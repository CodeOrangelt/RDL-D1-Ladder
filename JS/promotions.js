const a42_0x447617=a42_0x16a1,a42_0x2cfa50=(function(){let _0x2ce978=!![];return function(_0x171050,_0x4f093c){const _0x19bd95=_0x2ce978?function(){const _0x178fd8=a42_0x16a1;if(_0x4f093c){const _0x107aa9=_0x4f093c[_0x178fd8(0x1eb)](_0x171050,arguments);return _0x4f093c=null,_0x107aa9;}}:function(){};return _0x2ce978=![],_0x19bd95;};}()),a42_0x297fab=a42_0x2cfa50(this,function(){const _0x2cbcdc=a42_0x16a1;let _0x3af746;try{const _0x59fb36=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x3af746=_0x59fb36();}catch(_0x51f2f8){_0x3af746=window;}const _0x41dfe0=_0x3af746[_0x2cbcdc(0x1f1)]=_0x3af746['console']||{},_0x4f4437=[_0x2cbcdc(0x1c8),'warn',_0x2cbcdc(0x20a),_0x2cbcdc(0x1d6),_0x2cbcdc(0x1e6),'table',_0x2cbcdc(0x204)];for(let _0x279719=0x0;_0x279719<_0x4f4437[_0x2cbcdc(0x207)];_0x279719++){const _0x5ae273=a42_0x2cfa50['constructor'][_0x2cbcdc(0x1f9)][_0x2cbcdc(0x20e)](a42_0x2cfa50),_0x5ad071=_0x4f4437[_0x279719],_0x4ea3fd=_0x41dfe0[_0x5ad071]||_0x5ae273;_0x5ae273['__proto__']=a42_0x2cfa50['bind'](a42_0x2cfa50),_0x5ae273['toString']=_0x4ea3fd['toString']['bind'](_0x4ea3fd),_0x41dfe0[_0x5ad071]=_0x5ae273;}});a42_0x297fab();import{collection,doc,query,where,orderBy,limit,getDocs,addDoc,getDoc,serverTimestamp,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a42_0x16a1(_0x1b5d12,_0x581472){const _0x297fab=a42_0x4528();return a42_0x16a1=function(_0x2cfa50,_0xd8b31a){_0x2cfa50=_0x2cfa50-0x1a7;let _0x45287f=_0x297fab[_0x2cfa50];return _0x45287f;},a42_0x16a1(_0x1b5d12,_0x581472);}import{auth,db}from'./firebase-config.js';class PromotionManager{constructor(){const _0x152ae6=a42_0x16a1;this['DISPLAY_HOURS']=0x18,this['RANKS']=[{'threshold':0x578,'name':'Bronze','color':'#CD7F32'},{'threshold':0x640,'name':'Silver','color':'#C0C0C0'},{'threshold':0x708,'name':_0x152ae6(0x1f6),'color':'#FFD700'},{'threshold':0x834,'name':_0x152ae6(0x203),'color':_0x152ae6(0x202)}],this['bannerContainer']=null,this[_0x152ae6(0x1f7)]=0x0,this[_0x152ae6(0x20b)]=0xea60,this[_0x152ae6(0x1d8)]=null,this['usernameCache']={};}['initialize'](){const _0x1a516f=a42_0x16a1;this[_0x1a516f(0x1ef)]=document['getElementById']('promotion-banner-container');if(!this[_0x1a516f(0x1ef)]){console[_0x1a516f(0x1d6)](_0x1a516f(0x1b9));return;}this['setupBannerContainer']();const _0x506fd1=_0x1a516f(0x1b8)+new Date()[_0x1a516f(0x20d)](),_0x173f72=sessionStorage['getItem'](_0x506fd1);!_0x173f72&&(this['fetchRecentPromotions'](),sessionStorage['setItem'](_0x506fd1,_0x1a516f(0x1fe))),document['addEventListener'](_0x1a516f(0x208),()=>{const _0xaba37e=_0x1a516f;document['visibilityState']===_0xaba37e(0x1b3)&&!sessionStorage['getItem'](_0x506fd1)&&(this[_0xaba37e(0x1df)](),sessionStorage['setItem'](_0x506fd1,'true'));}),window['addEventListener'](_0x1a516f(0x1b7),()=>{const _0x1f675f=_0x1a516f;this['pollingInterval']&&clearInterval(this[_0x1f675f(0x1d8)]);});}['setupBannerContainer'](){this['bannerContainer']['innerHTML']='',this['bannerContainer']['style']['display']='none';}async['fetchRecentPromotions'](){const _0x372d2c=a42_0x16a1;try{const _0x444fa3=Date['now']();if(_0x444fa3-this[_0x372d2c(0x1f7)]<this['fetchInterval'])return;this['lastFetchTime']=_0x444fa3;const _0x43133a=collection(db,'eloHistory'),_0x3edbbc=query(_0x43133a,where('type','in',[_0x372d2c(0x1af),'demotion']),orderBy('timestamp','desc'),limit(0x14)),_0x2062ab=await getDocs(_0x3edbbc),_0x28c8b0=[];_0x2062ab[_0x372d2c(0x1bd)](_0xf558e7=>{const _0x30ee92=_0x372d2c,_0x178f84={'id':_0xf558e7['id'],..._0xf558e7['data']()};this['shouldShowPromotion'](_0xf558e7['id'])&&this[_0x30ee92(0x1cd)](_0x178f84)&&_0x28c8b0['push'](_0x178f84);}),_0x28c8b0['length']>0x0&&await this[_0x372d2c(0x1e4)](_0x28c8b0);}catch(_0x37da61){console['error']('Error\x20fetching\x20promotions:',_0x37da61);}}async['processRankChanges'](_0x3d50b5){const _0x461f37=a42_0x16a1;if(_0x3d50b5['length']===0x0)return;_0x3d50b5['sort']((_0x5614e3,_0x3d61bf)=>{const _0x1e61b0=a42_0x16a1,_0x537c5c=_0x5614e3['timestamp']?.['toMillis']?.()||_0x5614e3['timestamp']?.['seconds']*0x3e8||0x0,_0x244913=_0x3d61bf['timestamp']?.['toMillis']?.()||_0x3d61bf[_0x1e61b0(0x205)]?.['seconds']*0x3e8||0x0;return _0x244913-_0x537c5c;});const _0x316a1b=this['bannerContainer']['children']['length'],_0xa3f185=0x3-_0x316a1b;if(_0xa3f185<=0x0)return;const _0xeed093=_0x3d50b5['slice'](0x0,_0xa3f185);for(let _0x48601f=0x0;_0x48601f<_0xeed093['length'];_0x48601f++){const _0x1ce987=_0xeed093[_0x48601f],_0x4d2fd9=auth['currentUser'];try{setTimeout(()=>{const _0x59a882=a42_0x16a1;this[_0x59a882(0x1be)](_0x1ce987);},_0x48601f*0x3e8),_0x4d2fd9&&_0x1ce987[_0x461f37(0x1c0)]===_0x4d2fd9['displayName']&&this['showRankChangeLightbox'](_0x1ce987['type'],_0x1ce987['rankAchieved']);}catch(_0x52b0d2){console[_0x461f37(0x1d6)]('Error\x20processing\x20rank\x20change:',_0x52b0d2);}}}['shouldShowPromotion'](_0x33a18e){const _0xc5e9f7=a42_0x16a1;try{const _0x1f0718=_0xc5e9f7(0x1ab)+_0x33a18e,_0x3eda5c=localStorage['getItem'](_0x1f0718);if(_0x3eda5c){let _0x49a0b9;try{_0x49a0b9=JSON['parse'](_0x3eda5c);}catch(_0x2eafae){return console[_0xc5e9f7(0x209)]('Invalid\x20storage\x20format\x20for\x20'+_0x1f0718+',\x20treating\x20as\x20new'),!![];}if(_0x49a0b9['ignored']===!![])return console['log']('Promotion\x20'+_0x33a18e+'\x20is\x20permanently\x20ignored'),![];const _0xcd99eb=Date['now']();if(_0x49a0b9[_0xc5e9f7(0x206)]&&_0xcd99eb-_0x49a0b9['timestamp']<this[_0xc5e9f7(0x1e5)]*0x3c*0x3c*0x3e8)return console['log']('Promotion\x20'+_0x33a18e+'\x20was\x20dismissed\x20by\x20user\x20within\x20last\x20'+this['DISPLAY_HOURS']+'\x20hours'),![];if(_0x49a0b9['systemDismissed']&&_0xcd99eb-_0x49a0b9['timestamp']<0x4*0x3c*0x3c*0x3e8)return console['log']('Promotion\x20'+_0x33a18e+'\x20was\x20auto-dismissed\x20within\x20last\x204\x20hours'),![];}return!![];}catch(_0x53f910){return console[_0xc5e9f7(0x1d6)]('Error\x20checking\x20promotion\x20visibility:',_0x53f910),![];}}[a42_0x447617(0x1dd)](_0x4ab651){try{const _0x56d6af='promotion_'+_0x4ab651;localStorage['setItem'](_0x56d6af,JSON['stringify']({'timestamp':Date['now'](),'ignored':!![]}));}catch(_0x54252a){console['error']('Error\x20saving\x20promotion\x20preference:',_0x54252a);}}['showRankChangeBanner'](_0x74bfb1){const _0x2aec01=a42_0x447617;this[_0x2aec01(0x1a9)](_0x74bfb1)['then'](_0x599055=>{const _0xf97b61=_0x2aec01,_0x4e650f='promotion_'+_0x74bfb1['id'],_0x471ae1=localStorage['getItem'](_0x4e650f);if(_0x471ae1)try{const _0x369cf9=JSON['parse'](_0x471ae1);if(_0x369cf9['ignored']===!![]){console['log']('Skipping\x20ignored\x20promotion:\x20'+_0x74bfb1['id']);return;}}catch(_0x564c8b){}localStorage[_0xf97b61(0x1f2)](_0x4e650f,JSON[_0xf97b61(0x1a8)]({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':![],'seenAt':Date['now']()})),this['bannerContainer']['style']['display']='block';while(this['bannerContainer'][_0xf97b61(0x1ac)]['length']>=0x3){this[_0xf97b61(0x1ef)][_0xf97b61(0x1d1)](this[_0xf97b61(0x1ef)]['firstChild']);}const _0x2484b9=document['createElement'](_0xf97b61(0x1e7));_0x2484b9[_0xf97b61(0x1b5)]='promotion-banner',_0x2484b9['setAttribute']('data-rank',_0x599055['rankAchieved']),_0x2484b9['setAttribute']('data-id',_0x599055['id']);const _0x530069=document['createElement']('div');_0x530069['className']=_0xf97b61(0x1c7);const _0x10bae4=_0x599055['resolvedName']||_0x599055['player']||_0x599055['username']||_0x599055['playerUsername']||_0x599055[_0xf97b61(0x1e3)]||'A\x20player',_0x75ce4c=_0x599055['type']===_0xf97b61(0x1af)?_0x10bae4+'\x20was\x20promoted\x20to':_0x10bae4+'\x20was\x20demoted\x20to';_0x530069[_0xf97b61(0x1d5)]=_0x75ce4c+_0xf97b61(0x1f0)+_0x599055['rankAchieved']+_0xf97b61(0x1f4);const _0x439f73=document['createElement']('div');_0x439f73['className']=_0xf97b61(0x1fd);const _0x308cb3=document['createElement']('button');_0x308cb3['className']='dismiss-btn',_0x308cb3['innerHTML']='&times;',_0x308cb3[_0xf97b61(0x1bf)]='Dismiss';const _0x2f3517=document['createElement']('button');_0x2f3517[_0xf97b61(0x1b5)]=_0xf97b61(0x1d3),_0x2f3517['textContent']='Don\x27t\x20show\x20again',_0x2f3517['title']='Never\x20show\x20this\x20promotion\x20again',_0x439f73['appendChild'](_0x2f3517),_0x439f73['appendChild'](_0x308cb3),_0x2484b9['appendChild'](_0x530069),_0x2484b9['appendChild'](_0x439f73),this['bannerContainer']['appendChild'](_0x2484b9),void _0x2484b9['offsetWidth'],setTimeout(()=>{const _0x2c8916=_0xf97b61;_0x2484b9['classList'][_0x2c8916(0x1de)]('new-rank-change');},0x32),_0x308cb3['addEventListener']('click',()=>{const _0x437ef0=_0xf97b61;localStorage['setItem'](_0x4e650f,JSON[_0x437ef0(0x1a8)]({'timestamp':Date['now'](),'ignored':![],'userDismissed':!![],'systemDismissed':![]})),_0x2484b9['classList'][_0x437ef0(0x1ec)]('new-rank-change'),_0x2484b9['classList']['add'](_0x437ef0(0x1ae)),setTimeout(()=>{const _0x414405=_0x437ef0;_0x2484b9['parentNode']&&(_0x2484b9[_0x414405(0x1ec)](),this['bannerContainer'][_0x414405(0x1ac)][_0x414405(0x207)]===0x0&&(this[_0x414405(0x1ef)][_0x414405(0x200)]['display']='none'));},0x1f4);}),_0x2f3517[_0xf97b61(0x1c5)](_0xf97b61(0x20c),()=>{const _0xecb605=_0xf97b61;localStorage[_0xecb605(0x1f2)](_0x4e650f,JSON['stringify']({'timestamp':Date[_0xecb605(0x1cc)](),'ignored':!![],'userDismissed':!![],'systemDismissed':![]})),_0x2484b9['classList']['remove']('new-rank-change'),_0x2484b9[_0xecb605(0x1cb)][_0xecb605(0x1de)]('dismissing'),setTimeout(()=>{const _0x4203fd=_0xecb605;_0x2484b9[_0x4203fd(0x1bb)]&&(_0x2484b9['remove'](),this['bannerContainer']['children'][_0x4203fd(0x207)]===0x0&&(this['bannerContainer']['style']['display']='none'));},0x1f4);}),setTimeout(()=>{const _0x3baefe=_0xf97b61;_0x2484b9['parentNode']&&(_0x2484b9['classList'][_0x3baefe(0x1ec)]('new-rank-change'),_0x2484b9['classList']['add']('dismissing'),localStorage['setItem'](_0x4e650f,JSON[_0x3baefe(0x1a8)]({'timestamp':Date[_0x3baefe(0x1cc)](),'ignored':![],'userDismissed':![],'systemDismissed':!![]})),setTimeout(()=>{const _0x4e779c=_0x3baefe;_0x2484b9['parentNode']&&(_0x2484b9['remove'](),this['bannerContainer']['children'][_0x4e779c(0x207)]===0x0&&(this['bannerContainer']['style']['display']='none'));},0x1f4));},0x3a98);});}async['resolveUserId'](_0xd1bfa6){const _0x4ea3d0=a42_0x447617,_0x464958={..._0xd1bfa6},_0x27f22a=[_0xd1bfa6['player'],_0xd1bfa6['username'],_0xd1bfa6['playerUsername'],_0xd1bfa6['displayName']],_0x5a0402=_0x27f22a['some'](_0x564e32=>_0x564e32&&typeof _0x564e32==='string'&&!_0x564e32[_0x4ea3d0(0x1b0)]('ID:')&&!/^[a-zA-Z0-9]{20,}$/['test'](_0x564e32));if(_0x5a0402)return _0x464958;let _0x3a0f7d=null;if(_0xd1bfa6[_0x4ea3d0(0x1c9)])_0x3a0f7d=_0xd1bfa6[_0x4ea3d0(0x1c9)];else _0xd1bfa6['player']&&/^[A-Za-z0-9]{20,}$/['test'](_0xd1bfa6['player'])&&(_0x3a0f7d=_0xd1bfa6['player']);if(!_0x3a0f7d)return _0x464958;try{const _0x1a40c9=await getDoc(doc(db,'players',_0x3a0f7d));if(_0x1a40c9['exists']()){const _0x46cbd0=_0x1a40c9[_0x4ea3d0(0x1c2)]();if(_0x46cbd0['username'])return _0x464958['resolvedName']=_0x46cbd0['username'],_0x464958;}const _0x3fe2c9=await getDocs(query(collection(db,'approvedMatches'),where('winnerId','==',_0x3a0f7d),orderBy('date','desc'),limit(0x1)));if(!_0x3fe2c9['empty']){const _0x428059=_0x3fe2c9['docs'][0x0]['data']();if(_0x428059['winnerUsername'])return _0x464958[_0x4ea3d0(0x1b6)]=_0x428059['winnerUsername'],_0x464958;}const _0x543dad=await getDocs(query(collection(db,'approvedMatches'),where('loserId','==',_0x3a0f7d),orderBy('date','desc'),limit(0x1)));if(!_0x543dad[_0x4ea3d0(0x1ff)]){const _0x3286f5=_0x543dad['docs'][0x0]['data']();if(_0x3286f5['loserUsername'])return _0x464958['resolvedName']=_0x3286f5['loserUsername'],console[_0x4ea3d0(0x1c8)]('Resolved\x20'+_0x3a0f7d+_0x4ea3d0(0x1fc)+_0x3286f5['loserUsername']+_0x4ea3d0(0x1f5)),_0x464958;}}catch(_0x1bd7ed){console['error'](_0x4ea3d0(0x1bc),_0x1bd7ed);}return console[_0x4ea3d0(0x209)](_0x4ea3d0(0x1ba)+_0x3a0f7d),_0x464958;}['showRankChangeLightbox'](_0x3f9dcc,_0x2441ae){const _0x440d1b=a42_0x447617;let _0x892e8d=document[_0x440d1b(0x1a7)](_0x440d1b(0x1fb));!_0x892e8d&&(_0x892e8d=document[_0x440d1b(0x1c4)]('div'),_0x892e8d['id']='rankChangeModal',_0x892e8d['className']=_0x440d1b(0x1ee)+_0x3f9dcc,document[_0x440d1b(0x1e9)][_0x440d1b(0x1e2)](_0x892e8d));const _0x1d1bc1=_0x3f9dcc==='promotion'?'Congratulations!':_0x440d1b(0x1d4),_0x61835d=_0x3f9dcc===_0x440d1b(0x1af)?'You\x27ve\x20been\x20promoted\x20to':'You\x27ve\x20been\x20demoted\x20to';_0x892e8d[_0x440d1b(0x1d5)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rank-change-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2\x20class=\x22rank-change-title\x22>'+_0x1d1bc1+'</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>'+_0x61835d+_0x440d1b(0x1c6)+_0x2441ae+'</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22rank-change-button\x22\x20id=\x22rank-change-ok-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Got\x20it!\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x892e8d['style']['display']=_0x440d1b(0x1d9),document['getElementById']('rank-change-ok-btn')[_0x440d1b(0x1c5)](_0x440d1b(0x20c),()=>{const _0x24d791=_0x440d1b;_0x892e8d['style'][_0x24d791(0x1ea)]=_0x24d791(0x1ce);}),_0x892e8d['addEventListener']('click',_0x5f429e=>{_0x5f429e['target']===_0x892e8d&&(_0x892e8d['style']['display']='none');});}async['checkAndRecordPromotion'](_0x3fe921,_0x26b2da,_0x1b0b31,_0x31163f={}){const _0x5cc95a=a42_0x447617;try{if(_0x26b2da===_0x1b0b31||!_0x3fe921)return null;const _0x2dccb7=_0x31163f['source']||'automatic',_0x593bdb=_0x31163f[_0x5cc95a(0x1dc)]||null,_0x878366=_0x31163f['adminUser']||null;console[_0x5cc95a(0x1c8)]('Processing\x20potential\x20rank\x20change:\x20'+_0x1b0b31+'\x20→\x20'+_0x26b2da+'\x20(source:\x20'+_0x2dccb7+')');let _0x46869c=null,_0x50cc5c=null;try{const _0x11b9e8=await getDoc(doc(db,'players',_0x3fe921));if(_0x11b9e8[_0x5cc95a(0x1da)]()){const _0x23d741=_0x11b9e8['data']();_0x46869c=_0x23d741['username']||_0x23d741['displayName']||null,_0x50cc5c=_0x23d741['displayName']||_0x23d741['username']||null;}!_0x46869c&&_0x31163f['username']&&(_0x46869c=_0x31163f[_0x5cc95a(0x1aa)],_0x50cc5c=_0x31163f['username']);!_0x46869c&&auth['currentUser']&&(_0x46869c=auth['currentUser']['displayName']||auth[_0x5cc95a(0x1cf)]['email']['split']('@')[0x0],_0x50cc5c=auth[_0x5cc95a(0x1cf)]['displayName']||null);if(!_0x46869c){const _0x1e218c=query(collection(db,'approvedMatches'),where('winnerId','==',_0x3fe921),limit(0x1)),_0x35ba66=await getDocs(_0x1e218c);if(!_0x35ba66['empty'])_0x46869c=_0x35ba66['docs'][0x0]['data']()['winnerUsername']||_0x5cc95a(0x1c3),_0x50cc5c=_0x46869c;else{const _0x39447f=query(collection(db,'approvedMatches'),where('loserId','==',_0x3fe921),limit(0x1)),_0x448c72=await getDocs(_0x39447f);!_0x448c72['empty']&&(_0x46869c=_0x448c72[0x0][_0x5cc95a(0x1c2)]()[_0x5cc95a(0x201)]||'Unknown\x20Player',_0x50cc5c=_0x46869c);}}}catch(_0x37696f){console['error']('Error\x20resolving\x20username:',_0x37696f);}!_0x46869c&&(console['warn']('Could\x20not\x20resolve\x20username\x20for\x20userId:',_0x3fe921),_0x46869c=_0x5cc95a(0x1e8),_0x50cc5c=_0x5cc95a(0x1c3));const _0x320132=this['getRankName'](_0x1b0b31),_0x1cf4e2=this['getRankName'](_0x26b2da);if(_0x320132!==_0x1cf4e2){const _0x5b261e=_0x26b2da>_0x1b0b31,_0x1d96e6=_0x5b261e?'promotion':'demotion',_0xfea379=_0x1cf4e2;console['log']('Recording\x20'+_0x1d96e6+'\x20for\x20'+_0x46869c+':\x20'+_0x1b0b31+'\x20('+_0x320132+_0x5cc95a(0x1c1)+_0x26b2da+'\x20('+_0x1cf4e2+')');try{const _0x4d3555={'player':_0x46869c,'playerUsername':_0x46869c,'username':_0x46869c,'displayName':_0x50cc5c,'userId':_0x3fe921,'type':_0x1d96e6,'rankAchieved':_0xfea379,'timestamp':serverTimestamp(),'previousElo':_0x1b0b31,'newElo':_0x26b2da,'change':_0x26b2da-_0x1b0b31,'previousRank':_0x320132,'newRank':_0x1cf4e2,'source':_0x2dccb7};if(_0x2dccb7==='match'&&_0x593bdb)_0x4d3555[_0x5cc95a(0x1dc)]=_0x593bdb;else _0x2dccb7==='admin'&&_0x878366?(_0x4d3555['modifiedBy']=_0x878366,_0x4d3555['isAutomatic']=![]):_0x4d3555['isAutomatic']=!![];const _0x597244=writeBatch(db),_0x20c9eb=doc(collection(db,_0x5cc95a(0x1e1))),_0x269cbd=doc(collection(db,'promotionHistory'));return _0x597244[_0x5cc95a(0x1ed)](_0x20c9eb,_0x4d3555),_0x597244[_0x5cc95a(0x1ed)](_0x269cbd,_0x4d3555),await _0x597244[_0x5cc95a(0x1db)](),await this['sendPromotionNotification'](_0x3fe921,_0x46869c,_0x1b0b31,_0x26b2da,_0x320132,_0x1cf4e2,_0x1d96e6,{'displayName':_0x50cc5c,'source':_0x2dccb7,'matchId':_0x593bdb,'ladder':_0x31163f['ladder']||'D1'}),console[_0x5cc95a(0x1c8)](_0x5cc95a(0x1f8)+_0x1d96e6+_0x5cc95a(0x1ad)+_0x46869c+'\x20to\x20'+_0xfea379),_0xfea379;}catch(_0x13d01a){console['error']('Error\x20writing\x20promotion\x20records:',_0x13d01a);try{return await addDoc(collection(db,_0x5cc95a(0x1e1)),{'player':_0x46869c,'playerUsername':_0x46869c,'username':_0x46869c,'displayName':_0x50cc5c,'userId':_0x3fe921,'type':_0x1d96e6,'rankAchieved':_0xfea379,'timestamp':serverTimestamp(),'previousElo':_0x1b0b31,'newElo':_0x26b2da,'change':_0x26b2da-_0x1b0b31,'previousRank':_0x320132,'source':_0x2dccb7,'isAutomatic':_0x2dccb7!=='admin'}),await this[_0x5cc95a(0x1b1)](_0x3fe921,_0x46869c,_0x1b0b31,_0x26b2da,_0x320132,_0x1cf4e2,_0x1d96e6,{'displayName':_0x50cc5c,'source':_0x2dccb7,'matchId':_0x593bdb,'ladder':_0x31163f['ladder']||'D1'}),_0xfea379;}catch(_0x53a84d){return console['error']('Fallback\x20write\x20failed:',_0x53a84d),null;}}}return null;}catch(_0xb41e57){return console['error']('Error\x20in\x20promotion/demotion\x20recording:',_0xb41e57),null;}}[a42_0x447617(0x1fa)](_0x4a24ea){const _0x22d511=a42_0x447617;for(let _0x2d63ad=this['RANKS']['length']-0x1;_0x2d63ad>=0x0;_0x2d63ad--){if(_0x4a24ea>=this[_0x22d511(0x1d2)][_0x2d63ad]['threshold'])return this['RANKS'][_0x2d63ad]['name'];}return _0x22d511(0x1d7);}['cleanup'](){const _0x274cb5=a42_0x447617;this['pollingInterval']&&clearInterval(this[_0x274cb5(0x1d8)]);}[a42_0x447617(0x1cd)](_0x16cda0){const _0x57922c=a42_0x447617;if(_0x16cda0['timestamp']){const _0x5e1446=_0x16cda0['timestamp']['seconds']*0x3e8,_0x433332=Date['now'](),_0x4af298=(_0x433332-_0x5e1446)/(0x3e8*0x3c*0x3c);if(_0x4af298>0x18)return![];}if(_0x16cda0['previousRank']&&_0x16cda0['newRank']&&_0x16cda0[_0x57922c(0x1b4)]!==_0x16cda0[_0x57922c(0x1f3)])return!![];return![];}async['sendPromotionNotification'](_0x5bd06c,_0x5c7318,_0xb3ddd1,_0x50a6d3,_0x279c05,_0x2ea3ed,_0x2b78f7,_0x48911b={}){const _0x256f43=a42_0x447617;try{console['log']('STARTING\x20notification\x20for\x20'+_0x5c7318+'\x27s\x20'+_0x2b78f7);const _0x1d2030={'userId':_0x5bd06c,'username':_0x5c7318,'displayName':_0x48911b['displayName']||_0x5c7318,'oldElo':parseInt(_0xb3ddd1),'newElo':parseInt(_0x50a6d3),'eloDifference':parseInt(_0x50a6d3)-parseInt(_0xb3ddd1),'oldRank':_0x279c05,'newRank':_0x2ea3ed,'type':_0x2b78f7,'timestamp':serverTimestamp(),'processed':![],'source':_0x48911b[_0x256f43(0x1e0)]||_0x256f43(0x1b2),'matchId':_0x48911b[_0x256f43(0x1dc)]||null,'ladder':_0x48911b['ladder']||'D1','adminUser':_0x48911b['adminUser']||null};console['log']('Creating\x20Discord\x20notification:',_0x1d2030);const _0x42ce7f=await addDoc(collection(db,'promotionNotifications'),_0x1d2030);return console[_0x256f43(0x1c8)](_0x256f43(0x1d0)+_0x42ce7f['id']),!![];}catch(_0xfc494e){return console[_0x256f43(0x1d6)]('Error\x20sending\x20Discord\x20notification:',_0xfc494e),![];}}}export const promotionManager=new PromotionManager();document[a42_0x447617(0x1c5)]('DOMContentLoaded',()=>{const _0x22b0d1=a42_0x447617;promotionManager[_0x22b0d1(0x1ca)]();});export const initializePromotionTracker=()=>promotionManager[a42_0x447617(0x1ca)]();function a42_0x4528(){const _0x468752=['getElementById','stringify','resolveUserId','username','promotion_','children','\x20for\x20','dismissing','promotion','includes','sendPromotionNotification','automatic','visible','previousRank','className','resolvedName','beforeunload','promotions_checked_','Promotion\x20banner\x20container\x20not\x20found','Failed\x20to\x20resolve\x20user\x20ID:\x20','parentNode','Error\x20resolving\x20user\x20ID:','forEach','showRankChangeBanner','title','player',')\x20→\x20','data','Unknown\x20Player','createElement','addEventListener','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22rank-name\x22>','promotion-details','log','userId','initialize','classList','now','isNewRankChange','none','currentUser','Discord\x20notification\x20sent\x20successfully\x20with\x20ID:\x20','removeChild','RANKS','ignore-btn','Rank\x20Update','innerHTML','error','Unranked','pollingInterval','flex','exists','commit','matchId','ignorePromotion','add','fetchRecentPromotions','source','eloHistory','appendChild','displayName','processRankChanges','DISPLAY_HOURS','exception','div','A\x20player','body','display','apply','remove','set','rank-change-modal\x20','bannerContainer','\x20<span\x20class=\x22rank-text\x22>','console','setItem','newRank','</span>','\x20(loser)','Gold','lastFetchTime','Successfully\x20recorded\x20','prototype','getRankName','rankChangeModal','\x20to\x20','banner-actions','true','empty','style','loserUsername','#50C878','Emerald','trace','timestamp','userDismissed','length','visibilitychange','warn','info','fetchInterval','click','toDateString','bind'];a42_0x4528=function(){return _0x468752;};return a42_0x4528();}export const checkAndRecordPromotion=(_0x260eaa,_0x5a935f,_0x51b86e,_0x1b7c0f)=>promotionManager['checkAndRecordPromotion'](_0x260eaa,_0x5a935f,_0x51b86e,_0x1b7c0f);export const getRankName=_0x191c8b=>promotionManager['getRankName'](_0x191c8b);
const a54_0x73134e=a54_0x253f,a54_0x1f4af7=(function(){let _0x4d4eac=!![];return function(_0x3e6ac8,_0x8805c){const _0x5d73eb=_0x4d4eac?function(){if(_0x8805c){const _0x5691f8=_0x8805c['apply'](_0x3e6ac8,arguments);return _0x8805c=null,_0x5691f8;}}:function(){};return _0x4d4eac=![],_0x5d73eb;};}()),a54_0x2dcb5f=a54_0x1f4af7(this,function(){const _0x3fffdd=a54_0x253f;let _0x1e297d;try{const _0xc233d3=Function('return\x20(function()\x20'+_0x3fffdd(0x125)+');');_0x1e297d=_0xc233d3();}catch(_0x3a402e){_0x1e297d=window;}const _0x270a81=_0x1e297d[_0x3fffdd(0x114)]=_0x1e297d[_0x3fffdd(0x114)]||{},_0x9de890=[_0x3fffdd(0x123),'warn','info','error','exception','table',_0x3fffdd(0x126)];for(let _0x149bc9=0x0;_0x149bc9<_0x9de890['length'];_0x149bc9++){const _0x38793b=a54_0x1f4af7['constructor']['prototype']['bind'](a54_0x1f4af7),_0x1d31a0=_0x9de890[_0x149bc9],_0x184a5d=_0x270a81[_0x1d31a0]||_0x38793b;_0x38793b[_0x3fffdd(0x121)]=a54_0x1f4af7['bind'](a54_0x1f4af7),_0x38793b['toString']=_0x184a5d['toString']['bind'](_0x184a5d),_0x270a81[_0x1d31a0]=_0x38793b;}});a54_0x2dcb5f();import{db}from'../firebase-config.js';import{collection,doc,getDoc,getDocs,query,limit,startAfter,where,onSnapshot}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const cache={'userProfiles':new Map(),'ladderPlayers':new Map(),'matchResults':new Map(),'eloHistory':new Map()},CACHE_EXPIRY={'userProfiles':0x5*0x3c*0x3e8,'ladderPlayers':0x2*0x3c*0x3e8,'matchResults':0x1*0x3c*0x3e8,'eloHistory':0x3*0x3c*0x3e8};function a54_0x12bf(){const _0x5f54c7=['console','ladderPlayers','doc','slice','playersD3','set','playersD2','length','eloHistory','now','userProfiles','docs','get','__proto__','playersD','log','data','{}.constructor(\x22return\x20this\x22)(\x20)','trace','playerId','timestamp'];a54_0x12bf=function(){return _0x5f54c7;};return a54_0x12bf();}export const userProfilesRef=collection(db,'userProfiles');export async function fetchPaginatedData(_0x57cbea,_0x51de26=0xa,_0x19395f=null){const _0x2de1c3=a54_0x253f;let _0x51623d=query(_0x57cbea,limit(_0x51de26));_0x19395f&&(_0x51623d=query(_0x51623d,startAfter(_0x19395f)));const _0x56ff8d=await getDocs(_0x51623d),_0x5f00e5=_0x56ff8d['docs'][_0x56ff8d[_0x2de1c3(0x11f)]['length']-0x1];return{'data':_0x56ff8d['docs']['map'](_0x54c6e5=>({'id':_0x54c6e5['id'],..._0x54c6e5['data']()})),'lastVisible':_0x5f00e5,'hasMore':_0x56ff8d['docs'][_0x2de1c3(0x11b)]===_0x51de26};}export async function getUserProfile(_0x2395c4){const _0x26e8c1=a54_0x253f,_0x10b7a4=cache[_0x26e8c1(0x11e)]['get'](_0x2395c4);if(_0x10b7a4&&Date['now']()-_0x10b7a4['timestamp']<CACHE_EXPIRY[_0x26e8c1(0x11e)])return _0x10b7a4[_0x26e8c1(0x124)];const _0x34d096=await getDoc(doc(userProfilesRef,_0x2395c4));if(_0x34d096['exists']()){const _0x3d0534=_0x34d096['data']();return cache['userProfiles']['set'](_0x2395c4,{'data':_0x3d0534,'timestamp':Date['now']()}),_0x3d0534;}return null;}export async function getLadderData(_0x853245=0x1){const _0x4f8eb5=a54_0x253f,_0x54f1c3='division_'+_0x853245,_0x1c488a=cache[_0x4f8eb5(0x115)][_0x4f8eb5(0x120)](_0x54f1c3);if(_0x1c488a&&Date['now']()-_0x1c488a[_0x4f8eb5(0x128)]<CACHE_EXPIRY[_0x4f8eb5(0x115)])return _0x1c488a['data'];const _0x1fb623=_0x853245===0x1?'players':_0x4f8eb5(0x122)+_0x853245,_0x1e9390=collection(db,_0x1fb623),_0x1ec91d=await getDocs(query(_0x1e9390,limit(0x64))),_0x2fac70=_0x1ec91d[_0x4f8eb5(0x11f)]['map'](_0x280cf2=>({'id':_0x280cf2['id'],..._0x280cf2[_0x4f8eb5(0x124)]()}));return cache['ladderPlayers'][_0x4f8eb5(0x119)](_0x54f1c3,{'data':_0x2fac70,'timestamp':Date['now']()}),_0x2fac70;}function a54_0x253f(_0x2dc8d6,_0x2349b8){const _0x2dcb5f=a54_0x12bf();return a54_0x253f=function(_0x1f4af7,_0x153a47){_0x1f4af7=_0x1f4af7-0x114;let _0x12bfb5=_0x2dcb5f[_0x1f4af7];return _0x12bfb5;},a54_0x253f(_0x2dc8d6,_0x2349b8);}export async function getEloHistoryBatch(_0x315ee9,_0x280ec7=0x1){const _0x44a126=a54_0x253f,_0x4a48ce=_0x280ec7===0x1?'eloHistory':'eloHistoryD'+_0x280ec7,_0x18b72f=collection(db,_0x4a48ce),_0x4298cb={},_0x378ce4=[];_0x315ee9['forEach'](_0x1a164f=>{const _0x3656f7=a54_0x253f,_0x294086=_0x1a164f+'_'+_0x280ec7,_0x3ad349=cache['eloHistory']['get'](_0x294086);_0x3ad349&&Date[_0x3656f7(0x11d)]()-_0x3ad349['timestamp']<CACHE_EXPIRY[_0x3656f7(0x11c)]?_0x4298cb[_0x1a164f]=_0x3ad349['data']:_0x378ce4['push'](_0x1a164f);});const _0x4ccec2=0xa;for(let _0x2db420=0x0;_0x2db420<_0x378ce4['length'];_0x2db420+=_0x4ccec2){const _0x4c6c80=_0x378ce4[_0x44a126(0x117)](_0x2db420,_0x2db420+_0x4ccec2);if(_0x4c6c80[_0x44a126(0x11b)]>0x0)try{const _0x4b5524=query(_0x18b72f,where('playerId','in',_0x4c6c80),limit(0x64)),_0x8981f0=await getDocs(_0x4b5524);_0x8981f0['docs']['forEach'](_0x33a7a0=>{const _0x2ca3d3=_0x44a126,_0x5a202f=_0x33a7a0['data'](),_0x3f15a8=_0x5a202f[_0x2ca3d3(0x127)];if(!_0x4298cb[_0x3f15a8])_0x4298cb[_0x3f15a8]=[];_0x4298cb[_0x3f15a8]['push'](_0x5a202f);const _0x56cfac=_0x3f15a8+'_'+_0x280ec7;cache['eloHistory'][_0x2ca3d3(0x119)](_0x56cfac,{'data':_0x4298cb[_0x3f15a8],'timestamp':Date['now']()});});}catch(_0x111200){console['error']('Error\x20fetching\x20batch\x20ELO\x20history:',_0x111200);}}return _0x4298cb;}let usernameCache=new Map(),usernameCacheTimestamp=Date[a54_0x73134e(0x11d)]();export function setupEfficientListener(_0x366b0a,_0xb8dc15=[],_0x49732d){const _0x4c6d34=collection(db,_0x366b0a),_0x3706c0=query(_0x4c6d34,..._0xb8dc15),_0x3d1eae=onSnapshot(_0x3706c0,_0x101591=>{const _0x299d75=a54_0x253f,_0x5708c1=_0x101591['docChanges']()['map'](_0x33b6e0=>({'type':_0x33b6e0['type'],'id':_0x33b6e0['doc']['id'],'data':_0x33b6e0[_0x299d75(0x116)]['data']()}));_0x5708c1['length']>0x0&&_0x49732d(_0x5708c1,_0x101591['docs']);});return _0x3d1eae;}export async function bulkResolveUsernames(_0x8f4b20){const _0x3f96f9=a54_0x73134e,_0x294ff4=new Map();if(!_0x8f4b20||_0x8f4b20['length']===0x0)return _0x294ff4;const _0x3307e5=['players',_0x3f96f9(0x11a),_0x3f96f9(0x118),'nonParticipants'];for(const _0x45adb6 of _0x3307e5){const _0xc05c2a=collection(db,_0x45adb6),_0x4fcb4e=await getDocs(_0xc05c2a);_0x4fcb4e['forEach'](_0x2aaaa3=>{const _0x4a03c2=_0x3f96f9,_0x59b56c=_0x2aaaa3['data']();_0x59b56c['username']&&_0x8f4b20['includes'](_0x2aaaa3['id'])&&_0x294ff4[_0x4a03c2(0x119)](_0x2aaaa3['id'],_0x59b56c['username']);});}return _0x294ff4;}
const a12_0x5f3197=a12_0x5702,a12_0x49726e=(function(){let _0x52ac14=!![];return function(_0x1c0e02,_0x1eaa36){const _0x57dce5=_0x52ac14?function(){const _0x40955b=a12_0x5702;if(_0x1eaa36){const _0xec1537=_0x1eaa36[_0x40955b(0x77)](_0x1c0e02,arguments);return _0x1eaa36=null,_0xec1537;}}:function(){};return _0x52ac14=![],_0x57dce5;};}()),a12_0xb77232=a12_0x49726e(this,function(){const _0x32df5b=a12_0x5702;let _0x196e5a;try{const _0x91c58a=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x196e5a=_0x91c58a();}catch(_0x42f642){_0x196e5a=window;}const _0xfc7bc0=_0x196e5a['console']=_0x196e5a['console']||{},_0x44a6ef=['log','warn','info','error','exception','table',_0x32df5b(0x7a)];for(let _0x26d508=0x0;_0x26d508<_0x44a6ef[_0x32df5b(0x7b)];_0x26d508++){const _0x508dce=a12_0x49726e['constructor']['prototype']['bind'](a12_0x49726e),_0x39bf72=_0x44a6ef[_0x26d508],_0x16964f=_0xfc7bc0[_0x39bf72]||_0x508dce;_0x508dce['__proto__']=a12_0x49726e['bind'](a12_0x49726e),_0x508dce['toString']=_0x16964f['toString']['bind'](_0x16964f),_0xfc7bc0[_0x39bf72]=_0x508dce;}});function a12_0x5702(_0x5d6a09,_0x4222c6){const _0xb77232=a12_0x590f();return a12_0x5702=function(_0x49726e,_0x2dc0f6){_0x49726e=_0x49726e-0x6d;let _0x590f74=_0xb77232[_0x49726e];return _0x590f74;},a12_0x5702(_0x5d6a09,_0x4222c6);}function a12_0x590f(){const _0x245d9b=['Unranked','empty','Unknown\x20Player','newElo','winnerId','Emerald','log','Gold','playersD2','loserId','apply','docs','eloHistoryD2','trace','length','Bronze'];a12_0x590f=function(){return _0x245d9b;};return a12_0x590f();}a12_0xb77232();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D2=[{'name':'Gold','elo':0x708},{'name':'Silver','elo':0x640},{'name':a12_0x5f3197(0x7c),'elo':0x578},{'name':'Unranked','elo':0x4b0}];let lastVisibleD2=null;async function getUsernameByIdD2(_0xb66c0e){const _0x38ca23=a12_0x5f3197;try{if(!_0xb66c0e)return _0x38ca23(0x6f);const _0x236c72=await getDoc(doc(db,_0x38ca23(0x75),_0xb66c0e));if(_0x236c72['exists']())return _0x236c72['data']()['username']||'Unknown\x20Player';const _0x33cfea=await getDocs(query(collection(db,'approvedMatchesD2'),where(_0x38ca23(0x71),'==',_0xb66c0e),limit(0x1)));if(!_0x33cfea['empty'])return _0x33cfea['docs'][0x0]['data']()['winnerUsername']||'Unknown\x20Player';const _0x2fd152=await getDocs(query(collection(db,'approvedMatchesD2'),where(_0x38ca23(0x76),'==',_0xb66c0e),limit(0x1)));if(!_0x2fd152[_0x38ca23(0x6e)])return _0x2fd152['docs'][0x0]['data']()['loserUsername']||'Unknown\x20Player';return _0x38ca23(0x6f);}catch(_0x2214fd){return console['error']('Error\x20getting\x20username:',_0x2214fd),_0x38ca23(0x6f);}}export async function recordEloChangeD2({playerId:_0x4e95b4,previousElo:_0x4f5a41,newElo:_0x598df5,opponentId:_0x23b27d,matchResult:_0x5a0968,previousPosition:_0x32406c,newPosition:_0x6911d1,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x1e432c,timestamp:_0x1ca4a9}){const _0x514faf=a12_0x5f3197;try{const _0x1994e3=doc(collection(db,'eloHistoryD2'));let _0x9727d5='match';if(isPromotion)_0x9727d5='promotion';if(isDemotion)_0x9727d5='demotion';let _0x433537=_0x514faf(0x6d);if(_0x598df5>=0x834)_0x433537=_0x514faf(0x72);else{if(_0x598df5>=0x708)_0x433537=_0x514faf(0x74);else{if(_0x598df5>=0x640)_0x433537='Silver';else{if(_0x598df5>=0x578)_0x433537='Bronze';}}}return await setDoc(_0x1994e3,{'type':_0x9727d5,'player':_0x4e95b4,'opponent':_0x23b27d,'previousElo':_0x4f5a41,'newElo':_0x598df5,'change':_0x598df5-_0x4f5a41,'matchResult':_0x5a0968,'previousPosition':_0x32406c,'newPosition':_0x6911d1,'rankAchieved':_0x433537,'matchId':_0x1e432c,'timestamp':_0x1ca4a9}),console[_0x514faf(0x73)]('D2\x20ELO\x20history\x20recorded\x20for\x20'+_0x4e95b4),!![];}catch(_0x2bee3e){console['error']('Error\x20recording\x20D2\x20ELO\x20history:',_0x2bee3e);throw _0x2bee3e;}}export async function getEloHistoryD2(_0x4ac342=0x14){const _0x3c5ccc=a12_0x5f3197;try{const _0x43beba=collection(db,_0x3c5ccc(0x79));let _0x529d0e;lastVisibleD2?_0x529d0e=query(_0x43beba,orderBy('timestamp','desc'),startAfter(lastVisibleD2),limit(_0x4ac342)):_0x529d0e=query(_0x43beba,orderBy('timestamp','desc'),limit(_0x4ac342));const _0x41b298=await getDocs(_0x529d0e);if(_0x41b298['empty'])return{'entries':[],'hasMore':![]};lastVisibleD2=_0x41b298[_0x3c5ccc(0x78)][_0x41b298['docs'][_0x3c5ccc(0x7b)]-0x1];const _0x118ddc=_0x41b298['docs']['map'](async _0x36f45c=>{const _0x11fe77=_0x3c5ccc,_0x40e695=_0x36f45c['data'](),[_0x48d05a,_0xba086c]=await Promise['all']([getUsernameByIdD2(_0x40e695['player']),getUsernameByIdD2(_0x40e695['opponent'])]);return{..._0x40e695,'playerUsername':_0x48d05a,'opponentUsername':_0xba086c,'change':_0x40e695[_0x11fe77(0x70)]-_0x40e695['previousElo'],'timestamp':_0x40e695['timestamp']};}),_0x2c5d32=await Promise['all'](_0x118ddc);return{'entries':_0x2c5d32,'hasMore':_0x41b298['size']===_0x4ac342};}catch(_0x201bd3){console['error']('Error\x20fetching\x20D2\x20ELO\x20history:',_0x201bd3);throw _0x201bd3;}}export function resetPaginationD2(){lastVisibleD2=null;}
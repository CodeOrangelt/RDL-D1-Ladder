const a50_0x1af0f6=(function(){let _0x5e889d=!![];return function(_0xd11681,_0x120272){const _0x60b7b9=_0x5e889d?function(){if(_0x120272){const _0x4f0853=_0x120272['apply'](_0xd11681,arguments);return _0x120272=null,_0x4f0853;}}:function(){};return _0x5e889d=![],_0x60b7b9;};}()),a50_0x494fbc=a50_0x1af0f6(this,function(){const _0x3b2b20=a50_0x9d1d,_0x53aa18=function(){let _0x3fad4c;try{_0x3fad4c=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x2cd7e8){_0x3fad4c=window;}return _0x3fad4c;},_0x562363=_0x53aa18(),_0x1ed492=_0x562363['console']=_0x562363[_0x3b2b20(0x68)]||{},_0x34d862=['log',_0x3b2b20(0x74),'info','error','exception','table',_0x3b2b20(0x64)];for(let _0x3c49e4=0x0;_0x3c49e4<_0x34d862[_0x3b2b20(0x6f)];_0x3c49e4++){const _0x1e557a=a50_0x1af0f6['constructor']['prototype']['bind'](a50_0x1af0f6),_0x535119=_0x34d862[_0x3c49e4],_0x5adaa3=_0x1ed492[_0x535119]||_0x1e557a;_0x1e557a['__proto__']=a50_0x1af0f6[_0x3b2b20(0x77)](a50_0x1af0f6),_0x1e557a[_0x3b2b20(0x6b)]=_0x5adaa3['toString']['bind'](_0x5adaa3),_0x1ed492[_0x535119]=_0x1e557a;}});a50_0x494fbc();import{db}from'../firebase-config.js';function a50_0x9d1d(_0x4dd846,_0x2ba879){const _0x494fbc=a50_0x43c8();return a50_0x9d1d=function(_0x1af0f6,_0x38f127){_0x1af0f6=_0x1af0f6-0x64;let _0x43c8ea=_0x494fbc[_0x1af0f6];return _0x43c8ea;},a50_0x9d1d(_0x4dd846,_0x2ba879);}import{collection,doc,getDoc,getDocs,query,limit,startAfter,where,onSnapshot}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const cache={'userProfiles':new Map(),'ladderPlayers':new Map(),'matchResults':new Map(),'eloHistory':new Map()},CACHE_EXPIRY={'userProfiles':0x5*0x3c*0x3e8,'ladderPlayers':0x2*0x3c*0x3e8,'matchResults':0x1*0x3c*0x3e8,'eloHistory':0x3*0x3c*0x3e8};export const userProfilesRef=collection(db,'userProfiles');function a50_0x43c8(){const _0x923ef3=['trace','division_','docs','get','console','eloHistory','eloHistoryD','toString','data','timestamp','forEach','length','push','players','nonParticipants','doc','warn','set','now','bind','map'];a50_0x43c8=function(){return _0x923ef3;};return a50_0x43c8();}export async function fetchPaginatedData(_0x2df4c3,_0x5dbb2b=0xa,_0x4f58d5=null){const _0x27b128=a50_0x9d1d;let _0x1cb67a=query(_0x2df4c3,limit(_0x5dbb2b));_0x4f58d5&&(_0x1cb67a=query(_0x1cb67a,startAfter(_0x4f58d5)));const _0xc5d424=await getDocs(_0x1cb67a),_0x731d14=_0xc5d424['docs'][_0xc5d424[_0x27b128(0x66)]['length']-0x1];return{'data':_0xc5d424['docs'][_0x27b128(0x78)](_0x739242=>({'id':_0x739242['id'],..._0x739242['data']()})),'lastVisible':_0x731d14,'hasMore':_0xc5d424['docs']['length']===_0x5dbb2b};}export async function getUserProfile(_0x44b276){const _0x4f4e42=a50_0x9d1d,_0x1548aa=cache['userProfiles'][_0x4f4e42(0x67)](_0x44b276);if(_0x1548aa&&Date['now']()-_0x1548aa['timestamp']<CACHE_EXPIRY['userProfiles'])return _0x1548aa['data'];const _0x4e4047=await getDoc(doc(userProfilesRef,_0x44b276));if(_0x4e4047['exists']()){const _0x5a2f11=_0x4e4047['data']();return cache['userProfiles']['set'](_0x44b276,{'data':_0x5a2f11,'timestamp':Date['now']()}),_0x5a2f11;}return null;}export async function getLadderData(_0x4cbb95=0x1){const _0xcf323e=a50_0x9d1d,_0x11c794=_0xcf323e(0x65)+_0x4cbb95,_0x278823=cache['ladderPlayers']['get'](_0x11c794);if(_0x278823&&Date[_0xcf323e(0x76)]()-_0x278823[_0xcf323e(0x6d)]<CACHE_EXPIRY['ladderPlayers'])return _0x278823['data'];const _0x1518c9=_0x4cbb95===0x1?'players':'playersD'+_0x4cbb95,_0x29928c=collection(db,_0x1518c9),_0xa57e9b=await getDocs(query(_0x29928c,limit(0x64))),_0x5c923e=_0xa57e9b['docs']['map'](_0x314e38=>({'id':_0x314e38['id'],..._0x314e38[_0xcf323e(0x6c)]()}));return cache['ladderPlayers']['set'](_0x11c794,{'data':_0x5c923e,'timestamp':Date['now']()}),_0x5c923e;}export async function getEloHistoryBatch(_0x1e712b,_0x45d6f3=0x1){const _0x544336=a50_0x9d1d,_0x4bde5f=_0x45d6f3===0x1?_0x544336(0x69):_0x544336(0x6a)+_0x45d6f3,_0x1b3ad9=collection(db,_0x4bde5f),_0x4d3aa2={},_0x5ce9ed=[];_0x1e712b[_0x544336(0x6e)](_0x4de7a5=>{const _0x15fb1a=_0x4de7a5+'_'+_0x45d6f3,_0x346d2b=cache['eloHistory']['get'](_0x15fb1a);_0x346d2b&&Date['now']()-_0x346d2b['timestamp']<CACHE_EXPIRY['eloHistory']?_0x4d3aa2[_0x4de7a5]=_0x346d2b['data']:_0x5ce9ed['push'](_0x4de7a5);});const _0x45be72=0xa;for(let _0x45e463=0x0;_0x45e463<_0x5ce9ed[_0x544336(0x6f)];_0x45e463+=_0x45be72){const _0xdcbbbf=_0x5ce9ed['slice'](_0x45e463,_0x45e463+_0x45be72);if(_0xdcbbbf['length']>0x0)try{const _0x2b28fd=query(_0x1b3ad9,where('playerId','in',_0xdcbbbf),limit(0x64)),_0x363234=await getDocs(_0x2b28fd);_0x363234['docs']['forEach'](_0x3575a7=>{const _0x1cdc1c=_0x544336,_0x5a2c85=_0x3575a7['data'](),_0x4baa20=_0x5a2c85['playerId'];if(!_0x4d3aa2[_0x4baa20])_0x4d3aa2[_0x4baa20]=[];_0x4d3aa2[_0x4baa20][_0x1cdc1c(0x70)](_0x5a2c85);const _0x273626=_0x4baa20+'_'+_0x45d6f3;cache[_0x1cdc1c(0x69)]['set'](_0x273626,{'data':_0x4d3aa2[_0x4baa20],'timestamp':Date[_0x1cdc1c(0x76)]()});});}catch(_0x1cfb6c){console['error']('Error\x20fetching\x20batch\x20ELO\x20history:',_0x1cfb6c);}}return _0x4d3aa2;}let usernameCache=new Map(),usernameCacheTimestamp=Date['now']();export function setupEfficientListener(_0x50757c,_0x35fc49=[],_0x4f9ed4){const _0x1fb8a2=collection(db,_0x50757c),_0x968507=query(_0x1fb8a2,..._0x35fc49),_0x293b6b=onSnapshot(_0x968507,_0x428d02=>{const _0x38ba9c=a50_0x9d1d,_0x16ff62=_0x428d02['docChanges']()['map'](_0x4b5c4c=>({'type':_0x4b5c4c['type'],'id':_0x4b5c4c[_0x38ba9c(0x73)]['id'],'data':_0x4b5c4c['doc']['data']()}));_0x16ff62['length']>0x0&&_0x4f9ed4(_0x16ff62,_0x428d02['docs']);});return _0x293b6b;}export async function bulkResolveUsernames(_0x43d30f){const _0x5dadcd=a50_0x9d1d,_0x1cf387=new Map();if(!_0x43d30f||_0x43d30f[_0x5dadcd(0x6f)]===0x0)return _0x1cf387;const _0x1cd0ce=[_0x5dadcd(0x71),'playersD2','playersD3',_0x5dadcd(0x72)];for(const _0x532ef0 of _0x1cd0ce){const _0x9f38a=collection(db,_0x532ef0),_0x4438f2=await getDocs(_0x9f38a);_0x4438f2[_0x5dadcd(0x6e)](_0x52aa89=>{const _0x45c2f0=_0x5dadcd,_0x132722=_0x52aa89[_0x45c2f0(0x6c)]();_0x132722['username']&&_0x43d30f['includes'](_0x52aa89['id'])&&_0x1cf387[_0x45c2f0(0x75)](_0x52aa89['id'],_0x132722['username']);});}return _0x1cf387;}
const a29_0x204e53=(function(){let _0x46f16b=!![];return function(_0x87ad23,_0x281f5){const _0x2c3eff=_0x46f16b?function(){const _0x231c6e=a29_0x5355;if(_0x281f5){const _0x2902be=_0x281f5[_0x231c6e(0xf5)](_0x87ad23,arguments);return _0x281f5=null,_0x2902be;}}:function(){};return _0x46f16b=![],_0x2c3eff;};}()),a29_0x4b8f33=a29_0x204e53(this,function(){const _0x24f911=a29_0x5355,_0x72a88c=function(){const _0x3fbb55=a29_0x5355;let _0xe9fe8;try{_0xe9fe8=Function(_0x3fbb55(0xf0)+_0x3fbb55(0xf2)+');')();}catch(_0x2fc3b9){_0xe9fe8=window;}return _0xe9fe8;},_0x15354b=_0x72a88c(),_0x351760=_0x15354b['console']=_0x15354b[_0x24f911(0xe8)]||{},_0x3d285c=['log','warn',_0x24f911(0xeb),'error','exception','table',_0x24f911(0xf1)];for(let _0x23ba24=0x0;_0x23ba24<_0x3d285c['length'];_0x23ba24++){const _0x200825=a29_0x204e53['constructor']['prototype']['bind'](a29_0x204e53),_0x161d8e=_0x3d285c[_0x23ba24],_0x34720b=_0x351760[_0x161d8e]||_0x200825;_0x200825['__proto__']=a29_0x204e53[_0x24f911(0xe7)](a29_0x204e53),_0x200825['toString']=_0x34720b[_0x24f911(0xf7)]['bind'](_0x34720b),_0x351760[_0x161d8e]=_0x200825;}});a29_0x4b8f33();import{addDoc,updateDoc,serverTimestamp,collection,doc,getDoc,getDocs,query,where,setDoc,deleteDoc,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a29_0x4279(){const _0x12a9d7=['bind','console','username','Starting\x20approveReportD3\x20function\x20with:','info','D3\x20Match\x20successfully\x20approved\x20and\x20ELO\x20updated','eloRating','uid','D3\x20Report\x20not\x20found\x20with\x20ID:','return\x20(function()\x20','trace','{}.constructor(\x22return\x20this\x22)(\x20)','log','exists','apply','D3\x20ELO\x20ratings\x20updated\x20successfully','toString','D3\x20Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions','One\x20or\x20both\x20D3\x20players\x20not\x20found','loss','MAX_SAFE_INTEGER','winnerUsername','pow','empty','playersD3','position','update','all','D3\x20Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked','data'];a29_0x4279=function(){return _0x12a9d7;};return a29_0x4279();}import{db,auth}from'./firebase-config.js';import{recordEloChangeD3}from'./elo-history-d3.js';export function calculateEloD3(_0x5a4931,_0x436d9a,_0x1dd9fc=0x20){const _0x270ef3=a29_0x5355,_0x23c4ba=0x1/(0x1+Math['pow'](0xa,(_0x436d9a-_0x5a4931)/0x190)),_0x1be051=0x1/(0x1+Math[_0x270ef3(0xfd)](0xa,(_0x5a4931-_0x436d9a)/0x190)),_0x227f9f=_0x5a4931+_0x1dd9fc*(0x1-_0x23c4ba),_0x2789ef=_0x436d9a+_0x1dd9fc*(0x0-_0x1be051);return{'newWinnerRating':Math['round'](_0x227f9f),'newLoserRating':Math['round'](_0x2789ef)};}function a29_0x5355(_0x3845a0,_0x202552){const _0x4b8f33=a29_0x4279();return a29_0x5355=function(_0x204e53,_0x39c305){_0x204e53=_0x204e53-0xe7;let _0x42792c=_0x4b8f33[_0x204e53];return _0x42792c;},a29_0x5355(_0x3845a0,_0x202552);}export async function updateEloRatingsD3(_0x1e63e7,_0x4a046c,_0x2ef41f){const _0x1079f7=a29_0x5355;try{const _0x446776=writeBatch(db),_0x4c6cd8=doc(db,'playersD3',_0x1e63e7),_0x457065=doc(db,'playersD3',_0x4a046c),[_0x1ccfe5,_0x1a2001]=await Promise[_0x1079f7(0x102)]([getDoc(_0x4c6cd8),getDoc(_0x457065)]);if(!_0x1ccfe5[_0x1079f7(0xf4)]()||!_0x1a2001['exists']())throw new Error(_0x1079f7(0xf9));const _0x1a8689=_0x1ccfe5['data'](),_0x28ee71=_0x1a2001['data'](),_0x25ed4b=_0x1a8689['position']||Number['MAX_SAFE_INTEGER'],_0x3ec2e6=_0x28ee71['position']||Number[_0x1079f7(0xfb)],{newWinnerRating:_0x4befce,newLoserRating:_0x20422c}=calculateEloD3(_0x1a8689['eloRating']||0x4b0,_0x28ee71['eloRating']||0x4b0);let _0x30d386=_0x25ed4b,_0x35923e=_0x3ec2e6;if(_0x25ed4b>_0x3ec2e6){console[_0x1079f7(0xf3)](_0x1079f7(0x103)),_0x30d386=_0x3ec2e6,_0x35923e=_0x3ec2e6+0x1;const _0x2d8dbc=query(collection(db,'playersD3'),where('position','>',_0x3ec2e6),where(_0x1079f7(0x100),'<',_0x25ed4b)),_0x5ea85c=await getDocs(_0x2d8dbc);for(const _0x1491b7 of _0x5ea85c['docs']){_0x1491b7['id']!==_0x1e63e7&&_0x1491b7['id']!==_0x4a046c&&_0x446776['update'](doc(db,_0x1079f7(0xff),_0x1491b7['id']),{'position':_0x1491b7['data']()['position']+0x1});}}else console['log'](_0x1079f7(0xf8));return _0x446776[_0x1079f7(0x101)](_0x4c6cd8,{'eloRating':_0x4befce,'lastMatchDate':serverTimestamp(),'position':_0x30d386,'lastMatchId':_0x2ef41f}),_0x446776['update'](_0x457065,{'eloRating':_0x20422c,'lastMatchDate':serverTimestamp(),'position':_0x35923e,'lastMatchId':_0x2ef41f}),await _0x446776['commit'](),console[_0x1079f7(0xf3)](_0x1079f7(0xf6)),await Promise[_0x1079f7(0x102)]([recordEloChangeD3({'playerId':_0x1e63e7,'previousElo':_0x1a8689[_0x1079f7(0xed)]||0x4b0,'newElo':_0x4befce,'opponentId':_0x4a046c,'matchResult':'win','previousPosition':_0x25ed4b,'newPosition':_0x30d386,'isPromotion':_0x30d386<_0x25ed4b,'matchId':_0x2ef41f,'timestamp':serverTimestamp()}),recordEloChangeD3({'playerId':_0x4a046c,'previousElo':_0x28ee71[_0x1079f7(0xed)]||0x4b0,'newElo':_0x20422c,'opponentId':_0x1e63e7,'matchResult':_0x1079f7(0xfa),'previousPosition':_0x3ec2e6,'newPosition':_0x35923e,'isDemotion':_0x35923e>_0x3ec2e6,'matchId':_0x2ef41f,'timestamp':serverTimestamp()})]),!![];}catch(_0x204fb6){console['error']('Error\x20in\x20updateEloRatingsD3:',_0x204fb6);throw _0x204fb6;}}export async function approveReportD3(_0x5d78da,_0x446bec,_0x59e3e8,_0x2f84e9){const _0x2ebb9b=a29_0x5355;try{console[_0x2ebb9b(0xf3)](_0x2ebb9b(0xea),{'reportId':_0x5d78da,'winnerScore':_0x446bec,'winnerSuicides':_0x59e3e8,'winnerComment':_0x2f84e9});const _0x4f1e6d=auth['currentUser'];if(!_0x4f1e6d){console['log']('No\x20user\x20logged\x20in');throw new Error('You\x20must\x20be\x20logged\x20in\x20to\x20approve\x20D3\x20matches');}console[_0x2ebb9b(0xf3)]('Current\x20user:',_0x4f1e6d['email']);const _0x3bb57f=await getDoc(doc(db,'playersD3',_0x4f1e6d[_0x2ebb9b(0xee)])),_0x57ee59=_0x3bb57f['exists']()?_0x3bb57f['data']()['username']:null;console[_0x2ebb9b(0xf3)]('Current\x20username:',_0x57ee59);const _0x375844=doc(db,'pendingMatchesD3',_0x5d78da),_0x4dda56=await getDoc(_0x375844);if(!_0x4dda56['exists']()){console[_0x2ebb9b(0xf3)](_0x2ebb9b(0xef),_0x5d78da);throw new Error('D3\x20match\x20report\x20not\x20found');}const _0xfa9194=_0x4dda56[_0x2ebb9b(0x104)]();console[_0x2ebb9b(0xf3)]('D3\x20Report\x20data:',_0xfa9194);if(_0x57ee59!==_0xfa9194[_0x2ebb9b(0xfc)])throw new Error('Only\x20the\x20winner\x20can\x20approve\x20D3\x20matches');const _0x3d7085={..._0xfa9194,'winnerScore':_0x446bec,'winnerSuicides':_0x59e3e8,'winnerComment':_0x2f84e9,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':_0x57ee59,'createdAt':_0xfa9194['createdAt']||serverTimestamp(),'winnerUsername':_0xfa9194['winnerUsername'],'loserUsername':_0xfa9194['loserUsername']};await setDoc(doc(db,'approvedMatchesD3',_0x5d78da),_0x3d7085),await deleteDoc(_0x375844),console['log']('D3\x20Match\x20moved\x20to\x20approved\x20collection');const [_0x105325,_0x26b1f0]=await Promise['all']([getDocs(query(collection(db,'playersD3'),where('username','==',_0xfa9194['winnerUsername']))),getDocs(query(collection(db,'playersD3'),where(_0x2ebb9b(0xe9),'==',_0xfa9194['loserUsername'])))]);if(_0x105325['empty']||_0x26b1f0[_0x2ebb9b(0xfe)])throw new Error('Could\x20not\x20find\x20D3\x20player\x20documents');const _0x6bf839=_0x105325['docs'][0x0]['id'],_0x3a4806=_0x26b1f0['docs'][0x0]['id'];return await updateEloRatingsD3(_0x6bf839,_0x3a4806,_0x5d78da),console[_0x2ebb9b(0xf3)](_0x2ebb9b(0xec)),!![];}catch(_0x257c1e){console['error']('Error\x20in\x20approveReportD3:',_0x257c1e);throw _0x257c1e;}}
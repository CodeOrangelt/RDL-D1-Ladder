const a10_0x20bb7c=a10_0x1396,a10_0x319e9a=(function(){let _0x55b5d4=!![];return function(_0x167f52,_0x46fc07){const _0x253b31=_0x55b5d4?function(){if(_0x46fc07){const _0x24fa65=_0x46fc07['apply'](_0x167f52,arguments);return _0x46fc07=null,_0x24fa65;}}:function(){};return _0x55b5d4=![],_0x253b31;};}()),a10_0x4f1125=a10_0x319e9a(this,function(){const _0x470b3b=a10_0x1396;let _0x23c551;try{const _0xf6b9b8=Function(_0x470b3b(0x114)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x23c551=_0xf6b9b8();}catch(_0x27c288){_0x23c551=window;}const _0x2d3435=_0x23c551[_0x470b3b(0xfe)]=_0x23c551[_0x470b3b(0xfe)]||{},_0x3ef37f=['log','warn','info','error','exception','table','trace'];for(let _0x215d86=0x0;_0x215d86<_0x3ef37f[_0x470b3b(0x117)];_0x215d86++){const _0x2876a9=a10_0x319e9a['constructor'][_0x470b3b(0x101)]['bind'](a10_0x319e9a),_0x4ed3e6=_0x3ef37f[_0x215d86],_0x2960ec=_0x2d3435[_0x4ed3e6]||_0x2876a9;_0x2876a9['__proto__']=a10_0x319e9a[_0x470b3b(0x103)](a10_0x319e9a),_0x2876a9['toString']=_0x2960ec['toString'][_0x470b3b(0x103)](_0x2960ec),_0x2d3435[_0x4ed3e6]=_0x2876a9;}});a10_0x4f1125();import{getAuth,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{doc,getDoc,collection,query,where,getDocs,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import{isAdmin}from'./admin-check.js';const ADMIN_EMAILS=[a10_0x20bb7c(0xf1),a10_0x20bb7c(0xef)],userCache={'uid':null,'username':null,'isAdmin':![],'hasCheckedCollections':![],'lastChecked':0x0,'role':null},invitationCache={'lastCheck':0x0,'pendingCount':0x0,'checkInterval':0x493e0};function updateInboxNotification(_0x50099c){const _0x206b78=a10_0x20bb7c,_0x1c0177=document['getElementById']('inbox-notification');_0x1c0177&&(_0x50099c>0x0?(_0x1c0177['style'][_0x206b78(0x119)]=_0x206b78(0x10b),_0x1c0177['textContent']=_0x50099c>0x9?'9+':_0x50099c):_0x1c0177['style']['display']='none');}function a10_0x1396(_0x34b2c2,_0x14ca8c){const _0x4f1125=a10_0x1b24();return a10_0x1396=function(_0x319e9a,_0x180c00){_0x319e9a=_0x319e9a-0xec;let _0x1b24e5=_0x4f1125[_0x319e9a];return _0x1b24e5;},a10_0x1396(_0x34b2c2,_0x14ca8c);}async function checkPendingInvitationsForCurrentUser(_0x528cf1){const _0xdc7ac0=a10_0x20bb7c;try{const _0x94699b=Date['now']();if(_0x94699b-invitationCache[_0xdc7ac0(0x109)]<invitationCache['checkInterval'])return updateInboxNotification(invitationCache[_0xdc7ac0(0xf3)]),invitationCache['pendingCount'];invitationCache['lastCheck']=_0x94699b;const _0x175b92=collection(db,'gameInvitations'),_0x22a10a=query(_0x175b92,where('toUserId','==',_0x528cf1),where('status','==','pending'),limit(0x5)),_0x184128=await getDocs(_0x22a10a),_0x5b9bd7=_0x184128[_0xdc7ac0(0x106)];return invitationCache[_0xdc7ac0(0xf3)]=_0x5b9bd7,updateInboxNotification(_0x5b9bd7),_0x5b9bd7;}catch(_0xd071e2){return console[_0xdc7ac0(0xfd)](_0xdc7ac0(0xf7),_0xd071e2),0x0;}}function updateAuthSectionImmediate(_0x3450fc,_0x4057d8=![]){const _0x1097f8=a10_0x20bb7c,_0x4190f5=document['getElementById'](_0x1097f8(0x112));if(!_0x4190f5)return;if(_0x3450fc&&_0x4057d8)document['querySelectorAll']('.admin-only')[_0x1097f8(0xed)](_0x2d1423=>{const _0x1a609f=_0x1097f8;_0x2d1423['style'][_0x1a609f(0x119)]=_0x1a609f(0xf4);});else!_0x3450fc&&document['querySelectorAll']('.admin-only')['forEach'](_0x1cbc46=>{const _0x27be1b=_0x1097f8;_0x1cbc46[_0x27be1b(0xf8)][_0x27be1b(0x119)]=_0x27be1b(0x10f);});if(_0x3450fc){const _0x219bf3=userCache['username']||(_0x3450fc[_0x1097f8(0x10e)]?_0x3450fc['email']['split']('@')[0x0]:'User'),_0x33ba3d=userCache[_0x1097f8(0x10c)]?'\x20('+userCache['role']+')':_0x4057d8?'\x20(Admin)':'';_0x4190f5['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20class=\x22nav-username\x22>'+_0x219bf3+_0x33ba3d+_0x1097f8(0xfa)+encodeURIComponent(_0x219bf3)+'\x22>Profile</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./inbox.html\x22\x20class=\x22nav-notification\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Inbox\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22inbox-notification\x22\x20class=\x22notification-dot\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22members.html\x22>Members</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./redeem.html\x22><i\x20class=\x22fas\x20fa-gift\x22></i>Store</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20id=\x22logout-link\x22>Sign\x20Out</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';const _0x28d0c6=document[_0x1097f8(0xff)]('logout-link');_0x28d0c6&&_0x28d0c6['addEventListener']('click',_0x3b7980=>{_0x3b7980['preventDefault']();const _0x563ff9=getAuth();updateAuthSectionImmediate(null),_0x563ff9['signOut']()['catch'](_0x19f2cf=>{console['error']('Error\x20signing\x20out:',_0x19f2cf);});}),_0x3450fc['uid']&&setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0x3450fc['uid']);},0x3e8);}else _0x4190f5[_0x1097f8(0x102)]='<a\x20href=\x22login.html\x22\x20class=\x22login-link\x22>Login</a>';}function a10_0x1b24(){const _0x1bffa7=['filter','forEach','Found\x20admin\x20role:\x20','Brian2af@outlook.com','playersD2','admin@ladder.com','empty','pendingCount','block','\x20in\x20','error','Could\x20not\x20check\x20pending\x20invitations\x20for\x20current\x20user:','style','roleName','</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username=','data','addEventListener','warn','console','getElementById','all','prototype','innerHTML','bind','toUpperCase','userProfiles','size','username','lastChecked','lastCheck','admin','inline-block','role','log','email','none','uid','map','auth-section','split','return\x20(function()\x20','exists','\x20by\x20UID:','length','hasCheckedCollections','display'];a10_0x1b24=function(){return _0x1bffa7;};return a10_0x1b24();}async function checkAdminRoles(_0x25e3a6){const _0x24e5ef=a10_0x20bb7c;if(!_0x25e3a6||!_0x25e3a6['email'])return{'isAdmin':![],'role':null};try{console['log']('Checking\x20roles\x20for\x20user:\x20'+_0x25e3a6['email']);const _0x2f13ce=['players','playersD2','playersD3','nonParticipants',_0x24e5ef(0x105)],_0x543671=['council','creative\x20lead','owner',_0x24e5ef(0x10a)];for(const _0xb2eb0a of _0x2f13ce){try{const _0x2ceb33=doc(db,_0xb2eb0a,_0x25e3a6['uid']),_0x58d6bd=await getDoc(_0x2ceb33);if(_0x58d6bd[_0x24e5ef(0x115)]()){const _0x17f9a4=_0x58d6bd[_0x24e5ef(0xfb)]();console[_0x24e5ef(0x10d)]('Found\x20user\x20in\x20'+_0xb2eb0a+'\x20by\x20UID:',_0x17f9a4);let _0x44a287=(_0x17f9a4[_0x24e5ef(0xf9)]||_0x17f9a4['role']||'')['toLowerCase'](),_0x44d759=_0x17f9a4['roleName']||_0x17f9a4['role']||'';if(_0x44a287&&_0x543671['includes'](_0x44a287)){console['log'](_0x24e5ef(0xee)+_0x44a287+_0x24e5ef(0xf5)+_0xb2eb0a);const _0x4cab83=_0x44d759[_0x24e5ef(0x113)]('\x20')['map'](_0x466d9e=>_0x466d9e['charAt'](0x0)['toUpperCase']()+_0x466d9e['slice'](0x1)['toLowerCase']())['join']('\x20');return{'isAdmin':!![],'role':_0x4cab83};}}}catch(_0x53d293){console[_0x24e5ef(0xf6)]('Error\x20checking\x20'+_0xb2eb0a+_0x24e5ef(0x116),_0x53d293);}}for(const _0x4507dd of _0x2f13ce){try{const _0x1b638e=collection(db,_0x4507dd);let _0x103718=query(_0x1b638e,where('email','==',_0x25e3a6['email'])),_0x5db655=await getDocs(_0x103718);_0x5db655[_0x24e5ef(0xf2)]&&(_0x103718=query(_0x1b638e,where('email','==',_0x25e3a6['email']['toLowerCase']())),_0x5db655=await getDocs(_0x103718));if(!_0x5db655['empty']){const _0x1d785d=_0x5db655['docs'][0x0][_0x24e5ef(0xfb)]();console['log']('Found\x20user\x20in\x20'+_0x4507dd+'\x20by\x20email:',_0x1d785d);let _0x37f395=(_0x1d785d['roleName']||_0x1d785d[_0x24e5ef(0x10c)]||'')['toLowerCase'](),_0x3b07e0=_0x1d785d[_0x24e5ef(0xf9)]||_0x1d785d['role']||'';if(_0x37f395&&_0x543671['includes'](_0x37f395)){console['log']('Found\x20admin\x20role:\x20'+_0x37f395+'\x20in\x20'+_0x4507dd);const _0x2f9fab=_0x3b07e0['split']('\x20')['map'](_0x2d0d6d=>_0x2d0d6d['charAt'](0x0)[_0x24e5ef(0x104)]()+_0x2d0d6d['slice'](0x1)['toLowerCase']())['join']('\x20');return{'isAdmin':!![],'role':_0x2f9fab};}}}catch(_0x20091e){console['error']('Error\x20checking\x20'+_0x4507dd+'\x20by\x20email:',_0x20091e);}}return console['log']('No\x20admin\x20roles\x20found\x20for\x20user'),{'isAdmin':![],'role':null};}catch(_0x1e3c7d){return console[_0x24e5ef(0xf6)]('Error\x20in\x20checkAdminRoles:',_0x1e3c7d),{'isAdmin':![],'role':null};}}async function updateAuthSection(_0x4772cf){const _0x28c99e=a10_0x20bb7c,_0x2b9e47=_0x4772cf&&isAdmin(_0x4772cf[_0x28c99e(0x10e)]);updateAuthSectionImmediate(_0x4772cf,_0x2b9e47);if(!_0x4772cf){userCache['uid']=null,userCache['username']=null,userCache['isAdmin']=![],userCache[_0x28c99e(0x118)]=![],userCache[_0x28c99e(0x10c)]=null;return;}const _0x3cadb7=Date['now']();if(_0x4772cf['uid']===userCache['uid']&&userCache['hasCheckedCollections']&&_0x3cadb7-userCache[_0x28c99e(0x108)]<0x493e0)return;try{userCache['uid']=_0x4772cf['uid'],userCache['lastChecked']=_0x3cadb7;const _0x129c2c=isAdmin(_0x4772cf['email']);userCache['isAdmin']=_0x129c2c;if(!_0x129c2c){const {isAdmin:_0x4db66e,role:_0x17cfc9}=await checkAdminRoles(_0x4772cf);userCache['isAdmin']=_0x4db66e,userCache[_0x28c99e(0x10c)]=_0x17cfc9,_0x4db66e&&(document['querySelectorAll']('.admin-only')['forEach'](_0xafbb4b=>{const _0x99878f=_0x28c99e;_0xafbb4b['style']['display']=_0x99878f(0xf4);}),updateAuthSectionImmediate(_0x4772cf,!![]));}const _0x344377=['players',_0x28c99e(0xf0),'playersD3','playersDuos','playersCTF','nonParticipants','userProfiles'],_0x43c385=_0x344377[_0x28c99e(0x111)](_0x1b69e5=>getDoc(doc(db,_0x1b69e5,_0x4772cf[_0x28c99e(0x110)]))['then'](_0x536528=>_0x536528[_0x28c99e(0x115)]()?{'collection':_0x1b69e5,'data':_0x536528['data']()}:null)['catch'](()=>null)),_0x3f9c22=await Promise[_0x28c99e(0x100)](_0x43c385),_0x8ea65a=_0x3f9c22[_0x28c99e(0xec)](_0x550d17=>_0x550d17!==null);let _0xe7792=null;for(const _0xf3a1e7 of _0x8ea65a){if(_0xf3a1e7['data']['username']){_0xe7792=_0xf3a1e7['data']['username'];break;}}userCache[_0x28c99e(0x107)]=_0xe7792||(_0x4772cf['email']?_0x4772cf['email']['split']('@')[0x0]:'User'),userCache['hasCheckedCollections']=!![],updateAuthSectionImmediate(_0x4772cf,userCache['isAdmin']),setTimeout(()=>{const _0x3f31cd=_0x28c99e;checkPendingInvitationsForCurrentUser(_0x4772cf[_0x3f31cd(0x110)]);},0x1f4);}catch(_0x48c70d){console['error']('Error\x20in\x20full\x20auth\x20update:',_0x48c70d);}}document[a10_0x20bb7c(0xfc)]('DOMContentLoaded',()=>{const _0x575da8=getAuth();onAuthStateChanged(_0x575da8,async _0x12c957=>{await updateAuthSection(_0x12c957),_0x12c957&&checkPendingInvitationsForCurrentUser(_0x12c957['uid']);}),document['addEventListener']('visibilitychange',()=>{!document['hidden']&&_0x575da8['currentUser']&&checkPendingInvitationsForCurrentUser(_0x575da8['currentUser']['uid']);}),document['addEventListener']('click',_0x51c8df=>{const _0x5033f6=a10_0x1396;_0x51c8df['target']['closest']('a[href]')&&_0x575da8['currentUser']&&checkPendingInvitationsForCurrentUser(_0x575da8['currentUser'][_0x5033f6(0x110)]);});});export{updateAuthSection};
const a56_0x5dd870=(function(){let _0x266c09=!![];return function(_0x32870f,_0x5f37cf){const _0x1a3171=_0x266c09?function(){if(_0x5f37cf){const _0x957797=_0x5f37cf['apply'](_0x32870f,arguments);return _0x5f37cf=null,_0x957797;}}:function(){};return _0x266c09=![],_0x1a3171;};}()),a56_0x28c48c=a56_0x5dd870(this,function(){const _0x272b68=a56_0x16a0,_0x3a5cd5=function(){const _0x2151e4=a56_0x16a0;let _0x2299d0;try{_0x2299d0=Function(_0x2151e4(0xfd)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0xce128){_0x2299d0=window;}return _0x2299d0;},_0x90aa6a=_0x3a5cd5(),_0x589eaf=_0x90aa6a['console']=_0x90aa6a['console']||{},_0x3ea1cb=[_0x272b68(0x103),'warn','info','error',_0x272b68(0x108),_0x272b68(0x10e),'trace'];for(let _0x2a7cdb=0x0;_0x2a7cdb<_0x3ea1cb['length'];_0x2a7cdb++){const _0x5af174=a56_0x5dd870['constructor']['prototype']['bind'](a56_0x5dd870),_0x3be6ec=_0x3ea1cb[_0x2a7cdb],_0x401cfc=_0x589eaf[_0x3be6ec]||_0x5af174;_0x5af174[_0x272b68(0x100)]=a56_0x5dd870['bind'](a56_0x5dd870),_0x5af174[_0x272b68(0xff)]=_0x401cfc['toString'][_0x272b68(0x10c)](_0x401cfc),_0x589eaf[_0x3be6ec]=_0x5af174;}});a56_0x28c48c();import{db}from'../firebase-config.js';import{collection,doc,getDoc,getDocs,query,limit,startAfter,where,onSnapshot}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const cache={'userProfiles':new Map(),'ladderPlayers':new Map(),'matchResults':new Map(),'eloHistory':new Map()},CACHE_EXPIRY={'userProfiles':0x5*0x3c*0x3e8,'ladderPlayers':0x2*0x3c*0x3e8,'matchResults':0x1*0x3c*0x3e8,'eloHistory':0x3*0x3c*0x3e8};export const userProfilesRef=collection(db,'userProfiles');export async function fetchPaginatedData(_0x37b6e9,_0x16827b=0xa,_0x566c09=null){const _0x11d7b7=a56_0x16a0;let _0x1203fc=query(_0x37b6e9,limit(_0x16827b));_0x566c09&&(_0x1203fc=query(_0x1203fc,startAfter(_0x566c09)));const _0x12243d=await getDocs(_0x1203fc),_0x291800=_0x12243d['docs'][_0x12243d[_0x11d7b7(0x110)]['length']-0x1];return{'data':_0x12243d['docs']['map'](_0x280c8e=>({'id':_0x280c8e['id'],..._0x280c8e['data']()})),'lastVisible':_0x291800,'hasMore':_0x12243d[_0x11d7b7(0x110)][_0x11d7b7(0xfe)]===_0x16827b};}function a56_0x3b81(){const _0x366e95=['return\x20(function()\x20','length','toString','__proto__','userProfiles','eloHistory','log','username','get','players','forEach','exception','set','ladderPlayers','doc','bind','data','table','now','docs','timestamp'];a56_0x3b81=function(){return _0x366e95;};return a56_0x3b81();}export async function getUserProfile(_0x58c005){const _0x25eecc=a56_0x16a0,_0x183dd1=cache['userProfiles']['get'](_0x58c005);if(_0x183dd1&&Date['now']()-_0x183dd1[_0x25eecc(0x111)]<CACHE_EXPIRY[_0x25eecc(0x101)])return _0x183dd1['data'];const _0x565427=await getDoc(doc(userProfilesRef,_0x58c005));if(_0x565427['exists']()){const _0x5f12eb=_0x565427['data']();return cache['userProfiles']['set'](_0x58c005,{'data':_0x5f12eb,'timestamp':Date['now']()}),_0x5f12eb;}return null;}export async function getLadderData(_0x533b4e=0x1){const _0x5a37c5=a56_0x16a0,_0x279e50='division_'+_0x533b4e,_0x5187e6=cache['ladderPlayers'][_0x5a37c5(0x105)](_0x279e50);if(_0x5187e6&&Date['now']()-_0x5187e6['timestamp']<CACHE_EXPIRY[_0x5a37c5(0x10a)])return _0x5187e6[_0x5a37c5(0x10d)];const _0x1486d1=_0x533b4e===0x1?_0x5a37c5(0x106):'playersD'+_0x533b4e,_0x23f60f=collection(db,_0x1486d1),_0x36648c=await getDocs(query(_0x23f60f,limit(0x64))),_0x3ed0dc=_0x36648c[_0x5a37c5(0x110)]['map'](_0x38feee=>({'id':_0x38feee['id'],..._0x38feee['data']()}));return cache['ladderPlayers']['set'](_0x279e50,{'data':_0x3ed0dc,'timestamp':Date['now']()}),_0x3ed0dc;}export async function getEloHistoryBatch(_0x13adcd,_0x493e16=0x1){const _0x3e5d1e=a56_0x16a0,_0x110ab3=_0x493e16===0x1?_0x3e5d1e(0x102):'eloHistoryD'+_0x493e16,_0x1a8214=collection(db,_0x110ab3),_0x5e1be7={},_0x2739a8=[];_0x13adcd['forEach'](_0x1a4838=>{const _0x39ba9f=_0x3e5d1e,_0x1c56a1=_0x1a4838+'_'+_0x493e16,_0x35afa3=cache['eloHistory'][_0x39ba9f(0x105)](_0x1c56a1);_0x35afa3&&Date[_0x39ba9f(0x10f)]()-_0x35afa3['timestamp']<CACHE_EXPIRY['eloHistory']?_0x5e1be7[_0x1a4838]=_0x35afa3['data']:_0x2739a8['push'](_0x1a4838);});const _0x466534=0xa;for(let _0xfa8c1=0x0;_0xfa8c1<_0x2739a8['length'];_0xfa8c1+=_0x466534){const _0x41c457=_0x2739a8['slice'](_0xfa8c1,_0xfa8c1+_0x466534);if(_0x41c457[_0x3e5d1e(0xfe)]>0x0)try{const _0x560796=query(_0x1a8214,where('playerId','in',_0x41c457),limit(0x64)),_0x3209ec=await getDocs(_0x560796);_0x3209ec[_0x3e5d1e(0x110)][_0x3e5d1e(0x107)](_0x1375b2=>{const _0x46e9f2=_0x3e5d1e,_0x2d0ad8=_0x1375b2[_0x46e9f2(0x10d)](),_0x616ed7=_0x2d0ad8['playerId'];if(!_0x5e1be7[_0x616ed7])_0x5e1be7[_0x616ed7]=[];_0x5e1be7[_0x616ed7]['push'](_0x2d0ad8);const _0x65f4a0=_0x616ed7+'_'+_0x493e16;cache[_0x46e9f2(0x102)][_0x46e9f2(0x109)](_0x65f4a0,{'data':_0x5e1be7[_0x616ed7],'timestamp':Date['now']()});});}catch(_0x69862a){console['error']('Error\x20fetching\x20batch\x20ELO\x20history:',_0x69862a);}}return _0x5e1be7;}function a56_0x16a0(_0x2b241e,_0x593098){const _0x28c48c=a56_0x3b81();return a56_0x16a0=function(_0x5dd870,_0x5eb3d5){_0x5dd870=_0x5dd870-0xfd;let _0x3b8128=_0x28c48c[_0x5dd870];return _0x3b8128;},a56_0x16a0(_0x2b241e,_0x593098);}let usernameCache=new Map(),usernameCacheTimestamp=Date['now']();export function setupEfficientListener(_0x1294ae,_0x4f536a=[],_0xfae4ad){const _0x429ce8=collection(db,_0x1294ae),_0x45d697=query(_0x429ce8,..._0x4f536a),_0x414014=onSnapshot(_0x45d697,_0xfcdcc9=>{const _0xfe040b=a56_0x16a0,_0x5003f3=_0xfcdcc9['docChanges']()['map'](_0x4dcca6=>({'type':_0x4dcca6['type'],'id':_0x4dcca6[_0xfe040b(0x10b)]['id'],'data':_0x4dcca6['doc']['data']()}));_0x5003f3[_0xfe040b(0xfe)]>0x0&&_0xfae4ad(_0x5003f3,_0xfcdcc9['docs']);});return _0x414014;}export async function bulkResolveUsernames(_0x3ec809){const _0x201d45=a56_0x16a0,_0x4e375c=new Map();if(!_0x3ec809||_0x3ec809['length']===0x0)return _0x4e375c;const _0x5aa477=[_0x201d45(0x106),'playersD2','playersD3','nonParticipants'];for(const _0x10117e of _0x5aa477){const _0x10db4d=collection(db,_0x10117e),_0x5d85b1=await getDocs(_0x10db4d);_0x5d85b1[_0x201d45(0x107)](_0x3f809e=>{const _0x7c3047=_0x201d45,_0x4f2366=_0x3f809e['data']();_0x4f2366['username']&&_0x3ec809['includes'](_0x3f809e['id'])&&_0x4e375c[_0x7c3047(0x109)](_0x3f809e['id'],_0x4f2366[_0x7c3047(0x104)]);});}return _0x4e375c;}
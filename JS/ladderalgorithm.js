(function(_0x2be248,_0x694338){const _0x184add=a30_0xe9cd,_0x22403c=_0x2be248();while(!![]){try{const _0x5942d=-parseInt(_0x184add(0x1a5))/0x1*(-parseInt(_0x184add(0x1ac))/0x2)+-parseInt(_0x184add(0x192))/0x3+parseInt(_0x184add(0x1a7))/0x4+-parseInt(_0x184add(0x1b3))/0x5+-parseInt(_0x184add(0x1bb))/0x6+-parseInt(_0x184add(0x1a6))/0x7*(-parseInt(_0x184add(0x1ba))/0x8)+parseInt(_0x184add(0x18d))/0x9*(parseInt(_0x184add(0x19f))/0xa);if(_0x5942d===_0x694338)break;else _0x22403c['push'](_0x22403c['shift']());}catch(_0x5f37e){_0x22403c['push'](_0x22403c['shift']());}}}(a30_0x52d7,0x99fc9));const a30_0x26c231=(function(){let _0x516213=!![];return function(_0x4fcab2,_0x534be5){const _0x24fb97=_0x516213?function(){if(_0x534be5){const _0x58a3f0=_0x534be5['apply'](_0x4fcab2,arguments);return _0x534be5=null,_0x58a3f0;}}:function(){};return _0x516213=![],_0x24fb97;};}()),a30_0x1ac4e9=a30_0x26c231(this,function(){const _0x1bf8ad=a30_0xe9cd;return a30_0x1ac4e9['toString']()[_0x1bf8ad(0x198)](_0x1bf8ad(0x194))[_0x1bf8ad(0x1be)]()[_0x1bf8ad(0x1c6)](a30_0x1ac4e9)[_0x1bf8ad(0x198)](_0x1bf8ad(0x194));});a30_0x1ac4e9();const a30_0x4fa9ab=(function(){let _0x5759b8=!![];return function(_0x521416,_0x3d6908){const _0x152b96=_0x5759b8?function(){if(_0x3d6908){const _0x53dd57=_0x3d6908['apply'](_0x521416,arguments);return _0x3d6908=null,_0x53dd57;}}:function(){};return _0x5759b8=![],_0x152b96;};}()),a30_0x371d3c=a30_0x4fa9ab(this,function(){const _0x15eedb=a30_0xe9cd;let _0x5d20a7;try{const _0x33bc8d=Function(_0x15eedb(0x1a3)+_0x15eedb(0x1a8)+');');_0x5d20a7=_0x33bc8d();}catch(_0x257c0e){_0x5d20a7=window;}const _0x96288f=_0x5d20a7[_0x15eedb(0x19e)]=_0x5d20a7[_0x15eedb(0x19e)]||{},_0x235c1f=[_0x15eedb(0x18c),_0x15eedb(0x193),_0x15eedb(0x1c7),_0x15eedb(0x1b7),'exception','table','trace'];for(let _0x13aa85=0x0;_0x13aa85<_0x235c1f[_0x15eedb(0x18b)];_0x13aa85++){const _0x2d47ab=a30_0x4fa9ab[_0x15eedb(0x1c6)]['prototype'][_0x15eedb(0x197)](a30_0x4fa9ab),_0x374135=_0x235c1f[_0x13aa85],_0x5e9a11=_0x96288f[_0x374135]||_0x2d47ab;_0x2d47ab['__proto__']=a30_0x4fa9ab[_0x15eedb(0x197)](a30_0x4fa9ab),_0x2d47ab[_0x15eedb(0x1be)]=_0x5e9a11[_0x15eedb(0x1be)][_0x15eedb(0x197)](_0x5e9a11),_0x96288f[_0x374135]=_0x2d47ab;}});function a30_0x52d7(){const _0x483f5b=['round','error','data','match','4524976GOHAyy','5851146BIWzVj','then','ELO\x20ratings\x20and\x20positions\x20updated\x20successfully','toString','update','username','totalDeaths','eloRating','commit','collection','uid','constructor','info','MAX_SAFE_INTEGER','currentUser','length','log','118926iDMrsg','catch','loserScore','losses','winnerUsername','85974hnmnmy','warn','(((.+)+)+)+$','pow','loss','bind','search','Match\x20successfully\x20approved\x20and\x20ELO\x20updated','Report\x20not\x20found','Error\x20assigning\x20default\x20ELO\x20rating:','all','position','console','170SnRATx','loserUsername','exists','doc','return\x20(function()\x20','winnerScore','440071MKkhYz','14SQhQOX','3058752uMghOk','{}.constructor(\x22return\x20this\x22)(\x20)','checkAndRecordPromotion','empty','winRate','2mAQwyW','Assigned\x20default\x20ELO\x20rating\x20to\x20player\x20','wins','totalKills','One\x20or\x20both\x20players\x20not\x20found','approvedMatches','playerStats','4630315acyvDK','Error\x20approving\x20report:','players'];a30_0x52d7=function(){return _0x483f5b;};return a30_0x52d7();}a30_0x371d3c();import{collection,doc,getDoc,getDocs,updateDoc,setDoc,deleteDoc,writeBatch,query,where,serverTimestamp,addDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';import{recordEloChange}from'./elo-history.js';import{promotionManager,checkAndRecordPromotion}from'./promotions.js';function a30_0xe9cd(_0xb64c66,_0x2dc19f){const _0x13f6c8=a30_0x52d7();return a30_0xe9cd=function(_0x371d3c,_0x4fa9ab){_0x371d3c=_0x371d3c-0x18a;let _0x1990f7=_0x13f6c8[_0x371d3c];return _0x1990f7;},a30_0xe9cd(_0xb64c66,_0x2dc19f);}import{isAdmin}from'./admin-check.js';export function calculateElo(_0x47649f,_0x44042f,_0x15661d=0x20){const _0x5fa729=a30_0xe9cd,_0xc1d991=0x1/(0x1+Math['pow'](0xa,(_0x44042f-_0x47649f)/0x190)),_0x8239d7=0x1/(0x1+Math[_0x5fa729(0x195)](0xa,(_0x47649f-_0x44042f)/0x190)),_0x1a0955=_0x47649f+_0x15661d*(0x1-_0xc1d991),_0x48f66e=_0x44042f+_0x15661d*(0x0-_0x8239d7);return{'newWinnerRating':Math[_0x5fa729(0x1b6)](_0x1a0955),'newLoserRating':Math['round'](_0x48f66e)};}export function assignDefaultEloRating(_0x223eaf,_0x46fcad){const _0x4f20e4=a30_0xe9cd,_0x3e08c5=0x4b0;!_0x46fcad['eloRating']&&db[_0x4f20e4(0x1c4)]('players')[_0x4f20e4(0x1a2)](_0x223eaf)[_0x4f20e4(0x1bf)]({'eloRating':_0x3e08c5})[_0x4f20e4(0x1bc)](()=>{const _0x5cdd9a=_0x4f20e4;console['log'](_0x5cdd9a(0x1ad)+_0x46fcad[_0x5cdd9a(0x1c0)]);})[_0x4f20e4(0x18e)](_0x19fce5=>{const _0x366573=_0x4f20e4;console[_0x366573(0x1b7)](_0x366573(0x19b),_0x19fce5);});}export async function updateEloRatings(_0x502919,_0xb8e521,_0x473580){const _0x5f484d=a30_0xe9cd;try{const _0x494064=writeBatch(db),_0x2217c3=doc(db,'players',_0x502919),_0x54d499=doc(db,_0x5f484d(0x1b5),_0xb8e521),[_0x4bd456,_0x374d5c]=await Promise[_0x5f484d(0x19c)]([getDoc(_0x2217c3),getDoc(_0x54d499)]);if(!_0x4bd456['exists']()||!_0x374d5c[_0x5f484d(0x1a1)]())throw new Error(_0x5f484d(0x1b0));const _0xaf9ea0=_0x4bd456[_0x5f484d(0x1b8)](),_0x4bf8cf=_0x374d5c[_0x5f484d(0x1b8)](),_0x297150=_0xaf9ea0['position']||Number[_0x5f484d(0x1c8)],_0x4271ca=_0x4bf8cf[_0x5f484d(0x19d)]||Number[_0x5f484d(0x1c8)],{newWinnerRating:_0xf953e,newLoserRating:_0x13589e}=calculateElo(_0xaf9ea0[_0x5f484d(0x1c2)]||0x4b0,_0x4bf8cf[_0x5f484d(0x1c2)]||0x4b0);let _0x2c3e87=_0x297150,_0x1181bd=_0x4271ca;if(_0x297150>_0x4271ca){console[_0x5f484d(0x18c)]('Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked'),_0x2c3e87=_0x4271ca,_0x1181bd=_0x4271ca+0x1;const _0x47de86=query(collection(db,_0x5f484d(0x1b5)),where(_0x5f484d(0x19d),'>',_0x4271ca),where('position','<',_0x297150)),_0x38d0b4=await getDocs(_0x47de86);for(const _0x356b8b of _0x38d0b4['docs']){_0x356b8b['id']!==_0x502919&&_0x356b8b['id']!==_0xb8e521&&_0x494064[_0x5f484d(0x1bf)](doc(db,_0x5f484d(0x1b5),_0x356b8b['id']),{'position':_0x356b8b[_0x5f484d(0x1b8)]()['position']+0x1});}}else console[_0x5f484d(0x18c)]('Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions');const _0x2c0622={'eloRating':_0xf953e,'lastMatchDate':serverTimestamp(),'position':_0x2c3e87,'lastMatchId':_0x473580},_0x1febc0={'eloRating':_0x13589e,'lastMatchDate':serverTimestamp(),'position':_0x1181bd,'lastMatchId':_0x473580};return _0x494064['update'](_0x2217c3,_0x2c0622),_0x494064[_0x5f484d(0x1bf)](_0x54d499,_0x1febc0),await _0x494064[_0x5f484d(0x1c3)](),console[_0x5f484d(0x18c)]('ELO\x20ratings\x20updated\x20successfully'),await Promise[_0x5f484d(0x19c)]([recordEloChange({'playerId':_0x502919,'previousElo':_0xaf9ea0['eloRating']||0x4b0,'newElo':_0xf953e,'opponentId':_0xb8e521,'matchResult':'win','previousPosition':_0x297150,'newPosition':_0x2c3e87,'isPromotion':_0x2c3e87<_0x297150,'matchId':_0x473580,'timestamp':serverTimestamp()}),recordEloChange({'playerId':_0xb8e521,'previousElo':_0x4bf8cf[_0x5f484d(0x1c2)]||0x4b0,'newElo':_0x13589e,'opponentId':_0x502919,'matchResult':_0x5f484d(0x196),'previousPosition':_0x4271ca,'newPosition':_0x1181bd,'isDemotion':_0x1181bd>_0x4271ca,'matchId':_0x473580,'timestamp':serverTimestamp()})]),await promotionManager['checkAndRecordPromotion'](_0x502919,_0xf953e,_0xaf9ea0['eloRating'],{'source':_0x5f484d(0x1b9),'matchId':_0x473580}),await promotionManager[_0x5f484d(0x1a9)](_0xb8e521,_0x13589e,_0x4bf8cf[_0x5f484d(0x1c2)],{'source':'match','matchId':_0x473580}),console[_0x5f484d(0x18c)](_0x5f484d(0x1bd)),!![];}catch(_0x444491){console[_0x5f484d(0x1b7)]('Error\x20in\x20updateEloRatings:',_0x444491);throw _0x444491;}}export async function approveReport(_0x59fa42,_0x407eaf,_0x4ebc7b,_0xbb00d7,_0x5675e5){const _0xce9357=a30_0xe9cd;try{const _0x50fa01=doc(db,'pendingMatches',_0x59fa42),_0x329d07=await getDoc(_0x50fa01);if(!_0x329d07[_0xce9357(0x1a1)]())throw new Error(_0xce9357(0x19a));const _0x3a4aa7=_0x329d07[_0xce9357(0x1b8)](),_0x2bad51={..._0x3a4aa7,'winnerScore':_0x407eaf,'winnerSuicides':_0x4ebc7b,'winnerComment':_0xbb00d7,'winnerDemoLink':_0x5675e5,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':auth[_0xce9357(0x18a)][_0xce9357(0x1c5)]};await setDoc(doc(db,_0xce9357(0x1b1),_0x59fa42),_0x2bad51),await deleteDoc(_0x50fa01),console['log']('Match\x20moved\x20to\x20approved\x20collection');const [_0x482b46,_0x47fef5]=await Promise[_0xce9357(0x19c)]([getDocs(query(collection(db,_0xce9357(0x1b5)),where(_0xce9357(0x1c0),'==',_0x3a4aa7[_0xce9357(0x191)]))),getDocs(query(collection(db,'players'),where(_0xce9357(0x1c0),'==',_0x3a4aa7[_0xce9357(0x1a0)])))]);if(_0x482b46[_0xce9357(0x1aa)]||_0x47fef5[_0xce9357(0x1aa)])throw new Error('Could\x20not\x20find\x20player\x20documents');const _0x2c6b18=_0x482b46['docs'][0x0]['id'],_0x520473=_0x47fef5['docs'][0x0]['id'];return await updateEloRatings(_0x2c6b18,_0x520473,_0x59fa42),console[_0xce9357(0x18c)](_0xce9357(0x199)),!![];}catch(_0x3f525e){console[_0xce9357(0x1b7)](_0xce9357(0x1b4),_0x3f525e);throw _0x3f525e;}}async function updatePlayerElo(_0x3bcca4,_0x537be2,_0x16b79a){const _0x236d3c=a30_0xe9cd;await setDoc(doc(db,_0x236d3c(0x1b5),_0x3bcca4),{...playerData,'eloRating':_0x16b79a}),await checkAndRecordPromotion(_0x3bcca4,_0x16b79a,_0x537be2);}async function updatePlayerStats(_0x4110f9,_0x14c3b7,_0x522b8b){const _0x4675d0=a30_0xe9cd,_0x17bc6c=doc(db,_0x4675d0(0x1b2),_0x4110f9),_0x15e7cc=await getDoc(_0x17bc6c);let _0x36fe9f=_0x15e7cc['exists']()?_0x15e7cc['data']():{'wins':0x0,'losses':0x0,'totalKills':0x0,'totalDeaths':0x0,'winRate':0x0};_0x522b8b?(_0x36fe9f[_0x4675d0(0x1ae)]++,_0x36fe9f[_0x4675d0(0x1af)]+=parseInt(_0x14c3b7[_0x4675d0(0x1a4)]||0x0),_0x36fe9f[_0x4675d0(0x1c1)]+=parseInt(_0x14c3b7[_0x4675d0(0x18f)]||0x0)):(_0x36fe9f[_0x4675d0(0x190)]++,_0x36fe9f[_0x4675d0(0x1af)]+=parseInt(_0x14c3b7[_0x4675d0(0x18f)]||0x0),_0x36fe9f['totalDeaths']+=parseInt(_0x14c3b7[_0x4675d0(0x1a4)]||0x0));const _0x37894f=_0x36fe9f['wins']+_0x36fe9f[_0x4675d0(0x190)];_0x36fe9f[_0x4675d0(0x1ab)]=_0x37894f>0x0?(_0x36fe9f[_0x4675d0(0x1ae)]/_0x37894f*0x64)['toFixed'](0x1):0x0,_0x36fe9f['lastUpdated']=new Date()['toISOString'](),await setDoc(_0x17bc6c,_0x36fe9f,{'merge':!![]});}
function a0_0x482b(){const _0x60809c=['6956614thMicG','children','rankChangeModal','initialize','\x20for\x20','A\x20player','display','ID:','timestamp','getItem','157540CewaHq','Rank\x20Update','parentNode','getElementById','adminUser','\x20was\x20demoted\x20to','Discord\x20notification\x20sent\x20successfully\x20with\x20ID:\x20','Error\x20resolving\x20username:','log','slice','appendChild','exists','Error\x20fetching\x20promotions:','fetchInterval','warn','player','eloHistory','Error\x20processing\x20rank\x20change:','players','4KflWWb','Error\x20saving\x20promotion\x20preference:','checkAndRecordPromotion','data-id','className','prototype','beforeunload','27NmjUCy','loserUsername','classList','setAttribute','promotion','error','Error\x20in\x20promotion/demotion\x20recording:','3181976rZupZt','toMillis','getRankName','Gold','createElement','includes','source','stringify','flex','dismissing','modifiedBy','target','\x20hours','click','bind','displayName','username','empty','202234ReEVXs','1113929oqKWPa','resolvedName','bannerContainer','\x20to\x20','DISPLAY_HOURS','date','21hzEdDk','217040PLPctM','STARTING\x20notification\x20for\x20','winnerUsername','innerHTML','table','ignorePromotion','setItem','docs','button','remove','4364928aWLbjG','promotion_','\x20(loser)','addEventListener','matchId','loserId','demotion','</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>','currentUser','style','lastFetchTime','Emerald','userDismissed','type','length','trace','promotion-banner-container','rank-change-modal\x20','Error\x20writing\x20promotion\x20records:','Unknown\x20Player','You\x27ve\x20been\x20promoted\x20to','parse','approvedMatches','now','console','div','data','RANKS','userId','rankAchieved','</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22rank-change-button\x22\x20id=\x22rank-change-ok-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Got\x20it!\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','threshold','newRank','desc','usernameCache','pollingInterval',',\x20treating\x20as\x20new'];a0_0x482b=function(){return _0x60809c;};return a0_0x482b();}const a0_0x418b8f=a0_0x2df6;(function(_0x4a7583,_0x1c0991){const _0x35a884=a0_0x2df6,_0x1ca028=_0x4a7583();while(!![]){try{const _0x559efe=parseInt(_0x35a884(0x167))/0x1+parseInt(_0x35a884(0x166))/0x2*(parseInt(_0x35a884(0x16d))/0x3)+parseInt(_0x35a884(0x146))/0x4*(parseInt(_0x35a884(0x1a7))/0x5)+-parseInt(_0x35a884(0x178))/0x6+-parseInt(_0x35a884(0x19d))/0x7+parseInt(_0x35a884(0x154))/0x8+parseInt(_0x35a884(0x14d))/0x9*(parseInt(_0x35a884(0x16e))/0xa);if(_0x559efe===_0x1c0991)break;else _0x1ca028['push'](_0x1ca028['shift']());}catch(_0x2f20df){_0x1ca028['push'](_0x1ca028['shift']());}}}(a0_0x482b,0x91389));const a0_0x51dba1=(function(){let _0x65beb1=!![];return function(_0x3e70bb,_0x39a0d8){const _0x133e8f=_0x65beb1?function(){if(_0x39a0d8){const _0x37ec97=_0x39a0d8['apply'](_0x3e70bb,arguments);return _0x39a0d8=null,_0x37ec97;}}:function(){};return _0x65beb1=![],_0x133e8f;};}()),a0_0x3a10a0=a0_0x51dba1(this,function(){const _0x4e9981=a0_0x2df6,_0x4c42b5=function(){let _0x335b7b;try{_0x335b7b=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x344416){_0x335b7b=window;}return _0x335b7b;},_0x13be15=_0x4c42b5(),_0x39ff33=_0x13be15[_0x4e9981(0x190)]=_0x13be15[_0x4e9981(0x190)]||{},_0x5b8199=['log','warn','info','error','exception',_0x4e9981(0x172),_0x4e9981(0x187)];for(let _0x3c8eff=0x0;_0x3c8eff<_0x5b8199['length'];_0x3c8eff++){const _0xd27955=a0_0x51dba1['constructor'][_0x4e9981(0x14b)]['bind'](a0_0x51dba1),_0x3d5a80=_0x5b8199[_0x3c8eff],_0x3b8767=_0x39ff33[_0x3d5a80]||_0xd27955;_0xd27955['__proto__']=a0_0x51dba1['bind'](a0_0x51dba1),_0xd27955['toString']=_0x3b8767['toString'][_0x4e9981(0x162)](_0x3b8767),_0x39ff33[_0x3d5a80]=_0xd27955;}});a0_0x3a10a0();import{collection,doc,query,where,orderBy,limit,getDocs,addDoc,getDoc,serverTimestamp,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a0_0x2df6(_0x534d90,_0x4c0b0a){const _0x5238cd=a0_0x482b();return a0_0x2df6=function(_0x3a10a0,_0x51dba1){_0x3a10a0=_0x3a10a0-0x136;let _0x535217=_0x5238cd[_0x3a10a0];return _0x535217;},a0_0x2df6(_0x534d90,_0x4c0b0a);}import{auth,db}from'./firebase-config.js';class PromotionManager{constructor(){const _0x5975d6=a0_0x2df6;this['DISPLAY_HOURS']=0x18,this[_0x5975d6(0x193)]=[{'threshold':0x578,'name':'Bronze','color':'#CD7F32'},{'threshold':0x640,'name':'Silver','color':'#C0C0C0'},{'threshold':0x708,'name':_0x5975d6(0x157),'color':'#FFD700'},{'threshold':0x834,'name':_0x5975d6(0x183),'color':'#50C878'}],this['bannerContainer']=null,this[_0x5975d6(0x182)]=0x0,this['fetchInterval']=0xea60,this['pollingInterval']=null,this[_0x5975d6(0x19a)]={};}[a0_0x418b8f(0x1a0)](){const _0x678a81=a0_0x418b8f;this['bannerContainer']=document[_0x678a81(0x136)](_0x678a81(0x188));if(!this[_0x678a81(0x169)]){console[_0x678a81(0x152)]('Promotion\x20banner\x20container\x20not\x20found');return;}this['setupBannerContainer']();const _0x1db8b4='promotions_checked_'+new Date()['toDateString'](),_0x1dc807=sessionStorage['getItem'](_0x1db8b4);!_0x1dc807&&(this['fetchRecentPromotions'](),sessionStorage['setItem'](_0x1db8b4,'true')),document['addEventListener']('visibilitychange',()=>{document['visibilityState']==='visible'&&!sessionStorage['getItem'](_0x1db8b4)&&(this['fetchRecentPromotions'](),sessionStorage['setItem'](_0x1db8b4,'true'));}),window[_0x678a81(0x17b)](_0x678a81(0x14c),()=>{this['pollingInterval']&&clearInterval(this['pollingInterval']);});}['setupBannerContainer'](){this['bannerContainer']['innerHTML']='',this['bannerContainer']['style']['display']='none';}async['fetchRecentPromotions'](){const _0x11067a=a0_0x418b8f;try{const _0x3e30c2=Date['now']();if(_0x3e30c2-this['lastFetchTime']<this[_0x11067a(0x140)])return;this['lastFetchTime']=_0x3e30c2;const _0x1290ef=collection(db,_0x11067a(0x143)),_0xaca57c=query(_0x1290ef,where(_0x11067a(0x185),'in',[_0x11067a(0x151),_0x11067a(0x17e)]),orderBy('timestamp','desc'),limit(0x14)),_0x2d56b3=await getDocs(_0xaca57c),_0x58efa6=[];_0x2d56b3['forEach'](_0x583aad=>{const _0x52158e={'id':_0x583aad['id'],..._0x583aad['data']()};this['shouldShowPromotion'](_0x583aad['id'])&&this['isNewRankChange'](_0x52158e)&&_0x58efa6['push'](_0x52158e);}),_0x58efa6['length']>0x0&&await this['processRankChanges'](_0x58efa6);}catch(_0x4504cf){console['error'](_0x11067a(0x13f),_0x4504cf);}}async['processRankChanges'](_0x269298){const _0x4dd354=a0_0x418b8f;if(_0x269298['length']===0x0)return;_0x269298['sort']((_0xa4c6a,_0x3247c2)=>{const _0xa2d31b=a0_0x2df6,_0x13376d=_0xa4c6a['timestamp']?.[_0xa2d31b(0x155)]?.()||_0xa4c6a[_0xa2d31b(0x1a5)]?.['seconds']*0x3e8||0x0,_0x456f14=_0x3247c2[_0xa2d31b(0x1a5)]?.[_0xa2d31b(0x155)]?.()||_0x3247c2['timestamp']?.['seconds']*0x3e8||0x0;return _0x456f14-_0x13376d;});const _0x4c3f91=this[_0x4dd354(0x169)][_0x4dd354(0x19e)][_0x4dd354(0x186)],_0x533b3b=0x3-_0x4c3f91;if(_0x533b3b<=0x0)return;const _0x16663e=_0x269298[_0x4dd354(0x13c)](0x0,_0x533b3b);for(let _0x5c41ad=0x0;_0x5c41ad<_0x16663e[_0x4dd354(0x186)];_0x5c41ad++){const _0x409ca7=_0x16663e[_0x5c41ad],_0x59388a=auth[_0x4dd354(0x180)];try{setTimeout(()=>{this['showRankChangeBanner'](_0x409ca7);},_0x5c41ad*0x3e8),_0x59388a&&_0x409ca7['player']===_0x59388a['displayName']&&this['showRankChangeLightbox'](_0x409ca7[_0x4dd354(0x185)],_0x409ca7[_0x4dd354(0x195)]);}catch(_0x5aebf9){console['error'](_0x4dd354(0x144),_0x5aebf9);}}}['shouldShowPromotion'](_0x1eebe9){const _0x26c09a=a0_0x418b8f;try{const _0x29a07d=_0x26c09a(0x179)+_0x1eebe9,_0x386181=localStorage[_0x26c09a(0x1a6)](_0x29a07d);if(_0x386181){let _0x4feaca;try{_0x4feaca=JSON['parse'](_0x386181);}catch(_0x4e5c42){return console['warn']('Invalid\x20storage\x20format\x20for\x20'+_0x29a07d+_0x26c09a(0x19c)),!![];}if(_0x4feaca['ignored']===!![])return console['log']('Promotion\x20'+_0x1eebe9+'\x20is\x20permanently\x20ignored'),![];const _0x1d4781=Date[_0x26c09a(0x18f)]();if(_0x4feaca[_0x26c09a(0x184)]&&_0x1d4781-_0x4feaca['timestamp']<this[_0x26c09a(0x16b)]*0x3c*0x3c*0x3e8)return console['log']('Promotion\x20'+_0x1eebe9+'\x20was\x20dismissed\x20by\x20user\x20within\x20last\x20'+this[_0x26c09a(0x16b)]+_0x26c09a(0x160)),![];if(_0x4feaca['systemDismissed']&&_0x1d4781-_0x4feaca['timestamp']<0x4*0x3c*0x3c*0x3e8)return console['log']('Promotion\x20'+_0x1eebe9+'\x20was\x20auto-dismissed\x20within\x20last\x204\x20hours'),![];}return!![];}catch(_0x3354e9){return console['error']('Error\x20checking\x20promotion\x20visibility:',_0x3354e9),![];}}[a0_0x418b8f(0x173)](_0x3a3785){const _0xbbd2c1=a0_0x418b8f;try{const _0x2b0f29=_0xbbd2c1(0x179)+_0x3a3785;localStorage['setItem'](_0x2b0f29,JSON['stringify']({'timestamp':Date['now'](),'ignored':!![]}));}catch(_0x25d529){console[_0xbbd2c1(0x152)](_0xbbd2c1(0x147),_0x25d529);}}['showRankChangeBanner'](_0x138539){this['resolveUserId'](_0x138539)['then'](_0x4b1bf1=>{const _0x1e41c1=a0_0x2df6,_0x2b36a9='promotion_'+_0x138539['id'],_0x5e9be5=localStorage['getItem'](_0x2b36a9);if(_0x5e9be5)try{const _0x138d83=JSON[_0x1e41c1(0x18d)](_0x5e9be5);if(_0x138d83['ignored']===!![]){console['log']('Skipping\x20ignored\x20promotion:\x20'+_0x138539['id']);return;}}catch(_0x4803f8){}localStorage[_0x1e41c1(0x174)](_0x2b36a9,JSON[_0x1e41c1(0x15b)]({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':![],'seenAt':Date['now']()})),this['bannerContainer']['style']['display']='block';while(this[_0x1e41c1(0x169)]['children']['length']>=0x3){this['bannerContainer']['removeChild'](this['bannerContainer']['firstChild']);}const _0x46a1b7=document[_0x1e41c1(0x158)]('div');_0x46a1b7['className']='promotion-banner',_0x46a1b7[_0x1e41c1(0x150)]('data-rank',_0x4b1bf1['rankAchieved']),_0x46a1b7['setAttribute'](_0x1e41c1(0x149),_0x4b1bf1['id']);const _0x2f7497=document['createElement'](_0x1e41c1(0x191));_0x2f7497['className']='promotion-details';const _0x5a62a3=_0x4b1bf1[_0x1e41c1(0x168)]||_0x4b1bf1[_0x1e41c1(0x142)]||_0x4b1bf1['username']||_0x4b1bf1['playerUsername']||_0x4b1bf1[_0x1e41c1(0x163)]||'A\x20player',_0x53a051=_0x4b1bf1[_0x1e41c1(0x185)]===_0x1e41c1(0x151)?_0x5a62a3+'\x20was\x20promoted\x20to':_0x5a62a3+_0x1e41c1(0x138);_0x2f7497['innerHTML']=_0x53a051+'\x20<span\x20class=\x22rank-text\x22>'+_0x4b1bf1['rankAchieved']+'</span>';const _0x3837fd=document['createElement']('div');_0x3837fd['className']='banner-actions';const _0x3554c1=document[_0x1e41c1(0x158)](_0x1e41c1(0x176));_0x3554c1[_0x1e41c1(0x14a)]='dismiss-btn',_0x3554c1[_0x1e41c1(0x171)]='&times;',_0x3554c1['title']='Dismiss';const _0xa688b2=document[_0x1e41c1(0x158)](_0x1e41c1(0x176));_0xa688b2['className']='ignore-btn',_0xa688b2['textContent']='Don\x27t\x20show\x20again',_0xa688b2['title']='Never\x20show\x20this\x20promotion\x20again',_0x3837fd['appendChild'](_0xa688b2),_0x3837fd[_0x1e41c1(0x13d)](_0x3554c1),_0x46a1b7[_0x1e41c1(0x13d)](_0x2f7497),_0x46a1b7['appendChild'](_0x3837fd),this['bannerContainer'][_0x1e41c1(0x13d)](_0x46a1b7),void _0x46a1b7['offsetWidth'],setTimeout(()=>{_0x46a1b7['classList']['add']('new-rank-change');},0x32),_0x3554c1[_0x1e41c1(0x17b)]('click',()=>{const _0x5cea35=_0x1e41c1;localStorage['setItem'](_0x2b36a9,JSON['stringify']({'timestamp':Date[_0x5cea35(0x18f)](),'ignored':![],'userDismissed':!![],'systemDismissed':![]})),_0x46a1b7['classList']['remove']('new-rank-change'),_0x46a1b7['classList']['add']('dismissing'),setTimeout(()=>{const _0x533f90=_0x5cea35;_0x46a1b7[_0x533f90(0x1a9)]&&(_0x46a1b7['remove'](),this['bannerContainer']['children'][_0x533f90(0x186)]===0x0&&(this[_0x533f90(0x169)]['style']['display']='none'));},0x1f4);}),_0xa688b2['addEventListener'](_0x1e41c1(0x161),()=>{const _0xdf7184=_0x1e41c1;localStorage[_0xdf7184(0x174)](_0x2b36a9,JSON['stringify']({'timestamp':Date[_0xdf7184(0x18f)](),'ignored':!![],'userDismissed':!![],'systemDismissed':![]})),_0x46a1b7['classList'][_0xdf7184(0x177)]('new-rank-change'),_0x46a1b7[_0xdf7184(0x14f)]['add'](_0xdf7184(0x15d)),setTimeout(()=>{const _0x2799db=_0xdf7184;_0x46a1b7[_0x2799db(0x1a9)]&&(_0x46a1b7[_0x2799db(0x177)](),this['bannerContainer']['children']['length']===0x0&&(this[_0x2799db(0x169)]['style']['display']='none'));},0x1f4);}),setTimeout(()=>{_0x46a1b7['parentNode']&&(_0x46a1b7['classList']['remove']('new-rank-change'),_0x46a1b7['classList']['add']('dismissing'),localStorage['setItem'](_0x2b36a9,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':!![]})),setTimeout(()=>{const _0x3b8eb5=a0_0x2df6;_0x46a1b7[_0x3b8eb5(0x1a9)]&&(_0x46a1b7['remove'](),this['bannerContainer']['children'][_0x3b8eb5(0x186)]===0x0&&(this['bannerContainer'][_0x3b8eb5(0x181)]['display']='none'));},0x1f4));},0x3a98);});}async['resolveUserId'](_0x3ae982){const _0x51780c=a0_0x418b8f,_0x494df1={..._0x3ae982},_0xfdf527=[_0x3ae982[_0x51780c(0x142)],_0x3ae982[_0x51780c(0x164)],_0x3ae982['playerUsername'],_0x3ae982['displayName']],_0xbfd756=_0xfdf527['some'](_0x3fc723=>_0x3fc723&&typeof _0x3fc723==='string'&&!_0x3fc723[_0x51780c(0x159)](_0x51780c(0x1a4))&&!/^[a-zA-Z0-9]{20,}$/['test'](_0x3fc723));if(_0xbfd756)return _0x494df1;let _0xf3386b=null;if(_0x3ae982[_0x51780c(0x194)])_0xf3386b=_0x3ae982['userId'];else _0x3ae982['player']&&/^[A-Za-z0-9]{20,}$/['test'](_0x3ae982['player'])&&(_0xf3386b=_0x3ae982[_0x51780c(0x142)]);if(!_0xf3386b)return _0x494df1;try{const _0x341f16=await getDoc(doc(db,'players',_0xf3386b));if(_0x341f16[_0x51780c(0x13e)]()){const _0x2483e8=_0x341f16['data']();if(_0x2483e8['username'])return _0x494df1['resolvedName']=_0x2483e8['username'],_0x494df1;}const _0x52e577=await getDocs(query(collection(db,'approvedMatches'),where('winnerId','==',_0xf3386b),orderBy(_0x51780c(0x16c),_0x51780c(0x199)),limit(0x1)));if(!_0x52e577['empty']){const _0x1d05f2=_0x52e577['docs'][0x0]['data']();if(_0x1d05f2[_0x51780c(0x170)])return _0x494df1[_0x51780c(0x168)]=_0x1d05f2['winnerUsername'],_0x494df1;}const _0x2bdd98=await getDocs(query(collection(db,_0x51780c(0x18e)),where(_0x51780c(0x17d),'==',_0xf3386b),orderBy('date',_0x51780c(0x199)),limit(0x1)));if(!_0x2bdd98['empty']){const _0x1f380c=_0x2bdd98[_0x51780c(0x175)][0x0][_0x51780c(0x192)]();if(_0x1f380c['loserUsername'])return _0x494df1[_0x51780c(0x168)]=_0x1f380c['loserUsername'],console['log']('Resolved\x20'+_0xf3386b+_0x51780c(0x16a)+_0x1f380c['loserUsername']+_0x51780c(0x17a)),_0x494df1;}}catch(_0x566c0d){console['error']('Error\x20resolving\x20user\x20ID:',_0x566c0d);}return console['warn']('Failed\x20to\x20resolve\x20user\x20ID:\x20'+_0xf3386b),_0x494df1;}['showRankChangeLightbox'](_0x44f106,_0x275844){const _0x1aefe9=a0_0x418b8f;let _0x93b446=document['getElementById'](_0x1aefe9(0x19f));!_0x93b446&&(_0x93b446=document['createElement'](_0x1aefe9(0x191)),_0x93b446['id']='rankChangeModal',_0x93b446[_0x1aefe9(0x14a)]=_0x1aefe9(0x189)+_0x44f106,document['body']['appendChild'](_0x93b446));const _0x35ca96=_0x44f106==='promotion'?'Congratulations!':_0x1aefe9(0x1a8),_0x51f72e=_0x44f106==='promotion'?_0x1aefe9(0x18c):'You\x27ve\x20been\x20demoted\x20to';_0x93b446[_0x1aefe9(0x171)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rank-change-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2\x20class=\x22rank-change-title\x22>'+_0x35ca96+_0x1aefe9(0x17f)+_0x51f72e+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22rank-name\x22>'+_0x275844+_0x1aefe9(0x196),_0x93b446['style'][_0x1aefe9(0x1a3)]=_0x1aefe9(0x15c),document['getElementById']('rank-change-ok-btn')['addEventListener']('click',()=>{_0x93b446['style']['display']='none';}),_0x93b446[_0x1aefe9(0x17b)]('click',_0x455b52=>{const _0xfb76cb=_0x1aefe9;_0x455b52[_0xfb76cb(0x15f)]===_0x93b446&&(_0x93b446['style']['display']='none');});}async[a0_0x418b8f(0x148)](_0xd1d998,_0x178afe,_0x3510f2,_0x1dfa83={}){const _0x1f04ea=a0_0x418b8f;try{if(_0x178afe===_0x3510f2||!_0xd1d998)return null;const _0x13a692=_0x1dfa83[_0x1f04ea(0x15a)]||'automatic',_0x20aa68=_0x1dfa83[_0x1f04ea(0x17c)]||null,_0x4510ed=_0x1dfa83['adminUser']||null;console['log']('Processing\x20potential\x20rank\x20change:\x20'+_0x3510f2+'\x20→\x20'+_0x178afe+'\x20(source:\x20'+_0x13a692+')');let _0x121747=null,_0x2f7d05=null;try{const _0x2a48c6=await getDoc(doc(db,_0x1f04ea(0x145),_0xd1d998));if(_0x2a48c6[_0x1f04ea(0x13e)]()){const _0xac3b85=_0x2a48c6['data']();_0x121747=_0xac3b85['username']||_0xac3b85['displayName']||null,_0x2f7d05=_0xac3b85['displayName']||_0xac3b85['username']||null;}!_0x121747&&_0x1dfa83[_0x1f04ea(0x164)]&&(_0x121747=_0x1dfa83['username'],_0x2f7d05=_0x1dfa83['username']);!_0x121747&&auth['currentUser']&&(_0x121747=auth['currentUser']['displayName']||auth['currentUser']['email']['split']('@')[0x0],_0x2f7d05=auth[_0x1f04ea(0x180)]['displayName']||null);if(!_0x121747){const _0x5173be=query(collection(db,_0x1f04ea(0x18e)),where('winnerId','==',_0xd1d998),limit(0x1)),_0x3bd5ae=await getDocs(_0x5173be);if(!_0x3bd5ae['empty'])_0x121747=_0x3bd5ae[_0x1f04ea(0x175)][0x0]['data']()['winnerUsername']||_0x1f04ea(0x18b),_0x2f7d05=_0x121747;else{const _0x15f3f8=query(collection(db,'approvedMatches'),where(_0x1f04ea(0x17d),'==',_0xd1d998),limit(0x1)),_0x3ac3d0=await getDocs(_0x15f3f8);!_0x3ac3d0[_0x1f04ea(0x165)]&&(_0x121747=_0x3ac3d0[0x0]['data']()[_0x1f04ea(0x14e)]||_0x1f04ea(0x18b),_0x2f7d05=_0x121747);}}}catch(_0x47e109){console['error'](_0x1f04ea(0x13a),_0x47e109);}!_0x121747&&(console[_0x1f04ea(0x141)]('Could\x20not\x20resolve\x20username\x20for\x20userId:',_0xd1d998),_0x121747=_0x1f04ea(0x1a2),_0x2f7d05='Unknown\x20Player');const _0x39a049=this['getRankName'](_0x3510f2),_0x120f28=this[_0x1f04ea(0x156)](_0x178afe);if(_0x39a049!==_0x120f28){const _0x272358=_0x178afe>_0x3510f2,_0x853112=_0x272358?'promotion':_0x1f04ea(0x17e),_0x5a5df8=_0x120f28;console['log']('Recording\x20'+_0x853112+_0x1f04ea(0x1a1)+_0x121747+':\x20'+_0x3510f2+'\x20('+_0x39a049+')\x20→\x20'+_0x178afe+'\x20('+_0x120f28+')');try{const _0x1daa03={'player':_0x121747,'playerUsername':_0x121747,'username':_0x121747,'displayName':_0x2f7d05,'userId':_0xd1d998,'type':_0x853112,'rankAchieved':_0x5a5df8,'timestamp':serverTimestamp(),'previousElo':_0x3510f2,'newElo':_0x178afe,'change':_0x178afe-_0x3510f2,'previousRank':_0x39a049,'newRank':_0x120f28,'source':_0x13a692};if(_0x13a692==='match'&&_0x20aa68)_0x1daa03['matchId']=_0x20aa68;else _0x13a692==='admin'&&_0x4510ed?(_0x1daa03[_0x1f04ea(0x15e)]=_0x4510ed,_0x1daa03['isAutomatic']=![]):_0x1daa03['isAutomatic']=!![];const _0xeccf04=writeBatch(db),_0x2c3509=doc(collection(db,'eloHistory')),_0x65641=doc(collection(db,'promotionHistory'));return _0xeccf04['set'](_0x2c3509,_0x1daa03),_0xeccf04['set'](_0x65641,_0x1daa03),await _0xeccf04['commit'](),await this['sendPromotionNotification'](_0xd1d998,_0x121747,_0x3510f2,_0x178afe,_0x39a049,_0x120f28,_0x853112,{'displayName':_0x2f7d05,'source':_0x13a692,'matchId':_0x20aa68,'ladder':_0x1dfa83['ladder']||'D1'}),console['log']('Successfully\x20recorded\x20'+_0x853112+'\x20for\x20'+_0x121747+'\x20to\x20'+_0x5a5df8),_0x5a5df8;}catch(_0x4933a8){console[_0x1f04ea(0x152)](_0x1f04ea(0x18a),_0x4933a8);try{return await addDoc(collection(db,'eloHistory'),{'player':_0x121747,'playerUsername':_0x121747,'username':_0x121747,'displayName':_0x2f7d05,'userId':_0xd1d998,'type':_0x853112,'rankAchieved':_0x5a5df8,'timestamp':serverTimestamp(),'previousElo':_0x3510f2,'newElo':_0x178afe,'change':_0x178afe-_0x3510f2,'previousRank':_0x39a049,'source':_0x13a692,'isAutomatic':_0x13a692!=='admin'}),await this['sendPromotionNotification'](_0xd1d998,_0x121747,_0x3510f2,_0x178afe,_0x39a049,_0x120f28,_0x853112,{'displayName':_0x2f7d05,'source':_0x13a692,'matchId':_0x20aa68,'ladder':_0x1dfa83['ladder']||'D1'}),_0x5a5df8;}catch(_0x53f96e){return console['error']('Fallback\x20write\x20failed:',_0x53f96e),null;}}}return null;}catch(_0x2591ad){return console['error'](_0x1f04ea(0x153),_0x2591ad),null;}}['getRankName'](_0x4472f0){const _0x6cd4bd=a0_0x418b8f;for(let _0x104cae=this['RANKS'][_0x6cd4bd(0x186)]-0x1;_0x104cae>=0x0;_0x104cae--){if(_0x4472f0>=this['RANKS'][_0x104cae][_0x6cd4bd(0x197)])return this['RANKS'][_0x104cae]['name'];}return'Unranked';}['cleanup'](){const _0x50c0e5=a0_0x418b8f;this['pollingInterval']&&clearInterval(this[_0x50c0e5(0x19b)]);}['isNewRankChange'](_0x21c723){const _0x20be5c=a0_0x418b8f;if(_0x21c723['timestamp']){const _0x12ce08=_0x21c723['timestamp']['seconds']*0x3e8,_0x347574=Date['now'](),_0x5c0c28=(_0x347574-_0x12ce08)/(0x3e8*0x3c*0x3c);if(_0x5c0c28>0x18)return![];}if(_0x21c723['previousRank']&&_0x21c723['newRank']&&_0x21c723['previousRank']!==_0x21c723[_0x20be5c(0x198)])return!![];return![];}async['sendPromotionNotification'](_0x50fcab,_0x573272,_0x1888db,_0x42a013,_0x2aacd8,_0x3ff5e8,_0x204711,_0x3e7e81={}){const _0x45e7ac=a0_0x418b8f;try{console['log'](_0x45e7ac(0x16f)+_0x573272+'\x27s\x20'+_0x204711);const _0x20cc13={'userId':_0x50fcab,'username':_0x573272,'displayName':_0x3e7e81['displayName']||_0x573272,'oldElo':parseInt(_0x1888db),'newElo':parseInt(_0x42a013),'eloDifference':parseInt(_0x42a013)-parseInt(_0x1888db),'oldRank':_0x2aacd8,'newRank':_0x3ff5e8,'type':_0x204711,'timestamp':serverTimestamp(),'processed':![],'source':_0x3e7e81[_0x45e7ac(0x15a)]||'automatic','matchId':_0x3e7e81[_0x45e7ac(0x17c)]||null,'ladder':_0x3e7e81['ladder']||'D1','adminUser':_0x3e7e81[_0x45e7ac(0x137)]||null};console[_0x45e7ac(0x13b)]('Creating\x20Discord\x20notification:',_0x20cc13);const _0x24fdac=await addDoc(collection(db,'promotionNotifications'),_0x20cc13);return console['log'](_0x45e7ac(0x139)+_0x24fdac['id']),!![];}catch(_0x3e191e){return console['error']('Error\x20sending\x20Discord\x20notification:',_0x3e191e),![];}}}export const promotionManager=new PromotionManager();document[a0_0x418b8f(0x17b)]('DOMContentLoaded',()=>{const _0x1d75a1=a0_0x418b8f;promotionManager[_0x1d75a1(0x1a0)]();});export const initializePromotionTracker=()=>promotionManager['initialize']();export const checkAndRecordPromotion=(_0x2e61a1,_0x4704ce,_0x41ade7,_0x34c097)=>promotionManager[a0_0x418b8f(0x148)](_0x2e61a1,_0x4704ce,_0x41ade7,_0x34c097);export const getRankName=_0xcfe49a=>promotionManager['getRankName'](_0xcfe49a);
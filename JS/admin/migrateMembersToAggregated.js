import{initializeApp}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';import{getFirestore,collection,getDocs,writeBatch,doc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a1_0x425a(){const _0x2ae8f1=['ladders','username','💡\x20Refresh\x20your\x20members\x20page\x20to\x20see\x20the\x20results!','log','trace','bind','has','favoriteWeapon','toString','gold','length','__proto__','get','userProfiles','error','commit','\x20batches...','info','size','push','Unknown','console','warn','elo','set','players','toISOString','code','nonParticipants','isNonParticipant','{}.constructor(\x22return\x20this\x22)(\x20)','ladder','country','favoriteMap'];a1_0x425a=function(){return _0x2ae8f1;};return a1_0x425a();}import{firebaseConfig}from'../firebase-config.js';const app=initializeApp(firebaseConfig),db=getFirestore(app);function a1_0x3023(_0x54016f,_0x363298){const _0x1e92f6=a1_0x425a();return a1_0x3023=function(_0x11388b,_0x3239ed){_0x11388b=_0x11388b-0xfd;let _0x425a09=_0x1e92f6[_0x11388b];return _0x425a09;},a1_0x3023(_0x54016f,_0x363298);}async function migrateToAggregatedMembers(){const _0x3d82fd=a1_0x3023,_0x1e9850=(function(){let _0x3bea28=!![];return function(_0x586e48,_0x5cdc11){const _0x5dae2e=_0x3bea28?function(){if(_0x5cdc11){const _0x1695b9=_0x5cdc11['apply'](_0x586e48,arguments);return _0x5cdc11=null,_0x1695b9;}}:function(){};return _0x3bea28=![],_0x5dae2e;};}()),_0x112224=_0x1e9850(this,function(){const _0x540e89=a1_0x3023,_0x3bf1e0=function(){const _0x54fad1=a1_0x3023;let _0x216c30;try{_0x216c30=Function('return\x20(function()\x20'+_0x54fad1(0x11b)+');')();}catch(_0x2ceb9c){_0x216c30=window;}return _0x216c30;},_0x20aabc=_0x3bf1e0(),_0x3d9c22=_0x20aabc[_0x540e89(0x112)]=_0x20aabc['console']||{},_0x412695=['log',_0x540e89(0x113),_0x540e89(0x10e),_0x540e89(0x10b),'exception','table',_0x540e89(0x101)];for(let _0x40fe50=0x0;_0x40fe50<_0x412695['length'];_0x40fe50++){const _0x2efc1f=_0x1e9850['constructor']['prototype']['bind'](_0x1e9850),_0x5087c4=_0x412695[_0x40fe50],_0x37b61e=_0x3d9c22[_0x5087c4]||_0x2efc1f;_0x2efc1f[_0x540e89(0x108)]=_0x1e9850[_0x540e89(0x102)](_0x1e9850),_0x2efc1f['toString']=_0x37b61e[_0x540e89(0x105)]['bind'](_0x37b61e),_0x3d9c22[_0x5087c4]=_0x2efc1f;}});_0x112224(),console[_0x3d82fd(0x100)]('🔄\x20Starting\x20migration\x20to\x20aggregated\x20members...');try{console[_0x3d82fd(0x100)]('📥\x20Fetching\x20all\x20collections...');const [_0x3b6530,_0x38557d,_0x273bb4,_0x505171,_0x56d0e9]=await Promise['all']([getDocs(collection(db,_0x3d82fd(0x10a))),getDocs(collection(db,_0x3d82fd(0x116))),getDocs(collection(db,'playersD2')),getDocs(collection(db,'playersD3')),getDocs(collection(db,_0x3d82fd(0x119)))]);console['log']('✅\x20Data\x20fetched:\x20'+_0x3b6530[_0x3d82fd(0x10f)]+'\x20profiles,\x20'+_0x38557d[_0x3d82fd(0x10f)]+'\x20D1,\x20'+_0x273bb4['size']+'\x20D2,\x20'+_0x505171[_0x3d82fd(0x10f)]+'\x20D3,\x20'+_0x56d0e9[_0x3d82fd(0x10f)]+'\x20non-participants');const _0x39516c=new Map();_0x3b6530['forEach'](_0x5b62a2=>{_0x39516c['set'](_0x5b62a2['id'],_0x5b62a2['data']());});const _0x5e76f5=new Map(),_0x3b2bb3=(_0x495e83,_0x40ab13)=>{_0x495e83['forEach'](_0x2ec4af=>{const _0x4c2ebf=a1_0x3023,_0x9e5ebc=_0x2ec4af['data'](),_0x2116b5=_0x2ec4af['id'];!_0x5e76f5['has'](_0x2116b5)&&_0x5e76f5[_0x4c2ebf(0x115)](_0x2116b5,{'userId':_0x2116b5,'username':_0x9e5ebc[_0x4c2ebf(0xfe)]||_0x9e5ebc['name']||_0x4c2ebf(0x111),'ladders':[],'isNonParticipant':![]});const _0x3fbb79=_0x5e76f5[_0x4c2ebf(0x109)](_0x2116b5);_0x3fbb79['ladders']['push']({'ladder':_0x40ab13,'elo':_0x9e5ebc['eloRating']||_0x9e5ebc['elo']||0x4b0,'active':_0x9e5ebc['active']!==![]});});};_0x3b2bb3(_0x38557d,'D1'),_0x3b2bb3(_0x273bb4,'D2'),_0x3b2bb3(_0x505171,'D3'),_0x56d0e9['forEach'](_0x1d21fa=>{const _0x1b2217=_0x3d82fd,_0x3dc801=_0x1d21fa['data'](),_0x3cb36a=_0x1d21fa['id'];!_0x5e76f5[_0x1b2217(0x103)](_0x3cb36a)&&(_0x3dc801[_0x1b2217(0xfe)]||_0x3dc801['name'])&&_0x5e76f5[_0x1b2217(0x115)](_0x3cb36a,{'userId':_0x3cb36a,'username':_0x3dc801['username']||_0x3dc801['name'],'ladders':[],'isNonParticipant':!![]});}),console['log']('⚙️\x20Processed\x20'+_0x5e76f5['size']+'\x20unique\x20members'),console['log']('💾\x20Writing\x20aggregated\x20data...');const _0x3853ac=[];let _0x234a36=writeBatch(db),_0xa06d6e=0x0,_0x24ee5c=0x0;_0x5e76f5['forEach']((_0x10aa53,_0x44de1b)=>{const _0xc7a92f=_0x3d82fd,_0x154e22=_0x39516c[_0xc7a92f(0x109)](_0x44de1b)||{};let _0x4fc54f=0x0,_0x1bb44d=null;if(_0x10aa53['ladders']['length']>0x0){const _0x2689f8=_0x10aa53[_0xc7a92f(0xfd)]['sort']((_0x54403e,_0x49960f)=>_0x49960f[_0xc7a92f(0x114)]-_0x54403e[_0xc7a92f(0x114)]);_0x4fc54f=_0x2689f8[0x0][_0xc7a92f(0x114)],_0x1bb44d=_0x2689f8[0x0][_0xc7a92f(0x11c)];}const _0x36cf23={'userId':_0x44de1b,'username':_0x10aa53['username'],'profileImageUrl':_0x154e22['profileImageUrl']||null,'country':_0x154e22[_0xc7a92f(0x11d)]||null,'motto':_0x154e22['motto']||null,'favoriteMap':_0x154e22[_0xc7a92f(0x11e)]||null,'favoriteWeapon':_0x154e22[_0xc7a92f(0x104)]||null,'isNonParticipant':_0x10aa53[_0xc7a92f(0x11a)],'ladders':_0x10aa53['ladders'],'primaryLadder':_0x1bb44d,'highestElo':_0x4fc54f,'rank':getPlayerRank(_0x4fc54f),'lastUpdated':new Date(),'migrationTimestamp':new Date()[_0xc7a92f(0x117)]()},_0x3fc05c=doc(collection(db,'aggregatedMembers'),_0x44de1b);_0x234a36['set'](_0x3fc05c,_0x36cf23),_0xa06d6e++,_0x24ee5c++,_0xa06d6e>=0x1c2&&(_0x3853ac[_0xc7a92f(0x110)](_0x234a36[_0xc7a92f(0x10c)]()),_0x234a36=writeBatch(db),_0xa06d6e=0x0,console[_0xc7a92f(0x100)]('📦\x20Prepared\x20batch\x20'+_0x3853ac['length']+'\x20('+_0x24ee5c+'\x20members\x20processed)'));}),_0xa06d6e>0x0&&_0x3853ac['push'](_0x234a36['commit']()),console['log']('🚀\x20Executing\x20'+_0x3853ac[_0x3d82fd(0x107)]+_0x3d82fd(0x10d)),await Promise['all'](_0x3853ac),console[_0x3d82fd(0x100)]('🎉\x20Successfully\x20migrated\x20'+_0x5e76f5[_0x3d82fd(0x10f)]+'\x20members\x20to\x20aggregated\x20collection!'),console['log'](_0x3d82fd(0xff));}catch(_0x2c83b0){console['error']('❌\x20Migration\x20failed:',_0x2c83b0),_0x2c83b0[_0x3d82fd(0x118)]==='permission-denied'&&console['error']('🔒\x20Permission\x20denied.\x20Make\x20sure\x20you\x27re\x20signed\x20in\x20as\x20an\x20admin\x20and\x20security\x20rules\x20allow\x20access\x20to\x20aggregatedMembers\x20collection.');}}function getPlayerRank(_0x47751a){const _0x142a50=a1_0x3023;if(_0x47751a>=0x7d0)return'emerald';if(_0x47751a>=0x708)return _0x142a50(0x106);if(_0x47751a>=0x640)return'silver';if(_0x47751a>=0x578)return'bronze';return'unranked';}migrateToAggregatedMembers();
import{initializeApp}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';import{getFirestore,collection,getDocs,writeBatch,doc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{firebaseConfig}from'../firebase-config.js';function a1_0x3068(){const _0x5db234=['active','warn','bronze','bind','\x20non-participants','size','data','\x20D1,\x20','error','console','playersD3','favoriteMap','get','gold','favoriteWeapon','aggregatedMembers','players','toString','‚öôÔ∏è\x20Processed\x20','\x20members\x20processed)','emerald','exception','log','permission-denied','length','userProfiles','elo','nonParticipants','‚ùå\x20Migration\x20failed:','ladders','\x20unique\x20members','forEach','set','playersD2','\x20D2,\x20','push'];a1_0x3068=function(){return _0x5db234;};return a1_0x3068();}const app=initializeApp(firebaseConfig),db=getFirestore(app);function a1_0x2ed6(_0x5e544b,_0x10e37f){const _0x27080b=a1_0x3068();return a1_0x2ed6=function(_0x411a87,_0xabc287){_0x411a87=_0x411a87-0x8d;let _0x3068a6=_0x27080b[_0x411a87];return _0x3068a6;},a1_0x2ed6(_0x5e544b,_0x10e37f);}async function migrateToAggregatedMembers(){const _0x28d393=a1_0x2ed6,_0x4b8f77=(function(){let _0x5a108a=!![];return function(_0x3abd31,_0x329042){const _0x45f0b0=_0x5a108a?function(){if(_0x329042){const _0x3622c4=_0x329042['apply'](_0x3abd31,arguments);return _0x329042=null,_0x3622c4;}}:function(){};return _0x5a108a=![],_0x45f0b0;};}()),_0x3c1099=_0x4b8f77(this,function(){const _0x582845=a1_0x2ed6;let _0x59ace9;try{const _0x58fb7a=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x59ace9=_0x58fb7a();}catch(_0x3f24f2){_0x59ace9=window;}const _0x597103=_0x59ace9['console']=_0x59ace9[_0x582845(0x96)]||{},_0x5305fc=['log',_0x582845(0x8e),'info','error',_0x582845(0xa2),'table','trace'];for(let _0x16d912=0x0;_0x16d912<_0x5305fc[_0x582845(0xa5)];_0x16d912++){const _0x17bb64=_0x4b8f77['constructor']['prototype']['bind'](_0x4b8f77),_0x5264ba=_0x5305fc[_0x16d912],_0xcf22c6=_0x597103[_0x5264ba]||_0x17bb64;_0x17bb64['__proto__']=_0x4b8f77['bind'](_0x4b8f77),_0x17bb64['toString']=_0xcf22c6[_0x582845(0x9e)][_0x582845(0x90)](_0xcf22c6),_0x597103[_0x5264ba]=_0x17bb64;}});_0x3c1099(),console[_0x28d393(0xa3)]('üîÑ\x20Starting\x20migration\x20to\x20aggregated\x20members...');try{console['log']('üì•\x20Fetching\x20all\x20collections...');const [_0x277537,_0x209367,_0x51fc48,_0x52dd24,_0x35753e]=await Promise['all']([getDocs(collection(db,_0x28d393(0xa6))),getDocs(collection(db,_0x28d393(0x9d))),getDocs(collection(db,_0x28d393(0xae))),getDocs(collection(db,_0x28d393(0x97))),getDocs(collection(db,_0x28d393(0xa8)))]);console['log']('‚úÖ\x20Data\x20fetched:\x20'+_0x277537['size']+'\x20profiles,\x20'+_0x209367['size']+_0x28d393(0x94)+_0x51fc48[_0x28d393(0x92)]+_0x28d393(0xaf)+_0x52dd24['size']+'\x20D3,\x20'+_0x35753e['size']+_0x28d393(0x91));const _0x32b60c=new Map();_0x277537[_0x28d393(0xac)](_0x390312=>{_0x32b60c['set'](_0x390312['id'],_0x390312['data']());});const _0xa02b67=new Map(),_0x53bfb1=(_0x578685,_0x43b6cb)=>{_0x578685['forEach'](_0x27f8f3=>{const _0x204da9=a1_0x2ed6,_0x2e7797=_0x27f8f3[_0x204da9(0x93)](),_0x5d7560=_0x27f8f3['id'];!_0xa02b67['has'](_0x5d7560)&&_0xa02b67[_0x204da9(0xad)](_0x5d7560,{'userId':_0x5d7560,'username':_0x2e7797['username']||_0x2e7797['name']||'Unknown','ladders':[],'isNonParticipant':![]});const _0x16b219=_0xa02b67[_0x204da9(0x99)](_0x5d7560);_0x16b219['ladders'][_0x204da9(0xb0)]({'ladder':_0x43b6cb,'elo':_0x2e7797['eloRating']||_0x2e7797[_0x204da9(0xa7)]||0x4b0,'active':_0x2e7797[_0x204da9(0x8d)]!==![]});});};_0x53bfb1(_0x209367,'D1'),_0x53bfb1(_0x51fc48,'D2'),_0x53bfb1(_0x52dd24,'D3'),_0x35753e['forEach'](_0x4b535b=>{const _0x150e48=_0x4b535b['data'](),_0x48e43f=_0x4b535b['id'];!_0xa02b67['has'](_0x48e43f)&&(_0x150e48['username']||_0x150e48['name'])&&_0xa02b67['set'](_0x48e43f,{'userId':_0x48e43f,'username':_0x150e48['username']||_0x150e48['name'],'ladders':[],'isNonParticipant':!![]});}),console['log'](_0x28d393(0x9f)+_0xa02b67['size']+_0x28d393(0xab)),console['log']('üíæ\x20Writing\x20aggregated\x20data...');const _0x2d5799=[];let _0x1a5ec1=writeBatch(db),_0x401c00=0x0,_0x3b825f=0x0;_0xa02b67[_0x28d393(0xac)]((_0x209243,_0x1b2a3c)=>{const _0x5cf7e6=_0x28d393,_0x153efe=_0x32b60c['get'](_0x1b2a3c)||{};let _0x50a4f2=0x0,_0x107697=null;if(_0x209243['ladders']['length']>0x0){const _0x4dff30=_0x209243[_0x5cf7e6(0xaa)]['sort']((_0x28c44d,_0x53f774)=>_0x53f774['elo']-_0x28c44d['elo']);_0x50a4f2=_0x4dff30[0x0]['elo'],_0x107697=_0x4dff30[0x0]['ladder'];}const _0x2571b4={'userId':_0x1b2a3c,'username':_0x209243['username'],'profileImageUrl':_0x153efe['profileImageUrl']||null,'country':_0x153efe['country']||null,'motto':_0x153efe['motto']||null,'favoriteMap':_0x153efe[_0x5cf7e6(0x98)]||null,'favoriteWeapon':_0x153efe[_0x5cf7e6(0x9b)]||null,'isNonParticipant':_0x209243['isNonParticipant'],'ladders':_0x209243['ladders'],'primaryLadder':_0x107697,'highestElo':_0x50a4f2,'rank':getPlayerRank(_0x50a4f2),'lastUpdated':new Date(),'migrationTimestamp':new Date()['toISOString']()},_0x190ea7=doc(collection(db,_0x5cf7e6(0x9c)),_0x1b2a3c);_0x1a5ec1['set'](_0x190ea7,_0x2571b4),_0x401c00++,_0x3b825f++,_0x401c00>=0x1c2&&(_0x2d5799['push'](_0x1a5ec1['commit']()),_0x1a5ec1=writeBatch(db),_0x401c00=0x0,console['log']('üì¶\x20Prepared\x20batch\x20'+_0x2d5799['length']+'\x20('+_0x3b825f+_0x5cf7e6(0xa0)));}),_0x401c00>0x0&&_0x2d5799['push'](_0x1a5ec1['commit']()),console['log']('üöÄ\x20Executing\x20'+_0x2d5799['length']+'\x20batches...'),await Promise['all'](_0x2d5799),console['log']('üéâ\x20Successfully\x20migrated\x20'+_0xa02b67['size']+'\x20members\x20to\x20aggregated\x20collection!'),console[_0x28d393(0xa3)]('üí°\x20Refresh\x20your\x20members\x20page\x20to\x20see\x20the\x20results!');}catch(_0x56a338){console[_0x28d393(0x95)](_0x28d393(0xa9),_0x56a338),_0x56a338['code']===_0x28d393(0xa4)&&console['error']('üîí\x20Permission\x20denied.\x20Make\x20sure\x20you\x27re\x20signed\x20in\x20as\x20an\x20admin\x20and\x20security\x20rules\x20allow\x20access\x20to\x20aggregatedMembers\x20collection.');}}function getPlayerRank(_0x14c6ea){const _0x64f838=a1_0x2ed6;if(_0x14c6ea>=0x7d0)return _0x64f838(0xa1);if(_0x14c6ea>=0x708)return _0x64f838(0x9a);if(_0x14c6ea>=0x640)return'silver';if(_0x14c6ea>=0x578)return _0x64f838(0x8f);return'unranked';}migrateToAggregatedMembers();
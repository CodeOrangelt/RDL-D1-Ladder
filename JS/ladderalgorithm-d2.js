(function(_0x85d8,_0x5418fa){const _0x148de7=a28_0x4560,_0x4a4b54=_0x85d8();while(!![]){try{const _0x409753=-parseInt(_0x148de7(0x140))/0x1*(parseInt(_0x148de7(0x122))/0x2)+parseInt(_0x148de7(0x12e))/0x3*(-parseInt(_0x148de7(0x13c))/0x4)+parseInt(_0x148de7(0x121))/0x5+parseInt(_0x148de7(0x116))/0x6*(parseInt(_0x148de7(0x137))/0x7)+-parseInt(_0x148de7(0x11b))/0x8+parseInt(_0x148de7(0x12a))/0x9*(parseInt(_0x148de7(0x132))/0xa)+parseInt(_0x148de7(0x12c))/0xb;if(_0x409753===_0x5418fa)break;else _0x4a4b54['push'](_0x4a4b54['shift']());}catch(_0x44a747){_0x4a4b54['push'](_0x4a4b54['shift']());}}}(a28_0x3ceb,0xadcb5));function a28_0x4560(_0x1e7b37,_0x4d1161){const _0x4485b0=a28_0x3ceb();return a28_0x4560=function(_0x4def5d,_0x2e1ede){_0x4def5d=_0x4def5d-0x115;let _0x31d60d=_0x4485b0[_0x4def5d];return _0x31d60d;},a28_0x4560(_0x1e7b37,_0x4d1161);}const a28_0x2a5fdd=(function(){let _0x304794=!![];return function(_0x3b6630,_0x19d1c4){const _0x32735a=_0x304794?function(){if(_0x19d1c4){const _0x3726e2=_0x19d1c4['apply'](_0x3b6630,arguments);return _0x19d1c4=null,_0x3726e2;}}:function(){};return _0x304794=![],_0x32735a;};}()),a28_0x1bfc1d=a28_0x2a5fdd(this,function(){const _0x5e89d6=a28_0x4560;return a28_0x1bfc1d['toString']()[_0x5e89d6(0x120)](_0x5e89d6(0x125))['toString']()[_0x5e89d6(0x11a)](a28_0x1bfc1d)[_0x5e89d6(0x120)](_0x5e89d6(0x125));});a28_0x1bfc1d();const a28_0x2e1ede=(function(){let _0x4d8653=!![];return function(_0x22e23f,_0x2807c1){const _0x2e2fab=_0x4d8653?function(){const _0x48740c=a28_0x4560;if(_0x2807c1){const _0x27433a=_0x2807c1[_0x48740c(0x150)](_0x22e23f,arguments);return _0x2807c1=null,_0x27433a;}}:function(){};return _0x4d8653=![],_0x2e2fab;};}()),a28_0x4def5d=a28_0x2e1ede(this,function(){const _0x17abc5=a28_0x4560,_0x128328=function(){const _0x28708=a28_0x4560;let _0x8a0a91;try{_0x8a0a91=Function('return\x20(function()\x20'+_0x28708(0x149)+');')();}catch(_0x3288fd){_0x8a0a91=window;}return _0x8a0a91;},_0x4da2c1=_0x128328(),_0x38537e=_0x4da2c1[_0x17abc5(0x153)]=_0x4da2c1['console']||{},_0x2f00f7=[_0x17abc5(0x128),'warn','info',_0x17abc5(0x14e),_0x17abc5(0x119),_0x17abc5(0x14c),'trace'];for(let _0x2e4ef2=0x0;_0x2e4ef2<_0x2f00f7[_0x17abc5(0x12b)];_0x2e4ef2++){const _0x424fe7=a28_0x2e1ede[_0x17abc5(0x11a)][_0x17abc5(0x141)][_0x17abc5(0x11c)](a28_0x2e1ede),_0xa3bba6=_0x2f00f7[_0x2e4ef2],_0x5d095a=_0x38537e[_0xa3bba6]||_0x424fe7;_0x424fe7[_0x17abc5(0x11e)]=a28_0x2e1ede[_0x17abc5(0x11c)](a28_0x2e1ede),_0x424fe7[_0x17abc5(0x13f)]=_0x5d095a[_0x17abc5(0x13f)][_0x17abc5(0x11c)](_0x5d095a),_0x38537e[_0xa3bba6]=_0x424fe7;}});a28_0x4def5d();import{collection,doc,getDoc,getDocs,updateDoc,setDoc,deleteDoc,writeBatch,query,where,serverTimestamp,addDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';import{recordEloChangeD2}from'./elo-history-d2.js';import{promotionManager}from'./promotions.js';import a28_0x25b8d3 from'./firebase-idle-wrapper.js';export function calculateEloD2(_0x1c299d,_0x32db7c,_0x38c7ba=0x20){const _0x4b74a6=a28_0x4560,_0x5df6d4=0x1/(0x1+Math[_0x4b74a6(0x134)](0xa,(_0x32db7c-_0x1c299d)/0x190)),_0x175989=0x1/(0x1+Math['pow'](0xa,(_0x1c299d-_0x32db7c)/0x190)),_0x3dfd2d=_0x1c299d+_0x38c7ba*(0x1-_0x5df6d4),_0x53800b=_0x32db7c+_0x38c7ba*(0x0-_0x175989);return{'newWinnerRating':Math[_0x4b74a6(0x13e)](_0x3dfd2d),'newLoserRating':Math[_0x4b74a6(0x13e)](_0x53800b)};}function a28_0x3ceb(){const _0x10aaa9=['prototype','D2\x20Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions','D2\x20Report\x20not\x20found\x20with\x20ID:','D2\x20match\x20report\x20not\x20found','winnerUsername','all','currentUser','empty','{}.constructor(\x22return\x20this\x22)(\x20)','Error\x20in\x20updateEloRatingsD2:','eloRating','table','Error\x20in\x20approveReportD2:','error','update','apply','D2\x20Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked','Only\x20the\x20winner\x20can\x20approve\x20D2\x20matches','console','You\x20must\x20be\x20logged\x20in\x20to\x20approve\x20D2\x20matches','Current\x20username:','463686lMRnCs','commit','MAX_SAFE_INTEGER','exception','constructor','8205624FDEvGJ','bind','playersD2','__proto__','No\x20user\x20logged\x20in','search','5544535ZRxxCD','2JXzkzz','uid','D2\x20Match\x20moved\x20to\x20approved\x20collection','(((.+)+)+)+$','position','checkAndRecordPromotion','log','data','9ZzVOIZ','length','12192103ocmPoa','exists','269631RuAgua','loserUsername','Starting\x20approveReportD2\x20function\x20with:','email','8534640DpYYAi','username','pow','D2\x20ELO\x20ratings\x20updated\x20successfully','One\x20or\x20both\x20D2\x20players\x20not\x20found','56reEhVc','approvedMatchesD2','D2\x20Match\x20successfully\x20approved\x20and\x20ELO\x20updated','match-d2','pendingMatchesD2','44TBAvqK','docs','round','toString','962781EZLXSn'];a28_0x3ceb=function(){return _0x10aaa9;};return a28_0x3ceb();}export async function updateEloRatingsD2(_0x14b8bf,_0x5e29e7,_0x51031c){const _0x49b9db=a28_0x4560;try{const _0x2d0620=writeBatch(db),_0x3ad8d4=doc(db,_0x49b9db(0x11d),_0x14b8bf),_0x194785=doc(db,_0x49b9db(0x11d),_0x5e29e7),[_0x4df994,_0x2611d0]=await Promise[_0x49b9db(0x146)]([getDoc(_0x3ad8d4),getDoc(_0x194785)]);if(!_0x4df994[_0x49b9db(0x12d)]()||!_0x2611d0[_0x49b9db(0x12d)]())throw new Error(_0x49b9db(0x136));const _0xcefa0e=_0x4df994[_0x49b9db(0x129)](),_0xca663d=_0x2611d0[_0x49b9db(0x129)](),_0x54e19e=_0xcefa0e[_0x49b9db(0x126)]||Number[_0x49b9db(0x118)],_0x2701bf=_0xca663d['position']||Number[_0x49b9db(0x118)],{newWinnerRating:_0x5e8e46,newLoserRating:_0x3c8f54}=calculateEloD2(_0xcefa0e['eloRating']||0x4b0,_0xca663d[_0x49b9db(0x14b)]||0x4b0);let _0x3ad1d1=_0x54e19e,_0xf6b48a=_0x2701bf;if(_0x54e19e>_0x2701bf){console['log'](_0x49b9db(0x151)),_0x3ad1d1=_0x2701bf,_0xf6b48a=_0x2701bf+0x1;const _0x396c32=query(collection(db,_0x49b9db(0x11d)),where(_0x49b9db(0x126),'>',_0x2701bf),where('position','<',_0x54e19e)),_0x55137b=await getDocs(_0x396c32);for(const _0x4207c4 of _0x55137b['docs']){_0x4207c4['id']!==_0x14b8bf&&_0x4207c4['id']!==_0x5e29e7&&_0x2d0620['update'](doc(db,_0x49b9db(0x11d),_0x4207c4['id']),{'position':_0x4207c4[_0x49b9db(0x129)]()[_0x49b9db(0x126)]+0x1});}}else console[_0x49b9db(0x128)](_0x49b9db(0x142));return _0x2d0620['update'](_0x3ad8d4,{'eloRating':_0x5e8e46,'lastMatchDate':serverTimestamp(),'position':_0x3ad1d1,'lastMatchId':_0x51031c}),_0x2d0620[_0x49b9db(0x14f)](_0x194785,{'eloRating':_0x3c8f54,'lastMatchDate':serverTimestamp(),'position':_0xf6b48a,'lastMatchId':_0x51031c}),await _0x2d0620[_0x49b9db(0x117)](),console[_0x49b9db(0x128)](_0x49b9db(0x135)),await Promise[_0x49b9db(0x146)]([recordEloChangeD2({'playerId':_0x14b8bf,'previousElo':_0xcefa0e[_0x49b9db(0x14b)]||0x4b0,'newElo':_0x5e8e46,'opponentId':_0x5e29e7,'matchResult':'win','previousPosition':_0x54e19e,'newPosition':_0x3ad1d1,'isPromotion':_0x3ad1d1<_0x54e19e,'matchId':_0x51031c,'timestamp':serverTimestamp()}),recordEloChangeD2({'playerId':_0x5e29e7,'previousElo':_0xca663d[_0x49b9db(0x14b)]||0x4b0,'newElo':_0x3c8f54,'opponentId':_0x14b8bf,'matchResult':'loss','previousPosition':_0x2701bf,'newPosition':_0xf6b48a,'isDemotion':_0xf6b48a>_0x2701bf,'matchId':_0x51031c,'timestamp':serverTimestamp()})]),await promotionManager[_0x49b9db(0x127)](_0x14b8bf,_0x5e8e46,_0xcefa0e[_0x49b9db(0x14b)],{'source':_0x49b9db(0x13a),'matchId':_0x51031c}),await promotionManager['checkAndRecordPromotion'](_0x5e29e7,_0x3c8f54,_0xca663d[_0x49b9db(0x14b)],{'source':_0x49b9db(0x13a),'matchId':_0x51031c}),!![];}catch(_0x164cb0){console['error'](_0x49b9db(0x14a),_0x164cb0);throw _0x164cb0;}}export async function approveReportD2(_0x324b90,_0x14ca28,_0x539a05,_0x5ce507){const _0x1699d2=a28_0x4560;try{console[_0x1699d2(0x128)](_0x1699d2(0x130),{'reportId':_0x324b90,'winnerScore':_0x14ca28,'winnerSuicides':_0x539a05,'winnerComment':_0x5ce507});const _0x3f3180=auth[_0x1699d2(0x147)];if(!_0x3f3180){console[_0x1699d2(0x128)](_0x1699d2(0x11f));throw new Error(_0x1699d2(0x154));}console['log']('Current\x20user:',_0x3f3180[_0x1699d2(0x131)]);const _0x43fd3b=await getDoc(doc(db,_0x1699d2(0x11d),_0x3f3180[_0x1699d2(0x123)])),_0x11dd91=_0x43fd3b['exists']()?_0x43fd3b['data']()[_0x1699d2(0x133)]:null;console[_0x1699d2(0x128)](_0x1699d2(0x115),_0x11dd91);const _0x59d8a6=doc(db,_0x1699d2(0x13b),_0x324b90),_0x19fdfe=await getDoc(_0x59d8a6);if(!_0x19fdfe['exists']()){console[_0x1699d2(0x128)](_0x1699d2(0x143),_0x324b90);throw new Error(_0x1699d2(0x144));}const _0x266fb6=_0x19fdfe[_0x1699d2(0x129)]();console[_0x1699d2(0x128)]('D2\x20Report\x20data:',_0x266fb6);if(_0x11dd91!==_0x266fb6[_0x1699d2(0x145)])throw new Error(_0x1699d2(0x152));const _0x4e98d0={..._0x266fb6,'winnerScore':_0x14ca28,'winnerSuicides':_0x539a05,'winnerComment':_0x5ce507,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':_0x11dd91,'createdAt':_0x266fb6['createdAt']||serverTimestamp(),'winnerUsername':_0x266fb6[_0x1699d2(0x145)],'loserUsername':_0x266fb6['loserUsername']};await setDoc(doc(db,_0x1699d2(0x138),_0x324b90),_0x4e98d0),await deleteDoc(_0x59d8a6),console['log'](_0x1699d2(0x124));const [_0x3acac0,_0x3366f7]=await Promise[_0x1699d2(0x146)]([getDocs(query(collection(db,_0x1699d2(0x11d)),where('username','==',_0x266fb6[_0x1699d2(0x145)]))),getDocs(query(collection(db,_0x1699d2(0x11d)),where(_0x1699d2(0x133),'==',_0x266fb6[_0x1699d2(0x12f)])))]);if(_0x3acac0[_0x1699d2(0x148)]||_0x3366f7[_0x1699d2(0x148)])throw new Error('Could\x20not\x20find\x20D2\x20player\x20documents');const _0x48836b=_0x3acac0[_0x1699d2(0x13d)][0x0]['id'],_0x50eaff=_0x3366f7[_0x1699d2(0x13d)][0x0]['id'];return await updateEloRatingsD2(_0x48836b,_0x50eaff,_0x324b90),console[_0x1699d2(0x128)](_0x1699d2(0x139)),!![];}catch(_0x14c1ca){console[_0x1699d2(0x14e)](_0x1699d2(0x14d),_0x14c1ca);throw _0x14c1ca;}}
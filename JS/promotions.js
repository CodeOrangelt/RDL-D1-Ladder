const a43_0x5a4b6a=a43_0x1287;(function(_0x415cad,_0x37a8af){const _0x223e51=a43_0x1287,_0x29c884=_0x415cad();while(!![]){try{const _0x21d8b4=parseInt(_0x223e51(0x15d))/0x1+-parseInt(_0x223e51(0x124))/0x2*(-parseInt(_0x223e51(0x164))/0x3)+parseInt(_0x223e51(0x171))/0x4*(-parseInt(_0x223e51(0x154))/0x5)+parseInt(_0x223e51(0x1a9))/0x6+-parseInt(_0x223e51(0x1a3))/0x7*(-parseInt(_0x223e51(0x11e))/0x8)+-parseInt(_0x223e51(0x133))/0x9*(parseInt(_0x223e51(0x135))/0xa)+parseInt(_0x223e51(0x146))/0xb*(-parseInt(_0x223e51(0x16e))/0xc);if(_0x21d8b4===_0x37a8af)break;else _0x29c884['push'](_0x29c884['shift']());}catch(_0x3218b8){_0x29c884['push'](_0x29c884['shift']());}}}(a43_0x33d8,0xa5b41));const a43_0x1668e0=(function(){let _0x2800c7=!![];return function(_0x54cc3f,_0x2597da){const _0x4feb0d=_0x2800c7?function(){const _0x184218=a43_0x1287;if(_0x2597da){const _0x426aa=_0x2597da[_0x184218(0x1b9)](_0x54cc3f,arguments);return _0x2597da=null,_0x426aa;}}:function(){};return _0x2800c7=![],_0x4feb0d;};}()),a43_0x2dbae=a43_0x1668e0(this,function(){const _0x5022cc=a43_0x1287;return a43_0x2dbae['toString']()[_0x5022cc(0x184)](_0x5022cc(0x191))[_0x5022cc(0x158)]()[_0x5022cc(0x142)](a43_0x2dbae)['search'](_0x5022cc(0x191));});a43_0x2dbae();const a43_0x3bda44=(function(){let _0x282a02=!![];return function(_0x2dbc3a,_0xe8d8b6){const _0x4a6753=_0x282a02?function(){const _0x14f079=a43_0x1287;if(_0xe8d8b6){const _0x1cc5fc=_0xe8d8b6[_0x14f079(0x1b9)](_0x2dbc3a,arguments);return _0xe8d8b6=null,_0x1cc5fc;}}:function(){};return _0x282a02=![],_0x4a6753;};}()),a43_0x4fdfcd=a43_0x3bda44(this,function(){const _0x300d59=a43_0x1287;let _0x4fb6da;try{const _0x25674c=Function(_0x300d59(0x13a)+_0x300d59(0x1a0)+');');_0x4fb6da=_0x25674c();}catch(_0x587e07){_0x4fb6da=window;}const _0x110c0f=_0x4fb6da['console']=_0x4fb6da[_0x300d59(0x134)]||{},_0x57e822=[_0x300d59(0x12d),'warn',_0x300d59(0x1a2),_0x300d59(0x10f),_0x300d59(0x14d),_0x300d59(0x12a),_0x300d59(0x168)];for(let _0x43b43f=0x0;_0x43b43f<_0x57e822[_0x300d59(0x165)];_0x43b43f++){const _0x580775=a43_0x3bda44[_0x300d59(0x142)]['prototype'][_0x300d59(0x193)](a43_0x3bda44),_0x5afa12=_0x57e822[_0x43b43f],_0x13e437=_0x110c0f[_0x5afa12]||_0x580775;_0x580775['__proto__']=a43_0x3bda44[_0x300d59(0x193)](a43_0x3bda44),_0x580775['toString']=_0x13e437[_0x300d59(0x158)][_0x300d59(0x193)](_0x13e437),_0x110c0f[_0x5afa12]=_0x580775;}});a43_0x4fdfcd();import{collection,doc,query,where,orderBy,limit,getDocs,addDoc,getDoc,serverTimestamp,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{auth,db}from'./firebase-config.js';class PromotionManager{constructor(){const _0x25c8e8=a43_0x1287;this['DISPLAY_HOURS']=0x18,this[_0x25c8e8(0x115)]=[{'threshold':0x578,'name':_0x25c8e8(0x1ae),'color':_0x25c8e8(0x1ad)},{'threshold':0x640,'name':_0x25c8e8(0x19c),'color':_0x25c8e8(0x122)},{'threshold':0x708,'name':_0x25c8e8(0x175),'color':_0x25c8e8(0x1a4)},{'threshold':0x834,'name':_0x25c8e8(0x10a),'color':_0x25c8e8(0x1a1)}],this[_0x25c8e8(0x1a8)]=null,this[_0x25c8e8(0x160)]=0x0,this[_0x25c8e8(0x19d)]=0xea60,this[_0x25c8e8(0x186)]=null,this[_0x25c8e8(0x153)]={};}[a43_0x5a4b6a(0x178)](){const _0x5f5b81=a43_0x5a4b6a;this[_0x5f5b81(0x1a8)]=document[_0x5f5b81(0x10c)](_0x5f5b81(0x11a));if(!this[_0x5f5b81(0x1a8)]){console[_0x5f5b81(0x10f)](_0x5f5b81(0x1b5));return;}this[_0x5f5b81(0x129)]();const _0x2c4b95='promotions_checked_'+new Date()[_0x5f5b81(0x17c)](),_0x355d4a=sessionStorage[_0x5f5b81(0x10b)](_0x2c4b95);!_0x355d4a&&(this[_0x5f5b81(0x10d)](),sessionStorage[_0x5f5b81(0x14e)](_0x2c4b95,_0x5f5b81(0x1b1))),document['addEventListener']('visibilitychange',()=>{const _0x177086=_0x5f5b81;document['visibilityState']===_0x177086(0x148)&&!sessionStorage[_0x177086(0x10b)](_0x2c4b95)&&(this[_0x177086(0x10d)](),sessionStorage[_0x177086(0x14e)](_0x2c4b95,_0x177086(0x1b1)));}),window[_0x5f5b81(0x10e)]('beforeunload',()=>{const _0x35909d=_0x5f5b81;this['pollingInterval']&&clearInterval(this[_0x35909d(0x186)]);});}[a43_0x5a4b6a(0x129)](){const _0x3e1835=a43_0x5a4b6a;this[_0x3e1835(0x1a8)][_0x3e1835(0x125)]='',this[_0x3e1835(0x1a8)][_0x3e1835(0x194)][_0x3e1835(0x105)]=_0x3e1835(0x179);}async[a43_0x5a4b6a(0x10d)](){const _0x18c910=a43_0x5a4b6a;try{const _0x6ecf10=Date[_0x18c910(0x107)]();if(_0x6ecf10-this[_0x18c910(0x160)]<this['fetchInterval'])return;this[_0x18c910(0x160)]=_0x6ecf10;const _0x3a1886=collection(db,_0x18c910(0x147)),_0x3c37fc=query(_0x3a1886,where(_0x18c910(0x1bb),'in',[_0x18c910(0x106),_0x18c910(0x188)]),orderBy(_0x18c910(0x113),_0x18c910(0x16c)),limit(0x14)),_0xbf07d1=await getDocs(_0x3c37fc),_0x3d5ce6=[];_0xbf07d1[_0x18c910(0x17b)](_0x33fc18=>{const _0x4d3360=_0x18c910,_0x1d6a79={'id':_0x33fc18['id'],..._0x33fc18[_0x4d3360(0x141)]()};this[_0x4d3360(0x119)](_0x33fc18['id'])&&this[_0x4d3360(0x1c1)](_0x1d6a79)&&_0x3d5ce6['push'](_0x1d6a79);}),_0x3d5ce6[_0x18c910(0x165)]>0x0&&await this[_0x18c910(0x112)](_0x3d5ce6);}catch(_0x2c81f5){console[_0x18c910(0x10f)](_0x18c910(0x16f),_0x2c81f5);}}async[a43_0x5a4b6a(0x112)](_0x359796){const _0x158f5a=a43_0x5a4b6a;if(_0x359796['length']===0x0)return;_0x359796['sort']((_0x116629,_0x4a44ef)=>{const _0x14eb62=a43_0x1287,_0x881fe0=_0x116629['timestamp']?.['toMillis']?.()||_0x116629['timestamp']?.['seconds']*0x3e8||0x0,_0xfeeaeb=_0x4a44ef['timestamp']?.[_0x14eb62(0x166)]?.()||_0x4a44ef['timestamp']?.['seconds']*0x3e8||0x0;return _0xfeeaeb-_0x881fe0;});const _0x5ad110=this[_0x158f5a(0x1a8)]['children']['length'],_0x57c1ce=0x3-_0x5ad110;if(_0x57c1ce<=0x0)return;const _0x39167d=_0x359796[_0x158f5a(0x13d)](0x0,_0x57c1ce);for(let _0x3c25aa=0x0;_0x3c25aa<_0x39167d[_0x158f5a(0x165)];_0x3c25aa++){const _0xf74bd6=_0x39167d[_0x3c25aa],_0x328bed=auth['currentUser'];try{setTimeout(()=>{const _0x362fc6=_0x158f5a;this[_0x362fc6(0x187)](_0xf74bd6);},_0x3c25aa*0x3e8),_0x328bed&&_0xf74bd6[_0x158f5a(0x12e)]===_0x328bed['displayName']&&this[_0x158f5a(0x1b8)](_0xf74bd6[_0x158f5a(0x1bb)],_0xf74bd6[_0x158f5a(0x159)]);}catch(_0xb4820b){console['error'](_0x158f5a(0x150),_0xb4820b);}}}['shouldShowPromotion'](_0x33abd6){const _0x5f066e=a43_0x5a4b6a;try{const _0x4958b6=_0x5f066e(0x1b4)+_0x33abd6,_0x30a1c6=localStorage[_0x5f066e(0x10b)](_0x4958b6);if(_0x30a1c6){let _0x51dd14;try{_0x51dd14=JSON['parse'](_0x30a1c6);}catch(_0xe8d3c7){return console[_0x5f066e(0x1ac)]('Invalid\x20storage\x20format\x20for\x20'+_0x4958b6+_0x5f066e(0x14c)),!![];}if(_0x51dd14[_0x5f066e(0x111)]===!![])return console[_0x5f066e(0x12d)]('Promotion\x20'+_0x33abd6+_0x5f066e(0x145)),![];const _0x35cd86=Date[_0x5f066e(0x107)]();if(_0x51dd14[_0x5f066e(0x19a)]&&_0x35cd86-_0x51dd14['timestamp']<this[_0x5f066e(0x180)]*0x3c*0x3c*0x3e8)return console[_0x5f066e(0x12d)]('Promotion\x20'+_0x33abd6+'\x20was\x20dismissed\x20by\x20user\x20within\x20last\x20'+this['DISPLAY_HOURS']+_0x5f066e(0x157)),![];if(_0x51dd14[_0x5f066e(0x149)]&&_0x35cd86-_0x51dd14[_0x5f066e(0x113)]<0x4*0x3c*0x3c*0x3e8)return console[_0x5f066e(0x12d)](_0x5f066e(0x15e)+_0x33abd6+'\x20was\x20auto-dismissed\x20within\x20last\x204\x20hours'),![];}return!![];}catch(_0x5d0376){return console[_0x5f066e(0x10f)]('Error\x20checking\x20promotion\x20visibility:',_0x5d0376),![];}}[a43_0x5a4b6a(0x117)](_0x2a411c){const _0x4a3c43=a43_0x5a4b6a;try{const _0x2c1e46='promotion_'+_0x2a411c;localStorage[_0x4a3c43(0x14e)](_0x2c1e46,JSON[_0x4a3c43(0x116)]({'timestamp':Date[_0x4a3c43(0x107)](),'ignored':!![]}));}catch(_0x1a8247){console[_0x4a3c43(0x10f)](_0x4a3c43(0x12f),_0x1a8247);}}[a43_0x5a4b6a(0x187)](_0x13834d){this['resolveUserId'](_0x13834d)['then'](_0x4caaa4=>{const _0x144654=a43_0x1287,_0x305ade=_0x144654(0x1b4)+_0x13834d['id'],_0x33d48e=localStorage['getItem'](_0x305ade);if(_0x33d48e)try{const _0x5633e3=JSON[_0x144654(0x110)](_0x33d48e);if(_0x5633e3[_0x144654(0x111)]===!![]){console[_0x144654(0x12d)](_0x144654(0x185)+_0x13834d['id']);return;}}catch(_0x1aa95a){}localStorage['setItem'](_0x305ade,JSON[_0x144654(0x116)]({'timestamp':Date[_0x144654(0x107)](),'ignored':![],'userDismissed':![],'systemDismissed':![],'seenAt':Date['now']()})),this[_0x144654(0x1a8)][_0x144654(0x194)][_0x144654(0x105)]=_0x144654(0x17e);while(this[_0x144654(0x1a8)][_0x144654(0x13c)][_0x144654(0x165)]>=0x3){this['bannerContainer'][_0x144654(0x163)](this[_0x144654(0x1a8)]['firstChild']);}const _0x455713=document['createElement'](_0x144654(0x189));_0x455713[_0x144654(0x120)]=_0x144654(0x177),_0x455713[_0x144654(0x128)](_0x144654(0x1ba),_0x4caaa4[_0x144654(0x159)]),_0x455713[_0x144654(0x128)](_0x144654(0x18c),_0x4caaa4['id']);const _0x3704b1=document[_0x144654(0x1c2)](_0x144654(0x189));_0x3704b1[_0x144654(0x120)]=_0x144654(0x1b2);const _0x5ce93f=_0x4caaa4[_0x144654(0x102)]||_0x4caaa4[_0x144654(0x12e)]||_0x4caaa4[_0x144654(0x192)]||_0x4caaa4['playerUsername']||_0x4caaa4[_0x144654(0x11b)]||_0x144654(0x1a7),_0x192b50=_0x4caaa4['type']===_0x144654(0x106)?_0x5ce93f+_0x144654(0x13f):_0x5ce93f+_0x144654(0x104);_0x3704b1['innerHTML']=_0x192b50+'\x20<span\x20class=\x22rank-text\x22>'+_0x4caaa4[_0x144654(0x159)]+_0x144654(0x155);const _0x75ad4e=document[_0x144654(0x1c2)]('div');_0x75ad4e[_0x144654(0x120)]=_0x144654(0x15b);const _0x89efef=document[_0x144654(0x1c2)](_0x144654(0x19e));_0x89efef[_0x144654(0x120)]=_0x144654(0x17d),_0x89efef['innerHTML']=_0x144654(0x138),_0x89efef[_0x144654(0x1bc)]=_0x144654(0x167);const _0x1dc753=document['createElement'](_0x144654(0x19e));_0x1dc753[_0x144654(0x120)]=_0x144654(0x109),_0x1dc753['textContent']=_0x144654(0x13e),_0x1dc753['title']=_0x144654(0x132),_0x75ad4e[_0x144654(0x1a5)](_0x1dc753),_0x75ad4e[_0x144654(0x1a5)](_0x89efef),_0x455713[_0x144654(0x1a5)](_0x3704b1),_0x455713[_0x144654(0x1a5)](_0x75ad4e),this[_0x144654(0x1a8)][_0x144654(0x1a5)](_0x455713),void _0x455713[_0x144654(0x14a)],setTimeout(()=>{const _0x507570=_0x144654;_0x455713[_0x507570(0x16a)][_0x507570(0x1a6)](_0x507570(0x182));},0x32),_0x89efef[_0x144654(0x10e)](_0x144654(0x103),()=>{const _0x177752=_0x144654;localStorage[_0x177752(0x14e)](_0x305ade,JSON[_0x177752(0x116)]({'timestamp':Date['now'](),'ignored':![],'userDismissed':!![],'systemDismissed':![]})),_0x455713['classList'][_0x177752(0x15c)](_0x177752(0x182)),_0x455713[_0x177752(0x16a)]['add']('dismissing'),setTimeout(()=>{const _0x30b176=_0x177752;_0x455713[_0x30b176(0x17a)]&&(_0x455713[_0x30b176(0x15c)](),this[_0x30b176(0x1a8)][_0x30b176(0x13c)]['length']===0x0&&(this['bannerContainer']['style'][_0x30b176(0x105)]=_0x30b176(0x179)));},0x1f4);}),_0x1dc753['addEventListener']('click',()=>{const _0x48b66f=_0x144654;localStorage['setItem'](_0x305ade,JSON[_0x48b66f(0x116)]({'timestamp':Date[_0x48b66f(0x107)](),'ignored':!![],'userDismissed':!![],'systemDismissed':![]})),_0x455713[_0x48b66f(0x16a)][_0x48b66f(0x15c)](_0x48b66f(0x182)),_0x455713[_0x48b66f(0x16a)][_0x48b66f(0x1a6)](_0x48b66f(0x123)),setTimeout(()=>{const _0x1a64e4=_0x48b66f;_0x455713[_0x1a64e4(0x17a)]&&(_0x455713[_0x1a64e4(0x15c)](),this['bannerContainer'][_0x1a64e4(0x13c)][_0x1a64e4(0x165)]===0x0&&(this[_0x1a64e4(0x1a8)][_0x1a64e4(0x194)][_0x1a64e4(0x105)]=_0x1a64e4(0x179)));},0x1f4);}),setTimeout(()=>{const _0x34e798=_0x144654;_0x455713['parentNode']&&(_0x455713[_0x34e798(0x16a)][_0x34e798(0x15c)](_0x34e798(0x182)),_0x455713[_0x34e798(0x16a)][_0x34e798(0x1a6)](_0x34e798(0x123)),localStorage[_0x34e798(0x14e)](_0x305ade,JSON[_0x34e798(0x116)]({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':!![]})),setTimeout(()=>{const _0x44a2f2=_0x34e798;_0x455713[_0x44a2f2(0x17a)]&&(_0x455713[_0x44a2f2(0x15c)](),this[_0x44a2f2(0x1a8)][_0x44a2f2(0x13c)]['length']===0x0&&(this['bannerContainer'][_0x44a2f2(0x194)][_0x44a2f2(0x105)]=_0x44a2f2(0x179)));},0x1f4));},0x3a98);});}async['resolveUserId'](_0x4097e1){const _0x235174=a43_0x5a4b6a,_0x1b0206={..._0x4097e1},_0xdd9c19=[_0x4097e1[_0x235174(0x12e)],_0x4097e1[_0x235174(0x192)],_0x4097e1['playerUsername'],_0x4097e1[_0x235174(0x11b)]],_0x2a03a2=_0xdd9c19[_0x235174(0x131)](_0x49fc7f=>_0x49fc7f&&typeof _0x49fc7f===_0x235174(0x196)&&!_0x49fc7f[_0x235174(0x172)](_0x235174(0x1c0))&&!/^[a-zA-Z0-9]{20,}$/[_0x235174(0x14f)](_0x49fc7f));if(_0x2a03a2)return _0x1b0206;let _0x5d7185=null;if(_0x4097e1[_0x235174(0x1c3)])_0x5d7185=_0x4097e1[_0x235174(0x1c3)];else _0x4097e1[_0x235174(0x12e)]&&/^[A-Za-z0-9]{20,}$/['test'](_0x4097e1[_0x235174(0x12e)])&&(_0x5d7185=_0x4097e1['player']);if(!_0x5d7185)return _0x1b0206;try{const _0x36f173=await getDoc(doc(db,_0x235174(0x12b),_0x5d7185));if(_0x36f173[_0x235174(0x15a)]()){const _0x33215d=_0x36f173['data']();if(_0x33215d[_0x235174(0x192)])return _0x1b0206[_0x235174(0x102)]=_0x33215d[_0x235174(0x192)],_0x1b0206;}const _0x380b75=await getDocs(query(collection(db,_0x235174(0x11d)),where(_0x235174(0x143),'==',_0x5d7185),orderBy(_0x235174(0x15f),'desc'),limit(0x1)));if(!_0x380b75[_0x235174(0x1bf)]){const _0x52bacd=_0x380b75[_0x235174(0x1be)][0x0][_0x235174(0x141)]();if(_0x52bacd[_0x235174(0x1b6)])return _0x1b0206[_0x235174(0x102)]=_0x52bacd[_0x235174(0x1b6)],_0x1b0206;}const _0x219729=await getDocs(query(collection(db,'approvedMatches'),where('loserId','==',_0x5d7185),orderBy(_0x235174(0x15f),'desc'),limit(0x1)));if(!_0x219729[_0x235174(0x1bf)]){const _0x107ccd=_0x219729['docs'][0x0]['data']();if(_0x107ccd['loserUsername'])return _0x1b0206['resolvedName']=_0x107ccd[_0x235174(0x169)],console[_0x235174(0x12d)](_0x235174(0x11f)+_0x5d7185+_0x235174(0x151)+_0x107ccd[_0x235174(0x169)]+'\x20(loser)'),_0x1b0206;}}catch(_0x136ebf){console[_0x235174(0x10f)](_0x235174(0x139),_0x136ebf);}return console[_0x235174(0x1ac)](_0x235174(0x156)+_0x5d7185),_0x1b0206;}['showRankChangeLightbox'](_0x2f786b,_0x2ea49f){const _0x426a35=a43_0x5a4b6a;let _0x5528c6=document[_0x426a35(0x10c)](_0x426a35(0x1ab));!_0x5528c6&&(_0x5528c6=document[_0x426a35(0x1c2)](_0x426a35(0x189)),_0x5528c6['id']=_0x426a35(0x1ab),_0x5528c6['className']=_0x426a35(0x18e)+_0x2f786b,document[_0x426a35(0x17f)][_0x426a35(0x1a5)](_0x5528c6));const _0x2952b6=_0x2f786b==='promotion'?'Congratulations!':_0x426a35(0x174),_0x5d79ef=_0x2f786b==='promotion'?_0x426a35(0x181):'You\x27ve\x20been\x20demoted\x20to';_0x5528c6[_0x426a35(0x125)]=_0x426a35(0x13b)+_0x2952b6+_0x426a35(0x114)+_0x5d79ef+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22rank-name\x22>'+_0x2ea49f+_0x426a35(0x118),_0x5528c6[_0x426a35(0x194)][_0x426a35(0x105)]=_0x426a35(0x199),document[_0x426a35(0x10c)](_0x426a35(0x108))[_0x426a35(0x10e)](_0x426a35(0x103),()=>{const _0x233b16=_0x426a35;_0x5528c6[_0x233b16(0x194)][_0x233b16(0x105)]='none';}),_0x5528c6[_0x426a35(0x10e)](_0x426a35(0x103),_0x2b91a0=>{const _0x203399=_0x426a35;_0x2b91a0[_0x203399(0x18a)]===_0x5528c6&&(_0x5528c6[_0x203399(0x194)][_0x203399(0x105)]='none');});}async['checkAndRecordPromotion'](_0x4591bd,_0x519f59,_0x4b1645,_0x4ef965={}){const _0xc25a84=a43_0x5a4b6a;try{if(_0x519f59===_0x4b1645||!_0x4591bd)return null;const _0x1268af=_0x4ef965[_0xc25a84(0x170)]||_0xc25a84(0x130),_0x3baa77=_0x4ef965[_0xc25a84(0x16b)]||null,_0x4e0731=_0x4ef965[_0xc25a84(0x1bd)]||null;console[_0xc25a84(0x12d)](_0xc25a84(0x12c)+_0x4b1645+_0xc25a84(0x197)+_0x519f59+'\x20(source:\x20'+_0x1268af+')');let _0x25590a=null,_0x1bd3c6=null;try{const _0x2bdd98=await getDoc(doc(db,_0xc25a84(0x12b),_0x4591bd));if(_0x2bdd98['exists']()){const _0x3768f1=_0x2bdd98[_0xc25a84(0x141)]();_0x25590a=_0x3768f1['username']||_0x3768f1[_0xc25a84(0x11b)]||null,_0x1bd3c6=_0x3768f1[_0xc25a84(0x11b)]||_0x3768f1['username']||null;}!_0x25590a&&_0x4ef965[_0xc25a84(0x192)]&&(_0x25590a=_0x4ef965[_0xc25a84(0x192)],_0x1bd3c6=_0x4ef965[_0xc25a84(0x192)]);!_0x25590a&&auth[_0xc25a84(0x183)]&&(_0x25590a=auth[_0xc25a84(0x183)][_0xc25a84(0x11b)]||auth[_0xc25a84(0x183)][_0xc25a84(0x152)][_0xc25a84(0x137)]('@')[0x0],_0x1bd3c6=auth['currentUser'][_0xc25a84(0x11b)]||null);if(!_0x25590a){const _0x2e6051=query(collection(db,_0xc25a84(0x11d)),where(_0xc25a84(0x143),'==',_0x4591bd),limit(0x1)),_0x88878e=await getDocs(_0x2e6051);if(!_0x88878e[_0xc25a84(0x1bf)])_0x25590a=_0x88878e[_0xc25a84(0x1be)][0x0][_0xc25a84(0x141)]()[_0xc25a84(0x1b6)]||_0xc25a84(0x190),_0x1bd3c6=_0x25590a;else{const _0x14808d=query(collection(db,'approvedMatches'),where(_0xc25a84(0x18f),'==',_0x4591bd),limit(0x1)),_0x1a707f=await getDocs(_0x14808d);!_0x1a707f[_0xc25a84(0x1bf)]&&(_0x25590a=_0x1a707f[0x0][_0xc25a84(0x141)]()[_0xc25a84(0x169)]||_0xc25a84(0x190),_0x1bd3c6=_0x25590a);}}}catch(_0x23bf97){console[_0xc25a84(0x10f)](_0xc25a84(0x19f),_0x23bf97);}!_0x25590a&&(console['warn'](_0xc25a84(0x1b7),_0x4591bd),_0x25590a=_0xc25a84(0x1a7),_0x1bd3c6=_0xc25a84(0x190));const _0x27ad87=this[_0xc25a84(0x195)](_0x4b1645),_0x393951=this['getRankName'](_0x519f59);if(_0x27ad87!==_0x393951){const _0xe66303=_0x519f59>_0x4b1645,_0x3947c9=_0xe66303?_0xc25a84(0x106):_0xc25a84(0x188),_0x37f189=_0x393951;console[_0xc25a84(0x12d)]('Recording\x20'+_0x3947c9+'\x20for\x20'+_0x25590a+':\x20'+_0x4b1645+'\x20('+_0x27ad87+_0xc25a84(0x136)+_0x519f59+'\x20('+_0x393951+')');try{const _0x2b6711={'player':_0x25590a,'playerUsername':_0x25590a,'username':_0x25590a,'displayName':_0x1bd3c6,'userId':_0x4591bd,'type':_0x3947c9,'rankAchieved':_0x37f189,'timestamp':serverTimestamp(),'previousElo':_0x4b1645,'newElo':_0x519f59,'change':_0x519f59-_0x4b1645,'previousRank':_0x27ad87,'newRank':_0x393951,'source':_0x1268af};if(_0x1268af==='match'&&_0x3baa77)_0x2b6711[_0xc25a84(0x16b)]=_0x3baa77;else _0x1268af==='admin'&&_0x4e0731?(_0x2b6711[_0xc25a84(0x14b)]=_0x4e0731,_0x2b6711[_0xc25a84(0x11c)]=![]):_0x2b6711['isAutomatic']=!![];const _0x59e46e=writeBatch(db),_0x3bc9fb=doc(collection(db,'eloHistory')),_0x148764=doc(collection(db,'promotionHistory'));return _0x59e46e[_0xc25a84(0x19b)](_0x3bc9fb,_0x2b6711),_0x59e46e[_0xc25a84(0x19b)](_0x148764,_0x2b6711),await _0x59e46e[_0xc25a84(0x18d)](),await this['sendPromotionNotification'](_0x4591bd,_0x25590a,_0x4b1645,_0x519f59,_0x27ad87,_0x393951,_0x3947c9,{'displayName':_0x1bd3c6,'source':_0x1268af,'matchId':_0x3baa77,'ladder':_0x4ef965[_0xc25a84(0x126)]||'D1'}),console[_0xc25a84(0x12d)](_0xc25a84(0x173)+_0x3947c9+_0xc25a84(0x101)+_0x25590a+'\x20to\x20'+_0x37f189),_0x37f189;}catch(_0x1ee1b1){console[_0xc25a84(0x10f)](_0xc25a84(0x121),_0x1ee1b1);try{return await addDoc(collection(db,_0xc25a84(0x147)),{'player':_0x25590a,'playerUsername':_0x25590a,'username':_0x25590a,'displayName':_0x1bd3c6,'userId':_0x4591bd,'type':_0x3947c9,'rankAchieved':_0x37f189,'timestamp':serverTimestamp(),'previousElo':_0x4b1645,'newElo':_0x519f59,'change':_0x519f59-_0x4b1645,'previousRank':_0x27ad87,'source':_0x1268af,'isAutomatic':_0x1268af!==_0xc25a84(0x1b0)}),await this[_0xc25a84(0x198)](_0x4591bd,_0x25590a,_0x4b1645,_0x519f59,_0x27ad87,_0x393951,_0x3947c9,{'displayName':_0x1bd3c6,'source':_0x1268af,'matchId':_0x3baa77,'ladder':_0x4ef965['ladder']||'D1'}),_0x37f189;}catch(_0x3ed828){return console[_0xc25a84(0x10f)]('Fallback\x20write\x20failed:',_0x3ed828),null;}}}return null;}catch(_0x1b08c4){return console['error'](_0xc25a84(0x144),_0x1b08c4),null;}}[a43_0x5a4b6a(0x195)](_0xd191bc){const _0x25d11d=a43_0x5a4b6a;for(let _0xe2ca12=this[_0x25d11d(0x115)][_0x25d11d(0x165)]-0x1;_0xe2ca12>=0x0;_0xe2ca12--){if(_0xd191bc>=this[_0x25d11d(0x115)][_0xe2ca12]['threshold'])return this[_0x25d11d(0x115)][_0xe2ca12]['name'];}return _0x25d11d(0x161);}[a43_0x5a4b6a(0x1aa)](){const _0x4a6cc6=a43_0x5a4b6a;this[_0x4a6cc6(0x186)]&&clearInterval(this[_0x4a6cc6(0x186)]);}[a43_0x5a4b6a(0x1c1)](_0x24a6fe){const _0x2f4c4b=a43_0x5a4b6a;if(_0x24a6fe[_0x2f4c4b(0x113)]){const _0x4d5b4e=_0x24a6fe[_0x2f4c4b(0x113)][_0x2f4c4b(0x1af)]*0x3e8,_0x51cdce=Date[_0x2f4c4b(0x107)](),_0x2ecd59=(_0x51cdce-_0x4d5b4e)/(0x3e8*0x3c*0x3c);if(_0x2ecd59>0x18)return![];}if(_0x24a6fe['previousRank']&&_0x24a6fe[_0x2f4c4b(0x18b)]&&_0x24a6fe[_0x2f4c4b(0x127)]!==_0x24a6fe[_0x2f4c4b(0x18b)])return!![];return![];}async[a43_0x5a4b6a(0x198)](_0x24f9dc,_0x57af29,_0x4149df,_0x4460a8,_0x27cbda,_0x267116,_0x4d6cc5,_0x42cbd1={}){const _0x3d1197=a43_0x5a4b6a;try{console[_0x3d1197(0x12d)]('STARTING\x20notification\x20for\x20'+_0x57af29+_0x3d1197(0x1b3)+_0x4d6cc5);const _0x4065b1={'userId':_0x24f9dc,'username':_0x57af29,'displayName':_0x42cbd1['displayName']||_0x57af29,'oldElo':parseInt(_0x4149df),'newElo':parseInt(_0x4460a8),'eloDifference':parseInt(_0x4460a8)-parseInt(_0x4149df),'oldRank':_0x27cbda,'newRank':_0x267116,'type':_0x4d6cc5,'timestamp':serverTimestamp(),'processed':![],'source':_0x42cbd1['source']||_0x3d1197(0x130),'matchId':_0x42cbd1[_0x3d1197(0x16b)]||null,'ladder':_0x42cbd1[_0x3d1197(0x126)]||'D1','adminUser':_0x42cbd1[_0x3d1197(0x1bd)]||null};console['log'](_0x3d1197(0x16d),_0x4065b1);const _0x400221=await addDoc(collection(db,'promotionNotifications'),_0x4065b1);return console[_0x3d1197(0x12d)](_0x3d1197(0x140)+_0x400221['id']),!![];}catch(_0x471ec7){return console['error']('Error\x20sending\x20Discord\x20notification:',_0x471ec7),![];}}}export const promotionManager=new PromotionManager();function a43_0x1287(_0x44d423,_0x425280){const _0xe0b80a=a43_0x33d8();return a43_0x1287=function(_0x4fdfcd,_0x3bda44){_0x4fdfcd=_0x4fdfcd-0x101;let _0x2837c7=_0xe0b80a[_0x4fdfcd];return _0x2837c7;},a43_0x1287(_0x44d423,_0x425280);}document[a43_0x5a4b6a(0x10e)](a43_0x5a4b6a(0x176),()=>{const _0x342a00=a43_0x5a4b6a;promotionManager[_0x342a00(0x178)]();});export const initializePromotionTracker=()=>promotionManager[a43_0x5a4b6a(0x178)]();function a43_0x33d8(){const _0x2d34e0=[',\x20treating\x20as\x20new','exception','setItem','test','Error\x20processing\x20rank\x20change:','\x20to\x20','email','usernameCache','10PiAhWo','</span>','Failed\x20to\x20resolve\x20user\x20ID:\x20','\x20hours','toString','rankAchieved','exists','banner-actions','remove','1331322jxfhFq','Promotion\x20','date','lastFetchTime','Unranked','checkAndRecordPromotion','removeChild','1039242YQCDMl','length','toMillis','Dismiss','trace','loserUsername','classList','matchId','desc','Creating\x20Discord\x20notification:','142668ouQNGZ','Error\x20fetching\x20promotions:','source','22564qIWcIl','includes','Successfully\x20recorded\x20','Rank\x20Update','Gold','DOMContentLoaded','promotion-banner','initialize','none','parentNode','forEach','toDateString','dismiss-btn','block','body','DISPLAY_HOURS','You\x27ve\x20been\x20promoted\x20to','new-rank-change','currentUser','search','Skipping\x20ignored\x20promotion:\x20','pollingInterval','showRankChangeBanner','demotion','div','target','newRank','data-id','commit','rank-change-modal\x20','loserId','Unknown\x20Player','(((.+)+)+)+$','username','bind','style','getRankName','string','\x20→\x20','sendPromotionNotification','flex','userDismissed','set','Silver','fetchInterval','button','Error\x20resolving\x20username:','{}.constructor(\x22return\x20this\x22)(\x20)','#50C878','info','8766961MCEHmL','#FFD700','appendChild','add','A\x20player','bannerContainer','2076630ZdVLph','cleanup','rankChangeModal','warn','#CD7F32','Bronze','seconds','admin','true','promotion-details','\x27s\x20','promotion_','Promotion\x20banner\x20container\x20not\x20found','winnerUsername','Could\x20not\x20resolve\x20username\x20for\x20userId:','showRankChangeLightbox','apply','data-rank','type','title','adminUser','docs','empty','ID:','isNewRankChange','createElement','userId','\x20for\x20','resolvedName','click','\x20was\x20demoted\x20to','display','promotion','now','rank-change-ok-btn','ignore-btn','Emerald','getItem','getElementById','fetchRecentPromotions','addEventListener','error','parse','ignored','processRankChanges','timestamp','</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>','RANKS','stringify','ignorePromotion','</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22rank-change-button\x22\x20id=\x22rank-change-ok-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Got\x20it!\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','shouldShowPromotion','promotion-banner-container','displayName','isAutomatic','approvedMatches','8vAbpCD','Resolved\x20','className','Error\x20writing\x20promotion\x20records:','#C0C0C0','dismissing','2tVtWle','innerHTML','ladder','previousRank','setAttribute','setupBannerContainer','table','players','Processing\x20potential\x20rank\x20change:\x20','log','player','Error\x20saving\x20promotion\x20preference:','automatic','some','Never\x20show\x20this\x20promotion\x20again','27AjSiOK','console','3429340WmzXVf',')\x20→\x20','split','&times;','Error\x20resolving\x20user\x20ID:','return\x20(function()\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rank-change-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2\x20class=\x22rank-change-title\x22>','children','slice','Don\x27t\x20show\x20again','\x20was\x20promoted\x20to','Discord\x20notification\x20sent\x20successfully\x20with\x20ID:\x20','data','constructor','winnerId','Error\x20in\x20promotion/demotion\x20recording:','\x20is\x20permanently\x20ignored','1441tFjZrR','eloHistory','visible','systemDismissed','offsetWidth','modifiedBy'];a43_0x33d8=function(){return _0x2d34e0;};return a43_0x33d8();}export const checkAndRecordPromotion=(_0x2db63f,_0x4722e2,_0x44b4b0,_0x116102)=>promotionManager[a43_0x5a4b6a(0x162)](_0x2db63f,_0x4722e2,_0x44b4b0,_0x116102);export const getRankName=_0x4224d6=>promotionManager[a43_0x5a4b6a(0x195)](_0x4224d6);
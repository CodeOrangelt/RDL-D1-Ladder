function a54_0x2271(_0x1b0265,_0x566ebd){const _0x185f79=a54_0x46ce();return a54_0x2271=function(_0x4abfc3,_0x1a38c9){_0x4abfc3=_0x4abfc3-0x122;let _0x46ce03=_0x185f79[_0x4abfc3];return _0x46ce03;},a54_0x2271(_0x1b0265,_0x566ebd);}const a54_0x4abfc3=(function(){let _0x281175=!![];return function(_0x3737e2,_0x302a01){const _0x56ee87=_0x281175?function(){if(_0x302a01){const _0x83fa11=_0x302a01['apply'](_0x3737e2,arguments);return _0x302a01=null,_0x83fa11;}}:function(){};return _0x281175=![],_0x56ee87;};}()),a54_0x185f79=a54_0x4abfc3(this,function(){const _0x4b42e0=a54_0x2271;let _0x26ff9b;try{const _0x19cf83=Function(_0x4b42e0(0x126)+_0x4b42e0(0x130)+');');_0x26ff9b=_0x19cf83();}catch(_0x3bb718){_0x26ff9b=window;}const _0x3dd1df=_0x26ff9b['console']=_0x26ff9b['console']||{},_0x23e4ae=['log','warn','info','error','exception','table','trace'];for(let _0x4756b2=0x0;_0x4756b2<_0x23e4ae['length'];_0x4756b2++){const _0x3cf902=a54_0x4abfc3['constructor']['prototype']['bind'](a54_0x4abfc3),_0x30f263=_0x23e4ae[_0x4756b2],_0x2f059a=_0x3dd1df[_0x30f263]||_0x3cf902;_0x3cf902['__proto__']=a54_0x4abfc3['bind'](a54_0x4abfc3),_0x3cf902['toString']=_0x2f059a['toString']['bind'](_0x2f059a),_0x3dd1df[_0x30f263]=_0x3cf902;}});a54_0x185f79();import{db}from'../firebase-config.js';import{collection,doc,getDoc,getDocs,query,limit,startAfter,where,onSnapshot}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const cache={'userProfiles':new Map(),'ladderPlayers':new Map(),'matchResults':new Map(),'eloHistory':new Map()},CACHE_EXPIRY={'userProfiles':0x5*0x3c*0x3e8,'ladderPlayers':0x2*0x3c*0x3e8,'matchResults':0x1*0x3c*0x3e8,'eloHistory':0x3*0x3c*0x3e8};export const userProfilesRef=collection(db,'userProfiles');export async function fetchPaginatedData(_0x1ecaba,_0x29bcc1=0xa,_0x11c493=null){const _0x587eb9=a54_0x2271;let _0xd34d01=query(_0x1ecaba,limit(_0x29bcc1));_0x11c493&&(_0xd34d01=query(_0xd34d01,startAfter(_0x11c493)));const _0x562b9a=await getDocs(_0xd34d01),_0x2f74e7=_0x562b9a['docs'][_0x562b9a['docs']['length']-0x1];return{'data':_0x562b9a['docs']['map'](_0x4ef058=>({'id':_0x4ef058['id'],..._0x4ef058[_0x587eb9(0x129)]()})),'lastVisible':_0x2f74e7,'hasMore':_0x562b9a['docs'][_0x587eb9(0x12f)]===_0x29bcc1};}export async function getUserProfile(_0x44b693){const _0x4058e1=a54_0x2271,_0x29956c=cache['userProfiles']['get'](_0x44b693);if(_0x29956c&&Date['now']()-_0x29956c['timestamp']<CACHE_EXPIRY[_0x4058e1(0x125)])return _0x29956c['data'];const _0x110b9c=await getDoc(doc(userProfilesRef,_0x44b693));if(_0x110b9c[_0x4058e1(0x12d)]()){const _0x3aa47e=_0x110b9c['data']();return cache[_0x4058e1(0x125)][_0x4058e1(0x123)](_0x44b693,{'data':_0x3aa47e,'timestamp':Date[_0x4058e1(0x127)]()}),_0x3aa47e;}return null;}function a54_0x46ce(){const _0x2923e7=['nonParticipants','set','division_','userProfiles','return\x20(function()\x20','now','docs','data','doc','eloHistory','username','exists','slice','length','{}.constructor(\x22return\x20this\x22)(\x20)','push','playerId'];a54_0x46ce=function(){return _0x2923e7;};return a54_0x46ce();}export async function getLadderData(_0xf572f6=0x1){const _0x6f081b=a54_0x2271,_0x486b23=_0x6f081b(0x124)+_0xf572f6,_0x5eebe7=cache['ladderPlayers']['get'](_0x486b23);if(_0x5eebe7&&Date[_0x6f081b(0x127)]()-_0x5eebe7['timestamp']<CACHE_EXPIRY['ladderPlayers'])return _0x5eebe7['data'];const _0x4ab51a=_0xf572f6===0x1?'players':'playersD'+_0xf572f6,_0x37426c=collection(db,_0x4ab51a),_0x532375=await getDocs(query(_0x37426c,limit(0x64))),_0x9aa022=_0x532375[_0x6f081b(0x128)]['map'](_0x461f61=>({'id':_0x461f61['id'],..._0x461f61[_0x6f081b(0x129)]()}));return cache['ladderPlayers']['set'](_0x486b23,{'data':_0x9aa022,'timestamp':Date['now']()}),_0x9aa022;}export async function getEloHistoryBatch(_0x33fd7c,_0x2fe70b=0x1){const _0x10a27e=a54_0x2271,_0x28337a=_0x2fe70b===0x1?'eloHistory':'eloHistoryD'+_0x2fe70b,_0x5a3ce1=collection(db,_0x28337a),_0x5e0dca={},_0x46e63c=[];_0x33fd7c['forEach'](_0x3c1504=>{const _0x325e8e=a54_0x2271,_0x2a7267=_0x3c1504+'_'+_0x2fe70b,_0x3ec8fa=cache[_0x325e8e(0x12b)]['get'](_0x2a7267);_0x3ec8fa&&Date[_0x325e8e(0x127)]()-_0x3ec8fa['timestamp']<CACHE_EXPIRY['eloHistory']?_0x5e0dca[_0x3c1504]=_0x3ec8fa['data']:_0x46e63c['push'](_0x3c1504);});const _0xe25ac2=0xa;for(let _0x3255a1=0x0;_0x3255a1<_0x46e63c['length'];_0x3255a1+=_0xe25ac2){const _0x46de4d=_0x46e63c[_0x10a27e(0x12e)](_0x3255a1,_0x3255a1+_0xe25ac2);if(_0x46de4d['length']>0x0)try{const _0x12d43c=query(_0x5a3ce1,where(_0x10a27e(0x132),'in',_0x46de4d),limit(0x64)),_0x4d14f9=await getDocs(_0x12d43c);_0x4d14f9[_0x10a27e(0x128)]['forEach'](_0x5b69d9=>{const _0x590744=_0x10a27e,_0x49555d=_0x5b69d9[_0x590744(0x129)](),_0x50ee08=_0x49555d['playerId'];if(!_0x5e0dca[_0x50ee08])_0x5e0dca[_0x50ee08]=[];_0x5e0dca[_0x50ee08][_0x590744(0x131)](_0x49555d);const _0x477e67=_0x50ee08+'_'+_0x2fe70b;cache['eloHistory']['set'](_0x477e67,{'data':_0x5e0dca[_0x50ee08],'timestamp':Date['now']()});});}catch(_0x31cbdd){console['error']('Error\x20fetching\x20batch\x20ELO\x20history:',_0x31cbdd);}}return _0x5e0dca;}let usernameCache=new Map(),usernameCacheTimestamp=Date['now']();export function setupEfficientListener(_0x1a1d0a,_0x573fda=[],_0x3135c4){const _0x32b889=collection(db,_0x1a1d0a),_0x3b5e64=query(_0x32b889,..._0x573fda),_0x1f50db=onSnapshot(_0x3b5e64,_0xa7d812=>{const _0x22e996=a54_0x2271,_0x3799ae=_0xa7d812['docChanges']()['map'](_0x2d8c9d=>({'type':_0x2d8c9d['type'],'id':_0x2d8c9d['doc']['id'],'data':_0x2d8c9d[_0x22e996(0x12a)]['data']()}));_0x3799ae[_0x22e996(0x12f)]>0x0&&_0x3135c4(_0x3799ae,_0xa7d812[_0x22e996(0x128)]);});return _0x1f50db;}export async function bulkResolveUsernames(_0x4a93c2){const _0x12a57f=a54_0x2271,_0x1fa7e3=new Map();if(!_0x4a93c2||_0x4a93c2['length']===0x0)return _0x1fa7e3;const _0xcab797=['players','playersD2','playersD3',_0x12a57f(0x122)];for(const _0xdb8de of _0xcab797){const _0x1f872=collection(db,_0xdb8de),_0x55d842=await getDocs(_0x1f872);_0x55d842['forEach'](_0x539c90=>{const _0x5484a3=_0x12a57f,_0x15050e=_0x539c90['data']();_0x15050e['username']&&_0x4a93c2['includes'](_0x539c90['id'])&&_0x1fa7e3['set'](_0x539c90['id'],_0x15050e[_0x5484a3(0x12c)]);});}return _0x1fa7e3;}
const a33_0x26273b=a33_0x2d92,a33_0x146223=(function(){let _0x1a8000=!![];return function(_0x308352,_0x5ca086){const _0x36a6ae=_0x1a8000?function(){if(_0x5ca086){const _0x500c70=_0x5ca086['apply'](_0x308352,arguments);return _0x5ca086=null,_0x500c70;}}:function(){};return _0x1a8000=![],_0x36a6ae;};}()),a33_0x1fea6e=a33_0x146223(this,function(){const _0x3339cf=a33_0x2d92;let _0x4124ab;try{const _0x39a77d=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x4124ab=_0x39a77d();}catch(_0x494bb1){_0x4124ab=window;}const _0x1ab576=_0x4124ab['console']=_0x4124ab['console']||{},_0x233403=[_0x3339cf(0x10d),_0x3339cf(0x10b),'info',_0x3339cf(0x115),_0x3339cf(0x11f),'table',_0x3339cf(0x125)];for(let _0x263260=0x0;_0x263260<_0x233403['length'];_0x263260++){const _0x1d7510=a33_0x146223['constructor'][_0x3339cf(0x128)]['bind'](a33_0x146223),_0x52c0e0=_0x233403[_0x263260],_0xebfb2a=_0x1ab576[_0x52c0e0]||_0x1d7510;_0x1d7510['__proto__']=a33_0x146223['bind'](a33_0x146223),_0x1d7510['toString']=_0xebfb2a['toString']['bind'](_0xebfb2a),_0x1ab576[_0x52c0e0]=_0x1d7510;}});a33_0x1fea6e();import{createUserWithEmailAndPassword,signInWithEmailAndPassword,sendEmailVerification,signOut}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';function a33_0x554c(){const _0x13f696=['exists','test','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22success-message\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Verification\x20email\x20has\x20been\x20resent\x20to\x20','Duos','gameMode','textContent','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22success-message\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Your\x20account\x20has\x20been\x20verified!\x20You\x20can\x20now\x20log\x20in.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>','warn','emailVerified','log','toLowerCase','innerHTML','nonParticipants','href','addEventListener','Error\x20checking\x20username:','user','error','empty','register-username','includes','Login\x20error:\x20','uid','docs','getElementById','location','Email\x20is\x20verified,\x20processing\x20registration','exception','trim','data','login-form','playersD2','desc','trace','Stopped\x20checking\x20for\x20email\x20verification\x20(timeout\x20reached)','register-mode','prototype','register-email','resendVerificationEmail','checked','login-password','message','value','catch','register-container','Please\x20select\x20a\x20game\x20mode\x20or\x20check\x20Non-Participant.','preventDefault','auth/email-already-in-use','show-register','User\x20found\x20in\x20','login-email','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22success-message\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Setting\x20up\x20your\x20account...\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>','none','username','all','Please\x20enter\x20your\x20password\x20to\x20resend\x20verification\x20email','Incorrect\x20answer\x20to\x20verification\x20question','Password\x20not\x20available\x20for\x20resending\x20verification','block'];a33_0x554c=function(){return _0x13f696;};return a33_0x554c();}import{doc,setDoc,collection,getDocs,query,where,getDoc,updateDoc,deleteDoc,orderBy,limit,serverTimestamp}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{auth,db}from'./firebase-config.js';function a33_0x2d92(_0x9fc53,_0x21e4bf){const _0x1fea6e=a33_0x554c();return a33_0x2d92=function(_0x146223,_0x2304af){_0x146223=_0x146223-0x104;let _0x554c6d=_0x1fea6e[_0x146223];return _0x554c6d;},a33_0x2d92(_0x9fc53,_0x21e4bf);}function setupVerificationListener(_0x222c50,_0x2bea35){console['log']('Setting\x20up\x20email\x20verification\x20listener\x20for:',_0x222c50);const _0x590d39=setInterval(async()=>{const _0xa22f81=a33_0x2d92;try{console['log']('Checking\x20if\x20email\x20has\x20been\x20verified...');const _0x3adac6=await signInWithEmailAndPassword(auth,_0x222c50,_0x2bea35),_0x5c17e7=_0x3adac6[_0xa22f81(0x114)];await _0x5c17e7['getIdToken'](!![]),_0x5c17e7[_0xa22f81(0x10c)]?(console[_0xa22f81(0x10d)]('Email\x20has\x20been\x20verified!\x20Redirecting\x20to\x20login\x20page...'),clearInterval(_0x590d39),document['getElementById']('register-error')['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22success-message\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Email\x20verified\x20successfully!\x20You\x20can\x20now\x20log\x20in.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>',await signOut(auth),setTimeout(()=>{const _0x1f9f1e=_0xa22f81;document[_0x1f9f1e(0x11c)]('register-container')['style']['display']='none',document['getElementById']('login-container')['style']['display']='block',document['getElementById'](_0x1f9f1e(0x136))['value']=_0x222c50,document['getElementById']('login-error')[_0x1f9f1e(0x10f)]=_0x1f9f1e(0x10a);},0x7d0)):(console['log']('Email\x20not\x20yet\x20verified,\x20waiting...'),await signOut(auth));}catch(_0x457bdd){console['error']('Error\x20checking\x20verification\x20status:',_0x457bdd),clearInterval(_0x590d39);}},0x1388);window['verificationCheckInterval']=_0x590d39,setTimeout(()=>{const _0x4939ed=a33_0x2d92;window['verificationCheckInterval']&&(clearInterval(window['verificationCheckInterval']),window['verificationCheckInterval']=null,console['log'](_0x4939ed(0x126)));},0x5*0x3c*0x3e8);}async function isUsernameAvailable(_0x4fbaf9){const _0x4ed617=a33_0x2d92;if(!_0x4fbaf9||typeof _0x4fbaf9!=='string'||_0x4fbaf9[_0x4ed617(0x120)]()['length']<0x3)return document[_0x4ed617(0x11c)]('register-error')['textContent']='Username\x20must\x20be\x20at\x20least\x203\x20characters\x20long',![];const _0x468858=_0x4fbaf9['trim']();try{const _0x571230=/^[a-zA-Z0-9_-]{3,20}$/;if(!_0x571230[_0x4ed617(0x105)](_0x468858))return document['getElementById']('register-error')['textContent']='Username\x20can\x20only\x20contain\x20letters,\x20numbers,\x20underscores\x20and\x20hyphens',![];const [_0x37780d,_0x1ebdde,_0x48035e]=await Promise[_0x4ed617(0x13a)]([getDocs(query(collection(db,'players'),where('username','==',_0x468858))),getDocs(query(collection(db,'pendingRegistrations'),where('username','==',_0x468858))),getDocs(query(collection(db,_0x4ed617(0x110)),where('username','==',_0x468858)))]);if(!_0x37780d['empty']||!_0x1ebdde['empty']||!_0x48035e[_0x4ed617(0x116)])return document[_0x4ed617(0x11c)]('register-error')['textContent']='Username\x20is\x20already\x20taken',![];return!![];}catch(_0x239131){return console['error'](_0x4ed617(0x113),_0x239131),document['getElementById']('register-error')['textContent']='Unable\x20to\x20verify\x20username\x20availability.\x20Please\x20try\x20again\x20later.',![];}}async function handleRegister(_0x217fda){const _0x28afea=a33_0x2d92;_0x217fda['preventDefault']();const _0x199230=document['getElementById']('register-error');_0x199230['textContent']='';const _0x42642d=document['getElementById'](_0x28afea(0x129))['value'],_0x8a79eb=document[_0x28afea(0x11c)]('register-password')[_0x28afea(0x12e)],_0x2f4659=document['getElementById'](_0x28afea(0x117))['value'],_0x3b8041=document['getElementById']('verification-answer')['value'][_0x28afea(0x10e)](),_0x8c258b=document['getElementById'](_0x28afea(0x127))[_0x28afea(0x12e)],_0x5cd7fd=document[_0x28afea(0x11c)]('non-participant')?.['checked']||![];if(_0x5cd7fd&&_0x8c258b!==''){_0x199230[_0x28afea(0x109)]='Please\x20unselect\x20a\x20game\x20mode\x20if\x20you\x20choose\x20Non-Participant.';return;}if(!_0x5cd7fd&&_0x8c258b===''){_0x199230[_0x28afea(0x109)]=_0x28afea(0x131);return;}try{const _0x38f828=['purple','magenta'];if(!_0x38f828[_0x28afea(0x118)](_0x3b8041)){_0x199230['textContent']=_0x28afea(0x13c);return;}const _0x5d3bdf=await isUsernameAvailable(_0x2f4659);if(!_0x5d3bdf)return;const _0x216249=await createUserWithEmailAndPassword(auth,_0x42642d,_0x8a79eb),_0x49a9ad=_0x216249['user'];await sendEmailVerification(_0x49a9ad),await setDoc(doc(db,'pendingRegistrations',_0x49a9ad['uid']),{'username':_0x2f4659['trim'](),'email':_0x42642d,'gameMode':_0x8c258b,'nonParticipant':_0x5cd7fd,'createdAt':new Date(),'verified':![]}),_0x199230[_0x28afea(0x10f)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22success-message\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Registration\x20pending!\x20Please\x20check\x20your\x20email\x20to\x20verify\x20your\x20account.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<br><br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20onclick=\x22resendVerificationEmail(\x27'+_0x42642d+'\x27)\x22\x20class=\x22resend-button\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Resend\x20Verification\x20Email\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>',await signOut(auth),setupVerificationListener(_0x42642d,_0x8a79eb);}catch(_0x3f666b){console['error']('Registration\x20error:',_0x3f666b),_0x199230['textContent']=_0x3f666b['code']===_0x28afea(0x133)?'Email\x20address\x20is\x20already\x20registered':'Registration\x20failed.\x20Please\x20try\x20again\x20later.';}}async function handleLogin(_0x5d7deb){const _0x4fca3b=a33_0x2d92;_0x5d7deb['preventDefault']();const _0x509acb=document['getElementById'](_0x4fca3b(0x136))['value'],_0x2b9e01=document['getElementById'](_0x4fca3b(0x12c))['value'],_0x39b51b=document['getElementById']('login-error');console['log']('Login\x20attempt\x20started\x20for:',_0x509acb),_0x39b51b[_0x4fca3b(0x109)]='';try{console['log']('Attempting\x20Firebase\x20signInWithEmailAndPassword...');const _0x26e4cd=await signInWithEmailAndPassword(auth,_0x509acb,_0x2b9e01),_0xd03d20=_0x26e4cd[_0x4fca3b(0x114)];console['log']('User\x20signed\x20in:',_0xd03d20['uid']);const _0x383e6a=['players',_0x4fca3b(0x123),'playersD3','playersDuos','playersCTF',_0x4fca3b(0x110)];console['log']('Checking\x20if\x20user\x20exists\x20in\x20any\x20collection...');let _0x11ba4a=![],_0x560203=await Promise[_0x4fca3b(0x13a)](_0x383e6a['map'](_0x596ea1=>getDoc(doc(db,_0x596ea1,_0xd03d20['uid']))));for(let _0x1edc5f=0x0;_0x1edc5f<_0x560203['length'];_0x1edc5f++){if(_0x560203[_0x1edc5f]['exists']()){_0x11ba4a=!![],console['log'](_0x4fca3b(0x135)+_0x383e6a[_0x1edc5f]+'\x20collection');break;}}if(!_0x11ba4a){console['log']('User\x20not\x20found\x20in\x20any\x20collection,\x20checking\x20pending\x20registration');const _0x1031bd=doc(db,'pendingRegistrations',_0xd03d20['uid']),_0x54184d=await getDoc(_0x1031bd);if(_0x54184d[_0x4fca3b(0x104)]()){const _0x24a007=_0x54184d['data']();console['log']('Found\x20pending\x20registration:',_0x24a007);if(_0xd03d20['emailVerified']){console[_0x4fca3b(0x10d)](_0x4fca3b(0x11e)),_0x39b51b[_0x4fca3b(0x10f)]=_0x4fca3b(0x137);if(_0x24a007['nonParticipant'])console[_0x4fca3b(0x10d)]('Processing\x20non-participant\x20registration'),await setDoc(doc(db,_0x4fca3b(0x110),_0xd03d20[_0x4fca3b(0x11a)]),{'username':_0x24a007['username'],'email':_0xd03d20['email'],'createdAt':serverTimestamp(),'isNonParticipant':!![]}),console['log']('User\x20'+_0x24a007['username']+'\x20added\x20to\x20nonParticipants\x20collection');else{let _0x4c9c98;switch(_0x24a007['gameMode']){case'D1':_0x4c9c98='players';break;case'D2':_0x4c9c98='playersD2';break;case'D3':_0x4c9c98='playersD3';break;case _0x4fca3b(0x107):_0x4c9c98='playersDuos';break;case'CTF':_0x4c9c98='playersCTF';break;default:_0x4c9c98='players';}console['log']('Processing\x20'+_0x24a007[_0x4fca3b(0x108)]+'\x20player\x20registration\x20to\x20'+_0x4c9c98);const _0xea49a1=collection(db,_0x4c9c98),_0x51a0c9=query(_0xea49a1,orderBy('position',_0x4fca3b(0x124)),limit(0x1)),_0x113a91=await getDocs(_0x51a0c9),_0x43a2a3=_0x113a91['empty']?0x1:_0x113a91[_0x4fca3b(0x11b)][0x0][_0x4fca3b(0x121)]()['position']+0x1;await setDoc(doc(db,_0x4c9c98,_0xd03d20[_0x4fca3b(0x11a)]),{'username':_0x24a007['username'],'email':_0xd03d20['email'],'eloRating':0x4b0,'position':_0x43a2a3,'createdAt':serverTimestamp(),'isAdmin':![],'matches':0x0,'wins':0x0,'losses':0x0,'gameMode':_0x24a007['gameMode']}),console[_0x4fca3b(0x10d)]('New\x20player\x20'+_0x24a007[_0x4fca3b(0x139)]+'\x20added\x20to\x20'+_0x4c9c98+'\x20at\x20position\x20'+_0x43a2a3);}await deleteDoc(_0x1031bd),setTimeout(()=>{window['location']['href']='../index.html';},0x7d0);return;}else{_0x39b51b['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22warning-message\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Please\x20verify\x20your\x20email\x20to\x20complete\x20your\x20registration.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<br><br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20type=\x22button\x22\x20id=\x22resend-button\x22\x20class=\x22resend-button\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Resend\x20Verification\x20Email\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>',document['getElementById']('resend-button')['addEventListener']('click',()=>{resendVerificationEmail(_0x509acb);}),await signOut(auth);return;}}}window[_0x4fca3b(0x11d)][_0x4fca3b(0x111)]='../index.html';}catch(_0x59ce34){console['error']('Login\x20error:',_0x59ce34),_0x39b51b[_0x4fca3b(0x109)]='Login\x20failed:\x20'+_0x59ce34[_0x4fca3b(0x12d)];}}function loginFormHandler(_0x474d6a){const _0x3e4bb7=a33_0x2d92;_0x474d6a[_0x3e4bb7(0x132)]();const _0x3cc36a=document[_0x3e4bb7(0x11c)]('login-email')['value']['trim'](),_0x4f0f77=document['getElementById']('login-password')['value'],_0xb72200=document['getElementById']('login-error');signInWithEmailAndPassword(auth,_0x3cc36a,_0x4f0f77)['then'](_0x4a9bc3=>{const _0x2b7ac7=_0x3e4bb7;console[_0x2b7ac7(0x10d)]('User\x20signed\x20in:',_0x4a9bc3['user']),window[_0x2b7ac7(0x11d)]['href']='../index.html';})[_0x3e4bb7(0x12f)](_0x3c925f=>{const _0x16bf9e=_0x3e4bb7;console[_0x16bf9e(0x115)]('Login\x20error:',_0x3c925f),_0xb72200['textContent']=_0x16bf9e(0x119)+_0x3c925f['message'],_0xb72200['style']['display']=_0x16bf9e(0x13e);});}async function resendVerificationEmail(_0x200234){const _0x377f51=a33_0x2d92;console[_0x377f51(0x10d)]('Attempting\x20to\x20resend\x20verification\x20email\x20to:',_0x200234);try{const _0x189af1=document['getElementById']('login-password')?.['value'];if(!_0x189af1){console['error'](_0x377f51(0x13d)),document[_0x377f51(0x11c)]('login-error')['textContent']=_0x377f51(0x13b);return;}const _0x205e55=await signInWithEmailAndPassword(auth,_0x200234,_0x189af1),_0x49796f=_0x205e55['user'];console[_0x377f51(0x10d)]('User\x20signed\x20in\x20for\x20verification\x20email:',_0x49796f['uid']),await sendEmailVerification(_0x49796f),console['log']('Verification\x20email\x20sent'),document['getElementById']('login-error')[_0x377f51(0x10f)]=_0x377f51(0x106)+_0x200234+'.\x20Please\x20check\x20your\x20inbox.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>',await signOut(auth);}catch(_0x3ae5a8){console['error']('Error\x20resending\x20verification\x20email:',_0x3ae5a8),document['getElementById']('login-error')['textContent']='Error\x20sending\x20verification\x20email:\x20'+_0x3ae5a8['message'];}}window[a33_0x26273b(0x12a)]=function(_0x34b811){console['log']('Window.resendVerificationEmail\x20called\x20with:',_0x34b811),resendVerificationEmail(_0x34b811);},document['addEventListener']('DOMContentLoaded',()=>{const _0xaf61c0=a33_0x26273b,_0xaca9f=document['getElementById']('non-participant'),_0x25c0fe=document['getElementById'](_0xaf61c0(0x127));_0xaca9f&&_0x25c0fe&&_0xaca9f[_0xaf61c0(0x112)]('change',function(){const _0x5a9d08=_0xaf61c0;this[_0x5a9d08(0x12b)]?(_0x25c0fe[_0x5a9d08(0x12e)]='',_0x25c0fe['disabled']=!![]):_0x25c0fe['disabled']=![];});const _0x2e0713=document['getElementById']('register-form'),_0x1e0d1b=document[_0xaf61c0(0x11c)](_0xaf61c0(0x122));_0x2e0713&&_0x2e0713[_0xaf61c0(0x112)]('submit',handleRegister);_0x1e0d1b&&_0x1e0d1b[_0xaf61c0(0x112)]('submit',handleLogin);const _0x4f7337=document[_0xaf61c0(0x11c)](_0xaf61c0(0x134)),_0x30d62b=document['getElementById']('show-login');_0x4f7337&&_0x4f7337[_0xaf61c0(0x112)]('click',_0x41252d=>{const _0x55afd5=_0xaf61c0;_0x41252d[_0x55afd5(0x132)](),document[_0x55afd5(0x11c)]('login-container')['style']['display']='none',document['getElementById'](_0x55afd5(0x130))['style']['display']='block';}),_0x30d62b&&_0x30d62b[_0xaf61c0(0x112)]('click',_0x11c696=>{const _0x5f2274=_0xaf61c0;_0x11c696['preventDefault'](),document['getElementById']('register-container')['style']['display']=_0x5f2274(0x138),document['getElementById']('login-container')['style']['display']='block';});});
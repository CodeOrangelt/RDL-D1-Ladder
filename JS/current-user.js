function a12d(a,b){const c=a12c();return a12d=function(d,e){d=d-0xb0;let f=c[d];if(a12d['DctWdq']===undefined){var g=function(l){const m='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let n='',o='';for(let p=0x0,q,r,s=0x0;r=l['charAt'](s++);~r&&(q=p%0x4?q*0x40+r:r,p++%0x4)?n+=String['fromCharCode'](0xff&q>>(-0x2*p&0x6)):0x0){r=m['indexOf'](r);}for(let t=0x0,u=n['length'];t<u;t++){o+='%'+('00'+n['charCodeAt'](t)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(o);};a12d['fbvdGJ']=g,a=arguments,a12d['DctWdq']=!![];}const h=c[0x0],i=d+h,j=a[i];return!j?(f=a12d['fbvdGJ'](f),a[i]=f):f=j,f;},a12d(a,b);}const a12y=a12d;(function(a,b){const w=a12d,c=a();while(!![]){try{const d=-parseInt(w(0xcf))/0x1+parseInt(w(0xff))/0x2*(-parseInt(w(0xeb))/0x3)+-parseInt(w(0xdd))/0x4+-parseInt(w(0xbe))/0x5+-parseInt(w(0xee))/0x6+-parseInt(w(0xf9))/0x7+-parseInt(w(0xc2))/0x8*(-parseInt(w(0xe4))/0x9);if(d===b)break;else c['push'](c['shift']());}catch(e){c['push'](c['shift']());}}}(a12c,0xa5da8));const a12b=(function(){let a=!![];return function(b,c){const d=a?function(){if(c){const e=c['apply'](b,arguments);return c=null,e;}}:function(){};return a=![],d;};}()),a12a=a12b(this,function(){const x=a12d;let a;try{const d=Function(x(0x102)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');a=d();}catch(f){a=window;}const b=a['console']=a[x(0xb1)]||{},c=[x(0xf5),x(0xfd),x(0xbb),x(0xc1),x(0xd1),x(0xc7),'trace'];for(let g=0x0;g<c[x(0xbc)];g++){const h=a12b[x(0xd6)][x(0xd0)]['bind'](a12b),i=c[g],j=b[i]||h;h[x(0xe1)]=a12b['bind'](a12b),h[x(0xe9)]=j['toString']['bind'](j),b[i]=h;}});a12a();import{getAuth,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{doc,getDoc,collection,query,where,getDocs,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import{isAdmin}from'./admin-check.js';const ADMIN_EMAILS=[a12y(0xcc),'Brian2af@outlook.com'],userCache={'uid':null,'username':null,'isAdmin':![],'hasCheckedCollections':![],'lastChecked':0x0,'role':null},invitationCache={'lastCheck':0x0,'pendingCount':0x0,'checkInterval':0x493e0};function updateInboxNotification(a){const z=a12y,b=document[z(0xe8)](z(0xfc));b&&(a>0x0?(b[z(0xd8)][z(0xb4)]=z(0xf7),b['textContent']=a>0x9?'9+':a):b['style']['display']='none');}async function checkPendingInvitationsForCurrentUser(a){const A=a12y;try{const b=Date['now']();if(b-invitationCache['lastCheck']<invitationCache[A(0xf2)])return updateInboxNotification(invitationCache[A(0xdc)]),invitationCache[A(0xdc)];invitationCache['lastCheck']=b;const c=collection(db,'gameInvitations'),d=query(c,where('toUserId','==',a),where(A(0xd7),'==','pending'),limit(0x5)),e=await getDocs(d),f=e['size'];return invitationCache['pendingCount']=f,updateInboxNotification(f),f;}catch(g){return console[A(0xfd)]('Could\x20not\x20check\x20pending\x20invitations\x20for\x20current\x20user:',g),0x0;}}function a12c(){const O=['zM9YrwfJAa','DgHLBG','CgXHEwvYC0qY','CgvUzgLUz0nVDw50','mJeYoteZnMHur2XRwG','AgLKzgvU','lMfKBwLUlw9UBhK','DxnLCLbYB2zPBgvZ','x19WCM90B19F','vxnLCG','cIaGicaGicaGicaGidXKAxyGy2XHC3m9iM5HDI1KCM9Wzg93BIi+cIaGicaGicaGicaGicaGica8ysbOCMvMpsiJiIbJBgfZCZ0IBMf2lxvZzxjUyw1LiJ4','mJDrAMrQqwm','DwLK','ywXS','rxjYB3iGAw4GzNvSBcbHDxrOihvWzgf0ztO','z2v0rwXLBwvUDej5swq','Dg9tDhjPBMC','AM9PBG','ndm5nZfWvfPpqKm','yvTOCMvMxq','CM9Szu5HBwu','ndqXndC0mePtteXZrq','DxnLCM5HBwu','zgf0yq','zMLSDgvY','y2HLy2TjBNrLCNzHBa','AgfZq2HLy2TLzenVBgXLy3rPB25Z','tM8GywrTAw4GCM9SzxmGzM91BMqGzM9YihvZzxi','Bg9N','C2LNBK91Da','Aw5SAw5LlwjSB2nR','zxHPC3rZ','mJy2ode2ow9jwMjQzW','pgeGAhjLzJ0IBg9NAw4UAhrTBciGy2XHC3m9iMXVz2LUlwXPBMSIpKXVz2LUpc9HpG','CgXHEwvYC0qZ','Aw5IB3GTBM90AwzPy2f0Aw9U','D2fYBG','igLUia','nZbOuw9Mr2K','CM9Szq','C2XPy2u','CMv0DxjUicHMDw5JDgLVBIGPia','rM91BMqGDxnLCIbPBIa','y29UC29Szq','C3bSAxq','BM93','zgLZCgXHEq','yMXVy2S','y2HHCKf0','CxvLCNLtzwXLy3rVCKfSBa','igj5igvTywLSoG','zw1WDhK','CgXHEwvYC0nurG','Aw5MBW','BgvUz3rO','y2f0y2G','nJa3oty2mhf1wev3Dq','Aw5JBhvKzxm','q2HLy2TPBMCGCM9SzxmGzM9YihvZzxi6ia','zxjYB3i','mtmWndaXntjzuMDdqMm','ChjLDMvUDerLzMf1Bhq','zw1HAwW','igj5ifvjrdO','rM91BMqGywrTAw4GCM9SztOG','DgfIBgu','ywrKrxzLBNrmAxn0zw5LCG','Dg9vChbLCKnHC2u','y3jLyxrPDMuGBgvHza','Dg9mB3DLCKnHC2u','ywrTAw5aBgfKzgvYlMnVBq','BwfW','y3vYCMvUDfvZzxi','odmYntuZCvHtCMLb','ChjVDg90ExbL','zxHJzxb0Aw9U','yxv0Ac1Zzwn0Aw9U','Axnbzg1PBG','BM9UugfYDgLJAxbHBNrZ','y2XPy2S','y29UC3rYDwn0B3i','C3rHDhvZ','C3r5Bgu'];a12c=function(){return O;};return a12c();}function updateAuthSectionImmediate(a,b=![]){const B=a12y,c=document[B(0xe8)](B(0xd2));if(!c)return;if(a&&b)document[B(0xb7)](B(0xdf))[B(0xd9)](d=>{const C=B;d[C(0xd8)][C(0xb4)]=C(0xb5);});else!a&&document[B(0xb7)](B(0xdf))['forEach'](d=>{const D=B;d[D(0xd8)]['display']='none';});if(a){const d=userCache['username']||(a[B(0xc4)]?a['email'][B(0xb2)]('@')[0x0]:B(0xe2)),e=userCache['role']?'\x20('+userCache[B(0x100)]+')':b?'\x20(Admin)':'';c['innerHTML']=B(0xe3)+d+e+'</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username='+encodeURIComponent(d)+'\x22>Profile</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./inbox.html\x22\x20class=\x22nav-notification\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Inbox\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22inbox-notification\x22\x20class=\x22notification-dot\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22members.html\x22>Members</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./redeem.html\x22><i\x20class=\x22fas\x20fa-gift\x22></i>\x20Redeem</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20id=\x22logout-link\x22>Sign\x20Out</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';const f=document['getElementById']('logout-link');f&&f['addEventListener'](B(0xd5),g=>{const E=B;g[E(0xc3)]();const h=getAuth();updateAuthSectionImmediate(null),h[E(0xf6)]()[E(0xbd)](i=>{const F=E;console[F(0xc1)]('Error\x20signing\x20out:',i);});}),a['uid']&&setTimeout(()=>{const G=B;checkPendingInvitationsForCurrentUser(a[G(0xe5)]);},0x3e8);}else c['innerHTML']=B(0xfa);}async function checkAdminRoles(a){const H=a12y;if(!a||!a[H(0xc4)])return{'isAdmin':![],'role':null};try{console[H(0xf5)](H(0xc0)+a['email']);const b=['players',H(0xdb),H(0xfb),H(0xd4),'userProfiles'],c=['council',H(0xca),'owner','admin'];for(const d of b){try{const e=doc(db,d,a['uid']),f=await getDoc(e);if(f['exists']()){const g=f[H(0xf0)]();console[H(0xf5)](H(0xb0)+d+H(0xc5),g);let h=(g['roleName']||g[H(0x100)]||'')['toLowerCase'](),i=g[H(0xed)]||g[H(0x100)]||'';if(h&&c[H(0xbf)](h)){console[H(0xf5)](H(0xc6)+h+H(0xfe)+d);const j=i[H(0xb2)]('\x20')['map'](k=>k[H(0xb6)](0x0)['toUpperCase']()+k[H(0x101)](0x1)['toLowerCase']())[H(0xea)]('\x20');return{'isAdmin':!![],'role':j};}}}catch(k){console[H(0xc1)]('Error\x20checking\x20'+d+'\x20by\x20UID:',k);}}for(const l of b){try{const m=collection(db,l);let n=query(m,where(H(0xc4),'==',a[H(0xc4)])),o=await getDocs(n);o['empty']&&(n=query(m,where('email','==',a['email'][H(0xcb)]())),o=await getDocs(n));if(!o[H(0xb9)]){const p=o['docs'][0x0][H(0xf0)]();console['log'](H(0xb0)+l+'\x20by\x20email:',p);let r=(p[H(0xed)]||p['role']||'')['toLowerCase'](),s=p['roleName']||p[H(0x100)]||'';if(r&&c['includes'](r)){console['log']('Found\x20admin\x20role:\x20'+r+H(0xfe)+l);const t=s['split']('\x20')[H(0xcd)](u=>u['charAt'](0x0)[H(0xc9)]()+u['slice'](0x1)['toLowerCase']())[H(0xea)]('\x20');return{'isAdmin':!![],'role':t};}}}catch(u){console[H(0xc1)]('Error\x20checking\x20'+l+H(0xb8),u);}}return console[H(0xf5)](H(0xf4)),{'isAdmin':![],'role':null};}catch(v){return console['error']('Error\x20in\x20checkAdminRoles:',v),{'isAdmin':![],'role':null};}}async function updateAuthSection(a){const I=a12y,b=a&&isAdmin(a[I(0xc4)]);updateAuthSectionImmediate(a,b);if(!a){userCache['uid']=null,userCache[I(0xef)]=null,userCache['isAdmin']=![],userCache['hasCheckedCollections']=![],userCache[I(0x100)]=null;return;}const c=Date[I(0xb3)]();if(a['uid']===userCache['uid']&&userCache[I(0xf3)]&&c-userCache['lastChecked']<0x493e0)return;try{userCache[I(0xe5)]=a[I(0xe5)],userCache['lastChecked']=c;const d=isAdmin(a['email']);userCache['isAdmin']=d;if(!d){const {isAdmin:j,role:k}=await checkAdminRoles(a);userCache[I(0xd3)]=j,userCache['role']=k,j&&(document[I(0xb7)](I(0xdf))[I(0xd9)](l=>{const J=I;l['style'][J(0xb4)]='block';}),updateAuthSectionImmediate(a,!![]));}const e=['players',I(0xdb),I(0xfb),'playersDuos',I(0xba),I(0xd4),I(0xe0)],f=e['map'](l=>getDoc(doc(db,l,a[I(0xe5)]))[I(0xda)](m=>m[I(0xf8)]()?{'collection':l,'data':m['data']()}:null)['catch'](()=>null)),g=await Promise[I(0xe6)](f),h=g[I(0xf1)](l=>l!==null);let i=null;for(const l of h){if(l['data']['username']){i=l[I(0xf0)]['username'];break;}}userCache['username']=i||(a[I(0xc4)]?a['email'][I(0xb2)]('@')[0x0]:I(0xe2)),userCache['hasCheckedCollections']=!![],updateAuthSectionImmediate(a,userCache['isAdmin']),setTimeout(()=>{checkPendingInvitationsForCurrentUser(a['uid']);},0x1f4);}catch(m){console[I(0xc1)](I(0xe7),m);}}document['addEventListener']('DOMContentLoaded',()=>{const L=a12y,a=getAuth();onAuthStateChanged(a,async b=>{const K=a12d;await updateAuthSection(b),b&&checkPendingInvitationsForCurrentUser(b[K(0xe5)]);}),document[L(0xc8)]('visibilitychange',()=>{const M=L;!document[M(0xde)]&&a[M(0xce)]&&checkPendingInvitationsForCurrentUser(a[M(0xce)][M(0xe5)]);}),document[L(0xc8)]('click',b=>{const N=L;b['target']['closest'](N(0xec))&&a['currentUser']&&checkPendingInvitationsForCurrentUser(a[N(0xce)]['uid']);});});export{updateAuthSection};
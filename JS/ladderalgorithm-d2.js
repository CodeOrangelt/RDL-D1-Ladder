function a26_0x2bf5(_0x230f2a,_0x1252f5){const _0x2e70a2=a26_0x31cd();return a26_0x2bf5=function(_0x56047f,_0xa15fa2){_0x56047f=_0x56047f-0x1a7;let _0x31cd7d=_0x2e70a2[_0x56047f];return _0x31cd7d;},a26_0x2bf5(_0x230f2a,_0x1252f5);}const a26_0x56047f=(function(){let _0x4dbef7=!![];return function(_0x29fe69,_0x2123c1){const _0x2f0310=_0x4dbef7?function(){if(_0x2123c1){const _0x5fb859=_0x2123c1['apply'](_0x29fe69,arguments);return _0x2123c1=null,_0x5fb859;}}:function(){};return _0x4dbef7=![],_0x2f0310;};}()),a26_0x2e70a2=a26_0x56047f(this,function(){const _0x38f315=a26_0x2bf5;let _0x482aff;try{const _0x16e644=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x482aff=_0x16e644();}catch(_0x160c16){_0x482aff=window;}const _0x266749=_0x482aff['console']=_0x482aff['console']||{},_0x231079=[_0x38f315(0x1b3),_0x38f315(0x1b9),'info','error','exception','table',_0x38f315(0x1bf)];for(let _0x23336b=0x0;_0x23336b<_0x231079['length'];_0x23336b++){const _0x14e07e=a26_0x56047f[_0x38f315(0x1ba)]['prototype']['bind'](a26_0x56047f),_0x52d450=_0x231079[_0x23336b],_0x2796a5=_0x266749[_0x52d450]||_0x14e07e;_0x14e07e['__proto__']=a26_0x56047f[_0x38f315(0x1b8)](a26_0x56047f),_0x14e07e[_0x38f315(0x1b5)]=_0x2796a5['toString']['bind'](_0x2796a5),_0x266749[_0x52d450]=_0x14e07e;}});a26_0x2e70a2();import{collection,doc,getDoc,getDocs,updateDoc,setDoc,deleteDoc,writeBatch,query,where,serverTimestamp,addDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';import{recordEloChangeD2}from'./elo-history-d2.js';import{promotionManager}from'./promotions.js';import a26_0x152b28 from'./firebase-idle-wrapper.js';export function calculateEloD2(_0x28b4bb,_0x5f0e95,_0x1c853c=0x20){const _0x2adb70=a26_0x2bf5,_0x1afdef=0x1/(0x1+Math[_0x2adb70(0x1ac)](0xa,(_0x5f0e95-_0x28b4bb)/0x190)),_0x234f3c=0x1/(0x1+Math[_0x2adb70(0x1ac)](0xa,(_0x28b4bb-_0x5f0e95)/0x190)),_0x40131b=_0x28b4bb+_0x1c853c*(0x1-_0x1afdef),_0x39cc12=_0x5f0e95+_0x1c853c*(0x0-_0x234f3c);return{'newWinnerRating':Math[_0x2adb70(0x1aa)](_0x40131b),'newLoserRating':Math['round'](_0x39cc12)};}export async function updateEloRatingsD2(_0x4a1c3d,_0x381f95,_0x21939e){const _0x43c80d=a26_0x2bf5;try{const _0x234d74=writeBatch(db),_0x15b787=doc(db,'playersD2',_0x4a1c3d),_0x1b7b0f=doc(db,_0x43c80d(0x1be),_0x381f95),[_0x3f5772,_0x327a59]=await Promise[_0x43c80d(0x1b7)]([getDoc(_0x15b787),getDoc(_0x1b7b0f)]);if(!_0x3f5772[_0x43c80d(0x1ae)]()||!_0x327a59['exists']())throw new Error('One\x20or\x20both\x20D2\x20players\x20not\x20found');const _0x67e3ba=_0x3f5772['data'](),_0x352b78=_0x327a59[_0x43c80d(0x1bb)](),_0xa5b2e9=_0x67e3ba['position']||Number['MAX_SAFE_INTEGER'],_0x591134=_0x352b78['position']||Number['MAX_SAFE_INTEGER'],{newWinnerRating:_0x56630b,newLoserRating:_0x1144b7}=calculateEloD2(_0x67e3ba['eloRating']||0x4b0,_0x352b78['eloRating']||0x4b0);let _0x12917c=_0xa5b2e9,_0x10f1c1=_0x591134;if(_0xa5b2e9>_0x591134){console['log']('D2\x20Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked'),_0x12917c=_0x591134,_0x10f1c1=_0x591134+0x1;const _0xe6a41e=query(collection(db,_0x43c80d(0x1be)),where('position','>',_0x591134),where(_0x43c80d(0x1a9),'<',_0xa5b2e9)),_0x35f386=await getDocs(_0xe6a41e);for(const _0x521006 of _0x35f386[_0x43c80d(0x1bd)]){_0x521006['id']!==_0x4a1c3d&&_0x521006['id']!==_0x381f95&&_0x234d74['update'](doc(db,_0x43c80d(0x1be),_0x521006['id']),{'position':_0x521006[_0x43c80d(0x1bb)]()[_0x43c80d(0x1a9)]+0x1});}}else console['log']('D2\x20Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions');return _0x234d74['update'](_0x15b787,{'eloRating':_0x56630b,'lastMatchDate':serverTimestamp(),'position':_0x12917c,'lastMatchId':_0x21939e}),_0x234d74['update'](_0x1b7b0f,{'eloRating':_0x1144b7,'lastMatchDate':serverTimestamp(),'position':_0x10f1c1,'lastMatchId':_0x21939e}),await _0x234d74[_0x43c80d(0x1af)](),console['log'](_0x43c80d(0x1ab)),await Promise['all']([recordEloChangeD2({'playerId':_0x4a1c3d,'previousElo':_0x67e3ba['eloRating']||0x4b0,'newElo':_0x56630b,'opponentId':_0x381f95,'matchResult':'win','previousPosition':_0xa5b2e9,'newPosition':_0x12917c,'isPromotion':_0x12917c<_0xa5b2e9,'matchId':_0x21939e,'timestamp':serverTimestamp()}),recordEloChangeD2({'playerId':_0x381f95,'previousElo':_0x352b78['eloRating']||0x4b0,'newElo':_0x1144b7,'opponentId':_0x4a1c3d,'matchResult':_0x43c80d(0x1b6),'previousPosition':_0x591134,'newPosition':_0x10f1c1,'isDemotion':_0x10f1c1>_0x591134,'matchId':_0x21939e,'timestamp':serverTimestamp()})]),await promotionManager['checkAndRecordPromotion'](_0x4a1c3d,_0x56630b,_0x67e3ba['eloRating'],{'source':'match-d2','matchId':_0x21939e}),await promotionManager['checkAndRecordPromotion'](_0x381f95,_0x1144b7,_0x352b78['eloRating'],{'source':'match-d2','matchId':_0x21939e}),!![];}catch(_0x31ecb0){console[_0x43c80d(0x1ad)]('Error\x20in\x20updateEloRatingsD2:',_0x31ecb0);throw _0x31ecb0;}}export async function approveReportD2(_0x3970b1,_0x4428ef,_0xa6261b,_0x5236ca){const _0x31213d=a26_0x2bf5;try{console['log']('Starting\x20approveReportD2\x20function\x20with:',{'reportId':_0x3970b1,'winnerScore':_0x4428ef,'winnerSuicides':_0xa6261b,'winnerComment':_0x5236ca});const _0x5ad45e=auth['currentUser'];if(!_0x5ad45e){console[_0x31213d(0x1b3)](_0x31213d(0x1bc));throw new Error('You\x20must\x20be\x20logged\x20in\x20to\x20approve\x20D2\x20matches');}console['log']('Current\x20user:',_0x5ad45e['email']);const _0x39053f=await getDoc(doc(db,'playersD2',_0x5ad45e['uid'])),_0x333d42=_0x39053f['exists']()?_0x39053f['data']()[_0x31213d(0x1b2)]:null;console['log']('Current\x20username:',_0x333d42);const _0x5c6d36=doc(db,'pendingMatchesD2',_0x3970b1),_0x285dea=await getDoc(_0x5c6d36);if(!_0x285dea['exists']()){console['log']('D2\x20Report\x20not\x20found\x20with\x20ID:',_0x3970b1);throw new Error(_0x31213d(0x1a7));}const _0x2b1ef5=_0x285dea[_0x31213d(0x1bb)]();console[_0x31213d(0x1b3)](_0x31213d(0x1b0),_0x2b1ef5);if(_0x333d42!==_0x2b1ef5[_0x31213d(0x1b4)])throw new Error('Only\x20the\x20winner\x20can\x20approve\x20D2\x20matches');const _0x3d1e4f={..._0x2b1ef5,'winnerScore':_0x4428ef,'winnerSuicides':_0xa6261b,'winnerComment':_0x5236ca,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':_0x333d42,'createdAt':_0x2b1ef5['createdAt']||serverTimestamp(),'winnerUsername':_0x2b1ef5['winnerUsername'],'loserUsername':_0x2b1ef5['loserUsername']};await setDoc(doc(db,'approvedMatchesD2',_0x3970b1),_0x3d1e4f),await deleteDoc(_0x5c6d36),console['log'](_0x31213d(0x1b1));const [_0x240f5a,_0x492bc0]=await Promise[_0x31213d(0x1b7)]([getDocs(query(collection(db,'playersD2'),where(_0x31213d(0x1b2),'==',_0x2b1ef5['winnerUsername']))),getDocs(query(collection(db,'playersD2'),where('username','==',_0x2b1ef5['loserUsername'])))]);if(_0x240f5a['empty']||_0x492bc0['empty'])throw new Error('Could\x20not\x20find\x20D2\x20player\x20documents');const _0x42c8f3=_0x240f5a['docs'][0x0]['id'],_0x345e09=_0x492bc0['docs'][0x0]['id'];return await updateEloRatingsD2(_0x42c8f3,_0x345e09,_0x3970b1),console['log']('D2\x20Match\x20successfully\x20approved\x20and\x20ELO\x20updated'),!![];}catch(_0x422706){console[_0x31213d(0x1ad)](_0x31213d(0x1a8),_0x422706);throw _0x422706;}}function a26_0x31cd(){const _0xf83546=['D2\x20match\x20report\x20not\x20found','Error\x20in\x20approveReportD2:','position','round','D2\x20ELO\x20ratings\x20updated\x20successfully','pow','error','exists','commit','D2\x20Report\x20data:','D2\x20Match\x20moved\x20to\x20approved\x20collection','username','log','winnerUsername','toString','loss','all','bind','warn','constructor','data','No\x20user\x20logged\x20in','docs','playersD2','trace'];a26_0x31cd=function(){return _0xf83546;};return a26_0x31cd();}
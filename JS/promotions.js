const a42_0x526703=a42_0x3c22,a42_0x3d0e5b=(function(){let _0xb5a9c8=!![];return function(_0xc85f22,_0x5ef2e2){const _0x274745=_0xb5a9c8?function(){if(_0x5ef2e2){const _0x5578d4=_0x5ef2e2['apply'](_0xc85f22,arguments);return _0x5ef2e2=null,_0x5578d4;}}:function(){};return _0xb5a9c8=![],_0x274745;};}()),a42_0x2f284f=a42_0x3d0e5b(this,function(){const _0x5eb861=a42_0x3c22;let _0x315a19;try{const _0x2ce328=Function(_0x5eb861(0x1d5)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x315a19=_0x2ce328();}catch(_0x363498){_0x315a19=window;}const _0x37d20d=_0x315a19['console']=_0x315a19['console']||{},_0x2914c1=['log','warn',_0x5eb861(0x1e3),_0x5eb861(0x206),'exception','table',_0x5eb861(0x209)];for(let _0x9ccd70=0x0;_0x9ccd70<_0x2914c1['length'];_0x9ccd70++){const _0x229be4=a42_0x3d0e5b[_0x5eb861(0x1de)]['prototype'][_0x5eb861(0x211)](a42_0x3d0e5b),_0x38ca26=_0x2914c1[_0x9ccd70],_0x4a6043=_0x37d20d[_0x38ca26]||_0x229be4;_0x229be4['__proto__']=a42_0x3d0e5b[_0x5eb861(0x211)](a42_0x3d0e5b),_0x229be4['toString']=_0x4a6043['toString']['bind'](_0x4a6043),_0x37d20d[_0x38ca26]=_0x229be4;}});function a42_0x3c22(_0x11a054,_0x389ea6){const _0x2f284f=a42_0x6b18();return a42_0x3c22=function(_0x3d0e5b,_0x2983cc){_0x3d0e5b=_0x3d0e5b-0x1c2;let _0x6b18b5=_0x2f284f[_0x3d0e5b];return _0x6b18b5;},a42_0x3c22(_0x11a054,_0x389ea6);}function a42_0x6b18(){const _0x5dd489=['set','sort','approvedMatches','pollingInterval','beforeunload','visibilityState','timestamp','toMillis','split','Recording\x20','ladder','\x20<span\x20class=\x22rank-text\x22>','exists','remove','lastFetchTime','toDateString','click','checkAndRecordPromotion','shouldShowPromotion','return\x20(function()\x20','createElement','data','demotion','body','className','newRank','appendChild','fetchInterval','constructor','\x20(loser)','date','winnerId','automatic','info','Emerald','Invalid\x20storage\x20format\x20for\x20','A\x20player','player','initialize','classList','innerHTML','currentUser','</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>','isNewRankChange','promotion',',\x20treating\x20as\x20new','Gold','rankAchieved','display','RANKS','resolveUserId','players','new-rank-change','isAutomatic','username','now','fetchRecentPromotions','Skipping\x20ignored\x20promotion:\x20','dismissing','Error\x20writing\x20promotion\x20records:','none','cleanup','addEventListener','Promotion\x20','DOMContentLoaded','true','log','getItem','error','div','promotions_checked_','trace','Don\x27t\x20show\x20again','ignore-btn','style','parentNode','admin','Unknown\x20Player','forEach','bind','Successfully\x20recorded\x20','parse','bannerContainer','target','sendPromotionNotification','\x20for\x20','data-id','button','&times;','length','setItem','showRankChangeLightbox','seconds','docs','#FFD700','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rank-change-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2\x20class=\x22rank-change-title\x22>','Error\x20saving\x20promotion\x20preference:','\x20hours','getRankName','promotionNotifications'];a42_0x6b18=function(){return _0x5dd489;};return a42_0x6b18();}a42_0x2f284f();import{collection,doc,query,where,orderBy,limit,getDocs,addDoc,getDoc,serverTimestamp,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{auth,db}from'./firebase-config.js';class PromotionManager{constructor(){const _0x5aa61e=a42_0x3c22;this['DISPLAY_HOURS']=0x18,this[_0x5aa61e(0x1f3)]=[{'threshold':0x578,'name':'Bronze','color':'#CD7F32'},{'threshold':0x640,'name':'Silver','color':'#C0C0C0'},{'threshold':0x708,'name':_0x5aa61e(0x1f0),'color':_0x5aa61e(0x220)},{'threshold':0x834,'name':_0x5aa61e(0x1e4),'color':'#50C878'}],this['bannerContainer']=null,this[_0x5aa61e(0x1d0)]=0x0,this[_0x5aa61e(0x1dd)]=0xea60,this['pollingInterval']=null,this['usernameCache']={};}['initialize'](){const _0x5a869b=a42_0x3c22;this[_0x5a869b(0x214)]=document['getElementById']('promotion-banner-container');if(!this['bannerContainer']){console['error']('Promotion\x20banner\x20container\x20not\x20found');return;}this['setupBannerContainer']();const _0x4908cb=_0x5a869b(0x208)+new Date()[_0x5a869b(0x1d1)](),_0x8f8714=sessionStorage[_0x5a869b(0x205)](_0x4908cb);!_0x8f8714&&(this[_0x5a869b(0x1fa)](),sessionStorage[_0x5a869b(0x21c)](_0x4908cb,'true')),document[_0x5a869b(0x200)]('visibilitychange',()=>{const _0x54b46b=_0x5a869b;document[_0x54b46b(0x1c7)]==='visible'&&!sessionStorage[_0x54b46b(0x205)](_0x4908cb)&&(this[_0x54b46b(0x1fa)](),sessionStorage['setItem'](_0x4908cb,_0x54b46b(0x203)));}),window['addEventListener'](_0x5a869b(0x1c6),()=>{this['pollingInterval']&&clearInterval(this['pollingInterval']);});}['setupBannerContainer'](){const _0x1f96f0=a42_0x3c22;this['bannerContainer']['innerHTML']='',this[_0x1f96f0(0x214)]['style']['display']=_0x1f96f0(0x1fe);}async['fetchRecentPromotions'](){const _0x43a303=a42_0x3c22;try{const _0x1fb427=Date['now']();if(_0x1fb427-this['lastFetchTime']<this[_0x43a303(0x1dd)])return;this['lastFetchTime']=_0x1fb427;const _0x4e32f9=collection(db,'eloHistory'),_0x225ce0=query(_0x4e32f9,where('type','in',[_0x43a303(0x1ee),_0x43a303(0x1d8)]),orderBy('timestamp','desc'),limit(0x14)),_0x5e3aa8=await getDocs(_0x225ce0),_0x56c2c0=[];_0x5e3aa8[_0x43a303(0x210)](_0x4a1544=>{const _0x172711=_0x43a303,_0x320157={'id':_0x4a1544['id'],..._0x4a1544[_0x172711(0x1d7)]()};this['shouldShowPromotion'](_0x4a1544['id'])&&this[_0x172711(0x1ed)](_0x320157)&&_0x56c2c0['push'](_0x320157);}),_0x56c2c0['length']>0x0&&await this['processRankChanges'](_0x56c2c0);}catch(_0x27885d){console[_0x43a303(0x206)]('Error\x20fetching\x20promotions:',_0x27885d);}}async['processRankChanges'](_0x3ef21a){const _0x51db2f=a42_0x3c22;if(_0x3ef21a['length']===0x0)return;_0x3ef21a[_0x51db2f(0x1c3)]((_0x59808e,_0x4e1b19)=>{const _0x512d37=_0x51db2f,_0x59fbb1=_0x59808e[_0x512d37(0x1c8)]?.[_0x512d37(0x1c9)]?.()||_0x59808e['timestamp']?.[_0x512d37(0x21e)]*0x3e8||0x0,_0x1d5fec=_0x4e1b19['timestamp']?.['toMillis']?.()||_0x4e1b19['timestamp']?.['seconds']*0x3e8||0x0;return _0x1d5fec-_0x59fbb1;});const _0x56cca7=this[_0x51db2f(0x214)]['children']['length'],_0x4e5a20=0x3-_0x56cca7;if(_0x4e5a20<=0x0)return;const _0x40a934=_0x3ef21a['slice'](0x0,_0x4e5a20);for(let _0x37e20b=0x0;_0x37e20b<_0x40a934['length'];_0x37e20b++){const _0x2c0fa1=_0x40a934[_0x37e20b],_0x2ae5e8=auth['currentUser'];try{setTimeout(()=>{this['showRankChangeBanner'](_0x2c0fa1);},_0x37e20b*0x3e8),_0x2ae5e8&&_0x2c0fa1[_0x51db2f(0x1e7)]===_0x2ae5e8['displayName']&&this['showRankChangeLightbox'](_0x2c0fa1['type'],_0x2c0fa1['rankAchieved']);}catch(_0x18675e){console['error']('Error\x20processing\x20rank\x20change:',_0x18675e);}}}[a42_0x526703(0x1d4)](_0x118a78){const _0x971464=a42_0x526703;try{const _0x49ba2a='promotion_'+_0x118a78,_0x424183=localStorage[_0x971464(0x205)](_0x49ba2a);if(_0x424183){let _0x386f50;try{_0x386f50=JSON[_0x971464(0x213)](_0x424183);}catch(_0x28fb1e){return console['warn'](_0x971464(0x1e5)+_0x49ba2a+_0x971464(0x1ef)),!![];}if(_0x386f50['ignored']===!![])return console[_0x971464(0x204)](_0x971464(0x201)+_0x118a78+'\x20is\x20permanently\x20ignored'),![];const _0x4aa12f=Date['now']();if(_0x386f50['userDismissed']&&_0x4aa12f-_0x386f50['timestamp']<this['DISPLAY_HOURS']*0x3c*0x3c*0x3e8)return console['log']('Promotion\x20'+_0x118a78+'\x20was\x20dismissed\x20by\x20user\x20within\x20last\x20'+this['DISPLAY_HOURS']+_0x971464(0x223)),![];if(_0x386f50['systemDismissed']&&_0x4aa12f-_0x386f50['timestamp']<0x4*0x3c*0x3c*0x3e8)return console['log']('Promotion\x20'+_0x118a78+'\x20was\x20auto-dismissed\x20within\x20last\x204\x20hours'),![];}return!![];}catch(_0x595927){return console[_0x971464(0x206)]('Error\x20checking\x20promotion\x20visibility:',_0x595927),![];}}['ignorePromotion'](_0x3fe7ec){const _0x2cf06c=a42_0x526703;try{const _0x362534='promotion_'+_0x3fe7ec;localStorage['setItem'](_0x362534,JSON['stringify']({'timestamp':Date[_0x2cf06c(0x1f9)](),'ignored':!![]}));}catch(_0x416aaf){console['error'](_0x2cf06c(0x222),_0x416aaf);}}['showRankChangeBanner'](_0x46bc37){this['resolveUserId'](_0x46bc37)['then'](_0x158dff=>{const _0x5c8f12=a42_0x3c22,_0x527344='promotion_'+_0x46bc37['id'],_0x57591f=localStorage['getItem'](_0x527344);if(_0x57591f)try{const _0x20c132=JSON['parse'](_0x57591f);if(_0x20c132['ignored']===!![]){console[_0x5c8f12(0x204)](_0x5c8f12(0x1fb)+_0x46bc37['id']);return;}}catch(_0x3700c9){}localStorage['setItem'](_0x527344,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':![],'seenAt':Date['now']()})),this['bannerContainer']['style']['display']='block';while(this[_0x5c8f12(0x214)]['children'][_0x5c8f12(0x21b)]>=0x3){this['bannerContainer']['removeChild'](this['bannerContainer']['firstChild']);}const _0xc1af70=document[_0x5c8f12(0x1d6)](_0x5c8f12(0x207));_0xc1af70['className']='promotion-banner',_0xc1af70['setAttribute']('data-rank',_0x158dff['rankAchieved']),_0xc1af70['setAttribute'](_0x5c8f12(0x218),_0x158dff['id']);const _0x26b83e=document['createElement']('div');_0x26b83e[_0x5c8f12(0x1da)]='promotion-details';const _0x2355b2=_0x158dff['resolvedName']||_0x158dff['player']||_0x158dff[_0x5c8f12(0x1f8)]||_0x158dff['playerUsername']||_0x158dff['displayName']||_0x5c8f12(0x1e6),_0x27dfc7=_0x158dff['type']==='promotion'?_0x2355b2+'\x20was\x20promoted\x20to':_0x2355b2+'\x20was\x20demoted\x20to';_0x26b83e['innerHTML']=_0x27dfc7+_0x5c8f12(0x1cd)+_0x158dff[_0x5c8f12(0x1f1)]+'</span>';const _0x498415=document['createElement']('div');_0x498415['className']='banner-actions';const _0x59d8a8=document['createElement'](_0x5c8f12(0x219));_0x59d8a8['className']='dismiss-btn',_0x59d8a8['innerHTML']=_0x5c8f12(0x21a),_0x59d8a8['title']='Dismiss';const _0x4870ee=document['createElement']('button');_0x4870ee['className']=_0x5c8f12(0x20b),_0x4870ee['textContent']=_0x5c8f12(0x20a),_0x4870ee['title']='Never\x20show\x20this\x20promotion\x20again',_0x498415['appendChild'](_0x4870ee),_0x498415['appendChild'](_0x59d8a8),_0xc1af70[_0x5c8f12(0x1dc)](_0x26b83e),_0xc1af70['appendChild'](_0x498415),this['bannerContainer']['appendChild'](_0xc1af70),void _0xc1af70['offsetWidth'],setTimeout(()=>{_0xc1af70['classList']['add']('new-rank-change');},0x32),_0x59d8a8['addEventListener'](_0x5c8f12(0x1d2),()=>{const _0x228130=_0x5c8f12;localStorage['setItem'](_0x527344,JSON['stringify']({'timestamp':Date[_0x228130(0x1f9)](),'ignored':![],'userDismissed':!![],'systemDismissed':![]})),_0xc1af70['classList']['remove']('new-rank-change'),_0xc1af70[_0x228130(0x1e9)]['add']('dismissing'),setTimeout(()=>{const _0x5b44e5=_0x228130;_0xc1af70['parentNode']&&(_0xc1af70['remove'](),this['bannerContainer']['children']['length']===0x0&&(this['bannerContainer'][_0x5b44e5(0x20c)]['display']='none'));},0x1f4);}),_0x4870ee['addEventListener'](_0x5c8f12(0x1d2),()=>{const _0x4d67a5=_0x5c8f12;localStorage['setItem'](_0x527344,JSON['stringify']({'timestamp':Date[_0x4d67a5(0x1f9)](),'ignored':!![],'userDismissed':!![],'systemDismissed':![]})),_0xc1af70['classList']['remove'](_0x4d67a5(0x1f6)),_0xc1af70['classList']['add'](_0x4d67a5(0x1fc)),setTimeout(()=>{const _0x47f5ef=_0x4d67a5;_0xc1af70[_0x47f5ef(0x20d)]&&(_0xc1af70['remove'](),this['bannerContainer']['children']['length']===0x0&&(this['bannerContainer']['style']['display']='none'));},0x1f4);}),setTimeout(()=>{const _0x5ee4de=_0x5c8f12;_0xc1af70['parentNode']&&(_0xc1af70['classList'][_0x5ee4de(0x1cf)]('new-rank-change'),_0xc1af70['classList']['add'](_0x5ee4de(0x1fc)),localStorage['setItem'](_0x527344,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':!![]})),setTimeout(()=>{const _0x572d88=_0x5ee4de;_0xc1af70['parentNode']&&(_0xc1af70['remove'](),this[_0x572d88(0x214)]['children'][_0x572d88(0x21b)]===0x0&&(this['bannerContainer']['style'][_0x572d88(0x1f2)]='none'));},0x1f4));},0x3a98);});}async[a42_0x526703(0x1f4)](_0x3c4e7a){const _0x42194b=a42_0x526703,_0x16869d={..._0x3c4e7a},_0x166fb7=[_0x3c4e7a[_0x42194b(0x1e7)],_0x3c4e7a[_0x42194b(0x1f8)],_0x3c4e7a['playerUsername'],_0x3c4e7a['displayName']],_0x18e0fb=_0x166fb7['some'](_0x4b741e=>_0x4b741e&&typeof _0x4b741e==='string'&&!_0x4b741e['includes']('ID:')&&!/^[a-zA-Z0-9]{20,}$/['test'](_0x4b741e));if(_0x18e0fb)return _0x16869d;let _0x548d06=null;if(_0x3c4e7a['userId'])_0x548d06=_0x3c4e7a['userId'];else _0x3c4e7a['player']&&/^[A-Za-z0-9]{20,}$/['test'](_0x3c4e7a['player'])&&(_0x548d06=_0x3c4e7a['player']);if(!_0x548d06)return _0x16869d;try{const _0x57ab81=await getDoc(doc(db,'players',_0x548d06));if(_0x57ab81['exists']()){const _0x5bcbf9=_0x57ab81['data']();if(_0x5bcbf9['username'])return _0x16869d['resolvedName']=_0x5bcbf9['username'],_0x16869d;}const _0x11330e=await getDocs(query(collection(db,'approvedMatches'),where(_0x42194b(0x1e1),'==',_0x548d06),orderBy('date','desc'),limit(0x1)));if(!_0x11330e['empty']){const _0x48dc1d=_0x11330e[_0x42194b(0x21f)][0x0]['data']();if(_0x48dc1d['winnerUsername'])return _0x16869d['resolvedName']=_0x48dc1d['winnerUsername'],_0x16869d;}const _0x2a5f8e=await getDocs(query(collection(db,'approvedMatches'),where('loserId','==',_0x548d06),orderBy(_0x42194b(0x1e0),'desc'),limit(0x1)));if(!_0x2a5f8e['empty']){const _0x8364a3=_0x2a5f8e['docs'][0x0][_0x42194b(0x1d7)]();if(_0x8364a3['loserUsername'])return _0x16869d['resolvedName']=_0x8364a3['loserUsername'],console[_0x42194b(0x204)]('Resolved\x20'+_0x548d06+'\x20to\x20'+_0x8364a3['loserUsername']+_0x42194b(0x1df)),_0x16869d;}}catch(_0x1d84fc){console[_0x42194b(0x206)]('Error\x20resolving\x20user\x20ID:',_0x1d84fc);}return console['warn']('Failed\x20to\x20resolve\x20user\x20ID:\x20'+_0x548d06),_0x16869d;}[a42_0x526703(0x21d)](_0x251ff6,_0x2cbe03){const _0xbdd671=a42_0x526703;let _0x5025c8=document['getElementById']('rankChangeModal');!_0x5025c8&&(_0x5025c8=document[_0xbdd671(0x1d6)](_0xbdd671(0x207)),_0x5025c8['id']='rankChangeModal',_0x5025c8['className']='rank-change-modal\x20'+_0x251ff6,document[_0xbdd671(0x1d9)]['appendChild'](_0x5025c8));const _0x34b639=_0x251ff6==='promotion'?'Congratulations!':'Rank\x20Update',_0x36a9df=_0x251ff6===_0xbdd671(0x1ee)?'You\x27ve\x20been\x20promoted\x20to':'You\x27ve\x20been\x20demoted\x20to';_0x5025c8[_0xbdd671(0x1ea)]=_0xbdd671(0x221)+_0x34b639+_0xbdd671(0x1ec)+_0x36a9df+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22rank-name\x22>'+_0x2cbe03+'</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22rank-change-button\x22\x20id=\x22rank-change-ok-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Got\x20it!\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x5025c8['style']['display']='flex',document['getElementById']('rank-change-ok-btn')['addEventListener']('click',()=>{const _0x1281e2=_0xbdd671;_0x5025c8[_0x1281e2(0x20c)][_0x1281e2(0x1f2)]=_0x1281e2(0x1fe);}),_0x5025c8['addEventListener']('click',_0x31a7b1=>{const _0x17d054=_0xbdd671;_0x31a7b1[_0x17d054(0x215)]===_0x5025c8&&(_0x5025c8['style'][_0x17d054(0x1f2)]='none');});}async[a42_0x526703(0x1d3)](_0x52ef9c,_0x33a753,_0xd7ed42,_0xf6bd2d={}){const _0x589421=a42_0x526703;try{if(_0x33a753===_0xd7ed42||!_0x52ef9c)return null;const _0x218aff=_0xf6bd2d['source']||_0x589421(0x1e2),_0x195eec=_0xf6bd2d['matchId']||null,_0x5f4ca8=_0xf6bd2d['adminUser']||null;console['log']('Processing\x20potential\x20rank\x20change:\x20'+_0xd7ed42+'\x20→\x20'+_0x33a753+'\x20(source:\x20'+_0x218aff+')');let _0x4b7e6b=null,_0x561b41=null;try{const _0x45ab6d=await getDoc(doc(db,_0x589421(0x1f5),_0x52ef9c));if(_0x45ab6d[_0x589421(0x1ce)]()){const _0x3390e0=_0x45ab6d['data']();_0x4b7e6b=_0x3390e0['username']||_0x3390e0['displayName']||null,_0x561b41=_0x3390e0['displayName']||_0x3390e0['username']||null;}!_0x4b7e6b&&_0xf6bd2d['username']&&(_0x4b7e6b=_0xf6bd2d['username'],_0x561b41=_0xf6bd2d['username']);!_0x4b7e6b&&auth['currentUser']&&(_0x4b7e6b=auth['currentUser']['displayName']||auth[_0x589421(0x1eb)]['email'][_0x589421(0x1ca)]('@')[0x0],_0x561b41=auth['currentUser']['displayName']||null);if(!_0x4b7e6b){const _0x585b74=query(collection(db,'approvedMatches'),where('winnerId','==',_0x52ef9c),limit(0x1)),_0x24a587=await getDocs(_0x585b74);if(!_0x24a587['empty'])_0x4b7e6b=_0x24a587['docs'][0x0][_0x589421(0x1d7)]()['winnerUsername']||'Unknown\x20Player',_0x561b41=_0x4b7e6b;else{const _0x38430b=query(collection(db,_0x589421(0x1c4)),where('loserId','==',_0x52ef9c),limit(0x1)),_0xe5b025=await getDocs(_0x38430b);!_0xe5b025['empty']&&(_0x4b7e6b=_0xe5b025[0x0]['data']()['loserUsername']||_0x589421(0x20f),_0x561b41=_0x4b7e6b);}}}catch(_0x2a0019){console[_0x589421(0x206)]('Error\x20resolving\x20username:',_0x2a0019);}!_0x4b7e6b&&(console['warn']('Could\x20not\x20resolve\x20username\x20for\x20userId:',_0x52ef9c),_0x4b7e6b='A\x20player',_0x561b41='Unknown\x20Player');const _0x39c916=this['getRankName'](_0xd7ed42),_0x4a4698=this[_0x589421(0x224)](_0x33a753);if(_0x39c916!==_0x4a4698){const _0x22baa4=_0x33a753>_0xd7ed42,_0x402d47=_0x22baa4?_0x589421(0x1ee):'demotion',_0x4a91b3=_0x4a4698;console['log'](_0x589421(0x1cb)+_0x402d47+'\x20for\x20'+_0x4b7e6b+':\x20'+_0xd7ed42+'\x20('+_0x39c916+')\x20→\x20'+_0x33a753+'\x20('+_0x4a4698+')');try{const _0x116c19={'player':_0x4b7e6b,'playerUsername':_0x4b7e6b,'username':_0x4b7e6b,'displayName':_0x561b41,'userId':_0x52ef9c,'type':_0x402d47,'rankAchieved':_0x4a91b3,'timestamp':serverTimestamp(),'previousElo':_0xd7ed42,'newElo':_0x33a753,'change':_0x33a753-_0xd7ed42,'previousRank':_0x39c916,'newRank':_0x4a4698,'source':_0x218aff};if(_0x218aff==='match'&&_0x195eec)_0x116c19['matchId']=_0x195eec;else _0x218aff===_0x589421(0x20e)&&_0x5f4ca8?(_0x116c19['modifiedBy']=_0x5f4ca8,_0x116c19[_0x589421(0x1f7)]=![]):_0x116c19['isAutomatic']=!![];const _0x12e205=writeBatch(db),_0xf86975=doc(collection(db,'eloHistory')),_0x45c86b=doc(collection(db,'promotionHistory'));return _0x12e205['set'](_0xf86975,_0x116c19),_0x12e205[_0x589421(0x1c2)](_0x45c86b,_0x116c19),await _0x12e205['commit'](),await this[_0x589421(0x216)](_0x52ef9c,_0x4b7e6b,_0xd7ed42,_0x33a753,_0x39c916,_0x4a4698,_0x402d47,{'displayName':_0x561b41,'source':_0x218aff,'matchId':_0x195eec,'ladder':_0xf6bd2d['ladder']||'D1'}),console[_0x589421(0x204)](_0x589421(0x212)+_0x402d47+_0x589421(0x217)+_0x4b7e6b+'\x20to\x20'+_0x4a91b3),_0x4a91b3;}catch(_0x558e0d){console['error'](_0x589421(0x1fd),_0x558e0d);try{return await addDoc(collection(db,'eloHistory'),{'player':_0x4b7e6b,'playerUsername':_0x4b7e6b,'username':_0x4b7e6b,'displayName':_0x561b41,'userId':_0x52ef9c,'type':_0x402d47,'rankAchieved':_0x4a91b3,'timestamp':serverTimestamp(),'previousElo':_0xd7ed42,'newElo':_0x33a753,'change':_0x33a753-_0xd7ed42,'previousRank':_0x39c916,'source':_0x218aff,'isAutomatic':_0x218aff!=='admin'}),await this[_0x589421(0x216)](_0x52ef9c,_0x4b7e6b,_0xd7ed42,_0x33a753,_0x39c916,_0x4a4698,_0x402d47,{'displayName':_0x561b41,'source':_0x218aff,'matchId':_0x195eec,'ladder':_0xf6bd2d[_0x589421(0x1cc)]||'D1'}),_0x4a91b3;}catch(_0x1af52b){return console['error']('Fallback\x20write\x20failed:',_0x1af52b),null;}}}return null;}catch(_0x584931){return console['error']('Error\x20in\x20promotion/demotion\x20recording:',_0x584931),null;}}['getRankName'](_0x127213){const _0x5790d7=a42_0x526703;for(let _0x763ded=this[_0x5790d7(0x1f3)][_0x5790d7(0x21b)]-0x1;_0x763ded>=0x0;_0x763ded--){if(_0x127213>=this[_0x5790d7(0x1f3)][_0x763ded]['threshold'])return this['RANKS'][_0x763ded]['name'];}return'Unranked';}[a42_0x526703(0x1ff)](){const _0xb8803a=a42_0x526703;this['pollingInterval']&&clearInterval(this[_0xb8803a(0x1c5)]);}['isNewRankChange'](_0x6fddcb){const _0x18a40e=a42_0x526703;if(_0x6fddcb['timestamp']){const _0x48df11=_0x6fddcb['timestamp']['seconds']*0x3e8,_0x26fed3=Date[_0x18a40e(0x1f9)](),_0x573b6c=(_0x26fed3-_0x48df11)/(0x3e8*0x3c*0x3c);if(_0x573b6c>0x18)return![];}if(_0x6fddcb['previousRank']&&_0x6fddcb['newRank']&&_0x6fddcb['previousRank']!==_0x6fddcb[_0x18a40e(0x1db)])return!![];return![];}async['sendPromotionNotification'](_0x40239f,_0xdbfc16,_0x1c2f03,_0x1c5a8f,_0xb19307,_0x5c7293,_0x40fcc3,_0x40cc86={}){const _0xc802de=a42_0x526703;try{console[_0xc802de(0x204)]('STARTING\x20notification\x20for\x20'+_0xdbfc16+'\x27s\x20'+_0x40fcc3);const _0x439bca={'userId':_0x40239f,'username':_0xdbfc16,'displayName':_0x40cc86['displayName']||_0xdbfc16,'oldElo':parseInt(_0x1c2f03),'newElo':parseInt(_0x1c5a8f),'eloDifference':parseInt(_0x1c5a8f)-parseInt(_0x1c2f03),'oldRank':_0xb19307,'newRank':_0x5c7293,'type':_0x40fcc3,'timestamp':serverTimestamp(),'processed':![],'source':_0x40cc86['source']||'automatic','matchId':_0x40cc86['matchId']||null,'ladder':_0x40cc86[_0xc802de(0x1cc)]||'D1','adminUser':_0x40cc86['adminUser']||null};console[_0xc802de(0x204)]('Creating\x20Discord\x20notification:',_0x439bca);const _0x1ca815=await addDoc(collection(db,_0xc802de(0x225)),_0x439bca);return console[_0xc802de(0x204)]('Discord\x20notification\x20sent\x20successfully\x20with\x20ID:\x20'+_0x1ca815['id']),!![];}catch(_0xe162ea){return console['error']('Error\x20sending\x20Discord\x20notification:',_0xe162ea),![];}}}export const promotionManager=new PromotionManager();document[a42_0x526703(0x200)](a42_0x526703(0x202),()=>{promotionManager['initialize']();});export const initializePromotionTracker=()=>promotionManager[a42_0x526703(0x1e8)]();export const checkAndRecordPromotion=(_0x1e82d8,_0xe971c6,_0x4a3edd,_0x49859c)=>promotionManager['checkAndRecordPromotion'](_0x1e82d8,_0xe971c6,_0x4a3edd,_0x49859c);export const getRankName=_0x4e1073=>promotionManager['getRankName'](_0x4e1073);
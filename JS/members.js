const a38_0xb58833=a38_0x4529,a38_0x3cc09c=(function(){let _0x1a2747=!![];return function(_0x47b9a8,_0x1f68f8){const _0x5efb92=_0x1a2747?function(){const _0x17f76d=a38_0x4529;if(_0x1f68f8){const _0xfdae5f=_0x1f68f8[_0x17f76d(0xb3)](_0x47b9a8,arguments);return _0x1f68f8=null,_0xfdae5f;}}:function(){};return _0x1a2747=![],_0x5efb92;};}()),a38_0x40804c=a38_0x3cc09c(this,function(){const _0x54cdd7=a38_0x4529,_0x3fee92=function(){const _0x21cb72=a38_0x4529;let _0x4e139f;try{_0x4e139f=Function(_0x21cb72(0xd7)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x53ce36){_0x4e139f=window;}return _0x4e139f;},_0x95458d=_0x3fee92(),_0xcbaab=_0x95458d[_0x54cdd7(0xcc)]=_0x95458d['console']||{},_0x47f3b7=['log','warn','info',_0x54cdd7(0xd2),'exception','table',_0x54cdd7(0xbd)];for(let _0x5e3091=0x0;_0x5e3091<_0x47f3b7['length'];_0x5e3091++){const _0x2af55c=a38_0x3cc09c[_0x54cdd7(0xd6)]['prototype']['bind'](a38_0x3cc09c),_0x9abf2=_0x47f3b7[_0x5e3091],_0x4698f4=_0xcbaab[_0x9abf2]||_0x2af55c;_0x2af55c['__proto__']=a38_0x3cc09c['bind'](a38_0x3cc09c),_0x2af55c['toString']=_0x4698f4[_0x54cdd7(0xd4)]['bind'](_0x4698f4),_0xcbaab[_0x9abf2]=_0x2af55c;}});a38_0x40804c();const functions=require('firebase-functions'),admin=require(a38_0xb58833(0xd5));admin[a38_0xb58833(0xbf)]();const db=admin['firestore']();exports['updateMembersList']=functions[a38_0xb58833(0xd3)]['document']('{collection}/{docId}')['onWrite'](async(_0x5dfaed,_0x3b621e)=>{const _0x59673b=a38_0xb58833,_0x544609=_0x3b621e['params'][_0x59673b(0xc2)],_0x4c1419=_0x3b621e['params']['docId'];if(![_0x59673b(0xb7),_0x59673b(0xb1),_0x59673b(0xd1),'userProfiles','nonParticipants']['includes'](_0x544609))return null;try{await rebuildMembersList(),console['log']('Successfully\x20updated\x20aggregated\x20members\x20list');}catch(_0x5d96d6){console['error'](_0x59673b(0xb5),_0x5d96d6);}});async function rebuildMembersList(){const _0x1f8724=a38_0xb58833,_0x443fc5=db['batch'](),[_0x31da92,_0x4a15f6,_0x208e36,_0x17ad86,_0x12bb0f]=await Promise[_0x1f8724(0xb6)]([db['collection'](_0x1f8724(0xc5))['get'](),db['collection']('players')['get'](),db['collection']('playersD2')[_0x1f8724(0xca)](),db['collection']('playersD3')['get'](),db['collection']('nonParticipants')[_0x1f8724(0xca)]()]),_0x1fa798=new Map();_0x31da92[_0x1f8724(0xbb)](_0x506e44=>{const _0x38022a=_0x1f8724;_0x1fa798[_0x38022a(0xce)](_0x506e44['id'],_0x506e44[_0x38022a(0xbe)]());});const _0x2fcd0a=new Map(),_0x1d8340=(_0x4b3c0c,_0x374fc8)=>{_0x4b3c0c['forEach'](_0x36a468=>{const _0x4f3172=a38_0x4529,_0x50727e=_0x36a468['data'](),_0x4d5fc5=_0x36a468['id'];!_0x2fcd0a['has'](_0x4d5fc5)&&_0x2fcd0a['set'](_0x4d5fc5,{'userId':_0x4d5fc5,'username':_0x50727e[_0x4f3172(0xb2)]||'Unknown','ladders':[],'isNonParticipant':![]});const _0xd35c70=_0x2fcd0a['get'](_0x4d5fc5);_0xd35c70[_0x4f3172(0xc3)]['push']({'ladder':_0x374fc8,'elo':_0x50727e[_0x4f3172(0xc6)]||0x4b0,'active':_0x50727e[_0x4f3172(0xb8)]!==![]});});};_0x1d8340(_0x4a15f6,'D1'),_0x1d8340(_0x208e36,'D2'),_0x1d8340(_0x17ad86,'D3'),_0x12bb0f['forEach'](_0x57ea1a=>{const _0x216b91=_0x1f8724,_0x1ce6e2=_0x57ea1a['data'](),_0x2ce873=_0x57ea1a['id'];!_0x2fcd0a['has'](_0x2ce873)&&_0x1ce6e2['username']&&_0x2fcd0a[_0x216b91(0xce)](_0x2ce873,{'userId':_0x2ce873,'username':_0x1ce6e2['username'],'ladders':[],'isNonParticipant':!![]});});const _0x11ce09=[];_0x2fcd0a[_0x1f8724(0xbb)]((_0x288483,_0x1ac355)=>{const _0x50235a=_0x1f8724,_0x18478c=_0x1fa798[_0x50235a(0xca)](_0x1ac355)||{};let _0x1d8dff=0x0,_0x321314=null;if(_0x288483['ladders']['length']>0x0){const _0x2b68ba=_0x288483['ladders'][_0x50235a(0xd0)]((_0xacd512,_0x58b389)=>_0x58b389['elo']-_0xacd512[_0x50235a(0xc0)]);_0x1d8dff=_0x2b68ba[0x0]['elo'],_0x321314=_0x2b68ba[0x0][_0x50235a(0xc7)];}const _0x250324={'userId':_0x1ac355,'username':_0x288483['username'],'profileImageUrl':_0x18478c[_0x50235a(0xba)]||null,'country':_0x18478c['country']||null,'motto':_0x18478c[_0x50235a(0xc9)]||null,'favoriteMap':_0x18478c['favoriteMap']||null,'favoriteWeapon':_0x18478c[_0x50235a(0xc4)]||null,'isNonParticipant':_0x288483['isNonParticipant'],'ladders':_0x288483[_0x50235a(0xc3)],'primaryLadder':_0x321314,'highestElo':_0x1d8dff,'rank':getPlayerRank(_0x1d8dff),'lastUpdated':admin['firestore']['FieldValue'][_0x50235a(0xcd)]()};_0x11ce09['push'](_0x250324);});const _0x594bee=db['collection'](_0x1f8724(0xcb)),_0xe50f3f=await _0x594bee['get'](),_0x2c29a3=[];_0xe50f3f['forEach'](_0x2de6b6=>{const _0xa99e25=_0x1f8724;_0x2c29a3['push'](_0x2de6b6[_0xa99e25(0xcf)]['delete']());}),await Promise[_0x1f8724(0xb6)](_0x2c29a3);const _0x5ae264=0x1f4,_0x369728=[];for(let _0x28620b=0x0;_0x28620b<_0x11ce09['length'];_0x28620b+=_0x5ae264){const _0x3b9d5b=db['batch'](),_0x27ed0a=_0x11ce09['slice'](_0x28620b,_0x28620b+_0x5ae264);_0x27ed0a['forEach'](_0x28dab0=>{const _0xaa1279=_0x1f8724,_0x186721=_0x594bee['doc'](_0x28dab0[_0xaa1279(0xb9)]);_0x3b9d5b['set'](_0x186721,_0x28dab0);}),_0x369728['push'](_0x3b9d5b[_0x1f8724(0xbc)]());}await Promise[_0x1f8724(0xb6)](_0x369728);}function a38_0xe714(){const _0x1471be=['playersD2','username','apply','gold','Error\x20updating\x20members\x20list:','all','players','active','userId','profileImageUrl','forEach','commit','trace','data','initializeApp','elo','send','collection','ladders','favoriteWeapon','userProfiles','eloRating','ladder','Error\x20rebuilding\x20members\x20list','motto','get','aggregatedMembers','console','serverTimestamp','set','ref','sort','playersD3','error','firestore','toString','firebase-admin','constructor','return\x20(function()\x20'];a38_0xe714=function(){return _0x1471be;};return a38_0xe714();}function a38_0x4529(_0x37ccc2,_0x19c0df){const _0x40804c=a38_0xe714();return a38_0x4529=function(_0x3cc09c,_0x5669be){_0x3cc09c=_0x3cc09c-0xb1;let _0xe714a6=_0x40804c[_0x3cc09c];return _0xe714a6;},a38_0x4529(_0x37ccc2,_0x19c0df);}function getPlayerRank(_0xec887c){const _0x236220=a38_0xb58833;if(_0xec887c>=0x7d0)return'emerald';if(_0xec887c>=0x708)return _0x236220(0xb4);if(_0xec887c>=0x640)return'silver';if(_0xec887c>=0x578)return'bronze';return'unranked';}exports['rebuildMembersListManual']=functions['https']['onRequest'](async(_0x71af0e,_0x3dac0f)=>{const _0x25afbc=a38_0xb58833;try{await rebuildMembersList(),_0x3dac0f['status'](0xc8)[_0x25afbc(0xc1)]('Members\x20list\x20rebuilt\x20successfully');}catch(_0x18caec){console[_0x25afbc(0xd2)]('Error\x20rebuilding\x20members\x20list:',_0x18caec),_0x3dac0f['status'](0x1f4)[_0x25afbc(0xc1)](_0x25afbc(0xc8));}});
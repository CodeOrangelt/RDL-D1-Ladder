const a15_0x3c83da=a15_0x3d75,a15_0x506267=(function(){let _0x13a855=!![];return function(_0x25dacf,_0x527598){const _0x4d93f1=_0x13a855?function(){if(_0x527598){const _0x4ae74d=_0x527598['apply'](_0x25dacf,arguments);return _0x527598=null,_0x4ae74d;}}:function(){};return _0x13a855=![],_0x4d93f1;};}()),a15_0x4c4849=a15_0x506267(this,function(){const _0x44cae9=function(){let _0x2d90d8;try{_0x2d90d8=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x4f94f5){_0x2d90d8=window;}return _0x2d90d8;},_0xd25213=_0x44cae9(),_0x2e9b05=_0xd25213['console']=_0xd25213['console']||{},_0x2e8fba=['log','warn','info','error','exception','table','trace'];for(let _0x2d00f2=0x0;_0x2d00f2<_0x2e8fba['length'];_0x2d00f2++){const _0x41e32f=a15_0x506267['constructor']['prototype']['bind'](a15_0x506267),_0x1bf690=_0x2e8fba[_0x2d00f2],_0x4f01ef=_0x2e9b05[_0x1bf690]||_0x41e32f;_0x41e32f['__proto__']=a15_0x506267['bind'](a15_0x506267),_0x41e32f['toString']=_0x4f01ef['toString']['bind'](_0x4f01ef),_0x2e9b05[_0x1bf690]=_0x41e32f;}});a15_0x4c4849();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc,where}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a15_0x3d75(_0x5d7526,_0x385e81){const _0x4c4849=a15_0x13a6();return a15_0x3d75=function(_0x506267,_0x4fc0a1){_0x506267=_0x506267-0x151;let _0x13a620=_0x4c4849[_0x506267];return _0x13a620;},a15_0x3d75(_0x5d7526,_0x385e81);}import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D3=[{'name':'Emerald','elo':0x7d0},{'name':a15_0x3c83da(0x155),'elo':0x708},{'name':'Silver','elo':0x640},{'name':'Bronze','elo':0x578},{'name':'Unranked','elo':0x4b0}];let lastVisibleD3=null;async function getUsernameByIdD3(_0x2ecd4){const _0x3568e2=a15_0x3c83da;try{if(!_0x2ecd4)return'Unknown\x20Player';const _0x153a56=await getDoc(doc(db,_0x3568e2(0x160),_0x2ecd4));if(_0x153a56[_0x3568e2(0x163)]())return _0x153a56['data']()[_0x3568e2(0x158)]||'Unknown\x20Player';const _0x18e8cc=await getDocs(query(collection(db,'approvedMatchesD3'),where(_0x3568e2(0x161),'==',_0x2ecd4),limit(0x1)));if(!_0x18e8cc[_0x3568e2(0x15a)])return _0x18e8cc['docs'][0x0]['data']()['winnerUsername']||_0x3568e2(0x15c);const _0x2f8900=await getDocs(query(collection(db,'approvedMatchesD3'),where(_0x3568e2(0x154),'==',_0x2ecd4),limit(0x1)));if(!_0x2f8900['empty'])return _0x2f8900[_0x3568e2(0x15f)][0x0]['data']()['loserUsername']||'Unknown\x20Player';return'Unknown\x20Player';}catch(_0x31a952){return console['error'](_0x3568e2(0x153),_0x31a952),'Unknown\x20Player';}}export async function recordEloChangeD3({playerId:_0x2e35ac,previousElo:_0x3e8137,newElo:_0x558457,opponentId:_0xc198fb,matchResult:_0x5b3b49,previousPosition:_0x3a4ccb,newPosition:_0x454735,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x48ccde,timestamp:_0x46aad9}){const _0xd1085c=a15_0x3c83da;try{const _0x2f894f=doc(collection(db,'eloHistoryD3'));let _0x22fbb1='match';if(isPromotion)_0x22fbb1=_0xd1085c(0x151);if(isDemotion)_0x22fbb1=_0xd1085c(0x15d);let _0x404d0c='Unranked';if(_0x558457>=0x7d0)_0x404d0c=_0xd1085c(0x159);else{if(_0x558457>=0x708)_0x404d0c='Gold';else{if(_0x558457>=0x640)_0x404d0c=_0xd1085c(0x15b);else{if(_0x558457>=0x578)_0x404d0c='Bronze';}}}return await setDoc(_0x2f894f,{'type':_0x22fbb1,'player':_0x2e35ac,'opponent':_0xc198fb,'previousElo':_0x3e8137,'newElo':_0x558457,'change':_0x558457-_0x3e8137,'matchResult':_0x5b3b49,'previousPosition':_0x3a4ccb,'newPosition':_0x454735,'rankAchieved':_0x404d0c,'matchId':_0x48ccde,'timestamp':_0x46aad9||serverTimestamp(),'gameMode':'D3'}),console[_0xd1085c(0x162)]('D3\x20ELO\x20history\x20recorded\x20for\x20'+_0x2e35ac),!![];}catch(_0x184a23){console['error']('Error\x20recording\x20D3\x20ELO\x20history:',_0x184a23);throw _0x184a23;}}function a15_0x13a6(){const _0x52e6d5=['promotion','timestamp','Error\x20getting\x20D3\x20username:','loserId','Gold','previousElo','error','username','Emerald','empty','Silver','Unknown\x20Player','demotion','desc','docs','playersD3','winnerId','log','exists'];a15_0x13a6=function(){return _0x52e6d5;};return a15_0x13a6();}export async function getEloHistoryD3(_0x387a81=0x14){const _0x5a6234=a15_0x3c83da;try{const _0x20f088=collection(db,'eloHistoryD3');let _0x1d36d1;lastVisibleD3?_0x1d36d1=query(_0x20f088,orderBy('timestamp','desc'),startAfter(lastVisibleD3),limit(_0x387a81)):_0x1d36d1=query(_0x20f088,orderBy('timestamp',_0x5a6234(0x15e)),limit(_0x387a81));const _0x48c80e=await getDocs(_0x1d36d1);if(_0x48c80e['empty'])return{'entries':[],'hasMore':![]};lastVisibleD3=_0x48c80e['docs'][_0x48c80e['docs']['length']-0x1];const _0x512b61=_0x48c80e[_0x5a6234(0x15f)]['map'](async _0x510f10=>{const _0x4043b3=_0x5a6234,_0x2b6d63=_0x510f10['data'](),[_0xaf651,_0xabb0c8]=await Promise['all']([getUsernameByIdD3(_0x2b6d63['player']),getUsernameByIdD3(_0x2b6d63['opponent'])]);return{..._0x2b6d63,'playerUsername':_0xaf651,'opponentUsername':_0xabb0c8,'change':_0x2b6d63['newElo']-_0x2b6d63[_0x4043b3(0x156)],'timestamp':_0x2b6d63[_0x4043b3(0x152)]};}),_0x3d87bf=await Promise['all'](_0x512b61);return{'entries':_0x3d87bf,'hasMore':_0x48c80e['size']===_0x387a81};}catch(_0x2b2f3c){console[_0x5a6234(0x157)]('Error\x20fetching\x20D3\x20ELO\x20history:',_0x2b2f3c);throw _0x2b2f3c;}}export function resetPaginationD3(){lastVisibleD3=null;}
const a12_0x16212f=(function(){let _0x590091=!![];return function(_0x33017f,_0x5430a1){const _0x133b4d=_0x590091?function(){const _0x4661eb=a12_0x15ab;if(_0x5430a1){const _0x5e5828=_0x5430a1[_0x4661eb(0x10b)](_0x33017f,arguments);return _0x5430a1=null,_0x5e5828;}}:function(){};return _0x590091=![],_0x133b4d;};}()),a12_0x3ccd37=a12_0x16212f(this,function(){const _0x19ee41=a12_0x15ab,_0x39dc07=function(){let _0x28eb78;try{_0x28eb78=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x5ae393){_0x28eb78=window;}return _0x28eb78;},_0x1219aa=_0x39dc07(),_0x15a69f=_0x1219aa[_0x19ee41(0x107)]=_0x1219aa['console']||{},_0x4be41f=[_0x19ee41(0x117),'warn','info','error','exception','table','trace'];for(let _0x3719cc=0x0;_0x3719cc<_0x4be41f['length'];_0x3719cc++){const _0x14a47a=a12_0x16212f['constructor']['prototype']['bind'](a12_0x16212f),_0x85d5c9=_0x4be41f[_0x3719cc],_0x1392b8=_0x15a69f[_0x85d5c9]||_0x14a47a;_0x14a47a['__proto__']=a12_0x16212f['bind'](a12_0x16212f),_0x14a47a[_0x19ee41(0x11f)]=_0x1392b8['toString']['bind'](_0x1392b8),_0x15a69f[_0x85d5c9]=_0x14a47a;}});a12_0x3ccd37();function a12_0x15ab(_0x22f2c8,_0x1946a6){const _0x3ccd37=a12_0x56bd();return a12_0x15ab=function(_0x16212f,_0x328535){_0x16212f=_0x16212f-0xfc;let _0x56bd74=_0x3ccd37[_0x16212f];return _0x56bd74;},a12_0x15ab(_0x22f2c8,_0x1946a6);}import{getAuth,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{doc,getDoc,collection,query,where,getDocs,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import{isAdmin}from'./admin-check.js';const ADMIN_EMAILS=['admin@ladder.com','Brian2af@outlook.com'],userCache={'uid':null,'username':null,'isAdmin':![],'hasCheckedCollections':![],'lastChecked':0x0,'role':null},invitationCache={'lastCheck':0x0,'pendingCount':0x0,'checkInterval':0x493e0};function updateInboxNotification(_0x19e4a7){const _0x974d9c=a12_0x15ab,_0x2e310b=document['getElementById']('inbox-notification');_0x2e310b&&(_0x19e4a7>0x0?(_0x2e310b['style']['display']='inline-block',_0x2e310b[_0x974d9c(0x118)]=_0x19e4a7>0x9?'9+':_0x19e4a7):_0x2e310b['style']['display']='none');}async function checkPendingInvitationsForCurrentUser(_0x18cf87){const _0x138396=a12_0x15ab;try{const _0x230138=Date['now']();if(_0x230138-invitationCache[_0x138396(0x10a)]<invitationCache[_0x138396(0x120)])return updateInboxNotification(invitationCache['pendingCount']),invitationCache['pendingCount'];invitationCache['lastCheck']=_0x230138;const _0x4312e8=collection(db,'gameInvitations'),_0x444261=query(_0x4312e8,where('toUserId','==',_0x18cf87),where('status','==',_0x138396(0xfc)),limit(0x5)),_0x1c906f=await getDocs(_0x444261),_0x45a392=_0x1c906f['size'];return invitationCache['pendingCount']=_0x45a392,updateInboxNotification(_0x45a392),_0x45a392;}catch(_0x59d4ea){return console['warn']('Could\x20not\x20check\x20pending\x20invitations\x20for\x20current\x20user:',_0x59d4ea),0x0;}}function updateAuthSectionImmediate(_0x2a43cc,_0x494645=![]){const _0x416c59=a12_0x15ab,_0x3cc0f1=document['getElementById']('auth-section');if(!_0x3cc0f1)return;if(_0x2a43cc&&_0x494645)document['querySelectorAll'](_0x416c59(0x11c))['forEach'](_0x12b46b=>{const _0xe405f2=_0x416c59;_0x12b46b['style']['display']=_0xe405f2(0x10f);});else!_0x2a43cc&&document['querySelectorAll']('.admin-only')[_0x416c59(0x123)](_0x3346d2=>{_0x3346d2['style']['display']='none';});if(_0x2a43cc){const _0x4a345a=userCache[_0x416c59(0x11a)]||(_0x2a43cc['email']?_0x2a43cc[_0x416c59(0x112)]['split']('@')[0x0]:_0x416c59(0x113)),_0xbe201f=userCache['role']?'\x20('+userCache['role']+')':_0x494645?_0x416c59(0x108):'';_0x3cc0f1['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20class=\x22nav-username\x22>'+_0x4a345a+_0xbe201f+'</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username='+encodeURIComponent(_0x4a345a)+'\x22>Profile</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./inbox.html\x22\x20class=\x22nav-notification\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Inbox\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22inbox-notification\x22\x20class=\x22notification-dot\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22members.html\x22>Members</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./redeem.html\x22><i\x20class=\x22fas\x20fa-gift\x22></i>\x20Redeem</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20id=\x22logout-link\x22>Sign\x20Out</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';const _0xc6902b=document['getElementById'](_0x416c59(0x104));_0xc6902b&&_0xc6902b[_0x416c59(0x106)]('click',_0x110fcd=>{_0x110fcd['preventDefault']();const _0x2ce3d9=getAuth();updateAuthSectionImmediate(null),_0x2ce3d9['signOut']()['catch'](_0xf89241=>{const _0x50230b=a12_0x15ab;console[_0x50230b(0x122)]('Error\x20signing\x20out:',_0xf89241);});}),_0x2a43cc[_0x416c59(0xff)]&&setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0x2a43cc['uid']);},0x3e8);}else _0x3cc0f1['innerHTML']='<a\x20href=\x22login.html\x22\x20class=\x22login-link\x22>Login</a>';}async function checkAdminRoles(_0xb9f241){const _0x26f97a=a12_0x15ab;if(!_0xb9f241||!_0xb9f241[_0x26f97a(0x112)])return{'isAdmin':![],'role':null};try{console[_0x26f97a(0x117)]('Checking\x20roles\x20for\x20user:\x20'+_0xb9f241['email']);const _0x15b465=['players','playersD2',_0x26f97a(0xfe),_0x26f97a(0x111),'userProfiles'],_0x460693=[_0x26f97a(0xfd),'creative\x20lead','owner',_0x26f97a(0x11d)];for(const _0x13cf53 of _0x15b465){try{const _0x12d79b=doc(db,_0x13cf53,_0xb9f241['uid']),_0x3a431c=await getDoc(_0x12d79b);if(_0x3a431c[_0x26f97a(0x10d)]()){const _0x5872d8=_0x3a431c[_0x26f97a(0x114)]();console['log']('Found\x20user\x20in\x20'+_0x13cf53+'\x20by\x20UID:',_0x5872d8);let _0x690479=(_0x5872d8['roleName']||_0x5872d8['role']||'')['toLowerCase'](),_0x3aade0=_0x5872d8['roleName']||_0x5872d8['role']||'';if(_0x690479&&_0x460693[_0x26f97a(0x103)](_0x690479)){console['log'](_0x26f97a(0x100)+_0x690479+_0x26f97a(0x124)+_0x13cf53);const _0x3040aa=_0x3aade0['split']('\x20')['map'](_0x200c16=>_0x200c16['charAt'](0x0)['toUpperCase']()+_0x200c16['slice'](0x1)['toLowerCase']())['join']('\x20');return{'isAdmin':!![],'role':_0x3040aa};}}}catch(_0x2cb9a8){console['error']('Error\x20checking\x20'+_0x13cf53+'\x20by\x20UID:',_0x2cb9a8);}}for(const _0x3298b3 of _0x15b465){try{const _0x59b51b=collection(db,_0x3298b3);let _0x962a72=query(_0x59b51b,where('email','==',_0xb9f241['email'])),_0x187342=await getDocs(_0x962a72);_0x187342['empty']&&(_0x962a72=query(_0x59b51b,where('email','==',_0xb9f241[_0x26f97a(0x112)]['toLowerCase']())),_0x187342=await getDocs(_0x962a72));if(!_0x187342['empty']){const _0x525c70=_0x187342[_0x26f97a(0x127)][0x0][_0x26f97a(0x114)]();console[_0x26f97a(0x117)]('Found\x20user\x20in\x20'+_0x3298b3+'\x20by\x20email:',_0x525c70);let _0x415639=(_0x525c70['roleName']||_0x525c70['role']||'')['toLowerCase'](),_0x4de9d7=_0x525c70['roleName']||_0x525c70['role']||'';if(_0x415639&&_0x460693[_0x26f97a(0x103)](_0x415639)){console['log']('Found\x20admin\x20role:\x20'+_0x415639+'\x20in\x20'+_0x3298b3);const _0x3051a2=_0x4de9d7[_0x26f97a(0x101)]('\x20')['map'](_0xfe08ca=>_0xfe08ca[_0x26f97a(0x105)](0x0)['toUpperCase']()+_0xfe08ca[_0x26f97a(0x119)](0x1)['toLowerCase']())[_0x26f97a(0x10c)]('\x20');return{'isAdmin':!![],'role':_0x3051a2};}}}catch(_0x4d58e3){console['error'](_0x26f97a(0x102)+_0x3298b3+_0x26f97a(0x126),_0x4d58e3);}}return console['log'](_0x26f97a(0x109)),{'isAdmin':![],'role':null};}catch(_0x19ad0d){return console['error']('Error\x20in\x20checkAdminRoles:',_0x19ad0d),{'isAdmin':![],'role':null};}}async function updateAuthSection(_0x2545a7){const _0x35c2f0=a12_0x15ab,_0x4c823f=_0x2545a7&&isAdmin(_0x2545a7['email']);updateAuthSectionImmediate(_0x2545a7,_0x4c823f);if(!_0x2545a7){userCache['uid']=null,userCache['username']=null,userCache['isAdmin']=![],userCache['hasCheckedCollections']=![],userCache['role']=null;return;}const _0x3c6a24=Date['now']();if(_0x2545a7[_0x35c2f0(0xff)]===userCache[_0x35c2f0(0xff)]&&userCache['hasCheckedCollections']&&_0x3c6a24-userCache['lastChecked']<0x493e0)return;try{userCache[_0x35c2f0(0xff)]=_0x2545a7[_0x35c2f0(0xff)],userCache[_0x35c2f0(0x116)]=_0x3c6a24;const _0x3d957c=isAdmin(_0x2545a7['email']);userCache['isAdmin']=_0x3d957c;if(!_0x3d957c){const {isAdmin:_0x25f975,role:_0x409261}=await checkAdminRoles(_0x2545a7);userCache[_0x35c2f0(0x121)]=_0x25f975,userCache[_0x35c2f0(0x125)]=_0x409261,_0x25f975&&(document['querySelectorAll']('.admin-only')['forEach'](_0x185a35=>{const _0xe9b70d=_0x35c2f0;_0x185a35['style'][_0xe9b70d(0x10e)]='block';}),updateAuthSectionImmediate(_0x2545a7,!![]));}const _0xcbf1fe=[_0x35c2f0(0x11e),'playersD2','playersD3','playersDuos',_0x35c2f0(0x11b),'nonParticipants','userProfiles'],_0x2c8fdd=_0xcbf1fe[_0x35c2f0(0x115)](_0x1953a5=>getDoc(doc(db,_0x1953a5,_0x2545a7['uid']))['then'](_0x9f3e8=>_0x9f3e8['exists']()?{'collection':_0x1953a5,'data':_0x9f3e8[_0x35c2f0(0x114)]()}:null)['catch'](()=>null)),_0x1c233c=await Promise['all'](_0x2c8fdd),_0x55ee12=_0x1c233c['filter'](_0x2fb280=>_0x2fb280!==null);let _0x7f516c=null;for(const _0xb78203 of _0x55ee12){if(_0xb78203['data']['username']){_0x7f516c=_0xb78203['data']['username'];break;}}userCache['username']=_0x7f516c||(_0x2545a7[_0x35c2f0(0x112)]?_0x2545a7['email'][_0x35c2f0(0x101)]('@')[0x0]:'User'),userCache[_0x35c2f0(0x128)]=!![],updateAuthSectionImmediate(_0x2545a7,userCache['isAdmin']),setTimeout(()=>{const _0x44abec=_0x35c2f0;checkPendingInvitationsForCurrentUser(_0x2545a7[_0x44abec(0xff)]);},0x1f4);}catch(_0x4a3eca){console['error']('Error\x20in\x20full\x20auth\x20update:',_0x4a3eca);}}document['addEventListener']('DOMContentLoaded',()=>{const _0x316025=getAuth();onAuthStateChanged(_0x316025,async _0x255f4e=>{await updateAuthSection(_0x255f4e),_0x255f4e&&checkPendingInvitationsForCurrentUser(_0x255f4e['uid']);}),document['addEventListener']('visibilitychange',()=>{const _0x32d679=a12_0x15ab;!document['hidden']&&_0x316025[_0x32d679(0x110)]&&checkPendingInvitationsForCurrentUser(_0x316025['currentUser'][_0x32d679(0xff)]);}),document['addEventListener']('click',_0x1e8379=>{_0x1e8379['target']['closest']('a[href]')&&_0x316025['currentUser']&&checkPendingInvitationsForCurrentUser(_0x316025['currentUser']['uid']);});});function a12_0x56bd(){const _0x2f0c63=['pending','council','playersD3','uid','Found\x20admin\x20role:\x20','split','Error\x20checking\x20','includes','logout-link','charAt','addEventListener','console','\x20(Admin)','No\x20admin\x20roles\x20found\x20for\x20user','lastCheck','apply','join','exists','display','block','currentUser','nonParticipants','email','User','data','map','lastChecked','log','textContent','slice','username','playersCTF','.admin-only','admin','players','toString','checkInterval','isAdmin','error','forEach','\x20in\x20','role','\x20by\x20email:','docs','hasCheckedCollections'];a12_0x56bd=function(){return _0x2f0c63;};return a12_0x56bd();}export{updateAuthSection};
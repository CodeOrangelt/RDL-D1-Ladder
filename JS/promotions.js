const a44_0x3ca82d=a44_0x1fd5,a44_0x421f53=(function(){let _0x4de989=!![];return function(_0x2426ed,_0x56d14a){const _0x1621c1=_0x4de989?function(){if(_0x56d14a){const _0x4a3acd=_0x56d14a['apply'](_0x2426ed,arguments);return _0x56d14a=null,_0x4a3acd;}}:function(){};return _0x4de989=![],_0x1621c1;};}()),a44_0x424bc3=a44_0x421f53(this,function(){const _0x4168fa=a44_0x1fd5,_0x204c44=function(){let _0x177b71;try{_0x177b71=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x43ebb1){_0x177b71=window;}return _0x177b71;},_0x54916a=_0x204c44(),_0x574209=_0x54916a['console']=_0x54916a[_0x4168fa(0x200)]||{},_0x40bba1=['log',_0x4168fa(0x1f9),'info','error','exception',_0x4168fa(0x1e2),'trace'];for(let _0x19890a=0x0;_0x19890a<_0x40bba1[_0x4168fa(0x212)];_0x19890a++){const _0x1988c2=a44_0x421f53[_0x4168fa(0x22b)]['prototype']['bind'](a44_0x421f53),_0x233244=_0x40bba1[_0x19890a],_0x261042=_0x574209[_0x233244]||_0x1988c2;_0x1988c2['__proto__']=a44_0x421f53['bind'](a44_0x421f53),_0x1988c2['toString']=_0x261042[_0x4168fa(0x1f2)]['bind'](_0x261042),_0x574209[_0x233244]=_0x1988c2;}});a44_0x424bc3();import{collection,doc,query,where,orderBy,limit,getDocs,addDoc,getDoc,serverTimestamp,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a44_0x1fd5(_0x11b214,_0x10969a){const _0x424bc3=a44_0x1e9f();return a44_0x1fd5=function(_0x421f53,_0x4cec2a){_0x421f53=_0x421f53-0x1d7;let _0x1e9f60=_0x424bc3[_0x421f53];return _0x1e9f60;},a44_0x1fd5(_0x11b214,_0x10969a);}import{auth,db}from'./firebase-config.js';class PromotionManager{constructor(){const _0x7743a8=a44_0x1fd5;this[_0x7743a8(0x21b)]=0x18,this[_0x7743a8(0x1e4)]=[{'threshold':0x578,'name':_0x7743a8(0x1e7),'color':_0x7743a8(0x1de)},{'threshold':0x640,'name':'Silver','color':'#C0C0C0'},{'threshold':0x708,'name':'Gold','color':'#FFD700'},{'threshold':0x834,'name':'Emerald','color':'#50C878'}],this[_0x7743a8(0x1f3)]=null,this[_0x7743a8(0x210)]=0x0,this['fetchInterval']=0xea60,this['pollingInterval']=null,this['usernameCache']={};}['initialize'](){const _0x4eb4bc=a44_0x1fd5;this[_0x4eb4bc(0x1f3)]=document['getElementById'](_0x4eb4bc(0x229));if(!this[_0x4eb4bc(0x1f3)]){console['error']('Promotion\x20banner\x20container\x20not\x20found');return;}this['setupBannerContainer']();const _0x2926d5=_0x4eb4bc(0x232)+new Date()[_0x4eb4bc(0x231)](),_0xc4117b=sessionStorage['getItem'](_0x2926d5);!_0xc4117b&&(this['fetchRecentPromotions'](),sessionStorage['setItem'](_0x2926d5,'true')),document['addEventListener']('visibilitychange',()=>{const _0x46204e=_0x4eb4bc;document['visibilityState']==='visible'&&!sessionStorage[_0x46204e(0x1da)](_0x2926d5)&&(this[_0x46204e(0x222)](),sessionStorage['setItem'](_0x2926d5,'true'));}),window['addEventListener'](_0x4eb4bc(0x20b),()=>{const _0x53b4dd=_0x4eb4bc;this[_0x53b4dd(0x218)]&&clearInterval(this['pollingInterval']);});}[a44_0x3ca82d(0x20c)](){const _0x2a69c6=a44_0x3ca82d;this['bannerContainer']['innerHTML']='',this[_0x2a69c6(0x1f3)]['style'][_0x2a69c6(0x1fd)]='none';}async['fetchRecentPromotions'](){const _0x1ff6a2=a44_0x3ca82d;try{const _0x566649=Date['now']();if(_0x566649-this[_0x1ff6a2(0x210)]<this['fetchInterval'])return;this[_0x1ff6a2(0x210)]=_0x566649;const _0x2cd05e=collection(db,'eloHistory'),_0x51bb44=query(_0x2cd05e,where(_0x1ff6a2(0x225),'in',[_0x1ff6a2(0x214),_0x1ff6a2(0x1e0)]),orderBy('timestamp','desc'),limit(0x14)),_0x221e27=await getDocs(_0x51bb44),_0x3e269a=[];_0x221e27['forEach'](_0xd1871e=>{const _0x1205a4=_0x1ff6a2,_0x3e7001={'id':_0xd1871e['id'],..._0xd1871e[_0x1205a4(0x1d9)]()};this[_0x1205a4(0x1ee)](_0xd1871e['id'])&&this['isNewRankChange'](_0x3e7001)&&_0x3e269a[_0x1205a4(0x22a)](_0x3e7001);}),_0x3e269a['length']>0x0&&await this['processRankChanges'](_0x3e269a);}catch(_0x373648){console['error']('Error\x20fetching\x20promotions:',_0x373648);}}async['processRankChanges'](_0x56a840){const _0x138a94=a44_0x3ca82d;if(_0x56a840['length']===0x0)return;_0x56a840['sort']((_0x594054,_0x567db3)=>{const _0x5aea0c=a44_0x1fd5,_0xcc013c=_0x594054['timestamp']?.[_0x5aea0c(0x20e)]?.()||_0x594054['timestamp']?.['seconds']*0x3e8||0x0,_0x14dbfb=_0x567db3['timestamp']?.[_0x5aea0c(0x20e)]?.()||_0x567db3['timestamp']?.[_0x5aea0c(0x217)]*0x3e8||0x0;return _0x14dbfb-_0xcc013c;});const _0x2aab5e=this['bannerContainer'][_0x138a94(0x22f)][_0x138a94(0x212)],_0x31548e=0x3-_0x2aab5e;if(_0x31548e<=0x0)return;const _0x959bf3=_0x56a840['slice'](0x0,_0x31548e);for(let _0x5721e9=0x0;_0x5721e9<_0x959bf3['length'];_0x5721e9++){const _0x397321=_0x959bf3[_0x5721e9],_0x44cb75=auth['currentUser'];try{setTimeout(()=>{this['showRankChangeBanner'](_0x397321);},_0x5721e9*0x3e8),_0x44cb75&&_0x397321['player']===_0x44cb75[_0x138a94(0x1ef)]&&this['showRankChangeLightbox'](_0x397321['type'],_0x397321[_0x138a94(0x1f1)]);}catch(_0x2681e8){console[_0x138a94(0x20a)]('Error\x20processing\x20rank\x20change:',_0x2681e8);}}}['shouldShowPromotion'](_0x37aa87){const _0x4d979c=a44_0x3ca82d;try{const _0x21f5a4=_0x4d979c(0x235)+_0x37aa87,_0x1feafa=localStorage[_0x4d979c(0x1da)](_0x21f5a4);if(_0x1feafa){let _0x51eed3;try{_0x51eed3=JSON['parse'](_0x1feafa);}catch(_0x17d01c){return console['warn']('Invalid\x20storage\x20format\x20for\x20'+_0x21f5a4+',\x20treating\x20as\x20new'),!![];}if(_0x51eed3['ignored']===!![])return console['log']('Promotion\x20'+_0x37aa87+'\x20is\x20permanently\x20ignored'),![];const _0x178749=Date['now']();if(_0x51eed3[_0x4d979c(0x221)]&&_0x178749-_0x51eed3['timestamp']<this['DISPLAY_HOURS']*0x3c*0x3c*0x3e8)return console[_0x4d979c(0x224)]('Promotion\x20'+_0x37aa87+'\x20was\x20dismissed\x20by\x20user\x20within\x20last\x20'+this['DISPLAY_HOURS']+'\x20hours'),![];if(_0x51eed3['systemDismissed']&&_0x178749-_0x51eed3['timestamp']<0x4*0x3c*0x3c*0x3e8)return console['log']('Promotion\x20'+_0x37aa87+'\x20was\x20auto-dismissed\x20within\x20last\x204\x20hours'),![];}return!![];}catch(_0x53753d){return console[_0x4d979c(0x20a)]('Error\x20checking\x20promotion\x20visibility:',_0x53753d),![];}}[a44_0x3ca82d(0x21a)](_0x337a8){const _0x34d76d=a44_0x3ca82d;try{const _0x24bcd8='promotion_'+_0x337a8;localStorage['setItem'](_0x24bcd8,JSON[_0x34d76d(0x1dd)]({'timestamp':Date[_0x34d76d(0x234)](),'ignored':!![]}));}catch(_0x39f20f){console['error']('Error\x20saving\x20promotion\x20preference:',_0x39f20f);}}['showRankChangeBanner'](_0xe8185f){this['resolveUserId'](_0xe8185f)['then'](_0x288bd6=>{const _0x285926=a44_0x1fd5,_0xebf20a='promotion_'+_0xe8185f['id'],_0x9f2f9d=localStorage['getItem'](_0xebf20a);if(_0x9f2f9d)try{const _0x1a3800=JSON['parse'](_0x9f2f9d);if(_0x1a3800['ignored']===!![]){console['log']('Skipping\x20ignored\x20promotion:\x20'+_0xe8185f['id']);return;}}catch(_0x10564b){}localStorage['setItem'](_0xebf20a,JSON[_0x285926(0x1dd)]({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':![],'seenAt':Date['now']()})),this[_0x285926(0x1f3)]['style']['display']=_0x285926(0x213);while(this['bannerContainer']['children']['length']>=0x3){this['bannerContainer']['removeChild'](this[_0x285926(0x1f3)]['firstChild']);}const _0x28ef2e=document[_0x285926(0x204)]('div');_0x28ef2e['className']=_0x285926(0x223),_0x28ef2e[_0x285926(0x1ea)]('data-rank',_0x288bd6['rankAchieved']),_0x28ef2e['setAttribute']('data-id',_0x288bd6['id']);const _0x4f92c3=document['createElement']('div');_0x4f92c3['className']=_0x285926(0x1f8);const _0x113bb3=_0x288bd6[_0x285926(0x228)]||_0x288bd6['player']||_0x288bd6[_0x285926(0x1e9)]||_0x288bd6[_0x285926(0x226)]||_0x288bd6['displayName']||_0x285926(0x233),_0x14c9ea=_0x288bd6['type']===_0x285926(0x214)?_0x113bb3+'\x20was\x20promoted\x20to':_0x113bb3+'\x20was\x20demoted\x20to';_0x4f92c3['innerHTML']=_0x14c9ea+_0x285926(0x21f)+_0x288bd6['rankAchieved']+'</span>';const _0x297368=document[_0x285926(0x204)]('div');_0x297368['className']='banner-actions';const _0x4d124b=document[_0x285926(0x204)]('button');_0x4d124b['className']='dismiss-btn',_0x4d124b['innerHTML']='&times;',_0x4d124b[_0x285926(0x20d)]='Dismiss';const _0x472fd7=document[_0x285926(0x204)]('button');_0x472fd7[_0x285926(0x1e8)]='ignore-btn',_0x472fd7['textContent']=_0x285926(0x22c),_0x472fd7[_0x285926(0x20d)]=_0x285926(0x20f),_0x297368[_0x285926(0x220)](_0x472fd7),_0x297368[_0x285926(0x220)](_0x4d124b),_0x28ef2e['appendChild'](_0x4f92c3),_0x28ef2e[_0x285926(0x220)](_0x297368),this['bannerContainer'][_0x285926(0x220)](_0x28ef2e),void _0x28ef2e[_0x285926(0x209)],setTimeout(()=>{const _0x34d333=_0x285926;_0x28ef2e[_0x34d333(0x202)][_0x34d333(0x203)](_0x34d333(0x207));},0x32),_0x4d124b['addEventListener'](_0x285926(0x1f4),()=>{const _0x788b46=_0x285926;localStorage['setItem'](_0xebf20a,JSON['stringify']({'timestamp':Date[_0x788b46(0x234)](),'ignored':![],'userDismissed':!![],'systemDismissed':![]})),_0x28ef2e['classList'][_0x788b46(0x22e)](_0x788b46(0x207)),_0x28ef2e[_0x788b46(0x202)]['add']('dismissing'),setTimeout(()=>{const _0x3b4056=_0x788b46;_0x28ef2e['parentNode']&&(_0x28ef2e['remove'](),this['bannerContainer'][_0x3b4056(0x22f)]['length']===0x0&&(this['bannerContainer']['style']['display']='none'));},0x1f4);}),_0x472fd7['addEventListener']('click',()=>{const _0x534668=_0x285926;localStorage[_0x534668(0x21c)](_0xebf20a,JSON['stringify']({'timestamp':Date['now'](),'ignored':!![],'userDismissed':!![],'systemDismissed':![]})),_0x28ef2e['classList'][_0x534668(0x22e)]('new-rank-change'),_0x28ef2e['classList']['add']('dismissing'),setTimeout(()=>{const _0x51bc5f=_0x534668;_0x28ef2e['parentNode']&&(_0x28ef2e[_0x51bc5f(0x22e)](),this['bannerContainer']['children']['length']===0x0&&(this['bannerContainer']['style']['display']=_0x51bc5f(0x211)));},0x1f4);}),setTimeout(()=>{const _0x1a7478=_0x285926;_0x28ef2e['parentNode']&&(_0x28ef2e['classList']['remove']('new-rank-change'),_0x28ef2e['classList']['add'](_0x1a7478(0x227)),localStorage['setItem'](_0xebf20a,JSON[_0x1a7478(0x1dd)]({'timestamp':Date[_0x1a7478(0x234)](),'ignored':![],'userDismissed':![],'systemDismissed':!![]})),setTimeout(()=>{const _0x2f618d=_0x1a7478;_0x28ef2e['parentNode']&&(_0x28ef2e[_0x2f618d(0x22e)](),this['bannerContainer']['children']['length']===0x0&&(this['bannerContainer'][_0x2f618d(0x1df)]['display']='none'));},0x1f4));},0x3a98);});}async['resolveUserId'](_0x544ae5){const _0x347e50=a44_0x3ca82d,_0x451ffd={..._0x544ae5},_0x25aaee=[_0x544ae5[_0x347e50(0x1e3)],_0x544ae5['username'],_0x544ae5['playerUsername'],_0x544ae5['displayName']],_0x839da6=_0x25aaee['some'](_0x209f32=>_0x209f32&&typeof _0x209f32===_0x347e50(0x206)&&!_0x209f32['includes']('ID:')&&!/^[a-zA-Z0-9]{20,}$/['test'](_0x209f32));if(_0x839da6)return _0x451ffd;let _0x4a86fa=null;if(_0x544ae5[_0x347e50(0x1f6)])_0x4a86fa=_0x544ae5['userId'];else _0x544ae5['player']&&/^[A-Za-z0-9]{20,}$/['test'](_0x544ae5['player'])&&(_0x4a86fa=_0x544ae5['player']);if(!_0x4a86fa)return _0x451ffd;try{const _0x54fae1=await getDoc(doc(db,_0x347e50(0x1ec),_0x4a86fa));if(_0x54fae1['exists']()){const _0x48c7b1=_0x54fae1['data']();if(_0x48c7b1['username'])return _0x451ffd['resolvedName']=_0x48c7b1[_0x347e50(0x1e9)],_0x451ffd;}const _0x33b450=await getDocs(query(collection(db,_0x347e50(0x1fb)),where('winnerId','==',_0x4a86fa),orderBy(_0x347e50(0x1fe),'desc'),limit(0x1)));if(!_0x33b450['empty']){const _0x115640=_0x33b450['docs'][0x0][_0x347e50(0x1d9)]();if(_0x115640['winnerUsername'])return _0x451ffd['resolvedName']=_0x115640['winnerUsername'],_0x451ffd;}const _0x5c4e6e=await getDocs(query(collection(db,_0x347e50(0x1fb)),where(_0x347e50(0x1fc),'==',_0x4a86fa),orderBy(_0x347e50(0x1fe),'desc'),limit(0x1)));if(!_0x5c4e6e['empty']){const _0x2b906d=_0x5c4e6e[_0x347e50(0x21e)][0x0][_0x347e50(0x1d9)]();if(_0x2b906d['loserUsername'])return _0x451ffd['resolvedName']=_0x2b906d['loserUsername'],console[_0x347e50(0x224)]('Resolved\x20'+_0x4a86fa+'\x20to\x20'+_0x2b906d['loserUsername']+'\x20(loser)'),_0x451ffd;}}catch(_0x55c8a8){console[_0x347e50(0x20a)]('Error\x20resolving\x20user\x20ID:',_0x55c8a8);}return console['warn']('Failed\x20to\x20resolve\x20user\x20ID:\x20'+_0x4a86fa),_0x451ffd;}[a44_0x3ca82d(0x1d7)](_0x173eda,_0x519afd){const _0x5e8307=a44_0x3ca82d;let _0x274fee=document['getElementById']('rankChangeModal');!_0x274fee&&(_0x274fee=document['createElement']('div'),_0x274fee['id']='rankChangeModal',_0x274fee['className']='rank-change-modal\x20'+_0x173eda,document['body']['appendChild'](_0x274fee));const _0xd43850=_0x173eda==='promotion'?'Congratulations!':'Rank\x20Update',_0x3718ca=_0x173eda==='promotion'?'You\x27ve\x20been\x20promoted\x20to':'You\x27ve\x20been\x20demoted\x20to';_0x274fee['innerHTML']=_0x5e8307(0x1d8)+_0xd43850+'</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>'+_0x3718ca+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22rank-name\x22>'+_0x519afd+'</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22rank-change-button\x22\x20id=\x22rank-change-ok-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Got\x20it!\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x274fee[_0x5e8307(0x1df)]['display']=_0x5e8307(0x1e6),document['getElementById']('rank-change-ok-btn')['addEventListener'](_0x5e8307(0x1f4),()=>{const _0x109dd8=_0x5e8307;_0x274fee['style'][_0x109dd8(0x1fd)]='none';}),_0x274fee['addEventListener']('click',_0x295208=>{const _0x2fb2da=_0x5e8307;_0x295208[_0x2fb2da(0x219)]===_0x274fee&&(_0x274fee['style'][_0x2fb2da(0x1fd)]='none');});}async['checkAndRecordPromotion'](_0x5a8455,_0x493544,_0x27695f,_0x1b00b9={}){const _0x2b93a8=a44_0x3ca82d;try{if(_0x493544===_0x27695f||!_0x5a8455)return null;const _0x40b45=_0x1b00b9['source']||_0x2b93a8(0x1ed),_0x2579fd=_0x1b00b9['matchId']||null,_0x26b770=_0x1b00b9['adminUser']||null;console[_0x2b93a8(0x224)]('Processing\x20potential\x20rank\x20change:\x20'+_0x27695f+'\x20→\x20'+_0x493544+'\x20(source:\x20'+_0x40b45+')');let _0x20d7d7=null,_0x28c42b=null;try{const _0x342867=await getDoc(doc(db,'players',_0x5a8455));if(_0x342867['exists']()){const _0x4a7463=_0x342867['data']();_0x20d7d7=_0x4a7463['username']||_0x4a7463['displayName']||null,_0x28c42b=_0x4a7463['displayName']||_0x4a7463[_0x2b93a8(0x1e9)]||null;}!_0x20d7d7&&_0x1b00b9['username']&&(_0x20d7d7=_0x1b00b9['username'],_0x28c42b=_0x1b00b9['username']);!_0x20d7d7&&auth['currentUser']&&(_0x20d7d7=auth[_0x2b93a8(0x230)]['displayName']||auth['currentUser']['email'][_0x2b93a8(0x1f0)]('@')[0x0],_0x28c42b=auth['currentUser'][_0x2b93a8(0x1ef)]||null);if(!_0x20d7d7){const _0x4014f2=query(collection(db,_0x2b93a8(0x1fb)),where('winnerId','==',_0x5a8455),limit(0x1)),_0x5de6c4=await getDocs(_0x4014f2);if(!_0x5de6c4['empty'])_0x20d7d7=_0x5de6c4[_0x2b93a8(0x21e)][0x0]['data']()['winnerUsername']||_0x2b93a8(0x1dc),_0x28c42b=_0x20d7d7;else{const _0x2f24d9=query(collection(db,'approvedMatches'),where('loserId','==',_0x5a8455),limit(0x1)),_0x3196cc=await getDocs(_0x2f24d9);!_0x3196cc['empty']&&(_0x20d7d7=_0x3196cc[0x0][_0x2b93a8(0x1d9)]()[_0x2b93a8(0x208)]||'Unknown\x20Player',_0x28c42b=_0x20d7d7);}}}catch(_0x201fd5){console['error'](_0x2b93a8(0x1e1),_0x201fd5);}!_0x20d7d7&&(console['warn'](_0x2b93a8(0x1db),_0x5a8455),_0x20d7d7='A\x20player',_0x28c42b=_0x2b93a8(0x1dc));const _0x118576=this['getRankName'](_0x27695f),_0x10beed=this['getRankName'](_0x493544);if(_0x118576!==_0x10beed){const _0x2e2328=_0x493544>_0x27695f,_0x4f5943=_0x2e2328?_0x2b93a8(0x214):_0x2b93a8(0x1e0),_0x31bc72=_0x10beed;console['log']('Recording\x20'+_0x4f5943+'\x20for\x20'+_0x20d7d7+':\x20'+_0x27695f+'\x20('+_0x118576+')\x20→\x20'+_0x493544+'\x20('+_0x10beed+')');try{const _0x6025d2={'player':_0x20d7d7,'playerUsername':_0x20d7d7,'username':_0x20d7d7,'displayName':_0x28c42b,'userId':_0x5a8455,'type':_0x4f5943,'rankAchieved':_0x31bc72,'timestamp':serverTimestamp(),'previousElo':_0x27695f,'newElo':_0x493544,'change':_0x493544-_0x27695f,'previousRank':_0x118576,'newRank':_0x10beed,'source':_0x40b45};if(_0x40b45===_0x2b93a8(0x205)&&_0x2579fd)_0x6025d2['matchId']=_0x2579fd;else _0x40b45==='admin'&&_0x26b770?(_0x6025d2['modifiedBy']=_0x26b770,_0x6025d2['isAutomatic']=![]):_0x6025d2['isAutomatic']=!![];const _0x4ef579=writeBatch(db),_0x408a53=doc(collection(db,'eloHistory')),_0x4e7227=doc(collection(db,'promotionHistory'));return _0x4ef579[_0x2b93a8(0x1e5)](_0x408a53,_0x6025d2),_0x4ef579['set'](_0x4e7227,_0x6025d2),await _0x4ef579['commit'](),await this['sendPromotionNotification'](_0x5a8455,_0x20d7d7,_0x27695f,_0x493544,_0x118576,_0x10beed,_0x4f5943,{'displayName':_0x28c42b,'source':_0x40b45,'matchId':_0x2579fd,'ladder':_0x1b00b9['ladder']||'D1'}),console[_0x2b93a8(0x224)]('Successfully\x20recorded\x20'+_0x4f5943+'\x20for\x20'+_0x20d7d7+'\x20to\x20'+_0x31bc72),_0x31bc72;}catch(_0x4caf81){console[_0x2b93a8(0x20a)]('Error\x20writing\x20promotion\x20records:',_0x4caf81);try{return await addDoc(collection(db,_0x2b93a8(0x201)),{'player':_0x20d7d7,'playerUsername':_0x20d7d7,'username':_0x20d7d7,'displayName':_0x28c42b,'userId':_0x5a8455,'type':_0x4f5943,'rankAchieved':_0x31bc72,'timestamp':serverTimestamp(),'previousElo':_0x27695f,'newElo':_0x493544,'change':_0x493544-_0x27695f,'previousRank':_0x118576,'source':_0x40b45,'isAutomatic':_0x40b45!=='admin'}),await this['sendPromotionNotification'](_0x5a8455,_0x20d7d7,_0x27695f,_0x493544,_0x118576,_0x10beed,_0x4f5943,{'displayName':_0x28c42b,'source':_0x40b45,'matchId':_0x2579fd,'ladder':_0x1b00b9[_0x2b93a8(0x22d)]||'D1'}),_0x31bc72;}catch(_0x5b6235){return console['error']('Fallback\x20write\x20failed:',_0x5b6235),null;}}}return null;}catch(_0x2560a8){return console['error']('Error\x20in\x20promotion/demotion\x20recording:',_0x2560a8),null;}}['getRankName'](_0x174195){for(let _0x5bf3a1=this['RANKS']['length']-0x1;_0x5bf3a1>=0x0;_0x5bf3a1--){if(_0x174195>=this['RANKS'][_0x5bf3a1]['threshold'])return this['RANKS'][_0x5bf3a1]['name'];}return'Unranked';}[a44_0x3ca82d(0x215)](){this['pollingInterval']&&clearInterval(this['pollingInterval']);}['isNewRankChange'](_0x1602f7){const _0x3d66ef=a44_0x3ca82d;if(_0x1602f7['timestamp']){const _0x42fd76=_0x1602f7['timestamp']['seconds']*0x3e8,_0x18e805=Date[_0x3d66ef(0x234)](),_0xf3609=(_0x18e805-_0x42fd76)/(0x3e8*0x3c*0x3c);if(_0xf3609>0x18)return![];}if(_0x1602f7['previousRank']&&_0x1602f7['newRank']&&_0x1602f7[_0x3d66ef(0x1eb)]!==_0x1602f7[_0x3d66ef(0x21d)])return!![];return![];}async[a44_0x3ca82d(0x1f7)](_0xe0e5c6,_0x2c5efe,_0x31b9f4,_0x207f32,_0x1b7ac6,_0x59696a,_0x30c579,_0x450284={}){const _0x285ee7=a44_0x3ca82d;try{console['log'](_0x285ee7(0x1fa)+_0x2c5efe+'\x27s\x20'+_0x30c579);const _0x2a26d2={'userId':_0xe0e5c6,'username':_0x2c5efe,'displayName':_0x450284[_0x285ee7(0x1ef)]||_0x2c5efe,'oldElo':parseInt(_0x31b9f4),'newElo':parseInt(_0x207f32),'eloDifference':parseInt(_0x207f32)-parseInt(_0x31b9f4),'oldRank':_0x1b7ac6,'newRank':_0x59696a,'type':_0x30c579,'timestamp':serverTimestamp(),'processed':![],'source':_0x450284[_0x285ee7(0x1f5)]||'automatic','matchId':_0x450284['matchId']||null,'ladder':_0x450284['ladder']||'D1','adminUser':_0x450284['adminUser']||null};console['log'](_0x285ee7(0x216),_0x2a26d2);const _0x215355=await addDoc(collection(db,'promotionNotifications'),_0x2a26d2);return console['log']('Discord\x20notification\x20sent\x20successfully\x20with\x20ID:\x20'+_0x215355['id']),!![];}catch(_0x3b5a29){return console['error']('Error\x20sending\x20Discord\x20notification:',_0x3b5a29),![];}}}export const promotionManager=new PromotionManager();document['addEventListener']('DOMContentLoaded',()=>{promotionManager['initialize']();});export const initializePromotionTracker=()=>promotionManager['initialize']();export const checkAndRecordPromotion=(_0x536e70,_0xc70e7c,_0x3904f4,_0x3fc1ac)=>promotionManager[a44_0x3ca82d(0x1ff)](_0x536e70,_0xc70e7c,_0x3904f4,_0x3fc1ac);function a44_0x1e9f(){const _0x3a8085=['showRankChangeLightbox','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rank-change-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2\x20class=\x22rank-change-title\x22>','data','getItem','Could\x20not\x20resolve\x20username\x20for\x20userId:','Unknown\x20Player','stringify','#CD7F32','style','demotion','Error\x20resolving\x20username:','table','player','RANKS','set','flex','Bronze','className','username','setAttribute','previousRank','players','automatic','shouldShowPromotion','displayName','split','rankAchieved','toString','bannerContainer','click','source','userId','sendPromotionNotification','promotion-details','warn','STARTING\x20notification\x20for\x20','approvedMatches','loserId','display','date','checkAndRecordPromotion','console','eloHistory','classList','add','createElement','match','string','new-rank-change','loserUsername','offsetWidth','error','beforeunload','setupBannerContainer','title','toMillis','Never\x20show\x20this\x20promotion\x20again','lastFetchTime','none','length','block','promotion','cleanup','Creating\x20Discord\x20notification:','seconds','pollingInterval','target','ignorePromotion','DISPLAY_HOURS','setItem','newRank','docs','\x20<span\x20class=\x22rank-text\x22>','appendChild','userDismissed','fetchRecentPromotions','promotion-banner','log','type','playerUsername','dismissing','resolvedName','promotion-banner-container','push','constructor','Don\x27t\x20show\x20again','ladder','remove','children','currentUser','toDateString','promotions_checked_','A\x20player','now','promotion_'];a44_0x1e9f=function(){return _0x3a8085;};return a44_0x1e9f();}export const getRankName=_0x2d90b3=>promotionManager['getRankName'](_0x2d90b3);
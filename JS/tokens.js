const a52_0x4a3ee4=(function(){let _0x2142a7=!![];return function(_0x2439ac,_0x2137c6){const _0x4beff6=_0x2142a7?function(){const _0x47f037=a52_0x41db;if(_0x2137c6){const _0x4ac76a=_0x2137c6[_0x47f037(0x142)](_0x2439ac,arguments);return _0x2137c6=null,_0x4ac76a;}}:function(){};return _0x2142a7=![],_0x4beff6;};}()),a52_0x4d08e2=a52_0x4a3ee4(this,function(){const _0x3c6c90=a52_0x41db,_0x2482e3=function(){let _0x3488cf;try{_0x3488cf=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x439418){_0x3488cf=window;}return _0x3488cf;},_0x1ce01f=_0x2482e3(),_0x4c90fa=_0x1ce01f[_0x3c6c90(0x132)]=_0x1ce01f[_0x3c6c90(0x132)]||{},_0x211ef5=['log',_0x3c6c90(0x131),_0x3c6c90(0x136),'error',_0x3c6c90(0x143),'table','trace'];for(let _0x2b2ded=0x0;_0x2b2ded<_0x211ef5['length'];_0x2b2ded++){const _0x2b0b46=a52_0x4a3ee4['constructor']['prototype'][_0x3c6c90(0x144)](a52_0x4a3ee4),_0x461558=_0x211ef5[_0x2b2ded],_0x3cd69e=_0x4c90fa[_0x461558]||_0x2b0b46;_0x2b0b46[_0x3c6c90(0x135)]=a52_0x4a3ee4[_0x3c6c90(0x144)](a52_0x4a3ee4),_0x2b0b46[_0x3c6c90(0x13d)]=_0x3cd69e['toString']['bind'](_0x3cd69e),_0x4c90fa[_0x461558]=_0x2b0b46;}});function a52_0x41db(_0x1f7c88,_0x34061e){const _0x4d08e2=a52_0x31be();return a52_0x41db=function(_0x4a3ee4,_0x3598b7){_0x4a3ee4=_0x4a3ee4-0x12f;let _0x31beb9=_0x4d08e2[_0x4a3ee4];return _0x31beb9;},a52_0x41db(_0x1f7c88,_0x34061e);}a52_0x4d08e2();import{doc,getDoc,getDocs,collection}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const tokenCache=new Map(),CACHE_DURATION=0x5*0x3c*0x3e8;export async function getUserTokens(_0x3a3479){const _0x4dac04=a52_0x41db,_0x316de9='tokens_'+_0x3a3479,_0x2b555a=tokenCache['get'](_0x316de9);if(_0x2b555a&&Date['now']()-_0x2b555a[_0x4dac04(0x134)]<CACHE_DURATION)return _0x2b555a['tokens'];try{const _0x1a4b03=doc(db,_0x4dac04(0x146),_0x3a3479),_0x130875=await getDoc(_0x1a4b03);let _0x7b1a28=[];return _0x130875['exists']()&&(_0x7b1a28=_0x130875['data']()['tokens']||[]),tokenCache['set'](_0x316de9,{'tokens':_0x7b1a28,'timestamp':Date['now']()}),_0x7b1a28;}catch(_0x19c3c9){return console[_0x4dac04(0x145)](_0x4dac04(0x138),_0x19c3c9),[];}}export async function getBulkUserTokens(_0x108d25){const _0x5b32e3=a52_0x41db,_0x56c79b=new Map(),_0x1b31d0=[];_0x108d25['forEach'](_0x356ccf=>{const _0x2f4a02=a52_0x41db,_0x35f251='tokens_'+_0x356ccf,_0x375101=tokenCache[_0x2f4a02(0x13e)](_0x35f251);_0x375101&&Date[_0x2f4a02(0x140)]()-_0x375101['timestamp']<CACHE_DURATION?_0x56c79b[_0x2f4a02(0x141)](_0x356ccf,_0x375101['tokens']):_0x1b31d0['push'](_0x356ccf);});if(_0x1b31d0[_0x5b32e3(0x13f)]>0x0)try{const _0x111d60=_0x1b31d0['map'](async _0x1450e5=>{const _0x3f7232=_0x5b32e3,_0x57fa7f=doc(db,_0x3f7232(0x146),_0x1450e5),_0x2dd693=await getDoc(_0x57fa7f);let _0x2616a9=[];_0x2dd693['exists']()&&(_0x2616a9=_0x2dd693['data']()['tokens']||[]);const _0x1a53ca='tokens_'+_0x1450e5;return tokenCache['set'](_0x1a53ca,{'tokens':_0x2616a9,'timestamp':Date[_0x3f7232(0x140)]()}),[_0x1450e5,_0x2616a9];}),_0x21ef1d=await Promise['all'](_0x111d60);_0x21ef1d[_0x5b32e3(0x133)](([_0x1e6ad8,_0x5e4c74])=>{const _0x2af522=_0x5b32e3;_0x56c79b[_0x2af522(0x141)](_0x1e6ad8,_0x5e4c74);});}catch(_0x30578e){console['error']('Error\x20fetching\x20bulk\x20user\x20tokens:',_0x30578e);}return _0x56c79b;}export async function getTokensByUsernames(_0x155e24){const _0x5614e9=a52_0x41db,_0x2fc027=new Map();try{const _0x3dd734=collection(db,'userProfiles'),_0x25fd0d=await getDocs(_0x3dd734),_0x3b0d12=new Map();_0x25fd0d['forEach'](_0x504ba3=>{const _0x1484b1=a52_0x41db,_0x44c433=_0x504ba3['data']();_0x44c433[_0x1484b1(0x12f)]&&_0x155e24['includes'](_0x44c433['username'])&&_0x3b0d12[_0x1484b1(0x141)](_0x44c433['username'],_0x504ba3['id']);});const _0x283492=Array['from'](_0x3b0d12['values']());if(_0x283492[_0x5614e9(0x13f)]>0x0){const _0x47243a=await getBulkUserTokens(_0x283492);_0x3b0d12['forEach']((_0x1a2eb9,_0x50b563)=>{const _0x5d5f77=_0x5614e9,_0x3c1e46=_0x47243a['get'](_0x1a2eb9)||[];_0x2fc027[_0x5d5f77(0x141)](_0x50b563,_0x3c1e46);});}}catch(_0x114f8e){console['error']('Error\x20fetching\x20tokens\x20by\x20usernames:',_0x114f8e);}return _0x2fc027;}export function clearTokenCache(_0x2f4b7c=null){const _0xf3f9b8=a52_0x41db;if(_0x2f4b7c){const _0x31bb93='tokens_'+_0x2f4b7c;tokenCache[_0xf3f9b8(0x13c)](_0x31bb93),console[_0xf3f9b8(0x13a)]('🗑️\x20Cleared\x20token\x20cache\x20for\x20user:\x20'+_0x2f4b7c);}else tokenCache['clear'](),console['log']('🗑️\x20Cleared\x20all\x20token\x20cache');}export async function forceRefreshUserTokens(_0x50808e){return clearTokenCache(_0x50808e),await getUserTokens(_0x50808e);}export function getPrimaryDisplayToken(_0x2d58bb){if(!_0x2d58bb||_0x2d58bb['length']===0x0)return null;const _0x5e4331=_0x2d58bb['find'](_0x20871b=>_0x20871b['equipped']===!![]);if(_0x5e4331)return _0x5e4331;const _0x1b43fb=[..._0x2d58bb]['sort']((_0x4712ab,_0x22075d)=>{const _0x5a584a=a52_0x41db;let _0x2d32c7,_0x20ef5b;if(_0x4712ab['purchasedAt']){if(_0x4712ab['purchasedAt']['seconds'])_0x2d32c7=_0x4712ab['purchasedAt'][_0x5a584a(0x137)];else{if(_0x4712ab[_0x5a584a(0x130)]instanceof Date)_0x2d32c7=_0x4712ab['purchasedAt'][_0x5a584a(0x139)]()/0x3e8;else typeof _0x4712ab[_0x5a584a(0x130)]===_0x5a584a(0x13b)?_0x2d32c7=new Date(_0x4712ab['purchasedAt'])['getTime']()/0x3e8:_0x2d32c7=0x0;}}else _0x2d32c7=0x0;if(_0x22075d['purchasedAt']){if(_0x22075d['purchasedAt']['seconds'])_0x20ef5b=_0x22075d[_0x5a584a(0x130)]['seconds'];else{if(_0x22075d['purchasedAt']instanceof Date)_0x20ef5b=_0x22075d[_0x5a584a(0x130)]['getTime']()/0x3e8;else typeof _0x22075d['purchasedAt']==='string'?_0x20ef5b=new Date(_0x22075d['purchasedAt'])['getTime']()/0x3e8:_0x20ef5b=0x0;}}else _0x20ef5b=0x0;return _0x20ef5b-_0x2d32c7;});return _0x1b43fb[0x0];}function a52_0x31be(){const _0x4c1e6c=['username','purchasedAt','warn','console','forEach','timestamp','__proto__','info','seconds','Error\x20fetching\x20user\x20tokens:','getTime','log','string','delete','toString','get','length','now','set','apply','exception','bind','error','userTokens'];a52_0x31be=function(){return _0x4c1e6c;};return a52_0x31be();}
(function(_0x8ee2dc,_0x26f3b6){const _0x1d67df=a30_0x1a48,_0x248f51=_0x8ee2dc();while(!![]){try{const _0x274a7a=parseInt(_0x1d67df(0x105))/0x1*(-parseInt(_0x1d67df(0xf7))/0x2)+parseInt(_0x1d67df(0x10f))/0x3+parseInt(_0x1d67df(0x10b))/0x4*(-parseInt(_0x1d67df(0x12a))/0x5)+-parseInt(_0x1d67df(0x11f))/0x6+-parseInt(_0x1d67df(0x11c))/0x7+-parseInt(_0x1d67df(0x11a))/0x8*(-parseInt(_0x1d67df(0x10d))/0x9)+parseInt(_0x1d67df(0xf5))/0xa;if(_0x274a7a===_0x26f3b6)break;else _0x248f51['push'](_0x248f51['shift']());}catch(_0x16e94e){_0x248f51['push'](_0x248f51['shift']());}}}(a30_0x44ce,0xd3603));const a30_0x552e14=(function(){let _0x48e6f0=!![];return function(_0x4398b9,_0x538b38){const _0x2bac23=_0x48e6f0?function(){if(_0x538b38){const _0x47d3e5=_0x538b38['apply'](_0x4398b9,arguments);return _0x538b38=null,_0x47d3e5;}}:function(){};return _0x48e6f0=![],_0x2bac23;};}()),a30_0x450627=a30_0x552e14(this,function(){const _0xd2668a=a30_0x1a48;return a30_0x450627[_0xd2668a(0x108)]()[_0xd2668a(0xf6)](_0xd2668a(0x102))[_0xd2668a(0x108)]()[_0xd2668a(0xfb)](a30_0x450627)[_0xd2668a(0xf6)]('(((.+)+)+)+$');});a30_0x450627();const a30_0x1cd079=(function(){let _0x232843=!![];return function(_0x364d63,_0x1f5576){const _0x2bf1b4=_0x232843?function(){if(_0x1f5576){const _0x4e1f34=_0x1f5576['apply'](_0x364d63,arguments);return _0x1f5576=null,_0x4e1f34;}}:function(){};return _0x232843=![],_0x2bf1b4;};}()),a30_0x445fa5=a30_0x1cd079(this,function(){const _0x577d0e=a30_0x1a48,_0x6b94bc=function(){const _0x35e28f=a30_0x1a48;let _0x40fe06;try{_0x40fe06=Function(_0x35e28f(0xf8)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x4722f3){_0x40fe06=window;}return _0x40fe06;},_0x23aa21=_0x6b94bc(),_0x820ca2=_0x23aa21[_0x577d0e(0xf3)]=_0x23aa21[_0x577d0e(0xf3)]||{},_0x194470=[_0x577d0e(0x118),'warn','info',_0x577d0e(0x11b),_0x577d0e(0x126),_0x577d0e(0x119),_0x577d0e(0x114)];for(let _0x2df3b7=0x0;_0x2df3b7<_0x194470[_0x577d0e(0x123)];_0x2df3b7++){const _0x2b6e50=a30_0x1cd079['constructor']['prototype'][_0x577d0e(0xf4)](a30_0x1cd079),_0x646ae2=_0x194470[_0x2df3b7],_0x20bcd4=_0x820ca2[_0x646ae2]||_0x2b6e50;_0x2b6e50['__proto__']=a30_0x1cd079[_0x577d0e(0xf4)](a30_0x1cd079),_0x2b6e50[_0x577d0e(0x108)]=_0x20bcd4[_0x577d0e(0x108)][_0x577d0e(0xf4)](_0x20bcd4),_0x820ca2[_0x646ae2]=_0x2b6e50;}});a30_0x445fa5();import{collection,doc,getDoc,getDocs,updateDoc,setDoc,deleteDoc,writeBatch,query,where,serverTimestamp,addDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';import{recordEloChange}from'./elo-history.js';import{promotionManager,checkAndRecordPromotion}from'./promotions.js';import{isAdmin}from'./admin-check.js';export function calculateElo(_0x2040cc,_0x1a08e1,_0x5b5d30=0x20){const _0x49192c=a30_0x1a48,_0x1926eb=0x1/(0x1+Math[_0x49192c(0x120)](0xa,(_0x1a08e1-_0x2040cc)/0x190)),_0x21c302=0x1/(0x1+Math['pow'](0xa,(_0x2040cc-_0x1a08e1)/0x190)),_0x3ee7a9=_0x2040cc+_0x5b5d30*(0x1-_0x1926eb),_0x22ac3a=_0x1a08e1+_0x5b5d30*(0x0-_0x21c302);return{'newWinnerRating':Math['round'](_0x3ee7a9),'newLoserRating':Math[_0x49192c(0xfa)](_0x22ac3a)};}function a30_0x1a48(_0xfeb631,_0x1db015){const _0x19c492=a30_0x44ce();return a30_0x1a48=function(_0x445fa5,_0x1cd079){_0x445fa5=_0x445fa5-0xef;let _0x5ca516=_0x19c492[_0x445fa5];return _0x5ca516;},a30_0x1a48(_0xfeb631,_0x1db015);}export function assignDefaultEloRating(_0xb288c3,_0x1c83c9){const _0x407370=a30_0x1a48,_0x5e895a=0x4b0;!_0x1c83c9[_0x407370(0x12c)]&&db['collection']('players')[_0x407370(0x127)](_0xb288c3)['update']({'eloRating':_0x5e895a})['then'](()=>{const _0x25c3cd=_0x407370;console['log'](_0x25c3cd(0x124)+_0x1c83c9[_0x25c3cd(0x103)]);})[_0x407370(0x100)](_0x3d80ef=>{const _0x412e34=_0x407370;console[_0x412e34(0x11b)]('Error\x20assigning\x20default\x20ELO\x20rating:',_0x3d80ef);});}export async function updateEloRatings(_0x2670df,_0x9039c4,_0x2d0cc2){const _0x315d29=a30_0x1a48;try{const _0x3b0b71=writeBatch(db),_0x5101f6=doc(db,'players',_0x2670df),_0x369b47=doc(db,_0x315d29(0x113),_0x9039c4),[_0x5ce2ee,_0x56c6e8]=await Promise[_0x315d29(0xf2)]([getDoc(_0x5101f6),getDoc(_0x369b47)]);if(!_0x5ce2ee['exists']()||!_0x56c6e8[_0x315d29(0x12e)]())throw new Error(_0x315d29(0xf1));const _0x52f970=_0x5ce2ee[_0x315d29(0xfc)](),_0x87935c=_0x56c6e8['data'](),_0x19a2e9=_0x52f970['position']||Number[_0x315d29(0x104)],_0x1cd4d4=_0x87935c[_0x315d29(0x11d)]||Number[_0x315d29(0x104)],{newWinnerRating:_0x36ac32,newLoserRating:_0x1d39b1}=calculateElo(_0x52f970[_0x315d29(0x12c)]||0x4b0,_0x87935c['eloRating']||0x4b0);let _0x337673=_0x19a2e9,_0x26f003=_0x1cd4d4;if(_0x19a2e9>_0x1cd4d4){console[_0x315d29(0x118)](_0x315d29(0x12d)),_0x337673=_0x1cd4d4,_0x26f003=_0x1cd4d4+0x1;const _0x22ca68=query(collection(db,_0x315d29(0x113)),where(_0x315d29(0x11d),'>',_0x1cd4d4),where(_0x315d29(0x11d),'<',_0x19a2e9)),_0x26b52d=await getDocs(_0x22ca68);for(const _0x15bbbd of _0x26b52d['docs']){_0x15bbbd['id']!==_0x2670df&&_0x15bbbd['id']!==_0x9039c4&&_0x3b0b71[_0x315d29(0x10c)](doc(db,'players',_0x15bbbd['id']),{'position':_0x15bbbd[_0x315d29(0xfc)]()['position']+0x1});}}else console[_0x315d29(0x118)]('Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions');const _0x1ab6f3={'eloRating':_0x36ac32,'lastMatchDate':serverTimestamp(),'position':_0x337673,'lastMatchId':_0x2d0cc2},_0x2c28e9={'eloRating':_0x1d39b1,'lastMatchDate':serverTimestamp(),'position':_0x26f003,'lastMatchId':_0x2d0cc2};return _0x3b0b71['update'](_0x5101f6,_0x1ab6f3),_0x3b0b71[_0x315d29(0x10c)](_0x369b47,_0x2c28e9),await _0x3b0b71[_0x315d29(0x116)](),console[_0x315d29(0x118)]('ELO\x20ratings\x20updated\x20successfully'),await Promise[_0x315d29(0xf2)]([recordEloChange({'playerId':_0x2670df,'previousElo':_0x52f970['eloRating']||0x4b0,'newElo':_0x36ac32,'opponentId':_0x9039c4,'matchResult':_0x315d29(0x129),'previousPosition':_0x19a2e9,'newPosition':_0x337673,'isPromotion':_0x337673<_0x19a2e9,'matchId':_0x2d0cc2,'timestamp':serverTimestamp()}),recordEloChange({'playerId':_0x9039c4,'previousElo':_0x87935c[_0x315d29(0x12c)]||0x4b0,'newElo':_0x1d39b1,'opponentId':_0x2670df,'matchResult':_0x315d29(0x12b),'previousPosition':_0x1cd4d4,'newPosition':_0x26f003,'isDemotion':_0x26f003>_0x1cd4d4,'matchId':_0x2d0cc2,'timestamp':serverTimestamp()})]),await promotionManager['checkAndRecordPromotion'](_0x2670df,_0x36ac32,_0x52f970[_0x315d29(0x12c)],{'source':'match','matchId':_0x2d0cc2}),await promotionManager[_0x315d29(0x101)](_0x9039c4,_0x1d39b1,_0x87935c[_0x315d29(0x12c)],{'source':_0x315d29(0x10a),'matchId':_0x2d0cc2}),console[_0x315d29(0x118)]('ELO\x20ratings\x20and\x20positions\x20updated\x20successfully'),!![];}catch(_0xd74545){console[_0x315d29(0x11b)](_0x315d29(0x110),_0xd74545);throw _0xd74545;}}export async function approveReport(_0xb85ec,_0x95bf34,_0xd68995,_0x23a880,_0x2e195a){const _0xc62754=a30_0x1a48;try{const _0x497332=doc(db,'pendingMatches',_0xb85ec),_0xb7e6f3=await getDoc(_0x497332);if(!_0xb7e6f3['exists']())throw new Error(_0xc62754(0x115));const _0xaccd72=_0xb7e6f3[_0xc62754(0xfc)](),_0x4bb171={..._0xaccd72,'winnerScore':_0x95bf34,'winnerSuicides':_0xd68995,'winnerComment':_0x23a880,'winnerDemoLink':_0x2e195a,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':auth['currentUser'][_0xc62754(0x121)]};await setDoc(doc(db,_0xc62754(0x125),_0xb85ec),_0x4bb171),await deleteDoc(_0x497332),console[_0xc62754(0x118)]('Match\x20moved\x20to\x20approved\x20collection');const [_0xd7e497,_0x4fa082]=await Promise[_0xc62754(0xf2)]([getDocs(query(collection(db,_0xc62754(0x113)),where(_0xc62754(0x103),'==',_0xaccd72[_0xc62754(0x117)]))),getDocs(query(collection(db,_0xc62754(0x113)),where(_0xc62754(0x103),'==',_0xaccd72[_0xc62754(0xfd)])))]);if(_0xd7e497[_0xc62754(0xff)]||_0x4fa082[_0xc62754(0xff)])throw new Error(_0xc62754(0x122));const _0x17e437=_0xd7e497[_0xc62754(0xfe)][0x0]['id'],_0xfe8f34=_0x4fa082[_0xc62754(0xfe)][0x0]['id'];return await updateEloRatings(_0x17e437,_0xfe8f34,_0xb85ec),console[_0xc62754(0x118)](_0xc62754(0x111)),!![];}catch(_0x4f1b67){console[_0xc62754(0x11b)]('Error\x20approving\x20report:',_0x4f1b67);throw _0x4f1b67;}}function a30_0x44ce(){const _0x475229=['approvedMatches','exception','doc','toFixed','win','2044330CUJTFx','loss','eloRating','Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked','exists','lastUpdated','toISOString','One\x20or\x20both\x20players\x20not\x20found','all','console','bind','41340760NvbzWf','search','2050162JDnaAz','return\x20(function()\x20','wins','round','constructor','data','loserUsername','docs','empty','catch','checkAndRecordPromotion','(((.+)+)+)+$','username','MAX_SAFE_INTEGER','1vqOwbE','loserScore','losses','toString','winRate','match','8PcFdXR','update','572292xvFDdO','winnerScore','722475DoSXVr','Error\x20in\x20updateEloRatings:','Match\x20successfully\x20approved\x20and\x20ELO\x20updated','playerStats','players','trace','Report\x20not\x20found','commit','winnerUsername','log','table','144ktqmIm','error','11137784UEFwEC','position','totalKills','7318590lzFbUX','pow','uid','Could\x20not\x20find\x20player\x20documents','length','Assigned\x20default\x20ELO\x20rating\x20to\x20player\x20'];a30_0x44ce=function(){return _0x475229;};return a30_0x44ce();}async function updatePlayerElo(_0x4387cf,_0x3a600f,_0x105b83){const _0x56f089=a30_0x1a48;await setDoc(doc(db,_0x56f089(0x113),_0x4387cf),{...playerData,'eloRating':_0x105b83}),await checkAndRecordPromotion(_0x4387cf,_0x105b83,_0x3a600f);}async function updatePlayerStats(_0x4ea792,_0x52dbb4,_0x20a1e3){const _0x1f26cf=a30_0x1a48,_0x4edd20=doc(db,_0x1f26cf(0x112),_0x4ea792),_0x4244a3=await getDoc(_0x4edd20);let _0x2950b6=_0x4244a3[_0x1f26cf(0x12e)]()?_0x4244a3[_0x1f26cf(0xfc)]():{'wins':0x0,'losses':0x0,'totalKills':0x0,'totalDeaths':0x0,'winRate':0x0};_0x20a1e3?(_0x2950b6[_0x1f26cf(0xf9)]++,_0x2950b6['totalKills']+=parseInt(_0x52dbb4[_0x1f26cf(0x10e)]||0x0),_0x2950b6['totalDeaths']+=parseInt(_0x52dbb4[_0x1f26cf(0x106)]||0x0)):(_0x2950b6[_0x1f26cf(0x107)]++,_0x2950b6[_0x1f26cf(0x11e)]+=parseInt(_0x52dbb4[_0x1f26cf(0x106)]||0x0),_0x2950b6['totalDeaths']+=parseInt(_0x52dbb4[_0x1f26cf(0x10e)]||0x0));const _0x8c8171=_0x2950b6[_0x1f26cf(0xf9)]+_0x2950b6[_0x1f26cf(0x107)];_0x2950b6[_0x1f26cf(0x109)]=_0x8c8171>0x0?(_0x2950b6[_0x1f26cf(0xf9)]/_0x8c8171*0x64)[_0x1f26cf(0x128)](0x1):0x0,_0x2950b6[_0x1f26cf(0xef)]=new Date()[_0x1f26cf(0xf0)](),await setDoc(_0x4edd20,_0x2950b6,{'merge':!![]});}
const a12_0x561f0e=a12_0x44e1,a12_0x49b3ff=(function(){let _0x12720d=!![];return function(_0x495040,_0x5b01a7){const _0x3eb25e=_0x12720d?function(){if(_0x5b01a7){const _0xcf6e3f=_0x5b01a7['apply'](_0x495040,arguments);return _0x5b01a7=null,_0xcf6e3f;}}:function(){};return _0x12720d=![],_0x3eb25e;};}()),a12_0x4e6754=a12_0x49b3ff(this,function(){const _0x5d20d4=a12_0x44e1;let _0x49eab3;try{const _0x3af622=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x49eab3=_0x3af622();}catch(_0x5a72ea){_0x49eab3=window;}const _0x52466e=_0x49eab3['console']=_0x49eab3['console']||{},_0x4bfd79=['log',_0x5d20d4(0x1a8),'info','error',_0x5d20d4(0x19e),'table','trace'];for(let _0x3df9f3=0x0;_0x3df9f3<_0x4bfd79['length'];_0x3df9f3++){const _0x2250ee=a12_0x49b3ff['constructor']['prototype']['bind'](a12_0x49b3ff),_0x3aaabf=_0x4bfd79[_0x3df9f3],_0x381fb5=_0x52466e[_0x3aaabf]||_0x2250ee;_0x2250ee[_0x5d20d4(0x198)]=a12_0x49b3ff['bind'](a12_0x49b3ff),_0x2250ee[_0x5d20d4(0x19a)]=_0x381fb5['toString'][_0x5d20d4(0x1a9)](_0x381fb5),_0x52466e[_0x3aaabf]=_0x2250ee;}});a12_0x4e6754();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D2=[{'name':a12_0x561f0e(0x1a0),'elo':0x708},{'name':'Silver','elo':0x640},{'name':'Bronze','elo':0x578},{'name':a12_0x561f0e(0x1a1),'elo':0x4b0}];function a12_0x1e9d(){const _0x20eca6=['__proto__','desc','toString','opponent','empty','Unknown\x20Player','exception','error','Gold','Unranked','player','Error\x20getting\x20username:','previousElo','timestamp','docs','map','warn','bind','Emerald','Silver','loserUsername','log','winnerId'];a12_0x1e9d=function(){return _0x20eca6;};return a12_0x1e9d();}let lastVisibleD2=null;async function getUsernameByIdD2(_0x204a5e){const _0x4720aa=a12_0x561f0e;try{if(!_0x204a5e)return _0x4720aa(0x19d);const _0x4b72ea=await getDoc(doc(db,'playersD2',_0x204a5e));if(_0x4b72ea['exists']())return _0x4b72ea['data']()['username']||_0x4720aa(0x19d);const _0x2d7324=await getDocs(query(collection(db,'approvedMatchesD2'),where(_0x4720aa(0x1ae),'==',_0x204a5e),limit(0x1)));if(!_0x2d7324['empty'])return _0x2d7324['docs'][0x0]['data']()['winnerUsername']||'Unknown\x20Player';const _0x534822=await getDocs(query(collection(db,'approvedMatchesD2'),where('loserId','==',_0x204a5e),limit(0x1)));if(!_0x534822['empty'])return _0x534822['docs'][0x0]['data']()[_0x4720aa(0x1ac)]||_0x4720aa(0x19d);return'Unknown\x20Player';}catch(_0x237754){return console['error'](_0x4720aa(0x1a3),_0x237754),_0x4720aa(0x19d);}}export async function recordEloChangeD2({playerId:_0x262f1f,previousElo:_0x43d90c,newElo:_0x1d1a4d,opponentId:_0x177e22,matchResult:_0xaa45e7,previousPosition:_0x250c13,newPosition:_0x628436,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x26b81d,timestamp:_0x3ee2de}){const _0x18f396=a12_0x561f0e;try{const _0x2e4982=doc(collection(db,'eloHistoryD2'));let _0x170a29='match';if(isPromotion)_0x170a29='promotion';if(isDemotion)_0x170a29='demotion';let _0x1658d9='Unranked';if(_0x1d1a4d>=0x834)_0x1658d9=_0x18f396(0x1aa);else{if(_0x1d1a4d>=0x708)_0x1658d9='Gold';else{if(_0x1d1a4d>=0x640)_0x1658d9=_0x18f396(0x1ab);else{if(_0x1d1a4d>=0x578)_0x1658d9='Bronze';}}}return await setDoc(_0x2e4982,{'type':_0x170a29,'player':_0x262f1f,'opponent':_0x177e22,'previousElo':_0x43d90c,'newElo':_0x1d1a4d,'change':_0x1d1a4d-_0x43d90c,'matchResult':_0xaa45e7,'previousPosition':_0x250c13,'newPosition':_0x628436,'rankAchieved':_0x1658d9,'matchId':_0x26b81d,'timestamp':_0x3ee2de}),console[_0x18f396(0x1ad)]('D2\x20ELO\x20history\x20recorded\x20for\x20'+_0x262f1f),!![];}catch(_0x2dbda8){console[_0x18f396(0x19f)]('Error\x20recording\x20D2\x20ELO\x20history:',_0x2dbda8);throw _0x2dbda8;}}function a12_0x44e1(_0x58e4e7,_0x557ac7){const _0x4e6754=a12_0x1e9d();return a12_0x44e1=function(_0x49b3ff,_0x116f64){_0x49b3ff=_0x49b3ff-0x198;let _0x1e9ddd=_0x4e6754[_0x49b3ff];return _0x1e9ddd;},a12_0x44e1(_0x58e4e7,_0x557ac7);}export async function getEloHistoryD2(_0x321660=0x14){const _0x1835ca=a12_0x561f0e;try{const _0x49db74=collection(db,'eloHistoryD2');let _0x5cf66e;lastVisibleD2?_0x5cf66e=query(_0x49db74,orderBy(_0x1835ca(0x1a5),'desc'),startAfter(lastVisibleD2),limit(_0x321660)):_0x5cf66e=query(_0x49db74,orderBy(_0x1835ca(0x1a5),_0x1835ca(0x199)),limit(_0x321660));const _0x307086=await getDocs(_0x5cf66e);if(_0x307086[_0x1835ca(0x19c)])return{'entries':[],'hasMore':![]};lastVisibleD2=_0x307086['docs'][_0x307086['docs']['length']-0x1];const _0x3d510e=_0x307086[_0x1835ca(0x1a6)][_0x1835ca(0x1a7)](async _0x4cf169=>{const _0x57d1c4=_0x1835ca,_0x143fcb=_0x4cf169['data'](),[_0x33d85c,_0x53d5a5]=await Promise['all']([getUsernameByIdD2(_0x143fcb[_0x57d1c4(0x1a2)]),getUsernameByIdD2(_0x143fcb[_0x57d1c4(0x19b)])]);return{..._0x143fcb,'playerUsername':_0x33d85c,'opponentUsername':_0x53d5a5,'change':_0x143fcb['newElo']-_0x143fcb[_0x57d1c4(0x1a4)],'timestamp':_0x143fcb['timestamp']};}),_0x7f05f3=await Promise['all'](_0x3d510e);return{'entries':_0x7f05f3,'hasMore':_0x307086['size']===_0x321660};}catch(_0x39fd7f){console[_0x1835ca(0x19f)]('Error\x20fetching\x20D2\x20ELO\x20history:',_0x39fd7f);throw _0x39fd7f;}}export function resetPaginationD2(){lastVisibleD2=null;}
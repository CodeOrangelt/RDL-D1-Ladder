const a12_0x37ef75=a12_0x1a24,a12_0x186690=(function(){let _0x229c66=!![];return function(_0x1b3f0e,_0x2ac7f7){const _0x152785=_0x229c66?function(){const _0x300053=a12_0x1a24;if(_0x2ac7f7){const _0xd38e1=_0x2ac7f7[_0x300053(0x110)](_0x1b3f0e,arguments);return _0x2ac7f7=null,_0xd38e1;}}:function(){};return _0x229c66=![],_0x152785;};}()),a12_0xc348ed=a12_0x186690(this,function(){const _0x2e4612=a12_0x1a24,_0x38b134=function(){let _0x435adb;try{_0x435adb=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x4e4c06){_0x435adb=window;}return _0x435adb;},_0x33818c=_0x38b134(),_0x55aebf=_0x33818c['console']=_0x33818c['console']||{},_0x7eaab=['log','warn','info','error','exception','table','trace'];for(let _0x136c10=0x0;_0x136c10<_0x7eaab['length'];_0x136c10++){const _0x3e7f9e=a12_0x186690[_0x2e4612(0x124)][_0x2e4612(0x108)][_0x2e4612(0x125)](a12_0x186690),_0x2cdd80=_0x7eaab[_0x136c10],_0x35aff9=_0x55aebf[_0x2cdd80]||_0x3e7f9e;_0x3e7f9e['__proto__']=a12_0x186690['bind'](a12_0x186690),_0x3e7f9e['toString']=_0x35aff9['toString']['bind'](_0x35aff9),_0x55aebf[_0x2cdd80]=_0x3e7f9e;}});a12_0xc348ed();import{getAuth,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{doc,getDoc,collection,query,where,getDocs,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import{isAdmin}from'./admin-check.js';const ADMIN_EMAILS=[a12_0x37ef75(0x10e),a12_0x37ef75(0x130)],userCache={'uid':null,'username':null,'isAdmin':![],'hasCheckedCollections':![],'lastChecked':0x0,'role':null},invitationCache={'lastCheck':0x0,'pendingCount':0x0,'checkInterval':0x493e0};function updateInboxNotification(_0x13a5a0){const _0x53c666=a12_0x37ef75,_0x1038e7=document[_0x53c666(0x12c)](_0x53c666(0x118));_0x1038e7&&(_0x13a5a0>0x0?(_0x1038e7['style']['display']='inline-block',_0x1038e7['textContent']=_0x13a5a0>0x9?'9+':_0x13a5a0):_0x1038e7['style']['display']='none');}async function checkPendingInvitationsForCurrentUser(_0x3b8ada){const _0x5e4295=a12_0x37ef75;try{const _0x1b9396=Date['now']();if(_0x1b9396-invitationCache[_0x5e4295(0x11b)]<invitationCache['checkInterval'])return updateInboxNotification(invitationCache[_0x5e4295(0x11f)]),invitationCache['pendingCount'];invitationCache['lastCheck']=_0x1b9396;const _0x2d3a1d=collection(db,'gameInvitations'),_0x22b47b=query(_0x2d3a1d,where(_0x5e4295(0x128),'==',_0x3b8ada),where('status','==','pending'),limit(0x5)),_0xce80cb=await getDocs(_0x22b47b),_0x19a072=_0xce80cb['size'];return invitationCache['pendingCount']=_0x19a072,updateInboxNotification(_0x19a072),_0x19a072;}catch(_0x4b5d18){return console[_0x5e4295(0x133)]('Could\x20not\x20check\x20pending\x20invitations\x20for\x20current\x20user:',_0x4b5d18),0x0;}}function updateAuthSectionImmediate(_0x6fd334,_0x158e47=![]){const _0x22b79e=a12_0x37ef75,_0x3c4f35=document['getElementById'](_0x22b79e(0x116));if(!_0x3c4f35)return;if(_0x6fd334&&_0x158e47)document['querySelectorAll']('.admin-only')[_0x22b79e(0x115)](_0x546f2c=>{const _0x3d218c=_0x22b79e;_0x546f2c['style'][_0x3d218c(0x10a)]='block';});else!_0x6fd334&&document['querySelectorAll']('.admin-only')[_0x22b79e(0x115)](_0x4c7068=>{const _0x5b0916=_0x22b79e;_0x4c7068['style'][_0x5b0916(0x10a)]=_0x5b0916(0x104);});if(_0x6fd334){const _0x4c5f27=userCache[_0x22b79e(0x106)]||(_0x6fd334[_0x22b79e(0x122)]?_0x6fd334['email'][_0x22b79e(0x120)]('@')[0x0]:'User'),_0x1a34f2=userCache[_0x22b79e(0x12d)]?'\x20('+userCache['role']+')':_0x158e47?_0x22b79e(0x109):'';_0x3c4f35['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20class=\x22nav-username\x22>'+_0x4c5f27+_0x1a34f2+'</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username='+encodeURIComponent(_0x4c5f27)+'\x22>Profile</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./inbox.html\x22\x20class=\x22nav-notification\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Inbox\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22inbox-notification\x22\x20class=\x22notification-dot\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22members.html\x22>Members</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./redeem.html\x22><i\x20class=\x22fas\x20fa-gift\x22></i>\x20Redeem</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20id=\x22logout-link\x22>Sign\x20Out</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';const _0x521560=document['getElementById']('logout-link');_0x521560&&_0x521560[_0x22b79e(0x121)](_0x22b79e(0x12a),_0x4737dd=>{const _0x19f1d7=_0x22b79e;_0x4737dd[_0x19f1d7(0x10c)]();const _0xb41d54=getAuth();updateAuthSectionImmediate(null),_0xb41d54['signOut']()['catch'](_0x58f6e2=>{const _0x59c979=_0x19f1d7;console['error'](_0x59c979(0x10d),_0x58f6e2);});}),_0x6fd334[_0x22b79e(0x10f)]&&setTimeout(()=>{const _0x2a96cb=_0x22b79e;checkPendingInvitationsForCurrentUser(_0x6fd334[_0x2a96cb(0x10f)]);},0x3e8);}else _0x3c4f35['innerHTML']='<a\x20href=\x22login.html\x22\x20class=\x22login-link\x22>Login</a>';}function a12_0x1a24(_0x43745e,_0x3907ff){const _0xc348ed=a12_0x2907();return a12_0x1a24=function(_0x186690,_0x39dace){_0x186690=_0x186690-0x104;let _0x290708=_0xc348ed[_0x186690];return _0x290708;},a12_0x1a24(_0x43745e,_0x3907ff);}async function checkAdminRoles(_0x1d6186){const _0x5774d5=a12_0x37ef75;if(!_0x1d6186||!_0x1d6186['email'])return{'isAdmin':![],'role':null};try{console[_0x5774d5(0x112)]('Checking\x20roles\x20for\x20user:\x20'+_0x1d6186[_0x5774d5(0x122)]);const _0x2b917b=['players','playersD2',_0x5774d5(0x11c),'nonParticipants','userProfiles'],_0x5b0e12=['council','creative\x20lead',_0x5774d5(0x127),'admin'];for(const _0x43866b of _0x2b917b){try{const _0x358c28=doc(db,_0x43866b,_0x1d6186['uid']),_0x24eb94=await getDoc(_0x358c28);if(_0x24eb94['exists']()){const _0x599b7a=_0x24eb94['data']();console['log'](_0x5774d5(0x123)+_0x43866b+_0x5774d5(0x117),_0x599b7a);let _0x3b26f7=(_0x599b7a['roleName']||_0x599b7a['role']||'')[_0x5774d5(0x12b)](),_0x51c974=_0x599b7a['roleName']||_0x599b7a['role']||'';if(_0x3b26f7&&_0x5b0e12[_0x5774d5(0x111)](_0x3b26f7)){console['log']('Found\x20admin\x20role:\x20'+_0x3b26f7+'\x20in\x20'+_0x43866b);const _0x152753=_0x51c974['split']('\x20')[_0x5774d5(0x105)](_0x2428f5=>_0x2428f5['charAt'](0x0)['toUpperCase']()+_0x2428f5['slice'](0x1)['toLowerCase']())[_0x5774d5(0x11e)]('\x20');return{'isAdmin':!![],'role':_0x152753};}}}catch(_0x11d0d1){console['error']('Error\x20checking\x20'+_0x43866b+'\x20by\x20UID:',_0x11d0d1);}}for(const _0x414fea of _0x2b917b){try{const _0x52f675=collection(db,_0x414fea);let _0x56d031=query(_0x52f675,where(_0x5774d5(0x122),'==',_0x1d6186['email'])),_0x1876db=await getDocs(_0x56d031);_0x1876db[_0x5774d5(0x131)]&&(_0x56d031=query(_0x52f675,where('email','==',_0x1d6186['email'][_0x5774d5(0x12b)]())),_0x1876db=await getDocs(_0x56d031));if(!_0x1876db['empty']){const _0x42492e=_0x1876db['docs'][0x0][_0x5774d5(0x126)]();console[_0x5774d5(0x112)](_0x5774d5(0x123)+_0x414fea+'\x20by\x20email:',_0x42492e);let _0x52fa9d=(_0x42492e['roleName']||_0x42492e['role']||'')['toLowerCase'](),_0x3f9dde=_0x42492e['roleName']||_0x42492e[_0x5774d5(0x12d)]||'';if(_0x52fa9d&&_0x5b0e12['includes'](_0x52fa9d)){console[_0x5774d5(0x112)]('Found\x20admin\x20role:\x20'+_0x52fa9d+'\x20in\x20'+_0x414fea);const _0x17d52b=_0x3f9dde[_0x5774d5(0x120)]('\x20')[_0x5774d5(0x105)](_0x3b88ff=>_0x3b88ff['charAt'](0x0)['toUpperCase']()+_0x3b88ff['slice'](0x1)['toLowerCase']())['join']('\x20');return{'isAdmin':!![],'role':_0x17d52b};}}}catch(_0x3e773a){console['error']('Error\x20checking\x20'+_0x414fea+'\x20by\x20email:',_0x3e773a);}}return console[_0x5774d5(0x112)]('No\x20admin\x20roles\x20found\x20for\x20user'),{'isAdmin':![],'role':null};}catch(_0x42ba91){return console[_0x5774d5(0x132)]('Error\x20in\x20checkAdminRoles:',_0x42ba91),{'isAdmin':![],'role':null};}}async function updateAuthSection(_0x309632){const _0x134d13=a12_0x37ef75,_0x5f3af1=_0x309632&&isAdmin(_0x309632['email']);updateAuthSectionImmediate(_0x309632,_0x5f3af1);if(!_0x309632){userCache[_0x134d13(0x10f)]=null,userCache['username']=null,userCache['isAdmin']=![],userCache['hasCheckedCollections']=![],userCache[_0x134d13(0x12d)]=null;return;}const _0x6ba45=Date['now']();if(_0x309632['uid']===userCache['uid']&&userCache[_0x134d13(0x129)]&&_0x6ba45-userCache['lastChecked']<0x493e0)return;try{userCache['uid']=_0x309632[_0x134d13(0x10f)],userCache[_0x134d13(0x107)]=_0x6ba45;const _0x1f0b6d=isAdmin(_0x309632['email']);userCache['isAdmin']=_0x1f0b6d;if(!_0x1f0b6d){const {isAdmin:_0x26885c,role:_0x532ac9}=await checkAdminRoles(_0x309632);userCache['isAdmin']=_0x26885c,userCache['role']=_0x532ac9,_0x26885c&&(document[_0x134d13(0x119)]('.admin-only')['forEach'](_0x6ee112=>{const _0x27e8f4=_0x134d13;_0x6ee112['style']['display']=_0x27e8f4(0x12e);}),updateAuthSectionImmediate(_0x309632,!![]));}const _0x3f2de8=['players',_0x134d13(0x11d),'playersD3','playersDuos',_0x134d13(0x10b),'nonParticipants','userProfiles'],_0x3f951a=_0x3f2de8['map'](_0x5a1f11=>getDoc(doc(db,_0x5a1f11,_0x309632[_0x134d13(0x10f)]))['then'](_0x6b22e3=>_0x6b22e3['exists']()?{'collection':_0x5a1f11,'data':_0x6b22e3['data']()}:null)[_0x134d13(0x11a)](()=>null)),_0x402570=await Promise[_0x134d13(0x12f)](_0x3f951a),_0x52fb8f=_0x402570[_0x134d13(0x113)](_0x4440c7=>_0x4440c7!==null);let _0x55c2d4=null;for(const _0x4a52a8 of _0x52fb8f){if(_0x4a52a8['data']['username']){_0x55c2d4=_0x4a52a8[_0x134d13(0x126)][_0x134d13(0x106)];break;}}userCache['username']=_0x55c2d4||(_0x309632['email']?_0x309632['email'][_0x134d13(0x120)]('@')[0x0]:'User'),userCache['hasCheckedCollections']=!![],updateAuthSectionImmediate(_0x309632,userCache['isAdmin']),setTimeout(()=>{const _0x2b99d6=_0x134d13;checkPendingInvitationsForCurrentUser(_0x309632[_0x2b99d6(0x10f)]);},0x1f4);}catch(_0x577bac){console['error']('Error\x20in\x20full\x20auth\x20update:',_0x577bac);}}document['addEventListener']('DOMContentLoaded',()=>{const _0x2cfcff=a12_0x37ef75,_0x2a2c28=getAuth();onAuthStateChanged(_0x2a2c28,async _0x558a0c=>{await updateAuthSection(_0x558a0c),_0x558a0c&&checkPendingInvitationsForCurrentUser(_0x558a0c['uid']);}),document[_0x2cfcff(0x121)]('visibilitychange',()=>{const _0x4c693d=_0x2cfcff;!document['hidden']&&_0x2a2c28[_0x4c693d(0x114)]&&checkPendingInvitationsForCurrentUser(_0x2a2c28['currentUser']['uid']);}),document[_0x2cfcff(0x121)]('click',_0x582dd0=>{const _0x169aef=_0x2cfcff;_0x582dd0['target']['closest']('a[href]')&&_0x2a2c28[_0x169aef(0x114)]&&checkPendingInvitationsForCurrentUser(_0x2a2c28['currentUser'][_0x169aef(0x10f)]);});});export{updateAuthSection};function a12_0x2907(){const _0x21b5d8=['none','map','username','lastChecked','prototype','\x20(Admin)','display','playersCTF','preventDefault','Error\x20signing\x20out:','admin@ladder.com','uid','apply','includes','log','filter','currentUser','forEach','auth-section','\x20by\x20UID:','inbox-notification','querySelectorAll','catch','lastCheck','playersD3','playersD2','join','pendingCount','split','addEventListener','email','Found\x20user\x20in\x20','constructor','bind','data','owner','toUserId','hasCheckedCollections','click','toLowerCase','getElementById','role','block','all','Brian2af@outlook.com','empty','error','warn'];a12_0x2907=function(){return _0x21b5d8;};return a12_0x2907();}
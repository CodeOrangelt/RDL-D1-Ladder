function a29_0x1972(_0x152bf4,_0x28f2d0){const _0x141dd2=a29_0x3a8c();return a29_0x1972=function(_0x5b332d,_0x458e77){_0x5b332d=_0x5b332d-0x7f;let _0x3a8cbe=_0x141dd2[_0x5b332d];return _0x3a8cbe;},a29_0x1972(_0x152bf4,_0x28f2d0);}const a29_0x5b332d=(function(){let _0x2a2e6c=!![];return function(_0x121442,_0x377d44){const _0x7d7feb=_0x2a2e6c?function(){if(_0x377d44){const _0x17756d=_0x377d44['apply'](_0x121442,arguments);return _0x377d44=null,_0x17756d;}}:function(){};return _0x2a2e6c=![],_0x7d7feb;};}()),a29_0x141dd2=a29_0x5b332d(this,function(){const _0x58a325=a29_0x1972,_0x58c33e=function(){let _0xc8bd6;try{_0xc8bd6=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x5c8f20){_0xc8bd6=window;}return _0xc8bd6;},_0x41613c=_0x58c33e(),_0x51ef2b=_0x41613c['console']=_0x41613c[_0x58a325(0x80)]||{},_0x50aef0=['log','warn','info','error','exception',_0x58a325(0x83),'trace'];for(let _0x4281d2=0x0;_0x4281d2<_0x50aef0[_0x58a325(0x88)];_0x4281d2++){const _0x135a7d=a29_0x5b332d['constructor']['prototype']['bind'](a29_0x5b332d),_0x3e2bf9=_0x50aef0[_0x4281d2],_0x1ae654=_0x51ef2b[_0x3e2bf9]||_0x135a7d;_0x135a7d[_0x58a325(0x85)]=a29_0x5b332d['bind'](a29_0x5b332d),_0x135a7d['toString']=_0x1ae654['toString']['bind'](_0x1ae654),_0x51ef2b[_0x3e2bf9]=_0x135a7d;}});a29_0x141dd2();function a29_0x3a8c(){const _0x5da224=['exists','console','playersD3','log','table','winnerUsername','__proto__','loserUsername','eloRating','length','docs','No\x20user\x20logged\x20in','D3\x20ELO\x20ratings\x20updated\x20successfully','empty','position','Starting\x20approveReportD3\x20function\x20with:','Current\x20username:','D3\x20Match\x20moved\x20to\x20approved\x20collection'];a29_0x3a8c=function(){return _0x5da224;};return a29_0x3a8c();}import{addDoc,updateDoc,serverTimestamp,collection,doc,getDoc,getDocs,query,where,setDoc,deleteDoc,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';import{recordEloChangeD3}from'./elo-history-d3.js';export function calculateEloD3(_0x1a9b73,_0x49e406,_0x2124a8=0x20){const _0x273a87=0x1/(0x1+Math['pow'](0xa,(_0x49e406-_0x1a9b73)/0x190)),_0x1a3a34=0x1/(0x1+Math['pow'](0xa,(_0x1a9b73-_0x49e406)/0x190)),_0xa8739d=_0x1a9b73+_0x2124a8*(0x1-_0x273a87),_0x23bf48=_0x49e406+_0x2124a8*(0x0-_0x1a3a34);return{'newWinnerRating':Math['round'](_0xa8739d),'newLoserRating':Math['round'](_0x23bf48)};}export async function updateEloRatingsD3(_0xa040a2,_0x4b4a06,_0x25f5d9){const _0x53d3d1=a29_0x1972;try{const _0x1a2ca5=writeBatch(db),_0x5b95aa=doc(db,'playersD3',_0xa040a2),_0x113aa1=doc(db,'playersD3',_0x4b4a06),[_0x4d2c78,_0x29b2f8]=await Promise['all']([getDoc(_0x5b95aa),getDoc(_0x113aa1)]);if(!_0x4d2c78[_0x53d3d1(0x7f)]()||!_0x29b2f8[_0x53d3d1(0x7f)]())throw new Error('One\x20or\x20both\x20D3\x20players\x20not\x20found');const _0x474a89=_0x4d2c78['data'](),_0x41ce12=_0x29b2f8['data'](),_0x83ef26=_0x474a89[_0x53d3d1(0x8d)]||Number['MAX_SAFE_INTEGER'],_0x344c5c=_0x41ce12['position']||Number['MAX_SAFE_INTEGER'],{newWinnerRating:_0x2e0e16,newLoserRating:_0x4c755f}=calculateEloD3(_0x474a89[_0x53d3d1(0x87)]||0x4b0,_0x41ce12[_0x53d3d1(0x87)]||0x4b0);let _0x100bfd=_0x83ef26,_0xdb6a63=_0x344c5c;if(_0x83ef26>_0x344c5c){console['log']('D3\x20Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked'),_0x100bfd=_0x344c5c,_0xdb6a63=_0x344c5c+0x1;const _0x159e44=query(collection(db,'playersD3'),where(_0x53d3d1(0x8d),'>',_0x344c5c),where('position','<',_0x83ef26)),_0x168f50=await getDocs(_0x159e44);for(const _0x139ef9 of _0x168f50[_0x53d3d1(0x89)]){_0x139ef9['id']!==_0xa040a2&&_0x139ef9['id']!==_0x4b4a06&&_0x1a2ca5['update'](doc(db,_0x53d3d1(0x81),_0x139ef9['id']),{'position':_0x139ef9['data']()[_0x53d3d1(0x8d)]+0x1});}}else console['log']('D3\x20Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions');return _0x1a2ca5['update'](_0x5b95aa,{'eloRating':_0x2e0e16,'lastMatchDate':serverTimestamp(),'position':_0x100bfd,'lastMatchId':_0x25f5d9}),_0x1a2ca5['update'](_0x113aa1,{'eloRating':_0x4c755f,'lastMatchDate':serverTimestamp(),'position':_0xdb6a63,'lastMatchId':_0x25f5d9}),await _0x1a2ca5['commit'](),console['log'](_0x53d3d1(0x8b)),await Promise['all']([recordEloChangeD3({'playerId':_0xa040a2,'previousElo':_0x474a89['eloRating']||0x4b0,'newElo':_0x2e0e16,'opponentId':_0x4b4a06,'matchResult':'win','previousPosition':_0x83ef26,'newPosition':_0x100bfd,'isPromotion':_0x100bfd<_0x83ef26,'matchId':_0x25f5d9,'timestamp':serverTimestamp()}),recordEloChangeD3({'playerId':_0x4b4a06,'previousElo':_0x41ce12[_0x53d3d1(0x87)]||0x4b0,'newElo':_0x4c755f,'opponentId':_0xa040a2,'matchResult':'loss','previousPosition':_0x344c5c,'newPosition':_0xdb6a63,'isDemotion':_0xdb6a63>_0x344c5c,'matchId':_0x25f5d9,'timestamp':serverTimestamp()})]),!![];}catch(_0x3a7e6f){console['error']('Error\x20in\x20updateEloRatingsD3:',_0x3a7e6f);throw _0x3a7e6f;}}export async function approveReportD3(_0x54e956,_0x310159,_0x42cac9,_0xa8f55){const _0x7a0958=a29_0x1972;try{console['log'](_0x7a0958(0x8e),{'reportId':_0x54e956,'winnerScore':_0x310159,'winnerSuicides':_0x42cac9,'winnerComment':_0xa8f55});const _0x23a5db=auth['currentUser'];if(!_0x23a5db){console['log'](_0x7a0958(0x8a));throw new Error('You\x20must\x20be\x20logged\x20in\x20to\x20approve\x20D3\x20matches');}console['log']('Current\x20user:',_0x23a5db['email']);const _0x298936=await getDoc(doc(db,_0x7a0958(0x81),_0x23a5db['uid'])),_0x2fc61c=_0x298936[_0x7a0958(0x7f)]()?_0x298936['data']()['username']:null;console['log'](_0x7a0958(0x8f),_0x2fc61c);const _0x21b29c=doc(db,'pendingMatchesD3',_0x54e956),_0x3edc12=await getDoc(_0x21b29c);if(!_0x3edc12['exists']()){console['log']('D3\x20Report\x20not\x20found\x20with\x20ID:',_0x54e956);throw new Error('D3\x20match\x20report\x20not\x20found');}const _0x1677c2=_0x3edc12['data']();console['log']('D3\x20Report\x20data:',_0x1677c2);if(_0x2fc61c!==_0x1677c2[_0x7a0958(0x84)])throw new Error('Only\x20the\x20winner\x20can\x20approve\x20D3\x20matches');const _0x578d72={..._0x1677c2,'winnerScore':_0x310159,'winnerSuicides':_0x42cac9,'winnerComment':_0xa8f55,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':_0x2fc61c,'createdAt':_0x1677c2['createdAt']||serverTimestamp(),'winnerUsername':_0x1677c2['winnerUsername'],'loserUsername':_0x1677c2[_0x7a0958(0x86)]};await setDoc(doc(db,'approvedMatchesD3',_0x54e956),_0x578d72),await deleteDoc(_0x21b29c),console['log'](_0x7a0958(0x90));const [_0x26abaf,_0x5d831e]=await Promise['all']([getDocs(query(collection(db,'playersD3'),where('username','==',_0x1677c2[_0x7a0958(0x84)]))),getDocs(query(collection(db,'playersD3'),where('username','==',_0x1677c2['loserUsername'])))]);if(_0x26abaf['empty']||_0x5d831e[_0x7a0958(0x8c)])throw new Error('Could\x20not\x20find\x20D3\x20player\x20documents');const _0x4dee1c=_0x26abaf[_0x7a0958(0x89)][0x0]['id'],_0x78142d=_0x5d831e['docs'][0x0]['id'];return await updateEloRatingsD3(_0x4dee1c,_0x78142d,_0x54e956),console[_0x7a0958(0x82)]('D3\x20Match\x20successfully\x20approved\x20and\x20ELO\x20updated'),!![];}catch(_0x2238a2){console['error']('Error\x20in\x20approveReportD3:',_0x2238a2);throw _0x2238a2;}}
const a33_0x5de44e=(function(){let _0x4bf036=!![];return function(_0x41c47c,_0x196f73){const _0x557a02=_0x4bf036?function(){if(_0x196f73){const _0x5ab1bc=_0x196f73['apply'](_0x41c47c,arguments);return _0x196f73=null,_0x5ab1bc;}}:function(){};return _0x4bf036=![],_0x557a02;};}()),a33_0x37bc57=a33_0x5de44e(this,function(){const _0x46bc53=a33_0xbf42;let _0x4bb1c2;try{const _0x40444f=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x4bb1c2=_0x40444f();}catch(_0x1e4d40){_0x4bb1c2=window;}const _0xdcaa77=_0x4bb1c2['console']=_0x4bb1c2['console']||{},_0x506d19=[_0x46bc53(0x14b),'warn','info','error','exception',_0x46bc53(0x137),_0x46bc53(0x132)];for(let _0x240fab=0x0;_0x240fab<_0x506d19[_0x46bc53(0x135)];_0x240fab++){const _0x5b3856=a33_0x5de44e['constructor']['prototype']['bind'](a33_0x5de44e),_0x4a801e=_0x506d19[_0x240fab],_0x19cf9e=_0xdcaa77[_0x4a801e]||_0x5b3856;_0x5b3856[_0x46bc53(0x14a)]=a33_0x5de44e['bind'](a33_0x5de44e),_0x5b3856['toString']=_0x19cf9e[_0x46bc53(0x151)]['bind'](_0x19cf9e),_0xdcaa77[_0x4a801e]=_0x5b3856;}});a33_0x37bc57();import{createUserWithEmailAndPassword,signInWithEmailAndPassword,sendEmailVerification,signOut}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{doc,setDoc,collection,getDocs,query,where,getDoc,updateDoc,deleteDoc,orderBy,limit,serverTimestamp}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{auth,db}from'./firebase-config.js';function a33_0xb291(){const _0x113d41=['error','register-error','addEventListener','register-password','Email\x20not\x20yet\x20verified,\x20waiting...','style','User\x20','trim','Duos','\x20added\x20to\x20nonParticipants\x20collection','value','Registration\x20failed.\x20Please\x20try\x20again\x20later.','empty','exists','innerHTML','purple','playersD2','message','gameMode','login-error','disabled','checked','trace','login-container','display','length','href','table','Username\x20can\x20only\x20contain\x20letters,\x20numbers,\x20underscores\x20and\x20hyphens','user','playersCTF','Email\x20is\x20verified,\x20processing\x20registration','\x27)\x22\x20class=\x22resend-button\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Resend\x20Verification\x20Email\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>','Error\x20checking\x20username:','resend-button','verificationCheckInterval','username','Please\x20unselect\x20a\x20game\x20mode\x20if\x20you\x20choose\x20Non-Participant.','textContent','none','\x20collection','pendingRegistrations','show-register','nonParticipants','getElementById','Username\x20must\x20be\x20at\x20least\x203\x20characters\x20long','__proto__','log','preventDefault','uid','.\x20Please\x20check\x20your\x20inbox.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>','../index.html','login-email','toString','non-participant','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22warning-message\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Please\x20verify\x20your\x20email\x20to\x20complete\x20your\x20registration.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<br><br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20type=\x22button\x22\x20id=\x22resend-button\x22\x20class=\x22resend-button\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Resend\x20Verification\x20Email\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>','register-email','Unable\x20to\x20verify\x20username\x20availability.\x20Please\x20try\x20again\x20later.','all'];a33_0xb291=function(){return _0x113d41;};return a33_0xb291();}function setupVerificationListener(_0x32b54c,_0x4af148){const _0x1de58f=a33_0xbf42;console[_0x1de58f(0x14b)]('Setting\x20up\x20email\x20verification\x20listener\x20for:',_0x32b54c);const _0x2b4911=setInterval(async()=>{const _0x205dc8=_0x1de58f;try{console['log']('Checking\x20if\x20email\x20has\x20been\x20verified...');const _0x85298d=await signInWithEmailAndPassword(auth,_0x32b54c,_0x4af148),_0x341073=_0x85298d['user'];await _0x341073['getIdToken'](!![]),_0x341073['emailVerified']?(console[_0x205dc8(0x14b)]('Email\x20has\x20been\x20verified!\x20Redirecting\x20to\x20login\x20page...'),clearInterval(_0x2b4911),document[_0x205dc8(0x148)]('register-error')[_0x205dc8(0x12a)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22success-message\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Email\x20verified\x20successfully!\x20You\x20can\x20now\x20log\x20in.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>',await signOut(auth),setTimeout(()=>{const _0x257bf2=_0x205dc8;document['getElementById']('register-container')['style']['display']='none',document[_0x257bf2(0x148)]('login-container')[_0x257bf2(0x121)]['display']='block',document['getElementById'](_0x257bf2(0x150))['value']=_0x32b54c,document['getElementById'](_0x257bf2(0x12f))['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22success-message\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Your\x20account\x20has\x20been\x20verified!\x20You\x20can\x20now\x20log\x20in.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>';},0x7d0)):(console['log'](_0x205dc8(0x120)),await signOut(auth));}catch(_0x557543){console['error']('Error\x20checking\x20verification\x20status:',_0x557543),clearInterval(_0x2b4911);}},0x1388);window[_0x1de58f(0x13f)]=_0x2b4911,setTimeout(()=>{const _0x314ce3=_0x1de58f;window[_0x314ce3(0x13f)]&&(clearInterval(window['verificationCheckInterval']),window['verificationCheckInterval']=null,console[_0x314ce3(0x14b)]('Stopped\x20checking\x20for\x20email\x20verification\x20(timeout\x20reached)'));},0x5*0x3c*0x3e8);}async function isUsernameAvailable(_0x457c1e){const _0x39f75f=a33_0xbf42;if(!_0x457c1e||typeof _0x457c1e!=='string'||_0x457c1e[_0x39f75f(0x123)]()['length']<0x3)return document['getElementById'](_0x39f75f(0x11d))['textContent']=_0x39f75f(0x149),![];const _0x40892b=_0x457c1e['trim']();try{const _0x546e27=/^[a-zA-Z0-9_-]{3,20}$/;if(!_0x546e27['test'](_0x40892b))return document[_0x39f75f(0x148)]('register-error')['textContent']=_0x39f75f(0x138),![];const [_0x3ce7cd,_0x4293c1,_0x182320]=await Promise[_0x39f75f(0x156)]([getDocs(query(collection(db,'players'),where(_0x39f75f(0x140),'==',_0x40892b))),getDocs(query(collection(db,'pendingRegistrations'),where(_0x39f75f(0x140),'==',_0x40892b))),getDocs(query(collection(db,'nonParticipants'),where('username','==',_0x40892b)))]);if(!_0x3ce7cd['empty']||!_0x4293c1[_0x39f75f(0x128)]||!_0x182320['empty'])return document['getElementById']('register-error')['textContent']='Username\x20is\x20already\x20taken',![];return!![];}catch(_0x4700b3){return console['error'](_0x39f75f(0x13d),_0x4700b3),document['getElementById']('register-error')['textContent']=_0x39f75f(0x155),![];}}async function handleRegister(_0x4ae430){const _0x1d3249=a33_0xbf42;_0x4ae430[_0x1d3249(0x14c)]();const _0x524f2c=document[_0x1d3249(0x148)]('register-error');_0x524f2c['textContent']='';const _0x20b1e1=document['getElementById'](_0x1d3249(0x154))['value'],_0x421c96=document['getElementById'](_0x1d3249(0x11f))['value'],_0x48f61c=document[_0x1d3249(0x148)]('register-username')['value'],_0x3990ae=document['getElementById']('verification-answer')['value']['toLowerCase'](),_0x217f4f=document[_0x1d3249(0x148)]('register-mode')[_0x1d3249(0x126)],_0x575040=document['getElementById']('non-participant')?.[_0x1d3249(0x131)]||![];if(_0x575040&&_0x217f4f!==''){_0x524f2c['textContent']=_0x1d3249(0x141);return;}if(!_0x575040&&_0x217f4f===''){_0x524f2c['textContent']='Please\x20select\x20a\x20game\x20mode\x20or\x20check\x20Non-Participant.';return;}try{const _0x2d403d=[_0x1d3249(0x12b),'magenta'];if(!_0x2d403d['includes'](_0x3990ae)){_0x524f2c['textContent']='Incorrect\x20answer\x20to\x20verification\x20question';return;}const _0x7e8683=await isUsernameAvailable(_0x48f61c);if(!_0x7e8683)return;const _0x3148e5=await createUserWithEmailAndPassword(auth,_0x20b1e1,_0x421c96),_0x46cd37=_0x3148e5['user'];await sendEmailVerification(_0x46cd37),await setDoc(doc(db,_0x1d3249(0x145),_0x46cd37[_0x1d3249(0x14d)]),{'username':_0x48f61c['trim'](),'email':_0x20b1e1,'gameMode':_0x217f4f,'nonParticipant':_0x575040,'createdAt':new Date(),'verified':![]}),_0x524f2c['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22success-message\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Registration\x20pending!\x20Please\x20check\x20your\x20email\x20to\x20verify\x20your\x20account.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<br><br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20onclick=\x22resendVerificationEmail(\x27'+_0x20b1e1+_0x1d3249(0x13c),await signOut(auth),setupVerificationListener(_0x20b1e1,_0x421c96);}catch(_0x13825b){console['error']('Registration\x20error:',_0x13825b),_0x524f2c['textContent']=_0x13825b['code']==='auth/email-already-in-use'?'Email\x20address\x20is\x20already\x20registered':_0x1d3249(0x127);}}async function handleLogin(_0x286cfd){const _0x2eeacc=a33_0xbf42;_0x286cfd[_0x2eeacc(0x14c)]();const _0x5677e7=document['getElementById']('login-email')['value'],_0xd6531a=document['getElementById']('login-password')['value'],_0x5f518d=document['getElementById'](_0x2eeacc(0x12f));console['log']('Login\x20attempt\x20started\x20for:',_0x5677e7),_0x5f518d['textContent']='';try{console['log']('Attempting\x20Firebase\x20signInWithEmailAndPassword...');const _0x1c75d4=await signInWithEmailAndPassword(auth,_0x5677e7,_0xd6531a),_0x22ce93=_0x1c75d4['user'];console[_0x2eeacc(0x14b)]('User\x20signed\x20in:',_0x22ce93['uid']);const _0x22ddc4=['players',_0x2eeacc(0x12c),'playersD3','playersDuos','playersCTF','nonParticipants'];console[_0x2eeacc(0x14b)]('Checking\x20if\x20user\x20exists\x20in\x20any\x20collection...');let _0xbfbe6a=![],_0xd40e3e=await Promise['all'](_0x22ddc4['map'](_0x143e91=>getDoc(doc(db,_0x143e91,_0x22ce93['uid']))));for(let _0xf77a=0x0;_0xf77a<_0xd40e3e['length'];_0xf77a++){if(_0xd40e3e[_0xf77a][_0x2eeacc(0x129)]()){_0xbfbe6a=!![],console[_0x2eeacc(0x14b)]('User\x20found\x20in\x20'+_0x22ddc4[_0xf77a]+_0x2eeacc(0x144));break;}}if(!_0xbfbe6a){console[_0x2eeacc(0x14b)]('User\x20not\x20found\x20in\x20any\x20collection,\x20checking\x20pending\x20registration');const _0x5b20be=doc(db,'pendingRegistrations',_0x22ce93['uid']),_0x54cb80=await getDoc(_0x5b20be);if(_0x54cb80['exists']()){const _0xc6c27e=_0x54cb80['data']();console[_0x2eeacc(0x14b)]('Found\x20pending\x20registration:',_0xc6c27e);if(_0x22ce93['emailVerified']){console['log'](_0x2eeacc(0x13b)),_0x5f518d['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22success-message\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Setting\x20up\x20your\x20account...\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>';if(_0xc6c27e['nonParticipant'])console[_0x2eeacc(0x14b)]('Processing\x20non-participant\x20registration'),await setDoc(doc(db,_0x2eeacc(0x147),_0x22ce93['uid']),{'username':_0xc6c27e['username'],'email':_0x22ce93['email'],'createdAt':serverTimestamp(),'isNonParticipant':!![]}),console['log'](_0x2eeacc(0x122)+_0xc6c27e['username']+_0x2eeacc(0x125));else{let _0x3afe48;switch(_0xc6c27e['gameMode']){case'D1':_0x3afe48='players';break;case'D2':_0x3afe48='playersD2';break;case'D3':_0x3afe48='playersD3';break;case _0x2eeacc(0x124):_0x3afe48='playersDuos';break;case'CTF':_0x3afe48=_0x2eeacc(0x13a);break;default:_0x3afe48='players';}console['log']('Processing\x20'+_0xc6c27e['gameMode']+'\x20player\x20registration\x20to\x20'+_0x3afe48);const _0x556ce0=collection(db,_0x3afe48),_0x25ff16=query(_0x556ce0,orderBy('position','desc'),limit(0x1)),_0x131428=await getDocs(_0x25ff16),_0x5cdd56=_0x131428[_0x2eeacc(0x128)]?0x1:_0x131428['docs'][0x0]['data']()['position']+0x1;await setDoc(doc(db,_0x3afe48,_0x22ce93['uid']),{'username':_0xc6c27e['username'],'email':_0x22ce93['email'],'eloRating':0x4b0,'position':_0x5cdd56,'createdAt':serverTimestamp(),'isAdmin':![],'matches':0x0,'wins':0x0,'losses':0x0,'gameMode':_0xc6c27e[_0x2eeacc(0x12e)]}),console['log']('New\x20player\x20'+_0xc6c27e['username']+'\x20added\x20to\x20'+_0x3afe48+'\x20at\x20position\x20'+_0x5cdd56);}await deleteDoc(_0x5b20be),setTimeout(()=>{const _0xaad8c5=_0x2eeacc;window['location'][_0xaad8c5(0x136)]='../index.html';},0x7d0);return;}else{_0x5f518d['innerHTML']=_0x2eeacc(0x153),document['getElementById'](_0x2eeacc(0x13e))['addEventListener']('click',()=>{resendVerificationEmail(_0x5677e7);}),await signOut(auth);return;}}}window['location']['href']='../index.html';}catch(_0x5ebe23){console[_0x2eeacc(0x11c)]('Login\x20error:',_0x5ebe23),_0x5f518d['textContent']='Login\x20failed:\x20'+_0x5ebe23['message'];}}function loginFormHandler(_0x4af431){const _0x1c69c5=a33_0xbf42;_0x4af431['preventDefault']();const _0x44849e=document['getElementById']('login-email')['value']['trim'](),_0x318837=document[_0x1c69c5(0x148)]('login-password')['value'],_0x546f1b=document['getElementById']('login-error');signInWithEmailAndPassword(auth,_0x44849e,_0x318837)['then'](_0x5812aa=>{const _0xd34e09=_0x1c69c5;console['log']('User\x20signed\x20in:',_0x5812aa[_0xd34e09(0x139)]),window['location']['href']=_0xd34e09(0x14f);})['catch'](_0x30b189=>{const _0x4a9901=_0x1c69c5;console['error']('Login\x20error:',_0x30b189),_0x546f1b['textContent']='Login\x20error:\x20'+_0x30b189['message'],_0x546f1b[_0x4a9901(0x121)]['display']='block';});}async function resendVerificationEmail(_0x54c149){const _0x3c2e15=a33_0xbf42;console['log']('Attempting\x20to\x20resend\x20verification\x20email\x20to:',_0x54c149);try{const _0x4364ac=document[_0x3c2e15(0x148)]('login-password')?.['value'];if(!_0x4364ac){console['error']('Password\x20not\x20available\x20for\x20resending\x20verification'),document['getElementById']('login-error')[_0x3c2e15(0x142)]='Please\x20enter\x20your\x20password\x20to\x20resend\x20verification\x20email';return;}const _0x4ce98d=await signInWithEmailAndPassword(auth,_0x54c149,_0x4364ac),_0x34e865=_0x4ce98d['user'];console['log']('User\x20signed\x20in\x20for\x20verification\x20email:',_0x34e865['uid']),await sendEmailVerification(_0x34e865),console['log']('Verification\x20email\x20sent'),document['getElementById']('login-error')[_0x3c2e15(0x12a)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22success-message\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Verification\x20email\x20has\x20been\x20resent\x20to\x20'+_0x54c149+_0x3c2e15(0x14e),await signOut(auth);}catch(_0x54ba15){console[_0x3c2e15(0x11c)]('Error\x20resending\x20verification\x20email:',_0x54ba15),document['getElementById']('login-error')['textContent']='Error\x20sending\x20verification\x20email:\x20'+_0x54ba15[_0x3c2e15(0x12d)];}}function a33_0xbf42(_0x2caf90,_0x2d5e79){const _0x37bc57=a33_0xb291();return a33_0xbf42=function(_0x5de44e,_0x2efae6){_0x5de44e=_0x5de44e-0x11c;let _0xb2910a=_0x37bc57[_0x5de44e];return _0xb2910a;},a33_0xbf42(_0x2caf90,_0x2d5e79);}window['resendVerificationEmail']=function(_0x3121e8){console['log']('Window.resendVerificationEmail\x20called\x20with:',_0x3121e8),resendVerificationEmail(_0x3121e8);},document['addEventListener']('DOMContentLoaded',()=>{const _0x269067=a33_0xbf42,_0xfd407b=document['getElementById'](_0x269067(0x152)),_0x55257c=document[_0x269067(0x148)]('register-mode');_0xfd407b&&_0x55257c&&_0xfd407b['addEventListener']('change',function(){const _0x3a368a=_0x269067;this['checked']?(_0x55257c['value']='',_0x55257c[_0x3a368a(0x130)]=!![]):_0x55257c['disabled']=![];});const _0x46771f=document[_0x269067(0x148)]('register-form'),_0x300c80=document['getElementById']('login-form');_0x46771f&&_0x46771f[_0x269067(0x11e)]('submit',handleRegister);_0x300c80&&_0x300c80[_0x269067(0x11e)]('submit',handleLogin);const _0x26148a=document['getElementById'](_0x269067(0x146)),_0xecc643=document['getElementById']('show-login');_0x26148a&&_0x26148a['addEventListener']('click',_0x2d28db=>{const _0x273d8a=_0x269067;_0x2d28db[_0x273d8a(0x14c)](),document['getElementById'](_0x273d8a(0x133))['style']['display']='none',document[_0x273d8a(0x148)]('register-container')[_0x273d8a(0x121)]['display']='block';}),_0xecc643&&_0xecc643['addEventListener']('click',_0x4bdca5=>{const _0x467fe3=_0x269067;_0x4bdca5['preventDefault'](),document['getElementById']('register-container')['style'][_0x467fe3(0x134)]=_0x467fe3(0x143),document['getElementById']('login-container')['style']['display']='block';});});
const a15_0x16839c=a15_0x5558,a15_0x5372f5=(function(){let _0xd603de=!![];return function(_0x211fbb,_0x39b3be){const _0x366e40=_0xd603de?function(){if(_0x39b3be){const _0x305414=_0x39b3be['apply'](_0x211fbb,arguments);return _0x39b3be=null,_0x305414;}}:function(){};return _0xd603de=![],_0x366e40;};}()),a15_0x5c51be=a15_0x5372f5(this,function(){const _0x1fc65a=a15_0x5558;let _0x574b71;try{const _0x4d5976=Function('return\x20(function()\x20'+_0x1fc65a(0x136)+');');_0x574b71=_0x4d5976();}catch(_0x1db657){_0x574b71=window;}const _0x351826=_0x574b71['console']=_0x574b71[_0x1fc65a(0x142)]||{},_0x32e113=['log','warn',_0x1fc65a(0x12c),'error','exception',_0x1fc65a(0x133),'trace'];for(let _0x11fc3f=0x0;_0x11fc3f<_0x32e113['length'];_0x11fc3f++){const _0x4a70f5=a15_0x5372f5[_0x1fc65a(0x131)]['prototype']['bind'](a15_0x5372f5),_0x3764ab=_0x32e113[_0x11fc3f],_0x40e87f=_0x351826[_0x3764ab]||_0x4a70f5;_0x4a70f5['__proto__']=a15_0x5372f5[_0x1fc65a(0x13b)](a15_0x5372f5),_0x4a70f5['toString']=_0x40e87f[_0x1fc65a(0x141)]['bind'](_0x40e87f),_0x351826[_0x3764ab]=_0x4a70f5;}});a15_0x5c51be();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc,where}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D3=[{'name':a15_0x16839c(0x139),'elo':0x7d0},{'name':'Gold','elo':0x708},{'name':'Silver','elo':0x640},{'name':a15_0x16839c(0x12d),'elo':0x578},{'name':'Unranked','elo':0x4b0}];let lastVisibleD3=null;async function getUsernameByIdD3(_0x5177e3){const _0x59eaf4=a15_0x16839c;try{if(!_0x5177e3)return'Unknown\x20Player';const _0x2bc005=await getDoc(doc(db,_0x59eaf4(0x143),_0x5177e3));if(_0x2bc005[_0x59eaf4(0x140)]())return _0x2bc005['data']()['username']||'Unknown\x20Player';const _0xa8cd3e=await getDocs(query(collection(db,'approvedMatchesD3'),where('winnerId','==',_0x5177e3),limit(0x1)));if(!_0xa8cd3e['empty'])return _0xa8cd3e['docs'][0x0][_0x59eaf4(0x135)]()['winnerUsername']||_0x59eaf4(0x13f);const _0x4b8df3=await getDocs(query(collection(db,_0x59eaf4(0x132)),where(_0x59eaf4(0x12e),'==',_0x5177e3),limit(0x1)));if(!_0x4b8df3['empty'])return _0x4b8df3[_0x59eaf4(0x13a)][0x0]['data']()['loserUsername']||'Unknown\x20Player';return'Unknown\x20Player';}catch(_0x401b97){return console['error']('Error\x20getting\x20D3\x20username:',_0x401b97),'Unknown\x20Player';}}function a15_0x42b2(){const _0x611cc5=['size','info','Bronze','loserId','Error\x20recording\x20D3\x20ELO\x20history:','eloHistoryD3','constructor','approvedMatchesD3','table','timestamp','data','{}.constructor(\x22return\x20this\x22)(\x20)','previousElo','log','Emerald','docs','bind','newElo','map','all','Unknown\x20Player','exists','toString','console','playersD3','Error\x20fetching\x20D3\x20ELO\x20history:'];a15_0x42b2=function(){return _0x611cc5;};return a15_0x42b2();}export async function recordEloChangeD3({playerId:_0x45cf20,previousElo:_0x4db744,newElo:_0x375fa9,opponentId:_0x4d81dc,matchResult:_0x149d1,previousPosition:_0x3c6bea,newPosition:_0x4a275f,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x326421,timestamp:_0xb2ec11}){const _0x5a0cf9=a15_0x16839c;try{const _0x2c5808=doc(collection(db,'eloHistoryD3'));let _0x2288d8='match';if(isPromotion)_0x2288d8='promotion';if(isDemotion)_0x2288d8='demotion';let _0x5afa52='Unranked';if(_0x375fa9>=0x7d0)_0x5afa52='Emerald';else{if(_0x375fa9>=0x708)_0x5afa52='Gold';else{if(_0x375fa9>=0x640)_0x5afa52='Silver';else{if(_0x375fa9>=0x578)_0x5afa52='Bronze';}}}return await setDoc(_0x2c5808,{'type':_0x2288d8,'player':_0x45cf20,'opponent':_0x4d81dc,'previousElo':_0x4db744,'newElo':_0x375fa9,'change':_0x375fa9-_0x4db744,'matchResult':_0x149d1,'previousPosition':_0x3c6bea,'newPosition':_0x4a275f,'rankAchieved':_0x5afa52,'matchId':_0x326421,'timestamp':_0xb2ec11||serverTimestamp(),'gameMode':'D3'}),console[_0x5a0cf9(0x138)]('D3\x20ELO\x20history\x20recorded\x20for\x20'+_0x45cf20),!![];}catch(_0x357e42){console['error'](_0x5a0cf9(0x12f),_0x357e42);throw _0x357e42;}}function a15_0x5558(_0x4e2d4b,_0x386f9a){const _0x5c51be=a15_0x42b2();return a15_0x5558=function(_0x5372f5,_0xd744ed){_0x5372f5=_0x5372f5-0x12b;let _0x42b2d9=_0x5c51be[_0x5372f5];return _0x42b2d9;},a15_0x5558(_0x4e2d4b,_0x386f9a);}export async function getEloHistoryD3(_0x11054f=0x14){const _0x2278ae=a15_0x16839c;try{const _0x5ba081=collection(db,_0x2278ae(0x130));let _0x750c94;lastVisibleD3?_0x750c94=query(_0x5ba081,orderBy(_0x2278ae(0x134),'desc'),startAfter(lastVisibleD3),limit(_0x11054f)):_0x750c94=query(_0x5ba081,orderBy('timestamp','desc'),limit(_0x11054f));const _0x324017=await getDocs(_0x750c94);if(_0x324017['empty'])return{'entries':[],'hasMore':![]};lastVisibleD3=_0x324017['docs'][_0x324017['docs']['length']-0x1];const _0x2adc99=_0x324017['docs'][_0x2278ae(0x13d)](async _0x35ca1e=>{const _0x44eb52=_0x2278ae,_0x1697fb=_0x35ca1e['data'](),[_0x4530e0,_0x554944]=await Promise['all']([getUsernameByIdD3(_0x1697fb['player']),getUsernameByIdD3(_0x1697fb['opponent'])]);return{..._0x1697fb,'playerUsername':_0x4530e0,'opponentUsername':_0x554944,'change':_0x1697fb[_0x44eb52(0x13c)]-_0x1697fb[_0x44eb52(0x137)],'timestamp':_0x1697fb['timestamp']};}),_0x4be173=await Promise[_0x2278ae(0x13e)](_0x2adc99);return{'entries':_0x4be173,'hasMore':_0x324017[_0x2278ae(0x12b)]===_0x11054f};}catch(_0x139f4c){console['error'](_0x2278ae(0x144),_0x139f4c);throw _0x139f4c;}}export function resetPaginationD3(){lastVisibleD3=null;}
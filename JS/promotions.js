const a46_0x28440b=a46_0x5863,a46_0x4afa1a=(function(){let _0x4adeb8=!![];return function(_0x3cc2f9,_0x4c27f6){const _0x5489e2=_0x4adeb8?function(){if(_0x4c27f6){const _0x1ba701=_0x4c27f6['apply'](_0x3cc2f9,arguments);return _0x4c27f6=null,_0x1ba701;}}:function(){};return _0x4adeb8=![],_0x5489e2;};}()),a46_0x519da6=a46_0x4afa1a(this,function(){const _0x5de3bc=a46_0x5863,_0x58b694=function(){const _0x5ef902=a46_0x5863;let _0x48f3b8;try{_0x48f3b8=Function(_0x5ef902(0x98)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x21cb7b){_0x48f3b8=window;}return _0x48f3b8;},_0x4101d8=_0x58b694(),_0x5e0aba=_0x4101d8['console']=_0x4101d8['console']||{},_0x108dc7=[_0x5de3bc(0x94),'warn','info',_0x5de3bc(0xc1),'exception','table',_0x5de3bc(0x8c)];for(let _0x4e11cb=0x0;_0x4e11cb<_0x108dc7['length'];_0x4e11cb++){const _0x10dce5=a46_0x4afa1a[_0x5de3bc(0xb0)][_0x5de3bc(0xc8)]['bind'](a46_0x4afa1a),_0x27126a=_0x108dc7[_0x4e11cb],_0x42eabb=_0x5e0aba[_0x27126a]||_0x10dce5;_0x10dce5['__proto__']=a46_0x4afa1a[_0x5de3bc(0xd6)](a46_0x4afa1a),_0x10dce5['toString']=_0x42eabb[_0x5de3bc(0xb7)]['bind'](_0x42eabb),_0x5e0aba[_0x27126a]=_0x10dce5;}});a46_0x519da6();import{collection,doc,query,where,orderBy,limit,getDocs,addDoc,getDoc,serverTimestamp,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{auth,db}from'./firebase-config.js';class PromotionManager{constructor(){const _0x310f92=a46_0x5863;this[_0x310f92(0x9d)]=0x18,this[_0x310f92(0xd4)]=[{'threshold':0x578,'name':'Bronze','color':'#CD7F32'},{'threshold':0x640,'name':_0x310f92(0xbc),'color':'#C0C0C0'},{'threshold':0x708,'name':'Gold','color':_0x310f92(0xe8)},{'threshold':0x834,'name':'Emerald','color':'#50C878'}],this['bannerContainer']=null,this['lastFetchTime']=0x0,this[_0x310f92(0xcd)]=0xea60,this['pollingInterval']=null,this['usernameCache']={};}['initialize'](){const _0x2ab476=a46_0x5863;this['bannerContainer']=document[_0x2ab476(0xa0)]('promotion-banner-container');if(!this[_0x2ab476(0xdb)]){console['error'](_0x2ab476(0xa9));return;}this[_0x2ab476(0xb9)]();const _0x367af9='promotions_checked_'+new Date()['toDateString'](),_0x352c5d=sessionStorage['getItem'](_0x367af9);!_0x352c5d&&(this[_0x2ab476(0x9f)](),sessionStorage['setItem'](_0x367af9,'true')),document['addEventListener']('visibilitychange',()=>{const _0x258161=_0x2ab476;document[_0x258161(0xae)]==='visible'&&!sessionStorage['getItem'](_0x367af9)&&(this['fetchRecentPromotions'](),sessionStorage[_0x258161(0xde)](_0x367af9,'true'));}),window['addEventListener'](_0x2ab476(0xba),()=>{const _0x5c0075=_0x2ab476;this['pollingInterval']&&clearInterval(this[_0x5c0075(0xe6)]);});}[a46_0x28440b(0xb9)](){const _0x1d7492=a46_0x28440b;this[_0x1d7492(0xdb)]['innerHTML']='',this['bannerContainer'][_0x1d7492(0x92)]['display']=_0x1d7492(0xc6);}async[a46_0x28440b(0x9f)](){const _0x862a74=a46_0x28440b;try{const _0x554304=Date['now']();if(_0x554304-this['lastFetchTime']<this['fetchInterval'])return;this[_0x862a74(0xa3)]=_0x554304;const _0x3e941d=collection(db,'eloHistory'),_0x1d09db=query(_0x3e941d,where('type','in',['promotion','demotion']),orderBy('timestamp','desc'),limit(0x14)),_0x335fc5=await getDocs(_0x1d09db),_0x172068=[];_0x335fc5[_0x862a74(0xb8)](_0x1edd36=>{const _0x5a13d3=_0x862a74,_0x5d420c={'id':_0x1edd36['id'],..._0x1edd36[_0x5a13d3(0xce)]()};this['shouldShowPromotion'](_0x1edd36['id'])&&this['isNewRankChange'](_0x5d420c)&&_0x172068['push'](_0x5d420c);}),_0x172068[_0x862a74(0xe5)]>0x0&&await this['processRankChanges'](_0x172068);}catch(_0x33f5bc){console['error'](_0x862a74(0xe4),_0x33f5bc);}}async[a46_0x28440b(0xbd)](_0x3cd8f1){const _0x42acf4=a46_0x28440b;if(_0x3cd8f1['length']===0x0)return;_0x3cd8f1['sort']((_0xd9bcf2,_0x37b3d7)=>{const _0x5b65b5=a46_0x5863,_0x4e6845=_0xd9bcf2['timestamp']?.['toMillis']?.()||_0xd9bcf2['timestamp']?.['seconds']*0x3e8||0x0,_0x4fbec6=_0x37b3d7[_0x5b65b5(0x8a)]?.['toMillis']?.()||_0x37b3d7['timestamp']?.['seconds']*0x3e8||0x0;return _0x4fbec6-_0x4e6845;});const _0x19bc09=this['bannerContainer']['children'][_0x42acf4(0xe5)],_0x4a2e3e=0x3-_0x19bc09;if(_0x4a2e3e<=0x0)return;const _0x32edfb=_0x3cd8f1['slice'](0x0,_0x4a2e3e);for(let _0x5d6165=0x0;_0x5d6165<_0x32edfb[_0x42acf4(0xe5)];_0x5d6165++){const _0x251a71=_0x32edfb[_0x5d6165],_0x574ecc=auth['currentUser'];try{setTimeout(()=>{const _0x29ac6f=_0x42acf4;this[_0x29ac6f(0x95)](_0x251a71);},_0x5d6165*0x3e8),_0x574ecc&&_0x251a71['player']===_0x574ecc['displayName']&&this['showRankChangeLightbox'](_0x251a71[_0x42acf4(0xaf)],_0x251a71['rankAchieved']);}catch(_0x251657){console['error']('Error\x20processing\x20rank\x20change:',_0x251657);}}}[a46_0x28440b(0xb4)](_0x4c2deb){const _0x4cbe2c=a46_0x28440b;try{const _0x5b8a38='promotion_'+_0x4c2deb,_0x377672=localStorage['getItem'](_0x5b8a38);if(_0x377672){let _0x3d8726;try{_0x3d8726=JSON[_0x4cbe2c(0xa2)](_0x377672);}catch(_0x288a5a){return console[_0x4cbe2c(0xa4)]('Invalid\x20storage\x20format\x20for\x20'+_0x5b8a38+',\x20treating\x20as\x20new'),!![];}if(_0x3d8726['ignored']===!![])return console['log'](_0x4cbe2c(0xa1)+_0x4c2deb+'\x20is\x20permanently\x20ignored'),![];const _0x1e8923=Date['now']();if(_0x3d8726['userDismissed']&&_0x1e8923-_0x3d8726[_0x4cbe2c(0x8a)]<this['DISPLAY_HOURS']*0x3c*0x3c*0x3e8)return console['log'](_0x4cbe2c(0xa1)+_0x4c2deb+'\x20was\x20dismissed\x20by\x20user\x20within\x20last\x20'+this['DISPLAY_HOURS']+_0x4cbe2c(0x9a)),![];if(_0x3d8726['systemDismissed']&&_0x1e8923-_0x3d8726[_0x4cbe2c(0x8a)]<0x4*0x3c*0x3c*0x3e8)return console[_0x4cbe2c(0x94)]('Promotion\x20'+_0x4c2deb+'\x20was\x20auto-dismissed\x20within\x20last\x204\x20hours'),![];}return!![];}catch(_0x5be3d4){return console['error'](_0x4cbe2c(0xd9),_0x5be3d4),![];}}['ignorePromotion'](_0x19f6cc){const _0x2f8b38=a46_0x28440b;try{const _0x7cf42e='promotion_'+_0x19f6cc;localStorage['setItem'](_0x7cf42e,JSON['stringify']({'timestamp':Date[_0x2f8b38(0xe0)](),'ignored':!![]}));}catch(_0x2f7a2c){console['error']('Error\x20saving\x20promotion\x20preference:',_0x2f7a2c);}}[a46_0x28440b(0x95)](_0xf8a1e2){this['resolveUserId'](_0xf8a1e2)['then'](_0x4f436d=>{const _0x50ead3=a46_0x5863,_0x3242c2='promotion_'+_0xf8a1e2['id'],_0x1ca601=localStorage['getItem'](_0x3242c2);if(_0x1ca601)try{const _0xb144c6=JSON['parse'](_0x1ca601);if(_0xb144c6['ignored']===!![]){console[_0x50ead3(0x94)](_0x50ead3(0xc0)+_0xf8a1e2['id']);return;}}catch(_0x5c50f2){}localStorage['setItem'](_0x3242c2,JSON[_0x50ead3(0x8b)]({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':![],'seenAt':Date[_0x50ead3(0xe0)]()})),this['bannerContainer'][_0x50ead3(0x92)]['display']='block';while(this['bannerContainer']['children']['length']>=0x3){this['bannerContainer']['removeChild'](this['bannerContainer']['firstChild']);}const _0xaae4c4=document[_0x50ead3(0x90)](_0x50ead3(0xab));_0xaae4c4['className']='promotion-banner',_0xaae4c4['setAttribute']('data-rank',_0x4f436d['rankAchieved']),_0xaae4c4['setAttribute']('data-id',_0x4f436d['id']);const _0x1740c4=document['createElement']('div');_0x1740c4['className']=_0x50ead3(0xa8);const _0x5f5093=_0x4f436d['resolvedName']||_0x4f436d['player']||_0x4f436d['username']||_0x4f436d[_0x50ead3(0xc9)]||_0x4f436d['displayName']||'A\x20player',_0x27fce7=_0x4f436d[_0x50ead3(0xaf)]==='promotion'?_0x5f5093+_0x50ead3(0xcb):_0x5f5093+'\x20was\x20demoted\x20to';_0x1740c4['innerHTML']=_0x27fce7+'\x20<span\x20class=\x22rank-text\x22>'+_0x4f436d['rankAchieved']+'</span>';const _0x586a08=document[_0x50ead3(0x90)](_0x50ead3(0xab));_0x586a08['className']='banner-actions';const _0x644063=document['createElement']('button');_0x644063[_0x50ead3(0xd0)]=_0x50ead3(0x8d),_0x644063['innerHTML']='&times;',_0x644063['title']='Dismiss';const _0x4dc594=document['createElement']('button');_0x4dc594['className']='ignore-btn',_0x4dc594['textContent']='Don\x27t\x20show\x20again',_0x4dc594['title']=_0x50ead3(0x8f),_0x586a08['appendChild'](_0x4dc594),_0x586a08[_0x50ead3(0x96)](_0x644063),_0xaae4c4[_0x50ead3(0x96)](_0x1740c4),_0xaae4c4['appendChild'](_0x586a08),this[_0x50ead3(0xdb)]['appendChild'](_0xaae4c4),void _0xaae4c4['offsetWidth'],setTimeout(()=>{const _0x45804b=_0x50ead3;_0xaae4c4['classList']['add'](_0x45804b(0xd2));},0x32),_0x644063['addEventListener']('click',()=>{const _0x5f5957=_0x50ead3;localStorage['setItem'](_0x3242c2,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':!![],'systemDismissed':![]})),_0xaae4c4[_0x5f5957(0x93)]['remove']('new-rank-change'),_0xaae4c4[_0x5f5957(0x93)]['add'](_0x5f5957(0xea)),setTimeout(()=>{const _0x9904c3=_0x5f5957;_0xaae4c4['parentNode']&&(_0xaae4c4['remove'](),this['bannerContainer']['children'][_0x9904c3(0xe5)]===0x0&&(this[_0x9904c3(0xdb)]['style']['display']=_0x9904c3(0xc6)));},0x1f4);}),_0x4dc594[_0x50ead3(0x9e)]('click',()=>{localStorage['setItem'](_0x3242c2,JSON['stringify']({'timestamp':Date['now'](),'ignored':!![],'userDismissed':!![],'systemDismissed':![]})),_0xaae4c4['classList']['remove']('new-rank-change'),_0xaae4c4['classList']['add']('dismissing'),setTimeout(()=>{const _0xd8a1ce=a46_0x5863;_0xaae4c4['parentNode']&&(_0xaae4c4['remove'](),this[_0xd8a1ce(0xdb)]['children']['length']===0x0&&(this['bannerContainer']['style']['display']='none'));},0x1f4);}),setTimeout(()=>{const _0x2c08d8=_0x50ead3;_0xaae4c4['parentNode']&&(_0xaae4c4[_0x2c08d8(0x93)]['remove']('new-rank-change'),_0xaae4c4['classList']['add']('dismissing'),localStorage['setItem'](_0x3242c2,JSON[_0x2c08d8(0x8b)]({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':!![]})),setTimeout(()=>{const _0xfd5831=_0x2c08d8;_0xaae4c4['parentNode']&&(_0xaae4c4['remove'](),this[_0xfd5831(0xdb)]['children']['length']===0x0&&(this['bannerContainer'][_0xfd5831(0x92)]['display']='none'));},0x1f4));},0x3a98);});}async[a46_0x28440b(0x9b)](_0x1a43b3){const _0x3a10b5=a46_0x28440b,_0x57c084={..._0x1a43b3},_0x11ea36=[_0x1a43b3[_0x3a10b5(0xe9)],_0x1a43b3['username'],_0x1a43b3[_0x3a10b5(0xc9)],_0x1a43b3['displayName']],_0xc07071=_0x11ea36['some'](_0x1463cc=>_0x1463cc&&typeof _0x1463cc==='string'&&!_0x1463cc['includes'](_0x3a10b5(0xd3))&&!/^[a-zA-Z0-9]{20,}$/['test'](_0x1463cc));if(_0xc07071)return _0x57c084;let _0x54f6b0=null;if(_0x1a43b3['userId'])_0x54f6b0=_0x1a43b3[_0x3a10b5(0xa6)];else _0x1a43b3['player']&&/^[A-Za-z0-9]{20,}$/['test'](_0x1a43b3['player'])&&(_0x54f6b0=_0x1a43b3['player']);if(!_0x54f6b0)return _0x57c084;try{const _0x1dce67=await getDoc(doc(db,_0x3a10b5(0xb1),_0x54f6b0));if(_0x1dce67[_0x3a10b5(0xe1)]()){const _0x2941d5=_0x1dce67[_0x3a10b5(0xce)]();if(_0x2941d5[_0x3a10b5(0xaa)])return _0x57c084['resolvedName']=_0x2941d5['username'],_0x57c084;}const _0x3f5d7c=await getDocs(query(collection(db,'approvedMatches'),where(_0x3a10b5(0xda),'==',_0x54f6b0),orderBy('date','desc'),limit(0x1)));if(!_0x3f5d7c['empty']){const _0x354f6e=_0x3f5d7c[_0x3a10b5(0xc2)][0x0][_0x3a10b5(0xce)]();if(_0x354f6e[_0x3a10b5(0xac)])return _0x57c084['resolvedName']=_0x354f6e['winnerUsername'],_0x57c084;}const _0x5d2d4c=await getDocs(query(collection(db,'approvedMatches'),where('loserId','==',_0x54f6b0),orderBy(_0x3a10b5(0xa7),'desc'),limit(0x1)));if(!_0x5d2d4c['empty']){const _0x443c30=_0x5d2d4c['docs'][0x0][_0x3a10b5(0xce)]();if(_0x443c30[_0x3a10b5(0xb5)])return _0x57c084['resolvedName']=_0x443c30['loserUsername'],console['log']('Resolved\x20'+_0x54f6b0+_0x3a10b5(0xd5)+_0x443c30['loserUsername']+'\x20(loser)'),_0x57c084;}}catch(_0x4a93fa){console['error'](_0x3a10b5(0xd1),_0x4a93fa);}return console['warn']('Failed\x20to\x20resolve\x20user\x20ID:\x20'+_0x54f6b0),_0x57c084;}[a46_0x28440b(0xd7)](_0x4d5eaa,_0x4ecd9d){const _0x6bf81f=a46_0x28440b;let _0x4adf4e=document['getElementById'](_0x6bf81f(0x99));!_0x4adf4e&&(_0x4adf4e=document['createElement']('div'),_0x4adf4e['id']='rankChangeModal',_0x4adf4e[_0x6bf81f(0xd0)]='rank-change-modal\x20'+_0x4d5eaa,document['body']['appendChild'](_0x4adf4e));const _0x5d32f6=_0x4d5eaa==='promotion'?'Congratulations!':'Rank\x20Update',_0x23c0b6=_0x4d5eaa==='promotion'?'You\x27ve\x20been\x20promoted\x20to':'You\x27ve\x20been\x20demoted\x20to';_0x4adf4e['innerHTML']=_0x6bf81f(0xe7)+_0x5d32f6+'</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>'+_0x23c0b6+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22rank-name\x22>'+_0x4ecd9d+_0x6bf81f(0xc5),_0x4adf4e['style']['display']=_0x6bf81f(0xdf),document['getElementById']('rank-change-ok-btn')[_0x6bf81f(0x9e)]('click',()=>{const _0x3bfe9f=_0x6bf81f;_0x4adf4e[_0x3bfe9f(0x92)]['display']=_0x3bfe9f(0xc6);}),_0x4adf4e['addEventListener']('click',_0x25059c=>{const _0x343f19=_0x6bf81f;_0x25059c['target']===_0x4adf4e&&(_0x4adf4e['style'][_0x343f19(0xb6)]='none');});}async['checkAndRecordPromotion'](_0x158198,_0xdf527a,_0x55f777,_0x454ec0={}){const _0x5dea77=a46_0x28440b;try{if(_0xdf527a===_0x55f777||!_0x158198)return null;const _0x4bf0c6=_0x454ec0['source']||'automatic',_0x2c963c=_0x454ec0['matchId']||null,_0x3a5b0d=_0x454ec0['adminUser']||null;console['log']('Processing\x20potential\x20rank\x20change:\x20'+_0x55f777+'\x20→\x20'+_0xdf527a+_0x5dea77(0x91)+_0x4bf0c6+')');let _0x1dca9e=null,_0x384650=null;try{const _0x2cd704=await getDoc(doc(db,'players',_0x158198));if(_0x2cd704['exists']()){const _0x40da2e=_0x2cd704[_0x5dea77(0xce)]();_0x1dca9e=_0x40da2e['username']||_0x40da2e['displayName']||null,_0x384650=_0x40da2e['displayName']||_0x40da2e['username']||null;}!_0x1dca9e&&_0x454ec0[_0x5dea77(0xaa)]&&(_0x1dca9e=_0x454ec0['username'],_0x384650=_0x454ec0['username']);!_0x1dca9e&&auth['currentUser']&&(_0x1dca9e=auth['currentUser'][_0x5dea77(0x9c)]||auth['currentUser']['email']['split']('@')[0x0],_0x384650=auth['currentUser']['displayName']||null);if(!_0x1dca9e){const _0x2e6f1b=query(collection(db,_0x5dea77(0xbe)),where('winnerId','==',_0x158198),limit(0x1)),_0x25e002=await getDocs(_0x2e6f1b);if(!_0x25e002['empty'])_0x1dca9e=_0x25e002['docs'][0x0]['data']()['winnerUsername']||_0x5dea77(0xbf),_0x384650=_0x1dca9e;else{const _0x58feab=query(collection(db,'approvedMatches'),where('loserId','==',_0x158198),limit(0x1)),_0xc36188=await getDocs(_0x58feab);!_0xc36188[_0x5dea77(0xbb)]&&(_0x1dca9e=_0xc36188[0x0][_0x5dea77(0xce)]()['loserUsername']||'Unknown\x20Player',_0x384650=_0x1dca9e);}}}catch(_0x10b9a4){console['error'](_0x5dea77(0xdd),_0x10b9a4);}!_0x1dca9e&&(console['warn'](_0x5dea77(0xc3),_0x158198),_0x1dca9e='A\x20player',_0x384650=_0x5dea77(0xbf));const _0x101d2c=this['getRankName'](_0x55f777),_0x8c35b3=this['getRankName'](_0xdf527a);if(_0x101d2c!==_0x8c35b3){const _0x210e4a=_0xdf527a>_0x55f777,_0x45b6b8=_0x210e4a?'promotion':_0x5dea77(0xd8),_0x358065=_0x8c35b3;console[_0x5dea77(0x94)](_0x5dea77(0xad)+_0x45b6b8+'\x20for\x20'+_0x1dca9e+':\x20'+_0x55f777+'\x20('+_0x101d2c+')\x20→\x20'+_0xdf527a+'\x20('+_0x8c35b3+')');try{const _0x11fca8={'player':_0x1dca9e,'playerUsername':_0x1dca9e,'username':_0x1dca9e,'displayName':_0x384650,'userId':_0x158198,'type':_0x45b6b8,'rankAchieved':_0x358065,'timestamp':serverTimestamp(),'previousElo':_0x55f777,'newElo':_0xdf527a,'change':_0xdf527a-_0x55f777,'previousRank':_0x101d2c,'newRank':_0x8c35b3,'source':_0x4bf0c6};if(_0x4bf0c6==='match'&&_0x2c963c)_0x11fca8[_0x5dea77(0xcc)]=_0x2c963c;else _0x4bf0c6==='admin'&&_0x3a5b0d?(_0x11fca8['modifiedBy']=_0x3a5b0d,_0x11fca8['isAutomatic']=![]):_0x11fca8['isAutomatic']=!![];const _0x96785d=writeBatch(db),_0xb1c612=doc(collection(db,_0x5dea77(0xb3))),_0x5aae05=doc(collection(db,_0x5dea77(0xb2)));return _0x96785d['set'](_0xb1c612,_0x11fca8),_0x96785d[_0x5dea77(0xdc)](_0x5aae05,_0x11fca8),await _0x96785d['commit'](),await this['sendPromotionNotification'](_0x158198,_0x1dca9e,_0x55f777,_0xdf527a,_0x101d2c,_0x8c35b3,_0x45b6b8,{'displayName':_0x384650,'source':_0x4bf0c6,'matchId':_0x2c963c,'ladder':_0x454ec0['ladder']||'D1'}),console[_0x5dea77(0x94)](_0x5dea77(0xe3)+_0x45b6b8+'\x20for\x20'+_0x1dca9e+'\x20to\x20'+_0x358065),_0x358065;}catch(_0x49735c){console['error']('Error\x20writing\x20promotion\x20records:',_0x49735c);try{return await addDoc(collection(db,'eloHistory'),{'player':_0x1dca9e,'playerUsername':_0x1dca9e,'username':_0x1dca9e,'displayName':_0x384650,'userId':_0x158198,'type':_0x45b6b8,'rankAchieved':_0x358065,'timestamp':serverTimestamp(),'previousElo':_0x55f777,'newElo':_0xdf527a,'change':_0xdf527a-_0x55f777,'previousRank':_0x101d2c,'source':_0x4bf0c6,'isAutomatic':_0x4bf0c6!=='admin'}),await this['sendPromotionNotification'](_0x158198,_0x1dca9e,_0x55f777,_0xdf527a,_0x101d2c,_0x8c35b3,_0x45b6b8,{'displayName':_0x384650,'source':_0x4bf0c6,'matchId':_0x2c963c,'ladder':_0x454ec0['ladder']||'D1'}),_0x358065;}catch(_0x36409c){return console[_0x5dea77(0xc1)]('Fallback\x20write\x20failed:',_0x36409c),null;}}}return null;}catch(_0x12d978){return console['error']('Error\x20in\x20promotion/demotion\x20recording:',_0x12d978),null;}}[a46_0x28440b(0xcf)](_0x44b96f){const _0x222b43=a46_0x28440b;for(let _0x83907b=this[_0x222b43(0xd4)]['length']-0x1;_0x83907b>=0x0;_0x83907b--){if(_0x44b96f>=this[_0x222b43(0xd4)][_0x83907b]['threshold'])return this['RANKS'][_0x83907b]['name'];}return'Unranked';}[a46_0x28440b(0xc4)](){this['pollingInterval']&&clearInterval(this['pollingInterval']);}['isNewRankChange'](_0x523ae1){const _0x1dceea=a46_0x28440b;if(_0x523ae1['timestamp']){const _0x2a50ff=_0x523ae1[_0x1dceea(0x8a)]['seconds']*0x3e8,_0x1cd54d=Date[_0x1dceea(0xe0)](),_0x3fbe6d=(_0x1cd54d-_0x2a50ff)/(0x3e8*0x3c*0x3c);if(_0x3fbe6d>0x18)return![];}if(_0x523ae1['previousRank']&&_0x523ae1['newRank']&&_0x523ae1['previousRank']!==_0x523ae1['newRank'])return!![];return![];}async['sendPromotionNotification'](_0x7ec168,_0x5c948e,_0x9a3885,_0x3a2197,_0x16dd97,_0x5de47d,_0x36d6af,_0x135c8f={}){const _0x5b09ca=a46_0x28440b;try{console['log']('STARTING\x20notification\x20for\x20'+_0x5c948e+_0x5b09ca(0xc7)+_0x36d6af);const _0x201057={'userId':_0x7ec168,'username':_0x5c948e,'displayName':_0x135c8f['displayName']||_0x5c948e,'oldElo':parseInt(_0x9a3885),'newElo':parseInt(_0x3a2197),'eloDifference':parseInt(_0x3a2197)-parseInt(_0x9a3885),'oldRank':_0x16dd97,'newRank':_0x5de47d,'type':_0x36d6af,'timestamp':serverTimestamp(),'processed':![],'source':_0x135c8f[_0x5b09ca(0x8e)]||'automatic','matchId':_0x135c8f['matchId']||null,'ladder':_0x135c8f['ladder']||'D1','adminUser':_0x135c8f['adminUser']||null};console['log'](_0x5b09ca(0x97),_0x201057);const _0x38c00b=await addDoc(collection(db,'promotionNotifications'),_0x201057);return console['log'](_0x5b09ca(0xe2)+_0x38c00b['id']),!![];}catch(_0xa72979){return console['error']('Error\x20sending\x20Discord\x20notification:',_0xa72979),![];}}}export const promotionManager=new PromotionManager();function a46_0x8e7c(){const _0x21e27f=['timestamp','stringify','trace','dismiss-btn','source','Never\x20show\x20this\x20promotion\x20again','createElement','\x20(source:\x20','style','classList','log','showRankChangeBanner','appendChild','Creating\x20Discord\x20notification:','return\x20(function()\x20','rankChangeModal','\x20hours','resolveUserId','displayName','DISPLAY_HOURS','addEventListener','fetchRecentPromotions','getElementById','Promotion\x20','parse','lastFetchTime','warn','initialize','userId','date','promotion-details','Promotion\x20banner\x20container\x20not\x20found','username','div','winnerUsername','Recording\x20','visibilityState','type','constructor','players','promotionHistory','eloHistory','shouldShowPromotion','loserUsername','display','toString','forEach','setupBannerContainer','beforeunload','empty','Silver','processRankChanges','approvedMatches','Unknown\x20Player','Skipping\x20ignored\x20promotion:\x20','error','docs','Could\x20not\x20resolve\x20username\x20for\x20userId:','cleanup','</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22rank-change-button\x22\x20id=\x22rank-change-ok-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Got\x20it!\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','none','\x27s\x20','prototype','playerUsername','DOMContentLoaded','\x20was\x20promoted\x20to','matchId','fetchInterval','data','getRankName','className','Error\x20resolving\x20user\x20ID:','new-rank-change','ID:','RANKS','\x20to\x20','bind','showRankChangeLightbox','demotion','Error\x20checking\x20promotion\x20visibility:','winnerId','bannerContainer','set','Error\x20resolving\x20username:','setItem','flex','now','exists','Discord\x20notification\x20sent\x20successfully\x20with\x20ID:\x20','Successfully\x20recorded\x20','Error\x20fetching\x20promotions:','length','pollingInterval','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rank-change-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2\x20class=\x22rank-change-title\x22>','#FFD700','player','dismissing'];a46_0x8e7c=function(){return _0x21e27f;};return a46_0x8e7c();}function a46_0x5863(_0x38a98e,_0x4c9a8a){const _0x519da6=a46_0x8e7c();return a46_0x5863=function(_0x4afa1a,_0x48ca4f){_0x4afa1a=_0x4afa1a-0x8a;let _0x8e7c5b=_0x519da6[_0x4afa1a];return _0x8e7c5b;},a46_0x5863(_0x38a98e,_0x4c9a8a);}document['addEventListener'](a46_0x28440b(0xca),()=>{const _0x119511=a46_0x28440b;promotionManager[_0x119511(0xa5)]();});export const initializePromotionTracker=()=>promotionManager['initialize']();export const checkAndRecordPromotion=(_0x5e4698,_0x4151ef,_0x57abf7,_0x6a2e8b)=>promotionManager['checkAndRecordPromotion'](_0x5e4698,_0x4151ef,_0x57abf7,_0x6a2e8b);export const getRankName=_0x5e48a9=>promotionManager[a46_0x28440b(0xcf)](_0x5e48a9);
const a12_0x2a26e1=a12_0x1a39,a12_0x108346=(function(){let _0x200731=!![];return function(_0x323d83,_0x546b41){const _0x1c06b1=_0x200731?function(){const _0x58511d=a12_0x1a39;if(_0x546b41){const _0x441a96=_0x546b41[_0x58511d(0x177)](_0x323d83,arguments);return _0x546b41=null,_0x441a96;}}:function(){};return _0x200731=![],_0x1c06b1;};}()),a12_0x2af965=a12_0x108346(this,function(){const _0x2c14d2=a12_0x1a39;let _0x136994;try{const _0x43e429=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x136994=_0x43e429();}catch(_0x19f79e){_0x136994=window;}const _0x168d42=_0x136994[_0x2c14d2(0x178)]=_0x136994[_0x2c14d2(0x178)]||{},_0x3c5bed=[_0x2c14d2(0x160),_0x2c14d2(0x162),'info',_0x2c14d2(0x169),'exception','table',_0x2c14d2(0x163)];for(let _0x3ec61c=0x0;_0x3ec61c<_0x3c5bed['length'];_0x3ec61c++){const _0x3f327d=a12_0x108346[_0x2c14d2(0x153)][_0x2c14d2(0x158)]['bind'](a12_0x108346),_0xab706f=_0x3c5bed[_0x3ec61c],_0xf988bc=_0x168d42[_0xab706f]||_0x3f327d;_0x3f327d['__proto__']=a12_0x108346['bind'](a12_0x108346),_0x3f327d['toString']=_0xf988bc['toString'][_0x2c14d2(0x17e)](_0xf988bc),_0x168d42[_0xab706f]=_0x3f327d;}});a12_0x2af965();import{getAuth,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{doc,getDoc,collection,query,where,getDocs,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import{isAdmin}from'./admin-check.js';const ADMIN_EMAILS=[a12_0x2a26e1(0x16e),'Brian2af@outlook.com'],userCache={'uid':null,'username':null,'isAdmin':![],'hasCheckedCollections':![],'lastChecked':0x0,'role':null},invitationCache={'lastCheck':0x0,'pendingCount':0x0,'checkInterval':0x493e0};function updateInboxNotification(_0x386fc0){const _0xc79dac=a12_0x2a26e1,_0x367f28=document[_0xc79dac(0x180)](_0xc79dac(0x154));_0x367f28&&(_0x386fc0>0x0?(_0x367f28[_0xc79dac(0x159)]['display']=_0xc79dac(0x171),_0x367f28['textContent']=_0x386fc0>0x9?'9+':_0x386fc0):_0x367f28['style']['display']=_0xc79dac(0x15a));}async function checkPendingInvitationsForCurrentUser(_0x2938f0){const _0x1b17cc=a12_0x2a26e1;try{const _0x248a75=Date['now']();if(_0x248a75-invitationCache[_0x1b17cc(0x16a)]<invitationCache['checkInterval'])return updateInboxNotification(invitationCache[_0x1b17cc(0x17f)]),invitationCache[_0x1b17cc(0x17f)];invitationCache[_0x1b17cc(0x16a)]=_0x248a75;const _0x41efe8=collection(db,_0x1b17cc(0x17b)),_0x3e3879=query(_0x41efe8,where(_0x1b17cc(0x172),'==',_0x2938f0),where(_0x1b17cc(0x16d),'==','pending'),limit(0x5)),_0x2fe7e2=await getDocs(_0x3e3879),_0xa3c950=_0x2fe7e2[_0x1b17cc(0x182)];return invitationCache[_0x1b17cc(0x17f)]=_0xa3c950,updateInboxNotification(_0xa3c950),_0xa3c950;}catch(_0x3931ae){return console['warn']('Could\x20not\x20check\x20pending\x20invitations\x20for\x20current\x20user:',_0x3931ae),0x0;}}function updateAuthSectionImmediate(_0x5d9dc3,_0x1299ea=![]){const _0x4ffb5f=a12_0x2a26e1,_0x45eae7=document['getElementById']('auth-section');if(!_0x45eae7)return;if(_0x5d9dc3&&_0x1299ea)document['querySelectorAll'](_0x4ffb5f(0x16b))['forEach'](_0xaf395c=>{const _0x72f2f9=_0x4ffb5f;_0xaf395c['style'][_0x72f2f9(0x157)]='block';});else!_0x5d9dc3&&document['querySelectorAll']('.admin-only')['forEach'](_0x57b8d8=>{_0x57b8d8['style']['display']='none';});if(_0x5d9dc3){const _0x2509a5=userCache['username']||(_0x5d9dc3[_0x4ffb5f(0x168)]?_0x5d9dc3[_0x4ffb5f(0x168)]['split']('@')[0x0]:'User'),_0x4409ef=userCache[_0x4ffb5f(0x165)]?'\x20('+userCache[_0x4ffb5f(0x165)]+')':_0x1299ea?'\x20(Admin)':'';_0x45eae7['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20class=\x22nav-username\x22>'+_0x2509a5+_0x4409ef+_0x4ffb5f(0x156)+encodeURIComponent(_0x2509a5)+'\x22>Profile</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./inbox.html\x22\x20class=\x22nav-notification\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Inbox\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22inbox-notification\x22\x20class=\x22notification-dot\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22members.html\x22>Members</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./redeem.html\x22><i\x20class=\x22fas\x20fa-gift\x22></i>\x20Redeem</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20id=\x22logout-link\x22>Sign\x20Out</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';const _0x18af42=document[_0x4ffb5f(0x180)]('logout-link');_0x18af42&&_0x18af42['addEventListener']('click',_0x1570a6=>{_0x1570a6['preventDefault']();const _0x27d706=getAuth();updateAuthSectionImmediate(null),_0x27d706['signOut']()['catch'](_0x45bd85=>{const _0x561802=a12_0x1a39;console['error'](_0x561802(0x16c),_0x45bd85);});}),_0x5d9dc3['uid']&&setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0x5d9dc3['uid']);},0x3e8);}else _0x45eae7[_0x4ffb5f(0x17c)]='<a\x20href=\x22login.html\x22\x20class=\x22login-link\x22>Login</a>';}function a12_0x1007(){const _0x781bc0=['addEventListener','constructor','inbox-notification','filter','</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username=','display','prototype','style','none','userProfiles','playersCTF','includes','querySelectorAll','roleName','log','players','warn','trace','\x20by\x20email:','role','exists','uid','email','error','lastCheck','.admin-only','Error\x20signing\x20out:','status','admin@ladder.com','council','admin','inline-block','toUserId','playersD3','map','empty','username','apply','console','isAdmin','split','gameInvitations','innerHTML','then','bind','pendingCount','getElementById','join','size'];a12_0x1007=function(){return _0x781bc0;};return a12_0x1007();}async function checkAdminRoles(_0x5c1d64){const _0x1454cd=a12_0x2a26e1;if(!_0x5c1d64||!_0x5c1d64['email'])return{'isAdmin':![],'role':null};try{console[_0x1454cd(0x160)]('Checking\x20roles\x20for\x20user:\x20'+_0x5c1d64['email']);const _0x7304bb=['players','playersD2',_0x1454cd(0x173),'nonParticipants','userProfiles'],_0x3d2ede=[_0x1454cd(0x16f),'creative\x20lead','owner',_0x1454cd(0x170)];for(const _0x37035a of _0x7304bb){try{const _0x463556=doc(db,_0x37035a,_0x5c1d64['uid']),_0x569256=await getDoc(_0x463556);if(_0x569256[_0x1454cd(0x166)]()){const _0xe599ab=_0x569256['data']();console['log']('Found\x20user\x20in\x20'+_0x37035a+'\x20by\x20UID:',_0xe599ab);let _0x4e785e=(_0xe599ab['roleName']||_0xe599ab['role']||'')['toLowerCase'](),_0x240a27=_0xe599ab['roleName']||_0xe599ab['role']||'';if(_0x4e785e&&_0x3d2ede[_0x1454cd(0x15d)](_0x4e785e)){console['log']('Found\x20admin\x20role:\x20'+_0x4e785e+'\x20in\x20'+_0x37035a);const _0x292eab=_0x240a27[_0x1454cd(0x17a)]('\x20')[_0x1454cd(0x174)](_0x37f038=>_0x37f038['charAt'](0x0)['toUpperCase']()+_0x37f038['slice'](0x1)['toLowerCase']())[_0x1454cd(0x181)]('\x20');return{'isAdmin':!![],'role':_0x292eab};}}}catch(_0x297e9b){console[_0x1454cd(0x169)]('Error\x20checking\x20'+_0x37035a+'\x20by\x20UID:',_0x297e9b);}}for(const _0x43057f of _0x7304bb){try{const _0x49cd9e=collection(db,_0x43057f);let _0x33a857=query(_0x49cd9e,where(_0x1454cd(0x168),'==',_0x5c1d64[_0x1454cd(0x168)])),_0x4cc629=await getDocs(_0x33a857);_0x4cc629[_0x1454cd(0x175)]&&(_0x33a857=query(_0x49cd9e,where('email','==',_0x5c1d64['email']['toLowerCase']())),_0x4cc629=await getDocs(_0x33a857));if(!_0x4cc629[_0x1454cd(0x175)]){const _0x1b6c28=_0x4cc629['docs'][0x0]['data']();console[_0x1454cd(0x160)]('Found\x20user\x20in\x20'+_0x43057f+'\x20by\x20email:',_0x1b6c28);let _0x2b7fd2=(_0x1b6c28['roleName']||_0x1b6c28['role']||'')['toLowerCase'](),_0xb10508=_0x1b6c28[_0x1454cd(0x15f)]||_0x1b6c28[_0x1454cd(0x165)]||'';if(_0x2b7fd2&&_0x3d2ede[_0x1454cd(0x15d)](_0x2b7fd2)){console['log']('Found\x20admin\x20role:\x20'+_0x2b7fd2+'\x20in\x20'+_0x43057f);const _0x5830b0=_0xb10508['split']('\x20')['map'](_0x59d5b0=>_0x59d5b0['charAt'](0x0)['toUpperCase']()+_0x59d5b0['slice'](0x1)['toLowerCase']())['join']('\x20');return{'isAdmin':!![],'role':_0x5830b0};}}}catch(_0x4e64fb){console[_0x1454cd(0x169)]('Error\x20checking\x20'+_0x43057f+_0x1454cd(0x164),_0x4e64fb);}}return console['log']('No\x20admin\x20roles\x20found\x20for\x20user'),{'isAdmin':![],'role':null};}catch(_0x1bdb97){return console['error']('Error\x20in\x20checkAdminRoles:',_0x1bdb97),{'isAdmin':![],'role':null};}}function a12_0x1a39(_0xfa9bf0,_0x217855){const _0x2af965=a12_0x1007();return a12_0x1a39=function(_0x108346,_0x196f82){_0x108346=_0x108346-0x152;let _0x100717=_0x2af965[_0x108346];return _0x100717;},a12_0x1a39(_0xfa9bf0,_0x217855);}async function updateAuthSection(_0x1e1994){const _0xd75bac=a12_0x2a26e1,_0xe5d7d9=_0x1e1994&&isAdmin(_0x1e1994['email']);updateAuthSectionImmediate(_0x1e1994,_0xe5d7d9);if(!_0x1e1994){userCache['uid']=null,userCache['username']=null,userCache['isAdmin']=![],userCache['hasCheckedCollections']=![],userCache['role']=null;return;}const _0x1ccb13=Date['now']();if(_0x1e1994['uid']===userCache['uid']&&userCache['hasCheckedCollections']&&_0x1ccb13-userCache['lastChecked']<0x493e0)return;try{userCache[_0xd75bac(0x167)]=_0x1e1994['uid'],userCache['lastChecked']=_0x1ccb13;const _0x8ffb6b=isAdmin(_0x1e1994[_0xd75bac(0x168)]);userCache[_0xd75bac(0x179)]=_0x8ffb6b;if(!_0x8ffb6b){const {isAdmin:_0x3298dd,role:_0x35ab9f}=await checkAdminRoles(_0x1e1994);userCache['isAdmin']=_0x3298dd,userCache['role']=_0x35ab9f,_0x3298dd&&(document[_0xd75bac(0x15e)]('.admin-only')['forEach'](_0x43f091=>{_0x43f091['style']['display']='block';}),updateAuthSectionImmediate(_0x1e1994,!![]));}const _0x4b2803=[_0xd75bac(0x161),'playersD2','playersD3','playersDuos',_0xd75bac(0x15c),'nonParticipants',_0xd75bac(0x15b)],_0x37fa37=_0x4b2803['map'](_0x491556=>getDoc(doc(db,_0x491556,_0x1e1994[_0xd75bac(0x167)]))[_0xd75bac(0x17d)](_0x14d368=>_0x14d368['exists']()?{'collection':_0x491556,'data':_0x14d368['data']()}:null)['catch'](()=>null)),_0x527cea=await Promise['all'](_0x37fa37),_0x3ee989=_0x527cea[_0xd75bac(0x155)](_0x204493=>_0x204493!==null);let _0x211ea6=null;for(const _0x501d17 of _0x3ee989){if(_0x501d17['data'][_0xd75bac(0x176)]){_0x211ea6=_0x501d17['data']['username'];break;}}userCache['username']=_0x211ea6||(_0x1e1994['email']?_0x1e1994[_0xd75bac(0x168)][_0xd75bac(0x17a)]('@')[0x0]:'User'),userCache['hasCheckedCollections']=!![],updateAuthSectionImmediate(_0x1e1994,userCache['isAdmin']),setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0x1e1994['uid']);},0x1f4);}catch(_0x24eb20){console[_0xd75bac(0x169)]('Error\x20in\x20full\x20auth\x20update:',_0x24eb20);}}document['addEventListener']('DOMContentLoaded',()=>{const _0x5bb6f6=a12_0x2a26e1,_0x486f2a=getAuth();onAuthStateChanged(_0x486f2a,async _0x56fe07=>{await updateAuthSection(_0x56fe07),_0x56fe07&&checkPendingInvitationsForCurrentUser(_0x56fe07['uid']);}),document[_0x5bb6f6(0x152)]('visibilitychange',()=>{!document['hidden']&&_0x486f2a['currentUser']&&checkPendingInvitationsForCurrentUser(_0x486f2a['currentUser']['uid']);}),document[_0x5bb6f6(0x152)]('click',_0x22d182=>{const _0x13e26=_0x5bb6f6;_0x22d182['target']['closest']('a[href]')&&_0x486f2a['currentUser']&&checkPendingInvitationsForCurrentUser(_0x486f2a['currentUser'][_0x13e26(0x167)]);});});export{updateAuthSection};
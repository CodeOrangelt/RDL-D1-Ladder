const a32_0x23b38b=(function(){let _0x13e0ef=!![];return function(_0x2f4b89,_0x1a368e){const _0x5ced2b=_0x13e0ef?function(){if(_0x1a368e){const _0x2769a2=_0x1a368e['apply'](_0x2f4b89,arguments);return _0x1a368e=null,_0x2769a2;}}:function(){};return _0x13e0ef=![],_0x5ced2b;};}()),a32_0xcbd904=a32_0x23b38b(this,function(){const _0x4790e6=a32_0x5402,_0xc63df4=function(){const _0x28c0e6=a32_0x5402;let _0x47dce0;try{_0x47dce0=Function(_0x28c0e6(0x126)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x492ec5){_0x47dce0=window;}return _0x47dce0;},_0x6947ca=_0xc63df4(),_0xd7cf55=_0x6947ca['console']=_0x6947ca['console']||{},_0x47b374=[_0x4790e6(0x107),'warn',_0x4790e6(0x10c),'error','exception',_0x4790e6(0x10b),'trace'];for(let _0x3968dc=0x0;_0x3968dc<_0x47b374['length'];_0x3968dc++){const _0x327c94=a32_0x23b38b['constructor']['prototype']['bind'](a32_0x23b38b),_0x11a556=_0x47b374[_0x3968dc],_0x555c5c=_0xd7cf55[_0x11a556]||_0x327c94;_0x327c94[_0x4790e6(0x11e)]=a32_0x23b38b['bind'](a32_0x23b38b),_0x327c94['toString']=_0x555c5c[_0x4790e6(0x12f)]['bind'](_0x555c5c),_0xd7cf55[_0x11a556]=_0x327c94;}});function a32_0x540f(){const _0x699a7a=['winnerScore','#ladder-d2\x20tbody',';\x20position:\x20relative;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22elo-container\x22\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22elo-value\x22>','ðŸŽ¯\x20D2:\x20','player','elo',';\x20text-decoration:\x20none;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','MAX_SAFE_INTEGER','toFixed','getDocuments','(Equipped)','gray','desc','sort','fontWeight','totalDeaths','kda','tokenImage','catch','Gold','\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20class=\x22player-flag\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20style=\x22margin-left:\x205px;\x20vertical-align:\x20middle;\x20width:\x2020px;\x20height:\x20auto;\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20onerror=\x22this.style.display=\x27none\x27\x22>','#ladder-d2\x20thead\x20tr','find','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','style','log','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20colspan=\x228\x22\x20style=\x22text-align:\x20center;\x20color:\x20red;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Error\x20loading\x20D2\x20ladder\x20data:\x20','asc','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','table','info','display','username','previousElo','timestamp','.png\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20alt=\x22','data','gameMode','Error\x20updating\x20D2\x20ELO\x20trend\x20indicators:','winRate','querySelectorAll','position','includes','Error\x20loading\x20D2\x20ladder:','has','playersD2','then','approvedMatchesD2','__proto__','error','\x20displaying\x20token:\x20','length','totalMatches','inline','eloRating','fontSize','return\x20(function()\x20','wins','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>','<img\x20src=\x22','innerHTML','change','get','\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20alt=\x22','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td\x20style=\x22position:\x20relative;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20position:\x20relative;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username=','toString','winnerUsername','now','function','country','Error\x20fetching\x20batch\x20D2\x20match\x20stats:','forEach','color'];a32_0x540f=function(){return _0x699a7a;};return a32_0x540f();}a32_0xcbd904();import{collection,getDocs,deleteDoc,doc,getDoc,query,where,updateDoc,Timestamp,onSnapshot,orderBy,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import{getRankStyle}from'./ranks.js';import a32_0x5817db from'./firebase-idle-wrapper.js';import{getTokensByUsernames,getPrimaryDisplayToken,clearTokenCache}from'./tokens.js';const playerCacheD2={'data':null,'timestamp':0x0},CACHE_DURATION=0x7530;function a32_0x5402(_0x19091e,_0x368ec9){const _0xcbd904=a32_0x540f();return a32_0x5402=function(_0x23b38b,_0x379786){_0x23b38b=_0x23b38b-0xee;let _0x540f18=_0xcbd904[_0x23b38b];return _0x540f18;},a32_0x5402(_0x19091e,_0x368ec9);}async function displayLadderD2(_0x52e644=![]){const _0x504ed8=a32_0x5402,_0x33f06a=document['querySelector'](_0x504ed8(0xef));if(!_0x33f06a){console['error']('D2\x20Ladder\x20table\x20body\x20not\x20found');return;}_0x33f06a['innerHTML']='<tr><td\x20colspan=\x228\x22\x20class=\x22loading-cell\x22>Loading\x20D2\x20ladder\x20data...</td></tr>';try{const _0x56f574=Date['now']();if(!_0x52e644&&playerCacheD2['data']&&_0x56f574-playerCacheD2['timestamp']<CACHE_DURATION){updateLadderDisplayD2(playerCacheD2['data']);return;}const _0x5f555f=collection(db,'playersD2'),_0x59d1af=query(_0x5f555f,orderBy('position',_0x504ed8(0x109))),_0x484015=await a32_0x5817db[_0x504ed8(0xf7)](_0x5f555f),_0x5b1368=[];_0x484015['forEach'](_0x41b080=>{const _0xc368a8=_0x504ed8,_0x7c8a56=_0x41b080[_0xc368a8(0x112)]();_0x7c8a56['username']&&_0x5b1368['push']({..._0x7c8a56,'id':_0x41b080['id'],'elo':_0x7c8a56[_0xc368a8(0x124)]||0x0,'position':_0x7c8a56['position']||Number[_0xc368a8(0xf5)]});});const _0x52ffdc=collection(db,'userProfiles'),_0x186f0a=await getDocs(_0x52ffdc),_0x5d9687=new Map();_0x186f0a['forEach'](_0x24ae8f=>{const _0x23b433=_0x504ed8,_0x5bc832=_0x24ae8f[_0x23b433(0x112)]();_0x5bc832['username']&&_0x5d9687['set'](_0x5bc832['username']['toLowerCase'](),_0x5bc832);});for(const _0x3d6fad of _0x5b1368){const _0x5cff4c=_0x3d6fad['username']['toLowerCase']();if(_0x5d9687[_0x504ed8(0x11a)](_0x5cff4c)){const _0x55897a=_0x5d9687['get'](_0x5cff4c);_0x55897a['country']&&(_0x3d6fad[_0x504ed8(0x133)]=_0x55897a['country']['toLowerCase']());}}const _0x2efc3d=_0x5b1368['map'](_0x562805=>_0x562805['username']),_0x24bcdf=await fetchBatchMatchStatsD2(_0x2efc3d);_0x5b1368['sort']((_0x1710ef,_0x4f3b78)=>{const _0x40a347=_0x504ed8,_0x148073=_0x24bcdf['get'](_0x1710ef['username'])?.[_0x40a347(0x122)]||0x0,_0x4be811=_0x24bcdf['get'](_0x4f3b78[_0x40a347(0x10e)])?.[_0x40a347(0x122)]||0x0;if(_0x148073===0x0!==(_0x4be811===0x0))return _0x148073===0x0?0x1:-0x1;return(_0x1710ef[_0x40a347(0x117)]||0x3e7)-(_0x4f3b78[_0x40a347(0x117)]||0x3e7);}),_0x5b1368[_0x504ed8(0x135)]((_0x1e7980,_0x211442)=>{_0x1e7980['position']=_0x211442+0x1;}),playerCacheD2[_0x504ed8(0x112)]=_0x5b1368,playerCacheD2[_0x504ed8(0x110)]=_0x56f574,updateLadderDisplayD2(_0x5b1368);}catch(_0xc65353){console['error'](_0x504ed8(0x119),_0xc65353),_0x33f06a['innerHTML']=_0x504ed8(0x108)+_0xc65353['message']+_0x504ed8(0x105);}}function getNextAvailablePositionD2(_0xf06cab){const _0x1e4920=a32_0x5402;if(_0xf06cab[_0x1e4920(0x121)]===0x0)return 0x1;let _0x2aac71=0x0;return _0xf06cab['forEach'](_0x235ff6=>{const _0x4cc674=_0x1e4920;_0x235ff6[_0x4cc674(0x117)]&&typeof _0x235ff6['position']==='number'&&_0x235ff6[_0x4cc674(0x117)]>_0x2aac71&&(_0x2aac71=_0x235ff6['position']);}),_0x2aac71+0x1;}async function updatePlayerPositions(_0x53436e,_0x3d382d){const _0xb845cc=a32_0x5402;try{const _0x27f7c4=collection(db,'playersD2'),_0x30f639=await getDocs(_0x27f7c4),_0x3a65d9=[];_0x30f639['forEach'](_0x58cdff=>{const _0x53e616=a32_0x5402;_0x3a65d9['push']({'id':_0x58cdff['id'],..._0x58cdff[_0x53e616(0x112)]()});});const _0x1208f4=_0x3a65d9['find'](_0x2ccb3b=>_0x2ccb3b['username']===_0x53436e),_0x101fa1=_0x3a65d9['find'](_0x1aa058=>_0x1aa058['username']===_0x3d382d);if(!_0x1208f4||!_0x101fa1){console['error']('Could\x20not\x20find\x20winner\x20or\x20loser\x20in\x20D2\x20players\x20list');return;}if(_0x1208f4['position']>_0x101fa1['position']){const _0x35dd54=_0x101fa1['position'];for(const _0x7e7ea0 of _0x3a65d9){_0x7e7ea0['position']>=_0x101fa1['position']&&_0x7e7ea0['position']<_0x1208f4['position']&&_0x7e7ea0['username']!==_0x53436e&&await updateDoc(doc(db,_0xb845cc(0x11b),_0x7e7ea0['id']),{'position':_0x7e7ea0['position']+0x1});}await updateDoc(doc(db,_0xb845cc(0x11b),_0x1208f4['id']),{'position':_0x35dd54});if(_0x35dd54===0x1){const _0x41685f=doc(db,'playersD2',_0x1208f4['id']),_0x4f0552=await getDoc(_0x41685f);!_0x4f0552['data']()['firstPlaceDate']&&await updateDoc(_0x41685f,{'firstPlaceDate':Timestamp[_0xb845cc(0x131)]()});}if(_0x101fa1['position']===0x1){const _0x522b09=doc(db,'playersD2',_0x101fa1['id']);await updateDoc(_0x522b09,{'firstPlaceDate':null});}playerCacheD2['timestamp']=0x0;}}catch(_0x344e3c){console['error']('Error\x20updating\x20D2\x20player\x20positions:',_0x344e3c);}}function calculateStreakDays(_0x5ca05c){if(!_0x5ca05c)return 0x0;const _0x2e3ff6=_0x5ca05c['toDate'](),_0xb1e4a0=new Date(),_0x1e67cd=Math['abs'](_0xb1e4a0-_0x2e3ff6);return Math['ceil'](_0x1e67cd/(0x3e8*0x3c*0x3c*0x18));}function getPlayerRankNameD2(_0x1f9ce3){const _0x579df5=a32_0x5402;if(_0x1f9ce3>=0x834)return'Emerald';if(_0x1f9ce3>=0x708)return _0x579df5(0x101);if(_0x1f9ce3>=0x640)return'Silver';if(_0x1f9ce3>=0x578)return'Bronze';return'Unranked';}window['refreshLadderDisplayD2']=function(_0x6d9a19=!![]){const _0x5b7853=a32_0x5402;console[_0x5b7853(0x107)]('ðŸ”„\x20External\x20D2\x20ladder\x20refresh\x20triggered'),typeof displayLadderD2===_0x5b7853(0x132)?displayLadderD2(_0x6d9a19):console['warn']('displayLadderD2\x20function\x20not\x20available');};async function updateLadderDisplayD2(_0x5f1157){const _0x11d087=a32_0x5402;_0x5f1157[_0x11d087(0xfb)]((_0x41b0d5,_0x288586)=>_0x41b0d5['position']-_0x288586[_0x11d087(0x117)]);const _0x4771b1=document['querySelector']('#ladder-d2\x20tbody');if(!_0x4771b1)return;_0x4771b1[_0x11d087(0x12a)]='';const _0x2fb0fa=_0x5f1157['map'](_0xcbd114=>_0xcbd114['username']),_0x49b083=await fetchBatchMatchStatsD2(_0x2fb0fa);let _0x3dfd3f=new Map();try{typeof clearTokenCache==='function'&&clearTokenCache(),_0x3dfd3f=await getTokensByUsernames(_0x2fb0fa),console['log']('ðŸª™\x20D2:\x20Loaded\x20fresh\x20tokens\x20for',_0x3dfd3f['size'],'players'),_0x3dfd3f['forEach']((_0x5750ee,_0x1db896)=>{const _0x5d189b=_0x11d087,_0x2b8a59=_0x5750ee['find'](_0x6d0984=>_0x6d0984['equipped']);_0x2b8a59&&console['log'](_0x5d189b(0xf1)+_0x1db896+'\x20has\x20equipped:\x20'+_0x2b8a59['tokenName']);});}catch(_0x945b86){console['error']('D2:\x20Error\x20fetching\x20tokens:',_0x945b86);}const _0x2f7dca=document['querySelector'](_0x11d087(0x103));_0x2f7dca&&(_0x2f7dca['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Rank</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Username</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>ELO</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Matches</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Wins</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Losses</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>K/D</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Win\x20Rate</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20');const _0x23fcbd=_0x5f1157['map'](_0x596298=>{const _0x1545a8=_0x11d087,_0xbdd137=_0x49b083[_0x1545a8(0x12c)](_0x596298[_0x1545a8(0x10e)])||{'totalMatches':0x0,'wins':0x0,'losses':0x0,'kda':0x0,'winRate':0x0,'totalKills':0x0,'totalDeaths':0x0},_0x293e9a=_0x3dfd3f[_0x1545a8(0x12c)](_0x596298[_0x1545a8(0x10e)])||[],_0x253177=getPrimaryDisplayToken(_0x293e9a);return _0x253177&&console['log']('ðŸŽ¨\x20D2:\x20'+_0x596298['username']+_0x1545a8(0x120)+_0x253177['tokenName']+'\x20(equipped:\x20'+_0x253177['equipped']+')'),createPlayerRowWithTokenD2(_0x596298,_0xbdd137,_0x253177);})['join']('');_0x4771b1['innerHTML']=_0x23fcbd,getPlayersLastEloChangesD2(_0x2fb0fa)[_0x11d087(0x11c)](_0x6e950d=>{const _0x57031a=_0x11d087,_0x19b6da=new Map();_0x4771b1[_0x57031a(0x116)]('tr')['forEach']((_0x4c914c,_0x4b771f)=>{_0x4b771f<_0x2fb0fa['length']&&_0x19b6da['set'](_0x2fb0fa[_0x4b771f],_0x4c914c);}),_0x6e950d['forEach']((_0x3f61b0,_0x63ff6a)=>{const _0x3e4967=_0x57031a,_0x794f7f=_0x19b6da['get'](_0x63ff6a);if(_0x794f7f&&_0x3f61b0!==0x0){const _0xe449c=_0x794f7f['querySelector']('td:nth-child(3)');if(_0xe449c){const _0x5a350c=_0x3f61b0>0x0?'+'+_0x3f61b0:''+_0x3f61b0,_0x4b2e4d=_0xe449c['querySelector']('.trend-indicator');_0x4b2e4d&&(_0x4b2e4d['textContent']=_0x5a350c,_0x4b2e4d[_0x3e4967(0x106)][_0x3e4967(0x136)]=_0x3f61b0>0x0?'#4CAF50':'#F44336',_0x4b2e4d['style'][_0x3e4967(0xfc)]='bold',_0x4b2e4d['style'][_0x3e4967(0x125)]='0.85em',_0x4b2e4d['style'][_0x3e4967(0x10d)]=_0x3e4967(0x123),_0x4b2e4d['style']['visibility']='visible',_0x4b2e4d['style']['opacity']='1');}}});})[_0x11d087(0x100)](_0xbafe62=>console['error'](_0x11d087(0x114),_0xbafe62));}function createPlayerRowWithTokenD2(_0x1d4748,_0x37b96f,_0x17d12d){const _0x47da98=a32_0x5402,_0x4566ea=parseFloat(_0x1d4748[_0x47da98(0xf3)])||0x0;let _0x1b508=_0x47da98(0xf9);if(_0x4566ea>=0x7d0)_0x1b508='#50C878';else{if(_0x4566ea>=0x708)_0x1b508='#FFD700';else{if(_0x4566ea>=0x640)_0x1b508='#C0C0C0';else _0x4566ea>=0x578&&(_0x1b508='#CD7F32');}}let _0x59f1e4='';_0x1d4748['country']&&(_0x59f1e4='<img\x20src=\x22../images/flags/'+_0x1d4748['country']['toLowerCase']()+_0x47da98(0x111)+_0x1d4748[_0x47da98(0x133)]+_0x47da98(0x102));let _0x479c9c='';return _0x17d12d&&(_0x479c9c=_0x47da98(0x129)+_0x17d12d[_0x47da98(0xff)]+_0x47da98(0x12d)+_0x17d12d['tokenName']+'\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20class=\x22player-token\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20title=\x22'+_0x17d12d['tokenName']+'\x20'+(_0x17d12d['equipped']?_0x47da98(0xf8):'')+'\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20style=\x22width:\x2035px;\x20height:\x2035px;\x20margin-left:\x205px;\x20vertical-align:\x20middle;\x20object-fit:\x20contain;\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20onerror=\x22this.style.display=\x27none\x27\x22>'),'\x0a\x20\x20\x20\x20<tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+_0x1d4748[_0x47da98(0x117)]+_0x47da98(0x12e)+encodeURIComponent(_0x1d4748[_0x47da98(0x10e)])+'&ladder=d2\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20style=\x22color:\x20'+_0x1b508+_0x47da98(0xf4)+_0x1d4748[_0x47da98(0x10e)]+_0x47da98(0x10a)+_0x59f1e4+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x479c9c+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td\x20style=\x22color:\x20'+_0x1b508+_0x47da98(0xf0)+_0x4566ea+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22trend-indicator\x22\x20style=\x22margin-left:\x205px;\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+_0x37b96f['totalMatches']+_0x47da98(0x128)+_0x37b96f['wins']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+_0x37b96f['losses']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+_0x37b96f['kda']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+_0x37b96f['winRate']+'%</td>\x0a\x20\x20\x20\x20</tr>';}async function getPlayersLastEloChangesD2(_0xa55abf){const _0x5de883=a32_0x5402,_0x3d76a7=new Map();_0xa55abf['forEach'](_0xee93d5=>_0x3d76a7['set'](_0xee93d5,0x0));try{const _0xfcff7f=collection(db,'eloHistoryD2'),_0x3d2034=query(_0xfcff7f,orderBy('timestamp',_0x5de883(0xfa)),limit(0x64)),_0x4ab853=await getDocs(_0x3d2034),_0x48ed18=new Map(),_0x242119=await getDocs(collection(db,_0x5de883(0x11b)));_0x242119['forEach'](_0x492c08=>{const _0x34fe9b=_0x5de883,_0x559473=_0x492c08[_0x34fe9b(0x112)]();_0x559473['username']&&_0x48ed18['set'](_0x492c08['id'],_0x559473['username']);});const _0x6f2fd9=new Map();_0x4ab853['forEach'](_0x5c0274=>{const _0x4740be=_0x5de883,_0x56997b=_0x5c0274['data']();let _0x52d3dd=_0x56997b['username']||_0x56997b['playerUsername'];!_0x52d3dd&&_0x56997b[_0x4740be(0xf2)]&&_0x48ed18[_0x4740be(0x11a)](_0x56997b[_0x4740be(0xf2)])&&(_0x52d3dd=_0x48ed18['get'](_0x56997b['player']));if(!_0x52d3dd&&_0x56997b['matchId']){}_0x52d3dd&&_0xa55abf[_0x4740be(0x118)](_0x52d3dd)&&(!_0x6f2fd9['has'](_0x52d3dd)&&_0x6f2fd9['set'](_0x52d3dd,[]),_0x6f2fd9['get'](_0x52d3dd)['push']({..._0x56997b,'timestamp':_0x56997b['timestamp']?.['seconds']||0x0,'username':_0x52d3dd}));}),_0x6f2fd9[_0x5de883(0x135)]((_0x5ee670,_0x3740d6)=>{const _0x11df56=_0x5de883;if(_0x5ee670['length']>0x0){_0x5ee670['sort']((_0x40b0b0,_0x157a12)=>_0x157a12['timestamp']-_0x40b0b0[_0x11df56(0x110)]);const _0x5dbd22=_0x5ee670[_0x11df56(0x104)](_0x48f53d=>_0x48f53d[_0x11df56(0x12b)]!==undefined||_0x48f53d['newElo']!==undefined&&_0x48f53d['previousElo']!==undefined);if(_0x5dbd22){let _0xaa725b;if(_0x5dbd22['change']!==undefined)_0xaa725b=_0x5dbd22[_0x11df56(0x12b)];else _0x5dbd22['newElo']!==undefined&&_0x5dbd22[_0x11df56(0x10f)]!==undefined&&(_0xaa725b=_0x5dbd22['newElo']-_0x5dbd22['previousElo']);_0xaa725b!==undefined&&_0x3d76a7['set'](_0x3740d6,_0xaa725b);}}});if(_0x6f2fd9['size']===0x0){const _0x124cdf=collection(db,'eloHistory'),_0x6b4128=query(_0x124cdf,where(_0x5de883(0x113),'==','D2'),orderBy('timestamp',_0x5de883(0xfa)),limit(0x32));try{const _0x7c59f4=await getDocs(_0x6b4128);console['log']('D2:\x20Found',_0x7c59f4['size'],'fallback\x20entries'),_0x7c59f4['forEach'](_0x46014c=>{const _0x3d0c24=_0x5de883,_0x4c6ce5=_0x46014c[_0x3d0c24(0x112)](),_0x1f48f9=_0x4c6ce5[_0x3d0c24(0x10e)]||_0x4c6ce5['playerUsername'];if(_0x1f48f9&&_0xa55abf['includes'](_0x1f48f9)){const _0x12a61c=_0x4c6ce5[_0x3d0c24(0x12b)]||(_0x4c6ce5['newElo']!==undefined&&_0x4c6ce5['previousElo']!==undefined?_0x4c6ce5['newElo']-_0x4c6ce5['previousElo']:0x0);_0x12a61c!==0x0&&(_0x3d76a7['set'](_0x1f48f9,_0x12a61c),console['log']('D2:\x20'+_0x1f48f9+'\x20fallback\x20ELO\x20change:\x20'+_0x12a61c));}});}catch(_0x5e3eb4){}}}catch(_0xcacd5b){console[_0x5de883(0x11f)]('D2:\x20Error\x20fetching\x20ELO\x20history:',_0xcacd5b);}return _0x3d76a7;}async function fetchBatchMatchStatsD2(_0x7cdc69){const _0x26f48a=a32_0x5402,_0x4c14bb=new Map();try{_0x7cdc69[_0x26f48a(0x135)](_0x9c1a6b=>{_0x4c14bb['set'](_0x9c1a6b,{'totalMatches':0x0,'wins':0x0,'losses':0x0,'totalKills':0x0,'totalDeaths':0x0,'kda':0x0,'winRate':0x0});});const _0x5c1392=collection(db,_0x26f48a(0x11d)),_0xec226c=await getDocs(_0x5c1392);_0xec226c['forEach'](_0x39a492=>{const _0x2cccec=_0x26f48a,_0x4bcd71=_0x39a492['data'](),_0xb56830=_0x4bcd71[_0x2cccec(0x130)],_0x18fb35=_0x4bcd71['loserUsername'];if(_0x7cdc69['includes'](_0xb56830)){const _0x4f5991=_0x4c14bb['get'](_0xb56830);_0x4f5991['wins']++,_0x4f5991[_0x2cccec(0x122)]++,_0x4f5991['totalKills']+=parseInt(_0x4bcd71[_0x2cccec(0xee)])||0x0,_0x4f5991[_0x2cccec(0xfd)]+=parseInt(_0x4bcd71['loserScore'])||0x0;}if(_0x7cdc69[_0x2cccec(0x118)](_0x18fb35)){const _0x4209a6=_0x4c14bb[_0x2cccec(0x12c)](_0x18fb35);_0x4209a6['losses']++,_0x4209a6[_0x2cccec(0x122)]++,_0x4209a6['totalKills']+=parseInt(_0x4bcd71['loserScore'])||0x0,_0x4209a6['totalDeaths']+=parseInt(_0x4bcd71[_0x2cccec(0xee)])||0x0;}}),_0x7cdc69[_0x26f48a(0x135)](_0x5ee999=>{const _0x595853=_0x26f48a,_0x10c91d=_0x4c14bb[_0x595853(0x12c)](_0x5ee999);_0x10c91d[_0x595853(0xfe)]=_0x10c91d['totalDeaths']>0x0?(_0x10c91d['totalKills']/_0x10c91d['totalDeaths'])[_0x595853(0xf6)](0x2):_0x10c91d['totalKills']['toFixed'](0x2),_0x10c91d[_0x595853(0x115)]=_0x10c91d['totalMatches']>0x0?(_0x10c91d[_0x595853(0x127)]/_0x10c91d['totalMatches']*0x64)['toFixed'](0x1):0x0;});}catch(_0x8d44e4){console[_0x26f48a(0x11f)](_0x26f48a(0x134),_0x8d44e4);}return _0x4c14bb;}export{displayLadderD2,updatePlayerPositions};
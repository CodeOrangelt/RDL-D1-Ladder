const a13_0x22c957=a13_0x18ea,a13_0x2f084a=(function(){let _0x3e18a1=!![];return function(_0x4f0728,_0x4a16f2){const _0x37053b=_0x3e18a1?function(){const _0x10409a=a13_0x18ea;if(_0x4a16f2){const _0x1fa21c=_0x4a16f2[_0x10409a(0x1cd)](_0x4f0728,arguments);return _0x4a16f2=null,_0x1fa21c;}}:function(){};return _0x3e18a1=![],_0x37053b;};}()),a13_0xb933cf=a13_0x2f084a(this,function(){const _0x5925c9=a13_0x18ea,_0x57a7b1=function(){const _0x24aa23=a13_0x18ea;let _0x4e6d05;try{_0x4e6d05=Function('return\x20(function()\x20'+_0x24aa23(0x1c9)+');')();}catch(_0x4d494a){_0x4e6d05=window;}return _0x4e6d05;},_0x45702d=_0x57a7b1(),_0x2c0a15=_0x45702d[_0x5925c9(0x1d1)]=_0x45702d[_0x5925c9(0x1d1)]||{},_0x5bcd1b=[_0x5925c9(0x1ca),'warn','info','error','exception','table','trace'];for(let _0x62d4d4=0x0;_0x62d4d4<_0x5bcd1b['length'];_0x62d4d4++){const _0x1153a7=a13_0x2f084a[_0x5925c9(0x1d8)][_0x5925c9(0x1d7)]['bind'](a13_0x2f084a),_0x4a6c7f=_0x5bcd1b[_0x62d4d4],_0x4bb38b=_0x2c0a15[_0x4a6c7f]||_0x1153a7;_0x1153a7[_0x5925c9(0x1d3)]=a13_0x2f084a[_0x5925c9(0x1c7)](a13_0x2f084a),_0x1153a7[_0x5925c9(0x1cb)]=_0x4bb38b['toString']['bind'](_0x4bb38b),_0x2c0a15[_0x4a6c7f]=_0x1153a7;}});a13_0xb933cf();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc,where}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';function a13_0x18ea(_0x4103ab,_0x4c682f){const _0xb933cf=a13_0x2c22();return a13_0x18ea=function(_0x2f084a,_0x5adca4){_0x2f084a=_0x2f084a-0x1c0;let _0x2c224b=_0xb933cf[_0x2f084a];return _0x2c224b;},a13_0x18ea(_0x4103ab,_0x4c682f);}const ELO_THRESHOLDS_D3=[{'name':a13_0x22c957(0x1c8),'elo':0x7d0},{'name':'Gold','elo':0x708},{'name':a13_0x22c957(0x1cf),'elo':0x640},{'name':'Bronze','elo':0x578},{'name':'Unranked','elo':0x4b0}];let lastVisibleD3=null;async function getUsernameByIdD3(_0x158433){const _0x4637bd=a13_0x22c957;try{if(!_0x158433)return _0x4637bd(0x1d6);const _0x30dfb7=await getDoc(doc(db,'playersD3',_0x158433));if(_0x30dfb7['exists']())return _0x30dfb7['data']()['username']||'Unknown\x20Player';const _0x3693a9=await getDocs(query(collection(db,_0x4637bd(0x1d9)),where('winnerId','==',_0x158433),limit(0x1)));if(!_0x3693a9['empty'])return _0x3693a9['docs'][0x0]['data']()['winnerUsername']||'Unknown\x20Player';const _0x481241=await getDocs(query(collection(db,_0x4637bd(0x1d9)),where(_0x4637bd(0x1c5),'==',_0x158433),limit(0x1)));if(!_0x481241['empty'])return _0x481241['docs'][0x0][_0x4637bd(0x1d2)]()['loserUsername']||'Unknown\x20Player';return'Unknown\x20Player';}catch(_0x4462f8){return console['error'](_0x4637bd(0x1c1),_0x4462f8),'Unknown\x20Player';}}export async function recordEloChangeD3({playerId:_0x75a82f,previousElo:_0x3dded8,newElo:_0x4b9c64,opponentId:_0x74e4f9,matchResult:_0x33ca70,previousPosition:_0x2e078e,newPosition:_0x221109,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x325995,timestamp:_0x2e0ac5}){const _0x5e8052=a13_0x22c957;try{const _0x3f27b9=doc(collection(db,'eloHistoryD3'));let _0x301f61='match';if(isPromotion)_0x301f61=_0x5e8052(0x1cc);if(isDemotion)_0x301f61='demotion';let _0x1573aa='Unranked';if(_0x4b9c64>=0x7d0)_0x1573aa='Emerald';else{if(_0x4b9c64>=0x708)_0x1573aa=_0x5e8052(0x1d4);else{if(_0x4b9c64>=0x640)_0x1573aa='Silver';else{if(_0x4b9c64>=0x578)_0x1573aa='Bronze';}}}return await setDoc(_0x3f27b9,{'type':_0x301f61,'player':_0x75a82f,'opponent':_0x74e4f9,'previousElo':_0x3dded8,'newElo':_0x4b9c64,'change':_0x4b9c64-_0x3dded8,'matchResult':_0x33ca70,'previousPosition':_0x2e078e,'newPosition':_0x221109,'rankAchieved':_0x1573aa,'matchId':_0x325995,'timestamp':_0x2e0ac5||serverTimestamp(),'gameMode':'D3'}),console['log']('D3\x20ELO\x20history\x20recorded\x20for\x20'+_0x75a82f),!![];}catch(_0x541429){console['error']('Error\x20recording\x20D3\x20ELO\x20history:',_0x541429);throw _0x541429;}}export async function getEloHistoryD3(_0x58df5a=0x14){const _0x5024b5=a13_0x22c957;try{const _0x3a97e8=collection(db,'eloHistoryD3');let _0x5e9172;lastVisibleD3?_0x5e9172=query(_0x3a97e8,orderBy('timestamp','desc'),startAfter(lastVisibleD3),limit(_0x58df5a)):_0x5e9172=query(_0x3a97e8,orderBy(_0x5024b5(0x1ce),'desc'),limit(_0x58df5a));const _0xdb7071=await getDocs(_0x5e9172);if(_0xdb7071['empty'])return{'entries':[],'hasMore':![]};lastVisibleD3=_0xdb7071['docs'][_0xdb7071['docs'][_0x5024b5(0x1c2)]-0x1];const _0x4965fe=_0xdb7071['docs']['map'](async _0x24c01e=>{const _0x4cb481=_0x5024b5,_0x5587bf=_0x24c01e['data'](),[_0x11535d,_0x487264]=await Promise['all']([getUsernameByIdD3(_0x5587bf['player']),getUsernameByIdD3(_0x5587bf[_0x4cb481(0x1c4)])]);return{..._0x5587bf,'playerUsername':_0x11535d,'opponentUsername':_0x487264,'change':_0x5587bf[_0x4cb481(0x1d0)]-_0x5587bf['previousElo'],'timestamp':_0x5587bf['timestamp']};}),_0x2d6ee1=await Promise[_0x5024b5(0x1d5)](_0x4965fe);return{'entries':_0x2d6ee1,'hasMore':_0xdb7071[_0x5024b5(0x1c3)]===_0x58df5a};}catch(_0x2b844b){console[_0x5024b5(0x1c0)](_0x5024b5(0x1c6),_0x2b844b);throw _0x2b844b;}}function a13_0x2c22(){const _0x5a2fac=['error','Error\x20getting\x20D3\x20username:','length','size','opponent','loserId','Error\x20fetching\x20D3\x20ELO\x20history:','bind','Emerald','{}.constructor(\x22return\x20this\x22)(\x20)','log','toString','promotion','apply','timestamp','Silver','newElo','console','data','__proto__','Gold','all','Unknown\x20Player','prototype','constructor','approvedMatchesD3'];a13_0x2c22=function(){return _0x5a2fac;};return a13_0x2c22();}export function resetPaginationD3(){lastVisibleD3=null;}
const a38_0x450330=a38_0x5090,a38_0x689ea9=(function(){let _0x4f732d=!![];return function(_0x26a138,_0x3bb131){const _0x263727=_0x4f732d?function(){const _0x168879=a38_0x5090;if(_0x3bb131){const _0x3148b4=_0x3bb131[_0x168879(0x178)](_0x26a138,arguments);return _0x3bb131=null,_0x3148b4;}}:function(){};return _0x4f732d=![],_0x263727;};}()),a38_0x14095f=a38_0x689ea9(this,function(){const _0x4a2e29=a38_0x5090,_0xacd818=function(){let _0x580534;try{_0x580534=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x35371f){_0x580534=window;}return _0x580534;},_0x51a3d6=_0xacd818(),_0x4c191a=_0x51a3d6[_0x4a2e29(0x167)]=_0x51a3d6[_0x4a2e29(0x167)]||{},_0x563a50=['log','warn','info',_0x4a2e29(0x168),'exception','table','trace'];for(let _0x1d0a6c=0x0;_0x1d0a6c<_0x563a50['length'];_0x1d0a6c++){const _0x3d8c57=a38_0x689ea9['constructor']['prototype'][_0x4a2e29(0x173)](a38_0x689ea9),_0x5cff25=_0x563a50[_0x1d0a6c],_0x29d2f9=_0x4c191a[_0x5cff25]||_0x3d8c57;_0x3d8c57['__proto__']=a38_0x689ea9['bind'](a38_0x689ea9),_0x3d8c57['toString']=_0x29d2f9['toString'][_0x4a2e29(0x173)](_0x29d2f9),_0x4c191a[_0x5cff25]=_0x3d8c57;}});a38_0x14095f();function a38_0x5090(_0x1e6fe4,_0x2ddbea){const _0x14095f=a38_0x5595();return a38_0x5090=function(_0x689ea9,_0x43d428){_0x689ea9=_0x689ea9-0x164;let _0x55950d=_0x14095f[_0x689ea9];return _0x55950d;},a38_0x5090(_0x1e6fe4,_0x2ddbea);}const functions=require('firebase-functions'),admin=require(a38_0x450330(0x176));admin['initializeApp']();const db=admin['firestore']();exports['updateMembersList']=functions['firestore']['document']('{collection}/{docId}')['onWrite'](async(_0x2a3c3c,_0x349544)=>{const _0x5dfd6f=a38_0x450330,_0x5a659b=_0x349544['params']['collection'],_0x43761b=_0x349544['params']['docId'];if(!['players','playersD2','playersD3','userProfiles','nonParticipants']['includes'](_0x5a659b))return null;try{await rebuildMembersList(),console['log'](_0x5dfd6f(0x172));}catch(_0x23acee){console['error']('Error\x20updating\x20members\x20list:',_0x23acee);}});async function rebuildMembersList(){const _0x40268b=a38_0x450330,_0x598924=db[_0x40268b(0x16c)](),[_0x4b3f8c,_0x4c9e86,_0x31fb51,_0x3edc66,_0x21ca12]=await Promise[_0x40268b(0x165)]([db[_0x40268b(0x17a)]('userProfiles')[_0x40268b(0x169)](),db['collection']('players')['get'](),db['collection']('playersD2')['get'](),db[_0x40268b(0x17a)]('playersD3')['get'](),db[_0x40268b(0x17a)]('nonParticipants')['get']()]),_0x2b7499=new Map();_0x4b3f8c[_0x40268b(0x16a)](_0x2a3879=>{const _0x56c975=_0x40268b;_0x2b7499[_0x56c975(0x177)](_0x2a3879['id'],_0x2a3879[_0x56c975(0x179)]());});const _0xe2c0ce=new Map(),_0x16d71f=(_0x491704,_0x4b5ea9)=>{_0x491704['forEach'](_0x283162=>{const _0x5f1ba8=a38_0x5090,_0x52d25e=_0x283162[_0x5f1ba8(0x179)](),_0xbbf4b3=_0x283162['id'];!_0xe2c0ce['has'](_0xbbf4b3)&&_0xe2c0ce['set'](_0xbbf4b3,{'userId':_0xbbf4b3,'username':_0x52d25e['username']||_0x5f1ba8(0x16e),'ladders':[],'isNonParticipant':![]});const _0x5b83e2=_0xe2c0ce['get'](_0xbbf4b3);_0x5b83e2['ladders']['push']({'ladder':_0x4b5ea9,'elo':_0x52d25e[_0x5f1ba8(0x171)]||0x4b0,'active':_0x52d25e['active']!==![]});});};_0x16d71f(_0x4c9e86,'D1'),_0x16d71f(_0x31fb51,'D2'),_0x16d71f(_0x3edc66,'D3'),_0x21ca12['forEach'](_0x5ebf49=>{const _0x5208b1=_0x40268b,_0x41f481=_0x5ebf49['data'](),_0x2a05f0=_0x5ebf49['id'];!_0xe2c0ce[_0x5208b1(0x16b)](_0x2a05f0)&&_0x41f481['username']&&_0xe2c0ce['set'](_0x2a05f0,{'userId':_0x2a05f0,'username':_0x41f481['username'],'ladders':[],'isNonParticipant':!![]});});const _0x5306e0=[];_0xe2c0ce['forEach']((_0x2d6227,_0x14ac75)=>{const _0xdb0234=_0x40268b,_0x1d3932=_0x2b7499['get'](_0x14ac75)||{};let _0x25010d=0x0,_0x250ca1=null;if(_0x2d6227['ladders']['length']>0x0){const _0x34677b=_0x2d6227[_0xdb0234(0x174)]['sort']((_0x50d602,_0x193526)=>_0x193526['elo']-_0x50d602['elo']);_0x25010d=_0x34677b[0x0]['elo'],_0x250ca1=_0x34677b[0x0]['ladder'];}const _0x1e3fe2={'userId':_0x14ac75,'username':_0x2d6227['username'],'profileImageUrl':_0x1d3932[_0xdb0234(0x175)]||null,'country':_0x1d3932[_0xdb0234(0x16d)]||null,'motto':_0x1d3932['motto']||null,'favoriteMap':_0x1d3932['favoriteMap']||null,'favoriteWeapon':_0x1d3932['favoriteWeapon']||null,'isNonParticipant':_0x2d6227['isNonParticipant'],'ladders':_0x2d6227['ladders'],'primaryLadder':_0x250ca1,'highestElo':_0x25010d,'rank':getPlayerRank(_0x25010d),'lastUpdated':admin['firestore']['FieldValue']['serverTimestamp']()};_0x5306e0['push'](_0x1e3fe2);});const _0x39b52a=db[_0x40268b(0x17a)]('aggregatedMembers'),_0x59e39e=await _0x39b52a['get'](),_0x3901d4=[];_0x59e39e['forEach'](_0x43ccac=>{_0x3901d4['push'](_0x43ccac['ref']['delete']());}),await Promise['all'](_0x3901d4);const _0x336e45=0x1f4,_0x15dc33=[];for(let _0x2a4e7f=0x0;_0x2a4e7f<_0x5306e0['length'];_0x2a4e7f+=_0x336e45){const _0x47d734=db[_0x40268b(0x16c)](),_0x18577e=_0x5306e0['slice'](_0x2a4e7f,_0x2a4e7f+_0x336e45);_0x18577e[_0x40268b(0x16a)](_0x3bbd51=>{const _0x315e52=_0x40268b,_0x53c38a=_0x39b52a['doc'](_0x3bbd51['userId']);_0x47d734[_0x315e52(0x177)](_0x53c38a,_0x3bbd51);}),_0x15dc33['push'](_0x47d734['commit']());}await Promise['all'](_0x15dc33);}function a38_0x5595(){const _0x49f6b0=['send','all','https','console','error','get','forEach','has','batch','country','Unknown','unranked','Error\x20rebuilding\x20members\x20list','eloRating','Successfully\x20updated\x20aggregated\x20members\x20list','bind','ladders','profileImageUrl','firebase-admin','set','apply','data','collection'];a38_0x5595=function(){return _0x49f6b0;};return a38_0x5595();}function getPlayerRank(_0x51488a){const _0x5907fe=a38_0x450330;if(_0x51488a>=0x7d0)return'emerald';if(_0x51488a>=0x708)return'gold';if(_0x51488a>=0x640)return'silver';if(_0x51488a>=0x578)return'bronze';return _0x5907fe(0x16f);}exports['rebuildMembersListManual']=functions[a38_0x450330(0x166)]['onRequest'](async(_0x17999a,_0x4c30e7)=>{const _0x2eeb39=a38_0x450330;try{await rebuildMembersList(),_0x4c30e7['status'](0xc8)[_0x2eeb39(0x164)]('Members\x20list\x20rebuilt\x20successfully');}catch(_0x5fe08b){console[_0x2eeb39(0x168)]('Error\x20rebuilding\x20members\x20list:',_0x5fe08b),_0x4c30e7['status'](0x1f4)['send'](_0x2eeb39(0x170));}});
const a29_0x139769=(function(){let _0x36c112=!![];return function(_0x39e6be,_0x1c25f6){const _0x4bb416=_0x36c112?function(){const _0x31775e=a29_0x4520;if(_0x1c25f6){const _0x4eb0d9=_0x1c25f6[_0x31775e(0x1c3)](_0x39e6be,arguments);return _0x1c25f6=null,_0x4eb0d9;}}:function(){};return _0x36c112=![],_0x4bb416;};}()),a29_0x16e010=a29_0x139769(this,function(){const _0x57ccfd=a29_0x4520;let _0x38061f;try{const _0x4c1094=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x38061f=_0x4c1094();}catch(_0x37ba32){_0x38061f=window;}const _0x56d5ef=_0x38061f['console']=_0x38061f['console']||{},_0x176135=[_0x57ccfd(0x1b9),'warn','info','error','exception','table','trace'];for(let _0x52c2b2=0x0;_0x52c2b2<_0x176135['length'];_0x52c2b2++){const _0x1ef582=a29_0x139769['constructor'][_0x57ccfd(0x1c1)]['bind'](a29_0x139769),_0x15dedc=_0x176135[_0x52c2b2],_0x2d49e2=_0x56d5ef[_0x15dedc]||_0x1ef582;_0x1ef582['__proto__']=a29_0x139769[_0x57ccfd(0x1bb)](a29_0x139769),_0x1ef582['toString']=_0x2d49e2[_0x57ccfd(0x1bf)]['bind'](_0x2d49e2),_0x56d5ef[_0x15dedc]=_0x1ef582;}});function a29_0x1c89(){const _0x43bca8=['Error\x20in\x20approveReportD3:','D3\x20Report\x20not\x20found\x20with\x20ID:','One\x20or\x20both\x20D3\x20players\x20not\x20found','log','data','bind','docs','Current\x20user:','eloRating','toString','winnerUsername','prototype','exists','apply','currentUser','D3\x20match\x20report\x20not\x20found','win','No\x20user\x20logged\x20in','Error\x20in\x20updateEloRatingsD3:','error','playersD3'];a29_0x1c89=function(){return _0x43bca8;};return a29_0x1c89();}a29_0x16e010();function a29_0x4520(_0x11c131,_0x3c01f9){const _0x16e010=a29_0x1c89();return a29_0x4520=function(_0x139769,_0x3098e3){_0x139769=_0x139769-0x1b6;let _0x1c8907=_0x16e010[_0x139769];return _0x1c8907;},a29_0x4520(_0x11c131,_0x3c01f9);}import{addDoc,updateDoc,serverTimestamp,collection,doc,getDoc,getDocs,query,where,setDoc,deleteDoc,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';import{recordEloChangeD3}from'./elo-history-d3.js';export function calculateEloD3(_0xe5525e,_0xfd7136,_0xfcb097=0x20){const _0x455b59=0x1/(0x1+Math['pow'](0xa,(_0xfd7136-_0xe5525e)/0x190)),_0x1f15ee=0x1/(0x1+Math['pow'](0xa,(_0xe5525e-_0xfd7136)/0x190)),_0x539eb3=_0xe5525e+_0xfcb097*(0x1-_0x455b59),_0x231507=_0xfd7136+_0xfcb097*(0x0-_0x1f15ee);return{'newWinnerRating':Math['round'](_0x539eb3),'newLoserRating':Math['round'](_0x231507)};}export async function updateEloRatingsD3(_0x3047fd,_0x2bfb2f,_0x131a15){const _0xb727fc=a29_0x4520;try{const _0x9342fc=writeBatch(db),_0x537f7a=doc(db,'playersD3',_0x3047fd),_0x320ce8=doc(db,'playersD3',_0x2bfb2f),[_0x4bad9c,_0xd31809]=await Promise['all']([getDoc(_0x537f7a),getDoc(_0x320ce8)]);if(!_0x4bad9c['exists']()||!_0xd31809['exists']())throw new Error(_0xb727fc(0x1b8));const _0x4b9482=_0x4bad9c[_0xb727fc(0x1ba)](),_0xa8cfc6=_0xd31809['data'](),_0x11a4ce=_0x4b9482['position']||Number['MAX_SAFE_INTEGER'],_0x4fc7c2=_0xa8cfc6['position']||Number['MAX_SAFE_INTEGER'],{newWinnerRating:_0x3a4a8c,newLoserRating:_0x552cc1}=calculateEloD3(_0x4b9482['eloRating']||0x4b0,_0xa8cfc6[_0xb727fc(0x1be)]||0x4b0);let _0x27ff5a=_0x11a4ce,_0x5ba5a2=_0x4fc7c2;if(_0x11a4ce>_0x4fc7c2){console['log']('D3\x20Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked'),_0x27ff5a=_0x4fc7c2,_0x5ba5a2=_0x4fc7c2+0x1;const _0x4135a6=query(collection(db,'playersD3'),where('position','>',_0x4fc7c2),where('position','<',_0x11a4ce)),_0x4bde8a=await getDocs(_0x4135a6);for(const _0x13f346 of _0x4bde8a['docs']){_0x13f346['id']!==_0x3047fd&&_0x13f346['id']!==_0x2bfb2f&&_0x9342fc['update'](doc(db,_0xb727fc(0x1ca),_0x13f346['id']),{'position':_0x13f346[_0xb727fc(0x1ba)]()['position']+0x1});}}else console['log']('D3\x20Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions');return _0x9342fc['update'](_0x537f7a,{'eloRating':_0x3a4a8c,'lastMatchDate':serverTimestamp(),'position':_0x27ff5a,'lastMatchId':_0x131a15}),_0x9342fc['update'](_0x320ce8,{'eloRating':_0x552cc1,'lastMatchDate':serverTimestamp(),'position':_0x5ba5a2,'lastMatchId':_0x131a15}),await _0x9342fc['commit'](),console['log']('D3\x20ELO\x20ratings\x20updated\x20successfully'),await Promise['all']([recordEloChangeD3({'playerId':_0x3047fd,'previousElo':_0x4b9482[_0xb727fc(0x1be)]||0x4b0,'newElo':_0x3a4a8c,'opponentId':_0x2bfb2f,'matchResult':_0xb727fc(0x1c6),'previousPosition':_0x11a4ce,'newPosition':_0x27ff5a,'isPromotion':_0x27ff5a<_0x11a4ce,'matchId':_0x131a15,'timestamp':serverTimestamp()}),recordEloChangeD3({'playerId':_0x2bfb2f,'previousElo':_0xa8cfc6['eloRating']||0x4b0,'newElo':_0x552cc1,'opponentId':_0x3047fd,'matchResult':'loss','previousPosition':_0x4fc7c2,'newPosition':_0x5ba5a2,'isDemotion':_0x5ba5a2>_0x4fc7c2,'matchId':_0x131a15,'timestamp':serverTimestamp()})]),!![];}catch(_0x2bdbf5){console[_0xb727fc(0x1c9)](_0xb727fc(0x1c8),_0x2bdbf5);throw _0x2bdbf5;}}export async function approveReportD3(_0x3331ea,_0x226550,_0x4b3450,_0x2e3c73){const _0x455a17=a29_0x4520;try{console['log']('Starting\x20approveReportD3\x20function\x20with:',{'reportId':_0x3331ea,'winnerScore':_0x226550,'winnerSuicides':_0x4b3450,'winnerComment':_0x2e3c73});const _0x49d16b=auth[_0x455a17(0x1c4)];if(!_0x49d16b){console['log'](_0x455a17(0x1c7));throw new Error('You\x20must\x20be\x20logged\x20in\x20to\x20approve\x20D3\x20matches');}console['log'](_0x455a17(0x1bd),_0x49d16b['email']);const _0x113f03=await getDoc(doc(db,_0x455a17(0x1ca),_0x49d16b['uid'])),_0x313246=_0x113f03[_0x455a17(0x1c2)]()?_0x113f03['data']()['username']:null;console['log']('Current\x20username:',_0x313246);const _0x1c30ca=doc(db,'pendingMatchesD3',_0x3331ea),_0x4537b6=await getDoc(_0x1c30ca);if(!_0x4537b6['exists']()){console[_0x455a17(0x1b9)](_0x455a17(0x1b7),_0x3331ea);throw new Error(_0x455a17(0x1c5));}const _0x22fab3=_0x4537b6['data']();console['log']('D3\x20Report\x20data:',_0x22fab3);if(_0x313246!==_0x22fab3[_0x455a17(0x1c0)])throw new Error('Only\x20the\x20winner\x20can\x20approve\x20D3\x20matches');const _0x2171b8={..._0x22fab3,'winnerScore':_0x226550,'winnerSuicides':_0x4b3450,'winnerComment':_0x2e3c73,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':_0x313246,'createdAt':_0x22fab3['createdAt']||serverTimestamp(),'winnerUsername':_0x22fab3['winnerUsername'],'loserUsername':_0x22fab3['loserUsername']};await setDoc(doc(db,'approvedMatchesD3',_0x3331ea),_0x2171b8),await deleteDoc(_0x1c30ca),console['log']('D3\x20Match\x20moved\x20to\x20approved\x20collection');const [_0x164798,_0x40d49b]=await Promise['all']([getDocs(query(collection(db,'playersD3'),where('username','==',_0x22fab3[_0x455a17(0x1c0)]))),getDocs(query(collection(db,'playersD3'),where('username','==',_0x22fab3['loserUsername'])))]);if(_0x164798['empty']||_0x40d49b['empty'])throw new Error('Could\x20not\x20find\x20D3\x20player\x20documents');const _0x26f3a5=_0x164798[_0x455a17(0x1bc)][0x0]['id'],_0x5162f9=_0x40d49b['docs'][0x0]['id'];return await updateEloRatingsD3(_0x26f3a5,_0x5162f9,_0x3331ea),console['log']('D3\x20Match\x20successfully\x20approved\x20and\x20ELO\x20updated'),!![];}catch(_0x4a0729){console[_0x455a17(0x1c9)](_0x455a17(0x1b6),_0x4a0729);throw _0x4a0729;}}
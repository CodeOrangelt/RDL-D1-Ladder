function a17_0x3067(){const _0x1133d5=['match','empty','size','newElo','name','exception','info','apply','Unknown\x20Player','timestamp','D3\x20ELO\x20history\x20recorded\x20for\x20','map','log','Error\x20recording\x20D3\x20ELO\x20history:','approvedMatchesD3','loserId','winnerUsername','username','previousElo','Error\x20fetching\x20D3\x20ELO\x20history:','winnerId','loserUsername','Error\x20getting\x20D3\x20username:','return\x20(function()\x20','prototype','playersD3','length','desc','trace','docs','toString','demotion','all','error','bind','table','opponent','promotion','player','exists','warn','eloHistoryD3','__proto__','constructor','data','{}.constructor(\x22return\x20this\x22)(\x20)','console'];a17_0x3067=function(){return _0x1133d5;};return a17_0x3067();}const a17_0x4587f3=(function(){let _0x581274=!![];return function(_0xf98969,_0x1364dd){const _0x541638=_0x581274?function(){const _0x208d9f=a17_0x5bc3;if(_0x1364dd){const _0x196076=_0x1364dd[_0x208d9f(0xc8)](_0xf98969,arguments);return _0x1364dd=null,_0x196076;}}:function(){};return _0x581274=![],_0x541638;};}()),a17_0x22f02a=a17_0x4587f3(this,function(){const _0x4f56c5=a17_0x5bc3,_0x268493=function(){const _0x2ea986=a17_0x5bc3;let _0x52b525;try{_0x52b525=Function(_0x2ea986(0xd8)+_0x2ea986(0xee)+');')();}catch(_0x278f6b){_0x52b525=window;}return _0x52b525;},_0x13ffdb=_0x268493(),_0x4f3ee7=_0x13ffdb[_0x4f56c5(0xef)]=_0x13ffdb[_0x4f56c5(0xef)]||{},_0x5321a3=[_0x4f56c5(0xcd),_0x4f56c5(0xe9),_0x4f56c5(0xc7),_0x4f56c5(0xe2),_0x4f56c5(0xc6),_0x4f56c5(0xe4),_0x4f56c5(0xdd)];for(let _0x386006=0x0;_0x386006<_0x5321a3[_0x4f56c5(0xdb)];_0x386006++){const _0x110aec=a17_0x4587f3[_0x4f56c5(0xec)][_0x4f56c5(0xd9)][_0x4f56c5(0xe3)](a17_0x4587f3),_0x2465d6=_0x5321a3[_0x386006],_0x4d47aa=_0x4f3ee7[_0x2465d6]||_0x110aec;_0x110aec[_0x4f56c5(0xeb)]=a17_0x4587f3[_0x4f56c5(0xe3)](a17_0x4587f3),_0x110aec[_0x4f56c5(0xdf)]=_0x4d47aa[_0x4f56c5(0xdf)][_0x4f56c5(0xe3)](_0x4d47aa),_0x4f3ee7[_0x2465d6]=_0x110aec;}});a17_0x22f02a();function a17_0x5bc3(_0x4e6ff6,_0x1d2f38){_0x4e6ff6=_0x4e6ff6-0xc1;const _0x22f02a=a17_0x3067();let _0x4587f3=_0x22f02a[_0x4e6ff6];return _0x4587f3;}import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc,where}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import{getRankStyle}from'./ranks.js';let lastVisibleD3=null;async function getUsernameByIdD3(_0x14bad6){const _0x578d2c=a17_0x5bc3;try{if(!_0x14bad6)return _0x578d2c(0xc9);const _0x4d583e=await getDoc(doc(db,_0x578d2c(0xda),_0x14bad6));if(_0x4d583e[_0x578d2c(0xe8)]())return _0x4d583e[_0x578d2c(0xed)]()[_0x578d2c(0xd2)]||_0x578d2c(0xc9);const _0x44c55e=await getDocs(query(collection(db,_0x578d2c(0xcf)),where(_0x578d2c(0xd5),'==',_0x14bad6),limit(0x1)));if(!_0x44c55e[_0x578d2c(0xc2)])return _0x44c55e[_0x578d2c(0xde)][0x0][_0x578d2c(0xed)]()[_0x578d2c(0xd1)]||_0x578d2c(0xc9);const _0x2984d8=await getDocs(query(collection(db,_0x578d2c(0xcf)),where(_0x578d2c(0xd0),'==',_0x14bad6),limit(0x1)));if(!_0x2984d8[_0x578d2c(0xc2)])return _0x2984d8[_0x578d2c(0xde)][0x0][_0x578d2c(0xed)]()[_0x578d2c(0xd6)]||_0x578d2c(0xc9);return _0x578d2c(0xc9);}catch(_0x5464fc){return console[_0x578d2c(0xe2)](_0x578d2c(0xd7),_0x5464fc),_0x578d2c(0xc9);}}export async function recordEloChangeD3({playerId:_0x3326de,previousElo:_0xfacebc,newElo:_0x4a6c7f,opponentId:_0x31c0f4,matchResult:_0x3e3211,previousPosition:_0x5ba852,newPosition:_0x1f16ef,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x5c808e,timestamp:_0xd00432,matchCount:matchCount=null,winRate:winRate=0x0}){const _0x396ac3=a17_0x5bc3;try{const _0x4495ad=doc(collection(db,_0x396ac3(0xea))),_0x58bb27=await getUsernameByIdD3(_0x3326de),_0x5e7119=_0x31c0f4?await getUsernameByIdD3(_0x31c0f4):null;let _0x39c1a5=_0x396ac3(0xc1);if(isPromotion)_0x39c1a5=_0x396ac3(0xe6);if(isDemotion)_0x39c1a5=_0x396ac3(0xe0);const _0x8a03cc=getRankStyle(_0x4a6c7f,matchCount,winRate),_0x43503f=_0x8a03cc[_0x396ac3(0xc5)];return await setDoc(_0x4495ad,{'type':_0x39c1a5,'player':_0x3326de,'username':_0x58bb27,'playerUsername':_0x58bb27,'opponent':_0x31c0f4,'opponentUsername':_0x5e7119,'previousElo':_0xfacebc,'newElo':_0x4a6c7f,'change':_0x4a6c7f-_0xfacebc,'matchResult':_0x3e3211,'previousPosition':_0x5ba852,'newPosition':_0x1f16ef,'rankAchieved':_0x43503f,'matchId':_0x5c808e,'timestamp':_0xd00432||serverTimestamp(),'gameMode':'D3'}),console[_0x396ac3(0xcd)](_0x396ac3(0xcb)+_0x58bb27+'\x20('+_0x3326de+')'),!![];}catch(_0x3f8526){console[_0x396ac3(0xe2)](_0x396ac3(0xce),_0x3f8526);throw _0x3f8526;}}export async function getEloHistoryD3(_0x33b1ce=0x14){const _0x4ec0c3=a17_0x5bc3;try{const _0x3d3abb=collection(db,_0x4ec0c3(0xea));let _0x146b73;lastVisibleD3?_0x146b73=query(_0x3d3abb,orderBy(_0x4ec0c3(0xca),_0x4ec0c3(0xdc)),startAfter(lastVisibleD3),limit(_0x33b1ce)):_0x146b73=query(_0x3d3abb,orderBy(_0x4ec0c3(0xca),_0x4ec0c3(0xdc)),limit(_0x33b1ce));const _0x869c47=await getDocs(_0x146b73);if(_0x869c47[_0x4ec0c3(0xc2)])return{'entries':[],'hasMore':![]};lastVisibleD3=_0x869c47[_0x4ec0c3(0xde)][_0x869c47[_0x4ec0c3(0xde)][_0x4ec0c3(0xdb)]-0x1];const _0x468212=_0x869c47[_0x4ec0c3(0xde)][_0x4ec0c3(0xcc)](async _0x112b82=>{const _0x4c565a=_0x4ec0c3,_0x22611f=_0x112b82[_0x4c565a(0xed)](),[_0x4f428a,_0x2282db]=await Promise[_0x4c565a(0xe1)]([getUsernameByIdD3(_0x22611f[_0x4c565a(0xe7)]),getUsernameByIdD3(_0x22611f[_0x4c565a(0xe5)])]);return{..._0x22611f,'playerUsername':_0x4f428a,'opponentUsername':_0x2282db,'change':_0x22611f[_0x4c565a(0xc4)]-_0x22611f[_0x4c565a(0xd3)],'timestamp':_0x22611f[_0x4c565a(0xca)]};}),_0x40a881=await Promise[_0x4ec0c3(0xe1)](_0x468212);return{'entries':_0x40a881,'hasMore':_0x869c47[_0x4ec0c3(0xc3)]===_0x33b1ce};}catch(_0x11000c){console[_0x4ec0c3(0xe2)](_0x4ec0c3(0xd4),_0x11000c);throw _0x11000c;}}export function resetPaginationD3(){lastVisibleD3=null;}
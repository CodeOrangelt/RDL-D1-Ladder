const a35_0x5cf050=a35_0x1023,a35_0x24a01a=(function(){let _0x144249=!![];return function(_0x464806,_0x1ab557){const _0x36e7a0=_0x144249?function(){const _0xc57593=a35_0x1023;if(_0x1ab557){const _0x19a9e1=_0x1ab557[_0xc57593(0x166)](_0x464806,arguments);return _0x1ab557=null,_0x19a9e1;}}:function(){};return _0x144249=![],_0x36e7a0;};}()),a35_0xd8bce4=a35_0x24a01a(this,function(){const _0x385acc=a35_0x1023;let _0x2e738a;try{const _0x5aafc9=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x2e738a=_0x5aafc9();}catch(_0x3da1ff){_0x2e738a=window;}const _0x3c1870=_0x2e738a['console']=_0x2e738a[_0x385acc(0x181)]||{},_0x11ed07=['log','warn','info','error','exception',_0x385acc(0x168),'trace'];for(let _0x2482af=0x0;_0x2482af<_0x11ed07['length'];_0x2482af++){const _0x134a07=a35_0x24a01a['constructor']['prototype']['bind'](a35_0x24a01a),_0x32c5d0=_0x11ed07[_0x2482af],_0x3f34dc=_0x3c1870[_0x32c5d0]||_0x134a07;_0x134a07['__proto__']=a35_0x24a01a['bind'](a35_0x24a01a),_0x134a07[_0x385acc(0x174)]=_0x3f34dc['toString']['bind'](_0x3f34dc),_0x3c1870[_0x32c5d0]=_0x134a07;}});a35_0xd8bce4();const functions=require('firebase-functions'),admin=require('firebase-admin');admin['initializeApp']();const db=admin['firestore']();function a35_0x5363(){const _0x22c963=['gold','username','length','aggregatedMembers','apply','bronze','table','data','ladders','all','batch','forEach','nonParticipants','players','unranked','elo','includes','collection','toString','doc','playersD3','firestore','error','Error\x20updating\x20members\x20list:','document','country','get','eloRating','{collection}/{docId}','commit','active','console'];a35_0x5363=function(){return _0x22c963;};return a35_0x5363();}function a35_0x1023(_0x79d3df,_0x57c9e3){const _0xd8bce4=a35_0x5363();return a35_0x1023=function(_0x24a01a,_0xd8f99){_0x24a01a=_0x24a01a-0x162;let _0x53636b=_0xd8bce4[_0x24a01a];return _0x53636b;},a35_0x1023(_0x79d3df,_0x57c9e3);}exports['updateMembersList']=functions[a35_0x5cf050(0x177)][a35_0x5cf050(0x17a)](a35_0x5cf050(0x17e))['onWrite'](async(_0x31c4c4,_0x4aac18)=>{const _0x2fc581=a35_0x5cf050,_0x2161ba=_0x4aac18['params']['collection'],_0x4bb99b=_0x4aac18['params']['docId'];if(![_0x2fc581(0x16f),'playersD2','playersD3','userProfiles',_0x2fc581(0x16e)][_0x2fc581(0x172)](_0x2161ba))return null;try{await rebuildMembersList(),console['log']('Successfully\x20updated\x20aggregated\x20members\x20list');}catch(_0x110494){console[_0x2fc581(0x178)](_0x2fc581(0x179),_0x110494);}});async function rebuildMembersList(){const _0x2f7329=a35_0x5cf050,_0x4c9465=db['batch'](),[_0x253c6d,_0x24bb38,_0x15ec4b,_0x15614c,_0x33ead4]=await Promise[_0x2f7329(0x16b)]([db['collection']('userProfiles')['get'](),db[_0x2f7329(0x173)](_0x2f7329(0x16f))[_0x2f7329(0x17c)](),db['collection']('playersD2')['get'](),db[_0x2f7329(0x173)](_0x2f7329(0x176))['get'](),db[_0x2f7329(0x173)]('nonParticipants')[_0x2f7329(0x17c)]()]),_0x3e736c=new Map();_0x253c6d['forEach'](_0x42e2be=>{const _0x4078bf=_0x2f7329;_0x3e736c['set'](_0x42e2be['id'],_0x42e2be[_0x4078bf(0x169)]());});const _0x177079=new Map(),_0x135958=(_0xc013d2,_0x487831)=>{_0xc013d2['forEach'](_0x1d820a=>{const _0x3e1340=a35_0x1023,_0x2a6ec5=_0x1d820a[_0x3e1340(0x169)](),_0x3836df=_0x1d820a['id'];!_0x177079['has'](_0x3836df)&&_0x177079['set'](_0x3836df,{'userId':_0x3836df,'username':_0x2a6ec5[_0x3e1340(0x163)]||'Unknown','ladders':[],'isNonParticipant':![]});const _0x5b80ee=_0x177079['get'](_0x3836df);_0x5b80ee['ladders']['push']({'ladder':_0x487831,'elo':_0x2a6ec5[_0x3e1340(0x17d)]||0x4b0,'active':_0x2a6ec5[_0x3e1340(0x180)]!==![]});});};_0x135958(_0x24bb38,'D1'),_0x135958(_0x15ec4b,'D2'),_0x135958(_0x15614c,'D3'),_0x33ead4[_0x2f7329(0x16d)](_0x199ee4=>{const _0x144443=_0x2f7329,_0x3baee2=_0x199ee4[_0x144443(0x169)](),_0xe8e157=_0x199ee4['id'];!_0x177079['has'](_0xe8e157)&&_0x3baee2[_0x144443(0x163)]&&_0x177079['set'](_0xe8e157,{'userId':_0xe8e157,'username':_0x3baee2[_0x144443(0x163)],'ladders':[],'isNonParticipant':!![]});});const _0x53efde=[];_0x177079['forEach']((_0x4d7021,_0x5ac879)=>{const _0x5a2a5d=_0x2f7329,_0x44cad9=_0x3e736c[_0x5a2a5d(0x17c)](_0x5ac879)||{};let _0x2350bb=0x0,_0x248f6c=null;if(_0x4d7021[_0x5a2a5d(0x16a)][_0x5a2a5d(0x164)]>0x0){const _0x3e18cb=_0x4d7021['ladders']['sort']((_0x145b00,_0x546215)=>_0x546215[_0x5a2a5d(0x171)]-_0x145b00['elo']);_0x2350bb=_0x3e18cb[0x0][_0x5a2a5d(0x171)],_0x248f6c=_0x3e18cb[0x0]['ladder'];}const _0x294432={'userId':_0x5ac879,'username':_0x4d7021['username'],'profileImageUrl':_0x44cad9['profileImageUrl']||null,'country':_0x44cad9[_0x5a2a5d(0x17b)]||null,'motto':_0x44cad9['motto']||null,'favoriteMap':_0x44cad9['favoriteMap']||null,'favoriteWeapon':_0x44cad9['favoriteWeapon']||null,'isNonParticipant':_0x4d7021['isNonParticipant'],'ladders':_0x4d7021[_0x5a2a5d(0x16a)],'primaryLadder':_0x248f6c,'highestElo':_0x2350bb,'rank':getPlayerRank(_0x2350bb),'lastUpdated':admin[_0x5a2a5d(0x177)]['FieldValue']['serverTimestamp']()};_0x53efde['push'](_0x294432);});const _0xd2633a=db['collection'](_0x2f7329(0x165)),_0x3ba21a=await _0xd2633a['get'](),_0x250523=[];_0x3ba21a['forEach'](_0x1640c0=>{_0x250523['push'](_0x1640c0['ref']['delete']());}),await Promise[_0x2f7329(0x16b)](_0x250523);const _0x3e58c1=0x1f4,_0x11ea3c=[];for(let _0x3627f1=0x0;_0x3627f1<_0x53efde[_0x2f7329(0x164)];_0x3627f1+=_0x3e58c1){const _0xf524ca=db[_0x2f7329(0x16c)](),_0x8f2be=_0x53efde['slice'](_0x3627f1,_0x3627f1+_0x3e58c1);_0x8f2be[_0x2f7329(0x16d)](_0x42f5d0=>{const _0x163de9=_0x2f7329,_0x63c6dc=_0xd2633a[_0x163de9(0x175)](_0x42f5d0['userId']);_0xf524ca['set'](_0x63c6dc,_0x42f5d0);}),_0x11ea3c['push'](_0xf524ca[_0x2f7329(0x17f)]());}await Promise[_0x2f7329(0x16b)](_0x11ea3c);}function getPlayerRank(_0x2759e3){const _0xa79390=a35_0x5cf050;if(_0x2759e3>=0x7d0)return'emerald';if(_0x2759e3>=0x708)return _0xa79390(0x162);if(_0x2759e3>=0x640)return'silver';if(_0x2759e3>=0x578)return _0xa79390(0x167);return _0xa79390(0x170);}exports['rebuildMembersListManual']=functions['https']['onRequest'](async(_0x39916a,_0x2430a4)=>{const _0x4566fa=a35_0x5cf050;try{await rebuildMembersList(),_0x2430a4['status'](0xc8)['send']('Members\x20list\x20rebuilt\x20successfully');}catch(_0x39bc2d){console[_0x4566fa(0x178)]('Error\x20rebuilding\x20members\x20list:',_0x39bc2d),_0x2430a4['status'](0x1f4)['send']('Error\x20rebuilding\x20members\x20list');}});
const a56_0x59ce8a=a56_0x3cdd,a56_0xc01431=(function(){let _0x5a24fd=!![];return function(_0x1c0ec2,_0x87ec38){const _0x2cf190=_0x5a24fd?function(){const _0xcaf793=a56_0x3cdd;if(_0x87ec38){const _0x2a9b40=_0x87ec38[_0xcaf793(0x1dd)](_0x1c0ec2,arguments);return _0x87ec38=null,_0x2a9b40;}}:function(){};return _0x5a24fd=![],_0x2cf190;};}()),a56_0x327ff6=a56_0xc01431(this,function(){const _0x2a0ab6=a56_0x3cdd,_0x3dd3dd=function(){let _0x3e27d1;try{_0x3e27d1=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x3fa36e){_0x3e27d1=window;}return _0x3e27d1;},_0x14fe8=_0x3dd3dd(),_0x2fc3de=_0x14fe8['console']=_0x14fe8['console']||{},_0x6ff14f=['log','warn','info','error','exception','table',_0x2a0ab6(0x1e4)];for(let _0x73d614=0x0;_0x73d614<_0x6ff14f['length'];_0x73d614++){const _0x3ed238=a56_0xc01431['constructor']['prototype']['bind'](a56_0xc01431),_0x13eb74=_0x6ff14f[_0x73d614],_0xa273c2=_0x2fc3de[_0x13eb74]||_0x3ed238;_0x3ed238['__proto__']=a56_0xc01431['bind'](a56_0xc01431),_0x3ed238[_0x2a0ab6(0x1e1)]=_0xa273c2['toString']['bind'](_0xa273c2),_0x2fc3de[_0x13eb74]=_0x3ed238;}});a56_0x327ff6();import{db}from'../firebase-config.js';import{collection,doc,getDoc,getDocs,query,limit,startAfter,where,onSnapshot}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const cache={'userProfiles':new Map(),'ladderPlayers':new Map(),'matchResults':new Map(),'eloHistory':new Map()},CACHE_EXPIRY={'userProfiles':0x5*0x3c*0x3e8,'ladderPlayers':0x2*0x3c*0x3e8,'matchResults':0x1*0x3c*0x3e8,'eloHistory':0x3*0x3c*0x3e8};export const userProfilesRef=collection(db,'userProfiles');export async function fetchPaginatedData(_0x55b408,_0x6a0675=0xa,_0x32d5fe=null){const _0x54c2d2=a56_0x3cdd;let _0x514605=query(_0x55b408,limit(_0x6a0675));_0x32d5fe&&(_0x514605=query(_0x514605,startAfter(_0x32d5fe)));const _0x22ba97=await getDocs(_0x514605),_0x455ee9=_0x22ba97[_0x54c2d2(0x1d9)][_0x22ba97['docs']['length']-0x1];return{'data':_0x22ba97[_0x54c2d2(0x1d9)]['map'](_0x13d3e7=>({'id':_0x13d3e7['id'],..._0x13d3e7['data']()})),'lastVisible':_0x455ee9,'hasMore':_0x22ba97['docs']['length']===_0x6a0675};}export async function getUserProfile(_0x1fcbfe){const _0x524a27=a56_0x3cdd,_0x15c271=cache['userProfiles'][_0x524a27(0x1d8)](_0x1fcbfe);if(_0x15c271&&Date['now']()-_0x15c271['timestamp']<CACHE_EXPIRY['userProfiles'])return _0x15c271['data'];const _0x2f0d75=await getDoc(doc(userProfilesRef,_0x1fcbfe));if(_0x2f0d75['exists']()){const _0x59c635=_0x2f0d75[_0x524a27(0x1de)]();return cache['userProfiles']['set'](_0x1fcbfe,{'data':_0x59c635,'timestamp':Date[_0x524a27(0x1e0)]()}),_0x59c635;}return null;}function a56_0x3cdd(_0x29a045,_0x13a940){const _0x327ff6=a56_0x4bc9();return a56_0x3cdd=function(_0xc01431,_0x4d26c5){_0xc01431=_0xc01431-0x1d8;let _0x4bc964=_0x327ff6[_0xc01431];return _0x4bc964;},a56_0x3cdd(_0x29a045,_0x13a940);}export async function getLadderData(_0x2c70ac=0x1){const _0x48659f=a56_0x3cdd,_0x147f8c='division_'+_0x2c70ac,_0x365ffe=cache['ladderPlayers'][_0x48659f(0x1d8)](_0x147f8c);if(_0x365ffe&&Date['now']()-_0x365ffe['timestamp']<CACHE_EXPIRY[_0x48659f(0x1e3)])return _0x365ffe['data'];const _0x56d9e8=_0x2c70ac===0x1?'players':'playersD'+_0x2c70ac,_0x4fb719=collection(db,_0x56d9e8),_0x168054=await getDocs(query(_0x4fb719,limit(0x64))),_0x35cf0b=_0x168054['docs']['map'](_0x289df3=>({'id':_0x289df3['id'],..._0x289df3['data']()}));return cache[_0x48659f(0x1e3)][_0x48659f(0x1dc)](_0x147f8c,{'data':_0x35cf0b,'timestamp':Date[_0x48659f(0x1e0)]()}),_0x35cf0b;}export async function getEloHistoryBatch(_0x358104,_0x16e63e=0x1){const _0x59bda2=a56_0x3cdd,_0x35ef6b=_0x16e63e===0x1?'eloHistory':_0x59bda2(0x1db)+_0x16e63e,_0x31bfc8=collection(db,_0x35ef6b),_0x1d3774={},_0x3e3bc2=[];_0x358104[_0x59bda2(0x1da)](_0x264d01=>{const _0x1f3680=_0x59bda2,_0x3c7028=_0x264d01+'_'+_0x16e63e,_0x105993=cache['eloHistory']['get'](_0x3c7028);_0x105993&&Date[_0x1f3680(0x1e0)]()-_0x105993['timestamp']<CACHE_EXPIRY['eloHistory']?_0x1d3774[_0x264d01]=_0x105993['data']:_0x3e3bc2[_0x1f3680(0x1df)](_0x264d01);});const _0x3e2275=0xa;for(let _0x53310f=0x0;_0x53310f<_0x3e3bc2['length'];_0x53310f+=_0x3e2275){const _0x5c8df1=_0x3e3bc2[_0x59bda2(0x1e5)](_0x53310f,_0x53310f+_0x3e2275);if(_0x5c8df1[_0x59bda2(0x1e2)]>0x0)try{const _0x4cbd9b=query(_0x31bfc8,where('playerId','in',_0x5c8df1),limit(0x64)),_0x287ba7=await getDocs(_0x4cbd9b);_0x287ba7['docs']['forEach'](_0x330b21=>{const _0x23ee69=_0x59bda2,_0xe095c1=_0x330b21[_0x23ee69(0x1de)](),_0x1afa2a=_0xe095c1['playerId'];if(!_0x1d3774[_0x1afa2a])_0x1d3774[_0x1afa2a]=[];_0x1d3774[_0x1afa2a]['push'](_0xe095c1);const _0x58d8e4=_0x1afa2a+'_'+_0x16e63e;cache['eloHistory'][_0x23ee69(0x1dc)](_0x58d8e4,{'data':_0x1d3774[_0x1afa2a],'timestamp':Date['now']()});});}catch(_0x2977f3){console['error']('Error\x20fetching\x20batch\x20ELO\x20history:',_0x2977f3);}}return _0x1d3774;}let usernameCache=new Map(),usernameCacheTimestamp=Date[a56_0x59ce8a(0x1e0)]();function a56_0x4bc9(){const _0x4591e1=['get','docs','forEach','eloHistoryD','set','apply','data','push','now','toString','length','ladderPlayers','trace','slice','doc','type'];a56_0x4bc9=function(){return _0x4591e1;};return a56_0x4bc9();}export function setupEfficientListener(_0x314f14,_0x5216a6=[],_0x475873){const _0x15c1da=collection(db,_0x314f14),_0x51f8ab=query(_0x15c1da,..._0x5216a6),_0x28e646=onSnapshot(_0x51f8ab,_0x37f14a=>{const _0x23bc47=a56_0x3cdd,_0x3941d2=_0x37f14a['docChanges']()['map'](_0x262a2a=>({'type':_0x262a2a[_0x23bc47(0x1e7)],'id':_0x262a2a['doc']['id'],'data':_0x262a2a[_0x23bc47(0x1e6)][_0x23bc47(0x1de)]()}));_0x3941d2[_0x23bc47(0x1e2)]>0x0&&_0x475873(_0x3941d2,_0x37f14a[_0x23bc47(0x1d9)]);});return _0x28e646;}export async function bulkResolveUsernames(_0x1c46dc){const _0x486634=new Map();if(!_0x1c46dc||_0x1c46dc['length']===0x0)return _0x486634;const _0x2d868b=['players','playersD2','playersD3','nonParticipants'];for(const _0x2b502d of _0x2d868b){const _0x56caed=collection(db,_0x2b502d),_0x2d35a2=await getDocs(_0x56caed);_0x2d35a2['forEach'](_0x1d92d5=>{const _0x3531f1=_0x1d92d5['data']();_0x3531f1['username']&&_0x1c46dc['includes'](_0x1d92d5['id'])&&_0x486634['set'](_0x1d92d5['id'],_0x3531f1['username']);});}return _0x486634;}
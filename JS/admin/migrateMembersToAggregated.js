import{initializeApp}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';import{getFirestore,collection,getDocs,writeBatch,doc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a1_0x1e7f(_0x2c9c42,_0x14316a){const _0x1d9397=a1_0x2b79();return a1_0x1e7f=function(_0x51fbb8,_0x7c66d2){_0x51fbb8=_0x51fbb8-0x1e1;let _0x2b7911=_0x1d9397[_0x51fbb8];return _0x2b7911;},a1_0x1e7f(_0x2c9c42,_0x14316a);}import{firebaseConfig}from'../firebase-config.js';function a1_0x2b79(){const _0x2dc6c4=['\x20non-participants','size','log','{}.constructor(\x22return\x20this\x22)(\x20)','elo','‚ùå\x20Migration\x20failed:','console','error','‚öôÔ∏è\x20Processed\x20','toString','length','profileImageUrl','all','bind','forEach','üîí\x20Permission\x20denied.\x20Make\x20sure\x20you\x27re\x20signed\x20in\x20as\x20an\x20admin\x20and\x20security\x20rules\x20allow\x20access\x20to\x20aggregatedMembers\x20collection.','set','commit','ladder','\x20batches...','trace','name','constructor','‚úÖ\x20Data\x20fetched:\x20','\x20members\x20processed)','Unknown','playersD2'];a1_0x2b79=function(){return _0x2dc6c4;};return a1_0x2b79();}const app=initializeApp(firebaseConfig),db=getFirestore(app);async function migrateToAggregatedMembers(){const _0x341313=a1_0x1e7f,_0x49cf5e=(function(){let _0x235955=!![];return function(_0xaa5083,_0xfc618d){const _0x450756=_0x235955?function(){if(_0xfc618d){const _0x557069=_0xfc618d['apply'](_0xaa5083,arguments);return _0xfc618d=null,_0x557069;}}:function(){};return _0x235955=![],_0x450756;};}()),_0x1db343=_0x49cf5e(this,function(){const _0x3727c8=a1_0x1e7f;let _0x413656;try{const _0x456e3d=Function('return\x20(function()\x20'+_0x3727c8(0x1e4)+');');_0x413656=_0x456e3d();}catch(_0xb5fd60){_0x413656=window;}const _0x39a033=_0x413656[_0x3727c8(0x1e7)]=_0x413656['console']||{},_0x41944d=['log','warn','info',_0x3727c8(0x1e8),'exception','table',_0x3727c8(0x1f5)];for(let _0x306f08=0x0;_0x306f08<_0x41944d['length'];_0x306f08++){const _0x35ec5f=_0x49cf5e[_0x3727c8(0x1f7)]['prototype'][_0x3727c8(0x1ee)](_0x49cf5e),_0x509f4c=_0x41944d[_0x306f08],_0x1df47f=_0x39a033[_0x509f4c]||_0x35ec5f;_0x35ec5f['__proto__']=_0x49cf5e[_0x3727c8(0x1ee)](_0x49cf5e),_0x35ec5f[_0x3727c8(0x1ea)]=_0x1df47f['toString']['bind'](_0x1df47f),_0x39a033[_0x509f4c]=_0x35ec5f;}});_0x1db343(),console['log']('üîÑ\x20Starting\x20migration\x20to\x20aggregated\x20members...');try{console[_0x341313(0x1e3)]('üì•\x20Fetching\x20all\x20collections...');const [_0x574ae0,_0x30c7c5,_0x238f66,_0x52546a,_0x41d9ff]=await Promise['all']([getDocs(collection(db,'userProfiles')),getDocs(collection(db,'players')),getDocs(collection(db,_0x341313(0x1fb))),getDocs(collection(db,'playersD3')),getDocs(collection(db,'nonParticipants'))]);console['log'](_0x341313(0x1f8)+_0x574ae0['size']+'\x20profiles,\x20'+_0x30c7c5['size']+'\x20D1,\x20'+_0x238f66['size']+'\x20D2,\x20'+_0x52546a[_0x341313(0x1e2)]+'\x20D3,\x20'+_0x41d9ff['size']+_0x341313(0x1e1));const _0x109891=new Map();_0x574ae0['forEach'](_0x2e4251=>{const _0x9bfc9a=_0x341313;_0x109891[_0x9bfc9a(0x1f1)](_0x2e4251['id'],_0x2e4251['data']());});const _0x3094bf=new Map(),_0x29bb6a=(_0x570805,_0x1deb4a)=>{_0x570805['forEach'](_0x319c0b=>{const _0x1ed0a3=a1_0x1e7f,_0x3a2d65=_0x319c0b['data'](),_0x1e6dcc=_0x319c0b['id'];!_0x3094bf['has'](_0x1e6dcc)&&_0x3094bf[_0x1ed0a3(0x1f1)](_0x1e6dcc,{'userId':_0x1e6dcc,'username':_0x3a2d65['username']||_0x3a2d65['name']||_0x1ed0a3(0x1fa),'ladders':[],'isNonParticipant':![]});const _0x2f6d17=_0x3094bf['get'](_0x1e6dcc);_0x2f6d17['ladders']['push']({'ladder':_0x1deb4a,'elo':_0x3a2d65['eloRating']||_0x3a2d65['elo']||0x4b0,'active':_0x3a2d65['active']!==![]});});};_0x29bb6a(_0x30c7c5,'D1'),_0x29bb6a(_0x238f66,'D2'),_0x29bb6a(_0x52546a,'D3'),_0x41d9ff[_0x341313(0x1ef)](_0x93bef5=>{const _0x208eb5=_0x341313,_0x3d6b97=_0x93bef5['data'](),_0x5b1a15=_0x93bef5['id'];!_0x3094bf['has'](_0x5b1a15)&&(_0x3d6b97['username']||_0x3d6b97['name'])&&_0x3094bf['set'](_0x5b1a15,{'userId':_0x5b1a15,'username':_0x3d6b97['username']||_0x3d6b97[_0x208eb5(0x1f6)],'ladders':[],'isNonParticipant':!![]});}),console['log'](_0x341313(0x1e9)+_0x3094bf[_0x341313(0x1e2)]+'\x20unique\x20members'),console['log']('üíæ\x20Writing\x20aggregated\x20data...');const _0x3bf50e=[];let _0x4482dc=writeBatch(db),_0xc896da=0x0,_0xc7901c=0x0;_0x3094bf[_0x341313(0x1ef)]((_0x3d0223,_0x474e7e)=>{const _0x2ff2c5=_0x341313,_0x44fdde=_0x109891['get'](_0x474e7e)||{};let _0x5387a3=0x0,_0x3f3bd2=null;if(_0x3d0223['ladders'][_0x2ff2c5(0x1eb)]>0x0){const _0x10ae8a=_0x3d0223['ladders']['sort']((_0x397e2f,_0x32b1ed)=>_0x32b1ed['elo']-_0x397e2f[_0x2ff2c5(0x1e5)]);_0x5387a3=_0x10ae8a[0x0]['elo'],_0x3f3bd2=_0x10ae8a[0x0][_0x2ff2c5(0x1f3)];}const _0x53b7dd={'userId':_0x474e7e,'username':_0x3d0223['username'],'profileImageUrl':_0x44fdde[_0x2ff2c5(0x1ec)]||null,'country':_0x44fdde['country']||null,'motto':_0x44fdde['motto']||null,'favoriteMap':_0x44fdde['favoriteMap']||null,'favoriteWeapon':_0x44fdde['favoriteWeapon']||null,'isNonParticipant':_0x3d0223['isNonParticipant'],'ladders':_0x3d0223['ladders'],'primaryLadder':_0x3f3bd2,'highestElo':_0x5387a3,'rank':getPlayerRank(_0x5387a3),'lastUpdated':new Date(),'migrationTimestamp':new Date()['toISOString']()},_0x5b2143=doc(collection(db,'aggregatedMembers'),_0x474e7e);_0x4482dc['set'](_0x5b2143,_0x53b7dd),_0xc896da++,_0xc7901c++,_0xc896da>=0x1c2&&(_0x3bf50e['push'](_0x4482dc['commit']()),_0x4482dc=writeBatch(db),_0xc896da=0x0,console['log']('üì¶\x20Prepared\x20batch\x20'+_0x3bf50e['length']+'\x20('+_0xc7901c+_0x2ff2c5(0x1f9)));}),_0xc896da>0x0&&_0x3bf50e['push'](_0x4482dc[_0x341313(0x1f2)]()),console['log']('üöÄ\x20Executing\x20'+_0x3bf50e['length']+_0x341313(0x1f4)),await Promise[_0x341313(0x1ed)](_0x3bf50e),console['log']('üéâ\x20Successfully\x20migrated\x20'+_0x3094bf['size']+'\x20members\x20to\x20aggregated\x20collection!'),console['log']('üí°\x20Refresh\x20your\x20members\x20page\x20to\x20see\x20the\x20results!');}catch(_0x3c338e){console['error'](_0x341313(0x1e6),_0x3c338e),_0x3c338e['code']==='permission-denied'&&console['error'](_0x341313(0x1f0));}}function getPlayerRank(_0x113e46){if(_0x113e46>=0x7d0)return'emerald';if(_0x113e46>=0x708)return'gold';if(_0x113e46>=0x640)return'silver';if(_0x113e46>=0x578)return'bronze';return'unranked';}migrateToAggregatedMembers();
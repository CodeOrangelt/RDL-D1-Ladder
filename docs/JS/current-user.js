const a0_0x2abd64=a0_0x237f;(function(_0x4061f4,_0x42213b){const _0x18f1bc=a0_0x237f,_0xfa2652=_0x4061f4();while(!![]){try{const _0x4f9fce=parseInt(_0x18f1bc(0x9e))/0x1+parseInt(_0x18f1bc(0x9a))/0x2*(-parseInt(_0x18f1bc(0x82))/0x3)+parseInt(_0x18f1bc(0x8a))/0x4+parseInt(_0x18f1bc(0x8d))/0x5+parseInt(_0x18f1bc(0x95))/0x6*(-parseInt(_0x18f1bc(0x7c))/0x7)+parseInt(_0x18f1bc(0xa5))/0x8+-parseInt(_0x18f1bc(0x8f))/0x9*(parseInt(_0x18f1bc(0xb0))/0xa);if(_0x4f9fce===_0x42213b)break;else _0xfa2652['push'](_0xfa2652['shift']());}catch(_0x25bda8){_0xfa2652['push'](_0xfa2652['shift']());}}}(a0_0x2892,0x2dbd8));const a0_0x4a0bfc=(function(){let _0x766968=!![];return function(_0x5e8b09,_0x46af63){const _0x1c3047=_0x766968?function(){const _0x19cb79=a0_0x237f;if(_0x46af63){const _0x47aaa1=_0x46af63[_0x19cb79(0x8b)](_0x5e8b09,arguments);return _0x46af63=null,_0x47aaa1;}}:function(){};return _0x766968=![],_0x1c3047;};}()),a0_0x2e1af1=a0_0x4a0bfc(this,function(){const _0x3f209d=a0_0x237f,_0x50c655=function(){const _0x2deb90=a0_0x237f;let _0x437bdf;try{_0x437bdf=Function('return\x20(function()\x20'+_0x2deb90(0xa7)+');')();}catch(_0x123fb1){_0x437bdf=window;}return _0x437bdf;},_0x57f0ef=_0x50c655(),_0x347d6a=_0x57f0ef[_0x3f209d(0xac)]=_0x57f0ef[_0x3f209d(0xac)]||{},_0x1267d4=['log','warn','info','error','exception',_0x3f209d(0xa9),'trace'];for(let _0xcca2bb=0x0;_0xcca2bb<_0x1267d4['length'];_0xcca2bb++){const _0x4211c1=a0_0x4a0bfc['constructor'][_0x3f209d(0x7d)]['bind'](a0_0x4a0bfc),_0x33ad91=_0x1267d4[_0xcca2bb],_0x53d0d1=_0x347d6a[_0x33ad91]||_0x4211c1;_0x4211c1[_0x3f209d(0x83)]=a0_0x4a0bfc['bind'](a0_0x4a0bfc),_0x4211c1[_0x3f209d(0x94)]=_0x53d0d1['toString'][_0x3f209d(0x87)](_0x53d0d1),_0x347d6a[_0x33ad91]=_0x4211c1;}});a0_0x2e1af1();import{getAuth,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{doc,getDoc,collection,query,where,getDocs,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import{isAdmin}from'./admin-check.js';const ADMIN_EMAILS=['admin@ladder.com',a0_0x2abd64(0xaa)],userCache={'uid':null,'username':null,'isAdmin':![],'hasCheckedCollections':![],'lastChecked':0x0,'role':null},invitationCache={'lastCheck':0x0,'pendingCount':0x0,'checkInterval':0x493e0};function a0_0x2892(){const _0x1c0780=['data','checkInterval','\x20by\x20UID:','41018eyQhjs','exists','council','target','276406cdUwLl','isAdmin','error','role','nonParticipants','pending','join','2724568mANQxW','a[href]','{}.constructor(\x22return\x20this\x22)(\x20)','.admin-only','table','Brian2af@outlook.com','players','console','auth-section','charAt','map','30EGcGhs','uid','toUpperCase','hasCheckedCollections','pendingCount','status','2545193ksKIXQ','prototype','toLowerCase','click','username','docs','21WEhhYp','__proto__','display','addEventListener','querySelectorAll','bind','User','Error\x20checking\x20','1311600xKytmk','apply','creative\x20lead','1558690ZbqwCK','style','1686303LpTqCr','split','empty','email','slice','toString','6NpMlDk','innerHTML'];a0_0x2892=function(){return _0x1c0780;};return a0_0x2892();}function updateInboxNotification(_0x4098d8){const _0x16268f=a0_0x2abd64,_0x9f5b3f=document['getElementById']('inbox-notification');_0x9f5b3f&&(_0x4098d8>0x0?(_0x9f5b3f['style'][_0x16268f(0x84)]='inline-block',_0x9f5b3f['textContent']=_0x4098d8>0x9?'9+':_0x4098d8):_0x9f5b3f['style'][_0x16268f(0x84)]='none');}async function checkPendingInvitationsForCurrentUser(_0x14e24c){const _0x2d51f9=a0_0x2abd64;try{const _0xc41467=Date['now']();if(_0xc41467-invitationCache['lastCheck']<invitationCache[_0x2d51f9(0x98)])return updateInboxNotification(invitationCache[_0x2d51f9(0x7a)]),invitationCache[_0x2d51f9(0x7a)];invitationCache['lastCheck']=_0xc41467;const _0x42d530=collection(db,'gameInvitations'),_0xf3f571=query(_0x42d530,where('toUserId','==',_0x14e24c),where(_0x2d51f9(0x7b),'==',_0x2d51f9(0xa3)),limit(0x5)),_0x21b832=await getDocs(_0xf3f571),_0x56181c=_0x21b832['size'];return invitationCache['pendingCount']=_0x56181c,updateInboxNotification(_0x56181c),_0x56181c;}catch(_0x297113){return console['warn']('Could\x20not\x20check\x20pending\x20invitations\x20for\x20current\x20user:',_0x297113),0x0;}}function updateAuthSectionImmediate(_0x2c2396,_0x38d250=![]){const _0x4ca73a=a0_0x2abd64,_0x217245=document['getElementById'](_0x4ca73a(0xad));if(!_0x217245)return;if(_0x2c2396&&_0x38d250)document['querySelectorAll']('.admin-only')['forEach'](_0x4fa4ba=>{_0x4fa4ba['style']['display']='block';});else!_0x2c2396&&document['querySelectorAll']('.admin-only')['forEach'](_0xc9a28e=>{_0xc9a28e['style']['display']='none';});if(_0x2c2396){const _0x8327eb=userCache['username']||(_0x2c2396[_0x4ca73a(0x92)]?_0x2c2396[_0x4ca73a(0x92)][_0x4ca73a(0x90)]('@')[0x0]:'User'),_0x2cbd57=userCache[_0x4ca73a(0xa1)]?'\x20('+userCache['role']+')':_0x38d250?'\x20(Admin)':'';_0x217245['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20class=\x22nav-username\x22>'+_0x8327eb+_0x2cbd57+'</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username='+encodeURIComponent(_0x8327eb)+'\x22>Profile</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./inbox.html\x22\x20class=\x22nav-notification\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Inbox\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22inbox-notification\x22\x20class=\x22notification-dot\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22members.html\x22>Members</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./redeem.html\x22><i\x20class=\x22fas\x20fa-gift\x22></i>Store</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20id=\x22logout-link\x22>Sign\x20Out</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';const _0x13b3ff=document['getElementById']('logout-link');_0x13b3ff&&_0x13b3ff['addEventListener'](_0x4ca73a(0x7f),_0x4ed837=>{_0x4ed837['preventDefault']();const _0x5e3165=getAuth();updateAuthSectionImmediate(null),_0x5e3165['signOut']()['catch'](_0x4e2ddd=>{console['error']('Error\x20signing\x20out:',_0x4e2ddd);});}),_0x2c2396['uid']&&setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0x2c2396['uid']);},0x3e8);}else _0x217245[_0x4ca73a(0x96)]='<a\x20href=\x22login.html\x22\x20class=\x22login-link\x22>Login</a>';}function a0_0x237f(_0x5343b6,_0x85ac3d){const _0x40c9a4=a0_0x2892();return a0_0x237f=function(_0x2e1af1,_0x4a0bfc){_0x2e1af1=_0x2e1af1-0x78;let _0x57b432=_0x40c9a4[_0x2e1af1];return _0x57b432;},a0_0x237f(_0x5343b6,_0x85ac3d);}async function checkAdminRoles(_0x32dfa4){const _0x51dad4=a0_0x2abd64;if(!_0x32dfa4||!_0x32dfa4[_0x51dad4(0x92)])return{'isAdmin':![],'role':null};try{console['log']('Checking\x20roles\x20for\x20user:\x20'+_0x32dfa4['email']);const _0x5e9e18=['players','playersD2','playersD3','nonParticipants','userProfiles'],_0x287510=[_0x51dad4(0x9c),_0x51dad4(0x8c),'owner','admin'];for(const _0x479a5f of _0x5e9e18){try{const _0x271506=doc(db,_0x479a5f,_0x32dfa4['uid']),_0x366359=await getDoc(_0x271506);if(_0x366359[_0x51dad4(0x9b)]()){const _0x433c96=_0x366359[_0x51dad4(0x97)]();console['log']('Found\x20user\x20in\x20'+_0x479a5f+'\x20by\x20UID:',_0x433c96);let _0x1832f0=(_0x433c96['roleName']||_0x433c96[_0x51dad4(0xa1)]||'')['toLowerCase'](),_0x5646d5=_0x433c96['roleName']||_0x433c96['role']||'';if(_0x1832f0&&_0x287510['includes'](_0x1832f0)){console['log']('Found\x20admin\x20role:\x20'+_0x1832f0+'\x20in\x20'+_0x479a5f);const _0x4f90c9=_0x5646d5['split']('\x20')[_0x51dad4(0xaf)](_0x438031=>_0x438031[_0x51dad4(0xae)](0x0)[_0x51dad4(0x78)]()+_0x438031['slice'](0x1)['toLowerCase']())['join']('\x20');return{'isAdmin':!![],'role':_0x4f90c9};}}}catch(_0xef932f){console[_0x51dad4(0xa0)](_0x51dad4(0x89)+_0x479a5f+_0x51dad4(0x99),_0xef932f);}}for(const _0x4d1d0c of _0x5e9e18){try{const _0x3dc12b=collection(db,_0x4d1d0c);let _0xe1387b=query(_0x3dc12b,where('email','==',_0x32dfa4['email'])),_0xaa7900=await getDocs(_0xe1387b);_0xaa7900['empty']&&(_0xe1387b=query(_0x3dc12b,where('email','==',_0x32dfa4['email']['toLowerCase']())),_0xaa7900=await getDocs(_0xe1387b));if(!_0xaa7900[_0x51dad4(0x91)]){const _0x1ceb45=_0xaa7900[_0x51dad4(0x81)][0x0]['data']();console['log']('Found\x20user\x20in\x20'+_0x4d1d0c+'\x20by\x20email:',_0x1ceb45);let _0x8b73e6=(_0x1ceb45['roleName']||_0x1ceb45['role']||'')[_0x51dad4(0x7e)](),_0x323c24=_0x1ceb45['roleName']||_0x1ceb45['role']||'';if(_0x8b73e6&&_0x287510['includes'](_0x8b73e6)){console['log']('Found\x20admin\x20role:\x20'+_0x8b73e6+'\x20in\x20'+_0x4d1d0c);const _0x171c68=_0x323c24['split']('\x20')['map'](_0x167285=>_0x167285['charAt'](0x0)['toUpperCase']()+_0x167285[_0x51dad4(0x93)](0x1)[_0x51dad4(0x7e)]())[_0x51dad4(0xa4)]('\x20');return{'isAdmin':!![],'role':_0x171c68};}}}catch(_0x33ea41){console['error']('Error\x20checking\x20'+_0x4d1d0c+'\x20by\x20email:',_0x33ea41);}}return console['log']('No\x20admin\x20roles\x20found\x20for\x20user'),{'isAdmin':![],'role':null};}catch(_0x3aa60f){return console[_0x51dad4(0xa0)]('Error\x20in\x20checkAdminRoles:',_0x3aa60f),{'isAdmin':![],'role':null};}}async function updateAuthSection(_0x3eebaa){const _0x47ad67=a0_0x2abd64,_0x1788c0=_0x3eebaa&&isAdmin(_0x3eebaa[_0x47ad67(0x92)]);updateAuthSectionImmediate(_0x3eebaa,_0x1788c0);if(!_0x3eebaa){userCache['uid']=null,userCache['username']=null,userCache[_0x47ad67(0x9f)]=![],userCache['hasCheckedCollections']=![],userCache[_0x47ad67(0xa1)]=null;return;}const _0x28b935=Date['now']();if(_0x3eebaa['uid']===userCache['uid']&&userCache['hasCheckedCollections']&&_0x28b935-userCache['lastChecked']<0x493e0)return;try{userCache[_0x47ad67(0xb1)]=_0x3eebaa['uid'],userCache['lastChecked']=_0x28b935;const _0x4b1453=isAdmin(_0x3eebaa[_0x47ad67(0x92)]);userCache[_0x47ad67(0x9f)]=_0x4b1453;if(!_0x4b1453){const {isAdmin:_0x4c3231,role:_0x4c8a3c}=await checkAdminRoles(_0x3eebaa);userCache['isAdmin']=_0x4c3231,userCache['role']=_0x4c8a3c,_0x4c3231&&(document[_0x47ad67(0x86)](_0x47ad67(0xa8))['forEach'](_0x26b196=>{const _0x1ef04f=_0x47ad67;_0x26b196[_0x1ef04f(0x8e)][_0x1ef04f(0x84)]='block';}),updateAuthSectionImmediate(_0x3eebaa,!![]));}const _0x5c792c=[_0x47ad67(0xab),'playersD2','playersD3','playersDuos','playersCTF',_0x47ad67(0xa2),'userProfiles'],_0x4f1f8e=_0x5c792c[_0x47ad67(0xaf)](_0x5cc41d=>getDoc(doc(db,_0x5cc41d,_0x3eebaa['uid']))['then'](_0x298d12=>_0x298d12[_0x47ad67(0x9b)]()?{'collection':_0x5cc41d,'data':_0x298d12['data']()}:null)['catch'](()=>null)),_0x4a0184=await Promise['all'](_0x4f1f8e),_0x4e76df=_0x4a0184['filter'](_0x3beb7a=>_0x3beb7a!==null);let _0xef5acd=null;for(const _0x5d9b2c of _0x4e76df){if(_0x5d9b2c['data']['username']){_0xef5acd=_0x5d9b2c['data'][_0x47ad67(0x80)];break;}}userCache['username']=_0xef5acd||(_0x3eebaa[_0x47ad67(0x92)]?_0x3eebaa['email']['split']('@')[0x0]:_0x47ad67(0x88)),userCache[_0x47ad67(0x79)]=!![],updateAuthSectionImmediate(_0x3eebaa,userCache['isAdmin']),setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0x3eebaa['uid']);},0x1f4);}catch(_0x71f43d){console[_0x47ad67(0xa0)]('Error\x20in\x20full\x20auth\x20update:',_0x71f43d);}}document['addEventListener']('DOMContentLoaded',()=>{const _0x5f157f=a0_0x2abd64,_0x107596=getAuth();onAuthStateChanged(_0x107596,async _0x283a6f=>{await updateAuthSection(_0x283a6f),_0x283a6f&&checkPendingInvitationsForCurrentUser(_0x283a6f['uid']);}),document[_0x5f157f(0x85)]('visibilitychange',()=>{!document['hidden']&&_0x107596['currentUser']&&checkPendingInvitationsForCurrentUser(_0x107596['currentUser']['uid']);}),document['addEventListener']('click',_0x577f00=>{const _0x13d7de=_0x5f157f;_0x577f00[_0x13d7de(0x9d)]['closest'](_0x13d7de(0xa6))&&_0x107596['currentUser']&&checkPendingInvitationsForCurrentUser(_0x107596['currentUser'][_0x13d7de(0xb1)]);});});export{updateAuthSection};
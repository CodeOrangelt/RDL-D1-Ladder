const a29_0x3e9b29=(function(){let _0x299cd8=!![];return function(_0x4362d0,_0x2a2fe5){const _0x5a9373=_0x299cd8?function(){if(_0x2a2fe5){const _0x3dec84=_0x2a2fe5['apply'](_0x4362d0,arguments);return _0x2a2fe5=null,_0x3dec84;}}:function(){};return _0x299cd8=![],_0x5a9373;};}()),a29_0x109635=a29_0x3e9b29(this,function(){const _0x538655=a29_0x4271,_0x23953d=function(){const _0x6d4bca=a29_0x4271;let _0x1eb925;try{_0x1eb925=Function('return\x20(function()\x20'+_0x6d4bca(0x133)+');')();}catch(_0x1003d5){_0x1eb925=window;}return _0x1eb925;},_0xe83695=_0x23953d(),_0x56b659=_0xe83695[_0x538655(0x13c)]=_0xe83695[_0x538655(0x13c)]||{},_0x4fdd1f=['log','warn',_0x538655(0x134),_0x538655(0x13a),'exception','table',_0x538655(0x138)];for(let _0x21e12a=0x0;_0x21e12a<_0x4fdd1f[_0x538655(0x13e)];_0x21e12a++){const _0x35e886=a29_0x3e9b29['constructor']['prototype']['bind'](a29_0x3e9b29),_0x42ffd4=_0x4fdd1f[_0x21e12a],_0x2e3937=_0x56b659[_0x42ffd4]||_0x35e886;_0x35e886['__proto__']=a29_0x3e9b29['bind'](a29_0x3e9b29),_0x35e886['toString']=_0x2e3937['toString']['bind'](_0x2e3937),_0x56b659[_0x42ffd4]=_0x35e886;}});function a29_0x3433(){const _0x42d06a=['log','pow','username','data','Could\x20not\x20find\x20D3\x20player\x20documents','D3\x20Match\x20successfully\x20approved\x20and\x20ELO\x20updated','pendingMatchesD3','{}.constructor(\x22return\x20this\x22)(\x20)','info','commit','exists','position','trace','Current\x20user:','error','eloRating','console','One\x20or\x20both\x20D3\x20players\x20not\x20found','length','playersD3','MAX_SAFE_INTEGER','update'];a29_0x3433=function(){return _0x42d06a;};return a29_0x3433();}function a29_0x4271(_0x99ea36,_0x3ddf11){const _0x109635=a29_0x3433();return a29_0x4271=function(_0x3e9b29,_0x3583e4){_0x3e9b29=_0x3e9b29-0x12c;let _0x343321=_0x109635[_0x3e9b29];return _0x343321;},a29_0x4271(_0x99ea36,_0x3ddf11);}a29_0x109635();import{addDoc,updateDoc,serverTimestamp,collection,doc,getDoc,getDocs,query,where,setDoc,deleteDoc,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';import{recordEloChangeD3}from'./elo-history-d3.js';export function calculateEloD3(_0x2b2115,_0x414c5d,_0xa1e7f=0x20){const _0x491616=a29_0x4271,_0x40bbcc=0x1/(0x1+Math[_0x491616(0x12d)](0xa,(_0x414c5d-_0x2b2115)/0x190)),_0x1fd8d7=0x1/(0x1+Math[_0x491616(0x12d)](0xa,(_0x2b2115-_0x414c5d)/0x190)),_0x40b093=_0x2b2115+_0xa1e7f*(0x1-_0x40bbcc),_0x9cfd3=_0x414c5d+_0xa1e7f*(0x0-_0x1fd8d7);return{'newWinnerRating':Math['round'](_0x40b093),'newLoserRating':Math['round'](_0x9cfd3)};}export async function updateEloRatingsD3(_0x5510bc,_0x86cfe7,_0x8b75dd){const _0x26bded=a29_0x4271;try{const _0x2bb460=writeBatch(db),_0x2accca=doc(db,_0x26bded(0x13f),_0x5510bc),_0x4341ed=doc(db,'playersD3',_0x86cfe7),[_0x3361e7,_0x44d0e6]=await Promise['all']([getDoc(_0x2accca),getDoc(_0x4341ed)]);if(!_0x3361e7[_0x26bded(0x136)]()||!_0x44d0e6[_0x26bded(0x136)]())throw new Error(_0x26bded(0x13d));const _0x169f9f=_0x3361e7[_0x26bded(0x12f)](),_0x3133db=_0x44d0e6['data'](),_0x2f2f8c=_0x169f9f['position']||Number['MAX_SAFE_INTEGER'],_0xe5361a=_0x3133db[_0x26bded(0x137)]||Number[_0x26bded(0x140)],{newWinnerRating:_0x18122f,newLoserRating:_0x267ff9}=calculateEloD3(_0x169f9f['eloRating']||0x4b0,_0x3133db['eloRating']||0x4b0);let _0x3e21fd=_0x2f2f8c,_0x3c1463=_0xe5361a;if(_0x2f2f8c>_0xe5361a){console['log']('D3\x20Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked'),_0x3e21fd=_0xe5361a,_0x3c1463=_0xe5361a+0x1;const _0x572862=query(collection(db,'playersD3'),where('position','>',_0xe5361a),where(_0x26bded(0x137),'<',_0x2f2f8c)),_0x3e0c53=await getDocs(_0x572862);for(const _0x25a8c5 of _0x3e0c53['docs']){_0x25a8c5['id']!==_0x5510bc&&_0x25a8c5['id']!==_0x86cfe7&&_0x2bb460[_0x26bded(0x141)](doc(db,_0x26bded(0x13f),_0x25a8c5['id']),{'position':_0x25a8c5['data']()['position']+0x1});}}else console['log']('D3\x20Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions');return _0x2bb460['update'](_0x2accca,{'eloRating':_0x18122f,'lastMatchDate':serverTimestamp(),'position':_0x3e21fd,'lastMatchId':_0x8b75dd}),_0x2bb460[_0x26bded(0x141)](_0x4341ed,{'eloRating':_0x267ff9,'lastMatchDate':serverTimestamp(),'position':_0x3c1463,'lastMatchId':_0x8b75dd}),await _0x2bb460[_0x26bded(0x135)](),console[_0x26bded(0x12c)]('D3\x20ELO\x20ratings\x20updated\x20successfully'),await Promise['all']([recordEloChangeD3({'playerId':_0x5510bc,'previousElo':_0x169f9f['eloRating']||0x4b0,'newElo':_0x18122f,'opponentId':_0x86cfe7,'matchResult':'win','previousPosition':_0x2f2f8c,'newPosition':_0x3e21fd,'isPromotion':_0x3e21fd<_0x2f2f8c,'matchId':_0x8b75dd,'timestamp':serverTimestamp()}),recordEloChangeD3({'playerId':_0x86cfe7,'previousElo':_0x3133db[_0x26bded(0x13b)]||0x4b0,'newElo':_0x267ff9,'opponentId':_0x5510bc,'matchResult':'loss','previousPosition':_0xe5361a,'newPosition':_0x3c1463,'isDemotion':_0x3c1463>_0xe5361a,'matchId':_0x8b75dd,'timestamp':serverTimestamp()})]),!![];}catch(_0x144874){console['error']('Error\x20in\x20updateEloRatingsD3:',_0x144874);throw _0x144874;}}export async function approveReportD3(_0x2fc429,_0x48937f,_0x4401e8,_0x90cfc1){const _0x3f3046=a29_0x4271;try{console['log']('Starting\x20approveReportD3\x20function\x20with:',{'reportId':_0x2fc429,'winnerScore':_0x48937f,'winnerSuicides':_0x4401e8,'winnerComment':_0x90cfc1});const _0x131dc0=auth['currentUser'];if(!_0x131dc0){console[_0x3f3046(0x12c)]('No\x20user\x20logged\x20in');throw new Error('You\x20must\x20be\x20logged\x20in\x20to\x20approve\x20D3\x20matches');}console['log'](_0x3f3046(0x139),_0x131dc0['email']);const _0x3295f1=await getDoc(doc(db,_0x3f3046(0x13f),_0x131dc0['uid'])),_0x17ebba=_0x3295f1['exists']()?_0x3295f1[_0x3f3046(0x12f)]()[_0x3f3046(0x12e)]:null;console['log']('Current\x20username:',_0x17ebba);const _0x42fc0a=doc(db,_0x3f3046(0x132),_0x2fc429),_0x578517=await getDoc(_0x42fc0a);if(!_0x578517[_0x3f3046(0x136)]()){console[_0x3f3046(0x12c)]('D3\x20Report\x20not\x20found\x20with\x20ID:',_0x2fc429);throw new Error('D3\x20match\x20report\x20not\x20found');}const _0x15b2cd=_0x578517['data']();console['log']('D3\x20Report\x20data:',_0x15b2cd);if(_0x17ebba!==_0x15b2cd['winnerUsername'])throw new Error('Only\x20the\x20winner\x20can\x20approve\x20D3\x20matches');const _0x454c13={..._0x15b2cd,'winnerScore':_0x48937f,'winnerSuicides':_0x4401e8,'winnerComment':_0x90cfc1,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':_0x17ebba,'createdAt':_0x15b2cd['createdAt']||serverTimestamp(),'winnerUsername':_0x15b2cd['winnerUsername'],'loserUsername':_0x15b2cd['loserUsername']};await setDoc(doc(db,'approvedMatchesD3',_0x2fc429),_0x454c13),await deleteDoc(_0x42fc0a),console['log']('D3\x20Match\x20moved\x20to\x20approved\x20collection');const [_0x5896a5,_0x4e195f]=await Promise['all']([getDocs(query(collection(db,'playersD3'),where('username','==',_0x15b2cd['winnerUsername']))),getDocs(query(collection(db,'playersD3'),where('username','==',_0x15b2cd['loserUsername'])))]);if(_0x5896a5['empty']||_0x4e195f['empty'])throw new Error(_0x3f3046(0x130));const _0x5819dc=_0x5896a5['docs'][0x0]['id'],_0x422e20=_0x4e195f['docs'][0x0]['id'];return await updateEloRatingsD3(_0x5819dc,_0x422e20,_0x2fc429),console['log'](_0x3f3046(0x131)),!![];}catch(_0xedd27b){console['error']('Error\x20in\x20approveReportD3:',_0xedd27b);throw _0xedd27b;}}
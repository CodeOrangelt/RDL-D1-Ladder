function a28_0x42ac(){const _0x5b2213=['docs','warn','data','toString','One\x20or\x20both\x20D2\x20players\x20not\x20found','log','info','6PMDaWP','bind','playersD2','approvedMatchesD2','prototype','apply','search','8FIgiVF','loss','D2\x20Report\x20not\x20found\x20with\x20ID:','win','exists','createdAt','304058guEvuG','607188EaDlDH','455034XLegoT','1788966lAWMWM','3688760EbgIBt','checkAndRecordPromotion','winnerUsername','position','2018652SslOBl','uid','loserUsername','D2\x20Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions','D2\x20match\x20report\x20not\x20found','(((.+)+)+)+$','return\x20(function()\x20','No\x20user\x20logged\x20in','username','D2\x20Match\x20moved\x20to\x20approved\x20collection','pendingMatchesD2','console','update','Error\x20in\x20updateEloRatingsD2:','Current\x20username:','match-d2','constructor','D2\x20Report\x20data:','currentUser','eloRating','email','commit','Only\x20the\x20winner\x20can\x20approve\x20D2\x20matches','exception','D2\x20Match\x20successfully\x20approved\x20and\x20ELO\x20updated','length','empty','pow','all','Starting\x20approveReportD2\x20function\x20with:','D2\x20Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked','round','2473562MMmTZQ'];a28_0x42ac=function(){return _0x5b2213;};return a28_0x42ac();}(function(_0x3d25ae,_0x3432f0){const _0x21fd01=a28_0x10ec,_0x38e281=_0x3d25ae();while(!![]){try{const _0x428102=-parseInt(_0x21fd01(0xd1))/0x1*(-parseInt(_0x21fd01(0xde))/0x2)+parseInt(_0x21fd01(0xa9))/0x3+-parseInt(_0x21fd01(0xdf))/0x4+-parseInt(_0x21fd01(0xa5))/0x5+-parseInt(_0x21fd01(0xe0))/0x6+-parseInt(_0x21fd01(0xc9))/0x7*(parseInt(_0x21fd01(0xd8))/0x8)+parseInt(_0x21fd01(0xe1))/0x9;if(_0x428102===_0x3432f0)break;else _0x38e281['push'](_0x38e281['shift']());}catch(_0x5149e8){_0x38e281['push'](_0x38e281['shift']());}}}(a28_0x42ac,0x718b6));const a28_0xfccb9b=(function(){let _0x3d4d5=!![];return function(_0x3f098b,_0x8ccb3a){const _0x48b4a7=_0x3d4d5?function(){if(_0x8ccb3a){const _0x18fa9c=_0x8ccb3a['apply'](_0x3f098b,arguments);return _0x8ccb3a=null,_0x18fa9c;}}:function(){};return _0x3d4d5=![],_0x48b4a7;};}()),a28_0x5c5806=a28_0xfccb9b(this,function(){const _0x3a7fec=a28_0x10ec;return a28_0x5c5806[_0x3a7fec(0xcd)]()[_0x3a7fec(0xd7)](_0x3a7fec(0xae))[_0x3a7fec(0xcd)]()[_0x3a7fec(0xb9)](a28_0x5c5806)[_0x3a7fec(0xd7)]('(((.+)+)+)+$');});a28_0x5c5806();const a28_0x4bfc7c=(function(){let _0x6850d8=!![];return function(_0x4beb02,_0x83ba81){const _0x44a63f=_0x6850d8?function(){const _0x2e88c1=a28_0x10ec;if(_0x83ba81){const _0x1212f0=_0x83ba81[_0x2e88c1(0xd6)](_0x4beb02,arguments);return _0x83ba81=null,_0x1212f0;}}:function(){};return _0x6850d8=![],_0x44a63f;};}()),a28_0x14f547=a28_0x4bfc7c(this,function(){const _0x4011ba=a28_0x10ec;let _0x3b133b;try{const _0x351742=Function(_0x4011ba(0xaf)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x3b133b=_0x351742();}catch(_0xc67876){_0x3b133b=window;}const _0x43ab0a=_0x3b133b[_0x4011ba(0xb4)]=_0x3b133b[_0x4011ba(0xb4)]||{},_0x38a807=[_0x4011ba(0xcf),_0x4011ba(0xcb),_0x4011ba(0xd0),'error',_0x4011ba(0xc0),'table','trace'];for(let _0x1c133a=0x0;_0x1c133a<_0x38a807[_0x4011ba(0xc2)];_0x1c133a++){const _0x1f9950=a28_0x4bfc7c[_0x4011ba(0xb9)][_0x4011ba(0xd5)]['bind'](a28_0x4bfc7c),_0x2f6378=_0x38a807[_0x1c133a],_0x3528cb=_0x43ab0a[_0x2f6378]||_0x1f9950;_0x1f9950['__proto__']=a28_0x4bfc7c['bind'](a28_0x4bfc7c),_0x1f9950[_0x4011ba(0xcd)]=_0x3528cb[_0x4011ba(0xcd)][_0x4011ba(0xd2)](_0x3528cb),_0x43ab0a[_0x2f6378]=_0x1f9950;}});a28_0x14f547();import{collection,doc,getDoc,getDocs,updateDoc,setDoc,deleteDoc,writeBatch,query,where,serverTimestamp,addDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';import{recordEloChangeD2}from'./elo-history-d2.js';function a28_0x10ec(_0x41762d,_0x845666){const _0x431ba1=a28_0x42ac();return a28_0x10ec=function(_0x14f547,_0x4bfc7c){_0x14f547=_0x14f547-0xa5;let _0x2f3108=_0x431ba1[_0x14f547];return _0x2f3108;},a28_0x10ec(_0x41762d,_0x845666);}import{promotionManager}from'./promotions.js';import a28_0x1e4256 from'./firebase-idle-wrapper.js';export function calculateEloD2(_0x5c745f,_0x24866c,_0x51c3d0=0x20){const _0x1e89d6=a28_0x10ec,_0x5b82ed=0x1/(0x1+Math[_0x1e89d6(0xc4)](0xa,(_0x24866c-_0x5c745f)/0x190)),_0x2a98e2=0x1/(0x1+Math['pow'](0xa,(_0x5c745f-_0x24866c)/0x190)),_0x163fc0=_0x5c745f+_0x51c3d0*(0x1-_0x5b82ed),_0x1c6b52=_0x24866c+_0x51c3d0*(0x0-_0x2a98e2);return{'newWinnerRating':Math[_0x1e89d6(0xc8)](_0x163fc0),'newLoserRating':Math[_0x1e89d6(0xc8)](_0x1c6b52)};}export async function updateEloRatingsD2(_0x2c79e5,_0x432fa1,_0x22801e){const _0x43b2a5=a28_0x10ec;try{const _0x3844b6=writeBatch(db),_0x5ad0f5=doc(db,'playersD2',_0x2c79e5),_0x2564fe=doc(db,_0x43b2a5(0xd3),_0x432fa1),[_0x50e9c9,_0x35e0cd]=await Promise[_0x43b2a5(0xc5)]([getDoc(_0x5ad0f5),getDoc(_0x2564fe)]);if(!_0x50e9c9[_0x43b2a5(0xdc)]()||!_0x35e0cd[_0x43b2a5(0xdc)]())throw new Error(_0x43b2a5(0xce));const _0x306827=_0x50e9c9[_0x43b2a5(0xcc)](),_0x1173b0=_0x35e0cd[_0x43b2a5(0xcc)](),_0x4d0d32=_0x306827[_0x43b2a5(0xa8)]||Number['MAX_SAFE_INTEGER'],_0x247269=_0x1173b0[_0x43b2a5(0xa8)]||Number['MAX_SAFE_INTEGER'],{newWinnerRating:_0x4c1060,newLoserRating:_0x430bf6}=calculateEloD2(_0x306827[_0x43b2a5(0xbc)]||0x4b0,_0x1173b0[_0x43b2a5(0xbc)]||0x4b0);let _0x4cd3a3=_0x4d0d32,_0x1df685=_0x247269;if(_0x4d0d32>_0x247269){console[_0x43b2a5(0xcf)](_0x43b2a5(0xc7)),_0x4cd3a3=_0x247269,_0x1df685=_0x247269+0x1;const _0x4ffdfd=query(collection(db,_0x43b2a5(0xd3)),where(_0x43b2a5(0xa8),'>',_0x247269),where(_0x43b2a5(0xa8),'<',_0x4d0d32)),_0x384626=await getDocs(_0x4ffdfd);for(const _0x5749b2 of _0x384626[_0x43b2a5(0xca)]){_0x5749b2['id']!==_0x2c79e5&&_0x5749b2['id']!==_0x432fa1&&_0x3844b6[_0x43b2a5(0xb5)](doc(db,_0x43b2a5(0xd3),_0x5749b2['id']),{'position':_0x5749b2[_0x43b2a5(0xcc)]()[_0x43b2a5(0xa8)]+0x1});}}else console[_0x43b2a5(0xcf)](_0x43b2a5(0xac));return _0x3844b6[_0x43b2a5(0xb5)](_0x5ad0f5,{'eloRating':_0x4c1060,'lastMatchDate':serverTimestamp(),'position':_0x4cd3a3,'lastMatchId':_0x22801e}),_0x3844b6[_0x43b2a5(0xb5)](_0x2564fe,{'eloRating':_0x430bf6,'lastMatchDate':serverTimestamp(),'position':_0x1df685,'lastMatchId':_0x22801e}),await _0x3844b6[_0x43b2a5(0xbe)](),console[_0x43b2a5(0xcf)]('D2\x20ELO\x20ratings\x20updated\x20successfully'),await Promise[_0x43b2a5(0xc5)]([recordEloChangeD2({'playerId':_0x2c79e5,'previousElo':_0x306827[_0x43b2a5(0xbc)]||0x4b0,'newElo':_0x4c1060,'opponentId':_0x432fa1,'matchResult':_0x43b2a5(0xdb),'previousPosition':_0x4d0d32,'newPosition':_0x4cd3a3,'isPromotion':_0x4cd3a3<_0x4d0d32,'matchId':_0x22801e,'timestamp':serverTimestamp()}),recordEloChangeD2({'playerId':_0x432fa1,'previousElo':_0x1173b0[_0x43b2a5(0xbc)]||0x4b0,'newElo':_0x430bf6,'opponentId':_0x2c79e5,'matchResult':_0x43b2a5(0xd9),'previousPosition':_0x247269,'newPosition':_0x1df685,'isDemotion':_0x1df685>_0x247269,'matchId':_0x22801e,'timestamp':serverTimestamp()})]),await promotionManager['checkAndRecordPromotion'](_0x2c79e5,_0x4c1060,_0x306827[_0x43b2a5(0xbc)],{'source':_0x43b2a5(0xb8),'matchId':_0x22801e}),await promotionManager[_0x43b2a5(0xa6)](_0x432fa1,_0x430bf6,_0x1173b0[_0x43b2a5(0xbc)],{'source':_0x43b2a5(0xb8),'matchId':_0x22801e}),!![];}catch(_0x24bc10){console['error'](_0x43b2a5(0xb6),_0x24bc10);throw _0x24bc10;}}export async function approveReportD2(_0x4655b0,_0x2c4909,_0x372fd9,_0x232273){const _0x40a018=a28_0x10ec;try{console[_0x40a018(0xcf)](_0x40a018(0xc6),{'reportId':_0x4655b0,'winnerScore':_0x2c4909,'winnerSuicides':_0x372fd9,'winnerComment':_0x232273});const _0x5bf989=auth[_0x40a018(0xbb)];if(!_0x5bf989){console[_0x40a018(0xcf)](_0x40a018(0xb0));throw new Error('You\x20must\x20be\x20logged\x20in\x20to\x20approve\x20D2\x20matches');}console[_0x40a018(0xcf)]('Current\x20user:',_0x5bf989[_0x40a018(0xbd)]);const _0x58f360=await getDoc(doc(db,'playersD2',_0x5bf989[_0x40a018(0xaa)])),_0x32da20=_0x58f360[_0x40a018(0xdc)]()?_0x58f360[_0x40a018(0xcc)]()['username']:null;console['log'](_0x40a018(0xb7),_0x32da20);const _0x363a92=doc(db,_0x40a018(0xb3),_0x4655b0),_0x539c8c=await getDoc(_0x363a92);if(!_0x539c8c[_0x40a018(0xdc)]()){console['log'](_0x40a018(0xda),_0x4655b0);throw new Error(_0x40a018(0xad));}const _0x3848a6=_0x539c8c['data']();console[_0x40a018(0xcf)](_0x40a018(0xba),_0x3848a6);if(_0x32da20!==_0x3848a6['winnerUsername'])throw new Error(_0x40a018(0xbf));const _0xc501a4={..._0x3848a6,'winnerScore':_0x2c4909,'winnerSuicides':_0x372fd9,'winnerComment':_0x232273,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':_0x32da20,'createdAt':_0x3848a6[_0x40a018(0xdd)]||serverTimestamp(),'winnerUsername':_0x3848a6['winnerUsername'],'loserUsername':_0x3848a6[_0x40a018(0xab)]};await setDoc(doc(db,_0x40a018(0xd4),_0x4655b0),_0xc501a4),await deleteDoc(_0x363a92),console[_0x40a018(0xcf)](_0x40a018(0xb2));const [_0x2491f1,_0x568254]=await Promise[_0x40a018(0xc5)]([getDocs(query(collection(db,_0x40a018(0xd3)),where(_0x40a018(0xb1),'==',_0x3848a6[_0x40a018(0xa7)]))),getDocs(query(collection(db,_0x40a018(0xd3)),where(_0x40a018(0xb1),'==',_0x3848a6['loserUsername'])))]);if(_0x2491f1[_0x40a018(0xc3)]||_0x568254['empty'])throw new Error('Could\x20not\x20find\x20D2\x20player\x20documents');const _0x267ffd=_0x2491f1[_0x40a018(0xca)][0x0]['id'],_0x5fecde=_0x568254[_0x40a018(0xca)][0x0]['id'];return await updateEloRatingsD2(_0x267ffd,_0x5fecde,_0x4655b0),console[_0x40a018(0xcf)](_0x40a018(0xc1)),!![];}catch(_0x2ffecc){console['error']('Error\x20in\x20approveReportD2:',_0x2ffecc);throw _0x2ffecc;}}
const a43_0x97e432=a43_0x4413;(function(_0x3b7a18,_0x19b3fe){const _0x58f22e=a43_0x4413,_0x6400b7=_0x3b7a18();while(!![]){try{const _0x5129f8=parseInt(_0x58f22e(0x19a))/0x1*(-parseInt(_0x58f22e(0x1dc))/0x2)+parseInt(_0x58f22e(0x23c))/0x3+parseInt(_0x58f22e(0x1c3))/0x4*(parseInt(_0x58f22e(0x1e5))/0x5)+-parseInt(_0x58f22e(0x1d8))/0x6*(-parseInt(_0x58f22e(0x197))/0x7)+-parseInt(_0x58f22e(0x21c))/0x8+-parseInt(_0x58f22e(0x1c0))/0x9*(-parseInt(_0x58f22e(0x21b))/0xa)+-parseInt(_0x58f22e(0x1c1))/0xb;if(_0x5129f8===_0x19b3fe)break;else _0x6400b7['push'](_0x6400b7['shift']());}catch(_0x25b40b){_0x6400b7['push'](_0x6400b7['shift']());}}}(a43_0x1020,0x6ea99));function a43_0x4413(_0x4730ee,_0x365ae5){const _0x3dd2f0=a43_0x1020();return a43_0x4413=function(_0x277706,_0x8f270c){_0x277706=_0x277706-0x185;let _0x327c4a=_0x3dd2f0[_0x277706];return _0x327c4a;},a43_0x4413(_0x4730ee,_0x365ae5);}const a43_0x2507b0=(function(){let _0x2a7ec9=!![];return function(_0x3d7f4e,_0x4ad93b){const _0x532471=_0x2a7ec9?function(){const _0x2ead61=a43_0x4413;if(_0x4ad93b){const _0x544bf7=_0x4ad93b[_0x2ead61(0x222)](_0x3d7f4e,arguments);return _0x4ad93b=null,_0x544bf7;}}:function(){};return _0x2a7ec9=![],_0x532471;};}()),a43_0x5020c6=a43_0x2507b0(this,function(){const _0x4998fb=a43_0x4413;return a43_0x5020c6['toString']()[_0x4998fb(0x1d0)](_0x4998fb(0x1b2))[_0x4998fb(0x1bc)]()[_0x4998fb(0x220)](a43_0x5020c6)[_0x4998fb(0x1d0)](_0x4998fb(0x1b2));});a43_0x5020c6();const a43_0x8f270c=(function(){let _0x3e2ad8=!![];return function(_0x17cd74,_0x24ade1){const _0x5479b9=_0x3e2ad8?function(){if(_0x24ade1){const _0x3f3f49=_0x24ade1['apply'](_0x17cd74,arguments);return _0x24ade1=null,_0x3f3f49;}}:function(){};return _0x3e2ad8=![],_0x5479b9;};}()),a43_0x277706=a43_0x8f270c(this,function(){const _0x395647=a43_0x4413,_0x5bc424=function(){const _0x3452e3=a43_0x4413;let _0x5806b4;try{_0x5806b4=Function(_0x3452e3(0x234)+_0x3452e3(0x1d9)+');')();}catch(_0xa814b2){_0x5806b4=window;}return _0x5806b4;},_0x3c5dca=_0x5bc424(),_0x5caef3=_0x3c5dca[_0x395647(0x1bd)]=_0x3c5dca[_0x395647(0x1bd)]||{},_0x566343=['log',_0x395647(0x1af),_0x395647(0x196),_0x395647(0x1ab),_0x395647(0x18a),'table',_0x395647(0x22f)];for(let _0x440507=0x0;_0x440507<_0x566343['length'];_0x440507++){const _0x4c3ba0=a43_0x8f270c[_0x395647(0x220)][_0x395647(0x218)][_0x395647(0x1e8)](a43_0x8f270c),_0x597951=_0x566343[_0x440507],_0xd7e4c=_0x5caef3[_0x597951]||_0x4c3ba0;_0x4c3ba0['__proto__']=a43_0x8f270c[_0x395647(0x1e8)](a43_0x8f270c),_0x4c3ba0[_0x395647(0x1bc)]=_0xd7e4c['toString']['bind'](_0xd7e4c),_0x5caef3[_0x597951]=_0x4c3ba0;}});a43_0x277706();import{collection,doc,query,where,orderBy,limit,getDocs,addDoc,getDoc,serverTimestamp,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{auth,db}from'./firebase-config.js';class PromotionManager{constructor(){const _0x1ab18b=a43_0x4413;this[_0x1ab18b(0x1e4)]=0x18,this['RANKS']=[{'threshold':0x578,'name':'Bronze','color':_0x1ab18b(0x1d2)},{'threshold':0x640,'name':_0x1ab18b(0x1ca),'color':_0x1ab18b(0x18d)},{'threshold':0x708,'name':'Gold','color':_0x1ab18b(0x1a8)},{'threshold':0x834,'name':_0x1ab18b(0x212),'color':_0x1ab18b(0x1d7)}],this[_0x1ab18b(0x225)]=null,this['lastFetchTime']=0x0,this[_0x1ab18b(0x185)]=0xea60,this[_0x1ab18b(0x213)]=null,this[_0x1ab18b(0x20e)]={};}[a43_0x97e432(0x1e7)](){const _0xdbd164=a43_0x97e432;this[_0xdbd164(0x225)]=document[_0xdbd164(0x229)](_0xdbd164(0x1db));if(!this['bannerContainer']){console['error'](_0xdbd164(0x1d6));return;}this[_0xdbd164(0x206)]();const _0x566cd2=_0xdbd164(0x1c8)+new Date()['toDateString'](),_0x3e0310=sessionStorage[_0xdbd164(0x1e0)](_0x566cd2);!_0x3e0310&&(this[_0xdbd164(0x1e9)](),sessionStorage[_0xdbd164(0x1a9)](_0x566cd2,_0xdbd164(0x230))),document['addEventListener'](_0xdbd164(0x19f),()=>{const _0x3cdd65=_0xdbd164;document['visibilityState']===_0x3cdd65(0x1c7)&&!sessionStorage[_0x3cdd65(0x1e0)](_0x566cd2)&&(this[_0x3cdd65(0x1e9)](),sessionStorage[_0x3cdd65(0x1a9)](_0x566cd2,'true'));}),window[_0xdbd164(0x1a1)](_0xdbd164(0x199),()=>{const _0x464b7c=_0xdbd164;this['pollingInterval']&&clearInterval(this[_0x464b7c(0x213)]);});}[a43_0x97e432(0x206)](){const _0x524fc4=a43_0x97e432;this[_0x524fc4(0x225)][_0x524fc4(0x239)]='',this[_0x524fc4(0x225)][_0x524fc4(0x1ac)][_0x524fc4(0x205)]=_0x524fc4(0x1f3);}async[a43_0x97e432(0x1e9)](){const _0x2f4f3b=a43_0x97e432;try{const _0x24b7bf=Date[_0x2f4f3b(0x1e6)]();if(_0x24b7bf-this['lastFetchTime']<this[_0x2f4f3b(0x185)])return;this[_0x2f4f3b(0x189)]=_0x24b7bf;const _0x2c0424=collection(db,_0x2f4f3b(0x1fa)),_0x306461=query(_0x2c0424,where(_0x2f4f3b(0x1ec),'in',[_0x2f4f3b(0x1f9),_0x2f4f3b(0x190)]),orderBy(_0x2f4f3b(0x1a2),'desc'),limit(0x14)),_0x3ead43=await getDocs(_0x306461),_0x35f392=[];_0x3ead43['forEach'](_0x407807=>{const _0x281fb0=_0x2f4f3b,_0x316952={'id':_0x407807['id'],..._0x407807[_0x281fb0(0x1ae)]()};this['shouldShowPromotion'](_0x407807['id'])&&this[_0x281fb0(0x1ea)](_0x316952)&&_0x35f392[_0x281fb0(0x232)](_0x316952);}),_0x35f392[_0x2f4f3b(0x1a5)]>0x0&&await this[_0x2f4f3b(0x19c)](_0x35f392);}catch(_0x27ee1c){console[_0x2f4f3b(0x1ab)](_0x2f4f3b(0x21d),_0x27ee1c);}}async['processRankChanges'](_0x280fee){const _0x3db427=a43_0x97e432;if(_0x280fee[_0x3db427(0x1a5)]===0x0)return;_0x280fee[_0x3db427(0x1cd)]((_0x597f46,_0x2585e9)=>{const _0x229096=_0x3db427,_0x5dfcc=_0x597f46['timestamp']?.[_0x229096(0x1ed)]?.()||_0x597f46[_0x229096(0x1a2)]?.['seconds']*0x3e8||0x0,_0x320fdd=_0x2585e9[_0x229096(0x1a2)]?.[_0x229096(0x1ed)]?.()||_0x2585e9[_0x229096(0x1a2)]?.[_0x229096(0x22c)]*0x3e8||0x0;return _0x320fdd-_0x5dfcc;});const _0x58c3c6=this[_0x3db427(0x225)][_0x3db427(0x188)][_0x3db427(0x1a5)],_0x35b11e=0x3-_0x58c3c6;if(_0x35b11e<=0x0)return;const _0x33fa21=_0x280fee[_0x3db427(0x238)](0x0,_0x35b11e);for(let _0x270a85=0x0;_0x270a85<_0x33fa21['length'];_0x270a85++){const _0x3ef680=_0x33fa21[_0x270a85],_0x55f334=auth[_0x3db427(0x20b)];try{setTimeout(()=>{const _0x492dae=_0x3db427;this[_0x492dae(0x236)](_0x3ef680);},_0x270a85*0x3e8),_0x55f334&&_0x3ef680[_0x3db427(0x1f5)]===_0x55f334['displayName']&&this[_0x3db427(0x203)](_0x3ef680[_0x3db427(0x1ec)],_0x3ef680[_0x3db427(0x1c2)]);}catch(_0x44d514){console[_0x3db427(0x1ab)]('Error\x20processing\x20rank\x20change:',_0x44d514);}}}[a43_0x97e432(0x1cc)](_0x32480d){const _0x2c78aa=a43_0x97e432;try{const _0x1157ba='promotion_'+_0x32480d,_0x2cc43e=localStorage[_0x2c78aa(0x1e0)](_0x1157ba);if(_0x2cc43e){let _0x217c25;try{_0x217c25=JSON[_0x2c78aa(0x22a)](_0x2cc43e);}catch(_0x35a757){return console[_0x2c78aa(0x1af)]('Invalid\x20storage\x20format\x20for\x20'+_0x1157ba+_0x2c78aa(0x204)),!![];}if(_0x217c25[_0x2c78aa(0x1eb)]===!![])return console[_0x2c78aa(0x1e1)](_0x2c78aa(0x192)+_0x32480d+'\x20is\x20permanently\x20ignored'),![];const _0x55cf4c=Date[_0x2c78aa(0x1e6)]();if(_0x217c25[_0x2c78aa(0x20f)]&&_0x55cf4c-_0x217c25[_0x2c78aa(0x1a2)]<this['DISPLAY_HOURS']*0x3c*0x3c*0x3e8)return console[_0x2c78aa(0x1e1)](_0x2c78aa(0x192)+_0x32480d+'\x20was\x20dismissed\x20by\x20user\x20within\x20last\x20'+this[_0x2c78aa(0x1e4)]+'\x20hours'),![];if(_0x217c25[_0x2c78aa(0x1b8)]&&_0x55cf4c-_0x217c25[_0x2c78aa(0x1a2)]<0x4*0x3c*0x3c*0x3e8)return console[_0x2c78aa(0x1e1)](_0x2c78aa(0x192)+_0x32480d+'\x20was\x20auto-dismissed\x20within\x20last\x204\x20hours'),![];}return!![];}catch(_0x3b44b0){return console[_0x2c78aa(0x1ab)](_0x2c78aa(0x217),_0x3b44b0),![];}}['ignorePromotion'](_0x302fdc){const _0x136881=a43_0x97e432;try{const _0x5077b3=_0x136881(0x19e)+_0x302fdc;localStorage[_0x136881(0x1a9)](_0x5077b3,JSON[_0x136881(0x1e3)]({'timestamp':Date[_0x136881(0x1e6)](),'ignored':!![]}));}catch(_0x4ae27d){console[_0x136881(0x1ab)]('Error\x20saving\x20promotion\x20preference:',_0x4ae27d);}}[a43_0x97e432(0x236)](_0x1468e6){this['resolveUserId'](_0x1468e6)['then'](_0x3387f7=>{const _0x5635c1=a43_0x4413,_0x485e7d='promotion_'+_0x1468e6['id'],_0x5aada2=localStorage[_0x5635c1(0x1e0)](_0x485e7d);if(_0x5aada2)try{const _0x1f6279=JSON['parse'](_0x5aada2);if(_0x1f6279[_0x5635c1(0x1eb)]===!![]){console['log'](_0x5635c1(0x1a0)+_0x1468e6['id']);return;}}catch(_0x4b75f3){}localStorage[_0x5635c1(0x1a9)](_0x485e7d,JSON[_0x5635c1(0x1e3)]({'timestamp':Date[_0x5635c1(0x1e6)](),'ignored':![],'userDismissed':![],'systemDismissed':![],'seenAt':Date[_0x5635c1(0x1e6)]()})),this['bannerContainer'][_0x5635c1(0x1ac)][_0x5635c1(0x205)]=_0x5635c1(0x1b0);while(this[_0x5635c1(0x225)][_0x5635c1(0x188)][_0x5635c1(0x1a5)]>=0x3){this[_0x5635c1(0x225)][_0x5635c1(0x20c)](this[_0x5635c1(0x225)][_0x5635c1(0x1e2)]);}const _0x507af6=document[_0x5635c1(0x1f0)]('div');_0x507af6[_0x5635c1(0x198)]=_0x5635c1(0x233),_0x507af6['setAttribute']('data-rank',_0x3387f7[_0x5635c1(0x1c2)]),_0x507af6[_0x5635c1(0x1b5)](_0x5635c1(0x193),_0x3387f7['id']);const _0x427d34=document[_0x5635c1(0x1f0)](_0x5635c1(0x195));_0x427d34[_0x5635c1(0x198)]='promotion-details';const _0x418d68=_0x3387f7['resolvedName']||_0x3387f7[_0x5635c1(0x1f5)]||_0x3387f7['username']||_0x3387f7['playerUsername']||_0x3387f7[_0x5635c1(0x1bf)]||'A\x20player',_0x53f0c7=_0x3387f7[_0x5635c1(0x1ec)]===_0x5635c1(0x1f9)?_0x418d68+_0x5635c1(0x202):_0x418d68+'\x20was\x20demoted\x20to';_0x427d34[_0x5635c1(0x239)]=_0x53f0c7+_0x5635c1(0x1b4)+_0x3387f7[_0x5635c1(0x1c2)]+_0x5635c1(0x1b7);const _0x3bbc0d=document[_0x5635c1(0x1f0)]('div');_0x3bbc0d[_0x5635c1(0x198)]=_0x5635c1(0x1a3);const _0x48795b=document[_0x5635c1(0x1f0)](_0x5635c1(0x221));_0x48795b[_0x5635c1(0x198)]=_0x5635c1(0x214),_0x48795b[_0x5635c1(0x239)]='&times;',_0x48795b[_0x5635c1(0x1a6)]=_0x5635c1(0x209);const _0x297419=document[_0x5635c1(0x1f0)]('button');_0x297419[_0x5635c1(0x198)]=_0x5635c1(0x201),_0x297419[_0x5635c1(0x21a)]='Don\x27t\x20show\x20again',_0x297419[_0x5635c1(0x1a6)]='Never\x20show\x20this\x20promotion\x20again',_0x3bbc0d[_0x5635c1(0x237)](_0x297419),_0x3bbc0d[_0x5635c1(0x237)](_0x48795b),_0x507af6['appendChild'](_0x427d34),_0x507af6[_0x5635c1(0x237)](_0x3bbc0d),this[_0x5635c1(0x225)][_0x5635c1(0x237)](_0x507af6),void _0x507af6[_0x5635c1(0x1fd)],setTimeout(()=>{const _0x3f29ec=_0x5635c1;_0x507af6[_0x3f29ec(0x1dd)][_0x3f29ec(0x1fc)](_0x3f29ec(0x200));},0x32),_0x48795b['addEventListener'](_0x5635c1(0x216),()=>{const _0x2126c9=_0x5635c1;localStorage['setItem'](_0x485e7d,JSON[_0x2126c9(0x1e3)]({'timestamp':Date[_0x2126c9(0x1e6)](),'ignored':![],'userDismissed':!![],'systemDismissed':![]})),_0x507af6[_0x2126c9(0x1dd)]['remove'](_0x2126c9(0x200)),_0x507af6[_0x2126c9(0x1dd)][_0x2126c9(0x1fc)](_0x2126c9(0x21f)),setTimeout(()=>{const _0x4e3c91=_0x2126c9;_0x507af6[_0x4e3c91(0x21e)]&&(_0x507af6[_0x4e3c91(0x1cf)](),this[_0x4e3c91(0x225)][_0x4e3c91(0x188)][_0x4e3c91(0x1a5)]===0x0&&(this[_0x4e3c91(0x225)][_0x4e3c91(0x1ac)]['display']=_0x4e3c91(0x1f3)));},0x1f4);}),_0x297419[_0x5635c1(0x1a1)]('click',()=>{const _0x15c134=_0x5635c1;localStorage[_0x15c134(0x1a9)](_0x485e7d,JSON[_0x15c134(0x1e3)]({'timestamp':Date[_0x15c134(0x1e6)](),'ignored':!![],'userDismissed':!![],'systemDismissed':![]})),_0x507af6['classList'][_0x15c134(0x1cf)]('new-rank-change'),_0x507af6[_0x15c134(0x1dd)][_0x15c134(0x1fc)](_0x15c134(0x21f)),setTimeout(()=>{const _0x39890e=_0x15c134;_0x507af6[_0x39890e(0x21e)]&&(_0x507af6[_0x39890e(0x1cf)](),this[_0x39890e(0x225)][_0x39890e(0x188)][_0x39890e(0x1a5)]===0x0&&(this[_0x39890e(0x225)]['style'][_0x39890e(0x205)]=_0x39890e(0x1f3)));},0x1f4);}),setTimeout(()=>{const _0x973b14=_0x5635c1;_0x507af6['parentNode']&&(_0x507af6['classList'][_0x973b14(0x1cf)](_0x973b14(0x200)),_0x507af6['classList'][_0x973b14(0x1fc)](_0x973b14(0x21f)),localStorage[_0x973b14(0x1a9)](_0x485e7d,JSON[_0x973b14(0x1e3)]({'timestamp':Date[_0x973b14(0x1e6)](),'ignored':![],'userDismissed':![],'systemDismissed':!![]})),setTimeout(()=>{const _0x543583=_0x973b14;_0x507af6[_0x543583(0x21e)]&&(_0x507af6[_0x543583(0x1cf)](),this[_0x543583(0x225)][_0x543583(0x188)]['length']===0x0&&(this[_0x543583(0x225)][_0x543583(0x1ac)]['display']='none'));},0x1f4));},0x3a98);});}async[a43_0x97e432(0x18c)](_0x586215){const _0x19ad7e=a43_0x97e432,_0x213138={..._0x586215},_0x59ff62=[_0x586215[_0x19ad7e(0x1f5)],_0x586215['username'],_0x586215[_0x19ad7e(0x231)],_0x586215[_0x19ad7e(0x1bf)]],_0x41b352=_0x59ff62[_0x19ad7e(0x1d1)](_0x4b1ed3=>_0x4b1ed3&&typeof _0x4b1ed3==='string'&&!_0x4b1ed3[_0x19ad7e(0x1b3)]('ID:')&&!/^[a-zA-Z0-9]{20,}$/[_0x19ad7e(0x1c6)](_0x4b1ed3));if(_0x41b352)return _0x213138;let _0x4f16b5=null;if(_0x586215['userId'])_0x4f16b5=_0x586215['userId'];else _0x586215[_0x19ad7e(0x1f5)]&&/^[A-Za-z0-9]{20,}$/['test'](_0x586215['player'])&&(_0x4f16b5=_0x586215[_0x19ad7e(0x1f5)]);if(!_0x4f16b5)return _0x213138;try{const _0x2c871b=await getDoc(doc(db,_0x19ad7e(0x22d),_0x4f16b5));if(_0x2c871b[_0x19ad7e(0x19b)]()){const _0x42357e=_0x2c871b['data']();if(_0x42357e[_0x19ad7e(0x1f2)])return _0x213138[_0x19ad7e(0x1b6)]=_0x42357e[_0x19ad7e(0x1f2)],_0x213138;}const _0x2bf1f8=await getDocs(query(collection(db,'approvedMatches'),where(_0x19ad7e(0x20a),'==',_0x4f16b5),orderBy('date',_0x19ad7e(0x211)),limit(0x1)));if(!_0x2bf1f8[_0x19ad7e(0x186)]){const _0x469197=_0x2bf1f8[_0x19ad7e(0x1fe)][0x0][_0x19ad7e(0x1ae)]();if(_0x469197[_0x19ad7e(0x1d4)])return _0x213138[_0x19ad7e(0x1b6)]=_0x469197[_0x19ad7e(0x1d4)],_0x213138;}const _0x155665=await getDocs(query(collection(db,_0x19ad7e(0x1a7)),where(_0x19ad7e(0x1bb),'==',_0x4f16b5),orderBy('date',_0x19ad7e(0x211)),limit(0x1)));if(!_0x155665[_0x19ad7e(0x186)]){const _0x279ac7=_0x155665[_0x19ad7e(0x1fe)][0x0][_0x19ad7e(0x1ae)]();if(_0x279ac7[_0x19ad7e(0x1be)])return _0x213138['resolvedName']=_0x279ac7['loserUsername'],console[_0x19ad7e(0x1e1)](_0x19ad7e(0x1c5)+_0x4f16b5+_0x19ad7e(0x235)+_0x279ac7[_0x19ad7e(0x1be)]+_0x19ad7e(0x1d3)),_0x213138;}}catch(_0x78fd7b){console[_0x19ad7e(0x1ab)](_0x19ad7e(0x1f8),_0x78fd7b);}return console[_0x19ad7e(0x1af)](_0x19ad7e(0x1b1)+_0x4f16b5),_0x213138;}['showRankChangeLightbox'](_0xb01d41,_0x5e2994){const _0x184641=a43_0x97e432;let _0x3e2850=document[_0x184641(0x229)](_0x184641(0x207));!_0x3e2850&&(_0x3e2850=document[_0x184641(0x1f0)](_0x184641(0x195)),_0x3e2850['id']='rankChangeModal',_0x3e2850[_0x184641(0x198)]=_0x184641(0x191)+_0xb01d41,document['body']['appendChild'](_0x3e2850));const _0xbb9fa2=_0xb01d41===_0x184641(0x1f9)?'Congratulations!':'Rank\x20Update',_0x31e91b=_0xb01d41===_0x184641(0x1f9)?_0x184641(0x1ee):_0x184641(0x18f);_0x3e2850[_0x184641(0x239)]=_0x184641(0x23b)+_0xbb9fa2+_0x184641(0x18e)+_0x31e91b+_0x184641(0x1de)+_0x5e2994+'</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22rank-change-button\x22\x20id=\x22rank-change-ok-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Got\x20it!\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x3e2850['style']['display']=_0x184641(0x215),document[_0x184641(0x229)](_0x184641(0x1f6))['addEventListener']('click',()=>{const _0x1bb337=_0x184641;_0x3e2850[_0x1bb337(0x1ac)]['display']=_0x1bb337(0x1f3);}),_0x3e2850[_0x184641(0x1a1)](_0x184641(0x216),_0x3b97b6=>{const _0x1e4f99=_0x184641;_0x3b97b6[_0x1e4f99(0x1ff)]===_0x3e2850&&(_0x3e2850[_0x1e4f99(0x1ac)][_0x1e4f99(0x205)]=_0x1e4f99(0x1f3));});}async['checkAndRecordPromotion'](_0x1aa83a,_0xbd0021,_0x133a6d,_0x5656b4={}){const _0x4e6dd5=a43_0x97e432;try{if(_0xbd0021===_0x133a6d||!_0x1aa83a)return null;const _0x1853f4=_0x5656b4['source']||_0x4e6dd5(0x224),_0x418a68=_0x5656b4['matchId']||null,_0x17449e=_0x5656b4['adminUser']||null;console['log'](_0x4e6dd5(0x1df)+_0x133a6d+_0x4e6dd5(0x1b9)+_0xbd0021+'\x20(source:\x20'+_0x1853f4+')');let _0x305ec5=null,_0x3da6ac=null;try{const _0x281880=await getDoc(doc(db,_0x4e6dd5(0x22d),_0x1aa83a));if(_0x281880[_0x4e6dd5(0x19b)]()){const _0x3134c8=_0x281880[_0x4e6dd5(0x1ae)]();_0x305ec5=_0x3134c8[_0x4e6dd5(0x1f2)]||_0x3134c8[_0x4e6dd5(0x1bf)]||null,_0x3da6ac=_0x3134c8['displayName']||_0x3134c8['username']||null;}!_0x305ec5&&_0x5656b4[_0x4e6dd5(0x1f2)]&&(_0x305ec5=_0x5656b4[_0x4e6dd5(0x1f2)],_0x3da6ac=_0x5656b4[_0x4e6dd5(0x1f2)]);!_0x305ec5&&auth[_0x4e6dd5(0x20b)]&&(_0x305ec5=auth[_0x4e6dd5(0x20b)]['displayName']||auth['currentUser'][_0x4e6dd5(0x223)]['split']('@')[0x0],_0x3da6ac=auth[_0x4e6dd5(0x20b)][_0x4e6dd5(0x1bf)]||null);if(!_0x305ec5){const _0x66e4d4=query(collection(db,_0x4e6dd5(0x1a7)),where('winnerId','==',_0x1aa83a),limit(0x1)),_0x56b74d=await getDocs(_0x66e4d4);if(!_0x56b74d['empty'])_0x305ec5=_0x56b74d[_0x4e6dd5(0x1fe)][0x0][_0x4e6dd5(0x1ae)]()[_0x4e6dd5(0x1d4)]||_0x4e6dd5(0x1ad),_0x3da6ac=_0x305ec5;else{const _0x4e6fab=query(collection(db,_0x4e6dd5(0x1a7)),where(_0x4e6dd5(0x1bb),'==',_0x1aa83a),limit(0x1)),_0x46403d=await getDocs(_0x4e6fab);!_0x46403d[_0x4e6dd5(0x186)]&&(_0x305ec5=_0x46403d[0x0]['data']()[_0x4e6dd5(0x1be)]||'Unknown\x20Player',_0x3da6ac=_0x305ec5);}}}catch(_0x2600cf){console[_0x4e6dd5(0x1ab)](_0x4e6dd5(0x22e),_0x2600cf);}!_0x305ec5&&(console['warn'](_0x4e6dd5(0x1fb),_0x1aa83a),_0x305ec5=_0x4e6dd5(0x227),_0x3da6ac=_0x4e6dd5(0x1ad));const _0x4c71c8=this[_0x4e6dd5(0x194)](_0x133a6d),_0x59aed9=this[_0x4e6dd5(0x194)](_0xbd0021);if(_0x4c71c8!==_0x59aed9){const _0x11c7c0=_0xbd0021>_0x133a6d,_0x2e8c97=_0x11c7c0?_0x4e6dd5(0x1f9):_0x4e6dd5(0x190),_0x1aca4b=_0x59aed9;console['log'](_0x4e6dd5(0x226)+_0x2e8c97+'\x20for\x20'+_0x305ec5+':\x20'+_0x133a6d+'\x20('+_0x4c71c8+_0x4e6dd5(0x208)+_0xbd0021+'\x20('+_0x59aed9+')');try{const _0xe9a972={'player':_0x305ec5,'playerUsername':_0x305ec5,'username':_0x305ec5,'displayName':_0x3da6ac,'userId':_0x1aa83a,'type':_0x2e8c97,'rankAchieved':_0x1aca4b,'timestamp':serverTimestamp(),'previousElo':_0x133a6d,'newElo':_0xbd0021,'change':_0xbd0021-_0x133a6d,'previousRank':_0x4c71c8,'newRank':_0x59aed9,'source':_0x1853f4};if(_0x1853f4===_0x4e6dd5(0x1ce)&&_0x418a68)_0xe9a972[_0x4e6dd5(0x1da)]=_0x418a68;else _0x1853f4===_0x4e6dd5(0x1f7)&&_0x17449e?(_0xe9a972['modifiedBy']=_0x17449e,_0xe9a972['isAutomatic']=![]):_0xe9a972[_0x4e6dd5(0x23a)]=!![];const _0x46374f=writeBatch(db),_0x4bbe49=doc(collection(db,_0x4e6dd5(0x1fa))),_0x19ecc2=doc(collection(db,_0x4e6dd5(0x18b)));return _0x46374f[_0x4e6dd5(0x1f4)](_0x4bbe49,_0xe9a972),_0x46374f[_0x4e6dd5(0x1f4)](_0x19ecc2,_0xe9a972),await _0x46374f['commit'](),await this[_0x4e6dd5(0x1c9)](_0x1aa83a,_0x305ec5,_0x133a6d,_0xbd0021,_0x4c71c8,_0x59aed9,_0x2e8c97,{'displayName':_0x3da6ac,'source':_0x1853f4,'matchId':_0x418a68,'ladder':_0x5656b4['ladder']||'D1'}),console[_0x4e6dd5(0x1e1)](_0x4e6dd5(0x228)+_0x2e8c97+_0x4e6dd5(0x219)+_0x305ec5+_0x4e6dd5(0x235)+_0x1aca4b),_0x1aca4b;}catch(_0xa6f799){console['error'](_0x4e6dd5(0x1ef),_0xa6f799);try{return await addDoc(collection(db,'eloHistory'),{'player':_0x305ec5,'playerUsername':_0x305ec5,'username':_0x305ec5,'displayName':_0x3da6ac,'userId':_0x1aa83a,'type':_0x2e8c97,'rankAchieved':_0x1aca4b,'timestamp':serverTimestamp(),'previousElo':_0x133a6d,'newElo':_0xbd0021,'change':_0xbd0021-_0x133a6d,'previousRank':_0x4c71c8,'source':_0x1853f4,'isAutomatic':_0x1853f4!=='admin'}),await this['sendPromotionNotification'](_0x1aa83a,_0x305ec5,_0x133a6d,_0xbd0021,_0x4c71c8,_0x59aed9,_0x2e8c97,{'displayName':_0x3da6ac,'source':_0x1853f4,'matchId':_0x418a68,'ladder':_0x5656b4[_0x4e6dd5(0x20d)]||'D1'}),_0x1aca4b;}catch(_0x3c43d0){return console[_0x4e6dd5(0x1ab)]('Fallback\x20write\x20failed:',_0x3c43d0),null;}}}return null;}catch(_0xda7115){return console[_0x4e6dd5(0x1ab)](_0x4e6dd5(0x22b),_0xda7115),null;}}[a43_0x97e432(0x194)](_0xe9c364){const _0x19f2cd=a43_0x97e432;for(let _0xfa028e=this['RANKS'][_0x19f2cd(0x1a5)]-0x1;_0xfa028e>=0x0;_0xfa028e--){if(_0xe9c364>=this['RANKS'][_0xfa028e][_0x19f2cd(0x19d)])return this['RANKS'][_0xfa028e]['name'];}return'Unranked';}[a43_0x97e432(0x1a4)](){const _0x447a45=a43_0x97e432;this[_0x447a45(0x213)]&&clearInterval(this[_0x447a45(0x213)]);}['isNewRankChange'](_0xc8a229){const _0x4af9d5=a43_0x97e432;if(_0xc8a229['timestamp']){const _0xe05927=_0xc8a229[_0x4af9d5(0x1a2)][_0x4af9d5(0x22c)]*0x3e8,_0x1fd08c=Date[_0x4af9d5(0x1e6)](),_0x7af0bf=(_0x1fd08c-_0xe05927)/(0x3e8*0x3c*0x3c);if(_0x7af0bf>0x18)return![];}if(_0xc8a229['previousRank']&&_0xc8a229[_0x4af9d5(0x1f1)]&&_0xc8a229['previousRank']!==_0xc8a229[_0x4af9d5(0x1f1)])return!![];return![];}async[a43_0x97e432(0x1c9)](_0x1d3fad,_0x3754e5,_0x259947,_0x259519,_0x1a1be3,_0x275439,_0x2dd3b6,_0x532061={}){const _0x18e91f=a43_0x97e432;try{console[_0x18e91f(0x1e1)](_0x18e91f(0x1cb)+_0x3754e5+_0x18e91f(0x1ba)+_0x2dd3b6);const _0x4177b6={'userId':_0x1d3fad,'username':_0x3754e5,'displayName':_0x532061['displayName']||_0x3754e5,'oldElo':parseInt(_0x259947),'newElo':parseInt(_0x259519),'eloDifference':parseInt(_0x259519)-parseInt(_0x259947),'oldRank':_0x1a1be3,'newRank':_0x275439,'type':_0x2dd3b6,'timestamp':serverTimestamp(),'processed':![],'source':_0x532061[_0x18e91f(0x1d5)]||_0x18e91f(0x224),'matchId':_0x532061[_0x18e91f(0x1da)]||null,'ladder':_0x532061[_0x18e91f(0x20d)]||'D1','adminUser':_0x532061['adminUser']||null};console[_0x18e91f(0x1e1)]('Creating\x20Discord\x20notification:',_0x4177b6);const _0x3d60ee=await addDoc(collection(db,_0x18e91f(0x1aa)),_0x4177b6);return console[_0x18e91f(0x1e1)]('Discord\x20notification\x20sent\x20successfully\x20with\x20ID:\x20'+_0x3d60ee['id']),!![];}catch(_0x32ad5d){return console[_0x18e91f(0x1ab)](_0x18e91f(0x210),_0x32ad5d),![];}}}export const promotionManager=new PromotionManager();document[a43_0x97e432(0x1a1)](a43_0x97e432(0x187),()=>{const _0x487918=a43_0x97e432;promotionManager[_0x487918(0x1e7)]();});function a43_0x1020(){const _0x558d47=['Promotion\x20banner\x20container\x20not\x20found','#50C878','1816878scNDZd','{}.constructor(\x22return\x20this\x22)(\x20)','matchId','promotion-banner-container','4FIZsOS','classList','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22rank-name\x22>','Processing\x20potential\x20rank\x20change:\x20','getItem','log','firstChild','stringify','DISPLAY_HOURS','15IuGWEH','now','initialize','bind','fetchRecentPromotions','isNewRankChange','ignored','type','toMillis','You\x27ve\x20been\x20promoted\x20to','Error\x20writing\x20promotion\x20records:','createElement','newRank','username','none','set','player','rank-change-ok-btn','admin','Error\x20resolving\x20user\x20ID:','promotion','eloHistory','Could\x20not\x20resolve\x20username\x20for\x20userId:','add','offsetWidth','docs','target','new-rank-change','ignore-btn','\x20was\x20promoted\x20to','showRankChangeLightbox',',\x20treating\x20as\x20new','display','setupBannerContainer','rankChangeModal',')\x20→\x20','Dismiss','winnerId','currentUser','removeChild','ladder','usernameCache','userDismissed','Error\x20sending\x20Discord\x20notification:','desc','Emerald','pollingInterval','dismiss-btn','flex','click','Error\x20checking\x20promotion\x20visibility:','prototype','\x20for\x20','textContent','10EHwlOF','3222312vIzvor','Error\x20fetching\x20promotions:','parentNode','dismissing','constructor','button','apply','email','automatic','bannerContainer','Recording\x20','A\x20player','Successfully\x20recorded\x20','getElementById','parse','Error\x20in\x20promotion/demotion\x20recording:','seconds','players','Error\x20resolving\x20username:','trace','true','playerUsername','push','promotion-banner','return\x20(function()\x20','\x20to\x20','showRankChangeBanner','appendChild','slice','innerHTML','isAutomatic','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rank-change-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2\x20class=\x22rank-change-title\x22>','1350207VettFp','fetchInterval','empty','DOMContentLoaded','children','lastFetchTime','exception','promotionHistory','resolveUserId','#C0C0C0','</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>','You\x27ve\x20been\x20demoted\x20to','demotion','rank-change-modal\x20','Promotion\x20','data-id','getRankName','div','info','14NJTNwq','className','beforeunload','407041uabcJV','exists','processRankChanges','threshold','promotion_','visibilitychange','Skipping\x20ignored\x20promotion:\x20','addEventListener','timestamp','banner-actions','cleanup','length','title','approvedMatches','#FFD700','setItem','promotionNotifications','error','style','Unknown\x20Player','data','warn','block','Failed\x20to\x20resolve\x20user\x20ID:\x20','(((.+)+)+)+$','includes','\x20<span\x20class=\x22rank-text\x22>','setAttribute','resolvedName','</span>','systemDismissed','\x20→\x20','\x27s\x20','loserId','toString','console','loserUsername','displayName','3005361oSExDv','5563514gTguUB','rankAchieved','1048392NjNfYo','checkAndRecordPromotion','Resolved\x20','test','visible','promotions_checked_','sendPromotionNotification','Silver','STARTING\x20notification\x20for\x20','shouldShowPromotion','sort','match','remove','search','some','#CD7F32','\x20(loser)','winnerUsername','source'];a43_0x1020=function(){return _0x558d47;};return a43_0x1020();}export const initializePromotionTracker=()=>promotionManager[a43_0x97e432(0x1e7)]();export const checkAndRecordPromotion=(_0x3de0c7,_0x23073d,_0xecd8e8,_0x30462c)=>promotionManager[a43_0x97e432(0x1c4)](_0x3de0c7,_0x23073d,_0xecd8e8,_0x30462c);export const getRankName=_0x36d1c4=>promotionManager[a43_0x97e432(0x194)](_0x36d1c4);
const a14_0x5eb66c=a14_0x477e,a14_0x42948f=(function(){let _0x5d73e3=!![];return function(_0x300d18,_0x3f60a7){const _0x5ccb6e=_0x5d73e3?function(){if(_0x3f60a7){const _0x27bbd0=_0x3f60a7['apply'](_0x300d18,arguments);return _0x3f60a7=null,_0x27bbd0;}}:function(){};return _0x5d73e3=![],_0x5ccb6e;};}()),a14_0x4a9ac7=a14_0x42948f(this,function(){const _0x4a607e=a14_0x477e,_0xb0aeeb=function(){let _0x41fef9;try{_0x41fef9=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x347760){_0x41fef9=window;}return _0x41fef9;},_0x21f8b2=_0xb0aeeb(),_0x4ff44d=_0x21f8b2['console']=_0x21f8b2['console']||{},_0x267f0c=['log','warn','info','error','exception','table',_0x4a607e(0x1e9)];for(let _0x3012eb=0x0;_0x3012eb<_0x267f0c['length'];_0x3012eb++){const _0x375b9e=a14_0x42948f['constructor'][_0x4a607e(0x1e3)][_0x4a607e(0x1ee)](a14_0x42948f),_0x303202=_0x267f0c[_0x3012eb],_0x429827=_0x4ff44d[_0x303202]||_0x375b9e;_0x375b9e['__proto__']=a14_0x42948f[_0x4a607e(0x1ee)](a14_0x42948f),_0x375b9e['toString']=_0x429827['toString']['bind'](_0x429827),_0x4ff44d[_0x303202]=_0x375b9e;}});a14_0x4a9ac7();function a14_0x477e(_0x34e064,_0x1d0446){const _0x4a9ac7=a14_0x35ec();return a14_0x477e=function(_0x42948f,_0x442c06){_0x42948f=_0x42948f-0x1e1;let _0x35ecdc=_0x4a9ac7[_0x42948f];return _0x35ecdc;},a14_0x477e(_0x34e064,_0x1d0446);}import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D2=[{'name':'Gold','elo':0x708},{'name':'Silver','elo':0x640},{'name':a14_0x5eb66c(0x1e5),'elo':0x578},{'name':a14_0x5eb66c(0x1e7),'elo':0x4b0}];let lastVisibleD2=null;async function getUsernameByIdD2(_0x28614b){const _0xd66105=a14_0x5eb66c;try{if(!_0x28614b)return _0xd66105(0x1e8);const _0x32fcdc=await getDoc(doc(db,'playersD2',_0x28614b));if(_0x32fcdc['exists']())return _0x32fcdc[_0xd66105(0x1eb)]()['username']||'Unknown\x20Player';const _0x63cec1=await getDocs(query(collection(db,'approvedMatchesD2'),where('winnerId','==',_0x28614b),limit(0x1)));if(!_0x63cec1['empty'])return _0x63cec1['docs'][0x0]['data']()['winnerUsername']||'Unknown\x20Player';const _0x24b013=await getDocs(query(collection(db,_0xd66105(0x1e1)),where(_0xd66105(0x1e6),'==',_0x28614b),limit(0x1)));if(!_0x24b013[_0xd66105(0x1ef)])return _0x24b013[_0xd66105(0x1f0)][0x0]['data']()['loserUsername']||_0xd66105(0x1e8);return'Unknown\x20Player';}catch(_0x593d80){return console['error']('Error\x20getting\x20username:',_0x593d80),'Unknown\x20Player';}}export async function recordEloChangeD2({playerId:_0x7a8fcf,previousElo:_0x29b855,newElo:_0x425c55,opponentId:_0x4b11ca,matchResult:_0x5780df,previousPosition:_0x5eaef6,newPosition:_0x21a2da,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0xc4ce1,timestamp:_0x58ca55}){const _0x14d2aa=a14_0x5eb66c;try{const _0x3935d6=doc(collection(db,'eloHistoryD2'));let _0x5e7f54=_0x14d2aa(0x1ea);if(isPromotion)_0x5e7f54='promotion';if(isDemotion)_0x5e7f54='demotion';let _0x2f4a92='Unranked';if(_0x425c55>=0x834)_0x2f4a92='Emerald';else{if(_0x425c55>=0x708)_0x2f4a92='Gold';else{if(_0x425c55>=0x640)_0x2f4a92='Silver';else{if(_0x425c55>=0x578)_0x2f4a92=_0x14d2aa(0x1e5);}}}return await setDoc(_0x3935d6,{'type':_0x5e7f54,'player':_0x7a8fcf,'opponent':_0x4b11ca,'previousElo':_0x29b855,'newElo':_0x425c55,'change':_0x425c55-_0x29b855,'matchResult':_0x5780df,'previousPosition':_0x5eaef6,'newPosition':_0x21a2da,'rankAchieved':_0x2f4a92,'matchId':_0xc4ce1,'timestamp':_0x58ca55}),console['log']('D2\x20ELO\x20history\x20recorded\x20for\x20'+_0x7a8fcf),!![];}catch(_0x262b49){console['error'](_0x14d2aa(0x1ec),_0x262b49);throw _0x262b49;}}export async function getEloHistoryD2(_0x3c99b2=0x14){const _0x422e85=a14_0x5eb66c;try{const _0x203441=collection(db,'eloHistoryD2');let _0x21b52a;lastVisibleD2?_0x21b52a=query(_0x203441,orderBy('timestamp','desc'),startAfter(lastVisibleD2),limit(_0x3c99b2)):_0x21b52a=query(_0x203441,orderBy(_0x422e85(0x1ed),_0x422e85(0x1e2)),limit(_0x3c99b2));const _0x54b868=await getDocs(_0x21b52a);if(_0x54b868['empty'])return{'entries':[],'hasMore':![]};lastVisibleD2=_0x54b868['docs'][_0x54b868['docs']['length']-0x1];const _0x4fe76a=_0x54b868['docs']['map'](async _0x264b64=>{const _0xf4ef8b=_0x264b64['data'](),[_0x29ef00,_0x3a139e]=await Promise['all']([getUsernameByIdD2(_0xf4ef8b['player']),getUsernameByIdD2(_0xf4ef8b['opponent'])]);return{..._0xf4ef8b,'playerUsername':_0x29ef00,'opponentUsername':_0x3a139e,'change':_0xf4ef8b['newElo']-_0xf4ef8b['previousElo'],'timestamp':_0xf4ef8b['timestamp']};}),_0x3dc02a=await Promise['all'](_0x4fe76a);return{'entries':_0x3dc02a,'hasMore':_0x54b868['size']===_0x3c99b2};}catch(_0xf3f755){console[_0x422e85(0x1e4)]('Error\x20fetching\x20D2\x20ELO\x20history:',_0xf3f755);throw _0xf3f755;}}function a14_0x35ec(){const _0x145582=['approvedMatchesD2','desc','prototype','error','Bronze','loserId','Unranked','Unknown\x20Player','trace','match','data','Error\x20recording\x20D2\x20ELO\x20history:','timestamp','bind','empty','docs'];a14_0x35ec=function(){return _0x145582;};return a14_0x35ec();}export function resetPaginationD2(){lastVisibleD2=null;}
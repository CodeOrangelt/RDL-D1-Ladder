const a29_0x5245a9=(function(){let _0x23e28b=!![];return function(_0x56df8d,_0x18b14a){const _0x3d2aba=_0x23e28b?function(){if(_0x18b14a){const _0x236b37=_0x18b14a['apply'](_0x56df8d,arguments);return _0x18b14a=null,_0x236b37;}}:function(){};return _0x23e28b=![],_0x3d2aba;};}()),a29_0x3a4936=a29_0x5245a9(this,function(){const _0xc9ad40=a29_0x4302,_0x57a0fb=function(){const _0x19e917=a29_0x4302;let _0x29a1d9;try{_0x29a1d9=Function(_0x19e917(0x188)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x5e4f0f){_0x29a1d9=window;}return _0x29a1d9;},_0x544d1b=_0x57a0fb(),_0x5e69cc=_0x544d1b['console']=_0x544d1b['console']||{},_0x3791e8=[_0xc9ad40(0x18a),'warn','info','error','exception','table','trace'];for(let _0x3a40bb=0x0;_0x3a40bb<_0x3791e8['length'];_0x3a40bb++){const _0x344b3a=a29_0x5245a9[_0xc9ad40(0x18b)]['prototype']['bind'](a29_0x5245a9),_0x2162cb=_0x3791e8[_0x3a40bb],_0x596953=_0x5e69cc[_0x2162cb]||_0x344b3a;_0x344b3a['__proto__']=a29_0x5245a9['bind'](a29_0x5245a9),_0x344b3a['toString']=_0x596953[_0xc9ad40(0x186)][_0xc9ad40(0x184)](_0x596953),_0x5e69cc[_0x2162cb]=_0x344b3a;}});function a29_0x4a82(){const _0x453b6c=['Current\x20user:','loserUsername','currentUser','playersD3','bind','winnerUsername','toString','position','return\x20(function()\x20','uid','log','constructor','pendingMatchesD3','update','username','all','You\x20must\x20be\x20logged\x20in\x20to\x20approve\x20D3\x20matches','data','eloRating'];a29_0x4a82=function(){return _0x453b6c;};return a29_0x4a82();}a29_0x3a4936();import{addDoc,updateDoc,serverTimestamp,collection,doc,getDoc,getDocs,query,where,setDoc,deleteDoc,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';import{recordEloChangeD3}from'./elo-history-d3.js';function a29_0x4302(_0x2a85ff,_0x32946a){const _0x3a4936=a29_0x4a82();return a29_0x4302=function(_0x5245a9,_0x5f04bb){_0x5245a9=_0x5245a9-0x180;let _0x4a8246=_0x3a4936[_0x5245a9];return _0x4a8246;},a29_0x4302(_0x2a85ff,_0x32946a);}export function calculateEloD3(_0x5f3039,_0x145b77,_0x28342b=0x20){const _0x194f17=0x1/(0x1+Math['pow'](0xa,(_0x145b77-_0x5f3039)/0x190)),_0x3217a3=0x1/(0x1+Math['pow'](0xa,(_0x5f3039-_0x145b77)/0x190)),_0x35f698=_0x5f3039+_0x28342b*(0x1-_0x194f17),_0x340289=_0x145b77+_0x28342b*(0x0-_0x3217a3);return{'newWinnerRating':Math['round'](_0x35f698),'newLoserRating':Math['round'](_0x340289)};}export async function updateEloRatingsD3(_0x46e30c,_0x538681,_0x490a2f){const _0xc7d66b=a29_0x4302;try{const _0x101f9d=writeBatch(db),_0x317de9=doc(db,'playersD3',_0x46e30c),_0x286ce8=doc(db,'playersD3',_0x538681),[_0x3b14c4,_0x1137f9]=await Promise['all']([getDoc(_0x317de9),getDoc(_0x286ce8)]);if(!_0x3b14c4['exists']()||!_0x1137f9['exists']())throw new Error('One\x20or\x20both\x20D3\x20players\x20not\x20found');const _0x55855c=_0x3b14c4[_0xc7d66b(0x191)](),_0x10bdba=_0x1137f9['data'](),_0xd0daba=_0x55855c[_0xc7d66b(0x187)]||Number['MAX_SAFE_INTEGER'],_0x3a31e5=_0x10bdba[_0xc7d66b(0x187)]||Number['MAX_SAFE_INTEGER'],{newWinnerRating:_0x7ddaca,newLoserRating:_0x46e047}=calculateEloD3(_0x55855c[_0xc7d66b(0x192)]||0x4b0,_0x10bdba['eloRating']||0x4b0);let _0x2fcd85=_0xd0daba,_0xfcf712=_0x3a31e5;if(_0xd0daba>_0x3a31e5){console[_0xc7d66b(0x18a)]('D3\x20Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked'),_0x2fcd85=_0x3a31e5,_0xfcf712=_0x3a31e5+0x1;const _0xb50092=query(collection(db,'playersD3'),where(_0xc7d66b(0x187),'>',_0x3a31e5),where('position','<',_0xd0daba)),_0x5c5b4f=await getDocs(_0xb50092);for(const _0x1feeac of _0x5c5b4f['docs']){_0x1feeac['id']!==_0x46e30c&&_0x1feeac['id']!==_0x538681&&_0x101f9d['update'](doc(db,'playersD3',_0x1feeac['id']),{'position':_0x1feeac['data']()['position']+0x1});}}else console['log']('D3\x20Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions');return _0x101f9d[_0xc7d66b(0x18d)](_0x317de9,{'eloRating':_0x7ddaca,'lastMatchDate':serverTimestamp(),'position':_0x2fcd85,'lastMatchId':_0x490a2f}),_0x101f9d[_0xc7d66b(0x18d)](_0x286ce8,{'eloRating':_0x46e047,'lastMatchDate':serverTimestamp(),'position':_0xfcf712,'lastMatchId':_0x490a2f}),await _0x101f9d['commit'](),console['log']('D3\x20ELO\x20ratings\x20updated\x20successfully'),await Promise[_0xc7d66b(0x18f)]([recordEloChangeD3({'playerId':_0x46e30c,'previousElo':_0x55855c['eloRating']||0x4b0,'newElo':_0x7ddaca,'opponentId':_0x538681,'matchResult':'win','previousPosition':_0xd0daba,'newPosition':_0x2fcd85,'isPromotion':_0x2fcd85<_0xd0daba,'matchId':_0x490a2f,'timestamp':serverTimestamp()}),recordEloChangeD3({'playerId':_0x538681,'previousElo':_0x10bdba['eloRating']||0x4b0,'newElo':_0x46e047,'opponentId':_0x46e30c,'matchResult':'loss','previousPosition':_0x3a31e5,'newPosition':_0xfcf712,'isDemotion':_0xfcf712>_0x3a31e5,'matchId':_0x490a2f,'timestamp':serverTimestamp()})]),!![];}catch(_0x19ca68){console['error']('Error\x20in\x20updateEloRatingsD3:',_0x19ca68);throw _0x19ca68;}}export async function approveReportD3(_0x126454,_0x336b7c,_0x2613e8,_0x4f3d9d){const _0x56752c=a29_0x4302;try{console[_0x56752c(0x18a)]('Starting\x20approveReportD3\x20function\x20with:',{'reportId':_0x126454,'winnerScore':_0x336b7c,'winnerSuicides':_0x2613e8,'winnerComment':_0x4f3d9d});const _0xd7c19b=auth[_0x56752c(0x182)];if(!_0xd7c19b){console['log']('No\x20user\x20logged\x20in');throw new Error(_0x56752c(0x190));}console['log'](_0x56752c(0x180),_0xd7c19b['email']);const _0x3eca30=await getDoc(doc(db,'playersD3',_0xd7c19b[_0x56752c(0x189)])),_0x39e36c=_0x3eca30['exists']()?_0x3eca30[_0x56752c(0x191)]()[_0x56752c(0x18e)]:null;console['log']('Current\x20username:',_0x39e36c);const _0xfe9c49=doc(db,_0x56752c(0x18c),_0x126454),_0xdbd6dc=await getDoc(_0xfe9c49);if(!_0xdbd6dc['exists']()){console['log']('D3\x20Report\x20not\x20found\x20with\x20ID:',_0x126454);throw new Error('D3\x20match\x20report\x20not\x20found');}const _0x2f7d58=_0xdbd6dc[_0x56752c(0x191)]();console[_0x56752c(0x18a)]('D3\x20Report\x20data:',_0x2f7d58);if(_0x39e36c!==_0x2f7d58['winnerUsername'])throw new Error('Only\x20the\x20winner\x20can\x20approve\x20D3\x20matches');const _0x33061e={..._0x2f7d58,'winnerScore':_0x336b7c,'winnerSuicides':_0x2613e8,'winnerComment':_0x4f3d9d,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':_0x39e36c,'createdAt':_0x2f7d58['createdAt']||serverTimestamp(),'winnerUsername':_0x2f7d58['winnerUsername'],'loserUsername':_0x2f7d58['loserUsername']};await setDoc(doc(db,'approvedMatchesD3',_0x126454),_0x33061e),await deleteDoc(_0xfe9c49),console['log']('D3\x20Match\x20moved\x20to\x20approved\x20collection');const [_0x375e26,_0x1ec02e]=await Promise['all']([getDocs(query(collection(db,_0x56752c(0x183)),where('username','==',_0x2f7d58[_0x56752c(0x185)]))),getDocs(query(collection(db,'playersD3'),where(_0x56752c(0x18e),'==',_0x2f7d58[_0x56752c(0x181)])))]);if(_0x375e26['empty']||_0x1ec02e['empty'])throw new Error('Could\x20not\x20find\x20D3\x20player\x20documents');const _0x263677=_0x375e26['docs'][0x0]['id'],_0xbdd4c3=_0x1ec02e['docs'][0x0]['id'];return await updateEloRatingsD3(_0x263677,_0xbdd4c3,_0x126454),console['log']('D3\x20Match\x20successfully\x20approved\x20and\x20ELO\x20updated'),!![];}catch(_0x451636){console['error']('Error\x20in\x20approveReportD3:',_0x451636);throw _0x451636;}}
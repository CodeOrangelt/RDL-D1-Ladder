import{initializeApp}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';import{getFirestore,collection,getDocs,writeBatch,doc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a1_0xd017(){const _0x3a2879=['\x20D1,\x20','gold','favoriteMap','‚ùå\x20Migration\x20failed:','push','name','data','ladders','‚öôÔ∏è\x20Processed\x20','trace','constructor','ladder','apply','emerald','profileImageUrl','elo','\x20profiles,\x20','commit','üîÑ\x20Starting\x20migration\x20to\x20aggregated\x20members...','\x20batches...','get','size','\x20members\x20processed)','permission-denied','set','Unknown','üí°\x20Refresh\x20your\x20members\x20page\x20to\x20see\x20the\x20results!','players','bind','log'];a1_0xd017=function(){return _0x3a2879;};return a1_0xd017();}import{firebaseConfig}from'../firebase-config.js';const app=initializeApp(firebaseConfig),db=getFirestore(app);async function migrateToAggregatedMembers(){const _0x2ac6f1=a1_0x27a8,_0x3ed345=(function(){let _0x54cb49=!![];return function(_0x82a9d9,_0x21e540){const _0x336478=_0x54cb49?function(){const _0x5f03d4=a1_0x27a8;if(_0x21e540){const _0x2eb1e3=_0x21e540[_0x5f03d4(0x1a1)](_0x82a9d9,arguments);return _0x21e540=null,_0x2eb1e3;}}:function(){};return _0x54cb49=![],_0x336478;};}()),_0x2fd4a3=_0x3ed345(this,function(){const _0x5ab374=a1_0x27a8;let _0x142b76;try{const _0x5a8c35=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x142b76=_0x5a8c35();}catch(_0x4c16ec){_0x142b76=window;}const _0x116182=_0x142b76['console']=_0x142b76['console']||{},_0xc245bb=[_0x5ab374(0x1b2),'warn','info','error','exception','table',_0x5ab374(0x19e)];for(let _0x24e92c=0x0;_0x24e92c<_0xc245bb['length'];_0x24e92c++){const _0x4392f6=_0x3ed345[_0x5ab374(0x19f)]['prototype']['bind'](_0x3ed345),_0x445c46=_0xc245bb[_0x24e92c],_0x52508a=_0x116182[_0x445c46]||_0x4392f6;_0x4392f6['__proto__']=_0x3ed345[_0x5ab374(0x1b1)](_0x3ed345),_0x4392f6['toString']=_0x52508a['toString']['bind'](_0x52508a),_0x116182[_0x445c46]=_0x4392f6;}});_0x2fd4a3(),console['log'](_0x2ac6f1(0x1a7));try{console['log']('üì•\x20Fetching\x20all\x20collections...');const [_0x105176,_0x16a1d6,_0x16a22a,_0x77e251,_0x431b5a]=await Promise['all']([getDocs(collection(db,'userProfiles')),getDocs(collection(db,_0x2ac6f1(0x1b0))),getDocs(collection(db,'playersD2')),getDocs(collection(db,'playersD3')),getDocs(collection(db,'nonParticipants'))]);console['log']('‚úÖ\x20Data\x20fetched:\x20'+_0x105176['size']+_0x2ac6f1(0x1a5)+_0x16a1d6['size']+_0x2ac6f1(0x195)+_0x16a22a[_0x2ac6f1(0x1aa)]+'\x20D2,\x20'+_0x77e251[_0x2ac6f1(0x1aa)]+'\x20D3,\x20'+_0x431b5a['size']+'\x20non-participants');const _0x2ae06d=new Map();_0x105176['forEach'](_0xd4af7d=>{const _0x10b7b2=_0x2ac6f1;_0x2ae06d[_0x10b7b2(0x1ad)](_0xd4af7d['id'],_0xd4af7d['data']());});const _0x2cc55b=new Map(),_0x1c131d=(_0x39ccd0,_0x775674)=>{_0x39ccd0['forEach'](_0x1330f8=>{const _0x447c42=a1_0x27a8,_0x50b240=_0x1330f8[_0x447c42(0x19b)](),_0x98e979=_0x1330f8['id'];!_0x2cc55b['has'](_0x98e979)&&_0x2cc55b['set'](_0x98e979,{'userId':_0x98e979,'username':_0x50b240['username']||_0x50b240['name']||_0x447c42(0x1ae),'ladders':[],'isNonParticipant':![]});const _0x8d9e66=_0x2cc55b[_0x447c42(0x1a9)](_0x98e979);_0x8d9e66[_0x447c42(0x19c)][_0x447c42(0x199)]({'ladder':_0x775674,'elo':_0x50b240['eloRating']||_0x50b240['elo']||0x4b0,'active':_0x50b240['active']!==![]});});};_0x1c131d(_0x16a1d6,'D1'),_0x1c131d(_0x16a22a,'D2'),_0x1c131d(_0x77e251,'D3'),_0x431b5a['forEach'](_0x124d7f=>{const _0x5d61a0=_0x2ac6f1,_0xd3c114=_0x124d7f['data'](),_0x586424=_0x124d7f['id'];!_0x2cc55b['has'](_0x586424)&&(_0xd3c114['username']||_0xd3c114['name'])&&_0x2cc55b['set'](_0x586424,{'userId':_0x586424,'username':_0xd3c114['username']||_0xd3c114[_0x5d61a0(0x19a)],'ladders':[],'isNonParticipant':!![]});}),console['log'](_0x2ac6f1(0x19d)+_0x2cc55b['size']+'\x20unique\x20members'),console['log']('üíæ\x20Writing\x20aggregated\x20data...');const _0x46b7b3=[];let _0x284121=writeBatch(db),_0x5acf02=0x0,_0x22e601=0x0;_0x2cc55b['forEach']((_0x219120,_0x3d0624)=>{const _0x10b070=_0x2ac6f1,_0x4f8078=_0x2ae06d[_0x10b070(0x1a9)](_0x3d0624)||{};let _0x5ddb1f=0x0,_0x22e79c=null;if(_0x219120['ladders']['length']>0x0){const _0x215eff=_0x219120['ladders']['sort']((_0x3a822c,_0x49ed02)=>_0x49ed02['elo']-_0x3a822c['elo']);_0x5ddb1f=_0x215eff[0x0][_0x10b070(0x1a4)],_0x22e79c=_0x215eff[0x0][_0x10b070(0x1a0)];}const _0xbaea01={'userId':_0x3d0624,'username':_0x219120['username'],'profileImageUrl':_0x4f8078[_0x10b070(0x1a3)]||null,'country':_0x4f8078['country']||null,'motto':_0x4f8078['motto']||null,'favoriteMap':_0x4f8078[_0x10b070(0x197)]||null,'favoriteWeapon':_0x4f8078['favoriteWeapon']||null,'isNonParticipant':_0x219120['isNonParticipant'],'ladders':_0x219120[_0x10b070(0x19c)],'primaryLadder':_0x22e79c,'highestElo':_0x5ddb1f,'rank':getPlayerRank(_0x5ddb1f),'lastUpdated':new Date(),'migrationTimestamp':new Date()['toISOString']()},_0x1035da=doc(collection(db,'aggregatedMembers'),_0x3d0624);_0x284121['set'](_0x1035da,_0xbaea01),_0x5acf02++,_0x22e601++,_0x5acf02>=0x1c2&&(_0x46b7b3['push'](_0x284121[_0x10b070(0x1a6)]()),_0x284121=writeBatch(db),_0x5acf02=0x0,console['log']('üì¶\x20Prepared\x20batch\x20'+_0x46b7b3['length']+'\x20('+_0x22e601+_0x10b070(0x1ab)));}),_0x5acf02>0x0&&_0x46b7b3['push'](_0x284121[_0x2ac6f1(0x1a6)]()),console['log']('üöÄ\x20Executing\x20'+_0x46b7b3['length']+_0x2ac6f1(0x1a8)),await Promise['all'](_0x46b7b3),console[_0x2ac6f1(0x1b2)]('üéâ\x20Successfully\x20migrated\x20'+_0x2cc55b[_0x2ac6f1(0x1aa)]+'\x20members\x20to\x20aggregated\x20collection!'),console[_0x2ac6f1(0x1b2)](_0x2ac6f1(0x1af));}catch(_0x2cf036){console['error'](_0x2ac6f1(0x198),_0x2cf036),_0x2cf036['code']===_0x2ac6f1(0x1ac)&&console['error']('üîí\x20Permission\x20denied.\x20Make\x20sure\x20you\x27re\x20signed\x20in\x20as\x20an\x20admin\x20and\x20security\x20rules\x20allow\x20access\x20to\x20aggregatedMembers\x20collection.');}}function a1_0x27a8(_0x4e164f,_0x4f9e63){const _0x18cf20=a1_0xd017();return a1_0x27a8=function(_0x754e8,_0x28f51f){_0x754e8=_0x754e8-0x195;let _0xd017a1=_0x18cf20[_0x754e8];return _0xd017a1;},a1_0x27a8(_0x4e164f,_0x4f9e63);}function getPlayerRank(_0x1f53aa){const _0x3a56fb=a1_0x27a8;if(_0x1f53aa>=0x7d0)return _0x3a56fb(0x1a2);if(_0x1f53aa>=0x708)return _0x3a56fb(0x196);if(_0x1f53aa>=0x640)return'silver';if(_0x1f53aa>=0x578)return'bronze';return'unranked';}migrateToAggregatedMembers();
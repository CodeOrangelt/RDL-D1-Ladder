import{initializeApp}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';import{getFirestore,collection,getDocs,writeBatch,doc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a1_0x4b20(_0x377d3c,_0x40f5f2){const _0x417f50=a1_0xd8d6();return a1_0x4b20=function(_0x475cef,_0x4322bf){_0x475cef=_0x475cef-0x74;let _0xd8d6b9=_0x417f50[_0x475cef];return _0xd8d6b9;},a1_0x4b20(_0x377d3c,_0x40f5f2);}import{firebaseConfig}from'../firebase-config.js';const app=initializeApp(firebaseConfig),db=getFirestore(app);async function migrateToAggregatedMembers(){const _0x36277c=a1_0x4b20,_0x14d2bf=(function(){let _0x29c223=!![];return function(_0x1e891a,_0x5211ed){const _0x12b2e5=_0x29c223?function(){const _0x1c43df=a1_0x4b20;if(_0x5211ed){const _0x7ff6eb=_0x5211ed[_0x1c43df(0x7c)](_0x1e891a,arguments);return _0x5211ed=null,_0x7ff6eb;}}:function(){};return _0x29c223=![],_0x12b2e5;};}()),_0x175ebf=_0x14d2bf(this,function(){const _0x1b5fe2=a1_0x4b20,_0x2c3313=function(){let _0x45e18b;try{_0x45e18b=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x37a384){_0x45e18b=window;}return _0x45e18b;},_0x21839b=_0x2c3313(),_0x5d5859=_0x21839b['console']=_0x21839b[_0x1b5fe2(0x81)]||{},_0x3a5029=[_0x1b5fe2(0x75),'warn','info','error',_0x1b5fe2(0x7f),'table',_0x1b5fe2(0x8c)];for(let _0x721846=0x0;_0x721846<_0x3a5029['length'];_0x721846++){const _0x34eb27=_0x14d2bf[_0x1b5fe2(0x87)][_0x1b5fe2(0x85)]['bind'](_0x14d2bf),_0x5350ba=_0x3a5029[_0x721846],_0x5a1f0c=_0x5d5859[_0x5350ba]||_0x34eb27;_0x34eb27[_0x1b5fe2(0x7b)]=_0x14d2bf[_0x1b5fe2(0x7a)](_0x14d2bf),_0x34eb27['toString']=_0x5a1f0c['toString']['bind'](_0x5a1f0c),_0x5d5859[_0x5350ba]=_0x34eb27;}});_0x175ebf(),console[_0x36277c(0x75)]('ðŸ”„\x20Starting\x20migration\x20to\x20aggregated\x20members...');try{console['log']('ðŸ“¥\x20Fetching\x20all\x20collections...');const [_0x195ebd,_0x3f32c0,_0x2d18be,_0x2d756f,_0x1ce0f5]=await Promise[_0x36277c(0x7d)]([getDocs(collection(db,'userProfiles')),getDocs(collection(db,'players')),getDocs(collection(db,'playersD2')),getDocs(collection(db,'playersD3')),getDocs(collection(db,'nonParticipants'))]);console['log']('âœ…\x20Data\x20fetched:\x20'+_0x195ebd['size']+'\x20profiles,\x20'+_0x3f32c0['size']+_0x36277c(0x8d)+_0x2d18be[_0x36277c(0x8a)]+'\x20D2,\x20'+_0x2d756f[_0x36277c(0x8a)]+_0x36277c(0x80)+_0x1ce0f5['size']+'\x20non-participants');const _0x5b4c24=new Map();_0x195ebd['forEach'](_0x78a0b0=>{_0x5b4c24['set'](_0x78a0b0['id'],_0x78a0b0['data']());});const _0x5704c1=new Map(),_0x1b0e2e=(_0x7cf0cc,_0xafee9e)=>{_0x7cf0cc['forEach'](_0x219cc4=>{const _0xc1173b=a1_0x4b20,_0x2a6452=_0x219cc4['data'](),_0x120d1e=_0x219cc4['id'];!_0x5704c1['has'](_0x120d1e)&&_0x5704c1['set'](_0x120d1e,{'userId':_0x120d1e,'username':_0x2a6452['username']||_0x2a6452['name']||'Unknown','ladders':[],'isNonParticipant':![]});const _0x2fa72c=_0x5704c1['get'](_0x120d1e);_0x2fa72c['ladders']['push']({'ladder':_0xafee9e,'elo':_0x2a6452[_0xc1173b(0x88)]||_0x2a6452['elo']||0x4b0,'active':_0x2a6452['active']!==![]});});};_0x1b0e2e(_0x3f32c0,'D1'),_0x1b0e2e(_0x2d18be,'D2'),_0x1b0e2e(_0x2d756f,'D3'),_0x1ce0f5[_0x36277c(0x76)](_0x552efb=>{const _0x132d1a=_0x36277c,_0x4d7753=_0x552efb['data'](),_0x4d5cc4=_0x552efb['id'];!_0x5704c1['has'](_0x4d5cc4)&&(_0x4d7753['username']||_0x4d7753[_0x132d1a(0x83)])&&_0x5704c1['set'](_0x4d5cc4,{'userId':_0x4d5cc4,'username':_0x4d7753['username']||_0x4d7753['name'],'ladders':[],'isNonParticipant':!![]});}),console['log']('âš™ï¸\x20Processed\x20'+_0x5704c1['size']+'\x20unique\x20members'),console['log']('ðŸ’¾\x20Writing\x20aggregated\x20data...');const _0x507a71=[];let _0x3d8005=writeBatch(db),_0x13441b=0x0,_0x5e7f36=0x0;_0x5704c1[_0x36277c(0x76)]((_0x46f911,_0xb7c17d)=>{const _0x4e9abc=_0x36277c,_0x57759a=_0x5b4c24['get'](_0xb7c17d)||{};let _0x207dd4=0x0,_0x844d7c=null;if(_0x46f911['ladders']['length']>0x0){const _0x1276f2=_0x46f911['ladders']['sort']((_0x26bbf0,_0x3706ce)=>_0x3706ce['elo']-_0x26bbf0[_0x4e9abc(0x74)]);_0x207dd4=_0x1276f2[0x0][_0x4e9abc(0x74)],_0x844d7c=_0x1276f2[0x0][_0x4e9abc(0x78)];}const _0x26bfcd={'userId':_0xb7c17d,'username':_0x46f911[_0x4e9abc(0x79)],'profileImageUrl':_0x57759a[_0x4e9abc(0x77)]||null,'country':_0x57759a[_0x4e9abc(0x89)]||null,'motto':_0x57759a['motto']||null,'favoriteMap':_0x57759a['favoriteMap']||null,'favoriteWeapon':_0x57759a[_0x4e9abc(0x84)]||null,'isNonParticipant':_0x46f911['isNonParticipant'],'ladders':_0x46f911['ladders'],'primaryLadder':_0x844d7c,'highestElo':_0x207dd4,'rank':getPlayerRank(_0x207dd4),'lastUpdated':new Date(),'migrationTimestamp':new Date()['toISOString']()},_0x29e4bd=doc(collection(db,'aggregatedMembers'),_0xb7c17d);_0x3d8005['set'](_0x29e4bd,_0x26bfcd),_0x13441b++,_0x5e7f36++,_0x13441b>=0x1c2&&(_0x507a71['push'](_0x3d8005['commit']()),_0x3d8005=writeBatch(db),_0x13441b=0x0,console[_0x4e9abc(0x75)]('ðŸ“¦\x20Prepared\x20batch\x20'+_0x507a71[_0x4e9abc(0x8f)]+'\x20('+_0x5e7f36+'\x20members\x20processed)'));}),_0x13441b>0x0&&_0x507a71['push'](_0x3d8005[_0x36277c(0x8b)]()),console['log'](_0x36277c(0x86)+_0x507a71['length']+_0x36277c(0x8e)),await Promise['all'](_0x507a71),console[_0x36277c(0x75)](_0x36277c(0x82)+_0x5704c1[_0x36277c(0x8a)]+'\x20members\x20to\x20aggregated\x20collection!'),console['log']('ðŸ’¡\x20Refresh\x20your\x20members\x20page\x20to\x20see\x20the\x20results!');}catch(_0xed87b1){console['error']('âŒ\x20Migration\x20failed:',_0xed87b1),_0xed87b1['code']==='permission-denied'&&console['error'](_0x36277c(0x7e));}}function a1_0xd8d6(){const _0x1b3c04=['elo','log','forEach','profileImageUrl','ladder','username','bind','__proto__','apply','all','ðŸ”’\x20Permission\x20denied.\x20Make\x20sure\x20you\x27re\x20signed\x20in\x20as\x20an\x20admin\x20and\x20security\x20rules\x20allow\x20access\x20to\x20aggregatedMembers\x20collection.','exception','\x20D3,\x20','console','ðŸŽ‰\x20Successfully\x20migrated\x20','name','favoriteWeapon','prototype','ðŸš€\x20Executing\x20','constructor','eloRating','country','size','commit','trace','\x20D1,\x20','\x20batches...','length'];a1_0xd8d6=function(){return _0x1b3c04;};return a1_0xd8d6();}function getPlayerRank(_0x569961){if(_0x569961>=0x7d0)return'emerald';if(_0x569961>=0x708)return'gold';if(_0x569961>=0x640)return'silver';if(_0x569961>=0x578)return'bronze';return'unranked';}migrateToAggregatedMembers();
const a33t=a33b;(function(a,b){const s=a33b,c=a();while(!![]){try{const d=parseInt(s(0x230))/0x1*(-parseInt(s(0x225))/0x2)+parseInt(s(0x23a))/0x3*(parseInt(s(0x1f7))/0x4)+parseInt(s(0x1f8))/0x5*(parseInt(s(0x22a))/0x6)+parseInt(s(0x22f))/0x7*(parseInt(s(0x21c))/0x8)+parseInt(s(0x240))/0x9+parseInt(s(0x1ec))/0xa+-parseInt(s(0x21e))/0xb*(parseInt(s(0x203))/0xc);if(d===b)break;else c['push'](c['shift']());}catch(e){c['push'](c['shift']());}}}(a33a,0x1e1af));import{collection,getDocs,deleteDoc,doc,getDoc,query,where,updateDoc,Timestamp,onSnapshot,orderBy,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import{getRankStyle}from'./ranks.js';import a33c from'./firebase-idle-wrapper.js';const styleEl=document['createElement']('style');styleEl['textContent']='\x0a\x20\x20.streak-indicator\x20{\x0a\x20\x20\x20\x20font-size:\x200.9em;\x0a\x20\x20\x20\x20color:\x20#FF4500;\x0a\x20\x20\x20\x20margin-left:\x205px;\x0a\x20\x20\x20\x20font-weight:\x20bold;\x0a\x20\x20}\x0a',document[a33t(0x228)][a33t(0x227)](styleEl);const playerCacheD3={'data':null,'timestamp':0x0},CACHE_DURATION=0x7530;async function displayLadderD3(a=![]){const u=a33t,b=document[u(0x238)]('#ladder-d3\x20tbody');if(!b){console[u(0x1eb)]('D3\x20Ladder\x20table\x20body\x20not\x20found');return;}b[u(0x20e)]=u(0x1f1);try{const c=Date[u(0x1f4)]();if(!a&&playerCacheD3['data']&&c-playerCacheD3[u(0x208)]<CACHE_DURATION){updateLadderDisplayD3(playerCacheD3['data']);return;}const d=collection(db,u(0x22c)),e=await getDocs(d),f=[];e[u(0x1fa)](l=>{const v=u,m=l['data']();m[v(0x23c)]&&f[v(0x201)]({...m,'id':l['id'],'elo':m['eloRating']||0x0,'position':m['position']||Number[v(0x1fc)]});});const g=collection(db,u(0x205)),h=await getDocs(g),i=new Map();h[u(0x1fa)](l=>{const w=u,m=l['data']();m['username']&&i[w(0x1e8)](m['username']['toLowerCase'](),m);});for(const l of f){const m=l[u(0x23c)]['toLowerCase']();if(i['has'](m)){const n=i['get'](m);n['country']&&(l[u(0x234)]=n['country'][u(0x222)]());}}const j=f['map'](o=>o['username']),k=await fetchBatchMatchStatsD3(j);f[u(0x21b)]((o,p)=>{const x=u,q=k[x(0x204)](o[x(0x23c)])?.[x(0x20c)]||0x0,r=k['get'](p[x(0x23c)])?.['totalMatches']||0x0;if(q===0x0!==(r===0x0))return q===0x0?0x1:-0x1;return(o[x(0x202)]||0x3e7)-(p[x(0x202)]||0x3e7);}),f[u(0x1fa)]((o,p)=>{o['position']=p+0x1;}),playerCacheD3[u(0x1ee)]=f,playerCacheD3['timestamp']=c,updateLadderDisplayD3(f);}catch(o){console['error']('Error\x20loading\x20D3\x20ladder:',o),b[u(0x20e)]=u(0x210)+o['message']+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';}}function calculateStreakDays(a){const y=a33t;if(!a)return 0x0;const b=a[y(0x1ef)](),c=new Date(),d=Math[y(0x239)](c-b);return Math[y(0x21d)](d/(0x3e8*0x3c*0x3c*0x18));}async function updatePlayerPositions(a,b){const z=a33t;try{const c=collection(db,z(0x22c)),d=await getDocs(c),e=[];d['forEach'](h=>{e['push']({'id':h['id'],...h['data']()});});const f=e['find'](h=>h[z(0x23c)]===a),g=e[z(0x20d)](h=>h[z(0x23c)]===b);if(!f||!g){console[z(0x1eb)]('Could\x20not\x20find\x20winner\x20or\x20loser\x20in\x20D3\x20players\x20list');return;}if(f['position']>g['position']){const h=g['position'];for(const i of e){i[z(0x202)]>=g[z(0x202)]&&i['position']<f[z(0x202)]&&i[z(0x23c)]!==a&&await updateDoc(doc(db,'playersD3',i['id']),{'position':i[z(0x202)]+0x1});}await updateDoc(doc(db,z(0x22c),f['id']),{'position':h});if(h===0x1){const j=doc(db,z(0x22c),f['id']),k=await getDoc(j);!k['data']()[z(0x1f3)]&&await updateDoc(j,{'firstPlaceDate':Timestamp[z(0x1f4)]()});}if(g[z(0x202)]===0x1){const l=doc(db,z(0x22c),g['id']);await updateDoc(l,{'firstPlaceDate':null});}}}catch(m){console[z(0x1eb)]('Error\x20updating\x20D3\x20player\x20positions:',m);}}async function updateLadderDisplayD3(a){const A=a33t;a['sort']((g,h)=>g['position']-h[A(0x202)]);const b=document[A(0x238)](A(0x1ff));if(!b)return;b['innerHTML']='';const c=a['map'](g=>g['username']),d=await fetchBatchMatchStatsD3(c),e=document['querySelector'](A(0x217));e[A(0x20e)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20<th>Rank</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<th>Username</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<th>ELO</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<th>Matches</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<th>Wins</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<th>Losses</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<th>K/D</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<th>Win\x20Rate</th>\x0a\x20\x20\x20\x20';const f=a['map'](g=>{const B=A,h=d['get'](g[B(0x23c)])||{'totalMatches':0x0,'wins':0x0,'losses':0x0,'kda':0x0,'winRate':0x0,'totalKills':0x0,'totalDeaths':0x0};return createPlayerRowD3(g,h);})['join']('');b['innerHTML']=f,getPlayersLastEloChangesD3(c)[A(0x209)](g=>{const C=A,h=new Map();b['querySelectorAll']('tr')[C(0x1fa)]((i,j)=>{const D=C;j<c[D(0x218)]&&h['set'](c[j],i);}),g['forEach']((i,j)=>{const E=C,k=h[E(0x204)](j);if(k&&i!==0x0){const l=k['querySelector'](E(0x213));if(l){const m=i>0x0?'+'+i:''+i,n=l['querySelector'](E(0x236));n&&(n['textContent']=m,n[E(0x1e5)]['color']=i>0x0?'#4CAF50':'#F44336',n['style']['fontWeight']=E(0x22e),n[E(0x1e5)]['fontSize']='0.85em',n[E(0x1e5)]['display']='inline',n[E(0x1e5)][E(0x212)]='visible',n[E(0x1e5)]['opacity']='1');}}});})['catch'](g=>console['error'](A(0x20a),g));}function a33a(){const O=['zw50CMLLCW','CgXHEwvYC0qZ','i0zgrdCWma','yM9Sza','mtKZnJLcDu9wDgS','mvL0t2DhsW','D2LUuMf0zq','A2rH','igzHBgXIywnRigvUDhjPzxm','y291BNrYEq','Dg90ywXlAwXSCW','lNrYzw5KlwLUzgLJyxrVCG','jtWVDgq+cIaGica8l3rYpG','CxvLCNLtzwXLy3rVCG','ywjZ','nKDtwLrXCW','zgvZyW','DxnLCM5HBwu','Dg90ywXezwf0Ahm','pc90zd4kicaGicaGica8DgqGC3r5Bgu9iNbVC2L0Aw9UoIbYzwXHDgL2ztSIpGOGicaGicaGicaGica8zgL2ihn0EwXLpsjKAxnWBgf5oIbMBgv4oYbHBgLNBI1PDgvTCZOGy2vUDgvYoYbWB3nPDgLVBJOGCMvSyxrPDMu7iJ4kicaGicaGicaGicaGicaGidXHigHYzwy9iNbYB2zPBguUAhrTBd91C2vYBMfTzt0','CgLSB3q','mZiYmZuZug9fy2D0','CgXHEwvYvxnLCM5HBwu','C3r5Bgu','Bg9N','CgXHEwvY','C2v0','CgXHEwvYswq','zwXVsgLZDg9YEuqZ','zxjYB3i','mtm4otu3mfrxtgrqwa','C3rYAw5N','zgf0yq','Dg9eyxrL','rdm6ieXVB2TPBMCGzM9YievmtYbJAgfUz2vZigzVCIb1C2vYCZO','phrYpJX0zcbJB2XZCgfUpsi4iIbJBgfZCZ0IBg9HzgLUzY1JzwXSiJ5mB2fKAw5NieqZigXHzgrLCIbKyxrHlI4Upc90zd48l3rYpG','Bg9ZzxjvC2vYBMfTzq','zMLYC3rqBgfJzurHDgu','BM93','igzHBgXIywnRievmtYbJAgfUz2u6ia','C2L6zq','mJKYntmYthPnvKLx','ndC2otuWz1v4r2P5','AgfZ','zM9YrwfJAa','rdm6ievYCM9YigzLDgnOAw5NievmtYbOAxn0B3j5oG','tufyx1nbrKvFsu5uruDfuG','ihbSyxLLCNm','D2LUBMvYvxnLCM5HBwu','i2XHzgrLCI1KmYb0yM9KEq','pc90zd4kicaGicaGica8Dgq+','ChvZAa','Cg9ZAxrPB24','mJeXmJeYELLMzgLU','z2v0','DxnLCLbYB2zPBgvZ','z2fTzu1Vzgu','lNbUzYiGcIaGicaGicaGicaGicaGicaGicaGicaGigfSDd0I','DgLTzxn0yw1W','DgHLBG','rxjYB3iGDxbKyxrPBMCGrdmGruXpihrYzw5KigLUzgLJyxrVCNm6','pgLTzYbZCMm9iI4Ul2LTywDLCY9MBgfNCY8','Dg90ywXnyxrJAgvZ','zMLUza','Aw5Uzxjive1m','Bg9ZC2vZ','cIaGicaGicaGicaGidX0CJ4kicaGicaGicaGicaGicaGidX0zcbJB2XZCgfUpsi4iIbZDhLSzt0IDgv4Dc1HBgLNBJOGy2vUDgvYoYbJB2XVCJOGCMvKoYi+cIaGicaGicaGicaGicaGicaGicaGrxjYB3iGBg9HzgLUzYbemYbSywrKzxiGzgf0ytOG','zwXVsgLZDg9YEq','DMLZAwjPBgL0Eq','Dgq6BNrOlwnOAwXKkdmP','Bg9Zzxjty29Yzq','D2LUBMvYu2nVCMu','rdm6ia','i2XHzgrLCI1KmYb0AgvHzcb0CG','BgvUz3rO','zNjVBq','rdm6iezVDw5Kia','C29YDa','mJu2Dwj1qLrT','y2vPBa','mtu0AfPeBxPk','Aw5JBhvKzxm','cIaGicaGicaGicaGicaGica8l2e+cIaGicaGicaGicaGicaGica','Dg9gAxHLza','Dg9mB3DLCKnHC2u','rdm6iezHBgXIywnRihf1zxj5igzHAwXLzdO','y2HHBMDL','mJCWndK4AeLkww9l','ChjLDMLVDxnfBg8','yxbWzw5Kq2HPBgq','AgvHza','z3jHEq','nLDABLDyza'];a33a=function(){return O;};return a33a();}async function fetchBatchMatchStatsD3(a){const G=a33t,b=new Map();try{const c=collection(db,'approvedMatchesD3'),d=await getDocs(c);d['forEach'](e=>{const F=a33b,f=e['data']();if(a[F(0x21f)](f[F(0x1fe)])){const g=f[F(0x1fe)];!b[F(0x1f9)](g)&&b['set'](g,{'totalMatches':0x0,'wins':0x0,'losses':0x0,'totalKills':0x0,'totalDeaths':0x0,'kda':0x0,'winRate':0x0});const h=b[F(0x204)](g);h['wins']++,h['totalMatches']++,h['totalKills']+=parseInt(f['winnerScore'])||0x0,h[F(0x23d)]+=parseInt(f['loserScore'])||0x0;}if(a['includes'](f[F(0x1f2)])){const i=f['loserUsername'];!b[F(0x1f9)](i)&&b['set'](i,{'totalMatches':0x0,'wins':0x0,'losses':0x0,'totalKills':0x0,'totalDeaths':0x0,'kda':0x0,'winRate':0x0});const j=b['get'](i);j['losses']++,j[F(0x20c)]++,j['totalKills']+=parseInt(f[F(0x214)])||0x0,j[F(0x23d)]+=parseInt(f[F(0x215)])||0x0;}}),b[G(0x1fa)](e=>{const H=G;e[H(0x232)]=e[H(0x23d)]>0x0?(e[H(0x235)]/e['totalDeaths'])[H(0x221)](0x2):e['totalKills'],e['winRate']=e['totalMatches']>0x0?(e['wins']/e['totalMatches']*0x64)['toFixed'](0x1):0x0;});}catch(e){console['error']('Error\x20fetching\x20batch\x20match\x20stats\x20for\x20D3:',e);}return b;}function createPlayerRowD3(a,b){const I=a33t,c=parseFloat(a['elo'])||0x0;let d=I(0x229);if(c>=0x7d0)d='#50C878';else{if(c>=0x708)d=I(0x22d);else{if(c>=0x640)d='#C0C0C0';else c>=0x578&&(d='#CD7F32');}}let e='';return a['country']&&(e=I(0x20b)+a[I(0x234)][I(0x222)]()+I(0x207)+a['country']+'\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20class=\x22player-flag\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20onerror=\x22this.style.display=\x27none\x27\x22>'),'\x0a\x20\x20\x20\x20<tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+a['position']+I(0x23e)+encodeURIComponent(a[I(0x23c)])+'&ladder=d3\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20style=\x22color:\x20'+d+';\x20text-decoration:\x20none;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+a[I(0x23c)]+I(0x220)+e+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td\x20style=\x22color:\x20'+d+';\x20position:\x20relative;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22elo-container\x22\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22elo-value\x22>'+c+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22trend-indicator\x22\x20style=\x22margin-left:\x205px;\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+b['totalMatches']+I(0x200)+b['wins']+I(0x200)+b[I(0x20f)]+I(0x200)+b[I(0x232)]+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+b[I(0x231)]+I(0x237);}function a33b(a,b){const c=a33a();return a33b=function(d,e){d=d-0x1e5;let f=c[d];if(a33b['sIWtBh']===undefined){var g=function(l){const m='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let n='',o='';for(let p=0x0,q,r,s=0x0;r=l['charAt'](s++);~r&&(q=p%0x4?q*0x40+r:r,p++%0x4)?n+=String['fromCharCode'](0xff&q>>(-0x2*p&0x6)):0x0){r=m['indexOf'](r);}for(let t=0x0,u=n['length'];t<u;t++){o+='%'+('00'+n['charCodeAt'](t)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(o);};a33b['ukGTmy']=g,a=arguments,a33b['sIWtBh']=!![];}const h=c[0x0],i=d+h,j=a[i];return!j?(f=a33b['ukGTmy'](f),a[i]=f):f=j,f;},a33b(a,b);}async function getPlayersLastEloChangesD3(a){const J=a33t,b=new Map();a[J(0x1fa)](c=>b[J(0x1e8)](c,0x0));try{console[J(0x1e6)](J(0x1f0),a);const c=new Map(),d=await getDocs(collection(db,'playersD3'));d[J(0x1fa)](j=>{const K=J,k=j['data']();k['username']&&c['set'](j['id'],k[K(0x23c)]);}),console[J(0x1e6)]('D3:\x20Player\x20ID\x20mappings:',Array['from'](c[J(0x22b)]()));const e=collection(db,J(0x1ea)),f=query(e,orderBy('timestamp','desc'),limit(0x64)),g=await getDocs(f);g['empty']?console[J(0x1e6)]('D3:\x20eloHistoryD3\x20is\x20empty,\x20trying\x20fallback...'):console['log']('D3:\x20Found\x20'+g['size']+'\x20entries\x20in\x20eloHistoryD3');const h=new Map();g['forEach'](j=>{const L=J,k=j[L(0x1ee)]();let l=null;if(k[L(0x23c)])l=k[L(0x23c)];else{if(k['playerUsername'])l=k[L(0x241)];else{if(k['player']&&typeof k[L(0x1e7)]===L(0x1ed))l=k[L(0x1e7)];else{if(k[L(0x1e7)]&&c[L(0x1f9)](k[L(0x1e7)]))l=c['get'](k['player']);else k[L(0x1e9)]&&c[L(0x1f9)](k[L(0x1e9)])&&(l=c[L(0x204)](k[L(0x1e9)]));}}}(k['username']==='pilot'||k[L(0x241)]==='pilot'||k[L(0x1e7)]&&c['get'](k[L(0x1e7)])===L(0x23f))&&console['log']('D3:\x20Found\x20pilot\x20entry:',k),l&&a[L(0x21f)](l)&&(!h['has'](l)&&h['set'](l,[]),h['get'](l)['push']({...k,'timestamp':k[L(0x208)]?.['seconds']||0x0}));}),console['log']('D3:\x20Found\x20entries\x20for\x20'+h[J(0x1f6)]+J(0x1fd)),h['forEach']((j,k)=>{const M=J;if(j[M(0x218)]>0x0){j['sort']((m,n)=>n['timestamp']-m[M(0x208)]);const l=j['find'](m=>m['change']!==undefined||m['newElo']!==undefined&&m[M(0x226)]!==undefined);if(l){let m;if(l['change']!==undefined)m=l[M(0x224)];else l['newElo']!==undefined&&l[M(0x226)]!==undefined&&(m=l['newElo']-l['previousElo']);m!==undefined&&(b[M(0x1e8)](k,m),console['log']('D3:\x20'+k+'\x20ELO\x20change:\x20'+m));}}});if(h['size']===0x0){console['log']('D3:\x20No\x20entries\x20found\x20in\x20eloHistoryD3,\x20trying\x20fallback...');const j=collection(db,J(0x211)),k=query(j,where(J(0x206),'==','D3'),orderBy('timestamp',J(0x23b)),limit(0x32));try{const l=await getDocs(k);console[J(0x1e6)](J(0x21a)+l['size']+J(0x233)),l[J(0x1fa)](m=>{const N=J,n=m['data']();let o=n['username']||n[N(0x241)];!o&&n['player']&&c[N(0x1f9)](n[N(0x1e7)])&&(o=c[N(0x204)](n['player']));if(o&&a['includes'](o)){const p=n[N(0x224)]||(n['newElo']!==undefined&&n[N(0x226)]!==undefined?n['newElo']-n[N(0x226)]:0x0);p!==0x0&&(b['set'](o,p),console['log'](N(0x216)+o+N(0x1f5)+p));}});}catch(m){console['log'](J(0x223),m);}}const i=Array[J(0x219)](b['entries']())['filter'](([n,o])=>o!==0x0);console[J(0x1e6)]('D3:\x20Final\x20ELO\x20changes:',i);}catch(n){console[J(0x1eb)](J(0x1fb),n);}return b;}export{displayLadderD3,updatePlayerPositions};
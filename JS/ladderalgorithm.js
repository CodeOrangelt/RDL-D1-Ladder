function a30_0x57e4(){const _0x16b71a=['round','Could\x20not\x20find\x20player\x20documents','console','doc','prototype','constructor','exists','One\x20or\x20both\x20players\x20not\x20found','pow','docs','match','Error\x20approving\x20report:','loserScore','win','length','winnerScore','log','Match\x20moved\x20to\x20approved\x20collection','table','position','Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked','Assigned\x20default\x20ELO\x20rating\x20to\x20player\x20','losses','eloRating','subgameType','winRate','empty','data','all','username','update','error','Error\x20in\x20updateEloRatings:','approvedMatches','wins','players','toString','warn','then','ELO\x20ratings\x20updated\x20successfully'];a30_0x57e4=function(){return _0x16b71a;};return a30_0x57e4();}const a30_0x38829d=(function(){let _0x27a8e6=!![];return function(_0x5d6036,_0x54dc78){const _0x5621aa=_0x27a8e6?function(){if(_0x54dc78){const _0xa43634=_0x54dc78['apply'](_0x5d6036,arguments);return _0x54dc78=null,_0xa43634;}}:function(){};return _0x27a8e6=![],_0x5621aa;};}()),a30_0x42440e=a30_0x38829d(this,function(){const _0x223da9=a30_0x4306,_0x5c727f=function(){let _0x23bcc7;try{_0x23bcc7=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x1136d5){_0x23bcc7=window;}return _0x23bcc7;},_0x3e2a30=_0x5c727f(),_0x539ea4=_0x3e2a30[_0x223da9(0x16c)]=_0x3e2a30[_0x223da9(0x16c)]||{},_0x1845d8=[_0x223da9(0x17a),_0x223da9(0x18f),'info','error','exception',_0x223da9(0x17c),'trace'];for(let _0x558307=0x0;_0x558307<_0x1845d8[_0x223da9(0x178)];_0x558307++){const _0x1eeb1b=a30_0x38829d[_0x223da9(0x16f)][_0x223da9(0x16e)]['bind'](a30_0x38829d),_0x4e3a43=_0x1845d8[_0x558307],_0x1a9bfa=_0x539ea4[_0x4e3a43]||_0x1eeb1b;_0x1eeb1b['__proto__']=a30_0x38829d['bind'](a30_0x38829d),_0x1eeb1b['toString']=_0x1a9bfa[_0x223da9(0x18e)]['bind'](_0x1a9bfa),_0x539ea4[_0x4e3a43]=_0x1eeb1b;}});a30_0x42440e();import{collection,doc,getDoc,getDocs,updateDoc,setDoc,deleteDoc,writeBatch,query,where,serverTimestamp,addDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';function a30_0x4306(_0xcf7754,_0x3bd4b2){const _0x42440e=a30_0x57e4();return a30_0x4306=function(_0x38829d,_0x46b904){_0x38829d=_0x38829d-0x16a;let _0x57e4be=_0x42440e[_0x38829d];return _0x57e4be;},a30_0x4306(_0xcf7754,_0x3bd4b2);}import{recordEloChange}from'./elo-history.js';import{promotionManager,checkAndRecordPromotion}from'./promotions.js';import{isAdmin}from'./admin-check.js';export function calculateElo(_0x1803e1,_0x51f5f4,_0xdde42=0x20){const _0x5d3c1c=a30_0x4306,_0xc4d20=0x1/(0x1+Math[_0x5d3c1c(0x172)](0xa,(_0x51f5f4-_0x1803e1)/0x190)),_0x238758=0x1/(0x1+Math[_0x5d3c1c(0x172)](0xa,(_0x1803e1-_0x51f5f4)/0x190)),_0x516066=_0x1803e1+_0xdde42*(0x1-_0xc4d20),_0xc8cd2a=_0x51f5f4+_0xdde42*(0x0-_0x238758);return{'newWinnerRating':Math['round'](_0x516066),'newLoserRating':Math[_0x5d3c1c(0x16a)](_0xc8cd2a)};}export function assignDefaultEloRating(_0x1a170c,_0x3465b0){const _0x10ae5b=a30_0x4306,_0x9b5be2=0x4b0;!_0x3465b0['eloRating']&&db['collection']('players')[_0x10ae5b(0x16d)](_0x1a170c)['update']({'eloRating':_0x9b5be2})[_0x10ae5b(0x190)](()=>{const _0x188b28=_0x10ae5b;console['log'](_0x188b28(0x17f)+_0x3465b0[_0x188b28(0x187)]);})['catch'](_0x30ae09=>{console['error']('Error\x20assigning\x20default\x20ELO\x20rating:',_0x30ae09);});}export async function updateEloRatings(_0x1769e4,_0x46eb74,_0xa9edc5){const _0x177b8d=a30_0x4306;try{const _0x4b5e7d=writeBatch(db),_0x19917a=doc(db,_0x177b8d(0x18d),_0x1769e4),_0x3a5086=doc(db,'players',_0x46eb74),[_0x5fdcd0,_0x5771f1]=await Promise['all']([getDoc(_0x19917a),getDoc(_0x3a5086)]);if(!_0x5fdcd0[_0x177b8d(0x170)]()||!_0x5771f1['exists']())throw new Error(_0x177b8d(0x171));const _0x1c9073=_0x5fdcd0['data'](),_0x49d41c=_0x5771f1['data'](),_0x35ac70=_0x1c9073[_0x177b8d(0x17d)]||Number['MAX_SAFE_INTEGER'],_0x5740be=_0x49d41c[_0x177b8d(0x17d)]||Number['MAX_SAFE_INTEGER'],{newWinnerRating:_0x5e2641,newLoserRating:_0x5bb16a}=calculateElo(_0x1c9073[_0x177b8d(0x181)]||0x4b0,_0x49d41c[_0x177b8d(0x181)]||0x4b0);let _0xd3eb47=_0x35ac70,_0x135453=_0x5740be;if(_0x35ac70>_0x5740be){console['log'](_0x177b8d(0x17e)),_0xd3eb47=_0x5740be,_0x135453=_0x5740be+0x1;const _0x16f198=query(collection(db,'players'),where(_0x177b8d(0x17d),'>',_0x5740be),where(_0x177b8d(0x17d),'<',_0x35ac70)),_0x4ca123=await getDocs(_0x16f198);for(const _0x4c1200 of _0x4ca123[_0x177b8d(0x173)]){_0x4c1200['id']!==_0x1769e4&&_0x4c1200['id']!==_0x46eb74&&_0x4b5e7d['update'](doc(db,'players',_0x4c1200['id']),{'position':_0x4c1200[_0x177b8d(0x185)]()['position']+0x1});}}else console['log']('Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions');const _0x6a382a={'eloRating':_0x5e2641,'lastMatchDate':serverTimestamp(),'position':_0xd3eb47,'lastMatchId':_0xa9edc5},_0x44f1aa={'eloRating':_0x5bb16a,'lastMatchDate':serverTimestamp(),'position':_0x135453,'lastMatchId':_0xa9edc5};return _0x4b5e7d[_0x177b8d(0x188)](_0x19917a,_0x6a382a),_0x4b5e7d[_0x177b8d(0x188)](_0x3a5086,_0x44f1aa),await _0x4b5e7d['commit'](),console['log'](_0x177b8d(0x191)),await Promise[_0x177b8d(0x186)]([recordEloChange({'playerId':_0x1769e4,'previousElo':_0x1c9073['eloRating']||0x4b0,'newElo':_0x5e2641,'opponentId':_0x46eb74,'matchResult':_0x177b8d(0x177),'previousPosition':_0x35ac70,'newPosition':_0xd3eb47,'isPromotion':_0xd3eb47<_0x35ac70,'matchId':_0xa9edc5,'timestamp':serverTimestamp()}),recordEloChange({'playerId':_0x46eb74,'previousElo':_0x49d41c['eloRating']||0x4b0,'newElo':_0x5bb16a,'opponentId':_0x1769e4,'matchResult':'loss','previousPosition':_0x5740be,'newPosition':_0x135453,'isDemotion':_0x135453>_0x5740be,'matchId':_0xa9edc5,'timestamp':serverTimestamp()})]),await promotionManager['checkAndRecordPromotion'](_0x1769e4,_0x5e2641,_0x1c9073[_0x177b8d(0x181)],{'source':_0x177b8d(0x174),'matchId':_0xa9edc5}),await promotionManager['checkAndRecordPromotion'](_0x46eb74,_0x5bb16a,_0x49d41c['eloRating'],{'source':_0x177b8d(0x174),'matchId':_0xa9edc5}),console['log']('ELO\x20ratings\x20and\x20positions\x20updated\x20successfully'),!![];}catch(_0x15c443){console[_0x177b8d(0x189)](_0x177b8d(0x18a),_0x15c443);throw _0x15c443;}}export async function approveReport(_0x3ed6ad,_0x203bfc,_0x30be54,_0x2b1ca3,_0x4920be){const _0x594762=a30_0x4306;try{const _0x4ca7cc=doc(db,'pendingMatches',_0x3ed6ad),_0x1714f6=await getDoc(_0x4ca7cc);if(!_0x1714f6['exists']())throw new Error('Report\x20not\x20found');const _0x12924c=_0x1714f6['data'](),_0x205e12={..._0x12924c,'winnerScore':_0x203bfc,'winnerSuicides':_0x30be54,'winnerComment':_0x2b1ca3,'winnerDemoLink':_0x4920be,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':auth['currentUser']['uid']};await setDoc(doc(db,_0x594762(0x18b),_0x3ed6ad),_0x205e12),await deleteDoc(_0x4ca7cc),console[_0x594762(0x17a)](_0x594762(0x17b));const [_0x18f202,_0x28c848]=await Promise['all']([getDocs(query(collection(db,_0x594762(0x18d)),where(_0x594762(0x187),'==',_0x12924c['winnerUsername']))),getDocs(query(collection(db,'players'),where('username','==',_0x12924c['loserUsername'])))]);if(_0x18f202[_0x594762(0x184)]||_0x28c848['empty'])throw new Error(_0x594762(0x16b));const _0x2a7e55=_0x18f202['docs'][0x0]['id'],_0x5537ab=_0x28c848['docs'][0x0]['id'];await updateEloRatings(_0x2a7e55,_0x5537ab,_0x3ed6ad);try{await awardMatchPoints(_0x2a7e55,_0x5537ab,_0x12924c[_0x594762(0x182)]);}catch(_0x5052de){console['warn']('Points\x20award\x20failed,\x20but\x20match\x20approval\x20continues:',_0x5052de);}return console[_0x594762(0x17a)]('Match\x20successfully\x20approved\x20and\x20ELO\x20updated'),!![];}catch(_0x30e975){console['error'](_0x594762(0x175),_0x30e975);throw _0x30e975;}}async function updatePlayerElo(_0x57b6ee,_0x3db520,_0x16e1b0){const _0x5996c1=a30_0x4306;await setDoc(doc(db,_0x5996c1(0x18d),_0x57b6ee),{...playerData,'eloRating':_0x16e1b0}),await checkAndRecordPromotion(_0x57b6ee,_0x16e1b0,_0x3db520);}async function updatePlayerStats(_0x732188,_0x32343a,_0xc3b802){const _0x4e9e4a=a30_0x4306,_0x39ec22=doc(db,'playerStats',_0x732188),_0x1d8aef=await getDoc(_0x39ec22);let _0x5341ba=_0x1d8aef['exists']()?_0x1d8aef['data']():{'wins':0x0,'losses':0x0,'totalKills':0x0,'totalDeaths':0x0,'winRate':0x0};_0xc3b802?(_0x5341ba['wins']++,_0x5341ba['totalKills']+=parseInt(_0x32343a[_0x4e9e4a(0x179)]||0x0),_0x5341ba['totalDeaths']+=parseInt(_0x32343a['loserScore']||0x0)):(_0x5341ba[_0x4e9e4a(0x180)]++,_0x5341ba['totalKills']+=parseInt(_0x32343a[_0x4e9e4a(0x176)]||0x0),_0x5341ba['totalDeaths']+=parseInt(_0x32343a['winnerScore']||0x0));const _0x52b18d=_0x5341ba[_0x4e9e4a(0x18c)]+_0x5341ba['losses'];_0x5341ba[_0x4e9e4a(0x183)]=_0x52b18d>0x0?(_0x5341ba['wins']/_0x52b18d*0x64)['toFixed'](0x1):0x0,_0x5341ba['lastUpdated']=new Date()['toISOString'](),await setDoc(_0x39ec22,_0x5341ba,{'merge':!![]});}
const a52_0x5a7ad4=(function(){let _0x13a4d6=!![];return function(_0x4d863e,_0x317880){const _0x28f1b7=_0x13a4d6?function(){if(_0x317880){const _0x88224e=_0x317880['apply'](_0x4d863e,arguments);return _0x317880=null,_0x88224e;}}:function(){};return _0x13a4d6=![],_0x28f1b7;};}()),a52_0x36dd46=a52_0x5a7ad4(this,function(){const _0x82b073=a52_0x1c5a;let _0x565623;try{const _0x233ba0=Function('return\x20(function()\x20'+_0x82b073(0x84)+');');_0x565623=_0x233ba0();}catch(_0x5cb86a){_0x565623=window;}const _0x1812d3=_0x565623[_0x82b073(0x89)]=_0x565623['console']||{},_0x52822=[_0x82b073(0x81),'warn','info','error','exception',_0x82b073(0x94),'trace'];for(let _0x2dffae=0x0;_0x2dffae<_0x52822['length'];_0x2dffae++){const _0x3eec0e=a52_0x5a7ad4['constructor']['prototype']['bind'](a52_0x5a7ad4),_0x2d98db=_0x52822[_0x2dffae],_0x33d309=_0x1812d3[_0x2d98db]||_0x3eec0e;_0x3eec0e['__proto__']=a52_0x5a7ad4['bind'](a52_0x5a7ad4),_0x3eec0e['toString']=_0x33d309['toString']['bind'](_0x33d309),_0x1812d3[_0x2d98db]=_0x3eec0e;}});a52_0x36dd46();function a52_0x1c5a(_0x2c66b2,_0x3bd62a){const _0x36dd46=a52_0x20ce();return a52_0x1c5a=function(_0x5a7ad4,_0x11e542){_0x5a7ad4=_0x5a7ad4-0x7f;let _0x20cedd=_0x36dd46[_0x5a7ad4];return _0x20cedd;},a52_0x1c5a(_0x2c66b2,_0x3bd62a);}import{doc,getDoc,getDocs,collection}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';function a52_0x20ce(){const _0x590380=['ðŸ—‘ï¸\x20Cleared\x20all\x20token\x20cache','delete','log','error','now','{}.constructor(\x22return\x20this\x22)(\x20)','purchasedAt','username','exists','sort','console','string','tokens_','includes','data','Error\x20fetching\x20tokens\x20by\x20usernames:','map','timestamp','set','getTime','tokens','table'];a52_0x20ce=function(){return _0x590380;};return a52_0x20ce();}const tokenCache=new Map(),CACHE_DURATION=0x5*0x3c*0x3e8;export async function getUserTokens(_0x1b910a){const _0xf25be6=a52_0x1c5a,_0x33ba7d='tokens_'+_0x1b910a,_0x316e74=tokenCache['get'](_0x33ba7d);if(_0x316e74&&Date['now']()-_0x316e74[_0xf25be6(0x90)]<CACHE_DURATION)return _0x316e74['tokens'];try{const _0x55afd4=doc(db,'userTokens',_0x1b910a),_0x26d88d=await getDoc(_0x55afd4);let _0x4c8265=[];return _0x26d88d['exists']()&&(_0x4c8265=_0x26d88d['data']()['tokens']||[]),tokenCache[_0xf25be6(0x91)](_0x33ba7d,{'tokens':_0x4c8265,'timestamp':Date['now']()}),_0x4c8265;}catch(_0x44705e){return console['error']('Error\x20fetching\x20user\x20tokens:',_0x44705e),[];}}export async function getBulkUserTokens(_0x44d4d7){const _0x2d1b8c=a52_0x1c5a,_0x299b09=new Map(),_0x43491f=[];_0x44d4d7['forEach'](_0x516f30=>{const _0x2a3e20=a52_0x1c5a,_0x200a2a=_0x2a3e20(0x8b)+_0x516f30,_0x190f83=tokenCache['get'](_0x200a2a);_0x190f83&&Date[_0x2a3e20(0x83)]()-_0x190f83['timestamp']<CACHE_DURATION?_0x299b09['set'](_0x516f30,_0x190f83['tokens']):_0x43491f['push'](_0x516f30);});if(_0x43491f['length']>0x0)try{const _0x42a68a=_0x43491f[_0x2d1b8c(0x8f)](async _0x3b2d6d=>{const _0x2318b8=_0x2d1b8c,_0x42de45=doc(db,'userTokens',_0x3b2d6d),_0x30d536=await getDoc(_0x42de45);let _0x30cf87=[];_0x30d536[_0x2318b8(0x87)]()&&(_0x30cf87=_0x30d536['data']()[_0x2318b8(0x93)]||[]);const _0x1616a4='tokens_'+_0x3b2d6d;return tokenCache['set'](_0x1616a4,{'tokens':_0x30cf87,'timestamp':Date[_0x2318b8(0x83)]()}),[_0x3b2d6d,_0x30cf87];}),_0x1e4a7b=await Promise['all'](_0x42a68a);_0x1e4a7b['forEach'](([_0x3e96ad,_0x502700])=>{_0x299b09['set'](_0x3e96ad,_0x502700);});}catch(_0x34c040){console[_0x2d1b8c(0x82)]('Error\x20fetching\x20bulk\x20user\x20tokens:',_0x34c040);}return _0x299b09;}export async function getTokensByUsernames(_0x3ddadb){const _0x1d3b59=a52_0x1c5a,_0x3ffc36=new Map();try{const _0x56099f=collection(db,'userProfiles'),_0x501c66=await getDocs(_0x56099f),_0x1375e5=new Map();_0x501c66['forEach'](_0x5d3d6e=>{const _0x1331b8=a52_0x1c5a,_0x1ebad9=_0x5d3d6e[_0x1331b8(0x8d)]();_0x1ebad9[_0x1331b8(0x86)]&&_0x3ddadb[_0x1331b8(0x8c)](_0x1ebad9['username'])&&_0x1375e5[_0x1331b8(0x91)](_0x1ebad9['username'],_0x5d3d6e['id']);});const _0x30f074=Array['from'](_0x1375e5['values']());if(_0x30f074['length']>0x0){const _0x5d4084=await getBulkUserTokens(_0x30f074);_0x1375e5['forEach']((_0x40b546,_0x37d19c)=>{const _0x599626=a52_0x1c5a,_0x4914e2=_0x5d4084['get'](_0x40b546)||[];_0x3ffc36[_0x599626(0x91)](_0x37d19c,_0x4914e2);});}}catch(_0x757ac4){console['error'](_0x1d3b59(0x8e),_0x757ac4);}return _0x3ffc36;}export function clearTokenCache(_0x3e7b5f=null){const _0x3b6923=a52_0x1c5a;if(_0x3e7b5f){const _0x53a5ef='tokens_'+_0x3e7b5f;tokenCache[_0x3b6923(0x80)](_0x53a5ef),console['log']('ðŸ—‘ï¸\x20Cleared\x20token\x20cache\x20for\x20user:\x20'+_0x3e7b5f);}else tokenCache['clear'](),console['log'](_0x3b6923(0x7f));}export async function forceRefreshUserTokens(_0x4b8d1c){return clearTokenCache(_0x4b8d1c),await getUserTokens(_0x4b8d1c);}export function getPrimaryDisplayToken(_0x4b9e8d){const _0x53f362=a52_0x1c5a;if(!_0x4b9e8d||_0x4b9e8d['length']===0x0)return null;const _0x1f818b=_0x4b9e8d['find'](_0x3e6774=>_0x3e6774['equipped']===!![]);if(_0x1f818b)return _0x1f818b;const _0xfc07c7=[..._0x4b9e8d][_0x53f362(0x88)]((_0x170849,_0x503069)=>{const _0x2c6936=_0x53f362;let _0x4aea0b,_0x3881fc;if(_0x170849['purchasedAt']){if(_0x170849['purchasedAt']['seconds'])_0x4aea0b=_0x170849['purchasedAt']['seconds'];else{if(_0x170849[_0x2c6936(0x85)]instanceof Date)_0x4aea0b=_0x170849['purchasedAt'][_0x2c6936(0x92)]()/0x3e8;else typeof _0x170849[_0x2c6936(0x85)]==='string'?_0x4aea0b=new Date(_0x170849['purchasedAt'])['getTime']()/0x3e8:_0x4aea0b=0x0;}}else _0x4aea0b=0x0;if(_0x503069[_0x2c6936(0x85)]){if(_0x503069['purchasedAt']['seconds'])_0x3881fc=_0x503069['purchasedAt']['seconds'];else{if(_0x503069['purchasedAt']instanceof Date)_0x3881fc=_0x503069['purchasedAt']['getTime']()/0x3e8;else typeof _0x503069[_0x2c6936(0x85)]===_0x2c6936(0x8a)?_0x3881fc=new Date(_0x503069[_0x2c6936(0x85)])['getTime']()/0x3e8:_0x3881fc=0x0;}}else _0x3881fc=0x0;return _0x3881fc-_0x4aea0b;});return _0xfc07c7[0x0];}
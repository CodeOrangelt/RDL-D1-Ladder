const a52_0xd1733a=(function(){let _0x115db5=!![];return function(_0x154710,_0x4e12ff){const _0x32a22c=_0x115db5?function(){const _0x14cc69=a52_0x2370;if(_0x4e12ff){const _0x3af28d=_0x4e12ff[_0x14cc69(0x1a1)](_0x154710,arguments);return _0x4e12ff=null,_0x3af28d;}}:function(){};return _0x115db5=![],_0x32a22c;};}()),a52_0x398cfc=a52_0xd1733a(this,function(){const _0x3df456=a52_0x2370,_0xb34801=function(){let _0x2b00c5;try{_0x2b00c5=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x4ab422){_0x2b00c5=window;}return _0x2b00c5;},_0x555c59=_0xb34801(),_0x1e6dd4=_0x555c59[_0x3df456(0x1a6)]=_0x555c59[_0x3df456(0x1a6)]||{},_0x274798=['log','warn',_0x3df456(0x1a3),'error',_0x3df456(0x1a2),_0x3df456(0x194),'trace'];for(let _0x30ba20=0x0;_0x30ba20<_0x274798[_0x3df456(0x19b)];_0x30ba20++){const _0x5cff17=a52_0xd1733a[_0x3df456(0x1a0)]['prototype']['bind'](a52_0xd1733a),_0x23f365=_0x274798[_0x30ba20],_0x43fe01=_0x1e6dd4[_0x23f365]||_0x5cff17;_0x5cff17[_0x3df456(0x1a4)]=a52_0xd1733a['bind'](a52_0xd1733a),_0x5cff17[_0x3df456(0x18f)]=_0x43fe01[_0x3df456(0x18f)]['bind'](_0x43fe01),_0x1e6dd4[_0x23f365]=_0x5cff17;}});a52_0x398cfc();import{doc,getDoc,getDocs,collection}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a52_0x2370(_0x30d694,_0x1d1892){const _0x398cfc=a52_0x79e6();return a52_0x2370=function(_0xd1733a,_0x44f46b){_0xd1733a=_0xd1733a-0x18b;let _0x79e635=_0x398cfc[_0xd1733a];return _0x79e635;},a52_0x2370(_0x30d694,_0x1d1892);}import{db}from'./firebase-config.js';function a52_0x79e6(){const _0x293869=['username','userTokens','tokens','clear','toString','exists','string','delete','Error\x20fetching\x20bulk\x20user\x20tokens:','table','sort','purchasedAt','data','tokens_','get','set','length','Error\x20fetching\x20tokens\x20by\x20usernames:','seconds','userProfiles','error','constructor','apply','exception','info','__proto__','push','console'];a52_0x79e6=function(){return _0x293869;};return a52_0x79e6();}const tokenCache=new Map(),CACHE_DURATION=0x5*0x3c*0x3e8;export async function getUserTokens(_0x1e4b7b){const _0x334f43=a52_0x2370,_0x293c27='tokens_'+_0x1e4b7b,_0x30f5b9=tokenCache[_0x334f43(0x199)](_0x293c27);if(_0x30f5b9&&Date['now']()-_0x30f5b9['timestamp']<CACHE_DURATION)return _0x30f5b9['tokens'];try{const _0x1d2c86=doc(db,'userTokens',_0x1e4b7b),_0x20e1a9=await getDoc(_0x1d2c86);let _0x1d4765=[];return _0x20e1a9[_0x334f43(0x190)]()&&(_0x1d4765=_0x20e1a9['data']()['tokens']||[]),tokenCache['set'](_0x293c27,{'tokens':_0x1d4765,'timestamp':Date['now']()}),_0x1d4765;}catch(_0x341276){return console['error']('Error\x20fetching\x20user\x20tokens:',_0x341276),[];}}export async function getBulkUserTokens(_0x178206){const _0x16cbac=a52_0x2370,_0x21369d=new Map(),_0x1d791f=[];_0x178206['forEach'](_0x3232e6=>{const _0x2753f9=a52_0x2370,_0x1601eb='tokens_'+_0x3232e6,_0x124e38=tokenCache['get'](_0x1601eb);_0x124e38&&Date['now']()-_0x124e38['timestamp']<CACHE_DURATION?_0x21369d['set'](_0x3232e6,_0x124e38[_0x2753f9(0x18d)]):_0x1d791f[_0x2753f9(0x1a5)](_0x3232e6);});if(_0x1d791f['length']>0x0)try{const _0x4227e6=_0x1d791f['map'](async _0x2db70b=>{const _0x3a0a70=a52_0x2370,_0x13c9a3=doc(db,_0x3a0a70(0x18c),_0x2db70b),_0x23a878=await getDoc(_0x13c9a3);let _0x1585cd=[];_0x23a878['exists']()&&(_0x1585cd=_0x23a878[_0x3a0a70(0x197)]()[_0x3a0a70(0x18d)]||[]);const _0x26346e=_0x3a0a70(0x198)+_0x2db70b;return tokenCache[_0x3a0a70(0x19a)](_0x26346e,{'tokens':_0x1585cd,'timestamp':Date['now']()}),[_0x2db70b,_0x1585cd];}),_0x5c58da=await Promise['all'](_0x4227e6);_0x5c58da['forEach'](([_0x4ca1b2,_0x432de1])=>{_0x21369d['set'](_0x4ca1b2,_0x432de1);});}catch(_0x178ff1){console[_0x16cbac(0x19f)](_0x16cbac(0x193),_0x178ff1);}return _0x21369d;}export async function getTokensByUsernames(_0x14a31f){const _0x4f9eea=a52_0x2370,_0x3fa31f=new Map();try{const _0x3ea31d=collection(db,_0x4f9eea(0x19e)),_0x119639=await getDocs(_0x3ea31d),_0x5daec3=new Map();_0x119639['forEach'](_0x55dd0d=>{const _0x4b4786=_0x4f9eea,_0x52b808=_0x55dd0d[_0x4b4786(0x197)]();_0x52b808[_0x4b4786(0x18b)]&&_0x14a31f['includes'](_0x52b808['username'])&&_0x5daec3['set'](_0x52b808[_0x4b4786(0x18b)],_0x55dd0d['id']);});const _0x10949b=Array['from'](_0x5daec3['values']());if(_0x10949b[_0x4f9eea(0x19b)]>0x0){const _0x4c6ef2=await getBulkUserTokens(_0x10949b);_0x5daec3['forEach']((_0x15e754,_0x4ecd0f)=>{const _0x595f85=_0x4c6ef2['get'](_0x15e754)||[];_0x3fa31f['set'](_0x4ecd0f,_0x595f85);});}}catch(_0x325f91){console['error'](_0x4f9eea(0x19c),_0x325f91);}return _0x3fa31f;}export function clearTokenCache(_0x9a0abf=null){const _0x216803=a52_0x2370;if(_0x9a0abf){const _0x236557=_0x216803(0x198)+_0x9a0abf;tokenCache[_0x216803(0x192)](_0x236557),console['log']('🗑️\x20Cleared\x20token\x20cache\x20for\x20user:\x20'+_0x9a0abf);}else tokenCache[_0x216803(0x18e)](),console['log']('🗑️\x20Cleared\x20all\x20token\x20cache');}export async function forceRefreshUserTokens(_0x3ae2e9){return clearTokenCache(_0x3ae2e9),await getUserTokens(_0x3ae2e9);}export function getPrimaryDisplayToken(_0x5684d3){const _0xab6f=a52_0x2370;if(!_0x5684d3||_0x5684d3['length']===0x0)return null;const _0x293d6e=_0x5684d3['find'](_0x3d4053=>_0x3d4053['equipped']===!![]);if(_0x293d6e)return _0x293d6e;const _0x1d5261=[..._0x5684d3][_0xab6f(0x195)]((_0x14ac94,_0xda580f)=>{const _0x187105=_0xab6f;let _0x56f28b,_0x24b074;if(_0x14ac94['purchasedAt']){if(_0x14ac94['purchasedAt']['seconds'])_0x56f28b=_0x14ac94[_0x187105(0x196)][_0x187105(0x19d)];else{if(_0x14ac94['purchasedAt']instanceof Date)_0x56f28b=_0x14ac94[_0x187105(0x196)]['getTime']()/0x3e8;else typeof _0x14ac94[_0x187105(0x196)]==='string'?_0x56f28b=new Date(_0x14ac94[_0x187105(0x196)])['getTime']()/0x3e8:_0x56f28b=0x0;}}else _0x56f28b=0x0;if(_0xda580f[_0x187105(0x196)]){if(_0xda580f['purchasedAt']['seconds'])_0x24b074=_0xda580f['purchasedAt'][_0x187105(0x19d)];else{if(_0xda580f['purchasedAt']instanceof Date)_0x24b074=_0xda580f[_0x187105(0x196)]['getTime']()/0x3e8;else typeof _0xda580f['purchasedAt']===_0x187105(0x191)?_0x24b074=new Date(_0xda580f['purchasedAt'])['getTime']()/0x3e8:_0x24b074=0x0;}}else _0x24b074=0x0;return _0x24b074-_0x56f28b;});return _0x1d5261[0x0];}
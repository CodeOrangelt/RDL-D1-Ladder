function a42_0x2f79(){const _0x4a10f0=['username','displayName','now','DISPLAY_HOURS','slice','empty','promotion-banner','Error\x20saving\x20promotion\x20preference:','#FFD700','\x20(loser)','error','true','promotion','Error\x20checking\x20promotion\x20visibility:','setItem','rankAchieved','currentUser','Recording\x20','split','usernameCache','innerHTML','getElementById','promotion-details','source','console','length','title','initialize','classList','flex','some','newRank','resolvedName','Never\x20show\x20this\x20promotion\x20again','parentNode','createElement','children','appendChild','includes','ladder','desc','modifiedBy','exception','getItem','promotionHistory','trace','button','banner-actions','add','display','bannerContainer','</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>','demotion','new-rank-change','bind','fetchInterval','Error\x20resolving\x20username:',',\x20treating\x20as\x20new','pollingInterval','parse','div','Unranked','ignored','toString','data','beforeunload','log','A\x20player','target','seconds','player','addEventListener','Resolved\x20','remove','push','RANKS','stringify','className','getRankName','Successfully\x20recorded\x20','eloHistory','removeChild','showRankChangeBanner','winnerUsername','none','constructor','setAttribute','isNewRankChange','Error\x20fetching\x20promotions:','visibilityState','Promotion\x20banner\x20container\x20not\x20found','setupBannerContainer','Emerald','lastFetchTime','style','type','loserUsername','dismissing','approvedMatches'];a42_0x2f79=function(){return _0x4a10f0;};return a42_0x2f79();}const a42_0x59868b=a42_0x367e,a42_0x27dedf=(function(){let _0x251558=!![];return function(_0x37015c,_0x8ceaa4){const _0x2e7656=_0x251558?function(){if(_0x8ceaa4){const _0x3f561e=_0x8ceaa4['apply'](_0x37015c,arguments);return _0x8ceaa4=null,_0x3f561e;}}:function(){};return _0x251558=![],_0x2e7656;};}()),a42_0x5204f2=a42_0x27dedf(this,function(){const _0x14b0d3=a42_0x367e,_0x4d54e6=function(){let _0x12b4f9;try{_0x12b4f9=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x2eaf04){_0x12b4f9=window;}return _0x12b4f9;},_0x2c4a31=_0x4d54e6(),_0x544cea=_0x2c4a31['console']=_0x2c4a31[_0x14b0d3(0x116)]||{},_0x3b3783=[_0x14b0d3(0x140),'warn','info','error',_0x14b0d3(0x128),'table',_0x14b0d3(0x12b)];for(let _0x537c75=0x0;_0x537c75<_0x3b3783[_0x14b0d3(0x117)];_0x537c75++){const _0x39afe3=a42_0x27dedf[_0x14b0d3(0x153)]['prototype'][_0x14b0d3(0x134)](a42_0x27dedf),_0x3b36f5=_0x3b3783[_0x537c75],_0x174315=_0x544cea[_0x3b36f5]||_0x39afe3;_0x39afe3['__proto__']=a42_0x27dedf['bind'](a42_0x27dedf),_0x39afe3['toString']=_0x174315[_0x14b0d3(0x13d)]['bind'](_0x174315),_0x544cea[_0x3b36f5]=_0x39afe3;}});a42_0x5204f2();import{collection,doc,query,where,orderBy,limit,getDocs,addDoc,getDoc,serverTimestamp,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{auth,db}from'./firebase-config.js';class PromotionManager{constructor(){const _0x5de944=a42_0x367e;this[_0x5de944(0x101)]=0x18,this['RANKS']=[{'threshold':0x578,'name':'Bronze','color':'#CD7F32'},{'threshold':0x640,'name':'Silver','color':'#C0C0C0'},{'threshold':0x708,'name':'Gold','color':_0x5de944(0x106)},{'threshold':0x834,'name':_0x5de944(0x15a),'color':'#50C878'}],this[_0x5de944(0x130)]=null,this[_0x5de944(0x15b)]=0x0,this['fetchInterval']=0xea60,this['pollingInterval']=null,this[_0x5de944(0x111)]={};}['initialize'](){const _0x1e03b9=a42_0x367e;this[_0x1e03b9(0x130)]=document[_0x1e03b9(0x113)]('promotion-banner-container');if(!this['bannerContainer']){console['error'](_0x1e03b9(0x158));return;}this[_0x1e03b9(0x159)]();const _0x24c5d3='promotions_checked_'+new Date()['toDateString'](),_0x384790=sessionStorage['getItem'](_0x24c5d3);!_0x384790&&(this['fetchRecentPromotions'](),sessionStorage['setItem'](_0x24c5d3,'true')),document[_0x1e03b9(0x145)]('visibilitychange',()=>{const _0x42934b=_0x1e03b9;document[_0x42934b(0x157)]==='visible'&&!sessionStorage[_0x42934b(0x129)](_0x24c5d3)&&(this['fetchRecentPromotions'](),sessionStorage['setItem'](_0x24c5d3,_0x42934b(0x109)));}),window[_0x1e03b9(0x145)](_0x1e03b9(0x13f),()=>{this['pollingInterval']&&clearInterval(this['pollingInterval']);});}['setupBannerContainer'](){const _0x4f833c=a42_0x367e;this[_0x4f833c(0x130)]['innerHTML']='',this[_0x4f833c(0x130)]['style']['display']='none';}async['fetchRecentPromotions'](){const _0x39db46=a42_0x367e;try{const _0x94a2e8=Date['now']();if(_0x94a2e8-this['lastFetchTime']<this[_0x39db46(0x135)])return;this['lastFetchTime']=_0x94a2e8;const _0x418631=collection(db,_0x39db46(0x14e)),_0x4b3597=query(_0x418631,where('type','in',['promotion','demotion']),orderBy('timestamp',_0x39db46(0x126)),limit(0x14)),_0x1996e2=await getDocs(_0x4b3597),_0x3b8a7a=[];_0x1996e2['forEach'](_0x440b98=>{const _0x1075a8=_0x39db46,_0x5a2edd={'id':_0x440b98['id'],..._0x440b98['data']()};this['shouldShowPromotion'](_0x440b98['id'])&&this['isNewRankChange'](_0x5a2edd)&&_0x3b8a7a[_0x1075a8(0x148)](_0x5a2edd);}),_0x3b8a7a['length']>0x0&&await this['processRankChanges'](_0x3b8a7a);}catch(_0x42bbfa){console['error'](_0x39db46(0x156),_0x42bbfa);}}async['processRankChanges'](_0x20d632){const _0x5da540=a42_0x367e;if(_0x20d632[_0x5da540(0x117)]===0x0)return;_0x20d632['sort']((_0x40636a,_0x4dd08d)=>{const _0xb70acb=_0x40636a['timestamp']?.['toMillis']?.()||_0x40636a['timestamp']?.['seconds']*0x3e8||0x0,_0x33bc75=_0x4dd08d['timestamp']?.['toMillis']?.()||_0x4dd08d['timestamp']?.['seconds']*0x3e8||0x0;return _0x33bc75-_0xb70acb;});const _0x3374be=this[_0x5da540(0x130)]['children']['length'],_0x156300=0x3-_0x3374be;if(_0x156300<=0x0)return;const _0xc9a863=_0x20d632[_0x5da540(0x102)](0x0,_0x156300);for(let _0x2483e7=0x0;_0x2483e7<_0xc9a863['length'];_0x2483e7++){const _0x4271d5=_0xc9a863[_0x2483e7],_0x2fb40a=auth['currentUser'];try{setTimeout(()=>{const _0x515272=_0x5da540;this[_0x515272(0x150)](_0x4271d5);},_0x2483e7*0x3e8),_0x2fb40a&&_0x4271d5[_0x5da540(0x144)]===_0x2fb40a['displayName']&&this['showRankChangeLightbox'](_0x4271d5[_0x5da540(0x15d)],_0x4271d5['rankAchieved']);}catch(_0xb73bb2){console['error']('Error\x20processing\x20rank\x20change:',_0xb73bb2);}}}['shouldShowPromotion'](_0x17cd7d){const _0x486af7=a42_0x367e;try{const _0x580b64='promotion_'+_0x17cd7d,_0x3ce605=localStorage['getItem'](_0x580b64);if(_0x3ce605){let _0xae7702;try{_0xae7702=JSON['parse'](_0x3ce605);}catch(_0x45df3b){return console['warn']('Invalid\x20storage\x20format\x20for\x20'+_0x580b64+_0x486af7(0x137)),!![];}if(_0xae7702[_0x486af7(0x13c)]===!![])return console['log']('Promotion\x20'+_0x17cd7d+'\x20is\x20permanently\x20ignored'),![];const _0x38221c=Date['now']();if(_0xae7702['userDismissed']&&_0x38221c-_0xae7702['timestamp']<this['DISPLAY_HOURS']*0x3c*0x3c*0x3e8)return console['log']('Promotion\x20'+_0x17cd7d+'\x20was\x20dismissed\x20by\x20user\x20within\x20last\x20'+this[_0x486af7(0x101)]+'\x20hours'),![];if(_0xae7702['systemDismissed']&&_0x38221c-_0xae7702['timestamp']<0x4*0x3c*0x3c*0x3e8)return console['log']('Promotion\x20'+_0x17cd7d+'\x20was\x20auto-dismissed\x20within\x20last\x204\x20hours'),![];}return!![];}catch(_0xa09fe9){return console['error'](_0x486af7(0x10b),_0xa09fe9),![];}}['ignorePromotion'](_0x42544a){const _0x42a199=a42_0x367e;try{const _0xc2343a='promotion_'+_0x42544a;localStorage['setItem'](_0xc2343a,JSON['stringify']({'timestamp':Date[_0x42a199(0x100)](),'ignored':!![]}));}catch(_0x57fd0a){console['error'](_0x42a199(0x105),_0x57fd0a);}}['showRankChangeBanner'](_0x2fa17e){this['resolveUserId'](_0x2fa17e)['then'](_0x403ae2=>{const _0x367c7a=a42_0x367e,_0x47dd18='promotion_'+_0x2fa17e['id'],_0x363d06=localStorage['getItem'](_0x47dd18);if(_0x363d06)try{const _0x4a59eb=JSON[_0x367c7a(0x139)](_0x363d06);if(_0x4a59eb['ignored']===!![]){console[_0x367c7a(0x140)]('Skipping\x20ignored\x20promotion:\x20'+_0x2fa17e['id']);return;}}catch(_0x552ed6){}localStorage['setItem'](_0x47dd18,JSON['stringify']({'timestamp':Date[_0x367c7a(0x100)](),'ignored':![],'userDismissed':![],'systemDismissed':![],'seenAt':Date[_0x367c7a(0x100)]()})),this['bannerContainer'][_0x367c7a(0x15c)][_0x367c7a(0x12f)]='block';while(this['bannerContainer'][_0x367c7a(0x122)]['length']>=0x3){this['bannerContainer'][_0x367c7a(0x14f)](this['bannerContainer']['firstChild']);}const _0x3377e4=document['createElement'](_0x367c7a(0x13a));_0x3377e4['className']=_0x367c7a(0x104),_0x3377e4[_0x367c7a(0x154)]('data-rank',_0x403ae2[_0x367c7a(0x10d)]),_0x3377e4[_0x367c7a(0x154)]('data-id',_0x403ae2['id']);const _0x23ea79=document['createElement'](_0x367c7a(0x13a));_0x23ea79[_0x367c7a(0x14b)]=_0x367c7a(0x114);const _0x42e99d=_0x403ae2[_0x367c7a(0x11e)]||_0x403ae2[_0x367c7a(0x144)]||_0x403ae2[_0x367c7a(0xfe)]||_0x403ae2['playerUsername']||_0x403ae2[_0x367c7a(0xff)]||'A\x20player',_0xa37ae4=_0x403ae2['type']==='promotion'?_0x42e99d+'\x20was\x20promoted\x20to':_0x42e99d+'\x20was\x20demoted\x20to';_0x23ea79[_0x367c7a(0x112)]=_0xa37ae4+'\x20<span\x20class=\x22rank-text\x22>'+_0x403ae2['rankAchieved']+'</span>';const _0x216cf2=document['createElement']('div');_0x216cf2['className']=_0x367c7a(0x12d);const _0x51158e=document[_0x367c7a(0x121)](_0x367c7a(0x12c));_0x51158e[_0x367c7a(0x14b)]='dismiss-btn',_0x51158e['innerHTML']='&times;',_0x51158e[_0x367c7a(0x118)]='Dismiss';const _0x31bbd0=document['createElement'](_0x367c7a(0x12c));_0x31bbd0['className']='ignore-btn',_0x31bbd0['textContent']='Don\x27t\x20show\x20again',_0x31bbd0['title']=_0x367c7a(0x11f),_0x216cf2['appendChild'](_0x31bbd0),_0x216cf2['appendChild'](_0x51158e),_0x3377e4[_0x367c7a(0x123)](_0x23ea79),_0x3377e4['appendChild'](_0x216cf2),this['bannerContainer']['appendChild'](_0x3377e4),void _0x3377e4['offsetWidth'],setTimeout(()=>{const _0x2f65e5=_0x367c7a;_0x3377e4['classList'][_0x2f65e5(0x12e)]('new-rank-change');},0x32),_0x51158e[_0x367c7a(0x145)]('click',()=>{const _0x883f47=_0x367c7a;localStorage['setItem'](_0x47dd18,JSON[_0x883f47(0x14a)]({'timestamp':Date['now'](),'ignored':![],'userDismissed':!![],'systemDismissed':![]})),_0x3377e4['classList'][_0x883f47(0x147)]('new-rank-change'),_0x3377e4[_0x883f47(0x11a)]['add'](_0x883f47(0x15f)),setTimeout(()=>{const _0x5d86f4=_0x883f47;_0x3377e4['parentNode']&&(_0x3377e4['remove'](),this['bannerContainer']['children'][_0x5d86f4(0x117)]===0x0&&(this['bannerContainer']['style'][_0x5d86f4(0x12f)]='none'));},0x1f4);}),_0x31bbd0['addEventListener']('click',()=>{const _0x6d74b0=_0x367c7a;localStorage['setItem'](_0x47dd18,JSON['stringify']({'timestamp':Date['now'](),'ignored':!![],'userDismissed':!![],'systemDismissed':![]})),_0x3377e4['classList']['remove'](_0x6d74b0(0x133)),_0x3377e4['classList'][_0x6d74b0(0x12e)]('dismissing'),setTimeout(()=>{const _0x50c607=_0x6d74b0;_0x3377e4['parentNode']&&(_0x3377e4[_0x50c607(0x147)](),this['bannerContainer']['children']['length']===0x0&&(this[_0x50c607(0x130)]['style']['display']='none'));},0x1f4);}),setTimeout(()=>{const _0x224f8a=_0x367c7a;_0x3377e4['parentNode']&&(_0x3377e4['classList']['remove']('new-rank-change'),_0x3377e4['classList'][_0x224f8a(0x12e)]('dismissing'),localStorage[_0x224f8a(0x10c)](_0x47dd18,JSON['stringify']({'timestamp':Date[_0x224f8a(0x100)](),'ignored':![],'userDismissed':![],'systemDismissed':!![]})),setTimeout(()=>{const _0x124071=_0x224f8a;_0x3377e4[_0x124071(0x120)]&&(_0x3377e4['remove'](),this['bannerContainer']['children']['length']===0x0&&(this['bannerContainer']['style']['display']=_0x124071(0x152)));},0x1f4));},0x3a98);});}async['resolveUserId'](_0x38b347){const _0x21c0ad=a42_0x367e,_0x19464b={..._0x38b347},_0x5b0d52=[_0x38b347['player'],_0x38b347['username'],_0x38b347['playerUsername'],_0x38b347['displayName']],_0x22ad66=_0x5b0d52[_0x21c0ad(0x11c)](_0x4a56a2=>_0x4a56a2&&typeof _0x4a56a2==='string'&&!_0x4a56a2[_0x21c0ad(0x124)]('ID:')&&!/^[a-zA-Z0-9]{20,}$/['test'](_0x4a56a2));if(_0x22ad66)return _0x19464b;let _0x24db8c=null;if(_0x38b347['userId'])_0x24db8c=_0x38b347['userId'];else _0x38b347['player']&&/^[A-Za-z0-9]{20,}$/['test'](_0x38b347[_0x21c0ad(0x144)])&&(_0x24db8c=_0x38b347['player']);if(!_0x24db8c)return _0x19464b;try{const _0xfedcf1=await getDoc(doc(db,'players',_0x24db8c));if(_0xfedcf1['exists']()){const _0x1f39e0=_0xfedcf1[_0x21c0ad(0x13e)]();if(_0x1f39e0['username'])return _0x19464b['resolvedName']=_0x1f39e0[_0x21c0ad(0xfe)],_0x19464b;}const _0x19c966=await getDocs(query(collection(db,'approvedMatches'),where('winnerId','==',_0x24db8c),orderBy('date','desc'),limit(0x1)));if(!_0x19c966['empty']){const _0x5074dd=_0x19c966['docs'][0x0]['data']();if(_0x5074dd[_0x21c0ad(0x151)])return _0x19464b[_0x21c0ad(0x11e)]=_0x5074dd['winnerUsername'],_0x19464b;}const _0x545978=await getDocs(query(collection(db,_0x21c0ad(0x160)),where('loserId','==',_0x24db8c),orderBy('date','desc'),limit(0x1)));if(!_0x545978[_0x21c0ad(0x103)]){const _0x1c1ad9=_0x545978['docs'][0x0]['data']();if(_0x1c1ad9[_0x21c0ad(0x15e)])return _0x19464b['resolvedName']=_0x1c1ad9[_0x21c0ad(0x15e)],console['log'](_0x21c0ad(0x146)+_0x24db8c+'\x20to\x20'+_0x1c1ad9['loserUsername']+_0x21c0ad(0x107)),_0x19464b;}}catch(_0x583a6e){console[_0x21c0ad(0x108)]('Error\x20resolving\x20user\x20ID:',_0x583a6e);}return console['warn']('Failed\x20to\x20resolve\x20user\x20ID:\x20'+_0x24db8c),_0x19464b;}['showRankChangeLightbox'](_0x5ee211,_0x1d370a){const _0x31f55f=a42_0x367e;let _0x5a2f14=document['getElementById']('rankChangeModal');!_0x5a2f14&&(_0x5a2f14=document[_0x31f55f(0x121)]('div'),_0x5a2f14['id']='rankChangeModal',_0x5a2f14['className']='rank-change-modal\x20'+_0x5ee211,document['body']['appendChild'](_0x5a2f14));const _0x10e324=_0x5ee211==='promotion'?'Congratulations!':'Rank\x20Update',_0x3ba987=_0x5ee211===_0x31f55f(0x10a)?'You\x27ve\x20been\x20promoted\x20to':'You\x27ve\x20been\x20demoted\x20to';_0x5a2f14['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rank-change-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2\x20class=\x22rank-change-title\x22>'+_0x10e324+_0x31f55f(0x131)+_0x3ba987+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22rank-name\x22>'+_0x1d370a+'</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22rank-change-button\x22\x20id=\x22rank-change-ok-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Got\x20it!\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x5a2f14['style']['display']=_0x31f55f(0x11b),document['getElementById']('rank-change-ok-btn')['addEventListener']('click',()=>{const _0x30b308=_0x31f55f;_0x5a2f14[_0x30b308(0x15c)]['display']='none';}),_0x5a2f14['addEventListener']('click',_0xf1faa8=>{const _0x1847a3=_0x31f55f;_0xf1faa8[_0x1847a3(0x142)]===_0x5a2f14&&(_0x5a2f14['style']['display']='none');});}async['checkAndRecordPromotion'](_0x21fb70,_0x5ef971,_0x2979e1,_0x4499c5={}){const _0x2b30c1=a42_0x367e;try{if(_0x5ef971===_0x2979e1||!_0x21fb70)return null;const _0xc3b915=_0x4499c5[_0x2b30c1(0x115)]||'automatic',_0x40688c=_0x4499c5['matchId']||null,_0x4423b6=_0x4499c5['adminUser']||null;console[_0x2b30c1(0x140)]('Processing\x20potential\x20rank\x20change:\x20'+_0x2979e1+'\x20→\x20'+_0x5ef971+'\x20(source:\x20'+_0xc3b915+')');let _0x12863b=null,_0x52d41d=null;try{const _0x5ca98d=await getDoc(doc(db,'players',_0x21fb70));if(_0x5ca98d['exists']()){const _0x3cd93c=_0x5ca98d['data']();_0x12863b=_0x3cd93c['username']||_0x3cd93c['displayName']||null,_0x52d41d=_0x3cd93c['displayName']||_0x3cd93c[_0x2b30c1(0xfe)]||null;}!_0x12863b&&_0x4499c5['username']&&(_0x12863b=_0x4499c5[_0x2b30c1(0xfe)],_0x52d41d=_0x4499c5['username']);!_0x12863b&&auth['currentUser']&&(_0x12863b=auth['currentUser']['displayName']||auth[_0x2b30c1(0x10e)]['email'][_0x2b30c1(0x110)]('@')[0x0],_0x52d41d=auth['currentUser'][_0x2b30c1(0xff)]||null);if(!_0x12863b){const _0x498da3=query(collection(db,'approvedMatches'),where('winnerId','==',_0x21fb70),limit(0x1)),_0x5312e0=await getDocs(_0x498da3);if(!_0x5312e0[_0x2b30c1(0x103)])_0x12863b=_0x5312e0['docs'][0x0]['data']()['winnerUsername']||'Unknown\x20Player',_0x52d41d=_0x12863b;else{const _0x53e86f=query(collection(db,'approvedMatches'),where('loserId','==',_0x21fb70),limit(0x1)),_0x21b49a=await getDocs(_0x53e86f);!_0x21b49a['empty']&&(_0x12863b=_0x21b49a[0x0]['data']()['loserUsername']||'Unknown\x20Player',_0x52d41d=_0x12863b);}}}catch(_0x1d30d6){console['error'](_0x2b30c1(0x136),_0x1d30d6);}!_0x12863b&&(console['warn']('Could\x20not\x20resolve\x20username\x20for\x20userId:',_0x21fb70),_0x12863b=_0x2b30c1(0x141),_0x52d41d='Unknown\x20Player');const _0x3e851d=this[_0x2b30c1(0x14c)](_0x2979e1),_0x3d6917=this['getRankName'](_0x5ef971);if(_0x3e851d!==_0x3d6917){const _0x16865c=_0x5ef971>_0x2979e1,_0x3742ba=_0x16865c?'promotion':_0x2b30c1(0x132),_0x2de720=_0x3d6917;console['log'](_0x2b30c1(0x10f)+_0x3742ba+'\x20for\x20'+_0x12863b+':\x20'+_0x2979e1+'\x20('+_0x3e851d+')\x20→\x20'+_0x5ef971+'\x20('+_0x3d6917+')');try{const _0x40c1a7={'player':_0x12863b,'playerUsername':_0x12863b,'username':_0x12863b,'displayName':_0x52d41d,'userId':_0x21fb70,'type':_0x3742ba,'rankAchieved':_0x2de720,'timestamp':serverTimestamp(),'previousElo':_0x2979e1,'newElo':_0x5ef971,'change':_0x5ef971-_0x2979e1,'previousRank':_0x3e851d,'newRank':_0x3d6917,'source':_0xc3b915};if(_0xc3b915==='match'&&_0x40688c)_0x40c1a7['matchId']=_0x40688c;else _0xc3b915==='admin'&&_0x4423b6?(_0x40c1a7[_0x2b30c1(0x127)]=_0x4423b6,_0x40c1a7['isAutomatic']=![]):_0x40c1a7['isAutomatic']=!![];const _0x331007=writeBatch(db),_0x3ec708=doc(collection(db,'eloHistory')),_0x217a6c=doc(collection(db,_0x2b30c1(0x12a)));return _0x331007['set'](_0x3ec708,_0x40c1a7),_0x331007['set'](_0x217a6c,_0x40c1a7),await _0x331007['commit'](),await this['sendPromotionNotification'](_0x21fb70,_0x12863b,_0x2979e1,_0x5ef971,_0x3e851d,_0x3d6917,_0x3742ba,{'displayName':_0x52d41d,'source':_0xc3b915,'matchId':_0x40688c,'ladder':_0x4499c5[_0x2b30c1(0x125)]||'D1'}),console['log'](_0x2b30c1(0x14d)+_0x3742ba+'\x20for\x20'+_0x12863b+'\x20to\x20'+_0x2de720),_0x2de720;}catch(_0x41e6ec){console[_0x2b30c1(0x108)]('Error\x20writing\x20promotion\x20records:',_0x41e6ec);try{return await addDoc(collection(db,'eloHistory'),{'player':_0x12863b,'playerUsername':_0x12863b,'username':_0x12863b,'displayName':_0x52d41d,'userId':_0x21fb70,'type':_0x3742ba,'rankAchieved':_0x2de720,'timestamp':serverTimestamp(),'previousElo':_0x2979e1,'newElo':_0x5ef971,'change':_0x5ef971-_0x2979e1,'previousRank':_0x3e851d,'source':_0xc3b915,'isAutomatic':_0xc3b915!=='admin'}),await this['sendPromotionNotification'](_0x21fb70,_0x12863b,_0x2979e1,_0x5ef971,_0x3e851d,_0x3d6917,_0x3742ba,{'displayName':_0x52d41d,'source':_0xc3b915,'matchId':_0x40688c,'ladder':_0x4499c5['ladder']||'D1'}),_0x2de720;}catch(_0x32cdad){return console['error']('Fallback\x20write\x20failed:',_0x32cdad),null;}}}return null;}catch(_0x58dd49){return console['error']('Error\x20in\x20promotion/demotion\x20recording:',_0x58dd49),null;}}[a42_0x59868b(0x14c)](_0x344a45){const _0x1a0dc=a42_0x59868b;for(let _0x2c2dc9=this[_0x1a0dc(0x149)]['length']-0x1;_0x2c2dc9>=0x0;_0x2c2dc9--){if(_0x344a45>=this['RANKS'][_0x2c2dc9]['threshold'])return this[_0x1a0dc(0x149)][_0x2c2dc9]['name'];}return _0x1a0dc(0x13b);}['cleanup'](){const _0x582a70=a42_0x59868b;this[_0x582a70(0x138)]&&clearInterval(this['pollingInterval']);}[a42_0x59868b(0x155)](_0x3fb221){const _0x42d662=a42_0x59868b;if(_0x3fb221['timestamp']){const _0x46058f=_0x3fb221['timestamp'][_0x42d662(0x143)]*0x3e8,_0xcd1a19=Date[_0x42d662(0x100)](),_0x137fc7=(_0xcd1a19-_0x46058f)/(0x3e8*0x3c*0x3c);if(_0x137fc7>0x18)return![];}if(_0x3fb221['previousRank']&&_0x3fb221[_0x42d662(0x11d)]&&_0x3fb221['previousRank']!==_0x3fb221['newRank'])return!![];return![];}async['sendPromotionNotification'](_0x1c1081,_0x3f1cff,_0xe09130,_0x3fbd26,_0x31b3c8,_0x300055,_0x3a0411,_0xb419c3={}){const _0x1d6eed=a42_0x59868b;try{console[_0x1d6eed(0x140)]('STARTING\x20notification\x20for\x20'+_0x3f1cff+'\x27s\x20'+_0x3a0411);const _0x4af158={'userId':_0x1c1081,'username':_0x3f1cff,'displayName':_0xb419c3[_0x1d6eed(0xff)]||_0x3f1cff,'oldElo':parseInt(_0xe09130),'newElo':parseInt(_0x3fbd26),'eloDifference':parseInt(_0x3fbd26)-parseInt(_0xe09130),'oldRank':_0x31b3c8,'newRank':_0x300055,'type':_0x3a0411,'timestamp':serverTimestamp(),'processed':![],'source':_0xb419c3['source']||'automatic','matchId':_0xb419c3['matchId']||null,'ladder':_0xb419c3['ladder']||'D1','adminUser':_0xb419c3['adminUser']||null};console['log']('Creating\x20Discord\x20notification:',_0x4af158);const _0x1ee061=await addDoc(collection(db,'promotionNotifications'),_0x4af158);return console['log']('Discord\x20notification\x20sent\x20successfully\x20with\x20ID:\x20'+_0x1ee061['id']),!![];}catch(_0xd61913){return console['error']('Error\x20sending\x20Discord\x20notification:',_0xd61913),![];}}}export const promotionManager=new PromotionManager();function a42_0x367e(_0x14f384,_0x3e783b){const _0x5204f2=a42_0x2f79();return a42_0x367e=function(_0x27dedf,_0x39522a){_0x27dedf=_0x27dedf-0xfe;let _0x2f79d7=_0x5204f2[_0x27dedf];return _0x2f79d7;},a42_0x367e(_0x14f384,_0x3e783b);}document['addEventListener']('DOMContentLoaded',()=>{const _0x49ce2d=a42_0x59868b;promotionManager[_0x49ce2d(0x119)]();});export const initializePromotionTracker=()=>promotionManager['initialize']();export const checkAndRecordPromotion=(_0x16835,_0x2276cf,_0x1d567b,_0xae4e42)=>promotionManager['checkAndRecordPromotion'](_0x16835,_0x2276cf,_0x1d567b,_0xae4e42);export const getRankName=_0x305a8d=>promotionManager['getRankName'](_0x305a8d);
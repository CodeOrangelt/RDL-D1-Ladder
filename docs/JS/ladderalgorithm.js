(function(_0x1612c9,_0x40f0f0){const _0x34674c=a0_0xf5a7,_0x349ba8=_0x1612c9();while(!![]){try{const _0x3dd2e5=-parseInt(_0x34674c(0x146))/0x1*(-parseInt(_0x34674c(0x134))/0x2)+parseInt(_0x34674c(0x129))/0x3+parseInt(_0x34674c(0x136))/0x4+parseInt(_0x34674c(0x12c))/0x5*(-parseInt(_0x34674c(0x148))/0x6)+parseInt(_0x34674c(0x13c))/0x7*(parseInt(_0x34674c(0x131))/0x8)+-parseInt(_0x34674c(0x139))/0x9+-parseInt(_0x34674c(0x135))/0xa;if(_0x3dd2e5===_0x40f0f0)break;else _0x349ba8['push'](_0x349ba8['shift']());}catch(_0x19d41a){_0x349ba8['push'](_0x349ba8['shift']());}}}(a0_0x3120,0x70aec));const a0_0x4503fa=(function(){let _0x4f5922=!![];return function(_0x5e0ff8,_0x3cc007){const _0x1ed152=_0x4f5922?function(){if(_0x3cc007){const _0x5e4b56=_0x3cc007['apply'](_0x5e0ff8,arguments);return _0x3cc007=null,_0x5e4b56;}}:function(){};return _0x4f5922=![],_0x1ed152;};}()),a0_0x986a4c=a0_0x4503fa(this,function(){const _0x86951d=a0_0xf5a7;let _0x132514;try{const _0x36d8c4=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x132514=_0x36d8c4();}catch(_0x55961b){_0x132514=window;}const _0x53e001=_0x132514['console']=_0x132514['console']||{},_0xb1823c=['log','warn','info','error','exception','table','trace'];for(let _0x5b0b71=0x0;_0x5b0b71<_0xb1823c[_0x86951d(0x122)];_0x5b0b71++){const _0x4eaea8=a0_0x4503fa['constructor'][_0x86951d(0x11b)][_0x86951d(0x14b)](a0_0x4503fa),_0x4741ce=_0xb1823c[_0x5b0b71],_0x535252=_0x53e001[_0x4741ce]||_0x4eaea8;_0x4eaea8['__proto__']=a0_0x4503fa['bind'](a0_0x4503fa),_0x4eaea8['toString']=_0x535252[_0x86951d(0x13d)]['bind'](_0x535252),_0x53e001[_0x4741ce]=_0x4eaea8;}});a0_0x986a4c();import{collection,doc,getDoc,getDocs,updateDoc,setDoc,deleteDoc,writeBatch,query,where,serverTimestamp,addDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';function a0_0xf5a7(_0x3eb050,_0x1e4bc9){const _0x4ac96f=a0_0x3120();return a0_0xf5a7=function(_0x986a4c,_0x4503fa){_0x986a4c=_0x986a4c-0x119;let _0x1093dc=_0x4ac96f[_0x986a4c];return _0x1093dc;},a0_0xf5a7(_0x3eb050,_0x1e4bc9);}import{recordEloChange}from'./elo-history.js';import{promotionManager,checkAndRecordPromotion}from'./promotions.js';import{isAdmin}from'./admin-check.js';import{RANKS,getRankStyle}from'./ranks.js';export function calculateElo(_0x1e9255,_0x56410a,_0x1f6b2f=0x20){const _0x1cac7c=a0_0xf5a7;_0x1e9255=_0x1e9255>0x3e8?0xc8:_0x1e9255,_0x56410a=_0x56410a>0x3e8?0xc8:_0x56410a;const _0x50f18c=0x1/(0x1+Math['pow'](0xa,(_0x56410a-_0x1e9255)/0x190)),_0x3b778d=0x1/(0x1+Math['pow'](0xa,(_0x1e9255-_0x56410a)/0x190)),_0x52b9b7=_0x1e9255+_0x1f6b2f*(0x1-_0x50f18c),_0x516c7d=_0x56410a+_0x1f6b2f*(0x0-_0x3b778d);return{'newWinnerRating':Math['round'](Math[_0x1cac7c(0x11f)](_0x52b9b7)),'newLoserRating':Math['round'](Math[_0x1cac7c(0x145)](_0x516c7d,0x0))};}export function assignDefaultEloRating(_0x31e313,_0x54c15d){const _0x603380=a0_0xf5a7,_0x118685=0xc8;!_0x54c15d[_0x603380(0x14c)]&&db['collection']('players')['doc'](_0x31e313)['update']({'eloRating':_0x118685})[_0x603380(0x144)](()=>{console['log']('Assigned\x20default\x20ELO\x20rating\x20to\x20player\x20'+_0x54c15d['username']);})['catch'](_0x5632c2=>{console['error']('Error\x20assigning\x20default\x20ELO\x20rating:',_0x5632c2);});}export async function updateEloRatings(_0x183b46,_0x218075,_0x52c55d){const _0x4d3b02=a0_0xf5a7;try{const _0x4fa6b7=writeBatch(db),_0x18765b=doc(db,_0x4d3b02(0x12e),_0x183b46),_0x3a05d5=doc(db,'players',_0x218075),[_0x3cce81,_0x391962]=await Promise['all']([getDoc(_0x18765b),getDoc(_0x3a05d5)]);if(!_0x3cce81['exists']()||!_0x391962[_0x4d3b02(0x141)]())throw new Error('One\x20or\x20both\x20players\x20not\x20found');const _0x13be43=_0x3cce81[_0x4d3b02(0x127)](),_0x557b81=_0x391962[_0x4d3b02(0x127)](),_0x153165=_0x13be43['position']||Number['MAX_SAFE_INTEGER'],_0x4511e2=_0x557b81['position']||Number[_0x4d3b02(0x11a)],{newWinnerRating:_0x5b918e,newLoserRating:_0x5bbd1e}=calculateElo(_0x13be43['eloRating']||0x4b0,_0x557b81[_0x4d3b02(0x14c)]||0x4b0);let _0x17777b=_0x153165,_0x1510c1=_0x4511e2;if(_0x153165>_0x4511e2){console['log']('Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked'),_0x17777b=_0x4511e2,_0x1510c1=_0x4511e2+0x1;const _0x3a30b6=query(collection(db,'players'),where(_0x4d3b02(0x14d),'>',_0x4511e2),where('position','<',_0x153165)),_0xc66d49=await getDocs(_0x3a30b6);for(const _0x35aa7c of _0xc66d49[_0x4d3b02(0x149)]){_0x35aa7c['id']!==_0x183b46&&_0x35aa7c['id']!==_0x218075&&_0x4fa6b7['update'](doc(db,'players',_0x35aa7c['id']),{'position':_0x35aa7c['data']()['position']+0x1});}}else console['log']('Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions');const _0x563bf6={'eloRating':_0x5b918e,'lastMatchDate':serverTimestamp(),'position':_0x17777b,'lastMatchId':_0x52c55d},_0x591442={'eloRating':_0x5bbd1e,'lastMatchDate':serverTimestamp(),'position':_0x1510c1,'lastMatchId':_0x52c55d};return _0x4fa6b7[_0x4d3b02(0x120)](_0x18765b,_0x563bf6),_0x4fa6b7[_0x4d3b02(0x120)](_0x3a05d5,_0x591442),await _0x4fa6b7[_0x4d3b02(0x14f)](),console['log']('ELO\x20ratings\x20updated\x20successfully'),await Promise['all']([recordEloChange({'playerId':_0x183b46,'previousElo':_0x13be43['eloRating']||0x4b0,'newElo':_0x5b918e,'opponentId':_0x218075,'matchResult':_0x4d3b02(0x123),'previousPosition':_0x153165,'newPosition':_0x17777b,'isPromotion':_0x17777b<_0x153165,'matchId':_0x52c55d,'timestamp':serverTimestamp()}),recordEloChange({'playerId':_0x218075,'previousElo':_0x557b81[_0x4d3b02(0x14c)]||0x4b0,'newElo':_0x5bbd1e,'opponentId':_0x183b46,'matchResult':'loss','previousPosition':_0x4511e2,'newPosition':_0x1510c1,'isDemotion':_0x1510c1>_0x4511e2,'matchId':_0x52c55d,'timestamp':serverTimestamp()})]),await promotionManager[_0x4d3b02(0x12a)](_0x183b46,_0x5b918e,_0x13be43[_0x4d3b02(0x14c)],{'source':_0x4d3b02(0x132),'matchId':_0x52c55d}),await promotionManager['checkAndRecordPromotion'](_0x218075,_0x5bbd1e,_0x557b81['eloRating'],{'source':'match','matchId':_0x52c55d}),console[_0x4d3b02(0x125)]('ELO\x20ratings\x20and\x20positions\x20updated\x20successfully'),!![];}catch(_0x8a26c5){console[_0x4d3b02(0x12f)]('Error\x20in\x20updateEloRatings:',_0x8a26c5);throw _0x8a26c5;}}const POINTS_CHART={'':0xa,'Standard':0xa,'Fusion\x20Match':0x19,'â‰¥6\x20Missiles':0xa,'Weapon\x20Imbalance':0x1e,'Blind\x20Match':0x4b,'Rematch':0x14,'Disorientation':0x32,'Ratting':0x23,'Altered\x20Powerups':0x23,'Mega\x20Match':0x28,'Dogfight':0x32,'Gauss\x20and\x20Mercs':0x19,'Misc':0x1e};export async function approveReport(_0x1022b9,_0x19ca99,_0x1720d0,_0x576436,_0x3e8598){const _0x29e100=a0_0xf5a7;try{const _0x57c84c=doc(db,_0x29e100(0x13a),_0x1022b9),_0x4d0eab=await getDoc(_0x57c84c);if(!_0x4d0eab['exists']())throw new Error('Report\x20not\x20found');const _0x20c780=_0x4d0eab[_0x29e100(0x127)](),_0x66d1c0={..._0x20c780,'winnerScore':_0x19ca99,'winnerSuicides':_0x1720d0,'winnerComment':_0x576436,'winnerDemoLink':_0x3e8598,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':auth['currentUser']['uid']};await setDoc(doc(db,'approvedMatches',_0x1022b9),_0x66d1c0),await deleteDoc(_0x57c84c),console[_0x29e100(0x125)]('Match\x20moved\x20to\x20approved\x20collection');const [_0x222a9e,_0x369e8b]=await Promise['all']([getDocs(query(collection(db,'players'),where('username','==',_0x20c780['winnerUsername']))),getDocs(query(collection(db,'players'),where(_0x29e100(0x12b),'==',_0x20c780['loserUsername'])))]);if(_0x222a9e['empty']||_0x369e8b['empty'])throw new Error('Could\x20not\x20find\x20player\x20documents');const _0x5e7a32=_0x222a9e['docs'][0x0]['id'],_0x1e37db=_0x369e8b['docs'][0x0]['id'];await updateEloRatings(_0x5e7a32,_0x1e37db,_0x1022b9);try{const _0x1f486d=_0x20c780['subgameType']||'Standard',_0x4faddc=POINTS_CHART[_0x1f486d]||0xa,_0x4c7cc9=doc(db,_0x29e100(0x133),_0x5e7a32),_0x3dee3b=doc(db,_0x29e100(0x133),_0x1e37db),[_0xd80524,_0x2f34b7]=await Promise['all']([getDoc(_0x4c7cc9),getDoc(_0x3dee3b)]);if(_0xd80524['exists']()&&_0x2f34b7['exists']()){const _0x5c4b09=_0xd80524[_0x29e100(0x127)](),_0x36cf94=_0x2f34b7['data'](),_0x16a379=_0x5c4b09['points']||0x0,_0x1cbfea=_0x36cf94[_0x29e100(0x137)]||0x0,_0x2efc55=_0x16a379+_0x4faddc,_0x50accf=_0x1cbfea+_0x4faddc;await Promise[_0x29e100(0x130)]([updateDoc(_0x4c7cc9,{'points':_0x2efc55,'lastPointsModified':serverTimestamp()}),updateDoc(_0x3dee3b,{'points':_0x50accf,'lastPointsModified':serverTimestamp()})]),await Promise[_0x29e100(0x130)]([addDoc(collection(db,'pointsHistory'),{'userId':_0x5e7a32,'userEmail':_0x5c4b09[_0x29e100(0x13f)]||_0x29e100(0x13b),'displayName':_0x5c4b09[_0x29e100(0x147)]||_0x5c4b09['username']||'Unknown\x20User','action':_0x29e100(0x140),'amount':_0x4faddc,'previousPoints':_0x16a379,'newPoints':_0x2efc55,'reason':_0x29e100(0x119)+_0x1f486d+_0x29e100(0x14e),'adminEmail':'system-match-award','timestamp':serverTimestamp()}),addDoc(collection(db,_0x29e100(0x142)),{'userId':_0x1e37db,'userEmail':_0x36cf94['email']||'unknown','displayName':_0x36cf94['displayName']||_0x36cf94['username']||'Unknown\x20User','action':'add','amount':_0x4faddc,'previousPoints':_0x1cbfea,'newPoints':_0x50accf,'reason':'Match\x20points:\x20'+_0x1f486d+'\x20match\x20(Participant)','adminEmail':_0x29e100(0x128),'timestamp':serverTimestamp()})]),console[_0x29e100(0x125)](_0x29e100(0x143)+_0x4faddc+'\x20points\x20to\x20both\x20players\x20for\x20'+_0x1f486d+'\x20match');}else console['warn']('Could\x20not\x20award\x20points\x20-\x20one\x20or\x20both\x20user\x20profiles\x20not\x20found');}catch(_0x429ebd){console['warn'](_0x29e100(0x11c),_0x429ebd);}return console[_0x29e100(0x125)]('Match\x20successfully\x20approved\x20and\x20ELO\x20updated'),!![];}catch(_0x2c3c8e){console['error']('Error\x20approving\x20report:',_0x2c3c8e);throw _0x2c3c8e;}}function a0_0x3120(){const _0x37fd52=['checkAndRecordPromotion','username','11485hqLjOm','toISOString','players','error','all','24WQVMtn','match','userProfiles','2tHvvbE','12452040ToMWbe','1400836chpDnw','points','winnerScore','2611287rZHxhV','pendingMatches','unknown','1380946tMEbct','toString','totalDeaths','email','add','exists','pointsHistory','Awarded\x20','then','max','432311KknzUv','displayName','30bYQMCO','docs','losses','bind','eloRating','position','\x20match\x20(Winner)','commit','Match\x20points:\x20','MAX_SAFE_INTEGER','prototype','Points\x20award\x20failed,\x20but\x20match\x20approval\x20continues:','loserScore','totalMatches','min','update','toFixed','length','win','name','log','wins','data','system-match-award','1902078DCeGFG'];a0_0x3120=function(){return _0x37fd52;};return a0_0x3120();}async function updatePlayerElo(_0x508890,_0x4d2be8,_0x287093){const _0x49f85d=a0_0xf5a7,_0xfe13e0=doc(db,'players',_0x508890),_0x3c4219=await getDoc(_0xfe13e0),_0x4c8709=_0x3c4219[_0x49f85d(0x127)](),_0x3c3628=doc(db,'playerStats',_0x508890),_0x34e522=await getDoc(_0x3c3628),_0x486875=_0x34e522['data']()||{'totalMatches':0x0,'winRate':0x0},_0xd434d0=getRankStyle(_0x287093,_0x486875['totalMatches'],_0x486875['winRate']);await updateDoc(_0xfe13e0,{'eloRating':_0x287093,'rank':_0xd434d0[_0x49f85d(0x124)],'rankColor':_0xd434d0['color']}),await checkAndRecordPromotion(_0x508890,_0x287093,_0x4d2be8,{'matchCount':_0x486875[_0x49f85d(0x11e)],'winRate':_0x486875['winRate']});}async function updatePlayerStats(_0x246177,_0x98468c,_0x37e9b0){const _0x55372f=a0_0xf5a7,_0x551567=doc(db,'playerStats',_0x246177),_0x499177=await getDoc(_0x551567);let _0x358bcf=_0x499177[_0x55372f(0x141)]()?_0x499177['data']():{'wins':0x0,'losses':0x0,'totalKills':0x0,'totalDeaths':0x0,'winRate':0x0};_0x37e9b0?(_0x358bcf['wins']++,_0x358bcf['totalKills']+=parseInt(_0x98468c['winnerScore']||0x0),_0x358bcf['totalDeaths']+=parseInt(_0x98468c[_0x55372f(0x11d)]||0x0)):(_0x358bcf['losses']++,_0x358bcf['totalKills']+=parseInt(_0x98468c['loserScore']||0x0),_0x358bcf[_0x55372f(0x13e)]+=parseInt(_0x98468c[_0x55372f(0x138)]||0x0));const _0x423006=_0x358bcf['wins']+_0x358bcf[_0x55372f(0x14a)];_0x358bcf['winRate']=_0x423006>0x0?(_0x358bcf[_0x55372f(0x126)]/_0x423006*0x64)[_0x55372f(0x121)](0x1):0x0,_0x358bcf['lastUpdated']=new Date()[_0x55372f(0x12d)](),await setDoc(_0x551567,_0x358bcf,{'merge':!![]});}
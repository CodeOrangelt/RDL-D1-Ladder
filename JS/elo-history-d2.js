const a14_0x355588=a14_0x4116,a14_0x43c0ee=(function(){let _0x3f8036=!![];return function(_0x403f0f,_0x58f3d3){const _0x439cae=_0x3f8036?function(){if(_0x58f3d3){const _0x891c8=_0x58f3d3['apply'](_0x403f0f,arguments);return _0x58f3d3=null,_0x891c8;}}:function(){};return _0x3f8036=![],_0x439cae;};}()),a14_0x37a241=a14_0x43c0ee(this,function(){const _0x576370=a14_0x4116;let _0x3e6776;try{const _0x44aae8=Function(_0x576370(0x11d)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x3e6776=_0x44aae8();}catch(_0x331fae){_0x3e6776=window;}const _0x47bacd=_0x3e6776[_0x576370(0x123)]=_0x3e6776['console']||{},_0x3807f2=[_0x576370(0x117),_0x576370(0x11b),'info','error',_0x576370(0x11c),'table','trace'];for(let _0x19685d=0x0;_0x19685d<_0x3807f2['length'];_0x19685d++){const _0x327073=a14_0x43c0ee['constructor'][_0x576370(0x11a)]['bind'](a14_0x43c0ee),_0x187d01=_0x3807f2[_0x19685d],_0x447170=_0x47bacd[_0x187d01]||_0x327073;_0x327073['__proto__']=a14_0x43c0ee['bind'](a14_0x43c0ee),_0x327073['toString']=_0x447170['toString']['bind'](_0x447170),_0x47bacd[_0x187d01]=_0x327073;}});a14_0x37a241();function a14_0x26d8(){const _0x3a0d53=['winnerId','map','Error\x20getting\x20username:','Error\x20fetching\x20D2\x20ELO\x20history:','empty','previousElo','Unranked','docs','Bronze','log','promotion','demotion','prototype','warn','exception','return\x20(function()\x20','Unknown\x20Player','player','eloHistoryD2','timestamp','username','console','Silver','error'];a14_0x26d8=function(){return _0x3a0d53;};return a14_0x26d8();}import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D2=[{'name':'Gold','elo':0x708},{'name':a14_0x355588(0x124),'elo':0x640},{'name':a14_0x355588(0x116),'elo':0x578},{'name':a14_0x355588(0x114),'elo':0x4b0}];let lastVisibleD2=null;async function getUsernameByIdD2(_0x274eda){const _0x43059b=a14_0x355588;try{if(!_0x274eda)return'Unknown\x20Player';const _0x468bc0=await getDoc(doc(db,'playersD2',_0x274eda));if(_0x468bc0['exists']())return _0x468bc0['data']()[_0x43059b(0x122)]||'Unknown\x20Player';const _0x215fc6=await getDocs(query(collection(db,'approvedMatchesD2'),where(_0x43059b(0x10e),'==',_0x274eda),limit(0x1)));if(!_0x215fc6[_0x43059b(0x112)])return _0x215fc6[_0x43059b(0x115)][0x0]['data']()['winnerUsername']||'Unknown\x20Player';const _0x2c5a7e=await getDocs(query(collection(db,'approvedMatchesD2'),where('loserId','==',_0x274eda),limit(0x1)));if(!_0x2c5a7e['empty'])return _0x2c5a7e['docs'][0x0]['data']()['loserUsername']||_0x43059b(0x11e);return _0x43059b(0x11e);}catch(_0x8f24f9){return console['error'](_0x43059b(0x110),_0x8f24f9),'Unknown\x20Player';}}function a14_0x4116(_0x5c0674,_0x46d219){const _0x37a241=a14_0x26d8();return a14_0x4116=function(_0x43c0ee,_0x168fb1){_0x43c0ee=_0x43c0ee-0x10e;let _0x26d878=_0x37a241[_0x43c0ee];return _0x26d878;},a14_0x4116(_0x5c0674,_0x46d219);}export async function recordEloChangeD2({playerId:_0x3b147c,previousElo:_0x350e6e,newElo:_0x24dc22,opponentId:_0x1237dc,matchResult:_0x5674b8,previousPosition:_0x19caeb,newPosition:_0x5c0c4a,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x334dd5,timestamp:_0x3d9d4e}){const _0x22f6d8=a14_0x355588;try{const _0x5afa5d=doc(collection(db,'eloHistoryD2'));let _0x35b7cd='match';if(isPromotion)_0x35b7cd=_0x22f6d8(0x118);if(isDemotion)_0x35b7cd=_0x22f6d8(0x119);let _0xa22e37='Unranked';if(_0x24dc22>=0x834)_0xa22e37='Emerald';else{if(_0x24dc22>=0x708)_0xa22e37='Gold';else{if(_0x24dc22>=0x640)_0xa22e37='Silver';else{if(_0x24dc22>=0x578)_0xa22e37=_0x22f6d8(0x116);}}}return await setDoc(_0x5afa5d,{'type':_0x35b7cd,'player':_0x3b147c,'opponent':_0x1237dc,'previousElo':_0x350e6e,'newElo':_0x24dc22,'change':_0x24dc22-_0x350e6e,'matchResult':_0x5674b8,'previousPosition':_0x19caeb,'newPosition':_0x5c0c4a,'rankAchieved':_0xa22e37,'matchId':_0x334dd5,'timestamp':_0x3d9d4e}),console['log']('D2\x20ELO\x20history\x20recorded\x20for\x20'+_0x3b147c),!![];}catch(_0x524896){console[_0x22f6d8(0x125)]('Error\x20recording\x20D2\x20ELO\x20history:',_0x524896);throw _0x524896;}}export async function getEloHistoryD2(_0x1d1af7=0x14){const _0x2f5c59=a14_0x355588;try{const _0x1ff794=collection(db,_0x2f5c59(0x120));let _0x58c07a;lastVisibleD2?_0x58c07a=query(_0x1ff794,orderBy('timestamp','desc'),startAfter(lastVisibleD2),limit(_0x1d1af7)):_0x58c07a=query(_0x1ff794,orderBy('timestamp','desc'),limit(_0x1d1af7));const _0x54c12b=await getDocs(_0x58c07a);if(_0x54c12b['empty'])return{'entries':[],'hasMore':![]};lastVisibleD2=_0x54c12b['docs'][_0x54c12b['docs']['length']-0x1];const _0x280702=_0x54c12b['docs'][_0x2f5c59(0x10f)](async _0x308fac=>{const _0x2b985d=_0x2f5c59,_0x3cea8f=_0x308fac['data'](),[_0x4954e3,_0x2b7441]=await Promise['all']([getUsernameByIdD2(_0x3cea8f[_0x2b985d(0x11f)]),getUsernameByIdD2(_0x3cea8f['opponent'])]);return{..._0x3cea8f,'playerUsername':_0x4954e3,'opponentUsername':_0x2b7441,'change':_0x3cea8f['newElo']-_0x3cea8f[_0x2b985d(0x113)],'timestamp':_0x3cea8f[_0x2b985d(0x121)]};}),_0x68e19f=await Promise['all'](_0x280702);return{'entries':_0x68e19f,'hasMore':_0x54c12b['size']===_0x1d1af7};}catch(_0x435a89){console['error'](_0x2f5c59(0x111),_0x435a89);throw _0x435a89;}}export function resetPaginationD2(){lastVisibleD2=null;}
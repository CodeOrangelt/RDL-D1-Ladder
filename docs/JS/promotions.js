const a0_0x4d82e6=a0_0xc011;(function(_0x3b7f84,_0x327339){const _0x19f188=a0_0xc011,_0x276267=_0x3b7f84();while(!![]){try{const _0x5566eb=parseInt(_0x19f188(0x1f5))/0x1*(-parseInt(_0x19f188(0x211))/0x2)+parseInt(_0x19f188(0x21b))/0x3*(parseInt(_0x19f188(0x1db))/0x4)+-parseInt(_0x19f188(0x1f0))/0x5*(parseInt(_0x19f188(0x22e))/0x6)+parseInt(_0x19f188(0x22f))/0x7+-parseInt(_0x19f188(0x21e))/0x8+parseInt(_0x19f188(0x1cf))/0x9*(parseInt(_0x19f188(0x21c))/0xa)+parseInt(_0x19f188(0x217))/0xb*(parseInt(_0x19f188(0x1f3))/0xc);if(_0x5566eb===_0x327339)break;else _0x276267['push'](_0x276267['shift']());}catch(_0x1d74ef){_0x276267['push'](_0x276267['shift']());}}}(a0_0x2bdc,0x8d4f2));function a0_0x2bdc(){const _0x3d689e=['flex','DISPLAY_HOURS','toMillis','loserId','display','username','seconds','ignore-btn','match','79278AQwwTK','7056238JxEwTd','player','new-rank-change','firstChild','Error\x20saving\x20promotion\x20preference:','setAttribute','parentNode','setupBannerContainer','beforeunload','checkAndRecordPromotion','#C0C0C0','resolveUserId','toDateString','userDismissed','warn','promotion','dismissing','fetchInterval','userId','153846GPleRt','addEventListener','info','processRankChanges','\x27s\x20','stringify','Error\x20resolving\x20user\x20ID:','#CD7F32','ladder','Promotion\x20banner\x20container\x20not\x20found','div','log','4ATsVxr','winnerUsername','getRankName','name','loserUsername','timestamp','DOMContentLoaded','remove','ignored','style','createElement','currentUser','rankChangeModal','\x20is\x20permanently\x20ignored','length','isNewRankChange','getElementById','\x20was\x20dismissed\x20by\x20user\x20within\x20last\x20','source','newRank','Recording\x20','155zFQoOl','className','some','36niavxA','error','20tcxsPi','Bronze','classList','Silver','now','\x20for\x20','Could\x20not\x20resolve\x20username\x20for\x20userId:','A\x20player','sort','offsetWidth','innerHTML','#50C878','add','Gold','matchId','none','admin','rankAchieved','\x20to\x20','</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22rank-change-button\x22\x20id=\x22rank-change-ok-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Got\x20it!\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','bannerContainer','data','approvedMatches','target','email','setItem','appendChild','__proto__','74570PnySAr','\x20was\x20demoted\x20to','Never\x20show\x20this\x20promotion\x20again','then','promotionNotifications','Don\x27t\x20show\x20again','1534049xGRTCh','displayName','type','Congratulations!','1027686gBuDBU','220UggEwr','shouldShowPromotion','3287488yLGWmy','pollingInterval','Invalid\x20storage\x20format\x20for\x20','Error\x20writing\x20promotion\x20records:','test','children','set'];a0_0x2bdc=function(){return _0x3d689e;};return a0_0x2bdc();}const a0_0x28143b=(function(){let _0x1d8a5a=!![];return function(_0x5cc321,_0x40b424){const _0x284598=_0x1d8a5a?function(){if(_0x40b424){const _0x4f2f59=_0x40b424['apply'](_0x5cc321,arguments);return _0x40b424=null,_0x4f2f59;}}:function(){};return _0x1d8a5a=![],_0x284598;};}()),a0_0x15f586=a0_0x28143b(this,function(){const _0x3ddbd3=a0_0xc011,_0x37ba9f=function(){let _0x870c97;try{_0x870c97=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x5a4a04){_0x870c97=window;}return _0x870c97;},_0x15593b=_0x37ba9f(),_0x5a181b=_0x15593b['console']=_0x15593b['console']||{},_0x1c3c12=['log','warn',_0x3ddbd3(0x1d1),'error','exception','table','trace'];for(let _0x4fc617=0x0;_0x4fc617<_0x1c3c12['length'];_0x4fc617++){const _0x5d22dc=a0_0x28143b['constructor']['prototype']['bind'](a0_0x28143b),_0x50914b=_0x1c3c12[_0x4fc617],_0x15db9b=_0x5a181b[_0x50914b]||_0x5d22dc;_0x5d22dc[_0x3ddbd3(0x210)]=a0_0x28143b['bind'](a0_0x28143b),_0x5d22dc['toString']=_0x15db9b['toString']['bind'](_0x15db9b),_0x5a181b[_0x50914b]=_0x5d22dc;}});a0_0x15f586();import{collection,doc,query,where,orderBy,limit,getDocs,addDoc,getDoc,serverTimestamp,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{auth,db}from'./firebase-config.js';class PromotionManager{constructor(){const _0x4bd973=a0_0xc011;this['DISPLAY_HOURS']=0x18,this['RANKS']=[{'threshold':0x578,'name':_0x4bd973(0x1f6),'color':_0x4bd973(0x1d6)},{'threshold':0x640,'name':_0x4bd973(0x1f8),'color':_0x4bd973(0x1c6)},{'threshold':0x708,'name':_0x4bd973(0x202),'color':'#FFD700'},{'threshold':0x834,'name':'Emerald','color':_0x4bd973(0x200)}],this['bannerContainer']=null,this['lastFetchTime']=0x0,this['fetchInterval']=0xea60,this['pollingInterval']=null,this['usernameCache']={};}['initialize'](){const _0x3e1c37=a0_0xc011;this['bannerContainer']=document['getElementById']('promotion-banner-container');if(!this[_0x3e1c37(0x209)]){console['error'](_0x3e1c37(0x1d8));return;}this[_0x3e1c37(0x236)]();const _0x482642='promotions_checked_'+new Date()[_0x3e1c37(0x1c8)](),_0x273162=sessionStorage['getItem'](_0x482642);!_0x273162&&(this['fetchRecentPromotions'](),sessionStorage['setItem'](_0x482642,'true')),document[_0x3e1c37(0x1d0)]('visibilitychange',()=>{document['visibilityState']==='visible'&&!sessionStorage['getItem'](_0x482642)&&(this['fetchRecentPromotions'](),sessionStorage['setItem'](_0x482642,'true'));}),window[_0x3e1c37(0x1d0)](_0x3e1c37(0x237),()=>{const _0x58221b=_0x3e1c37;this[_0x58221b(0x21f)]&&clearInterval(this['pollingInterval']);});}[a0_0x4d82e6(0x236)](){const _0x29c7d6=a0_0x4d82e6;this[_0x29c7d6(0x209)][_0x29c7d6(0x1ff)]='',this['bannerContainer']['style']['display']='none';}async['fetchRecentPromotions'](){const _0x59153e=a0_0x4d82e6;try{const _0x49b0b9=Date['now']();if(_0x49b0b9-this['lastFetchTime']<this[_0x59153e(0x1cd)])return;this['lastFetchTime']=_0x49b0b9;const _0x553321=collection(db,'eloHistory'),_0x21455a=query(_0x553321,where('type','in',['promotion','demotion']),orderBy('timestamp','desc'),limit(0x14)),_0x3cda91=await getDocs(_0x21455a),_0x2a39b7=[];_0x3cda91['forEach'](_0x315b6d=>{const _0xac4693=_0x59153e,_0x1eee23={'id':_0x315b6d['id'],..._0x315b6d['data']()};this['shouldShowPromotion'](_0x315b6d['id'])&&this[_0xac4693(0x1ea)](_0x1eee23)&&_0x2a39b7['push'](_0x1eee23);}),_0x2a39b7['length']>0x0&&await this[_0x59153e(0x1d2)](_0x2a39b7);}catch(_0x420c58){console['error']('Error\x20fetching\x20promotions:',_0x420c58);}}async['processRankChanges'](_0x36da68){const _0x3551f1=a0_0x4d82e6;if(_0x36da68['length']===0x0)return;_0x36da68[_0x3551f1(0x1fd)]((_0x729243,_0x5b7054)=>{const _0x4c9c61=_0x3551f1,_0x4bb64e=_0x729243['timestamp']?.[_0x4c9c61(0x227)]?.()||_0x729243['timestamp']?.['seconds']*0x3e8||0x0,_0x557caa=_0x5b7054['timestamp']?.['toMillis']?.()||_0x5b7054['timestamp']?.[_0x4c9c61(0x22b)]*0x3e8||0x0;return _0x557caa-_0x4bb64e;});const _0xecdbec=this[_0x3551f1(0x209)]['children']['length'],_0x21815d=0x3-_0xecdbec;if(_0x21815d<=0x0)return;const _0x55e0b8=_0x36da68['slice'](0x0,_0x21815d);for(let _0x4eba20=0x0;_0x4eba20<_0x55e0b8['length'];_0x4eba20++){const _0x9ed048=_0x55e0b8[_0x4eba20],_0x1f2713=auth['currentUser'];try{setTimeout(()=>{this['showRankChangeBanner'](_0x9ed048);},_0x4eba20*0x3e8),_0x1f2713&&_0x9ed048[_0x3551f1(0x230)]===_0x1f2713['displayName']&&this['showRankChangeLightbox'](_0x9ed048['type'],_0x9ed048['rankAchieved']);}catch(_0x479f56){console[_0x3551f1(0x1f4)]('Error\x20processing\x20rank\x20change:',_0x479f56);}}}[a0_0x4d82e6(0x21d)](_0x4b4ef4){const _0x2d2bba=a0_0x4d82e6;try{const _0x5989de='promotion_'+_0x4b4ef4,_0x302500=localStorage['getItem'](_0x5989de);if(_0x302500){let _0x46f1bc;try{_0x46f1bc=JSON['parse'](_0x302500);}catch(_0x523e11){return console[_0x2d2bba(0x1ca)](_0x2d2bba(0x220)+_0x5989de+',\x20treating\x20as\x20new'),!![];}if(_0x46f1bc['ignored']===!![])return console['log']('Promotion\x20'+_0x4b4ef4+_0x2d2bba(0x1e8)),![];const _0x1a34aa=Date[_0x2d2bba(0x1f9)]();if(_0x46f1bc[_0x2d2bba(0x1c9)]&&_0x1a34aa-_0x46f1bc[_0x2d2bba(0x1e0)]<this['DISPLAY_HOURS']*0x3c*0x3c*0x3e8)return console['log']('Promotion\x20'+_0x4b4ef4+_0x2d2bba(0x1ec)+this[_0x2d2bba(0x226)]+'\x20hours'),![];if(_0x46f1bc['systemDismissed']&&_0x1a34aa-_0x46f1bc['timestamp']<0x4*0x3c*0x3c*0x3e8)return console[_0x2d2bba(0x1da)]('Promotion\x20'+_0x4b4ef4+'\x20was\x20auto-dismissed\x20within\x20last\x204\x20hours'),![];}return!![];}catch(_0x3d803c){return console['error']('Error\x20checking\x20promotion\x20visibility:',_0x3d803c),![];}}['ignorePromotion'](_0x4646dd){const _0x216025=a0_0x4d82e6;try{const _0x4b6d36='promotion_'+_0x4646dd;localStorage['setItem'](_0x4b6d36,JSON['stringify']({'timestamp':Date[_0x216025(0x1f9)](),'ignored':!![]}));}catch(_0x3f2543){console[_0x216025(0x1f4)](_0x216025(0x233),_0x3f2543);}}['showRankChangeBanner'](_0x3ccff3){const _0x3eb773=a0_0x4d82e6;this[_0x3eb773(0x1c7)](_0x3ccff3)[_0x3eb773(0x214)](_0x19f39d=>{const _0x355dd4=_0x3eb773,_0x460b1a='promotion_'+_0x3ccff3['id'],_0x49fa1d=localStorage['getItem'](_0x460b1a);if(_0x49fa1d)try{const _0x5e3fb9=JSON['parse'](_0x49fa1d);if(_0x5e3fb9[_0x355dd4(0x1e3)]===!![]){console['log']('Skipping\x20ignored\x20promotion:\x20'+_0x3ccff3['id']);return;}}catch(_0x306f1c){}localStorage['setItem'](_0x460b1a,JSON['stringify']({'timestamp':Date[_0x355dd4(0x1f9)](),'ignored':![],'userDismissed':![],'systemDismissed':![],'seenAt':Date[_0x355dd4(0x1f9)]()})),this['bannerContainer'][_0x355dd4(0x1e4)][_0x355dd4(0x229)]='block';while(this['bannerContainer']['children'][_0x355dd4(0x1e9)]>=0x3){this['bannerContainer']['removeChild'](this['bannerContainer'][_0x355dd4(0x232)]);}const _0x33d7e2=document['createElement']('div');_0x33d7e2[_0x355dd4(0x1f1)]='promotion-banner',_0x33d7e2[_0x355dd4(0x234)]('data-rank',_0x19f39d['rankAchieved']),_0x33d7e2[_0x355dd4(0x234)]('data-id',_0x19f39d['id']);const _0x1f324b=document[_0x355dd4(0x1e5)](_0x355dd4(0x1d9));_0x1f324b['className']='promotion-details';const _0x4aaf7f=_0x19f39d['resolvedName']||_0x19f39d['player']||_0x19f39d[_0x355dd4(0x22a)]||_0x19f39d['playerUsername']||_0x19f39d['displayName']||_0x355dd4(0x1fc),_0x37c957=_0x19f39d[_0x355dd4(0x219)]===_0x355dd4(0x1cb)?_0x4aaf7f+'\x20was\x20promoted\x20to':_0x4aaf7f+_0x355dd4(0x212);_0x1f324b['innerHTML']=_0x37c957+'\x20<span\x20class=\x22rank-text\x22>'+_0x19f39d[_0x355dd4(0x206)]+'</span>';const _0x1dd3bd=document[_0x355dd4(0x1e5)]('div');_0x1dd3bd[_0x355dd4(0x1f1)]='banner-actions';const _0x2be83b=document['createElement']('button');_0x2be83b[_0x355dd4(0x1f1)]='dismiss-btn',_0x2be83b['innerHTML']='&times;',_0x2be83b['title']='Dismiss';const _0x3b23fc=document['createElement']('button');_0x3b23fc['className']=_0x355dd4(0x22c),_0x3b23fc['textContent']=_0x355dd4(0x216),_0x3b23fc['title']=_0x355dd4(0x213),_0x1dd3bd['appendChild'](_0x3b23fc),_0x1dd3bd[_0x355dd4(0x20f)](_0x2be83b),_0x33d7e2['appendChild'](_0x1f324b),_0x33d7e2['appendChild'](_0x1dd3bd),this[_0x355dd4(0x209)][_0x355dd4(0x20f)](_0x33d7e2),void _0x33d7e2[_0x355dd4(0x1fe)],setTimeout(()=>{const _0x3cacb8=_0x355dd4;_0x33d7e2['classList'][_0x3cacb8(0x201)]('new-rank-change');},0x32),_0x2be83b['addEventListener']('click',()=>{const _0x1d0603=_0x355dd4;localStorage['setItem'](_0x460b1a,JSON[_0x1d0603(0x1d4)]({'timestamp':Date['now'](),'ignored':![],'userDismissed':!![],'systemDismissed':![]})),_0x33d7e2['classList']['remove']('new-rank-change'),_0x33d7e2[_0x1d0603(0x1f7)][_0x1d0603(0x201)](_0x1d0603(0x1cc)),setTimeout(()=>{const _0x1be90f=_0x1d0603;_0x33d7e2[_0x1be90f(0x235)]&&(_0x33d7e2[_0x1be90f(0x1e2)](),this[_0x1be90f(0x209)][_0x1be90f(0x223)][_0x1be90f(0x1e9)]===0x0&&(this[_0x1be90f(0x209)][_0x1be90f(0x1e4)]['display']='none'));},0x1f4);}),_0x3b23fc['addEventListener']('click',()=>{const _0x32a16c=_0x355dd4;localStorage['setItem'](_0x460b1a,JSON['stringify']({'timestamp':Date[_0x32a16c(0x1f9)](),'ignored':!![],'userDismissed':!![],'systemDismissed':![]})),_0x33d7e2['classList']['remove'](_0x32a16c(0x231)),_0x33d7e2['classList']['add']('dismissing'),setTimeout(()=>{const _0x3f6de0=_0x32a16c;_0x33d7e2['parentNode']&&(_0x33d7e2['remove'](),this['bannerContainer'][_0x3f6de0(0x223)][_0x3f6de0(0x1e9)]===0x0&&(this['bannerContainer'][_0x3f6de0(0x1e4)]['display']='none'));},0x1f4);}),setTimeout(()=>{const _0xaad32f=_0x355dd4;_0x33d7e2[_0xaad32f(0x235)]&&(_0x33d7e2[_0xaad32f(0x1f7)][_0xaad32f(0x1e2)]('new-rank-change'),_0x33d7e2[_0xaad32f(0x1f7)]['add']('dismissing'),localStorage[_0xaad32f(0x20e)](_0x460b1a,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':!![]})),setTimeout(()=>{_0x33d7e2['parentNode']&&(_0x33d7e2['remove'](),this['bannerContainer']['children']['length']===0x0&&(this['bannerContainer']['style']['display']='none'));},0x1f4));},0x3a98);});}async['resolveUserId'](_0x911d31){const _0x2ff32e=a0_0x4d82e6,_0x1c922f={..._0x911d31},_0x1db978=[_0x911d31['player'],_0x911d31[_0x2ff32e(0x22a)],_0x911d31['playerUsername'],_0x911d31['displayName']],_0x5732f3=_0x1db978[_0x2ff32e(0x1f2)](_0x1159e3=>_0x1159e3&&typeof _0x1159e3==='string'&&!_0x1159e3['includes']('ID:')&&!/^[a-zA-Z0-9]{20,}$/['test'](_0x1159e3));if(_0x5732f3)return _0x1c922f;let _0x4074c9=null;if(_0x911d31['userId'])_0x4074c9=_0x911d31[_0x2ff32e(0x1ce)];else _0x911d31['player']&&/^[A-Za-z0-9]{20,}$/[_0x2ff32e(0x222)](_0x911d31['player'])&&(_0x4074c9=_0x911d31['player']);if(!_0x4074c9)return _0x1c922f;try{const _0x48e1ec=await getDoc(doc(db,'players',_0x4074c9));if(_0x48e1ec['exists']()){const _0x1a4583=_0x48e1ec['data']();if(_0x1a4583['username'])return _0x1c922f['resolvedName']=_0x1a4583['username'],_0x1c922f;}const _0x50c47e=await getDocs(query(collection(db,'approvedMatches'),where('winnerId','==',_0x4074c9),orderBy('date','desc'),limit(0x1)));if(!_0x50c47e['empty']){const _0x31129b=_0x50c47e['docs'][0x0]['data']();if(_0x31129b['winnerUsername'])return _0x1c922f['resolvedName']=_0x31129b['winnerUsername'],_0x1c922f;}const _0x403451=await getDocs(query(collection(db,_0x2ff32e(0x20b)),where('loserId','==',_0x4074c9),orderBy('date','desc'),limit(0x1)));if(!_0x403451['empty']){const _0x5967ff=_0x403451['docs'][0x0]['data']();if(_0x5967ff[_0x2ff32e(0x1df)])return _0x1c922f['resolvedName']=_0x5967ff['loserUsername'],console['log']('Resolved\x20'+_0x4074c9+_0x2ff32e(0x207)+_0x5967ff['loserUsername']+'\x20(loser)'),_0x1c922f;}}catch(_0x18b2a1){console['error'](_0x2ff32e(0x1d5),_0x18b2a1);}return console['warn']('Failed\x20to\x20resolve\x20user\x20ID:\x20'+_0x4074c9),_0x1c922f;}['showRankChangeLightbox'](_0x4ca59a,_0x4dfa67){const _0x3a7bed=a0_0x4d82e6;let _0x157890=document['getElementById']('rankChangeModal');!_0x157890&&(_0x157890=document['createElement'](_0x3a7bed(0x1d9)),_0x157890['id']=_0x3a7bed(0x1e7),_0x157890['className']='rank-change-modal\x20'+_0x4ca59a,document['body']['appendChild'](_0x157890));const _0x1e5809=_0x4ca59a==='promotion'?_0x3a7bed(0x21a):'Rank\x20Update',_0x497ff1=_0x4ca59a===_0x3a7bed(0x1cb)?'You\x27ve\x20been\x20promoted\x20to':'You\x27ve\x20been\x20demoted\x20to';_0x157890[_0x3a7bed(0x1ff)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rank-change-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2\x20class=\x22rank-change-title\x22>'+_0x1e5809+'</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>'+_0x497ff1+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22rank-name\x22>'+_0x4dfa67+_0x3a7bed(0x208),_0x157890['style']['display']=_0x3a7bed(0x225),document[_0x3a7bed(0x1eb)]('rank-change-ok-btn')['addEventListener']('click',()=>{const _0x918830=_0x3a7bed;_0x157890['style']['display']=_0x918830(0x204);}),_0x157890[_0x3a7bed(0x1d0)]('click',_0x4b106d=>{const _0x88ce61=_0x3a7bed;_0x4b106d[_0x88ce61(0x20c)]===_0x157890&&(_0x157890['style']['display']=_0x88ce61(0x204));});}async['checkAndRecordPromotion'](_0x2d76fc,_0x1b4ce4,_0x46d78a,_0x4b3a1b={}){const _0x49d03f=a0_0x4d82e6;try{if(_0x1b4ce4===_0x46d78a||!_0x2d76fc)return null;const _0x1fead9=_0x4b3a1b['source']||'automatic',_0x6430d9=_0x4b3a1b[_0x49d03f(0x203)]||null,_0x33bf8b=_0x4b3a1b['adminUser']||null;console['log']('Processing\x20potential\x20rank\x20change:\x20'+_0x46d78a+'\x20→\x20'+_0x1b4ce4+'\x20(source:\x20'+_0x1fead9+')');let _0x2c5e98=null,_0x225a7f=null;try{const _0x2f1e23=await getDoc(doc(db,'players',_0x2d76fc));if(_0x2f1e23['exists']()){const _0x52d201=_0x2f1e23['data']();_0x2c5e98=_0x52d201['username']||_0x52d201['displayName']||null,_0x225a7f=_0x52d201[_0x49d03f(0x218)]||_0x52d201['username']||null;}!_0x2c5e98&&_0x4b3a1b['username']&&(_0x2c5e98=_0x4b3a1b['username'],_0x225a7f=_0x4b3a1b['username']);!_0x2c5e98&&auth['currentUser']&&(_0x2c5e98=auth['currentUser']['displayName']||auth[_0x49d03f(0x1e6)][_0x49d03f(0x20d)]['split']('@')[0x0],_0x225a7f=auth['currentUser']['displayName']||null);if(!_0x2c5e98){const _0x284d57=query(collection(db,'approvedMatches'),where('winnerId','==',_0x2d76fc),limit(0x1)),_0x548dcd=await getDocs(_0x284d57);if(!_0x548dcd['empty'])_0x2c5e98=_0x548dcd['docs'][0x0]['data']()[_0x49d03f(0x1dc)]||'Unknown\x20Player',_0x225a7f=_0x2c5e98;else{const _0x1e4a2f=query(collection(db,'approvedMatches'),where(_0x49d03f(0x228),'==',_0x2d76fc),limit(0x1)),_0x22378b=await getDocs(_0x1e4a2f);!_0x22378b['empty']&&(_0x2c5e98=_0x22378b[0x0][_0x49d03f(0x20a)]()['loserUsername']||'Unknown\x20Player',_0x225a7f=_0x2c5e98);}}}catch(_0x36334d){console['error']('Error\x20resolving\x20username:',_0x36334d);}!_0x2c5e98&&(console[_0x49d03f(0x1ca)](_0x49d03f(0x1fb),_0x2d76fc),_0x2c5e98=_0x49d03f(0x1fc),_0x225a7f='Unknown\x20Player');const _0x344ce2=this['getRankName'](_0x46d78a),_0x14b529=this[_0x49d03f(0x1dd)](_0x1b4ce4);if(_0x344ce2!==_0x14b529){const _0x55f2ba=_0x1b4ce4>_0x46d78a,_0x49730b=_0x55f2ba?'promotion':'demotion',_0x192d58=_0x14b529;console['log'](_0x49d03f(0x1ef)+_0x49730b+_0x49d03f(0x1fa)+_0x2c5e98+':\x20'+_0x46d78a+'\x20('+_0x344ce2+')\x20→\x20'+_0x1b4ce4+'\x20('+_0x14b529+')');try{const _0x68365a={'player':_0x2c5e98,'playerUsername':_0x2c5e98,'username':_0x2c5e98,'displayName':_0x225a7f,'userId':_0x2d76fc,'type':_0x49730b,'rankAchieved':_0x192d58,'timestamp':serverTimestamp(),'previousElo':_0x46d78a,'newElo':_0x1b4ce4,'change':_0x1b4ce4-_0x46d78a,'previousRank':_0x344ce2,'newRank':_0x14b529,'source':_0x1fead9};if(_0x1fead9===_0x49d03f(0x22d)&&_0x6430d9)_0x68365a['matchId']=_0x6430d9;else _0x1fead9==='admin'&&_0x33bf8b?(_0x68365a['modifiedBy']=_0x33bf8b,_0x68365a['isAutomatic']=![]):_0x68365a['isAutomatic']=!![];const _0x3361ee=writeBatch(db),_0x5bb24c=doc(collection(db,'eloHistory')),_0x2d961b=doc(collection(db,'promotionHistory'));return _0x3361ee['set'](_0x5bb24c,_0x68365a),_0x3361ee[_0x49d03f(0x224)](_0x2d961b,_0x68365a),await _0x3361ee['commit'](),await this['sendPromotionNotification'](_0x2d76fc,_0x2c5e98,_0x46d78a,_0x1b4ce4,_0x344ce2,_0x14b529,_0x49730b,{'displayName':_0x225a7f,'source':_0x1fead9,'matchId':_0x6430d9,'ladder':_0x4b3a1b['ladder']||'D1'}),console[_0x49d03f(0x1da)]('Successfully\x20recorded\x20'+_0x49730b+'\x20for\x20'+_0x2c5e98+_0x49d03f(0x207)+_0x192d58),_0x192d58;}catch(_0xf05f8b){console['error'](_0x49d03f(0x221),_0xf05f8b);try{return await addDoc(collection(db,'eloHistory'),{'player':_0x2c5e98,'playerUsername':_0x2c5e98,'username':_0x2c5e98,'displayName':_0x225a7f,'userId':_0x2d76fc,'type':_0x49730b,'rankAchieved':_0x192d58,'timestamp':serverTimestamp(),'previousElo':_0x46d78a,'newElo':_0x1b4ce4,'change':_0x1b4ce4-_0x46d78a,'previousRank':_0x344ce2,'source':_0x1fead9,'isAutomatic':_0x1fead9!==_0x49d03f(0x205)}),await this['sendPromotionNotification'](_0x2d76fc,_0x2c5e98,_0x46d78a,_0x1b4ce4,_0x344ce2,_0x14b529,_0x49730b,{'displayName':_0x225a7f,'source':_0x1fead9,'matchId':_0x6430d9,'ladder':_0x4b3a1b[_0x49d03f(0x1d7)]||'D1'}),_0x192d58;}catch(_0x5c75f2){return console[_0x49d03f(0x1f4)]('Fallback\x20write\x20failed:',_0x5c75f2),null;}}}return null;}catch(_0x2b510c){return console[_0x49d03f(0x1f4)]('Error\x20in\x20promotion/demotion\x20recording:',_0x2b510c),null;}}['getRankName'](_0x6e34ef){const _0x5f0339=a0_0x4d82e6;for(let _0x47d160=this['RANKS']['length']-0x1;_0x47d160>=0x0;_0x47d160--){if(_0x6e34ef>=this['RANKS'][_0x47d160]['threshold'])return this['RANKS'][_0x47d160][_0x5f0339(0x1de)];}return'Unranked';}['cleanup'](){const _0x290ced=a0_0x4d82e6;this[_0x290ced(0x21f)]&&clearInterval(this['pollingInterval']);}['isNewRankChange'](_0x5abc3f){const _0x50647d=a0_0x4d82e6;if(_0x5abc3f['timestamp']){const _0x138b02=_0x5abc3f['timestamp']['seconds']*0x3e8,_0x4368d9=Date['now'](),_0x31b8b0=(_0x4368d9-_0x138b02)/(0x3e8*0x3c*0x3c);if(_0x31b8b0>0x18)return![];}if(_0x5abc3f['previousRank']&&_0x5abc3f['newRank']&&_0x5abc3f['previousRank']!==_0x5abc3f[_0x50647d(0x1ee)])return!![];return![];}async['sendPromotionNotification'](_0x29de39,_0x1506fe,_0x26faef,_0x426d5c,_0x10abb4,_0xacc194,_0x1bcd09,_0x3f9418={}){const _0xc37bab=a0_0x4d82e6;try{console['log']('STARTING\x20notification\x20for\x20'+_0x1506fe+_0xc37bab(0x1d3)+_0x1bcd09);const _0x2b1a62={'userId':_0x29de39,'username':_0x1506fe,'displayName':_0x3f9418[_0xc37bab(0x218)]||_0x1506fe,'oldElo':parseInt(_0x26faef),'newElo':parseInt(_0x426d5c),'eloDifference':parseInt(_0x426d5c)-parseInt(_0x26faef),'oldRank':_0x10abb4,'newRank':_0xacc194,'type':_0x1bcd09,'timestamp':serverTimestamp(),'processed':![],'source':_0x3f9418[_0xc37bab(0x1ed)]||'automatic','matchId':_0x3f9418['matchId']||null,'ladder':_0x3f9418[_0xc37bab(0x1d7)]||'D1','adminUser':_0x3f9418['adminUser']||null};console[_0xc37bab(0x1da)]('Creating\x20Discord\x20notification:',_0x2b1a62);const _0x173d82=await addDoc(collection(db,_0xc37bab(0x215)),_0x2b1a62);return console[_0xc37bab(0x1da)]('Discord\x20notification\x20sent\x20successfully\x20with\x20ID:\x20'+_0x173d82['id']),!![];}catch(_0x15c224){return console['error']('Error\x20sending\x20Discord\x20notification:',_0x15c224),![];}}}export const promotionManager=new PromotionManager();function a0_0xc011(_0x638a3d,_0x43d24e){const _0x4da9b7=a0_0x2bdc();return a0_0xc011=function(_0x15f586,_0x28143b){_0x15f586=_0x15f586-0x1c5;let _0x57c969=_0x4da9b7[_0x15f586];return _0x57c969;},a0_0xc011(_0x638a3d,_0x43d24e);}document['addEventListener'](a0_0x4d82e6(0x1e1),()=>{promotionManager['initialize']();});export const initializePromotionTracker=()=>promotionManager['initialize']();export const checkAndRecordPromotion=(_0x1a0d33,_0x1a3231,_0x567a13,_0x43d045)=>promotionManager[a0_0x4d82e6(0x1c5)](_0x1a0d33,_0x1a3231,_0x567a13,_0x43d045);export const getRankName=_0x3eab9a=>promotionManager['getRankName'](_0x3eab9a);
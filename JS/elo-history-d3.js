const a13_0xa58a83=a13_0x118a,a13_0x1479d5=(function(){let _0x3fa364=!![];return function(_0xe798a0,_0x24c49f){const _0x573288=_0x3fa364?function(){if(_0x24c49f){const _0x1cc5e8=_0x24c49f['apply'](_0xe798a0,arguments);return _0x24c49f=null,_0x1cc5e8;}}:function(){};return _0x3fa364=![],_0x573288;};}()),a13_0x199ba7=a13_0x1479d5(this,function(){const _0x272c48=a13_0x118a;let _0xd5ee9f;try{const _0x201178=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0xd5ee9f=_0x201178();}catch(_0xf732c3){_0xd5ee9f=window;}const _0x286aee=_0xd5ee9f['console']=_0xd5ee9f['console']||{},_0x3bcc07=['log','warn','info','error',_0x272c48(0xa6),'table',_0x272c48(0xa9)];for(let _0x31dff8=0x0;_0x31dff8<_0x3bcc07[_0x272c48(0xa7)];_0x31dff8++){const _0x51ecdf=a13_0x1479d5[_0x272c48(0xb0)]['prototype']['bind'](a13_0x1479d5),_0x5b8aa8=_0x3bcc07[_0x31dff8],_0x3bb4f8=_0x286aee[_0x5b8aa8]||_0x51ecdf;_0x51ecdf['__proto__']=a13_0x1479d5[_0x272c48(0xa8)](a13_0x1479d5),_0x51ecdf['toString']=_0x3bb4f8['toString'][_0x272c48(0xa8)](_0x3bb4f8),_0x286aee[_0x5b8aa8]=_0x51ecdf;}});a13_0x199ba7();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc,where}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a13_0x118a(_0x4cf555,_0x4bbc2f){const _0x199ba7=a13_0x4fe7();return a13_0x118a=function(_0x1479d5,_0x1fb9d0){_0x1479d5=_0x1479d5-0x97;let _0x4fe77f=_0x199ba7[_0x1479d5];return _0x4fe77f;},a13_0x118a(_0x4cf555,_0x4bbc2f);}import{db}from'./firebase-config.js';function a13_0x4fe7(){const _0x4f830a=['timestamp','approvedMatchesD3','Unknown\x20Player','winnerId','match','Bronze','previousElo','desc','Emerald','promotion','map','data','Silver','docs','log','exception','length','bind','trace','all','empty','size','Unranked','demotion','username','constructor','eloHistoryD3','playersD3','loserId'];a13_0x4fe7=function(){return _0x4f830a;};return a13_0x4fe7();}const ELO_THRESHOLDS_D3=[{'name':'Emerald','elo':0x7d0},{'name':'Gold','elo':0x708},{'name':'Silver','elo':0x640},{'name':a13_0xa58a83(0x9c),'elo':0x578},{'name':a13_0xa58a83(0xad),'elo':0x4b0}];let lastVisibleD3=null;async function getUsernameByIdD3(_0x143344){const _0x3c56b5=a13_0xa58a83;try{if(!_0x143344)return _0x3c56b5(0x99);const _0x4c0fd6=await getDoc(doc(db,_0x3c56b5(0xb2),_0x143344));if(_0x4c0fd6['exists']())return _0x4c0fd6['data']()[_0x3c56b5(0xaf)]||_0x3c56b5(0x99);const _0x45f7e3=await getDocs(query(collection(db,'approvedMatchesD3'),where(_0x3c56b5(0x9a),'==',_0x143344),limit(0x1)));if(!_0x45f7e3['empty'])return _0x45f7e3['docs'][0x0]['data']()['winnerUsername']||'Unknown\x20Player';const _0x1eba9b=await getDocs(query(collection(db,_0x3c56b5(0x98)),where(_0x3c56b5(0xb3),'==',_0x143344),limit(0x1)));if(!_0x1eba9b[_0x3c56b5(0xab)])return _0x1eba9b[_0x3c56b5(0xa4)][0x0]['data']()['loserUsername']||'Unknown\x20Player';return'Unknown\x20Player';}catch(_0xe4c3ed){return console['error']('Error\x20getting\x20D3\x20username:',_0xe4c3ed),_0x3c56b5(0x99);}}export async function recordEloChangeD3({playerId:_0x415554,previousElo:_0x55905a,newElo:_0x2bc62a,opponentId:_0x31a27d,matchResult:_0x3ac4a7,previousPosition:_0x344cd1,newPosition:_0x2a8f04,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x238990,timestamp:_0x44013c}){const _0x4ce14f=a13_0xa58a83;try{const _0x22abf6=doc(collection(db,_0x4ce14f(0xb1)));let _0x2149bb=_0x4ce14f(0x9b);if(isPromotion)_0x2149bb=_0x4ce14f(0xa0);if(isDemotion)_0x2149bb=_0x4ce14f(0xae);let _0x95e881=_0x4ce14f(0xad);if(_0x2bc62a>=0x7d0)_0x95e881=_0x4ce14f(0x9f);else{if(_0x2bc62a>=0x708)_0x95e881='Gold';else{if(_0x2bc62a>=0x640)_0x95e881=_0x4ce14f(0xa3);else{if(_0x2bc62a>=0x578)_0x95e881='Bronze';}}}return await setDoc(_0x22abf6,{'type':_0x2149bb,'player':_0x415554,'opponent':_0x31a27d,'previousElo':_0x55905a,'newElo':_0x2bc62a,'change':_0x2bc62a-_0x55905a,'matchResult':_0x3ac4a7,'previousPosition':_0x344cd1,'newPosition':_0x2a8f04,'rankAchieved':_0x95e881,'matchId':_0x238990,'timestamp':_0x44013c||serverTimestamp(),'gameMode':'D3'}),console[_0x4ce14f(0xa5)]('D3\x20ELO\x20history\x20recorded\x20for\x20'+_0x415554),!![];}catch(_0x165905){console['error']('Error\x20recording\x20D3\x20ELO\x20history:',_0x165905);throw _0x165905;}}export async function getEloHistoryD3(_0x48e50b=0x14){const _0x108a5f=a13_0xa58a83;try{const _0x746461=collection(db,'eloHistoryD3');let _0xfe8a0a;lastVisibleD3?_0xfe8a0a=query(_0x746461,orderBy('timestamp',_0x108a5f(0x9e)),startAfter(lastVisibleD3),limit(_0x48e50b)):_0xfe8a0a=query(_0x746461,orderBy('timestamp','desc'),limit(_0x48e50b));const _0x438285=await getDocs(_0xfe8a0a);if(_0x438285['empty'])return{'entries':[],'hasMore':![]};lastVisibleD3=_0x438285['docs'][_0x438285[_0x108a5f(0xa4)][_0x108a5f(0xa7)]-0x1];const _0x22bb34=_0x438285['docs'][_0x108a5f(0xa1)](async _0x519041=>{const _0x3ba037=_0x108a5f,_0x33d590=_0x519041[_0x3ba037(0xa2)](),[_0x508a83,_0x450a08]=await Promise[_0x3ba037(0xaa)]([getUsernameByIdD3(_0x33d590['player']),getUsernameByIdD3(_0x33d590['opponent'])]);return{..._0x33d590,'playerUsername':_0x508a83,'opponentUsername':_0x450a08,'change':_0x33d590['newElo']-_0x33d590[_0x3ba037(0x9d)],'timestamp':_0x33d590[_0x3ba037(0x97)]};}),_0x116774=await Promise['all'](_0x22bb34);return{'entries':_0x116774,'hasMore':_0x438285[_0x108a5f(0xac)]===_0x48e50b};}catch(_0x3b00f6){console['error']('Error\x20fetching\x20D3\x20ELO\x20history:',_0x3b00f6);throw _0x3b00f6;}}export function resetPaginationD3(){lastVisibleD3=null;}
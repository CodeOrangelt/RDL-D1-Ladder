const a44_0x263c44=a44_0x5b66,a44_0x3dc01a=(function(){let _0x123f35=!![];return function(_0x5e76f3,_0x4308a7){const _0x15958a=_0x123f35?function(){if(_0x4308a7){const _0x3eef1c=_0x4308a7['apply'](_0x5e76f3,arguments);return _0x4308a7=null,_0x3eef1c;}}:function(){};return _0x123f35=![],_0x15958a;};}()),a44_0xbf4749=a44_0x3dc01a(this,function(){const _0x4651f9=a44_0x5b66,_0x21f292=function(){const _0x287d18=a44_0x5b66;let _0x360cc5;try{_0x360cc5=Function(_0x287d18(0x1a4)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x29f6eb){_0x360cc5=window;}return _0x360cc5;},_0x4b242e=_0x21f292(),_0x8de96f=_0x4b242e[_0x4651f9(0x173)]=_0x4b242e['console']||{},_0x4d5496=[_0x4651f9(0x175),_0x4651f9(0x1af),'info','error','exception','table','trace'];for(let _0x14ae72=0x0;_0x14ae72<_0x4d5496[_0x4651f9(0x19f)];_0x14ae72++){const _0x2c19ad=a44_0x3dc01a[_0x4651f9(0x1ae)]['prototype']['bind'](a44_0x3dc01a),_0x16d3a5=_0x4d5496[_0x14ae72],_0x5e15eb=_0x8de96f[_0x16d3a5]||_0x2c19ad;_0x2c19ad['__proto__']=a44_0x3dc01a['bind'](a44_0x3dc01a),_0x2c19ad['toString']=_0x5e15eb['toString'][_0x4651f9(0x198)](_0x5e15eb),_0x8de96f[_0x16d3a5]=_0x2c19ad;}});a44_0xbf4749();import{collection,doc,query,where,orderBy,limit,getDocs,addDoc,getDoc,serverTimestamp,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{auth,db}from'./firebase-config.js';class PromotionManager{constructor(){const _0x3bce2c=a44_0x5b66;this[_0x3bce2c(0x199)]=0x18,this[_0x3bce2c(0x1ab)]=[{'threshold':0x578,'name':'Bronze','color':'#CD7F32'},{'threshold':0x640,'name':_0x3bce2c(0x195),'color':'#C0C0C0'},{'threshold':0x708,'name':_0x3bce2c(0x1a3),'color':_0x3bce2c(0x187)},{'threshold':0x834,'name':'Emerald','color':'#50C878'}],this[_0x3bce2c(0x1ba)]=null,this['lastFetchTime']=0x0,this['fetchInterval']=0xea60,this[_0x3bce2c(0x1a2)]=null,this['usernameCache']={};}['initialize'](){const _0x846e29=a44_0x5b66;this['bannerContainer']=document['getElementById']('promotion-banner-container');if(!this['bannerContainer']){console['error']('Promotion\x20banner\x20container\x20not\x20found');return;}this['setupBannerContainer']();const _0x44695c='promotions_checked_'+new Date()['toDateString'](),_0x1b7b1b=sessionStorage[_0x846e29(0x19a)](_0x44695c);!_0x1b7b1b&&(this['fetchRecentPromotions'](),sessionStorage['setItem'](_0x44695c,_0x846e29(0x1b5))),document[_0x846e29(0x1b6)](_0x846e29(0x164),()=>{const _0x4180ee=_0x846e29;document['visibilityState']==='visible'&&!sessionStorage['getItem'](_0x44695c)&&(this['fetchRecentPromotions'](),sessionStorage['setItem'](_0x44695c,_0x4180ee(0x1b5)));}),window['addEventListener']('beforeunload',()=>{const _0xef7f85=_0x846e29;this[_0xef7f85(0x1a2)]&&clearInterval(this[_0xef7f85(0x1a2)]);});}['setupBannerContainer'](){const _0x8696a2=a44_0x5b66;this['bannerContainer'][_0x8696a2(0x1b4)]='',this[_0x8696a2(0x1ba)]['style']['display']='none';}async[a44_0x263c44(0x165)](){try{const _0x2754dc=Date['now']();if(_0x2754dc-this['lastFetchTime']<this['fetchInterval'])return;this['lastFetchTime']=_0x2754dc;const _0x520c20=collection(db,'eloHistory'),_0x546925=query(_0x520c20,where('type','in',['promotion','demotion']),orderBy('timestamp','desc'),limit(0x14)),_0x355fa8=await getDocs(_0x546925),_0x1b6dd2=[];_0x355fa8['forEach'](_0x1c532b=>{const _0x261f45=a44_0x5b66,_0x4a1cdc={'id':_0x1c532b['id'],..._0x1c532b['data']()};this['shouldShowPromotion'](_0x1c532b['id'])&&this[_0x261f45(0x1b3)](_0x4a1cdc)&&_0x1b6dd2['push'](_0x4a1cdc);}),_0x1b6dd2['length']>0x0&&await this['processRankChanges'](_0x1b6dd2);}catch(_0x1e4688){console['error']('Error\x20fetching\x20promotions:',_0x1e4688);}}async[a44_0x263c44(0x1bb)](_0x4c7858){const _0x1b9331=a44_0x263c44;if(_0x4c7858['length']===0x0)return;_0x4c7858['sort']((_0x228c1c,_0x1b580d)=>{const _0x3bc932=a44_0x5b66,_0x572505=_0x228c1c['timestamp']?.['toMillis']?.()||_0x228c1c[_0x3bc932(0x179)]?.[_0x3bc932(0x1a6)]*0x3e8||0x0,_0x412a42=_0x1b580d['timestamp']?.[_0x3bc932(0x1ac)]?.()||_0x1b580d['timestamp']?.[_0x3bc932(0x1a6)]*0x3e8||0x0;return _0x412a42-_0x572505;});const _0x8d8ac2=this[_0x1b9331(0x1ba)]['children']['length'],_0x5d3258=0x3-_0x8d8ac2;if(_0x5d3258<=0x0)return;const _0x3b16b0=_0x4c7858['slice'](0x0,_0x5d3258);for(let _0x5a8d5f=0x0;_0x5a8d5f<_0x3b16b0['length'];_0x5a8d5f++){const _0x51e659=_0x3b16b0[_0x5a8d5f],_0x2c28c8=auth['currentUser'];try{setTimeout(()=>{const _0x4ae8a5=_0x1b9331;this[_0x4ae8a5(0x18a)](_0x51e659);},_0x5a8d5f*0x3e8),_0x2c28c8&&_0x51e659['player']===_0x2c28c8[_0x1b9331(0x1b7)]&&this['showRankChangeLightbox'](_0x51e659['type'],_0x51e659[_0x1b9331(0x1b2)]);}catch(_0x519688){console['error']('Error\x20processing\x20rank\x20change:',_0x519688);}}}['shouldShowPromotion'](_0x40eba6){const _0x289658=a44_0x263c44;try{const _0x19899c='promotion_'+_0x40eba6,_0x6d7643=localStorage['getItem'](_0x19899c);if(_0x6d7643){let _0x31bb65;try{_0x31bb65=JSON['parse'](_0x6d7643);}catch(_0x158659){return console['warn']('Invalid\x20storage\x20format\x20for\x20'+_0x19899c+_0x289658(0x184)),!![];}if(_0x31bb65['ignored']===!![])return console['log']('Promotion\x20'+_0x40eba6+'\x20is\x20permanently\x20ignored'),![];const _0x44270a=Date['now']();if(_0x31bb65[_0x289658(0x1b1)]&&_0x44270a-_0x31bb65['timestamp']<this['DISPLAY_HOURS']*0x3c*0x3c*0x3e8)return console['log'](_0x289658(0x191)+_0x40eba6+_0x289658(0x18c)+this['DISPLAY_HOURS']+'\x20hours'),![];if(_0x31bb65['systemDismissed']&&_0x44270a-_0x31bb65['timestamp']<0x4*0x3c*0x3c*0x3e8)return console['log']('Promotion\x20'+_0x40eba6+'\x20was\x20auto-dismissed\x20within\x20last\x204\x20hours'),![];}return!![];}catch(_0x469eb6){return console[_0x289658(0x1a5)]('Error\x20checking\x20promotion\x20visibility:',_0x469eb6),![];}}['ignorePromotion'](_0x40d6f0){const _0x244d96=a44_0x263c44;try{const _0x277cd3=_0x244d96(0x16d)+_0x40d6f0;localStorage[_0x244d96(0x1b0)](_0x277cd3,JSON['stringify']({'timestamp':Date['now'](),'ignored':!![]}));}catch(_0x468516){console['error']('Error\x20saving\x20promotion\x20preference:',_0x468516);}}['showRankChangeBanner'](_0x1ac995){this['resolveUserId'](_0x1ac995)['then'](_0x58bd03=>{const _0x5b2eab=a44_0x5b66,_0x159c8f='promotion_'+_0x1ac995['id'],_0x185c43=localStorage['getItem'](_0x159c8f);if(_0x185c43)try{const _0x4da8b9=JSON[_0x5b2eab(0x177)](_0x185c43);if(_0x4da8b9['ignored']===!![]){console[_0x5b2eab(0x175)]('Skipping\x20ignored\x20promotion:\x20'+_0x1ac995['id']);return;}}catch(_0x149069){}localStorage[_0x5b2eab(0x1b0)](_0x159c8f,JSON['stringify']({'timestamp':Date[_0x5b2eab(0x1b9)](),'ignored':![],'userDismissed':![],'systemDismissed':![],'seenAt':Date[_0x5b2eab(0x1b9)]()})),this['bannerContainer']['style']['display']=_0x5b2eab(0x189);while(this[_0x5b2eab(0x1ba)][_0x5b2eab(0x194)]['length']>=0x3){this[_0x5b2eab(0x1ba)]['removeChild'](this[_0x5b2eab(0x1ba)]['firstChild']);}const _0x175e39=document['createElement'](_0x5b2eab(0x171));_0x175e39['className']=_0x5b2eab(0x18e),_0x175e39[_0x5b2eab(0x1a8)]('data-rank',_0x58bd03['rankAchieved']),_0x175e39[_0x5b2eab(0x1a8)]('data-id',_0x58bd03['id']);const _0x1be668=document['createElement']('div');_0x1be668['className']='promotion-details';const _0x9e6cf9=_0x58bd03['resolvedName']||_0x58bd03['player']||_0x58bd03['username']||_0x58bd03['playerUsername']||_0x58bd03['displayName']||'A\x20player',_0x6462b4=_0x58bd03['type']==='promotion'?_0x9e6cf9+_0x5b2eab(0x163):_0x9e6cf9+'\x20was\x20demoted\x20to';_0x1be668['innerHTML']=_0x6462b4+'\x20<span\x20class=\x22rank-text\x22>'+_0x58bd03['rankAchieved']+_0x5b2eab(0x16a);const _0xafb2a7=document['createElement']('div');_0xafb2a7['className']='banner-actions';const _0x5c67c0=document['createElement'](_0x5b2eab(0x18f));_0x5c67c0['className']='dismiss-btn',_0x5c67c0[_0x5b2eab(0x1b4)]='&times;',_0x5c67c0['title']='Dismiss';const _0x28e922=document['createElement'](_0x5b2eab(0x18f));_0x28e922['className']='ignore-btn',_0x28e922[_0x5b2eab(0x1bc)]='Don\x27t\x20show\x20again',_0x28e922['title']='Never\x20show\x20this\x20promotion\x20again',_0xafb2a7['appendChild'](_0x28e922),_0xafb2a7[_0x5b2eab(0x1be)](_0x5c67c0),_0x175e39['appendChild'](_0x1be668),_0x175e39['appendChild'](_0xafb2a7),this['bannerContainer']['appendChild'](_0x175e39),void _0x175e39['offsetWidth'],setTimeout(()=>{const _0x289a67=_0x5b2eab;_0x175e39[_0x289a67(0x182)]['add'](_0x289a67(0x1bd));},0x32),_0x5c67c0['addEventListener'](_0x5b2eab(0x166),()=>{const _0x233301=_0x5b2eab;localStorage['setItem'](_0x159c8f,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':!![],'systemDismissed':![]})),_0x175e39['classList'][_0x233301(0x185)]('new-rank-change'),_0x175e39[_0x233301(0x182)]['add']('dismissing'),setTimeout(()=>{const _0x57aee0=_0x233301;_0x175e39['parentNode']&&(_0x175e39['remove'](),this['bannerContainer']['children']['length']===0x0&&(this['bannerContainer'][_0x57aee0(0x16c)][_0x57aee0(0x174)]='none'));},0x1f4);}),_0x28e922['addEventListener']('click',()=>{const _0xd83503=_0x5b2eab;localStorage['setItem'](_0x159c8f,JSON['stringify']({'timestamp':Date[_0xd83503(0x1b9)](),'ignored':!![],'userDismissed':!![],'systemDismissed':![]})),_0x175e39['classList'][_0xd83503(0x185)]('new-rank-change'),_0x175e39['classList'][_0xd83503(0x1a1)]('dismissing'),setTimeout(()=>{const _0x550ef2=_0xd83503;_0x175e39['parentNode']&&(_0x175e39['remove'](),this['bannerContainer']['children']['length']===0x0&&(this[_0x550ef2(0x1ba)][_0x550ef2(0x16c)]['display']='none'));},0x1f4);}),setTimeout(()=>{const _0x3bd70a=_0x5b2eab;_0x175e39[_0x3bd70a(0x196)]&&(_0x175e39['classList'][_0x3bd70a(0x185)]('new-rank-change'),_0x175e39['classList']['add']('dismissing'),localStorage['setItem'](_0x159c8f,JSON['stringify']({'timestamp':Date[_0x3bd70a(0x1b9)](),'ignored':![],'userDismissed':![],'systemDismissed':!![]})),setTimeout(()=>{const _0x314b82=_0x3bd70a;_0x175e39['parentNode']&&(_0x175e39['remove'](),this[_0x314b82(0x1ba)]['children']['length']===0x0&&(this['bannerContainer'][_0x314b82(0x16c)]['display']=_0x314b82(0x167)));},0x1f4));},0x3a98);});}async[a44_0x263c44(0x18b)](_0x4345bf){const _0x3a38bd=a44_0x263c44,_0x57d8da={..._0x4345bf},_0x4aa53d=[_0x4345bf[_0x3a38bd(0x188)],_0x4345bf['username'],_0x4345bf['playerUsername'],_0x4345bf['displayName']],_0x4422b0=_0x4aa53d['some'](_0x318711=>_0x318711&&typeof _0x318711===_0x3a38bd(0x180)&&!_0x318711['includes']('ID:')&&!/^[a-zA-Z0-9]{20,}$/['test'](_0x318711));if(_0x4422b0)return _0x57d8da;let _0x153fb5=null;if(_0x4345bf[_0x3a38bd(0x197)])_0x153fb5=_0x4345bf[_0x3a38bd(0x197)];else _0x4345bf['player']&&/^[A-Za-z0-9]{20,}$/[_0x3a38bd(0x183)](_0x4345bf[_0x3a38bd(0x188)])&&(_0x153fb5=_0x4345bf['player']);if(!_0x153fb5)return _0x57d8da;try{const _0x3a6487=await getDoc(doc(db,'players',_0x153fb5));if(_0x3a6487['exists']()){const _0x1dbc39=_0x3a6487[_0x3a38bd(0x19e)]();if(_0x1dbc39['username'])return _0x57d8da['resolvedName']=_0x1dbc39['username'],_0x57d8da;}const _0x107b30=await getDocs(query(collection(db,'approvedMatches'),where('winnerId','==',_0x153fb5),orderBy('date','desc'),limit(0x1)));if(!_0x107b30['empty']){const _0x62433a=_0x107b30['docs'][0x0][_0x3a38bd(0x19e)]();if(_0x62433a[_0x3a38bd(0x1a0)])return _0x57d8da['resolvedName']=_0x62433a[_0x3a38bd(0x1a0)],_0x57d8da;}const _0x570dbf=await getDocs(query(collection(db,'approvedMatches'),where('loserId','==',_0x153fb5),orderBy('date','desc'),limit(0x1)));if(!_0x570dbf['empty']){const _0x23daaa=_0x570dbf[_0x3a38bd(0x190)][0x0]['data']();if(_0x23daaa['loserUsername'])return _0x57d8da['resolvedName']=_0x23daaa[_0x3a38bd(0x16f)],console[_0x3a38bd(0x175)]('Resolved\x20'+_0x153fb5+'\x20to\x20'+_0x23daaa['loserUsername']+'\x20(loser)'),_0x57d8da;}}catch(_0x404a05){console[_0x3a38bd(0x1a5)]('Error\x20resolving\x20user\x20ID:',_0x404a05);}return console[_0x3a38bd(0x1af)]('Failed\x20to\x20resolve\x20user\x20ID:\x20'+_0x153fb5),_0x57d8da;}['showRankChangeLightbox'](_0x25dd2a,_0x516771){const _0x1fc184=a44_0x263c44;let _0x58debd=document[_0x1fc184(0x172)]('rankChangeModal');!_0x58debd&&(_0x58debd=document[_0x1fc184(0x18d)](_0x1fc184(0x171)),_0x58debd['id']='rankChangeModal',_0x58debd['className']=_0x1fc184(0x181)+_0x25dd2a,document['body'][_0x1fc184(0x1be)](_0x58debd));const _0x2a38ad=_0x25dd2a===_0x1fc184(0x19d)?'Congratulations!':'Rank\x20Update',_0x47ea40=_0x25dd2a===_0x1fc184(0x19d)?'You\x27ve\x20been\x20promoted\x20to':_0x1fc184(0x1ad);_0x58debd[_0x1fc184(0x1b4)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rank-change-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2\x20class=\x22rank-change-title\x22>'+_0x2a38ad+'</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>'+_0x47ea40+_0x1fc184(0x193)+_0x516771+_0x1fc184(0x192),_0x58debd[_0x1fc184(0x16c)][_0x1fc184(0x174)]='flex',document['getElementById']('rank-change-ok-btn')[_0x1fc184(0x1b6)](_0x1fc184(0x166),()=>{const _0x418527=_0x1fc184;_0x58debd['style'][_0x418527(0x174)]='none';}),_0x58debd['addEventListener'](_0x1fc184(0x166),_0x1b236b=>{const _0x3a73be=_0x1fc184;_0x1b236b['target']===_0x58debd&&(_0x58debd['style'][_0x3a73be(0x174)]='none');});}async['checkAndRecordPromotion'](_0x17dfaa,_0x4c91e6,_0x47c4de,_0x4aba27={}){const _0x4d02f5=a44_0x263c44;try{if(_0x4c91e6===_0x47c4de||!_0x17dfaa)return null;const _0x4744d3=_0x4aba27['source']||'automatic',_0x229fea=_0x4aba27['matchId']||null,_0x3456d2=_0x4aba27['adminUser']||null;console['log'](_0x4d02f5(0x17f)+_0x47c4de+'\x20→\x20'+_0x4c91e6+_0x4d02f5(0x16b)+_0x4744d3+')');let _0x4f5f76=null,_0x270a0b=null;try{const _0x2415d1=await getDoc(doc(db,_0x4d02f5(0x19b),_0x17dfaa));if(_0x2415d1['exists']()){const _0x410d23=_0x2415d1['data']();_0x4f5f76=_0x410d23['username']||_0x410d23['displayName']||null,_0x270a0b=_0x410d23['displayName']||_0x410d23['username']||null;}!_0x4f5f76&&_0x4aba27['username']&&(_0x4f5f76=_0x4aba27[_0x4d02f5(0x178)],_0x270a0b=_0x4aba27['username']);!_0x4f5f76&&auth['currentUser']&&(_0x4f5f76=auth['currentUser'][_0x4d02f5(0x1b7)]||auth['currentUser'][_0x4d02f5(0x17d)]['split']('@')[0x0],_0x270a0b=auth[_0x4d02f5(0x17e)]['displayName']||null);if(!_0x4f5f76){const _0x13471a=query(collection(db,'approvedMatches'),where(_0x4d02f5(0x1b8),'==',_0x17dfaa),limit(0x1)),_0x486cec=await getDocs(_0x13471a);if(!_0x486cec['empty'])_0x4f5f76=_0x486cec['docs'][0x0]['data']()['winnerUsername']||'Unknown\x20Player',_0x270a0b=_0x4f5f76;else{const _0x19c44d=query(collection(db,'approvedMatches'),where(_0x4d02f5(0x168),'==',_0x17dfaa),limit(0x1)),_0x5e50e8=await getDocs(_0x19c44d);!_0x5e50e8['empty']&&(_0x4f5f76=_0x5e50e8[0x0]['data']()['loserUsername']||'Unknown\x20Player',_0x270a0b=_0x4f5f76);}}}catch(_0x238063){console[_0x4d02f5(0x1a5)]('Error\x20resolving\x20username:',_0x238063);}!_0x4f5f76&&(console['warn']('Could\x20not\x20resolve\x20username\x20for\x20userId:',_0x17dfaa),_0x4f5f76='A\x20player',_0x270a0b='Unknown\x20Player');const _0x5bd3ce=this['getRankName'](_0x47c4de),_0x5878a9=this[_0x4d02f5(0x1a7)](_0x4c91e6);if(_0x5bd3ce!==_0x5878a9){const _0x9b06cd=_0x4c91e6>_0x47c4de,_0x5517a9=_0x9b06cd?'promotion':_0x4d02f5(0x17a),_0x1a4ffd=_0x5878a9;console['log']('Recording\x20'+_0x5517a9+'\x20for\x20'+_0x4f5f76+':\x20'+_0x47c4de+'\x20('+_0x5bd3ce+_0x4d02f5(0x169)+_0x4c91e6+'\x20('+_0x5878a9+')');try{const _0x54a59a={'player':_0x4f5f76,'playerUsername':_0x4f5f76,'username':_0x4f5f76,'displayName':_0x270a0b,'userId':_0x17dfaa,'type':_0x5517a9,'rankAchieved':_0x1a4ffd,'timestamp':serverTimestamp(),'previousElo':_0x47c4de,'newElo':_0x4c91e6,'change':_0x4c91e6-_0x47c4de,'previousRank':_0x5bd3ce,'newRank':_0x5878a9,'source':_0x4744d3};if(_0x4744d3==='match'&&_0x229fea)_0x54a59a['matchId']=_0x229fea;else _0x4744d3===_0x4d02f5(0x16e)&&_0x3456d2?(_0x54a59a['modifiedBy']=_0x3456d2,_0x54a59a['isAutomatic']=![]):_0x54a59a[_0x4d02f5(0x186)]=!![];const _0x47c925=writeBatch(db),_0xb619d6=doc(collection(db,'eloHistory')),_0x458cd4=doc(collection(db,'promotionHistory'));return _0x47c925['set'](_0xb619d6,_0x54a59a),_0x47c925['set'](_0x458cd4,_0x54a59a),await _0x47c925[_0x4d02f5(0x17b)](),await this['sendPromotionNotification'](_0x17dfaa,_0x4f5f76,_0x47c4de,_0x4c91e6,_0x5bd3ce,_0x5878a9,_0x5517a9,{'displayName':_0x270a0b,'source':_0x4744d3,'matchId':_0x229fea,'ladder':_0x4aba27[_0x4d02f5(0x176)]||'D1'}),console['log']('Successfully\x20recorded\x20'+_0x5517a9+_0x4d02f5(0x19c)+_0x4f5f76+'\x20to\x20'+_0x1a4ffd),_0x1a4ffd;}catch(_0x23fd85){console[_0x4d02f5(0x1a5)]('Error\x20writing\x20promotion\x20records:',_0x23fd85);try{return await addDoc(collection(db,'eloHistory'),{'player':_0x4f5f76,'playerUsername':_0x4f5f76,'username':_0x4f5f76,'displayName':_0x270a0b,'userId':_0x17dfaa,'type':_0x5517a9,'rankAchieved':_0x1a4ffd,'timestamp':serverTimestamp(),'previousElo':_0x47c4de,'newElo':_0x4c91e6,'change':_0x4c91e6-_0x47c4de,'previousRank':_0x5bd3ce,'source':_0x4744d3,'isAutomatic':_0x4744d3!=='admin'}),await this['sendPromotionNotification'](_0x17dfaa,_0x4f5f76,_0x47c4de,_0x4c91e6,_0x5bd3ce,_0x5878a9,_0x5517a9,{'displayName':_0x270a0b,'source':_0x4744d3,'matchId':_0x229fea,'ladder':_0x4aba27['ladder']||'D1'}),_0x1a4ffd;}catch(_0x13518c){return console['error']('Fallback\x20write\x20failed:',_0x13518c),null;}}}return null;}catch(_0x3a5476){return console[_0x4d02f5(0x1a5)](_0x4d02f5(0x1aa),_0x3a5476),null;}}[a44_0x263c44(0x1a7)](_0x3c905e){for(let _0x4a41d6=this['RANKS']['length']-0x1;_0x4a41d6>=0x0;_0x4a41d6--){if(_0x3c905e>=this['RANKS'][_0x4a41d6]['threshold'])return this['RANKS'][_0x4a41d6]['name'];}return'Unranked';}['cleanup'](){const _0x4fb34c=a44_0x263c44;this['pollingInterval']&&clearInterval(this[_0x4fb34c(0x1a2)]);}[a44_0x263c44(0x1b3)](_0x344673){const _0x4bc505=a44_0x263c44;if(_0x344673['timestamp']){const _0x3bb824=_0x344673['timestamp']['seconds']*0x3e8,_0x35b4fb=Date['now'](),_0x2b23c7=(_0x35b4fb-_0x3bb824)/(0x3e8*0x3c*0x3c);if(_0x2b23c7>0x18)return![];}if(_0x344673['previousRank']&&_0x344673['newRank']&&_0x344673[_0x4bc505(0x1a9)]!==_0x344673['newRank'])return!![];return![];}async['sendPromotionNotification'](_0x576c2f,_0x375b93,_0x43a0ff,_0x25fb08,_0x1a0a7f,_0x5a4456,_0x52b907,_0x191c3e={}){const _0x12dee5=a44_0x263c44;try{console['log']('STARTING\x20notification\x20for\x20'+_0x375b93+'\x27s\x20'+_0x52b907);const _0x36d14f={'userId':_0x576c2f,'username':_0x375b93,'displayName':_0x191c3e['displayName']||_0x375b93,'oldElo':parseInt(_0x43a0ff),'newElo':parseInt(_0x25fb08),'eloDifference':parseInt(_0x25fb08)-parseInt(_0x43a0ff),'oldRank':_0x1a0a7f,'newRank':_0x5a4456,'type':_0x52b907,'timestamp':serverTimestamp(),'processed':![],'source':_0x191c3e['source']||'automatic','matchId':_0x191c3e['matchId']||null,'ladder':_0x191c3e[_0x12dee5(0x176)]||'D1','adminUser':_0x191c3e['adminUser']||null};console['log']('Creating\x20Discord\x20notification:',_0x36d14f);const _0x3b5162=await addDoc(collection(db,'promotionNotifications'),_0x36d14f);return console['log'](_0x12dee5(0x170)+_0x3b5162['id']),!![];}catch(_0x4af06f){return console[_0x12dee5(0x1a5)]('Error\x20sending\x20Discord\x20notification:',_0x4af06f),![];}}}export const promotionManager=new PromotionManager();function a44_0x2c24(){const _0x44241d=['\x20was\x20promoted\x20to','visibilitychange','fetchRecentPromotions','click','none','loserId',')\x20→\x20','</span>','\x20(source:\x20','style','promotion_','admin','loserUsername','Discord\x20notification\x20sent\x20successfully\x20with\x20ID:\x20','div','getElementById','console','display','log','ladder','parse','username','timestamp','demotion','commit','DOMContentLoaded','email','currentUser','Processing\x20potential\x20rank\x20change:\x20','string','rank-change-modal\x20','classList','test',',\x20treating\x20as\x20new','remove','isAutomatic','#FFD700','player','block','showRankChangeBanner','resolveUserId','\x20was\x20dismissed\x20by\x20user\x20within\x20last\x20','createElement','promotion-banner','button','docs','Promotion\x20','</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22rank-change-button\x22\x20id=\x22rank-change-ok-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Got\x20it!\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22rank-name\x22>','children','Silver','parentNode','userId','bind','DISPLAY_HOURS','getItem','players','\x20for\x20','promotion','data','length','winnerUsername','add','pollingInterval','Gold','return\x20(function()\x20','error','seconds','getRankName','setAttribute','previousRank','Error\x20in\x20promotion/demotion\x20recording:','RANKS','toMillis','You\x27ve\x20been\x20demoted\x20to','constructor','warn','setItem','userDismissed','rankAchieved','isNewRankChange','innerHTML','true','addEventListener','displayName','winnerId','now','bannerContainer','processRankChanges','textContent','new-rank-change','appendChild'];a44_0x2c24=function(){return _0x44241d;};return a44_0x2c24();}document[a44_0x263c44(0x1b6)](a44_0x263c44(0x17c),()=>{promotionManager['initialize']();});function a44_0x5b66(_0x1a2e27,_0x1d7302){const _0xbf4749=a44_0x2c24();return a44_0x5b66=function(_0x3dc01a,_0x50fa19){_0x3dc01a=_0x3dc01a-0x163;let _0x2c241e=_0xbf4749[_0x3dc01a];return _0x2c241e;},a44_0x5b66(_0x1a2e27,_0x1d7302);}export const initializePromotionTracker=()=>promotionManager['initialize']();export const checkAndRecordPromotion=(_0x157969,_0x8432f0,_0x296356,_0x37c375)=>promotionManager['checkAndRecordPromotion'](_0x157969,_0x8432f0,_0x296356,_0x37c375);export const getRankName=_0x5c2d93=>promotionManager['getRankName'](_0x5c2d93);
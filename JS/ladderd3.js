const a31_0xe9aa30=a31_0x2bb7,a31_0xff5efe=(function(){let _0x52d6fc=!![];return function(_0x529b92,_0x107338){const _0x493005=_0x52d6fc?function(){const _0x580683=a31_0x2bb7;if(_0x107338){const _0x113208=_0x107338[_0x580683(0x197)](_0x529b92,arguments);return _0x107338=null,_0x113208;}}:function(){};return _0x52d6fc=![],_0x493005;};}()),a31_0x2adae9=a31_0xff5efe(this,function(){const _0xfba86d=a31_0x2bb7;let _0x396c75;try{const _0x1efc08=Function('return\x20(function()\x20'+_0xfba86d(0x189)+');');_0x396c75=_0x1efc08();}catch(_0x36ced8){_0x396c75=window;}const _0x473b61=_0x396c75['console']=_0x396c75[_0xfba86d(0x174)]||{},_0x32758d=[_0xfba86d(0x1a2),'warn','info','error','exception','table','trace'];for(let _0x5a1362=0x0;_0x5a1362<_0x32758d[_0xfba86d(0x184)];_0x5a1362++){const _0x2ff42c=a31_0xff5efe[_0xfba86d(0x17e)][_0xfba86d(0x180)]['bind'](a31_0xff5efe),_0x351185=_0x32758d[_0x5a1362],_0x18cac2=_0x473b61[_0x351185]||_0x2ff42c;_0x2ff42c['__proto__']=a31_0xff5efe[_0xfba86d(0x1a8)](a31_0xff5efe),_0x2ff42c[_0xfba86d(0x18b)]=_0x18cac2['toString'][_0xfba86d(0x1a8)](_0x18cac2),_0x473b61[_0x351185]=_0x2ff42c;}});a31_0x2adae9();import{collection,getDocs,doc,getDoc,query,where,updateDoc,Timestamp,orderBy,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';function a31_0x2bb7(_0x19c196,_0x285e5e){const _0x2adae9=a31_0x7495();return a31_0x2bb7=function(_0xff5efe,_0x1da7c7){_0xff5efe=_0xff5efe-0x170;let _0x7495ed=_0x2adae9[_0xff5efe];return _0x7495ed;},a31_0x2bb7(_0x19c196,_0x285e5e);}import a31_0x521588 from'./firebase-idle-wrapper.js';import{getTokensByUsernames,getPrimaryDisplayToken,clearTokenCache}from'./tokens.js';const styleEl=document[a31_0xe9aa30(0x18c)]('style');styleEl['textContent']='\x0a\x20\x20.streak-indicator\x20{\x0a\x20\x20\x20\x20font-size:\x200.9em;\x0a\x20\x20\x20\x20color:\x20#FF4500;\x0a\x20\x20\x20\x20margin-left:\x205px;\x0a\x20\x20\x20\x20font-weight:\x20bold;\x0a\x20\x20}\x0a',document[a31_0xe9aa30(0x185)]['appendChild'](styleEl);const playerCacheD3={'data':null,'timestamp':0x0},CACHE_DURATION=0x7530;async function displayLadderD3(_0x8bf89f=![]){const _0x310f3c=a31_0xe9aa30,_0x354acd=document['querySelector']('#ladder-d3\x20tbody');if(!_0x354acd){console[_0x310f3c(0x1aa)](_0x310f3c(0x17f));return;}_0x354acd['innerHTML']='<tr><td\x20colspan=\x228\x22\x20class=\x22loading-cell\x22>Loading\x20D3\x20ladder\x20data...</td></tr>';try{const _0x4bdf2f=Date['now']();if(!_0x8bf89f&&playerCacheD3['data']&&_0x4bdf2f-playerCacheD3['timestamp']<CACHE_DURATION){updateLadderDisplayD3(playerCacheD3['data']);return;}const _0x2c2cc5=collection(db,'playersD3'),_0xfe7b9b=await getDocs(_0x2c2cc5),_0x4ceb02=[];_0xfe7b9b['forEach'](_0x21ecab=>{const _0x2f5e6a=_0x310f3c,_0x57337f=_0x21ecab[_0x2f5e6a(0x19a)]();_0x57337f['username']&&_0x4ceb02['push']({..._0x57337f,'id':_0x21ecab['id'],'elo':_0x57337f['eloRating']||0x0,'position':_0x57337f['position']||Number['MAX_SAFE_INTEGER']});});const _0x532118=collection(db,'userProfiles'),_0x46dd38=await getDocs(_0x532118),_0x216d68=new Map();_0x46dd38['forEach'](_0x1c18da=>{const _0x265a00=_0x310f3c,_0x1beeea=_0x1c18da['data']();_0x1beeea[_0x265a00(0x18f)]&&_0x216d68[_0x265a00(0x1a7)](_0x1beeea['username'][_0x265a00(0x170)](),_0x1beeea);});for(const _0x20aba8 of _0x4ceb02){const _0x5eb645=_0x20aba8['username']['toLowerCase']();if(_0x216d68['has'](_0x5eb645)){const _0x5c5dc1=_0x216d68['get'](_0x5eb645);_0x5c5dc1['country']&&(_0x20aba8['country']=_0x5c5dc1['country']['toLowerCase']());}}const _0x2b1048=_0x4ceb02['map'](_0x51b03c=>_0x51b03c['username']),_0x3381ba=await fetchBatchMatchStatsD3(_0x2b1048);_0x4ceb02['sort']((_0x2cb32,_0x47261f)=>{const _0x2f0990=_0x310f3c,_0x1f923d=_0x3381ba['get'](_0x2cb32[_0x2f0990(0x18f)])?.['totalMatches']||0x0,_0x430134=_0x3381ba['get'](_0x47261f[_0x2f0990(0x18f)])?.['totalMatches']||0x0;if(_0x1f923d===0x0!==(_0x430134===0x0))return _0x1f923d===0x0?0x1:-0x1;return(_0x2cb32['position']||0x3e7)-(_0x47261f['position']||0x3e7);}),_0x4ceb02[_0x310f3c(0x177)]((_0xa9c1da,_0x4cf14b)=>{_0xa9c1da['position']=_0x4cf14b+0x1;}),playerCacheD3['data']=_0x4ceb02,playerCacheD3['timestamp']=_0x4bdf2f,updateLadderDisplayD3(_0x4ceb02);}catch(_0x2796aa){console['error']('Error\x20loading\x20D3\x20ladder:',_0x2796aa),_0x354acd['innerHTML']=_0x310f3c(0x176)+_0x2796aa[_0x310f3c(0x194)]+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';}}function a31_0x7495(){const _0x49724b=['toLowerCase','firstPlaceDate','previousElo','\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20class=\x22player-flag\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20style=\x22margin-left:\x205px;\x20vertical-align:\x20middle;\x20width:\x2020px;\x20height:\x20auto;\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20onerror=\x22this.style.display=\x27none\x27\x22>','console','Error\x20updating\x20D3\x20ELO\x20trend\x20indicators:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20colspan=\x228\x22\x20style=\x22text-align:\x20center;\x20color:\x20red;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Error\x20loading\x20D3\x20ladder\x20data:\x20','forEach','desc','totalDeaths','.png\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20alt=\x22','color','newElo','playersD3','constructor','D3\x20Ladder\x20table\x20body\x20not\x20found','prototype','eloHistoryD3','#ladder-d3\x20thead\x20tr','\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20class=\x22player-token\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20title=\x22','length','head','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td\x20style=\x22color:\x20','&ladder=d3\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20style=\x22color:\x20','push','{}.constructor(\x22return\x20this\x22)(\x20)','catch','toString','createElement','includes','%</td>\x0a\x20\x20\x20\x20</tr>','username','function','totalMatches','tokenName','\x0a\x20\x20\x20\x20<tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>','message','displayLadderD3\x20function\x20not\x20available','then','apply','approvedMatchesD3','position','data','ceil','totalKills','winRate','toDate','#4CAF50','playerUsername','losses','log','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22trend-indicator\x22\x20style=\x22margin-left:\x205px;\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>','sort','player','#50C878','set','bind','timestamp','error','get','\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20alt=\x22'];a31_0x7495=function(){return _0x49724b;};return a31_0x7495();}function calculateStreakDays(_0xddabe4){const _0x73f4a5=a31_0xe9aa30;if(!_0xddabe4)return 0x0;const _0x53b101=_0xddabe4[_0x73f4a5(0x19e)](),_0x4a68c5=new Date(),_0x422835=Math['abs'](_0x4a68c5-_0x53b101);return Math[_0x73f4a5(0x19b)](_0x422835/(0x3e8*0x3c*0x3c*0x18));}async function updatePlayerPositions(_0x5efd5e,_0x3c80d8){const _0x7fb978=a31_0xe9aa30;try{const _0x50a95c=collection(db,'playersD3'),_0x514961=await getDocs(_0x50a95c),_0x5c472b=[];_0x514961['forEach'](_0x8370e8=>{_0x5c472b['push']({'id':_0x8370e8['id'],..._0x8370e8['data']()});});const _0x20219d=_0x5c472b['find'](_0x17718b=>_0x17718b['username']===_0x5efd5e),_0x417ae8=_0x5c472b['find'](_0x15d7b4=>_0x15d7b4['username']===_0x3c80d8);if(!_0x20219d||!_0x417ae8){console['error']('Could\x20not\x20find\x20winner\x20or\x20loser\x20in\x20D3\x20players\x20list');return;}if(_0x20219d[_0x7fb978(0x199)]>_0x417ae8['position']){const _0x1974cc=_0x417ae8['position'];for(const _0x4c4260 of _0x5c472b){_0x4c4260[_0x7fb978(0x199)]>=_0x417ae8['position']&&_0x4c4260['position']<_0x20219d['position']&&_0x4c4260['username']!==_0x5efd5e&&await updateDoc(doc(db,'playersD3',_0x4c4260['id']),{'position':_0x4c4260[_0x7fb978(0x199)]+0x1});}await updateDoc(doc(db,_0x7fb978(0x17d),_0x20219d['id']),{'position':_0x1974cc});if(_0x1974cc===0x1){const _0x3bbf57=doc(db,'playersD3',_0x20219d['id']),_0x50a4b0=await getDoc(_0x3bbf57);!_0x50a4b0[_0x7fb978(0x19a)]()[_0x7fb978(0x171)]&&await updateDoc(_0x3bbf57,{'firstPlaceDate':Timestamp['now']()});}if(_0x417ae8[_0x7fb978(0x199)]===0x1){const _0x3434d6=doc(db,'playersD3',_0x417ae8['id']);await updateDoc(_0x3434d6,{'firstPlaceDate':null});}playerCacheD3['timestamp']=0x0;}}catch(_0x5e4d43){console['error']('Error\x20updating\x20D3\x20player\x20positions:',_0x5e4d43);}}async function updateLadderDisplayD3(_0x5e9e7c){const _0x41d3b4=a31_0xe9aa30;_0x5e9e7c[_0x41d3b4(0x1a4)]((_0x50bd18,_0x597bbf)=>_0x50bd18['position']-_0x597bbf['position']);const _0x3408ae=document['querySelector']('#ladder-d3\x20tbody');if(!_0x3408ae)return;_0x3408ae['innerHTML']='';const _0x4307af=_0x5e9e7c['map'](_0x52980f=>_0x52980f['username']),_0x3da578=await fetchBatchMatchStatsD3(_0x4307af);let _0xcc891b=new Map();try{typeof clearTokenCache===_0x41d3b4(0x190)&&clearTokenCache(),_0xcc891b=await getTokensByUsernames(_0x4307af);}catch(_0xa94f66){console['error']('D3:\x20Error\x20fetching\x20tokens:',_0xa94f66);}const _0x4e7a18=document['querySelector'](_0x41d3b4(0x182));_0x4e7a18&&(_0x4e7a18['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Rank</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Username</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>ELO</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Matches</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Wins</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Losses</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>K/D</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Win\x20Rate</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20');const _0x5a0bb7=_0x5e9e7c['map'](_0x3d5a8d=>{const _0x5a1a36=_0x41d3b4,_0x5131b=_0x3da578['get'](_0x3d5a8d['username'])||{'totalMatches':0x0,'wins':0x0,'losses':0x0,'kda':0x0,'winRate':0x0,'totalKills':0x0,'totalDeaths':0x0},_0x381c36=_0xcc891b['get'](_0x3d5a8d[_0x5a1a36(0x18f)])||[],_0x100e8b=getPrimaryDisplayToken(_0x381c36);return createPlayerRowD3(_0x3d5a8d,_0x5131b,_0x100e8b);})['join']('');_0x3408ae['innerHTML']=_0x5a0bb7,getPlayersLastEloChangesD3(_0x4307af)[_0x41d3b4(0x196)](_0x321aab=>{const _0x5b9a56=_0x41d3b4,_0x27fcd0=new Map();_0x3408ae['querySelectorAll']('tr')[_0x5b9a56(0x177)]((_0x1d9814,_0x2dee0d)=>{_0x2dee0d<_0x4307af['length']&&_0x27fcd0['set'](_0x4307af[_0x2dee0d],_0x1d9814);}),_0x321aab['forEach']((_0x141b6d,_0x45358a)=>{const _0x5e0890=_0x5b9a56,_0x16813b=_0x27fcd0['get'](_0x45358a);if(_0x16813b&&_0x141b6d!==0x0){const _0x11342f=_0x16813b['querySelector']('td:nth-child(3)');if(_0x11342f){const _0x1b5ce5=_0x141b6d>0x0?'+'+_0x141b6d:''+_0x141b6d,_0x5a2bdd=_0x11342f['querySelector']('.trend-indicator');_0x5a2bdd&&(_0x5a2bdd['textContent']=_0x1b5ce5,_0x5a2bdd['style'][_0x5e0890(0x17b)]=_0x141b6d>0x0?_0x5e0890(0x19f):'#F44336',_0x5a2bdd['style']['fontWeight']='bold',_0x5a2bdd['style']['fontSize']='0.85em',_0x5a2bdd['style']['display']='inline',_0x5a2bdd['style']['visibility']='visible',_0x5a2bdd['style']['opacity']='1');}}});})[_0x41d3b4(0x18a)](_0x28de31=>console[_0x41d3b4(0x1aa)](_0x41d3b4(0x175),_0x28de31));}async function fetchBatchMatchStatsD3(_0xfb9c33){const _0x4514ec=a31_0xe9aa30,_0x4528f8=new Map();try{_0xfb9c33[_0x4514ec(0x177)](_0x1da7b7=>{_0x4528f8['set'](_0x1da7b7,{'totalMatches':0x0,'wins':0x0,'losses':0x0,'totalKills':0x0,'totalDeaths':0x0,'kda':0x0,'winRate':0x0});});const _0x25eb50=collection(db,_0x4514ec(0x198)),_0x320c48=await getDocs(_0x25eb50);_0x320c48['forEach'](_0x106783=>{const _0x4477fd=_0x4514ec,_0x1bc9fc=_0x106783['data'](),_0x1eafca=_0x1bc9fc['winnerUsername'],_0x55ed1a=_0x1bc9fc['loserUsername'];if(_0xfb9c33[_0x4477fd(0x18d)](_0x1eafca)){const _0x36f6f2=_0x4528f8[_0x4477fd(0x1ab)](_0x1eafca);_0x36f6f2['wins']++,_0x36f6f2['totalMatches']++,_0x36f6f2['totalKills']+=parseInt(_0x1bc9fc['winnerScore'])||0x0,_0x36f6f2['totalDeaths']+=parseInt(_0x1bc9fc['loserScore'])||0x0;}if(_0xfb9c33['includes'](_0x55ed1a)){const _0x222f68=_0x4528f8[_0x4477fd(0x1ab)](_0x55ed1a);_0x222f68[_0x4477fd(0x1a1)]++,_0x222f68['totalMatches']++,_0x222f68[_0x4477fd(0x19c)]+=parseInt(_0x1bc9fc['loserScore'])||0x0,_0x222f68['totalDeaths']+=parseInt(_0x1bc9fc['winnerScore'])||0x0;}}),_0xfb9c33[_0x4514ec(0x177)](_0x4081ea=>{const _0x3ab46a=_0x4514ec,_0x255806=_0x4528f8['get'](_0x4081ea);_0x255806['kda']=_0x255806['totalDeaths']>0x0?(_0x255806['totalKills']/_0x255806[_0x3ab46a(0x179)])['toFixed'](0x2):_0x255806['totalKills'],_0x255806[_0x3ab46a(0x19d)]=_0x255806['totalMatches']>0x0?(_0x255806['wins']/_0x255806[_0x3ab46a(0x191)]*0x64)['toFixed'](0x1):0x0;});}catch(_0x2eb274){console['error']('Error\x20fetching\x20batch\x20match\x20stats\x20for\x20D3:',_0x2eb274);}return _0x4528f8;}function createPlayerRowD3(_0x52011c,_0x3ecf55,_0x50928b){const _0x24be35=a31_0xe9aa30,_0x5c5010=parseFloat(_0x52011c['elo'])||0x0;let _0x2393cf='gray';if(_0x5c5010>=0x7d0)_0x2393cf=_0x24be35(0x1a6);else{if(_0x5c5010>=0x708)_0x2393cf='#FFD700';else{if(_0x5c5010>=0x640)_0x2393cf='#b9f1fc';else _0x5c5010>=0x578&&(_0x2393cf='#CD7F32');}}let _0x21a271='';_0x52011c['country']&&(_0x21a271='<img\x20src=\x22../images/flags/'+_0x52011c['country']['toLowerCase']()+_0x24be35(0x17a)+_0x52011c['country']+_0x24be35(0x173));let _0x1aa7d9='';return _0x50928b&&(_0x1aa7d9='<img\x20src=\x22'+_0x50928b['tokenImage']+_0x24be35(0x1ac)+_0x50928b[_0x24be35(0x192)]+_0x24be35(0x183)+_0x50928b['tokenName']+'\x20'+(_0x50928b['equipped']?'(Equipped)':'')+'\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20style=\x22width:\x2035px;\x20height:\x2035px;\x20margin-left:\x205px;\x20vertical-align:\x20middle;\x20object-fit:\x20contain;\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20onerror=\x22this.style.display=\x27none\x27\x22>'),_0x24be35(0x193)+_0x52011c['position']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td\x20style=\x22position:\x20relative;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20position:\x20relative;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username='+encodeURIComponent(_0x52011c[_0x24be35(0x18f)])+_0x24be35(0x187)+_0x2393cf+';\x20text-decoration:\x20none;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x52011c['username']+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x21a271+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x1aa7d9+_0x24be35(0x186)+_0x2393cf+';\x20position:\x20relative;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22elo-container\x22\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22elo-value\x22>'+_0x5c5010+_0x24be35(0x1a3)+_0x3ecf55[_0x24be35(0x191)]+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+_0x3ecf55['wins']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+_0x3ecf55[_0x24be35(0x1a1)]+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+_0x3ecf55['kda']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+_0x3ecf55['winRate']+_0x24be35(0x18e);}async function getPlayersLastEloChangesD3(_0x36b3be){const _0x4e8936=a31_0xe9aa30,_0x3f6986=new Map();_0x36b3be['forEach'](_0x33a7d4=>_0x3f6986[_0x4e8936(0x1a7)](_0x33a7d4,0x0));try{const _0x5bc600=new Map(),_0x2b7a05=await getDocs(collection(db,'playersD3'));_0x2b7a05[_0x4e8936(0x177)](_0xc28fba=>{const _0xcad438=_0xc28fba['data']();_0xcad438['username']&&_0x5bc600['set'](_0xc28fba['id'],_0xcad438['username']);});const _0x5891ae=collection(db,_0x4e8936(0x181)),_0x36a48d=query(_0x5891ae,orderBy('timestamp',_0x4e8936(0x178)),limit(0x64)),_0x189c75=await getDocs(_0x36a48d),_0xaab3b0=new Map();_0x189c75['forEach'](_0x408b1d=>{const _0x3e0200=_0x4e8936,_0x3f571a=_0x408b1d[_0x3e0200(0x19a)]();let _0x360881=null;if(_0x3f571a[_0x3e0200(0x18f)])_0x360881=_0x3f571a[_0x3e0200(0x18f)];else{if(_0x3f571a[_0x3e0200(0x1a0)])_0x360881=_0x3f571a[_0x3e0200(0x1a0)];else{if(_0x3f571a[_0x3e0200(0x1a5)]&&typeof _0x3f571a[_0x3e0200(0x1a5)]==='string')_0x360881=_0x3f571a['player'];else{if(_0x3f571a[_0x3e0200(0x1a5)]&&_0x5bc600['has'](_0x3f571a['player']))_0x360881=_0x5bc600['get'](_0x3f571a[_0x3e0200(0x1a5)]);else _0x3f571a['playerId']&&_0x5bc600['has'](_0x3f571a['playerId'])&&(_0x360881=_0x5bc600['get'](_0x3f571a['playerId']));}}}_0x360881&&_0x36b3be['includes'](_0x360881)&&(!_0xaab3b0['has'](_0x360881)&&_0xaab3b0['set'](_0x360881,[]),_0xaab3b0['get'](_0x360881)[_0x3e0200(0x188)]({..._0x3f571a,'timestamp':_0x3f571a['timestamp']?.['seconds']||0x0}));}),_0xaab3b0[_0x4e8936(0x177)]((_0x3ac1a2,_0x3eebb0)=>{const _0x49d504=_0x4e8936;if(_0x3ac1a2[_0x49d504(0x184)]>0x0){_0x3ac1a2[_0x49d504(0x1a4)]((_0x4a046f,_0x368bf6)=>_0x368bf6[_0x49d504(0x1a9)]-_0x4a046f['timestamp']);const _0x205769=_0x3ac1a2['find'](_0x198733=>_0x198733['change']!==undefined||_0x198733['newElo']!==undefined&&_0x198733[_0x49d504(0x172)]!==undefined);if(_0x205769){let _0x1fb91c;if(_0x205769['change']!==undefined)_0x1fb91c=_0x205769['change'];else _0x205769[_0x49d504(0x17c)]!==undefined&&_0x205769['previousElo']!==undefined&&(_0x1fb91c=_0x205769['newElo']-_0x205769['previousElo']);_0x1fb91c!==undefined&&_0x3f6986[_0x49d504(0x1a7)](_0x3eebb0,_0x1fb91c);}}});if(_0xaab3b0['size']===0x0){const _0x16515c=collection(db,'eloHistory'),_0x4b64d0=query(_0x16515c,where('gameMode','==','D3'),orderBy('timestamp','desc'),limit(0x32));try{const _0x4ff14e=await getDocs(_0x4b64d0);_0x4ff14e['forEach'](_0x23a54a=>{const _0x3b84a6=_0x4e8936,_0x59afa4=_0x23a54a['data']();let _0x272096=_0x59afa4['username']||_0x59afa4[_0x3b84a6(0x1a0)];!_0x272096&&_0x59afa4['player']&&_0x5bc600['has'](_0x59afa4['player'])&&(_0x272096=_0x5bc600['get'](_0x59afa4[_0x3b84a6(0x1a5)]));if(_0x272096&&_0x36b3be['includes'](_0x272096)){const _0x20872a=_0x59afa4['change']||(_0x59afa4['newElo']!==undefined&&_0x59afa4['previousElo']!==undefined?_0x59afa4['newElo']-_0x59afa4['previousElo']:0x0);_0x20872a!==0x0&&_0x3f6986[_0x3b84a6(0x1a7)](_0x272096,_0x20872a);}});}catch(_0x49a633){console[_0x4e8936(0x1aa)]('D3:\x20Fallback\x20query\x20failed:',_0x49a633);}}}catch(_0x397545){console['error']('D3:\x20Error\x20fetching\x20ELO\x20history:',_0x397545);}return _0x3f6986;}window['refreshLadderDisplayD3']=function(_0xe05a51=!![]){const _0x27584a=a31_0xe9aa30;typeof displayLadderD3==='function'?displayLadderD3(_0xe05a51):console['warn'](_0x27584a(0x195));};export{displayLadderD3,updatePlayerPositions};
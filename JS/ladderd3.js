const a33t=a33b;(function(a,b){const s=a33b,c=a();while(!![]){try{const d=-parseInt(s(0x1ca))/0x1*(parseInt(s(0x1bb))/0x2)+-parseInt(s(0x17c))/0x3*(parseInt(s(0x180))/0x4)+-parseInt(s(0x1a4))/0x5+-parseInt(s(0x1c8))/0x6+parseInt(s(0x190))/0x7+parseInt(s(0x1c3))/0x8*(-parseInt(s(0x195))/0x9)+parseInt(s(0x196))/0xa;if(d===b)break;else c['push'](c['shift']());}catch(e){c['push'](c['shift']());}}}(a33a,0x72b89));import{collection,getDocs,deleteDoc,doc,getDoc,query,where,updateDoc,Timestamp,onSnapshot,orderBy,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import{getRankStyle}from'./ranks.js';import a33c from'./firebase-idle-wrapper.js';const styleEl=document[a33t(0x1ae)]('style');styleEl['textContent']='\x0a\x20\x20.streak-indicator\x20{\x0a\x20\x20\x20\x20font-size:\x200.9em;\x0a\x20\x20\x20\x20color:\x20#FF4500;\x0a\x20\x20\x20\x20margin-left:\x205px;\x0a\x20\x20\x20\x20font-weight:\x20bold;\x0a\x20\x20}\x0a',document['head']['appendChild'](styleEl);const playerCacheD3={'data':null,'timestamp':0x0},CACHE_DURATION=0x7530;function a33b(a,b){const c=a33a();return a33b=function(d,e){d=d-0x179;let f=c[d];if(a33b['DJaBZE']===undefined){var g=function(l){const m='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let n='',o='';for(let p=0x0,q,r,s=0x0;r=l['charAt'](s++);~r&&(q=p%0x4?q*0x40+r:r,p++%0x4)?n+=String['fromCharCode'](0xff&q>>(-0x2*p&0x6)):0x0){r=m['indexOf'](r);}for(let t=0x0,u=n['length'];t<u;t++){o+='%'+('00'+n['charCodeAt'](t)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(o);};a33b['wNlKbl']=g,a=arguments,a33b['DJaBZE']=!![];}const h=c[0x0],i=d+h,j=a[i];return!j?(f=a33b['wNlKbl'](f),a[i]=f):f=j,f;},a33b(a,b);}async function displayLadderD3(a=![]){const u=a33t,b=document['querySelector']('#ladder-d3\x20tbody');if(!b){console['error'](u(0x1d4));return;}b[u(0x1ba)]='<tr><td\x20colspan=\x228\x22\x20class=\x22loading-cell\x22>Loading\x20D3\x20ladder\x20data...</td></tr>';try{const c=Date[u(0x1a0)]();if(!a&&playerCacheD3['data']&&c-playerCacheD3[u(0x18b)]<CACHE_DURATION){updateLadderDisplayD3(playerCacheD3[u(0x1c6)]);return;}const d=collection(db,'playersD3'),e=await getDocs(d),f=[];e[u(0x1cf)](l=>{const v=u,m=l['data']();m[v(0x1b5)]&&f['push']({...m,'id':l['id'],'elo':m['eloRating']||0x0,'position':m[v(0x19f)]||Number[v(0x1b2)]});});const g=collection(db,u(0x1a8)),h=await getDocs(g),i=new Map();h['forEach'](l=>{const w=u,m=l['data']();m['username']&&i[w(0x1cb)](m[w(0x1b5)]['toLowerCase'](),m);});for(const l of f){const m=l['username']['toLowerCase']();if(i['has'](m)){const n=i['get'](m);n['country']&&(l['country']=n[u(0x1d5)]['toLowerCase']());}}const j=f[u(0x1d1)](o=>o['username']),k=await fetchBatchMatchStatsD3(j);f['sort']((o,p)=>{const x=u,q=k['get'](o['username'])?.['totalMatches']||0x0,r=k['get'](p[x(0x1b5)])?.[x(0x1a5)]||0x0;if(q===0x0!==(r===0x0))return q===0x0?0x1:-0x1;return(o['position']||0x3e7)-(p['position']||0x3e7);}),f['forEach']((o,p)=>{const y=u;o[y(0x19f)]=p+0x1;}),playerCacheD3[u(0x1c6)]=f,playerCacheD3[u(0x18b)]=c,updateLadderDisplayD3(f);}catch(o){console[u(0x1c9)]('Error\x20loading\x20D3\x20ladder:',o),b[u(0x1ba)]=u(0x1a3)+o['message']+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';}}function calculateStreakDays(a){const z=a33t;if(!a)return 0x0;const b=a['toDate'](),c=new Date(),d=Math[z(0x181)](c-b);return Math[z(0x1a1)](d/(0x3e8*0x3c*0x3c*0x18));}async function updatePlayerPositions(a,b){const B=a33t;try{const c=collection(db,'playersD3'),d=await getDocs(c),e=[];d['forEach'](h=>{const A=a33b;e[A(0x18f)]({'id':h['id'],...h[A(0x1c6)]()});});const f=e['find'](h=>h['username']===a),g=e['find'](h=>h[B(0x1b5)]===b);if(!f||!g){console['error']('Could\x20not\x20find\x20winner\x20or\x20loser\x20in\x20D3\x20players\x20list');return;}if(f[B(0x19f)]>g[B(0x19f)]){const h=g['position'];for(const i of e){i['position']>=g[B(0x19f)]&&i[B(0x19f)]<f['position']&&i[B(0x1b5)]!==a&&await updateDoc(doc(db,'playersD3',i['id']),{'position':i['position']+0x1});}await updateDoc(doc(db,B(0x1b3),f['id']),{'position':h});if(h===0x1){const j=doc(db,'playersD3',f['id']),k=await getDoc(j);!k['data']()[B(0x197)]&&await updateDoc(j,{'firstPlaceDate':Timestamp[B(0x1a0)]()});}if(g[B(0x19f)]===0x1){const l=doc(db,B(0x1b3),g['id']);await updateDoc(l,{'firstPlaceDate':null});}}}catch(m){console[B(0x1c9)]('Error\x20updating\x20D3\x20player\x20positions:',m);}}async function updateLadderDisplayD3(a){const C=a33t;a[C(0x198)]((g,h)=>g['position']-h['position']);const b=document['querySelector']('#ladder-d3\x20tbody');if(!b)return;b['innerHTML']='';const c=a[C(0x1d1)](g=>g['username']),d=await fetchBatchMatchStatsD3(c),e=document[C(0x17a)]('#ladder-d3\x20thead\x20tr');e['innerHTML']=C(0x1cd);const f=a['map'](g=>{const D=C,h=d[D(0x1c0)](g['username'])||{'totalMatches':0x0,'wins':0x0,'losses':0x0,'kda':0x0,'winRate':0x0,'totalKills':0x0,'totalDeaths':0x0};return createPlayerRowD3(g,h);})['join']('');b['innerHTML']=f,getPlayersLastEloChangesD3(c)[C(0x1b7)](g=>{const F=C,h=new Map();b['querySelectorAll']('tr')['forEach']((i,j)=>{const E=a33b;j<c[E(0x1bc)]&&h[E(0x1cb)](c[j],i);}),g[F(0x1cf)]((i,j)=>{const G=F,k=h['get'](j);if(k&&i!==0x0){const l=k[G(0x17a)]('td:nth-child(3)');if(l){const m=i>0x0?'+'+i:''+i,n=l['querySelector'](G(0x1ab));n&&(n['textContent']=m,n['style'][G(0x1af)]=i>0x0?'#4CAF50':'#F44336',n['style'][G(0x1bf)]='bold',n['style']['fontSize']=G(0x19e),n[G(0x1d0)]['display']=G(0x179),n[G(0x1d0)][G(0x193)]=G(0x19b),n['style']['opacity']='1');}}});})[C(0x1b6)](g=>console[C(0x1c9)](C(0x1ac),g));}async function fetchBatchMatchStatsD3(a){const J=a33t,b=new Map();try{const c=collection(db,'approvedMatchesD3'),d=await getDocs(c);d['forEach'](e=>{const H=a33b,f=e[H(0x1c6)]();if(a['includes'](f[H(0x1aa)])){const g=f['winnerUsername'];!b[H(0x1be)](g)&&b['set'](g,{'totalMatches':0x0,'wins':0x0,'losses':0x0,'totalKills':0x0,'totalDeaths':0x0,'kda':0x0,'winRate':0x0});const h=b['get'](g);h['wins']++,h['totalMatches']++,h['totalKills']+=parseInt(f[H(0x186)])||0x0,h['totalDeaths']+=parseInt(f['loserScore'])||0x0;}if(a['includes'](f[H(0x1c5)])){const i=f['loserUsername'];!b[H(0x1be)](i)&&b['set'](i,{'totalMatches':0x0,'wins':0x0,'losses':0x0,'totalKills':0x0,'totalDeaths':0x0,'kda':0x0,'winRate':0x0});const j=b['get'](i);j[H(0x17e)]++,j[H(0x1a5)]++,j['totalKills']+=parseInt(f['loserScore'])||0x0,j['totalDeaths']+=parseInt(f['winnerScore'])||0x0;}}),b['forEach'](e=>{const I=a33b;e[I(0x1a2)]=e['totalDeaths']>0x0?(e[I(0x1b0)]/e[I(0x1cc)])['toFixed'](0x2):e['totalKills'],e['winRate']=e['totalMatches']>0x0?(e['wins']/e[I(0x1a5)]*0x64)[I(0x18a)](0x1):0x0;});}catch(e){console[J(0x1c9)]('Error\x20fetching\x20batch\x20match\x20stats\x20for\x20D3:',e);}return b;}function a33a(){const P=['DgLTzxn0yw1W','zNjVBq','zwXV','zwXVsgLZDg9YEq','ChvZAa','mJCWote2mwjqr21gyG','oYbWB3nPDgLVBJOGCMvSyxrPDMu7iJ4kicaGicaGicaGicaGpgrPDIbJBgfZCZ0IzwXVlwnVBNrHAw5LCIiGC3r5Bgu9iMrPC3bSyxK6igzSzxG7igfSAwDUlwL0zw1ZoIbJzw50zxi7iJ4kicaGicaGicaGicaGicaGidXZCgfUignSyxnZpsjLBg8TDMfSDwuIpG','igvUDhjPzxmGAw4GzwXVsgLZDg9YEuqZ','DMLZAwjPBgL0Eq','Aw5JBhvKzxm','mZaYnZy5rgHyuwnP','mtm0nZmWndbWtxLosvO','zMLYC3rqBgfJzurHDgu','C29YDa','zw50CMLLCW','CgXHEwvY','DMLZAwjSzq','pgLTzYbZCMm9iI4Ul2LTywDLCY9MBgfNCY8','zwXVsgLZDg9YEuqZ','mc44nwvT','Cg9ZAxrPB24','BM93','y2vPBa','A2rH','cIaGicaGicaGicaGidX0CJ4kicaGicaGicaGicaGicaGidX0zcbJB2XZCgfUpsi4iIbZDhLSzt0IDgv4Dc1HBgLNBJOGy2vUDgvYoYbJB2XVCJOGCMvKoYi+cIaGicaGicaGicaGicaGicaGicaGrxjYB3iGBg9HzgLUzYbemYbSywrKzxiGzgf0ytOG','mJa3mti1v3zRtxrv','Dg90ywXnyxrJAgvZ','rdm6iezVDw5KigvUDhjPzxmGzM9Yia','jtWVDgq+cIaGica8l3rYpG','DxnLCLbYB2zPBgvZ','zMLSDgvY','D2LUBMvYvxnLCM5HBwu','lNrYzw5KlwLUzgLJyxrVCG','rxjYB3iGDxbKyxrPBMCGrdmGruXpihrYzw5KigLUzgLJyxrVCNm6','cIaGica8Dhi+cIaGicaGicaGphrKpG','y3jLyxrLrwXLBwvUDa','y29SB3i','Dg90ywXlAwXSCW','igzHBgXIywnRigvUDhjPzxm','tufyx1nbrKvFsu5uruDfuG','CgXHEwvYC0qZ','C2L6zq','DxnLCM5HBwu','y2f0y2G','DgHLBG','pc90zd4kicaGicaGica8Dgq+','iIakicaGicaGicaGicaGicaGicaGicaGicaGy2XHC3m9iNbSyxLLCI1MBgfNiIakicaGicaGicaGicaGicaGicaGicaGicaGB25LCNjVCJ0IDgHPCY5ZDhLSzs5KAxnWBgf5psDUB25LjYi+','Aw5Uzxjive1m','mtmWmtryu2Hly1O','BgvUz3rO','ihbSyxLLCNm','AgfZ','zM9UDfDLAwDODa','z2v0','CgXHEwvYswq','rdm6ievYCM9YigzLDgnOAw5NievmtYbOAxn0B3j5oG','ndbTBej0vwq','Bg9N','Bg9ZzxjvC2vYBMfTzq','zgf0yq','i0zgrdCWma','nda1ndeXnMXls3vdyG','zxjYB3i','mtvUEKX3qLG','C2v0','Dg90ywXezwf0Ahm','cIaGicaGicaGphrOpLjHBMS8l3rOpGOGicaGicaGidX0Ad5vC2vYBMfTztWVDgG+cIaGicaGicaGphrOpKvmtZWVDgG+cIaGicaGicaGphrOpK1HDgnOzxm8l3rOpGOGicaGicaGidX0Ad5xAw5Zpc90Ad4kicaGicaGica8DgG+tg9ZC2vZpc90Ad4kicaGicaGica8DgG+sY9epc90Ad4kicaGicaGica8DgG+v2LUifjHDgu8l3rOpGOGicaG','CgLSB3q','zM9YrwfJAa','C3r5Bgu','BwfW','oYb0zxH0lwrLy29YyxrPB246ig5VBMu7iJ4kicaGicaGicaGicaGicaGicaGica','rdm6ie5VigvUDhjPzxmGzM91BMqGAw4GzwXVsgLZDg9YEuqZlcb0CNLPBMCGzMfSBgjHy2SUlI4','rdmGtgfKzgvYihrHyMXLigjVzhKGBM90igzVDw5K','y291BNrYEq','Aw5SAw5L','CxvLCNLtzwXLy3rVCG','pc90zd4kicaGicaGica8DgqGC3r5Bgu9iNbVC2L0Aw9UoIbYzwXHDgL2ztSIpGOGicaGicaGicaGica8zgL2ihn0EwXLpsjKAxnWBgf5oIbMBgv4oYbHBgLNBI1PDgvTCZOGy2vUDgvYoYbWB3nPDgLVBJOGCMvSyxrPDMu7iJ4kicaGicaGicaGicaGicaGidXHigHYzwy9iNbYB2zPBguUAhrTBd91C2vYBMfTzt0','m2jOrfLpuq','i0nen0yZmG','Bg9ZC2vZ','i0mWqZbdma','mteYnJaZnLf1tLDICW','ywjZ','BMv3rwXV','zgvZyW','iZuWqZG3oa','CgXHEwvYvxnLCM5HBwu','D2LUBMvYu2nVCMu','y2HHBMDL','ievmtYbJAgfUz2u6ia','igzHBgXIywnRievmtYbJAgfUz2u6ia','Dg9gAxHLza'];a33a=function(){return P;};return a33a();}function createPlayerRowD3(a,b){const K=a33t,c=parseFloat(a[K(0x18d)])||0x0;let d='gray';if(c>=0x7d0)d=K(0x184);else{if(c>=0x708)d=K(0x1c7);else{if(c>=0x640)d=K(0x17f);else c>=0x578&&(d=K(0x17d));}}let e='';return a[K(0x1d5)]&&(e=K(0x19c)+a[K(0x1d5)]['toLowerCase']()+'.png\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20alt=\x22'+a[K(0x1d5)]+K(0x1b9)),K(0x1ad)+a['position']+K(0x17b)+encodeURIComponent(a[K(0x1b5)])+'&ladder=d3\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20style=\x22color:\x20'+d+K(0x1d2)+a['username']+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+e+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td\x20style=\x22color:\x20'+d+K(0x191)+c+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22trend-indicator\x22\x20style=\x22margin-left:\x205px;\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+b[K(0x1a5)]+K(0x1b8)+b['wins']+K(0x1b8)+b['losses']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+b[K(0x1a2)]+K(0x1b8)+b['winRate']+K(0x1a7);}async function getPlayersLastEloChangesD3(a){const L=a33t,b=new Map();a['forEach'](c=>b[L(0x1cb)](c,0x0));try{console['log']('D3:\x20Looking\x20for\x20ELO\x20changes\x20for\x20users:',a);const c=new Map(),d=await getDocs(collection(db,'playersD3'));d[L(0x1cf)](j=>{const k=j['data']();k['username']&&c['set'](j['id'],k['username']);}),console[L(0x1c4)]('D3:\x20Player\x20ID\x20mappings:',Array[L(0x18c)](c[L(0x199)]()));const e=collection(db,L(0x19d)),f=query(e,orderBy('timestamp',L(0x183)),limit(0x64)),g=await getDocs(f);g['empty']?console['log']('D3:\x20eloHistoryD3\x20is\x20empty,\x20trying\x20fallback...'):console['log']('D3:\x20Found\x20'+g['size']+L(0x192));const h=new Map();g[L(0x1cf)](j=>{const M=L,k=j[M(0x1c6)]();let l=null;if(k['username'])l=k['username'];else{if(k['playerUsername'])l=k[M(0x185)];else{if(k[M(0x19a)]&&typeof k['player']==='string')l=k['player'];else{if(k[M(0x19a)]&&c['has'](k[M(0x19a)]))l=c[M(0x1c0)](k['player']);else k[M(0x1c1)]&&c[M(0x1be)](k[M(0x1c1)])&&(l=c['get'](k['playerId']));}}}(k[M(0x1b5)]===M(0x1ce)||k[M(0x185)]===M(0x1ce)||k['player']&&c[M(0x1c0)](k[M(0x19a)])==='pilot')&&console['log']('D3:\x20Found\x20pilot\x20entry:',k),l&&a[M(0x194)](l)&&(!h['has'](l)&&h['set'](l,[]),h['get'](l)[M(0x18f)]({...k,'timestamp':k['timestamp']?.['seconds']||0x0}));}),console['log'](L(0x1a6)+h['size']+L(0x1bd)),h['forEach']((j,k)=>{const N=L;if(j['length']>0x0){j[N(0x198)]((m,n)=>n['timestamp']-m[N(0x18b)]);const l=j['find'](m=>m[N(0x187)]!==undefined||m[N(0x182)]!==undefined&&m['previousElo']!==undefined);if(l){let m;if(l['change']!==undefined)m=l['change'];else l[N(0x182)]!==undefined&&l['previousElo']!==undefined&&(m=l[N(0x182)]-l['previousElo']);m!==undefined&&(b['set'](k,m),console['log']('D3:\x20'+k+N(0x188)+m));}}});if(h[L(0x1b4)]===0x0){console['log'](L(0x1d3));const j=collection(db,L(0x18e)),k=query(j,where('gameMode','==','D3'),orderBy(L(0x18b),L(0x183)),limit(0x32));try{const l=await getDocs(k);console[L(0x1c4)]('D3:\x20Found\x20'+l['size']+L(0x1b1)),l['forEach'](m=>{const O=L,n=m[O(0x1c6)]();let o=n['username']||n[O(0x185)];!o&&n['player']&&c['has'](n[O(0x19a)])&&(o=c['get'](n['player']));if(o&&a[O(0x194)](o)){const p=n['change']||(n[O(0x182)]!==undefined&&n['previousElo']!==undefined?n[O(0x182)]-n['previousElo']:0x0);p!==0x0&&(b[O(0x1cb)](o,p),console['log']('D3:\x20'+o+O(0x189)+p));}});}catch(m){console['log']('D3:\x20Fallback\x20query\x20failed:',m);}}const i=Array['from'](b[L(0x199)]())[L(0x1a9)](([n,o])=>o!==0x0);console[L(0x1c4)]('D3:\x20Final\x20ELO\x20changes:',i);}catch(n){console['error'](L(0x1c2),n);}return b;}export{displayLadderD3,updatePlayerPositions};
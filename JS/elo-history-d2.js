function a14_0xfc6e(){const _0x580544=['data','loserUsername','match','info','demotion','newElo','Error\x20fetching\x20D2\x20ELO\x20history:','eloHistoryD2','player','apply','bind','warn','Unknown\x20Player','username','Unranked','empty'];a14_0xfc6e=function(){return _0x580544;};return a14_0xfc6e();}const a14_0x432fc4=(function(){let _0x3d72a4=!![];return function(_0x36306b,_0x5cbdea){const _0x23f714=_0x3d72a4?function(){const _0x1d536c=a14_0x59ed;if(_0x5cbdea){const _0x168824=_0x5cbdea[_0x1d536c(0xbd)](_0x36306b,arguments);return _0x5cbdea=null,_0x168824;}}:function(){};return _0x3d72a4=![],_0x23f714;};}()),a14_0x8e36d6=a14_0x432fc4(this,function(){const _0x3c6400=a14_0x59ed;let _0x3cb499;try{const _0x371af7=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x3cb499=_0x371af7();}catch(_0xc20569){_0x3cb499=window;}const _0x3be601=_0x3cb499['console']=_0x3cb499['console']||{},_0x507f1c=['log',_0x3c6400(0xbf),_0x3c6400(0xb7),'error','exception','table','trace'];for(let _0x33e207=0x0;_0x33e207<_0x507f1c['length'];_0x33e207++){const _0x487f23=a14_0x432fc4['constructor']['prototype']['bind'](a14_0x432fc4),_0x4aef98=_0x507f1c[_0x33e207],_0xb3c46=_0x3be601[_0x4aef98]||_0x487f23;_0x487f23['__proto__']=a14_0x432fc4[_0x3c6400(0xbe)](a14_0x432fc4),_0x487f23['toString']=_0xb3c46['toString']['bind'](_0xb3c46),_0x3be601[_0x4aef98]=_0x487f23;}});a14_0x8e36d6();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';function a14_0x59ed(_0x2ef8c2,_0x260a3c){const _0x8e36d6=a14_0xfc6e();return a14_0x59ed=function(_0x432fc4,_0x135fd9){_0x432fc4=_0x432fc4-0xb4;let _0xfc6ec2=_0x8e36d6[_0x432fc4];return _0xfc6ec2;},a14_0x59ed(_0x2ef8c2,_0x260a3c);}const ELO_THRESHOLDS_D2=[{'name':'Gold','elo':0x708},{'name':'Silver','elo':0x640},{'name':'Bronze','elo':0x578},{'name':'Unranked','elo':0x4b0}];let lastVisibleD2=null;async function getUsernameByIdD2(_0x3d4389){const _0x5b5796=a14_0x59ed;try{if(!_0x3d4389)return'Unknown\x20Player';const _0x22f147=await getDoc(doc(db,'playersD2',_0x3d4389));if(_0x22f147['exists']())return _0x22f147['data']()[_0x5b5796(0xc1)]||_0x5b5796(0xc0);const _0x18a293=await getDocs(query(collection(db,'approvedMatchesD2'),where('winnerId','==',_0x3d4389),limit(0x1)));if(!_0x18a293[_0x5b5796(0xc3)])return _0x18a293['docs'][0x0][_0x5b5796(0xb4)]()['winnerUsername']||'Unknown\x20Player';const _0x26b6af=await getDocs(query(collection(db,'approvedMatchesD2'),where('loserId','==',_0x3d4389),limit(0x1)));if(!_0x26b6af['empty'])return _0x26b6af['docs'][0x0][_0x5b5796(0xb4)]()[_0x5b5796(0xb5)]||'Unknown\x20Player';return'Unknown\x20Player';}catch(_0x3f12a9){return console['error']('Error\x20getting\x20username:',_0x3f12a9),'Unknown\x20Player';}}export async function recordEloChangeD2({playerId:_0x1e0c3c,previousElo:_0x4820a7,newElo:_0x513aaf,opponentId:_0x52d3aa,matchResult:_0x45fb47,previousPosition:_0x1db26e,newPosition:_0x124bf0,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x56fac3,timestamp:_0x3bbd47}){const _0x277a11=a14_0x59ed;try{const _0x2a01d9=doc(collection(db,'eloHistoryD2'));let _0x1f8b03=_0x277a11(0xb6);if(isPromotion)_0x1f8b03='promotion';if(isDemotion)_0x1f8b03=_0x277a11(0xb8);let _0x529a12=_0x277a11(0xc2);if(_0x513aaf>=0x834)_0x529a12='Emerald';else{if(_0x513aaf>=0x708)_0x529a12='Gold';else{if(_0x513aaf>=0x640)_0x529a12='Silver';else{if(_0x513aaf>=0x578)_0x529a12='Bronze';}}}return await setDoc(_0x2a01d9,{'type':_0x1f8b03,'player':_0x1e0c3c,'opponent':_0x52d3aa,'previousElo':_0x4820a7,'newElo':_0x513aaf,'change':_0x513aaf-_0x4820a7,'matchResult':_0x45fb47,'previousPosition':_0x1db26e,'newPosition':_0x124bf0,'rankAchieved':_0x529a12,'matchId':_0x56fac3,'timestamp':_0x3bbd47}),console['log']('D2\x20ELO\x20history\x20recorded\x20for\x20'+_0x1e0c3c),!![];}catch(_0x5ce8e3){console['error']('Error\x20recording\x20D2\x20ELO\x20history:',_0x5ce8e3);throw _0x5ce8e3;}}export async function getEloHistoryD2(_0x5a4783=0x14){const _0x416f31=a14_0x59ed;try{const _0x1bbec2=collection(db,_0x416f31(0xbb));let _0x4e5334;lastVisibleD2?_0x4e5334=query(_0x1bbec2,orderBy('timestamp','desc'),startAfter(lastVisibleD2),limit(_0x5a4783)):_0x4e5334=query(_0x1bbec2,orderBy('timestamp','desc'),limit(_0x5a4783));const _0x2078d0=await getDocs(_0x4e5334);if(_0x2078d0['empty'])return{'entries':[],'hasMore':![]};lastVisibleD2=_0x2078d0['docs'][_0x2078d0['docs']['length']-0x1];const _0x12f668=_0x2078d0['docs']['map'](async _0x3165f1=>{const _0x18c869=_0x416f31,_0x4a67cb=_0x3165f1['data'](),[_0x2da113,_0x2ffdc9]=await Promise['all']([getUsernameByIdD2(_0x4a67cb[_0x18c869(0xbc)]),getUsernameByIdD2(_0x4a67cb['opponent'])]);return{..._0x4a67cb,'playerUsername':_0x2da113,'opponentUsername':_0x2ffdc9,'change':_0x4a67cb[_0x18c869(0xb9)]-_0x4a67cb['previousElo'],'timestamp':_0x4a67cb['timestamp']};}),_0x4f5ead=await Promise['all'](_0x12f668);return{'entries':_0x4f5ead,'hasMore':_0x2078d0['size']===_0x5a4783};}catch(_0xce0abd){console['error'](_0x416f31(0xba),_0xce0abd);throw _0xce0abd;}}export function resetPaginationD2(){lastVisibleD2=null;}
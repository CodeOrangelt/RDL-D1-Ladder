const a12_0x557e7e=a12_0x3a76,a12_0x54b0d5=(function(){let _0x12f08e=!![];return function(_0x4c7909,_0x38ac77){const _0x41a674=_0x12f08e?function(){const _0x1e7df5=a12_0x3a76;if(_0x38ac77){const _0x17bd81=_0x38ac77[_0x1e7df5(0x7f)](_0x4c7909,arguments);return _0x38ac77=null,_0x17bd81;}}:function(){};return _0x12f08e=![],_0x41a674;};}()),a12_0x3b213c=a12_0x54b0d5(this,function(){const _0x262d97=a12_0x3a76;let _0xc9a3bb;try{const _0x2f7025=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0xc9a3bb=_0x2f7025();}catch(_0x35173f){_0xc9a3bb=window;}const _0x2c3401=_0xc9a3bb['console']=_0xc9a3bb['console']||{},_0x4b7a16=[_0x262d97(0x8c),'warn','info',_0x262d97(0x87),'exception','table','trace'];for(let _0x410f39=0x0;_0x410f39<_0x4b7a16['length'];_0x410f39++){const _0x1db433=a12_0x54b0d5['constructor'][_0x262d97(0x84)]['bind'](a12_0x54b0d5),_0x1571f2=_0x4b7a16[_0x410f39],_0x2e5cc2=_0x2c3401[_0x1571f2]||_0x1db433;_0x1db433['__proto__']=a12_0x54b0d5['bind'](a12_0x54b0d5),_0x1db433['toString']=_0x2e5cc2[_0x262d97(0x8a)][_0x262d97(0x89)](_0x2e5cc2),_0x2c3401[_0x1571f2]=_0x1db433;}});a12_0x3b213c();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D2=[{'name':'Gold','elo':0x708},{'name':a12_0x557e7e(0x79),'elo':0x640},{'name':a12_0x557e7e(0x83),'elo':0x578},{'name':'Unranked','elo':0x4b0}];function a12_0x3a76(_0xfcb646,_0x3b3419){const _0x3b213c=a12_0x336a();return a12_0x3a76=function(_0x54b0d5,_0x26bb35){_0x54b0d5=_0x54b0d5-0x79;let _0x336ae1=_0x3b213c[_0x54b0d5];return _0x336ae1;},a12_0x3a76(_0xfcb646,_0x3b3419);}function a12_0x336a(){const _0x5e48c8=['Silver','previousElo','all','empty','docs','Unranked','apply','timestamp','data','Error\x20recording\x20D2\x20ELO\x20history:','Bronze','prototype','desc','map','error','Emerald','bind','toString','winnerUsername','log','Unknown\x20Player','Error\x20fetching\x20D2\x20ELO\x20history:','D2\x20ELO\x20history\x20recorded\x20for\x20','newElo'];a12_0x336a=function(){return _0x5e48c8;};return a12_0x336a();}let lastVisibleD2=null;async function getUsernameByIdD2(_0x101428){const _0x15ec57=a12_0x557e7e;try{if(!_0x101428)return'Unknown\x20Player';const _0x9ecd0d=await getDoc(doc(db,'playersD2',_0x101428));if(_0x9ecd0d['exists']())return _0x9ecd0d['data']()['username']||'Unknown\x20Player';const _0x4fe507=await getDocs(query(collection(db,'approvedMatchesD2'),where('winnerId','==',_0x101428),limit(0x1)));if(!_0x4fe507[_0x15ec57(0x7c)])return _0x4fe507['docs'][0x0]['data']()[_0x15ec57(0x8b)]||'Unknown\x20Player';const _0x53c8f4=await getDocs(query(collection(db,'approvedMatchesD2'),where('loserId','==',_0x101428),limit(0x1)));if(!_0x53c8f4['empty'])return _0x53c8f4[_0x15ec57(0x7d)][0x0]['data']()['loserUsername']||'Unknown\x20Player';return _0x15ec57(0x8d);}catch(_0x5361a6){return console['error']('Error\x20getting\x20username:',_0x5361a6),'Unknown\x20Player';}}export async function recordEloChangeD2({playerId:_0x5b406d,previousElo:_0x225096,newElo:_0x30b7ab,opponentId:_0x591691,matchResult:_0x4b68fb,previousPosition:_0x5bfbc5,newPosition:_0x6fa6d0,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x4dd433,timestamp:_0x59205c}){const _0x4c336f=a12_0x557e7e;try{const _0x223761=doc(collection(db,'eloHistoryD2'));let _0x407778='match';if(isPromotion)_0x407778='promotion';if(isDemotion)_0x407778='demotion';let _0x54e043=_0x4c336f(0x7e);if(_0x30b7ab>=0x834)_0x54e043=_0x4c336f(0x88);else{if(_0x30b7ab>=0x708)_0x54e043='Gold';else{if(_0x30b7ab>=0x640)_0x54e043=_0x4c336f(0x79);else{if(_0x30b7ab>=0x578)_0x54e043='Bronze';}}}return await setDoc(_0x223761,{'type':_0x407778,'player':_0x5b406d,'opponent':_0x591691,'previousElo':_0x225096,'newElo':_0x30b7ab,'change':_0x30b7ab-_0x225096,'matchResult':_0x4b68fb,'previousPosition':_0x5bfbc5,'newPosition':_0x6fa6d0,'rankAchieved':_0x54e043,'matchId':_0x4dd433,'timestamp':_0x59205c}),console['log'](_0x4c336f(0x8f)+_0x5b406d),!![];}catch(_0x4ea549){console['error'](_0x4c336f(0x82),_0x4ea549);throw _0x4ea549;}}export async function getEloHistoryD2(_0x364efb=0x14){const _0x409aa0=a12_0x557e7e;try{const _0x11ece2=collection(db,'eloHistoryD2');let _0x1a0384;lastVisibleD2?_0x1a0384=query(_0x11ece2,orderBy('timestamp',_0x409aa0(0x85)),startAfter(lastVisibleD2),limit(_0x364efb)):_0x1a0384=query(_0x11ece2,orderBy(_0x409aa0(0x80),'desc'),limit(_0x364efb));const _0xd86da3=await getDocs(_0x1a0384);if(_0xd86da3[_0x409aa0(0x7c)])return{'entries':[],'hasMore':![]};lastVisibleD2=_0xd86da3['docs'][_0xd86da3['docs']['length']-0x1];const _0x4d0886=_0xd86da3[_0x409aa0(0x7d)][_0x409aa0(0x86)](async _0x52a7ec=>{const _0x565599=_0x409aa0,_0x175b24=_0x52a7ec[_0x565599(0x81)](),[_0x43a1df,_0x2d6ae0]=await Promise['all']([getUsernameByIdD2(_0x175b24['player']),getUsernameByIdD2(_0x175b24['opponent'])]);return{..._0x175b24,'playerUsername':_0x43a1df,'opponentUsername':_0x2d6ae0,'change':_0x175b24[_0x565599(0x90)]-_0x175b24[_0x565599(0x7a)],'timestamp':_0x175b24['timestamp']};}),_0x18583e=await Promise[_0x409aa0(0x7b)](_0x4d0886);return{'entries':_0x18583e,'hasMore':_0xd86da3['size']===_0x364efb};}catch(_0x26b5cf){console['error'](_0x409aa0(0x8e),_0x26b5cf);throw _0x26b5cf;}}export function resetPaginationD2(){lastVisibleD2=null;}
const a14_0xf93cd3=a14_0xdb1c,a14_0x358c54=(function(){let _0x50050d=!![];return function(_0x31eb1f,_0x3edf20){const _0xfd33e1=_0x50050d?function(){if(_0x3edf20){const _0x1ad4a6=_0x3edf20['apply'](_0x31eb1f,arguments);return _0x3edf20=null,_0x1ad4a6;}}:function(){};return _0x50050d=![],_0xfd33e1;};}()),a14_0x3bf715=a14_0x358c54(this,function(){const _0x586bfc=a14_0xdb1c,_0x2f144c=function(){let _0x5a235c;try{_0x5a235c=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x4319b0){_0x5a235c=window;}return _0x5a235c;},_0xf450f9=_0x2f144c(),_0x205016=_0xf450f9[_0x586bfc(0x1ef)]=_0xf450f9['console']||{},_0x34d41a=['log','warn','info','error',_0x586bfc(0x1f5),_0x586bfc(0x1de),_0x586bfc(0x1e9)];for(let _0x211f4c=0x0;_0x211f4c<_0x34d41a['length'];_0x211f4c++){const _0x2260ad=a14_0x358c54['constructor']['prototype']['bind'](a14_0x358c54),_0x2eb00b=_0x34d41a[_0x211f4c],_0xb23bfa=_0x205016[_0x2eb00b]||_0x2260ad;_0x2260ad[_0x586bfc(0x1e6)]=a14_0x358c54['bind'](a14_0x358c54),_0x2260ad[_0x586bfc(0x1e3)]=_0xb23bfa['toString'][_0x586bfc(0x1e1)](_0xb23bfa),_0x205016[_0x2eb00b]=_0x2260ad;}});function a14_0xdb1c(_0x1fb50d,_0x3479cb){const _0x3bf715=a14_0x3096();return a14_0xdb1c=function(_0x358c54,_0x4e1e5e){_0x358c54=_0x358c54-0x1dc;let _0x30966d=_0x3bf715[_0x358c54];return _0x30966d;},a14_0xdb1c(_0x1fb50d,_0x3479cb);}a14_0x3bf715();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';function a14_0x3096(){const _0x42bf44=['docs','promotion','table','error','all','bind','Bronze','toString','size','loserUsername','__proto__','winnerId','Unknown\x20Player','trace','empty','data','desc','Gold','D2\x20ELO\x20history\x20recorded\x20for\x20','console','log','length','Error\x20fetching\x20D2\x20ELO\x20history:','Emerald','Unranked','exception','approvedMatchesD2','Silver'];a14_0x3096=function(){return _0x42bf44;};return a14_0x3096();}const ELO_THRESHOLDS_D2=[{'name':'Gold','elo':0x708},{'name':a14_0xf93cd3(0x1f7),'elo':0x640},{'name':'Bronze','elo':0x578},{'name':'Unranked','elo':0x4b0}];let lastVisibleD2=null;async function getUsernameByIdD2(_0x2969b8){const _0x55083a=a14_0xf93cd3;try{if(!_0x2969b8)return'Unknown\x20Player';const _0x33557c=await getDoc(doc(db,'playersD2',_0x2969b8));if(_0x33557c['exists']())return _0x33557c[_0x55083a(0x1eb)]()['username']||_0x55083a(0x1e8);const _0x2141ba=await getDocs(query(collection(db,'approvedMatchesD2'),where(_0x55083a(0x1e7),'==',_0x2969b8),limit(0x1)));if(!_0x2141ba[_0x55083a(0x1ea)])return _0x2141ba[_0x55083a(0x1dc)][0x0]['data']()['winnerUsername']||'Unknown\x20Player';const _0x2529fe=await getDocs(query(collection(db,_0x55083a(0x1f6)),where('loserId','==',_0x2969b8),limit(0x1)));if(!_0x2529fe[_0x55083a(0x1ea)])return _0x2529fe[_0x55083a(0x1dc)][0x0]['data']()[_0x55083a(0x1e5)]||'Unknown\x20Player';return'Unknown\x20Player';}catch(_0x478fa1){return console[_0x55083a(0x1df)]('Error\x20getting\x20username:',_0x478fa1),'Unknown\x20Player';}}export async function recordEloChangeD2({playerId:_0x17efd0,previousElo:_0x114880,newElo:_0x5c02ee,opponentId:_0x3a22a0,matchResult:_0xdaf741,previousPosition:_0x18ebec,newPosition:_0x9dc9a9,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x245280,timestamp:_0x4882c9}){const _0x45d092=a14_0xf93cd3;try{const _0x2df9c2=doc(collection(db,'eloHistoryD2'));let _0x273a86='match';if(isPromotion)_0x273a86=_0x45d092(0x1dd);if(isDemotion)_0x273a86='demotion';let _0xf206d=_0x45d092(0x1f4);if(_0x5c02ee>=0x834)_0xf206d=_0x45d092(0x1f3);else{if(_0x5c02ee>=0x708)_0xf206d=_0x45d092(0x1ed);else{if(_0x5c02ee>=0x640)_0xf206d='Silver';else{if(_0x5c02ee>=0x578)_0xf206d=_0x45d092(0x1e2);}}}return await setDoc(_0x2df9c2,{'type':_0x273a86,'player':_0x17efd0,'opponent':_0x3a22a0,'previousElo':_0x114880,'newElo':_0x5c02ee,'change':_0x5c02ee-_0x114880,'matchResult':_0xdaf741,'previousPosition':_0x18ebec,'newPosition':_0x9dc9a9,'rankAchieved':_0xf206d,'matchId':_0x245280,'timestamp':_0x4882c9}),console[_0x45d092(0x1f0)](_0x45d092(0x1ee)+_0x17efd0),!![];}catch(_0x53c96e){console['error']('Error\x20recording\x20D2\x20ELO\x20history:',_0x53c96e);throw _0x53c96e;}}export async function getEloHistoryD2(_0x1a5af4=0x14){const _0x1ba760=a14_0xf93cd3;try{const _0x1d63a5=collection(db,'eloHistoryD2');let _0x37d838;lastVisibleD2?_0x37d838=query(_0x1d63a5,orderBy('timestamp',_0x1ba760(0x1ec)),startAfter(lastVisibleD2),limit(_0x1a5af4)):_0x37d838=query(_0x1d63a5,orderBy('timestamp','desc'),limit(_0x1a5af4));const _0x2e07a6=await getDocs(_0x37d838);if(_0x2e07a6[_0x1ba760(0x1ea)])return{'entries':[],'hasMore':![]};lastVisibleD2=_0x2e07a6['docs'][_0x2e07a6['docs'][_0x1ba760(0x1f1)]-0x1];const _0x527bc6=_0x2e07a6['docs']['map'](async _0x368286=>{const _0x48f522=_0x1ba760,_0x12804c=_0x368286['data'](),[_0x1e8265,_0xe79ead]=await Promise[_0x48f522(0x1e0)]([getUsernameByIdD2(_0x12804c['player']),getUsernameByIdD2(_0x12804c['opponent'])]);return{..._0x12804c,'playerUsername':_0x1e8265,'opponentUsername':_0xe79ead,'change':_0x12804c['newElo']-_0x12804c['previousElo'],'timestamp':_0x12804c['timestamp']};}),_0xadf44e=await Promise['all'](_0x527bc6);return{'entries':_0xadf44e,'hasMore':_0x2e07a6[_0x1ba760(0x1e4)]===_0x1a5af4};}catch(_0x1d78e6){console[_0x1ba760(0x1df)](_0x1ba760(0x1f2),_0x1d78e6);throw _0x1d78e6;}}export function resetPaginationD2(){lastVisibleD2=null;}
const a54_0x39bfe0=a54_0x3c7f,a54_0x15ca4e=(function(){let _0x4c9bd4=!![];return function(_0x5ee5e4,_0x21d619){const _0xfd744e=_0x4c9bd4?function(){if(_0x21d619){const _0x5514b2=_0x21d619['apply'](_0x5ee5e4,arguments);return _0x21d619=null,_0x5514b2;}}:function(){};return _0x4c9bd4=![],_0xfd744e;};}()),a54_0x5da1cc=a54_0x15ca4e(this,function(){const _0x3f558d=a54_0x3c7f;let _0x302b31;try{const _0x13d3a1=Function('return\x20(function()\x20'+_0x3f558d(0xa7)+');');_0x302b31=_0x13d3a1();}catch(_0x4e2771){_0x302b31=window;}const _0x3105d1=_0x302b31['console']=_0x302b31['console']||{},_0x18a7a1=['log','warn','info',_0x3f558d(0xa2),_0x3f558d(0xa8),'table',_0x3f558d(0xa5)];for(let _0x41464e=0x0;_0x41464e<_0x18a7a1['length'];_0x41464e++){const _0x5a84fe=a54_0x15ca4e[_0x3f558d(0x9a)][_0x3f558d(0xa9)]['bind'](a54_0x15ca4e),_0x2eeaba=_0x18a7a1[_0x41464e],_0x5c4ea6=_0x3105d1[_0x2eeaba]||_0x5a84fe;_0x5a84fe['__proto__']=a54_0x15ca4e['bind'](a54_0x15ca4e),_0x5a84fe['toString']=_0x5c4ea6[_0x3f558d(0xa3)]['bind'](_0x5c4ea6),_0x3105d1[_0x2eeaba]=_0x5a84fe;}});a54_0x5da1cc();import{db}from'../firebase-config.js';import{collection,doc,getDoc,getDocs,query,limit,startAfter,where,onSnapshot}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const cache={'userProfiles':new Map(),'ladderPlayers':new Map(),'matchResults':new Map(),'eloHistory':new Map()},CACHE_EXPIRY={'userProfiles':0x5*0x3c*0x3e8,'ladderPlayers':0x2*0x3c*0x3e8,'matchResults':0x1*0x3c*0x3e8,'eloHistory':0x3*0x3c*0x3e8};export const userProfilesRef=collection(db,a54_0x39bfe0(0xb0));export async function fetchPaginatedData(_0x3fee31,_0xa0d1e2=0xa,_0x2801a4=null){let _0x198ef6=query(_0x3fee31,limit(_0xa0d1e2));_0x2801a4&&(_0x198ef6=query(_0x198ef6,startAfter(_0x2801a4)));const _0x3bef7c=await getDocs(_0x198ef6),_0x30c01e=_0x3bef7c['docs'][_0x3bef7c['docs']['length']-0x1];return{'data':_0x3bef7c['docs']['map'](_0x362ea4=>({'id':_0x362ea4['id'],..._0x362ea4['data']()})),'lastVisible':_0x30c01e,'hasMore':_0x3bef7c['docs']['length']===_0xa0d1e2};}export async function getUserProfile(_0x503582){const _0x3ce3b3=a54_0x39bfe0,_0x4738ec=cache[_0x3ce3b3(0xb0)]['get'](_0x503582);if(_0x4738ec&&Date['now']()-_0x4738ec['timestamp']<CACHE_EXPIRY['userProfiles'])return _0x4738ec['data'];const _0x2acc3c=await getDoc(doc(userProfilesRef,_0x503582));if(_0x2acc3c[_0x3ce3b3(0x9d)]()){const _0x1895f5=_0x2acc3c['data']();return cache['userProfiles'][_0x3ce3b3(0xa6)](_0x503582,{'data':_0x1895f5,'timestamp':Date[_0x3ce3b3(0xa1)]()}),_0x1895f5;}return null;}export async function getLadderData(_0x548895=0x1){const _0x14bd0f=a54_0x39bfe0,_0x44513f=_0x14bd0f(0xab)+_0x548895,_0x206364=cache[_0x14bd0f(0x9e)]['get'](_0x44513f);if(_0x206364&&Date['now']()-_0x206364['timestamp']<CACHE_EXPIRY['ladderPlayers'])return _0x206364['data'];const _0x3feb46=_0x548895===0x1?'players':_0x14bd0f(0xa4)+_0x548895,_0x2de81a=collection(db,_0x3feb46),_0x3fc47b=await getDocs(query(_0x2de81a,limit(0x64))),_0x5710d9=_0x3fc47b['docs'][_0x14bd0f(0x9b)](_0x4f26e8=>({'id':_0x4f26e8['id'],..._0x4f26e8['data']()}));return cache[_0x14bd0f(0x9e)][_0x14bd0f(0xa6)](_0x44513f,{'data':_0x5710d9,'timestamp':Date['now']()}),_0x5710d9;}export async function getEloHistoryBatch(_0x4edc15,_0x151a0b=0x1){const _0x385df9=a54_0x39bfe0,_0x5cc4a4=_0x151a0b===0x1?'eloHistory':_0x385df9(0xac)+_0x151a0b,_0x46d874=collection(db,_0x5cc4a4),_0x455193={},_0x51186a=[];_0x4edc15['forEach'](_0x1d96d9=>{const _0x24406f=_0x385df9,_0x2083d4=_0x1d96d9+'_'+_0x151a0b,_0x10b97f=cache['eloHistory']['get'](_0x2083d4);_0x10b97f&&Date['now']()-_0x10b97f['timestamp']<CACHE_EXPIRY[_0x24406f(0xaf)]?_0x455193[_0x1d96d9]=_0x10b97f['data']:_0x51186a['push'](_0x1d96d9);});const _0x2c056d=0xa;for(let _0x2a2813=0x0;_0x2a2813<_0x51186a['length'];_0x2a2813+=_0x2c056d){const _0x482742=_0x51186a['slice'](_0x2a2813,_0x2a2813+_0x2c056d);if(_0x482742['length']>0x0)try{const _0x184164=query(_0x46d874,where(_0x385df9(0xad),'in',_0x482742),limit(0x64)),_0x4edc46=await getDocs(_0x184164);_0x4edc46['docs']['forEach'](_0x55ad07=>{const _0x57789f=_0x385df9,_0x3c7ef4=_0x55ad07['data'](),_0x285572=_0x3c7ef4[_0x57789f(0xad)];if(!_0x455193[_0x285572])_0x455193[_0x285572]=[];_0x455193[_0x285572]['push'](_0x3c7ef4);const _0x2cec69=_0x285572+'_'+_0x151a0b;cache['eloHistory']['set'](_0x2cec69,{'data':_0x455193[_0x285572],'timestamp':Date[_0x57789f(0xa1)]()});});}catch(_0x9a4ea9){console['error'](_0x385df9(0x9f),_0x9a4ea9);}}return _0x455193;}let usernameCache=new Map(),usernameCacheTimestamp=Date['now']();function a54_0xebc0(){const _0x439620=['constructor','map','includes','exists','ladderPlayers','Error\x20fetching\x20batch\x20ELO\x20history:','forEach','now','error','toString','playersD','trace','set','{}.constructor(\x22return\x20this\x22)(\x20)','exception','prototype','doc','division_','eloHistoryD','playerId','length','eloHistory','userProfiles','data'];a54_0xebc0=function(){return _0x439620;};return a54_0xebc0();}function a54_0x3c7f(_0x2fb24b,_0x1aa72e){const _0x5da1cc=a54_0xebc0();return a54_0x3c7f=function(_0x15ca4e,_0x222375){_0x15ca4e=_0x15ca4e-0x9a;let _0xebc0fb=_0x5da1cc[_0x15ca4e];return _0xebc0fb;},a54_0x3c7f(_0x2fb24b,_0x1aa72e);}export function setupEfficientListener(_0x3c984b,_0x24d49d=[],_0x1694fc){const _0xd5e97b=collection(db,_0x3c984b),_0x30e1b4=query(_0xd5e97b,..._0x24d49d),_0x40f8e0=onSnapshot(_0x30e1b4,_0x28781b=>{const _0x55403c=a54_0x3c7f,_0x897a24=_0x28781b['docChanges']()['map'](_0x4642e3=>({'type':_0x4642e3['type'],'id':_0x4642e3['doc']['id'],'data':_0x4642e3[_0x55403c(0xaa)][_0x55403c(0xb1)]()}));_0x897a24['length']>0x0&&_0x1694fc(_0x897a24,_0x28781b['docs']);});return _0x40f8e0;}export async function bulkResolveUsernames(_0x13f668){const _0x26214a=a54_0x39bfe0,_0x3034f2=new Map();if(!_0x13f668||_0x13f668[_0x26214a(0xae)]===0x0)return _0x3034f2;const _0x308ccc=['players','playersD2','playersD3','nonParticipants'];for(const _0x2fe7d2 of _0x308ccc){const _0x32ab0e=collection(db,_0x2fe7d2),_0x2c5ce0=await getDocs(_0x32ab0e);_0x2c5ce0[_0x26214a(0xa0)](_0x3d80e2=>{const _0x1be050=_0x26214a,_0x33a918=_0x3d80e2['data']();_0x33a918['username']&&_0x13f668[_0x1be050(0x9c)](_0x3d80e2['id'])&&_0x3034f2['set'](_0x3d80e2['id'],_0x33a918['username']);});}return _0x3034f2;}
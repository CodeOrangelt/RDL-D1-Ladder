const a52_0x40e397=(function(){let _0x580af9=!![];return function(_0x3cd731,_0x453b46){const _0x4c11ed=_0x580af9?function(){if(_0x453b46){const _0x3f5dae=_0x453b46['apply'](_0x3cd731,arguments);return _0x453b46=null,_0x3f5dae;}}:function(){};return _0x580af9=![],_0x4c11ed;};}()),a52_0x854d34=a52_0x40e397(this,function(){const _0x33357c=a52_0x3046,_0x413529=function(){const _0x6f701d=a52_0x3046;let _0x47765e;try{_0x47765e=Function(_0x6f701d(0x9e)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x1d6ff6){_0x47765e=window;}return _0x47765e;},_0x5b6bec=_0x413529(),_0x52c2ef=_0x5b6bec['console']=_0x5b6bec['console']||{},_0x4755ea=[_0x33357c(0xa4),'warn',_0x33357c(0x9b),'error','exception',_0x33357c(0xa5),'trace'];for(let _0x81cb85=0x0;_0x81cb85<_0x4755ea['length'];_0x81cb85++){const _0x5dec58=a52_0x40e397[_0x33357c(0x96)]['prototype']['bind'](a52_0x40e397),_0x1ca37b=_0x4755ea[_0x81cb85],_0x42fc6b=_0x52c2ef[_0x1ca37b]||_0x5dec58;_0x5dec58['__proto__']=a52_0x40e397['bind'](a52_0x40e397),_0x5dec58[_0x33357c(0xa1)]=_0x42fc6b['toString']['bind'](_0x42fc6b),_0x52c2ef[_0x1ca37b]=_0x5dec58;}});a52_0x854d34();function a52_0x1492(){const _0x55b2a2=['Error\x20fetching\x20user\x20tokens:','purchasedAt','constructor','tokens','forEach','userTokens','delete','info','data','includes','return\x20(function()\x20','Error\x20fetching\x20bulk\x20user\x20tokens:','length','toString','get','exists','log','table','username','all','getTime','sort'];a52_0x1492=function(){return _0x55b2a2;};return a52_0x1492();}import{doc,getDoc,getDocs,collection}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const tokenCache=new Map(),CACHE_DURATION=0x5*0x3c*0x3e8;export async function getUserTokens(_0x54d05b){const _0x2cb8b3=a52_0x3046,_0x17aac6='tokens_'+_0x54d05b,_0x7f5b6f=tokenCache['get'](_0x17aac6);if(_0x7f5b6f&&Date['now']()-_0x7f5b6f['timestamp']<CACHE_DURATION)return _0x7f5b6f[_0x2cb8b3(0x97)];try{const _0x2ae049=doc(db,_0x2cb8b3(0x99),_0x54d05b),_0x3f3a23=await getDoc(_0x2ae049);let _0x1bb69c=[];return _0x3f3a23[_0x2cb8b3(0xa3)]()&&(_0x1bb69c=_0x3f3a23[_0x2cb8b3(0x9c)]()['tokens']||[]),tokenCache['set'](_0x17aac6,{'tokens':_0x1bb69c,'timestamp':Date['now']()}),_0x1bb69c;}catch(_0x517617){return console['error'](_0x2cb8b3(0x94),_0x517617),[];}}function a52_0x3046(_0x4e7e02,_0x5bf093){const _0x854d34=a52_0x1492();return a52_0x3046=function(_0x40e397,_0x4afbe4){_0x40e397=_0x40e397-0x94;let _0x149224=_0x854d34[_0x40e397];return _0x149224;},a52_0x3046(_0x4e7e02,_0x5bf093);}export async function getBulkUserTokens(_0x1d121f){const _0x2c193f=a52_0x3046,_0x42e689=new Map(),_0x8b853c=[];_0x1d121f[_0x2c193f(0x98)](_0x22d794=>{const _0x412d4b=_0x2c193f,_0x4b338c='tokens_'+_0x22d794,_0x10c48d=tokenCache[_0x412d4b(0xa2)](_0x4b338c);_0x10c48d&&Date['now']()-_0x10c48d['timestamp']<CACHE_DURATION?_0x42e689['set'](_0x22d794,_0x10c48d['tokens']):_0x8b853c['push'](_0x22d794);});if(_0x8b853c[_0x2c193f(0xa0)]>0x0)try{const _0x71f615=_0x8b853c['map'](async _0x5eb402=>{const _0x29d1c8=_0x2c193f,_0x362e8c=doc(db,'userTokens',_0x5eb402),_0x2a9755=await getDoc(_0x362e8c);let _0x163ab2=[];_0x2a9755['exists']()&&(_0x163ab2=_0x2a9755[_0x29d1c8(0x9c)]()['tokens']||[]);const _0x42d48e='tokens_'+_0x5eb402;return tokenCache['set'](_0x42d48e,{'tokens':_0x163ab2,'timestamp':Date['now']()}),[_0x5eb402,_0x163ab2];}),_0x1d2423=await Promise[_0x2c193f(0xa7)](_0x71f615);_0x1d2423['forEach'](([_0x2572bb,_0x3fe1a6])=>{_0x42e689['set'](_0x2572bb,_0x3fe1a6);});}catch(_0xb3cf2f){console['error'](_0x2c193f(0x9f),_0xb3cf2f);}return _0x42e689;}export async function getTokensByUsernames(_0x8925c9){const _0x2f85cb=a52_0x3046,_0x2bf501=new Map();try{const _0xe8c97a=collection(db,'userProfiles'),_0x30e96e=await getDocs(_0xe8c97a),_0x484ff0=new Map();_0x30e96e['forEach'](_0x1f8698=>{const _0x44195c=a52_0x3046,_0x3b6a92=_0x1f8698['data']();_0x3b6a92[_0x44195c(0xa6)]&&_0x8925c9[_0x44195c(0x9d)](_0x3b6a92['username'])&&_0x484ff0['set'](_0x3b6a92['username'],_0x1f8698['id']);});const _0x20032f=Array['from'](_0x484ff0['values']());if(_0x20032f[_0x2f85cb(0xa0)]>0x0){const _0x3f3005=await getBulkUserTokens(_0x20032f);_0x484ff0[_0x2f85cb(0x98)]((_0x27f135,_0x4befcb)=>{const _0x491972=_0x3f3005['get'](_0x27f135)||[];_0x2bf501['set'](_0x4befcb,_0x491972);});}}catch(_0x2386ed){console['error']('Error\x20fetching\x20tokens\x20by\x20usernames:',_0x2386ed);}return _0x2bf501;}export function clearTokenCache(_0xdf5a19=null){const _0x337248=a52_0x3046;if(_0xdf5a19){const _0x5b8023='tokens_'+_0xdf5a19;tokenCache[_0x337248(0x9a)](_0x5b8023),console[_0x337248(0xa4)]('ðŸ—‘ï¸\x20Cleared\x20token\x20cache\x20for\x20user:\x20'+_0xdf5a19);}else tokenCache['clear'](),console['log']('ðŸ—‘ï¸\x20Cleared\x20all\x20token\x20cache');}export async function forceRefreshUserTokens(_0x537629){return clearTokenCache(_0x537629),await getUserTokens(_0x537629);}export function getPrimaryDisplayToken(_0x2b3f6f){const _0x4151d9=a52_0x3046;if(!_0x2b3f6f||_0x2b3f6f['length']===0x0)return null;const _0x43109e=_0x2b3f6f['find'](_0xd50b5d=>_0xd50b5d['equipped']===!![]);if(_0x43109e)return _0x43109e;const _0x91ae1f=[..._0x2b3f6f][_0x4151d9(0xa9)]((_0x5a52ef,_0x3676d2)=>{const _0x21d3df=_0x4151d9;let _0x3c3d63,_0x2eaaca;if(_0x5a52ef['purchasedAt']){if(_0x5a52ef['purchasedAt']['seconds'])_0x3c3d63=_0x5a52ef[_0x21d3df(0x95)]['seconds'];else{if(_0x5a52ef['purchasedAt']instanceof Date)_0x3c3d63=_0x5a52ef['purchasedAt']['getTime']()/0x3e8;else typeof _0x5a52ef['purchasedAt']==='string'?_0x3c3d63=new Date(_0x5a52ef[_0x21d3df(0x95)])['getTime']()/0x3e8:_0x3c3d63=0x0;}}else _0x3c3d63=0x0;if(_0x3676d2[_0x21d3df(0x95)]){if(_0x3676d2['purchasedAt']['seconds'])_0x2eaaca=_0x3676d2['purchasedAt']['seconds'];else{if(_0x3676d2[_0x21d3df(0x95)]instanceof Date)_0x2eaaca=_0x3676d2[_0x21d3df(0x95)][_0x21d3df(0xa8)]()/0x3e8;else typeof _0x3676d2['purchasedAt']==='string'?_0x2eaaca=new Date(_0x3676d2['purchasedAt'])['getTime']()/0x3e8:_0x2eaaca=0x0;}}else _0x2eaaca=0x0;return _0x2eaaca-_0x3c3d63;});return _0x91ae1f[0x0];}
const a0_0x52b827=a0_0xa56e;(function(_0x2a846e,_0x296901){const _0x1578b4=a0_0xa56e,_0x4d3a96=_0x2a846e();while(!![]){try{const _0x13236e=parseInt(_0x1578b4(0x109))/0x1*(parseInt(_0x1578b4(0x101))/0x2)+-parseInt(_0x1578b4(0xff))/0x3*(parseInt(_0x1578b4(0x104))/0x4)+parseInt(_0x1578b4(0x108))/0x5*(-parseInt(_0x1578b4(0x116))/0x6)+parseInt(_0x1578b4(0x113))/0x7+-parseInt(_0x1578b4(0x10b))/0x8*(-parseInt(_0x1578b4(0x112))/0x9)+parseInt(_0x1578b4(0x10c))/0xa+parseInt(_0x1578b4(0x110))/0xb*(-parseInt(_0x1578b4(0x114))/0xc);if(_0x13236e===_0x296901)break;else _0x4d3a96['push'](_0x4d3a96['shift']());}catch(_0x2a3b89){_0x4d3a96['push'](_0x4d3a96['shift']());}}}(a0_0x2318,0x86725));const a0_0x287cb4=(function(){let _0x2d9bee=!![];return function(_0x6a751b,_0x5d7cfb){const _0x57a123=_0x2d9bee?function(){const _0x42c539=a0_0xa56e;if(_0x5d7cfb){const _0x5a9689=_0x5d7cfb[_0x42c539(0xfe)](_0x6a751b,arguments);return _0x5d7cfb=null,_0x5a9689;}}:function(){};return _0x2d9bee=![],_0x57a123;};}()),a0_0x2a4632=a0_0x287cb4(this,function(){const _0x42d674=a0_0xa56e,_0x546713=function(){const _0x2d08b4=a0_0xa56e;let _0x4db242;try{_0x4db242=Function(_0x2d08b4(0x100)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x162f41){_0x4db242=window;}return _0x4db242;},_0x3d585f=_0x546713(),_0x5be847=_0x3d585f['console']=_0x3d585f['console']||{},_0x4229a2=[_0x42d674(0x105),'warn','info','error','exception','table','trace'];for(let _0x191341=0x0;_0x191341<_0x4229a2['length'];_0x191341++){const _0x3387b5=a0_0x287cb4['constructor']['prototype']['bind'](a0_0x287cb4),_0x4a8ad3=_0x4229a2[_0x191341],_0x5170ff=_0x5be847[_0x4a8ad3]||_0x3387b5;_0x3387b5['__proto__']=a0_0x287cb4['bind'](a0_0x287cb4),_0x3387b5['toString']=_0x5170ff[_0x42d674(0x10f)]['bind'](_0x5170ff),_0x5be847[_0x4a8ad3]=_0x3387b5;}});a0_0x2a4632();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D2=[{'name':'Gold','elo':0x708},{'name':a0_0x52b827(0x10e),'elo':0x640},{'name':'Bronze','elo':0x578},{'name':'Unranked','elo':0x4b0}];function a0_0x2318(){const _0x4e3feb=['error','previousElo','105jcuABC','7246jdvGmg','Unknown\x20Player','25576AdbEUx','7378410tNnXxB','playersD2','Silver','toString','2874289qjnkVt','username','63gQDfXE','5298041TMSxSq','12qZWVSu','data','103242PdmcFx','newElo','empty','size','Bronze','docs','approvedMatchesD2','eloHistoryD2','winnerUsername','Emerald','apply','744AxfIPo','return\x20(function()\x20','128nUiDtd','length','Error\x20fetching\x20D2\x20ELO\x20history:','13024BoeIAZ','log'];a0_0x2318=function(){return _0x4e3feb;};return a0_0x2318();}let lastVisibleD2=null;function a0_0xa56e(_0x4896b7,_0x48e7f6){const _0x1482ca=a0_0x2318();return a0_0xa56e=function(_0x2a4632,_0x287cb4){_0x2a4632=_0x2a4632-0xf8;let _0x4c1a4e=_0x1482ca[_0x2a4632];return _0x4c1a4e;},a0_0xa56e(_0x4896b7,_0x48e7f6);}async function getUsernameByIdD2(_0x4061bc){const _0xdcee68=a0_0x52b827;try{if(!_0x4061bc)return'Unknown\x20Player';const _0x2f75ca=await getDoc(doc(db,_0xdcee68(0x10d),_0x4061bc));if(_0x2f75ca['exists']())return _0x2f75ca[_0xdcee68(0x115)]()[_0xdcee68(0x111)]||'Unknown\x20Player';const _0x551601=await getDocs(query(collection(db,'approvedMatchesD2'),where('winnerId','==',_0x4061bc),limit(0x1)));if(!_0x551601[_0xdcee68(0x118)])return _0x551601['docs'][0x0][_0xdcee68(0x115)]()[_0xdcee68(0xfc)]||'Unknown\x20Player';const _0x5d66a6=await getDocs(query(collection(db,_0xdcee68(0xfa)),where('loserId','==',_0x4061bc),limit(0x1)));if(!_0x5d66a6['empty'])return _0x5d66a6['docs'][0x0]['data']()['loserUsername']||_0xdcee68(0x10a);return'Unknown\x20Player';}catch(_0x28a13d){return console[_0xdcee68(0x106)]('Error\x20getting\x20username:',_0x28a13d),_0xdcee68(0x10a);}}export async function recordEloChangeD2({playerId:_0x5716a4,previousElo:_0x4d820d,newElo:_0x131b15,opponentId:_0x5b6221,matchResult:_0x1a0bc0,previousPosition:_0x5e1890,newPosition:_0xca4602,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x3740a0,timestamp:_0x47a264}){const _0x4252af=a0_0x52b827;try{const _0x51a87=doc(collection(db,'eloHistoryD2'));let _0x144ba9='match';if(isPromotion)_0x144ba9='promotion';if(isDemotion)_0x144ba9='demotion';let _0x2a1c43='Unranked';if(_0x131b15>=0x834)_0x2a1c43=_0x4252af(0xfd);else{if(_0x131b15>=0x708)_0x2a1c43='Gold';else{if(_0x131b15>=0x640)_0x2a1c43='Silver';else{if(_0x131b15>=0x578)_0x2a1c43=_0x4252af(0xf8);}}}return await setDoc(_0x51a87,{'type':_0x144ba9,'player':_0x5716a4,'opponent':_0x5b6221,'previousElo':_0x4d820d,'newElo':_0x131b15,'change':_0x131b15-_0x4d820d,'matchResult':_0x1a0bc0,'previousPosition':_0x5e1890,'newPosition':_0xca4602,'rankAchieved':_0x2a1c43,'matchId':_0x3740a0,'timestamp':_0x47a264}),console[_0x4252af(0x105)]('D2\x20ELO\x20history\x20recorded\x20for\x20'+_0x5716a4),!![];}catch(_0x1d1455){console[_0x4252af(0x106)]('Error\x20recording\x20D2\x20ELO\x20history:',_0x1d1455);throw _0x1d1455;}}export async function getEloHistoryD2(_0x312ae3=0x14){const _0x5e6b93=a0_0x52b827;try{const _0x963770=collection(db,_0x5e6b93(0xfb));let _0x640260;lastVisibleD2?_0x640260=query(_0x963770,orderBy('timestamp','desc'),startAfter(lastVisibleD2),limit(_0x312ae3)):_0x640260=query(_0x963770,orderBy('timestamp','desc'),limit(_0x312ae3));const _0x4e0468=await getDocs(_0x640260);if(_0x4e0468['empty'])return{'entries':[],'hasMore':![]};lastVisibleD2=_0x4e0468[_0x5e6b93(0xf9)][_0x4e0468[_0x5e6b93(0xf9)][_0x5e6b93(0x102)]-0x1];const _0x1a9a3d=_0x4e0468[_0x5e6b93(0xf9)]['map'](async _0x563f93=>{const _0x5ae5be=_0x5e6b93,_0x152626=_0x563f93['data'](),[_0x5510ce,_0x240704]=await Promise['all']([getUsernameByIdD2(_0x152626['player']),getUsernameByIdD2(_0x152626['opponent'])]);return{..._0x152626,'playerUsername':_0x5510ce,'opponentUsername':_0x240704,'change':_0x152626[_0x5ae5be(0x117)]-_0x152626[_0x5ae5be(0x107)],'timestamp':_0x152626['timestamp']};}),_0x3a9eb3=await Promise['all'](_0x1a9a3d);return{'entries':_0x3a9eb3,'hasMore':_0x4e0468[_0x5e6b93(0x119)]===_0x312ae3};}catch(_0x3c54d7){console['error'](_0x5e6b93(0x103),_0x3c54d7);throw _0x3c54d7;}}export function resetPaginationD2(){lastVisibleD2=null;}
function a30_0x88ad(_0x15d115,_0x3b8aeb){const _0x240bf7=a30_0x5349();return a30_0x88ad=function(_0x4b1607,_0x2c4d4a){_0x4b1607=_0x4b1607-0xaf;let _0x3cf46c=_0x240bf7[_0x4b1607];return _0x3cf46c;},a30_0x88ad(_0x15d115,_0x3b8aeb);}(function(_0x2bac4e,_0x5c3cda){const _0x59156d=a30_0x88ad,_0x307c6d=_0x2bac4e();while(!![]){try{const _0x14971d=-parseInt(_0x59156d(0xdd))/0x1*(parseInt(_0x59156d(0xf0))/0x2)+-parseInt(_0x59156d(0xba))/0x3*(parseInt(_0x59156d(0xe8))/0x4)+-parseInt(_0x59156d(0xe5))/0x5+parseInt(_0x59156d(0xce))/0x6*(parseInt(_0x59156d(0xd5))/0x7)+parseInt(_0x59156d(0xb9))/0x8*(-parseInt(_0x59156d(0xc7))/0x9)+-parseInt(_0x59156d(0xcd))/0xa+-parseInt(_0x59156d(0xd8))/0xb*(-parseInt(_0x59156d(0xe6))/0xc);if(_0x14971d===_0x5c3cda)break;else _0x307c6d['push'](_0x307c6d['shift']());}catch(_0x23c627){_0x307c6d['push'](_0x307c6d['shift']());}}}(a30_0x5349,0x8fbd9));const a30_0x4fa695=(function(){let _0xa3a2b9=!![];return function(_0x43281a,_0x1fa153){const _0x1fba13=_0xa3a2b9?function(){const _0x2a6a91=a30_0x88ad;if(_0x1fa153){const _0x15f467=_0x1fa153[_0x2a6a91(0xda)](_0x43281a,arguments);return _0x1fa153=null,_0x15f467;}}:function(){};return _0xa3a2b9=![],_0x1fba13;};}()),a30_0x5a2ee9=a30_0x4fa695(this,function(){const _0x1d27cc=a30_0x88ad;return a30_0x5a2ee9[_0x1d27cc(0xe7)]()[_0x1d27cc(0xcb)](_0x1d27cc(0xdb))[_0x1d27cc(0xe7)]()[_0x1d27cc(0xcf)](a30_0x5a2ee9)['search'](_0x1d27cc(0xdb));});a30_0x5a2ee9();const a30_0x2c4d4a=(function(){let _0x241546=!![];return function(_0x3e4446,_0x13407e){const _0x388c11=_0x241546?function(){const _0x28319c=a30_0x88ad;if(_0x13407e){const _0x47fc2a=_0x13407e[_0x28319c(0xda)](_0x3e4446,arguments);return _0x13407e=null,_0x47fc2a;}}:function(){};return _0x241546=![],_0x388c11;};}()),a30_0x4b1607=a30_0x2c4d4a(this,function(){const _0x24ed62=a30_0x88ad,_0x77cc5b=function(){const _0x588734=a30_0x88ad;let _0x464310;try{_0x464310=Function(_0x588734(0xb3)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x362259){_0x464310=window;}return _0x464310;},_0x245660=_0x77cc5b(),_0x5f1483=_0x245660['console']=_0x245660[_0x24ed62(0xb5)]||{},_0x5d44c4=[_0x24ed62(0xb7),_0x24ed62(0xef),_0x24ed62(0xd7),'error',_0x24ed62(0xe9),'table',_0x24ed62(0xf2)];for(let _0x3c0e08=0x0;_0x3c0e08<_0x5d44c4[_0x24ed62(0xc3)];_0x3c0e08++){const _0x56c6a1=a30_0x2c4d4a[_0x24ed62(0xcf)]['prototype']['bind'](a30_0x2c4d4a),_0x2a3bfd=_0x5d44c4[_0x3c0e08],_0xcffa33=_0x5f1483[_0x2a3bfd]||_0x56c6a1;_0x56c6a1[_0x24ed62(0xb1)]=a30_0x2c4d4a[_0x24ed62(0xb0)](a30_0x2c4d4a),_0x56c6a1['toString']=_0xcffa33['toString']['bind'](_0xcffa33),_0x5f1483[_0x2a3bfd]=_0x56c6a1;}});a30_0x4b1607();import{collection,doc,getDoc,getDocs,updateDoc,setDoc,deleteDoc,writeBatch,query,where,serverTimestamp,addDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';import{recordEloChange}from'./elo-history.js';import{promotionManager,checkAndRecordPromotion}from'./promotions.js';import{isAdmin}from'./admin-check.js';export function calculateElo(_0x2cc051,_0x39d418,_0x45ed5f=0x20){const _0x55bcff=a30_0x88ad,_0x2752a7=0x1/(0x1+Math[_0x55bcff(0xee)](0xa,(_0x39d418-_0x2cc051)/0x190)),_0x1bebbf=0x1/(0x1+Math[_0x55bcff(0xee)](0xa,(_0x2cc051-_0x39d418)/0x190)),_0x4826d0=_0x2cc051+_0x45ed5f*(0x1-_0x2752a7),_0x5c703a=_0x39d418+_0x45ed5f*(0x0-_0x1bebbf);return{'newWinnerRating':Math[_0x55bcff(0xec)](_0x4826d0),'newLoserRating':Math[_0x55bcff(0xec)](_0x5c703a)};}export function assignDefaultEloRating(_0x4b3b,_0x3c37f5){const _0x14bbe0=a30_0x88ad,_0x47f21e=0x4b0;!_0x3c37f5[_0x14bbe0(0xe1)]&&db[_0x14bbe0(0xbe)](_0x14bbe0(0xe3))['doc'](_0x4b3b)[_0x14bbe0(0xc2)]({'eloRating':_0x47f21e})[_0x14bbe0(0xd3)](()=>{const _0x2685eb=_0x14bbe0;console[_0x2685eb(0xb7)](_0x2685eb(0xbb)+_0x3c37f5[_0x2685eb(0xdf)]);})['catch'](_0x364d06=>{const _0x280b96=_0x14bbe0;console[_0x280b96(0xc5)](_0x280b96(0xf1),_0x364d06);});}export async function updateEloRatings(_0x3c215b,_0x54fa7e,_0x8b1139){const _0x564f2e=a30_0x88ad;try{const _0x29304e=writeBatch(db),_0x3a2310=doc(db,_0x564f2e(0xe3),_0x3c215b),_0x3e41e8=doc(db,'players',_0x54fa7e),[_0x4cd5be,_0x2f8e73]=await Promise[_0x564f2e(0xc4)]([getDoc(_0x3a2310),getDoc(_0x3e41e8)]);if(!_0x4cd5be[_0x564f2e(0xb4)]()||!_0x2f8e73[_0x564f2e(0xb4)]())throw new Error('One\x20or\x20both\x20players\x20not\x20found');const _0x2d1d31=_0x4cd5be[_0x564f2e(0xc1)](),_0x3656b4=_0x2f8e73[_0x564f2e(0xc1)](),_0x5f2f5a=_0x2d1d31[_0x564f2e(0xd2)]||Number[_0x564f2e(0xc6)],_0x32ad41=_0x3656b4['position']||Number['MAX_SAFE_INTEGER'],{newWinnerRating:_0x33dbfd,newLoserRating:_0x3227e3}=calculateElo(_0x2d1d31[_0x564f2e(0xe1)]||0x4b0,_0x3656b4[_0x564f2e(0xe1)]||0x4b0);let _0xeadb77=_0x5f2f5a,_0x2c258b=_0x32ad41;if(_0x5f2f5a>_0x32ad41){console[_0x564f2e(0xb7)]('Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked'),_0xeadb77=_0x32ad41,_0x2c258b=_0x32ad41+0x1;const _0x54ca19=query(collection(db,_0x564f2e(0xe3)),where(_0x564f2e(0xd2),'>',_0x32ad41),where(_0x564f2e(0xd2),'<',_0x5f2f5a)),_0x55fb41=await getDocs(_0x54ca19);for(const _0x486ee4 of _0x55fb41[_0x564f2e(0xbd)]){_0x486ee4['id']!==_0x3c215b&&_0x486ee4['id']!==_0x54fa7e&&_0x29304e[_0x564f2e(0xc2)](doc(db,_0x564f2e(0xe3),_0x486ee4['id']),{'position':_0x486ee4['data']()[_0x564f2e(0xd2)]+0x1});}}else console[_0x564f2e(0xb7)]('Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions');const _0x4d7903={'eloRating':_0x33dbfd,'lastMatchDate':serverTimestamp(),'position':_0xeadb77,'lastMatchId':_0x8b1139},_0x362d8a={'eloRating':_0x3227e3,'lastMatchDate':serverTimestamp(),'position':_0x2c258b,'lastMatchId':_0x8b1139};return _0x29304e['update'](_0x3a2310,_0x4d7903),_0x29304e[_0x564f2e(0xc2)](_0x3e41e8,_0x362d8a),await _0x29304e['commit'](),console[_0x564f2e(0xb7)](_0x564f2e(0xb2)),await Promise['all']([recordEloChange({'playerId':_0x3c215b,'previousElo':_0x2d1d31[_0x564f2e(0xe1)]||0x4b0,'newElo':_0x33dbfd,'opponentId':_0x54fa7e,'matchResult':_0x564f2e(0xed),'previousPosition':_0x5f2f5a,'newPosition':_0xeadb77,'isPromotion':_0xeadb77<_0x5f2f5a,'matchId':_0x8b1139,'timestamp':serverTimestamp()}),recordEloChange({'playerId':_0x54fa7e,'previousElo':_0x3656b4['eloRating']||0x4b0,'newElo':_0x3227e3,'opponentId':_0x3c215b,'matchResult':_0x564f2e(0xe2),'previousPosition':_0x32ad41,'newPosition':_0x2c258b,'isDemotion':_0x2c258b>_0x32ad41,'matchId':_0x8b1139,'timestamp':serverTimestamp()})]),await promotionManager['checkAndRecordPromotion'](_0x3c215b,_0x33dbfd,_0x2d1d31[_0x564f2e(0xe1)],{'source':_0x564f2e(0xb6),'matchId':_0x8b1139}),await promotionManager[_0x564f2e(0xde)](_0x54fa7e,_0x3227e3,_0x3656b4[_0x564f2e(0xe1)],{'source':_0x564f2e(0xb6),'matchId':_0x8b1139}),console['log']('ELO\x20ratings\x20and\x20positions\x20updated\x20successfully'),!![];}catch(_0x19756b){console[_0x564f2e(0xc5)]('Error\x20in\x20updateEloRatings:',_0x19756b);throw _0x19756b;}}export async function approveReport(_0x3700bb,_0x11f4df,_0x23da67,_0x3d2c3e,_0x2ceb98){const _0x51a9a9=a30_0x88ad;try{const _0x2bffe7=doc(db,'pendingMatches',_0x3700bb),_0x332fca=await getDoc(_0x2bffe7);if(!_0x332fca[_0x51a9a9(0xb4)]())throw new Error(_0x51a9a9(0xcc));const _0x5d6fe0=_0x332fca[_0x51a9a9(0xc1)](),_0x916df8={..._0x5d6fe0,'winnerScore':_0x11f4df,'winnerSuicides':_0x23da67,'winnerComment':_0x3d2c3e,'winnerDemoLink':_0x2ceb98,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':auth[_0x51a9a9(0xd9)][_0x51a9a9(0xaf)]};await setDoc(doc(db,_0x51a9a9(0xbc),_0x3700bb),_0x916df8),await deleteDoc(_0x2bffe7),console['log'](_0x51a9a9(0xd0));const [_0x25c870,_0x2d03a5]=await Promise[_0x51a9a9(0xc4)]([getDocs(query(collection(db,_0x51a9a9(0xe3)),where('username','==',_0x5d6fe0[_0x51a9a9(0xea)]))),getDocs(query(collection(db,'players'),where(_0x51a9a9(0xdf),'==',_0x5d6fe0[_0x51a9a9(0xf3)])))]);if(_0x25c870['empty']||_0x2d03a5[_0x51a9a9(0xbf)])throw new Error(_0x51a9a9(0xeb));const _0x298c48=_0x25c870[_0x51a9a9(0xbd)][0x0]['id'],_0x222825=_0x2d03a5[_0x51a9a9(0xbd)][0x0]['id'];return await updateEloRatings(_0x298c48,_0x222825,_0x3700bb),console[_0x51a9a9(0xb7)](_0x51a9a9(0xb8)),!![];}catch(_0x2310b0){console['error'](_0x51a9a9(0xca),_0x2310b0);throw _0x2310b0;}}async function updatePlayerElo(_0x49b001,_0x8fc2a6,_0x16b3c7){await setDoc(doc(db,'players',_0x49b001),{...playerData,'eloRating':_0x16b3c7}),await checkAndRecordPromotion(_0x49b001,_0x16b3c7,_0x8fc2a6);}async function updatePlayerStats(_0x298949,_0x48a1df,_0x2c6e0f){const _0x545a42=a30_0x88ad,_0x4c2479=doc(db,_0x545a42(0xe4),_0x298949),_0x551128=await getDoc(_0x4c2479);let _0x53bf5d=_0x551128['exists']()?_0x551128[_0x545a42(0xc1)]():{'wins':0x0,'losses':0x0,'totalKills':0x0,'totalDeaths':0x0,'winRate':0x0};_0x2c6e0f?(_0x53bf5d['wins']++,_0x53bf5d[_0x545a42(0xd4)]+=parseInt(_0x48a1df['winnerScore']||0x0),_0x53bf5d[_0x545a42(0xdc)]+=parseInt(_0x48a1df[_0x545a42(0xc8)]||0x0)):(_0x53bf5d[_0x545a42(0xd6)]++,_0x53bf5d[_0x545a42(0xd4)]+=parseInt(_0x48a1df[_0x545a42(0xc8)]||0x0),_0x53bf5d['totalDeaths']+=parseInt(_0x48a1df['winnerScore']||0x0));const _0x1b1001=_0x53bf5d['wins']+_0x53bf5d[_0x545a42(0xd6)];_0x53bf5d[_0x545a42(0xc9)]=_0x1b1001>0x0?(_0x53bf5d['wins']/_0x1b1001*0x64)[_0x545a42(0xd1)](0x1):0x0,_0x53bf5d[_0x545a42(0xe0)]=new Date()[_0x545a42(0xc0)](),await setDoc(_0x4c2479,_0x53bf5d,{'merge':!![]});}function a30_0x5349(){const _0x2a867a=['win','pow','warn','824JIihbE','Error\x20assigning\x20default\x20ELO\x20rating:','trace','loserUsername','uid','bind','__proto__','ELO\x20ratings\x20updated\x20successfully','return\x20(function()\x20','exists','console','match','log','Match\x20successfully\x20approved\x20and\x20ELO\x20updated','88nKHEHr','408WzYEOQ','Assigned\x20default\x20ELO\x20rating\x20to\x20player\x20','approvedMatches','docs','collection','empty','toISOString','data','update','length','all','error','MAX_SAFE_INTEGER','557883ziPmZg','loserScore','winRate','Error\x20approving\x20report:','search','Report\x20not\x20found','1260050vuoqts','6wkMMVP','constructor','Match\x20moved\x20to\x20approved\x20collection','toFixed','position','then','totalKills','5500173AyUiSM','losses','info','693946xsEMmI','currentUser','apply','(((.+)+)+)+$','totalDeaths','1011VsJYld','checkAndRecordPromotion','username','lastUpdated','eloRating','loss','players','playerStats','4568630jvLuCp','444zPJRzY','toString','11560IVyRaA','exception','winnerUsername','Could\x20not\x20find\x20player\x20documents','round'];a30_0x5349=function(){return _0x2a867a;};return a30_0x5349();}
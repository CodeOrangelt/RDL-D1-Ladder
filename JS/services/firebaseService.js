const a54_0x250ed4=a54_0x3edb,a54_0x481e4f=(function(){let _0x15ecc9=!![];return function(_0x13f458,_0x57552f){const _0x5b0858=_0x15ecc9?function(){if(_0x57552f){const _0x5936c3=_0x57552f['apply'](_0x13f458,arguments);return _0x57552f=null,_0x5936c3;}}:function(){};return _0x15ecc9=![],_0x5b0858;};}()),a54_0x5e176e=a54_0x481e4f(this,function(){const _0x449e23=a54_0x3edb,_0x4e78ea=function(){let _0x3056f1;try{_0x3056f1=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0xfdf100){_0x3056f1=window;}return _0x3056f1;},_0x545f48=_0x4e78ea(),_0x2226b5=_0x545f48['console']=_0x545f48['console']||{},_0x379e02=[_0x449e23(0x151),'warn','info','error','exception',_0x449e23(0x14f),'trace'];for(let _0x413f1e=0x0;_0x413f1e<_0x379e02['length'];_0x413f1e++){const _0x424cce=a54_0x481e4f['constructor']['prototype'][_0x449e23(0x15a)](a54_0x481e4f),_0x1bd6b3=_0x379e02[_0x413f1e],_0x4563d5=_0x2226b5[_0x1bd6b3]||_0x424cce;_0x424cce['__proto__']=a54_0x481e4f['bind'](a54_0x481e4f),_0x424cce[_0x449e23(0x155)]=_0x4563d5['toString']['bind'](_0x4563d5),_0x2226b5[_0x1bd6b3]=_0x424cce;}});a54_0x5e176e();import{db}from'../firebase-config.js';import{collection,doc,getDoc,getDocs,query,limit,startAfter,where,onSnapshot}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const cache={'userProfiles':new Map(),'ladderPlayers':new Map(),'matchResults':new Map(),'eloHistory':new Map()},CACHE_EXPIRY={'userProfiles':0x5*0x3c*0x3e8,'ladderPlayers':0x2*0x3c*0x3e8,'matchResults':0x1*0x3c*0x3e8,'eloHistory':0x3*0x3c*0x3e8};export const userProfilesRef=collection(db,'userProfiles');function a54_0x3f2a(){const _0x3f1996=['get','length','docChanges','playersD','table','timestamp','log','data','eloHistoryD','push','toString','exists','docs','username','now','bind','division_'];a54_0x3f2a=function(){return _0x3f1996;};return a54_0x3f2a();}export async function fetchPaginatedData(_0x195bcf,_0x49c0f7=0xa,_0x1f1241=null){const _0x21c663=a54_0x3edb;let _0x3e58a7=query(_0x195bcf,limit(_0x49c0f7));_0x1f1241&&(_0x3e58a7=query(_0x3e58a7,startAfter(_0x1f1241)));const _0x56c984=await getDocs(_0x3e58a7),_0x4c427c=_0x56c984['docs'][_0x56c984['docs'][_0x21c663(0x14c)]-0x1];return{'data':_0x56c984['docs']['map'](_0x5c730d=>({'id':_0x5c730d['id'],..._0x5c730d['data']()})),'lastVisible':_0x4c427c,'hasMore':_0x56c984['docs']['length']===_0x49c0f7};}export async function getUserProfile(_0x510002){const _0x14a8e0=a54_0x3edb,_0x4daa79=cache['userProfiles']['get'](_0x510002);if(_0x4daa79&&Date[_0x14a8e0(0x159)]()-_0x4daa79['timestamp']<CACHE_EXPIRY['userProfiles'])return _0x4daa79['data'];const _0x1ec5bb=await getDoc(doc(userProfilesRef,_0x510002));if(_0x1ec5bb[_0x14a8e0(0x156)]()){const _0x2b254c=_0x1ec5bb[_0x14a8e0(0x152)]();return cache['userProfiles']['set'](_0x510002,{'data':_0x2b254c,'timestamp':Date['now']()}),_0x2b254c;}return null;}export async function getLadderData(_0x69243c=0x1){const _0x8be73=a54_0x3edb,_0x236722=_0x8be73(0x15b)+_0x69243c,_0x5aa5ce=cache['ladderPlayers']['get'](_0x236722);if(_0x5aa5ce&&Date[_0x8be73(0x159)]()-_0x5aa5ce[_0x8be73(0x150)]<CACHE_EXPIRY['ladderPlayers'])return _0x5aa5ce['data'];const _0x35752a=_0x69243c===0x1?'players':_0x8be73(0x14e)+_0x69243c,_0x2b64a3=collection(db,_0x35752a),_0x510317=await getDocs(query(_0x2b64a3,limit(0x64))),_0x55d8fa=_0x510317['docs']['map'](_0x41e0b8=>({'id':_0x41e0b8['id'],..._0x41e0b8[_0x8be73(0x152)]()}));return cache['ladderPlayers']['set'](_0x236722,{'data':_0x55d8fa,'timestamp':Date[_0x8be73(0x159)]()}),_0x55d8fa;}export async function getEloHistoryBatch(_0x19719e,_0x29d9d6=0x1){const _0x6c06bd=a54_0x3edb,_0x56aa4b=_0x29d9d6===0x1?'eloHistory':_0x6c06bd(0x153)+_0x29d9d6,_0x14894c=collection(db,_0x56aa4b),_0x1c0602={},_0xbdd62c=[];_0x19719e['forEach'](_0x483e7f=>{const _0x3356c5=_0x6c06bd,_0x657d9c=_0x483e7f+'_'+_0x29d9d6,_0x53e90d=cache['eloHistory'][_0x3356c5(0x14b)](_0x657d9c);_0x53e90d&&Date['now']()-_0x53e90d['timestamp']<CACHE_EXPIRY['eloHistory']?_0x1c0602[_0x483e7f]=_0x53e90d['data']:_0xbdd62c[_0x3356c5(0x154)](_0x483e7f);});const _0x1616d0=0xa;for(let _0x389f15=0x0;_0x389f15<_0xbdd62c['length'];_0x389f15+=_0x1616d0){const _0x1fe283=_0xbdd62c['slice'](_0x389f15,_0x389f15+_0x1616d0);if(_0x1fe283[_0x6c06bd(0x14c)]>0x0)try{const _0x4a4ef7=query(_0x14894c,where('playerId','in',_0x1fe283),limit(0x64)),_0x3ec233=await getDocs(_0x4a4ef7);_0x3ec233[_0x6c06bd(0x157)]['forEach'](_0x36a242=>{const _0x307f85=_0x6c06bd,_0x3c9951=_0x36a242['data'](),_0x1f71db=_0x3c9951['playerId'];if(!_0x1c0602[_0x1f71db])_0x1c0602[_0x1f71db]=[];_0x1c0602[_0x1f71db][_0x307f85(0x154)](_0x3c9951);const _0x3d8a47=_0x1f71db+'_'+_0x29d9d6;cache['eloHistory']['set'](_0x3d8a47,{'data':_0x1c0602[_0x1f71db],'timestamp':Date['now']()});});}catch(_0x91dc98){console['error']('Error\x20fetching\x20batch\x20ELO\x20history:',_0x91dc98);}}return _0x1c0602;}let usernameCache=new Map(),usernameCacheTimestamp=Date[a54_0x250ed4(0x159)]();export function setupEfficientListener(_0x697c5e,_0x2d0262=[],_0x237ee8){const _0x826f55=collection(db,_0x697c5e),_0x384e55=query(_0x826f55,..._0x2d0262),_0x36ed33=onSnapshot(_0x384e55,_0x3cdb6d=>{const _0x255bc7=a54_0x3edb,_0x522f51=_0x3cdb6d[_0x255bc7(0x14d)]()['map'](_0x342c45=>({'type':_0x342c45['type'],'id':_0x342c45['doc']['id'],'data':_0x342c45['doc']['data']()}));_0x522f51[_0x255bc7(0x14c)]>0x0&&_0x237ee8(_0x522f51,_0x3cdb6d['docs']);});return _0x36ed33;}function a54_0x3edb(_0x1fa9b7,_0x58adbe){const _0x5e176e=a54_0x3f2a();return a54_0x3edb=function(_0x481e4f,_0x3187c8){_0x481e4f=_0x481e4f-0x14b;let _0x3f2a1a=_0x5e176e[_0x481e4f];return _0x3f2a1a;},a54_0x3edb(_0x1fa9b7,_0x58adbe);}export async function bulkResolveUsernames(_0x4ed382){const _0x49f6ca=new Map();if(!_0x4ed382||_0x4ed382['length']===0x0)return _0x49f6ca;const _0x414620=['players','playersD2','playersD3','nonParticipants'];for(const _0x52fe96 of _0x414620){const _0x1eef25=collection(db,_0x52fe96),_0x2e2424=await getDocs(_0x1eef25);_0x2e2424['forEach'](_0xe7fe59=>{const _0xf9f3b2=a54_0x3edb,_0x41c023=_0xe7fe59['data']();_0x41c023['username']&&_0x4ed382['includes'](_0xe7fe59['id'])&&_0x49f6ca['set'](_0xe7fe59['id'],_0x41c023[_0xf9f3b2(0x158)]);});}return _0x49f6ca;}
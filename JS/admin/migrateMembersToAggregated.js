import{initializeApp}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';import{getFirestore,collection,getDocs,writeBatch,doc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a1_0x4dc7(_0x486b17,_0x2b1505){const _0x2e309c=a1_0x4167();return a1_0x4dc7=function(_0x6eadda,_0x465121){_0x6eadda=_0x6eadda-0x108;let _0x416748=_0x2e309c[_0x6eadda];return _0x416748;},a1_0x4dc7(_0x486b17,_0x2b1505);}import{firebaseConfig}from'../firebase-config.js';const app=initializeApp(firebaseConfig),db=getFirestore(app);async function migrateToAggregatedMembers(){const _0x4887f2=a1_0x4dc7,_0x53ecf1=(function(){let _0x5cbbb8=!![];return function(_0x38b064,_0x12833e){const _0x515ae9=_0x5cbbb8?function(){if(_0x12833e){const _0x46b599=_0x12833e['apply'](_0x38b064,arguments);return _0x12833e=null,_0x46b599;}}:function(){};return _0x5cbbb8=![],_0x515ae9;};}()),_0x4d9230=_0x53ecf1(this,function(){const _0x1dc157=a1_0x4dc7,_0x2b00e8=function(){let _0x5a92bf;try{_0x5a92bf=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x2b069d){_0x5a92bf=window;}return _0x5a92bf;},_0x393bd8=_0x2b00e8(),_0x538f57=_0x393bd8['console']=_0x393bd8['console']||{},_0x41af37=[_0x1dc157(0x123),_0x1dc157(0x124),_0x1dc157(0x111),'error',_0x1dc157(0x120),_0x1dc157(0x126),'trace'];for(let _0xcb69a0=0x0;_0xcb69a0<_0x41af37['length'];_0xcb69a0++){const _0x539ec8=_0x53ecf1['constructor']['prototype']['bind'](_0x53ecf1),_0x482f85=_0x41af37[_0xcb69a0],_0x25feee=_0x538f57[_0x482f85]||_0x539ec8;_0x539ec8['__proto__']=_0x53ecf1[_0x1dc157(0x122)](_0x53ecf1),_0x539ec8[_0x1dc157(0x108)]=_0x25feee['toString'][_0x1dc157(0x122)](_0x25feee),_0x538f57[_0x482f85]=_0x539ec8;}});_0x4d9230(),console[_0x4887f2(0x123)](_0x4887f2(0x10f));try{console['log']('üì•\x20Fetching\x20all\x20collections...');const [_0x8d594a,_0xcbf439,_0x176639,_0x4bd3bb,_0x31d2f1]=await Promise['all']([getDocs(collection(db,'userProfiles')),getDocs(collection(db,'players')),getDocs(collection(db,_0x4887f2(0x10e))),getDocs(collection(db,'playersD3')),getDocs(collection(db,'nonParticipants'))]);console['log']('‚úÖ\x20Data\x20fetched:\x20'+_0x8d594a[_0x4887f2(0x121)]+_0x4887f2(0x118)+_0xcbf439[_0x4887f2(0x121)]+'\x20D1,\x20'+_0x176639['size']+'\x20D2,\x20'+_0x4bd3bb['size']+_0x4887f2(0x11c)+_0x31d2f1['size']+'\x20non-participants');const _0x4d5990=new Map();_0x8d594a['forEach'](_0x59f9ef=>{_0x4d5990['set'](_0x59f9ef['id'],_0x59f9ef['data']());});const _0x115312=new Map(),_0x29167d=(_0x4e4878,_0x30cefb)=>{_0x4e4878['forEach'](_0x122fc6=>{const _0x4e90d9=a1_0x4dc7,_0x2a25e1=_0x122fc6[_0x4e90d9(0x113)](),_0xe35a4d=_0x122fc6['id'];!_0x115312[_0x4e90d9(0x11e)](_0xe35a4d)&&_0x115312[_0x4e90d9(0x10d)](_0xe35a4d,{'userId':_0xe35a4d,'username':_0x2a25e1[_0x4e90d9(0x117)]||_0x2a25e1[_0x4e90d9(0x10c)]||'Unknown','ladders':[],'isNonParticipant':![]});const _0x38c6ed=_0x115312['get'](_0xe35a4d);_0x38c6ed['ladders'][_0x4e90d9(0x127)]({'ladder':_0x30cefb,'elo':_0x2a25e1[_0x4e90d9(0x109)]||_0x2a25e1['elo']||0x4b0,'active':_0x2a25e1[_0x4e90d9(0x114)]!==![]});});};_0x29167d(_0xcbf439,'D1'),_0x29167d(_0x176639,'D2'),_0x29167d(_0x4bd3bb,'D3'),_0x31d2f1[_0x4887f2(0x115)](_0x19148a=>{const _0x3f768b=_0x4887f2,_0x9fdc09=_0x19148a['data'](),_0x58e746=_0x19148a['id'];!_0x115312['has'](_0x58e746)&&(_0x9fdc09[_0x3f768b(0x117)]||_0x9fdc09['name'])&&_0x115312[_0x3f768b(0x10d)](_0x58e746,{'userId':_0x58e746,'username':_0x9fdc09[_0x3f768b(0x117)]||_0x9fdc09['name'],'ladders':[],'isNonParticipant':!![]});}),console['log'](_0x4887f2(0x11f)+_0x115312['size']+'\x20unique\x20members'),console[_0x4887f2(0x123)]('üíæ\x20Writing\x20aggregated\x20data...');const _0x79bf12=[];let _0x248704=writeBatch(db),_0x4a36cb=0x0,_0x9db0ac=0x0;_0x115312['forEach']((_0x3d897b,_0x28b679)=>{const _0x31b7f2=_0x4887f2,_0x4e0f3f=_0x4d5990[_0x31b7f2(0x116)](_0x28b679)||{};let _0x369c2b=0x0,_0x248a76=null;if(_0x3d897b['ladders']['length']>0x0){const _0x5cad38=_0x3d897b['ladders']['sort']((_0x48056d,_0x484ad9)=>_0x484ad9['elo']-_0x48056d[_0x31b7f2(0x10a)]);_0x369c2b=_0x5cad38[0x0]['elo'],_0x248a76=_0x5cad38[0x0]['ladder'];}const _0x579008={'userId':_0x28b679,'username':_0x3d897b['username'],'profileImageUrl':_0x4e0f3f['profileImageUrl']||null,'country':_0x4e0f3f[_0x31b7f2(0x11d)]||null,'motto':_0x4e0f3f['motto']||null,'favoriteMap':_0x4e0f3f['favoriteMap']||null,'favoriteWeapon':_0x4e0f3f['favoriteWeapon']||null,'isNonParticipant':_0x3d897b['isNonParticipant'],'ladders':_0x3d897b[_0x31b7f2(0x125)],'primaryLadder':_0x248a76,'highestElo':_0x369c2b,'rank':getPlayerRank(_0x369c2b),'lastUpdated':new Date(),'migrationTimestamp':new Date()['toISOString']()},_0x42a9f9=doc(collection(db,_0x31b7f2(0x11a)),_0x28b679);_0x248704['set'](_0x42a9f9,_0x579008),_0x4a36cb++,_0x9db0ac++,_0x4a36cb>=0x1c2&&(_0x79bf12['push'](_0x248704['commit']()),_0x248704=writeBatch(db),_0x4a36cb=0x0,console['log']('üì¶\x20Prepared\x20batch\x20'+_0x79bf12[_0x31b7f2(0x112)]+'\x20('+_0x9db0ac+'\x20members\x20processed)'));}),_0x4a36cb>0x0&&_0x79bf12[_0x4887f2(0x127)](_0x248704['commit']()),console['log']('üöÄ\x20Executing\x20'+_0x79bf12['length']+'\x20batches...'),await Promise['all'](_0x79bf12),console[_0x4887f2(0x123)]('üéâ\x20Successfully\x20migrated\x20'+_0x115312['size']+_0x4887f2(0x11b)),console['log']('üí°\x20Refresh\x20your\x20members\x20page\x20to\x20see\x20the\x20results!');}catch(_0x14104f){console['error']('‚ùå\x20Migration\x20failed:',_0x14104f),_0x14104f[_0x4887f2(0x110)]==='permission-denied'&&console['error']('üîí\x20Permission\x20denied.\x20Make\x20sure\x20you\x27re\x20signed\x20in\x20as\x20an\x20admin\x20and\x20security\x20rules\x20allow\x20access\x20to\x20aggregatedMembers\x20collection.');}}function getPlayerRank(_0x10fc1e){const _0x38f9a2=a1_0x4dc7;if(_0x10fc1e>=0x7d0)return'emerald';if(_0x10fc1e>=0x708)return'gold';if(_0x10fc1e>=0x640)return _0x38f9a2(0x119);if(_0x10fc1e>=0x578)return'bronze';return _0x38f9a2(0x10b);}migrateToAggregatedMembers();function a1_0x4167(){const _0x12d166=['toString','eloRating','elo','unranked','name','set','playersD2','üîÑ\x20Starting\x20migration\x20to\x20aggregated\x20members...','code','info','length','data','active','forEach','get','username','\x20profiles,\x20','silver','aggregatedMembers','\x20members\x20to\x20aggregated\x20collection!','\x20D3,\x20','country','has','‚öôÔ∏è\x20Processed\x20','exception','size','bind','log','warn','ladders','table','push'];a1_0x4167=function(){return _0x12d166;};return a1_0x4167();}
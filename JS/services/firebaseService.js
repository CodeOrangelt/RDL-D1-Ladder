const a53_0x41b8a6=a53_0x574d,a53_0x300a05=(function(){let _0x11e09e=!![];return function(_0xbe0913,_0xfa6843){const _0x5950b2=_0x11e09e?function(){const _0x4fc583=a53_0x574d;if(_0xfa6843){const _0x42e4db=_0xfa6843[_0x4fc583(0x9e)](_0xbe0913,arguments);return _0xfa6843=null,_0x42e4db;}}:function(){};return _0x11e09e=![],_0x5950b2;};}()),a53_0x234655=a53_0x300a05(this,function(){const _0x3868e1=a53_0x574d;let _0x3b0603;try{const _0x3e1a42=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x3b0603=_0x3e1a42();}catch(_0x458bb7){_0x3b0603=window;}const _0x2f1a2f=_0x3b0603['console']=_0x3b0603['console']||{},_0x10fb09=['log',_0x3868e1(0xa5),'info','error','exception','table',_0x3868e1(0x9d)];for(let _0x47166c=0x0;_0x47166c<_0x10fb09['length'];_0x47166c++){const _0x58d3d0=a53_0x300a05['constructor']['prototype'][_0x3868e1(0x9c)](a53_0x300a05),_0x2ab7af=_0x10fb09[_0x47166c],_0x50e2d5=_0x2f1a2f[_0x2ab7af]||_0x58d3d0;_0x58d3d0['__proto__']=a53_0x300a05[_0x3868e1(0x9c)](a53_0x300a05),_0x58d3d0['toString']=_0x50e2d5[_0x3868e1(0x9f)][_0x3868e1(0x9c)](_0x50e2d5),_0x2f1a2f[_0x2ab7af]=_0x58d3d0;}});a53_0x234655();import{db}from'../firebase-config.js';import{collection,doc,getDoc,getDocs,query,limit,startAfter,where,onSnapshot}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const cache={'userProfiles':new Map(),'ladderPlayers':new Map(),'matchResults':new Map(),'eloHistory':new Map()},CACHE_EXPIRY={'userProfiles':0x5*0x3c*0x3e8,'ladderPlayers':0x2*0x3c*0x3e8,'matchResults':0x1*0x3c*0x3e8,'eloHistory':0x3*0x3c*0x3e8};export const userProfilesRef=collection(db,a53_0x41b8a6(0x98));export async function fetchPaginatedData(_0x3e6b23,_0x54fcd2=0xa,_0x19eb5b=null){const _0x2cacaf=a53_0x41b8a6;let _0x498e52=query(_0x3e6b23,limit(_0x54fcd2));_0x19eb5b&&(_0x498e52=query(_0x498e52,startAfter(_0x19eb5b)));const _0x3beca6=await getDocs(_0x498e52),_0xe72486=_0x3beca6['docs'][_0x3beca6[_0x2cacaf(0xaa)]['length']-0x1];return{'data':_0x3beca6['docs']['map'](_0x5d3370=>({'id':_0x5d3370['id'],..._0x5d3370['data']()})),'lastVisible':_0xe72486,'hasMore':_0x3beca6['docs'][_0x2cacaf(0xa9)]===_0x54fcd2};}function a53_0x574d(_0x5384af,_0x501e25){const _0x234655=a53_0x1e66();return a53_0x574d=function(_0x300a05,_0x18d148){_0x300a05=_0x300a05-0x97;let _0x1e6697=_0x234655[_0x300a05];return _0x1e6697;},a53_0x574d(_0x5384af,_0x501e25);}export async function getUserProfile(_0x580f24){const _0x221816=a53_0x41b8a6,_0x229eb1=cache['userProfiles']['get'](_0x580f24);if(_0x229eb1&&Date[_0x221816(0xa2)]()-_0x229eb1['timestamp']<CACHE_EXPIRY['userProfiles'])return _0x229eb1['data'];const _0x39a7e0=await getDoc(doc(userProfilesRef,_0x580f24));if(_0x39a7e0[_0x221816(0xac)]()){const _0x285f1c=_0x39a7e0['data']();return cache[_0x221816(0x98)]['set'](_0x580f24,{'data':_0x285f1c,'timestamp':Date['now']()}),_0x285f1c;}return null;}export async function getLadderData(_0x2518b0=0x1){const _0x4ed544=a53_0x41b8a6,_0x4afd4f='division_'+_0x2518b0,_0x109b2b=cache['ladderPlayers']['get'](_0x4afd4f);if(_0x109b2b&&Date[_0x4ed544(0xa2)]()-_0x109b2b[_0x4ed544(0xa4)]<CACHE_EXPIRY['ladderPlayers'])return _0x109b2b[_0x4ed544(0x9a)];const _0x4a3042=_0x2518b0===0x1?_0x4ed544(0xa6):_0x4ed544(0xa1)+_0x2518b0,_0x4d9653=collection(db,_0x4a3042),_0x490c97=await getDocs(query(_0x4d9653,limit(0x64))),_0x21b29a=_0x490c97['docs']['map'](_0x1798cd=>({'id':_0x1798cd['id'],..._0x1798cd['data']()}));return cache['ladderPlayers']['set'](_0x4afd4f,{'data':_0x21b29a,'timestamp':Date['now']()}),_0x21b29a;}export async function getEloHistoryBatch(_0x5757ad,_0xa2fc97=0x1){const _0x326f83=a53_0x41b8a6,_0xbac440=_0xa2fc97===0x1?'eloHistory':'eloHistoryD'+_0xa2fc97,_0x53cba7=collection(db,_0xbac440),_0x3b3043={},_0x4b91d0=[];_0x5757ad['forEach'](_0x1461e6=>{const _0x235728=a53_0x574d,_0x28e6d4=_0x1461e6+'_'+_0xa2fc97,_0x18b5ad=cache['eloHistory']['get'](_0x28e6d4);_0x18b5ad&&Date['now']()-_0x18b5ad[_0x235728(0xa4)]<CACHE_EXPIRY[_0x235728(0xa0)]?_0x3b3043[_0x1461e6]=_0x18b5ad[_0x235728(0x9a)]:_0x4b91d0[_0x235728(0xa3)](_0x1461e6);});const _0x521f52=0xa;for(let _0x33df4a=0x0;_0x33df4a<_0x4b91d0['length'];_0x33df4a+=_0x521f52){const _0x1d6032=_0x4b91d0[_0x326f83(0x9b)](_0x33df4a,_0x33df4a+_0x521f52);if(_0x1d6032[_0x326f83(0xa9)]>0x0)try{const _0x495d2e=query(_0x53cba7,where('playerId','in',_0x1d6032),limit(0x64)),_0x4fa095=await getDocs(_0x495d2e);_0x4fa095[_0x326f83(0xaa)][_0x326f83(0x99)](_0x46726f=>{const _0x1cab16=_0x326f83,_0x5e01b4=_0x46726f['data'](),_0x35d5c4=_0x5e01b4['playerId'];if(!_0x3b3043[_0x35d5c4])_0x3b3043[_0x35d5c4]=[];_0x3b3043[_0x35d5c4]['push'](_0x5e01b4);const _0x2197e5=_0x35d5c4+'_'+_0xa2fc97;cache['eloHistory'][_0x1cab16(0xa7)](_0x2197e5,{'data':_0x3b3043[_0x35d5c4],'timestamp':Date[_0x1cab16(0xa2)]()});});}catch(_0x385f40){console[_0x326f83(0xad)]('Error\x20fetching\x20batch\x20ELO\x20history:',_0x385f40);}}return _0x3b3043;}let usernameCache=new Map(),usernameCacheTimestamp=Date[a53_0x41b8a6(0xa2)]();export function setupEfficientListener(_0x1e8700,_0x4d7fa1=[],_0xc7d90a){const _0x50dd52=collection(db,_0x1e8700),_0x5a7c1f=query(_0x50dd52,..._0x4d7fa1),_0x3e956a=onSnapshot(_0x5a7c1f,_0x20c1c7=>{const _0x554541=a53_0x574d,_0x5b5196=_0x20c1c7[_0x554541(0xa8)]()[_0x554541(0xab)](_0x35f278=>({'type':_0x35f278[_0x554541(0x97)],'id':_0x35f278['doc']['id'],'data':_0x35f278['doc'][_0x554541(0x9a)]()}));_0x5b5196['length']>0x0&&_0xc7d90a(_0x5b5196,_0x20c1c7['docs']);});return _0x3e956a;}export async function bulkResolveUsernames(_0x73b2ad){const _0x49e51c=new Map();if(!_0x73b2ad||_0x73b2ad['length']===0x0)return _0x49e51c;const _0x500260=['players','playersD2','playersD3','nonParticipants'];for(const _0x3b0d2d of _0x500260){const _0x45c37b=collection(db,_0x3b0d2d),_0x429f43=await getDocs(_0x45c37b);_0x429f43['forEach'](_0x3b60c2=>{const _0x178e6b=a53_0x574d,_0x485327=_0x3b60c2['data']();_0x485327['username']&&_0x73b2ad['includes'](_0x3b60c2['id'])&&_0x49e51c[_0x178e6b(0xa7)](_0x3b60c2['id'],_0x485327['username']);});}return _0x49e51c;}function a53_0x1e66(){const _0x5ef29e=['type','userProfiles','forEach','data','slice','bind','trace','apply','toString','eloHistory','playersD','now','push','timestamp','warn','players','set','docChanges','length','docs','map','exists','error'];a53_0x1e66=function(){return _0x5ef29e;};return a53_0x1e66();}
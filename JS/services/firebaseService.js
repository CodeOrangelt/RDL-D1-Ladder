const a56_0x1b67e4=a56_0x237a,a56_0x56c339=(function(){let _0x3d9441=!![];return function(_0x2195f4,_0x474692){const _0x128a97=_0x3d9441?function(){const _0x2e54fe=a56_0x237a;if(_0x474692){const _0x160bc7=_0x474692[_0x2e54fe(0xff)](_0x2195f4,arguments);return _0x474692=null,_0x160bc7;}}:function(){};return _0x3d9441=![],_0x128a97;};}()),a56_0x85fff6=a56_0x56c339(this,function(){const _0x7e3b3=a56_0x237a;let _0x91afb5;try{const _0x31589a=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x91afb5=_0x31589a();}catch(_0x55bafd){_0x91afb5=window;}const _0xb6666c=_0x91afb5['console']=_0x91afb5['console']||{},_0xaaed55=[_0x7e3b3(0x106),'warn',_0x7e3b3(0xfa),_0x7e3b3(0x108),_0x7e3b3(0x102),_0x7e3b3(0x100),'trace'];for(let _0x47fdcb=0x0;_0x47fdcb<_0xaaed55['length'];_0x47fdcb++){const _0x332d4c=a56_0x56c339['constructor']['prototype']['bind'](a56_0x56c339),_0x193d65=_0xaaed55[_0x47fdcb],_0x894d00=_0xb6666c[_0x193d65]||_0x332d4c;_0x332d4c['__proto__']=a56_0x56c339['bind'](a56_0x56c339),_0x332d4c[_0x7e3b3(0x101)]=_0x894d00['toString']['bind'](_0x894d00),_0xb6666c[_0x193d65]=_0x332d4c;}});function a56_0x1d04(){const _0x23489d=['set','playerId','userProfiles','info','nonParticipants','playersD2','push','playersD','apply','table','toString','exception','division_','forEach','docs','log','data','error','slice','length','includes','docChanges','get'];a56_0x1d04=function(){return _0x23489d;};return a56_0x1d04();}a56_0x85fff6();import{db}from'../firebase-config.js';import{collection,doc,getDoc,getDocs,query,limit,startAfter,where,onSnapshot}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const cache={'userProfiles':new Map(),'ladderPlayers':new Map(),'matchResults':new Map(),'eloHistory':new Map()},CACHE_EXPIRY={'userProfiles':0x5*0x3c*0x3e8,'ladderPlayers':0x2*0x3c*0x3e8,'matchResults':0x1*0x3c*0x3e8,'eloHistory':0x3*0x3c*0x3e8};export const userProfilesRef=collection(db,a56_0x1b67e4(0xf9));export async function fetchPaginatedData(_0x771b79,_0x5139f7=0xa,_0x4276d7=null){const _0xc54833=a56_0x1b67e4;let _0x472b63=query(_0x771b79,limit(_0x5139f7));_0x4276d7&&(_0x472b63=query(_0x472b63,startAfter(_0x4276d7)));const _0x167006=await getDocs(_0x472b63),_0x3156a1=_0x167006[_0xc54833(0x105)][_0x167006['docs'][_0xc54833(0x10a)]-0x1];return{'data':_0x167006[_0xc54833(0x105)]['map'](_0x4f8aa4=>({'id':_0x4f8aa4['id'],..._0x4f8aa4['data']()})),'lastVisible':_0x3156a1,'hasMore':_0x167006['docs']['length']===_0x5139f7};}export async function getUserProfile(_0x1f2e03){const _0x130fa7=a56_0x1b67e4,_0x3b8177=cache[_0x130fa7(0xf9)][_0x130fa7(0x10d)](_0x1f2e03);if(_0x3b8177&&Date['now']()-_0x3b8177['timestamp']<CACHE_EXPIRY['userProfiles'])return _0x3b8177[_0x130fa7(0x107)];const _0x3d40b0=await getDoc(doc(userProfilesRef,_0x1f2e03));if(_0x3d40b0['exists']()){const _0x10f2ca=_0x3d40b0[_0x130fa7(0x107)]();return cache['userProfiles'][_0x130fa7(0xf7)](_0x1f2e03,{'data':_0x10f2ca,'timestamp':Date['now']()}),_0x10f2ca;}return null;}export async function getLadderData(_0x3b18b8=0x1){const _0x2b61d3=a56_0x1b67e4,_0x3f1b4b=_0x2b61d3(0x103)+_0x3b18b8,_0x34cbc8=cache['ladderPlayers']['get'](_0x3f1b4b);if(_0x34cbc8&&Date['now']()-_0x34cbc8['timestamp']<CACHE_EXPIRY['ladderPlayers'])return _0x34cbc8[_0x2b61d3(0x107)];const _0x500a8d=_0x3b18b8===0x1?'players':_0x2b61d3(0xfe)+_0x3b18b8,_0x33ab80=collection(db,_0x500a8d),_0xb513cc=await getDocs(query(_0x33ab80,limit(0x64))),_0x941694=_0xb513cc['docs']['map'](_0x3511a5=>({'id':_0x3511a5['id'],..._0x3511a5['data']()}));return cache['ladderPlayers'][_0x2b61d3(0xf7)](_0x3f1b4b,{'data':_0x941694,'timestamp':Date['now']()}),_0x941694;}function a56_0x237a(_0x5d2290,_0x5a2dfc){const _0x85fff6=a56_0x1d04();return a56_0x237a=function(_0x56c339,_0x220922){_0x56c339=_0x56c339-0xf7;let _0x1d04d0=_0x85fff6[_0x56c339];return _0x1d04d0;},a56_0x237a(_0x5d2290,_0x5a2dfc);}export async function getEloHistoryBatch(_0xb8168a,_0x2c9a3c=0x1){const _0x3f8ca4=a56_0x1b67e4,_0x117637=_0x2c9a3c===0x1?'eloHistory':'eloHistoryD'+_0x2c9a3c,_0x5574cf=collection(db,_0x117637),_0x5d442d={},_0x3d15df=[];_0xb8168a['forEach'](_0x558bcc=>{const _0xe50935=a56_0x237a,_0x162392=_0x558bcc+'_'+_0x2c9a3c,_0x410c2a=cache['eloHistory'][_0xe50935(0x10d)](_0x162392);_0x410c2a&&Date['now']()-_0x410c2a['timestamp']<CACHE_EXPIRY['eloHistory']?_0x5d442d[_0x558bcc]=_0x410c2a['data']:_0x3d15df['push'](_0x558bcc);});const _0x338405=0xa;for(let _0x4c855b=0x0;_0x4c855b<_0x3d15df['length'];_0x4c855b+=_0x338405){const _0x45a441=_0x3d15df[_0x3f8ca4(0x109)](_0x4c855b,_0x4c855b+_0x338405);if(_0x45a441[_0x3f8ca4(0x10a)]>0x0)try{const _0x2a594a=query(_0x5574cf,where('playerId','in',_0x45a441),limit(0x64)),_0x561618=await getDocs(_0x2a594a);_0x561618['docs'][_0x3f8ca4(0x104)](_0x4859ca=>{const _0x36b8c3=_0x3f8ca4,_0x56ff8d=_0x4859ca['data'](),_0x2ff33e=_0x56ff8d[_0x36b8c3(0xf8)];if(!_0x5d442d[_0x2ff33e])_0x5d442d[_0x2ff33e]=[];_0x5d442d[_0x2ff33e][_0x36b8c3(0xfd)](_0x56ff8d);const _0x3d9824=_0x2ff33e+'_'+_0x2c9a3c;cache['eloHistory']['set'](_0x3d9824,{'data':_0x5d442d[_0x2ff33e],'timestamp':Date['now']()});});}catch(_0x279c74){console['error']('Error\x20fetching\x20batch\x20ELO\x20history:',_0x279c74);}}return _0x5d442d;}let usernameCache=new Map(),usernameCacheTimestamp=Date['now']();export function setupEfficientListener(_0x251410,_0x119cdb=[],_0x38c5c3){const _0x31721a=collection(db,_0x251410),_0x41ff52=query(_0x31721a,..._0x119cdb),_0xb03df3=onSnapshot(_0x41ff52,_0x3bdf75=>{const _0x434c86=a56_0x237a,_0x896c98=_0x3bdf75[_0x434c86(0x10c)]()['map'](_0x76e9fe=>({'type':_0x76e9fe['type'],'id':_0x76e9fe['doc']['id'],'data':_0x76e9fe['doc']['data']()}));_0x896c98[_0x434c86(0x10a)]>0x0&&_0x38c5c3(_0x896c98,_0x3bdf75[_0x434c86(0x105)]);});return _0xb03df3;}export async function bulkResolveUsernames(_0x2cee3e){const _0x4e33f0=a56_0x1b67e4,_0x579323=new Map();if(!_0x2cee3e||_0x2cee3e[_0x4e33f0(0x10a)]===0x0)return _0x579323;const _0x44b15d=['players',_0x4e33f0(0xfc),'playersD3',_0x4e33f0(0xfb)];for(const _0x5f31af of _0x44b15d){const _0x1a5e64=collection(db,_0x5f31af),_0x450128=await getDocs(_0x1a5e64);_0x450128['forEach'](_0x144a0c=>{const _0x762228=_0x4e33f0,_0x5e61c1=_0x144a0c['data']();_0x5e61c1['username']&&_0x2cee3e[_0x762228(0x10b)](_0x144a0c['id'])&&_0x579323['set'](_0x144a0c['id'],_0x5e61c1['username']);});}return _0x579323;}
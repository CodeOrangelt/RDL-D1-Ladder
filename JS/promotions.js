const a43_0x2ae7a7=a43_0x7ef7,a43_0x268ab9=(function(){let _0x2b5aad=!![];return function(_0x445bbb,_0x2070cd){const _0x1d4100=_0x2b5aad?function(){if(_0x2070cd){const _0x51923e=_0x2070cd['apply'](_0x445bbb,arguments);return _0x2070cd=null,_0x51923e;}}:function(){};return _0x2b5aad=![],_0x1d4100;};}()),a43_0x5dc4b8=a43_0x268ab9(this,function(){const _0xe347a3=a43_0x7ef7,_0x446b4a=function(){const _0x418da5=a43_0x7ef7;let _0x5a771f;try{_0x5a771f=Function('return\x20(function()\x20'+_0x418da5(0x231)+');')();}catch(_0x13cac3){_0x5a771f=window;}return _0x5a771f;},_0x412bc3=_0x446b4a(),_0x12bdeb=_0x412bc3['console']=_0x412bc3['console']||{},_0x25028a=[_0xe347a3(0x24a),_0xe347a3(0x206),'info','error','exception','table','trace'];for(let _0xe5d9ff=0x0;_0xe5d9ff<_0x25028a['length'];_0xe5d9ff++){const _0x27f155=a43_0x268ab9['constructor']['prototype']['bind'](a43_0x268ab9),_0x189fdd=_0x25028a[_0xe5d9ff],_0xab0df=_0x12bdeb[_0x189fdd]||_0x27f155;_0x27f155['__proto__']=a43_0x268ab9['bind'](a43_0x268ab9),_0x27f155['toString']=_0xab0df['toString']['bind'](_0xab0df),_0x12bdeb[_0x189fdd]=_0x27f155;}});a43_0x5dc4b8();function a43_0x7ef7(_0x1ca82a,_0x30ae2a){const _0x5dc4b8=a43_0x38f1();return a43_0x7ef7=function(_0x268ab9,_0x5c6e85){_0x268ab9=_0x268ab9-0x1ed;let _0x38f156=_0x5dc4b8[_0x268ab9];return _0x38f156;},a43_0x7ef7(_0x1ca82a,_0x30ae2a);}function a43_0x38f1(){const _0x334362=['style','error','username','\x20→\x20','button','ladder','pollingInterval','addEventListener','Unknown\x20Player','Bronze','STARTING\x20notification\x20for\x20','adminUser','currentUser','Don\x27t\x20show\x20again','ID:','offsetWidth','display','rankAchieved','displayName','docs','rankChangeModal','date','eloHistory','add','empty','warn','rank-change-modal\x20','initialize','Error\x20in\x20promotion/demotion\x20recording:','ignorePromotion','DOMContentLoaded','getRankName','test','appendChild','showRankChangeBanner','player','slice',')\x20→\x20','rank-change-ok-btn','loserId','toMillis','fetchRecentPromotions','promotionHistory','Promotion\x20','DISPLAY_HOURS','\x20hours','innerHTML','resolvedName','Never\x20show\x20this\x20promotion\x20again','data','Fallback\x20write\x20failed:','dismiss-btn','commit','setItem','visibilitychange','dismissing','Successfully\x20recorded\x20','Congratulations!','previousRank','promotion','parse','stringify','timestamp','RANKS','setAttribute','getElementById','loserUsername','true','{}.constructor(\x22return\x20this\x22)(\x20)','exists','Unranked','usernameCache','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22rank-name\x22>','className','none','remove','classList','bannerContainer','shouldShowPromotion','includes','Recording\x20','Silver','type','source','winnerUsername','\x20for\x20','\x20<span\x20class=\x22rank-text\x22>','new-rank-change','Dismiss','automatic','parentNode','promotions_checked_','length','log'];a43_0x38f1=function(){return _0x334362;};return a43_0x38f1();}import{collection,doc,query,where,orderBy,limit,getDocs,addDoc,getDoc,serverTimestamp,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{auth,db}from'./firebase-config.js';class PromotionManager{constructor(){const _0x3b00f4=a43_0x7ef7;this[_0x3b00f4(0x219)]=0x18,this['RANKS']=[{'threshold':0x578,'name':_0x3b00f4(0x1f6),'color':'#CD7F32'},{'threshold':0x640,'name':_0x3b00f4(0x23e),'color':'#C0C0C0'},{'threshold':0x708,'name':'Gold','color':'#FFD700'},{'threshold':0x834,'name':'Emerald','color':'#50C878'}],this['bannerContainer']=null,this['lastFetchTime']=0x0,this['fetchInterval']=0xea60,this['pollingInterval']=null,this[_0x3b00f4(0x234)]={};}[a43_0x2ae7a7(0x208)](){const _0x10c571=a43_0x2ae7a7;this['bannerContainer']=document[_0x10c571(0x22e)]('promotion-banner-container');if(!this['bannerContainer']){console['error']('Promotion\x20banner\x20container\x20not\x20found');return;}this['setupBannerContainer']();const _0x17a401=_0x10c571(0x248)+new Date()['toDateString'](),_0x4d4acd=sessionStorage['getItem'](_0x17a401);!_0x4d4acd&&(this[_0x10c571(0x216)](),sessionStorage['setItem'](_0x17a401,_0x10c571(0x230))),document['addEventListener'](_0x10c571(0x223),()=>{const _0x5adea5=_0x10c571;document['visibilityState']==='visible'&&!sessionStorage['getItem'](_0x17a401)&&(this['fetchRecentPromotions'](),sessionStorage[_0x5adea5(0x222)](_0x17a401,_0x5adea5(0x230)));}),window[_0x10c571(0x1f4)]('beforeunload',()=>{const _0x11c2f5=_0x10c571;this[_0x11c2f5(0x1f3)]&&clearInterval(this['pollingInterval']);});}['setupBannerContainer'](){const _0x431fdb=a43_0x2ae7a7;this[_0x431fdb(0x23a)][_0x431fdb(0x21b)]='',this['bannerContainer']['style']['display']='none';}async['fetchRecentPromotions'](){const _0x4a7577=a43_0x2ae7a7;try{const _0x5a780c=Date['now']();if(_0x5a780c-this['lastFetchTime']<this['fetchInterval'])return;this['lastFetchTime']=_0x5a780c;const _0x41647a=collection(db,_0x4a7577(0x203)),_0x16f12e=query(_0x41647a,where('type','in',[_0x4a7577(0x228),'demotion']),orderBy('timestamp','desc'),limit(0x14)),_0xdf4b3a=await getDocs(_0x16f12e),_0x26f34e=[];_0xdf4b3a['forEach'](_0x293622=>{const _0x22a205=_0x4a7577,_0x4035cc={'id':_0x293622['id'],..._0x293622['data']()};this[_0x22a205(0x23b)](_0x293622['id'])&&this['isNewRankChange'](_0x4035cc)&&_0x26f34e['push'](_0x4035cc);}),_0x26f34e['length']>0x0&&await this['processRankChanges'](_0x26f34e);}catch(_0x148bc9){console[_0x4a7577(0x1ee)]('Error\x20fetching\x20promotions:',_0x148bc9);}}async['processRankChanges'](_0x404d25){const _0x25aa4d=a43_0x2ae7a7;if(_0x404d25['length']===0x0)return;_0x404d25['sort']((_0x5b1476,_0x57e94a)=>{const _0x1abd0c=a43_0x7ef7,_0x1e764e=_0x5b1476['timestamp']?.['toMillis']?.()||_0x5b1476[_0x1abd0c(0x22b)]?.['seconds']*0x3e8||0x0,_0x21f9c1=_0x57e94a[_0x1abd0c(0x22b)]?.[_0x1abd0c(0x215)]?.()||_0x57e94a['timestamp']?.['seconds']*0x3e8||0x0;return _0x21f9c1-_0x1e764e;});const _0x2e9ff4=this['bannerContainer']['children']['length'],_0x4d255c=0x3-_0x2e9ff4;if(_0x4d255c<=0x0)return;const _0x1957bd=_0x404d25[_0x25aa4d(0x211)](0x0,_0x4d255c);for(let _0x238094=0x0;_0x238094<_0x1957bd[_0x25aa4d(0x249)];_0x238094++){const _0xa75791=_0x1957bd[_0x238094],_0xac6a15=auth['currentUser'];try{setTimeout(()=>{this['showRankChangeBanner'](_0xa75791);},_0x238094*0x3e8),_0xac6a15&&_0xa75791['player']===_0xac6a15['displayName']&&this['showRankChangeLightbox'](_0xa75791['type'],_0xa75791['rankAchieved']);}catch(_0x53de32){console['error']('Error\x20processing\x20rank\x20change:',_0x53de32);}}}['shouldShowPromotion'](_0x544e36){const _0x22ccdc=a43_0x2ae7a7;try{const _0x2439f4='promotion_'+_0x544e36,_0x3dc2dc=localStorage['getItem'](_0x2439f4);if(_0x3dc2dc){let _0x4a8ee9;try{_0x4a8ee9=JSON[_0x22ccdc(0x229)](_0x3dc2dc);}catch(_0x5657f3){return console[_0x22ccdc(0x206)]('Invalid\x20storage\x20format\x20for\x20'+_0x2439f4+',\x20treating\x20as\x20new'),!![];}if(_0x4a8ee9['ignored']===!![])return console[_0x22ccdc(0x24a)](_0x22ccdc(0x218)+_0x544e36+'\x20is\x20permanently\x20ignored'),![];const _0x7bef3e=Date['now']();if(_0x4a8ee9['userDismissed']&&_0x7bef3e-_0x4a8ee9[_0x22ccdc(0x22b)]<this['DISPLAY_HOURS']*0x3c*0x3c*0x3e8)return console[_0x22ccdc(0x24a)]('Promotion\x20'+_0x544e36+'\x20was\x20dismissed\x20by\x20user\x20within\x20last\x20'+this[_0x22ccdc(0x219)]+_0x22ccdc(0x21a)),![];if(_0x4a8ee9['systemDismissed']&&_0x7bef3e-_0x4a8ee9[_0x22ccdc(0x22b)]<0x4*0x3c*0x3c*0x3e8)return console['log'](_0x22ccdc(0x218)+_0x544e36+'\x20was\x20auto-dismissed\x20within\x20last\x204\x20hours'),![];}return!![];}catch(_0x53db7f){return console['error']('Error\x20checking\x20promotion\x20visibility:',_0x53db7f),![];}}[a43_0x2ae7a7(0x20a)](_0x13e1ee){const _0x404175=a43_0x2ae7a7;try{const _0x3cbbac='promotion_'+_0x13e1ee;localStorage['setItem'](_0x3cbbac,JSON['stringify']({'timestamp':Date['now'](),'ignored':!![]}));}catch(_0x45aafd){console[_0x404175(0x1ee)]('Error\x20saving\x20promotion\x20preference:',_0x45aafd);}}[a43_0x2ae7a7(0x20f)](_0x53ee97){this['resolveUserId'](_0x53ee97)['then'](_0x1edcd4=>{const _0x5cd82a=a43_0x7ef7,_0x4e8f15='promotion_'+_0x53ee97['id'],_0x1cb6af=localStorage['getItem'](_0x4e8f15);if(_0x1cb6af)try{const _0x192ff7=JSON['parse'](_0x1cb6af);if(_0x192ff7['ignored']===!![]){console[_0x5cd82a(0x24a)]('Skipping\x20ignored\x20promotion:\x20'+_0x53ee97['id']);return;}}catch(_0x5cb096){}localStorage['setItem'](_0x4e8f15,JSON[_0x5cd82a(0x22a)]({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':![],'seenAt':Date['now']()})),this['bannerContainer'][_0x5cd82a(0x1ed)][_0x5cd82a(0x1fd)]='block';while(this['bannerContainer']['children']['length']>=0x3){this[_0x5cd82a(0x23a)]['removeChild'](this['bannerContainer']['firstChild']);}const _0xcb7f8f=document['createElement']('div');_0xcb7f8f[_0x5cd82a(0x236)]='promotion-banner',_0xcb7f8f[_0x5cd82a(0x22d)]('data-rank',_0x1edcd4['rankAchieved']),_0xcb7f8f['setAttribute']('data-id',_0x1edcd4['id']);const _0x197522=document['createElement']('div');_0x197522['className']='promotion-details';const _0x31288c=_0x1edcd4['resolvedName']||_0x1edcd4['player']||_0x1edcd4['username']||_0x1edcd4['playerUsername']||_0x1edcd4['displayName']||'A\x20player',_0x39a3ea=_0x1edcd4[_0x5cd82a(0x23f)]==='promotion'?_0x31288c+'\x20was\x20promoted\x20to':_0x31288c+'\x20was\x20demoted\x20to';_0x197522['innerHTML']=_0x39a3ea+_0x5cd82a(0x243)+_0x1edcd4[_0x5cd82a(0x1fe)]+'</span>';const _0x51f99a=document['createElement']('div');_0x51f99a[_0x5cd82a(0x236)]='banner-actions';const _0x42dc1f=document['createElement'](_0x5cd82a(0x1f1));_0x42dc1f['className']=_0x5cd82a(0x220),_0x42dc1f['innerHTML']='&times;',_0x42dc1f['title']=_0x5cd82a(0x245);const _0x3abc60=document['createElement']('button');_0x3abc60['className']='ignore-btn',_0x3abc60['textContent']=_0x5cd82a(0x1fa),_0x3abc60['title']=_0x5cd82a(0x21d),_0x51f99a['appendChild'](_0x3abc60),_0x51f99a[_0x5cd82a(0x20e)](_0x42dc1f),_0xcb7f8f['appendChild'](_0x197522),_0xcb7f8f['appendChild'](_0x51f99a),this['bannerContainer']['appendChild'](_0xcb7f8f),void _0xcb7f8f[_0x5cd82a(0x1fc)],setTimeout(()=>{const _0x2c69c6=_0x5cd82a;_0xcb7f8f['classList'][_0x2c69c6(0x204)]('new-rank-change');},0x32),_0x42dc1f['addEventListener']('click',()=>{const _0x54031f=_0x5cd82a;localStorage[_0x54031f(0x222)](_0x4e8f15,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':!![],'systemDismissed':![]})),_0xcb7f8f['classList']['remove']('new-rank-change'),_0xcb7f8f['classList']['add']('dismissing'),setTimeout(()=>{const _0x102650=_0x54031f;_0xcb7f8f['parentNode']&&(_0xcb7f8f['remove'](),this['bannerContainer']['children'][_0x102650(0x249)]===0x0&&(this['bannerContainer']['style']['display']=_0x102650(0x237)));},0x1f4);}),_0x3abc60[_0x5cd82a(0x1f4)]('click',()=>{localStorage['setItem'](_0x4e8f15,JSON['stringify']({'timestamp':Date['now'](),'ignored':!![],'userDismissed':!![],'systemDismissed':![]})),_0xcb7f8f['classList']['remove']('new-rank-change'),_0xcb7f8f['classList']['add']('dismissing'),setTimeout(()=>{const _0x2165d0=a43_0x7ef7;_0xcb7f8f['parentNode']&&(_0xcb7f8f[_0x2165d0(0x238)](),this['bannerContainer']['children']['length']===0x0&&(this['bannerContainer'][_0x2165d0(0x1ed)]['display']='none'));},0x1f4);}),setTimeout(()=>{const _0x587922=_0x5cd82a;_0xcb7f8f['parentNode']&&(_0xcb7f8f['classList']['remove'](_0x587922(0x244)),_0xcb7f8f[_0x587922(0x239)]['add'](_0x587922(0x224)),localStorage[_0x587922(0x222)](_0x4e8f15,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':!![]})),setTimeout(()=>{const _0x1da24d=_0x587922;_0xcb7f8f[_0x1da24d(0x247)]&&(_0xcb7f8f['remove'](),this['bannerContainer']['children'][_0x1da24d(0x249)]===0x0&&(this['bannerContainer']['style'][_0x1da24d(0x1fd)]='none'));},0x1f4));},0x3a98);});}async['resolveUserId'](_0x33d716){const _0x4c8d01=a43_0x2ae7a7,_0x2b8974={..._0x33d716},_0x40497e=[_0x33d716[_0x4c8d01(0x210)],_0x33d716[_0x4c8d01(0x1ef)],_0x33d716['playerUsername'],_0x33d716['displayName']],_0x104828=_0x40497e['some'](_0x2e68d5=>_0x2e68d5&&typeof _0x2e68d5==='string'&&!_0x2e68d5[_0x4c8d01(0x23c)](_0x4c8d01(0x1fb))&&!/^[a-zA-Z0-9]{20,}$/['test'](_0x2e68d5));if(_0x104828)return _0x2b8974;let _0x3ceced=null;if(_0x33d716['userId'])_0x3ceced=_0x33d716['userId'];else _0x33d716['player']&&/^[A-Za-z0-9]{20,}$/[_0x4c8d01(0x20d)](_0x33d716['player'])&&(_0x3ceced=_0x33d716['player']);if(!_0x3ceced)return _0x2b8974;try{const _0x528898=await getDoc(doc(db,'players',_0x3ceced));if(_0x528898[_0x4c8d01(0x232)]()){const _0x4393be=_0x528898['data']();if(_0x4393be[_0x4c8d01(0x1ef)])return _0x2b8974['resolvedName']=_0x4393be['username'],_0x2b8974;}const _0x532076=await getDocs(query(collection(db,'approvedMatches'),where('winnerId','==',_0x3ceced),orderBy(_0x4c8d01(0x202),'desc'),limit(0x1)));if(!_0x532076['empty']){const _0x4d92af=_0x532076['docs'][0x0][_0x4c8d01(0x21e)]();if(_0x4d92af[_0x4c8d01(0x241)])return _0x2b8974['resolvedName']=_0x4d92af['winnerUsername'],_0x2b8974;}const _0x4378de=await getDocs(query(collection(db,'approvedMatches'),where('loserId','==',_0x3ceced),orderBy('date','desc'),limit(0x1)));if(!_0x4378de['empty']){const _0x5c09c1=_0x4378de[_0x4c8d01(0x200)][0x0][_0x4c8d01(0x21e)]();if(_0x5c09c1['loserUsername'])return _0x2b8974[_0x4c8d01(0x21c)]=_0x5c09c1['loserUsername'],console[_0x4c8d01(0x24a)]('Resolved\x20'+_0x3ceced+'\x20to\x20'+_0x5c09c1[_0x4c8d01(0x22f)]+'\x20(loser)'),_0x2b8974;}}catch(_0x278537){console[_0x4c8d01(0x1ee)]('Error\x20resolving\x20user\x20ID:',_0x278537);}return console[_0x4c8d01(0x206)]('Failed\x20to\x20resolve\x20user\x20ID:\x20'+_0x3ceced),_0x2b8974;}['showRankChangeLightbox'](_0x4ad7bd,_0xc21a64){const _0x5f5bf8=a43_0x2ae7a7;let _0xf49918=document['getElementById'](_0x5f5bf8(0x201));!_0xf49918&&(_0xf49918=document['createElement']('div'),_0xf49918['id']='rankChangeModal',_0xf49918['className']=_0x5f5bf8(0x207)+_0x4ad7bd,document['body']['appendChild'](_0xf49918));const _0x537593=_0x4ad7bd==='promotion'?_0x5f5bf8(0x226):'Rank\x20Update',_0x55eed4=_0x4ad7bd===_0x5f5bf8(0x228)?'You\x27ve\x20been\x20promoted\x20to':'You\x27ve\x20been\x20demoted\x20to';_0xf49918['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rank-change-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2\x20class=\x22rank-change-title\x22>'+_0x537593+'</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>'+_0x55eed4+_0x5f5bf8(0x235)+_0xc21a64+'</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22rank-change-button\x22\x20id=\x22rank-change-ok-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Got\x20it!\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0xf49918['style']['display']='flex',document['getElementById'](_0x5f5bf8(0x213))[_0x5f5bf8(0x1f4)]('click',()=>{const _0x27dc00=_0x5f5bf8;_0xf49918[_0x27dc00(0x1ed)]['display']='none';}),_0xf49918[_0x5f5bf8(0x1f4)]('click',_0x5bf38b=>{const _0x5ef44e=_0x5f5bf8;_0x5bf38b['target']===_0xf49918&&(_0xf49918['style'][_0x5ef44e(0x1fd)]='none');});}async['checkAndRecordPromotion'](_0x475b75,_0x432983,_0x326432,_0x4499ff={}){const _0x272a1f=a43_0x2ae7a7;try{if(_0x432983===_0x326432||!_0x475b75)return null;const _0x548c69=_0x4499ff['source']||_0x272a1f(0x246),_0x2cf9ba=_0x4499ff['matchId']||null,_0xd1f82d=_0x4499ff[_0x272a1f(0x1f8)]||null;console['log']('Processing\x20potential\x20rank\x20change:\x20'+_0x326432+_0x272a1f(0x1f0)+_0x432983+'\x20(source:\x20'+_0x548c69+')');let _0x35af0f=null,_0x49078f=null;try{const _0x18d518=await getDoc(doc(db,'players',_0x475b75));if(_0x18d518['exists']()){const _0x44180d=_0x18d518['data']();_0x35af0f=_0x44180d['username']||_0x44180d[_0x272a1f(0x1ff)]||null,_0x49078f=_0x44180d['displayName']||_0x44180d['username']||null;}!_0x35af0f&&_0x4499ff[_0x272a1f(0x1ef)]&&(_0x35af0f=_0x4499ff['username'],_0x49078f=_0x4499ff['username']);!_0x35af0f&&auth['currentUser']&&(_0x35af0f=auth['currentUser'][_0x272a1f(0x1ff)]||auth[_0x272a1f(0x1f9)]['email']['split']('@')[0x0],_0x49078f=auth['currentUser']['displayName']||null);if(!_0x35af0f){const _0x4f212a=query(collection(db,'approvedMatches'),where('winnerId','==',_0x475b75),limit(0x1)),_0xe7ee75=await getDocs(_0x4f212a);if(!_0xe7ee75['empty'])_0x35af0f=_0xe7ee75[_0x272a1f(0x200)][0x0][_0x272a1f(0x21e)]()['winnerUsername']||'Unknown\x20Player',_0x49078f=_0x35af0f;else{const _0x133f0b=query(collection(db,'approvedMatches'),where(_0x272a1f(0x214),'==',_0x475b75),limit(0x1)),_0x37897f=await getDocs(_0x133f0b);!_0x37897f[_0x272a1f(0x205)]&&(_0x35af0f=_0x37897f[0x0][_0x272a1f(0x21e)]()['loserUsername']||'Unknown\x20Player',_0x49078f=_0x35af0f);}}}catch(_0x348ec6){console['error']('Error\x20resolving\x20username:',_0x348ec6);}!_0x35af0f&&(console[_0x272a1f(0x206)]('Could\x20not\x20resolve\x20username\x20for\x20userId:',_0x475b75),_0x35af0f='A\x20player',_0x49078f=_0x272a1f(0x1f5));const _0x47fa46=this['getRankName'](_0x326432),_0x5b5b74=this[_0x272a1f(0x20c)](_0x432983);if(_0x47fa46!==_0x5b5b74){const _0x39b186=_0x432983>_0x326432,_0x51ddb5=_0x39b186?'promotion':'demotion',_0x1c6972=_0x5b5b74;console['log'](_0x272a1f(0x23d)+_0x51ddb5+_0x272a1f(0x242)+_0x35af0f+':\x20'+_0x326432+'\x20('+_0x47fa46+_0x272a1f(0x212)+_0x432983+'\x20('+_0x5b5b74+')');try{const _0x1ee441={'player':_0x35af0f,'playerUsername':_0x35af0f,'username':_0x35af0f,'displayName':_0x49078f,'userId':_0x475b75,'type':_0x51ddb5,'rankAchieved':_0x1c6972,'timestamp':serverTimestamp(),'previousElo':_0x326432,'newElo':_0x432983,'change':_0x432983-_0x326432,'previousRank':_0x47fa46,'newRank':_0x5b5b74,'source':_0x548c69};if(_0x548c69==='match'&&_0x2cf9ba)_0x1ee441['matchId']=_0x2cf9ba;else _0x548c69==='admin'&&_0xd1f82d?(_0x1ee441['modifiedBy']=_0xd1f82d,_0x1ee441['isAutomatic']=![]):_0x1ee441['isAutomatic']=!![];const _0x5a9485=writeBatch(db),_0x20d553=doc(collection(db,'eloHistory')),_0x16f31d=doc(collection(db,_0x272a1f(0x217)));return _0x5a9485['set'](_0x20d553,_0x1ee441),_0x5a9485['set'](_0x16f31d,_0x1ee441),await _0x5a9485[_0x272a1f(0x221)](),await this['sendPromotionNotification'](_0x475b75,_0x35af0f,_0x326432,_0x432983,_0x47fa46,_0x5b5b74,_0x51ddb5,{'displayName':_0x49078f,'source':_0x548c69,'matchId':_0x2cf9ba,'ladder':_0x4499ff['ladder']||'D1'}),console[_0x272a1f(0x24a)](_0x272a1f(0x225)+_0x51ddb5+_0x272a1f(0x242)+_0x35af0f+'\x20to\x20'+_0x1c6972),_0x1c6972;}catch(_0x2ff99a){console['error']('Error\x20writing\x20promotion\x20records:',_0x2ff99a);try{return await addDoc(collection(db,'eloHistory'),{'player':_0x35af0f,'playerUsername':_0x35af0f,'username':_0x35af0f,'displayName':_0x49078f,'userId':_0x475b75,'type':_0x51ddb5,'rankAchieved':_0x1c6972,'timestamp':serverTimestamp(),'previousElo':_0x326432,'newElo':_0x432983,'change':_0x432983-_0x326432,'previousRank':_0x47fa46,'source':_0x548c69,'isAutomatic':_0x548c69!=='admin'}),await this['sendPromotionNotification'](_0x475b75,_0x35af0f,_0x326432,_0x432983,_0x47fa46,_0x5b5b74,_0x51ddb5,{'displayName':_0x49078f,'source':_0x548c69,'matchId':_0x2cf9ba,'ladder':_0x4499ff[_0x272a1f(0x1f2)]||'D1'}),_0x1c6972;}catch(_0x4788d1){return console['error'](_0x272a1f(0x21f),_0x4788d1),null;}}}return null;}catch(_0x4cf8ff){return console['error'](_0x272a1f(0x209),_0x4cf8ff),null;}}['getRankName'](_0x5bfbad){const _0x575e89=a43_0x2ae7a7;for(let _0x5edff3=this[_0x575e89(0x22c)]['length']-0x1;_0x5edff3>=0x0;_0x5edff3--){if(_0x5bfbad>=this['RANKS'][_0x5edff3]['threshold'])return this[_0x575e89(0x22c)][_0x5edff3]['name'];}return _0x575e89(0x233);}['cleanup'](){const _0x76179f=a43_0x2ae7a7;this[_0x76179f(0x1f3)]&&clearInterval(this['pollingInterval']);}['isNewRankChange'](_0x2e01be){const _0x585e7f=a43_0x2ae7a7;if(_0x2e01be['timestamp']){const _0x26ea83=_0x2e01be['timestamp']['seconds']*0x3e8,_0x286b2d=Date['now'](),_0x3c5dd5=(_0x286b2d-_0x26ea83)/(0x3e8*0x3c*0x3c);if(_0x3c5dd5>0x18)return![];}if(_0x2e01be['previousRank']&&_0x2e01be['newRank']&&_0x2e01be[_0x585e7f(0x227)]!==_0x2e01be['newRank'])return!![];return![];}async['sendPromotionNotification'](_0x4e2b9e,_0x14964e,_0x3cbf4f,_0x59e3c5,_0x591c5f,_0x49a0d6,_0x31d7a0,_0x1242bf={}){const _0x304475=a43_0x2ae7a7;try{console[_0x304475(0x24a)](_0x304475(0x1f7)+_0x14964e+'\x27s\x20'+_0x31d7a0);const _0x514834={'userId':_0x4e2b9e,'username':_0x14964e,'displayName':_0x1242bf['displayName']||_0x14964e,'oldElo':parseInt(_0x3cbf4f),'newElo':parseInt(_0x59e3c5),'eloDifference':parseInt(_0x59e3c5)-parseInt(_0x3cbf4f),'oldRank':_0x591c5f,'newRank':_0x49a0d6,'type':_0x31d7a0,'timestamp':serverTimestamp(),'processed':![],'source':_0x1242bf[_0x304475(0x240)]||_0x304475(0x246),'matchId':_0x1242bf['matchId']||null,'ladder':_0x1242bf['ladder']||'D1','adminUser':_0x1242bf['adminUser']||null};console[_0x304475(0x24a)]('Creating\x20Discord\x20notification:',_0x514834);const _0x397696=await addDoc(collection(db,'promotionNotifications'),_0x514834);return console['log']('Discord\x20notification\x20sent\x20successfully\x20with\x20ID:\x20'+_0x397696['id']),!![];}catch(_0x22b683){return console['error']('Error\x20sending\x20Discord\x20notification:',_0x22b683),![];}}}export const promotionManager=new PromotionManager();document['addEventListener'](a43_0x2ae7a7(0x20b),()=>{promotionManager['initialize']();});export const initializePromotionTracker=()=>promotionManager['initialize']();export const checkAndRecordPromotion=(_0x4f70e5,_0x2de1c6,_0x491498,_0x18ebc6)=>promotionManager['checkAndRecordPromotion'](_0x4f70e5,_0x2de1c6,_0x491498,_0x18ebc6);export const getRankName=_0x50d498=>promotionManager['getRankName'](_0x50d498);
const a42_0x35c4f6=a42_0x1f51,a42_0x292255=(function(){let _0x45a305=!![];return function(_0x5937f6,_0x15002f){const _0x2e4492=_0x45a305?function(){if(_0x15002f){const _0xd13cfc=_0x15002f['apply'](_0x5937f6,arguments);return _0x15002f=null,_0xd13cfc;}}:function(){};return _0x45a305=![],_0x2e4492;};}()),a42_0x5aae34=a42_0x292255(this,function(){const _0x24937b=a42_0x1f51,_0x3930b4=function(){const _0x2b5851=a42_0x1f51;let _0x47fe01;try{_0x47fe01=Function(_0x2b5851(0x160)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x1a8c96){_0x47fe01=window;}return _0x47fe01;},_0x5322ac=_0x3930b4(),_0x59b052=_0x5322ac['console']=_0x5322ac['console']||{},_0x7d4722=[_0x24937b(0x120),'warn','info','error','exception','table','trace'];for(let _0x399a91=0x0;_0x399a91<_0x7d4722['length'];_0x399a91++){const _0x1ae3cf=a42_0x292255[_0x24937b(0x145)][_0x24937b(0x139)]['bind'](a42_0x292255),_0x2add5d=_0x7d4722[_0x399a91],_0x289ad6=_0x59b052[_0x2add5d]||_0x1ae3cf;_0x1ae3cf[_0x24937b(0x158)]=a42_0x292255['bind'](a42_0x292255),_0x1ae3cf['toString']=_0x289ad6[_0x24937b(0x11f)]['bind'](_0x289ad6),_0x59b052[_0x2add5d]=_0x1ae3cf;}});a42_0x5aae34();import{collection,doc,query,where,orderBy,limit,getDocs,addDoc,getDoc,serverTimestamp,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{auth,db}from'./firebase-config.js';class PromotionManager{constructor(){const _0x3f54b0=a42_0x1f51;this[_0x3f54b0(0x13d)]=0x18,this[_0x3f54b0(0x131)]=[{'threshold':0x578,'name':'Bronze','color':_0x3f54b0(0x10b)},{'threshold':0x640,'name':'Silver','color':_0x3f54b0(0x11b)},{'threshold':0x708,'name':'Gold','color':'#FFD700'},{'threshold':0x834,'name':'Emerald','color':'#50C878'}],this['bannerContainer']=null,this[_0x3f54b0(0x151)]=0x0,this['fetchInterval']=0xea60,this['pollingInterval']=null,this['usernameCache']={};}[a42_0x35c4f6(0x147)](){const _0x3d6ea4=a42_0x35c4f6;this['bannerContainer']=document[_0x3d6ea4(0x15e)]('promotion-banner-container');if(!this['bannerContainer']){console[_0x3d6ea4(0x10d)](_0x3d6ea4(0x15a));return;}this['setupBannerContainer']();const _0x553d66='promotions_checked_'+new Date()[_0x3d6ea4(0x117)](),_0x140c93=sessionStorage[_0x3d6ea4(0x111)](_0x553d66);!_0x140c93&&(this[_0x3d6ea4(0x113)](),sessionStorage['setItem'](_0x553d66,'true')),document[_0x3d6ea4(0x138)]('visibilitychange',()=>{document['visibilityState']==='visible'&&!sessionStorage['getItem'](_0x553d66)&&(this['fetchRecentPromotions'](),sessionStorage['setItem'](_0x553d66,'true'));}),window['addEventListener']('beforeunload',()=>{const _0x56e845=_0x3d6ea4;this[_0x56e845(0x122)]&&clearInterval(this[_0x56e845(0x122)]);});}[a42_0x35c4f6(0x112)](){const _0x28e910=a42_0x35c4f6;this[_0x28e910(0x14a)]['innerHTML']='',this[_0x28e910(0x14a)]['style']['display']='none';}async['fetchRecentPromotions'](){const _0x3f535d=a42_0x35c4f6;try{const _0x1badba=Date['now']();if(_0x1badba-this['lastFetchTime']<this['fetchInterval'])return;this['lastFetchTime']=_0x1badba;const _0x258b0e=collection(db,'eloHistory'),_0x189b2b=query(_0x258b0e,where(_0x3f535d(0x12d),'in',['promotion',_0x3f535d(0x136)]),orderBy('timestamp','desc'),limit(0x14)),_0x4cb776=await getDocs(_0x189b2b),_0x56f712=[];_0x4cb776['forEach'](_0x5c6c8a=>{const _0x56c716=_0x3f535d,_0x279006={'id':_0x5c6c8a['id'],..._0x5c6c8a['data']()};this['shouldShowPromotion'](_0x5c6c8a['id'])&&this[_0x56c716(0x15c)](_0x279006)&&_0x56f712['push'](_0x279006);}),_0x56f712['length']>0x0&&await this['processRankChanges'](_0x56f712);}catch(_0x5bd4aa){console[_0x3f535d(0x10d)](_0x3f535d(0x130),_0x5bd4aa);}}async['processRankChanges'](_0x25ba05){const _0x1bae74=a42_0x35c4f6;if(_0x25ba05['length']===0x0)return;_0x25ba05['sort']((_0x36883f,_0x1ef6a4)=>{const _0x425e82=a42_0x1f51,_0x116856=_0x36883f[_0x425e82(0x13c)]?.[_0x425e82(0x12b)]?.()||_0x36883f[_0x425e82(0x13c)]?.['seconds']*0x3e8||0x0,_0x803cf3=_0x1ef6a4[_0x425e82(0x13c)]?.[_0x425e82(0x12b)]?.()||_0x1ef6a4['timestamp']?.['seconds']*0x3e8||0x0;return _0x803cf3-_0x116856;});const _0x384e67=this['bannerContainer'][_0x1bae74(0x157)][_0x1bae74(0x11a)],_0x414da4=0x3-_0x384e67;if(_0x414da4<=0x0)return;const _0x185cde=_0x25ba05['slice'](0x0,_0x414da4);for(let _0x25ba12=0x0;_0x25ba12<_0x185cde[_0x1bae74(0x11a)];_0x25ba12++){const _0x149292=_0x185cde[_0x25ba12],_0x3d3e58=auth['currentUser'];try{setTimeout(()=>{this['showRankChangeBanner'](_0x149292);},_0x25ba12*0x3e8),_0x3d3e58&&_0x149292['player']===_0x3d3e58['displayName']&&this['showRankChangeLightbox'](_0x149292['type'],_0x149292[_0x1bae74(0x14b)]);}catch(_0x4b8554){console[_0x1bae74(0x10d)]('Error\x20processing\x20rank\x20change:',_0x4b8554);}}}['shouldShowPromotion'](_0x122d4e){const _0x22f8f8=a42_0x35c4f6;try{const _0x1ed580=_0x22f8f8(0x152)+_0x122d4e,_0x7bb5bc=localStorage[_0x22f8f8(0x111)](_0x1ed580);if(_0x7bb5bc){let _0xef56f2;try{_0xef56f2=JSON[_0x22f8f8(0x14c)](_0x7bb5bc);}catch(_0x570a55){return console['warn'](_0x22f8f8(0x161)+_0x1ed580+',\x20treating\x20as\x20new'),!![];}if(_0xef56f2[_0x22f8f8(0x110)]===!![])return console['log']('Promotion\x20'+_0x122d4e+'\x20is\x20permanently\x20ignored'),![];const _0x1e0a9a=Date['now']();if(_0xef56f2[_0x22f8f8(0x116)]&&_0x1e0a9a-_0xef56f2[_0x22f8f8(0x13c)]<this[_0x22f8f8(0x13d)]*0x3c*0x3c*0x3e8)return console['log']('Promotion\x20'+_0x122d4e+'\x20was\x20dismissed\x20by\x20user\x20within\x20last\x20'+this['DISPLAY_HOURS']+'\x20hours'),![];if(_0xef56f2['systemDismissed']&&_0x1e0a9a-_0xef56f2['timestamp']<0x4*0x3c*0x3c*0x3e8)return console[_0x22f8f8(0x120)]('Promotion\x20'+_0x122d4e+'\x20was\x20auto-dismissed\x20within\x20last\x204\x20hours'),![];}return!![];}catch(_0x506ea6){return console[_0x22f8f8(0x10d)](_0x22f8f8(0x154),_0x506ea6),![];}}['ignorePromotion'](_0x4897b2){const _0x15cadf=a42_0x35c4f6;try{const _0x4bb747='promotion_'+_0x4897b2;localStorage[_0x15cadf(0x146)](_0x4bb747,JSON['stringify']({'timestamp':Date[_0x15cadf(0x15b)](),'ignored':!![]}));}catch(_0x5a1556){console['error']('Error\x20saving\x20promotion\x20preference:',_0x5a1556);}}['showRankChangeBanner'](_0x581e89){this['resolveUserId'](_0x581e89)['then'](_0x5e49ef=>{const _0x41831a=a42_0x1f51,_0x1a1dd4='promotion_'+_0x581e89['id'],_0x2ef865=localStorage['getItem'](_0x1a1dd4);if(_0x2ef865)try{const _0x354f5d=JSON['parse'](_0x2ef865);if(_0x354f5d['ignored']===!![]){console['log']('Skipping\x20ignored\x20promotion:\x20'+_0x581e89['id']);return;}}catch(_0x4831b5){}localStorage['setItem'](_0x1a1dd4,JSON[_0x41831a(0x150)]({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':![],'seenAt':Date['now']()})),this[_0x41831a(0x14a)]['style']['display']='block';while(this[_0x41831a(0x14a)]['children']['length']>=0x3){this[_0x41831a(0x14a)]['removeChild'](this['bannerContainer'][_0x41831a(0x13e)]);}const _0x44f3ed=document['createElement']('div');_0x44f3ed[_0x41831a(0x132)]='promotion-banner',_0x44f3ed['setAttribute']('data-rank',_0x5e49ef['rankAchieved']),_0x44f3ed['setAttribute']('data-id',_0x5e49ef['id']);const _0x5cd937=document['createElement']('div');_0x5cd937[_0x41831a(0x132)]='promotion-details';const _0x3d964b=_0x5e49ef[_0x41831a(0x140)]||_0x5e49ef[_0x41831a(0x142)]||_0x5e49ef['username']||_0x5e49ef['playerUsername']||_0x5e49ef[_0x41831a(0x128)]||'A\x20player',_0x338fd0=_0x5e49ef['type']==='promotion'?_0x3d964b+'\x20was\x20promoted\x20to':_0x3d964b+'\x20was\x20demoted\x20to';_0x5cd937['innerHTML']=_0x338fd0+'\x20<span\x20class=\x22rank-text\x22>'+_0x5e49ef['rankAchieved']+'</span>';const _0x48708a=document[_0x41831a(0x144)]('div');_0x48708a['className']='banner-actions';const _0x40414c=document['createElement']('button');_0x40414c['className']='dismiss-btn',_0x40414c['innerHTML']='&times;',_0x40414c['title']='Dismiss';const _0xe426d4=document[_0x41831a(0x144)]('button');_0xe426d4['className']='ignore-btn',_0xe426d4[_0x41831a(0x159)]=_0x41831a(0x135),_0xe426d4['title']='Never\x20show\x20this\x20promotion\x20again',_0x48708a['appendChild'](_0xe426d4),_0x48708a['appendChild'](_0x40414c),_0x44f3ed[_0x41831a(0x123)](_0x5cd937),_0x44f3ed['appendChild'](_0x48708a),this['bannerContainer']['appendChild'](_0x44f3ed),void _0x44f3ed[_0x41831a(0x153)],setTimeout(()=>{const _0x2b0c40=_0x41831a;_0x44f3ed[_0x2b0c40(0x127)][_0x2b0c40(0x10e)]('new-rank-change');},0x32),_0x40414c[_0x41831a(0x138)]('click',()=>{const _0x298e89=_0x41831a;localStorage[_0x298e89(0x146)](_0x1a1dd4,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':!![],'systemDismissed':![]})),_0x44f3ed['classList']['remove']('new-rank-change'),_0x44f3ed['classList'][_0x298e89(0x10e)]('dismissing'),setTimeout(()=>{const _0x5317eb=_0x298e89;_0x44f3ed['parentNode']&&(_0x44f3ed[_0x5317eb(0x14d)](),this['bannerContainer']['children'][_0x5317eb(0x11a)]===0x0&&(this[_0x5317eb(0x14a)]['style'][_0x5317eb(0x11d)]='none'));},0x1f4);}),_0xe426d4['addEventListener'](_0x41831a(0x115),()=>{const _0x12b3c4=_0x41831a;localStorage[_0x12b3c4(0x146)](_0x1a1dd4,JSON[_0x12b3c4(0x150)]({'timestamp':Date[_0x12b3c4(0x15b)](),'ignored':!![],'userDismissed':!![],'systemDismissed':![]})),_0x44f3ed['classList']['remove']('new-rank-change'),_0x44f3ed[_0x12b3c4(0x127)]['add']('dismissing'),setTimeout(()=>{const _0xaa3e27=_0x12b3c4;_0x44f3ed[_0xaa3e27(0x125)]&&(_0x44f3ed['remove'](),this['bannerContainer']['children'][_0xaa3e27(0x11a)]===0x0&&(this['bannerContainer'][_0xaa3e27(0x134)][_0xaa3e27(0x11d)]='none'));},0x1f4);}),setTimeout(()=>{const _0xc18bf7=_0x41831a;_0x44f3ed['parentNode']&&(_0x44f3ed[_0xc18bf7(0x127)]['remove']('new-rank-change'),_0x44f3ed['classList']['add']('dismissing'),localStorage['setItem'](_0x1a1dd4,JSON[_0xc18bf7(0x150)]({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':!![]})),setTimeout(()=>{const _0x56c9d0=_0xc18bf7;_0x44f3ed['parentNode']&&(_0x44f3ed['remove'](),this['bannerContainer']['children'][_0x56c9d0(0x11a)]===0x0&&(this[_0x56c9d0(0x14a)]['style'][_0x56c9d0(0x11d)]=_0x56c9d0(0x114)));},0x1f4));},0x3a98);});}async['resolveUserId'](_0x1db277){const _0xd2d275=a42_0x35c4f6,_0x2d3ee3={..._0x1db277},_0x525e12=[_0x1db277['player'],_0x1db277['username'],_0x1db277[_0xd2d275(0x143)],_0x1db277['displayName']],_0x541363=_0x525e12['some'](_0x50d5f0=>_0x50d5f0&&typeof _0x50d5f0==='string'&&!_0x50d5f0[_0xd2d275(0x12a)]('ID:')&&!/^[a-zA-Z0-9]{20,}$/['test'](_0x50d5f0));if(_0x541363)return _0x2d3ee3;let _0x25ce01=null;if(_0x1db277[_0xd2d275(0x14f)])_0x25ce01=_0x1db277['userId'];else _0x1db277[_0xd2d275(0x142)]&&/^[A-Za-z0-9]{20,}$/['test'](_0x1db277['player'])&&(_0x25ce01=_0x1db277['player']);if(!_0x25ce01)return _0x2d3ee3;try{const _0xea02d4=await getDoc(doc(db,'players',_0x25ce01));if(_0xea02d4['exists']()){const _0x47169c=_0xea02d4[_0xd2d275(0x126)]();if(_0x47169c['username'])return _0x2d3ee3['resolvedName']=_0x47169c['username'],_0x2d3ee3;}const _0x43cf1b=await getDocs(query(collection(db,'approvedMatches'),where('winnerId','==',_0x25ce01),orderBy(_0xd2d275(0x121),'desc'),limit(0x1)));if(!_0x43cf1b['empty']){const _0x4f7f8a=_0x43cf1b['docs'][0x0]['data']();if(_0x4f7f8a['winnerUsername'])return _0x2d3ee3['resolvedName']=_0x4f7f8a['winnerUsername'],_0x2d3ee3;}const _0x57dcaf=await getDocs(query(collection(db,'approvedMatches'),where('loserId','==',_0x25ce01),orderBy('date','desc'),limit(0x1)));if(!_0x57dcaf[_0xd2d275(0x13a)]){const _0x449027=_0x57dcaf['docs'][0x0][_0xd2d275(0x126)]();if(_0x449027[_0xd2d275(0x156)])return _0x2d3ee3['resolvedName']=_0x449027['loserUsername'],console['log']('Resolved\x20'+_0x25ce01+'\x20to\x20'+_0x449027['loserUsername']+'\x20(loser)'),_0x2d3ee3;}}catch(_0x242abd){console['error']('Error\x20resolving\x20user\x20ID:',_0x242abd);}return console['warn']('Failed\x20to\x20resolve\x20user\x20ID:\x20'+_0x25ce01),_0x2d3ee3;}['showRankChangeLightbox'](_0x1a3966,_0x580760){const _0x47c495=a42_0x35c4f6;let _0x30df5f=document['getElementById']('rankChangeModal');!_0x30df5f&&(_0x30df5f=document[_0x47c495(0x144)]('div'),_0x30df5f['id']='rankChangeModal',_0x30df5f['className']='rank-change-modal\x20'+_0x1a3966,document['body']['appendChild'](_0x30df5f));const _0x1c82ab=_0x1a3966==='promotion'?_0x47c495(0x107):'Rank\x20Update',_0x5a41eb=_0x1a3966===_0x47c495(0x12e)?'You\x27ve\x20been\x20promoted\x20to':'You\x27ve\x20been\x20demoted\x20to';_0x30df5f[_0x47c495(0x11e)]=_0x47c495(0x14e)+_0x1c82ab+'</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>'+_0x5a41eb+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22rank-name\x22>'+_0x580760+'</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22rank-change-button\x22\x20id=\x22rank-change-ok-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Got\x20it!\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x30df5f[_0x47c495(0x134)][_0x47c495(0x11d)]='flex',document[_0x47c495(0x15e)](_0x47c495(0x129))['addEventListener']('click',()=>{const _0x30f5bc=_0x47c495;_0x30df5f[_0x30f5bc(0x134)][_0x30f5bc(0x11d)]='none';}),_0x30df5f['addEventListener']('click',_0x1d0326=>{const _0x3ce23e=_0x47c495;_0x1d0326[_0x3ce23e(0x13b)]===_0x30df5f&&(_0x30df5f[_0x3ce23e(0x134)][_0x3ce23e(0x11d)]=_0x3ce23e(0x114));});}async['checkAndRecordPromotion'](_0x5c4f64,_0x599aa1,_0x530975,_0x49afb1={}){const _0x54daa6=a42_0x35c4f6;try{if(_0x599aa1===_0x530975||!_0x5c4f64)return null;const _0x256b99=_0x49afb1['source']||'automatic',_0x1a66f5=_0x49afb1['matchId']||null,_0x4cb905=_0x49afb1['adminUser']||null;console['log']('Processing\x20potential\x20rank\x20change:\x20'+_0x530975+'\x20→\x20'+_0x599aa1+'\x20(source:\x20'+_0x256b99+')');let _0x55c10a=null,_0x4b42f3=null;try{const _0x261f0b=await getDoc(doc(db,'players',_0x5c4f64));if(_0x261f0b['exists']()){const _0x27a173=_0x261f0b['data']();_0x55c10a=_0x27a173[_0x54daa6(0x124)]||_0x27a173['displayName']||null,_0x4b42f3=_0x27a173['displayName']||_0x27a173[_0x54daa6(0x124)]||null;}!_0x55c10a&&_0x49afb1['username']&&(_0x55c10a=_0x49afb1['username'],_0x4b42f3=_0x49afb1['username']);!_0x55c10a&&auth[_0x54daa6(0x10c)]&&(_0x55c10a=auth[_0x54daa6(0x10c)]['displayName']||auth['currentUser']['email']['split']('@')[0x0],_0x4b42f3=auth['currentUser']['displayName']||null);if(!_0x55c10a){const _0x39a649=query(collection(db,'approvedMatches'),where('winnerId','==',_0x5c4f64),limit(0x1)),_0x2dcc8a=await getDocs(_0x39a649);if(!_0x2dcc8a['empty'])_0x55c10a=_0x2dcc8a['docs'][0x0]['data']()['winnerUsername']||_0x54daa6(0x149),_0x4b42f3=_0x55c10a;else{const _0x3de7b5=query(collection(db,_0x54daa6(0x12c)),where(_0x54daa6(0x119),'==',_0x5c4f64),limit(0x1)),_0x36c022=await getDocs(_0x3de7b5);!_0x36c022['empty']&&(_0x55c10a=_0x36c022[0x0]['data']()[_0x54daa6(0x156)]||_0x54daa6(0x149),_0x4b42f3=_0x55c10a);}}}catch(_0x3491af){console[_0x54daa6(0x10d)]('Error\x20resolving\x20username:',_0x3491af);}!_0x55c10a&&(console['warn']('Could\x20not\x20resolve\x20username\x20for\x20userId:',_0x5c4f64),_0x55c10a='A\x20player',_0x4b42f3='Unknown\x20Player');const _0x205340=this['getRankName'](_0x530975),_0xb28473=this['getRankName'](_0x599aa1);if(_0x205340!==_0xb28473){const _0x587f29=_0x599aa1>_0x530975,_0x462023=_0x587f29?'promotion':_0x54daa6(0x136),_0x4c1070=_0xb28473;console[_0x54daa6(0x120)]('Recording\x20'+_0x462023+'\x20for\x20'+_0x55c10a+':\x20'+_0x530975+'\x20('+_0x205340+_0x54daa6(0x12f)+_0x599aa1+'\x20('+_0xb28473+')');try{const _0x2c39b7={'player':_0x55c10a,'playerUsername':_0x55c10a,'username':_0x55c10a,'displayName':_0x4b42f3,'userId':_0x5c4f64,'type':_0x462023,'rankAchieved':_0x4c1070,'timestamp':serverTimestamp(),'previousElo':_0x530975,'newElo':_0x599aa1,'change':_0x599aa1-_0x530975,'previousRank':_0x205340,'newRank':_0xb28473,'source':_0x256b99};if(_0x256b99===_0x54daa6(0x13f)&&_0x1a66f5)_0x2c39b7['matchId']=_0x1a66f5;else _0x256b99==='admin'&&_0x4cb905?(_0x2c39b7[_0x54daa6(0x148)]=_0x4cb905,_0x2c39b7['isAutomatic']=![]):_0x2c39b7['isAutomatic']=!![];const _0x2076f1=writeBatch(db),_0x48e9c4=doc(collection(db,'eloHistory')),_0x248be1=doc(collection(db,'promotionHistory'));return _0x2076f1[_0x54daa6(0x15d)](_0x48e9c4,_0x2c39b7),_0x2076f1['set'](_0x248be1,_0x2c39b7),await _0x2076f1[_0x54daa6(0x108)](),await this['sendPromotionNotification'](_0x5c4f64,_0x55c10a,_0x530975,_0x599aa1,_0x205340,_0xb28473,_0x462023,{'displayName':_0x4b42f3,'source':_0x256b99,'matchId':_0x1a66f5,'ladder':_0x49afb1[_0x54daa6(0x141)]||'D1'}),console['log']('Successfully\x20recorded\x20'+_0x462023+_0x54daa6(0x133)+_0x55c10a+'\x20to\x20'+_0x4c1070),_0x4c1070;}catch(_0xfe39){console['error']('Error\x20writing\x20promotion\x20records:',_0xfe39);try{return await addDoc(collection(db,_0x54daa6(0x162)),{'player':_0x55c10a,'playerUsername':_0x55c10a,'username':_0x55c10a,'displayName':_0x4b42f3,'userId':_0x5c4f64,'type':_0x462023,'rankAchieved':_0x4c1070,'timestamp':serverTimestamp(),'previousElo':_0x530975,'newElo':_0x599aa1,'change':_0x599aa1-_0x530975,'previousRank':_0x205340,'source':_0x256b99,'isAutomatic':_0x256b99!=='admin'}),await this['sendPromotionNotification'](_0x5c4f64,_0x55c10a,_0x530975,_0x599aa1,_0x205340,_0xb28473,_0x462023,{'displayName':_0x4b42f3,'source':_0x256b99,'matchId':_0x1a66f5,'ladder':_0x49afb1['ladder']||'D1'}),_0x4c1070;}catch(_0x53b7b4){return console['error']('Fallback\x20write\x20failed:',_0x53b7b4),null;}}}return null;}catch(_0xcf9440){return console['error'](_0x54daa6(0x155),_0xcf9440),null;}}['getRankName'](_0x53d2ff){const _0x1bd1d7=a42_0x35c4f6;for(let _0x3fbbe7=this['RANKS'][_0x1bd1d7(0x11a)]-0x1;_0x3fbbe7>=0x0;_0x3fbbe7--){if(_0x53d2ff>=this['RANKS'][_0x3fbbe7]['threshold'])return this[_0x1bd1d7(0x131)][_0x3fbbe7]['name'];}return'Unranked';}['cleanup'](){const _0x423a1a=a42_0x35c4f6;this['pollingInterval']&&clearInterval(this[_0x423a1a(0x122)]);}['isNewRankChange'](_0x40749){const _0x682c7e=a42_0x35c4f6;if(_0x40749['timestamp']){const _0x236cc1=_0x40749[_0x682c7e(0x13c)][_0x682c7e(0x118)]*0x3e8,_0x5b3c90=Date[_0x682c7e(0x15b)](),_0x11aabb=(_0x5b3c90-_0x236cc1)/(0x3e8*0x3c*0x3c);if(_0x11aabb>0x18)return![];}if(_0x40749[_0x682c7e(0x10a)]&&_0x40749['newRank']&&_0x40749['previousRank']!==_0x40749['newRank'])return!![];return![];}async[a42_0x35c4f6(0x15f)](_0x15aa4a,_0x45135f,_0x43d14c,_0x21818b,_0x4d1206,_0xd2cfb,_0x1acb1f,_0x2905db={}){const _0x2ebcfb=a42_0x35c4f6;try{console['log'](_0x2ebcfb(0x11c)+_0x45135f+'\x27s\x20'+_0x1acb1f);const _0x545a7f={'userId':_0x15aa4a,'username':_0x45135f,'displayName':_0x2905db[_0x2ebcfb(0x128)]||_0x45135f,'oldElo':parseInt(_0x43d14c),'newElo':parseInt(_0x21818b),'eloDifference':parseInt(_0x21818b)-parseInt(_0x43d14c),'oldRank':_0x4d1206,'newRank':_0xd2cfb,'type':_0x1acb1f,'timestamp':serverTimestamp(),'processed':![],'source':_0x2905db['source']||'automatic','matchId':_0x2905db[_0x2ebcfb(0x137)]||null,'ladder':_0x2905db[_0x2ebcfb(0x141)]||'D1','adminUser':_0x2905db[_0x2ebcfb(0x109)]||null};console[_0x2ebcfb(0x120)]('Creating\x20Discord\x20notification:',_0x545a7f);const _0x1b1b30=await addDoc(collection(db,'promotionNotifications'),_0x545a7f);return console['log']('Discord\x20notification\x20sent\x20successfully\x20with\x20ID:\x20'+_0x1b1b30['id']),!![];}catch(_0x5941f4){return console[_0x2ebcfb(0x10d)]('Error\x20sending\x20Discord\x20notification:',_0x5941f4),![];}}}export const promotionManager=new PromotionManager();function a42_0x1f51(_0x5aa6e4,_0x56ae29){const _0x5aae34=a42_0x488f();return a42_0x1f51=function(_0x292255,_0x55aa4d){_0x292255=_0x292255-0x107;let _0x488f8a=_0x5aae34[_0x292255];return _0x488f8a;},a42_0x1f51(_0x5aa6e4,_0x56ae29);}document[a42_0x35c4f6(0x138)]('DOMContentLoaded',()=>{promotionManager['initialize']();});export const initializePromotionTracker=()=>promotionManager['initialize']();function a42_0x488f(){const _0x36e1f5=['Congratulations!','commit','adminUser','previousRank','#CD7F32','currentUser','error','add','checkAndRecordPromotion','ignored','getItem','setupBannerContainer','fetchRecentPromotions','none','click','userDismissed','toDateString','seconds','loserId','length','#C0C0C0','STARTING\x20notification\x20for\x20','display','innerHTML','toString','log','date','pollingInterval','appendChild','username','parentNode','data','classList','displayName','rank-change-ok-btn','includes','toMillis','approvedMatches','type','promotion',')\x20→\x20','Error\x20fetching\x20promotions:','RANKS','className','\x20for\x20','style','Don\x27t\x20show\x20again','demotion','matchId','addEventListener','prototype','empty','target','timestamp','DISPLAY_HOURS','firstChild','match','resolvedName','ladder','player','playerUsername','createElement','constructor','setItem','initialize','modifiedBy','Unknown\x20Player','bannerContainer','rankAchieved','parse','remove','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rank-change-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2\x20class=\x22rank-change-title\x22>','userId','stringify','lastFetchTime','promotion_','offsetWidth','Error\x20checking\x20promotion\x20visibility:','Error\x20in\x20promotion/demotion\x20recording:','loserUsername','children','__proto__','textContent','Promotion\x20banner\x20container\x20not\x20found','now','isNewRankChange','set','getElementById','sendPromotionNotification','return\x20(function()\x20','Invalid\x20storage\x20format\x20for\x20','eloHistory'];a42_0x488f=function(){return _0x36e1f5;};return a42_0x488f();}export const checkAndRecordPromotion=(_0x469dac,_0x505f77,_0x17b0d0,_0x387942)=>promotionManager[a42_0x35c4f6(0x10f)](_0x469dac,_0x505f77,_0x17b0d0,_0x387942);export const getRankName=_0x50b54e=>promotionManager['getRankName'](_0x50b54e);
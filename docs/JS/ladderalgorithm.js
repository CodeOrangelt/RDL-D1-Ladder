(function(_0x5064b2,_0x6fbaf0){const _0x13a373=a0_0x5506,_0x21b0e4=_0x5064b2();while(!![]){try{const _0x384bf8=-parseInt(_0x13a373(0x1e0))/0x1+parseInt(_0x13a373(0x1de))/0x2+parseInt(_0x13a373(0x1e5))/0x3+parseInt(_0x13a373(0x1cb))/0x4+-parseInt(_0x13a373(0x1b4))/0x5+-parseInt(_0x13a373(0x1af))/0x6*(-parseInt(_0x13a373(0x1e4))/0x7)+parseInt(_0x13a373(0x1df))/0x8*(parseInt(_0x13a373(0x1bb))/0x9);if(_0x384bf8===_0x6fbaf0)break;else _0x21b0e4['push'](_0x21b0e4['shift']());}catch(_0x403db9){_0x21b0e4['push'](_0x21b0e4['shift']());}}}(a0_0x4078,0xd53d2));const a0_0x5b397d=(function(){let _0x10c3d7=!![];return function(_0xed5c2c,_0x117625){const _0x155ec6=_0x10c3d7?function(){const _0x3825df=a0_0x5506;if(_0x117625){const _0x3407e9=_0x117625[_0x3825df(0x1d2)](_0xed5c2c,arguments);return _0x117625=null,_0x3407e9;}}:function(){};return _0x10c3d7=![],_0x155ec6;};}()),a0_0xd252cd=a0_0x5b397d(this,function(){const _0xbbd71=a0_0x5506,_0x937492=function(){const _0x162ba8=a0_0x5506;let _0x19f4d4;try{_0x19f4d4=Function(_0x162ba8(0x1c4)+_0x162ba8(0x1b5)+');')();}catch(_0x3bed17){_0x19f4d4=window;}return _0x19f4d4;},_0x1491d4=_0x937492(),_0x5cd591=_0x1491d4['console']=_0x1491d4[_0xbbd71(0x1cc)]||{},_0x48e00d=[_0xbbd71(0x1be),'warn','info',_0xbbd71(0x1d5),'exception',_0xbbd71(0x1bc),'trace'];for(let _0x6f313f=0x0;_0x6f313f<_0x48e00d['length'];_0x6f313f++){const _0x4737c7=a0_0x5b397d['constructor'][_0xbbd71(0x1db)]['bind'](a0_0x5b397d),_0x4eb2d7=_0x48e00d[_0x6f313f],_0x46d4da=_0x5cd591[_0x4eb2d7]||_0x4737c7;_0x4737c7['__proto__']=a0_0x5b397d['bind'](a0_0x5b397d),_0x4737c7[_0xbbd71(0x1c7)]=_0x46d4da['toString']['bind'](_0x46d4da),_0x5cd591[_0x4eb2d7]=_0x4737c7;}});a0_0xd252cd();import{collection,doc,getDoc,getDocs,updateDoc,setDoc,deleteDoc,writeBatch,query,where,serverTimestamp,addDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';import{recordEloChange}from'./elo-history.js';function a0_0x4078(){const _0x13e6f8=['name','1623528hdRJVz','table','Report\x20not\x20found','log','approvedMatches','Unknown\x20User','winnerUsername','totalDeaths','empty','return\x20(function()\x20','catch','position','toString','add','Could\x20not\x20award\x20points\x20-\x20one\x20or\x20both\x20user\x20profiles\x20not\x20found','Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions','2553920YwCYJs','console','match','checkAndRecordPromotion','max','loss','exists','apply','userProfiles','round','error','Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked','warn','winnerScore','username','then','prototype','players','data','1357150OmVGnP','48nzXYTW','581864DwkqaW','Match\x20points:\x20','unknown','eloRating','1484vRBivF','640785tgoDqm','888VhOcbV','toISOString','totalKills','playerStats','losses','5945440OdJxVc','{}.constructor(\x22return\x20this\x22)(\x20)','docs','pointsHistory','lastUpdated','displayName'];a0_0x4078=function(){return _0x13e6f8;};return a0_0x4078();}import{promotionManager,checkAndRecordPromotion}from'./promotions.js';import{isAdmin}from'./admin-check.js';function a0_0x5506(_0x7c79fc,_0x53844f){const _0x3997e9=a0_0x4078();return a0_0x5506=function(_0xd252cd,_0x5b397d){_0xd252cd=_0xd252cd-0x1af;let _0x4bc828=_0x3997e9[_0xd252cd];return _0x4bc828;},a0_0x5506(_0x7c79fc,_0x53844f);}import{RANKS,getRankStyle}from'./ranks.js';export function calculateElo(_0x2ba4b0,_0x2b8264,_0x48e2b2=0x20){const _0xa8bcd5=a0_0x5506;_0x2ba4b0=_0x2ba4b0>0x3e8?0xc8:_0x2ba4b0,_0x2b8264=_0x2b8264>0x3e8?0xc8:_0x2b8264;const _0x4dfc95=0x1/(0x1+Math['pow'](0xa,(_0x2b8264-_0x2ba4b0)/0x190)),_0x4064fa=0x1/(0x1+Math['pow'](0xa,(_0x2ba4b0-_0x2b8264)/0x190)),_0x279181=_0x2ba4b0+_0x48e2b2*(0x1-_0x4dfc95),_0x13b26f=_0x2b8264+_0x48e2b2*(0x0-_0x4064fa);return{'newWinnerRating':Math['round'](Math['min'](_0x279181)),'newLoserRating':Math[_0xa8bcd5(0x1d4)](Math[_0xa8bcd5(0x1cf)](_0x13b26f,0x0))};}export function assignDefaultEloRating(_0x35e01f,_0x72bde6){const _0x3fcad1=a0_0x5506,_0x241b7c=0xc8;!_0x72bde6['eloRating']&&db['collection'](_0x3fcad1(0x1dc))['doc'](_0x35e01f)['update']({'eloRating':_0x241b7c})[_0x3fcad1(0x1da)](()=>{console['log']('Assigned\x20default\x20ELO\x20rating\x20to\x20player\x20'+_0x72bde6['username']);})[_0x3fcad1(0x1c5)](_0x3b0388=>{console['error']('Error\x20assigning\x20default\x20ELO\x20rating:',_0x3b0388);});}export async function updateEloRatings(_0x33f8cb,_0x4a663d,_0x470dab){const _0x1d698d=a0_0x5506;try{const _0x266b84=writeBatch(db),_0x484c8c=doc(db,'players',_0x33f8cb),_0x26e9fd=doc(db,'players',_0x4a663d),[_0x59f20e,_0x53363c]=await Promise['all']([getDoc(_0x484c8c),getDoc(_0x26e9fd)]);if(!_0x59f20e['exists']()||!_0x53363c['exists']())throw new Error('One\x20or\x20both\x20players\x20not\x20found');const _0x5f50b8=_0x59f20e['data'](),_0x487146=_0x53363c['data'](),_0x2b5541=_0x5f50b8['position']||Number['MAX_SAFE_INTEGER'],_0x4852ab=_0x487146['position']||Number['MAX_SAFE_INTEGER'],{newWinnerRating:_0x4bf10f,newLoserRating:_0x5f125c}=calculateElo(_0x5f50b8['eloRating']||0x4b0,_0x487146['eloRating']||0x4b0);let _0xe852e0=_0x2b5541,_0x5a9149=_0x4852ab;if(_0x2b5541>_0x4852ab){console[_0x1d698d(0x1be)](_0x1d698d(0x1d6)),_0xe852e0=_0x4852ab,_0x5a9149=_0x4852ab+0x1;const _0x4f9e9b=query(collection(db,_0x1d698d(0x1dc)),where(_0x1d698d(0x1c6),'>',_0x4852ab),where(_0x1d698d(0x1c6),'<',_0x2b5541)),_0xc49fa8=await getDocs(_0x4f9e9b);for(const _0x15ba5b of _0xc49fa8['docs']){_0x15ba5b['id']!==_0x33f8cb&&_0x15ba5b['id']!==_0x4a663d&&_0x266b84['update'](doc(db,'players',_0x15ba5b['id']),{'position':_0x15ba5b[_0x1d698d(0x1dd)]()[_0x1d698d(0x1c6)]+0x1});}}else console['log'](_0x1d698d(0x1ca));const _0x4e8b10={'eloRating':_0x4bf10f,'lastMatchDate':serverTimestamp(),'position':_0xe852e0,'lastMatchId':_0x470dab},_0x1d7c7c={'eloRating':_0x5f125c,'lastMatchDate':serverTimestamp(),'position':_0x5a9149,'lastMatchId':_0x470dab};return _0x266b84['update'](_0x484c8c,_0x4e8b10),_0x266b84['update'](_0x26e9fd,_0x1d7c7c),await _0x266b84['commit'](),console['log']('ELO\x20ratings\x20updated\x20successfully'),await Promise['all']([recordEloChange({'playerId':_0x33f8cb,'previousElo':_0x5f50b8[_0x1d698d(0x1e3)]||0x4b0,'newElo':_0x4bf10f,'opponentId':_0x4a663d,'matchResult':'win','previousPosition':_0x2b5541,'newPosition':_0xe852e0,'isPromotion':_0xe852e0<_0x2b5541,'matchId':_0x470dab,'timestamp':serverTimestamp()}),recordEloChange({'playerId':_0x4a663d,'previousElo':_0x487146[_0x1d698d(0x1e3)]||0x4b0,'newElo':_0x5f125c,'opponentId':_0x33f8cb,'matchResult':_0x1d698d(0x1d0),'previousPosition':_0x4852ab,'newPosition':_0x5a9149,'isDemotion':_0x5a9149>_0x4852ab,'matchId':_0x470dab,'timestamp':serverTimestamp()})]),await promotionManager[_0x1d698d(0x1ce)](_0x33f8cb,_0x4bf10f,_0x5f50b8['eloRating'],{'source':_0x1d698d(0x1cd),'matchId':_0x470dab}),await promotionManager[_0x1d698d(0x1ce)](_0x4a663d,_0x5f125c,_0x487146[_0x1d698d(0x1e3)],{'source':'match','matchId':_0x470dab}),console[_0x1d698d(0x1be)]('ELO\x20ratings\x20and\x20positions\x20updated\x20successfully'),!![];}catch(_0x5703b2){console[_0x1d698d(0x1d5)]('Error\x20in\x20updateEloRatings:',_0x5703b2);throw _0x5703b2;}}const POINTS_CHART={'':0xa,'Standard':0xa,'Fusion\x20Match':0x19,'â‰¥6\x20Missiles':0xa,'Weapon\x20Imbalance':0x1e,'Blind\x20Match':0x4b,'Rematch':0x14,'Disorientation':0x32,'Ratting':0x23,'Altered\x20Powerups':0x23,'Mega\x20Match':0x28,'Dogfight':0x32,'Gauss\x20and\x20Mercs':0x19,'Misc':0x1e};export async function approveReport(_0x2776a9,_0x1eedec,_0x1004f0,_0x218059,_0x24616e){const _0x351017=a0_0x5506;try{const _0x205c37=doc(db,'pendingMatches',_0x2776a9),_0x139a00=await getDoc(_0x205c37);if(!_0x139a00['exists']())throw new Error(_0x351017(0x1bd));const _0x5e3b7c=_0x139a00['data'](),_0x1d6d02={..._0x5e3b7c,'winnerScore':_0x1eedec,'winnerSuicides':_0x1004f0,'winnerComment':_0x218059,'winnerDemoLink':_0x24616e,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':auth['currentUser']['uid']};await setDoc(doc(db,_0x351017(0x1bf),_0x2776a9),_0x1d6d02),await deleteDoc(_0x205c37),console['log']('Match\x20moved\x20to\x20approved\x20collection');const [_0xc164a2,_0x55bca2]=await Promise['all']([getDocs(query(collection(db,_0x351017(0x1dc)),where('username','==',_0x5e3b7c[_0x351017(0x1c1)]))),getDocs(query(collection(db,'players'),where('username','==',_0x5e3b7c['loserUsername'])))]);if(_0xc164a2[_0x351017(0x1c3)]||_0x55bca2[_0x351017(0x1c3)])throw new Error('Could\x20not\x20find\x20player\x20documents');const _0x466fa0=_0xc164a2[_0x351017(0x1b6)][0x0]['id'],_0x126c04=_0x55bca2[_0x351017(0x1b6)][0x0]['id'];await updateEloRatings(_0x466fa0,_0x126c04,_0x2776a9);try{const _0x349b9e=_0x5e3b7c['subgameType']||'Standard',_0x537b62=POINTS_CHART[_0x349b9e]||0xa,_0x4242ef=doc(db,_0x351017(0x1d3),_0x466fa0),_0x2c65f3=doc(db,'userProfiles',_0x126c04),[_0x26767d,_0x461263]=await Promise['all']([getDoc(_0x4242ef),getDoc(_0x2c65f3)]);if(_0x26767d['exists']()&&_0x461263['exists']()){const _0x3e8af8=_0x26767d[_0x351017(0x1dd)](),_0x6c44cb=_0x461263['data'](),_0x490842=_0x3e8af8['points']||0x0,_0x23e682=_0x6c44cb['points']||0x0,_0x4c1630=_0x490842+_0x537b62,_0x1cfe03=_0x23e682+_0x537b62;await Promise['all']([updateDoc(_0x4242ef,{'points':_0x4c1630,'lastPointsModified':serverTimestamp()}),updateDoc(_0x2c65f3,{'points':_0x1cfe03,'lastPointsModified':serverTimestamp()})]),await Promise['all']([addDoc(collection(db,'pointsHistory'),{'userId':_0x466fa0,'userEmail':_0x3e8af8['email']||'unknown','displayName':_0x3e8af8[_0x351017(0x1b9)]||_0x3e8af8[_0x351017(0x1d9)]||_0x351017(0x1c0),'action':'add','amount':_0x537b62,'previousPoints':_0x490842,'newPoints':_0x4c1630,'reason':_0x351017(0x1e1)+_0x349b9e+'\x20match\x20(Winner)','adminEmail':'system-match-award','timestamp':serverTimestamp()}),addDoc(collection(db,_0x351017(0x1b7)),{'userId':_0x126c04,'userEmail':_0x6c44cb['email']||_0x351017(0x1e2),'displayName':_0x6c44cb['displayName']||_0x6c44cb[_0x351017(0x1d9)]||'Unknown\x20User','action':_0x351017(0x1c8),'amount':_0x537b62,'previousPoints':_0x23e682,'newPoints':_0x1cfe03,'reason':'Match\x20points:\x20'+_0x349b9e+'\x20match\x20(Participant)','adminEmail':'system-match-award','timestamp':serverTimestamp()})]),console[_0x351017(0x1be)]('Awarded\x20'+_0x537b62+'\x20points\x20to\x20both\x20players\x20for\x20'+_0x349b9e+'\x20match');}else console[_0x351017(0x1d7)](_0x351017(0x1c9));}catch(_0x92ae96){console['warn']('Points\x20award\x20failed,\x20but\x20match\x20approval\x20continues:',_0x92ae96);}return console['log']('Match\x20successfully\x20approved\x20and\x20ELO\x20updated'),!![];}catch(_0x41f734){console['error']('Error\x20approving\x20report:',_0x41f734);throw _0x41f734;}}async function updatePlayerElo(_0x5b8ab9,_0x59a909,_0xc1a64e){const _0x28885b=a0_0x5506,_0x20303e=doc(db,'players',_0x5b8ab9),_0x344d60=await getDoc(_0x20303e),_0x3742bc=_0x344d60['data'](),_0x4611d2=doc(db,_0x28885b(0x1b2),_0x5b8ab9),_0x5f1af0=await getDoc(_0x4611d2),_0x3ea28c=_0x5f1af0['data']()||{'totalMatches':0x0,'winRate':0x0},_0x1a82e5=getRankStyle(_0xc1a64e,_0x3ea28c['totalMatches'],_0x3ea28c['winRate']);await updateDoc(_0x20303e,{'eloRating':_0xc1a64e,'rank':_0x1a82e5[_0x28885b(0x1ba)],'rankColor':_0x1a82e5['color']}),await checkAndRecordPromotion(_0x5b8ab9,_0xc1a64e,_0x59a909,{'matchCount':_0x3ea28c['totalMatches'],'winRate':_0x3ea28c['winRate']});}async function updatePlayerStats(_0x47ec10,_0x3dd813,_0x41945a){const _0x5a655e=a0_0x5506,_0x41681a=doc(db,_0x5a655e(0x1b2),_0x47ec10),_0x47888f=await getDoc(_0x41681a);let _0x4fd88b=_0x47888f[_0x5a655e(0x1d1)]()?_0x47888f['data']():{'wins':0x0,'losses':0x0,'totalKills':0x0,'totalDeaths':0x0,'winRate':0x0};_0x41945a?(_0x4fd88b['wins']++,_0x4fd88b['totalKills']+=parseInt(_0x3dd813[_0x5a655e(0x1d8)]||0x0),_0x4fd88b[_0x5a655e(0x1c2)]+=parseInt(_0x3dd813['loserScore']||0x0)):(_0x4fd88b['losses']++,_0x4fd88b[_0x5a655e(0x1b1)]+=parseInt(_0x3dd813['loserScore']||0x0),_0x4fd88b['totalDeaths']+=parseInt(_0x3dd813['winnerScore']||0x0));const _0x5aee88=_0x4fd88b['wins']+_0x4fd88b[_0x5a655e(0x1b3)];_0x4fd88b['winRate']=_0x5aee88>0x0?(_0x4fd88b['wins']/_0x5aee88*0x64)['toFixed'](0x1):0x0,_0x4fd88b[_0x5a655e(0x1b8)]=new Date()[_0x5a655e(0x1b0)](),await setDoc(_0x41681a,_0x4fd88b,{'merge':!![]});}
(function(_0x31c832,_0x5948a7){const _0x105c1b=a30_0x1d1a,_0x35193f=_0x31c832();while(!![]){try{const _0x41bcef=-parseInt(_0x105c1b(0x11a))/0x1*(parseInt(_0x105c1b(0x114))/0x2)+parseInt(_0x105c1b(0x143))/0x3*(parseInt(_0x105c1b(0x146))/0x4)+parseInt(_0x105c1b(0x11b))/0x5*(parseInt(_0x105c1b(0x129))/0x6)+-parseInt(_0x105c1b(0x11f))/0x7+-parseInt(_0x105c1b(0x148))/0x8+-parseInt(_0x105c1b(0x142))/0x9*(-parseInt(_0x105c1b(0x135))/0xa)+parseInt(_0x105c1b(0x13f))/0xb*(parseInt(_0x105c1b(0x12a))/0xc);if(_0x41bcef===_0x5948a7)break;else _0x35193f['push'](_0x35193f['shift']());}catch(_0x565b9d){_0x35193f['push'](_0x35193f['shift']());}}}(a30_0x3c7c,0xa6546));const a30_0x64ddf2=(function(){let _0x4675d7=!![];return function(_0x28e086,_0x4748b8){const _0x40707f=_0x4675d7?function(){const _0x558111=a30_0x1d1a;if(_0x4748b8){const _0x3c62f1=_0x4748b8[_0x558111(0x153)](_0x28e086,arguments);return _0x4748b8=null,_0x3c62f1;}}:function(){};return _0x4675d7=![],_0x40707f;};}()),a30_0x233e7c=a30_0x64ddf2(this,function(){const _0x1c0029=a30_0x1d1a;return a30_0x233e7c[_0x1c0029(0x13d)]()['search'](_0x1c0029(0x14e))['toString']()[_0x1c0029(0x120)](a30_0x233e7c)['search'](_0x1c0029(0x14e));});a30_0x233e7c();const a30_0x5bafe6=(function(){let _0x427812=!![];return function(_0x2f2a50,_0x3b8cce){const _0x1d6583=_0x427812?function(){const _0x241210=a30_0x1d1a;if(_0x3b8cce){const _0x348ead=_0x3b8cce[_0x241210(0x153)](_0x2f2a50,arguments);return _0x3b8cce=null,_0x348ead;}}:function(){};return _0x427812=![],_0x1d6583;};}()),a30_0x3399ac=a30_0x5bafe6(this,function(){const _0x4bfd66=a30_0x1d1a,_0x72fc96=function(){const _0x48c06f=a30_0x1d1a;let _0x15c635;try{_0x15c635=Function(_0x48c06f(0x158)+_0x48c06f(0x155)+');')();}catch(_0x18caa5){_0x15c635=window;}return _0x15c635;},_0x21eae1=_0x72fc96(),_0x1cc7ff=_0x21eae1[_0x4bfd66(0x12f)]=_0x21eae1[_0x4bfd66(0x12f)]||{},_0x4675e1=[_0x4bfd66(0x131),_0x4bfd66(0x122),'info',_0x4bfd66(0x144),_0x4bfd66(0x159),_0x4bfd66(0x137),_0x4bfd66(0x126)];for(let _0x2e093f=0x0;_0x2e093f<_0x4675e1[_0x4bfd66(0x14f)];_0x2e093f++){const _0x5b5801=a30_0x5bafe6['constructor'][_0x4bfd66(0x14b)][_0x4bfd66(0x13c)](a30_0x5bafe6),_0x3307e4=_0x4675e1[_0x2e093f],_0x4f4e87=_0x1cc7ff[_0x3307e4]||_0x5b5801;_0x5b5801[_0x4bfd66(0x13b)]=a30_0x5bafe6[_0x4bfd66(0x13c)](a30_0x5bafe6),_0x5b5801['toString']=_0x4f4e87['toString']['bind'](_0x4f4e87),_0x1cc7ff[_0x3307e4]=_0x5b5801;}});a30_0x3399ac();import{collection,doc,getDoc,getDocs,updateDoc,setDoc,deleteDoc,writeBatch,query,where,serverTimestamp,addDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a30_0x3c7c(){const _0x442ab1=['docs','ELO\x20ratings\x20updated\x20successfully','return\x20(function()\x20','exception','loss','checkAndRecordPromotion','catch','loserScore','empty','35288jxkmFA','winnerScore','Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions','Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked','uid','loserUsername','76RqSieJ','5cGuPpV','data','totalKills','update','2116499TRtEmK','constructor','Could\x20not\x20find\x20player\x20documents','warn','Error\x20approving\x20report:','currentUser','Error\x20in\x20updateEloRatings:','trace','all','collection','3872424kxygvv','6635412wRbfPm','pow','winnerUsername','position','totalDeaths','console','round','log','eloRating','toISOString','pendingMatches','920BuVqYQ','playerStats','table','username','commit','approvedMatches','__proto__','bind','toString','Match\x20moved\x20to\x20approved\x20collection','11hAdSvH','ELO\x20ratings\x20and\x20positions\x20updated\x20successfully','players','41499ZxvAwc','1869Rzffbl','error','toFixed','5768yEWSvD','losses','1570768lopMTC','MAX_SAFE_INTEGER','match','prototype','lastUpdated','then','(((.+)+)+)+$','length','doc','Error\x20assigning\x20default\x20ELO\x20rating:','exists','apply','win','{}.constructor(\x22return\x20this\x22)(\x20)'];a30_0x3c7c=function(){return _0x442ab1;};return a30_0x3c7c();}import{db,auth}from'./firebase-config.js';import{recordEloChange}from'./elo-history.js';import{promotionManager,checkAndRecordPromotion}from'./promotions.js';import{isAdmin}from'./admin-check.js';export function calculateElo(_0x5e9df8,_0xb4c88c,_0x297acf=0x20){const _0x26ced4=a30_0x1d1a,_0x580e01=0x1/(0x1+Math['pow'](0xa,(_0xb4c88c-_0x5e9df8)/0x190)),_0x2d0f26=0x1/(0x1+Math[_0x26ced4(0x12b)](0xa,(_0x5e9df8-_0xb4c88c)/0x190)),_0x3c6236=_0x5e9df8+_0x297acf*(0x1-_0x580e01),_0xb22d2a=_0xb4c88c+_0x297acf*(0x0-_0x2d0f26);return{'newWinnerRating':Math[_0x26ced4(0x130)](_0x3c6236),'newLoserRating':Math['round'](_0xb22d2a)};}export function assignDefaultEloRating(_0x152b94,_0x1dac40){const _0x57ab6a=a30_0x1d1a,_0xbf9f38=0x4b0;!_0x1dac40['eloRating']&&db[_0x57ab6a(0x128)](_0x57ab6a(0x141))[_0x57ab6a(0x150)](_0x152b94)[_0x57ab6a(0x11e)]({'eloRating':_0xbf9f38})[_0x57ab6a(0x14d)](()=>{const _0x1d298d=_0x57ab6a;console[_0x1d298d(0x131)]('Assigned\x20default\x20ELO\x20rating\x20to\x20player\x20'+_0x1dac40[_0x1d298d(0x138)]);})[_0x57ab6a(0x111)](_0x34f9bd=>{const _0x46471d=_0x57ab6a;console['error'](_0x46471d(0x151),_0x34f9bd);});}function a30_0x1d1a(_0x5ae211,_0x5ef11a){const _0x430162=a30_0x3c7c();return a30_0x1d1a=function(_0x3399ac,_0x5bafe6){_0x3399ac=_0x3399ac-0x10f;let _0x3ddc8a=_0x430162[_0x3399ac];return _0x3ddc8a;},a30_0x1d1a(_0x5ae211,_0x5ef11a);}export async function updateEloRatings(_0x5df6d7,_0x26c807,_0x4b1790){const _0x3eeead=a30_0x1d1a;try{const _0x2738cb=writeBatch(db),_0x1c922d=doc(db,_0x3eeead(0x141),_0x5df6d7),_0x29e796=doc(db,'players',_0x26c807),[_0x2d6718,_0x59a174]=await Promise['all']([getDoc(_0x1c922d),getDoc(_0x29e796)]);if(!_0x2d6718[_0x3eeead(0x152)]()||!_0x59a174[_0x3eeead(0x152)]())throw new Error('One\x20or\x20both\x20players\x20not\x20found');const _0x57f30b=_0x2d6718[_0x3eeead(0x11c)](),_0x131ce1=_0x59a174[_0x3eeead(0x11c)](),_0x1fc60e=_0x57f30b[_0x3eeead(0x12d)]||Number[_0x3eeead(0x149)],_0x2c1dce=_0x131ce1[_0x3eeead(0x12d)]||Number[_0x3eeead(0x149)],{newWinnerRating:_0x2fc759,newLoserRating:_0x1cb846}=calculateElo(_0x57f30b[_0x3eeead(0x132)]||0x4b0,_0x131ce1[_0x3eeead(0x132)]||0x4b0);let _0x56eeb7=_0x1fc60e,_0x3cd3f6=_0x2c1dce;if(_0x1fc60e>_0x2c1dce){console[_0x3eeead(0x131)](_0x3eeead(0x117)),_0x56eeb7=_0x2c1dce,_0x3cd3f6=_0x2c1dce+0x1;const _0x43359e=query(collection(db,'players'),where(_0x3eeead(0x12d),'>',_0x2c1dce),where(_0x3eeead(0x12d),'<',_0x1fc60e)),_0x5d6605=await getDocs(_0x43359e);for(const _0xbd2c41 of _0x5d6605[_0x3eeead(0x156)]){_0xbd2c41['id']!==_0x5df6d7&&_0xbd2c41['id']!==_0x26c807&&_0x2738cb[_0x3eeead(0x11e)](doc(db,_0x3eeead(0x141),_0xbd2c41['id']),{'position':_0xbd2c41[_0x3eeead(0x11c)]()['position']+0x1});}}else console[_0x3eeead(0x131)](_0x3eeead(0x116));const _0xc5b456={'eloRating':_0x2fc759,'lastMatchDate':serverTimestamp(),'position':_0x56eeb7,'lastMatchId':_0x4b1790},_0x5f5887={'eloRating':_0x1cb846,'lastMatchDate':serverTimestamp(),'position':_0x3cd3f6,'lastMatchId':_0x4b1790};return _0x2738cb[_0x3eeead(0x11e)](_0x1c922d,_0xc5b456),_0x2738cb[_0x3eeead(0x11e)](_0x29e796,_0x5f5887),await _0x2738cb[_0x3eeead(0x139)](),console['log'](_0x3eeead(0x157)),await Promise[_0x3eeead(0x127)]([recordEloChange({'playerId':_0x5df6d7,'previousElo':_0x57f30b['eloRating']||0x4b0,'newElo':_0x2fc759,'opponentId':_0x26c807,'matchResult':_0x3eeead(0x154),'previousPosition':_0x1fc60e,'newPosition':_0x56eeb7,'isPromotion':_0x56eeb7<_0x1fc60e,'matchId':_0x4b1790,'timestamp':serverTimestamp()}),recordEloChange({'playerId':_0x26c807,'previousElo':_0x131ce1['eloRating']||0x4b0,'newElo':_0x1cb846,'opponentId':_0x5df6d7,'matchResult':_0x3eeead(0x10f),'previousPosition':_0x2c1dce,'newPosition':_0x3cd3f6,'isDemotion':_0x3cd3f6>_0x2c1dce,'matchId':_0x4b1790,'timestamp':serverTimestamp()})]),await promotionManager[_0x3eeead(0x110)](_0x5df6d7,_0x2fc759,_0x57f30b[_0x3eeead(0x132)],{'source':'match','matchId':_0x4b1790}),await promotionManager[_0x3eeead(0x110)](_0x26c807,_0x1cb846,_0x131ce1[_0x3eeead(0x132)],{'source':_0x3eeead(0x14a),'matchId':_0x4b1790}),console[_0x3eeead(0x131)](_0x3eeead(0x140)),!![];}catch(_0x44b139){console[_0x3eeead(0x144)](_0x3eeead(0x125),_0x44b139);throw _0x44b139;}}export async function approveReport(_0x7a684c,_0xf5d9b0,_0x1f3ee0,_0x4e5ffc,_0x4222dc){const _0x42d025=a30_0x1d1a;try{const _0x2c4c2d=doc(db,_0x42d025(0x134),_0x7a684c),_0x5a8b71=await getDoc(_0x2c4c2d);if(!_0x5a8b71['exists']())throw new Error('Report\x20not\x20found');const _0x3ad55c=_0x5a8b71[_0x42d025(0x11c)](),_0xfbf736={..._0x3ad55c,'winnerScore':_0xf5d9b0,'winnerSuicides':_0x1f3ee0,'winnerComment':_0x4e5ffc,'winnerDemoLink':_0x4222dc,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':auth[_0x42d025(0x124)][_0x42d025(0x118)]};await setDoc(doc(db,_0x42d025(0x13a),_0x7a684c),_0xfbf736),await deleteDoc(_0x2c4c2d),console[_0x42d025(0x131)](_0x42d025(0x13e));const [_0x5d64ae,_0x3312c6]=await Promise[_0x42d025(0x127)]([getDocs(query(collection(db,'players'),where(_0x42d025(0x138),'==',_0x3ad55c[_0x42d025(0x12c)]))),getDocs(query(collection(db,'players'),where(_0x42d025(0x138),'==',_0x3ad55c[_0x42d025(0x119)])))]);if(_0x5d64ae[_0x42d025(0x113)]||_0x3312c6['empty'])throw new Error(_0x42d025(0x121));const _0x19a9e=_0x5d64ae['docs'][0x0]['id'],_0x259d68=_0x3312c6[_0x42d025(0x156)][0x0]['id'];return await updateEloRatings(_0x19a9e,_0x259d68,_0x7a684c),console['log']('Match\x20successfully\x20approved\x20and\x20ELO\x20updated'),!![];}catch(_0x11b8f1){console[_0x42d025(0x144)](_0x42d025(0x123),_0x11b8f1);throw _0x11b8f1;}}async function updatePlayerElo(_0x2a8ba8,_0x508501,_0x36968a){await setDoc(doc(db,'players',_0x2a8ba8),{...playerData,'eloRating':_0x36968a}),await checkAndRecordPromotion(_0x2a8ba8,_0x36968a,_0x508501);}async function updatePlayerStats(_0x15e5b9,_0x3b9ded,_0x30f4ad){const _0x1886ba=a30_0x1d1a,_0x76efc0=doc(db,_0x1886ba(0x136),_0x15e5b9),_0x3c5707=await getDoc(_0x76efc0);let _0x5c367e=_0x3c5707[_0x1886ba(0x152)]()?_0x3c5707[_0x1886ba(0x11c)]():{'wins':0x0,'losses':0x0,'totalKills':0x0,'totalDeaths':0x0,'winRate':0x0};_0x30f4ad?(_0x5c367e['wins']++,_0x5c367e[_0x1886ba(0x11d)]+=parseInt(_0x3b9ded[_0x1886ba(0x115)]||0x0),_0x5c367e['totalDeaths']+=parseInt(_0x3b9ded['loserScore']||0x0)):(_0x5c367e[_0x1886ba(0x147)]++,_0x5c367e[_0x1886ba(0x11d)]+=parseInt(_0x3b9ded[_0x1886ba(0x112)]||0x0),_0x5c367e[_0x1886ba(0x12e)]+=parseInt(_0x3b9ded['winnerScore']||0x0));const _0x2810e2=_0x5c367e['wins']+_0x5c367e[_0x1886ba(0x147)];_0x5c367e['winRate']=_0x2810e2>0x0?(_0x5c367e['wins']/_0x2810e2*0x64)[_0x1886ba(0x145)](0x1):0x0,_0x5c367e[_0x1886ba(0x14c)]=new Date()[_0x1886ba(0x133)](),await setDoc(_0x76efc0,_0x5c367e,{'merge':!![]});}
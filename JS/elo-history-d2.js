function a14_0x2346(_0x488259,_0x47123c){const _0x1e4eaf=a14_0x2df3();return a14_0x2346=function(_0x24a40d,_0x2f1670){_0x24a40d=_0x24a40d-0x140;let _0x2df306=_0x1e4eaf[_0x24a40d];return _0x2df306;},a14_0x2346(_0x488259,_0x47123c);}const a14_0x24a40d=(function(){let _0x4ba97e=!![];return function(_0x30e851,_0x5c90dd){const _0xd7abe5=_0x4ba97e?function(){if(_0x5c90dd){const _0x57b75e=_0x5c90dd['apply'](_0x30e851,arguments);return _0x5c90dd=null,_0x57b75e;}}:function(){};return _0x4ba97e=![],_0xd7abe5;};}()),a14_0x1e4eaf=a14_0x24a40d(this,function(){const _0x23bf6b=a14_0x2346;let _0x4f9e3a;try{const _0x363d3f=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x4f9e3a=_0x363d3f();}catch(_0x5adc16){_0x4f9e3a=window;}const _0x25dbdc=_0x4f9e3a[_0x23bf6b(0x143)]=_0x4f9e3a['console']||{},_0x8ec22f=['log',_0x23bf6b(0x14a),_0x23bf6b(0x14b),'error','exception','table',_0x23bf6b(0x140)];for(let _0x560805=0x0;_0x560805<_0x8ec22f[_0x23bf6b(0x14f)];_0x560805++){const _0x4f99fc=a14_0x24a40d['constructor']['prototype'][_0x23bf6b(0x14e)](a14_0x24a40d),_0x27d4c4=_0x8ec22f[_0x560805],_0x3f7a61=_0x25dbdc[_0x27d4c4]||_0x4f99fc;_0x4f99fc['__proto__']=a14_0x24a40d['bind'](a14_0x24a40d),_0x4f99fc[_0x23bf6b(0x14d)]=_0x3f7a61['toString']['bind'](_0x3f7a61),_0x25dbdc[_0x27d4c4]=_0x4f99fc;}});a14_0x1e4eaf();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D2=[{'name':'Gold','elo':0x708},{'name':'Silver','elo':0x640},{'name':'Bronze','elo':0x578},{'name':'Unranked','elo':0x4b0}];let lastVisibleD2=null;async function getUsernameByIdD2(_0x5d52fe){const _0x2496d9=a14_0x2346;try{if(!_0x5d52fe)return'Unknown\x20Player';const _0x5b219d=await getDoc(doc(db,'playersD2',_0x5d52fe));if(_0x5b219d['exists']())return _0x5b219d['data']()['username']||'Unknown\x20Player';const _0x369de1=await getDocs(query(collection(db,'approvedMatchesD2'),where('winnerId','==',_0x5d52fe),limit(0x1)));if(!_0x369de1['empty'])return _0x369de1['docs'][0x0][_0x2496d9(0x14c)]()['winnerUsername']||_0x2496d9(0x146);const _0xb93ef0=await getDocs(query(collection(db,_0x2496d9(0x144)),where(_0x2496d9(0x150),'==',_0x5d52fe),limit(0x1)));if(!_0xb93ef0[_0x2496d9(0x149)])return _0xb93ef0['docs'][0x0]['data']()['loserUsername']||_0x2496d9(0x146);return'Unknown\x20Player';}catch(_0x2b7d7a){return console[_0x2496d9(0x145)]('Error\x20getting\x20username:',_0x2b7d7a),'Unknown\x20Player';}}export async function recordEloChangeD2({playerId:_0x5bb719,previousElo:_0x2b1ba4,newElo:_0x5352c0,opponentId:_0x56742a,matchResult:_0x36516c,previousPosition:_0x487336,newPosition:_0x11b5ca,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x2d3ad3,timestamp:_0x4456a3}){const _0x18e83e=a14_0x2346;try{const _0x478e6c=doc(collection(db,'eloHistoryD2'));let _0xea1b57='match';if(isPromotion)_0xea1b57=_0x18e83e(0x141);if(isDemotion)_0xea1b57='demotion';let _0x3195dd='Unranked';if(_0x5352c0>=0x834)_0x3195dd='Emerald';else{if(_0x5352c0>=0x708)_0x3195dd=_0x18e83e(0x147);else{if(_0x5352c0>=0x640)_0x3195dd=_0x18e83e(0x151);else{if(_0x5352c0>=0x578)_0x3195dd='Bronze';}}}return await setDoc(_0x478e6c,{'type':_0xea1b57,'player':_0x5bb719,'opponent':_0x56742a,'previousElo':_0x2b1ba4,'newElo':_0x5352c0,'change':_0x5352c0-_0x2b1ba4,'matchResult':_0x36516c,'previousPosition':_0x487336,'newPosition':_0x11b5ca,'rankAchieved':_0x3195dd,'matchId':_0x2d3ad3,'timestamp':_0x4456a3}),console['log']('D2\x20ELO\x20history\x20recorded\x20for\x20'+_0x5bb719),!![];}catch(_0x47ed7f){console[_0x18e83e(0x145)]('Error\x20recording\x20D2\x20ELO\x20history:',_0x47ed7f);throw _0x47ed7f;}}export async function getEloHistoryD2(_0x23ac3f=0x14){const _0x4eba75=a14_0x2346;try{const _0x113705=collection(db,'eloHistoryD2');let _0x26553d;lastVisibleD2?_0x26553d=query(_0x113705,orderBy('timestamp',_0x4eba75(0x142)),startAfter(lastVisibleD2),limit(_0x23ac3f)):_0x26553d=query(_0x113705,orderBy('timestamp','desc'),limit(_0x23ac3f));const _0x2b67f3=await getDocs(_0x26553d);if(_0x2b67f3[_0x4eba75(0x149)])return{'entries':[],'hasMore':![]};lastVisibleD2=_0x2b67f3[_0x4eba75(0x152)][_0x2b67f3['docs']['length']-0x1];const _0x30d6f3=_0x2b67f3['docs']['map'](async _0x52e33d=>{const _0xa5cd1f=_0x52e33d['data'](),[_0x10230d,_0x3bf263]=await Promise['all']([getUsernameByIdD2(_0xa5cd1f['player']),getUsernameByIdD2(_0xa5cd1f['opponent'])]);return{..._0xa5cd1f,'playerUsername':_0x10230d,'opponentUsername':_0x3bf263,'change':_0xa5cd1f['newElo']-_0xa5cd1f['previousElo'],'timestamp':_0xa5cd1f['timestamp']};}),_0xe9159b=await Promise['all'](_0x30d6f3);return{'entries':_0xe9159b,'hasMore':_0x2b67f3[_0x4eba75(0x148)]===_0x23ac3f};}catch(_0x33702f){console['error']('Error\x20fetching\x20D2\x20ELO\x20history:',_0x33702f);throw _0x33702f;}}function a14_0x2df3(){const _0x67eeaf=['trace','promotion','desc','console','approvedMatchesD2','error','Unknown\x20Player','Gold','size','empty','warn','info','data','toString','bind','length','loserId','Silver','docs'];a14_0x2df3=function(){return _0x67eeaf;};return a14_0x2df3();}export function resetPaginationD2(){lastVisibleD2=null;}
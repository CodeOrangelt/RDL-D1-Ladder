const a4_0x53efd7=a4_0x48e1,a4_0xb7ca59=(function(){let _0x99d4b5=!![];return function(_0x3d3740,_0x34b2a9){const _0x593d14=_0x99d4b5?function(){if(_0x34b2a9){const _0x415ac4=_0x34b2a9['apply'](_0x3d3740,arguments);return _0x34b2a9=null,_0x415ac4;}}:function(){};return _0x99d4b5=![],_0x593d14;};}()),a4_0x5bd85a=a4_0xb7ca59(this,function(){const _0x1c6d88=a4_0x48e1,_0x2f4898=function(){let _0xf87951;try{_0xf87951=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x1ebc70){_0xf87951=window;}return _0xf87951;},_0x2853e8=_0x2f4898(),_0x3319c3=_0x2853e8['console']=_0x2853e8['console']||{},_0xe982ed=['log',_0x1c6d88(0x8f),_0x1c6d88(0x8e),'error','exception',_0x1c6d88(0xaa),'trace'];for(let _0x48ea8e=0x0;_0x48ea8e<_0xe982ed['length'];_0x48ea8e++){const _0x2d3b8e=a4_0xb7ca59['constructor']['prototype']['bind'](a4_0xb7ca59),_0x5a9568=_0xe982ed[_0x48ea8e],_0x1e6ba2=_0x3319c3[_0x5a9568]||_0x2d3b8e;_0x2d3b8e[_0x1c6d88(0xee)]=a4_0xb7ca59[_0x1c6d88(0x119)](a4_0xb7ca59),_0x2d3b8e['toString']=_0x1e6ba2['toString']['bind'](_0x1e6ba2),_0x3319c3[_0x5a9568]=_0x2d3b8e;}});a4_0x5bd85a();import{collection,getDocs,addDoc,query,orderBy,limit,startAfter,Timestamp,serverTimestamp,getDoc,doc,where,deleteDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const mutedUsers=[{'username':'Daz','muteFromDate':new Date('2025-07-02')[a4_0x53efd7(0xa3)]()}];function isUsernameMuted(_0x56b672,_0x4049ff){const _0x543351=a4_0x53efd7;if(!_0x56b672)return![];const _0xb904f2=mutedUsers['find'](_0x49e5fb=>_0x49e5fb['username']===_0x56b672);if(!_0xb904f2)return![];if(!_0x4049ff)return!![];const _0x48cc54=_0x4049ff instanceof Date?_0x4049ff[_0x543351(0xa3)]():_0x4049ff['seconds']?_0x4049ff['seconds']*0x3e8:Date['now']();return _0x48cc54>=_0xb904f2['muteFromDate'];}function filterComment(_0x22a9b3,_0x33ea5b,_0xe44a){if(!_0x22a9b3)return'-';if(isUsernameMuted(_0x33ea5b,_0xe44a))return'Muted.';return _0x22a9b3;}const previewState={'currentMode':'D1','currentPage':0x1,'matchesPerPage':0x5,'lastVisible':null,'firstVisible':null,'isLoading':![],'filterUsername':'','enhancedFilters':{'pilots':'','levels':'','subgames':[]},'totalPages':0x1,'hasReachedEnd':![]};function getCacheKey(_0x37af29,_0x572e60,_0x42a0a0){const _0x4f763d='u:'+(_0x42a0a0['filterUsername']||'');return'previewCache_'+_0x37af29+'_p'+_0x572e60+'_'+_0x4f763d;}function getCachedPage(_0x527df2){const _0x1dcdfa=a4_0x53efd7,_0x1d2bf6=sessionStorage[_0x1dcdfa(0x103)](_0x527df2);if(_0x1d2bf6)try{return JSON[_0x1dcdfa(0xca)](_0x1d2bf6);}catch(_0x225e69){return console['error']('Failed\x20to\x20parse\x20cache:',_0x225e69),sessionStorage['removeItem'](_0x527df2),null;}return null;}function cachePage(_0x272c27,_0x56a3de){try{sessionStorage['setItem'](_0x272c27,JSON['stringify'](_0x56a3de));}catch(_0x46de6b){console['error']('Failed\x20to\x20cache\x20data:',_0x46de6b);}}function a4_0x48e1(_0x153be3,_0x368156){const _0x5bd85a=a4_0x50fc();return a4_0x48e1=function(_0xb7ca59,_0x4afe7f){_0xb7ca59=_0xb7ca59-0x70;let _0x50fc80=_0x5bd85a[_0xb7ca59];return _0x50fc80;},a4_0x48e1(_0x153be3,_0x368156);}function getEloColor(_0x535fe2){const _0x5b6ed1=a4_0x53efd7,_0x204d6f=Number(_0x535fe2);if(_0x204d6f>=0x7d0)return'#50C878';else{if(_0x204d6f>=0x708)return _0x5b6ed1(0xce);else{if(_0x204d6f>=0x640)return _0x5b6ed1(0x105);else{if(_0x204d6f>=0x578)return'#CD7F32';else return'#808080';}}}}function formatDate(_0x4b1b61,_0xcdf710=![]){const _0xa65828=a4_0x53efd7;if(!_0x4b1b61||!_0x4b1b61['seconds'])return _0xa65828(0x10f);const _0xdead8c=new Date(_0x4b1b61['seconds']*0x3e8);return _0xcdf710?_0xdead8c['toLocaleString']():_0xdead8c[_0xa65828(0xa4)]();}function truncateComment(_0x59e58e,_0xc482ad=0x1e){const _0x522458=a4_0x53efd7;if(!_0x59e58e)return'-';if(_0x59e58e['length']<=_0xc482ad)return _0x59e58e;return _0x59e58e[_0x522458(0xba)](0x0,_0xc482ad)+_0x522458(0xab);}function formatCommentDate(_0x29d59a){const _0x376200=a4_0x53efd7;if(!_0x29d59a||!_0x29d59a['seconds'])return'';const _0xff6bd0=new Date(_0x29d59a['seconds']*0x3e8),_0x44dec2=new Date(),_0x5423f7=Math['abs'](_0x44dec2-_0xff6bd0),_0x5402ab=Math[_0x376200(0x116)](_0x5423f7/(0x3e8*0x3c*0x3c*0x18));if(_0x5402ab===0x0)return _0x376200(0xb0);else{if(_0x5402ab===0x1)return _0x376200(0x91);else return _0x5402ab<0x7?_0x5402ab+'\x20days\x20ago':_0xff6bd0['toLocaleDateString']();}}function setLoadingIndicator(_0x3fefa1){const _0x160402=a4_0x53efd7,_0xcfc690=document[_0x160402(0xaf)]('loading-indicator');if(_0xcfc690)_0xcfc690['style']['display']=_0x3fefa1?'block':'none';}export function updatePreviewLadderModeUI(){const _0x5cb12a=a4_0x53efd7,_0x37e5dd=document[_0x5cb12a(0xaf)]('preview-ladder-mode'),_0x40b131=document['getElementById']('preview-d1-button'),_0xa22f58=document['getElementById']('preview-d2-button'),_0x53f66f=document[_0x5cb12a(0xaf)]('preview-d3-button');if(_0x37e5dd)_0x37e5dd['textContent']=previewState[_0x5cb12a(0x114)];if(_0x40b131)_0x40b131['classList']['toggle']('active',previewState['currentMode']==='D1');if(_0xa22f58)_0xa22f58['classList']['toggle']('active',previewState['currentMode']==='D2');if(_0x53f66f)_0x53f66f['classList'][_0x5cb12a(0x9f)]('active',previewState[_0x5cb12a(0x114)]==='D3');}function updatePreviewPaginationControls(_0xd38823){const _0x545b36=a4_0x53efd7,_0x456b97=document['getElementById']('previewPrevPage'),_0x16849f=document['getElementById'](_0x545b36(0x7a)),_0x1c3163=document[_0x545b36(0xaf)](_0x545b36(0xcd));if(!_0x456b97||!_0x16849f||!_0x1c3163)return;_0x1c3163[_0x545b36(0xd0)]=_0x545b36(0x8a)+previewState['currentPage'],_0x456b97['disabled']=previewState['currentPage']<=0x1,_0x16849f['disabled']=!_0xd38823;}function setPreviewLoadingState(_0x57aba7){const _0x48c3e3=a4_0x53efd7;previewState['isLoading']=_0x57aba7,setLoadingIndicator(_0x57aba7);const _0xd8a8c6=document[_0x48c3e3(0xaf)]('recent-matches-preview'),_0x28c432=_0xd8a8c6?_0xd8a8c6['querySelector'](_0x48c3e3(0x9c)):null,_0x5673d5=document[_0x48c3e3(0xaf)]('previewPrevPage'),_0x9a82ca=document[_0x48c3e3(0xaf)](_0x48c3e3(0x7a)),_0xf303d3=document['getElementById']('preview-d1-button'),_0x1896aa=document['getElementById']('preview-d2-button'),_0x194aad=document[_0x48c3e3(0xaf)]('applyFilterBtn'),_0x5f2361=document['getElementById']('clearFilterBtn');if(_0x28c432&&!_0x57aba7)_0x28c432[_0x48c3e3(0x102)]['display']='none';else _0x28c432&&_0x57aba7&&(_0x28c432['style']['display']='block');!_0x57aba7&&_0xd8a8c6&&!_0xd8a8c6['querySelector']('.match-card')&&!_0xd8a8c6[_0x48c3e3(0xf5)](_0x48c3e3(0x104))&&(_0xd8a8c6['innerHTML']=_0x48c3e3(0xcc)+(previewState[_0x48c3e3(0xe6)]?_0x48c3e3(0xf1):'')+_0x48c3e3(0x73));if(_0x5673d5)_0x5673d5['disabled']=_0x57aba7||previewState['currentPage']<=0x1;if(_0x9a82ca)_0x9a82ca['disabled']=_0x57aba7;if(_0xf303d3)_0xf303d3[_0x48c3e3(0x7e)]=_0x57aba7;if(_0x1896aa)_0x1896aa['disabled']=_0x57aba7;if(_0x194aad)_0x194aad[_0x48c3e3(0x7e)]=_0x57aba7;if(_0x5f2361)_0x5f2361['disabled']=_0x57aba7;}function applyClientFilters(_0x40a885){const _0x1d9792=a4_0x53efd7;if(!previewState['filterUsername'])return _0x40a885;const _0x3335e6=previewState[_0x1d9792(0xe6)]['toLowerCase']();return _0x40a885['filter'](_0x5ad18a=>{const _0x558825=(_0x5ad18a['winnerUsername']||'')['toLowerCase'](),_0x3a2db2=(_0x5ad18a['loserUsername']||'')['toLowerCase']();return _0x558825['includes'](_0x3335e6)||_0x3a2db2['includes'](_0x3335e6);});}function applyEnhancedClientFilters(_0x1fdaa3){if(!hasEnhancedFilters())return _0x1fdaa3;return _0x1fdaa3['filter'](_0x44b987=>{const _0x2ac324=a4_0x48e1;if(previewState['enhancedFilters']['pilots']){const _0x336996=previewState['enhancedFilters'][_0x2ac324(0x83)][_0x2ac324(0x92)](),_0x37e89c=(_0x44b987['winnerUsername']||'')['toLowerCase'](),_0x558bb0=(_0x44b987[_0x2ac324(0xb3)]||'')['toLowerCase']();if(!_0x37e89c['includes'](_0x336996)&&!_0x558bb0['includes'](_0x336996))return![];}if(previewState['enhancedFilters'][_0x2ac324(0x117)]){const _0x2bd158=previewState['enhancedFilters'][_0x2ac324(0x117)]['toLowerCase'](),_0x2ffbed=(_0x44b987[_0x2ac324(0x7c)]||'')[_0x2ac324(0x92)]();if(!_0x2ffbed[_0x2ac324(0xfe)](_0x2bd158))return![];}if(previewState['enhancedFilters']['subgames']['length']>0x0){const _0x4f56ef=_0x44b987['subgameType']||_0x2ac324(0xc6);if(!previewState[_0x2ac324(0x80)]['subgames'][_0x2ac324(0xfe)](_0x4f56ef))return![];}return!![];});}function hasEnhancedFilters(){const _0x2b013d=a4_0x53efd7;return previewState[_0x2b013d(0x80)]['pilots']||previewState['enhancedFilters']['levels']||previewState['enhancedFilters']['subgames']['length']>0x0;}function a4_0x50fc(){const _0x4f6fce=['commentOverlayPreview','username','<strong>','.</div>','filter','none','gauss-and-mercs','loserOldElo','Unable\x20to\x20submit\x20comment\x20-\x20system\x20not\x20ready','from','previewNextPage','button','mapPlayed','className','disabled','color','enhancedFilters','<button\x20class=\x22delete-comment-btn\x22\x20aria-label=\x22Delete\x20comment\x22>×</button>','add','pilots','closeAddCommentPopup','filter-subgames','length','block','createElement','winner-','Page\x20','blind-match','commentAddOverlay','recent-matches-preview','info','warn','isLoading','Yesterday','toLowerCase','.winner-demo-link','displayName','commentUser','Please\x20enter\x20a\x20demo\x20link','value','current','exists','.player.loser\x20.player-score','closest','.matches-loading','cursor','winnerComment','toggle','error','Match\x20','#fff','getTime','toLocaleDateString','currentPage','trim','stopPropagation','createdAt','.comment.winner-comment','table','...','aria-label','demoLink','parentNode','getElementById','Today','insertBefore','commentPopupTitlePreview','loserUsername','Unknown\x20User','winnerOldElo','classList','Loading\x20next\x20page\x20using\x20cursor','uid','.player.winner\x20.player-suicides','substring','showAddCommentPopup','map','removeItem','submit','body','dataset','mega-match','Error\x20deleting\x20comment:','lastVisible','Preview\x20UI\x20or\x20Filter\x20elements\x20not\x20found,\x20cannot\x20attach\x20listeners.','auth','Standard\x20Match','next','default','popup-actions','parse','appendChild','<div\x20class=\x22matches-loading\x22>No\x20recent\x20matches\x20found','previewPageInfo','#FFD700','matchComments','textContent','commentText','flex','.player.loser\x20.player-name','userProfiles','onclick','apply-enhanced-filters','fusion-match','disorientation','data','display','</p><small\x20style=\x22color:#aaa;\x20display:block;\x20text-align:right;\x20margin-top:10px;\x22>Posted\x20on\x20','delete-comment-btn','backgroundColor','Comments\x20are\x20limited\x20to\x2015\x20words\x20maximum.\x20Please\x20shorten\x20your\x20comment.','gold','demo-link','text','.popup-actions','.loser-demo-link','winnerUsername','commentAddPopup','filterUsername','push','.option-tab.active','rematch','addEventListener','Loading\x20first\x20page\x20from\x20Firestore','filter-pilots','loserScore','__proto__','Muted.','Error\x20submitting\x20comment:','\x20matching\x20filters','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22option-tabs\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20type=\x22button\x22\x20class=\x22option-tab\x20active\x22\x20data-option=\x22comment\x22>Add\x20Comment</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22option-divider\x22>OR</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20type=\x22button\x22\x20class=\x22option-tab\x22\x20data-option=\x22demo\x22>Share\x20Demo\x20Link</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22option-content\x22\x20id=\x22commentOption\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22commentText\x22>Your\x20comment\x20(15\x20words\x20max):</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22commentText\x22\x20name=\x22commentText\x22\x20rows=\x223\x22\x20placeholder=\x22Share\x20your\x20thoughts...\x22></textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22word-counter\x22><span\x20id=\x22wordCount\x22>0</span>/15\x20words</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22option-content\x22\x20id=\x22demoOption\x22\x20style=\x22display:\x20none;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22demoLink\x22>Demo\x20Link:</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22url\x22\x20id=\x22demoLink\x22\x20name=\x22demoLink\x22\x20placeholder=\x22https://...\x22\x20required>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22demoDescription\x22>Description\x20(20\x20words\x20max):</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22demoDescription\x22\x20name=\x22demoDescription\x22\x20rows=\x222\x22\x20placeholder=\x22Describe\x20your\x20demo...\x22></textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22word-counter\x22><span\x20id=\x22demoWordCount\x22>0</span>/20\x20words</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20type=\x22submit\x22\x20class=\x22submit-comment-btn\x22>Submit</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</form>\x0a\x20\x20\x20\x20','log',':</strong>\x20\x22','querySelector','title','firstChild','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','Anonymous','.match-date','previewPrevPage','jump-to-page','Unknown','includes','click','0.6','subgameType','style','getItem','.matches-loading[style*=\x22color:\x20red\x22]','#b9f1fc','currentUser','.comment.loser-comment','firstVisible','toLocaleString','bronze','\x20demo\x20links:','desc','type','matchesPerPage','N/A','content','.add-comment-btn','innerHTML','Please\x20enter\x20a\x20valid\x20URL\x20for\x20the\x20demo\x20link','currentMode','opacity','floor','levels','option','bind','winnerSuicides','forEach','commentMatchId','You\x20must\x20be\x20signed\x20in\x20to\x20leave\x20a\x20comment','\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3>Add\x20Comment\x20or\x20Demo</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22closeAddCommentPopup\x22\x20class=\x22close-btn\x22>&times;</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<form\x20id=\x22addCommentForm\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22hidden\x22\x20id=\x22commentMatchId\x22\x20name=\x22commentMatchId\x22\x20value=\x22','timestamp','max','Comment\x20from\x20'];a4_0x50fc=function(){return _0x4f6fce;};return a4_0x50fc();}function clearEnhancedFilters(){const _0x3ae61f=a4_0x53efd7;previewState['enhancedFilters']={'pilots':'','levels':'','subgames':[]},document['getElementById']('filter-pilots')['value']='',document['getElementById']('filter-levels')['value']='';const _0x13a6b5=document['getElementById'](_0x3ae61f(0x85));for(let _0x19e7f6 of _0x13a6b5['options']){_0x19e7f6['selected']=![];}}function jumpToPage(_0x38065a){const _0x58cf2f=a4_0x53efd7,_0x491258=document['getElementById'](_0x58cf2f(0xfc)),_0x343b57=previewState[_0x58cf2f(0xa5)];let _0x39fa99=_0x343b57;switch(_0x38065a){case'start':_0x39fa99=0x1;break;case'end':_0x39fa99=Math['max'](_0x343b57+0xa,previewState['totalPages']||_0x343b57+0xa);break;case'+1':_0x39fa99=_0x343b57+0x1;break;case'+5':_0x39fa99=_0x343b57+0x5;break;case'+10':_0x39fa99=_0x343b57+0xa;break;case'-1':_0x39fa99=Math['max'](0x1,_0x343b57-0x1);break;case'-5':_0x39fa99=Math['max'](0x1,_0x343b57-0x5);break;case'-10':_0x39fa99=Math[_0x58cf2f(0x120)](0x1,_0x343b57-0xa);break;case'input':const _0x37bc3c=parseInt(_0x491258['value']);_0x37bc3c&&_0x37bc3c>0x0&&(_0x39fa99=_0x37bc3c,_0x491258[_0x58cf2f(0x97)]='');break;}_0x39fa99!==_0x343b57&&_0x39fa99>0x0&&(previewState['currentPage']=_0x39fa99,loadRecentMatchesPreview('jump'));}export async function loadRecentMatchesPreview(_0x347fe7='current'){const _0x11863f=a4_0x53efd7,_0x3af683=document['getElementById']('recent-matches-preview'),_0x2df9a4=document['getElementById']('match-card-template');if(previewState[_0x11863f(0x90)]||!_0x3af683||!_0x2df9a4)return;_0x347fe7==='current'&&(console['log']('Clearing\x20cache\x20for\x20refresh/reset'),Object['keys'](sessionStorage)[_0x11863f(0x11b)](_0x1194dc=>{const _0x561708=_0x11863f;_0x1194dc[_0x561708(0xfe)]('previewCache_'+previewState[_0x561708(0x114)])&&sessionStorage[_0x561708(0xbd)](_0x1194dc);}));let _0x20ca1b=previewState['currentPage'];if(_0x347fe7==='next')_0x20ca1b++;else{if(_0x347fe7==='prev')_0x20ca1b--;else _0x347fe7==='current'&&(_0x20ca1b=0x1,previewState['firstVisible']=null,previewState['lastVisible']=null);}if(_0x20ca1b<0x1)_0x20ca1b=0x1;const _0xc5d616=previewState[_0x11863f(0xa5)];previewState['currentPage']=_0x20ca1b,updatePreviewPaginationControls(!![]);const _0x3de67f={'filterUsername':previewState[_0x11863f(0xe6)]},_0x21c2f1=getCacheKey(previewState[_0x11863f(0x114)],_0x20ca1b,_0x3de67f),_0x41739b=_0x347fe7!=='current'?getCachedPage(_0x21c2f1):null;if(_0x41739b){console['log']('Rendering\x20page\x20'+_0x20ca1b+'\x20from\x20cache'),setPreviewLoadingState(!![]),renderMatchCards(_0x41739b['docsData']),updatePreviewPaginationControls(_0x41739b['hasNextPage']),setPreviewLoadingState(![]);return;}console['log']('Cache\x20miss\x20for\x20page\x20'+_0x20ca1b+',\x20fetching\x20from\x20Firestore'),setPreviewLoadingState(!![]),_0x3af683['innerHTML']='<div\x20class=\x22matches-loading\x22>Loading\x20recent\x20matches...</div>';const _0x5b5c12=previewState['currentMode']==='D1'?'approvedMatches':previewState['currentMode']==='D2'?'approvedMatchesD2':'approvedMatchesD3',_0x4c297e=previewState[_0x11863f(0x114)]==='D1'?'createdAt':'approvedAt';try{const _0x240d99=collection(window['db'],_0x5b5c12);let _0x519bc4=[orderBy(_0x4c297e,'desc')];if(_0x20ca1b===0x1)console['log'](_0x11863f(0xeb)),_0x519bc4[_0x11863f(0xe7)](limit(previewState['matchesPerPage']));else{if(_0x347fe7==='next'&&previewState[_0x11863f(0xc3)])console['log'](_0x11863f(0xb7)),_0x519bc4[_0x11863f(0xe7)](startAfter(previewState['lastVisible'])),_0x519bc4['push'](limit(previewState['matchesPerPage']));else{console[_0x11863f(0xf3)]('No\x20valid\x20cursor,\x20fetching\x20from\x20beginning\x20and\x20skipping\x20pages');const _0x18e55c=_0x20ca1b*previewState[_0x11863f(0x10e)];_0x519bc4['push'](limit(_0x18e55c));}}const _0x1d58ac=query(_0x240d99,..._0x519bc4),_0x221235=await getDocs(_0x1d58ac);let _0x2e131b=_0x221235['docs'];if(_0x20ca1b>0x1&&_0x347fe7!==_0x11863f(0xc7)){const _0x1c2144=(_0x20ca1b-0x1)*previewState['matchesPerPage'];_0x2e131b=_0x2e131b['slice'](_0x1c2144,_0x1c2144+previewState[_0x11863f(0x10e)]);}if(_0x2e131b['length']===0x0){console['log']('No\x20results\x20found\x20for\x20this\x20page');_0x347fe7==='next'&&(previewState['currentPage']=_0xc5d616,updatePreviewPaginationControls(![]));_0x3af683['innerHTML']='<div\x20class=\x22matches-loading\x22>No\x20more\x20matches\x20to\x20display'+(previewState[_0x11863f(0xe6)]?'\x20matching\x20filters':'')+'.</div>',setPreviewLoadingState(![]);return;}previewState[_0x11863f(0x108)]=_0x2e131b[0x0],previewState['lastVisible']=_0x2e131b[_0x2e131b['length']-0x1];const _0x52548c=_0x2e131b['map'](_0x564852=>({'id':_0x564852['id'],..._0x564852[_0x11863f(0xd9)]()}));let _0x3aab69=![];if(_0x2e131b[_0x11863f(0x86)]===previewState['matchesPerPage']){const _0x544637=query(_0x240d99,orderBy(_0x4c297e,_0x11863f(0x10c)),startAfter(previewState['lastVisible']),limit(0x1)),_0x2ecabb=await getDocs(_0x544637);_0x3aab69=!_0x2ecabb['empty'];}const _0x50f1bc=applyClientFilters(_0x52548c),_0x540885={'docsData':_0x52548c,'hasNextPage':_0x3aab69};cachePage(getCacheKey(previewState['currentMode'],previewState[_0x11863f(0xa5)],_0x3de67f),_0x540885);if(_0x20ca1b>0x1&&_0x347fe7!=='next')for(let _0x7bccfe=0x1;_0x7bccfe<_0x20ca1b;_0x7bccfe++){const _0x342227=(_0x7bccfe-0x1)*previewState['matchesPerPage'],_0xbfcad5=_0x342227+previewState[_0x11863f(0x10e)],_0x442c56=_0x221235['docs']['slice'](_0x342227,_0xbfcad5);if(_0x442c56[_0x11863f(0x86)]>0x0){const _0x916d0=_0x442c56['map'](_0xa459cc=>({'id':_0xa459cc['id'],..._0xa459cc['data']()})),_0xebfc07=!![];cachePage(getCacheKey(previewState['currentMode'],_0x7bccfe,_0x3de67f),{'docsData':_0x916d0,'hasNextPage':_0xebfc07}),console['log']('Cached\x20intermediary\x20page\x20'+_0x7bccfe);}}_0x50f1bc['length']===0x0&&previewState[_0x11863f(0xe6)]?_0x3af683['innerHTML']='<div\x20class=\x22matches-loading\x22>No\x20matches\x20found\x20matching\x20filter:\x20\x22'+previewState[_0x11863f(0xe6)]+'\x22</div>':renderMatchCards(_0x50f1bc),updatePreviewPaginationControls(_0x3aab69);}catch(_0x36069e){console[_0x11863f(0xa0)]('Error\x20fetching\x20'+previewState['currentMode']+'\x20matches:',_0x36069e),_0x3af683[_0x11863f(0x112)]='<div\x20class=\x22matches-loading\x22\x20style=\x22color:\x20red;\x22>Error\x20loading\x20matches:\x20'+_0x36069e['message']+'</div>',updatePreviewPaginationControls(![]),previewState['currentPage']=_0xc5d616;}finally{setPreviewLoadingState(![]);}}async function renderMatchCards(_0x2d5fd2){const _0x4653f2=a4_0x53efd7,_0x465d53=document['getElementById'](_0x4653f2(0x8d)),_0x180df2=document[_0x4653f2(0xaf)]('match-card-template');if(!_0x465d53||!_0x180df2)return;!_0x465d53['querySelector']('.matches-loading[style*=\x22color:\x20red\x22]')&&(_0x465d53['innerHTML']='');if(!_0x2d5fd2||_0x2d5fd2['length']===0x0){if(!_0x465d53['querySelector']('.matches-loading[style*=\x22color:\x20red\x22]')){const _0x1b034c=hasEnhancedFilters()?'\x20matching\x20filters':previewState[_0x4653f2(0xe6)]?'\x20matching\x20filters':'';_0x465d53[_0x4653f2(0x112)]='<div\x20class=\x22matches-loading\x22>No\x20recent\x20matches\x20found'+_0x1b034c+'.</div>';}return;}const _0x34f7ca=applyEnhancedClientFilters(_0x2d5fd2);if(_0x34f7ca['length']===0x0){_0x465d53['innerHTML']='<div\x20class=\x22matches-loading\x22>No\x20matches\x20found\x20matching\x20current\x20filters.</div>';return;}const _0x62515d=_0x34f7ca[_0x4653f2(0xbc)](_0x225937=>getAllCommentsForMatch(_0x225937['id']));let _0xc03eff=[];try{_0xc03eff=await Promise['all'](_0x62515d);}catch(_0x2c2925){console['error']('Error\x20fetching\x20comments\x20batch:',_0x2c2925),_0xc03eff=_0x34f7ca['map'](()=>[]);}const _0x2e6846={};_0xc03eff[_0x4653f2(0x11b)]((_0x4642b5,_0x5456e0)=>{_0x2e6846[_0x34f7ca[_0x5456e0]['id']]=_0x4642b5||[];}),_0x34f7ca[_0x4653f2(0x11b)](_0x488b04=>{const _0x43e2bc=_0x4653f2,_0x3917b3=_0x180df2[_0x43e2bc(0x110)]['cloneNode'](!![]),_0x1fa0dc=_0x3917b3['querySelector']('.match-display-wrapper'),_0x26e626=_0x3917b3['querySelector']('.match-card'),_0x2af8bd=getEloRankClass(_0x488b04[_0x43e2bc(0xb5)]);_0x26e626[_0x43e2bc(0xb6)][_0x43e2bc(0x82)](_0x43e2bc(0x89)+_0x2af8bd),_0x26e626['querySelector']('.match-map')[_0x43e2bc(0xd0)]=_0x488b04['mapPlayed']||'Unknown\x20Map',_0x26e626[_0x43e2bc(0xf5)](_0x43e2bc(0xfa))['textContent']=formatDate(_0x488b04['approvedAt']||_0x488b04[_0x43e2bc(0xa8)]);const _0x32689d=_0x26e626[_0x43e2bc(0xf5)]('.player.winner\x20.player-name');_0x32689d[_0x43e2bc(0xd0)]=_0x488b04[_0x43e2bc(0xe4)]||'Unknown',_0x32689d[_0x43e2bc(0x102)]['color']=getEloColor(_0x488b04['winnerOldElo']),_0x26e626['querySelector']('.player.winner\x20.player-score')['textContent']=_0x488b04['winnerScore']??0x0;const _0x46c730=_0x26e626['querySelector'](_0x43e2bc(0xb9)),_0x44fc9d=_0x488b04[_0x43e2bc(0x11a)]||0x0;_0x46c730['textContent']='S:\x20'+_0x44fc9d;const _0x246f4e=_0x26e626['querySelector'](_0x43e2bc(0xd3));_0x246f4e['textContent']=_0x488b04['loserUsername']||_0x43e2bc(0xfd),_0x246f4e['style']['color']=getEloColor(_0x488b04[_0x43e2bc(0x77)]),_0x26e626['querySelector'](_0x43e2bc(0x9a))['textContent']=_0x488b04[_0x43e2bc(0xed)]??0x0;const _0x48fe52=_0x26e626['querySelector']('.player.loser\x20.player-suicides'),_0x98ca95=_0x488b04['loserSuicides']||0x0;_0x48fe52['textContent']='S:\x20'+_0x98ca95;const _0x17843a=_0x26e626['querySelector']('.match-subgame');if(_0x17843a){if(_0x488b04[_0x43e2bc(0x101)]&&_0x488b04['subgameType']['trim']()!==''){_0x17843a['textContent']=_0x488b04[_0x43e2bc(0x101)],_0x17843a['style']['display']='block';const _0x576641=getSubgameClass(_0x488b04['subgameType']);_0x576641&&_0x17843a['classList']['add'](_0x576641);}else _0x17843a['textContent']='Standard\x20Match',_0x17843a[_0x43e2bc(0x102)]['display']='block',_0x17843a[_0x43e2bc(0x102)][_0x43e2bc(0x115)]=_0x43e2bc(0x100);}const _0x5ba184=_0x26e626['querySelector'](_0x43e2bc(0xa9)),_0x3810d3=_0x26e626[_0x43e2bc(0xf5)](_0x43e2bc(0x107)),_0x40765c=_0x488b04[_0x43e2bc(0x9e)]||'',_0x1fa89d=_0x488b04['loserComment']||'',_0x9c9b4a=_0x488b04['approvedAt']||_0x488b04['createdAt'],_0x173e6a=filterComment(_0x40765c,_0x488b04['winnerUsername'],_0x9c9b4a),_0x46867a=filterComment(_0x1fa89d,_0x488b04['loserUsername'],_0x9c9b4a);_0x5ba184[_0x43e2bc(0xd0)]='\x22'+truncateComment(_0x40765c)+'\x22',_0x3810d3['textContent']='\x22'+truncateComment(_0x1fa89d)+'\x22';_0x40765c&&!isUsernameMuted(_0x488b04[_0x43e2bc(0xe4)],_0x9c9b4a)?_0x5ba184['onclick']=()=>showPreviewCommentPopup(_0x173e6a,_0x488b04[_0x43e2bc(0xe4)]||'Winner',getEloColor(_0x488b04['winnerOldElo'])):(_0x5ba184['textContent']=_0x173e6a==='Muted.'?_0x43e2bc(0xef):'-',_0x5ba184['style'][_0x43e2bc(0x9d)]=_0x43e2bc(0xc8),_0x5ba184['onclick']=null);_0x1fa89d&&!isUsernameMuted(_0x488b04[_0x43e2bc(0xb3)])?_0x3810d3['onclick']=()=>showPreviewCommentPopup(_0x46867a,_0x488b04['loserUsername']||'Loser',getEloColor(_0x488b04['loserOldElo'])):(_0x3810d3['textContent']=_0x46867a==='Muted.'?'Muted.':'-',_0x3810d3['style']['cursor']='default',_0x3810d3[_0x43e2bc(0xd5)]=null);const _0x3890fb=_0x1fa0dc?.['querySelector']('.community-comments-section');if(!_0x3890fb)console['warn']('Comments\x20section\x20not\x20found\x20in\x20template');else{const _0x4b6b0b=_0x3890fb['querySelector']('.comments-container'),_0x2ef4f1=_0x4b6b0b?.['querySelector']('.no-comments-message'),_0x4293b5=_0x3890fb[_0x43e2bc(0xf5)](_0x43e2bc(0x111));if(_0x4b6b0b){while(_0x4b6b0b['firstChild']&&_0x4b6b0b['firstChild']!==_0x2ef4f1){_0x4b6b0b['removeChild'](_0x4b6b0b[_0x43e2bc(0xf7)]);}_0x4293b5&&_0x4293b5['addEventListener']('click',()=>{showAddCommentPopup(_0x488b04['id']);});const _0x172bbf=_0x2e6846[_0x488b04['id']]||[];if(_0x172bbf['length']>0x0){if(_0x2ef4f1)_0x2ef4f1['style']['display']='none';const _0x2c58a3=(_0xf897f5,_0x4e22af)=>{const _0x426acf=_0x43e2bc,_0x2b7d51=_0xf897f5['split']('\x20');if(_0x2b7d51[_0x426acf(0x86)]<=_0x4e22af)return _0xf897f5;return _0x2b7d51['slice'](0x0,_0x4e22af)['join']('\x20')+'...';};_0x172bbf['forEach'](_0x39ead9=>{const _0x4b4819=_0x43e2bc,_0x2c8ef1=document['createElement']('div');if(_0x39ead9[_0x4b4819(0x10d)]==='demo'){_0x2c8ef1['className']=_0x4b4819(0xe0),_0x2c8ef1['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22'+_0x39ead9['demoLink']+'\x22\x20target=\x22_blank\x22\x20class=\x22play-icon\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M8,5.14V19.14L19,12.14L8,5.14Z\x22\x20/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22demo-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22demo-author\x22>Demo\x20from\x20'+_0x39ead9['username']+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22demo-description\x22>'+(_0x39ead9['description']||'No\x20description\x20provided')+_0x4b4819(0xf8);const _0x5cf606=window['auth']['currentUser'],_0x50396c=_0x5cf606&&_0x39ead9['userId']===_0x5cf606[_0x4b4819(0xb8)];if(_0x50396c){const _0x8c4d88=document['createElement']('button');_0x8c4d88[_0x4b4819(0x7d)]=_0x4b4819(0xdc),_0x8c4d88[_0x4b4819(0x112)]='×',_0x8c4d88['setAttribute'](_0x4b4819(0xac),'Delete\x20demo'),_0x8c4d88['addEventListener']('click',_0x46b334=>{_0x46b334['preventDefault'](),_0x46b334['stopPropagation'](),deleteComment(_0x39ead9['id'],_0x2c8ef1);}),_0x2c8ef1['appendChild'](_0x8c4d88);}}else{_0x2c8ef1[_0x4b4819(0x7d)]='comment-item';const _0x5151d2=isUsernameMuted(_0x39ead9[_0x4b4819(0x71)],_0x39ead9['timestamp']),_0x4fd518=_0x5151d2?_0x4b4819(0xef):_0x2c58a3(_0x39ead9['text']||'',0xf),_0x51127a=_0x39ead9['username']||'Anonymous',_0x1fecad=window['auth'][_0x4b4819(0x106)],_0x12b437=_0x1fecad&&_0x39ead9['userId']===_0x1fecad['uid'];let _0x3d1a5f='';_0x12b437&&(_0x3d1a5f=_0x4b4819(0x81));_0x2c8ef1['innerHTML']=_0x3d1a5f+_0x4b4819(0x72)+_0x51127a+_0x4b4819(0xf4)+_0x4fd518+'\x22';if(_0x12b437){const _0x11a642=_0x2c8ef1['querySelector']('.delete-comment-btn');_0x11a642&&_0x11a642[_0x4b4819(0xea)]('click',_0x590181=>{const _0x504ebf=_0x4b4819;_0x590181[_0x504ebf(0xa7)](),deleteComment(_0x39ead9['id'],_0x2c8ef1);});}!_0x5151d2?_0x2c8ef1['addEventListener']('click',()=>{showFullCommentLightbox(_0x39ead9);}):_0x2c8ef1['style']['cursor']='default';}_0x4b6b0b[_0x4b4819(0xb1)](_0x2c8ef1,_0x4b6b0b['firstChild']);});}else{if(_0x2ef4f1)_0x2ef4f1['style'][_0x43e2bc(0xda)]=_0x43e2bc(0x87);}}}const _0x545e92=_0x26e626[_0x43e2bc(0xf5)]('.match-demo-links');if(_0x545e92){const _0xecd31d=_0x26e626['querySelector'](_0x43e2bc(0x93)),_0xd0d966=_0x26e626['querySelector'](_0x43e2bc(0xe3)),_0x59374f=_0x488b04['winnerDemoLink']||null,_0x55ecaf=_0x488b04['loserDemoLink']||_0x488b04[_0x43e2bc(0xad)]||null;console['log'](_0x43e2bc(0xa1)+_0x488b04['id']+_0x43e2bc(0x10b),{'winner':_0x59374f,'loser':_0x55ecaf}),_0xecd31d&&(_0x59374f?(_0xecd31d['href']=_0x59374f,_0xecd31d['style'][_0x43e2bc(0xda)]='flex',_0xecd31d[_0x43e2bc(0xf6)]=_0x488b04['winnerUsername']+'\x27s\x20Demo'):_0xecd31d[_0x43e2bc(0x102)]['display']=_0x43e2bc(0x75)),_0xd0d966&&(_0x55ecaf?(_0xd0d966['href']=_0x55ecaf,_0xd0d966['style']['display']='flex',_0xd0d966[_0x43e2bc(0xf6)]=_0x488b04['loserUsername']+'\x27s\x20Demo'):_0xd0d966['style'][_0x43e2bc(0xda)]=_0x43e2bc(0x75)),_0x59374f&&_0xecd31d||_0x55ecaf&&_0xd0d966?_0x545e92['style']['display']=_0x43e2bc(0xd2):_0x545e92['style']['display']=_0x43e2bc(0x75);}_0x465d53['appendChild'](_0x3917b3);});}function getSubgameClass(_0x5eef88){const _0x551481=a4_0x53efd7,_0x1dddac={'Fusion\x20Match':_0x551481(0xd7),'≥6\x20Missiles':'missiles-6plus','≥6\x20missiles':'missiles-6plus','Weapon\x20Imbalance':'weapon-imbalance','Blind\x20Match':_0x551481(0x8b),'Rematch':_0x551481(0xe9),'Disorientation':_0x551481(0xd8),'Ratting':'ratting','Altered\x20Powerups':'altered-powerups','Mega\x20Match':_0x551481(0xc1),'Dogfight':'dogfight','Gauss\x20and\x20Mercs':_0x551481(0x76)};return _0x1dddac[_0x5eef88]||'';}async function deleteComment(_0x514f3c,_0x570e26){const _0x2ecc82=a4_0x53efd7,_0x5ea42b=window['auth'][_0x2ecc82(0x106)];if(!_0x5ea42b){alert('You\x20need\x20to\x20be\x20signed\x20in\x20to\x20delete\x20comments');return;}if(!confirm('Are\x20you\x20sure\x20you\x20want\x20to\x20delete\x20this\x20comment?'))return;try{const _0x31b3f1=doc(window['db'],'matchComments',_0x514f3c),_0x10bb39=await getDoc(_0x31b3f1);if(!_0x10bb39['exists']()){alert('Comment\x20not\x20found.\x20It\x20may\x20have\x20already\x20been\x20deleted.');return;}const _0x30aea3=_0x10bb39['data']();if(_0x30aea3['userId']!==_0x5ea42b[_0x2ecc82(0xb8)]){alert('You\x20can\x20only\x20delete\x20your\x20own\x20comments');return;}await deleteDoc(_0x31b3f1);if(_0x570e26&&_0x570e26['parentNode']){_0x570e26[_0x2ecc82(0xae)]['removeChild'](_0x570e26);const _0x4592b1=_0x570e26[_0x2ecc82(0x9b)]('.comments-container');if(_0x4592b1&&!_0x4592b1['querySelector']('.comment-item')){const _0x210534=_0x4592b1['querySelector']('.no-comments-message');if(_0x210534)_0x210534['style'][_0x2ecc82(0xda)]='block';}}console['log']('Comment\x20deleted\x20successfully');}catch(_0x8908f3){console['error'](_0x2ecc82(0xc2),_0x8908f3),alert('Failed\x20to\x20delete\x20comment:\x20'+_0x8908f3['message']);}}async function getAllCommentsForMatch(_0x2ac663){const _0x277b3b=a4_0x53efd7;if(!_0x2ac663)return[];try{const _0x433b34=collection(window['db'],'matchComments'),_0x58639b=query(_0x433b34,where('matchId','==',_0x2ac663),orderBy('timestamp',_0x277b3b(0x10c))),_0x329e70=await getDocs(_0x58639b);if(_0x329e70['empty'])return[];return _0x329e70['docs']['map'](_0x144c59=>({'id':_0x144c59['id'],..._0x144c59[_0x277b3b(0xd9)]()}));}catch(_0x3dd7be){return console[_0x277b3b(0xa0)]('Error\x20fetching\x20comments:',_0x3dd7be),[];}}async function submitComment(_0x54a2d7){const _0x50054=a4_0x53efd7;_0x54a2d7['preventDefault']();if(!window[_0x50054(0xc5)]||!window['db']){console[_0x50054(0xa0)]('Firebase\x20not\x20initialized'),alert(_0x50054(0x78));return;}const _0xb148e9=window['auth']['currentUser'];if(!_0xb148e9){alert(_0x50054(0x11d));return;}const _0x4e802a=document['getElementById'](_0x50054(0x11c))?.[_0x50054(0x97)],_0x3758f5=document[_0x50054(0xaf)]('commentText')?.['value']?.['trim']();if(!_0x4e802a||!_0x3758f5){alert('Please\x20enter\x20a\x20comment\x20before\x20submitting');return;}const _0xc22199=_0x3758f5['split'](/\s+/)[_0x50054(0x74)](_0xfb99c4=>_0xfb99c4[_0x50054(0x86)]>0x0)['length'];if(_0xc22199>0xf){alert(_0x50054(0xde));return;}const _0x565976=document['querySelector']('.submit-comment-btn');_0x565976&&(_0x565976[_0x50054(0x7e)]=!![],_0x565976[_0x50054(0xd0)]='Submitting...');try{let _0x99cf6d='Anonymous';try{const _0x3d3210=doc(window['db'],'userProfiles',_0xb148e9['uid']),_0x4a8b3d=await getDoc(_0x3d3210);if(_0x4a8b3d[_0x50054(0x99)]()){const _0x26e8bf=_0x4a8b3d['data']();_0x26e8bf['username']&&(_0x99cf6d=_0x26e8bf['username']);}_0x99cf6d===_0x50054(0xf9)&&_0xb148e9[_0x50054(0x94)]&&(_0x99cf6d=_0xb148e9['displayName']);}catch(_0x2a31e4){console['warn']('Failed\x20to\x20fetch\x20user\x20profile:',_0x2a31e4),_0xb148e9[_0x50054(0x94)]&&(_0x99cf6d=_0xb148e9['displayName']);}const _0x2bbcc0={'matchId':_0x4e802a,'userId':_0xb148e9[_0x50054(0xb8)],'username':_0x99cf6d,'text':_0x3758f5,'timestamp':serverTimestamp()};console['log']('Submitting\x20comment\x20as:',_0x99cf6d);const _0x5b84d0=collection(window['db'],_0x50054(0xcf));await addDoc(_0x5b84d0,_0x2bbcc0),console['log']('Comment\x20added\x20successfully'),closeAddCommentPopup(),loadRecentMatchesPreview('current');}catch(_0x4b70e9){console['error'](_0x50054(0xf0),_0x4b70e9),alert('Failed\x20to\x20add\x20comment:\x20'+_0x4b70e9['message']),_0x565976&&(_0x565976['disabled']=![],_0x565976[_0x50054(0xd0)]='Submit');}}function closeAddCommentPopup(){const _0x2c0c6a=a4_0x53efd7,_0x6e0d35=document['getElementById'](_0x2c0c6a(0xe5)),_0xaa2039=document[_0x2c0c6a(0xaf)]('commentAddOverlay');if(_0x6e0d35)_0x6e0d35[_0x2c0c6a(0x102)]['display']='none';if(_0xaa2039)_0xaa2039['style']['display']='none';}function showAddCommentPopup(_0x2dd9b2){const _0x5bcf99=a4_0x53efd7,_0x2f6714=window[_0x5bcf99(0xc5)][_0x5bcf99(0x106)];if(!_0x2f6714){alert('You\x20need\x20to\x20be\x20signed\x20in\x20to\x20leave\x20a\x20comment\x20or\x20add\x20a\x20demo');return;}let _0x1ebb01=document[_0x5bcf99(0xaf)]('commentAddPopup'),_0x24b720=document[_0x5bcf99(0xaf)](_0x5bcf99(0x8c));!_0x1ebb01&&(_0x1ebb01=document[_0x5bcf99(0x88)]('div'),_0x1ebb01['id']='commentAddPopup',_0x1ebb01['className']='comment-popup',document[_0x5bcf99(0xbf)]['appendChild'](_0x1ebb01));!_0x24b720&&(_0x24b720=document[_0x5bcf99(0x88)]('div'),_0x24b720['id']=_0x5bcf99(0x8c),_0x24b720['className']='comment-overlay',document['body']['appendChild'](_0x24b720));_0x1ebb01[_0x5bcf99(0x112)]=_0x5bcf99(0x11e)+_0x2dd9b2+_0x5bcf99(0xf2),_0x1ebb01['style']['display']='block',_0x24b720['style']['display']='block',document[_0x5bcf99(0xaf)]('closeAddCommentPopup')['addEventListener']('click',closeAddCommentPopup),_0x24b720['addEventListener']('click',closeAddCommentPopup);const _0x5e10dc=_0x1ebb01['querySelectorAll']('.option-tab');_0x5e10dc['forEach'](_0x268e1d=>{_0x268e1d['addEventListener']('click',function(){const _0x1de3e2=a4_0x48e1;_0x5e10dc['forEach'](_0x1847d5=>_0x1847d5['classList']['remove']('active')),document['querySelectorAll']('.option-content')['forEach'](_0x1adaed=>_0x1adaed['style'][_0x1de3e2(0xda)]='none'),this[_0x1de3e2(0xb6)]['add']('active');const _0x16e2e2=this['dataset']['option'];document[_0x1de3e2(0xaf)](_0x16e2e2+'Option')['style']['display']='block',_0x16e2e2==='demo'?(document['getElementById']('demoLink')['setAttribute']('required',''),document['getElementById'](_0x1de3e2(0xd1))['removeAttribute']('required')):(document[_0x1de3e2(0xaf)](_0x1de3e2(0xad))['removeAttribute']('required'),document['getElementById']('commentText')['setAttribute']('required',''));});}),document[_0x5bcf99(0xaf)]('commentText')['setAttribute']('required',''),document[_0x5bcf99(0xaf)]('demoLink')['removeAttribute']('required'),setupWordCounter('commentText','wordCount',0xf),setupWordCounter('demoDescription','demoWordCount',0x14),document['getElementById']('addCommentForm')[_0x5bcf99(0xea)]('submit',submitCommentOrDemo);}function setupWordCounter(_0x3df2fa,_0x2b1f7c,_0x906e17){const _0x5f55f2=a4_0x53efd7,_0x28b70e=document[_0x5f55f2(0xaf)](_0x3df2fa),_0x2cbf17=document['getElementById'](_0x2b1f7c);if(!_0x28b70e||!_0x2cbf17)return;_0x501775(),_0x28b70e['addEventListener']('input',_0x501775);function _0x501775(){const _0x3691b9=_0x5f55f2,_0x1df847=_0x28b70e['value']['trim'](),_0x4abd5e=_0x1df847?_0x1df847['split'](/\s+/)[_0x3691b9(0x74)](_0x34fa8c=>_0x34fa8c['length']>0x0)['length']:0x0;_0x2cbf17['textContent']=_0x4abd5e,_0x4abd5e>_0x906e17?_0x2cbf17[_0x3691b9(0x102)]['color']='#ff4444':_0x2cbf17['style'][_0x3691b9(0x7f)]='#aaa';}}async function submitCommentOrDemo(_0x54d8b8){const _0x2d4d00=a4_0x53efd7;_0x54d8b8['preventDefault']();if(!window[_0x2d4d00(0xc5)]||!window['db']){console['error']('Firebase\x20not\x20initialized'),alert('Unable\x20to\x20submit\x20-\x20system\x20not\x20ready');return;}const _0x601bf8=window['auth']['currentUser'];if(!_0x601bf8){alert('You\x20must\x20be\x20signed\x20in\x20to\x20continue');return;}const _0x455624=document['getElementById']('commentMatchId')[_0x2d4d00(0x97)],_0x4c541a=document[_0x2d4d00(0xf5)](_0x2d4d00(0xe8))['dataset'][_0x2d4d00(0x118)];let _0x59ec32=_0x2d4d00(0xf9);try{const _0x45f9c0=doc(window['db'],_0x2d4d00(0xd4),_0x601bf8['uid']),_0x141aae=await getDoc(_0x45f9c0);if(_0x141aae[_0x2d4d00(0x99)]()){const _0x267e49=_0x141aae[_0x2d4d00(0xd9)]();_0x267e49[_0x2d4d00(0x71)]&&(_0x59ec32=_0x267e49[_0x2d4d00(0x71)]);}_0x59ec32===_0x2d4d00(0xf9)&&_0x601bf8['displayName']&&(_0x59ec32=_0x601bf8[_0x2d4d00(0x94)]);}catch(_0x112fa9){console['warn']('Failed\x20to\x20fetch\x20username:',_0x112fa9),_0x601bf8['displayName']&&(_0x59ec32=_0x601bf8[_0x2d4d00(0x94)]);}const _0x44a247=document[_0x2d4d00(0xf5)]('.submit-comment-btn');_0x44a247&&(_0x44a247[_0x2d4d00(0x7e)]=!![],_0x44a247[_0x2d4d00(0xd0)]='Submitting...');try{if(_0x4c541a==='comment'){const _0x408cf0=document['getElementById']('commentText')['value'][_0x2d4d00(0xa6)]();if(!_0x408cf0){alert('Please\x20enter\x20a\x20comment\x20before\x20submitting'),_0x44a247['disabled']=![],_0x44a247['textContent']='Submit';return;}const _0xd72de9=_0x408cf0['split'](/\s+/)['filter'](_0x507dec=>_0x507dec['length']>0x0)['length'];if(_0xd72de9>0xf){alert(_0x2d4d00(0xde)),_0x44a247[_0x2d4d00(0x7e)]=![],_0x44a247['textContent']='Submit';return;}const _0x474528={'matchId':_0x455624,'userId':_0x601bf8[_0x2d4d00(0xb8)],'username':_0x59ec32,'text':_0x408cf0,'type':'comment','timestamp':serverTimestamp()},_0x482063=collection(window['db'],'matchComments');await addDoc(_0x482063,_0x474528);}else{const _0x57359d=document['getElementById']('demoLink')['value']['trim'](),_0x42f729=document['getElementById']('demoDescription')['value'][_0x2d4d00(0xa6)]()||'Demo\x20link';if(!_0x57359d){alert(_0x2d4d00(0x96)),_0x44a247['disabled']=![],_0x44a247['textContent']='Submit';return;}try{new URL(_0x57359d);}catch(_0x2e54dc){alert(_0x2d4d00(0x113)),_0x44a247['disabled']=![],_0x44a247['textContent']='Submit';return;}const _0x4fc160=_0x42f729['split'](/\s+/)['filter'](_0x3278a1=>_0x3278a1['length']>0x0)[_0x2d4d00(0x86)];if(_0x4fc160>0x14){alert('Demo\x20descriptions\x20are\x20limited\x20to\x2020\x20words\x20maximum.\x20Please\x20shorten\x20your\x20description.'),_0x44a247[_0x2d4d00(0x7e)]=![],_0x44a247['textContent']='Submit';return;}const _0x306641={'matchId':_0x455624,'userId':_0x601bf8[_0x2d4d00(0xb8)],'username':_0x59ec32,'demoLink':_0x57359d,'description':_0x42f729,'type':'demo','text':'Demo:\x20'+_0x42f729,'timestamp':serverTimestamp()},_0x1c8b1e=collection(window['db'],_0x2d4d00(0xcf));await addDoc(_0x1c8b1e,_0x306641);}closeAddCommentPopup(),loadRecentMatchesPreview('current');}catch(_0x19b71e){console['error']('Error\x20submitting:',_0x19b71e),alert('Failed\x20to\x20submit:\x20'+_0x19b71e['message']),_0x44a247&&(_0x44a247[_0x2d4d00(0x7e)]=![],_0x44a247[_0x2d4d00(0xd0)]='Submit');}}function getEloRankClass(_0x1381e2){const _0x45cf81=a4_0x53efd7,_0x508ff5=Number(_0x1381e2);if(_0x508ff5>=0x7d0)return'emerald';else{if(_0x508ff5>=0x708)return _0x45cf81(0xdf);else{if(_0x508ff5>=0x640)return'silver';else{if(_0x508ff5>=0x578)return _0x45cf81(0x10a);else return'unranked';}}}}function showPreviewCommentPopup(_0x3f0196,_0x168ce5,_0x1f8b80=a4_0x53efd7(0xa2)){const _0x299b43=a4_0x53efd7,_0x38c088=document['getElementById']('commentPopupPreview'),_0x2dc1a7=document[_0x299b43(0xaf)]('commentOverlayPreview'),_0x942a71=document['getElementById'](_0x299b43(0xb2)),_0x479b13=document['getElementById']('commentPopupContentPreview'),_0x30ac9e=document['getElementById']('reportCommentButton');if(!_0x38c088||!_0x2dc1a7||!_0x942a71||!_0x479b13||!_0x30ac9e)return;_0x38c088['dataset']['commentText']=_0x3f0196,_0x38c088[_0x299b43(0xc0)][_0x299b43(0x95)]=_0x168ce5,_0x942a71['style']['color']=_0x1f8b80,_0x942a71['textContent']=_0x299b43(0x121)+_0x168ce5,_0x479b13[_0x299b43(0xd0)]=_0x3f0196,_0x30ac9e['onclick']=reportComment,_0x38c088['style'][_0x299b43(0xda)]='block',_0x2dc1a7['style']['display']='block';}function closePreviewCommentPopup(){const _0x517326=a4_0x53efd7,_0x2a3598=document[_0x517326(0xaf)]('commentPopupPreview'),_0x4a3fe5=document[_0x517326(0xaf)](_0x517326(0x70));if(_0x2a3598)_0x2a3598[_0x517326(0x102)][_0x517326(0xda)]='none';if(_0x4a3fe5)_0x4a3fe5['style']['display']=_0x517326(0x75);}async function reportComment(){const _0x477c19=a4_0x53efd7,_0x3c17b3=window['auth'][_0x477c19(0x106)];if(!_0x3c17b3){alert('You\x20need\x20to\x20be\x20signed\x20in\x20to\x20report\x20comments');return;}if(!confirm('Are\x20you\x20sure\x20you\x20want\x20to\x20report\x20this\x20comment\x20as\x20inappropriate?'))return;try{const _0x4c74b6=document['getElementById']('commentPopupPreview'),_0x137f7e={'commentAuthor':_0x4c74b6[_0x477c19(0xc0)]['commentUser']||_0x477c19(0xb4),'commentText':_0x4c74b6[_0x477c19(0xc0)]['commentText']||'','matchId':previewState['currentMatchId']||'','reportedBy':_0x3c17b3['uid'],'reporterUsername':_0x3c17b3['displayName']||'Anonymous\x20User','reportedAt':serverTimestamp()},_0x193a9b=collection(window['db'],'badComments');await addDoc(_0x193a9b,_0x137f7e),alert('Thank\x20you.\x20The\x20comment\x20has\x20been\x20reported\x20and\x20will\x20be\x20reviewed.'),closePreviewCommentPopup();}catch(_0x1f31ce){console[_0x477c19(0xa0)]('Error\x20reporting\x20comment:',_0x1f31ce),alert('Failed\x20to\x20report\x20comment:\x20'+_0x1f31ce['message']);}}function showFullCommentLightbox(_0x471102){const _0x2f6d86=a4_0x53efd7;if(isUsernameMuted(_0x471102['username']))return;const _0x497d87=document[_0x2f6d86(0xaf)]('commentPopupPreview'),_0x13d965=document[_0x2f6d86(0xaf)]('commentOverlayPreview'),_0x5a5efc=document['getElementById'](_0x2f6d86(0xb2)),_0x85638f=document[_0x2f6d86(0xaf)]('commentPopupContentPreview');if(!_0x497d87||!_0x13d965||!_0x5a5efc||!_0x85638f)return;_0x5a5efc['style'][_0x2f6d86(0x7f)]='#fff',_0x5a5efc['textContent']='Comment\x20from\x20'+_0x471102['username'];if(_0x471102['timestamp']){const _0x543618=new Date(_0x471102[_0x2f6d86(0x11f)]['seconds']*0x3e8),_0x658864=_0x543618[_0x2f6d86(0x109)]();_0x85638f[_0x2f6d86(0x112)]='<p>'+_0x471102[_0x2f6d86(0xe1)]+_0x2f6d86(0xdb)+_0x658864+'</small>';}else _0x85638f['textContent']=_0x471102['text'];_0x497d87['dataset']['commentId']=_0x471102['id']||'',_0x497d87['dataset']['commentUser']=_0x471102['username']||'',_0x497d87[_0x2f6d86(0xc0)][_0x2f6d86(0xd1)]=_0x471102['text']||'',_0x497d87[_0x2f6d86(0xc0)]['matchId']=_0x471102['matchId']||'';const _0x223f2f=_0x497d87['querySelector']('.popup-actions')||document[_0x2f6d86(0x88)]('div');!_0x497d87[_0x2f6d86(0xf5)](_0x2f6d86(0xe2))?(_0x223f2f['className']=_0x2f6d86(0xc9),_0x223f2f['style'][_0x2f6d86(0xda)]=_0x2f6d86(0xd2),_0x223f2f[_0x2f6d86(0x102)]['justifyContent']='center',_0x223f2f['style']['gap']='10px',_0x223f2f['style']['marginTop']='15px',_0x497d87['appendChild'](_0x223f2f)):_0x223f2f[_0x2f6d86(0x112)]='';const _0x1664ba=document[_0x2f6d86(0x88)](_0x2f6d86(0x7b));_0x1664ba[_0x2f6d86(0xd0)]='Close',_0x1664ba['className']='popup-btn\x20close-btn',_0x1664ba['id']='closeCommentPopupPreview',_0x1664ba[_0x2f6d86(0xea)](_0x2f6d86(0xff),closePreviewCommentPopup);const _0x2be4ed=document['createElement']('button');_0x2be4ed[_0x2f6d86(0xd0)]='Report',_0x2be4ed['className']='popup-btn\x20report-btn',_0x2be4ed['style'][_0x2f6d86(0xdd)]='#d32f2f',_0x2be4ed['addEventListener'](_0x2f6d86(0xff),reportComment),_0x223f2f[_0x2f6d86(0xcb)](_0x1664ba),_0x223f2f['appendChild'](_0x2be4ed),_0x497d87['style']['display']='block',_0x13d965['style']['display']='block';}export function setupPreviewEventListeners(){const _0x117598=a4_0x53efd7,_0x58460b=document['getElementById'](_0x117598(0xfb)),_0x1097b7=document['getElementById']('previewNextPage'),_0x5c65d9=document[_0x117598(0xaf)]('preview-d1-button'),_0x504f14=document['getElementById']('preview-d2-button'),_0x3df19f=document['getElementById']('preview-d3-button'),_0x5bc715=document['getElementById']('filter-toggle-button'),_0x2e487b=document['getElementById']('enhanced-filter-section');if(!_0x58460b||!_0x1097b7||!_0x5c65d9||!_0x504f14||!_0x3df19f||!_0x5bc715||!_0x2e487b){console['warn'](_0x117598(0xc4));return;}_0x58460b['addEventListener']('click',()=>{if(!_0x58460b['disabled'])loadRecentMatchesPreview('prev');}),_0x1097b7[_0x117598(0xea)]('click',()=>{const _0x16cae2=_0x117598;if(!_0x1097b7[_0x16cae2(0x7e)])loadRecentMatchesPreview('next');}),_0x5c65d9['addEventListener']('click',()=>{const _0x178521=_0x117598;previewState[_0x178521(0x114)]!=='D1'&&!previewState['isLoading']&&(previewState['currentMode']='D1',updatePreviewLadderModeUI(),loadRecentMatchesPreview('current'));}),_0x504f14['addEventListener'](_0x117598(0xff),()=>{const _0x371fdc=_0x117598;previewState['currentMode']!=='D2'&&!previewState['isLoading']&&(previewState[_0x371fdc(0x114)]='D2',updatePreviewLadderModeUI(),loadRecentMatchesPreview(_0x371fdc(0x98)));}),_0x3df19f['addEventListener']('click',()=>{const _0xb339f5=_0x117598;previewState['currentMode']!=='D3'&&!previewState[_0xb339f5(0x90)]&&(previewState['currentMode']='D3',updatePreviewLadderModeUI(),loadRecentMatchesPreview(_0xb339f5(0x98)));});_0x5bc715&&_0x2e487b&&_0x5bc715['addEventListener']('click',()=>{const _0x1027d9=_0x117598,_0x63a7c3=_0x2e487b['style'][_0x1027d9(0xda)]!==_0x1027d9(0x75);_0x2e487b[_0x1027d9(0x102)][_0x1027d9(0xda)]=_0x63a7c3?_0x1027d9(0x75):'block',_0x5bc715['classList'][_0x1027d9(0x9f)]('active',!_0x63a7c3);});const _0x4dc4ea=document['getElementById'](_0x117598(0xd6)),_0x2a72bb=document['getElementById']('clear-enhanced-filters');_0x4dc4ea&&_0x4dc4ea['addEventListener']('click',()=>{const _0x5b8eae=_0x117598;previewState[_0x5b8eae(0x80)][_0x5b8eae(0x83)]=document['getElementById'](_0x5b8eae(0xec))['value']['trim'](),previewState['enhancedFilters']['levels']=document['getElementById']('filter-levels')['value']['trim']();const _0x24fdb6=document[_0x5b8eae(0xaf)]('filter-subgames');previewState['enhancedFilters']['subgames']=Array[_0x5b8eae(0x79)](_0x24fdb6['selectedOptions'])[_0x5b8eae(0xbc)](_0x21df1f=>_0x21df1f['value'])[_0x5b8eae(0x74)](_0x13ee9d=>_0x13ee9d!==''),loadRecentMatchesPreview(_0x5b8eae(0x98));});_0x2a72bb&&_0x2a72bb['addEventListener']('click',()=>{clearEnhancedFilters(),loadRecentMatchesPreview('current');});document['querySelectorAll']('.jump-btn')['forEach'](_0x164d41=>{_0x164d41['addEventListener']('click',()=>{const _0xc46315=_0x164d41['dataset']['jump'];jumpToPage(_0xc46315);});});const _0x4e3f2f=document[_0x117598(0xaf)]('jump-to-page');_0x4e3f2f&&_0x4e3f2f['addEventListener']('keypress',_0xc41058=>{_0xc41058['key']==='Enter'&&jumpToPage('input');});const _0x27b694=document['getElementById']('closeCommentPopupPreview'),_0x430cd9=document['getElementById'](_0x117598(0x70));if(_0x27b694)_0x27b694['addEventListener'](_0x117598(0xff),closePreviewCommentPopup);if(_0x430cd9)_0x430cd9['addEventListener'](_0x117598(0xff),closePreviewCommentPopup);const _0x21d598=document['getElementById']('closeAddCommentPopup'),_0x5bbffc=document['getElementById'](_0x117598(0x8c)),_0x377b21=document['getElementById']('addCommentForm');if(_0x21d598)_0x21d598['addEventListener']('click',closeAddCommentPopup);if(_0x5bbffc)_0x5bbffc['addEventListener']('click',closeAddCommentPopup);if(_0x377b21)_0x377b21['addEventListener'](_0x117598(0xbe),submitComment);const _0xeaeb6a=document[_0x117598(0xaf)]('commentText'),_0x22bf40=document[_0x117598(0xaf)]('wordCount');_0xeaeb6a&&_0x22bf40&&setupWordCounter('commentText','wordCount',0xf);}window[a4_0x53efd7(0xbb)]=showAddCommentPopup,window[a4_0x53efd7(0x84)]=closeAddCommentPopup,window['submitComment']=submitComment;
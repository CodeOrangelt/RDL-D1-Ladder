const a38_0x1a2dd0=a38_0x2f1c,a38_0x59097e=(function(){let _0x3fe4b2=!![];return function(_0x4a4783,_0x2bc493){const _0x2b7a8e=_0x3fe4b2?function(){if(_0x2bc493){const _0x2bda90=_0x2bc493['apply'](_0x4a4783,arguments);return _0x2bc493=null,_0x2bda90;}}:function(){};return _0x3fe4b2=![],_0x2b7a8e;};}()),a38_0x31c119=a38_0x59097e(this,function(){const _0x445d97=a38_0x2f1c;let _0x1fce2a;try{const _0x32c411=Function('return\x20(function()\x20'+_0x445d97(0x16b)+');');_0x1fce2a=_0x32c411();}catch(_0x122df9){_0x1fce2a=window;}const _0x57923d=_0x1fce2a['console']=_0x1fce2a['console']||{},_0x3a208a=['log',_0x445d97(0x167),'info','error','exception','table',_0x445d97(0x15e)];for(let _0x3a5d42=0x0;_0x3a5d42<_0x3a208a['length'];_0x3a5d42++){const _0x529612=a38_0x59097e['constructor']['prototype']['bind'](a38_0x59097e),_0x47e6d9=_0x3a208a[_0x3a5d42],_0x5c8c1a=_0x57923d[_0x47e6d9]||_0x529612;_0x529612['__proto__']=a38_0x59097e['bind'](a38_0x59097e),_0x529612['toString']=_0x5c8c1a['toString']['bind'](_0x5c8c1a),_0x57923d[_0x47e6d9]=_0x529612;}});a38_0x31c119();function a38_0x2f1c(_0x25a84f,_0x36e5ed){const _0x31c119=a38_0x1904();return a38_0x2f1c=function(_0x59097e,_0x4c74e4){_0x59097e=_0x59097e-0x150;let _0x19042e=_0x31c119[_0x59097e];return _0x19042e;},a38_0x2f1c(_0x25a84f,_0x36e5ed);}const functions=require('firebase-functions'),admin=require('firebase-admin');admin[a38_0x1a2dd0(0x169)]();const db=admin['firestore']();exports['updateMembersList']=functions['firestore']['document']('{collection}/{docId}')['onWrite'](async(_0x296afb,_0x1b0d7e)=>{const _0x3b9182=a38_0x1a2dd0,_0x54c819=_0x1b0d7e[_0x3b9182(0x165)]['collection'],_0x3ce80b=_0x1b0d7e['params']['docId'];if(!['players','playersD2','playersD3','userProfiles','nonParticipants'][_0x3b9182(0x15d)](_0x54c819))return null;try{await rebuildMembersList(),console['log']('Successfully\x20updated\x20aggregated\x20members\x20list');}catch(_0x5858f9){console['error']('Error\x20updating\x20members\x20list:',_0x5858f9);}});async function rebuildMembersList(){const _0x4142fc=a38_0x1a2dd0,_0x416ab8=db['batch'](),[_0x3c7e95,_0x87651c,_0x1f0a64,_0x52a331,_0xb07814]=await Promise[_0x4142fc(0x156)]([db['collection']('userProfiles')['get'](),db['collection']('players')['get'](),db['collection']('playersD2')['get'](),db[_0x4142fc(0x154)](_0x4142fc(0x162))[_0x4142fc(0x157)](),db['collection'](_0x4142fc(0x153))[_0x4142fc(0x157)]()]),_0x536cde=new Map();_0x3c7e95['forEach'](_0x5bb25f=>{_0x536cde['set'](_0x5bb25f['id'],_0x5bb25f['data']());});const _0x1d66b1=new Map(),_0x38831e=(_0x120691,_0x39779e)=>{_0x120691['forEach'](_0x282056=>{const _0x443d2f=a38_0x2f1c,_0x3e6f2f=_0x282056['data'](),_0x40fb6d=_0x282056['id'];!_0x1d66b1['has'](_0x40fb6d)&&_0x1d66b1[_0x443d2f(0x16d)](_0x40fb6d,{'userId':_0x40fb6d,'username':_0x3e6f2f[_0x443d2f(0x151)]||'Unknown','ladders':[],'isNonParticipant':![]});const _0x6f18ed=_0x1d66b1['get'](_0x40fb6d);_0x6f18ed['ladders'][_0x443d2f(0x16f)]({'ladder':_0x39779e,'elo':_0x3e6f2f['eloRating']||0x4b0,'active':_0x3e6f2f[_0x443d2f(0x15f)]!==![]});});};_0x38831e(_0x87651c,'D1'),_0x38831e(_0x1f0a64,'D2'),_0x38831e(_0x52a331,'D3'),_0xb07814[_0x4142fc(0x166)](_0x4619ec=>{const _0x2ee977=_0x4142fc,_0x498dda=_0x4619ec[_0x2ee977(0x161)](),_0x56f15f=_0x4619ec['id'];!_0x1d66b1['has'](_0x56f15f)&&_0x498dda['username']&&_0x1d66b1['set'](_0x56f15f,{'userId':_0x56f15f,'username':_0x498dda['username'],'ladders':[],'isNonParticipant':!![]});});const _0x3ecadd=[];_0x1d66b1[_0x4142fc(0x166)]((_0x51223c,_0x56a071)=>{const _0x4d44b5=_0x4142fc,_0x102f9b=_0x536cde['get'](_0x56a071)||{};let _0x40fc77=0x0,_0x25131b=null;if(_0x51223c['ladders']['length']>0x0){const _0x33063e=_0x51223c[_0x4d44b5(0x163)]['sort']((_0x29fdcf,_0x3af92c)=>_0x3af92c['elo']-_0x29fdcf[_0x4d44b5(0x150)]);_0x40fc77=_0x33063e[0x0][_0x4d44b5(0x150)],_0x25131b=_0x33063e[0x0]['ladder'];}const _0x598b88={'userId':_0x56a071,'username':_0x51223c[_0x4d44b5(0x151)],'profileImageUrl':_0x102f9b['profileImageUrl']||null,'country':_0x102f9b[_0x4d44b5(0x15a)]||null,'motto':_0x102f9b['motto']||null,'favoriteMap':_0x102f9b['favoriteMap']||null,'favoriteWeapon':_0x102f9b[_0x4d44b5(0x16e)]||null,'isNonParticipant':_0x51223c['isNonParticipant'],'ladders':_0x51223c['ladders'],'primaryLadder':_0x25131b,'highestElo':_0x40fc77,'rank':getPlayerRank(_0x40fc77),'lastUpdated':admin['firestore']['FieldValue']['serverTimestamp']()};_0x3ecadd[_0x4d44b5(0x16f)](_0x598b88);});const _0x4c213d=db['collection']('aggregatedMembers'),_0x3a28a9=await _0x4c213d['get'](),_0x5d67f6=[];_0x3a28a9['forEach'](_0x1e9f18=>{_0x5d67f6['push'](_0x1e9f18['ref']['delete']());}),await Promise[_0x4142fc(0x156)](_0x5d67f6);const _0x4c6a89=0x1f4,_0x3ae90f=[];for(let _0x3a60be=0x0;_0x3a60be<_0x3ecadd[_0x4142fc(0x158)];_0x3a60be+=_0x4c6a89){const _0x5292aa=db[_0x4142fc(0x168)](),_0x131122=_0x3ecadd[_0x4142fc(0x155)](_0x3a60be,_0x3a60be+_0x4c6a89);_0x131122['forEach'](_0x469911=>{const _0x383ab4=_0x4142fc,_0x34075d=_0x4c213d[_0x383ab4(0x15b)](_0x469911['userId']);_0x5292aa['set'](_0x34075d,_0x469911);}),_0x3ae90f[_0x4142fc(0x16f)](_0x5292aa[_0x4142fc(0x159)]());}await Promise['all'](_0x3ae90f);}function a38_0x1904(){const _0x454fe0=['elo','username','onRequest','nonParticipants','collection','slice','all','get','length','commit','country','doc','error','includes','trace','active','Error\x20rebuilding\x20members\x20list','data','playersD3','ladders','silver','params','forEach','warn','batch','initializeApp','send','{}.constructor(\x22return\x20this\x22)(\x20)','status','set','favoriteWeapon','push'];a38_0x1904=function(){return _0x454fe0;};return a38_0x1904();}function getPlayerRank(_0x309d6b){const _0x1d03e3=a38_0x1a2dd0;if(_0x309d6b>=0x7d0)return'emerald';if(_0x309d6b>=0x708)return'gold';if(_0x309d6b>=0x640)return _0x1d03e3(0x164);if(_0x309d6b>=0x578)return'bronze';return'unranked';}exports['rebuildMembersListManual']=functions['https'][a38_0x1a2dd0(0x152)](async(_0x14c65e,_0x1fb10b)=>{const _0x3621d4=a38_0x1a2dd0;try{await rebuildMembersList(),_0x1fb10b[_0x3621d4(0x16c)](0xc8)['send']('Members\x20list\x20rebuilt\x20successfully');}catch(_0x4ca03a){console[_0x3621d4(0x15c)]('Error\x20rebuilding\x20members\x20list:',_0x4ca03a),_0x1fb10b[_0x3621d4(0x16c)](0x1f4)[_0x3621d4(0x16a)](_0x3621d4(0x160));}});
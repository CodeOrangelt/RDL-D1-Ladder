function a0_0x31d7(_0x109e10,_0x1103e0){const _0x23cad1=a0_0x4561();return a0_0x31d7=function(_0x1ca083,_0x59616a){_0x1ca083=_0x1ca083-0x1cd;let _0x22934d=_0x23cad1[_0x1ca083];return _0x22934d;},a0_0x31d7(_0x109e10,_0x1103e0);}const a0_0x2cb364=a0_0x31d7;(function(_0x1fe45e,_0x401fce){const _0x1b2c58=a0_0x31d7,_0x1d11c9=_0x1fe45e();while(!![]){try{const _0x2de00f=-parseInt(_0x1b2c58(0x1f0))/0x1+parseInt(_0x1b2c58(0x1d1))/0x2+parseInt(_0x1b2c58(0x1d5))/0x3*(parseInt(_0x1b2c58(0x1fb))/0x4)+parseInt(_0x1b2c58(0x1ce))/0x5+-parseInt(_0x1b2c58(0x1e2))/0x6*(parseInt(_0x1b2c58(0x1f8))/0x7)+-parseInt(_0x1b2c58(0x204))/0x8*(-parseInt(_0x1b2c58(0x1dc))/0x9)+parseInt(_0x1b2c58(0x1ec))/0xa;if(_0x2de00f===_0x401fce)break;else _0x1d11c9['push'](_0x1d11c9['shift']());}catch(_0x4cd76c){_0x1d11c9['push'](_0x1d11c9['shift']());}}}(a0_0x4561,0x9819b));const a0_0x59616a=(function(){let _0x1f8909=!![];return function(_0x10eef1,_0x359022){const _0x1d1472=_0x1f8909?function(){if(_0x359022){const _0x2b4959=_0x359022['apply'](_0x10eef1,arguments);return _0x359022=null,_0x2b4959;}}:function(){};return _0x1f8909=![],_0x1d1472;};}()),a0_0x1ca083=a0_0x59616a(this,function(){const _0x58f736=a0_0x31d7;let _0x186be7;try{const _0xd1e9c1=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x186be7=_0xd1e9c1();}catch(_0x478f43){_0x186be7=window;}const _0x5e8d32=_0x186be7[_0x58f736(0x1d3)]=_0x186be7['console']||{},_0x2785d8=['log','warn','info','error','exception',_0x58f736(0x1f7),'trace'];for(let _0x5a1634=0x0;_0x5a1634<_0x2785d8[_0x58f736(0x1f3)];_0x5a1634++){const _0x20cdaa=a0_0x59616a['constructor'][_0x58f736(0x1e8)]['bind'](a0_0x59616a),_0x1719a0=_0x2785d8[_0x5a1634],_0x235ff2=_0x5e8d32[_0x1719a0]||_0x20cdaa;_0x20cdaa['__proto__']=a0_0x59616a[_0x58f736(0x1d0)](a0_0x59616a),_0x20cdaa['toString']=_0x235ff2['toString'][_0x58f736(0x1d0)](_0x235ff2),_0x5e8d32[_0x1719a0]=_0x20cdaa;}});a0_0x1ca083();import{getAuth,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{doc,getDoc,collection,query,where,getDocs,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';function a0_0x4561(){const _0x250d6f=['\x20by\x20UID:','log','lastChecked','prototype','textContent','filter','toLowerCase','7716700BvsVee','addEventListener','\x20(Admin)','error','460791jiVVXF','.admin-only','isAdmin','length','auth-section','Found\x20user\x20in\x20','hasCheckedCollections','table','12103lSUtRR','playersD3','status','531320sNQlaV','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20class=\x22nav-username\x22>','\x22>Profile</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./inbox.html\x22\x20class=\x22nav-notification\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Inbox\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22inbox-notification\x22\x20class=\x22notification-dot\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22members.html\x22>Members</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./redeem.html\x22><i\x20class=\x22fas\x20fa-gift\x22></i>Store</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20id=\x22logout-link\x22>Sign\x20Out</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','playersD2','players','forEach','uid','split','\x20by\x20email:','2072sGknTn','data','No\x20admin\x20roles\x20found\x20for\x20user','block','Found\x20admin\x20role:\x20','email','2062235kMTCVl','Brian2af@outlook.com','bind','143930vhjdAy','owner','console','display','6fCFiSL','includes','Error\x20signing\x20out:','charAt','Error\x20checking\x20','join','userProfiles','6471ZZhByv','style','docs','slice','signOut','currentUser','2166GNeniS','nonParticipants','roleName'];a0_0x4561=function(){return _0x250d6f;};return a0_0x4561();}import{isAdmin}from'./admin-check.js';const ADMIN_EMAILS=['admin@ladder.com',a0_0x2cb364(0x1cf)],userCache={'uid':null,'username':null,'isAdmin':![],'hasCheckedCollections':![],'lastChecked':0x0,'role':null},invitationCache={'lastCheck':0x0,'pendingCount':0x0,'checkInterval':0x493e0};function updateInboxNotification(_0x2c09a4){const _0x50819f=a0_0x2cb364,_0x166ba0=document['getElementById']('inbox-notification');_0x166ba0&&(_0x2c09a4>0x0?(_0x166ba0[_0x50819f(0x1dd)][_0x50819f(0x1d4)]='inline-block',_0x166ba0[_0x50819f(0x1e9)]=_0x2c09a4>0x9?'9+':_0x2c09a4):_0x166ba0['style']['display']='none');}async function checkPendingInvitationsForCurrentUser(_0x5a67cc){const _0x2454d5=a0_0x2cb364;try{const _0x378233=Date['now']();if(_0x378233-invitationCache['lastCheck']<invitationCache['checkInterval'])return updateInboxNotification(invitationCache['pendingCount']),invitationCache['pendingCount'];invitationCache['lastCheck']=_0x378233;const _0x2b51fd=collection(db,'gameInvitations'),_0x1313cb=query(_0x2b51fd,where('toUserId','==',_0x5a67cc),where(_0x2454d5(0x1fa),'==','pending'),limit(0x5)),_0x4215b2=await getDocs(_0x1313cb),_0xa1e337=_0x4215b2['size'];return invitationCache['pendingCount']=_0xa1e337,updateInboxNotification(_0xa1e337),_0xa1e337;}catch(_0x4b8a02){return console['warn']('Could\x20not\x20check\x20pending\x20invitations\x20for\x20current\x20user:',_0x4b8a02),0x0;}}function updateAuthSectionImmediate(_0x1aa88d,_0x422df3=![]){const _0x4185d4=a0_0x2cb364,_0x3806b7=document['getElementById'](_0x4185d4(0x1f4));if(!_0x3806b7)return;if(_0x1aa88d&&_0x422df3)document['querySelectorAll'](_0x4185d4(0x1f1))['forEach'](_0x373fa9=>{const _0x56ff95=_0x4185d4;_0x373fa9['style']['display']=_0x56ff95(0x207);});else!_0x1aa88d&&document['querySelectorAll'](_0x4185d4(0x1f1))['forEach'](_0x53e548=>{_0x53e548['style']['display']='none';});if(_0x1aa88d){const _0x4be858=userCache['username']||(_0x1aa88d['email']?_0x1aa88d['email']['split']('@')[0x0]:'User'),_0x70506e=userCache['role']?'\x20('+userCache['role']+')':_0x422df3?_0x4185d4(0x1ee):'';_0x3806b7['innerHTML']=_0x4185d4(0x1fc)+_0x4be858+_0x70506e+'</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username='+encodeURIComponent(_0x4be858)+_0x4185d4(0x1fd);const _0x250f2b=document['getElementById']('logout-link');_0x250f2b&&_0x250f2b['addEventListener']('click',_0x559ec8=>{const _0x523b2a=_0x4185d4;_0x559ec8['preventDefault']();const _0x3b5c20=getAuth();updateAuthSectionImmediate(null),_0x3b5c20[_0x523b2a(0x1e0)]()['catch'](_0x344189=>{const _0x14dcc5=_0x523b2a;console[_0x14dcc5(0x1ef)](_0x14dcc5(0x1d7),_0x344189);});}),_0x1aa88d['uid']&&setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0x1aa88d['uid']);},0x3e8);}else _0x3806b7['innerHTML']='<a\x20href=\x22login.html\x22\x20class=\x22login-link\x22>Login</a>';}async function checkAdminRoles(_0x9b0c5){const _0x24497d=a0_0x2cb364;if(!_0x9b0c5||!_0x9b0c5[_0x24497d(0x1cd)])return{'isAdmin':![],'role':null};try{console['log']('Checking\x20roles\x20for\x20user:\x20'+_0x9b0c5[_0x24497d(0x1cd)]);const _0x170ddf=[_0x24497d(0x1ff),'playersD2',_0x24497d(0x1f9),'nonParticipants',_0x24497d(0x1db)],_0x41663c=['council','creative\x20lead',_0x24497d(0x1d2),'admin'];for(const _0x15e0db of _0x170ddf){try{const _0x2f81cf=doc(db,_0x15e0db,_0x9b0c5[_0x24497d(0x201)]),_0x39d287=await getDoc(_0x2f81cf);if(_0x39d287['exists']()){const _0x5b3b9e=_0x39d287['data']();console[_0x24497d(0x1e6)](_0x24497d(0x1f5)+_0x15e0db+'\x20by\x20UID:',_0x5b3b9e);let _0x5ad72c=(_0x5b3b9e[_0x24497d(0x1e4)]||_0x5b3b9e['role']||'')['toLowerCase'](),_0x228e4a=_0x5b3b9e['roleName']||_0x5b3b9e['role']||'';if(_0x5ad72c&&_0x41663c[_0x24497d(0x1d6)](_0x5ad72c)){console['log'](_0x24497d(0x208)+_0x5ad72c+'\x20in\x20'+_0x15e0db);const _0x408c21=_0x228e4a['split']('\x20')['map'](_0x5340a7=>_0x5340a7['charAt'](0x0)['toUpperCase']()+_0x5340a7['slice'](0x1)['toLowerCase']())['join']('\x20');return{'isAdmin':!![],'role':_0x408c21};}}}catch(_0x21fc7b){console['error'](_0x24497d(0x1d9)+_0x15e0db+_0x24497d(0x1e5),_0x21fc7b);}}for(const _0x3b7bb5 of _0x170ddf){try{const _0x297b47=collection(db,_0x3b7bb5);let _0x54d42c=query(_0x297b47,where('email','==',_0x9b0c5['email'])),_0x1541ab=await getDocs(_0x54d42c);_0x1541ab['empty']&&(_0x54d42c=query(_0x297b47,where('email','==',_0x9b0c5[_0x24497d(0x1cd)]['toLowerCase']())),_0x1541ab=await getDocs(_0x54d42c));if(!_0x1541ab['empty']){const _0xdc526d=_0x1541ab[_0x24497d(0x1de)][0x0][_0x24497d(0x205)]();console[_0x24497d(0x1e6)](_0x24497d(0x1f5)+_0x3b7bb5+_0x24497d(0x203),_0xdc526d);let _0x1aba56=(_0xdc526d['roleName']||_0xdc526d['role']||'')[_0x24497d(0x1eb)](),_0x574285=_0xdc526d[_0x24497d(0x1e4)]||_0xdc526d['role']||'';if(_0x1aba56&&_0x41663c['includes'](_0x1aba56)){console[_0x24497d(0x1e6)]('Found\x20admin\x20role:\x20'+_0x1aba56+'\x20in\x20'+_0x3b7bb5);const _0x5c8254=_0x574285[_0x24497d(0x202)]('\x20')['map'](_0x2adc54=>_0x2adc54[_0x24497d(0x1d8)](0x0)['toUpperCase']()+_0x2adc54[_0x24497d(0x1df)](0x1)['toLowerCase']())[_0x24497d(0x1da)]('\x20');return{'isAdmin':!![],'role':_0x5c8254};}}}catch(_0x3b0aa4){console[_0x24497d(0x1ef)]('Error\x20checking\x20'+_0x3b7bb5+'\x20by\x20email:',_0x3b0aa4);}}return console['log'](_0x24497d(0x206)),{'isAdmin':![],'role':null};}catch(_0x548338){return console['error']('Error\x20in\x20checkAdminRoles:',_0x548338),{'isAdmin':![],'role':null};}}async function updateAuthSection(_0x1f770a){const _0x1bca85=a0_0x2cb364,_0x547cf7=_0x1f770a&&isAdmin(_0x1f770a['email']);updateAuthSectionImmediate(_0x1f770a,_0x547cf7);if(!_0x1f770a){userCache['uid']=null,userCache['username']=null,userCache['isAdmin']=![],userCache[_0x1bca85(0x1f6)]=![],userCache['role']=null;return;}const _0x15aa75=Date['now']();if(_0x1f770a['uid']===userCache['uid']&&userCache[_0x1bca85(0x1f6)]&&_0x15aa75-userCache[_0x1bca85(0x1e7)]<0x493e0)return;try{userCache[_0x1bca85(0x201)]=_0x1f770a['uid'],userCache[_0x1bca85(0x1e7)]=_0x15aa75;const _0x1bdff8=isAdmin(_0x1f770a['email']);userCache[_0x1bca85(0x1f2)]=_0x1bdff8;if(!_0x1bdff8){const {isAdmin:_0x5d1a3b,role:_0x5d6b16}=await checkAdminRoles(_0x1f770a);userCache['isAdmin']=_0x5d1a3b,userCache['role']=_0x5d6b16,_0x5d1a3b&&(document['querySelectorAll']('.admin-only')[_0x1bca85(0x200)](_0x5e6071=>{const _0x16bacf=_0x1bca85;_0x5e6071[_0x16bacf(0x1dd)]['display']='block';}),updateAuthSectionImmediate(_0x1f770a,!![]));}const _0x2896d2=['players',_0x1bca85(0x1fe),_0x1bca85(0x1f9),'playersDuos','playersCTF',_0x1bca85(0x1e3),'userProfiles'],_0x3980b5=_0x2896d2['map'](_0x1fba17=>getDoc(doc(db,_0x1fba17,_0x1f770a['uid']))['then'](_0x161e36=>_0x161e36['exists']()?{'collection':_0x1fba17,'data':_0x161e36['data']()}:null)['catch'](()=>null)),_0x39220a=await Promise['all'](_0x3980b5),_0x332a0a=_0x39220a[_0x1bca85(0x1ea)](_0xcbd21f=>_0xcbd21f!==null);let _0x15e076=null;for(const _0x1fcd44 of _0x332a0a){if(_0x1fcd44['data']['username']){_0x15e076=_0x1fcd44['data']['username'];break;}}userCache['username']=_0x15e076||(_0x1f770a['email']?_0x1f770a['email']['split']('@')[0x0]:'User'),userCache[_0x1bca85(0x1f6)]=!![],updateAuthSectionImmediate(_0x1f770a,userCache['isAdmin']),setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0x1f770a['uid']);},0x1f4);}catch(_0xf3174c){console['error']('Error\x20in\x20full\x20auth\x20update:',_0xf3174c);}}document['addEventListener']('DOMContentLoaded',()=>{const _0x224635=a0_0x2cb364,_0xb687d8=getAuth();onAuthStateChanged(_0xb687d8,async _0x2a6b99=>{const _0x112397=a0_0x31d7;await updateAuthSection(_0x2a6b99),_0x2a6b99&&checkPendingInvitationsForCurrentUser(_0x2a6b99[_0x112397(0x201)]);}),document[_0x224635(0x1ed)]('visibilitychange',()=>{const _0x220ea1=_0x224635;!document['hidden']&&_0xb687d8[_0x220ea1(0x1e1)]&&checkPendingInvitationsForCurrentUser(_0xb687d8['currentUser']['uid']);}),document['addEventListener']('click',_0x386225=>{const _0x52a901=_0x224635;_0x386225['target']['closest']('a[href]')&&_0xb687d8['currentUser']&&checkPendingInvitationsForCurrentUser(_0xb687d8['currentUser'][_0x52a901(0x201)]);});});export{updateAuthSection};
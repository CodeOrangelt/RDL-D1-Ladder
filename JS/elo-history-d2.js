const a12_0x345eb2=a12_0x2a1e,a12_0x1f038b=(function(){let _0x22ae94=!![];return function(_0x28bd00,_0x27d97a){const _0x17235d=_0x22ae94?function(){const _0x24b694=a12_0x2a1e;if(_0x27d97a){const _0x58becf=_0x27d97a[_0x24b694(0x10e)](_0x28bd00,arguments);return _0x27d97a=null,_0x58becf;}}:function(){};return _0x22ae94=![],_0x17235d;};}()),a12_0x603fef=a12_0x1f038b(this,function(){const _0x12da98=a12_0x2a1e;let _0x22c241;try{const _0x164a74=Function(_0x12da98(0x10c)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x22c241=_0x164a74();}catch(_0x4daab1){_0x22c241=window;}const _0x1c1cd3=_0x22c241['console']=_0x22c241[_0x12da98(0x10f)]||{},_0x5d8c9b=['log','warn','info','error','exception','table','trace'];for(let _0x319e38=0x0;_0x319e38<_0x5d8c9b['length'];_0x319e38++){const _0x2a462f=a12_0x1f038b['constructor']['prototype'][_0x12da98(0x119)](a12_0x1f038b),_0x1d64b9=_0x5d8c9b[_0x319e38],_0x50d799=_0x1c1cd3[_0x1d64b9]||_0x2a462f;_0x2a462f[_0x12da98(0x11c)]=a12_0x1f038b['bind'](a12_0x1f038b),_0x2a462f['toString']=_0x50d799['toString']['bind'](_0x50d799),_0x1c1cd3[_0x1d64b9]=_0x2a462f;}});function a12_0x2a1e(_0xff1c8d,_0x51df9b){const _0x603fef=a12_0x228a();return a12_0x2a1e=function(_0x1f038b,_0x107082){_0x1f038b=_0x1f038b-0x10c;let _0x228a5a=_0x603fef[_0x1f038b];return _0x228a5a;},a12_0x2a1e(_0xff1c8d,_0x51df9b);}a12_0x603fef();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D2=[{'name':a12_0x345eb2(0x110),'elo':0x708},{'name':'Silver','elo':0x640},{'name':'Bronze','elo':0x578},{'name':'Unranked','elo':0x4b0}];let lastVisibleD2=null;async function getUsernameByIdD2(_0x5dc8f1){const _0x4ff145=a12_0x345eb2;try{if(!_0x5dc8f1)return'Unknown\x20Player';const _0x431784=await getDoc(doc(db,'playersD2',_0x5dc8f1));if(_0x431784['exists']())return _0x431784['data']()['username']||'Unknown\x20Player';const _0x2b2a11=await getDocs(query(collection(db,'approvedMatchesD2'),where('winnerId','==',_0x5dc8f1),limit(0x1)));if(!_0x2b2a11['empty'])return _0x2b2a11['docs'][0x0]['data']()['winnerUsername']||_0x4ff145(0x111);const _0x3dbcdc=await getDocs(query(collection(db,'approvedMatchesD2'),where('loserId','==',_0x5dc8f1),limit(0x1)));if(!_0x3dbcdc['empty'])return _0x3dbcdc[_0x4ff145(0x11a)][0x0]['data']()['loserUsername']||'Unknown\x20Player';return'Unknown\x20Player';}catch(_0xfbdd16){return console['error'](_0x4ff145(0x113),_0xfbdd16),'Unknown\x20Player';}}export async function recordEloChangeD2({playerId:_0x4a8af6,previousElo:_0x3645f8,newElo:_0x3eb277,opponentId:_0x333e66,matchResult:_0x23a0f1,previousPosition:_0x2633e7,newPosition:_0x165e32,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x32dd88,timestamp:_0x2a03e3}){const _0x114580=a12_0x345eb2;try{const _0xdca488=doc(collection(db,'eloHistoryD2'));let _0x484a3a='match';if(isPromotion)_0x484a3a=_0x114580(0x11b);if(isDemotion)_0x484a3a=_0x114580(0x11d);let _0x5bcead=_0x114580(0x11e);if(_0x3eb277>=0x834)_0x5bcead='Emerald';else{if(_0x3eb277>=0x708)_0x5bcead='Gold';else{if(_0x3eb277>=0x640)_0x5bcead=_0x114580(0x10d);else{if(_0x3eb277>=0x578)_0x5bcead=_0x114580(0x117);}}}return await setDoc(_0xdca488,{'type':_0x484a3a,'player':_0x4a8af6,'opponent':_0x333e66,'previousElo':_0x3645f8,'newElo':_0x3eb277,'change':_0x3eb277-_0x3645f8,'matchResult':_0x23a0f1,'previousPosition':_0x2633e7,'newPosition':_0x165e32,'rankAchieved':_0x5bcead,'matchId':_0x32dd88,'timestamp':_0x2a03e3}),console['log']('D2\x20ELO\x20history\x20recorded\x20for\x20'+_0x4a8af6),!![];}catch(_0x37323d){console[_0x114580(0x118)]('Error\x20recording\x20D2\x20ELO\x20history:',_0x37323d);throw _0x37323d;}}function a12_0x228a(){const _0x5e7c5c=['return\x20(function()\x20','Silver','apply','console','Gold','Unknown\x20Player','Error\x20fetching\x20D2\x20ELO\x20history:','Error\x20getting\x20username:','data','length','desc','Bronze','error','bind','docs','promotion','__proto__','demotion','Unranked'];a12_0x228a=function(){return _0x5e7c5c;};return a12_0x228a();}export async function getEloHistoryD2(_0x2e8623=0x14){const _0x239c19=a12_0x345eb2;try{const _0x2e446e=collection(db,'eloHistoryD2');let _0x412716;lastVisibleD2?_0x412716=query(_0x2e446e,orderBy('timestamp',_0x239c19(0x116)),startAfter(lastVisibleD2),limit(_0x2e8623)):_0x412716=query(_0x2e446e,orderBy('timestamp','desc'),limit(_0x2e8623));const _0x554fa6=await getDocs(_0x412716);if(_0x554fa6['empty'])return{'entries':[],'hasMore':![]};lastVisibleD2=_0x554fa6['docs'][_0x554fa6[_0x239c19(0x11a)][_0x239c19(0x115)]-0x1];const _0x521f86=_0x554fa6[_0x239c19(0x11a)]['map'](async _0x4ff872=>{const _0x4051ea=_0x239c19,_0x19ecd1=_0x4ff872[_0x4051ea(0x114)](),[_0x591763,_0x57b104]=await Promise['all']([getUsernameByIdD2(_0x19ecd1['player']),getUsernameByIdD2(_0x19ecd1['opponent'])]);return{..._0x19ecd1,'playerUsername':_0x591763,'opponentUsername':_0x57b104,'change':_0x19ecd1['newElo']-_0x19ecd1['previousElo'],'timestamp':_0x19ecd1['timestamp']};}),_0x2a8d32=await Promise['all'](_0x521f86);return{'entries':_0x2a8d32,'hasMore':_0x554fa6['size']===_0x2e8623};}catch(_0x430adf){console[_0x239c19(0x118)](_0x239c19(0x112),_0x430adf);throw _0x430adf;}}export function resetPaginationD2(){lastVisibleD2=null;}
const a35_0x2d345c=a35_0x28c6,a35_0x5c8cbc=(function(){let _0x4c745f=!![];return function(_0x68ff39,_0x4e2c05){const _0x4890e1=_0x4c745f?function(){if(_0x4e2c05){const _0x31629c=_0x4e2c05['apply'](_0x68ff39,arguments);return _0x4e2c05=null,_0x31629c;}}:function(){};return _0x4c745f=![],_0x4890e1;};}()),a35_0x4ffb29=a35_0x5c8cbc(this,function(){const _0x216f31=a35_0x28c6;let _0xdea625;try{const _0xc3d18c=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0xdea625=_0xc3d18c();}catch(_0x221142){_0xdea625=window;}const _0x17a0a=_0xdea625['console']=_0xdea625['console']||{},_0x5b5197=[_0x216f31(0x204),_0x216f31(0x1f1),'info',_0x216f31(0x1f8),'exception','table','trace'];for(let _0x209c25=0x0;_0x209c25<_0x5b5197['length'];_0x209c25++){const _0x2065d6=a35_0x5c8cbc['constructor'][_0x216f31(0x205)][_0x216f31(0x20c)](a35_0x5c8cbc),_0x36802c=_0x5b5197[_0x209c25],_0x21dd9d=_0x17a0a[_0x36802c]||_0x2065d6;_0x2065d6[_0x216f31(0x1f6)]=a35_0x5c8cbc['bind'](a35_0x5c8cbc),_0x2065d6[_0x216f31(0x214)]=_0x21dd9d['toString']['bind'](_0x21dd9d),_0x17a0a[_0x36802c]=_0x2065d6;}});a35_0x4ffb29();const functions=require('firebase-functions'),admin=require('firebase-admin');admin['initializeApp']();const db=admin['firestore']();function a35_0x28c6(_0xe3b0ba,_0x1b88af){const _0x4ffb29=a35_0x1d4f();return a35_0x28c6=function(_0x5c8cbc,_0x2bdc93){_0x5c8cbc=_0x5c8cbc-0x1ef;let _0x1d4f18=_0x4ffb29[_0x5c8cbc];return _0x1d4f18;},a35_0x28c6(_0xe3b0ba,_0x1b88af);}exports['updateMembersList']=functions['firestore']['document'](a35_0x2d345c(0x207))['onWrite'](async(_0x4ebbf9,_0xf90219)=>{const _0x595c4c=a35_0x2d345c,_0x4f7765=_0xf90219['params']['collection'],_0x4d79ce=_0xf90219[_0x595c4c(0x215)]['docId'];if(!['players','playersD2','playersD3',_0x595c4c(0x217),'nonParticipants'][_0x595c4c(0x20f)](_0x4f7765))return null;try{await rebuildMembersList(),console['log'](_0x595c4c(0x1ef));}catch(_0x485427){console['error'](_0x595c4c(0x200),_0x485427);}});function a35_0x1d4f(){const _0x49968b=['Successfully\x20updated\x20aggregated\x20members\x20list','emerald','warn','Members\x20list\x20rebuilt\x20successfully','ref','get','doc','__proto__','set','error','has','collection','favoriteMap','country','all','motto','serverTimestamp','Error\x20updating\x20members\x20list:','nonParticipants','forEach','elo','log','prototype','favoriteWeapon','{collection}/{docId}','delete','rebuildMembersListManual','playersD3','ladders','bind','Error\x20rebuilding\x20members\x20list','username','includes','length','data','userId','batch','toString','params','players','userProfiles','push'];a35_0x1d4f=function(){return _0x49968b;};return a35_0x1d4f();}async function rebuildMembersList(){const _0x556677=a35_0x2d345c,_0x7cdc7a=db[_0x556677(0x213)](),[_0x30a3ef,_0x13693a,_0x1b1aa4,_0x10486c,_0x24f074]=await Promise['all']([db['collection']('userProfiles')['get'](),db['collection'](_0x556677(0x216))[_0x556677(0x1f4)](),db['collection']('playersD2')[_0x556677(0x1f4)](),db['collection'](_0x556677(0x20a))['get'](),db['collection'](_0x556677(0x201))[_0x556677(0x1f4)]()]),_0x2f32f1=new Map();_0x30a3ef[_0x556677(0x202)](_0xced933=>{_0x2f32f1['set'](_0xced933['id'],_0xced933['data']());});const _0x1bc3da=new Map(),_0x205fe0=(_0x22d7b8,_0x152e90)=>{const _0x17a618=_0x556677;_0x22d7b8[_0x17a618(0x202)](_0x2e9f99=>{const _0x396a1e=_0x17a618,_0x23a660=_0x2e9f99[_0x396a1e(0x211)](),_0x4c3f5b=_0x2e9f99['id'];!_0x1bc3da[_0x396a1e(0x1f9)](_0x4c3f5b)&&_0x1bc3da['set'](_0x4c3f5b,{'userId':_0x4c3f5b,'username':_0x23a660['username']||'Unknown','ladders':[],'isNonParticipant':![]});const _0x5f25cb=_0x1bc3da['get'](_0x4c3f5b);_0x5f25cb['ladders']['push']({'ladder':_0x152e90,'elo':_0x23a660['eloRating']||0x4b0,'active':_0x23a660['active']!==![]});});};_0x205fe0(_0x13693a,'D1'),_0x205fe0(_0x1b1aa4,'D2'),_0x205fe0(_0x10486c,'D3'),_0x24f074['forEach'](_0x3d474a=>{const _0x1b5bad=_0x556677,_0x45d4d6=_0x3d474a[_0x1b5bad(0x211)](),_0x296598=_0x3d474a['id'];!_0x1bc3da['has'](_0x296598)&&_0x45d4d6['username']&&_0x1bc3da[_0x1b5bad(0x1f7)](_0x296598,{'userId':_0x296598,'username':_0x45d4d6['username'],'ladders':[],'isNonParticipant':!![]});});const _0x31d603=[];_0x1bc3da['forEach']((_0x24b6ed,_0x304e95)=>{const _0x1a2934=_0x556677,_0x41d28d=_0x2f32f1['get'](_0x304e95)||{};let _0x9bf869=0x0,_0x35d02c=null;if(_0x24b6ed['ladders'][_0x1a2934(0x210)]>0x0){const _0x2f6b3e=_0x24b6ed[_0x1a2934(0x20b)]['sort']((_0x5090e1,_0x13c6a0)=>_0x13c6a0[_0x1a2934(0x203)]-_0x5090e1['elo']);_0x9bf869=_0x2f6b3e[0x0]['elo'],_0x35d02c=_0x2f6b3e[0x0]['ladder'];}const _0x1a0e87={'userId':_0x304e95,'username':_0x24b6ed[_0x1a2934(0x20e)],'profileImageUrl':_0x41d28d['profileImageUrl']||null,'country':_0x41d28d[_0x1a2934(0x1fc)]||null,'motto':_0x41d28d[_0x1a2934(0x1fe)]||null,'favoriteMap':_0x41d28d[_0x1a2934(0x1fb)]||null,'favoriteWeapon':_0x41d28d[_0x1a2934(0x206)]||null,'isNonParticipant':_0x24b6ed['isNonParticipant'],'ladders':_0x24b6ed['ladders'],'primaryLadder':_0x35d02c,'highestElo':_0x9bf869,'rank':getPlayerRank(_0x9bf869),'lastUpdated':admin['firestore']['FieldValue'][_0x1a2934(0x1ff)]()};_0x31d603['push'](_0x1a0e87);});const _0x369f01=db[_0x556677(0x1fa)]('aggregatedMembers'),_0x5d5d2e=await _0x369f01['get'](),_0x5958a6=[];_0x5d5d2e['forEach'](_0x5c410d=>{const _0x5e5cb8=_0x556677;_0x5958a6[_0x5e5cb8(0x218)](_0x5c410d[_0x5e5cb8(0x1f3)][_0x5e5cb8(0x208)]());}),await Promise[_0x556677(0x1fd)](_0x5958a6);const _0x41bf1f=0x1f4,_0x51c36a=[];for(let _0x21212d=0x0;_0x21212d<_0x31d603['length'];_0x21212d+=_0x41bf1f){const _0x59c44a=db['batch'](),_0x2b027e=_0x31d603['slice'](_0x21212d,_0x21212d+_0x41bf1f);_0x2b027e['forEach'](_0x13a8c7=>{const _0x5352f4=_0x556677,_0x252447=_0x369f01[_0x5352f4(0x1f5)](_0x13a8c7[_0x5352f4(0x212)]);_0x59c44a['set'](_0x252447,_0x13a8c7);}),_0x51c36a['push'](_0x59c44a['commit']());}await Promise['all'](_0x51c36a);}function getPlayerRank(_0x886aec){const _0x117c2e=a35_0x2d345c;if(_0x886aec>=0x7d0)return _0x117c2e(0x1f0);if(_0x886aec>=0x708)return'gold';if(_0x886aec>=0x640)return'silver';if(_0x886aec>=0x578)return'bronze';return'unranked';}exports[a35_0x2d345c(0x209)]=functions['https']['onRequest'](async(_0x45644c,_0x49cfe7)=>{const _0x1a867=a35_0x2d345c;try{await rebuildMembersList(),_0x49cfe7['status'](0xc8)['send'](_0x1a867(0x1f2));}catch(_0x993f65){console[_0x1a867(0x1f8)]('Error\x20rebuilding\x20members\x20list:',_0x993f65),_0x49cfe7['status'](0x1f4)['send'](_0x1a867(0x20d));}});
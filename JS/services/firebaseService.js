const a54_0x5ce699=a54_0x4ae4,a54_0x4eb5b4=(function(){let _0xee2c46=!![];return function(_0x4d0035,_0x3a61ee){const _0xaeaa11=_0xee2c46?function(){const _0x41971c=a54_0x4ae4;if(_0x3a61ee){const _0x2e0852=_0x3a61ee[_0x41971c(0x8a)](_0x4d0035,arguments);return _0x3a61ee=null,_0x2e0852;}}:function(){};return _0xee2c46=![],_0xaeaa11;};}()),a54_0x2ad82e=a54_0x4eb5b4(this,function(){const _0x4d3b48=a54_0x4ae4,_0x47f6ef=function(){let _0x3d352b;try{_0x3d352b=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x332a78){_0x3d352b=window;}return _0x3d352b;},_0x10662f=_0x47f6ef(),_0x2c2762=_0x10662f[_0x4d3b48(0x84)]=_0x10662f['console']||{},_0x42ad3a=[_0x4d3b48(0x94),'warn','info',_0x4d3b48(0x8f),_0x4d3b48(0x81),'table','trace'];for(let _0x4a67e1=0x0;_0x4a67e1<_0x42ad3a['length'];_0x4a67e1++){const _0x1d89b7=a54_0x4eb5b4['constructor']['prototype']['bind'](a54_0x4eb5b4),_0x412bd1=_0x42ad3a[_0x4a67e1],_0x1e85de=_0x2c2762[_0x412bd1]||_0x1d89b7;_0x1d89b7[_0x4d3b48(0x93)]=a54_0x4eb5b4['bind'](a54_0x4eb5b4),_0x1d89b7['toString']=_0x1e85de['toString']['bind'](_0x1e85de),_0x2c2762[_0x412bd1]=_0x1d89b7;}});a54_0x2ad82e();import{db}from'../firebase-config.js';import{collection,doc,getDoc,getDocs,query,limit,startAfter,where,onSnapshot}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const cache={'userProfiles':new Map(),'ladderPlayers':new Map(),'matchResults':new Map(),'eloHistory':new Map()},CACHE_EXPIRY={'userProfiles':0x5*0x3c*0x3e8,'ladderPlayers':0x2*0x3c*0x3e8,'matchResults':0x1*0x3c*0x3e8,'eloHistory':0x3*0x3c*0x3e8};function a54_0x4ae4(_0x5c84c3,_0x5efa23){const _0x2ad82e=a54_0x3416();return a54_0x4ae4=function(_0x4eb5b4,_0x425cee){_0x4eb5b4=_0x4eb5b4-0x81;let _0x341679=_0x2ad82e[_0x4eb5b4];return _0x341679;},a54_0x4ae4(_0x5c84c3,_0x5efa23);}export const userProfilesRef=collection(db,a54_0x5ce699(0x8d));export async function fetchPaginatedData(_0x4881ce,_0x11a02d=0xa,_0x36550e=null){const _0x23013d=a54_0x5ce699;let _0x3077c9=query(_0x4881ce,limit(_0x11a02d));_0x36550e&&(_0x3077c9=query(_0x3077c9,startAfter(_0x36550e)));const _0x48d75f=await getDocs(_0x3077c9),_0x547507=_0x48d75f['docs'][_0x48d75f['docs']['length']-0x1];return{'data':_0x48d75f['docs']['map'](_0x10903c=>({'id':_0x10903c['id'],..._0x10903c[_0x23013d(0x90)]()})),'lastVisible':_0x547507,'hasMore':_0x48d75f['docs']['length']===_0x11a02d};}export async function getUserProfile(_0x2f1011){const _0x13b40a=a54_0x5ce699,_0x1e6838=cache['userProfiles']['get'](_0x2f1011);if(_0x1e6838&&Date['now']()-_0x1e6838['timestamp']<CACHE_EXPIRY['userProfiles'])return _0x1e6838[_0x13b40a(0x90)];const _0x479a08=await getDoc(doc(userProfilesRef,_0x2f1011));if(_0x479a08[_0x13b40a(0x85)]()){const _0x5e95a7=_0x479a08['data']();return cache[_0x13b40a(0x8d)][_0x13b40a(0x8c)](_0x2f1011,{'data':_0x5e95a7,'timestamp':Date['now']()}),_0x5e95a7;}return null;}export async function getLadderData(_0x4c8b68=0x1){const _0x49bc9d=a54_0x5ce699,_0x171923='division_'+_0x4c8b68,_0x15bc58=cache['ladderPlayers']['get'](_0x171923);if(_0x15bc58&&Date['now']()-_0x15bc58[_0x49bc9d(0x92)]<CACHE_EXPIRY['ladderPlayers'])return _0x15bc58['data'];const _0x9e2d89=_0x4c8b68===0x1?'players':'playersD'+_0x4c8b68,_0x4f06c9=collection(db,_0x9e2d89),_0xdf6749=await getDocs(query(_0x4f06c9,limit(0x64))),_0x3e4c46=_0xdf6749['docs']['map'](_0x524fb8=>({'id':_0x524fb8['id'],..._0x524fb8[_0x49bc9d(0x90)]()}));return cache[_0x49bc9d(0x8b)][_0x49bc9d(0x8c)](_0x171923,{'data':_0x3e4c46,'timestamp':Date[_0x49bc9d(0x83)]()}),_0x3e4c46;}export async function getEloHistoryBatch(_0xdec59a,_0x65a0ce=0x1){const _0x3d2682=a54_0x5ce699,_0x133605=_0x65a0ce===0x1?'eloHistory':'eloHistoryD'+_0x65a0ce,_0x56ce45=collection(db,_0x133605),_0x31e3ec={},_0xb2fd22=[];_0xdec59a['forEach'](_0x236062=>{const _0x18f61b=a54_0x4ae4,_0x49db5d=_0x236062+'_'+_0x65a0ce,_0x3ed9c0=cache['eloHistory']['get'](_0x49db5d);_0x3ed9c0&&Date['now']()-_0x3ed9c0[_0x18f61b(0x92)]<CACHE_EXPIRY['eloHistory']?_0x31e3ec[_0x236062]=_0x3ed9c0[_0x18f61b(0x90)]:_0xb2fd22[_0x18f61b(0x89)](_0x236062);});const _0x1ebf14=0xa;for(let _0x1fef35=0x0;_0x1fef35<_0xb2fd22[_0x3d2682(0x88)];_0x1fef35+=_0x1ebf14){const _0x5b9b2a=_0xb2fd22['slice'](_0x1fef35,_0x1fef35+_0x1ebf14);if(_0x5b9b2a[_0x3d2682(0x88)]>0x0)try{const _0x13f278=query(_0x56ce45,where(_0x3d2682(0x8e),'in',_0x5b9b2a),limit(0x64)),_0x40f66f=await getDocs(_0x13f278);_0x40f66f['docs'][_0x3d2682(0x87)](_0x418a00=>{const _0x30db57=_0x418a00['data'](),_0x191124=_0x30db57['playerId'];if(!_0x31e3ec[_0x191124])_0x31e3ec[_0x191124]=[];_0x31e3ec[_0x191124]['push'](_0x30db57);const _0x22d959=_0x191124+'_'+_0x65a0ce;cache['eloHistory']['set'](_0x22d959,{'data':_0x31e3ec[_0x191124],'timestamp':Date['now']()});});}catch(_0x2c6743){console[_0x3d2682(0x8f)]('Error\x20fetching\x20batch\x20ELO\x20history:',_0x2c6743);}}return _0x31e3ec;}let usernameCache=new Map(),usernameCacheTimestamp=Date['now']();export function setupEfficientListener(_0x341c46,_0xafe53=[],_0x3bff54){const _0x1ce0a8=collection(db,_0x341c46),_0x4c5609=query(_0x1ce0a8,..._0xafe53),_0x21f589=onSnapshot(_0x4c5609,_0x139db8=>{const _0x3528ff=a54_0x4ae4,_0x16354c=_0x139db8['docChanges']()['map'](_0x3cffbf=>({'type':_0x3cffbf['type'],'id':_0x3cffbf['doc']['id'],'data':_0x3cffbf['doc']['data']()}));_0x16354c['length']>0x0&&_0x3bff54(_0x16354c,_0x139db8[_0x3528ff(0x82)]);});return _0x21f589;}export async function bulkResolveUsernames(_0x2bc0aa){const _0x2efe4d=a54_0x5ce699,_0x52a34d=new Map();if(!_0x2bc0aa||_0x2bc0aa['length']===0x0)return _0x52a34d;const _0x2cd0b9=['players',_0x2efe4d(0x91),_0x2efe4d(0x86),'nonParticipants'];for(const _0x1d40ff of _0x2cd0b9){const _0x1da966=collection(db,_0x1d40ff),_0xdee22f=await getDocs(_0x1da966);_0xdee22f['forEach'](_0x1171fd=>{const _0x3313de=_0x2efe4d,_0xdda45e=_0x1171fd[_0x3313de(0x90)]();_0xdda45e['username']&&_0x2bc0aa['includes'](_0x1171fd['id'])&&_0x52a34d[_0x3313de(0x8c)](_0x1171fd['id'],_0xdda45e['username']);});}return _0x52a34d;}function a54_0x3416(){const _0xc84b95=['exception','docs','now','console','exists','playersD3','forEach','length','push','apply','ladderPlayers','set','userProfiles','playerId','error','data','playersD2','timestamp','__proto__','log'];a54_0x3416=function(){return _0xc84b95;};return a54_0x3416();}
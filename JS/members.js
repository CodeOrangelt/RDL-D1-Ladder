const a35_0x35a7b3=a35_0x53f7,a35_0x2f4647=(function(){let _0x540932=!![];return function(_0x54aee4,_0x100456){const _0x3b5313=_0x540932?function(){if(_0x100456){const _0x1b3455=_0x100456['apply'](_0x54aee4,arguments);return _0x100456=null,_0x1b3455;}}:function(){};return _0x540932=![],_0x3b5313;};}()),a35_0x33b7b5=a35_0x2f4647(this,function(){const _0x355444=a35_0x53f7,_0x4df61f=function(){let _0x2ef168;try{_0x2ef168=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x352d5c){_0x2ef168=window;}return _0x2ef168;},_0x189f62=_0x4df61f(),_0x22d558=_0x189f62[_0x355444(0x183)]=_0x189f62['console']||{},_0xa1ca65=['log','warn','info','error','exception','table','trace'];for(let _0x52edfd=0x0;_0x52edfd<_0xa1ca65[_0x355444(0x189)];_0x52edfd++){const _0x19ca91=a35_0x2f4647['constructor']['prototype']['bind'](a35_0x2f4647),_0x4c1dbd=_0xa1ca65[_0x52edfd],_0x3473a4=_0x22d558[_0x4c1dbd]||_0x19ca91;_0x19ca91[_0x355444(0x176)]=a35_0x2f4647[_0x355444(0x17f)](a35_0x2f4647),_0x19ca91['toString']=_0x3473a4['toString'][_0x355444(0x17f)](_0x3473a4),_0x22d558[_0x4c1dbd]=_0x19ca91;}});a35_0x33b7b5();const functions=require('firebase-functions'),admin=require('firebase-admin');function a35_0x2446(){const _0x53243e=['sort','batch','https','__proto__','push','bronze','{collection}/{docId}','userProfiles','doc','all','Error\x20updating\x20members\x20list:','ladders','bind','forEach','firestore','status','console','slice','get','params','send','isNonParticipant','length','nonParticipants','collection','log'];a35_0x2446=function(){return _0x53243e;};return a35_0x2446();}admin['initializeApp']();const db=admin[a35_0x35a7b3(0x181)]();function a35_0x53f7(_0x10173c,_0x42dce4){const _0x33b7b5=a35_0x2446();return a35_0x53f7=function(_0x2f4647,_0x344c89){_0x2f4647=_0x2f4647-0x173;let _0x244642=_0x33b7b5[_0x2f4647];return _0x244642;},a35_0x53f7(_0x10173c,_0x42dce4);}exports['updateMembersList']=functions['firestore']['document'](a35_0x35a7b3(0x179))['onWrite'](async(_0x24f7d3,_0x2a724a)=>{const _0x5d487a=a35_0x35a7b3,_0x9a293f=_0x2a724a['params'][_0x5d487a(0x18b)],_0x16dead=_0x2a724a[_0x5d487a(0x186)]['docId'];if(!['players','playersD2','playersD3',_0x5d487a(0x17a),_0x5d487a(0x18a)]['includes'](_0x9a293f))return null;try{await rebuildMembersList(),console[_0x5d487a(0x18c)]('Successfully\x20updated\x20aggregated\x20members\x20list');}catch(_0x42d9b9){console['error'](_0x5d487a(0x17d),_0x42d9b9);}});async function rebuildMembersList(){const _0x1fcc4e=a35_0x35a7b3,_0x7cc1be=db[_0x1fcc4e(0x174)](),[_0x11c6b6,_0x45f635,_0x53db48,_0x20fed8,_0x128486]=await Promise[_0x1fcc4e(0x17c)]([db['collection']('userProfiles')['get'](),db['collection']('players')['get'](),db['collection']('playersD2')['get'](),db[_0x1fcc4e(0x18b)]('playersD3')[_0x1fcc4e(0x185)](),db[_0x1fcc4e(0x18b)](_0x1fcc4e(0x18a))['get']()]),_0x59ecb3=new Map();_0x11c6b6[_0x1fcc4e(0x180)](_0x56dfb7=>{_0x59ecb3['set'](_0x56dfb7['id'],_0x56dfb7['data']());});const _0x255ec1=new Map(),_0x155d27=(_0x489ce8,_0x43d019)=>{_0x489ce8['forEach'](_0x178c82=>{const _0x4b1b08=a35_0x53f7,_0x2aed52=_0x178c82['data'](),_0x29abbc=_0x178c82['id'];!_0x255ec1['has'](_0x29abbc)&&_0x255ec1['set'](_0x29abbc,{'userId':_0x29abbc,'username':_0x2aed52['username']||'Unknown','ladders':[],'isNonParticipant':![]});const _0x58dce1=_0x255ec1['get'](_0x29abbc);_0x58dce1['ladders'][_0x4b1b08(0x177)]({'ladder':_0x43d019,'elo':_0x2aed52['eloRating']||0x4b0,'active':_0x2aed52['active']!==![]});});};_0x155d27(_0x45f635,'D1'),_0x155d27(_0x53db48,'D2'),_0x155d27(_0x20fed8,'D3'),_0x128486['forEach'](_0x23d252=>{const _0x413de7=_0x23d252['data'](),_0x168153=_0x23d252['id'];!_0x255ec1['has'](_0x168153)&&_0x413de7['username']&&_0x255ec1['set'](_0x168153,{'userId':_0x168153,'username':_0x413de7['username'],'ladders':[],'isNonParticipant':!![]});});const _0x464138=[];_0x255ec1['forEach']((_0x4551a1,_0x40d480)=>{const _0x551751=_0x1fcc4e,_0xdca883=_0x59ecb3['get'](_0x40d480)||{};let _0x27bf64=0x0,_0x30e27f=null;if(_0x4551a1['ladders'][_0x551751(0x189)]>0x0){const _0x2d885f=_0x4551a1[_0x551751(0x17e)][_0x551751(0x173)]((_0x4b66a7,_0x7a6dae)=>_0x7a6dae['elo']-_0x4b66a7['elo']);_0x27bf64=_0x2d885f[0x0]['elo'],_0x30e27f=_0x2d885f[0x0]['ladder'];}const _0x495083={'userId':_0x40d480,'username':_0x4551a1['username'],'profileImageUrl':_0xdca883['profileImageUrl']||null,'country':_0xdca883['country']||null,'motto':_0xdca883['motto']||null,'favoriteMap':_0xdca883['favoriteMap']||null,'favoriteWeapon':_0xdca883['favoriteWeapon']||null,'isNonParticipant':_0x4551a1[_0x551751(0x188)],'ladders':_0x4551a1['ladders'],'primaryLadder':_0x30e27f,'highestElo':_0x27bf64,'rank':getPlayerRank(_0x27bf64),'lastUpdated':admin['firestore']['FieldValue']['serverTimestamp']()};_0x464138['push'](_0x495083);});const _0x3f0451=db['collection']('aggregatedMembers'),_0x2f5e81=await _0x3f0451[_0x1fcc4e(0x185)](),_0x35fda9=[];_0x2f5e81['forEach'](_0x445b78=>{_0x35fda9['push'](_0x445b78['ref']['delete']());}),await Promise['all'](_0x35fda9);const _0x49b18c=0x1f4,_0x29ef7a=[];for(let _0x3a1e61=0x0;_0x3a1e61<_0x464138['length'];_0x3a1e61+=_0x49b18c){const _0xe8f9fe=db['batch'](),_0x3cfa99=_0x464138[_0x1fcc4e(0x184)](_0x3a1e61,_0x3a1e61+_0x49b18c);_0x3cfa99['forEach'](_0x3ae57c=>{const _0x341e06=_0x1fcc4e,_0x5e2df5=_0x3f0451[_0x341e06(0x17b)](_0x3ae57c['userId']);_0xe8f9fe['set'](_0x5e2df5,_0x3ae57c);}),_0x29ef7a[_0x1fcc4e(0x177)](_0xe8f9fe['commit']());}await Promise['all'](_0x29ef7a);}function getPlayerRank(_0x2b95ad){const _0x4af7af=a35_0x35a7b3;if(_0x2b95ad>=0x7d0)return'emerald';if(_0x2b95ad>=0x708)return'gold';if(_0x2b95ad>=0x640)return'silver';if(_0x2b95ad>=0x578)return _0x4af7af(0x178);return'unranked';}exports['rebuildMembersListManual']=functions[a35_0x35a7b3(0x175)]['onRequest'](async(_0x149695,_0x430117)=>{const _0x464c53=a35_0x35a7b3;try{await rebuildMembersList(),_0x430117[_0x464c53(0x182)](0xc8)['send']('Members\x20list\x20rebuilt\x20successfully');}catch(_0x2d7b71){console['error']('Error\x20rebuilding\x20members\x20list:',_0x2d7b71),_0x430117['status'](0x1f4)[_0x464c53(0x187)]('Error\x20rebuilding\x20members\x20list');}});
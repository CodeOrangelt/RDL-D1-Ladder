const a10_0x38c4f8=(function(){let _0xc7ecb7=!![];return function(_0x3c3320,_0x29adac){const _0x2b20a5=_0xc7ecb7?function(){if(_0x29adac){const _0x489896=_0x29adac['apply'](_0x3c3320,arguments);return _0x29adac=null,_0x489896;}}:function(){};return _0xc7ecb7=![],_0x2b20a5;};}()),a10_0x30ba34=a10_0x38c4f8(this,function(){const _0x4c0fd2=a10_0x36c6,_0x14ce5f=function(){const _0xa8013d=a10_0x36c6;let _0x3ca03c;try{_0x3ca03c=Function(_0xa8013d(0xa3)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x16e0ab){_0x3ca03c=window;}return _0x3ca03c;},_0x3d43f3=_0x14ce5f(),_0x18d02a=_0x3d43f3['console']=_0x3d43f3['console']||{},_0x5d8916=[_0x4c0fd2(0x84),_0x4c0fd2(0xaa),_0x4c0fd2(0xa5),'error','exception',_0x4c0fd2(0xae),_0x4c0fd2(0xa1)];for(let _0x46845d=0x0;_0x46845d<_0x5d8916['length'];_0x46845d++){const _0x3d2672=a10_0x38c4f8['constructor'][_0x4c0fd2(0x85)]['bind'](a10_0x38c4f8),_0xb97f30=_0x5d8916[_0x46845d],_0x2d1fca=_0x18d02a[_0xb97f30]||_0x3d2672;_0x3d2672['__proto__']=a10_0x38c4f8[_0x4c0fd2(0x9a)](a10_0x38c4f8),_0x3d2672['toString']=_0x2d1fca[_0x4c0fd2(0x88)]['bind'](_0x2d1fca),_0x18d02a[_0xb97f30]=_0x3d2672;}});a10_0x30ba34();import{getAuth,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{doc,getDoc,collection,query,where,getDocs,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import{isAdmin}from'./admin-check.js';const ADMIN_EMAILS=['admin@ladder.com','Brian2af@outlook.com'],userCache={'uid':null,'username':null,'isAdmin':![],'hasCheckedCollections':![],'lastChecked':0x0,'role':null},invitationCache={'lastCheck':0x0,'pendingCount':0x0,'checkInterval':0x493e0};function updateInboxNotification(_0x181579){const _0x592b08=a10_0x36c6,_0x30d9a7=document['getElementById']('inbox-notification');_0x30d9a7&&(_0x181579>0x0?(_0x30d9a7[_0x592b08(0x8a)]['display']='inline-block',_0x30d9a7[_0x592b08(0x9e)]=_0x181579>0x9?'9+':_0x181579):_0x30d9a7['style'][_0x592b08(0x8f)]='none');}async function checkPendingInvitationsForCurrentUser(_0x15a67b){const _0x42fc5c=a10_0x36c6;try{const _0xadc334=Date['now']();if(_0xadc334-invitationCache['lastCheck']<invitationCache['checkInterval'])return updateInboxNotification(invitationCache['pendingCount']),invitationCache['pendingCount'];invitationCache[_0x42fc5c(0x82)]=_0xadc334;const _0x55dc89=collection(db,'gameInvitations'),_0x888770=query(_0x55dc89,where(_0x42fc5c(0x96),'==',_0x15a67b),where('status','==','pending'),limit(0x5)),_0x5d405b=await getDocs(_0x888770),_0x5adf32=_0x5d405b[_0x42fc5c(0x91)];return invitationCache['pendingCount']=_0x5adf32,updateInboxNotification(_0x5adf32),_0x5adf32;}catch(_0x224f2f){return console[_0x42fc5c(0xaa)]('Could\x20not\x20check\x20pending\x20invitations\x20for\x20current\x20user:',_0x224f2f),0x0;}}function updateAuthSectionImmediate(_0x395cd2,_0x2d072d=![]){const _0x3a8400=a10_0x36c6,_0x487b3e=document['getElementById']('auth-section');if(!_0x487b3e)return;if(_0x395cd2&&_0x2d072d)document['querySelectorAll']('.admin-only')['forEach'](_0x359698=>{const _0x1d82bf=a10_0x36c6;_0x359698['style']['display']=_0x1d82bf(0x94);});else!_0x395cd2&&document[_0x3a8400(0x83)]('.admin-only')['forEach'](_0x2d340a=>{_0x2d340a['style']['display']='none';});if(_0x395cd2){const _0x709b5=userCache[_0x3a8400(0x99)]||(_0x395cd2[_0x3a8400(0x81)]?_0x395cd2['email']['split']('@')[0x0]:_0x3a8400(0xad)),_0x4c9190=userCache['role']?'\x20('+userCache['role']+')':_0x2d072d?_0x3a8400(0x97):'';_0x487b3e['innerHTML']=_0x3a8400(0xa7)+_0x709b5+_0x4c9190+'</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username='+encodeURIComponent(_0x709b5)+'\x22>Profile</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./inbox.html\x22\x20class=\x22nav-notification\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Inbox\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22inbox-notification\x22\x20class=\x22notification-dot\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22members.html\x22>Members</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./redeem.html\x22><i\x20class=\x22fas\x20fa-gift\x22></i>Store</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20id=\x22logout-link\x22>Sign\x20Out</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';const _0x1c4454=document['getElementById']('logout-link');_0x1c4454&&_0x1c4454['addEventListener']('click',_0x3065d0=>{_0x3065d0['preventDefault']();const _0x3a926b=getAuth();updateAuthSectionImmediate(null),_0x3a926b['signOut']()['catch'](_0x1c497f=>{console['error']('Error\x20signing\x20out:',_0x1c497f);});}),_0x395cd2[_0x3a8400(0x8d)]&&setTimeout(()=>{const _0x17bd66=_0x3a8400;checkPendingInvitationsForCurrentUser(_0x395cd2[_0x17bd66(0x8d)]);},0x3e8);}else _0x487b3e['innerHTML']='<a\x20href=\x22login.html\x22\x20class=\x22login-link\x22>Login</a>';}async function checkAdminRoles(_0x1bf459){const _0x27835e=a10_0x36c6;if(!_0x1bf459||!_0x1bf459[_0x27835e(0x81)])return{'isAdmin':![],'role':null};try{console['log']('Checking\x20roles\x20for\x20user:\x20'+_0x1bf459['email']);const _0x4bee2b=['players',_0x27835e(0x93),_0x27835e(0xa8),'nonParticipants','userProfiles'],_0x190a45=['council','creative\x20lead','owner','admin'];for(const _0x16ea6e of _0x4bee2b){try{const _0x128ef3=doc(db,_0x16ea6e,_0x1bf459[_0x27835e(0x8d)]),_0x340f38=await getDoc(_0x128ef3);if(_0x340f38['exists']()){const _0x255f7c=_0x340f38['data']();console['log']('Found\x20user\x20in\x20'+_0x16ea6e+'\x20by\x20UID:',_0x255f7c);let _0x542c94=(_0x255f7c[_0x27835e(0x98)]||_0x255f7c[_0x27835e(0x92)]||'')['toLowerCase'](),_0xde6922=_0x255f7c['roleName']||_0x255f7c[_0x27835e(0x92)]||'';if(_0x542c94&&_0x190a45[_0x27835e(0x9f)](_0x542c94)){console['log']('Found\x20admin\x20role:\x20'+_0x542c94+'\x20in\x20'+_0x16ea6e);const _0xbe9652=_0xde6922['split']('\x20')[_0x27835e(0x86)](_0x480a6a=>_0x480a6a[_0x27835e(0x95)](0x0)['toUpperCase']()+_0x480a6a['slice'](0x1)['toLowerCase']())['join']('\x20');return{'isAdmin':!![],'role':_0xbe9652};}}}catch(_0x5c10f6){console['error']('Error\x20checking\x20'+_0x16ea6e+'\x20by\x20UID:',_0x5c10f6);}}for(const _0xa3b030 of _0x4bee2b){try{const _0xaee208=collection(db,_0xa3b030);let _0x5eada4=query(_0xaee208,where(_0x27835e(0x81),'==',_0x1bf459[_0x27835e(0x81)])),_0x32b40f=await getDocs(_0x5eada4);_0x32b40f['empty']&&(_0x5eada4=query(_0xaee208,where('email','==',_0x1bf459['email'][_0x27835e(0x89)]())),_0x32b40f=await getDocs(_0x5eada4));if(!_0x32b40f['empty']){const _0x134a83=_0x32b40f['docs'][0x0]['data']();console['log'](_0x27835e(0x8e)+_0xa3b030+'\x20by\x20email:',_0x134a83);let _0x36dbf0=(_0x134a83[_0x27835e(0x98)]||_0x134a83['role']||'')['toLowerCase'](),_0x550407=_0x134a83['roleName']||_0x134a83['role']||'';if(_0x36dbf0&&_0x190a45['includes'](_0x36dbf0)){console['log'](_0x27835e(0x87)+_0x36dbf0+'\x20in\x20'+_0xa3b030);const _0x3a7a45=_0x550407[_0x27835e(0x9d)]('\x20')['map'](_0x54b570=>_0x54b570[_0x27835e(0x95)](0x0)['toUpperCase']()+_0x54b570[_0x27835e(0x8b)](0x1)['toLowerCase']())[_0x27835e(0xaf)]('\x20');return{'isAdmin':!![],'role':_0x3a7a45};}}}catch(_0x27ef80){console[_0x27835e(0xab)]('Error\x20checking\x20'+_0xa3b030+'\x20by\x20email:',_0x27ef80);}}return console[_0x27835e(0x84)]('No\x20admin\x20roles\x20found\x20for\x20user'),{'isAdmin':![],'role':null};}catch(_0x262963){return console['error'](_0x27835e(0x8c),_0x262963),{'isAdmin':![],'role':null};}}function a10_0x36c6(_0x1f1f14,_0x450965){const _0x30ba34=a10_0x434f();return a10_0x36c6=function(_0x38c4f8,_0x4f7022){_0x38c4f8=_0x38c4f8-0x80;let _0x434fee=_0x30ba34[_0x38c4f8];return _0x434fee;},a10_0x36c6(_0x1f1f14,_0x450965);}async function updateAuthSection(_0x580e87){const _0x11fead=a10_0x36c6,_0x3efc95=_0x580e87&&isAdmin(_0x580e87['email']);updateAuthSectionImmediate(_0x580e87,_0x3efc95);if(!_0x580e87){userCache[_0x11fead(0x8d)]=null,userCache['username']=null,userCache[_0x11fead(0xac)]=![],userCache['hasCheckedCollections']=![],userCache[_0x11fead(0x92)]=null;return;}const _0x39009b=Date['now']();if(_0x580e87['uid']===userCache['uid']&&userCache['hasCheckedCollections']&&_0x39009b-userCache['lastChecked']<0x493e0)return;try{userCache['uid']=_0x580e87['uid'],userCache['lastChecked']=_0x39009b;const _0x3cc796=isAdmin(_0x580e87[_0x11fead(0x81)]);userCache['isAdmin']=_0x3cc796;if(!_0x3cc796){const {isAdmin:_0x20cec4,role:_0x52d5de}=await checkAdminRoles(_0x580e87);userCache['isAdmin']=_0x20cec4,userCache['role']=_0x52d5de,_0x20cec4&&(document['querySelectorAll']('.admin-only')[_0x11fead(0xa0)](_0x32edfd=>{const _0x3faba3=_0x11fead;_0x32edfd[_0x3faba3(0x8a)]['display']='block';}),updateAuthSectionImmediate(_0x580e87,!![]));}const _0x39f3a1=['players',_0x11fead(0x93),_0x11fead(0xa8),_0x11fead(0xa4),_0x11fead(0xa2),'nonParticipants','userProfiles'],_0x4fe31c=_0x39f3a1[_0x11fead(0x86)](_0x1966ad=>getDoc(doc(db,_0x1966ad,_0x580e87['uid']))[_0x11fead(0x80)](_0x2ef87a=>_0x2ef87a[_0x11fead(0x9b)]()?{'collection':_0x1966ad,'data':_0x2ef87a['data']()}:null)[_0x11fead(0xa9)](()=>null)),_0x218d14=await Promise[_0x11fead(0x9c)](_0x4fe31c),_0x101194=_0x218d14[_0x11fead(0x90)](_0x17347d=>_0x17347d!==null);let _0x5ac2a7=null;for(const _0x16e881 of _0x101194){if(_0x16e881['data'][_0x11fead(0x99)]){_0x5ac2a7=_0x16e881['data'][_0x11fead(0x99)];break;}}userCache[_0x11fead(0x99)]=_0x5ac2a7||(_0x580e87['email']?_0x580e87['email']['split']('@')[0x0]:'User'),userCache['hasCheckedCollections']=!![],updateAuthSectionImmediate(_0x580e87,userCache[_0x11fead(0xac)]),setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0x580e87['uid']);},0x1f4);}catch(_0x1b7047){console['error']('Error\x20in\x20full\x20auth\x20update:',_0x1b7047);}}document['addEventListener']('DOMContentLoaded',()=>{const _0x39bb7a=getAuth();onAuthStateChanged(_0x39bb7a,async _0x5dfdaf=>{await updateAuthSection(_0x5dfdaf),_0x5dfdaf&&checkPendingInvitationsForCurrentUser(_0x5dfdaf['uid']);}),document['addEventListener']('visibilitychange',()=>{const _0xa6a04f=a10_0x36c6;!document['hidden']&&_0x39bb7a['currentUser']&&checkPendingInvitationsForCurrentUser(_0x39bb7a['currentUser'][_0xa6a04f(0x8d)]);}),document['addEventListener']('click',_0x43e79b=>{const _0x1ae2b3=a10_0x36c6;_0x43e79b['target']['closest']('a[href]')&&_0x39bb7a[_0x1ae2b3(0xa6)]&&checkPendingInvitationsForCurrentUser(_0x39bb7a[_0x1ae2b3(0xa6)]['uid']);});});function a10_0x434f(){const _0x4340bd=['then','email','lastCheck','querySelectorAll','log','prototype','map','Found\x20admin\x20role:\x20','toString','toLowerCase','style','slice','Error\x20in\x20checkAdminRoles:','uid','Found\x20user\x20in\x20','display','filter','size','role','playersD2','block','charAt','toUserId','\x20(Admin)','roleName','username','bind','exists','all','split','textContent','includes','forEach','trace','playersCTF','return\x20(function()\x20','playersDuos','info','currentUser','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20class=\x22nav-username\x22>','playersD3','catch','warn','error','isAdmin','User','table','join'];a10_0x434f=function(){return _0x4340bd;};return a10_0x434f();}export{updateAuthSection};
(function(_0x25a224,_0x5107c3){const _0x33d553=a29_0x486f,_0x21b1d9=_0x25a224();while(!![]){try{const _0x5ae697=parseInt(_0x33d553(0x1be))/0x1*(-parseInt(_0x33d553(0x19a))/0x2)+parseInt(_0x33d553(0x196))/0x3+parseInt(_0x33d553(0x197))/0x4*(-parseInt(_0x33d553(0x1c7))/0x5)+parseInt(_0x33d553(0x1b2))/0x6+-parseInt(_0x33d553(0x1a0))/0x7*(parseInt(_0x33d553(0x192))/0x8)+-parseInt(_0x33d553(0x19c))/0x9+parseInt(_0x33d553(0x1bc))/0xa;if(_0x5ae697===_0x5107c3)break;else _0x21b1d9['push'](_0x21b1d9['shift']());}catch(_0x121c37){_0x21b1d9['push'](_0x21b1d9['shift']());}}}(a29_0x4f65,0x70fed));const a29_0x3f1381=(function(){let _0x2e2c86=!![];return function(_0xce591,_0x35714e){const _0x3b4aaf=_0x2e2c86?function(){const _0x9c271a=a29_0x486f;if(_0x35714e){const _0x3adda5=_0x35714e[_0x9c271a(0x1c0)](_0xce591,arguments);return _0x35714e=null,_0x3adda5;}}:function(){};return _0x2e2c86=![],_0x3b4aaf;};}()),a29_0x59a685=a29_0x3f1381(this,function(){const _0x5288e5=a29_0x486f;return a29_0x59a685['toString']()['search']('(((.+)+)+)+$')['toString']()['constructor'](a29_0x59a685)[_0x5288e5(0x19f)]('(((.+)+)+)+$');});a29_0x59a685();const a29_0x217362=(function(){let _0x4da28a=!![];return function(_0x6d961b,_0x5165c4){const _0x2114f4=_0x4da28a?function(){if(_0x5165c4){const _0x116360=_0x5165c4['apply'](_0x6d961b,arguments);return _0x5165c4=null,_0x116360;}}:function(){};return _0x4da28a=![],_0x2114f4;};}()),a29_0x3ce80d=a29_0x217362(this,function(){const _0x5e97bb=a29_0x486f,_0x50e611=function(){const _0x197150=a29_0x486f;let _0x363a55;try{_0x363a55=Function(_0x197150(0x1b4)+_0x197150(0x1a7)+');')();}catch(_0x5f0d19){_0x363a55=window;}return _0x363a55;},_0x43cb6b=_0x50e611(),_0x20af12=_0x43cb6b['console']=_0x43cb6b['console']||{},_0x3ebd07=[_0x5e97bb(0x1af),_0x5e97bb(0x1bf),'info',_0x5e97bb(0x1c1),'exception',_0x5e97bb(0x1b1),_0x5e97bb(0x1a2)];for(let _0x4eb099=0x0;_0x4eb099<_0x3ebd07['length'];_0x4eb099++){const _0xe9b874=a29_0x217362[_0x5e97bb(0x19d)][_0x5e97bb(0x1a1)][_0x5e97bb(0x1ae)](a29_0x217362),_0x3e4361=_0x3ebd07[_0x4eb099],_0x5586d0=_0x20af12[_0x3e4361]||_0xe9b874;_0xe9b874[_0x5e97bb(0x1a3)]=a29_0x217362[_0x5e97bb(0x1ae)](a29_0x217362),_0xe9b874[_0x5e97bb(0x1a8)]=_0x5586d0[_0x5e97bb(0x1a8)][_0x5e97bb(0x1ae)](_0x5586d0),_0x20af12[_0x3e4361]=_0xe9b874;}});a29_0x3ce80d();import{addDoc,updateDoc,serverTimestamp,collection,doc,getDoc,getDocs,query,where,setDoc,deleteDoc,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';import{recordEloChangeD3}from'./elo-history-d3.js';function a29_0x4f65(){const _0x5ebc25=['currentUser','data','Starting\x20approveReportD3\x20function\x20with:','{}.constructor(\x22return\x20this\x22)(\x20)','toString','D3\x20Match\x20successfully\x20approved\x20and\x20ELO\x20updated','uid','win','Error\x20in\x20approveReportD3:','loserUsername','bind','log','empty','table','5091252sdMyZY','username','return\x20(function()\x20','approvedMatchesD3','docs','pow','all','One\x20or\x20both\x20D3\x20players\x20not\x20found','exists','createdAt','1683830RZbhit','position','87832XeVVhF','warn','apply','error','winnerUsername','Could\x20not\x20find\x20D3\x20player\x20documents','D3\x20Report\x20data:','email','eloRating','5kVEoAA','Only\x20the\x20winner\x20can\x20approve\x20D3\x20matches','update','D3\x20match\x20report\x20not\x20found','1392TMROfi','MAX_SAFE_INTEGER','D3\x20Report\x20not\x20found\x20with\x20ID:','D3\x20Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions','1628538AjRDLG','723364rlEfdv','commit','Current\x20username:','4sTEyqB','playersD3','6129927Sewcle','constructor','D3\x20ELO\x20ratings\x20updated\x20successfully','search','2387hGeccx','prototype','trace','__proto__'];a29_0x4f65=function(){return _0x5ebc25;};return a29_0x4f65();}export function calculateEloD3(_0xd23b8c,_0x49d121,_0x7ab3cf=0x20){const _0x59a27e=a29_0x486f,_0x2f196f=0x1/(0x1+Math[_0x59a27e(0x1b7)](0xa,(_0x49d121-_0xd23b8c)/0x190)),_0x3799c4=0x1/(0x1+Math['pow'](0xa,(_0xd23b8c-_0x49d121)/0x190)),_0x10cabe=_0xd23b8c+_0x7ab3cf*(0x1-_0x2f196f),_0x1f7bfd=_0x49d121+_0x7ab3cf*(0x0-_0x3799c4);return{'newWinnerRating':Math['round'](_0x10cabe),'newLoserRating':Math['round'](_0x1f7bfd)};}function a29_0x486f(_0x429eb5,_0x187b5e){const _0xf3cad3=a29_0x4f65();return a29_0x486f=function(_0x3ce80d,_0x217362){_0x3ce80d=_0x3ce80d-0x190;let _0x3e4530=_0xf3cad3[_0x3ce80d];return _0x3e4530;},a29_0x486f(_0x429eb5,_0x187b5e);}export async function updateEloRatingsD3(_0x290ca5,_0x32ac49,_0x299fc6){const _0x3fc0b9=a29_0x486f;try{const _0x54e931=writeBatch(db),_0x403457=doc(db,_0x3fc0b9(0x19b),_0x290ca5),_0x6b680f=doc(db,_0x3fc0b9(0x19b),_0x32ac49),[_0x2f68a2,_0x46522b]=await Promise[_0x3fc0b9(0x1b8)]([getDoc(_0x403457),getDoc(_0x6b680f)]);if(!_0x2f68a2[_0x3fc0b9(0x1ba)]()||!_0x46522b[_0x3fc0b9(0x1ba)]())throw new Error(_0x3fc0b9(0x1b9));const _0x4affa6=_0x2f68a2[_0x3fc0b9(0x1a5)](),_0x165a74=_0x46522b[_0x3fc0b9(0x1a5)](),_0x56d84d=_0x4affa6[_0x3fc0b9(0x1bd)]||Number['MAX_SAFE_INTEGER'],_0x1b6254=_0x165a74[_0x3fc0b9(0x1bd)]||Number[_0x3fc0b9(0x193)],{newWinnerRating:_0x2cdd4f,newLoserRating:_0x3ae9b4}=calculateEloD3(_0x4affa6[_0x3fc0b9(0x1c6)]||0x4b0,_0x165a74[_0x3fc0b9(0x1c6)]||0x4b0);let _0x3c9708=_0x56d84d,_0x5a6314=_0x1b6254;if(_0x56d84d>_0x1b6254){console['log']('D3\x20Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked'),_0x3c9708=_0x1b6254,_0x5a6314=_0x1b6254+0x1;const _0x35d7d9=query(collection(db,_0x3fc0b9(0x19b)),where(_0x3fc0b9(0x1bd),'>',_0x1b6254),where(_0x3fc0b9(0x1bd),'<',_0x56d84d)),_0x26e26b=await getDocs(_0x35d7d9);for(const _0x1ae79a of _0x26e26b[_0x3fc0b9(0x1b6)]){_0x1ae79a['id']!==_0x290ca5&&_0x1ae79a['id']!==_0x32ac49&&_0x54e931[_0x3fc0b9(0x190)](doc(db,'playersD3',_0x1ae79a['id']),{'position':_0x1ae79a[_0x3fc0b9(0x1a5)]()[_0x3fc0b9(0x1bd)]+0x1});}}else console['log'](_0x3fc0b9(0x195));return _0x54e931[_0x3fc0b9(0x190)](_0x403457,{'eloRating':_0x2cdd4f,'lastMatchDate':serverTimestamp(),'position':_0x3c9708,'lastMatchId':_0x299fc6}),_0x54e931[_0x3fc0b9(0x190)](_0x6b680f,{'eloRating':_0x3ae9b4,'lastMatchDate':serverTimestamp(),'position':_0x5a6314,'lastMatchId':_0x299fc6}),await _0x54e931[_0x3fc0b9(0x198)](),console['log'](_0x3fc0b9(0x19e)),await Promise[_0x3fc0b9(0x1b8)]([recordEloChangeD3({'playerId':_0x290ca5,'previousElo':_0x4affa6['eloRating']||0x4b0,'newElo':_0x2cdd4f,'opponentId':_0x32ac49,'matchResult':_0x3fc0b9(0x1ab),'previousPosition':_0x56d84d,'newPosition':_0x3c9708,'isPromotion':_0x3c9708<_0x56d84d,'matchId':_0x299fc6,'timestamp':serverTimestamp()}),recordEloChangeD3({'playerId':_0x32ac49,'previousElo':_0x165a74['eloRating']||0x4b0,'newElo':_0x3ae9b4,'opponentId':_0x290ca5,'matchResult':'loss','previousPosition':_0x1b6254,'newPosition':_0x5a6314,'isDemotion':_0x5a6314>_0x1b6254,'matchId':_0x299fc6,'timestamp':serverTimestamp()})]),!![];}catch(_0x3c0ff6){console[_0x3fc0b9(0x1c1)]('Error\x20in\x20updateEloRatingsD3:',_0x3c0ff6);throw _0x3c0ff6;}}export async function approveReportD3(_0x4c3365,_0x4bd7c5,_0x4bc046,_0x384a2a){const _0x2a7aa9=a29_0x486f;try{console[_0x2a7aa9(0x1af)](_0x2a7aa9(0x1a6),{'reportId':_0x4c3365,'winnerScore':_0x4bd7c5,'winnerSuicides':_0x4bc046,'winnerComment':_0x384a2a});const _0x5131eb=auth[_0x2a7aa9(0x1a4)];if(!_0x5131eb){console[_0x2a7aa9(0x1af)]('No\x20user\x20logged\x20in');throw new Error('You\x20must\x20be\x20logged\x20in\x20to\x20approve\x20D3\x20matches');}console[_0x2a7aa9(0x1af)]('Current\x20user:',_0x5131eb[_0x2a7aa9(0x1c5)]);const _0x3c6e0a=await getDoc(doc(db,_0x2a7aa9(0x19b),_0x5131eb[_0x2a7aa9(0x1aa)])),_0x20300d=_0x3c6e0a[_0x2a7aa9(0x1ba)]()?_0x3c6e0a[_0x2a7aa9(0x1a5)]()[_0x2a7aa9(0x1b3)]:null;console[_0x2a7aa9(0x1af)](_0x2a7aa9(0x199),_0x20300d);const _0x1d9443=doc(db,'pendingMatchesD3',_0x4c3365),_0x40af30=await getDoc(_0x1d9443);if(!_0x40af30[_0x2a7aa9(0x1ba)]()){console[_0x2a7aa9(0x1af)](_0x2a7aa9(0x194),_0x4c3365);throw new Error(_0x2a7aa9(0x191));}const _0x587912=_0x40af30[_0x2a7aa9(0x1a5)]();console[_0x2a7aa9(0x1af)](_0x2a7aa9(0x1c4),_0x587912);if(_0x20300d!==_0x587912['winnerUsername'])throw new Error(_0x2a7aa9(0x1c8));const _0x3d2b01={..._0x587912,'winnerScore':_0x4bd7c5,'winnerSuicides':_0x4bc046,'winnerComment':_0x384a2a,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':_0x20300d,'createdAt':_0x587912[_0x2a7aa9(0x1bb)]||serverTimestamp(),'winnerUsername':_0x587912[_0x2a7aa9(0x1c2)],'loserUsername':_0x587912[_0x2a7aa9(0x1ad)]};await setDoc(doc(db,_0x2a7aa9(0x1b5),_0x4c3365),_0x3d2b01),await deleteDoc(_0x1d9443),console[_0x2a7aa9(0x1af)]('D3\x20Match\x20moved\x20to\x20approved\x20collection');const [_0x25d47d,_0x31071c]=await Promise['all']([getDocs(query(collection(db,_0x2a7aa9(0x19b)),where('username','==',_0x587912[_0x2a7aa9(0x1c2)]))),getDocs(query(collection(db,_0x2a7aa9(0x19b)),where(_0x2a7aa9(0x1b3),'==',_0x587912[_0x2a7aa9(0x1ad)])))]);if(_0x25d47d['empty']||_0x31071c[_0x2a7aa9(0x1b0)])throw new Error(_0x2a7aa9(0x1c3));const _0xc623b7=_0x25d47d[_0x2a7aa9(0x1b6)][0x0]['id'],_0x93a576=_0x31071c[_0x2a7aa9(0x1b6)][0x0]['id'];return await updateEloRatingsD3(_0xc623b7,_0x93a576,_0x4c3365),console[_0x2a7aa9(0x1af)](_0x2a7aa9(0x1a9)),!![];}catch(_0x3f37b8){console[_0x2a7aa9(0x1c1)](_0x2a7aa9(0x1ac),_0x3f37b8);throw _0x3f37b8;}}
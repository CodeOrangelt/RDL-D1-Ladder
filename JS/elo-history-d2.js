const a12_0xe60b13=a12_0x3533,a12_0x2a2ea9=(function(){let _0xb6b230=!![];return function(_0x7baad8,_0x10e7f8){const _0x19df2c=_0xb6b230?function(){const _0x48826c=a12_0x3533;if(_0x10e7f8){const _0x2632d2=_0x10e7f8[_0x48826c(0x152)](_0x7baad8,arguments);return _0x10e7f8=null,_0x2632d2;}}:function(){};return _0xb6b230=![],_0x19df2c;};}()),a12_0x5c06ea=a12_0x2a2ea9(this,function(){const _0x25ea49=function(){const _0x136efa=a12_0x3533;let _0x55faa3;try{_0x55faa3=Function(_0x136efa(0x153)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x51021c){_0x55faa3=window;}return _0x55faa3;},_0x427672=_0x25ea49(),_0x4e1ea6=_0x427672['console']=_0x427672['console']||{},_0x3ac5cc=['log','warn','info','error','exception','table','trace'];for(let _0x2379b2=0x0;_0x2379b2<_0x3ac5cc['length'];_0x2379b2++){const _0x30a7c5=a12_0x2a2ea9['constructor']['prototype']['bind'](a12_0x2a2ea9),_0x1371cc=_0x3ac5cc[_0x2379b2],_0x54123d=_0x4e1ea6[_0x1371cc]||_0x30a7c5;_0x30a7c5['__proto__']=a12_0x2a2ea9['bind'](a12_0x2a2ea9),_0x30a7c5['toString']=_0x54123d['toString']['bind'](_0x54123d),_0x4e1ea6[_0x1371cc]=_0x30a7c5;}});a12_0x5c06ea();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a12_0x1d21(){const _0x524377=['username','Silver','Error\x20fetching\x20D2\x20ELO\x20history:','winnerUsername','Gold','playersD2','demotion','data','promotion','timestamp','all','opponent','error','length','apply','return\x20(function()\x20','docs','empty'];a12_0x1d21=function(){return _0x524377;};return a12_0x1d21();}function a12_0x3533(_0x2c6f8c,_0x82ae0d){const _0x5c06ea=a12_0x1d21();return a12_0x3533=function(_0x2a2ea9,_0x42c722){_0x2a2ea9=_0x2a2ea9-0x144;let _0x1d21cf=_0x5c06ea[_0x2a2ea9];return _0x1d21cf;},a12_0x3533(_0x2c6f8c,_0x82ae0d);}import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D2=[{'name':'Gold','elo':0x708},{'name':a12_0xe60b13(0x145),'elo':0x640},{'name':'Bronze','elo':0x578},{'name':'Unranked','elo':0x4b0}];let lastVisibleD2=null;async function getUsernameByIdD2(_0x15d3f3){const _0x497574=a12_0xe60b13;try{if(!_0x15d3f3)return'Unknown\x20Player';const _0x4894ba=await getDoc(doc(db,_0x497574(0x149),_0x15d3f3));if(_0x4894ba['exists']())return _0x4894ba['data']()[_0x497574(0x144)]||'Unknown\x20Player';const _0x19085b=await getDocs(query(collection(db,'approvedMatchesD2'),where('winnerId','==',_0x15d3f3),limit(0x1)));if(!_0x19085b['empty'])return _0x19085b[_0x497574(0x154)][0x0]['data']()[_0x497574(0x147)]||'Unknown\x20Player';const _0x1a84c5=await getDocs(query(collection(db,'approvedMatchesD2'),where('loserId','==',_0x15d3f3),limit(0x1)));if(!_0x1a84c5['empty'])return _0x1a84c5['docs'][0x0][_0x497574(0x14b)]()['loserUsername']||'Unknown\x20Player';return'Unknown\x20Player';}catch(_0x149ddb){return console['error']('Error\x20getting\x20username:',_0x149ddb),'Unknown\x20Player';}}export async function recordEloChangeD2({playerId:_0x33cc37,previousElo:_0x2924d8,newElo:_0x4733c4,opponentId:_0x2f1dce,matchResult:_0x1dc91f,previousPosition:_0x48e23c,newPosition:_0x594f16,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0xee9f91,timestamp:_0x2113a5}){const _0x140308=a12_0xe60b13;try{const _0x26d356=doc(collection(db,'eloHistoryD2'));let _0x5764fd='match';if(isPromotion)_0x5764fd=_0x140308(0x14c);if(isDemotion)_0x5764fd=_0x140308(0x14a);let _0x365bd2='Unranked';if(_0x4733c4>=0x834)_0x365bd2='Emerald';else{if(_0x4733c4>=0x708)_0x365bd2=_0x140308(0x148);else{if(_0x4733c4>=0x640)_0x365bd2=_0x140308(0x145);else{if(_0x4733c4>=0x578)_0x365bd2='Bronze';}}}return await setDoc(_0x26d356,{'type':_0x5764fd,'player':_0x33cc37,'opponent':_0x2f1dce,'previousElo':_0x2924d8,'newElo':_0x4733c4,'change':_0x4733c4-_0x2924d8,'matchResult':_0x1dc91f,'previousPosition':_0x48e23c,'newPosition':_0x594f16,'rankAchieved':_0x365bd2,'matchId':_0xee9f91,'timestamp':_0x2113a5}),console['log']('D2\x20ELO\x20history\x20recorded\x20for\x20'+_0x33cc37),!![];}catch(_0x180303){console[_0x140308(0x150)]('Error\x20recording\x20D2\x20ELO\x20history:',_0x180303);throw _0x180303;}}export async function getEloHistoryD2(_0x41445e=0x14){const _0x397721=a12_0xe60b13;try{const _0x5e2e35=collection(db,'eloHistoryD2');let _0x40f802;lastVisibleD2?_0x40f802=query(_0x5e2e35,orderBy(_0x397721(0x14d),'desc'),startAfter(lastVisibleD2),limit(_0x41445e)):_0x40f802=query(_0x5e2e35,orderBy('timestamp','desc'),limit(_0x41445e));const _0x4d1a8f=await getDocs(_0x40f802);if(_0x4d1a8f[_0x397721(0x155)])return{'entries':[],'hasMore':![]};lastVisibleD2=_0x4d1a8f[_0x397721(0x154)][_0x4d1a8f[_0x397721(0x154)][_0x397721(0x151)]-0x1];const _0x1dfd08=_0x4d1a8f['docs']['map'](async _0x5b512e=>{const _0x30f060=_0x397721,_0x1831da=_0x5b512e[_0x30f060(0x14b)](),[_0x1e1bdb,_0x2a506b]=await Promise['all']([getUsernameByIdD2(_0x1831da['player']),getUsernameByIdD2(_0x1831da[_0x30f060(0x14f)])]);return{..._0x1831da,'playerUsername':_0x1e1bdb,'opponentUsername':_0x2a506b,'change':_0x1831da['newElo']-_0x1831da['previousElo'],'timestamp':_0x1831da['timestamp']};}),_0xd0ec68=await Promise[_0x397721(0x14e)](_0x1dfd08);return{'entries':_0xd0ec68,'hasMore':_0x4d1a8f['size']===_0x41445e};}catch(_0x394669){console['error'](_0x397721(0x146),_0x394669);throw _0x394669;}}export function resetPaginationD2(){lastVisibleD2=null;}
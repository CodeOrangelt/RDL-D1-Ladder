const a10_0x1a28de=a10_0x597d,a10_0x31d340=(function(){let _0x229989=!![];return function(_0x2714ff,_0x32e19d){const _0x248ca2=_0x229989?function(){const _0x11703f=a10_0x597d;if(_0x32e19d){const _0xa49da3=_0x32e19d[_0x11703f(0x1d8)](_0x2714ff,arguments);return _0x32e19d=null,_0xa49da3;}}:function(){};return _0x229989=![],_0x248ca2;};}()),a10_0x4ab1f5=a10_0x31d340(this,function(){const _0x26e813=a10_0x597d;let _0x1c7a1e;try{const _0x141665=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x1c7a1e=_0x141665();}catch(_0x33253d){_0x1c7a1e=window;}const _0x256932=_0x1c7a1e['console']=_0x1c7a1e['console']||{},_0x54bd0f=['log','warn',_0x26e813(0x1df),'error','exception','table',_0x26e813(0x1e4)];for(let _0x24ce42=0x0;_0x24ce42<_0x54bd0f[_0x26e813(0x1e1)];_0x24ce42++){const _0x565915=a10_0x31d340['constructor']['prototype'][_0x26e813(0x1f1)](a10_0x31d340),_0x5dac12=_0x54bd0f[_0x24ce42],_0x86d09a=_0x256932[_0x5dac12]||_0x565915;_0x565915['__proto__']=a10_0x31d340['bind'](a10_0x31d340),_0x565915['toString']=_0x86d09a['toString']['bind'](_0x86d09a),_0x256932[_0x5dac12]=_0x565915;}});a10_0x4ab1f5();import{getAuth,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{doc,getDoc,collection,query,where,getDocs,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import{isAdmin}from'./admin-check.js';const ADMIN_EMAILS=['admin@ladder.com','Brian2af@outlook.com'],userCache={'uid':null,'username':null,'isAdmin':![],'hasCheckedCollections':![],'lastChecked':0x0,'role':null},invitationCache={'lastCheck':0x0,'pendingCount':0x0,'checkInterval':0x493e0};function updateInboxNotification(_0x30e85e){const _0x3991c3=a10_0x597d,_0x7a3b4c=document['getElementById']('inbox-notification');_0x7a3b4c&&(_0x30e85e>0x0?(_0x7a3b4c['style']['display']=_0x3991c3(0x1e0),_0x7a3b4c[_0x3991c3(0x1e6)]=_0x30e85e>0x9?'9+':_0x30e85e):_0x7a3b4c['style'][_0x3991c3(0x1f3)]=_0x3991c3(0x1fa));}async function checkPendingInvitationsForCurrentUser(_0x570da8){const _0xa84ea6=a10_0x597d;try{const _0x54b145=Date['now']();if(_0x54b145-invitationCache['lastCheck']<invitationCache['checkInterval'])return updateInboxNotification(invitationCache['pendingCount']),invitationCache['pendingCount'];invitationCache[_0xa84ea6(0x1f0)]=_0x54b145;const _0x5ed618=collection(db,'gameInvitations'),_0x238d26=query(_0x5ed618,where('toUserId','==',_0x570da8),where(_0xa84ea6(0x1fb),'==','pending'),limit(0x5)),_0x552f6b=await getDocs(_0x238d26),_0x5c36f4=_0x552f6b['size'];return invitationCache[_0xa84ea6(0x1e2)]=_0x5c36f4,updateInboxNotification(_0x5c36f4),_0x5c36f4;}catch(_0x3968ed){return console['warn'](_0xa84ea6(0x1f9),_0x3968ed),0x0;}}function updateAuthSectionImmediate(_0x50939f,_0x4bc792=![]){const _0x2a6f73=a10_0x597d,_0x301276=document[_0x2a6f73(0x1fc)]('auth-section');if(!_0x301276)return;if(_0x50939f&&_0x4bc792)document['querySelectorAll']('.admin-only')['forEach'](_0x55b446=>{const _0x96c6a8=_0x2a6f73;_0x55b446[_0x96c6a8(0x1d6)]['display']='block';});else!_0x50939f&&document[_0x2a6f73(0x1ef)]('.admin-only')[_0x2a6f73(0x1ec)](_0x778750=>{const _0x2de599=_0x2a6f73;_0x778750[_0x2de599(0x1d6)]['display']='none';});if(_0x50939f){const _0x1bd999=userCache['username']||(_0x50939f[_0x2a6f73(0x1d9)]?_0x50939f[_0x2a6f73(0x1d9)]['split']('@')[0x0]:'User'),_0x52cc32=userCache['role']?'\x20('+userCache['role']+')':_0x4bc792?'\x20(Admin)':'';_0x301276[_0x2a6f73(0x1d5)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20class=\x22nav-username\x22>'+_0x1bd999+_0x52cc32+'</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username='+encodeURIComponent(_0x1bd999)+'\x22>Profile</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./inbox.html\x22\x20class=\x22nav-notification\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Inbox\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22inbox-notification\x22\x20class=\x22notification-dot\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22members.html\x22>Members</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./redeem.html\x22><i\x20class=\x22fas\x20fa-gift\x22></i>Store</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20id=\x22logout-link\x22>Sign\x20Out</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';const _0xe51bfa=document[_0x2a6f73(0x1fc)]('logout-link');_0xe51bfa&&_0xe51bfa['addEventListener']('click',_0x42bb94=>{const _0x1a6b03=_0x2a6f73;_0x42bb94['preventDefault']();const _0x3c88cb=getAuth();updateAuthSectionImmediate(null),_0x3c88cb[_0x1a6b03(0x1db)]()[_0x1a6b03(0x1ee)](_0x27ec83=>{console['error']('Error\x20signing\x20out:',_0x27ec83);});}),_0x50939f['uid']&&setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0x50939f['uid']);},0x3e8);}else _0x301276['innerHTML']='<a\x20href=\x22login.html\x22\x20class=\x22login-link\x22>Login</a>';}function a10_0x597d(_0x232e08,_0x1a8a83){const _0x4ab1f5=a10_0x1d7b();return a10_0x597d=function(_0x31d340,_0x1bbab9){_0x31d340=_0x31d340-0x1d1;let _0x1d7bcd=_0x4ab1f5[_0x31d340];return _0x1d7bcd;},a10_0x597d(_0x232e08,_0x1a8a83);}async function checkAdminRoles(_0x509ef3){const _0x4822c4=a10_0x597d;if(!_0x509ef3||!_0x509ef3['email'])return{'isAdmin':![],'role':null};try{console['log']('Checking\x20roles\x20for\x20user:\x20'+_0x509ef3['email']);const _0x33b343=[_0x4822c4(0x1da),'playersD2','playersD3','nonParticipants','userProfiles'],_0x1cc1a2=['council','creative\x20lead','owner',_0x4822c4(0x1de)];for(const _0x58c823 of _0x33b343){try{const _0x1c5340=doc(db,_0x58c823,_0x509ef3['uid']),_0x2b3852=await getDoc(_0x1c5340);if(_0x2b3852['exists']()){const _0x16a868=_0x2b3852[_0x4822c4(0x1f5)]();console['log'](_0x4822c4(0x1e8)+_0x58c823+'\x20by\x20UID:',_0x16a868);let _0x2f0da3=(_0x16a868['roleName']||_0x16a868[_0x4822c4(0x1eb)]||'')['toLowerCase'](),_0x1dafb5=_0x16a868['roleName']||_0x16a868['role']||'';if(_0x2f0da3&&_0x1cc1a2[_0x4822c4(0x1d1)](_0x2f0da3)){console['log']('Found\x20admin\x20role:\x20'+_0x2f0da3+'\x20in\x20'+_0x58c823);const _0x51e655=_0x1dafb5[_0x4822c4(0x1e7)]('\x20')['map'](_0x47f09c=>_0x47f09c['charAt'](0x0)['toUpperCase']()+_0x47f09c['slice'](0x1)['toLowerCase']())['join']('\x20');return{'isAdmin':!![],'role':_0x51e655};}}}catch(_0x2ffb04){console['error'](_0x4822c4(0x1d2)+_0x58c823+'\x20by\x20UID:',_0x2ffb04);}}for(const _0x323d49 of _0x33b343){try{const _0x4da65e=collection(db,_0x323d49);let _0x254ab4=query(_0x4da65e,where('email','==',_0x509ef3['email'])),_0x5a5388=await getDocs(_0x254ab4);_0x5a5388['empty']&&(_0x254ab4=query(_0x4da65e,where('email','==',_0x509ef3['email']['toLowerCase']())),_0x5a5388=await getDocs(_0x254ab4));if(!_0x5a5388[_0x4822c4(0x200)]){const _0x8e1ea3=_0x5a5388[_0x4822c4(0x1dc)][0x0][_0x4822c4(0x1f5)]();console[_0x4822c4(0x1e9)](_0x4822c4(0x1e8)+_0x323d49+'\x20by\x20email:',_0x8e1ea3);let _0x1d85e0=(_0x8e1ea3['roleName']||_0x8e1ea3['role']||'')['toLowerCase'](),_0x2000ea=_0x8e1ea3['roleName']||_0x8e1ea3['role']||'';if(_0x1d85e0&&_0x1cc1a2['includes'](_0x1d85e0)){console['log']('Found\x20admin\x20role:\x20'+_0x1d85e0+'\x20in\x20'+_0x323d49);const _0x35d274=_0x2000ea[_0x4822c4(0x1e7)]('\x20')['map'](_0x4f8c78=>_0x4f8c78['charAt'](0x0)[_0x4822c4(0x1fe)]()+_0x4f8c78['slice'](0x1)['toLowerCase']())['join']('\x20');return{'isAdmin':!![],'role':_0x35d274};}}}catch(_0x2a32f7){console['error']('Error\x20checking\x20'+_0x323d49+'\x20by\x20email:',_0x2a32f7);}}return console[_0x4822c4(0x1e9)](_0x4822c4(0x1f7)),{'isAdmin':![],'role':null};}catch(_0x3f6be1){return console['error']('Error\x20in\x20checkAdminRoles:',_0x3f6be1),{'isAdmin':![],'role':null};}}async function updateAuthSection(_0x55b2c4){const _0x343ae2=a10_0x597d,_0x1c439a=_0x55b2c4&&isAdmin(_0x55b2c4['email']);updateAuthSectionImmediate(_0x55b2c4,_0x1c439a);if(!_0x55b2c4){userCache['uid']=null,userCache['username']=null,userCache['isAdmin']=![],userCache['hasCheckedCollections']=![],userCache['role']=null;return;}const _0x442a25=Date['now']();if(_0x55b2c4['uid']===userCache['uid']&&userCache['hasCheckedCollections']&&_0x442a25-userCache['lastChecked']<0x493e0)return;try{userCache['uid']=_0x55b2c4['uid'],userCache['lastChecked']=_0x442a25;const _0x28d88a=isAdmin(_0x55b2c4[_0x343ae2(0x1d9)]);userCache[_0x343ae2(0x1f2)]=_0x28d88a;if(!_0x28d88a){const {isAdmin:_0x5e844e,role:_0x312a8d}=await checkAdminRoles(_0x55b2c4);userCache['isAdmin']=_0x5e844e,userCache['role']=_0x312a8d,_0x5e844e&&(document[_0x343ae2(0x1ef)]('.admin-only')['forEach'](_0x2adecf=>{_0x2adecf['style']['display']='block';}),updateAuthSectionImmediate(_0x55b2c4,!![]));}const _0x2c38a6=[_0x343ae2(0x1da),_0x343ae2(0x1f8),_0x343ae2(0x1ff),'playersDuos',_0x343ae2(0x1d3),_0x343ae2(0x1ea),_0x343ae2(0x1f6)],_0x1f7536=_0x2c38a6[_0x343ae2(0x1e5)](_0xd1ce45=>getDoc(doc(db,_0xd1ce45,_0x55b2c4[_0x343ae2(0x1fd)]))['then'](_0x3a234a=>_0x3a234a['exists']()?{'collection':_0xd1ce45,'data':_0x3a234a[_0x343ae2(0x1f5)]()}:null)['catch'](()=>null)),_0x5a3c37=await Promise['all'](_0x1f7536),_0x86f99d=_0x5a3c37[_0x343ae2(0x1d4)](_0x2ea77e=>_0x2ea77e!==null);let _0x3dbc3f=null;for(const _0xb7c5c1 of _0x86f99d){if(_0xb7c5c1['data'][_0x343ae2(0x1f4)]){_0x3dbc3f=_0xb7c5c1['data'][_0x343ae2(0x1f4)];break;}}userCache['username']=_0x3dbc3f||(_0x55b2c4[_0x343ae2(0x1d9)]?_0x55b2c4[_0x343ae2(0x1d9)]['split']('@')[0x0]:'User'),userCache['hasCheckedCollections']=!![],updateAuthSectionImmediate(_0x55b2c4,userCache['isAdmin']),setTimeout(()=>{const _0x41956c=_0x343ae2;checkPendingInvitationsForCurrentUser(_0x55b2c4[_0x41956c(0x1fd)]);},0x1f4);}catch(_0x1c2f8d){console['error'](_0x343ae2(0x1e3),_0x1c2f8d);}}document['addEventListener'](a10_0x1a28de(0x1d7),()=>{const _0xfeeea5=a10_0x1a28de,_0x5571be=getAuth();onAuthStateChanged(_0x5571be,async _0x4f12a0=>{await updateAuthSection(_0x4f12a0),_0x4f12a0&&checkPendingInvitationsForCurrentUser(_0x4f12a0['uid']);}),document['addEventListener'](_0xfeeea5(0x1ed),()=>{const _0xd7dbe6=_0xfeeea5;!document['hidden']&&_0x5571be['currentUser']&&checkPendingInvitationsForCurrentUser(_0x5571be['currentUser'][_0xd7dbe6(0x1fd)]);}),document['addEventListener']('click',_0x3eb3d7=>{const _0x5c1436=_0xfeeea5;_0x3eb3d7[_0x5c1436(0x1dd)]['closest']('a[href]')&&_0x5571be['currentUser']&&checkPendingInvitationsForCurrentUser(_0x5571be['currentUser']['uid']);});});function a10_0x1d7b(){const _0x173db9=['includes','Error\x20checking\x20','playersCTF','filter','innerHTML','style','DOMContentLoaded','apply','email','players','signOut','docs','target','admin','info','inline-block','length','pendingCount','Error\x20in\x20full\x20auth\x20update:','trace','map','textContent','split','Found\x20user\x20in\x20','log','nonParticipants','role','forEach','visibilitychange','catch','querySelectorAll','lastCheck','bind','isAdmin','display','username','data','userProfiles','No\x20admin\x20roles\x20found\x20for\x20user','playersD2','Could\x20not\x20check\x20pending\x20invitations\x20for\x20current\x20user:','none','status','getElementById','uid','toUpperCase','playersD3','empty'];a10_0x1d7b=function(){return _0x173db9;};return a10_0x1d7b();}export{updateAuthSection};
const a50_0x16791f=a50_0x3b49,a50_0x18ffa1=(function(){let _0x420b4c=!![];return function(_0x4a6624,_0x24dda6){const _0xf0bce9=_0x420b4c?function(){if(_0x24dda6){const _0x5fdfa7=_0x24dda6['apply'](_0x4a6624,arguments);return _0x24dda6=null,_0x5fdfa7;}}:function(){};return _0x420b4c=![],_0xf0bce9;};}()),a50_0x255ebf=a50_0x18ffa1(this,function(){const _0x3ba1a9=a50_0x3b49;let _0x2f5aac;try{const _0xafcfec=Function(_0x3ba1a9(0x1dd)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x2f5aac=_0xafcfec();}catch(_0x45b166){_0x2f5aac=window;}const _0x10f8bb=_0x2f5aac[_0x3ba1a9(0x1e0)]=_0x2f5aac['console']||{},_0x243ea3=['log',_0x3ba1a9(0x1d2),'info','error','exception','table',_0x3ba1a9(0x1e1)];for(let _0xefb5b2=0x0;_0xefb5b2<_0x243ea3['length'];_0xefb5b2++){const _0x3910bb=a50_0x18ffa1[_0x3ba1a9(0x1d5)]['prototype'][_0x3ba1a9(0x1d3)](a50_0x18ffa1),_0x30884c=_0x243ea3[_0xefb5b2],_0x226070=_0x10f8bb[_0x30884c]||_0x3910bb;_0x3910bb['__proto__']=a50_0x18ffa1['bind'](a50_0x18ffa1),_0x3910bb['toString']=_0x226070['toString'][_0x3ba1a9(0x1d3)](_0x226070),_0x10f8bb[_0x30884c]=_0x3910bb;}});function a50_0x2423(){const _0x2e7574=['length','eloHistory','warn','bind','get','constructor','Error\x20fetching\x20batch\x20ELO\x20history:','set','data','push','playersD3','docs','playersD2','return\x20(function()\x20','playerId','ladderPlayers','console','trace','now','map','userProfiles'];a50_0x2423=function(){return _0x2e7574;};return a50_0x2423();}a50_0x255ebf();import{db}from'../firebase-config.js';import{collection,doc,getDoc,getDocs,query,limit,startAfter,where,onSnapshot}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const cache={'userProfiles':new Map(),'ladderPlayers':new Map(),'matchResults':new Map(),'eloHistory':new Map()},CACHE_EXPIRY={'userProfiles':0x5*0x3c*0x3e8,'ladderPlayers':0x2*0x3c*0x3e8,'matchResults':0x1*0x3c*0x3e8,'eloHistory':0x3*0x3c*0x3e8};export const userProfilesRef=collection(db,a50_0x16791f(0x1e4));export async function fetchPaginatedData(_0x42bd5f,_0x2e6991=0xa,_0x57e2e9=null){const _0x2c7069=a50_0x16791f;let _0x5c6198=query(_0x42bd5f,limit(_0x2e6991));_0x57e2e9&&(_0x5c6198=query(_0x5c6198,startAfter(_0x57e2e9)));const _0x5206c6=await getDocs(_0x5c6198),_0xccff6f=_0x5206c6[_0x2c7069(0x1db)][_0x5206c6['docs']['length']-0x1];return{'data':_0x5206c6['docs'][_0x2c7069(0x1e3)](_0x2198c0=>({'id':_0x2198c0['id'],..._0x2198c0[_0x2c7069(0x1d8)]()})),'lastVisible':_0xccff6f,'hasMore':_0x5206c6['docs']['length']===_0x2e6991};}export async function getUserProfile(_0x27b96e){const _0x3eda90=a50_0x16791f,_0x1b01d9=cache['userProfiles']['get'](_0x27b96e);if(_0x1b01d9&&Date['now']()-_0x1b01d9['timestamp']<CACHE_EXPIRY[_0x3eda90(0x1e4)])return _0x1b01d9[_0x3eda90(0x1d8)];const _0x172455=await getDoc(doc(userProfilesRef,_0x27b96e));if(_0x172455['exists']()){const _0x3210c1=_0x172455['data']();return cache[_0x3eda90(0x1e4)]['set'](_0x27b96e,{'data':_0x3210c1,'timestamp':Date['now']()}),_0x3210c1;}return null;}export async function getLadderData(_0x419944=0x1){const _0x5d64e5=a50_0x16791f,_0x2fbc11='division_'+_0x419944,_0x1f6ea0=cache['ladderPlayers']['get'](_0x2fbc11);if(_0x1f6ea0&&Date[_0x5d64e5(0x1e2)]()-_0x1f6ea0['timestamp']<CACHE_EXPIRY[_0x5d64e5(0x1df)])return _0x1f6ea0['data'];const _0x5cd125=_0x419944===0x1?'players':'playersD'+_0x419944,_0x417a6e=collection(db,_0x5cd125),_0x3d88be=await getDocs(query(_0x417a6e,limit(0x64))),_0x2cc518=_0x3d88be['docs']['map'](_0x37f3a5=>({'id':_0x37f3a5['id'],..._0x37f3a5[_0x5d64e5(0x1d8)]()}));return cache['ladderPlayers']['set'](_0x2fbc11,{'data':_0x2cc518,'timestamp':Date['now']()}),_0x2cc518;}export async function getEloHistoryBatch(_0x336e8a,_0x2a024c=0x1){const _0x167d15=a50_0x16791f,_0x4ab5d5=_0x2a024c===0x1?_0x167d15(0x1d1):'eloHistoryD'+_0x2a024c,_0x19c09e=collection(db,_0x4ab5d5),_0x26c799={},_0x194a91=[];_0x336e8a['forEach'](_0x1c0fd5=>{const _0x496927=_0x167d15,_0x20c57d=_0x1c0fd5+'_'+_0x2a024c,_0x22d814=cache['eloHistory'][_0x496927(0x1d4)](_0x20c57d);_0x22d814&&Date['now']()-_0x22d814['timestamp']<CACHE_EXPIRY['eloHistory']?_0x26c799[_0x1c0fd5]=_0x22d814[_0x496927(0x1d8)]:_0x194a91['push'](_0x1c0fd5);});const _0x4ae8e9=0xa;for(let _0x2f10d1=0x0;_0x2f10d1<_0x194a91[_0x167d15(0x1d0)];_0x2f10d1+=_0x4ae8e9){const _0x167aed=_0x194a91['slice'](_0x2f10d1,_0x2f10d1+_0x4ae8e9);if(_0x167aed['length']>0x0)try{const _0x12bf60=query(_0x19c09e,where(_0x167d15(0x1de),'in',_0x167aed),limit(0x64)),_0x17a196=await getDocs(_0x12bf60);_0x17a196['docs']['forEach'](_0x4c8abb=>{const _0x46d1bd=_0x167d15,_0x4a50f3=_0x4c8abb['data'](),_0x56d529=_0x4a50f3['playerId'];if(!_0x26c799[_0x56d529])_0x26c799[_0x56d529]=[];_0x26c799[_0x56d529][_0x46d1bd(0x1d9)](_0x4a50f3);const _0x234665=_0x56d529+'_'+_0x2a024c;cache['eloHistory'][_0x46d1bd(0x1d7)](_0x234665,{'data':_0x26c799[_0x56d529],'timestamp':Date[_0x46d1bd(0x1e2)]()});});}catch(_0x539178){console['error'](_0x167d15(0x1d6),_0x539178);}}return _0x26c799;}let usernameCache=new Map(),usernameCacheTimestamp=Date['now']();export function setupEfficientListener(_0x32a451,_0x4dbebb=[],_0xd924b2){const _0xb9a023=collection(db,_0x32a451),_0x18e40d=query(_0xb9a023,..._0x4dbebb),_0x19a5a3=onSnapshot(_0x18e40d,_0x276081=>{const _0x50cd58=_0x276081['docChanges']()['map'](_0x4c36c2=>({'type':_0x4c36c2['type'],'id':_0x4c36c2['doc']['id'],'data':_0x4c36c2['doc']['data']()}));_0x50cd58['length']>0x0&&_0xd924b2(_0x50cd58,_0x276081['docs']);});return _0x19a5a3;}function a50_0x3b49(_0x358ca9,_0x1acaae){const _0x255ebf=a50_0x2423();return a50_0x3b49=function(_0x18ffa1,_0x14c1e5){_0x18ffa1=_0x18ffa1-0x1d0;let _0x2423fa=_0x255ebf[_0x18ffa1];return _0x2423fa;},a50_0x3b49(_0x358ca9,_0x1acaae);}export async function bulkResolveUsernames(_0x2e4f51){const _0x13f206=a50_0x16791f,_0x2037c5=new Map();if(!_0x2e4f51||_0x2e4f51[_0x13f206(0x1d0)]===0x0)return _0x2037c5;const _0x117ab5=['players',_0x13f206(0x1dc),_0x13f206(0x1da),'nonParticipants'];for(const _0x2b1cfc of _0x117ab5){const _0x1a9e42=collection(db,_0x2b1cfc),_0x5c707d=await getDocs(_0x1a9e42);_0x5c707d['forEach'](_0x159d9c=>{const _0x4b79fe=_0x13f206,_0x17ccdb=_0x159d9c[_0x4b79fe(0x1d8)]();_0x17ccdb['username']&&_0x2e4f51['includes'](_0x159d9c['id'])&&_0x2037c5['set'](_0x159d9c['id'],_0x17ccdb['username']);});}return _0x2037c5;}
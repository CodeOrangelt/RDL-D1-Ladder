(function(a,b){const u=a28d,c=a();while(!![]){try{const d=-parseInt(u(0xa8))/0x1*(-parseInt(u(0xaf))/0x2)+parseInt(u(0xa9))/0x3+-parseInt(u(0xa1))/0x4*(parseInt(u(0xb1))/0x5)+parseInt(u(0xad))/0x6*(-parseInt(u(0x98))/0x7)+parseInt(u(0xbc))/0x8+parseInt(u(0x9d))/0x9*(-parseInt(u(0xbe))/0xa)+-parseInt(u(0xa2))/0xb;if(d===b)break;else c['push'](c['shift']());}catch(e){c['push'](c['shift']());}}}(a28c,0x9ae57));const a28b=(function(){let a=!![];return function(b,c){const d=a?function(){if(c){const e=c['apply'](b,arguments);return c=null,e;}}:function(){};return a=![],d;};}()),a28a=a28b(this,function(){const v=a28d;let a;try{const d=Function(v(0xbd)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');a=d();}catch(f){a=window;}const b=a[v(0x9e)]=a[v(0x9e)]||{},c=[v(0xb6),v(0xc1),'info',v(0xbf),v(0xaa),'table',v(0x94)];for(let g=0x0;g<c['length'];g++){const h=a28b[v(0x9c)][v(0xc2)][v(0xc3)](a28b),i=c[g],j=b[i]||h;h[v(0xa6)]=a28b['bind'](a28b),h['toString']=j['toString']['bind'](j),b[i]=h;}});a28a();import{collection,doc,getDoc,getDocs,updateDoc,setDoc,deleteDoc,writeBatch,query,where,serverTimestamp,addDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';import{recordEloChangeD2}from'./elo-history-d2.js';import{promotionManager}from'./promotions.js';function a28d(a,b){const c=a28c();return a28d=function(d,e){d=d-0x94;let f=c[d];if(a28d['TEVJEO']===undefined){var g=function(l){const m='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let n='',o='';for(let p=0x0,q,r,s=0x0;r=l['charAt'](s++);~r&&(q=p%0x4?q*0x40+r:r,p++%0x4)?n+=String['fromCharCode'](0xff&q>>(-0x2*p&0x6)):0x0){r=m['indexOf'](r);}for(let t=0x0,u=n['length'];t<u;t++){o+='%'+('00'+n['charCodeAt'](t)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(o);};a28d['FcQJgT']=g,a=arguments,a28d['TEVJEO']=!![];}const h=c[0x0],i=d+h,j=a[i];return!j?(f=a28d['FcQJgT'](f),a[i]=f):f=j,f;},a28d(a,b);}import a28e from'./firebase-idle-wrapper.js';export function calculateEloD2(a,b,c=0x20){const w=a28d,d=0x1/(0x1+Math['pow'](0xa,(b-a)/0x190)),e=0x1/(0x1+Math['pow'](0xa,(a-b)/0x190)),f=a+c*(0x1-d),g=b+c*(0x0-e);return{'newWinnerRating':Math['round'](f),'newLoserRating':Math[w(0xb9)](g)};}export async function updateEloRatingsD2(a,b,c){const x=a28d;try{const d=writeBatch(db),e=doc(db,'playersD2',a),f=doc(db,'playersD2',b),[g,h]=await Promise[x(0x97)]([getDoc(e),getDoc(f)]);if(!g[x(0xbb)]()||!h['exists']())throw new Error(x(0x9b));const i=g['data'](),j=h[x(0xae)](),k=i[x(0x9f)]||Number['MAX_SAFE_INTEGER'],l=j['position']||Number['MAX_SAFE_INTEGER'],{newWinnerRating:m,newLoserRating:n}=calculateEloD2(i[x(0xa0)]||0x4b0,j['eloRating']||0x4b0);let o=k,p=l;if(k>l){console[x(0xb6)](x(0xa4)),o=l,p=l+0x1;const q=query(collection(db,'playersD2'),where('position','>',l),where(x(0x9f),'<',k)),r=await getDocs(q);for(const s of r['docs']){s['id']!==a&&s['id']!==b&&d['update'](doc(db,x(0x99),s['id']),{'position':s['data']()['position']+0x1});}}else console['log']('D2\x20Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions');return d[x(0x9a)](e,{'eloRating':m,'lastMatchDate':serverTimestamp(),'position':o,'lastMatchId':c}),d[x(0x9a)](f,{'eloRating':n,'lastMatchDate':serverTimestamp(),'position':p,'lastMatchId':c}),await d[x(0xa3)](),console[x(0xb6)]('D2\x20ELO\x20ratings\x20updated\x20successfully'),await Promise['all']([recordEloChangeD2({'playerId':a,'previousElo':i['eloRating']||0x4b0,'newElo':m,'opponentId':b,'matchResult':'win','previousPosition':k,'newPosition':o,'isPromotion':o<k,'matchId':c,'timestamp':serverTimestamp()}),recordEloChangeD2({'playerId':b,'previousElo':j['eloRating']||0x4b0,'newElo':n,'opponentId':a,'matchResult':'loss','previousPosition':l,'newPosition':p,'isDemotion':p>l,'matchId':c,'timestamp':serverTimestamp()})]),await promotionManager['checkAndRecordPromotion'](a,m,i[x(0xa0)],{'source':x(0xb5),'matchId':c}),await promotionManager['checkAndRecordPromotion'](b,n,j['eloRating'],{'source':x(0xb5),'matchId':c}),!![];}catch(t){console['error'](x(0xc0),t);throw t;}}export async function approveReportD2(a,b,c,d){const y=a28d;try{console['log'](y(0xc6),{'reportId':a,'winnerScore':b,'winnerSuicides':c,'winnerComment':d});const e=auth['currentUser'];if(!e){console['log']('No\x20user\x20logged\x20in');throw new Error(y(0xba));}console['log'](y(0x96),e[y(0xac)]);const f=await getDoc(doc(db,'playersD2',e[y(0xc5)])),g=f[y(0xbb)]()?f[y(0xae)]()[y(0x95)]:null;console[y(0xb6)](y(0xb4),g);const h=doc(db,y(0xc4),a),i=await getDoc(h);if(!i[y(0xbb)]()){console['log'](y(0xb3),a);throw new Error('D2\x20match\x20report\x20not\x20found');}const j=i['data']();console[y(0xb6)]('D2\x20Report\x20data:',j);if(g!==j['winnerUsername'])throw new Error('Only\x20the\x20winner\x20can\x20approve\x20D2\x20matches');const k={...j,'winnerScore':b,'winnerSuicides':c,'winnerComment':d,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':g,'createdAt':j[y(0xa7)]||serverTimestamp(),'winnerUsername':j[y(0xb8)],'loserUsername':j['loserUsername']};await setDoc(doc(db,y(0xab),a),k),await deleteDoc(h),console[y(0xb6)](y(0xa5));const [l,m]=await Promise['all']([getDocs(query(collection(db,'playersD2'),where('username','==',j[y(0xb8)]))),getDocs(query(collection(db,'playersD2'),where('username','==',j['loserUsername'])))]);if(l[y(0xb7)]||m[y(0xb7)])throw new Error(y(0xb2));const n=l[y(0xb0)][0x0]['id'],o=m[y(0xb0)][0x0]['id'];return await updateEloRatingsD2(n,o,a),console['log']('D2\x20Match\x20successfully\x20approved\x20and\x20ELO\x20updated'),!![];}catch(p){console[y(0xbf)]('Error\x20in\x20approveReportD2:',p);throw p;}}function a28c(){const z=['rdiGuMvWB3j0ig5VDcbMB3vUzcb3AxrOieLeoG','q3vYCMvUDcb1C2vYBMfTztO','Bwf0y2GTzdi','Bg9N','zw1WDhK','D2LUBMvYvxnLCM5HBwu','CM91BMq','ww91ig11C3qGyMuGBg9Nz2vKigLUihrVigfWChjVDMuGrdiGBwf0y2HLCW','zxHPC3rZ','nZy2mdqXnKr6z3zXvq','CMv0DxjUicHMDw5JDgLVBIGPia','mZGWyxDks3jS','zxjYB3i','rxjYB3iGAw4GDxbKyxrLrwXVuMf0Aw5NC0qYoG','D2fYBG','ChjVDg90ExbL','yMLUza','CgvUzgLUz01HDgnOzxnemG','DwLK','u3rHCNrPBMCGyxbWCM92zvjLCg9YDeqYigz1BMn0Aw9UihDPDgG6','DhjHy2u','DxnLCM5HBwu','q3vYCMvUDcb1C2vYoG','ywXS','mtu0v3HKzgPM','CgXHEwvYC0qY','DxbKyxrL','t25Lig9YigjVDgGGrdiGCgXHEwvYCYbUB3qGzM91BMq','y29UC3rYDwn0B3i','mJyXmtHjDvDsuem','y29UC29Szq','Cg9ZAxrPB24','zwXVuMf0Aw5N','nhfOyxHMuW','mtm0mtqWnZftv09pB0G','y29TBwL0','rdiGug9ZAxrPB24GC3DHCcbUzwvKzwqGlsb3Aw5UzxiGD2fZigXVD2vYihjHBMTLza','rdiGtwf0y2GGBw92zwqGDg8GyxbWCM92zwqGy29SBgvJDgLVBG','x19WCM90B19F','y3jLyxrLzef0','mtu1mdq5CfPftMvu','mJyYndqXnwTLvgD2ra','zxHJzxb0Aw9U','yxbWCM92zwrnyxrJAgvZrdi','zw1HAwW','ntC4nZbTz0TJy1e','zgf0yq','mtjvCg9lrey','zg9JCW','mJKZmtm0nw1csfPoCG','q291BgqGBM90igzPBMqGrdiGCgXHEwvYigrVy3vTzw50CW'];a28c=function(){return z;};return a28c();}
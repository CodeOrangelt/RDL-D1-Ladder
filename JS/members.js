const a38B=a38d;function a38d(a,b){const c=a38c();return a38d=function(d,e){d=d-0xe6;let f=c[d];if(a38d['QBMVgL']===undefined){var g=function(l){const m='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let n='',o='';for(let p=0x0,q,r,s=0x0;r=l['charAt'](s++);~r&&(q=p%0x4?q*0x40+r:r,p++%0x4)?n+=String['fromCharCode'](0xff&q>>(-0x2*p&0x6)):0x0){r=m['indexOf'](r);}for(let t=0x0,u=n['length'];t<u;t++){o+='%'+('00'+n['charCodeAt'](t)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(o);};a38d['ltKjoA']=g,a=arguments,a38d['QBMVgL']=!![];}const h=c[0x0],i=d+h,j=a[i];return!j?(f=a38d['ltKjoA'](f),a[i]=f):f=j,f;},a38d(a,b);}(function(a,b){const z=a38d,c=a();while(!![]){try{const d=-parseInt(z(0x11b))/0x1*(-parseInt(z(0x11e))/0x2)+parseInt(z(0x105))/0x3+-parseInt(z(0x116))/0x4+-parseInt(z(0xec))/0x5*(-parseInt(z(0xf7))/0x6)+-parseInt(z(0x115))/0x7+-parseInt(z(0xf6))/0x8+parseInt(z(0x10d))/0x9*(parseInt(z(0x113))/0xa);if(d===b)break;else c['push'](c['shift']());}catch(e){c['push'](c['shift']());}}}(a38c,0x50eec));const a38b=(function(){let a=!![];return function(b,c){const d=a?function(){if(c){const e=c['apply'](b,arguments);return c=null,e;}}:function(){};return a=![],d;};}()),a38a=a38b(this,function(){const A=a38d,a=function(){let f;try{f=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(g){f=window;}return f;},b=a(),c=b['console']=b['console']||{},d=[A(0x100),'warn',A(0x114),'error','exception',A(0x101),A(0xf1)];for(let e=0x0;e<d[A(0x11c)];e++){const f=a38b['constructor'][A(0x110)]['bind'](a38b),g=d[e],h=c[g]||f;f[A(0x11a)]=a38b[A(0xf0)](a38b),f['toString']=h[A(0x120)]['bind'](h),c[g]=f;}});a38a();const functions=require('firebase-functions'),admin=require(a38B(0xef));function a38c(){const L=['mti0nJG3mePVswfqAW','Aw5MBW','ndqYmdm4mvLpC3DqzG','mtq4mZqWmgvVtwDwta','zxjYB3i','BgfKzgvY','C2vUza','x19WCM90B19F','neTdCfPkBG','BgvUz3rO','BM9UugfYDgLJAxbHBNrZ','mtm3ndjAtvPUCgS','ywn0AxzL','Dg9tDhjPBMC','rxjYB3iGCMvIDwLSzgLUzYbTzw1IzxjZigXPC3q6','z2v0','BgfKzgvYCW','C29YDa','y29SBgvJDgLVBG','twvTyMvYCYbSAxn0ihjLyNvPBhqGC3vJy2vZC2z1BgX5','mtvwt3jXtMS','u3vJy2vZC2z1BgX5ihvWzgf0zwqGywDNCMvNyxrLzcbTzw1IzxjZigXPC3q','DxnLCM5HBwu','zMLYzwjHC2uTywrTAw4','yMLUza','DhjHy2u','CMvIDwLSze1LBwjLCNnmAxn0twfUDwfS','zw1LCMfSza','zMf2B3jPDgvxzwfWB24','ChvZAa','mJaXmZy4oeLVv2jevq','mtm1nJy2zuPJB2PS','C2vYDMvYvgLTzxn0yw1W','DxnLCLbYB2zPBgvZ','zg9Jswq','zMLYzxn0B3jL','ywXS','zMf2B3jPDgvnyxa','zg9JDw1LBNq','C2LSDMvY','Bg9N','DgfIBgu','ywDNCMvNyxrLze1LBwjLCNm','rxjYB3iGDxbKyxrPBMCGBwvTyMvYCYbSAxn0oG','Bw90Dg8','mteWndeZmLbvB3DorW','C2v0','y291BNrYEq','AxnoB25qyxj0AwnPCgfUDa','yNjVBNPL','B25xCML0zq','zg9J','yMf0y2G','odf1qwztBwW','y29TBwL0','zgf0yq','ChjVDg90ExbL','zM9YrwfJAa','CgfYyw1Z'];a38c=function(){return L;};return a38c();}admin['initializeApp']();const db=admin['firestore']();exports['updateMembersList']=functions['firestore'][a38B(0xfe)]('{collection}/{docId}')[a38B(0x10a)](async(a,b)=>{const C=a38B,c=b['params']['collection'],d=b[C(0x112)][C(0xfa)];if(!['players','playersD2','playersD3',C(0xf9),C(0x11d)]['includes'](c))return null;try{await rebuildMembersList(),console[C(0x100)](C(0xed));}catch(e){console[C(0x117)](C(0x103),e);}});async function rebuildMembersList(){const D=a38B,a=db[D(0x10c)](),[b,c,d,e,f]=await Promise[D(0xfc)]([db[D(0xea)](D(0xf9))['get'](),db['collection']('players')[D(0xe7)](),db['collection']('playersD2')['get'](),db[D(0xea)]('playersD3')['get'](),db['collection']('nonParticipants')[D(0xe7)]()]),g=new Map();b[D(0x111)](q=>{g['set'](q['id'],q['data']());});const h=new Map(),j=(q,r)=>{q['forEach'](s=>{const E=a38d,t=s['data'](),u=s['id'];!h['has'](u)&&h['set'](u,{'userId':u,'username':t['username']||'Unknown','ladders':[],'isNonParticipant':![]});const v=h[E(0xe7)](u);v[E(0xe8)][E(0xf5)]({'ladder':r,'elo':t['eloRating']||0x4b0,'active':t[E(0x11f)]!==![]});});};j(c,'D1'),j(d,'D2'),j(e,'D3'),f[D(0x111)](q=>{const F=D,r=q[F(0x10f)](),s=q['id'];!h['has'](s)&&r[F(0xee)]&&h[F(0x106)](s,{'userId':s,'username':r['username'],'ladders':[],'isNonParticipant':!![]});});const k=[];h['forEach']((q,r)=>{const G=D,s=g['get'](r)||{};let t=0x0,u=null;if(q['ladders']['length']>0x0){const w=q['ladders'][G(0xe9)]((x,y)=>y['elo']-x['elo']);t=w[0x0]['elo'],u=w[0x0][G(0x118)];}const v={'userId':r,'username':q[G(0xee)],'profileImageUrl':s['profileImageUrl']||null,'country':s[G(0x107)]||null,'motto':s[G(0x104)]||null,'favoriteMap':s[G(0xfd)]||null,'favoriteWeapon':s[G(0xf4)]||null,'isNonParticipant':q[G(0x108)],'ladders':q[G(0xe8)],'primaryLadder':u,'highestElo':t,'rank':getPlayerRank(t),'lastUpdated':admin[G(0xfb)]['FieldValue'][G(0xf8)]()};k[G(0xf5)](v);});const l=db[D(0xea)](D(0x102)),m=await l['get'](),n=[];m[D(0x111)](q=>{const H=D;n[H(0xf5)](q['ref']['delete']());}),await Promise['all'](n);const o=0x1f4,p=[];for(let q=0x0;q<k[D(0x11c)];q+=o){const r=db['batch'](),s=k['slice'](q,q+o);s['forEach'](t=>{const I=D,u=l[I(0x10b)](t['userId']);r[I(0x106)](u,t);}),p[D(0xf5)](r[D(0x10e)]());}await Promise['all'](p);}function getPlayerRank(a){const J=a38B;if(a>=0x7d0)return J(0xf3);if(a>=0x708)return'gold';if(a>=0x640)return J(0xff);if(a>=0x578)return J(0x109);return'unranked';}exports[a38B(0xf2)]=functions['https']['onRequest'](async(a,b)=>{const K=a38B;try{await rebuildMembersList(),b['status'](0xc8)[K(0x119)](K(0xeb));}catch(c){console['error'](K(0xe6),c),b['status'](0x1f4)[K(0x119)]('Error\x20rebuilding\x20members\x20list');}});
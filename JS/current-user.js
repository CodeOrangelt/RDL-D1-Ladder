const a12x=a12b;(function(a,b){const w=a12b,c=a();while(!![]){try{const d=parseInt(w(0x73))/0x1+parseInt(w(0x85))/0x2+-parseInt(w(0x93))/0x3+parseInt(w(0x82))/0x4+parseInt(w(0x95))/0x5+parseInt(w(0x86))/0x6*(parseInt(w(0x84))/0x7)+-parseInt(w(0x8c))/0x8;if(d===b)break;else c['push'](c['shift']());}catch(e){c['push'](c['shift']());}}}(a12a,0x91a7b));import{getAuth,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';function a12b(a,b){const c=a12a();return a12b=function(d,e){d=d-0x72;let f=c[d];if(a12b['vcMuLC']===undefined){var g=function(l){const m='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let n='',o='';for(let p=0x0,q,r,s=0x0;r=l['charAt'](s++);~r&&(q=p%0x4?q*0x40+r:r,p++%0x4)?n+=String['fromCharCode'](0xff&q>>(-0x2*p&0x6)):0x0){r=m['indexOf'](r);}for(let t=0x0,u=n['length'];t<u;t++){o+='%'+('00'+n['charCodeAt'](t)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(o);};a12b['dFEwrz']=g,a=arguments,a12b['vcMuLC']=!![];}const h=c[0x0],i=d+h,j=a[i];return!j?(f=a12b['dFEwrz'](f),a[i]=f):f=j,f;},a12b(a,b);}import{doc,getDoc,collection,query,where,getDocs,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import{isAdmin}from'./admin-check.js';const ADMIN_EMAILS=[a12x(0xb0),a12x(0x8e)],userCache={'uid':null,'username':null,'isAdmin':![],'hasCheckedCollections':![],'lastChecked':0x0,'role':null},invitationCache={'lastCheck':0x0,'pendingCount':0x0,'checkInterval':0x493e0};function updateInboxNotification(a){const y=a12x,b=document[y(0x7c)](y(0xa3));b&&(a>0x0?(b[y(0x9b)]['display']='inline-block',b['textContent']=a>0x9?'9+':a):b[y(0x9b)]['display']='none');}async function checkPendingInvitationsForCurrentUser(a){const z=a12x;try{const b=Date['now']();if(b-invitationCache[z(0x9f)]<invitationCache['checkInterval'])return updateInboxNotification(invitationCache['pendingCount']),invitationCache[z(0x94)];invitationCache[z(0x9f)]=b;const c=collection(db,'gameInvitations'),d=query(c,where(z(0x8f),'==',a),where(z(0x72),'==',z(0xa5)),limit(0x5)),e=await getDocs(d),f=e['size'];return invitationCache['pendingCount']=f,updateInboxNotification(f),f;}catch(g){return console['warn'](z(0x80),g),0x0;}}function updateAuthSectionImmediate(a,b=![]){const A=a12x,c=document['getElementById'](A(0x83));if(!c)return;if(a&&b)document['querySelectorAll'](A(0xaa))[A(0x88)](d=>{const B=A;d[B(0x9b)]['display']='block';});else!a&&document[A(0x81)]('.admin-only')['forEach'](d=>{const C=A;d[C(0x9b)]['display']='none';});if(a){const d=userCache[A(0x92)]||(a['email']?a[A(0x9d)]['split']('@')[0x0]:A(0x87)),e=userCache[A(0x79)]?'\x20('+userCache['role']+')':b?'\x20(Admin)':'';c[A(0x7e)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20class=\x22nav-username\x22>'+d+e+'</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username='+encodeURIComponent(d)+'\x22>Profile</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./inbox.html\x22\x20class=\x22nav-notification\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Inbox\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22inbox-notification\x22\x20class=\x22notification-dot\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22members.html\x22>Members</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./redeem.html\x22><i\x20class=\x22fas\x20fa-gift\x22></i>\x20Redeem</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20id=\x22logout-link\x22>Sign\x20Out</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';const f=document[A(0x7c)](A(0x78));f&&f['addEventListener'](A(0xa4),g=>{const D=A;g['preventDefault']();const h=getAuth();updateAuthSectionImmediate(null),h[D(0xa2)]()['catch'](i=>{const E=D;console['error'](E(0xa0),i);});}),a[A(0xb2)]&&setTimeout(()=>{checkPendingInvitationsForCurrentUser(a['uid']);},0x3e8);}else c[A(0x7e)]=A(0x97);}function a12a(){const M=['zw1WDhK','ywrKrxzLBNrmAxn0zw5LCG','DxnLCM5HBwu','mJe5mZqZnuf3v0vdzG','CgvUzgLUz0nVDw50','mJu2mdG4nwzQt1zQrW','DgHLBG','pgeGAhjLzJ0IBg9NAw4UAhrTBciGy2XHC3m9iMXVz2LUlwXPBMSIpKXVz2LUpc9HpG','Bg9N','CgXHEwvYC0qY','Aw5JBhvKzxm','C3r5Bgu','y291BMnPBa','zw1HAwW','B3DUzxi','BgfZDenOzwnR','rxjYB3iGC2LNBMLUzYbVDxq6','re9nq29UDgvUDeXVywrLza','C2LNBK91Da','Aw5IB3GTBM90AwzPy2f0Aw9U','y2XPy2S','CgvUzgLUzW','y2HHCKf0','CgXHEwvYC0nurG','AgfZq2HLy2TLzenVBgXLy3rPB25Z','tM8GywrTAw4GCM9SzxmGzM91BMqGzM9YihvZzxi','lMfKBwLUlw9UBhK','zxHPC3rZ','CM9Szu5HBwu','rxjYB3iGy2HLy2TPBMCG','rxjYB3iGAw4GzNvSBcbHDxrOihvWzgf0ztO','Axnbzg1PBG','ywrTAw5aBgfKzgvYlMnVBq','zg9JCW','DwLK','C3rHDhvZ','oteWnZa1vgjIDhbu','y3vYCMvUDfvZzxi','zgf0yq','BwfW','q2HLy2TPBMCGCM9SzxmGzM9YihvZzxi6ia','Bg9NB3v0lwXPBMS','CM9Szq','DxnLCLbYB2zPBgvZ','rM91BMqGywrTAw4GCM9SztOG','z2v0rwXLBwvUDej5swq','BM9UugfYDgLJAxbHBNrZ','Aw5Uzxjive1m','CgXHEwvYC0r1B3m','q291BgqGBM90ignOzwnRihbLBMrPBMCGAw52AxrHDgLVBNmGzM9Yign1CNjLBNqGDxnLCJO','CxvLCNLtzwXLy3rVCKfSBa','mZe5mZG3mNj4D0jHCa','yxv0Ac1Zzwn0Aw9U','ndq1mJDdrfLhA0q','ntC5nJaYu25cELj5','nteWzwv6rvnt','vxnLCG','zM9YrwfJAa','C3bSAxq','Dg9mB3DLCKnHC2u','CgXHEwvYCW','mtm3oti3mdrhugjWBNC','rxjYB3iGAw4Gy2HLy2Tbzg1PBLjVBgvZoG','qNjPyw4YywzaB3v0Bg9VAY5JB20','Dg9vC2vYswq'];a12a=function(){return M;};return a12a();}async function checkAdminRoles(a){const F=a12x;if(!a||!a['email'])return{'isAdmin':![],'role':null};try{console['log'](F(0x77)+a['email']);const b=['players',F(0x99),'playersD3','nonParticipants',F(0x7a)],c=[F(0x9c),'creative\x20lead',F(0x9e),'admin'];for(const d of b){try{const e=doc(db,d,a[F(0xb2)]),f=await getDoc(e);if(f[F(0xab)]()){const g=f[F(0x75)]();console[F(0x98)]('Found\x20user\x20in\x20'+d+'\x20by\x20UID:',g);let h=(g[F(0xac)]||g['role']||'')['toLowerCase'](),i=g[F(0xac)]||g[F(0x79)]||'';if(h&&c[F(0x9a)](h)){console['log']('Found\x20admin\x20role:\x20'+h+'\x20in\x20'+d);const j=i[F(0x89)]('\x20')['map'](k=>k[F(0xa6)](0x0)['toUpperCase']()+k['slice'](0x1)['toLowerCase']())['join']('\x20');return{'isAdmin':!![],'role':j};}}}catch(k){console['error']('Error\x20checking\x20'+d+'\x20by\x20UID:',k);}}for(const l of b){try{const m=collection(db,l);let n=query(m,where(F(0x9d),'==',a[F(0x9d)])),o=await getDocs(n);o[F(0x90)]&&(n=query(m,where(F(0x9d),'==',a['email'][F(0x8a)]())),o=await getDocs(n));if(!o[F(0x90)]){const p=o[F(0xb1)][0x0][F(0x75)]();console['log']('Found\x20user\x20in\x20'+l+'\x20by\x20email:',p);let r=(p['roleName']||p[F(0x79)]||'')[F(0x8a)](),s=p[F(0xac)]||p[F(0x79)]||'';if(r&&c[F(0x9a)](r)){console[F(0x98)](F(0x7b)+r+'\x20in\x20'+l);const t=s['split']('\x20')['map'](u=>u[F(0xa6)](0x0)['toUpperCase']()+u['slice'](0x1)[F(0x8a)]())['join']('\x20');return{'isAdmin':!![],'role':t};}}}catch(u){console['error'](F(0xad)+l+'\x20by\x20email:',u);}}return console[F(0x98)](F(0xa9)),{'isAdmin':![],'role':null};}catch(v){return console['error'](F(0x8d),v),{'isAdmin':![],'role':null};}}async function updateAuthSection(a){const G=a12x,b=a&&isAdmin(a[G(0x9d)]);updateAuthSectionImmediate(a,b);if(!a){userCache[G(0xb2)]=null,userCache['username']=null,userCache[G(0xaf)]=![],userCache['hasCheckedCollections']=![],userCache['role']=null;return;}const c=Date['now']();if(a['uid']===userCache['uid']&&userCache['hasCheckedCollections']&&c-userCache['lastChecked']<0x493e0)return;try{userCache[G(0xb2)]=a['uid'],userCache['lastChecked']=c;const d=isAdmin(a[G(0x9d)]);userCache['isAdmin']=d;if(!d){const {isAdmin:j,role:k}=await checkAdminRoles(a);userCache[G(0xaf)]=j,userCache['role']=k,j&&(document[G(0x81)](G(0xaa))[G(0x88)](l=>{const H=G;l[H(0x9b)]['display']='block';}),updateAuthSectionImmediate(a,!![]));}const e=[G(0x8b),'playersD2','playersD3',G(0x7f),G(0xa7),G(0x7d),G(0x7a)],f=e[G(0x76)](l=>getDoc(doc(db,l,a['uid']))[G(0x96)](m=>m[G(0xab)]()?{'collection':l,'data':m['data']()}:null)['catch'](()=>null)),g=await Promise['all'](f),h=g['filter'](l=>l!==null);let i=null;for(const l of h){if(l[G(0x75)][G(0x92)]){i=l[G(0x75)]['username'];break;}}userCache[G(0x92)]=i||(a['email']?a[G(0x9d)]['split']('@')[0x0]:G(0x87)),userCache[G(0xa8)]=!![],updateAuthSectionImmediate(a,userCache[G(0xaf)]),setTimeout(()=>{const I=G;checkPendingInvitationsForCurrentUser(a[I(0xb2)]);},0x1f4);}catch(m){console['error'](G(0xae),m);}}document[a12x(0x91)](a12x(0xa1),()=>{const K=a12x,a=getAuth();onAuthStateChanged(a,async b=>{await updateAuthSection(b),b&&checkPendingInvitationsForCurrentUser(b['uid']);}),document['addEventListener']('visibilitychange',()=>{const J=a12b;!document['hidden']&&a[J(0x74)]&&checkPendingInvitationsForCurrentUser(a['currentUser']['uid']);}),document[K(0x91)](K(0xa4),b=>{const L=K;b['target']['closest']('a[href]')&&a[L(0x74)]&&checkPendingInvitationsForCurrentUser(a['currentUser'][L(0xb2)]);});});export{updateAuthSection};
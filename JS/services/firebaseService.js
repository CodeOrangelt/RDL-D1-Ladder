const a56_0x35fe64=a56_0x16e3,a56_0x38e260=(function(){let _0x23f501=!![];return function(_0x13f4ff,_0x3c9770){const _0x26c53e=_0x23f501?function(){if(_0x3c9770){const _0x3e594f=_0x3c9770['apply'](_0x13f4ff,arguments);return _0x3c9770=null,_0x3e594f;}}:function(){};return _0x23f501=![],_0x26c53e;};}()),a56_0x3376d2=a56_0x38e260(this,function(){const _0x9ab311=a56_0x16e3;let _0x10addb;try{const _0x12e4dc=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x10addb=_0x12e4dc();}catch(_0x2b1c3f){_0x10addb=window;}const _0x53a691=_0x10addb['console']=_0x10addb['console']||{},_0x289b65=['log','warn','info','error',_0x9ab311(0xd6),'table','trace'];for(let _0x1ebead=0x0;_0x1ebead<_0x289b65['length'];_0x1ebead++){const _0x427729=a56_0x38e260['constructor']['prototype']['bind'](a56_0x38e260),_0x5921a0=_0x289b65[_0x1ebead],_0x2ef5e2=_0x53a691[_0x5921a0]||_0x427729;_0x427729['__proto__']=a56_0x38e260['bind'](a56_0x38e260),_0x427729['toString']=_0x2ef5e2[_0x9ab311(0xdb)][_0x9ab311(0xdd)](_0x2ef5e2),_0x53a691[_0x5921a0]=_0x427729;}});a56_0x3376d2();import{db}from'../firebase-config.js';import{collection,doc,getDoc,getDocs,query,limit,startAfter,where,onSnapshot}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const cache={'userProfiles':new Map(),'ladderPlayers':new Map(),'matchResults':new Map(),'eloHistory':new Map()},CACHE_EXPIRY={'userProfiles':0x5*0x3c*0x3e8,'ladderPlayers':0x2*0x3c*0x3e8,'matchResults':0x1*0x3c*0x3e8,'eloHistory':0x3*0x3c*0x3e8};export const userProfilesRef=collection(db,a56_0x35fe64(0xd8));export async function fetchPaginatedData(_0x4f3260,_0x1dacd7=0xa,_0x501ea0=null){const _0x393436=a56_0x35fe64;let _0x5ca0fb=query(_0x4f3260,limit(_0x1dacd7));_0x501ea0&&(_0x5ca0fb=query(_0x5ca0fb,startAfter(_0x501ea0)));const _0x401910=await getDocs(_0x5ca0fb),_0x5d6eee=_0x401910[_0x393436(0xd0)][_0x401910['docs']['length']-0x1];return{'data':_0x401910['docs']['map'](_0x16efb5=>({'id':_0x16efb5['id'],..._0x16efb5['data']()})),'lastVisible':_0x5d6eee,'hasMore':_0x401910['docs']['length']===_0x1dacd7};}export async function getUserProfile(_0x58c303){const _0x2caf1a=a56_0x35fe64,_0x17aa65=cache[_0x2caf1a(0xd8)]['get'](_0x58c303);if(_0x17aa65&&Date['now']()-_0x17aa65['timestamp']<CACHE_EXPIRY['userProfiles'])return _0x17aa65[_0x2caf1a(0xdc)];const _0x2a7a13=await getDoc(doc(userProfilesRef,_0x58c303));if(_0x2a7a13['exists']()){const _0x2ccae2=_0x2a7a13['data']();return cache['userProfiles']['set'](_0x58c303,{'data':_0x2ccae2,'timestamp':Date['now']()}),_0x2ccae2;}return null;}export async function getLadderData(_0x2de9e2=0x1){const _0x2c8d8e=a56_0x35fe64,_0x321d07='division_'+_0x2de9e2,_0x26ad60=cache['ladderPlayers']['get'](_0x321d07);if(_0x26ad60&&Date['now']()-_0x26ad60[_0x2c8d8e(0xd7)]<CACHE_EXPIRY[_0x2c8d8e(0xd5)])return _0x26ad60['data'];const _0x783207=_0x2de9e2===0x1?'players':_0x2c8d8e(0xd9)+_0x2de9e2,_0x4bf8eb=collection(db,_0x783207),_0x56ee3e=await getDocs(query(_0x4bf8eb,limit(0x64))),_0x14ce76=_0x56ee3e['docs']['map'](_0x25212b=>({'id':_0x25212b['id'],..._0x25212b[_0x2c8d8e(0xdc)]()}));return cache[_0x2c8d8e(0xd5)]['set'](_0x321d07,{'data':_0x14ce76,'timestamp':Date['now']()}),_0x14ce76;}function a56_0x16e3(_0x1c9ecb,_0x17db89){const _0x3376d2=a56_0x32f8();return a56_0x16e3=function(_0x38e260,_0x1d364b){_0x38e260=_0x38e260-0xd0;let _0x32f8fe=_0x3376d2[_0x38e260];return _0x32f8fe;},a56_0x16e3(_0x1c9ecb,_0x17db89);}function a56_0x32f8(){const _0x634c49=['docs','forEach','now','push','length','ladderPlayers','exception','timestamp','userProfiles','playersD','doc','toString','data','bind'];a56_0x32f8=function(){return _0x634c49;};return a56_0x32f8();}export async function getEloHistoryBatch(_0x29a369,_0x2c44d7=0x1){const _0x330485=a56_0x35fe64,_0x4d8ffa=_0x2c44d7===0x1?'eloHistory':'eloHistoryD'+_0x2c44d7,_0x1e711d=collection(db,_0x4d8ffa),_0x29b989={},_0x4829f3=[];_0x29a369['forEach'](_0x301708=>{const _0x21acfb=a56_0x16e3,_0x2143d5=_0x301708+'_'+_0x2c44d7,_0x276513=cache['eloHistory']['get'](_0x2143d5);_0x276513&&Date['now']()-_0x276513['timestamp']<CACHE_EXPIRY['eloHistory']?_0x29b989[_0x301708]=_0x276513['data']:_0x4829f3[_0x21acfb(0xd3)](_0x301708);});const _0x4c5eb8=0xa;for(let _0xcf465d=0x0;_0xcf465d<_0x4829f3[_0x330485(0xd4)];_0xcf465d+=_0x4c5eb8){const _0x52fe9a=_0x4829f3['slice'](_0xcf465d,_0xcf465d+_0x4c5eb8);if(_0x52fe9a['length']>0x0)try{const _0x1fe96e=query(_0x1e711d,where('playerId','in',_0x52fe9a),limit(0x64)),_0x323752=await getDocs(_0x1fe96e);_0x323752['docs'][_0x330485(0xd1)](_0x3eb95d=>{const _0x48a5e2=_0x3eb95d['data'](),_0x1455a3=_0x48a5e2['playerId'];if(!_0x29b989[_0x1455a3])_0x29b989[_0x1455a3]=[];_0x29b989[_0x1455a3]['push'](_0x48a5e2);const _0x4eaf08=_0x1455a3+'_'+_0x2c44d7;cache['eloHistory']['set'](_0x4eaf08,{'data':_0x29b989[_0x1455a3],'timestamp':Date['now']()});});}catch(_0x1ee4dd){console['error']('Error\x20fetching\x20batch\x20ELO\x20history:',_0x1ee4dd);}}return _0x29b989;}let usernameCache=new Map(),usernameCacheTimestamp=Date[a56_0x35fe64(0xd2)]();export function setupEfficientListener(_0x1fe36a,_0x1f293e=[],_0x34b77c){const _0x25590b=collection(db,_0x1fe36a),_0xd77e67=query(_0x25590b,..._0x1f293e),_0x42afcd=onSnapshot(_0xd77e67,_0x4b6258=>{const _0x2882bd=a56_0x16e3,_0x3aecc0=_0x4b6258['docChanges']()['map'](_0x8ddd01=>({'type':_0x8ddd01['type'],'id':_0x8ddd01[_0x2882bd(0xda)]['id'],'data':_0x8ddd01['doc']['data']()}));_0x3aecc0['length']>0x0&&_0x34b77c(_0x3aecc0,_0x4b6258['docs']);});return _0x42afcd;}export async function bulkResolveUsernames(_0x5f3b66){const _0x618231=a56_0x35fe64,_0x514fea=new Map();if(!_0x5f3b66||_0x5f3b66['length']===0x0)return _0x514fea;const _0x87703b=['players','playersD2','playersD3','nonParticipants'];for(const _0x1c9f7c of _0x87703b){const _0x233b98=collection(db,_0x1c9f7c),_0x396a4e=await getDocs(_0x233b98);_0x396a4e[_0x618231(0xd1)](_0x5a76d0=>{const _0x25e6bf=_0x618231,_0xc84b27=_0x5a76d0[_0x25e6bf(0xdc)]();_0xc84b27['username']&&_0x5f3b66['includes'](_0x5a76d0['id'])&&_0x514fea['set'](_0x5a76d0['id'],_0xc84b27['username']);});}return _0x514fea;}
const a12_0x52bfdc=a12_0x156b,a12_0x921484=(function(){let _0x5b2ce9=!![];return function(_0x173653,_0x1ebb1b){const _0x187ac8=_0x5b2ce9?function(){if(_0x1ebb1b){const _0x119fd8=_0x1ebb1b['apply'](_0x173653,arguments);return _0x1ebb1b=null,_0x119fd8;}}:function(){};return _0x5b2ce9=![],_0x187ac8;};}()),a12_0x175cf5=a12_0x921484(this,function(){const _0x46afdd=a12_0x156b;let _0x49dd7f;try{const _0x3f5125=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x49dd7f=_0x3f5125();}catch(_0x59533e){_0x49dd7f=window;}const _0x163bbd=_0x49dd7f['console']=_0x49dd7f['console']||{},_0x5bd364=[_0x46afdd(0x1ba),_0x46afdd(0x1a4),_0x46afdd(0x1a7),'error',_0x46afdd(0x1a2),'table','trace'];for(let _0x80bb9a=0x0;_0x80bb9a<_0x5bd364['length'];_0x80bb9a++){const _0x332af5=a12_0x921484['constructor']['prototype'][_0x46afdd(0x1c8)](a12_0x921484),_0x197eab=_0x5bd364[_0x80bb9a],_0x34c113=_0x163bbd[_0x197eab]||_0x332af5;_0x332af5[_0x46afdd(0x1aa)]=a12_0x921484['bind'](a12_0x921484),_0x332af5['toString']=_0x34c113['toString']['bind'](_0x34c113),_0x163bbd[_0x197eab]=_0x332af5;}});a12_0x175cf5();function a12_0x156b(_0x25a816,_0x5c67d0){const _0x175cf5=a12_0x3a83();return a12_0x156b=function(_0x921484,_0x12db8b){_0x921484=_0x921484-0x199;let _0x3a839e=_0x175cf5[_0x921484];return _0x3a839e;},a12_0x156b(_0x25a816,_0x5c67d0);}import{getAuth,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{doc,getDoc,collection,query,where,getDocs,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import{isAdmin}from'./admin-check.js';const ADMIN_EMAILS=[a12_0x52bfdc(0x1b9),'Brian2af@outlook.com'],userCache={'uid':null,'username':null,'isAdmin':![],'hasCheckedCollections':![],'lastChecked':0x0,'role':null},invitationCache={'lastCheck':0x0,'pendingCount':0x0,'checkInterval':0x493e0};function updateInboxNotification(_0x51378f){const _0x52ca2c=a12_0x52bfdc,_0x4005cc=document[_0x52ca2c(0x1b7)]('inbox-notification');_0x4005cc&&(_0x51378f>0x0?(_0x4005cc['style']['display']='inline-block',_0x4005cc['textContent']=_0x51378f>0x9?'9+':_0x51378f):_0x4005cc['style'][_0x52ca2c(0x19c)]=_0x52ca2c(0x1c6));}async function checkPendingInvitationsForCurrentUser(_0x2a7a57){const _0x5348a7=a12_0x52bfdc;try{const _0x58afd0=Date['now']();if(_0x58afd0-invitationCache[_0x5348a7(0x1bd)]<invitationCache['checkInterval'])return updateInboxNotification(invitationCache[_0x5348a7(0x1b6)]),invitationCache['pendingCount'];invitationCache['lastCheck']=_0x58afd0;const _0x58c591=collection(db,'gameInvitations'),_0x51b3c5=query(_0x58c591,where('toUserId','==',_0x2a7a57),where('status','==','pending'),limit(0x5)),_0x4bda4e=await getDocs(_0x51b3c5),_0x5b7ddd=_0x4bda4e['size'];return invitationCache[_0x5348a7(0x1b6)]=_0x5b7ddd,updateInboxNotification(_0x5b7ddd),_0x5b7ddd;}catch(_0x7bf436){return console[_0x5348a7(0x1a4)]('Could\x20not\x20check\x20pending\x20invitations\x20for\x20current\x20user:',_0x7bf436),0x0;}}function updateAuthSectionImmediate(_0x2d9d4,_0x569b7f=![]){const _0x3cd130=a12_0x52bfdc,_0x2befe9=document[_0x3cd130(0x1b7)]('auth-section');if(!_0x2befe9)return;if(_0x2d9d4&&_0x569b7f)document[_0x3cd130(0x1bb)](_0x3cd130(0x1c1))['forEach'](_0x2800a8=>{const _0x30f145=_0x3cd130;_0x2800a8['style'][_0x30f145(0x19c)]='block';});else!_0x2d9d4&&document[_0x3cd130(0x1bb)]('.admin-only')['forEach'](_0x2b96da=>{const _0x466708=_0x3cd130;_0x2b96da[_0x466708(0x1b5)]['display']=_0x466708(0x1c6);});if(_0x2d9d4){const _0x38e2b9=userCache['username']||(_0x2d9d4[_0x3cd130(0x1a8)]?_0x2d9d4['email']['split']('@')[0x0]:'User'),_0x1e3442=userCache['role']?'\x20('+userCache[_0x3cd130(0x1c7)]+')':_0x569b7f?'\x20(Admin)':'';_0x2befe9[_0x3cd130(0x1a5)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20class=\x22nav-username\x22>'+_0x38e2b9+_0x1e3442+'</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username='+encodeURIComponent(_0x38e2b9)+'\x22>Profile</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./inbox.html\x22\x20class=\x22nav-notification\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Inbox\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22inbox-notification\x22\x20class=\x22notification-dot\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22members.html\x22>Members</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./redeem.html\x22><i\x20class=\x22fas\x20fa-gift\x22></i>\x20Redeem</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20id=\x22logout-link\x22>Sign\x20Out</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';const _0x11160a=document['getElementById']('logout-link');_0x11160a&&_0x11160a[_0x3cd130(0x1bf)]('click',_0x28eb42=>{_0x28eb42['preventDefault']();const _0x675dda=getAuth();updateAuthSectionImmediate(null),_0x675dda['signOut']()['catch'](_0x3174bb=>{console['error']('Error\x20signing\x20out:',_0x3174bb);});}),_0x2d9d4['uid']&&setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0x2d9d4['uid']);},0x3e8);}else _0x2befe9[_0x3cd130(0x1a5)]='<a\x20href=\x22login.html\x22\x20class=\x22login-link\x22>Login</a>';}async function checkAdminRoles(_0x225802){const _0x4c24ce=a12_0x52bfdc;if(!_0x225802||!_0x225802[_0x4c24ce(0x1a8)])return{'isAdmin':![],'role':null};try{console['log']('Checking\x20roles\x20for\x20user:\x20'+_0x225802['email']);const _0x403d5c=['players','playersD2','playersD3',_0x4c24ce(0x1c9),'userProfiles'],_0x3fdbe3=['council','creative\x20lead','owner','admin'];for(const _0x1bb3d8 of _0x403d5c){try{const _0x247e86=doc(db,_0x1bb3d8,_0x225802[_0x4c24ce(0x1a0)]),_0x57771b=await getDoc(_0x247e86);if(_0x57771b[_0x4c24ce(0x1b8)]()){const _0x1ffe4b=_0x57771b['data']();console['log'](_0x4c24ce(0x1b0)+_0x1bb3d8+_0x4c24ce(0x1ac),_0x1ffe4b);let _0x5b42fe=(_0x1ffe4b['roleName']||_0x1ffe4b['role']||'')['toLowerCase'](),_0xe5554f=_0x1ffe4b['roleName']||_0x1ffe4b[_0x4c24ce(0x1c7)]||'';if(_0x5b42fe&&_0x3fdbe3['includes'](_0x5b42fe)){console['log']('Found\x20admin\x20role:\x20'+_0x5b42fe+_0x4c24ce(0x1ab)+_0x1bb3d8);const _0x313458=_0xe5554f['split']('\x20')['map'](_0x2dd694=>_0x2dd694[_0x4c24ce(0x19e)](0x0)['toUpperCase']()+_0x2dd694[_0x4c24ce(0x19b)](0x1)['toLowerCase']())[_0x4c24ce(0x19d)]('\x20');return{'isAdmin':!![],'role':_0x313458};}}}catch(_0x1db56f){console['error']('Error\x20checking\x20'+_0x1bb3d8+'\x20by\x20UID:',_0x1db56f);}}for(const _0x6023ba of _0x403d5c){try{const _0x4ebc2e=collection(db,_0x6023ba);let _0x5cf25b=query(_0x4ebc2e,where(_0x4c24ce(0x1a8),'==',_0x225802['email'])),_0x3f8d44=await getDocs(_0x5cf25b);_0x3f8d44[_0x4c24ce(0x1c3)]&&(_0x5cf25b=query(_0x4ebc2e,where('email','==',_0x225802['email'][_0x4c24ce(0x1b2)]())),_0x3f8d44=await getDocs(_0x5cf25b));if(!_0x3f8d44[_0x4c24ce(0x1c3)]){const _0x6b6168=_0x3f8d44['docs'][0x0][_0x4c24ce(0x1bc)]();console['log']('Found\x20user\x20in\x20'+_0x6023ba+'\x20by\x20email:',_0x6b6168);let _0x3a142e=(_0x6b6168['roleName']||_0x6b6168['role']||'')[_0x4c24ce(0x1b2)](),_0x192c5f=_0x6b6168[_0x4c24ce(0x1a3)]||_0x6b6168['role']||'';if(_0x3a142e&&_0x3fdbe3[_0x4c24ce(0x1b1)](_0x3a142e)){console['log'](_0x4c24ce(0x19f)+_0x3a142e+'\x20in\x20'+_0x6023ba);const _0x5ed404=_0x192c5f[_0x4c24ce(0x1c2)]('\x20')['map'](_0x5e658f=>_0x5e658f['charAt'](0x0)['toUpperCase']()+_0x5e658f['slice'](0x1)['toLowerCase']())[_0x4c24ce(0x19d)]('\x20');return{'isAdmin':!![],'role':_0x5ed404};}}}catch(_0x5c9de3){console['error'](_0x4c24ce(0x1ae)+_0x6023ba+'\x20by\x20email:',_0x5c9de3);}}return console['log']('No\x20admin\x20roles\x20found\x20for\x20user'),{'isAdmin':![],'role':null};}catch(_0x3c6820){return console['error']('Error\x20in\x20checkAdminRoles:',_0x3c6820),{'isAdmin':![],'role':null};}}async function updateAuthSection(_0x2db217){const _0x1178c7=a12_0x52bfdc,_0x4107e0=_0x2db217&&isAdmin(_0x2db217['email']);updateAuthSectionImmediate(_0x2db217,_0x4107e0);if(!_0x2db217){userCache['uid']=null,userCache['username']=null,userCache[_0x1178c7(0x1a6)]=![],userCache['hasCheckedCollections']=![],userCache['role']=null;return;}const _0x2326b6=Date['now']();if(_0x2db217[_0x1178c7(0x1a0)]===userCache['uid']&&userCache[_0x1178c7(0x1ad)]&&_0x2326b6-userCache[_0x1178c7(0x1b3)]<0x493e0)return;try{userCache['uid']=_0x2db217['uid'],userCache['lastChecked']=_0x2326b6;const _0x1ed964=isAdmin(_0x2db217['email']);userCache['isAdmin']=_0x1ed964;if(!_0x1ed964){const {isAdmin:_0x1af8f9,role:_0x235cb6}=await checkAdminRoles(_0x2db217);userCache['isAdmin']=_0x1af8f9,userCache['role']=_0x235cb6,_0x1af8f9&&(document['querySelectorAll']('.admin-only')['forEach'](_0x124877=>{const _0x3be7b6=_0x1178c7;_0x124877['style'][_0x3be7b6(0x19c)]=_0x3be7b6(0x1ca);}),updateAuthSectionImmediate(_0x2db217,!![]));}const _0x21616a=['players','playersD2',_0x1178c7(0x1a9),'playersDuos','playersCTF','nonParticipants',_0x1178c7(0x1c4)],_0x395c5d=_0x21616a[_0x1178c7(0x199)](_0x26a974=>getDoc(doc(db,_0x26a974,_0x2db217[_0x1178c7(0x1a0)]))['then'](_0x40fd49=>_0x40fd49['exists']()?{'collection':_0x26a974,'data':_0x40fd49['data']()}:null)['catch'](()=>null)),_0x465a74=await Promise['all'](_0x395c5d),_0x1339d2=_0x465a74[_0x1178c7(0x1c5)](_0x1016ef=>_0x1016ef!==null);let _0x1441ca=null;for(const _0x402781 of _0x1339d2){if(_0x402781['data']['username']){_0x1441ca=_0x402781['data'][_0x1178c7(0x1be)];break;}}userCache['username']=_0x1441ca||(_0x2db217['email']?_0x2db217['email'][_0x1178c7(0x1c2)]('@')[0x0]:_0x1178c7(0x1c0)),userCache['hasCheckedCollections']=!![],updateAuthSectionImmediate(_0x2db217,userCache['isAdmin']),setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0x2db217['uid']);},0x1f4);}catch(_0x43c35b){console['error']('Error\x20in\x20full\x20auth\x20update:',_0x43c35b);}}function a12_0x3a83(){const _0x2e2d02=['map','currentUser','slice','display','join','charAt','Found\x20admin\x20role:\x20','uid','hidden','exception','roleName','warn','innerHTML','isAdmin','info','email','playersD3','__proto__','\x20in\x20','\x20by\x20UID:','hasCheckedCollections','Error\x20checking\x20','closest','Found\x20user\x20in\x20','includes','toLowerCase','lastChecked','a[href]','style','pendingCount','getElementById','exists','admin@ladder.com','log','querySelectorAll','data','lastCheck','username','addEventListener','User','.admin-only','split','empty','userProfiles','filter','none','role','bind','nonParticipants','block'];a12_0x3a83=function(){return _0x2e2d02;};return a12_0x3a83();}document[a12_0x52bfdc(0x1bf)]('DOMContentLoaded',()=>{const _0x5d32f8=getAuth();onAuthStateChanged(_0x5d32f8,async _0xb5d976=>{await updateAuthSection(_0xb5d976),_0xb5d976&&checkPendingInvitationsForCurrentUser(_0xb5d976['uid']);}),document['addEventListener']('visibilitychange',()=>{const _0x543c5a=a12_0x156b;!document[_0x543c5a(0x1a1)]&&_0x5d32f8['currentUser']&&checkPendingInvitationsForCurrentUser(_0x5d32f8[_0x543c5a(0x19a)]['uid']);}),document['addEventListener']('click',_0x53bf7b=>{const _0x4395cc=a12_0x156b;_0x53bf7b['target'][_0x4395cc(0x1af)](_0x4395cc(0x1b4))&&_0x5d32f8['currentUser']&&checkPendingInvitationsForCurrentUser(_0x5d32f8[_0x4395cc(0x19a)][_0x4395cc(0x1a0)]);});});export{updateAuthSection};
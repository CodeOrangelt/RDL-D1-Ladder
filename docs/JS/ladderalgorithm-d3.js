(function(_0x5c0870,_0x250fde){const _0x3a8903=a0_0x5a5a,_0x2ee1cf=_0x5c0870();while(!![]){try{const _0x153549=parseInt(_0x3a8903(0x122))/0x1+parseInt(_0x3a8903(0x11d))/0x2+-parseInt(_0x3a8903(0x11c))/0x3+-parseInt(_0x3a8903(0x12d))/0x4*(-parseInt(_0x3a8903(0x12e))/0x5)+parseInt(_0x3a8903(0x118))/0x6*(parseInt(_0x3a8903(0x128))/0x7)+parseInt(_0x3a8903(0x115))/0x8+parseInt(_0x3a8903(0x114))/0x9*(-parseInt(_0x3a8903(0x112))/0xa);if(_0x153549===_0x250fde)break;else _0x2ee1cf['push'](_0x2ee1cf['shift']());}catch(_0x568e5b){_0x2ee1cf['push'](_0x2ee1cf['shift']());}}}(a0_0x372f,0xac6da));const a0_0x15a81d=(function(){let _0x40b065=!![];return function(_0x4169cc,_0x4a45f8){const _0x22dd10=_0x40b065?function(){if(_0x4a45f8){const _0x65ccda=_0x4a45f8['apply'](_0x4169cc,arguments);return _0x4a45f8=null,_0x65ccda;}}:function(){};return _0x40b065=![],_0x22dd10;};}()),a0_0x320d5e=a0_0x15a81d(this,function(){const _0x3eaf18=a0_0x5a5a;let _0x2f36d5;try{const _0x2fef89=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x2f36d5=_0x2fef89();}catch(_0x2e259f){_0x2f36d5=window;}const _0x41bbbe=_0x2f36d5[_0x3eaf18(0x10e)]=_0x2f36d5['console']||{},_0x1865c4=['log','warn','info',_0x3eaf18(0x10f),_0x3eaf18(0x110),'table',_0x3eaf18(0x11f)];for(let _0x44ca49=0x0;_0x44ca49<_0x1865c4[_0x3eaf18(0x124)];_0x44ca49++){const _0x1802e8=a0_0x15a81d['constructor']['prototype']['bind'](a0_0x15a81d),_0x1237e5=_0x1865c4[_0x44ca49],_0x27a356=_0x41bbbe[_0x1237e5]||_0x1802e8;_0x1802e8['__proto__']=a0_0x15a81d[_0x3eaf18(0x116)](a0_0x15a81d),_0x1802e8['toString']=_0x27a356['toString']['bind'](_0x27a356),_0x41bbbe[_0x1237e5]=_0x1802e8;}});a0_0x320d5e();import{addDoc,updateDoc,serverTimestamp,collection,doc,getDoc,getDocs,query,where,setDoc,deleteDoc,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';function a0_0x372f(){const _0x3eba07=['10640710tDHNwZ','Current\x20username:','9igqTrp','2005600LmbmXN','bind','winnerUsername','117510ObJcJa','all','loserUsername','D3\x20ELO\x20ratings\x20updated\x20successfully','2861484acfvtv','1091826cpJXGz','exists','trace','Current\x20user:','D3\x20Match\x20successfully\x20approved\x20and\x20ELO\x20updated','561281mqMbAz','eloRating','length','update','win','docs','259QmPuEQ','username','loss','log','playersD3','1283252eSdUyh','10agswIR','console','error','exception','pow'];a0_0x372f=function(){return _0x3eba07;};return a0_0x372f();}import{recordEloChangeD3}from'./elo-history-d3.js';export function calculateEloD3(_0x4d7036,_0x430e5e,_0x4af571=0x20){const _0x3597cb=a0_0x5a5a,_0x1c0887=0x1/(0x1+Math[_0x3597cb(0x111)](0xa,(_0x430e5e-_0x4d7036)/0x190)),_0xbb390e=0x1/(0x1+Math['pow'](0xa,(_0x4d7036-_0x430e5e)/0x190)),_0x10246d=_0x4d7036+_0x4af571*(0x1-_0x1c0887),_0x423928=_0x430e5e+_0x4af571*(0x0-_0xbb390e);return{'newWinnerRating':Math['round'](_0x10246d),'newLoserRating':Math['round'](_0x423928)};}export async function updateEloRatingsD3(_0x1df58d,_0x5a6faa,_0x381709){const _0x18e42e=a0_0x5a5a;try{const _0x1f85be=writeBatch(db),_0x3df2eb=doc(db,_0x18e42e(0x12c),_0x1df58d),_0x36da97=doc(db,_0x18e42e(0x12c),_0x5a6faa),[_0x482e01,_0x1b4a0d]=await Promise['all']([getDoc(_0x3df2eb),getDoc(_0x36da97)]);if(!_0x482e01[_0x18e42e(0x11e)]()||!_0x1b4a0d['exists']())throw new Error('One\x20or\x20both\x20D3\x20players\x20not\x20found');const _0x1e1dae=_0x482e01['data'](),_0xadba9b=_0x1b4a0d['data'](),_0x545e04=_0x1e1dae['position']||Number['MAX_SAFE_INTEGER'],_0x477375=_0xadba9b['position']||Number['MAX_SAFE_INTEGER'],{newWinnerRating:_0x26f16d,newLoserRating:_0x360fc8}=calculateEloD3(_0x1e1dae['eloRating']||0x4b0,_0xadba9b['eloRating']||0x4b0);let _0x4cecdf=_0x545e04,_0x130194=_0x477375;if(_0x545e04>_0x477375){console[_0x18e42e(0x12b)]('D3\x20Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked'),_0x4cecdf=_0x477375,_0x130194=_0x477375+0x1;const _0x4d1d75=query(collection(db,_0x18e42e(0x12c)),where('position','>',_0x477375),where('position','<',_0x545e04)),_0x35a2f8=await getDocs(_0x4d1d75);for(const _0x56a324 of _0x35a2f8[_0x18e42e(0x127)]){_0x56a324['id']!==_0x1df58d&&_0x56a324['id']!==_0x5a6faa&&_0x1f85be['update'](doc(db,'playersD3',_0x56a324['id']),{'position':_0x56a324['data']()['position']+0x1});}}else console['log']('D3\x20Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions');return _0x1f85be[_0x18e42e(0x125)](_0x3df2eb,{'eloRating':_0x26f16d,'lastMatchDate':serverTimestamp(),'position':_0x4cecdf,'lastMatchId':_0x381709}),_0x1f85be['update'](_0x36da97,{'eloRating':_0x360fc8,'lastMatchDate':serverTimestamp(),'position':_0x130194,'lastMatchId':_0x381709}),await _0x1f85be['commit'](),console['log'](_0x18e42e(0x11b)),await Promise[_0x18e42e(0x119)]([recordEloChangeD3({'playerId':_0x1df58d,'previousElo':_0x1e1dae[_0x18e42e(0x123)]||0x4b0,'newElo':_0x26f16d,'opponentId':_0x5a6faa,'matchResult':_0x18e42e(0x126),'previousPosition':_0x545e04,'newPosition':_0x4cecdf,'isPromotion':_0x4cecdf<_0x545e04,'matchId':_0x381709,'timestamp':serverTimestamp()}),recordEloChangeD3({'playerId':_0x5a6faa,'previousElo':_0xadba9b['eloRating']||0x4b0,'newElo':_0x360fc8,'opponentId':_0x1df58d,'matchResult':_0x18e42e(0x12a),'previousPosition':_0x477375,'newPosition':_0x130194,'isDemotion':_0x130194>_0x477375,'matchId':_0x381709,'timestamp':serverTimestamp()})]),!![];}catch(_0x21b3fd){console['error']('Error\x20in\x20updateEloRatingsD3:',_0x21b3fd);throw _0x21b3fd;}}function a0_0x5a5a(_0x4b6a02,_0x13ccd3){const _0x49efae=a0_0x372f();return a0_0x5a5a=function(_0x320d5e,_0x15a81d){_0x320d5e=_0x320d5e-0x10e;let _0x2c21f2=_0x49efae[_0x320d5e];return _0x2c21f2;},a0_0x5a5a(_0x4b6a02,_0x13ccd3);}export async function approveReportD3(_0x4afaf1,_0x461ca9,_0x533675,_0x1afef6){const _0x30d8e1=a0_0x5a5a;try{console['log']('Starting\x20approveReportD3\x20function\x20with:',{'reportId':_0x4afaf1,'winnerScore':_0x461ca9,'winnerSuicides':_0x533675,'winnerComment':_0x1afef6});const _0xc33568=auth['currentUser'];if(!_0xc33568){console[_0x30d8e1(0x12b)]('No\x20user\x20logged\x20in');throw new Error('You\x20must\x20be\x20logged\x20in\x20to\x20approve\x20D3\x20matches');}console['log'](_0x30d8e1(0x120),_0xc33568['email']);const _0x5c0bba=await getDoc(doc(db,_0x30d8e1(0x12c),_0xc33568['uid'])),_0x2e66af=_0x5c0bba[_0x30d8e1(0x11e)]()?_0x5c0bba['data']()['username']:null;console['log'](_0x30d8e1(0x113),_0x2e66af);const _0x33dede=doc(db,'pendingMatchesD3',_0x4afaf1),_0x419062=await getDoc(_0x33dede);if(!_0x419062['exists']()){console['log']('D3\x20Report\x20not\x20found\x20with\x20ID:',_0x4afaf1);throw new Error('D3\x20match\x20report\x20not\x20found');}const _0x59bcc2=_0x419062['data']();console['log']('D3\x20Report\x20data:',_0x59bcc2);if(_0x2e66af!==_0x59bcc2[_0x30d8e1(0x117)])throw new Error('Only\x20the\x20winner\x20can\x20approve\x20D3\x20matches');const _0x3bc3be={..._0x59bcc2,'winnerScore':_0x461ca9,'winnerSuicides':_0x533675,'winnerComment':_0x1afef6,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':_0x2e66af,'createdAt':_0x59bcc2['createdAt']||serverTimestamp(),'winnerUsername':_0x59bcc2['winnerUsername'],'loserUsername':_0x59bcc2['loserUsername']};await setDoc(doc(db,'approvedMatchesD3',_0x4afaf1),_0x3bc3be),await deleteDoc(_0x33dede),console['log']('D3\x20Match\x20moved\x20to\x20approved\x20collection');const [_0x55be84,_0x470ffb]=await Promise['all']([getDocs(query(collection(db,'playersD3'),where(_0x30d8e1(0x129),'==',_0x59bcc2['winnerUsername']))),getDocs(query(collection(db,'playersD3'),where('username','==',_0x59bcc2[_0x30d8e1(0x11a)])))]);if(_0x55be84['empty']||_0x470ffb['empty'])throw new Error('Could\x20not\x20find\x20D3\x20player\x20documents');const _0x2f075c=_0x55be84[_0x30d8e1(0x127)][0x0]['id'],_0x2a6d13=_0x470ffb['docs'][0x0]['id'];return await updateEloRatingsD3(_0x2f075c,_0x2a6d13,_0x4afaf1),console[_0x30d8e1(0x12b)](_0x30d8e1(0x121)),!![];}catch(_0x177746){console[_0x30d8e1(0x10f)]('Error\x20in\x20approveReportD3:',_0x177746);throw _0x177746;}}
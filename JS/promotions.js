const a46_0x286856=a46_0x170a,a46_0x29d1f6=(function(){let _0x288a9b=!![];return function(_0xe3e3c2,_0x1f0734){const _0x393a5f=_0x288a9b?function(){if(_0x1f0734){const _0x2e6a8c=_0x1f0734['apply'](_0xe3e3c2,arguments);return _0x1f0734=null,_0x2e6a8c;}}:function(){};return _0x288a9b=![],_0x393a5f;};}()),a46_0x1fe4f0=a46_0x29d1f6(this,function(){const _0x492ebf=a46_0x170a,_0x3e87dd=function(){let _0x5915c9;try{_0x5915c9=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x239c99){_0x5915c9=window;}return _0x5915c9;},_0x4b4e51=_0x3e87dd(),_0xc35ff9=_0x4b4e51['console']=_0x4b4e51['console']||{},_0x3b433d=[_0x492ebf(0x137),_0x492ebf(0x101),_0x492ebf(0xdc),'error','exception','table','trace'];for(let _0x250742=0x0;_0x250742<_0x3b433d[_0x492ebf(0xd1)];_0x250742++){const _0x5c5e40=a46_0x29d1f6['constructor'][_0x492ebf(0xd7)]['bind'](a46_0x29d1f6),_0x39e6b3=_0x3b433d[_0x250742],_0x45b050=_0xc35ff9[_0x39e6b3]||_0x5c5e40;_0x5c5e40[_0x492ebf(0x136)]=a46_0x29d1f6['bind'](a46_0x29d1f6),_0x5c5e40['toString']=_0x45b050['toString'][_0x492ebf(0xe5)](_0x45b050),_0xc35ff9[_0x39e6b3]=_0x5c5e40;}});a46_0x1fe4f0();import{collection,doc,query,where,orderBy,limit,getDocs,addDoc,getDoc,serverTimestamp,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{auth,db}from'./firebase-config.js';class PromotionManager{constructor(){const _0x2d086b=a46_0x170a;this['DISPLAY_HOURS']=0x18,this['RANKS']=[{'threshold':0x578,'name':'Bronze','color':'#CD7F32'},{'threshold':0x640,'name':_0x2d086b(0x12a),'color':'#C0C0C0'},{'threshold':0x708,'name':'Gold','color':_0x2d086b(0x117)},{'threshold':0x834,'name':'Emerald','color':'#50C878'}],this['bannerContainer']=null,this[_0x2d086b(0x135)]=0x0,this[_0x2d086b(0x132)]=0xea60,this['pollingInterval']=null,this[_0x2d086b(0xeb)]={};}['initialize'](){const _0x5c7dd4=a46_0x170a;this['bannerContainer']=document['getElementById']('promotion-banner-container');if(!this['bannerContainer']){console['error']('Promotion\x20banner\x20container\x20not\x20found');return;}this[_0x5c7dd4(0x12b)]();const _0x42364c='promotions_checked_'+new Date()[_0x5c7dd4(0xe2)](),_0x22ec44=sessionStorage['getItem'](_0x42364c);!_0x22ec44&&(this[_0x5c7dd4(0x131)](),sessionStorage['setItem'](_0x42364c,_0x5c7dd4(0xdd))),document['addEventListener']('visibilitychange',()=>{const _0x28a917=_0x5c7dd4;document[_0x28a917(0xe0)]==='visible'&&!sessionStorage['getItem'](_0x42364c)&&(this[_0x28a917(0x131)](),sessionStorage['setItem'](_0x42364c,'true'));}),window['addEventListener'](_0x5c7dd4(0x10d),()=>{this['pollingInterval']&&clearInterval(this['pollingInterval']);});}['setupBannerContainer'](){const _0x34f764=a46_0x170a;this[_0x34f764(0x121)][_0x34f764(0xf5)]='',this['bannerContainer']['style'][_0x34f764(0xd2)]='none';}async['fetchRecentPromotions'](){const _0x55c3a1=a46_0x170a;try{const _0x230409=Date['now']();if(_0x230409-this['lastFetchTime']<this[_0x55c3a1(0x132)])return;this['lastFetchTime']=_0x230409;const _0x471e49=collection(db,_0x55c3a1(0x11e)),_0x11a27f=query(_0x471e49,where('type','in',['promotion','demotion']),orderBy('timestamp','desc'),limit(0x14)),_0x126a8a=await getDocs(_0x11a27f),_0x2eb4f7=[];_0x126a8a['forEach'](_0x4b3e94=>{const _0x117337={'id':_0x4b3e94['id'],..._0x4b3e94['data']()};this['shouldShowPromotion'](_0x4b3e94['id'])&&this['isNewRankChange'](_0x117337)&&_0x2eb4f7['push'](_0x117337);}),_0x2eb4f7[_0x55c3a1(0xd1)]>0x0&&await this[_0x55c3a1(0x103)](_0x2eb4f7);}catch(_0x5b771d){console['error'](_0x55c3a1(0x123),_0x5b771d);}}async['processRankChanges'](_0x4ce44d){const _0x1df9e1=a46_0x170a;if(_0x4ce44d['length']===0x0)return;_0x4ce44d['sort']((_0x2f7be2,_0x4edf2e)=>{const _0x1ce618=a46_0x170a,_0x4559c5=_0x2f7be2['timestamp']?.['toMillis']?.()||_0x2f7be2[_0x1ce618(0xe7)]?.['seconds']*0x3e8||0x0,_0x22a61c=_0x4edf2e[_0x1ce618(0xe7)]?.['toMillis']?.()||_0x4edf2e['timestamp']?.[_0x1ce618(0xec)]*0x3e8||0x0;return _0x22a61c-_0x4559c5;});const _0x377908=this[_0x1df9e1(0x121)]['children']['length'],_0x1bb7e3=0x3-_0x377908;if(_0x1bb7e3<=0x0)return;const _0x1b1385=_0x4ce44d[_0x1df9e1(0xf7)](0x0,_0x1bb7e3);for(let _0x8201b0=0x0;_0x8201b0<_0x1b1385['length'];_0x8201b0++){const _0x358eef=_0x1b1385[_0x8201b0],_0x20dbed=auth['currentUser'];try{setTimeout(()=>{this['showRankChangeBanner'](_0x358eef);},_0x8201b0*0x3e8),_0x20dbed&&_0x358eef['player']===_0x20dbed[_0x1df9e1(0x112)]&&this['showRankChangeLightbox'](_0x358eef[_0x1df9e1(0xdb)],_0x358eef[_0x1df9e1(0xf6)]);}catch(_0x27ec4a){console['error']('Error\x20processing\x20rank\x20change:',_0x27ec4a);}}}['shouldShowPromotion'](_0x582fa7){const _0x338dfe=a46_0x170a;try{const _0x599160='promotion_'+_0x582fa7,_0x570f56=localStorage[_0x338dfe(0x133)](_0x599160);if(_0x570f56){let _0x35f580;try{_0x35f580=JSON['parse'](_0x570f56);}catch(_0x303925){return console['warn']('Invalid\x20storage\x20format\x20for\x20'+_0x599160+_0x338dfe(0xe3)),!![];}if(_0x35f580[_0x338dfe(0x116)]===!![])return console['log']('Promotion\x20'+_0x582fa7+'\x20is\x20permanently\x20ignored'),![];const _0x3c078a=Date['now']();if(_0x35f580['userDismissed']&&_0x3c078a-_0x35f580['timestamp']<this[_0x338dfe(0xef)]*0x3c*0x3c*0x3e8)return console[_0x338dfe(0x137)]('Promotion\x20'+_0x582fa7+'\x20was\x20dismissed\x20by\x20user\x20within\x20last\x20'+this['DISPLAY_HOURS']+_0x338dfe(0x134)),![];if(_0x35f580['systemDismissed']&&_0x3c078a-_0x35f580['timestamp']<0x4*0x3c*0x3c*0x3e8)return console[_0x338dfe(0x137)](_0x338dfe(0x127)+_0x582fa7+_0x338dfe(0xe9)),![];}return!![];}catch(_0x15a205){return console[_0x338dfe(0x11f)]('Error\x20checking\x20promotion\x20visibility:',_0x15a205),![];}}[a46_0x286856(0x113)](_0x4953f3){const _0x101db3=a46_0x286856;try{const _0x344b11=_0x101db3(0x139)+_0x4953f3;localStorage['setItem'](_0x344b11,JSON['stringify']({'timestamp':Date[_0x101db3(0xe8)](),'ignored':!![]}));}catch(_0x4b1ee2){console[_0x101db3(0x11f)](_0x101db3(0x122),_0x4b1ee2);}}[a46_0x286856(0x12e)](_0x2603a7){const _0x21e575=a46_0x286856;this['resolveUserId'](_0x2603a7)[_0x21e575(0x118)](_0xc067eb=>{const _0x38c26a=_0x21e575,_0x2bc91c='promotion_'+_0x2603a7['id'],_0x2fd7e3=localStorage['getItem'](_0x2bc91c);if(_0x2fd7e3)try{const _0x458e25=JSON[_0x38c26a(0x104)](_0x2fd7e3);if(_0x458e25['ignored']===!![]){console['log']('Skipping\x20ignored\x20promotion:\x20'+_0x2603a7['id']);return;}}catch(_0x4a18c8){}localStorage['setItem'](_0x2bc91c,JSON[_0x38c26a(0x105)]({'timestamp':Date[_0x38c26a(0xe8)](),'ignored':![],'userDismissed':![],'systemDismissed':![],'seenAt':Date[_0x38c26a(0xe8)]()})),this['bannerContainer'][_0x38c26a(0xf2)]['display']='block';while(this['bannerContainer']['children']['length']>=0x3){this['bannerContainer'][_0x38c26a(0xfb)](this[_0x38c26a(0x121)]['firstChild']);}const _0x264a45=document['createElement']('div');_0x264a45['className']='promotion-banner',_0x264a45['setAttribute']('data-rank',_0xc067eb['rankAchieved']),_0x264a45['setAttribute']('data-id',_0xc067eb['id']);const _0x5cdfa5=document['createElement']('div');_0x5cdfa5['className']='promotion-details';const _0x7f20=_0xc067eb['resolvedName']||_0xc067eb[_0x38c26a(0xea)]||_0xc067eb['username']||_0xc067eb[_0x38c26a(0xe4)]||_0xc067eb['displayName']||'A\x20player',_0x534e6b=_0xc067eb['type']==='promotion'?_0x7f20+'\x20was\x20promoted\x20to':_0x7f20+'\x20was\x20demoted\x20to';_0x5cdfa5['innerHTML']=_0x534e6b+'\x20<span\x20class=\x22rank-text\x22>'+_0xc067eb[_0x38c26a(0xf6)]+'</span>';const _0x373d23=document['createElement']('div');_0x373d23['className']='banner-actions';const _0xa8d2af=document['createElement'](_0x38c26a(0xd3));_0xa8d2af['className']='dismiss-btn',_0xa8d2af[_0x38c26a(0xf5)]=_0x38c26a(0x125),_0xa8d2af['title']='Dismiss';const _0x7241a=document[_0x38c26a(0x12f)](_0x38c26a(0xd3));_0x7241a['className']='ignore-btn',_0x7241a['textContent']='Don\x27t\x20show\x20again',_0x7241a['title']='Never\x20show\x20this\x20promotion\x20again',_0x373d23['appendChild'](_0x7241a),_0x373d23['appendChild'](_0xa8d2af),_0x264a45['appendChild'](_0x5cdfa5),_0x264a45['appendChild'](_0x373d23),this[_0x38c26a(0x121)][_0x38c26a(0x109)](_0x264a45),void _0x264a45['offsetWidth'],setTimeout(()=>{const _0x5a11ea=_0x38c26a;_0x264a45['classList']['add'](_0x5a11ea(0x119));},0x32),_0xa8d2af['addEventListener'](_0x38c26a(0x111),()=>{const _0xcb95ac=_0x38c26a;localStorage[_0xcb95ac(0x138)](_0x2bc91c,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':!![],'systemDismissed':![]})),_0x264a45['classList'][_0xcb95ac(0xfa)]('new-rank-change'),_0x264a45[_0xcb95ac(0xd8)]['add']('dismissing'),setTimeout(()=>{const _0x3c7539=_0xcb95ac;_0x264a45['parentNode']&&(_0x264a45[_0x3c7539(0xfa)](),this[_0x3c7539(0x121)][_0x3c7539(0x128)]['length']===0x0&&(this['bannerContainer'][_0x3c7539(0xf2)]['display']='none'));},0x1f4);}),_0x7241a['addEventListener']('click',()=>{const _0x474dca=_0x38c26a;localStorage[_0x474dca(0x138)](_0x2bc91c,JSON[_0x474dca(0x105)]({'timestamp':Date['now'](),'ignored':!![],'userDismissed':!![],'systemDismissed':![]})),_0x264a45['classList']['remove'](_0x474dca(0x119)),_0x264a45[_0x474dca(0xd8)]['add']('dismissing'),setTimeout(()=>{const _0x17f05b=_0x474dca;_0x264a45['parentNode']&&(_0x264a45['remove'](),this[_0x17f05b(0x121)]['children']['length']===0x0&&(this[_0x17f05b(0x121)]['style']['display']=_0x17f05b(0x115)));},0x1f4);}),setTimeout(()=>{const _0x1b9847=_0x38c26a;_0x264a45['parentNode']&&(_0x264a45[_0x1b9847(0xd8)]['remove']('new-rank-change'),_0x264a45['classList'][_0x1b9847(0x108)](_0x1b9847(0xd5)),localStorage['setItem'](_0x2bc91c,JSON[_0x1b9847(0x105)]({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':!![]})),setTimeout(()=>{const _0x2c78b8=_0x1b9847;_0x264a45['parentNode']&&(_0x264a45[_0x2c78b8(0xfa)](),this[_0x2c78b8(0x121)][_0x2c78b8(0x128)]['length']===0x0&&(this['bannerContainer']['style']['display']='none'));},0x1f4));},0x3a98);});}async['resolveUserId'](_0x2ad45d){const _0x38e56c=a46_0x286856,_0x1e3ea9={..._0x2ad45d},_0x17c5d1=[_0x2ad45d[_0x38e56c(0xea)],_0x2ad45d['username'],_0x2ad45d[_0x38e56c(0xe4)],_0x2ad45d['displayName']],_0x401883=_0x17c5d1[_0x38e56c(0x106)](_0x3edce9=>_0x3edce9&&typeof _0x3edce9===_0x38e56c(0xf0)&&!_0x3edce9['includes'](_0x38e56c(0xf9))&&!/^[a-zA-Z0-9]{20,}$/[_0x38e56c(0x110)](_0x3edce9));if(_0x401883)return _0x1e3ea9;let _0x14b638=null;if(_0x2ad45d['userId'])_0x14b638=_0x2ad45d[_0x38e56c(0xed)];else _0x2ad45d['player']&&/^[A-Za-z0-9]{20,}$/['test'](_0x2ad45d['player'])&&(_0x14b638=_0x2ad45d['player']);if(!_0x14b638)return _0x1e3ea9;try{const _0x404d65=await getDoc(doc(db,'players',_0x14b638));if(_0x404d65['exists']()){const _0x334075=_0x404d65['data']();if(_0x334075[_0x38e56c(0x120)])return _0x1e3ea9['resolvedName']=_0x334075[_0x38e56c(0x120)],_0x1e3ea9;}const _0x116823=await getDocs(query(collection(db,'approvedMatches'),where('winnerId','==',_0x14b638),orderBy(_0x38e56c(0x107),'desc'),limit(0x1)));if(!_0x116823['empty']){const _0x24864d=_0x116823[_0x38e56c(0xda)][0x0][_0x38e56c(0x100)]();if(_0x24864d['winnerUsername'])return _0x1e3ea9[_0x38e56c(0x11b)]=_0x24864d[_0x38e56c(0xf3)],_0x1e3ea9;}const _0x4ed7a1=await getDocs(query(collection(db,'approvedMatches'),where('loserId','==',_0x14b638),orderBy('date','desc'),limit(0x1)));if(!_0x4ed7a1['empty']){const _0xc02663=_0x4ed7a1['docs'][0x0][_0x38e56c(0x100)]();if(_0xc02663['loserUsername'])return _0x1e3ea9['resolvedName']=_0xc02663['loserUsername'],console['log']('Resolved\x20'+_0x14b638+'\x20to\x20'+_0xc02663['loserUsername']+'\x20(loser)'),_0x1e3ea9;}}catch(_0x23b920){console['error']('Error\x20resolving\x20user\x20ID:',_0x23b920);}return console[_0x38e56c(0x101)](_0x38e56c(0xf1)+_0x14b638),_0x1e3ea9;}['showRankChangeLightbox'](_0x2b08aa,_0x4e753f){const _0xeed252=a46_0x286856;let _0x34296c=document['getElementById']('rankChangeModal');!_0x34296c&&(_0x34296c=document['createElement']('div'),_0x34296c['id']=_0xeed252(0xe1),_0x34296c['className']='rank-change-modal\x20'+_0x2b08aa,document['body']['appendChild'](_0x34296c));const _0x4e3f28=_0x2b08aa===_0xeed252(0x10c)?'Congratulations!':'Rank\x20Update',_0x2350e7=_0x2b08aa==='promotion'?'You\x27ve\x20been\x20promoted\x20to':'You\x27ve\x20been\x20demoted\x20to';_0x34296c['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rank-change-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2\x20class=\x22rank-change-title\x22>'+_0x4e3f28+'</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>'+_0x2350e7+_0xeed252(0xff)+_0x4e753f+'</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22rank-change-button\x22\x20id=\x22rank-change-ok-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Got\x20it!\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x34296c['style']['display']='flex',document[_0xeed252(0xe6)](_0xeed252(0xd9))['addEventListener']('click',()=>{const _0x6a0e9c=_0xeed252;_0x34296c['style'][_0x6a0e9c(0xd2)]='none';}),_0x34296c[_0xeed252(0x114)]('click',_0x51e3d9=>{const _0xe3583c=_0xeed252;_0x51e3d9['target']===_0x34296c&&(_0x34296c['style']['display']=_0xe3583c(0x115));});}async['checkAndRecordPromotion'](_0xa16e0b,_0x48b0dc,_0x358015,_0x4f9d07={}){const _0x1b3115=a46_0x286856;try{if(_0x48b0dc===_0x358015||!_0xa16e0b)return null;const _0x590a32=_0x4f9d07['source']||'automatic',_0x48d7d1=_0x4f9d07[_0x1b3115(0xde)]||null,_0x10edbf=_0x4f9d07[_0x1b3115(0x12d)]||null;console['log']('Processing\x20potential\x20rank\x20change:\x20'+_0x358015+_0x1b3115(0xf8)+_0x48b0dc+'\x20(source:\x20'+_0x590a32+')');let _0x134db9=null,_0x21b7d6=null;try{const _0x365ca1=await getDoc(doc(db,'players',_0xa16e0b));if(_0x365ca1[_0x1b3115(0x10e)]()){const _0x2b37e6=_0x365ca1['data']();_0x134db9=_0x2b37e6[_0x1b3115(0x120)]||_0x2b37e6['displayName']||null,_0x21b7d6=_0x2b37e6['displayName']||_0x2b37e6['username']||null;}!_0x134db9&&_0x4f9d07['username']&&(_0x134db9=_0x4f9d07[_0x1b3115(0x120)],_0x21b7d6=_0x4f9d07['username']);!_0x134db9&&auth['currentUser']&&(_0x134db9=auth['currentUser']['displayName']||auth['currentUser'][_0x1b3115(0x11a)]['split']('@')[0x0],_0x21b7d6=auth['currentUser']['displayName']||null);if(!_0x134db9){const _0x559f72=query(collection(db,'approvedMatches'),where(_0x1b3115(0x10b),'==',_0xa16e0b),limit(0x1)),_0x1f2663=await getDocs(_0x559f72);if(!_0x1f2663[_0x1b3115(0x129)])_0x134db9=_0x1f2663[_0x1b3115(0xda)][0x0]['data']()[_0x1b3115(0xf3)]||_0x1b3115(0xdf),_0x21b7d6=_0x134db9;else{const _0x3f858e=query(collection(db,'approvedMatches'),where(_0x1b3115(0x11d),'==',_0xa16e0b),limit(0x1)),_0x123dca=await getDocs(_0x3f858e);!_0x123dca['empty']&&(_0x134db9=_0x123dca[0x0]['data']()[_0x1b3115(0x130)]||'Unknown\x20Player',_0x21b7d6=_0x134db9);}}}catch(_0x52d9a8){console['error']('Error\x20resolving\x20username:',_0x52d9a8);}!_0x134db9&&(console['warn'](_0x1b3115(0xfd),_0xa16e0b),_0x134db9=_0x1b3115(0x10a),_0x21b7d6='Unknown\x20Player');const _0x5d93c2=this['getRankName'](_0x358015),_0x376a72=this['getRankName'](_0x48b0dc);if(_0x5d93c2!==_0x376a72){const _0x4b2d27=_0x48b0dc>_0x358015,_0x529269=_0x4b2d27?_0x1b3115(0x10c):'demotion',_0x446cc7=_0x376a72;console[_0x1b3115(0x137)]('Recording\x20'+_0x529269+'\x20for\x20'+_0x134db9+':\x20'+_0x358015+'\x20('+_0x5d93c2+_0x1b3115(0x102)+_0x48b0dc+'\x20('+_0x376a72+')');try{const _0x34f602={'player':_0x134db9,'playerUsername':_0x134db9,'username':_0x134db9,'displayName':_0x21b7d6,'userId':_0xa16e0b,'type':_0x529269,'rankAchieved':_0x446cc7,'timestamp':serverTimestamp(),'previousElo':_0x358015,'newElo':_0x48b0dc,'change':_0x48b0dc-_0x358015,'previousRank':_0x5d93c2,'newRank':_0x376a72,'source':_0x590a32};if(_0x590a32==='match'&&_0x48d7d1)_0x34f602['matchId']=_0x48d7d1;else _0x590a32==='admin'&&_0x10edbf?(_0x34f602['modifiedBy']=_0x10edbf,_0x34f602['isAutomatic']=![]):_0x34f602['isAutomatic']=!![];const _0x452759=writeBatch(db),_0x1a08bb=doc(collection(db,_0x1b3115(0x11e))),_0x3dac24=doc(collection(db,'promotionHistory'));return _0x452759[_0x1b3115(0xd4)](_0x1a08bb,_0x34f602),_0x452759['set'](_0x3dac24,_0x34f602),await _0x452759['commit'](),await this[_0x1b3115(0xf4)](_0xa16e0b,_0x134db9,_0x358015,_0x48b0dc,_0x5d93c2,_0x376a72,_0x529269,{'displayName':_0x21b7d6,'source':_0x590a32,'matchId':_0x48d7d1,'ladder':_0x4f9d07['ladder']||'D1'}),console['log']('Successfully\x20recorded\x20'+_0x529269+'\x20for\x20'+_0x134db9+'\x20to\x20'+_0x446cc7),_0x446cc7;}catch(_0x359f4e){console['error']('Error\x20writing\x20promotion\x20records:',_0x359f4e);try{return await addDoc(collection(db,'eloHistory'),{'player':_0x134db9,'playerUsername':_0x134db9,'username':_0x134db9,'displayName':_0x21b7d6,'userId':_0xa16e0b,'type':_0x529269,'rankAchieved':_0x446cc7,'timestamp':serverTimestamp(),'previousElo':_0x358015,'newElo':_0x48b0dc,'change':_0x48b0dc-_0x358015,'previousRank':_0x5d93c2,'source':_0x590a32,'isAutomatic':_0x590a32!==_0x1b3115(0xfe)}),await this['sendPromotionNotification'](_0xa16e0b,_0x134db9,_0x358015,_0x48b0dc,_0x5d93c2,_0x376a72,_0x529269,{'displayName':_0x21b7d6,'source':_0x590a32,'matchId':_0x48d7d1,'ladder':_0x4f9d07[_0x1b3115(0x126)]||'D1'}),_0x446cc7;}catch(_0x3eedeb){return console[_0x1b3115(0x11f)]('Fallback\x20write\x20failed:',_0x3eedeb),null;}}}return null;}catch(_0xf08610){return console['error']('Error\x20in\x20promotion/demotion\x20recording:',_0xf08610),null;}}['getRankName'](_0x35196f){const _0x10eb77=a46_0x286856;for(let _0x11ad3d=this[_0x10eb77(0x10f)]['length']-0x1;_0x11ad3d>=0x0;_0x11ad3d--){if(_0x35196f>=this[_0x10eb77(0x10f)][_0x11ad3d]['threshold'])return this[_0x10eb77(0x10f)][_0x11ad3d][_0x10eb77(0x124)];}return'Unranked';}['cleanup'](){this['pollingInterval']&&clearInterval(this['pollingInterval']);}['isNewRankChange'](_0x1c1a52){const _0x5a3021=a46_0x286856;if(_0x1c1a52['timestamp']){const _0xd36fa7=_0x1c1a52['timestamp']['seconds']*0x3e8,_0x2f7d77=Date['now'](),_0x240669=(_0x2f7d77-_0xd36fa7)/(0x3e8*0x3c*0x3c);if(_0x240669>0x18)return![];}if(_0x1c1a52['previousRank']&&_0x1c1a52['newRank']&&_0x1c1a52[_0x5a3021(0xfc)]!==_0x1c1a52['newRank'])return!![];return![];}async['sendPromotionNotification'](_0x5d6c08,_0x5020ee,_0x163b32,_0x17758c,_0x3d08df,_0x1aa308,_0x147903,_0x2f6052={}){const _0x63bfaa=a46_0x286856;try{console[_0x63bfaa(0x137)]('STARTING\x20notification\x20for\x20'+_0x5020ee+_0x63bfaa(0x11c)+_0x147903);const _0x3ecfed={'userId':_0x5d6c08,'username':_0x5020ee,'displayName':_0x2f6052['displayName']||_0x5020ee,'oldElo':parseInt(_0x163b32),'newElo':parseInt(_0x17758c),'eloDifference':parseInt(_0x17758c)-parseInt(_0x163b32),'oldRank':_0x3d08df,'newRank':_0x1aa308,'type':_0x147903,'timestamp':serverTimestamp(),'processed':![],'source':_0x2f6052['source']||'automatic','matchId':_0x2f6052['matchId']||null,'ladder':_0x2f6052['ladder']||'D1','adminUser':_0x2f6052['adminUser']||null};console['log']('Creating\x20Discord\x20notification:',_0x3ecfed);const _0x65b960=await addDoc(collection(db,'promotionNotifications'),_0x3ecfed);return console['log'](_0x63bfaa(0xee)+_0x65b960['id']),!![];}catch(_0x167473){return console[_0x63bfaa(0x11f)]('Error\x20sending\x20Discord\x20notification:',_0x167473),![];}}}export const promotionManager=new PromotionManager();document['addEventListener']('DOMContentLoaded',()=>{const _0x3005fb=a46_0x286856;promotionManager[_0x3005fb(0xd6)]();});export const initializePromotionTracker=()=>promotionManager['initialize']();export const checkAndRecordPromotion=(_0x5c67b1,_0x800937,_0xb4fd23,_0x1dd98c)=>promotionManager['checkAndRecordPromotion'](_0x5c67b1,_0x800937,_0xb4fd23,_0x1dd98c);function a46_0x170a(_0x523dda,_0x14f234){const _0x1fe4f0=a46_0x420d();return a46_0x170a=function(_0x29d1f6,_0x43b233){_0x29d1f6=_0x29d1f6-0xd1;let _0x420d3e=_0x1fe4f0[_0x29d1f6];return _0x420d3e;},a46_0x170a(_0x523dda,_0x14f234);}export const getRankName=_0x3f912c=>promotionManager[a46_0x286856(0x12c)](_0x3f912c);function a46_0x420d(){const _0x1f8d7c=['length','display','button','set','dismissing','initialize','prototype','classList','rank-change-ok-btn','docs','type','info','true','matchId','Unknown\x20Player','visibilityState','rankChangeModal','toDateString',',\x20treating\x20as\x20new','playerUsername','bind','getElementById','timestamp','now','\x20was\x20auto-dismissed\x20within\x20last\x204\x20hours','player','usernameCache','seconds','userId','Discord\x20notification\x20sent\x20successfully\x20with\x20ID:\x20','DISPLAY_HOURS','string','Failed\x20to\x20resolve\x20user\x20ID:\x20','style','winnerUsername','sendPromotionNotification','innerHTML','rankAchieved','slice','\x20→\x20','ID:','remove','removeChild','previousRank','Could\x20not\x20resolve\x20username\x20for\x20userId:','admin','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22rank-name\x22>','data','warn',')\x20→\x20','processRankChanges','parse','stringify','some','date','add','appendChild','A\x20player','winnerId','promotion','beforeunload','exists','RANKS','test','click','displayName','ignorePromotion','addEventListener','none','ignored','#FFD700','then','new-rank-change','email','resolvedName','\x27s\x20','loserId','eloHistory','error','username','bannerContainer','Error\x20saving\x20promotion\x20preference:','Error\x20fetching\x20promotions:','name','&times;','ladder','Promotion\x20','children','empty','Silver','setupBannerContainer','getRankName','adminUser','showRankChangeBanner','createElement','loserUsername','fetchRecentPromotions','fetchInterval','getItem','\x20hours','lastFetchTime','__proto__','log','setItem','promotion_'];a46_0x420d=function(){return _0x1f8d7c;};return a46_0x420d();}
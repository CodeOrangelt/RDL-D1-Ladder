const a13_0x148a15=a13_0x314a,a13_0x2025c4=(function(){let _0x430040=!![];return function(_0x1a9bb3,_0x38a663){const _0x101791=_0x430040?function(){if(_0x38a663){const _0x42332d=_0x38a663['apply'](_0x1a9bb3,arguments);return _0x38a663=null,_0x42332d;}}:function(){};return _0x430040=![],_0x101791;};}()),a13_0x2158cb=a13_0x2025c4(this,function(){const _0x441f32=a13_0x314a,_0x51d6ff=function(){let _0x6080c5;try{_0x6080c5=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x52dfbb){_0x6080c5=window;}return _0x6080c5;},_0x23e2d6=_0x51d6ff(),_0x2e7a64=_0x23e2d6['console']=_0x23e2d6['console']||{},_0x3d10bc=['log',_0x441f32(0x18d),_0x441f32(0x18f),'error','exception','table','trace'];for(let _0x24d340=0x0;_0x24d340<_0x3d10bc['length'];_0x24d340++){const _0x502d4f=a13_0x2025c4['constructor']['prototype']['bind'](a13_0x2025c4),_0x2b2c50=_0x3d10bc[_0x24d340],_0x53b274=_0x2e7a64[_0x2b2c50]||_0x502d4f;_0x502d4f[_0x441f32(0x196)]=a13_0x2025c4[_0x441f32(0x188)](a13_0x2025c4),_0x502d4f['toString']=_0x53b274['toString']['bind'](_0x53b274),_0x2e7a64[_0x2b2c50]=_0x502d4f;}});a13_0x2158cb();function a13_0x502b(){const _0x732253=['D3\x20ELO\x20history\x20recorded\x20for\x20','demotion','timestamp','playersD3','docs','empty','newElo','Unknown\x20Player','bind','player','Unranked','data','Gold','warn','approvedMatchesD3','info','match','map','Bronze','opponent','all','exists','__proto__','promotion','error'];a13_0x502b=function(){return _0x732253;};return a13_0x502b();}import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc,where}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a13_0x314a(_0x5793b6,_0x3cf539){const _0x2158cb=a13_0x502b();return a13_0x314a=function(_0x2025c4,_0x54829b){_0x2025c4=_0x2025c4-0x180;let _0x502b45=_0x2158cb[_0x2025c4];return _0x502b45;},a13_0x314a(_0x5793b6,_0x3cf539);}import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D3=[{'name':'Emerald','elo':0x7d0},{'name':'Gold','elo':0x708},{'name':'Silver','elo':0x640},{'name':a13_0x148a15(0x192),'elo':0x578},{'name':'Unranked','elo':0x4b0}];let lastVisibleD3=null;async function getUsernameByIdD3(_0x5268f0){const _0x2aaec2=a13_0x148a15;try{if(!_0x5268f0)return'Unknown\x20Player';const _0x49d626=await getDoc(doc(db,_0x2aaec2(0x183),_0x5268f0));if(_0x49d626[_0x2aaec2(0x195)]())return _0x49d626['data']()['username']||_0x2aaec2(0x187);const _0x59f8f1=await getDocs(query(collection(db,_0x2aaec2(0x18e)),where('winnerId','==',_0x5268f0),limit(0x1)));if(!_0x59f8f1['empty'])return _0x59f8f1['docs'][0x0]['data']()['winnerUsername']||'Unknown\x20Player';const _0x26017b=await getDocs(query(collection(db,'approvedMatchesD3'),where('loserId','==',_0x5268f0),limit(0x1)));if(!_0x26017b[_0x2aaec2(0x185)])return _0x26017b[_0x2aaec2(0x184)][0x0][_0x2aaec2(0x18b)]()['loserUsername']||_0x2aaec2(0x187);return'Unknown\x20Player';}catch(_0x4c6206){return console[_0x2aaec2(0x198)]('Error\x20getting\x20D3\x20username:',_0x4c6206),'Unknown\x20Player';}}export async function recordEloChangeD3({playerId:_0x38e366,previousElo:_0x33f88a,newElo:_0x12bcda,opponentId:_0x42b790,matchResult:_0x4d1c55,previousPosition:_0x66406d,newPosition:_0x49aa7c,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x1444c0,timestamp:_0x2d6845}){const _0x5a1cd6=a13_0x148a15;try{const _0x850be5=doc(collection(db,'eloHistoryD3'));let _0x73af80=_0x5a1cd6(0x190);if(isPromotion)_0x73af80=_0x5a1cd6(0x197);if(isDemotion)_0x73af80=_0x5a1cd6(0x181);let _0x204196=_0x5a1cd6(0x18a);if(_0x12bcda>=0x7d0)_0x204196='Emerald';else{if(_0x12bcda>=0x708)_0x204196=_0x5a1cd6(0x18c);else{if(_0x12bcda>=0x640)_0x204196='Silver';else{if(_0x12bcda>=0x578)_0x204196='Bronze';}}}return await setDoc(_0x850be5,{'type':_0x73af80,'player':_0x38e366,'opponent':_0x42b790,'previousElo':_0x33f88a,'newElo':_0x12bcda,'change':_0x12bcda-_0x33f88a,'matchResult':_0x4d1c55,'previousPosition':_0x66406d,'newPosition':_0x49aa7c,'rankAchieved':_0x204196,'matchId':_0x1444c0,'timestamp':_0x2d6845||serverTimestamp(),'gameMode':'D3'}),console['log'](_0x5a1cd6(0x180)+_0x38e366),!![];}catch(_0x4f5f01){console['error']('Error\x20recording\x20D3\x20ELO\x20history:',_0x4f5f01);throw _0x4f5f01;}}export async function getEloHistoryD3(_0x4e1f8f=0x14){const _0x4c51b0=a13_0x148a15;try{const _0x46982f=collection(db,'eloHistoryD3');let _0x48cd2c;lastVisibleD3?_0x48cd2c=query(_0x46982f,orderBy(_0x4c51b0(0x182),'desc'),startAfter(lastVisibleD3),limit(_0x4e1f8f)):_0x48cd2c=query(_0x46982f,orderBy('timestamp','desc'),limit(_0x4e1f8f));const _0x1cd629=await getDocs(_0x48cd2c);if(_0x1cd629['empty'])return{'entries':[],'hasMore':![]};lastVisibleD3=_0x1cd629['docs'][_0x1cd629['docs']['length']-0x1];const _0x127efe=_0x1cd629[_0x4c51b0(0x184)][_0x4c51b0(0x191)](async _0x404c85=>{const _0x2f5998=_0x4c51b0,_0x587e1c=_0x404c85['data'](),[_0x1e1959,_0x32979a]=await Promise[_0x2f5998(0x194)]([getUsernameByIdD3(_0x587e1c[_0x2f5998(0x189)]),getUsernameByIdD3(_0x587e1c[_0x2f5998(0x193)])]);return{..._0x587e1c,'playerUsername':_0x1e1959,'opponentUsername':_0x32979a,'change':_0x587e1c[_0x2f5998(0x186)]-_0x587e1c['previousElo'],'timestamp':_0x587e1c['timestamp']};}),_0x3287c2=await Promise[_0x4c51b0(0x194)](_0x127efe);return{'entries':_0x3287c2,'hasMore':_0x1cd629['size']===_0x4e1f8f};}catch(_0x178a22){console['error']('Error\x20fetching\x20D3\x20ELO\x20history:',_0x178a22);throw _0x178a22;}}export function resetPaginationD3(){lastVisibleD3=null;}
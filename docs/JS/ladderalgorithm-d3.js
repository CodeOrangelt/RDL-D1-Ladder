(function(_0x45e5fb,_0x110c4f){const _0x2ebb00=a0_0x4507,_0x56e47b=_0x45e5fb();while(!![]){try{const _0x3153d6=parseInt(_0x2ebb00(0x1bb))/0x1*(parseInt(_0x2ebb00(0x1c1))/0x2)+parseInt(_0x2ebb00(0x1ba))/0x3+-parseInt(_0x2ebb00(0x1b5))/0x4+-parseInt(_0x2ebb00(0x1a1))/0x5*(-parseInt(_0x2ebb00(0x1b2))/0x6)+-parseInt(_0x2ebb00(0x1a4))/0x7*(-parseInt(_0x2ebb00(0x1b8))/0x8)+parseInt(_0x2ebb00(0x1b9))/0x9+-parseInt(_0x2ebb00(0x1a2))/0xa;if(_0x3153d6===_0x110c4f)break;else _0x56e47b['push'](_0x56e47b['shift']());}catch(_0x1b3f7b){_0x56e47b['push'](_0x56e47b['shift']());}}}(a0_0x4a2a,0x7c0e5));function a0_0x4a2a(){const _0x3974b2=['427620Zpyecd','5NNbhex','Error\x20in\x20updateEloRatingsD3:','console','length','log','playersD3','60832WrDwQj','prototype','trace','D3\x20Report\x20data:','61855JzLLlr','16319370hLedHZ','D3\x20Report\x20not\x20found\x20with\x20ID:','7EBfbam','all','D3\x20Match\x20successfully\x20approved\x20and\x20ELO\x20updated','position','commit','__proto__','win','bind','exists','docs','winnerUsername','loserUsername','{}.constructor(\x22return\x20this\x22)(\x20)','error','150GXDLHi','data','toString','1043428kwijvV','One\x20or\x20both\x20D3\x20players\x20not\x20found','constructor','7231016HAYZku','8038395CyoxIu'];a0_0x4a2a=function(){return _0x3974b2;};return a0_0x4a2a();}const a0_0x70faf1=(function(){let _0xd4f09=!![];return function(_0x2aa7ce,_0x2011cb){const _0x18d2a8=_0xd4f09?function(){if(_0x2011cb){const _0x19bf7c=_0x2011cb['apply'](_0x2aa7ce,arguments);return _0x2011cb=null,_0x19bf7c;}}:function(){};return _0xd4f09=![],_0x18d2a8;};}()),a0_0xa3780c=a0_0x70faf1(this,function(){const _0x13fe2c=a0_0x4507,_0x50db6f=function(){const _0x553c6e=a0_0x4507;let _0x3fc5b0;try{_0x3fc5b0=Function('return\x20(function()\x20'+_0x553c6e(0x1b0)+');')();}catch(_0x552584){_0x3fc5b0=window;}return _0x3fc5b0;},_0x553429=_0x50db6f(),_0x4ee1f3=_0x553429[_0x13fe2c(0x1bd)]=_0x553429[_0x13fe2c(0x1bd)]||{},_0x343677=[_0x13fe2c(0x1bf),'warn','info',_0x13fe2c(0x1b1),'exception','table',_0x13fe2c(0x19f)];for(let _0x2eb49a=0x0;_0x2eb49a<_0x343677[_0x13fe2c(0x1be)];_0x2eb49a++){const _0x240ddd=a0_0x70faf1[_0x13fe2c(0x1b7)][_0x13fe2c(0x1c2)]['bind'](a0_0x70faf1),_0x25682c=_0x343677[_0x2eb49a],_0x13602f=_0x4ee1f3[_0x25682c]||_0x240ddd;_0x240ddd[_0x13fe2c(0x1a9)]=a0_0x70faf1['bind'](a0_0x70faf1),_0x240ddd[_0x13fe2c(0x1b4)]=_0x13602f['toString'][_0x13fe2c(0x1ab)](_0x13602f),_0x4ee1f3[_0x25682c]=_0x240ddd;}});a0_0xa3780c();import{addDoc,updateDoc,serverTimestamp,collection,doc,getDoc,getDocs,query,where,setDoc,deleteDoc,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';import{recordEloChangeD3}from'./elo-history-d3.js';export function calculateEloD3(_0x2f62b1,_0xa1a847,_0x340882=0x20){const _0x37a26f=0x1/(0x1+Math['pow'](0xa,(_0xa1a847-_0x2f62b1)/0x190)),_0x4f6913=0x1/(0x1+Math['pow'](0xa,(_0x2f62b1-_0xa1a847)/0x190)),_0x536f2f=_0x2f62b1+_0x340882*(0x1-_0x37a26f),_0x3ec645=_0xa1a847+_0x340882*(0x0-_0x4f6913);return{'newWinnerRating':Math['round'](_0x536f2f),'newLoserRating':Math['round'](_0x3ec645)};}export async function updateEloRatingsD3(_0xa76118,_0x294a8b,_0x8b6787){const _0x56c414=a0_0x4507;try{const _0x4e9bd9=writeBatch(db),_0x2ae363=doc(db,'playersD3',_0xa76118),_0x11b0d3=doc(db,'playersD3',_0x294a8b),[_0x4167e1,_0x5ef153]=await Promise['all']([getDoc(_0x2ae363),getDoc(_0x11b0d3)]);if(!_0x4167e1['exists']()||!_0x5ef153[_0x56c414(0x1ac)]())throw new Error(_0x56c414(0x1b6));const _0x580e46=_0x4167e1[_0x56c414(0x1b3)](),_0x3964c7=_0x5ef153['data'](),_0x318a0c=_0x580e46[_0x56c414(0x1a7)]||Number['MAX_SAFE_INTEGER'],_0x158602=_0x3964c7[_0x56c414(0x1a7)]||Number['MAX_SAFE_INTEGER'],{newWinnerRating:_0x42761a,newLoserRating:_0x1e3c08}=calculateEloD3(_0x580e46['eloRating']||0x4b0,_0x3964c7['eloRating']||0x4b0);let _0x59eed5=_0x318a0c,_0x14ca1b=_0x158602;if(_0x318a0c>_0x158602){console['log']('D3\x20Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked'),_0x59eed5=_0x158602,_0x14ca1b=_0x158602+0x1;const _0x1a12be=query(collection(db,'playersD3'),where('position','>',_0x158602),where(_0x56c414(0x1a7),'<',_0x318a0c)),_0x56890a=await getDocs(_0x1a12be);for(const _0x29eafe of _0x56890a['docs']){_0x29eafe['id']!==_0xa76118&&_0x29eafe['id']!==_0x294a8b&&_0x4e9bd9['update'](doc(db,'playersD3',_0x29eafe['id']),{'position':_0x29eafe['data']()['position']+0x1});}}else console[_0x56c414(0x1bf)]('D3\x20Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions');return _0x4e9bd9['update'](_0x2ae363,{'eloRating':_0x42761a,'lastMatchDate':serverTimestamp(),'position':_0x59eed5,'lastMatchId':_0x8b6787}),_0x4e9bd9['update'](_0x11b0d3,{'eloRating':_0x1e3c08,'lastMatchDate':serverTimestamp(),'position':_0x14ca1b,'lastMatchId':_0x8b6787}),await _0x4e9bd9[_0x56c414(0x1a8)](),console['log']('D3\x20ELO\x20ratings\x20updated\x20successfully'),await Promise[_0x56c414(0x1a5)]([recordEloChangeD3({'playerId':_0xa76118,'previousElo':_0x580e46['eloRating']||0x4b0,'newElo':_0x42761a,'opponentId':_0x294a8b,'matchResult':_0x56c414(0x1aa),'previousPosition':_0x318a0c,'newPosition':_0x59eed5,'isPromotion':_0x59eed5<_0x318a0c,'matchId':_0x8b6787,'timestamp':serverTimestamp()}),recordEloChangeD3({'playerId':_0x294a8b,'previousElo':_0x3964c7['eloRating']||0x4b0,'newElo':_0x1e3c08,'opponentId':_0xa76118,'matchResult':'loss','previousPosition':_0x158602,'newPosition':_0x14ca1b,'isDemotion':_0x14ca1b>_0x158602,'matchId':_0x8b6787,'timestamp':serverTimestamp()})]),!![];}catch(_0x47017b){console['error'](_0x56c414(0x1bc),_0x47017b);throw _0x47017b;}}function a0_0x4507(_0x55f1cf,_0x3b3c85){const _0x3e4e8d=a0_0x4a2a();return a0_0x4507=function(_0xa3780c,_0x70faf1){_0xa3780c=_0xa3780c-0x19f;let _0x58756a=_0x3e4e8d[_0xa3780c];return _0x58756a;},a0_0x4507(_0x55f1cf,_0x3b3c85);}export async function approveReportD3(_0x878b7e,_0x57d4cb,_0x42b9bc,_0x20e218){const _0x55db17=a0_0x4507;try{console['log']('Starting\x20approveReportD3\x20function\x20with:',{'reportId':_0x878b7e,'winnerScore':_0x57d4cb,'winnerSuicides':_0x42b9bc,'winnerComment':_0x20e218});const _0x1561f8=auth['currentUser'];if(!_0x1561f8){console['log']('No\x20user\x20logged\x20in');throw new Error('You\x20must\x20be\x20logged\x20in\x20to\x20approve\x20D3\x20matches');}console['log']('Current\x20user:',_0x1561f8['email']);const _0x44ed98=await getDoc(doc(db,_0x55db17(0x1c0),_0x1561f8['uid'])),_0x348019=_0x44ed98['exists']()?_0x44ed98['data']()['username']:null;console[_0x55db17(0x1bf)]('Current\x20username:',_0x348019);const _0xe87ed9=doc(db,'pendingMatchesD3',_0x878b7e),_0x18fe6a=await getDoc(_0xe87ed9);if(!_0x18fe6a[_0x55db17(0x1ac)]()){console['log'](_0x55db17(0x1a3),_0x878b7e);throw new Error('D3\x20match\x20report\x20not\x20found');}const _0x4ced59=_0x18fe6a['data']();console['log'](_0x55db17(0x1a0),_0x4ced59);if(_0x348019!==_0x4ced59[_0x55db17(0x1ae)])throw new Error('Only\x20the\x20winner\x20can\x20approve\x20D3\x20matches');const _0x3373f0={..._0x4ced59,'winnerScore':_0x57d4cb,'winnerSuicides':_0x42b9bc,'winnerComment':_0x20e218,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':_0x348019,'createdAt':_0x4ced59['createdAt']||serverTimestamp(),'winnerUsername':_0x4ced59['winnerUsername'],'loserUsername':_0x4ced59['loserUsername']};await setDoc(doc(db,'approvedMatchesD3',_0x878b7e),_0x3373f0),await deleteDoc(_0xe87ed9),console['log']('D3\x20Match\x20moved\x20to\x20approved\x20collection');const [_0x4bba12,_0x14fd78]=await Promise[_0x55db17(0x1a5)]([getDocs(query(collection(db,'playersD3'),where('username','==',_0x4ced59[_0x55db17(0x1ae)]))),getDocs(query(collection(db,'playersD3'),where('username','==',_0x4ced59[_0x55db17(0x1af)])))]);if(_0x4bba12['empty']||_0x14fd78['empty'])throw new Error('Could\x20not\x20find\x20D3\x20player\x20documents');const _0x5b405e=_0x4bba12[_0x55db17(0x1ad)][0x0]['id'],_0x2b949c=_0x14fd78['docs'][0x0]['id'];return await updateEloRatingsD3(_0x5b405e,_0x2b949c,_0x878b7e),console[_0x55db17(0x1bf)](_0x55db17(0x1a6)),!![];}catch(_0x26e03b){console['error']('Error\x20in\x20approveReportD3:',_0x26e03b);throw _0x26e03b;}}
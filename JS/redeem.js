const a50_0x3a56e0=a50_0x3b97,a50_0x2af5d2=(function(){let _0x132aeb=!![];return function(_0x2953bf,_0x2d1886){const _0x1ecfa5=_0x132aeb?function(){const _0x580c4c=a50_0x3b97;if(_0x2d1886){const _0x56d6b5=_0x2d1886[_0x580c4c(0x13e)](_0x2953bf,arguments);return _0x2d1886=null,_0x56d6b5;}}:function(){};return _0x132aeb=![],_0x1ecfa5;};}()),a50_0x24e6ba=a50_0x2af5d2(this,function(){const _0x3b2b0c=a50_0x3b97;let _0x1a860d;try{const _0x238fbb=Function(_0x3b2b0c(0x166)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x1a860d=_0x238fbb();}catch(_0x89ab5f){_0x1a860d=window;}const _0x4c390e=_0x1a860d['console']=_0x1a860d[_0x3b2b0c(0x143)]||{},_0x519b35=['log','warn','info',_0x3b2b0c(0x17d),'exception','table','trace'];for(let _0x4c5e4b=0x0;_0x4c5e4b<_0x519b35['length'];_0x4c5e4b++){const _0x6b7ee3=a50_0x2af5d2['constructor'][_0x3b2b0c(0x120)]['bind'](a50_0x2af5d2),_0x551593=_0x519b35[_0x4c5e4b],_0x5c79ba=_0x4c390e[_0x551593]||_0x6b7ee3;_0x6b7ee3['__proto__']=a50_0x2af5d2[_0x3b2b0c(0x155)](a50_0x2af5d2),_0x6b7ee3['toString']=_0x5c79ba['toString']['bind'](_0x5c79ba),_0x4c390e[_0x551593]=_0x6b7ee3;}});function a50_0x3b97(_0xf79c8c,_0xb89d2d){const _0x24e6ba=a50_0x172d();return a50_0x3b97=function(_0x2af5d2,_0x27158b){_0x2af5d2=_0x2af5d2-0xf9;let _0x172d0b=_0x24e6ba[_0x2af5d2];return _0x172d0b;},a50_0x3b97(_0xf79c8c,_0xb89d2d);}a50_0x24e6ba();import{getAuth,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{getFirestore,doc,getDoc,setDoc,updateDoc,collection,addDoc,serverTimestamp}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{clearTokenCache}from'./tokens.js';const auth=getAuth(),db=getFirestore(),THEMES={'default':{'price':0x0,'name':'Classic\x20RDL','description':'Rock\x20texture\x20with\x20a\x20sleek\x20nav\x20and\x20footer'},'purple':{'price':0x96,'name':'Purple','description':'Can\x27t\x20get\x20enough'},'cyberpunk':{'price':0x190,'name':a50_0x3a56e0(0x13d),'description':a50_0x3a56e0(0x135)},'emerald':{'price':0x3e8,'name':'Emerald','description':'Emerald\x20City!'},'gold':{'price':0x320,'name':'Gold','description':'Only\x20the\x20best\x20get\x20this\x20one'},'contrast':{'price':0x0,'name':a50_0x3a56e0(0x16c),'description':'You\x20can\x20see\x20better!'},'ocean':{'price':0x12c,'name':'Blue','description':a50_0x3a56e0(0x129)},'volcanic':{'price':0x1f4,'name':'Red','description':'For\x20the\x20angry\x20type.'}},TOKENS={'blob01':{'price':0x1f4,'name':a50_0x3a56e0(0x148),'description':'A\x20mysterious\x20purple\x20blob\x20token','image':a50_0x3a56e0(0x172),'category':a50_0x3a56e0(0xfc)},'blob02':{'price':0x3e8,'name':'Blob\x20Token\x202','description':'Another\x20enigmatic\x20blob\x20creature','image':'../images/tokens/blob02.gif','category':'blob'},'blob03':{'price':0x7d0,'name':'Blob\x20Token\x203','description':'The\x20final\x20blob\x20in\x20the\x20collection','image':'../images/tokens/blob03.gif','category':'blob'},'cloak':{'price':0x1f4,'name':'Cloaking\x20Device','description':'Become\x20one\x20with\x20the\x20shadows','image':'../images/tokens/cloak.gif','category':'special'},'gauge18':{'price':0x320,'name':a50_0x3a56e0(0x145),'description':a50_0x3a56e0(0x177),'image':a50_0x3a56e0(0x13a),'category':'equipment'},'fusion':{'price':0x15e,'name':'Fusion\x20Cannon','description':'Devastating\x20fusion\x20weapon\x20technology','image':'../images/tokens/subgame/fusion.gif','category':a50_0x3a56e0(0x12a)},'mmissile':{'price':0x320,'name':'Mega\x20Missile','description':'Heavy\x20ordinance\x20for\x20tough\x20situations','image':'../images/tokens/subgame/mmissile.gif','category':a50_0x3a56e0(0x12a)},'pbomb':{'price':0x15e,'name':a50_0x3a56e0(0x154),'description':'Strategic\x20explosive\x20device','image':a50_0x3a56e0(0x17b),'category':'weapon'},'pwr01':{'price':0x64,'name':'Energy','description':a50_0x3a56e0(0x122),'image':a50_0x3a56e0(0x127),'category':a50_0x3a56e0(0x14a)},'pwr02':{'price':0x258,'name':a50_0x3a56e0(0x17f),'description':a50_0x3a56e0(0x16e),'image':'../images/tokens/subgame/pwr02.gif','category':'powerup'},'smissile':{'price':0x28a,'name':a50_0x3a56e0(0x130),'description':a50_0x3a56e0(0x110),'image':'../images/tokens/subgame/smissile.gif','category':'weapon'}};let userData={'points':0x0,'inventory':[],'isAdmin':![]},storeContainer,pointsDisplay,authWarning;document[a50_0x3a56e0(0x14f)](a50_0x3a56e0(0x131),()=>{console['log']('🏪\x20Redeem\x20store\x20initializing...'),storeContainer=document['getElementById']('store-content'),pointsDisplay=document['getElementById']('user-points'),authWarning=document['getElementById']('auth-warning'),initAuthListener(),buildStoreUI();});function initAuthListener(){onAuthStateChanged(auth,async _0x4fc1ad=>{const _0x1ff3f3=a50_0x3b97;if(_0x4fc1ad){console[_0x1ff3f3(0x136)]('✅\x20User\x20authenticated:',_0x4fc1ad['displayName']||_0x4fc1ad[_0x1ff3f3(0x15a)]);if(authWarning)authWarning['style'][_0x1ff3f3(0x119)]='none';if(storeContainer)storeContainer['style']['display']=_0x1ff3f3(0x165);await loadUserData(_0x4fc1ad),updateThemeButtons(),updateTokenButtons();}else{console['log'](_0x1ff3f3(0x11f));if(authWarning)authWarning['style']['display']='block';if(storeContainer)storeContainer['style']['display']='none';userData={'points':0x0,'inventory':[],'isAdmin':![]},window[_0x1ff3f3(0xf9)]=![];}});}async function loadUserData(_0x5d5586){const _0x4fae32=a50_0x3a56e0;try{const _0x1e448f=doc(db,'userProfiles',_0x5d5586['uid']),_0x2d5e90=await getDoc(_0x1e448f);if(_0x2d5e90['exists']()){const _0x42177b=_0x2d5e90['data']();userData={'points':_0x42177b['points']||0x0,'inventory':_0x42177b['inventory']||[],'isAdmin':_0x42177b['isAdmin']||![],'equippedToken':_0x42177b['equippedToken']||null},pointsDisplay&&(pointsDisplay[_0x4fae32(0x114)]=userData['points']['toLocaleString']()),window[_0x4fae32(0xf9)]=userData['isAdmin'],userData['isAdmin']&&(console[_0x4fae32(0x136)](_0x4fae32(0x121)),window[_0x4fae32(0x160)](new CustomEvent('adminStatusChanged',{'detail':{'isAdmin':!![]}}))),console[_0x4fae32(0x136)](_0x4fae32(0x149)+userData[_0x4fae32(0x182)]+',\x20Inventory:\x20'+userData['inventory']['length']+'\x20items,\x20Equipped:\x20'+(userData['equippedToken']||'none'));}else await setDoc(_0x1e448f,{'points':0x0,'inventory':[],'equippedToken':null,'createdAt':serverTimestamp(),'username':_0x5d5586['displayName']||_0x5d5586['email']?.['split']('@')[0x0]||'User'}),userData={'points':0x0,'inventory':[],'isAdmin':![],'equippedToken':null},pointsDisplay&&(pointsDisplay['textContent']='0'),window[_0x4fae32(0xf9)]=![],console['log'](_0x4fae32(0x112));}catch(_0x3d1c02){console['error']('Error\x20loading\x20user\x20data:',_0x3d1c02);}}function userOwnsTheme(_0x285ce8){if(THEMES[_0x285ce8]?.['price']===0x0)return!![];return userData['inventory']['includes']('theme_'+_0x285ce8);}function userOwnsToken(_0x137afc){return userData['inventory']['includes']('token_'+_0x137afc);}function userHasTokenEquipped(_0x18fc73){return userData['equippedToken']===_0x18fc73;}function getEquippedToken(){return userData['equippedToken']||null;}async function purchaseTheme(_0x36c3d1){const _0x405eb6=a50_0x3a56e0,_0x38891f=auth['currentUser'];if(!_0x38891f)return showMessage('Please\x20sign\x20in\x20to\x20purchase\x20themes',_0x405eb6(0x17d)),![];const _0x3d5d9e=THEMES[_0x36c3d1];if(!_0x3d5d9e)return console['error']('Theme\x20'+_0x36c3d1+'\x20not\x20found'),![];if(userData['points']<_0x3d5d9e['price'])return showMessage('Not\x20enough\x20points.\x20You\x20need\x20'+(_0x3d5d9e['price']-userData[_0x405eb6(0x182)])+_0x405eb6(0x168),'error'),![];if(userOwnsTheme(_0x36c3d1))return showMessage('You\x20already\x20own\x20the\x20'+_0x3d5d9e['name']+'\x20theme',_0x405eb6(0x13c)),![];try{return await processPurchase(_0x36c3d1,_0x3d5d9e,'theme');}catch(_0x5c7c23){return console[_0x405eb6(0x17d)]('Theme\x20purchase\x20failed:',_0x5c7c23),showMessage('Purchase\x20failed.\x20Please\x20try\x20again.','error'),![];}}async function purchaseToken(_0x105753){const _0x56539b=a50_0x3a56e0,_0x13d3f4=auth['currentUser'];if(!_0x13d3f4)return showMessage('Please\x20sign\x20in\x20to\x20purchase\x20tokens','error'),![];const _0x4cb926=TOKENS[_0x105753];if(!_0x4cb926)return console[_0x56539b(0x17d)]('Token\x20'+_0x105753+_0x56539b(0x15d)),![];if(userData['points']<_0x4cb926[_0x56539b(0x156)])return showMessage('Not\x20enough\x20points.\x20You\x20need\x20'+(_0x4cb926['price']-userData['points'])+'\x20more\x20points.','error'),![];if(userOwnsToken(_0x105753))return showMessage(_0x56539b(0x179)+_0x4cb926['name']+'\x20token','info'),![];try{return await processPurchase(_0x105753,_0x4cb926,'token');}catch(_0x25af2d){return console['error']('Token\x20purchase\x20failed:',_0x25af2d),showMessage(_0x56539b(0x185),_0x56539b(0x17d)),![];}}async function processPurchase(_0x594af8,_0x30815e,_0x5c0611){const _0x7611aa=a50_0x3a56e0,_0x2ed738=auth['currentUser'];try{const _0x1fb1a6=doc(db,'userProfiles',_0x2ed738['uid']),_0x22f291=await getDoc(_0x1fb1a6);if(!_0x22f291['exists']())return showMessage('User\x20profile\x20not\x20found','error'),![];const _0x50bf24=_0x22f291['data'](),_0x4cda16=_0x50bf24['points']||0x0,_0x3b287b=_0x50bf24['inventory']||[];if(_0x4cda16<_0x30815e['price'])return showMessage('Insufficient\x20points','error'),![];if(_0x3b287b[_0x7611aa(0x12c)](_0x5c0611+'_'+_0x594af8))return showMessage(_0x7611aa(0xff)+_0x5c0611,_0x7611aa(0x13c)),![];const _0x5bf1b7=_0x4cda16-_0x30815e['price'],_0x996474=[..._0x3b287b,_0x5c0611+'_'+_0x594af8];await updateDoc(_0x1fb1a6,{'points':_0x5bf1b7,'inventory':_0x996474,'lastPurchase':serverTimestamp()});if(_0x5c0611==='token')try{const _0x12f600=doc(db,'userTokens',_0x2ed738['uid']),_0x3a7390=await getDoc(_0x12f600);let _0x3fe897=[];_0x3a7390['exists']()&&(_0x3fe897=_0x3a7390['data']()[_0x7611aa(0x163)]||[]);const _0x1f4346=new Date();_0x3fe897['push']({'tokenId':_0x594af8,'tokenName':_0x30815e['name'],'tokenImage':_0x30815e[_0x7611aa(0x10b)],'category':_0x30815e['category'],'purchasedAt':_0x1f4346,'price':_0x30815e['price'],'equipped':![]}),await setDoc(_0x12f600,{'userId':_0x2ed738[_0x7611aa(0x137)],'username':_0x50bf24[_0x7611aa(0x183)]||_0x2ed738['displayName']||_0x7611aa(0x15b),'tokens':_0x3fe897,'lastUpdated':serverTimestamp()},{'merge':!![]}),typeof clearTokenCache===_0x7611aa(0x173)&&clearTokenCache(_0x2ed738['uid']),console[_0x7611aa(0x136)]('✅\x20Token\x20'+_0x594af8+_0x7611aa(0x15e));}catch(_0x2c07d5){console['warn']('Token\x20collection\x20update\x20had\x20an\x20issue,\x20but\x20purchase\x20completed:',_0x2c07d5),_0x2c07d5['code']===_0x7611aa(0x111)?console['log']('🔧\x20Token\x20permissions\x20issue\x20detected,\x20but\x20purchase\x20was\x20successful'):console[_0x7611aa(0x17d)]('Unexpected\x20token\x20error:',_0x2c07d5);}try{await addDoc(collection(db,'transactions'),{'userId':_0x2ed738['uid'],'userEmail':_0x2ed738['email'],'itemId':_0x5c0611+'_'+_0x594af8,'itemTitle':_0x30815e['name'],'price':_0x30815e['price'],'type':'purchase','category':_0x5c0611,'timestamp':serverTimestamp()});}catch(_0x23c5a1){console[_0x7611aa(0xfd)](_0x7611aa(0x12f),_0x23c5a1);}return userData['points']=_0x5bf1b7,userData['inventory']=_0x996474,pointsDisplay&&(pointsDisplay['textContent']=userData['points'][_0x7611aa(0x12d)]()),updateTokenButtons(),_0x5c0611==='theme'&&updateThemeButtons(),console[_0x7611aa(0x136)]('✅\x20Purchased\x20'+_0x30815e['name']+'\x20for\x20'+_0x30815e['price']+'\x20points'),showMessage('Successfully\x20purchased\x20'+_0x30815e['name']+'!\x20Use\x20the\x20\x22Equip\x22\x20button\x20to\x20show\x20it\x20on\x20the\x20ladder.','success'),!![];}catch(_0x53a67a){console['error']('Purchase\x20processing\x20error:',_0x53a67a);if(_0x53a67a[_0x7611aa(0x100)]===_0x7611aa(0x111))showMessage('Permission\x20denied.\x20Please\x20try\x20again\x20or\x20contact\x20support.','error');else{if(_0x53a67a['code']==='unavailable')showMessage('Service\x20temporarily\x20unavailable.\x20Please\x20try\x20again.','error');else _0x53a67a['code']===_0x7611aa(0x151)?showMessage('Please\x20sign\x20in\x20again\x20to\x20complete\x20purchase.','error'):showMessage(_0x7611aa(0x185),'error');}return![];}}async function equipToken(_0x5c6967){const _0x3eb6c9=a50_0x3a56e0,_0x101ac6=auth['currentUser'];if(!_0x101ac6)return showMessage('Please\x20sign\x20in\x20to\x20equip\x20tokens',_0x3eb6c9(0x17d)),![];const _0x7e003f=TOKENS[_0x5c6967];if(!_0x7e003f)return console['error']('Token\x20'+_0x5c6967+'\x20not\x20found'),![];if(!userOwnsToken(_0x5c6967))return showMessage(_0x3eb6c9(0x174),'error'),![];try{const _0x2567b9=doc(db,_0x3eb6c9(0x132),_0x101ac6['uid']);await updateDoc(_0x2567b9,{'equippedToken':_0x5c6967,'lastTokenEquip':serverTimestamp()});try{const _0x5376c3=doc(db,'userTokens',_0x101ac6[_0x3eb6c9(0x137)]),_0x41a24a=await getDoc(_0x5376c3);if(_0x41a24a[_0x3eb6c9(0x117)]()){const _0x24fea5=_0x41a24a['data'](),_0x1113ff=_0x24fea5['tokens']||[],_0x18ac30=_0x1113ff[_0x3eb6c9(0x11a)](_0x4e7011=>({..._0x4e7011,'equipped':_0x4e7011[_0x3eb6c9(0x10e)]===_0x5c6967}));await updateDoc(_0x5376c3,{'tokens':_0x18ac30,'equippedToken':_0x5c6967,'lastUpdated':serverTimestamp()});}}catch(_0x2939f3){console['warn']('Token\x20collection\x20update\x20had\x20an\x20issue,\x20but\x20equip\x20was\x20successful:',_0x2939f3);}return userData['equippedToken']=_0x5c6967,typeof clearTokenCache===_0x3eb6c9(0x173)&&(clearTokenCache(_0x101ac6['uid']),clearTokenCache()),setTimeout(()=>{const _0x26f86f=_0x3eb6c9;window[_0x26f86f(0x134)]&&typeof window['displayLadder']==='function'&&(console['log']('🔄\x20Refreshing\x20ladder\x20to\x20show\x20equipped\x20token'),window['displayLadder'](!![])),window['RedeemStore']&&typeof window[_0x26f86f(0x15f)]['refreshUI']===_0x26f86f(0x173)&&window[_0x26f86f(0x15f)]['refreshUI']();},0x1f4),console[_0x3eb6c9(0x136)]('✅\x20Equipped\x20token:\x20'+_0x7e003f['name']),showMessage(_0x7e003f[_0x3eb6c9(0x108)]+'\x20equipped!\x20Ladder\x20will\x20refresh\x20shortly.','success'),!![];}catch(_0x32e50a){return console['error']('Token\x20equip\x20failed:',_0x32e50a),_0x32e50a['code']===_0x3eb6c9(0x111)?showMessage('Permission\x20denied.\x20Token\x20may\x20still\x20be\x20equipped\x20-\x20check\x20the\x20ladder.','warning'):showMessage('Failed\x20to\x20equip\x20token:\x20'+_0x32e50a['message'],'error'),![];}}async function unequipToken(){const _0x4b40f3=a50_0x3a56e0,_0x962251=auth['currentUser'];if(!_0x962251)return showMessage('Please\x20sign\x20in\x20to\x20unequip\x20tokens','error'),![];if(!userData['equippedToken'])return showMessage('No\x20token\x20is\x20currently\x20equipped',_0x4b40f3(0x13c)),![];try{const _0x15a73f=doc(db,'userProfiles',_0x962251['uid']);await updateDoc(_0x15a73f,{'equippedToken':null,'lastTokenEquip':serverTimestamp()});const _0x1bd8c4=doc(db,'userTokens',_0x962251['uid']),_0x102486=await getDoc(_0x1bd8c4);if(_0x102486['exists']()){const _0x115cbd=_0x102486['data'](),_0x3e79dd=_0x115cbd['tokens']||[],_0x2f922c=_0x3e79dd[_0x4b40f3(0x11a)](_0x4fd036=>({..._0x4fd036,'equipped':![]}));await updateDoc(_0x1bd8c4,{'tokens':_0x2f922c,'equippedToken':null,'lastUpdated':serverTimestamp()});}return userData['equippedToken']=null,typeof clearTokenCache===_0x4b40f3(0x173)&&(clearTokenCache(_0x962251['uid']),clearTokenCache()),setTimeout(()=>{const _0xb10aad=_0x4b40f3;window[_0xb10aad(0x134)]&&typeof window['displayLadder']==='function'&&(console[_0xb10aad(0x136)]('🔄\x20Refreshing\x20ladder\x20to\x20remove\x20unequipped\x20token'),window['displayLadder'](!![])),window[_0xb10aad(0x15f)]&&typeof window['RedeemStore']['refreshUI']==='function'&&window['RedeemStore'][_0xb10aad(0x133)]();},0x1f4),console['log'](_0x4b40f3(0x180)),showMessage('Token\x20unequipped!\x20Ladder\x20will\x20refresh\x20shortly.',_0x4b40f3(0x13f)),!![];}catch(_0x7bfa23){return console['error']('Token\x20unequip\x20failed:',_0x7bfa23),showMessage('Failed\x20to\x20unequip\x20token:\x20'+_0x7bfa23['message'],'error'),![];}}function a50_0x172d(){const _0x410c35=['isUserAdmin','cursor','apply-theme','blob','warn','\x20for\x20','You\x20already\x20own\x20this\x20','code','</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22item-description\x22>','Only\x20admins\x20can\x20sell\x20tokens','\x20theme\x20purchased!','.token-equip-btn','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22item-title\x22>','current-theme','visible','name','token','floor','image','Apply\x20Theme','classList','tokenId','remove','Intelligent\x20targeting\x20system','permission-denied','New\x20user\x20profile\x20created','closest','textContent','sign-in-free','var(--info-color,\x20#17a2b8)','exists','Need\x20','display','map','\x20Points','Buy\x20for\x20','preventDefault','background','❌\x20User\x20not\x20authenticated','prototype','👑\x20Admin\x20controls\x20enabled','Enhanced\x20energy\x20generation\x20unit','add','transactions','pointer','\x20pts)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','../images/tokens/subgame/pwr01.gif','getElementById','This\x20one\x20is\x20really\x20pretty','weapon','querySelector','includes','toLocaleString','\x20points?','Transaction\x20logging\x20failed,\x20but\x20purchase\x20was\x20successful:','Smart\x20Missile','DOMContentLoaded','userProfiles','refreshUI','displayLadder','This\x20theme\x20makes\x20me\x20happy','log','uid','appendChild','forEach','../images/tokens/gauge18.gif','\x20points?\x20This\x20cannot\x20be\x20undone.','info','Yellow\x20Orange','apply','success','isAdmin','0.5','itemId','console','confirm','R/Y/B\x20Keys','querySelectorAll','equippedToken','Blob\x20Token\x201','User\x20data\x20loaded\x20-\x20Points:\x20','powerup','data','cannot-afford','ThemeSystem','owned','addEventListener','Equipped','unauthenticated','opacity','.theme-select-btn','Proximity\x20Bomb','bind','price','store-message','Purchase\x20','Are\x20you\x20sure\x20you\x20want\x20to\x20sell\x20','email','Unknown','token_','\x20not\x20found','\x20saved\x20to\x20userTokens\x20collection\x20(not\x20equipped)','RedeemStore','dispatchEvent','0.7','message','tokens','Themes\x20container\x20not\x20found','block','return\x20(function()\x20','innerHTML','\x20more\x20points.','currentUser','not-allowed','[data-theme]','Black\x20&\x20White','style','Advanced\x20energy\x20storage\x20system','var(--success-color,\x20#4CAF50)','Unequip\x20','getCurrentTheme','../images/tokens/blob01.gif','function','You\x20must\x20own\x20this\x20token\x20to\x20equip\x20it','dataset','?\x20This\x20will\x20unequip\x20your\x20current\x20token.','Monitor\x20your\x20ship\x27s\x20energy\x20levels','filter','You\x20already\x20own\x20the\x20','inventory','../images/tokens/subgame/pbomb.gif','[data-token]','error','Token\x20','Shield\x20Orb','✅\x20Token\x20unequipped','disabled','points','username','Sign\x20in\x20to\x20Apply','Purchase\x20failed.\x20Please\x20try\x20again.','className'];a50_0x172d=function(){return _0x410c35;};return a50_0x172d();}async function sellToken(_0x1b5d47){const _0x4f14aa=a50_0x3a56e0,_0x5881ab=auth[_0x4f14aa(0x169)];if(!_0x5881ab)return showMessage('Please\x20sign\x20in\x20to\x20sell\x20tokens','error'),![];if(!userData[_0x4f14aa(0x140)])return showMessage(_0x4f14aa(0x102),'error'),![];const _0x1ee90c=TOKENS[_0x1b5d47];if(!_0x1ee90c)return console['error'](_0x4f14aa(0x17e)+_0x1b5d47+_0x4f14aa(0x15d)),![];if(!userOwnsToken(_0x1b5d47))return showMessage('You\x20don\x27t\x20own\x20this\x20token','error'),![];try{const _0x46ef8a=doc(db,'userProfiles',_0x5881ab['uid']),_0x3b7f3a=await getDoc(_0x46ef8a),_0x263d7a=_0x3b7f3a[_0x4f14aa(0x14b)](),_0x9858f9=Math[_0x4f14aa(0x10a)](_0x1ee90c[_0x4f14aa(0x156)]*0.5),_0x197654=(_0x263d7a['points']||0x0)+_0x9858f9,_0x49d9bb=(_0x263d7a[_0x4f14aa(0x17a)]||[])[_0x4f14aa(0x178)](_0x4bad00=>_0x4bad00!==_0x4f14aa(0x15c)+_0x1b5d47),_0x14762f=_0x263d7a[_0x4f14aa(0x147)]===_0x1b5d47?null:_0x263d7a[_0x4f14aa(0x147)];await updateDoc(_0x46ef8a,{'points':_0x197654,'inventory':_0x49d9bb,'equippedToken':_0x14762f,'lastSale':serverTimestamp()});const _0x38617f=doc(db,'userTokens',_0x5881ab[_0x4f14aa(0x137)]),_0x5aea1f=await getDoc(_0x38617f);if(_0x5aea1f['exists']()){const _0x1255e8=_0x5aea1f['data'](),_0xb7b29f=_0x1255e8['tokens']||[],_0xc0e7b0=_0xb7b29f['filter'](_0x26e832=>_0x26e832[_0x4f14aa(0x10e)]!==_0x1b5d47);await updateDoc(_0x38617f,{'tokens':_0xc0e7b0,'equippedToken':_0x14762f,'lastUpdated':serverTimestamp()});}return await addDoc(collection(db,_0x4f14aa(0x124)),{'userId':_0x5881ab['uid'],'userEmail':_0x5881ab[_0x4f14aa(0x15a)],'itemId':'token_'+_0x1b5d47,'itemTitle':_0x1ee90c[_0x4f14aa(0x108)],'refund':_0x9858f9,'originalPrice':_0x1ee90c['price'],'type':'sale','category':'token','timestamp':serverTimestamp()}),userData['points']=_0x197654,userData['inventory']=_0x49d9bb,userData[_0x4f14aa(0x147)]=_0x14762f,pointsDisplay&&(pointsDisplay['textContent']=userData[_0x4f14aa(0x182)]['toLocaleString']()),typeof clearTokenCache==='function'&&clearTokenCache(_0x5881ab['uid']),console[_0x4f14aa(0x136)]('✅\x20Sold\x20token\x20'+_0x1ee90c[_0x4f14aa(0x108)]+'\x20for\x20'+_0x9858f9+'\x20points'),showMessage('Sold\x20'+_0x1ee90c['name']+'\x20for\x20'+_0x9858f9+'\x20points\x20(50%\x20refund)',_0x4f14aa(0x13f)),!![];}catch(_0x416407){return console['error']('Token\x20sale\x20failed:',_0x416407),showMessage('Failed\x20to\x20sell\x20token:\x20'+_0x416407[_0x4f14aa(0x162)],_0x4f14aa(0x17d)),![];}}function applyTheme(_0x5f3d00){const _0x6ee92d=a50_0x3a56e0;if(!userOwnsTheme(_0x5f3d00))return showMessage('You\x20must\x20purchase\x20this\x20theme\x20first','error'),![];return window[_0x6ee92d(0x14d)]?(window['ThemeSystem']['switchTheme'](_0x5f3d00),showMessage((THEMES[_0x5f3d00]?.['name']||_0x5f3d00)+'\x20theme\x20applied!','success'),!![]):(console[_0x6ee92d(0x17d)]('Theme\x20system\x20not\x20found'),![]);}function buildStoreUI(){buildThemeItems(),buildTokenItems();}function buildThemeItems(){const _0x15ca26=a50_0x3a56e0,_0x283b54=document['querySelector']('.themes-grid');if(!_0x283b54){console['error'](_0x15ca26(0x164));return;}_0x283b54[_0x15ca26(0x167)]='',Object['entries'](THEMES)['forEach'](([_0x8c581c,_0x353118])=>{const _0x3a7544=_0x15ca26,_0x57bfef=document['createElement']('div');_0x57bfef[_0x3a7544(0x186)]='store-item',_0x57bfef['dataset']['theme']=_0x8c581c,_0x57bfef[_0x3a7544(0x175)]['itemId']='theme_'+_0x8c581c,_0x57bfef[_0x3a7544(0x175)]['price']=_0x353118['price'],_0x57bfef['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22item-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22item-icon\x20theme-icon-'+_0x8c581c+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-palette\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22item-price\x22>'+(_0x353118['price']===0x0?'FREE':_0x353118['price']+'\x20Points')+_0x3a7544(0x105)+_0x353118['name']+_0x3a7544(0x101)+_0x353118['description']+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22theme-select-btn\x20purchase-btn\x22>Select\x20Theme</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x283b54[_0x3a7544(0x138)](_0x57bfef);}),setupThemeButtons();}function buildTokenItems(){const _0x7bc54b=a50_0x3a56e0,_0x448879=document['querySelector']('.tokens-grid');if(!_0x448879){console['error']('Tokens\x20container\x20not\x20found');return;}_0x448879['innerHTML']='',Object['entries'](TOKENS)[_0x7bc54b(0x139)](([_0x3b75a2,_0x5e5279])=>{const _0x2d074b=_0x7bc54b,_0x3046c4=document['createElement']('div');_0x3046c4['className']='store-item\x20token-item',_0x3046c4['dataset']['token']=_0x3b75a2,_0x3046c4[_0x2d074b(0x175)][_0x2d074b(0x142)]='token_'+_0x3b75a2,_0x3046c4['dataset']['price']=_0x5e5279['price'];const _0x10eea2=userData[_0x2d074b(0x140)]&&userOwnsToken(_0x3b75a2)?'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22token-sell-btn\x20admin-btn\x22\x20style=\x22margin-top:\x200.5rem;\x20background:\x20#f44336;\x20font-size:\x200.8rem;\x20padding:\x200.3rem;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Sell\x20('+Math['floor'](_0x5e5279[_0x2d074b(0x156)]*0.5)+_0x2d074b(0x126):'';_0x3046c4[_0x2d074b(0x167)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22item-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22item-icon\x20token-icon\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22'+_0x5e5279['image']+'\x22\x20alt=\x22'+_0x5e5279[_0x2d074b(0x108)]+'\x22\x20class=\x22token-preview\x22\x20onerror=\x22this.style.display=\x27none\x27;\x20this.nextElementSibling.style.display=\x27flex\x27;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22token-fallback\x22\x20style=\x22display:\x20none;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-coins\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22item-price\x22>'+_0x5e5279[_0x2d074b(0x156)]+'\x20Points</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22token-select-btn\x20purchase-btn\x22>Purchase</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22token-equip-btn\x20equip-btn\x22\x20style=\x22margin-top:\x200.5rem;\x20display:\x20none;\x22>Equip</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x10eea2+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x448879[_0x2d074b(0x138)](_0x3046c4);}),setupTokenButtons();}function setupThemeButtons(){const _0x23b77a=a50_0x3a56e0,_0xd119a0=document[_0x23b77a(0x146)]('.theme-select-btn');_0xd119a0[_0x23b77a(0x139)](_0x21fb4e=>{_0x21fb4e['addEventListener']('click',async _0x4aab0c=>{const _0x27b343=a50_0x3b97;_0x4aab0c[_0x27b343(0x11d)]();const _0x34276c=auth['currentUser'];if(!_0x34276c){showMessage('Please\x20sign\x20in\x20to\x20select\x20themes','error');return;}const _0x2a71bd=_0x21fb4e['closest']('[data-theme]'),_0x12a64e=_0x2a71bd[_0x27b343(0x175)]['theme'],_0x5d31a0=THEMES[_0x12a64e];if(!_0x5d31a0){console['error']('Theme\x20'+_0x12a64e+'\x20not\x20found');return;}console['log']('Theme\x20clicked:\x20'+_0x5d31a0[_0x27b343(0x108)]+'\x20('+_0x12a64e+')');if(_0x21fb4e['disabled']){_0x5d31a0['price']>0x0&&showMessage('You\x20need\x20'+_0x5d31a0[_0x27b343(0x156)]+'\x20points\x20to\x20purchase\x20this\x20theme','error');return;}if(_0x21fb4e['textContent']==='Current\x20Theme'){showMessage(_0x5d31a0['name']+'\x20is\x20already\x20your\x20current\x20theme','info');return;}if(_0x21fb4e['textContent']==='Apply\x20Theme'){applyTheme(_0x12a64e),updateThemeButtons();return;}if(_0x21fb4e['textContent'][_0x27b343(0x12c)]('Buy')){const _0x207313=window['confirm']('Purchase\x20'+_0x5d31a0['name']+'\x20theme\x20for\x20'+_0x5d31a0['price']+_0x27b343(0x12e));if(!_0x207313)return;const _0x1af71e=await purchaseTheme(_0x12a64e);_0x1af71e&&(showMessage(_0x5d31a0[_0x27b343(0x108)]+_0x27b343(0x103),'success'),applyTheme(_0x12a64e),updateThemeButtons());return;}userOwnsTheme(_0x12a64e)?applyTheme(_0x12a64e):showMessage('You\x20must\x20purchase\x20this\x20theme\x20first','error');});}),updateThemeButtons();}function setupTokenButtons(){const _0x5c79ff=a50_0x3a56e0,_0x5ec444=document['querySelectorAll']('.token-select-btn'),_0x1e7ac5=document['querySelectorAll'](_0x5c79ff(0x104)),_0xc59353=document[_0x5c79ff(0x146)]('.token-sell-btn');_0x5ec444['forEach'](_0x42d2df=>{const _0xe17282=_0x5c79ff;_0x42d2df[_0xe17282(0x14f)]('click',async _0x42de55=>{const _0x9ecbc8=_0xe17282;_0x42de55['preventDefault']();const _0x22f2f8=auth['currentUser'];if(!_0x22f2f8){showMessage('Please\x20sign\x20in\x20to\x20purchase\x20tokens','error');return;}const _0x45ad33=_0x42d2df[_0x9ecbc8(0x113)]('[data-token]'),_0x1e515d=_0x45ad33['dataset'][_0x9ecbc8(0x109)],_0x534fd3=TOKENS[_0x1e515d];if(!_0x534fd3){console['error'](_0x9ecbc8(0x17e)+_0x1e515d+'\x20not\x20found');return;}console['log']('Token\x20clicked:\x20'+_0x534fd3[_0x9ecbc8(0x108)]+'\x20('+_0x1e515d+')');if(_0x42d2df['disabled']){showMessage('You\x20need\x20'+_0x534fd3['price']+'\x20points\x20to\x20purchase\x20this\x20token','error');return;}if(_0x42d2df['textContent']==='Owned'){showMessage('You\x20already\x20own\x20the\x20'+_0x534fd3['name']+'\x20token',_0x9ecbc8(0x13c));return;}if(_0x42d2df['textContent']['includes']('Purchase')||_0x42d2df[_0x9ecbc8(0x114)]['includes']('Buy')){const _0x2f43ea=window['confirm'](_0x9ecbc8(0x158)+_0x534fd3[_0x9ecbc8(0x108)]+'\x20token\x20for\x20'+_0x534fd3[_0x9ecbc8(0x156)]+_0x9ecbc8(0x12e));if(!_0x2f43ea)return;const _0x28074b=await purchaseToken(_0x1e515d);_0x28074b&&updateTokenButtons();return;}});}),_0x1e7ac5['forEach'](_0x3071be=>{_0x3071be['addEventListener']('click',async _0x5453bb=>{const _0x50b429=a50_0x3b97;_0x5453bb['preventDefault']();const _0x3743ce=_0x3071be['closest']('[data-token]'),_0x272173=_0x3743ce['dataset']['token'],_0x247150=TOKENS[_0x272173];if(_0x3071be['textContent']===_0x50b429(0x150)){const _0xef7ea2=window['confirm'](_0x50b429(0x170)+_0x247150['name']+'?');if(!_0xef7ea2)return;const _0x1e1589=await unequipToken();_0x1e1589&&updateTokenButtons();}else{const _0x1fc09e=window['confirm']('Equip\x20'+_0x247150['name']+_0x50b429(0x176));if(!_0x1fc09e)return;const _0x382f43=await equipToken(_0x272173);_0x382f43&&updateTokenButtons();}});}),_0xc59353[_0x5c79ff(0x139)](_0x25c285=>{_0x25c285['addEventListener']('click',async _0x431e2a=>{const _0x8d28ca=a50_0x3b97;_0x431e2a['preventDefault']();const _0x3e4079=_0x25c285['closest'](_0x8d28ca(0x17c)),_0x390d85=_0x3e4079['dataset']['token'],_0x54e29b=TOKENS[_0x390d85],_0x4dae8d=Math['floor'](_0x54e29b['price']*0.5),_0x100ac6=window[_0x8d28ca(0x144)](_0x8d28ca(0x159)+_0x54e29b[_0x8d28ca(0x108)]+_0x8d28ca(0xfe)+_0x4dae8d+_0x8d28ca(0x13b));if(!_0x100ac6)return;const _0x6bee8f=await sellToken(_0x390d85);_0x6bee8f&&updateTokenButtons();});}),updateTokenButtons();}function updateThemeButtons(){const _0x41cd22=a50_0x3a56e0,_0x6de768=window['ThemeSystem']?window['ThemeSystem'][_0x41cd22(0x171)]():'default',_0x3671b2=auth['currentUser'];document['querySelectorAll'](_0x41cd22(0x153))['forEach'](_0x4a8e2c=>{const _0x90ec5e=_0x41cd22,_0x15d395=_0x4a8e2c['closest'](_0x90ec5e(0x16b)),_0x450503=_0x15d395[_0x90ec5e(0x175)]['theme'],_0x59baba=THEMES[_0x450503];if(!_0x59baba)return;_0x4a8e2c['disabled']=![],_0x4a8e2c['style']['opacity']='',_0x4a8e2c[_0x90ec5e(0x16d)]['cursor']='pointer',_0x4a8e2c['classList']['remove']('current-theme',_0x90ec5e(0xfb),'can-afford',_0x90ec5e(0x14c),'sign-in-free','sign-in-paid');if(!_0x3671b2){_0x59baba['price']===0x0?(_0x4a8e2c['textContent']=_0x90ec5e(0x184),_0x4a8e2c['classList'][_0x90ec5e(0x123)](_0x90ec5e(0x115))):(_0x4a8e2c[_0x90ec5e(0x114)]='Sign\x20in\x20to\x20Purchase',_0x4a8e2c['disabled']=!![],_0x4a8e2c['style']['opacity']=_0x90ec5e(0x161),_0x4a8e2c['classList']['add']('sign-in-paid'));return;}if(_0x450503===_0x6de768){_0x4a8e2c['textContent']='Current\x20Theme',_0x4a8e2c[_0x90ec5e(0x10d)]['add'](_0x90ec5e(0x106)),_0x4a8e2c[_0x90ec5e(0x181)]=!![],_0x4a8e2c['style']['cursor']='default';return;}if(userOwnsTheme(_0x450503)){_0x4a8e2c['textContent']=_0x90ec5e(0x10c),_0x4a8e2c['classList']['add']('apply-theme');return;}if(userData['points']>=_0x59baba['price']){_0x4a8e2c['textContent']=_0x90ec5e(0x11c)+_0x59baba['price']+_0x90ec5e(0x11b),_0x4a8e2c['classList']['add']('can-afford');return;}_0x4a8e2c[_0x90ec5e(0x114)]='Need\x20'+_0x59baba['price']+_0x90ec5e(0x11b),_0x4a8e2c[_0x90ec5e(0x10d)]['add']('cannot-afford'),_0x4a8e2c['style']['opacity']=_0x90ec5e(0x141),_0x4a8e2c['disabled']=!![],_0x4a8e2c['style']['cursor']='not-allowed';});}function updateTokenButtons(){const _0x30daa4=auth['currentUser'];document['querySelectorAll']('.token-select-btn')['forEach'](_0x6cc091=>{const _0x9a7128=a50_0x3b97,_0x4aebc0=_0x6cc091['closest']('[data-token]'),_0x375bcf=_0x4aebc0['dataset']['token'],_0x36f8fa=TOKENS[_0x375bcf],_0x581664=_0x4aebc0[_0x9a7128(0x12b)](_0x9a7128(0x104)),_0x504bfc=_0x4aebc0[_0x9a7128(0x12b)]('.token-sell-btn');if(!_0x36f8fa)return;_0x6cc091['disabled']=![],_0x6cc091['style']['opacity']='',_0x6cc091['style'][_0x9a7128(0xfa)]='pointer';_0x581664&&(_0x581664[_0x9a7128(0x16d)]['display']='none',_0x581664['disabled']=![],_0x581664['style']['opacity']='',_0x581664[_0x9a7128(0x10d)]['remove']('equipped','can-equip'));_0x504bfc&&(_0x504bfc['style']['display']='none');_0x6cc091['classList'][_0x9a7128(0x10f)](_0x9a7128(0x14e),'can-afford','cannot-afford','sign-in');if(!_0x30daa4){_0x6cc091['textContent']='Sign\x20in\x20to\x20Purchase',_0x6cc091['disabled']=!![],_0x6cc091['style'][_0x9a7128(0x152)]=_0x9a7128(0x161),_0x6cc091['classList']['add']('sign-in');return;}if(userOwnsToken(_0x375bcf)){_0x6cc091['textContent']='Owned',_0x6cc091[_0x9a7128(0x10d)]['add']('owned'),_0x6cc091['disabled']=!![],_0x6cc091['style']['cursor']='default',_0x6cc091[_0x9a7128(0x16d)]['background']=_0x9a7128(0x16f);_0x581664&&(_0x581664['style']['display']=_0x9a7128(0x165),userHasTokenEquipped(_0x375bcf)?(_0x581664[_0x9a7128(0x114)]='Equipped',_0x581664['classList'][_0x9a7128(0x123)]('equipped'),_0x581664['style']['background']='var(--accent-color,\x20#2196F3)',_0x581664['style'][_0x9a7128(0xfa)]='pointer'):(_0x581664['textContent']='Equip',_0x581664['classList'][_0x9a7128(0x123)]('can-equip'),_0x581664['style']['background']=_0x9a7128(0x116),_0x581664[_0x9a7128(0x16d)]['cursor']=_0x9a7128(0x125)));_0x504bfc&&userData['isAdmin']&&(_0x504bfc['style'][_0x9a7128(0x119)]='block');return;}if(userData['points']>=_0x36f8fa['price']){_0x6cc091[_0x9a7128(0x114)]=_0x9a7128(0x11c)+_0x36f8fa['price']+'\x20Points',_0x6cc091[_0x9a7128(0x10d)]['add']('can-afford'),_0x6cc091['style'][_0x9a7128(0x11e)]='';return;}_0x6cc091['textContent']=_0x9a7128(0x118)+_0x36f8fa['price']+'\x20Points',_0x6cc091[_0x9a7128(0x10d)]['add'](_0x9a7128(0x14c)),_0x6cc091['style']['opacity']='0.5',_0x6cc091['disabled']=!![],_0x6cc091['style']['cursor']=_0x9a7128(0x16a),_0x6cc091[_0x9a7128(0x16d)]['background']='var(--muted-color,\x20#757575)';});}function showMessage(_0x29106d,_0x563e60=a50_0x3a56e0(0x13c)){const _0x2f8c50=a50_0x3a56e0,_0x4e36e5=document[_0x2f8c50(0x128)](_0x2f8c50(0x157));_0x4e36e5&&_0x4e36e5['remove']();const _0x424846=document['createElement']('div');_0x424846['id']='store-message',_0x424846['className']='store-message\x20store-message-'+_0x563e60,_0x424846['textContent']=_0x29106d,document['body']['appendChild'](_0x424846),requestAnimationFrame(()=>{const _0x425921=_0x2f8c50;_0x424846[_0x425921(0x10d)][_0x425921(0x123)](_0x425921(0x107));}),setTimeout(()=>{const _0xc58fa8=_0x2f8c50;_0x424846['classList'][_0xc58fa8(0x10f)](_0xc58fa8(0x107)),setTimeout(()=>{_0x424846['parentNode']&&_0x424846['remove']();},0x12c);},0xfa0);}window['RedeemStore']={'refreshUI':()=>{updateThemeButtons(),updateTokenButtons();},'checkOwnership':userOwnsTheme,'checkTokenOwnership':userOwnsToken,'applyTheme':applyTheme,'purchaseTheme':purchaseTheme,'purchaseToken':purchaseToken},console[a50_0x3a56e0(0x136)]('🏪\x20Redeem\x20store\x20loaded');
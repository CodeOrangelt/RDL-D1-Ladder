const a31_0xf8206a=a31_0x5b31,a31_0x44507f=(function(){let _0x29cbab=!![];return function(_0x12c553,_0x1ad4e8){const _0x560e96=_0x29cbab?function(){if(_0x1ad4e8){const _0xded0ef=_0x1ad4e8['apply'](_0x12c553,arguments);return _0x1ad4e8=null,_0xded0ef;}}:function(){};return _0x29cbab=![],_0x560e96;};}()),a31_0x1a6998=a31_0x44507f(this,function(){const _0x1d678f=a31_0x5b31;let _0x6a5822;try{const _0x57a3f5=Function('return\x20(function()\x20'+_0x1d678f(0xcb)+');');_0x6a5822=_0x57a3f5();}catch(_0x279233){_0x6a5822=window;}const _0x1ef6c9=_0x6a5822['console']=_0x6a5822['console']||{},_0x2f627b=['log',_0x1d678f(0x98),_0x1d678f(0xd4),_0x1d678f(0x96),'exception','table',_0x1d678f(0xa6)];for(let _0x50aad1=0x0;_0x50aad1<_0x2f627b['length'];_0x50aad1++){const _0x29d4d7=a31_0x44507f['constructor']['prototype']['bind'](a31_0x44507f),_0x147d6e=_0x2f627b[_0x50aad1],_0x5504e3=_0x1ef6c9[_0x147d6e]||_0x29d4d7;_0x29d4d7['__proto__']=a31_0x44507f[_0x1d678f(0xc8)](a31_0x44507f),_0x29d4d7['toString']=_0x5504e3[_0x1d678f(0xc3)]['bind'](_0x5504e3),_0x1ef6c9[_0x147d6e]=_0x29d4d7;}});a31_0x1a6998();import{collection,getDocs,doc,getDoc,query,where,updateDoc,Timestamp,orderBy,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a31_0xc30c(){const _0x12f96d=['error','#C0C0C0','warn','map','length','losses','username','loserScore','seconds','points','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','totalMatches','data','get','position','\x0a\x20\x20.streak-indicator\x20{\x0a\x20\x20\x20\x20font-size:\x200.9em;\x0a\x20\x20\x20\x20color:\x20#FF4500;\x0a\x20\x20\x20\x20margin-left:\x205px;\x0a\x20\x20\x20\x20font-weight:\x20bold;\x0a\x20\x20}\x0a','trace',';\x20position:\x20relative;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22elo-container\x22\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22elo-value\x22>','gameMode','then','winRate','playerUsername','string','function','D3:\x20Error\x20fetching\x20tokens:','display','change','color','createElement','newElo','eloRating','style','(Equipped)','push','forEach','player','totalDeaths','querySelector','country','fontSize','previousElo','D3:\x20Error\x20fetching\x20ELO\x20history:','desc','set','fontWeight','toString','inline','opacity','<img\x20src=\x22../images/flags/','</td>\x0a\x20\x20\x20\x20</tr>','bind','toFixed','#ladder-d3\x20thead\x20tr','{}.constructor(\x22return\x20this\x22)(\x20)','%</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td\x20style=\x22color:\x20gray;\x22>','timestamp','#ladder-d3\x20tbody','td:nth-child(3)','innerHTML','playersD3','#F44336','displayLadderD3\x20function\x20not\x20available','info','totalKills'];a31_0xc30c=function(){return _0x12f96d;};return a31_0xc30c();}import{db}from'./firebase-config.js';import a31_0x1bde16 from'./firebase-idle-wrapper.js';import{getTokensByUsernames,getPrimaryDisplayToken,clearTokenCache}from'./tokens.js';const styleEl=document[a31_0xf8206a(0xb2)]('style');styleEl['textContent']=a31_0xf8206a(0xa5),document['head']['appendChild'](styleEl);const playerCacheD3={'data':null,'timestamp':0x0},CACHE_DURATION=0x7530;async function displayLadderD3(_0x1230fa=![]){const _0x452692=a31_0xf8206a,_0x139868=document['querySelector']('#ladder-d3\x20tbody');if(!_0x139868){console['error']('D3\x20Ladder\x20table\x20body\x20not\x20found');return;}_0x139868['innerHTML']='<tr><td\x20colspan=\x228\x22\x20class=\x22loading-cell\x22>Loading\x20D3\x20ladder\x20data...</td></tr>';try{const _0x828d05=Date['now']();if(!_0x1230fa&&playerCacheD3['data']&&_0x828d05-playerCacheD3['timestamp']<CACHE_DURATION){updateLadderDisplayD3(playerCacheD3['data']);return;}const _0x526832=collection(db,'playersD3'),_0x54eb35=await getDocs(_0x526832),_0x16736e=[];_0x54eb35[_0x452692(0xb8)](_0x2dc89f=>{const _0x376ed8=_0x452692,_0x393965=_0x2dc89f[_0x376ed8(0xa2)]();_0x393965['username']&&_0x16736e['push']({..._0x393965,'id':_0x2dc89f['id'],'elo':_0x393965[_0x376ed8(0xb4)]||0x0,'position':_0x393965[_0x376ed8(0xa4)]||Number['MAX_SAFE_INTEGER']});});const _0x16046a=collection(db,'userProfiles'),_0x45cef6=await getDocs(_0x16046a),_0xae8363=new Map();_0x45cef6[_0x452692(0xb8)](_0x3d2182=>{const _0x41d335=_0x452692,_0x33066f=_0x3d2182['data']();_0x33066f[_0x41d335(0x9c)]&&_0xae8363[_0x41d335(0xc1)](_0x33066f[_0x41d335(0x9c)]['toLowerCase'](),_0x33066f);});for(const _0x32880a of _0x16736e){const _0x1826f=_0x32880a['username']['toLowerCase']();if(_0xae8363['has'](_0x1826f)){const _0x2df461=_0xae8363['get'](_0x1826f);_0x2df461['country']&&(_0x32880a['country']=_0x2df461['country']['toLowerCase']()),_0x32880a['points']=_0x2df461['points']||0x0;}else _0x32880a['points']=0x0;}const _0x458fde=_0x16736e[_0x452692(0x99)](_0x2ecde9=>_0x2ecde9['username']),_0x3e4b15=await fetchBatchMatchStatsD3(_0x458fde);_0x16736e['sort']((_0x2eeed5,_0x4b2e62)=>{const _0x161b52=_0x452692,_0x414169=_0x3e4b15[_0x161b52(0xa3)](_0x2eeed5['username'])?.[_0x161b52(0xa1)]||0x0,_0x1bd075=_0x3e4b15['get'](_0x4b2e62['username'])?.['totalMatches']||0x0;if(_0x414169===0x0!==(_0x1bd075===0x0))return _0x414169===0x0?0x1:-0x1;return(_0x2eeed5['position']||0x3e7)-(_0x4b2e62['position']||0x3e7);}),_0x16736e['forEach']((_0x23c60c,_0x43cf75)=>{_0x23c60c['position']=_0x43cf75+0x1;}),playerCacheD3[_0x452692(0xa2)]=_0x16736e,playerCacheD3['timestamp']=_0x828d05,updateLadderDisplayD3(_0x16736e);}catch(_0x3266f4){console['error']('Error\x20loading\x20D3\x20ladder:',_0x3266f4),_0x139868[_0x452692(0xd0)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20colspan=\x228\x22\x20style=\x22text-align:\x20center;\x20color:\x20red;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Error\x20loading\x20D3\x20ladder\x20data:\x20'+_0x3266f4['message']+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';}}function calculateStreakDays(_0x572417){if(!_0x572417)return 0x0;const _0x2bc927=_0x572417['toDate'](),_0x417c4a=new Date(),_0x5af40a=Math['abs'](_0x417c4a-_0x2bc927);return Math['ceil'](_0x5af40a/(0x3e8*0x3c*0x3c*0x18));}async function updatePlayerPositions(_0xf8b80d,_0x72041d){const _0x3c1d04=a31_0xf8206a;try{const _0x3ccbd0=collection(db,_0x3c1d04(0xd1)),_0x1a3689=await getDocs(_0x3ccbd0),_0x210966=[];_0x1a3689['forEach'](_0x26d06e=>{const _0x238632=_0x3c1d04;_0x210966[_0x238632(0xb7)]({'id':_0x26d06e['id'],..._0x26d06e[_0x238632(0xa2)]()});});const _0x5c0381=_0x210966['find'](_0x492e4b=>_0x492e4b[_0x3c1d04(0x9c)]===_0xf8b80d),_0x4800dd=_0x210966['find'](_0x182d08=>_0x182d08[_0x3c1d04(0x9c)]===_0x72041d);if(!_0x5c0381||!_0x4800dd){console['error']('Could\x20not\x20find\x20winner\x20or\x20loser\x20in\x20D3\x20players\x20list');return;}if(_0x5c0381['position']>_0x4800dd['position']){const _0x2f499b=_0x4800dd['position'];for(const _0x2d552c of _0x210966){_0x2d552c[_0x3c1d04(0xa4)]>=_0x4800dd['position']&&_0x2d552c['position']<_0x5c0381[_0x3c1d04(0xa4)]&&_0x2d552c['username']!==_0xf8b80d&&await updateDoc(doc(db,'playersD3',_0x2d552c['id']),{'position':_0x2d552c['position']+0x1});}await updateDoc(doc(db,'playersD3',_0x5c0381['id']),{'position':_0x2f499b});if(_0x2f499b===0x1){const _0x4cda05=doc(db,'playersD3',_0x5c0381['id']),_0x2191d0=await getDoc(_0x4cda05);!_0x2191d0[_0x3c1d04(0xa2)]()['firstPlaceDate']&&await updateDoc(_0x4cda05,{'firstPlaceDate':Timestamp['now']()});}if(_0x4800dd[_0x3c1d04(0xa4)]===0x1){const _0x2ad074=doc(db,'playersD3',_0x4800dd['id']);await updateDoc(_0x2ad074,{'firstPlaceDate':null});}playerCacheD3['timestamp']=0x0;}}catch(_0x2d1b15){console['error']('Error\x20updating\x20D3\x20player\x20positions:',_0x2d1b15);}}async function updateLadderDisplayD3(_0x1b9337){const _0x596dc6=a31_0xf8206a;_0x1b9337['sort']((_0x57c94e,_0x463311)=>_0x57c94e['position']-_0x463311[_0x596dc6(0xa4)]);const _0x7ca447=document['querySelector'](_0x596dc6(0xce));if(!_0x7ca447)return;_0x7ca447[_0x596dc6(0xd0)]='';const _0x17930b=_0x1b9337[_0x596dc6(0x99)](_0x4871bc=>_0x4871bc['username']),_0x85049f=await fetchBatchMatchStatsD3(_0x17930b);let _0x7bd921=new Map();try{typeof clearTokenCache==='function'&&clearTokenCache(),_0x7bd921=await getTokensByUsernames(_0x17930b);}catch(_0x563e53){console[_0x596dc6(0x96)](_0x596dc6(0xae),_0x563e53);}const _0x4e54ad=document['querySelector'](_0x596dc6(0xca));_0x4e54ad&&(_0x4e54ad['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Rank</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Username</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>ELO</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Matches</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Wins</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Losses</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>K/D</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Win\x20Rate</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Points</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20');const _0x213652=_0x1b9337['map'](_0x211e21=>{const _0x24f246=_0x596dc6,_0x4675f4=_0x85049f[_0x24f246(0xa3)](_0x211e21[_0x24f246(0x9c)])||{'totalMatches':0x0,'wins':0x0,'losses':0x0,'kda':0x0,'winRate':0x0,'totalKills':0x0,'totalDeaths':0x0},_0x47d7bd=_0x7bd921['get'](_0x211e21['username'])||[],_0xde41d9=getPrimaryDisplayToken(_0x47d7bd);return createPlayerRowD3(_0x211e21,_0x4675f4,_0xde41d9);})['join']('');_0x7ca447['innerHTML']=_0x213652,getPlayersLastEloChangesD3(_0x17930b)[_0x596dc6(0xa9)](_0x5bd7dc=>{const _0x36c319=_0x596dc6,_0x48c4b3=new Map();_0x7ca447['querySelectorAll']('tr')['forEach']((_0x4b18c1,_0x25f8a7)=>{_0x25f8a7<_0x17930b['length']&&_0x48c4b3['set'](_0x17930b[_0x25f8a7],_0x4b18c1);}),_0x5bd7dc[_0x36c319(0xb8)]((_0x36bca9,_0x244cc2)=>{const _0x718e5b=_0x36c319,_0x630349=_0x48c4b3['get'](_0x244cc2);if(_0x630349&&_0x36bca9!==0x0){const _0x164824=_0x630349[_0x718e5b(0xbb)](_0x718e5b(0xcf));if(_0x164824){const _0x58da1f=_0x36bca9>0x0?'+'+_0x36bca9:''+_0x36bca9,_0x271d6c=_0x164824['querySelector']('.trend-indicator');_0x271d6c&&(_0x271d6c['textContent']=_0x58da1f,_0x271d6c['style'][_0x718e5b(0xb1)]=_0x36bca9>0x0?'#4CAF50':_0x718e5b(0xd2),_0x271d6c['style'][_0x718e5b(0xc2)]='bold',_0x271d6c['style'][_0x718e5b(0xbd)]='0.85em',_0x271d6c['style'][_0x718e5b(0xaf)]=_0x718e5b(0xc4),_0x271d6c[_0x718e5b(0xb5)]['visibility']='visible',_0x271d6c[_0x718e5b(0xb5)][_0x718e5b(0xc5)]='1');}}});})['catch'](_0xfdff2d=>console[_0x596dc6(0x96)]('Error\x20updating\x20D3\x20ELO\x20trend\x20indicators:',_0xfdff2d));}async function fetchBatchMatchStatsD3(_0x417e8b){const _0x1d1796=new Map();try{_0x417e8b['forEach'](_0x569a5b=>{_0x1d1796['set'](_0x569a5b,{'totalMatches':0x0,'wins':0x0,'losses':0x0,'totalKills':0x0,'totalDeaths':0x0,'kda':0x0,'winRate':0x0});});const _0x3786a=collection(db,'approvedMatchesD3'),_0x4e928b=await getDocs(_0x3786a);_0x4e928b['forEach'](_0x2325e9=>{const _0xf73ac=a31_0x5b31,_0x5f4dff=_0x2325e9['data'](),_0x54971e=_0x5f4dff['winnerUsername'],_0x31ab24=_0x5f4dff['loserUsername'];if(_0x417e8b['includes'](_0x54971e)){const _0x207dc0=_0x1d1796[_0xf73ac(0xa3)](_0x54971e);_0x207dc0['wins']++,_0x207dc0[_0xf73ac(0xa1)]++,_0x207dc0[_0xf73ac(0xd5)]+=parseInt(_0x5f4dff['winnerScore'])||0x0,_0x207dc0['totalDeaths']+=parseInt(_0x5f4dff[_0xf73ac(0x9d)])||0x0;}if(_0x417e8b['includes'](_0x31ab24)){const _0x2a248b=_0x1d1796['get'](_0x31ab24);_0x2a248b['losses']++,_0x2a248b['totalMatches']++,_0x2a248b['totalKills']+=parseInt(_0x5f4dff[_0xf73ac(0x9d)])||0x0,_0x2a248b[_0xf73ac(0xba)]+=parseInt(_0x5f4dff['winnerScore'])||0x0;}}),_0x417e8b['forEach'](_0x16e09b=>{const _0x32b008=a31_0x5b31,_0x213914=_0x1d1796['get'](_0x16e09b);_0x213914['kda']=_0x213914['totalDeaths']>0x0?(_0x213914['totalKills']/_0x213914[_0x32b008(0xba)])[_0x32b008(0xc9)](0x2):_0x213914['totalKills'],_0x213914[_0x32b008(0xaa)]=_0x213914['totalMatches']>0x0?(_0x213914['wins']/_0x213914['totalMatches']*0x64)[_0x32b008(0xc9)](0x1):0x0;});}catch(_0x576c97){console['error']('Error\x20fetching\x20batch\x20match\x20stats\x20for\x20D3:',_0x576c97);}return _0x1d1796;}function createPlayerRowD3(_0x487118,_0x406d19,_0xe1353e){const _0xe000d7=a31_0xf8206a,_0x46a7a6=parseFloat(_0x487118['elo'])||0x0;let _0x46c0bf='#DC143C';if(_0x406d19[_0xe000d7(0xa1)]===0x0)_0x46c0bf='#DC143C';else{if(_0x46a7a6>=0x3e8&&_0x406d19[_0xe000d7(0xaa)]>=0x50&&_0x406d19['totalMatches']>=0x14)_0x46c0bf='#50C878';else{if(_0x46a7a6>=0x2bc)_0x46c0bf='#FFD700';else{if(_0x46a7a6>=0x1f4)_0x46c0bf=_0xe000d7(0x97);else _0x46a7a6>=0xc8&&(_0x46c0bf='#CD7F32');}}}let _0x5e30ff='';_0x487118['country']&&(_0x5e30ff=_0xe000d7(0xc6)+_0x487118[_0xe000d7(0xbc)]['toLowerCase']()+'.png\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20alt=\x22'+_0x487118['country']+'\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20class=\x22player-flag\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20style=\x22margin-left:\x205px;\x20vertical-align:\x20middle;\x20width:\x2020px;\x20height:\x20auto;\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20onerror=\x22this.style.display=\x27none\x27\x22>');let _0x4f8989='';return _0xe1353e&&(_0x4f8989='<img\x20src=\x22'+_0xe1353e['tokenImage']+'\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20alt=\x22'+_0xe1353e['tokenName']+'\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20class=\x22player-token\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20title=\x22'+_0xe1353e['tokenName']+'\x20'+(_0xe1353e['equipped']?_0xe000d7(0xb6):'')+'\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20style=\x22width:\x2035px;\x20height:\x2035px;\x20margin-left:\x205px;\x20vertical-align:\x20middle;\x20object-fit:\x20contain;\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20onerror=\x22this.style.display=\x27none\x27\x22>'),'\x0a\x20\x20\x20\x20<tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+_0x487118['position']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td\x20style=\x22position:\x20relative;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20position:\x20relative;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username='+encodeURIComponent(_0x487118['username'])+'&ladder=d3\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20style=\x22color:\x20'+_0x46c0bf+';\x20text-decoration:\x20none;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x487118[_0xe000d7(0x9c)]+_0xe000d7(0xa0)+_0x5e30ff+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x4f8989+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td\x20style=\x22color:\x20'+_0x46c0bf+_0xe000d7(0xa7)+_0x46a7a6+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22trend-indicator\x22\x20style=\x22margin-left:\x205px;\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+_0x406d19[_0xe000d7(0xa1)]+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+_0x406d19['wins']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+_0x406d19[_0xe000d7(0x9b)]+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+_0x406d19['kda']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+_0x406d19['winRate']+_0xe000d7(0xcc)+(_0x487118[_0xe000d7(0x9f)]||0x0)+_0xe000d7(0xc7);}async function getPlayersLastEloChangesD3(_0xa66140){const _0x8ece7d=a31_0xf8206a,_0xfe851=new Map();_0xa66140['forEach'](_0x767231=>_0xfe851['set'](_0x767231,0x0));try{const _0x16c6a1=new Map(),_0x387bb4=await getDocs(collection(db,_0x8ece7d(0xd1)));_0x387bb4[_0x8ece7d(0xb8)](_0x431a42=>{const _0x54d886=_0x8ece7d,_0x106dd1=_0x431a42['data']();_0x106dd1[_0x54d886(0x9c)]&&_0x16c6a1['set'](_0x431a42['id'],_0x106dd1['username']);});const _0x5871a0=collection(db,'eloHistoryD3'),_0x1971d6=query(_0x5871a0,orderBy('timestamp',_0x8ece7d(0xc0)),limit(0x64)),_0x19e99c=await getDocs(_0x1971d6),_0x353caa=new Map();_0x19e99c['forEach'](_0x3160b3=>{const _0xaa511=_0x8ece7d,_0xa1264=_0x3160b3['data']();let _0x4a6df6=null;if(_0xa1264['username'])_0x4a6df6=_0xa1264['username'];else{if(_0xa1264['playerUsername'])_0x4a6df6=_0xa1264['playerUsername'];else{if(_0xa1264['player']&&typeof _0xa1264['player']===_0xaa511(0xac))_0x4a6df6=_0xa1264['player'];else{if(_0xa1264['player']&&_0x16c6a1['has'](_0xa1264['player']))_0x4a6df6=_0x16c6a1['get'](_0xa1264[_0xaa511(0xb9)]);else _0xa1264['playerId']&&_0x16c6a1['has'](_0xa1264['playerId'])&&(_0x4a6df6=_0x16c6a1[_0xaa511(0xa3)](_0xa1264['playerId']));}}}_0x4a6df6&&_0xa66140['includes'](_0x4a6df6)&&(!_0x353caa['has'](_0x4a6df6)&&_0x353caa[_0xaa511(0xc1)](_0x4a6df6,[]),_0x353caa[_0xaa511(0xa3)](_0x4a6df6)['push']({..._0xa1264,'timestamp':_0xa1264['timestamp']?.[_0xaa511(0x9e)]||0x0}));}),_0x353caa[_0x8ece7d(0xb8)]((_0x55f08c,_0x5b7c26)=>{const _0x548e6f=_0x8ece7d;if(_0x55f08c[_0x548e6f(0x9a)]>0x0){_0x55f08c['sort']((_0xf868be,_0x4524ea)=>_0x4524ea[_0x548e6f(0xcd)]-_0xf868be['timestamp']);const _0x4d3334=_0x55f08c['find'](_0x584658=>_0x584658[_0x548e6f(0xb0)]!==undefined||_0x584658[_0x548e6f(0xb3)]!==undefined&&_0x584658['previousElo']!==undefined);if(_0x4d3334){let _0x6f3d4;if(_0x4d3334['change']!==undefined)_0x6f3d4=_0x4d3334['change'];else _0x4d3334['newElo']!==undefined&&_0x4d3334[_0x548e6f(0xbe)]!==undefined&&(_0x6f3d4=_0x4d3334['newElo']-_0x4d3334[_0x548e6f(0xbe)]);_0x6f3d4!==undefined&&_0xfe851['set'](_0x5b7c26,_0x6f3d4);}}});if(_0x353caa['size']===0x0){const _0xe7d720=collection(db,'eloHistory'),_0xea79c1=query(_0xe7d720,where(_0x8ece7d(0xa8),'==','D3'),orderBy(_0x8ece7d(0xcd),'desc'),limit(0x32));try{const _0x4da51c=await getDocs(_0xea79c1);_0x4da51c['forEach'](_0xac0fc9=>{const _0x33da0b=_0x8ece7d,_0x2feb29=_0xac0fc9['data']();let _0x287942=_0x2feb29[_0x33da0b(0x9c)]||_0x2feb29[_0x33da0b(0xab)];!_0x287942&&_0x2feb29[_0x33da0b(0xb9)]&&_0x16c6a1['has'](_0x2feb29[_0x33da0b(0xb9)])&&(_0x287942=_0x16c6a1[_0x33da0b(0xa3)](_0x2feb29['player']));if(_0x287942&&_0xa66140['includes'](_0x287942)){const _0x110310=_0x2feb29[_0x33da0b(0xb0)]||(_0x2feb29['newElo']!==undefined&&_0x2feb29['previousElo']!==undefined?_0x2feb29['newElo']-_0x2feb29['previousElo']:0x0);_0x110310!==0x0&&_0xfe851['set'](_0x287942,_0x110310);}});}catch(_0x535e24){console['error']('D3:\x20Fallback\x20query\x20failed:',_0x535e24);}}}catch(_0x308a7b){console[_0x8ece7d(0x96)](_0x8ece7d(0xbf),_0x308a7b);}return _0xfe851;}window['refreshLadderDisplayD3']=function(_0x16e48f=!![]){const _0x306488=a31_0xf8206a;typeof displayLadderD3===_0x306488(0xad)?displayLadderD3(_0x16e48f):console['warn'](_0x306488(0xd3));};function a31_0x5b31(_0x4bc927,_0xf7d81b){const _0x1a6998=a31_0xc30c();return a31_0x5b31=function(_0x44507f,_0x226008){_0x44507f=_0x44507f-0x96;let _0xc30c7f=_0x1a6998[_0x44507f];return _0xc30c7f;},a31_0x5b31(_0x4bc927,_0xf7d81b);}export{displayLadderD3,updatePlayerPositions};
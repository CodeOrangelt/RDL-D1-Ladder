const a12_0x8e2c0e=a12_0x555f,a12_0x8a2b06=(function(){let _0x411085=!![];return function(_0x379b36,_0x125875){const _0x409894=_0x411085?function(){const _0x2f5e4a=a12_0x555f;if(_0x125875){const _0x8e6a8a=_0x125875[_0x2f5e4a(0xff)](_0x379b36,arguments);return _0x125875=null,_0x8e6a8a;}}:function(){};return _0x411085=![],_0x409894;};}()),a12_0x373f6c=a12_0x8a2b06(this,function(){const _0x5b7a4f=a12_0x555f;let _0xca15d5;try{const _0x3e5832=Function(_0x5b7a4f(0xe1)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0xca15d5=_0x3e5832();}catch(_0x484b27){_0xca15d5=window;}const _0x70ceab=_0xca15d5[_0x5b7a4f(0xfa)]=_0xca15d5[_0x5b7a4f(0xfa)]||{},_0x108c50=['log','warn',_0x5b7a4f(0xf4),_0x5b7a4f(0xf5),'exception','table',_0x5b7a4f(0xfe)];for(let _0x5e5d88=0x0;_0x5e5d88<_0x108c50['length'];_0x5e5d88++){const _0x32c7d1=a12_0x8a2b06[_0x5b7a4f(0x104)][_0x5b7a4f(0x10b)]['bind'](a12_0x8a2b06),_0x18a89f=_0x108c50[_0x5e5d88],_0x3ba9d3=_0x70ceab[_0x18a89f]||_0x32c7d1;_0x32c7d1['__proto__']=a12_0x8a2b06['bind'](a12_0x8a2b06),_0x32c7d1['toString']=_0x3ba9d3[_0x5b7a4f(0x10a)][_0x5b7a4f(0xe7)](_0x3ba9d3),_0x70ceab[_0x18a89f]=_0x32c7d1;}});a12_0x373f6c();function a12_0x555f(_0x5d02cc,_0x24aa5f){const _0x373f6c=a12_0x2f81();return a12_0x555f=function(_0x8a2b06,_0x1711d3){_0x8a2b06=_0x8a2b06-0xe1;let _0x2f81c1=_0x373f6c[_0x8a2b06];return _0x2f81c1;},a12_0x555f(_0x5d02cc,_0x24aa5f);}function a12_0x2f81(){const _0x5be286=['return\x20(function()\x20','pending','uid','userProfiles','style','catch','bind','split','isAdmin','players','gameInvitations','charAt','toUpperCase','\x20by\x20UID:','preventDefault','display','pendingCount','email','includes','info','error','log','playersCTF','inline-block','.admin-only','console','lastChecked','visibilitychange','forEach','trace','apply','checkInterval','hasCheckedCollections','inbox-notification','now','constructor','none','playersD3','toLowerCase','admin@ladder.com','exists','toString','prototype','logout-link','username','getElementById','</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username=','map','querySelectorAll','role','then','Error\x20checking\x20','currentUser'];a12_0x2f81=function(){return _0x5be286;};return a12_0x2f81();}import{getAuth,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{doc,getDoc,collection,query,where,getDocs,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import{isAdmin}from'./admin-check.js';const ADMIN_EMAILS=[a12_0x8e2c0e(0x108),'Brian2af@outlook.com'],userCache={'uid':null,'username':null,'isAdmin':![],'hasCheckedCollections':![],'lastChecked':0x0,'role':null},invitationCache={'lastCheck':0x0,'pendingCount':0x0,'checkInterval':0x493e0};function updateInboxNotification(_0x12ea29){const _0x55e352=a12_0x8e2c0e,_0x2195b4=document[_0x55e352(0x10e)](_0x55e352(0x102));_0x2195b4&&(_0x12ea29>0x0?(_0x2195b4['style']['display']=_0x55e352(0xf8),_0x2195b4['textContent']=_0x12ea29>0x9?'9+':_0x12ea29):_0x2195b4['style']['display']=_0x55e352(0x105));}async function checkPendingInvitationsForCurrentUser(_0x2edabe){const _0x5569f2=a12_0x8e2c0e;try{const _0x3e1018=Date[_0x5569f2(0x103)]();if(_0x3e1018-invitationCache['lastCheck']<invitationCache[_0x5569f2(0x100)])return updateInboxNotification(invitationCache['pendingCount']),invitationCache[_0x5569f2(0xf1)];invitationCache['lastCheck']=_0x3e1018;const _0x38c67c=collection(db,_0x5569f2(0xeb)),_0x5b7e74=query(_0x38c67c,where('toUserId','==',_0x2edabe),where('status','==',_0x5569f2(0xe2)),limit(0x5)),_0x55fc62=await getDocs(_0x5b7e74),_0x510b04=_0x55fc62['size'];return invitationCache['pendingCount']=_0x510b04,updateInboxNotification(_0x510b04),_0x510b04;}catch(_0x243ea9){return console['warn']('Could\x20not\x20check\x20pending\x20invitations\x20for\x20current\x20user:',_0x243ea9),0x0;}}function updateAuthSectionImmediate(_0xe54468,_0x495d31=![]){const _0x265f0d=a12_0x8e2c0e,_0x42d578=document['getElementById']('auth-section');if(!_0x42d578)return;if(_0xe54468&&_0x495d31)document[_0x265f0d(0x111)](_0x265f0d(0xf9))[_0x265f0d(0xfd)](_0x2eb516=>{const _0x4efa21=_0x265f0d;_0x2eb516[_0x4efa21(0xe5)]['display']='block';});else!_0xe54468&&document['querySelectorAll'](_0x265f0d(0xf9))['forEach'](_0x3f174b=>{const _0x2bda55=_0x265f0d;_0x3f174b['style'][_0x2bda55(0xf0)]='none';});if(_0xe54468){const _0x49cc86=userCache['username']||(_0xe54468['email']?_0xe54468[_0x265f0d(0xf2)][_0x265f0d(0xe8)]('@')[0x0]:'User'),_0x5a3c31=userCache['role']?'\x20('+userCache['role']+')':_0x495d31?'\x20(Admin)':'';_0x42d578['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20class=\x22nav-username\x22>'+_0x49cc86+_0x5a3c31+_0x265f0d(0x10f)+encodeURIComponent(_0x49cc86)+'\x22>Profile</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./inbox.html\x22\x20class=\x22nav-notification\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Inbox\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22inbox-notification\x22\x20class=\x22notification-dot\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22members.html\x22>Members</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./redeem.html\x22><i\x20class=\x22fas\x20fa-gift\x22></i>\x20Redeem</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20id=\x22logout-link\x22>Sign\x20Out</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';const _0x1da65f=document[_0x265f0d(0x10e)](_0x265f0d(0x10c));_0x1da65f&&_0x1da65f['addEventListener']('click',_0x3cc9c2=>{const _0x2967cf=_0x265f0d;_0x3cc9c2[_0x2967cf(0xef)]();const _0x4a81af=getAuth();updateAuthSectionImmediate(null),_0x4a81af['signOut']()['catch'](_0x5e6c2e=>{console['error']('Error\x20signing\x20out:',_0x5e6c2e);});}),_0xe54468[_0x265f0d(0xe3)]&&setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0xe54468['uid']);},0x3e8);}else _0x42d578['innerHTML']='<a\x20href=\x22login.html\x22\x20class=\x22login-link\x22>Login</a>';}async function checkAdminRoles(_0x4d23ed){const _0x1129af=a12_0x8e2c0e;if(!_0x4d23ed||!_0x4d23ed[_0x1129af(0xf2)])return{'isAdmin':![],'role':null};try{console['log']('Checking\x20roles\x20for\x20user:\x20'+_0x4d23ed['email']);const _0x278fe2=[_0x1129af(0xea),'playersD2','playersD3','nonParticipants','userProfiles'],_0x4d5c37=['council','creative\x20lead','owner','admin'];for(const _0x208250 of _0x278fe2){try{const _0x487660=doc(db,_0x208250,_0x4d23ed['uid']),_0x3225d5=await getDoc(_0x487660);if(_0x3225d5['exists']()){const _0x5a195a=_0x3225d5['data']();console['log']('Found\x20user\x20in\x20'+_0x208250+'\x20by\x20UID:',_0x5a195a);let _0x317cbf=(_0x5a195a['roleName']||_0x5a195a[_0x1129af(0x112)]||'')['toLowerCase'](),_0x346351=_0x5a195a['roleName']||_0x5a195a[_0x1129af(0x112)]||'';if(_0x317cbf&&_0x4d5c37[_0x1129af(0xf3)](_0x317cbf)){console['log']('Found\x20admin\x20role:\x20'+_0x317cbf+'\x20in\x20'+_0x208250);const _0xcb2b51=_0x346351['split']('\x20')[_0x1129af(0x110)](_0x2f90be=>_0x2f90be['charAt'](0x0)[_0x1129af(0xed)]()+_0x2f90be['slice'](0x1)['toLowerCase']())['join']('\x20');return{'isAdmin':!![],'role':_0xcb2b51};}}}catch(_0x28eac0){console['error'](_0x1129af(0x114)+_0x208250+_0x1129af(0xee),_0x28eac0);}}for(const _0x4760b3 of _0x278fe2){try{const _0x472f21=collection(db,_0x4760b3);let _0x8fffff=query(_0x472f21,where('email','==',_0x4d23ed['email'])),_0x24fd4d=await getDocs(_0x8fffff);_0x24fd4d['empty']&&(_0x8fffff=query(_0x472f21,where(_0x1129af(0xf2),'==',_0x4d23ed['email']['toLowerCase']())),_0x24fd4d=await getDocs(_0x8fffff));if(!_0x24fd4d['empty']){const _0x46125c=_0x24fd4d['docs'][0x0]['data']();console[_0x1129af(0xf6)]('Found\x20user\x20in\x20'+_0x4760b3+'\x20by\x20email:',_0x46125c);let _0x88705e=(_0x46125c['roleName']||_0x46125c['role']||'')['toLowerCase'](),_0x5e130f=_0x46125c['roleName']||_0x46125c['role']||'';if(_0x88705e&&_0x4d5c37['includes'](_0x88705e)){console[_0x1129af(0xf6)]('Found\x20admin\x20role:\x20'+_0x88705e+'\x20in\x20'+_0x4760b3);const _0x5bdcfc=_0x5e130f[_0x1129af(0xe8)]('\x20')['map'](_0x424bd2=>_0x424bd2[_0x1129af(0xec)](0x0)['toUpperCase']()+_0x424bd2['slice'](0x1)[_0x1129af(0x107)]())['join']('\x20');return{'isAdmin':!![],'role':_0x5bdcfc};}}}catch(_0x3306d5){console['error'](_0x1129af(0x114)+_0x4760b3+'\x20by\x20email:',_0x3306d5);}}return console['log']('No\x20admin\x20roles\x20found\x20for\x20user'),{'isAdmin':![],'role':null};}catch(_0x5b1349){return console['error']('Error\x20in\x20checkAdminRoles:',_0x5b1349),{'isAdmin':![],'role':null};}}async function updateAuthSection(_0x30192e){const _0x446729=a12_0x8e2c0e,_0x59d4e2=_0x30192e&&isAdmin(_0x30192e['email']);updateAuthSectionImmediate(_0x30192e,_0x59d4e2);if(!_0x30192e){userCache['uid']=null,userCache['username']=null,userCache['isAdmin']=![],userCache['hasCheckedCollections']=![],userCache[_0x446729(0x112)]=null;return;}const _0x218966=Date['now']();if(_0x30192e['uid']===userCache[_0x446729(0xe3)]&&userCache['hasCheckedCollections']&&_0x218966-userCache[_0x446729(0xfb)]<0x493e0)return;try{userCache['uid']=_0x30192e['uid'],userCache[_0x446729(0xfb)]=_0x218966;const _0x29710e=isAdmin(_0x30192e[_0x446729(0xf2)]);userCache['isAdmin']=_0x29710e;if(!_0x29710e){const {isAdmin:_0x389406,role:_0x73bd04}=await checkAdminRoles(_0x30192e);userCache[_0x446729(0xe9)]=_0x389406,userCache['role']=_0x73bd04,_0x389406&&(document[_0x446729(0x111)](_0x446729(0xf9))['forEach'](_0x1c3351=>{const _0x506dd4=_0x446729;_0x1c3351['style'][_0x506dd4(0xf0)]='block';}),updateAuthSectionImmediate(_0x30192e,!![]));}const _0x29a7f1=[_0x446729(0xea),'playersD2',_0x446729(0x106),'playersDuos',_0x446729(0xf7),'nonParticipants',_0x446729(0xe4)],_0x249705=_0x29a7f1['map'](_0x2de715=>getDoc(doc(db,_0x2de715,_0x30192e[_0x446729(0xe3)]))[_0x446729(0x113)](_0x417461=>_0x417461[_0x446729(0x109)]()?{'collection':_0x2de715,'data':_0x417461['data']()}:null)[_0x446729(0xe6)](()=>null)),_0x7c9e7f=await Promise['all'](_0x249705),_0xc0e9b3=_0x7c9e7f['filter'](_0x46fc08=>_0x46fc08!==null);let _0x3e8e63=null;for(const _0x3684e4 of _0xc0e9b3){if(_0x3684e4['data'][_0x446729(0x10d)]){_0x3e8e63=_0x3684e4['data']['username'];break;}}userCache[_0x446729(0x10d)]=_0x3e8e63||(_0x30192e['email']?_0x30192e[_0x446729(0xf2)]['split']('@')[0x0]:'User'),userCache[_0x446729(0x101)]=!![],updateAuthSectionImmediate(_0x30192e,userCache['isAdmin']),setTimeout(()=>{const _0x344da8=_0x446729;checkPendingInvitationsForCurrentUser(_0x30192e[_0x344da8(0xe3)]);},0x1f4);}catch(_0x18be4f){console[_0x446729(0xf5)]('Error\x20in\x20full\x20auth\x20update:',_0x18be4f);}}document['addEventListener']('DOMContentLoaded',()=>{const _0x109afc=a12_0x8e2c0e,_0x51fdc3=getAuth();onAuthStateChanged(_0x51fdc3,async _0x42ad61=>{await updateAuthSection(_0x42ad61),_0x42ad61&&checkPendingInvitationsForCurrentUser(_0x42ad61['uid']);}),document['addEventListener'](_0x109afc(0xfc),()=>{!document['hidden']&&_0x51fdc3['currentUser']&&checkPendingInvitationsForCurrentUser(_0x51fdc3['currentUser']['uid']);}),document['addEventListener']('click',_0x552c6d=>{const _0x55a58f=_0x109afc;_0x552c6d['target']['closest']('a[href]')&&_0x51fdc3[_0x55a58f(0x115)]&&checkPendingInvitationsForCurrentUser(_0x51fdc3['currentUser'][_0x55a58f(0xe3)]);});});export{updateAuthSection};
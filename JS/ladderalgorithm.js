(function(_0x4969f8,_0x3ae370){const _0x24a4e6=a30_0x316d,_0x4ad5c5=_0x4969f8();while(!![]){try{const _0x4d3ffa=parseInt(_0x24a4e6(0x103))/0x1*(-parseInt(_0x24a4e6(0x104))/0x2)+parseInt(_0x24a4e6(0xd5))/0x3+-parseInt(_0x24a4e6(0xdd))/0x4+-parseInt(_0x24a4e6(0xe3))/0x5+parseInt(_0x24a4e6(0xfd))/0x6+-parseInt(_0x24a4e6(0xe6))/0x7*(parseInt(_0x24a4e6(0xd9))/0x8)+-parseInt(_0x24a4e6(0xcb))/0x9*(-parseInt(_0x24a4e6(0x106))/0xa);if(_0x4d3ffa===_0x3ae370)break;else _0x4ad5c5['push'](_0x4ad5c5['shift']());}catch(_0x28f69b){_0x4ad5c5['push'](_0x4ad5c5['shift']());}}}(a30_0x2255,0xcf669));const a30_0x3263db=(function(){let _0x30a666=!![];return function(_0x472901,_0x120464){const _0x4d00b6=_0x30a666?function(){if(_0x120464){const _0x4d47c7=_0x120464['apply'](_0x472901,arguments);return _0x120464=null,_0x4d47c7;}}:function(){};return _0x30a666=![],_0x4d00b6;};}()),a30_0x3246e8=a30_0x3263db(this,function(){const _0x7e71d9=a30_0x316d;return a30_0x3246e8[_0x7e71d9(0xfc)]()['search']('(((.+)+)+)+$')[_0x7e71d9(0xfc)]()[_0x7e71d9(0xcd)](a30_0x3246e8)[_0x7e71d9(0x107)]('(((.+)+)+)+$');});a30_0x3246e8();const a30_0x101218=(function(){let _0x13a1c7=!![];return function(_0x549ec5,_0x234c84){const _0x1618b8=_0x13a1c7?function(){const _0x4863b1=a30_0x316d;if(_0x234c84){const _0x2ad2ae=_0x234c84[_0x4863b1(0xe0)](_0x549ec5,arguments);return _0x234c84=null,_0x2ad2ae;}}:function(){};return _0x13a1c7=![],_0x1618b8;};}()),a30_0x43281b=a30_0x101218(this,function(){const _0x4ebc46=a30_0x316d;let _0x134421;try{const _0x9dd46b=Function(_0x4ebc46(0xf0)+_0x4ebc46(0xc7)+');');_0x134421=_0x9dd46b();}catch(_0x2c8896){_0x134421=window;}const _0xfb6a52=_0x134421[_0x4ebc46(0xed)]=_0x134421['console']||{},_0x57b410=['log',_0x4ebc46(0xe2),_0x4ebc46(0xca),_0x4ebc46(0xfa),_0x4ebc46(0xc8),'table',_0x4ebc46(0xf7)];for(let _0x13ee28=0x0;_0x13ee28<_0x57b410['length'];_0x13ee28++){const _0x40230a=a30_0x101218[_0x4ebc46(0xcd)][_0x4ebc46(0xda)]['bind'](a30_0x101218),_0x5a9dad=_0x57b410[_0x13ee28],_0x1e19d7=_0xfb6a52[_0x5a9dad]||_0x40230a;_0x40230a[_0x4ebc46(0xc9)]=a30_0x101218['bind'](a30_0x101218),_0x40230a[_0x4ebc46(0xfc)]=_0x1e19d7['toString'][_0x4ebc46(0xd3)](_0x1e19d7),_0xfb6a52[_0x5a9dad]=_0x40230a;}});a30_0x43281b();import{collection,doc,getDoc,getDocs,updateDoc,setDoc,deleteDoc,writeBatch,query,where,serverTimestamp,addDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';import{recordEloChange}from'./elo-history.js';import{promotionManager,checkAndRecordPromotion}from'./promotions.js';import{isAdmin}from'./admin-check.js';function a30_0x2255(){const _0x4379e3=['username','error','match','toString','3709416Ihxuya','ELO\x20ratings\x20updated\x20successfully','Match\x20successfully\x20approved\x20and\x20ELO\x20updated','all','win','Could\x20not\x20find\x20player\x20documents','1400405oHoClt','2YvsuZz','winnerScore','4372460XTmyqQ','search','totalDeaths','eloRating','log','currentUser','{}.constructor(\x22return\x20this\x22)(\x20)','exception','__proto__','info','45xbswDr','loss','constructor','round','winnerUsername','update','doc','losses','bind','players','3446808rSZfIz','toISOString','empty','exists','13672xhMbBg','prototype','approvedMatches','wins','2160612cSeFaG','Report\x20not\x20found','loserUsername','apply','loserScore','warn','4107655ALSDXz','playerStats','winRate','1400DQQaNP','position','checkAndRecordPromotion','Error\x20in\x20updateEloRatings:','ELO\x20ratings\x20and\x20positions\x20updated\x20successfully','Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked','data','console','then','One\x20or\x20both\x20players\x20not\x20found','return\x20(function()\x20','pendingMatches','totalKills','Error\x20approving\x20report:','Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions','Match\x20moved\x20to\x20approved\x20collection','MAX_SAFE_INTEGER','trace','docs'];a30_0x2255=function(){return _0x4379e3;};return a30_0x2255();}function a30_0x316d(_0x1c002c,_0x2ba7b1){const _0x338fbf=a30_0x2255();return a30_0x316d=function(_0x43281b,_0x101218){_0x43281b=_0x43281b-0xc4;let _0x17fd53=_0x338fbf[_0x43281b];return _0x17fd53;},a30_0x316d(_0x1c002c,_0x2ba7b1);}export function calculateElo(_0x5a30ab,_0x29e745,_0x44939f=0x20){const _0x2fd7e7=a30_0x316d,_0x209c35=0x1/(0x1+Math['pow'](0xa,(_0x29e745-_0x5a30ab)/0x190)),_0x3fe382=0x1/(0x1+Math['pow'](0xa,(_0x5a30ab-_0x29e745)/0x190)),_0x1c44d5=_0x5a30ab+_0x44939f*(0x1-_0x209c35),_0x5aa192=_0x29e745+_0x44939f*(0x0-_0x3fe382);return{'newWinnerRating':Math[_0x2fd7e7(0xce)](_0x1c44d5),'newLoserRating':Math[_0x2fd7e7(0xce)](_0x5aa192)};}export function assignDefaultEloRating(_0x5f451d,_0x5e7c3d){const _0x1ddd17=a30_0x316d,_0x179bd0=0x4b0;!_0x5e7c3d[_0x1ddd17(0xc4)]&&db['collection'](_0x1ddd17(0xd4))[_0x1ddd17(0xd1)](_0x5f451d)[_0x1ddd17(0xd0)]({'eloRating':_0x179bd0})[_0x1ddd17(0xee)](()=>{const _0x4d4667=_0x1ddd17;console[_0x4d4667(0xc5)]('Assigned\x20default\x20ELO\x20rating\x20to\x20player\x20'+_0x5e7c3d[_0x4d4667(0xf9)]);})['catch'](_0x2d4b2b=>{const _0x4e9e91=_0x1ddd17;console[_0x4e9e91(0xfa)]('Error\x20assigning\x20default\x20ELO\x20rating:',_0x2d4b2b);});}export async function updateEloRatings(_0x941a0c,_0xacf373,_0x14930a){const _0x41478e=a30_0x316d;try{const _0x340865=writeBatch(db),_0x3297d0=doc(db,'players',_0x941a0c),_0x2d6adc=doc(db,'players',_0xacf373),[_0x592073,_0x58c0db]=await Promise[_0x41478e(0x100)]([getDoc(_0x3297d0),getDoc(_0x2d6adc)]);if(!_0x592073[_0x41478e(0xd8)]()||!_0x58c0db[_0x41478e(0xd8)]())throw new Error(_0x41478e(0xef));const _0x546ee1=_0x592073['data'](),_0x30415c=_0x58c0db[_0x41478e(0xec)](),_0x204ca0=_0x546ee1[_0x41478e(0xe7)]||Number[_0x41478e(0xf6)],_0x3a3380=_0x30415c['position']||Number[_0x41478e(0xf6)],{newWinnerRating:_0x5b7bff,newLoserRating:_0x2b9822}=calculateElo(_0x546ee1[_0x41478e(0xc4)]||0x4b0,_0x30415c[_0x41478e(0xc4)]||0x4b0);let _0xcc466e=_0x204ca0,_0x309d53=_0x3a3380;if(_0x204ca0>_0x3a3380){console[_0x41478e(0xc5)](_0x41478e(0xeb)),_0xcc466e=_0x3a3380,_0x309d53=_0x3a3380+0x1;const _0x24f75f=query(collection(db,_0x41478e(0xd4)),where(_0x41478e(0xe7),'>',_0x3a3380),where(_0x41478e(0xe7),'<',_0x204ca0)),_0x3ba0b0=await getDocs(_0x24f75f);for(const _0x5ad9e8 of _0x3ba0b0[_0x41478e(0xf8)]){_0x5ad9e8['id']!==_0x941a0c&&_0x5ad9e8['id']!==_0xacf373&&_0x340865['update'](doc(db,_0x41478e(0xd4),_0x5ad9e8['id']),{'position':_0x5ad9e8[_0x41478e(0xec)]()[_0x41478e(0xe7)]+0x1});}}else console[_0x41478e(0xc5)](_0x41478e(0xf4));const _0x19e7e2={'eloRating':_0x5b7bff,'lastMatchDate':serverTimestamp(),'position':_0xcc466e,'lastMatchId':_0x14930a},_0x2f4ac7={'eloRating':_0x2b9822,'lastMatchDate':serverTimestamp(),'position':_0x309d53,'lastMatchId':_0x14930a};return _0x340865[_0x41478e(0xd0)](_0x3297d0,_0x19e7e2),_0x340865[_0x41478e(0xd0)](_0x2d6adc,_0x2f4ac7),await _0x340865['commit'](),console['log'](_0x41478e(0xfe)),await Promise[_0x41478e(0x100)]([recordEloChange({'playerId':_0x941a0c,'previousElo':_0x546ee1[_0x41478e(0xc4)]||0x4b0,'newElo':_0x5b7bff,'opponentId':_0xacf373,'matchResult':_0x41478e(0x101),'previousPosition':_0x204ca0,'newPosition':_0xcc466e,'isPromotion':_0xcc466e<_0x204ca0,'matchId':_0x14930a,'timestamp':serverTimestamp()}),recordEloChange({'playerId':_0xacf373,'previousElo':_0x30415c[_0x41478e(0xc4)]||0x4b0,'newElo':_0x2b9822,'opponentId':_0x941a0c,'matchResult':_0x41478e(0xcc),'previousPosition':_0x3a3380,'newPosition':_0x309d53,'isDemotion':_0x309d53>_0x3a3380,'matchId':_0x14930a,'timestamp':serverTimestamp()})]),await promotionManager[_0x41478e(0xe8)](_0x941a0c,_0x5b7bff,_0x546ee1[_0x41478e(0xc4)],{'source':_0x41478e(0xfb),'matchId':_0x14930a}),await promotionManager[_0x41478e(0xe8)](_0xacf373,_0x2b9822,_0x30415c[_0x41478e(0xc4)],{'source':_0x41478e(0xfb),'matchId':_0x14930a}),console[_0x41478e(0xc5)](_0x41478e(0xea)),!![];}catch(_0x49895d){console[_0x41478e(0xfa)](_0x41478e(0xe9),_0x49895d);throw _0x49895d;}}export async function approveReport(_0x42e1e8,_0x1ae516,_0x33ca13,_0x54786b,_0xdb6ac5){const _0x88df75=a30_0x316d;try{const _0x142e19=doc(db,_0x88df75(0xf1),_0x42e1e8),_0x1aac01=await getDoc(_0x142e19);if(!_0x1aac01[_0x88df75(0xd8)]())throw new Error(_0x88df75(0xde));const _0x30cfef=_0x1aac01['data'](),_0x17d2bf={..._0x30cfef,'winnerScore':_0x1ae516,'winnerSuicides':_0x33ca13,'winnerComment':_0x54786b,'winnerDemoLink':_0xdb6ac5,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':auth[_0x88df75(0xc6)]['uid']};await setDoc(doc(db,_0x88df75(0xdb),_0x42e1e8),_0x17d2bf),await deleteDoc(_0x142e19),console['log'](_0x88df75(0xf5));const [_0x1f4774,_0x345c97]=await Promise[_0x88df75(0x100)]([getDocs(query(collection(db,_0x88df75(0xd4)),where(_0x88df75(0xf9),'==',_0x30cfef[_0x88df75(0xcf)]))),getDocs(query(collection(db,_0x88df75(0xd4)),where(_0x88df75(0xf9),'==',_0x30cfef[_0x88df75(0xdf)])))]);if(_0x1f4774[_0x88df75(0xd7)]||_0x345c97[_0x88df75(0xd7)])throw new Error(_0x88df75(0x102));const _0x3549cc=_0x1f4774['docs'][0x0]['id'],_0x381f51=_0x345c97[_0x88df75(0xf8)][0x0]['id'];return await updateEloRatings(_0x3549cc,_0x381f51,_0x42e1e8),console[_0x88df75(0xc5)](_0x88df75(0xff)),!![];}catch(_0x3d5b27){console[_0x88df75(0xfa)](_0x88df75(0xf3),_0x3d5b27);throw _0x3d5b27;}}async function updatePlayerElo(_0x3b2918,_0x58d0ca,_0x43a1f7){const _0x2aaf6d=a30_0x316d;await setDoc(doc(db,_0x2aaf6d(0xd4),_0x3b2918),{...playerData,'eloRating':_0x43a1f7}),await checkAndRecordPromotion(_0x3b2918,_0x43a1f7,_0x58d0ca);}async function updatePlayerStats(_0x23d1f3,_0x323438,_0x2391f1){const _0x516afb=a30_0x316d,_0x3a6b6e=doc(db,_0x516afb(0xe4),_0x23d1f3),_0x4070f1=await getDoc(_0x3a6b6e);let _0xee3cd5=_0x4070f1['exists']()?_0x4070f1[_0x516afb(0xec)]():{'wins':0x0,'losses':0x0,'totalKills':0x0,'totalDeaths':0x0,'winRate':0x0};_0x2391f1?(_0xee3cd5[_0x516afb(0xdc)]++,_0xee3cd5[_0x516afb(0xf2)]+=parseInt(_0x323438[_0x516afb(0x105)]||0x0),_0xee3cd5['totalDeaths']+=parseInt(_0x323438['loserScore']||0x0)):(_0xee3cd5['losses']++,_0xee3cd5[_0x516afb(0xf2)]+=parseInt(_0x323438[_0x516afb(0xe1)]||0x0),_0xee3cd5[_0x516afb(0x108)]+=parseInt(_0x323438[_0x516afb(0x105)]||0x0));const _0x8cfc7f=_0xee3cd5[_0x516afb(0xdc)]+_0xee3cd5[_0x516afb(0xd2)];_0xee3cd5[_0x516afb(0xe5)]=_0x8cfc7f>0x0?(_0xee3cd5[_0x516afb(0xdc)]/_0x8cfc7f*0x64)['toFixed'](0x1):0x0,_0xee3cd5['lastUpdated']=new Date()[_0x516afb(0xd6)](),await setDoc(_0x3a6b6e,_0xee3cd5,{'merge':!![]});}
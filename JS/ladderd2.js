const a30_0x517fc7=a30_0x185e,a30_0x16c36e=(function(){let _0x4e50c8=!![];return function(_0xca715e,_0x241759){const _0xe1c755=_0x4e50c8?function(){if(_0x241759){const _0x1990ea=_0x241759['apply'](_0xca715e,arguments);return _0x241759=null,_0x1990ea;}}:function(){};return _0x4e50c8=![],_0xe1c755;};}()),a30_0x344fb5=a30_0x16c36e(this,function(){const _0x4f0435=a30_0x185e,_0x80c6f8=function(){const _0x173e0a=a30_0x185e;let _0x1bce42;try{_0x1bce42=Function(_0x173e0a(0xab)+_0x173e0a(0xe5)+');')();}catch(_0x5a2945){_0x1bce42=window;}return _0x1bce42;},_0x58d576=_0x80c6f8(),_0x10399d=_0x58d576['console']=_0x58d576[_0x4f0435(0xdc)]||{},_0x492132=[_0x4f0435(0xdd),_0x4f0435(0xc2),'info','error','exception','table','trace'];for(let _0x2acfc9=0x0;_0x2acfc9<_0x492132[_0x4f0435(0xa9)];_0x2acfc9++){const _0x35eb1f=a30_0x16c36e['constructor']['prototype']['bind'](a30_0x16c36e),_0x2eb2b9=_0x492132[_0x2acfc9],_0x460a13=_0x10399d[_0x2eb2b9]||_0x35eb1f;_0x35eb1f['__proto__']=a30_0x16c36e['bind'](a30_0x16c36e),_0x35eb1f[_0x4f0435(0xe3)]=_0x460a13['toString'][_0x4f0435(0xee)](_0x460a13),_0x10399d[_0x2eb2b9]=_0x35eb1f;}});a30_0x344fb5();import{collection,getDocs,doc,getDoc,query,where,updateDoc,Timestamp,orderBy,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import a30_0x2568ed from'./firebase-idle-wrapper.js';import{getTokensByUsernames,getPrimaryDisplayToken,clearTokenCache}from'./tokens.js';const playerCacheD2={'data':null,'timestamp':0x0},CACHE_DURATION=0x7530;async function displayLadderD2(_0x433aa=![]){const _0x478d44=a30_0x185e,_0x1d274e=document['querySelector'](_0x478d44(0xf1));if(!_0x1d274e){console[_0x478d44(0xe9)]('D2\x20Ladder\x20table\x20body\x20not\x20found');return;}_0x1d274e['innerHTML']='<tr><td\x20colspan=\x228\x22\x20class=\x22loading-cell\x22>Loading\x20D2\x20ladder\x20data...</td></tr>';try{const _0x1c60c8=Date[_0x478d44(0xb8)]();if(!_0x433aa&&playerCacheD2['data']&&_0x1c60c8-playerCacheD2['timestamp']<CACHE_DURATION){updateLadderDisplayD2(playerCacheD2['data']);return;}const _0x9c8d4=collection(db,'playersD2'),_0x51d5f3=await a30_0x2568ed['getDocuments'](_0x9c8d4),_0x1e8319=[];_0x51d5f3['forEach'](_0x597fff=>{const _0x1fe298=_0x597fff['data']();_0x1fe298['username']&&_0x1e8319['push']({..._0x1fe298,'id':_0x597fff['id'],'elo':_0x1fe298['eloRating']||0x0,'position':_0x1fe298['position']||Number['MAX_SAFE_INTEGER']});});const _0x592afd=collection(db,'userProfiles'),_0x29d9c0=await getDocs(_0x592afd),_0x4daf54=new Map();_0x29d9c0['forEach'](_0x4966eb=>{const _0x5eb84f=_0x478d44,_0x1475f9=_0x4966eb['data']();_0x1475f9[_0x5eb84f(0xca)]&&_0x4daf54['set'](_0x1475f9['username']['toLowerCase'](),_0x1475f9);});for(const _0x11e0e2 of _0x1e8319){const _0x5f3e91=_0x11e0e2[_0x478d44(0xca)]['toLowerCase']();if(_0x4daf54['has'](_0x5f3e91)){const _0x2eda96=_0x4daf54['get'](_0x5f3e91);_0x2eda96['country']&&(_0x11e0e2['country']=_0x2eda96['country'][_0x478d44(0xdb)]()),_0x11e0e2['points']=_0x2eda96['points']||0x0;}else _0x11e0e2[_0x478d44(0xd4)]=0x0;}const _0xa71ffc=_0x1e8319['map'](_0x32b112=>_0x32b112['username']),_0x2e7463=await fetchBatchMatchStatsD2(_0xa71ffc);_0x1e8319['sort']((_0x1194b2,_0x48c653)=>{const _0x4396c2=_0x478d44,_0x42c277=_0x2e7463[_0x4396c2(0xcb)](_0x1194b2['username'])?.['totalMatches']||0x0,_0x3cb159=_0x2e7463['get'](_0x48c653['username'])?.[_0x4396c2(0xe0)]||0x0;if(_0x42c277===0x0!==(_0x3cb159===0x0))return _0x42c277===0x0?0x1:-0x1;return(_0x1194b2['position']||0x3e7)-(_0x48c653[_0x4396c2(0xd2)]||0x3e7);}),_0x1e8319[_0x478d44(0xd1)]((_0x5dbfff,_0x3140c2)=>{const _0x1ddfad=_0x478d44;_0x5dbfff[_0x1ddfad(0xd2)]=_0x3140c2+0x1;}),playerCacheD2['data']=_0x1e8319,playerCacheD2['timestamp']=_0x1c60c8,updateLadderDisplayD2(_0x1e8319);}catch(_0x33b665){console['error'](_0x478d44(0xed),_0x33b665),_0x1d274e[_0x478d44(0xae)]=_0x478d44(0xac)+_0x33b665['message']+_0x478d44(0xbb);}}function getNextAvailablePositionD2(_0x482ff3){const _0x32be49=a30_0x185e;if(_0x482ff3[_0x32be49(0xa9)]===0x0)return 0x1;let _0x5cbe5d=0x0;return _0x482ff3['forEach'](_0x55a5c2=>{const _0x3396ce=_0x32be49;_0x55a5c2[_0x3396ce(0xd2)]&&typeof _0x55a5c2['position']==='number'&&_0x55a5c2[_0x3396ce(0xd2)]>_0x5cbe5d&&(_0x5cbe5d=_0x55a5c2['position']);}),_0x5cbe5d+0x1;}async function updatePlayerPositions(_0x2eb047,_0x2da118){const _0x77c45=a30_0x185e;try{const _0x569fd5=collection(db,_0x77c45(0xe2)),_0x16e90a=await getDocs(_0x569fd5),_0x2aa79f=[];_0x16e90a['forEach'](_0xd7134f=>{const _0x2190a8=_0x77c45;_0x2aa79f[_0x2190a8(0xe6)]({'id':_0xd7134f['id'],..._0xd7134f[_0x2190a8(0xb1)]()});});const _0x3c1188=_0x2aa79f['find'](_0x3e0f32=>_0x3e0f32['username']===_0x2eb047),_0x5a60a7=_0x2aa79f['find'](_0x1cff15=>_0x1cff15['username']===_0x2da118);if(!_0x3c1188||!_0x5a60a7){console['error']('Could\x20not\x20find\x20winner\x20or\x20loser\x20in\x20D2\x20players\x20list');return;}if(_0x3c1188['position']>_0x5a60a7['position']){const _0x5ef010=_0x5a60a7[_0x77c45(0xd2)];for(const _0x6ca81f of _0x2aa79f){_0x6ca81f[_0x77c45(0xd2)]>=_0x5a60a7['position']&&_0x6ca81f[_0x77c45(0xd2)]<_0x3c1188[_0x77c45(0xd2)]&&_0x6ca81f['username']!==_0x2eb047&&await updateDoc(doc(db,_0x77c45(0xe2),_0x6ca81f['id']),{'position':_0x6ca81f['position']+0x1});}await updateDoc(doc(db,_0x77c45(0xe2),_0x3c1188['id']),{'position':_0x5ef010});if(_0x5ef010===0x1){const _0x2bcdef=doc(db,_0x77c45(0xe2),_0x3c1188['id']),_0x124cfc=await getDoc(_0x2bcdef);!_0x124cfc[_0x77c45(0xb1)]()['firstPlaceDate']&&await updateDoc(_0x2bcdef,{'firstPlaceDate':Timestamp['now']()});}if(_0x5a60a7['position']===0x1){const _0x1a3375=doc(db,_0x77c45(0xe2),_0x5a60a7['id']);await updateDoc(_0x1a3375,{'firstPlaceDate':null});}playerCacheD2['timestamp']=0x0;}}catch(_0xba5975){console['error'](_0x77c45(0xc7),_0xba5975);}}function a30_0x185e(_0xe9d239,_0x15774a){const _0x344fb5=a30_0x4b58();return a30_0x185e=function(_0x16c36e,_0x40c222){_0x16c36e=_0x16c36e-0xa8;let _0x4b5821=_0x344fb5[_0x16c36e];return _0x4b5821;},a30_0x185e(_0xe9d239,_0x15774a);}function a30_0x4b58(){const _0x3d80d2=['#F44336','length','function','return\x20(function()\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20colspan=\x228\x22\x20style=\x22text-align:\x20center;\x20color:\x20red;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Error\x20loading\x20D2\x20ladder\x20data:\x20','bold','innerHTML','timestamp','opacity','data','kda','tokenName','Emerald','totalKills','.trend-indicator','Silver','now','country','wins','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','winnerUsername','set','change','#50C878','#DC143C','previousElo','warn','fontWeight','player','\x0a<tr>\x0a\x20\x20\x20\x20<td>','has','Error\x20updating\x20D2\x20player\x20positions:','sort','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Rank</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Username</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>ELO</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Matches</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Wins</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Losses</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>K/D</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Win\x20Rate</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Points</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','username','get','join','includes','td:nth-child(3)','querySelector','displayLadderD2\x20function\x20not\x20available','forEach','position','textContent','points','\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20style=\x22width:\x2035px;\x20height:\x2035px;\x20margin-left:\x205px;\x20vertical-align:\x20middle;\x20object-fit:\x20contain;\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20onerror=\x22this.style.display=\x27none\x27\x22>','toFixed','size','visibility','loserScore','.png\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20alt=\x22','toLowerCase','console','log','newElo','eloHistory','totalMatches','Unranked','playersD2','toString','winRate','{}.constructor(\x22return\x20this\x22)(\x20)','push','inline','desc','error','</td>\x0a\x20\x20\x20\x20<td>','style','losses','Error\x20loading\x20D2\x20ladder:','bind','refreshLadderDisplayD2','winnerScore','#ladder-d2\x20tbody'];a30_0x4b58=function(){return _0x3d80d2;};return a30_0x4b58();}function getPlayerRankNameD2(_0x303020,_0x2465a0=0x0,_0x33206b=0x0){const _0x52b2f2=a30_0x185e;if(_0x2465a0===0x0)return _0x52b2f2(0xe1);if(_0x303020>=0x3e8&&_0x33206b>=0x50&&_0x2465a0>=0x14)return _0x52b2f2(0xb4);if(_0x303020>=0x2bc)return'Gold';if(_0x303020>=0x1f4)return _0x52b2f2(0xb7);if(_0x303020>=0xc8)return'Bronze';return'Unranked';}window[a30_0x517fc7(0xef)]=function(_0xccfc8c=!![]){const _0x47dcaa=a30_0x517fc7;typeof displayLadderD2==='function'?displayLadderD2(_0xccfc8c):console['warn'](_0x47dcaa(0xd0));};async function updateLadderDisplayD2(_0x150a9c){const _0x32ec12=a30_0x517fc7;_0x150a9c[_0x32ec12(0xc8)]((_0x4e110e,_0x3e347a)=>_0x4e110e['position']-_0x3e347a[_0x32ec12(0xd2)]);const _0x490f91=document[_0x32ec12(0xcf)](_0x32ec12(0xf1));if(!_0x490f91)return;_0x490f91['innerHTML']='';const _0x54f42e=_0x150a9c['map'](_0x300e27=>_0x300e27[_0x32ec12(0xca)]),_0x198d81=await fetchBatchMatchStatsD2(_0x54f42e);let _0x33508e=new Map();try{typeof clearTokenCache===_0x32ec12(0xaa)&&clearTokenCache(),_0x33508e=await getTokensByUsernames(_0x54f42e);}catch(_0x2e5a59){console['error']('D2:\x20Error\x20fetching\x20tokens:',_0x2e5a59);}const _0x182451=document['querySelector']('#ladder-d2\x20thead\x20tr');_0x182451&&(_0x182451['innerHTML']=_0x32ec12(0xc9));const _0x14273f=_0x150a9c['map'](_0x4a0530=>{const _0xa15eff=_0x32ec12,_0x57ca43=_0x198d81['get'](_0x4a0530['username'])||{'totalMatches':0x0,'wins':0x0,'losses':0x0,'kda':0x0,'winRate':0x0,'totalKills':0x0,'totalDeaths':0x0},_0x3a68e2=_0x33508e[_0xa15eff(0xcb)](_0x4a0530['username'])||[],_0x3cb477=getPrimaryDisplayToken(_0x3a68e2);return createPlayerRowWithTokenD2(_0x4a0530,_0x57ca43,_0x3cb477);})[_0x32ec12(0xcc)]('');_0x490f91[_0x32ec12(0xae)]=_0x14273f,getPlayersLastEloChangesD2(_0x54f42e)['then'](_0x2b4f0c=>{const _0x18b0f0=_0x32ec12,_0x99a520=new Map();_0x490f91['querySelectorAll']('tr')[_0x18b0f0(0xd1)]((_0x4c8e76,_0x4e878b)=>{_0x4e878b<_0x54f42e['length']&&_0x99a520['set'](_0x54f42e[_0x4e878b],_0x4c8e76);}),_0x2b4f0c['forEach']((_0x344c8b,_0x176bce)=>{const _0x1e3f48=_0x18b0f0,_0x251c3a=_0x99a520['get'](_0x176bce);if(_0x251c3a&&_0x344c8b!==0x0){const _0x134f91=_0x251c3a[_0x1e3f48(0xcf)](_0x1e3f48(0xce));if(_0x134f91){const _0x291829=_0x344c8b>0x0?'+'+_0x344c8b:''+_0x344c8b,_0x370b00=_0x134f91['querySelector'](_0x1e3f48(0xb6));_0x370b00&&(_0x370b00[_0x1e3f48(0xd3)]=_0x291829,_0x370b00['style']['color']=_0x344c8b>0x0?'#4CAF50':_0x1e3f48(0xa8),_0x370b00[_0x1e3f48(0xeb)][_0x1e3f48(0xc3)]=_0x1e3f48(0xad),_0x370b00['style']['fontSize']='0.85em',_0x370b00['style']['display']=_0x1e3f48(0xe7),_0x370b00['style'][_0x1e3f48(0xd8)]='visible',_0x370b00['style'][_0x1e3f48(0xb0)]='1');}}});})['catch'](_0x10efb5=>console['error']('Error\x20updating\x20D2\x20ELO\x20trend\x20indicators:',_0x10efb5));}function createPlayerRowWithTokenD2(_0x147d94,_0x4948b7,_0x261901){const _0x5031d6=a30_0x517fc7,_0x853432=parseFloat(_0x147d94['elo'])||0x0;let _0x4e6f3c='#DC143C';if(_0x4948b7['totalMatches']===0x0)_0x4e6f3c=_0x5031d6(0xc0);else{if(_0x853432>=0x3e8&&_0x4948b7['winRate']>=0x50&&_0x4948b7[_0x5031d6(0xe0)]>=0x14)_0x4e6f3c=_0x5031d6(0xbf);else{if(_0x853432>=0x2bc)_0x4e6f3c='#FFD700';else{if(_0x853432>=0x1f4)_0x4e6f3c='#C0C0C0';else _0x853432>=0xc8&&(_0x4e6f3c='#CD7F32');}}}let _0x530cca='';_0x147d94['country']&&(_0x530cca='<img\x20src=\x22../images/flags/'+_0x147d94[_0x5031d6(0xb9)][_0x5031d6(0xdb)]()+_0x5031d6(0xda)+_0x147d94['country']+'\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20class=\x22player-flag\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20style=\x22margin-left:\x205px;\x20vertical-align:\x20middle;\x20width:\x2020px;\x20height:\x20auto;\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20onerror=\x22this.style.display=\x27none\x27\x22>');let _0x133f30='';return _0x261901&&(_0x133f30='<img\x20src=\x22'+_0x261901['tokenImage']+'\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20alt=\x22'+_0x261901[_0x5031d6(0xb3)]+'\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20class=\x22player-token\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20title=\x22'+_0x261901[_0x5031d6(0xb3)]+'\x20'+(_0x261901['equipped']?'(Equipped)':'')+_0x5031d6(0xd5)),_0x5031d6(0xc5)+_0x147d94['position']+'</td>\x0a\x20\x20\x20\x20<td\x20style=\x22position:\x20relative;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20position:\x20relative;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username='+encodeURIComponent(_0x147d94[_0x5031d6(0xca)])+'&ladder=d2\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20style=\x22color:\x20'+_0x4e6f3c+';\x20text-decoration:\x20none;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x147d94['username']+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x530cca+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x133f30+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20<td\x20style=\x22color:\x20'+_0x4e6f3c+';\x20position:\x20relative;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22elo-container\x22\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22elo-value\x22>'+_0x853432+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22trend-indicator\x22\x20style=\x22margin-left:\x205px;\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20<td>'+_0x4948b7['totalMatches']+'</td>\x0a\x20\x20\x20\x20<td>'+_0x4948b7['wins']+'</td>\x0a\x20\x20\x20\x20<td>'+_0x4948b7[_0x5031d6(0xec)]+_0x5031d6(0xea)+_0x4948b7['kda']+'</td>\x0a\x20\x20\x20\x20<td>'+_0x4948b7[_0x5031d6(0xe4)]+'%</td>\x0a\x20\x20\x20\x20<td\x20style=\x22color:\x20gray;\x22>'+(_0x147d94[_0x5031d6(0xd4)]||0x0)+'</td>\x0a</tr>';}async function getPlayersLastEloChangesD2(_0x42a220){const _0xab8be0=a30_0x517fc7,_0x5b4fcb=new Map();_0x42a220['forEach'](_0x4758dd=>_0x5b4fcb['set'](_0x4758dd,0x0));try{const _0x195e4e=collection(db,'eloHistoryD2'),_0x2147a6=query(_0x195e4e,orderBy('timestamp',_0xab8be0(0xe8)),limit(0x64)),_0x2dfaed=await getDocs(_0x2147a6),_0x3a29f8=new Map(),_0x20974f=await getDocs(collection(db,_0xab8be0(0xe2)));_0x20974f[_0xab8be0(0xd1)](_0x246d22=>{const _0x5aab50=_0xab8be0,_0x128c12=_0x246d22['data']();_0x128c12[_0x5aab50(0xca)]&&_0x3a29f8['set'](_0x246d22['id'],_0x128c12['username']);});const _0x2f2c04=new Map();_0x2dfaed['forEach'](_0x21cdf1=>{const _0x4054ac=_0xab8be0,_0x11da9c=_0x21cdf1['data']();let _0x3bbedd=_0x11da9c['username']||_0x11da9c['playerUsername'];!_0x3bbedd&&_0x11da9c['player']&&_0x3a29f8[_0x4054ac(0xc6)](_0x11da9c[_0x4054ac(0xc4)])&&(_0x3bbedd=_0x3a29f8['get'](_0x11da9c['player'])),_0x3bbedd&&_0x42a220[_0x4054ac(0xcd)](_0x3bbedd)&&(!_0x2f2c04[_0x4054ac(0xc6)](_0x3bbedd)&&_0x2f2c04[_0x4054ac(0xbd)](_0x3bbedd,[]),_0x2f2c04[_0x4054ac(0xcb)](_0x3bbedd)['push']({..._0x11da9c,'timestamp':_0x11da9c[_0x4054ac(0xaf)]?.['seconds']||0x0,'username':_0x3bbedd}));}),_0x2f2c04['forEach']((_0xa2afcd,_0x176562)=>{const _0x34d7f9=_0xab8be0;if(_0xa2afcd[_0x34d7f9(0xa9)]>0x0){_0xa2afcd['sort']((_0x3f450e,_0xe50c43)=>_0xe50c43['timestamp']-_0x3f450e['timestamp']);const _0x1f707d=_0xa2afcd['find'](_0xec1412=>_0xec1412[_0x34d7f9(0xbe)]!==undefined||_0xec1412['newElo']!==undefined&&_0xec1412['previousElo']!==undefined);if(_0x1f707d){let _0x39af87;if(_0x1f707d[_0x34d7f9(0xbe)]!==undefined)_0x39af87=_0x1f707d['change'];else _0x1f707d['newElo']!==undefined&&_0x1f707d[_0x34d7f9(0xc1)]!==undefined&&(_0x39af87=_0x1f707d[_0x34d7f9(0xde)]-_0x1f707d[_0x34d7f9(0xc1)]);_0x39af87!==undefined&&_0x5b4fcb['set'](_0x176562,_0x39af87);}}});if(_0x2f2c04[_0xab8be0(0xd7)]===0x0){const _0x14d768=collection(db,_0xab8be0(0xdf)),_0x1c611f=query(_0x14d768,where('gameMode','==','D2'),orderBy('timestamp','desc'),limit(0x32));try{const _0x38b689=await getDocs(_0x1c611f);_0x38b689['forEach'](_0x5a45a7=>{const _0x1308a4=_0xab8be0,_0x2d445f=_0x5a45a7['data'](),_0x896c17=_0x2d445f['username']||_0x2d445f['playerUsername'];if(_0x896c17&&_0x42a220['includes'](_0x896c17)){const _0x353759=_0x2d445f['change']||(_0x2d445f['newElo']!==undefined&&_0x2d445f['previousElo']!==undefined?_0x2d445f[_0x1308a4(0xde)]-_0x2d445f[_0x1308a4(0xc1)]:0x0);_0x353759!==0x0&&_0x5b4fcb['set'](_0x896c17,_0x353759);}});}catch(_0x576347){}}}catch(_0x5e2780){console['error']('D2:\x20Error\x20fetching\x20ELO\x20history:',_0x5e2780);}return _0x5b4fcb;}async function fetchBatchMatchStatsD2(_0x36a49b){const _0x5a026b=a30_0x517fc7,_0x41e11d=new Map();try{_0x36a49b[_0x5a026b(0xd1)](_0x132b63=>{const _0x1e385d=_0x5a026b;_0x41e11d[_0x1e385d(0xbd)](_0x132b63,{'totalMatches':0x0,'wins':0x0,'losses':0x0,'totalKills':0x0,'totalDeaths':0x0,'kda':0x0,'winRate':0x0});});const _0x32ef76=collection(db,'approvedMatchesD2'),_0x4e258f=await getDocs(_0x32ef76);_0x4e258f['forEach'](_0xe7b438=>{const _0x5a20ef=_0x5a026b,_0x29f588=_0xe7b438[_0x5a20ef(0xb1)](),_0x686731=_0x29f588[_0x5a20ef(0xbc)],_0x1bf590=_0x29f588['loserUsername'];if(_0x36a49b[_0x5a20ef(0xcd)](_0x686731)){const _0x396096=_0x41e11d['get'](_0x686731);_0x396096[_0x5a20ef(0xba)]++,_0x396096['totalMatches']++,_0x396096[_0x5a20ef(0xb5)]+=parseInt(_0x29f588['winnerScore'])||0x0,_0x396096['totalDeaths']+=parseInt(_0x29f588[_0x5a20ef(0xd9)])||0x0;}if(_0x36a49b[_0x5a20ef(0xcd)](_0x1bf590)){const _0x1ce72a=_0x41e11d[_0x5a20ef(0xcb)](_0x1bf590);_0x1ce72a['losses']++,_0x1ce72a['totalMatches']++,_0x1ce72a[_0x5a20ef(0xb5)]+=parseInt(_0x29f588['loserScore'])||0x0,_0x1ce72a['totalDeaths']+=parseInt(_0x29f588[_0x5a20ef(0xf0)])||0x0;}}),_0x36a49b['forEach'](_0x45abd7=>{const _0x21a44a=_0x5a026b,_0x2c9407=_0x41e11d['get'](_0x45abd7);_0x2c9407[_0x21a44a(0xb2)]=_0x2c9407['totalDeaths']>0x0?(_0x2c9407[_0x21a44a(0xb5)]/_0x2c9407['totalDeaths'])['toFixed'](0x2):_0x2c9407['totalKills']['toFixed'](0x2),_0x2c9407[_0x21a44a(0xe4)]=_0x2c9407[_0x21a44a(0xe0)]>0x0?(_0x2c9407[_0x21a44a(0xba)]/_0x2c9407['totalMatches']*0x64)[_0x21a44a(0xd6)](0x1):0x0;});}catch(_0x2b9fd2){console['error']('Error\x20fetching\x20batch\x20D2\x20match\x20stats:',_0x2b9fd2);}return _0x41e11d;}export{displayLadderD2,updatePlayerPositions};
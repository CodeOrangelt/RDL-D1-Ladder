const a39_0x37a5cb=a39_0x3f5c,a39_0x2a6c04=(function(){let _0x4f766a=!![];return function(_0x40141a,_0x2aea92){const _0x20e9ed=_0x4f766a?function(){const _0x1b20a8=a39_0x3f5c;if(_0x2aea92){const _0x1f3bd4=_0x2aea92[_0x1b20a8(0xc1)](_0x40141a,arguments);return _0x2aea92=null,_0x1f3bd4;}}:function(){};return _0x4f766a=![],_0x20e9ed;};}()),a39_0xc54951=a39_0x2a6c04(this,function(){const _0xfcc4e9=a39_0x3f5c;let _0xa30e2e;try{const _0x4fd2c5=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0xa30e2e=_0x4fd2c5();}catch(_0x1438ca){_0xa30e2e=window;}const _0x46085a=_0xa30e2e['console']=_0xa30e2e['console']||{},_0x35e094=['log','warn','info','error','exception','table','trace'];for(let _0x494d9c=0x0;_0x494d9c<_0x35e094['length'];_0x494d9c++){const _0xe14685=a39_0x2a6c04[_0xfcc4e9(0xbe)]['prototype'][_0xfcc4e9(0xb8)](a39_0x2a6c04),_0x48afe0=_0x35e094[_0x494d9c],_0x15e0e1=_0x46085a[_0x48afe0]||_0xe14685;_0xe14685['__proto__']=a39_0x2a6c04['bind'](a39_0x2a6c04),_0xe14685[_0xfcc4e9(0xb9)]=_0x15e0e1['toString'][_0xfcc4e9(0xb8)](_0x15e0e1),_0x46085a[_0x48afe0]=_0xe14685;}});a39_0xc54951();function a39_0x3f5c(_0x3ee342,_0x5d4806){const _0xc54951=a39_0x2088();return a39_0x3f5c=function(_0x2a6c04,_0xe5ecaf){_0x2a6c04=_0x2a6c04-0xb0;let _0x208805=_0xc54951[_0x2a6c04];return _0x208805;},a39_0x3f5c(_0x3ee342,_0x5d4806);}import{db}from'./firebase-config.js';import{doc,getDoc,updateDoc,addDoc,collection,serverTimestamp}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const POINTS_CHART={'':0xa,'Standard':0xa,'Fusion\x20Match':0x19,'â‰¥6\x20Missiles':0xa,'Weapon\x20Imbalance':0x1e,'Blind\x20Match':0x4b,'Rematch':0x14,'Disorientation':0x32,'Ratting':0x23,'Altered\x20Powerups':0x23,'Mega\x20Match':0x28,'Dogfight':0x32,'Gauss\x20and\x20Mercs':0x19,'Misc':0x1e};let adminModifyUserPoints=null;function a39_0x2088(){const _0x14b830=['email','all','userProfiles','Error\x20awarding\x20match\x20points:','\x20points\x20to\x20both\x20players\x20for\x20','\x20match\x20(Winner)','Match\x20points:\x20','Unknown\x20User','bind','toString','\x20points\x20to\x20user\x20','add','Added\x20','\x20match\x20(Participant)','constructor','log','Standard','apply'];a39_0x2088=function(){return _0x14b830;};return a39_0x2088();}try{const adminModule=await import('./adminbackend.js');adminModule['modifyUserPoints']&&(adminModifyUserPoints=adminModule['modifyUserPoints'],console[a39_0x37a5cb(0xbf)]('Admin\x20points\x20service\x20connected'));}catch(a39_0x7fd142){console[a39_0x37a5cb(0xbf)]('Admin\x20backend\x20not\x20available,\x20using\x20fallback\x20points\x20service');}export async function awardMatchPoints(_0x1bbe5f,_0x31d2ed,_0x15717a){const _0x5c0ec3=a39_0x37a5cb;try{const _0x136a31=POINTS_CHART[_0x15717a]||0xa;return adminModifyUserPoints?await Promise[_0x5c0ec3(0xb1)]([adminModifyUserPoints(_0x1bbe5f,'add',_0x136a31,_0x5c0ec3(0xb6)+(_0x15717a||'Standard')+'\x20match\x20(Winner)'),adminModifyUserPoints(_0x31d2ed,'add',_0x136a31,_0x5c0ec3(0xb6)+(_0x15717a||'Standard')+'\x20match\x20(Participant)')]):await Promise['all']([addPointsFallback(_0x1bbe5f,_0x136a31,_0x5c0ec3(0xb6)+(_0x15717a||'Standard')+_0x5c0ec3(0xb5)),addPointsFallback(_0x31d2ed,_0x136a31,_0x5c0ec3(0xb6)+(_0x15717a||'Standard')+_0x5c0ec3(0xbd))]),console['log']('Awarded\x20'+_0x136a31+_0x5c0ec3(0xb4)+(_0x15717a||_0x5c0ec3(0xc0))+'\x20match'),!![];}catch(_0x173e8f){return console['error'](_0x5c0ec3(0xb3),_0x173e8f),![];}}async function addPointsFallback(_0xb74b3a,_0x10efd1,_0x3b6434=''){const _0x5a0350=a39_0x37a5cb;try{const _0x312fef=doc(db,_0x5a0350(0xb2),_0xb74b3a),_0x5d0579=await getDoc(_0x312fef);if(!_0x5d0579['exists']()){console[_0x5a0350(0xbf)]('User\x20profile\x20not\x20found\x20for\x20'+_0xb74b3a+',\x20skipping\x20points\x20award');return;}const _0x5654ae=_0x5d0579['data'](),_0x5ad7b8=_0x5654ae['points']||0x0,_0x548411=_0x5ad7b8+_0x10efd1;await updateDoc(_0x312fef,{'points':_0x548411,'lastPointsModified':serverTimestamp()}),await addDoc(collection(db,'pointsHistory'),{'userId':_0xb74b3a,'userEmail':_0x5654ae[_0x5a0350(0xb0)]||'unknown','displayName':_0x5654ae['displayName']||_0x5654ae['username']||_0x5a0350(0xb7),'action':_0x5a0350(0xbb),'amount':_0x10efd1,'previousPoints':_0x5ad7b8,'newPoints':_0x548411,'reason':_0x3b6434,'adminEmail':'system-match-award','timestamp':serverTimestamp()}),console['log'](_0x5a0350(0xbc)+_0x10efd1+_0x5a0350(0xba)+_0xb74b3a+'.\x20New\x20total:\x20'+_0x548411);}catch(_0x163e43){console['error']('Error\x20adding\x20points\x20to\x20user:',_0x163e43);throw _0x163e43;}}
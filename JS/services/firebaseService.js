const a53_0x1f98b8=(function(){let _0x31838d=!![];return function(_0x9afaf8,_0x8ab3a4){const _0x356348=_0x31838d?function(){if(_0x8ab3a4){const _0x10779a=_0x8ab3a4['apply'](_0x9afaf8,arguments);return _0x8ab3a4=null,_0x10779a;}}:function(){};return _0x31838d=![],_0x356348;};}()),a53_0x27865b=a53_0x1f98b8(this,function(){const _0x1f2a46=a53_0x478e;let _0x26fec3;try{const _0x81e84b=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x26fec3=_0x81e84b();}catch(_0x49c68e){_0x26fec3=window;}const _0x5523d3=_0x26fec3['console']=_0x26fec3['console']||{},_0x2b0d3b=['log','warn',_0x1f2a46(0xdd),'error',_0x1f2a46(0xe5),'table','trace'];for(let _0x35e3e=0x0;_0x35e3e<_0x2b0d3b[_0x1f2a46(0xde)];_0x35e3e++){const _0xa16a4e=a53_0x1f98b8['constructor']['prototype']['bind'](a53_0x1f98b8),_0x6e2a99=_0x2b0d3b[_0x35e3e],_0x48dee8=_0x5523d3[_0x6e2a99]||_0xa16a4e;_0xa16a4e['__proto__']=a53_0x1f98b8[_0x1f2a46(0xf1)](a53_0x1f98b8),_0xa16a4e['toString']=_0x48dee8[_0x1f2a46(0xe3)]['bind'](_0x48dee8),_0x5523d3[_0x6e2a99]=_0xa16a4e;}});a53_0x27865b();import{db}from'../firebase-config.js';import{collection,doc,getDoc,getDocs,query,limit,startAfter,where,onSnapshot}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const cache={'userProfiles':new Map(),'ladderPlayers':new Map(),'matchResults':new Map(),'eloHistory':new Map()},CACHE_EXPIRY={'userProfiles':0x5*0x3c*0x3e8,'ladderPlayers':0x2*0x3c*0x3e8,'matchResults':0x1*0x3c*0x3e8,'eloHistory':0x3*0x3c*0x3e8};function a53_0x1f60(){const _0x2dd7e7=['info','length','forEach','slice','players','division_','toString','map','exception','data','timestamp','username','now','eloHistory','get','playersD3','exists','userProfiles','docs','docChanges','bind'];a53_0x1f60=function(){return _0x2dd7e7;};return a53_0x1f60();}export const userProfilesRef=collection(db,'userProfiles');export async function fetchPaginatedData(_0x4a3f8e,_0x2b6320=0xa,_0x44c20f=null){const _0x14ac9d=a53_0x478e;let _0x2acd3f=query(_0x4a3f8e,limit(_0x2b6320));_0x44c20f&&(_0x2acd3f=query(_0x2acd3f,startAfter(_0x44c20f)));const _0x5aefe2=await getDocs(_0x2acd3f),_0x4db54c=_0x5aefe2[_0x14ac9d(0xef)][_0x5aefe2[_0x14ac9d(0xef)][_0x14ac9d(0xde)]-0x1];return{'data':_0x5aefe2['docs'][_0x14ac9d(0xe4)](_0x201fda=>({'id':_0x201fda['id'],..._0x201fda['data']()})),'lastVisible':_0x4db54c,'hasMore':_0x5aefe2[_0x14ac9d(0xef)]['length']===_0x2b6320};}export async function getUserProfile(_0x1f61e3){const _0x1f4a1c=a53_0x478e,_0x197550=cache['userProfiles']['get'](_0x1f61e3);if(_0x197550&&Date['now']()-_0x197550[_0x1f4a1c(0xe7)]<CACHE_EXPIRY[_0x1f4a1c(0xee)])return _0x197550['data'];const _0x50212f=await getDoc(doc(userProfilesRef,_0x1f61e3));if(_0x50212f[_0x1f4a1c(0xed)]()){const _0x1fe15f=_0x50212f['data']();return cache['userProfiles']['set'](_0x1f61e3,{'data':_0x1fe15f,'timestamp':Date['now']()}),_0x1fe15f;}return null;}export async function getLadderData(_0x43f96d=0x1){const _0x4aec75=a53_0x478e,_0x2f9b93=_0x4aec75(0xe2)+_0x43f96d,_0x252298=cache['ladderPlayers']['get'](_0x2f9b93);if(_0x252298&&Date[_0x4aec75(0xe9)]()-_0x252298['timestamp']<CACHE_EXPIRY['ladderPlayers'])return _0x252298[_0x4aec75(0xe6)];const _0x1d4f8e=_0x43f96d===0x1?_0x4aec75(0xe1):'playersD'+_0x43f96d,_0x436cab=collection(db,_0x1d4f8e),_0x47d9aa=await getDocs(query(_0x436cab,limit(0x64))),_0x16a5e9=_0x47d9aa['docs']['map'](_0x177a70=>({'id':_0x177a70['id'],..._0x177a70[_0x4aec75(0xe6)]()}));return cache['ladderPlayers']['set'](_0x2f9b93,{'data':_0x16a5e9,'timestamp':Date['now']()}),_0x16a5e9;}function a53_0x478e(_0x3f51ab,_0xcd2578){const _0x27865b=a53_0x1f60();return a53_0x478e=function(_0x1f98b8,_0x1e7d7f){_0x1f98b8=_0x1f98b8-0xdd;let _0x1f60c2=_0x27865b[_0x1f98b8];return _0x1f60c2;},a53_0x478e(_0x3f51ab,_0xcd2578);}export async function getEloHistoryBatch(_0x52b71b,_0x46eb7f=0x1){const _0x3deb5a=a53_0x478e,_0x1a3de1=_0x46eb7f===0x1?'eloHistory':'eloHistoryD'+_0x46eb7f,_0x2d9a94=collection(db,_0x1a3de1),_0x224c43={},_0x5eccf7=[];_0x52b71b[_0x3deb5a(0xdf)](_0x131ae2=>{const _0x42f886=_0x3deb5a,_0x19e9a5=_0x131ae2+'_'+_0x46eb7f,_0x2de4f9=cache['eloHistory'][_0x42f886(0xeb)](_0x19e9a5);_0x2de4f9&&Date[_0x42f886(0xe9)]()-_0x2de4f9[_0x42f886(0xe7)]<CACHE_EXPIRY[_0x42f886(0xea)]?_0x224c43[_0x131ae2]=_0x2de4f9[_0x42f886(0xe6)]:_0x5eccf7['push'](_0x131ae2);});const _0x443dd3=0xa;for(let _0x39ef8c=0x0;_0x39ef8c<_0x5eccf7['length'];_0x39ef8c+=_0x443dd3){const _0xd7d54=_0x5eccf7[_0x3deb5a(0xe0)](_0x39ef8c,_0x39ef8c+_0x443dd3);if(_0xd7d54['length']>0x0)try{const _0xbad571=query(_0x2d9a94,where('playerId','in',_0xd7d54),limit(0x64)),_0xaf849e=await getDocs(_0xbad571);_0xaf849e['docs'][_0x3deb5a(0xdf)](_0x261160=>{const _0x17e552=_0x261160['data'](),_0x2bc7ce=_0x17e552['playerId'];if(!_0x224c43[_0x2bc7ce])_0x224c43[_0x2bc7ce]=[];_0x224c43[_0x2bc7ce]['push'](_0x17e552);const _0x3fbf0a=_0x2bc7ce+'_'+_0x46eb7f;cache['eloHistory']['set'](_0x3fbf0a,{'data':_0x224c43[_0x2bc7ce],'timestamp':Date['now']()});});}catch(_0x4c6cf4){console['error']('Error\x20fetching\x20batch\x20ELO\x20history:',_0x4c6cf4);}}return _0x224c43;}let usernameCache=new Map(),usernameCacheTimestamp=Date['now']();export function setupEfficientListener(_0x46ae73,_0x2288cc=[],_0x34d6ad){const _0x2a7f35=collection(db,_0x46ae73),_0x291c12=query(_0x2a7f35,..._0x2288cc),_0x413dde=onSnapshot(_0x291c12,_0x461a84=>{const _0x5a6cb4=a53_0x478e,_0x257847=_0x461a84[_0x5a6cb4(0xf0)]()['map'](_0x473de1=>({'type':_0x473de1['type'],'id':_0x473de1['doc']['id'],'data':_0x473de1['doc'][_0x5a6cb4(0xe6)]()}));_0x257847['length']>0x0&&_0x34d6ad(_0x257847,_0x461a84[_0x5a6cb4(0xef)]);});return _0x413dde;}export async function bulkResolveUsernames(_0x1b97c7){const _0x170e4e=a53_0x478e,_0x2e8bd9=new Map();if(!_0x1b97c7||_0x1b97c7[_0x170e4e(0xde)]===0x0)return _0x2e8bd9;const _0x508b39=['players','playersD2',_0x170e4e(0xec),'nonParticipants'];for(const _0x4c9e98 of _0x508b39){const _0x91fcba=collection(db,_0x4c9e98),_0x1e09c2=await getDocs(_0x91fcba);_0x1e09c2['forEach'](_0x9880e2=>{const _0x305d3c=_0x170e4e,_0x24d7bb=_0x9880e2['data']();_0x24d7bb['username']&&_0x1b97c7['includes'](_0x9880e2['id'])&&_0x2e8bd9['set'](_0x9880e2['id'],_0x24d7bb[_0x305d3c(0xe8)]);});}return _0x2e8bd9;}
const a15_0x3b3ffc=a15_0x6fc4,a15_0xc434bf=(function(){let _0x41d66d=!![];return function(_0x428b83,_0xc3c013){const _0x1e0ee2=_0x41d66d?function(){if(_0xc3c013){const _0x3b66d7=_0xc3c013['apply'](_0x428b83,arguments);return _0xc3c013=null,_0x3b66d7;}}:function(){};return _0x41d66d=![],_0x1e0ee2;};}()),a15_0x89664c=a15_0xc434bf(this,function(){const _0x164d93=a15_0x6fc4;let _0x5bbaab;try{const _0x37983d=Function(_0x164d93(0x93)+_0x164d93(0x8d)+');');_0x5bbaab=_0x37983d();}catch(_0x2bf6ad){_0x5bbaab=window;}const _0x3710c6=_0x5bbaab['console']=_0x5bbaab['console']||{},_0x3b3a2b=['log',_0x164d93(0x8f),'info','error',_0x164d93(0xa2),_0x164d93(0xa0),'trace'];for(let _0x3b25a0=0x0;_0x3b25a0<_0x3b3a2b['length'];_0x3b25a0++){const _0x2f395d=a15_0xc434bf['constructor']['prototype'][_0x164d93(0xa4)](a15_0xc434bf),_0x162af8=_0x3b3a2b[_0x3b25a0],_0x282512=_0x3710c6[_0x162af8]||_0x2f395d;_0x2f395d[_0x164d93(0x90)]=a15_0xc434bf['bind'](a15_0xc434bf),_0x2f395d['toString']=_0x282512['toString']['bind'](_0x282512),_0x3710c6[_0x162af8]=_0x2f395d;}});a15_0x89664c();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc,where}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D3=[{'name':'Emerald','elo':0x7d0},{'name':'Gold','elo':0x708},{'name':a15_0x3b3ffc(0x9c),'elo':0x640},{'name':a15_0x3b3ffc(0x99),'elo':0x578},{'name':'Unranked','elo':0x4b0}];function a15_0x55c8(){const _0x169d63=['empty','opponent','all','newElo','{}.constructor(\x22return\x20this\x22)(\x20)','docs','warn','__proto__','timestamp','Error\x20getting\x20D3\x20username:','return\x20(function()\x20','error','exists','approvedMatchesD3','Emerald','loserId','Bronze','data','match','Silver','Unknown\x20Player','Gold','demotion','table','playersD3','exception','Unranked','bind'];a15_0x55c8=function(){return _0x169d63;};return a15_0x55c8();}let lastVisibleD3=null;function a15_0x6fc4(_0x436172,_0x1928c8){const _0x89664c=a15_0x55c8();return a15_0x6fc4=function(_0xc434bf,_0x2ed7f4){_0xc434bf=_0xc434bf-0x89;let _0x55c8cc=_0x89664c[_0xc434bf];return _0x55c8cc;},a15_0x6fc4(_0x436172,_0x1928c8);}async function getUsernameByIdD3(_0x4c89af){const _0x4a82fa=a15_0x3b3ffc;try{if(!_0x4c89af)return'Unknown\x20Player';const _0x5099e4=await getDoc(doc(db,_0x4a82fa(0xa1),_0x4c89af));if(_0x5099e4[_0x4a82fa(0x95)]())return _0x5099e4[_0x4a82fa(0x9a)]()['username']||'Unknown\x20Player';const _0x34a2b4=await getDocs(query(collection(db,_0x4a82fa(0x96)),where('winnerId','==',_0x4c89af),limit(0x1)));if(!_0x34a2b4['empty'])return _0x34a2b4['docs'][0x0]['data']()['winnerUsername']||_0x4a82fa(0x9d);const _0x1e6b83=await getDocs(query(collection(db,'approvedMatchesD3'),where(_0x4a82fa(0x98),'==',_0x4c89af),limit(0x1)));if(!_0x1e6b83['empty'])return _0x1e6b83[_0x4a82fa(0x8e)][0x0]['data']()['loserUsername']||'Unknown\x20Player';return'Unknown\x20Player';}catch(_0xafc8b4){return console[_0x4a82fa(0x94)](_0x4a82fa(0x92),_0xafc8b4),'Unknown\x20Player';}}export async function recordEloChangeD3({playerId:_0x415308,previousElo:_0x194ba5,newElo:_0x10ba3a,opponentId:_0x24785c,matchResult:_0x2c96ee,previousPosition:_0x2880e3,newPosition:_0x49c663,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x1ec36b,timestamp:_0x3d5209}){const _0x3fa0b2=a15_0x3b3ffc;try{const _0x466f5f=doc(collection(db,'eloHistoryD3'));let _0x44814a=_0x3fa0b2(0x9b);if(isPromotion)_0x44814a='promotion';if(isDemotion)_0x44814a=_0x3fa0b2(0x9f);let _0xa4df4f=_0x3fa0b2(0xa3);if(_0x10ba3a>=0x7d0)_0xa4df4f=_0x3fa0b2(0x97);else{if(_0x10ba3a>=0x708)_0xa4df4f=_0x3fa0b2(0x9e);else{if(_0x10ba3a>=0x640)_0xa4df4f='Silver';else{if(_0x10ba3a>=0x578)_0xa4df4f='Bronze';}}}return await setDoc(_0x466f5f,{'type':_0x44814a,'player':_0x415308,'opponent':_0x24785c,'previousElo':_0x194ba5,'newElo':_0x10ba3a,'change':_0x10ba3a-_0x194ba5,'matchResult':_0x2c96ee,'previousPosition':_0x2880e3,'newPosition':_0x49c663,'rankAchieved':_0xa4df4f,'matchId':_0x1ec36b,'timestamp':_0x3d5209||serverTimestamp(),'gameMode':'D3'}),console['log']('D3\x20ELO\x20history\x20recorded\x20for\x20'+_0x415308),!![];}catch(_0x272427){console['error']('Error\x20recording\x20D3\x20ELO\x20history:',_0x272427);throw _0x272427;}}export async function getEloHistoryD3(_0x1b6c95=0x14){const _0x264073=a15_0x3b3ffc;try{const _0x2fa2c8=collection(db,'eloHistoryD3');let _0x5bc76f;lastVisibleD3?_0x5bc76f=query(_0x2fa2c8,orderBy(_0x264073(0x91),'desc'),startAfter(lastVisibleD3),limit(_0x1b6c95)):_0x5bc76f=query(_0x2fa2c8,orderBy('timestamp','desc'),limit(_0x1b6c95));const _0xfc9f9c=await getDocs(_0x5bc76f);if(_0xfc9f9c[_0x264073(0x89)])return{'entries':[],'hasMore':![]};lastVisibleD3=_0xfc9f9c[_0x264073(0x8e)][_0xfc9f9c['docs']['length']-0x1];const _0x10f9c0=_0xfc9f9c['docs']['map'](async _0x4da6f5=>{const _0x29b3b6=_0x264073,_0x1ab994=_0x4da6f5['data'](),[_0x1f7789,_0x504c13]=await Promise['all']([getUsernameByIdD3(_0x1ab994['player']),getUsernameByIdD3(_0x1ab994[_0x29b3b6(0x8a)])]);return{..._0x1ab994,'playerUsername':_0x1f7789,'opponentUsername':_0x504c13,'change':_0x1ab994[_0x29b3b6(0x8c)]-_0x1ab994['previousElo'],'timestamp':_0x1ab994['timestamp']};}),_0x2e17e6=await Promise[_0x264073(0x8b)](_0x10f9c0);return{'entries':_0x2e17e6,'hasMore':_0xfc9f9c['size']===_0x1b6c95};}catch(_0x52fc15){console['error']('Error\x20fetching\x20D3\x20ELO\x20history:',_0x52fc15);throw _0x52fc15;}}export function resetPaginationD3(){lastVisibleD3=null;}
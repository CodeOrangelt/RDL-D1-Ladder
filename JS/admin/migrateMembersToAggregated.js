import{initializeApp}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';import{getFirestore,collection,getDocs,writeBatch,doc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{firebaseConfig}from'../firebase-config.js';const app=initializeApp(firebaseConfig),db=getFirestore(app);function a1_0x5a0b(_0x1e0d09,_0x43be3a){const _0x55b6b0=a1_0x3edd();return a1_0x5a0b=function(_0x576a98,_0x5e8c2f){_0x576a98=_0x576a98-0x6a;let _0x3edd5e=_0x55b6b0[_0x576a98];return _0x3edd5e;},a1_0x5a0b(_0x1e0d09,_0x43be3a);}function a1_0x3edd(){const _0x275d61=['trace','console','active','info','all','emerald','playersD2','set','log','nonParticipants','\x20members\x20to\x20aggregated\x20collection!','get','size','bind','\x20D2,\x20','length','apply','ðŸ’¾\x20Writing\x20aggregated\x20data...','forEach','profileImageUrl','country','motto','has','âœ…\x20Data\x20fetched:\x20','ladders','name','data','sort'];a1_0x3edd=function(){return _0x275d61;};return a1_0x3edd();}async function migrateToAggregatedMembers(){const _0x4a3ad6=a1_0x5a0b,_0x29258d=(function(){let _0x4ad669=!![];return function(_0x43ca44,_0x150a41){const _0x32e58b=_0x4ad669?function(){const _0x360ff9=a1_0x5a0b;if(_0x150a41){const _0x17b4ff=_0x150a41[_0x360ff9(0x7a)](_0x43ca44,arguments);return _0x150a41=null,_0x17b4ff;}}:function(){};return _0x4ad669=![],_0x32e58b;};}()),_0x3ca6ba=_0x29258d(this,function(){const _0x1439eb=a1_0x5a0b,_0x4a8fbc=function(){let _0x40d9a1;try{_0x40d9a1=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x329dc3){_0x40d9a1=window;}return _0x40d9a1;},_0x4e6454=_0x4a8fbc(),_0x2c8642=_0x4e6454[_0x1439eb(0x6b)]=_0x4e6454[_0x1439eb(0x6b)]||{},_0x9e7725=['log','warn',_0x1439eb(0x6d),'error','exception','table',_0x1439eb(0x6a)];for(let _0x2e7d4f=0x0;_0x2e7d4f<_0x9e7725['length'];_0x2e7d4f++){const _0x6697e=_0x29258d['constructor']['prototype']['bind'](_0x29258d),_0x2755c8=_0x9e7725[_0x2e7d4f],_0x139bd1=_0x2c8642[_0x2755c8]||_0x6697e;_0x6697e['__proto__']=_0x29258d[_0x1439eb(0x77)](_0x29258d),_0x6697e['toString']=_0x139bd1['toString']['bind'](_0x139bd1),_0x2c8642[_0x2755c8]=_0x6697e;}});_0x3ca6ba(),console['log']('ðŸ”„\x20Starting\x20migration\x20to\x20aggregated\x20members...');try{console[_0x4a3ad6(0x72)]('ðŸ“¥\x20Fetching\x20all\x20collections...');const [_0x36cb14,_0x452aab,_0x15672e,_0x55d38e,_0x406fe6]=await Promise['all']([getDocs(collection(db,'userProfiles')),getDocs(collection(db,'players')),getDocs(collection(db,_0x4a3ad6(0x70))),getDocs(collection(db,'playersD3')),getDocs(collection(db,_0x4a3ad6(0x73)))]);console[_0x4a3ad6(0x72)](_0x4a3ad6(0x81)+_0x36cb14['size']+'\x20profiles,\x20'+_0x452aab[_0x4a3ad6(0x76)]+'\x20D1,\x20'+_0x15672e['size']+_0x4a3ad6(0x78)+_0x55d38e[_0x4a3ad6(0x76)]+'\x20D3,\x20'+_0x406fe6[_0x4a3ad6(0x76)]+'\x20non-participants');const _0x607099=new Map();_0x36cb14['forEach'](_0x5415a6=>{const _0x539abe=_0x4a3ad6;_0x607099[_0x539abe(0x71)](_0x5415a6['id'],_0x5415a6[_0x539abe(0x84)]());});const _0x277cfc=new Map(),_0x343606=(_0x21a641,_0x13659a)=>{_0x21a641['forEach'](_0x1bf7c5=>{const _0x492926=a1_0x5a0b,_0x1d5000=_0x1bf7c5[_0x492926(0x84)](),_0x1f278f=_0x1bf7c5['id'];!_0x277cfc['has'](_0x1f278f)&&_0x277cfc[_0x492926(0x71)](_0x1f278f,{'userId':_0x1f278f,'username':_0x1d5000['username']||_0x1d5000['name']||'Unknown','ladders':[],'isNonParticipant':![]});const _0x40da33=_0x277cfc['get'](_0x1f278f);_0x40da33[_0x492926(0x82)]['push']({'ladder':_0x13659a,'elo':_0x1d5000['eloRating']||_0x1d5000['elo']||0x4b0,'active':_0x1d5000[_0x492926(0x6c)]!==![]});});};_0x343606(_0x452aab,'D1'),_0x343606(_0x15672e,'D2'),_0x343606(_0x55d38e,'D3'),_0x406fe6['forEach'](_0x112e90=>{const _0x4ed7b=_0x4a3ad6,_0xf7b7a6=_0x112e90['data'](),_0x504f4e=_0x112e90['id'];!_0x277cfc[_0x4ed7b(0x80)](_0x504f4e)&&(_0xf7b7a6['username']||_0xf7b7a6[_0x4ed7b(0x83)])&&_0x277cfc['set'](_0x504f4e,{'userId':_0x504f4e,'username':_0xf7b7a6['username']||_0xf7b7a6['name'],'ladders':[],'isNonParticipant':!![]});}),console['log']('âš™ï¸\x20Processed\x20'+_0x277cfc[_0x4a3ad6(0x76)]+'\x20unique\x20members'),console[_0x4a3ad6(0x72)](_0x4a3ad6(0x7b));const _0x50b497=[];let _0x2e8fc0=writeBatch(db),_0x268b05=0x0,_0x193c33=0x0;_0x277cfc[_0x4a3ad6(0x7c)]((_0x4c858f,_0x220471)=>{const _0x27045e=_0x4a3ad6,_0x427323=_0x607099[_0x27045e(0x75)](_0x220471)||{};let _0x537816=0x0,_0x19ffca=null;if(_0x4c858f['ladders'][_0x27045e(0x79)]>0x0){const _0x5b274e=_0x4c858f['ladders'][_0x27045e(0x85)]((_0x12862f,_0x7ad15a)=>_0x7ad15a['elo']-_0x12862f['elo']);_0x537816=_0x5b274e[0x0]['elo'],_0x19ffca=_0x5b274e[0x0]['ladder'];}const _0x151636={'userId':_0x220471,'username':_0x4c858f['username'],'profileImageUrl':_0x427323[_0x27045e(0x7d)]||null,'country':_0x427323[_0x27045e(0x7e)]||null,'motto':_0x427323[_0x27045e(0x7f)]||null,'favoriteMap':_0x427323['favoriteMap']||null,'favoriteWeapon':_0x427323['favoriteWeapon']||null,'isNonParticipant':_0x4c858f['isNonParticipant'],'ladders':_0x4c858f['ladders'],'primaryLadder':_0x19ffca,'highestElo':_0x537816,'rank':getPlayerRank(_0x537816),'lastUpdated':new Date(),'migrationTimestamp':new Date()['toISOString']()},_0x4e0e73=doc(collection(db,'aggregatedMembers'),_0x220471);_0x2e8fc0[_0x27045e(0x71)](_0x4e0e73,_0x151636),_0x268b05++,_0x193c33++,_0x268b05>=0x1c2&&(_0x50b497['push'](_0x2e8fc0['commit']()),_0x2e8fc0=writeBatch(db),_0x268b05=0x0,console['log']('ðŸ“¦\x20Prepared\x20batch\x20'+_0x50b497[_0x27045e(0x79)]+'\x20('+_0x193c33+'\x20members\x20processed)'));}),_0x268b05>0x0&&_0x50b497['push'](_0x2e8fc0['commit']()),console[_0x4a3ad6(0x72)]('ðŸš€\x20Executing\x20'+_0x50b497[_0x4a3ad6(0x79)]+'\x20batches...'),await Promise[_0x4a3ad6(0x6e)](_0x50b497),console['log']('ðŸŽ‰\x20Successfully\x20migrated\x20'+_0x277cfc['size']+_0x4a3ad6(0x74)),console[_0x4a3ad6(0x72)]('ðŸ’¡\x20Refresh\x20your\x20members\x20page\x20to\x20see\x20the\x20results!');}catch(_0x1081ab){console['error']('âŒ\x20Migration\x20failed:',_0x1081ab),_0x1081ab['code']==='permission-denied'&&console['error']('ðŸ”’\x20Permission\x20denied.\x20Make\x20sure\x20you\x27re\x20signed\x20in\x20as\x20an\x20admin\x20and\x20security\x20rules\x20allow\x20access\x20to\x20aggregatedMembers\x20collection.');}}function getPlayerRank(_0x48129a){const _0x58479d=a1_0x5a0b;if(_0x48129a>=0x7d0)return _0x58479d(0x6f);if(_0x48129a>=0x708)return'gold';if(_0x48129a>=0x640)return'silver';if(_0x48129a>=0x578)return'bronze';return'unranked';}migrateToAggregatedMembers();
const a46_0x128264=a46_0x40c8,a46_0xfc1a7c=(function(){let _0x5308df=!![];return function(_0x12c4d0,_0xa52c5){const _0x1dd65a=_0x5308df?function(){const _0x2e7d0a=a46_0x40c8;if(_0xa52c5){const _0x1819b7=_0xa52c5[_0x2e7d0a(0xd6)](_0x12c4d0,arguments);return _0xa52c5=null,_0x1819b7;}}:function(){};return _0x5308df=![],_0x1dd65a;};}()),a46_0x457e67=a46_0xfc1a7c(this,function(){const _0x384c0b=a46_0x40c8,_0x566778=function(){let _0x33cf9d;try{_0x33cf9d=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x2d56c9){_0x33cf9d=window;}return _0x33cf9d;},_0x39ae10=_0x566778(),_0x1ef520=_0x39ae10['console']=_0x39ae10['console']||{},_0x2ca092=[_0x384c0b(0xc7),'warn','info','error',_0x384c0b(0xd0),'table','trace'];for(let _0x5122eb=0x0;_0x5122eb<_0x2ca092['length'];_0x5122eb++){const _0x22fce5=a46_0xfc1a7c['constructor']['prototype']['bind'](a46_0xfc1a7c),_0xb7ff9d=_0x2ca092[_0x5122eb],_0x2fe124=_0x1ef520[_0xb7ff9d]||_0x22fce5;_0x22fce5['__proto__']=a46_0xfc1a7c[_0x384c0b(0xd5)](a46_0xfc1a7c),_0x22fce5['toString']=_0x2fe124['toString']['bind'](_0x2fe124),_0x1ef520[_0xb7ff9d]=_0x22fce5;}});a46_0x457e67();import{getAuth,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{getFirestore,doc,getDoc,setDoc,updateDoc,collection,addDoc,serverTimestamp}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{clearTokenCache}from'./tokens.js';const auth=getAuth(),db=getFirestore(),THEMES={'default':{'price':0x0,'name':'Classic\x20RDL','description':'Rock\x20texture\x20with\x20a\x20sleek\x20nav\x20and\x20footer'},'purple':{'price':0x96,'name':'Purple','description':'Can\x27t\x20get\x20enough'},'cyberpunk':{'price':0x190,'name':'Yellow\x20Orange','description':'This\x20theme\x20makes\x20me\x20happy'},'emerald':{'price':0x3e8,'name':'Emerald','description':a46_0x128264(0x10a)},'gold':{'price':0x320,'name':a46_0x128264(0xc2),'description':'Only\x20the\x20best\x20get\x20this\x20one'},'contrast':{'price':0x0,'name':'Black\x20&\x20White','description':a46_0x128264(0xbf)},'ocean':{'price':0x12c,'name':'Blue','description':'This\x20one\x20is\x20really\x20pretty'},'volcanic':{'price':0x1f4,'name':'Red','description':a46_0x128264(0xc6)}},TOKENS={'blob01':{'price':0x1f4,'name':'Blob\x20Token\x201','description':a46_0x128264(0x13a),'image':a46_0x128264(0x109),'category':'blob'},'blob02':{'price':0x3e8,'name':a46_0x128264(0x11f),'description':'Another\x20enigmatic\x20blob\x20creature','image':a46_0x128264(0x117),'category':'blob'},'blob03':{'price':0x7d0,'name':a46_0x128264(0xba),'description':'The\x20final\x20blob\x20in\x20the\x20collection','image':'../images/tokens/blob03.gif','category':'blob'},'cloak':{'price':0x1f4,'name':'Cloaking\x20Device','description':'Become\x20one\x20with\x20the\x20shadows','image':'../images/tokens/cloak.gif','category':'special'},'gauge18':{'price':0x320,'name':a46_0x128264(0x122),'description':a46_0x128264(0x13c),'image':'../images/tokens/gauge18.gif','category':'equipment'},'fusion':{'price':0x15e,'name':a46_0x128264(0x110),'description':a46_0x128264(0xbb),'image':'../images/tokens/subgame/fusion.gif','category':'weapon'},'mmissile':{'price':0x320,'name':a46_0x128264(0x134),'description':'Heavy\x20ordinance\x20for\x20tough\x20situations','image':a46_0x128264(0x104),'category':'weapon'},'pbomb':{'price':0x15e,'name':'Proximity\x20Bomb','description':'Strategic\x20explosive\x20device','image':'../images/tokens/subgame/pbomb.gif','category':'weapon'},'pwr01':{'price':0x64,'name':a46_0x128264(0x131),'description':'Enhanced\x20energy\x20generation\x20unit','image':'../images/tokens/subgame/pwr01.gif','category':'powerup'},'pwr02':{'price':0x258,'name':'Shield\x20Orb','description':'Advanced\x20energy\x20storage\x20system','image':'../images/tokens/subgame/pwr02.gif','category':a46_0x128264(0xe4)},'smissile':{'price':0x28a,'name':'Smart\x20Missile','description':'Intelligent\x20targeting\x20system','image':'../images/tokens/subgame/smissile.gif','category':'weapon'}};let userData={'points':0x0,'inventory':[],'isAdmin':![]},storeContainer,pointsDisplay,authWarning;document['addEventListener']('DOMContentLoaded',()=>{const _0x360590=a46_0x128264;console['log']('üè™\x20Redeem\x20store\x20initializing...'),storeContainer=document[_0x360590(0xf1)](_0x360590(0xe3)),pointsDisplay=document['getElementById']('user-points'),authWarning=document['getElementById']('auth-warning'),initAuthListener(),buildStoreUI();});function initAuthListener(){onAuthStateChanged(auth,async _0xdbc102=>{const _0x118ecd=a46_0x40c8;if(_0xdbc102){console['log']('‚úÖ\x20User\x20authenticated:',_0xdbc102['displayName']||_0xdbc102['email']);if(authWarning)authWarning['style'][_0x118ecd(0x127)]='none';if(storeContainer)storeContainer[_0x118ecd(0x130)][_0x118ecd(0x127)]='block';await loadUserData(_0xdbc102),updateThemeButtons(),updateTokenButtons();}else{console['log'](_0x118ecd(0x13f));if(authWarning)authWarning['style'][_0x118ecd(0x127)]='block';if(storeContainer)storeContainer['style'][_0x118ecd(0x127)]='none';userData={'points':0x0,'inventory':[],'isAdmin':![]},window['isUserAdmin']=![];}});}function a46_0x19ca(){const _0x1dbeeb=['Blob\x20Token\x203','Devastating\x20fusion\x20weapon\x20technology','exists','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22token-sell-btn\x20admin-btn\x22\x20style=\x22margin-top:\x200.5rem;\x20background:\x20#f44336;\x20font-size:\x200.8rem;\x20padding:\x200.3rem;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Sell\x20(','owned','You\x20can\x20see\x20better!','innerHTML','dataset','Gold','Buy','Permission\x20denied.\x20Token\x20may\x20still\x20be\x20equipped\x20-\x20check\x20the\x20ladder.','can-afford','For\x20the\x20angry\x20type.','log','closest','disabled','visible','\x20theme\x20applied!','\x20points\x20to\x20purchase\x20this\x20token','uid','\x20points?\x20This\x20cannot\x20be\x20undone.','\x20saved\x20to\x20userTokens\x20collection\x20(not\x20equipped)','exception','isAdmin','Please\x20sign\x20in\x20to\x20equip\x20tokens','itemId','.token-equip-btn','bind','apply','Token\x20','üîÑ\x20Refreshing\x20ladder\x20to\x20remove\x20unequipped\x20token','data','floor','\x20points','Sign\x20in\x20to\x20Purchase','Token\x20sale\x20failed:','add','store-item','purchase','Failed\x20to\x20unequip\x20token:\x20','Token\x20unequipped!\x20Ladder\x20will\x20refresh\x20shortly.','store-content','powerup','RedeemStore','Purchase\x20','\x20is\x20already\x20your\x20current\x20theme','function','Need\x20','error','currentUser','equippedToken','confirm','token','querySelector','\x20more\x20points.','getElementById','tokenId','Owned','className','name','Error\x20loading\x20user\x20data:','push','addEventListener','ThemeSystem','Token\x20collection\x20update\x20had\x20an\x20issue,\x20but\x20equip\x20was\x20successful:','code','displayName','success','remove','inventory','Insufficient\x20points','\x20for\x20','default','classList','../images/tokens/subgame/mmissile.gif','toLocaleString','var(--info-color,\x20#17a2b8)','userTokens','parentNode','../images/tokens/blob01.gif','Emerald\x20City!','switchTheme','points','image','Purchase\x20failed.\x20Please\x20try\x20again.','.token-select-btn','Fusion\x20Cannon','sign-in-paid','info','\x20not\x20found','dispatchEvent','cannot-afford','userProfiles','../images/tokens/blob02.gif','cursor','email','block','Unexpected\x20token\x20error:','Token\x20unequip\x20failed:','var(--accent-color,\x20#2196F3)','Equipped','Blob\x20Token\x202','createElement','.token-sell-btn','R/Y/B\x20Keys','warning','preventDefault','‚úÖ\x20Token\x20','\x20token','display','textContent','\x20Points','querySelectorAll','unauthenticated','You\x20already\x20own\x20this\x20','click','[data-token]','price','style','Energy','Apply\x20Theme','Theme\x20clicked:\x20','Mega\x20Missile','message','includes','forEach','opacity','User','A\x20mysterious\x20purple\x20blob\x20token','Token\x20purchase\x20failed:','Monitor\x20your\x20ship\x27s\x20energy\x20levels','theme_','current-theme','‚ùå\x20User\x20not\x20authenticated','You\x20must\x20purchase\x20this\x20theme\x20first','theme'];a46_0x19ca=function(){return _0x1dbeeb;};return a46_0x19ca();}async function loadUserData(_0x184584){const _0x5751bc=a46_0x128264;try{const _0x37467f=doc(db,_0x5751bc(0x116),_0x184584['uid']),_0x4b75a7=await getDoc(_0x37467f);if(_0x4b75a7[_0x5751bc(0xbc)]()){const _0x3fd2d6=_0x4b75a7['data']();userData={'points':_0x3fd2d6['points']||0x0,'inventory':_0x3fd2d6['inventory']||[],'isAdmin':_0x3fd2d6[_0x5751bc(0xd1)]||![],'equippedToken':_0x3fd2d6[_0x5751bc(0xec)]||null},pointsDisplay&&(pointsDisplay['textContent']=userData['points'][_0x5751bc(0x105)]()),window['isUserAdmin']=userData[_0x5751bc(0xd1)],userData['isAdmin']&&(console['log']('üëë\x20Admin\x20controls\x20enabled'),window[_0x5751bc(0x114)](new CustomEvent('adminStatusChanged',{'detail':{'isAdmin':!![]}}))),console['log']('User\x20data\x20loaded\x20-\x20Points:\x20'+userData['points']+',\x20Inventory:\x20'+userData['inventory']['length']+'\x20items,\x20Equipped:\x20'+(userData['equippedToken']||'none'));}else await setDoc(_0x37467f,{'points':0x0,'inventory':[],'equippedToken':null,'createdAt':serverTimestamp(),'username':_0x184584[_0x5751bc(0xfc)]||_0x184584['email']?.['split']('@')[0x0]||_0x5751bc(0x139)}),userData={'points':0x0,'inventory':[],'isAdmin':![],'equippedToken':null},pointsDisplay&&(pointsDisplay[_0x5751bc(0x128)]='0'),window['isUserAdmin']=![],console['log']('New\x20user\x20profile\x20created');}catch(_0x1b5191){console['error'](_0x5751bc(0xf6),_0x1b5191);}}function userOwnsTheme(_0x499e08){const _0x55c4ea=a46_0x128264;if(THEMES[_0x499e08]?.[_0x55c4ea(0x12f)]===0x0)return!![];return userData['inventory']['includes']('theme_'+_0x499e08);}function userOwnsToken(_0x3e9b9a){const _0x7a958e=a46_0x128264;return userData['inventory'][_0x7a958e(0x136)]('token_'+_0x3e9b9a);}function userHasTokenEquipped(_0x414f58){return userData['equippedToken']===_0x414f58;}function getEquippedToken(){return userData['equippedToken']||null;}async function purchaseTheme(_0x48bb07){const _0x596df0=a46_0x128264,_0x510f76=auth['currentUser'];if(!_0x510f76)return showMessage('Please\x20sign\x20in\x20to\x20purchase\x20themes','error'),![];const _0x301299=THEMES[_0x48bb07];if(!_0x301299)return console['error']('Theme\x20'+_0x48bb07+'\x20not\x20found'),![];if(userData[_0x596df0(0x10c)]<_0x301299['price'])return showMessage('Not\x20enough\x20points.\x20You\x20need\x20'+(_0x301299[_0x596df0(0x12f)]-userData['points'])+_0x596df0(0xf0),'error'),![];if(userOwnsTheme(_0x48bb07))return showMessage('You\x20already\x20own\x20the\x20'+_0x301299['name']+'\x20theme','info'),![];try{return await processPurchase(_0x48bb07,_0x301299,_0x596df0(0x141));}catch(_0x55c65e){return console['error']('Theme\x20purchase\x20failed:',_0x55c65e),showMessage('Purchase\x20failed.\x20Please\x20try\x20again.','error'),![];}}async function purchaseToken(_0x323dfa){const _0x2c51cb=a46_0x128264,_0xd21980=auth[_0x2c51cb(0xeb)];if(!_0xd21980)return showMessage('Please\x20sign\x20in\x20to\x20purchase\x20tokens',_0x2c51cb(0xea)),![];const _0x2c8c8a=TOKENS[_0x323dfa];if(!_0x2c8c8a)return console['error']('Token\x20'+_0x323dfa+'\x20not\x20found'),![];if(userData['points']<_0x2c8c8a['price'])return showMessage('Not\x20enough\x20points.\x20You\x20need\x20'+(_0x2c8c8a[_0x2c51cb(0x12f)]-userData['points'])+'\x20more\x20points.','error'),![];if(userOwnsToken(_0x323dfa))return showMessage('You\x20already\x20own\x20the\x20'+_0x2c8c8a['name']+_0x2c51cb(0x126),_0x2c51cb(0x112)),![];try{return await processPurchase(_0x323dfa,_0x2c8c8a,'token');}catch(_0x10d548){return console[_0x2c51cb(0xea)](_0x2c51cb(0x13b),_0x10d548),showMessage('Purchase\x20failed.\x20Please\x20try\x20again.','error'),![];}}async function processPurchase(_0x3e8975,_0x329f34,_0x9f0cd){const _0x18a648=a46_0x128264,_0x4ac480=auth[_0x18a648(0xeb)];try{const _0x3c0049=doc(db,'userProfiles',_0x4ac480['uid']),_0x2d8361=await getDoc(_0x3c0049);if(!_0x2d8361['exists']())return showMessage('User\x20profile\x20not\x20found','error'),![];const _0x2510ee=_0x2d8361[_0x18a648(0xd9)](),_0x1af59b=_0x2510ee[_0x18a648(0x10c)]||0x0,_0x594ba4=_0x2510ee['inventory']||[];if(_0x1af59b<_0x329f34['price'])return showMessage(_0x18a648(0x100),'error'),![];if(_0x594ba4['includes'](_0x9f0cd+'_'+_0x3e8975))return showMessage(_0x18a648(0x12c)+_0x9f0cd,_0x18a648(0x112)),![];const _0x276b93=_0x1af59b-_0x329f34['price'],_0x306d23=[..._0x594ba4,_0x9f0cd+'_'+_0x3e8975];await updateDoc(_0x3c0049,{'points':_0x276b93,'inventory':_0x306d23,'lastPurchase':serverTimestamp()});if(_0x9f0cd==='token')try{const _0x38ee50=doc(db,_0x18a648(0x107),_0x4ac480['uid']),_0xea0fd=await getDoc(_0x38ee50);let _0x252cf7=[];_0xea0fd['exists']()&&(_0x252cf7=_0xea0fd[_0x18a648(0xd9)]()['tokens']||[]);const _0x448138=new Date();_0x252cf7[_0x18a648(0xf7)]({'tokenId':_0x3e8975,'tokenName':_0x329f34['name'],'tokenImage':_0x329f34['image'],'category':_0x329f34['category'],'purchasedAt':_0x448138,'price':_0x329f34[_0x18a648(0x12f)],'equipped':![]}),await setDoc(_0x38ee50,{'userId':_0x4ac480['uid'],'username':_0x2510ee['username']||_0x4ac480[_0x18a648(0xfc)]||'Unknown','tokens':_0x252cf7,'lastUpdated':serverTimestamp()},{'merge':!![]}),typeof clearTokenCache===_0x18a648(0xe8)&&clearTokenCache(_0x4ac480['uid']),console[_0x18a648(0xc7)](_0x18a648(0x125)+_0x3e8975+_0x18a648(0xcf));}catch(_0x8910d2){console['warn']('Token\x20collection\x20update\x20had\x20an\x20issue,\x20but\x20purchase\x20completed:',_0x8910d2),_0x8910d2['code']==='permission-denied'?console[_0x18a648(0xc7)]('üîß\x20Token\x20permissions\x20issue\x20detected,\x20but\x20purchase\x20was\x20successful'):console['error'](_0x18a648(0x11b),_0x8910d2);}try{await addDoc(collection(db,'transactions'),{'userId':_0x4ac480['uid'],'userEmail':_0x4ac480[_0x18a648(0x119)],'itemId':_0x9f0cd+'_'+_0x3e8975,'itemTitle':_0x329f34['name'],'price':_0x329f34['price'],'type':_0x18a648(0xe0),'category':_0x9f0cd,'timestamp':serverTimestamp()});}catch(_0x281510){console['warn']('Transaction\x20logging\x20failed,\x20but\x20purchase\x20was\x20successful:',_0x281510);}return userData['points']=_0x276b93,userData[_0x18a648(0xff)]=_0x306d23,pointsDisplay&&(pointsDisplay['textContent']=userData['points']['toLocaleString']()),updateTokenButtons(),_0x9f0cd==='theme'&&updateThemeButtons(),console['log']('‚úÖ\x20Purchased\x20'+_0x329f34['name']+'\x20for\x20'+_0x329f34['price']+_0x18a648(0xdb)),showMessage('Successfully\x20purchased\x20'+_0x329f34['name']+'!\x20Use\x20the\x20\x22Equip\x22\x20button\x20to\x20show\x20it\x20on\x20the\x20ladder.','success'),!![];}catch(_0x11e373){console['error']('Purchase\x20processing\x20error:',_0x11e373);if(_0x11e373[_0x18a648(0xfb)]==='permission-denied')showMessage('Permission\x20denied.\x20Please\x20try\x20again\x20or\x20contact\x20support.','error');else{if(_0x11e373[_0x18a648(0xfb)]==='unavailable')showMessage('Service\x20temporarily\x20unavailable.\x20Please\x20try\x20again.',_0x18a648(0xea));else _0x11e373['code']===_0x18a648(0x12b)?showMessage('Please\x20sign\x20in\x20again\x20to\x20complete\x20purchase.','error'):showMessage(_0x18a648(0x10e),'error');}return![];}}async function equipToken(_0x3ce02f){const _0x318c18=a46_0x128264,_0x2b1987=auth['currentUser'];if(!_0x2b1987)return showMessage(_0x318c18(0xd2),'error'),![];const _0x2bfae6=TOKENS[_0x3ce02f];if(!_0x2bfae6)return console['error']('Token\x20'+_0x3ce02f+_0x318c18(0x113)),![];if(!userOwnsToken(_0x3ce02f))return showMessage('You\x20must\x20own\x20this\x20token\x20to\x20equip\x20it','error'),![];try{const _0x4aef4e=doc(db,'userProfiles',_0x2b1987[_0x318c18(0xcd)]);await updateDoc(_0x4aef4e,{'equippedToken':_0x3ce02f,'lastTokenEquip':serverTimestamp()});try{const _0x24281a=doc(db,_0x318c18(0x107),_0x2b1987[_0x318c18(0xcd)]),_0x419ac9=await getDoc(_0x24281a);if(_0x419ac9[_0x318c18(0xbc)]()){const _0x826795=_0x419ac9['data'](),_0x2aa873=_0x826795['tokens']||[],_0x5ee7a1=_0x2aa873['map'](_0x4c43ba=>({..._0x4c43ba,'equipped':_0x4c43ba[_0x318c18(0xf2)]===_0x3ce02f}));await updateDoc(_0x24281a,{'tokens':_0x5ee7a1,'equippedToken':_0x3ce02f,'lastUpdated':serverTimestamp()});}}catch(_0x359fe3){console['warn'](_0x318c18(0xfa),_0x359fe3);}return userData[_0x318c18(0xec)]=_0x3ce02f,typeof clearTokenCache==='function'&&(clearTokenCache(_0x2b1987[_0x318c18(0xcd)]),clearTokenCache()),setTimeout(()=>{const _0x969a87=_0x318c18;window['displayLadder']&&typeof window['displayLadder']==='function'&&(console['log']('üîÑ\x20Refreshing\x20ladder\x20to\x20show\x20equipped\x20token'),window['displayLadder'](!![])),window['RedeemStore']&&typeof window['RedeemStore']['refreshUI']===_0x969a87(0xe8)&&window['RedeemStore']['refreshUI']();},0x1f4),console[_0x318c18(0xc7)]('‚úÖ\x20Equipped\x20token:\x20'+_0x2bfae6['name']),showMessage(_0x2bfae6[_0x318c18(0xf5)]+'\x20equipped!\x20Ladder\x20will\x20refresh\x20shortly.','success'),!![];}catch(_0xb7c116){return console['error']('Token\x20equip\x20failed:',_0xb7c116),_0xb7c116[_0x318c18(0xfb)]==='permission-denied'?showMessage(_0x318c18(0xc4),_0x318c18(0x123)):showMessage('Failed\x20to\x20equip\x20token:\x20'+_0xb7c116['message'],'error'),![];}}function a46_0x40c8(_0x4d75e7,_0xbe46e3){const _0x457e67=a46_0x19ca();return a46_0x40c8=function(_0xfc1a7c,_0x41313e){_0xfc1a7c=_0xfc1a7c-0xba;let _0x19ca69=_0x457e67[_0xfc1a7c];return _0x19ca69;},a46_0x40c8(_0x4d75e7,_0xbe46e3);}async function unequipToken(){const _0x45fadd=a46_0x128264,_0x484d28=auth['currentUser'];if(!_0x484d28)return showMessage('Please\x20sign\x20in\x20to\x20unequip\x20tokens','error'),![];if(!userData['equippedToken'])return showMessage('No\x20token\x20is\x20currently\x20equipped','info'),![];try{const _0x57588c=doc(db,'userProfiles',_0x484d28['uid']);await updateDoc(_0x57588c,{'equippedToken':null,'lastTokenEquip':serverTimestamp()});const _0x43ab7e=doc(db,_0x45fadd(0x107),_0x484d28[_0x45fadd(0xcd)]),_0x553494=await getDoc(_0x43ab7e);if(_0x553494['exists']()){const _0x35ebb1=_0x553494[_0x45fadd(0xd9)](),_0x155166=_0x35ebb1['tokens']||[],_0x8c0e05=_0x155166['map'](_0x1a5e03=>({..._0x1a5e03,'equipped':![]}));await updateDoc(_0x43ab7e,{'tokens':_0x8c0e05,'equippedToken':null,'lastUpdated':serverTimestamp()});}return userData['equippedToken']=null,typeof clearTokenCache==='function'&&(clearTokenCache(_0x484d28[_0x45fadd(0xcd)]),clearTokenCache()),setTimeout(()=>{const _0x540150=_0x45fadd;window['displayLadder']&&typeof window['displayLadder']===_0x540150(0xe8)&&(console[_0x540150(0xc7)](_0x540150(0xd8)),window['displayLadder'](!![])),window[_0x540150(0xe5)]&&typeof window['RedeemStore']['refreshUI']===_0x540150(0xe8)&&window['RedeemStore']['refreshUI']();},0x1f4),console[_0x45fadd(0xc7)]('‚úÖ\x20Token\x20unequipped'),showMessage(_0x45fadd(0xe2),'success'),!![];}catch(_0x2ae3b2){return console['error'](_0x45fadd(0x11c),_0x2ae3b2),showMessage(_0x45fadd(0xe1)+_0x2ae3b2[_0x45fadd(0x135)],'error'),![];}}async function sellToken(_0x1295ea){const _0x3fce37=a46_0x128264,_0x132400=auth['currentUser'];if(!_0x132400)return showMessage('Please\x20sign\x20in\x20to\x20sell\x20tokens','error'),![];if(!userData[_0x3fce37(0xd1)])return showMessage('Only\x20admins\x20can\x20sell\x20tokens','error'),![];const _0x23ed88=TOKENS[_0x1295ea];if(!_0x23ed88)return console['error'](_0x3fce37(0xd7)+_0x1295ea+'\x20not\x20found'),![];if(!userOwnsToken(_0x1295ea))return showMessage('You\x20don\x27t\x20own\x20this\x20token',_0x3fce37(0xea)),![];try{const _0x3653b1=doc(db,_0x3fce37(0x116),_0x132400['uid']),_0x4a5845=await getDoc(_0x3653b1),_0x1fa3f9=_0x4a5845[_0x3fce37(0xd9)](),_0x4bdad6=Math['floor'](_0x23ed88['price']*0.5),_0x558372=(_0x1fa3f9[_0x3fce37(0x10c)]||0x0)+_0x4bdad6,_0x4443fc=(_0x1fa3f9['inventory']||[])['filter'](_0x23af01=>_0x23af01!=='token_'+_0x1295ea),_0x39accf=_0x1fa3f9['equippedToken']===_0x1295ea?null:_0x1fa3f9['equippedToken'];await updateDoc(_0x3653b1,{'points':_0x558372,'inventory':_0x4443fc,'equippedToken':_0x39accf,'lastSale':serverTimestamp()});const _0x23a5a0=doc(db,_0x3fce37(0x107),_0x132400['uid']),_0x2e4ccd=await getDoc(_0x23a5a0);if(_0x2e4ccd[_0x3fce37(0xbc)]()){const _0x1faf60=_0x2e4ccd[_0x3fce37(0xd9)](),_0x5c5365=_0x1faf60['tokens']||[],_0x55fedc=_0x5c5365['filter'](_0x16c082=>_0x16c082[_0x3fce37(0xf2)]!==_0x1295ea);await updateDoc(_0x23a5a0,{'tokens':_0x55fedc,'equippedToken':_0x39accf,'lastUpdated':serverTimestamp()});}return await addDoc(collection(db,'transactions'),{'userId':_0x132400['uid'],'userEmail':_0x132400[_0x3fce37(0x119)],'itemId':'token_'+_0x1295ea,'itemTitle':_0x23ed88[_0x3fce37(0xf5)],'refund':_0x4bdad6,'originalPrice':_0x23ed88['price'],'type':'sale','category':'token','timestamp':serverTimestamp()}),userData['points']=_0x558372,userData['inventory']=_0x4443fc,userData['equippedToken']=_0x39accf,pointsDisplay&&(pointsDisplay['textContent']=userData[_0x3fce37(0x10c)]['toLocaleString']()),typeof clearTokenCache==='function'&&clearTokenCache(_0x132400[_0x3fce37(0xcd)]),console[_0x3fce37(0xc7)]('‚úÖ\x20Sold\x20token\x20'+_0x23ed88['name']+'\x20for\x20'+_0x4bdad6+'\x20points'),showMessage('Sold\x20'+_0x23ed88['name']+'\x20for\x20'+_0x4bdad6+'\x20points\x20(50%\x20refund)','success'),!![];}catch(_0x278aa7){return console['error'](_0x3fce37(0xdd),_0x278aa7),showMessage('Failed\x20to\x20sell\x20token:\x20'+_0x278aa7[_0x3fce37(0x135)],'error'),![];}}function applyTheme(_0x39b164){const _0x1da0fd=a46_0x128264;if(!userOwnsTheme(_0x39b164))return showMessage(_0x1da0fd(0x140),'error'),![];return window['ThemeSystem']?(window[_0x1da0fd(0xf9)][_0x1da0fd(0x10b)](_0x39b164),showMessage((THEMES[_0x39b164]?.['name']||_0x39b164)+_0x1da0fd(0xcb),'success'),!![]):(console['error']('Theme\x20system\x20not\x20found'),![]);}function buildStoreUI(){buildThemeItems(),buildTokenItems();}function buildThemeItems(){const _0x141dff=a46_0x128264,_0x4630c2=document['querySelector']('.themes-grid');if(!_0x4630c2){console[_0x141dff(0xea)]('Themes\x20container\x20not\x20found');return;}_0x4630c2['innerHTML']='',Object['entries'](THEMES)['forEach'](([_0x4886a4,_0x5b7876])=>{const _0x1c56d7=_0x141dff,_0xedd9de=document['createElement']('div');_0xedd9de['className']=_0x1c56d7(0xdf),_0xedd9de[_0x1c56d7(0xc1)]['theme']=_0x4886a4,_0xedd9de[_0x1c56d7(0xc1)][_0x1c56d7(0xd3)]=_0x1c56d7(0x13d)+_0x4886a4,_0xedd9de['dataset'][_0x1c56d7(0x12f)]=_0x5b7876[_0x1c56d7(0x12f)],_0xedd9de[_0x1c56d7(0xc0)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22item-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22item-icon\x20theme-icon-'+_0x4886a4+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-palette\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22item-price\x22>'+(_0x5b7876['price']===0x0?'FREE':_0x5b7876['price']+'\x20Points')+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22item-title\x22>'+_0x5b7876['name']+'</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22item-description\x22>'+_0x5b7876['description']+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22theme-select-btn\x20purchase-btn\x22>Select\x20Theme</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x4630c2['appendChild'](_0xedd9de);}),setupThemeButtons();}function buildTokenItems(){const _0x4ddf23=a46_0x128264,_0x21c26a=document['querySelector']('.tokens-grid');if(!_0x21c26a){console[_0x4ddf23(0xea)]('Tokens\x20container\x20not\x20found');return;}_0x21c26a['innerHTML']='',Object['entries'](TOKENS)['forEach'](([_0x219367,_0x24428d])=>{const _0x3a75d4=_0x4ddf23,_0x20a404=document[_0x3a75d4(0x120)]('div');_0x20a404[_0x3a75d4(0xf4)]='store-item\x20token-item',_0x20a404['dataset']['token']=_0x219367,_0x20a404['dataset']['itemId']='token_'+_0x219367,_0x20a404[_0x3a75d4(0xc1)]['price']=_0x24428d['price'];const _0x5356d0=userData[_0x3a75d4(0xd1)]&&userOwnsToken(_0x219367)?_0x3a75d4(0xbd)+Math[_0x3a75d4(0xda)](_0x24428d[_0x3a75d4(0x12f)]*0.5)+'\x20pts)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20':'';_0x20a404['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22item-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22item-icon\x20token-icon\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22'+_0x24428d[_0x3a75d4(0x10d)]+'\x22\x20alt=\x22'+_0x24428d['name']+'\x22\x20class=\x22token-preview\x22\x20onerror=\x22this.style.display=\x27none\x27;\x20this.nextElementSibling.style.display=\x27flex\x27;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22token-fallback\x22\x20style=\x22display:\x20none;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-coins\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22item-price\x22>'+_0x24428d['price']+'\x20Points</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22token-select-btn\x20purchase-btn\x22>Purchase</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22token-equip-btn\x20equip-btn\x22\x20style=\x22margin-top:\x200.5rem;\x20display:\x20none;\x22>Equip</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x5356d0+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x21c26a['appendChild'](_0x20a404);}),setupTokenButtons();}function setupThemeButtons(){const _0x55e350=a46_0x128264,_0xc68654=document[_0x55e350(0x12a)]('.theme-select-btn');_0xc68654[_0x55e350(0x137)](_0x5a47d5=>{const _0x14175f=_0x55e350;_0x5a47d5['addEventListener'](_0x14175f(0x12d),async _0x3408ab=>{const _0x2eae12=_0x14175f;_0x3408ab[_0x2eae12(0x124)]();const _0x35e1fd=auth['currentUser'];if(!_0x35e1fd){showMessage('Please\x20sign\x20in\x20to\x20select\x20themes','error');return;}const _0x1d214f=_0x5a47d5['closest']('[data-theme]'),_0xae8745=_0x1d214f['dataset']['theme'],_0x1fddfe=THEMES[_0xae8745];if(!_0x1fddfe){console['error']('Theme\x20'+_0xae8745+_0x2eae12(0x113));return;}console['log'](_0x2eae12(0x133)+_0x1fddfe['name']+'\x20('+_0xae8745+')');if(_0x5a47d5['disabled']){_0x1fddfe[_0x2eae12(0x12f)]>0x0&&showMessage('You\x20need\x20'+_0x1fddfe['price']+'\x20points\x20to\x20purchase\x20this\x20theme','error');return;}if(_0x5a47d5['textContent']==='Current\x20Theme'){showMessage(_0x1fddfe[_0x2eae12(0xf5)]+_0x2eae12(0xe7),'info');return;}if(_0x5a47d5['textContent']===_0x2eae12(0x132)){applyTheme(_0xae8745),updateThemeButtons();return;}if(_0x5a47d5[_0x2eae12(0x128)]['includes'](_0x2eae12(0xc3))){const _0x2af9d6=window[_0x2eae12(0xed)]('Purchase\x20'+_0x1fddfe['name']+'\x20theme\x20for\x20'+_0x1fddfe['price']+'\x20points?');if(!_0x2af9d6)return;const _0x532301=await purchaseTheme(_0xae8745);_0x532301&&(showMessage(_0x1fddfe['name']+'\x20theme\x20purchased!',_0x2eae12(0xfd)),applyTheme(_0xae8745),updateThemeButtons());return;}userOwnsTheme(_0xae8745)?applyTheme(_0xae8745):showMessage('You\x20must\x20purchase\x20this\x20theme\x20first','error');});}),updateThemeButtons();}function setupTokenButtons(){const _0x3ccf3d=a46_0x128264,_0x3d00a8=document[_0x3ccf3d(0x12a)](_0x3ccf3d(0x10f)),_0x5446da=document['querySelectorAll']('.token-equip-btn'),_0xdea0b6=document[_0x3ccf3d(0x12a)]('.token-sell-btn');_0x3d00a8['forEach'](_0x403a86=>{const _0x4a4714=_0x3ccf3d;_0x403a86[_0x4a4714(0xf8)]('click',async _0x4459ee=>{const _0x4de524=_0x4a4714;_0x4459ee['preventDefault']();const _0x44512a=auth[_0x4de524(0xeb)];if(!_0x44512a){showMessage('Please\x20sign\x20in\x20to\x20purchase\x20tokens','error');return;}const _0xee6220=_0x403a86['closest']('[data-token]'),_0x572edc=_0xee6220['dataset'][_0x4de524(0xee)],_0x42dc0b=TOKENS[_0x572edc];if(!_0x42dc0b){console[_0x4de524(0xea)]('Token\x20'+_0x572edc+'\x20not\x20found');return;}console['log']('Token\x20clicked:\x20'+_0x42dc0b['name']+'\x20('+_0x572edc+')');if(_0x403a86['disabled']){showMessage('You\x20need\x20'+_0x42dc0b['price']+_0x4de524(0xcc),'error');return;}if(_0x403a86['textContent']===_0x4de524(0xf3)){showMessage('You\x20already\x20own\x20the\x20'+_0x42dc0b['name']+_0x4de524(0x126),_0x4de524(0x112));return;}if(_0x403a86[_0x4de524(0x128)][_0x4de524(0x136)]('Purchase')||_0x403a86['textContent']['includes'](_0x4de524(0xc3))){const _0x25bc72=window['confirm'](_0x4de524(0xe6)+_0x42dc0b['name']+'\x20token\x20for\x20'+_0x42dc0b['price']+'\x20points?');if(!_0x25bc72)return;const _0x53739b=await purchaseToken(_0x572edc);_0x53739b&&updateTokenButtons();return;}});}),_0x5446da[_0x3ccf3d(0x137)](_0x64d596=>{const _0x4d7652=_0x3ccf3d;_0x64d596[_0x4d7652(0xf8)]('click',async _0x1b814f=>{const _0x444025=_0x4d7652;_0x1b814f['preventDefault']();const _0x3b3412=_0x64d596[_0x444025(0xc8)]('[data-token]'),_0x1f242f=_0x3b3412['dataset']['token'],_0x351df2=TOKENS[_0x1f242f];if(_0x64d596['textContent']==='Equipped'){const _0x227beb=window['confirm']('Unequip\x20'+_0x351df2['name']+'?');if(!_0x227beb)return;const _0x4c6685=await unequipToken();_0x4c6685&&updateTokenButtons();}else{const _0x3c1616=window['confirm']('Equip\x20'+_0x351df2['name']+'?\x20This\x20will\x20unequip\x20your\x20current\x20token.');if(!_0x3c1616)return;const _0x4f00f3=await equipToken(_0x1f242f);_0x4f00f3&&updateTokenButtons();}});}),_0xdea0b6['forEach'](_0x314688=>{_0x314688['addEventListener']('click',async _0x2d0c15=>{const _0x381d78=a46_0x40c8;_0x2d0c15['preventDefault']();const _0x7b0981=_0x314688['closest']('[data-token]'),_0x24d795=_0x7b0981['dataset'][_0x381d78(0xee)],_0x2b688f=TOKENS[_0x24d795],_0x174d51=Math['floor'](_0x2b688f['price']*0.5),_0x581ebc=window['confirm']('Are\x20you\x20sure\x20you\x20want\x20to\x20sell\x20'+_0x2b688f['name']+_0x381d78(0x101)+_0x174d51+_0x381d78(0xce));if(!_0x581ebc)return;const _0x1dd13a=await sellToken(_0x24d795);_0x1dd13a&&updateTokenButtons();});}),updateTokenButtons();}function updateThemeButtons(){const _0xc5eb13=a46_0x128264,_0x301355=window['ThemeSystem']?window['ThemeSystem']['getCurrentTheme']():_0xc5eb13(0x102),_0x442bee=auth['currentUser'];document['querySelectorAll']('.theme-select-btn')[_0xc5eb13(0x137)](_0x544344=>{const _0x587833=_0xc5eb13,_0x212edc=_0x544344['closest']('[data-theme]'),_0x544cad=_0x212edc[_0x587833(0xc1)]['theme'],_0xdded55=THEMES[_0x544cad];if(!_0xdded55)return;_0x544344['disabled']=![],_0x544344['style']['opacity']='',_0x544344['style']['cursor']='pointer',_0x544344['classList'][_0x587833(0xfe)](_0x587833(0x13e),'apply-theme',_0x587833(0xc5),_0x587833(0x115),'sign-in-free','sign-in-paid');if(!_0x442bee){_0xdded55[_0x587833(0x12f)]===0x0?(_0x544344[_0x587833(0x128)]='Sign\x20in\x20to\x20Apply',_0x544344['classList']['add']('sign-in-free')):(_0x544344[_0x587833(0x128)]='Sign\x20in\x20to\x20Purchase',_0x544344[_0x587833(0xc9)]=!![],_0x544344['style']['opacity']='0.7',_0x544344['classList']['add'](_0x587833(0x111)));return;}if(_0x544cad===_0x301355){_0x544344['textContent']='Current\x20Theme',_0x544344['classList'][_0x587833(0xde)]('current-theme'),_0x544344['disabled']=!![],_0x544344[_0x587833(0x130)][_0x587833(0x118)]='default';return;}if(userOwnsTheme(_0x544cad)){_0x544344['textContent']=_0x587833(0x132),_0x544344[_0x587833(0x103)][_0x587833(0xde)]('apply-theme');return;}if(userData['points']>=_0xdded55['price']){_0x544344['textContent']='Buy\x20for\x20'+_0xdded55['price']+'\x20Points',_0x544344['classList'][_0x587833(0xde)]('can-afford');return;}_0x544344[_0x587833(0x128)]=_0x587833(0xe9)+_0xdded55[_0x587833(0x12f)]+'\x20Points',_0x544344['classList']['add']('cannot-afford'),_0x544344['style']['opacity']='0.5',_0x544344['disabled']=!![],_0x544344[_0x587833(0x130)]['cursor']='not-allowed';});}function updateTokenButtons(){const _0x3a47f2=a46_0x128264,_0x34648d=auth['currentUser'];document['querySelectorAll'](_0x3a47f2(0x10f))['forEach'](_0x32acd6=>{const _0x163c94=_0x3a47f2,_0x13f0b1=_0x32acd6['closest'](_0x163c94(0x12e)),_0x1a20e5=_0x13f0b1[_0x163c94(0xc1)][_0x163c94(0xee)],_0x1f2d89=TOKENS[_0x1a20e5],_0x4a936d=_0x13f0b1[_0x163c94(0xef)](_0x163c94(0xd4)),_0x14ddc9=_0x13f0b1['querySelector'](_0x163c94(0x121));if(!_0x1f2d89)return;_0x32acd6[_0x163c94(0xc9)]=![],_0x32acd6[_0x163c94(0x130)][_0x163c94(0x138)]='',_0x32acd6['style']['cursor']='pointer';_0x4a936d&&(_0x4a936d['style']['display']='none',_0x4a936d['disabled']=![],_0x4a936d['style']['opacity']='',_0x4a936d[_0x163c94(0x103)][_0x163c94(0xfe)]('equipped','can-equip'));_0x14ddc9&&(_0x14ddc9['style'][_0x163c94(0x127)]='none');_0x32acd6[_0x163c94(0x103)]['remove'](_0x163c94(0xbe),_0x163c94(0xc5),'cannot-afford','sign-in');if(!_0x34648d){_0x32acd6[_0x163c94(0x128)]=_0x163c94(0xdc),_0x32acd6['disabled']=!![],_0x32acd6[_0x163c94(0x130)]['opacity']='0.7',_0x32acd6['classList']['add']('sign-in');return;}if(userOwnsToken(_0x1a20e5)){_0x32acd6['textContent']='Owned',_0x32acd6['classList']['add']('owned'),_0x32acd6['disabled']=!![],_0x32acd6['style']['cursor']='default',_0x32acd6['style']['background']='var(--success-color,\x20#4CAF50)';_0x4a936d&&(_0x4a936d['style']['display']='block',userHasTokenEquipped(_0x1a20e5)?(_0x4a936d['textContent']=_0x163c94(0x11e),_0x4a936d[_0x163c94(0x103)]['add']('equipped'),_0x4a936d['style']['background']=_0x163c94(0x11d),_0x4a936d['style']['cursor']='pointer'):(_0x4a936d[_0x163c94(0x128)]='Equip',_0x4a936d[_0x163c94(0x103)]['add']('can-equip'),_0x4a936d['style']['background']=_0x163c94(0x106),_0x4a936d['style']['cursor']='pointer'));_0x14ddc9&&userData[_0x163c94(0xd1)]&&(_0x14ddc9['style']['display']=_0x163c94(0x11a));return;}if(userData[_0x163c94(0x10c)]>=_0x1f2d89[_0x163c94(0x12f)]){_0x32acd6[_0x163c94(0x128)]='Buy\x20for\x20'+_0x1f2d89['price']+'\x20Points',_0x32acd6[_0x163c94(0x103)]['add']('can-afford'),_0x32acd6['style']['background']='';return;}_0x32acd6['textContent']=_0x163c94(0xe9)+_0x1f2d89['price']+_0x163c94(0x129),_0x32acd6[_0x163c94(0x103)]['add']('cannot-afford'),_0x32acd6[_0x163c94(0x130)][_0x163c94(0x138)]='0.5',_0x32acd6[_0x163c94(0xc9)]=!![],_0x32acd6['style'][_0x163c94(0x118)]='not-allowed',_0x32acd6['style']['background']='var(--muted-color,\x20#757575)';});}function showMessage(_0x4e745d,_0x9ef2ec='info'){const _0xa11e89=a46_0x128264,_0x25bf76=document[_0xa11e89(0xf1)]('store-message');_0x25bf76&&_0x25bf76[_0xa11e89(0xfe)]();const _0x4a8a09=document['createElement']('div');_0x4a8a09['id']='store-message',_0x4a8a09['className']='store-message\x20store-message-'+_0x9ef2ec,_0x4a8a09['textContent']=_0x4e745d,document['body']['appendChild'](_0x4a8a09),requestAnimationFrame(()=>{const _0x440efc=_0xa11e89;_0x4a8a09[_0x440efc(0x103)][_0x440efc(0xde)]('visible');}),setTimeout(()=>{const _0xb39271=_0xa11e89;_0x4a8a09['classList'][_0xb39271(0xfe)](_0xb39271(0xca)),setTimeout(()=>{const _0x2771f1=_0xb39271;_0x4a8a09[_0x2771f1(0x108)]&&_0x4a8a09['remove']();},0x12c);},0xfa0);}window[a46_0x128264(0xe5)]={'refreshUI':()=>{updateThemeButtons(),updateTokenButtons();},'checkOwnership':userOwnsTheme,'checkTokenOwnership':userOwnsToken,'applyTheme':applyTheme,'purchaseTheme':purchaseTheme,'purchaseToken':purchaseToken},console['log']('üè™\x20Redeem\x20store\x20loaded');
const a15_0x572317=a15_0xcd04,a15_0x3e9a2d=(function(){let _0x284eb6=!![];return function(_0x234da0,_0x4a0481){const _0x44ebda=_0x284eb6?function(){const _0x5c1503=a15_0xcd04;if(_0x4a0481){const _0x169eda=_0x4a0481[_0x5c1503(0x10c)](_0x234da0,arguments);return _0x4a0481=null,_0x169eda;}}:function(){};return _0x284eb6=![],_0x44ebda;};}()),a15_0x3ba0d0=a15_0x3e9a2d(this,function(){const _0x122815=a15_0xcd04,_0x270489=function(){const _0x486a0c=a15_0xcd04;let _0x41ce96;try{_0x41ce96=Function(_0x486a0c(0x117)+_0x486a0c(0x115)+');')();}catch(_0xf0eb69){_0x41ce96=window;}return _0x41ce96;},_0x436fee=_0x270489(),_0x5edeac=_0x436fee['console']=_0x436fee['console']||{},_0x36f7aa=['log',_0x122815(0x110),'info','error',_0x122815(0x106),'table','trace'];for(let _0x145b32=0x0;_0x145b32<_0x36f7aa[_0x122815(0x10a)];_0x145b32++){const _0x129c89=a15_0x3e9a2d['constructor']['prototype']['bind'](a15_0x3e9a2d),_0x5048ad=_0x36f7aa[_0x145b32],_0x23327a=_0x5edeac[_0x5048ad]||_0x129c89;_0x129c89['__proto__']=a15_0x3e9a2d['bind'](a15_0x3e9a2d),_0x129c89['toString']=_0x23327a['toString']['bind'](_0x23327a),_0x5edeac[_0x5048ad]=_0x129c89;}});a15_0x3ba0d0();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc,where}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D3=[{'name':'Emerald','elo':0x7d0},{'name':'Gold','elo':0x708},{'name':'Silver','elo':0x640},{'name':a15_0x572317(0x108),'elo':0x578},{'name':'Unranked','elo':0x4b0}];let lastVisibleD3=null;async function getUsernameByIdD3(_0x5279bb){const _0x3c6edb=a15_0x572317;try{if(!_0x5279bb)return'Unknown\x20Player';const _0x17a18f=await getDoc(doc(db,_0x3c6edb(0x114),_0x5279bb));if(_0x17a18f['exists']())return _0x17a18f['data']()['username']||'Unknown\x20Player';const _0x552c92=await getDocs(query(collection(db,_0x3c6edb(0x107)),where(_0x3c6edb(0x104),'==',_0x5279bb),limit(0x1)));if(!_0x552c92[_0x3c6edb(0x113)])return _0x552c92['docs'][0x0][_0x3c6edb(0x102)]()[_0x3c6edb(0x111)]||'Unknown\x20Player';const _0x5528cf=await getDocs(query(collection(db,'approvedMatchesD3'),where(_0x3c6edb(0x100),'==',_0x5279bb),limit(0x1)));if(!_0x5528cf[_0x3c6edb(0x113)])return _0x5528cf['docs'][0x0][_0x3c6edb(0x102)]()['loserUsername']||'Unknown\x20Player';return _0x3c6edb(0x10f);}catch(_0xe88072){return console['error']('Error\x20getting\x20D3\x20username:',_0xe88072),'Unknown\x20Player';}}export async function recordEloChangeD3({playerId:_0x3d23f3,previousElo:_0x4b0b9d,newElo:_0x19c0c4,opponentId:_0x24980d,matchResult:_0x4837d9,previousPosition:_0xab9a9,newPosition:_0x4c691c,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0xd94a9c,timestamp:_0x3f7d80}){const _0xacf5ff=a15_0x572317;try{const _0x408332=doc(collection(db,'eloHistoryD3'));let _0x3e141f='match';if(isPromotion)_0x3e141f='promotion';if(isDemotion)_0x3e141f='demotion';let _0x38c69c='Unranked';if(_0x19c0c4>=0x7d0)_0x38c69c='Emerald';else{if(_0x19c0c4>=0x708)_0x38c69c=_0xacf5ff(0x10d);else{if(_0x19c0c4>=0x640)_0x38c69c='Silver';else{if(_0x19c0c4>=0x578)_0x38c69c=_0xacf5ff(0x108);}}}return await setDoc(_0x408332,{'type':_0x3e141f,'player':_0x3d23f3,'opponent':_0x24980d,'previousElo':_0x4b0b9d,'newElo':_0x19c0c4,'change':_0x19c0c4-_0x4b0b9d,'matchResult':_0x4837d9,'previousPosition':_0xab9a9,'newPosition':_0x4c691c,'rankAchieved':_0x38c69c,'matchId':_0xd94a9c,'timestamp':_0x3f7d80||serverTimestamp(),'gameMode':'D3'}),console['log']('D3\x20ELO\x20history\x20recorded\x20for\x20'+_0x3d23f3),!![];}catch(_0x577dc0){console['error'](_0xacf5ff(0xff),_0x577dc0);throw _0x577dc0;}}function a15_0xcd04(_0x4d59aa,_0x54a5e5){const _0x3ba0d0=a15_0x6c4e();return a15_0xcd04=function(_0x3e9a2d,_0x57c72d){_0x3e9a2d=_0x3e9a2d-0xff;let _0x6c4ee0=_0x3ba0d0[_0x3e9a2d];return _0x6c4ee0;},a15_0xcd04(_0x4d59aa,_0x54a5e5);}function a15_0x6c4e(){const _0x568bf3=['Error\x20recording\x20D3\x20ELO\x20history:','loserId','all','data','Error\x20fetching\x20D3\x20ELO\x20history:','winnerId','docs','exception','approvedMatchesD3','Bronze','opponent','length','previousElo','apply','Gold','map','Unknown\x20Player','warn','winnerUsername','size','empty','playersD3','{}.constructor(\x22return\x20this\x22)(\x20)','eloHistoryD3','return\x20(function()\x20'];a15_0x6c4e=function(){return _0x568bf3;};return a15_0x6c4e();}export async function getEloHistoryD3(_0x561620=0x14){const _0x3be2c4=a15_0x572317;try{const _0x322922=collection(db,_0x3be2c4(0x116));let _0x386fe8;lastVisibleD3?_0x386fe8=query(_0x322922,orderBy('timestamp','desc'),startAfter(lastVisibleD3),limit(_0x561620)):_0x386fe8=query(_0x322922,orderBy('timestamp','desc'),limit(_0x561620));const _0xccc01b=await getDocs(_0x386fe8);if(_0xccc01b['empty'])return{'entries':[],'hasMore':![]};lastVisibleD3=_0xccc01b[_0x3be2c4(0x105)][_0xccc01b['docs']['length']-0x1];const _0x2a9f2d=_0xccc01b['docs'][_0x3be2c4(0x10e)](async _0x563bf9=>{const _0x1a1010=_0x3be2c4,_0xb38348=_0x563bf9['data'](),[_0x59d101,_0x6da464]=await Promise[_0x1a1010(0x101)]([getUsernameByIdD3(_0xb38348['player']),getUsernameByIdD3(_0xb38348[_0x1a1010(0x109)])]);return{..._0xb38348,'playerUsername':_0x59d101,'opponentUsername':_0x6da464,'change':_0xb38348['newElo']-_0xb38348[_0x1a1010(0x10b)],'timestamp':_0xb38348['timestamp']};}),_0x5cd8c1=await Promise['all'](_0x2a9f2d);return{'entries':_0x5cd8c1,'hasMore':_0xccc01b[_0x3be2c4(0x112)]===_0x561620};}catch(_0x3075c1){console['error'](_0x3be2c4(0x103),_0x3075c1);throw _0x3075c1;}}export function resetPaginationD3(){lastVisibleD3=null;}
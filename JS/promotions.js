const a42_0x97e2d=a42_0xff0e,a42_0x887723=(function(){let _0xe862c3=!![];return function(_0x5b294c,_0x2c18c4){const _0x102285=_0xe862c3?function(){if(_0x2c18c4){const _0x124571=_0x2c18c4['apply'](_0x5b294c,arguments);return _0x2c18c4=null,_0x124571;}}:function(){};return _0xe862c3=![],_0x102285;};}()),a42_0x11b499=a42_0x887723(this,function(){const _0x4d0fdd=a42_0xff0e,_0xac7e14=function(){const _0x2d8388=a42_0xff0e;let _0x4ae23d;try{_0x4ae23d=Function(_0x2d8388(0x1d6)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x40f436){_0x4ae23d=window;}return _0x4ae23d;},_0x2910c9=_0xac7e14(),_0x2e2c3e=_0x2910c9['console']=_0x2910c9['console']||{},_0x211b89=['log','warn',_0x4d0fdd(0x1d9),'error','exception','table',_0x4d0fdd(0x211)];for(let _0x4a9a7f=0x0;_0x4a9a7f<_0x211b89['length'];_0x4a9a7f++){const _0x3a5249=a42_0x887723['constructor'][_0x4d0fdd(0x227)]['bind'](a42_0x887723),_0x55b80c=_0x211b89[_0x4a9a7f],_0x3e4ba2=_0x2e2c3e[_0x55b80c]||_0x3a5249;_0x3a5249['__proto__']=a42_0x887723['bind'](a42_0x887723),_0x3a5249['toString']=_0x3e4ba2['toString']['bind'](_0x3e4ba2),_0x2e2c3e[_0x55b80c]=_0x3a5249;}});a42_0x11b499();import{collection,doc,query,where,orderBy,limit,getDocs,addDoc,getDoc,serverTimestamp,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{auth,db}from'./firebase-config.js';function a42_0x1dc9(){const _0x2d3a91=['return\x20(function()\x20','showRankChangeLightbox','Discord\x20notification\x20sent\x20successfully\x20with\x20ID:\x20','info','now','Unranked',')\x20â†’\x20','classList','pollingInterval','Error\x20processing\x20rank\x20change:','You\x27ve\x20been\x20promoted\x20to','toDateString','promotions_checked_','match','forEach','</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22rank-change-button\x22\x20id=\x22rank-change-ok-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Got\x20it!\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','dismissing','promotion-banner','rankChangeModal','ladder','add','docs','adminUser','sort','isNewRankChange','A\x20player','setItem','promotion','Error\x20fetching\x20promotions:','fetchInterval','length','className','isAutomatic','newRank','div','stringify','bannerContainer','promotionNotifications','promotion_','true','new-rank-change','data','matchId','empty','timestamp','log','remove','display','cleanup','previousRank','children','toMillis','error','\x20for\x20','winnerUsername','exists','Unknown\x20Player','ignored','lastFetchTime','trace','getElementById','string','Failed\x20to\x20resolve\x20user\x20ID:\x20','checkAndRecordPromotion','style','Never\x20show\x20this\x20promotion\x20again','createElement','parse','\x27s\x20','shouldShowPromotion','\x20hours','none','Skipping\x20ignored\x20promotion:\x20','currentUser','addEventListener','removeChild','#FFD700','innerHTML','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rank-change-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2\x20class=\x22rank-change-title\x22>','type','player','prototype','beforeunload','approvedMatches','appendChild','parentNode','set','DISPLAY_HOURS','Congratulations!'];a42_0x1dc9=function(){return _0x2d3a91;};return a42_0x1dc9();}function a42_0xff0e(_0x3c74f5,_0x19207e){const _0x11b499=a42_0x1dc9();return a42_0xff0e=function(_0x887723,_0x578eca){_0x887723=_0x887723-0x1d6;let _0x1dc94c=_0x11b499[_0x887723];return _0x1dc94c;},a42_0xff0e(_0x3c74f5,_0x19207e);}class PromotionManager{constructor(){const _0xaf5689=a42_0xff0e;this[_0xaf5689(0x22d)]=0x18,this['RANKS']=[{'threshold':0x578,'name':'Bronze','color':'#CD7F32'},{'threshold':0x640,'name':'Silver','color':'#C0C0C0'},{'threshold':0x708,'name':'Gold','color':_0xaf5689(0x222)},{'threshold':0x834,'name':'Emerald','color':'#50C878'}],this[_0xaf5689(0x1fa)]=null,this['lastFetchTime']=0x0,this['fetchInterval']=0xea60,this[_0xaf5689(0x1de)]=null,this['usernameCache']={};}['initialize'](){const _0x2813fa=a42_0xff0e;this['bannerContainer']=document['getElementById']('promotion-banner-container');if(!this['bannerContainer']){console[_0x2813fa(0x20a)]('Promotion\x20banner\x20container\x20not\x20found');return;}this['setupBannerContainer']();const _0x46354b=_0x2813fa(0x1e2)+new Date()[_0x2813fa(0x1e1)](),_0x59319d=sessionStorage['getItem'](_0x46354b);!_0x59319d&&(this['fetchRecentPromotions'](),sessionStorage[_0x2813fa(0x1f0)](_0x46354b,'true')),document['addEventListener']('visibilitychange',()=>{const _0x2b62ca=_0x2813fa;document['visibilityState']==='visible'&&!sessionStorage['getItem'](_0x46354b)&&(this['fetchRecentPromotions'](),sessionStorage[_0x2b62ca(0x1f0)](_0x46354b,_0x2b62ca(0x1fd)));}),window['addEventListener'](_0x2813fa(0x228),()=>{const _0x510ab2=_0x2813fa;this[_0x510ab2(0x1de)]&&clearInterval(this['pollingInterval']);});}['setupBannerContainer'](){const _0xb38600=a42_0xff0e;this[_0xb38600(0x1fa)][_0xb38600(0x223)]='',this['bannerContainer']['style']['display']=_0xb38600(0x21d);}async['fetchRecentPromotions'](){const _0x4b1805=a42_0xff0e;try{const _0x48f0cf=Date[_0x4b1805(0x1da)]();if(_0x48f0cf-this[_0x4b1805(0x210)]<this[_0x4b1805(0x1f3)])return;this['lastFetchTime']=_0x48f0cf;const _0x416255=collection(db,'eloHistory'),_0x185a33=query(_0x416255,where(_0x4b1805(0x225),'in',['promotion','demotion']),orderBy('timestamp','desc'),limit(0x14)),_0x704ef5=await getDocs(_0x185a33),_0xb2302a=[];_0x704ef5[_0x4b1805(0x1e4)](_0x30c433=>{const _0x32e70e=_0x4b1805,_0x4bbfcc={'id':_0x30c433['id'],..._0x30c433['data']()};this[_0x32e70e(0x21b)](_0x30c433['id'])&&this['isNewRankChange'](_0x4bbfcc)&&_0xb2302a['push'](_0x4bbfcc);}),_0xb2302a['length']>0x0&&await this['processRankChanges'](_0xb2302a);}catch(_0xbc92d7){console['error'](_0x4b1805(0x1f2),_0xbc92d7);}}async['processRankChanges'](_0x57695d){const _0x448efc=a42_0xff0e;if(_0x57695d['length']===0x0)return;_0x57695d[_0x448efc(0x1ed)]((_0x2f9790,_0x517033)=>{const _0x50159f=_0x448efc,_0x46cde0=_0x2f9790[_0x50159f(0x202)]?.['toMillis']?.()||_0x2f9790['timestamp']?.['seconds']*0x3e8||0x0,_0x2f9952=_0x517033[_0x50159f(0x202)]?.[_0x50159f(0x209)]?.()||_0x517033['timestamp']?.['seconds']*0x3e8||0x0;return _0x2f9952-_0x46cde0;});const _0x22b98c=this[_0x448efc(0x1fa)]['children']['length'],_0x3456dd=0x3-_0x22b98c;if(_0x3456dd<=0x0)return;const _0x41852b=_0x57695d['slice'](0x0,_0x3456dd);for(let _0x113211=0x0;_0x113211<_0x41852b['length'];_0x113211++){const _0x4d8da4=_0x41852b[_0x113211],_0x478a95=auth['currentUser'];try{setTimeout(()=>{this['showRankChangeBanner'](_0x4d8da4);},_0x113211*0x3e8),_0x478a95&&_0x4d8da4['player']===_0x478a95['displayName']&&this[_0x448efc(0x1d7)](_0x4d8da4[_0x448efc(0x225)],_0x4d8da4['rankAchieved']);}catch(_0x130194){console['error'](_0x448efc(0x1df),_0x130194);}}}['shouldShowPromotion'](_0x2aa953){const _0x7d2515=a42_0xff0e;try{const _0x21beef=_0x7d2515(0x1fc)+_0x2aa953,_0x146172=localStorage['getItem'](_0x21beef);if(_0x146172){let _0x3cb5ba;try{_0x3cb5ba=JSON[_0x7d2515(0x219)](_0x146172);}catch(_0x3bf9b4){return console['warn']('Invalid\x20storage\x20format\x20for\x20'+_0x21beef+',\x20treating\x20as\x20new'),!![];}if(_0x3cb5ba[_0x7d2515(0x20f)]===!![])return console['log']('Promotion\x20'+_0x2aa953+'\x20is\x20permanently\x20ignored'),![];const _0x5e10a3=Date[_0x7d2515(0x1da)]();if(_0x3cb5ba['userDismissed']&&_0x5e10a3-_0x3cb5ba[_0x7d2515(0x202)]<this['DISPLAY_HOURS']*0x3c*0x3c*0x3e8)return console[_0x7d2515(0x203)]('Promotion\x20'+_0x2aa953+'\x20was\x20dismissed\x20by\x20user\x20within\x20last\x20'+this['DISPLAY_HOURS']+_0x7d2515(0x21c)),![];if(_0x3cb5ba['systemDismissed']&&_0x5e10a3-_0x3cb5ba[_0x7d2515(0x202)]<0x4*0x3c*0x3c*0x3e8)return console[_0x7d2515(0x203)]('Promotion\x20'+_0x2aa953+'\x20was\x20auto-dismissed\x20within\x20last\x204\x20hours'),![];}return!![];}catch(_0x1872c3){return console[_0x7d2515(0x20a)]('Error\x20checking\x20promotion\x20visibility:',_0x1872c3),![];}}['ignorePromotion'](_0x1dfaff){const _0x37f9b4=a42_0xff0e;try{const _0x3957a7=_0x37f9b4(0x1fc)+_0x1dfaff;localStorage['setItem'](_0x3957a7,JSON[_0x37f9b4(0x1f9)]({'timestamp':Date[_0x37f9b4(0x1da)](),'ignored':!![]}));}catch(_0x166760){console['error']('Error\x20saving\x20promotion\x20preference:',_0x166760);}}['showRankChangeBanner'](_0x1b2cee){this['resolveUserId'](_0x1b2cee)['then'](_0x1b97f8=>{const _0x3202c1=a42_0xff0e,_0x10acdb='promotion_'+_0x1b2cee['id'],_0x2b1c87=localStorage['getItem'](_0x10acdb);if(_0x2b1c87)try{const _0x4be1a7=JSON['parse'](_0x2b1c87);if(_0x4be1a7['ignored']===!![]){console['log'](_0x3202c1(0x21e)+_0x1b2cee['id']);return;}}catch(_0x87b16a){}localStorage['setItem'](_0x10acdb,JSON['stringify']({'timestamp':Date[_0x3202c1(0x1da)](),'ignored':![],'userDismissed':![],'systemDismissed':![],'seenAt':Date[_0x3202c1(0x1da)]()})),this[_0x3202c1(0x1fa)][_0x3202c1(0x216)]['display']='block';while(this['bannerContainer']['children'][_0x3202c1(0x1f4)]>=0x3){this['bannerContainer'][_0x3202c1(0x221)](this['bannerContainer']['firstChild']);}const _0x3a0247=document['createElement']('div');_0x3a0247['className']=_0x3202c1(0x1e7),_0x3a0247['setAttribute']('data-rank',_0x1b97f8['rankAchieved']),_0x3a0247['setAttribute']('data-id',_0x1b97f8['id']);const _0x7e470a=document[_0x3202c1(0x218)](_0x3202c1(0x1f8));_0x7e470a['className']='promotion-details';const _0x2f63d0=_0x1b97f8['resolvedName']||_0x1b97f8[_0x3202c1(0x226)]||_0x1b97f8['username']||_0x1b97f8['playerUsername']||_0x1b97f8['displayName']||'A\x20player',_0x27f07b=_0x1b97f8['type']===_0x3202c1(0x1f1)?_0x2f63d0+'\x20was\x20promoted\x20to':_0x2f63d0+'\x20was\x20demoted\x20to';_0x7e470a[_0x3202c1(0x223)]=_0x27f07b+'\x20<span\x20class=\x22rank-text\x22>'+_0x1b97f8['rankAchieved']+'</span>';const _0x242c90=document['createElement'](_0x3202c1(0x1f8));_0x242c90[_0x3202c1(0x1f5)]='banner-actions';const _0x2b3dad=document['createElement']('button');_0x2b3dad['className']='dismiss-btn',_0x2b3dad['innerHTML']='&times;',_0x2b3dad['title']='Dismiss';const _0x366786=document[_0x3202c1(0x218)]('button');_0x366786['className']='ignore-btn',_0x366786['textContent']='Don\x27t\x20show\x20again',_0x366786['title']=_0x3202c1(0x217),_0x242c90[_0x3202c1(0x22a)](_0x366786),_0x242c90[_0x3202c1(0x22a)](_0x2b3dad),_0x3a0247['appendChild'](_0x7e470a),_0x3a0247['appendChild'](_0x242c90),this['bannerContainer']['appendChild'](_0x3a0247),void _0x3a0247['offsetWidth'],setTimeout(()=>{const _0x1acc1d=_0x3202c1;_0x3a0247['classList'][_0x1acc1d(0x1ea)](_0x1acc1d(0x1fe));},0x32),_0x2b3dad['addEventListener']('click',()=>{const _0x42af3e=_0x3202c1;localStorage[_0x42af3e(0x1f0)](_0x10acdb,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':!![],'systemDismissed':![]})),_0x3a0247[_0x42af3e(0x1dd)][_0x42af3e(0x204)]('new-rank-change'),_0x3a0247[_0x42af3e(0x1dd)]['add'](_0x42af3e(0x1e6)),setTimeout(()=>{const _0x4be8ff=_0x42af3e;_0x3a0247['parentNode']&&(_0x3a0247['remove'](),this['bannerContainer'][_0x4be8ff(0x208)]['length']===0x0&&(this[_0x4be8ff(0x1fa)]['style'][_0x4be8ff(0x205)]='none'));},0x1f4);}),_0x366786['addEventListener']('click',()=>{const _0x454b23=_0x3202c1;localStorage['setItem'](_0x10acdb,JSON[_0x454b23(0x1f9)]({'timestamp':Date[_0x454b23(0x1da)](),'ignored':!![],'userDismissed':!![],'systemDismissed':![]})),_0x3a0247['classList']['remove']('new-rank-change'),_0x3a0247['classList']['add']('dismissing'),setTimeout(()=>{const _0x47588c=_0x454b23;_0x3a0247['parentNode']&&(_0x3a0247[_0x47588c(0x204)](),this[_0x47588c(0x1fa)]['children']['length']===0x0&&(this['bannerContainer'][_0x47588c(0x216)]['display']='none'));},0x1f4);}),setTimeout(()=>{const _0x5726d7=_0x3202c1;_0x3a0247[_0x5726d7(0x22b)]&&(_0x3a0247['classList']['remove']('new-rank-change'),_0x3a0247['classList'][_0x5726d7(0x1ea)]('dismissing'),localStorage[_0x5726d7(0x1f0)](_0x10acdb,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':!![]})),setTimeout(()=>{const _0x112c4a=_0x5726d7;_0x3a0247[_0x112c4a(0x22b)]&&(_0x3a0247['remove'](),this['bannerContainer'][_0x112c4a(0x208)][_0x112c4a(0x1f4)]===0x0&&(this['bannerContainer'][_0x112c4a(0x216)]['display']=_0x112c4a(0x21d)));},0x1f4));},0x3a98);});}async['resolveUserId'](_0x23f60c){const _0x7ad66b=a42_0xff0e,_0x2701e9={..._0x23f60c},_0x45eb63=[_0x23f60c['player'],_0x23f60c['username'],_0x23f60c['playerUsername'],_0x23f60c['displayName']],_0x25ed12=_0x45eb63['some'](_0x2c3ad4=>_0x2c3ad4&&typeof _0x2c3ad4===_0x7ad66b(0x213)&&!_0x2c3ad4['includes']('ID:')&&!/^[a-zA-Z0-9]{20,}$/['test'](_0x2c3ad4));if(_0x25ed12)return _0x2701e9;let _0x241db7=null;if(_0x23f60c['userId'])_0x241db7=_0x23f60c['userId'];else _0x23f60c[_0x7ad66b(0x226)]&&/^[A-Za-z0-9]{20,}$/['test'](_0x23f60c[_0x7ad66b(0x226)])&&(_0x241db7=_0x23f60c['player']);if(!_0x241db7)return _0x2701e9;try{const _0x2884ee=await getDoc(doc(db,'players',_0x241db7));if(_0x2884ee[_0x7ad66b(0x20d)]()){const _0x4e3002=_0x2884ee['data']();if(_0x4e3002['username'])return _0x2701e9['resolvedName']=_0x4e3002['username'],_0x2701e9;}const _0x19b30e=await getDocs(query(collection(db,_0x7ad66b(0x229)),where('winnerId','==',_0x241db7),orderBy('date','desc'),limit(0x1)));if(!_0x19b30e[_0x7ad66b(0x201)]){const _0x4888b9=_0x19b30e[_0x7ad66b(0x1eb)][0x0]['data']();if(_0x4888b9['winnerUsername'])return _0x2701e9['resolvedName']=_0x4888b9[_0x7ad66b(0x20c)],_0x2701e9;}const _0x53f0fc=await getDocs(query(collection(db,'approvedMatches'),where('loserId','==',_0x241db7),orderBy('date','desc'),limit(0x1)));if(!_0x53f0fc[_0x7ad66b(0x201)]){const _0x3fb0ce=_0x53f0fc['docs'][0x0]['data']();if(_0x3fb0ce['loserUsername'])return _0x2701e9['resolvedName']=_0x3fb0ce['loserUsername'],console['log']('Resolved\x20'+_0x241db7+'\x20to\x20'+_0x3fb0ce['loserUsername']+'\x20(loser)'),_0x2701e9;}}catch(_0x4d04de){console['error']('Error\x20resolving\x20user\x20ID:',_0x4d04de);}return console['warn'](_0x7ad66b(0x214)+_0x241db7),_0x2701e9;}['showRankChangeLightbox'](_0x3ff33d,_0x3daeb5){const _0x43adeb=a42_0xff0e;let _0x3c267c=document[_0x43adeb(0x212)]('rankChangeModal');!_0x3c267c&&(_0x3c267c=document['createElement'](_0x43adeb(0x1f8)),_0x3c267c['id']=_0x43adeb(0x1e8),_0x3c267c['className']='rank-change-modal\x20'+_0x3ff33d,document['body'][_0x43adeb(0x22a)](_0x3c267c));const _0x1eeecf=_0x3ff33d===_0x43adeb(0x1f1)?_0x43adeb(0x22e):'Rank\x20Update',_0x8d3427=_0x3ff33d==='promotion'?_0x43adeb(0x1e0):'You\x27ve\x20been\x20demoted\x20to';_0x3c267c['innerHTML']=_0x43adeb(0x224)+_0x1eeecf+'</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>'+_0x8d3427+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22rank-name\x22>'+_0x3daeb5+_0x43adeb(0x1e5),_0x3c267c['style'][_0x43adeb(0x205)]='flex',document['getElementById']('rank-change-ok-btn')['addEventListener']('click',()=>{const _0x87cf25=_0x43adeb;_0x3c267c[_0x87cf25(0x216)]['display']=_0x87cf25(0x21d);}),_0x3c267c[_0x43adeb(0x220)]('click',_0x3df730=>{_0x3df730['target']===_0x3c267c&&(_0x3c267c['style']['display']='none');});}async['checkAndRecordPromotion'](_0x3418d3,_0x3862a4,_0x1c8d74,_0x42747b={}){const _0x5f56b6=a42_0xff0e;try{if(_0x3862a4===_0x1c8d74||!_0x3418d3)return null;const _0x42c28e=_0x42747b['source']||'automatic',_0xd55471=_0x42747b[_0x5f56b6(0x200)]||null,_0x3e3d5b=_0x42747b['adminUser']||null;console[_0x5f56b6(0x203)]('Processing\x20potential\x20rank\x20change:\x20'+_0x1c8d74+'\x20â†’\x20'+_0x3862a4+'\x20(source:\x20'+_0x42c28e+')');let _0xd1dda4=null,_0x5310d3=null;try{const _0x1df938=await getDoc(doc(db,'players',_0x3418d3));if(_0x1df938['exists']()){const _0x17d4bb=_0x1df938[_0x5f56b6(0x1ff)]();_0xd1dda4=_0x17d4bb['username']||_0x17d4bb['displayName']||null,_0x5310d3=_0x17d4bb['displayName']||_0x17d4bb['username']||null;}!_0xd1dda4&&_0x42747b['username']&&(_0xd1dda4=_0x42747b['username'],_0x5310d3=_0x42747b['username']);!_0xd1dda4&&auth['currentUser']&&(_0xd1dda4=auth['currentUser']['displayName']||auth[_0x5f56b6(0x21f)]['email']['split']('@')[0x0],_0x5310d3=auth['currentUser']['displayName']||null);if(!_0xd1dda4){const _0x96b4ba=query(collection(db,'approvedMatches'),where('winnerId','==',_0x3418d3),limit(0x1)),_0x49122a=await getDocs(_0x96b4ba);if(!_0x49122a['empty'])_0xd1dda4=_0x49122a['docs'][0x0]['data']()['winnerUsername']||'Unknown\x20Player',_0x5310d3=_0xd1dda4;else{const _0x4a92d4=query(collection(db,'approvedMatches'),where('loserId','==',_0x3418d3),limit(0x1)),_0x117902=await getDocs(_0x4a92d4);!_0x117902[_0x5f56b6(0x201)]&&(_0xd1dda4=_0x117902[0x0]['data']()['loserUsername']||'Unknown\x20Player',_0x5310d3=_0xd1dda4);}}}catch(_0x42610c){console['error']('Error\x20resolving\x20username:',_0x42610c);}!_0xd1dda4&&(console['warn']('Could\x20not\x20resolve\x20username\x20for\x20userId:',_0x3418d3),_0xd1dda4=_0x5f56b6(0x1ef),_0x5310d3=_0x5f56b6(0x20e));const _0x19ec46=this['getRankName'](_0x1c8d74),_0x4165fd=this['getRankName'](_0x3862a4);if(_0x19ec46!==_0x4165fd){const _0x2679cf=_0x3862a4>_0x1c8d74,_0x55e048=_0x2679cf?'promotion':'demotion',_0x159f96=_0x4165fd;console['log']('Recording\x20'+_0x55e048+_0x5f56b6(0x20b)+_0xd1dda4+':\x20'+_0x1c8d74+'\x20('+_0x19ec46+_0x5f56b6(0x1dc)+_0x3862a4+'\x20('+_0x4165fd+')');try{const _0x5002e8={'player':_0xd1dda4,'playerUsername':_0xd1dda4,'username':_0xd1dda4,'displayName':_0x5310d3,'userId':_0x3418d3,'type':_0x55e048,'rankAchieved':_0x159f96,'timestamp':serverTimestamp(),'previousElo':_0x1c8d74,'newElo':_0x3862a4,'change':_0x3862a4-_0x1c8d74,'previousRank':_0x19ec46,'newRank':_0x4165fd,'source':_0x42c28e};if(_0x42c28e===_0x5f56b6(0x1e3)&&_0xd55471)_0x5002e8['matchId']=_0xd55471;else _0x42c28e==='admin'&&_0x3e3d5b?(_0x5002e8['modifiedBy']=_0x3e3d5b,_0x5002e8[_0x5f56b6(0x1f6)]=![]):_0x5002e8['isAutomatic']=!![];const _0x4ca095=writeBatch(db),_0x1ec916=doc(collection(db,'eloHistory')),_0x450efb=doc(collection(db,'promotionHistory'));return _0x4ca095[_0x5f56b6(0x22c)](_0x1ec916,_0x5002e8),_0x4ca095[_0x5f56b6(0x22c)](_0x450efb,_0x5002e8),await _0x4ca095['commit'](),await this['sendPromotionNotification'](_0x3418d3,_0xd1dda4,_0x1c8d74,_0x3862a4,_0x19ec46,_0x4165fd,_0x55e048,{'displayName':_0x5310d3,'source':_0x42c28e,'matchId':_0xd55471,'ladder':_0x42747b[_0x5f56b6(0x1e9)]||'D1'}),console['log']('Successfully\x20recorded\x20'+_0x55e048+_0x5f56b6(0x20b)+_0xd1dda4+'\x20to\x20'+_0x159f96),_0x159f96;}catch(_0x3f5200){console['error']('Error\x20writing\x20promotion\x20records:',_0x3f5200);try{return await addDoc(collection(db,'eloHistory'),{'player':_0xd1dda4,'playerUsername':_0xd1dda4,'username':_0xd1dda4,'displayName':_0x5310d3,'userId':_0x3418d3,'type':_0x55e048,'rankAchieved':_0x159f96,'timestamp':serverTimestamp(),'previousElo':_0x1c8d74,'newElo':_0x3862a4,'change':_0x3862a4-_0x1c8d74,'previousRank':_0x19ec46,'source':_0x42c28e,'isAutomatic':_0x42c28e!=='admin'}),await this['sendPromotionNotification'](_0x3418d3,_0xd1dda4,_0x1c8d74,_0x3862a4,_0x19ec46,_0x4165fd,_0x55e048,{'displayName':_0x5310d3,'source':_0x42c28e,'matchId':_0xd55471,'ladder':_0x42747b['ladder']||'D1'}),_0x159f96;}catch(_0x25eb59){return console[_0x5f56b6(0x20a)]('Fallback\x20write\x20failed:',_0x25eb59),null;}}}return null;}catch(_0x1eb6e7){return console['error']('Error\x20in\x20promotion/demotion\x20recording:',_0x1eb6e7),null;}}['getRankName'](_0x405a4f){const _0x29c90d=a42_0xff0e;for(let _0x54fcd7=this['RANKS']['length']-0x1;_0x54fcd7>=0x0;_0x54fcd7--){if(_0x405a4f>=this['RANKS'][_0x54fcd7]['threshold'])return this['RANKS'][_0x54fcd7]['name'];}return _0x29c90d(0x1db);}[a42_0x97e2d(0x206)](){this['pollingInterval']&&clearInterval(this['pollingInterval']);}[a42_0x97e2d(0x1ee)](_0x8cc7bb){const _0x2da1f8=a42_0x97e2d;if(_0x8cc7bb['timestamp']){const _0x5aae62=_0x8cc7bb['timestamp']['seconds']*0x3e8,_0x5d14b8=Date['now'](),_0x40a442=(_0x5d14b8-_0x5aae62)/(0x3e8*0x3c*0x3c);if(_0x40a442>0x18)return![];}if(_0x8cc7bb['previousRank']&&_0x8cc7bb[_0x2da1f8(0x1f7)]&&_0x8cc7bb[_0x2da1f8(0x207)]!==_0x8cc7bb['newRank'])return!![];return![];}async['sendPromotionNotification'](_0x1e4009,_0x490594,_0x143656,_0x3b0788,_0x37cab9,_0x37073a,_0x397555,_0x384f22={}){const _0x5685a4=a42_0x97e2d;try{console['log']('STARTING\x20notification\x20for\x20'+_0x490594+_0x5685a4(0x21a)+_0x397555);const _0x3119ff={'userId':_0x1e4009,'username':_0x490594,'displayName':_0x384f22['displayName']||_0x490594,'oldElo':parseInt(_0x143656),'newElo':parseInt(_0x3b0788),'eloDifference':parseInt(_0x3b0788)-parseInt(_0x143656),'oldRank':_0x37cab9,'newRank':_0x37073a,'type':_0x397555,'timestamp':serverTimestamp(),'processed':![],'source':_0x384f22['source']||'automatic','matchId':_0x384f22['matchId']||null,'ladder':_0x384f22['ladder']||'D1','adminUser':_0x384f22[_0x5685a4(0x1ec)]||null};console['log']('Creating\x20Discord\x20notification:',_0x3119ff);const _0xca86eb=await addDoc(collection(db,_0x5685a4(0x1fb)),_0x3119ff);return console['log'](_0x5685a4(0x1d8)+_0xca86eb['id']),!![];}catch(_0x5afe84){return console['error']('Error\x20sending\x20Discord\x20notification:',_0x5afe84),![];}}}export const promotionManager=new PromotionManager();document['addEventListener']('DOMContentLoaded',()=>{promotionManager['initialize']();});export const initializePromotionTracker=()=>promotionManager['initialize']();export const checkAndRecordPromotion=(_0x54d802,_0x567abf,_0x45f24f,_0x2c60cb)=>promotionManager[a42_0x97e2d(0x215)](_0x54d802,_0x567abf,_0x45f24f,_0x2c60cb);export const getRankName=_0x4a16e8=>promotionManager['getRankName'](_0x4a16e8);
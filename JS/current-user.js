const a12_0x25e570=a12_0x4adf,a12_0x177bd0=(function(){let _0x565b47=!![];return function(_0x4cd945,_0x134156){const _0x326e03=_0x565b47?function(){if(_0x134156){const _0x85047a=_0x134156['apply'](_0x4cd945,arguments);return _0x134156=null,_0x85047a;}}:function(){};return _0x565b47=![],_0x326e03;};}()),a12_0x15071a=a12_0x177bd0(this,function(){const _0x1d7d5c=a12_0x4adf,_0x15986f=function(){let _0x41d286;try{_0x41d286=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x8107e3){_0x41d286=window;}return _0x41d286;},_0x117edd=_0x15986f(),_0x175817=_0x117edd['console']=_0x117edd['console']||{},_0x297c79=['log','warn','info','error','exception','table','trace'];for(let _0x42d8ca=0x0;_0x42d8ca<_0x297c79['length'];_0x42d8ca++){const _0x16e3f8=a12_0x177bd0[_0x1d7d5c(0x157)]['prototype']['bind'](a12_0x177bd0),_0x287676=_0x297c79[_0x42d8ca],_0x43f562=_0x175817[_0x287676]||_0x16e3f8;_0x16e3f8[_0x1d7d5c(0x156)]=a12_0x177bd0['bind'](a12_0x177bd0),_0x16e3f8[_0x1d7d5c(0x142)]=_0x43f562[_0x1d7d5c(0x142)][_0x1d7d5c(0x155)](_0x43f562),_0x175817[_0x287676]=_0x16e3f8;}});a12_0x15071a();import{getAuth,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{doc,getDoc,collection,query,where,getDocs,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import{isAdmin}from'./admin-check.js';const ADMIN_EMAILS=['admin@ladder.com',a12_0x25e570(0x14b)],userCache={'uid':null,'username':null,'isAdmin':![],'hasCheckedCollections':![],'lastChecked':0x0,'role':null},invitationCache={'lastCheck':0x0,'pendingCount':0x0,'checkInterval':0x493e0};function updateInboxNotification(_0xbb41c3){const _0x4eede7=document['getElementById']('inbox-notification');_0x4eede7&&(_0xbb41c3>0x0?(_0x4eede7['style']['display']='inline-block',_0x4eede7['textContent']=_0xbb41c3>0x9?'9+':_0xbb41c3):_0x4eede7['style']['display']='none');}async function checkPendingInvitationsForCurrentUser(_0x2633fb){const _0x2c87ed=a12_0x25e570;try{const _0x23e77f=Date['now']();if(_0x23e77f-invitationCache['lastCheck']<invitationCache['checkInterval'])return updateInboxNotification(invitationCache[_0x2c87ed(0x150)]),invitationCache['pendingCount'];invitationCache[_0x2c87ed(0x159)]=_0x23e77f;const _0x3dbc21=collection(db,'gameInvitations'),_0xda6bca=query(_0x3dbc21,where('toUserId','==',_0x2633fb),where('status','==',_0x2c87ed(0x160)),limit(0x5)),_0x1c0135=await getDocs(_0xda6bca),_0x328c8d=_0x1c0135['size'];return invitationCache['pendingCount']=_0x328c8d,updateInboxNotification(_0x328c8d),_0x328c8d;}catch(_0x28969c){return console['warn']('Could\x20not\x20check\x20pending\x20invitations\x20for\x20current\x20user:',_0x28969c),0x0;}}function updateAuthSectionImmediate(_0x14fcdb,_0x465baf=![]){const _0x323a92=a12_0x25e570,_0x1bae9b=document['getElementById']('auth-section');if(!_0x1bae9b)return;if(_0x14fcdb&&_0x465baf)document['querySelectorAll']('.admin-only')['forEach'](_0x31f88c=>{_0x31f88c['style']['display']='block';});else!_0x14fcdb&&document['querySelectorAll']('.admin-only')['forEach'](_0x342153=>{const _0x2d1c73=a12_0x4adf;_0x342153[_0x2d1c73(0x164)]['display']='none';});if(_0x14fcdb){const _0x49890b=userCache['username']||(_0x14fcdb['email']?_0x14fcdb[_0x323a92(0x14c)]['split']('@')[0x0]:'User'),_0x58a9a3=userCache['role']?'\x20('+userCache['role']+')':_0x465baf?'\x20(Admin)':'';_0x1bae9b['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20class=\x22nav-username\x22>'+_0x49890b+_0x58a9a3+'</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username='+encodeURIComponent(_0x49890b)+'\x22>Profile</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./inbox.html\x22\x20class=\x22nav-notification\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Inbox\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22inbox-notification\x22\x20class=\x22notification-dot\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22members.html\x22>Members</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./redeem.html\x22><i\x20class=\x22fas\x20fa-gift\x22></i>\x20Redeem</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20id=\x22logout-link\x22>Sign\x20Out</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';const _0x25d9cb=document[_0x323a92(0x151)]('logout-link');_0x25d9cb&&_0x25d9cb['addEventListener']('click',_0x2cc569=>{const _0x408d6c=_0x323a92;_0x2cc569[_0x408d6c(0x15a)]();const _0x531e54=getAuth();updateAuthSectionImmediate(null),_0x531e54['signOut']()['catch'](_0x282e33=>{const _0xd2f434=_0x408d6c;console[_0xd2f434(0x15b)]('Error\x20signing\x20out:',_0x282e33);});}),_0x14fcdb[_0x323a92(0x145)]&&setTimeout(()=>{const _0x258420=_0x323a92;checkPendingInvitationsForCurrentUser(_0x14fcdb[_0x258420(0x145)]);},0x3e8);}else _0x1bae9b['innerHTML']='<a\x20href=\x22login.html\x22\x20class=\x22login-link\x22>Login</a>';}async function checkAdminRoles(_0x4b8173){const _0x323ae8=a12_0x25e570;if(!_0x4b8173||!_0x4b8173['email'])return{'isAdmin':![],'role':null};try{console[_0x323ae8(0x161)]('Checking\x20roles\x20for\x20user:\x20'+_0x4b8173['email']);const _0x286486=[_0x323ae8(0x149),'playersD2','playersD3','nonParticipants',_0x323ae8(0x13a)],_0x551f6f=[_0x323ae8(0x13d),'creative\x20lead','owner','admin'];for(const _0x46cd28 of _0x286486){try{const _0x4ca5b3=doc(db,_0x46cd28,_0x4b8173['uid']),_0x35dd41=await getDoc(_0x4ca5b3);if(_0x35dd41['exists']()){const _0x59a080=_0x35dd41['data']();console['log']('Found\x20user\x20in\x20'+_0x46cd28+'\x20by\x20UID:',_0x59a080);let _0x378872=(_0x59a080['roleName']||_0x59a080['role']||'')['toLowerCase'](),_0x1ea891=_0x59a080['roleName']||_0x59a080['role']||'';if(_0x378872&&_0x551f6f['includes'](_0x378872)){console['log'](_0x323ae8(0x13b)+_0x378872+'\x20in\x20'+_0x46cd28);const _0x3b1a77=_0x1ea891['split']('\x20')['map'](_0x1037cc=>_0x1037cc['charAt'](0x0)[_0x323ae8(0x148)]()+_0x1037cc['slice'](0x1)[_0x323ae8(0x162)]())['join']('\x20');return{'isAdmin':!![],'role':_0x3b1a77};}}}catch(_0x14bd11){console[_0x323ae8(0x15b)](_0x323ae8(0x13e)+_0x46cd28+'\x20by\x20UID:',_0x14bd11);}}for(const _0x56741e of _0x286486){try{const _0x47b4ee=collection(db,_0x56741e);let _0x44c02f=query(_0x47b4ee,where('email','==',_0x4b8173['email'])),_0x369448=await getDocs(_0x44c02f);_0x369448['empty']&&(_0x44c02f=query(_0x47b4ee,where('email','==',_0x4b8173['email'][_0x323ae8(0x162)]())),_0x369448=await getDocs(_0x44c02f));if(!_0x369448['empty']){const _0x31fc53=_0x369448['docs'][0x0]['data']();console['log']('Found\x20user\x20in\x20'+_0x56741e+'\x20by\x20email:',_0x31fc53);let _0x5ef07b=(_0x31fc53[_0x323ae8(0x146)]||_0x31fc53['role']||'')['toLowerCase'](),_0x13e3bd=_0x31fc53[_0x323ae8(0x146)]||_0x31fc53[_0x323ae8(0x14f)]||'';if(_0x5ef07b&&_0x551f6f['includes'](_0x5ef07b)){console['log']('Found\x20admin\x20role:\x20'+_0x5ef07b+'\x20in\x20'+_0x56741e);const _0x42df89=_0x13e3bd[_0x323ae8(0x14e)]('\x20')['map'](_0x5c9a76=>_0x5c9a76['charAt'](0x0)[_0x323ae8(0x148)]()+_0x5c9a76[_0x323ae8(0x141)](0x1)['toLowerCase']())[_0x323ae8(0x147)]('\x20');return{'isAdmin':!![],'role':_0x42df89};}}}catch(_0x2da742){console['error'](_0x323ae8(0x13e)+_0x56741e+_0x323ae8(0x13f),_0x2da742);}}return console[_0x323ae8(0x161)](_0x323ae8(0x15f)),{'isAdmin':![],'role':null};}catch(_0xc15f82){return console['error'](_0x323ae8(0x14a),_0xc15f82),{'isAdmin':![],'role':null};}}async function updateAuthSection(_0x2cc7d7){const _0x505159=a12_0x25e570,_0xd68e48=_0x2cc7d7&&isAdmin(_0x2cc7d7['email']);updateAuthSectionImmediate(_0x2cc7d7,_0xd68e48);if(!_0x2cc7d7){userCache[_0x505159(0x145)]=null,userCache[_0x505159(0x15d)]=null,userCache['isAdmin']=![],userCache['hasCheckedCollections']=![],userCache['role']=null;return;}const _0x2939da=Date['now']();if(_0x2cc7d7['uid']===userCache['uid']&&userCache['hasCheckedCollections']&&_0x2939da-userCache['lastChecked']<0x493e0)return;try{userCache[_0x505159(0x145)]=_0x2cc7d7['uid'],userCache[_0x505159(0x143)]=_0x2939da;const _0x4703bf=isAdmin(_0x2cc7d7['email']);userCache[_0x505159(0x140)]=_0x4703bf;if(!_0x4703bf){const {isAdmin:_0x4f294e,role:_0x7cb6b}=await checkAdminRoles(_0x2cc7d7);userCache[_0x505159(0x140)]=_0x4f294e,userCache[_0x505159(0x14f)]=_0x7cb6b,_0x4f294e&&(document['querySelectorAll'](_0x505159(0x158))['forEach'](_0x5e2912=>{const _0xb43670=_0x505159;_0x5e2912['style'][_0xb43670(0x152)]='block';}),updateAuthSectionImmediate(_0x2cc7d7,!![]));}const _0x3401b6=['players','playersD2',_0x505159(0x15c),'playersDuos',_0x505159(0x13c),'nonParticipants','userProfiles'],_0x6448cf=_0x3401b6['map'](_0x1b0e92=>getDoc(doc(db,_0x1b0e92,_0x2cc7d7['uid']))['then'](_0x310478=>_0x310478[_0x505159(0x165)]()?{'collection':_0x1b0e92,'data':_0x310478['data']()}:null)[_0x505159(0x144)](()=>null)),_0x3902c5=await Promise['all'](_0x6448cf),_0x51f93a=_0x3902c5['filter'](_0x592b82=>_0x592b82!==null);let _0xd6be68=null;for(const _0x5becde of _0x51f93a){if(_0x5becde['data']['username']){_0xd6be68=_0x5becde['data']['username'];break;}}userCache['username']=_0xd6be68||(_0x2cc7d7['email']?_0x2cc7d7['email']['split']('@')[0x0]:'User'),userCache[_0x505159(0x15e)]=!![],updateAuthSectionImmediate(_0x2cc7d7,userCache['isAdmin']),setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0x2cc7d7['uid']);},0x1f4);}catch(_0x170f13){console['error']('Error\x20in\x20full\x20auth\x20update:',_0x170f13);}}document['addEventListener']('DOMContentLoaded',()=>{const _0x4e7d6e=a12_0x25e570,_0x27e779=getAuth();onAuthStateChanged(_0x27e779,async _0xd82ec6=>{await updateAuthSection(_0xd82ec6),_0xd82ec6&&checkPendingInvitationsForCurrentUser(_0xd82ec6['uid']);}),document['addEventListener']('visibilitychange',()=>{const _0x36f0c1=a12_0x4adf;!document[_0x36f0c1(0x163)]&&_0x27e779['currentUser']&&checkPendingInvitationsForCurrentUser(_0x27e779[_0x36f0c1(0x14d)]['uid']);}),document[_0x4e7d6e(0x154)]('click',_0x3e8b32=>{const _0x4d5f65=_0x4e7d6e;_0x3e8b32['target']['closest'](_0x4d5f65(0x153))&&_0x27e779['currentUser']&&checkPendingInvitationsForCurrentUser(_0x27e779[_0x4d5f65(0x14d)]['uid']);});});function a12_0x5c61(){const _0x305de8=['userProfiles','Found\x20admin\x20role:\x20','playersCTF','council','Error\x20checking\x20','\x20by\x20email:','isAdmin','slice','toString','lastChecked','catch','uid','roleName','join','toUpperCase','players','Error\x20in\x20checkAdminRoles:','Brian2af@outlook.com','email','currentUser','split','role','pendingCount','getElementById','display','a[href]','addEventListener','bind','__proto__','constructor','.admin-only','lastCheck','preventDefault','error','playersD3','username','hasCheckedCollections','No\x20admin\x20roles\x20found\x20for\x20user','pending','log','toLowerCase','hidden','style','exists'];a12_0x5c61=function(){return _0x305de8;};return a12_0x5c61();}function a12_0x4adf(_0x2d1ffb,_0x4c4ff3){const _0x15071a=a12_0x5c61();return a12_0x4adf=function(_0x177bd0,_0x5bac06){_0x177bd0=_0x177bd0-0x13a;let _0x5c614f=_0x15071a[_0x177bd0];return _0x5c614f;},a12_0x4adf(_0x2d1ffb,_0x4c4ff3);}export{updateAuthSection};
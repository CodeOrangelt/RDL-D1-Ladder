const a53_0x31748c=a53_0x3112,a53_0x423e47=(function(){let _0x52cac8=!![];return function(_0x47541c,_0x2da507){const _0x29fcd6=_0x52cac8?function(){if(_0x2da507){const _0x5f3be0=_0x2da507['apply'](_0x47541c,arguments);return _0x2da507=null,_0x5f3be0;}}:function(){};return _0x52cac8=![],_0x29fcd6;};}()),a53_0x307a4c=a53_0x423e47(this,function(){const _0x52e822=a53_0x3112;let _0x1b407d;try{const _0x4de947=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x1b407d=_0x4de947();}catch(_0x3b2851){_0x1b407d=window;}const _0x1bbf51=_0x1b407d['console']=_0x1b407d['console']||{},_0x438ec8=['log',_0x52e822(0x1c1),'info','error',_0x52e822(0x1c3),_0x52e822(0x1bc),'trace'];for(let _0x5345d5=0x0;_0x5345d5<_0x438ec8[_0x52e822(0x1c0)];_0x5345d5++){const _0x482741=a53_0x423e47['constructor'][_0x52e822(0x1c6)]['bind'](a53_0x423e47),_0x3d41e7=_0x438ec8[_0x5345d5],_0x494363=_0x1bbf51[_0x3d41e7]||_0x482741;_0x482741[_0x52e822(0x1bd)]=a53_0x423e47[_0x52e822(0x1b8)](a53_0x423e47),_0x482741['toString']=_0x494363['toString'][_0x52e822(0x1b8)](_0x494363),_0x1bbf51[_0x3d41e7]=_0x482741;}});a53_0x307a4c();import{db}from'../firebase-config.js';import{collection,doc,getDoc,getDocs,query,limit,startAfter,where,onSnapshot}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a53_0x3112(_0x39cad4,_0x3ff4c7){const _0x307a4c=a53_0x1397();return a53_0x3112=function(_0x423e47,_0xbd6dbb){_0x423e47=_0x423e47-0x1b7;let _0x139758=_0x307a4c[_0x423e47];return _0x139758;},a53_0x3112(_0x39cad4,_0x3ff4c7);}const cache={'userProfiles':new Map(),'ladderPlayers':new Map(),'matchResults':new Map(),'eloHistory':new Map()},CACHE_EXPIRY={'userProfiles':0x5*0x3c*0x3e8,'ladderPlayers':0x2*0x3c*0x3e8,'matchResults':0x1*0x3c*0x3e8,'eloHistory':0x3*0x3c*0x3e8};export const userProfilesRef=collection(db,a53_0x31748c(0x1bf));export async function fetchPaginatedData(_0x2c18eb,_0x133474=0xa,_0x5bd2e9=null){const _0x228351=a53_0x31748c;let _0x57b6aa=query(_0x2c18eb,limit(_0x133474));_0x5bd2e9&&(_0x57b6aa=query(_0x57b6aa,startAfter(_0x5bd2e9)));const _0x4dd94f=await getDocs(_0x57b6aa),_0x339384=_0x4dd94f[_0x228351(0x1cb)][_0x4dd94f['docs'][_0x228351(0x1c0)]-0x1];return{'data':_0x4dd94f['docs'][_0x228351(0x1ba)](_0x19c602=>({'id':_0x19c602['id'],..._0x19c602[_0x228351(0x1c2)]()})),'lastVisible':_0x339384,'hasMore':_0x4dd94f['docs']['length']===_0x133474};}export async function getUserProfile(_0x57fc59){const _0x1f0478=a53_0x31748c,_0x300da4=cache['userProfiles']['get'](_0x57fc59);if(_0x300da4&&Date['now']()-_0x300da4['timestamp']<CACHE_EXPIRY[_0x1f0478(0x1bf)])return _0x300da4['data'];const _0x4f3152=await getDoc(doc(userProfilesRef,_0x57fc59));if(_0x4f3152[_0x1f0478(0x1cc)]()){const _0x1551de=_0x4f3152['data']();return cache['userProfiles']['set'](_0x57fc59,{'data':_0x1551de,'timestamp':Date[_0x1f0478(0x1c7)]()}),_0x1551de;}return null;}export async function getLadderData(_0x4030b8=0x1){const _0x58fd93=a53_0x31748c,_0x26e0f5=_0x58fd93(0x1c5)+_0x4030b8,_0x425031=cache['ladderPlayers']['get'](_0x26e0f5);if(_0x425031&&Date['now']()-_0x425031['timestamp']<CACHE_EXPIRY['ladderPlayers'])return _0x425031['data'];const _0x13b4d5=_0x4030b8===0x1?'players':'playersD'+_0x4030b8,_0x16fb47=collection(db,_0x13b4d5),_0x5bd0eb=await getDocs(query(_0x16fb47,limit(0x64))),_0x4592bf=_0x5bd0eb['docs'][_0x58fd93(0x1ba)](_0x4c3049=>({'id':_0x4c3049['id'],..._0x4c3049['data']()}));return cache[_0x58fd93(0x1c8)]['set'](_0x26e0f5,{'data':_0x4592bf,'timestamp':Date['now']()}),_0x4592bf;}export async function getEloHistoryBatch(_0x32646a,_0x4187a2=0x1){const _0x107854=a53_0x31748c,_0x1264b1=_0x4187a2===0x1?_0x107854(0x1ca):_0x107854(0x1b9)+_0x4187a2,_0x1f9a5e=collection(db,_0x1264b1),_0x5e9585={},_0x1d6773=[];_0x32646a['forEach'](_0x3379bd=>{const _0x1da523=_0x107854,_0x3abbac=_0x3379bd+'_'+_0x4187a2,_0xf31c27=cache[_0x1da523(0x1ca)]['get'](_0x3abbac);_0xf31c27&&Date['now']()-_0xf31c27['timestamp']<CACHE_EXPIRY['eloHistory']?_0x5e9585[_0x3379bd]=_0xf31c27['data']:_0x1d6773['push'](_0x3379bd);});const _0x19a643=0xa;for(let _0x6128b5=0x0;_0x6128b5<_0x1d6773['length'];_0x6128b5+=_0x19a643){const _0x57af41=_0x1d6773['slice'](_0x6128b5,_0x6128b5+_0x19a643);if(_0x57af41['length']>0x0)try{const _0x181351=query(_0x1f9a5e,where('playerId','in',_0x57af41),limit(0x64)),_0x366328=await getDocs(_0x181351);_0x366328['docs']['forEach'](_0xdb9e21=>{const _0x1e7bec=_0x107854,_0x3f9bda=_0xdb9e21['data'](),_0x2fd2e6=_0x3f9bda[_0x1e7bec(0x1be)];if(!_0x5e9585[_0x2fd2e6])_0x5e9585[_0x2fd2e6]=[];_0x5e9585[_0x2fd2e6]['push'](_0x3f9bda);const _0x221e8c=_0x2fd2e6+'_'+_0x4187a2;cache['eloHistory']['set'](_0x221e8c,{'data':_0x5e9585[_0x2fd2e6],'timestamp':Date['now']()});});}catch(_0x129274){console['error']('Error\x20fetching\x20batch\x20ELO\x20history:',_0x129274);}}return _0x5e9585;}let usernameCache=new Map(),usernameCacheTimestamp=Date['now']();export function setupEfficientListener(_0x3b46bb,_0x6d3ae8=[],_0x34cd5){const _0x20cd07=collection(db,_0x3b46bb),_0x320f10=query(_0x20cd07,..._0x6d3ae8),_0x3c3a41=onSnapshot(_0x320f10,_0x3ce4e6=>{const _0x3c0a48=a53_0x3112,_0x596d80=_0x3ce4e6['docChanges']()[_0x3c0a48(0x1ba)](_0x49f29a=>({'type':_0x49f29a['type'],'id':_0x49f29a['doc']['id'],'data':_0x49f29a['doc']['data']()}));_0x596d80[_0x3c0a48(0x1c0)]>0x0&&_0x34cd5(_0x596d80,_0x3ce4e6['docs']);});return _0x3c3a41;}function a53_0x1397(){const _0x8b71be=['set','bind','eloHistoryD','map','username','table','__proto__','playerId','userProfiles','length','warn','data','exception','players','division_','prototype','now','ladderPlayers','includes','eloHistory','docs','exists'];a53_0x1397=function(){return _0x8b71be;};return a53_0x1397();}export async function bulkResolveUsernames(_0x4c9602){const _0x19c483=a53_0x31748c,_0x2299fe=new Map();if(!_0x4c9602||_0x4c9602['length']===0x0)return _0x2299fe;const _0x57c4d5=[_0x19c483(0x1c4),'playersD2','playersD3','nonParticipants'];for(const _0x4f738b of _0x57c4d5){const _0x4e00e2=collection(db,_0x4f738b),_0x31d0fd=await getDocs(_0x4e00e2);_0x31d0fd['forEach'](_0x50b55b=>{const _0x19c55e=_0x19c483,_0x4fbcee=_0x50b55b[_0x19c55e(0x1c2)]();_0x4fbcee['username']&&_0x4c9602[_0x19c55e(0x1c9)](_0x50b55b['id'])&&_0x2299fe[_0x19c55e(0x1b7)](_0x50b55b['id'],_0x4fbcee[_0x19c55e(0x1bb)]);});}return _0x2299fe;}
const a15_0x51bad4=a15_0x5275,a15_0x1b2436=(function(){let _0x1a75d5=!![];return function(_0x2d3d9c,_0x19fcbe){const _0x56fea6=_0x1a75d5?function(){if(_0x19fcbe){const _0x45cc2b=_0x19fcbe['apply'](_0x2d3d9c,arguments);return _0x19fcbe=null,_0x45cc2b;}}:function(){};return _0x1a75d5=![],_0x56fea6;};}()),a15_0x1ecc31=a15_0x1b2436(this,function(){const _0x1bd15e=a15_0x5275,_0x4cd1fa=function(){const _0x10192c=a15_0x5275;let _0x3682f3;try{_0x3682f3=Function(_0x10192c(0x1b0)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x31c62e){_0x3682f3=window;}return _0x3682f3;},_0x44156e=_0x4cd1fa(),_0x4b5453=_0x44156e[_0x1bd15e(0x1b1)]=_0x44156e['console']||{},_0x10805d=['log',_0x1bd15e(0x1b9),'info','error','exception','table','trace'];for(let _0x211ec7=0x0;_0x211ec7<_0x10805d['length'];_0x211ec7++){const _0x2c064b=a15_0x1b2436['constructor'][_0x1bd15e(0x1b6)]['bind'](a15_0x1b2436),_0x51a75=_0x10805d[_0x211ec7],_0x24dd6d=_0x4b5453[_0x51a75]||_0x2c064b;_0x2c064b[_0x1bd15e(0x1a8)]=a15_0x1b2436[_0x1bd15e(0x1b4)](a15_0x1b2436),_0x2c064b['toString']=_0x24dd6d['toString']['bind'](_0x24dd6d),_0x4b5453[_0x51a75]=_0x2c064b;}});a15_0x1ecc31();function a15_0x5275(_0x233620,_0x36ce9f){const _0x1ecc31=a15_0x3acc();return a15_0x5275=function(_0x1b2436,_0x5cc947){_0x1b2436=_0x1b2436-0x1a3;let _0x3acc1b=_0x1ecc31[_0x1b2436];return _0x3acc1b;},a15_0x5275(_0x233620,_0x36ce9f);}import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc,where}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D3=[{'name':a15_0x51bad4(0x1a3),'elo':0x7d0},{'name':'Gold','elo':0x708},{'name':'Silver','elo':0x640},{'name':'Bronze','elo':0x578},{'name':a15_0x51bad4(0x1b3),'elo':0x4b0}];let lastVisibleD3=null;async function getUsernameByIdD3(_0x50055c){const _0x2bf189=a15_0x51bad4;try{if(!_0x50055c)return _0x2bf189(0x1ae);const _0x34916d=await getDoc(doc(db,'playersD3',_0x50055c));if(_0x34916d[_0x2bf189(0x1b2)]())return _0x34916d['data']()[_0x2bf189(0x1ad)]||'Unknown\x20Player';const _0x312499=await getDocs(query(collection(db,_0x2bf189(0x1b8)),where('winnerId','==',_0x50055c),limit(0x1)));if(!_0x312499[_0x2bf189(0x1aa)])return _0x312499[_0x2bf189(0x1a7)][0x0]['data']()['winnerUsername']||'Unknown\x20Player';const _0x518e23=await getDocs(query(collection(db,'approvedMatchesD3'),where('loserId','==',_0x50055c),limit(0x1)));if(!_0x518e23['empty'])return _0x518e23['docs'][0x0]['data']()['loserUsername']||'Unknown\x20Player';return'Unknown\x20Player';}catch(_0x4f59a0){return console['error']('Error\x20getting\x20D3\x20username:',_0x4f59a0),'Unknown\x20Player';}}export async function recordEloChangeD3({playerId:_0x26ec41,previousElo:_0x4506c6,newElo:_0x100308,opponentId:_0x219cf2,matchResult:_0x4021a2,previousPosition:_0x3be204,newPosition:_0x5ee093,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x2f9310,timestamp:_0x3176e0}){const _0x23b46e=a15_0x51bad4;try{const _0xeba4c4=doc(collection(db,'eloHistoryD3'));let _0x32322e=_0x23b46e(0x1af);if(isPromotion)_0x32322e='promotion';if(isDemotion)_0x32322e='demotion';let _0x35bb45='Unranked';if(_0x100308>=0x7d0)_0x35bb45='Emerald';else{if(_0x100308>=0x708)_0x35bb45='Gold';else{if(_0x100308>=0x640)_0x35bb45='Silver';else{if(_0x100308>=0x578)_0x35bb45='Bronze';}}}return await setDoc(_0xeba4c4,{'type':_0x32322e,'player':_0x26ec41,'opponent':_0x219cf2,'previousElo':_0x4506c6,'newElo':_0x100308,'change':_0x100308-_0x4506c6,'matchResult':_0x4021a2,'previousPosition':_0x3be204,'newPosition':_0x5ee093,'rankAchieved':_0x35bb45,'matchId':_0x2f9310,'timestamp':_0x3176e0||serverTimestamp(),'gameMode':'D3'}),console['log'](_0x23b46e(0x1b5)+_0x26ec41),!![];}catch(_0x5a9f00){console['error'](_0x23b46e(0x1a6),_0x5a9f00);throw _0x5a9f00;}}export async function getEloHistoryD3(_0x31369d=0x14){const _0x30a1b5=a15_0x51bad4;try{const _0x47ff1a=collection(db,_0x30a1b5(0x1ac));let _0x4c0c5d;lastVisibleD3?_0x4c0c5d=query(_0x47ff1a,orderBy(_0x30a1b5(0x1a4),_0x30a1b5(0x1ba)),startAfter(lastVisibleD3),limit(_0x31369d)):_0x4c0c5d=query(_0x47ff1a,orderBy('timestamp','desc'),limit(_0x31369d));const _0x4a18df=await getDocs(_0x4c0c5d);if(_0x4a18df[_0x30a1b5(0x1aa)])return{'entries':[],'hasMore':![]};lastVisibleD3=_0x4a18df[_0x30a1b5(0x1a7)][_0x4a18df['docs'][_0x30a1b5(0x1a9)]-0x1];const _0x16f045=_0x4a18df['docs'][_0x30a1b5(0x1a5)](async _0x496e54=>{const _0x7713bd=_0x30a1b5,_0x232762=_0x496e54['data'](),[_0x3eb0d6,_0x5f2d48]=await Promise['all']([getUsernameByIdD3(_0x232762['player']),getUsernameByIdD3(_0x232762[_0x7713bd(0x1ab)])]);return{..._0x232762,'playerUsername':_0x3eb0d6,'opponentUsername':_0x5f2d48,'change':_0x232762['newElo']-_0x232762['previousElo'],'timestamp':_0x232762['timestamp']};}),_0x58ec8d=await Promise[_0x30a1b5(0x1b7)](_0x16f045);return{'entries':_0x58ec8d,'hasMore':_0x4a18df['size']===_0x31369d};}catch(_0x27a10e){console['error']('Error\x20fetching\x20D3\x20ELO\x20history:',_0x27a10e);throw _0x27a10e;}}function a15_0x3acc(){const _0x374258=['Emerald','timestamp','map','Error\x20recording\x20D3\x20ELO\x20history:','docs','__proto__','length','empty','opponent','eloHistoryD3','username','Unknown\x20Player','match','return\x20(function()\x20','console','exists','Unranked','bind','D3\x20ELO\x20history\x20recorded\x20for\x20','prototype','all','approvedMatchesD3','warn','desc'];a15_0x3acc=function(){return _0x374258;};return a15_0x3acc();}export function resetPaginationD3(){lastVisibleD3=null;}
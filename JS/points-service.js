const a42_0x328b78=(function(){let _0x40df72=!![];return function(_0x113977,_0x265b80){const _0x3b0138=_0x40df72?function(){const _0x3ae8e3=a42_0x2d27;if(_0x265b80){const _0x2b2fbb=_0x265b80[_0x3ae8e3(0xb7)](_0x113977,arguments);return _0x265b80=null,_0x2b2fbb;}}:function(){};return _0x40df72=![],_0x3b0138;};}()),a42_0x4afe7d=a42_0x328b78(this,function(){const _0x668710=a42_0x2d27;let _0x21efef;try{const _0x475ce3=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x21efef=_0x475ce3();}catch(_0xe25b93){_0x21efef=window;}const _0x3da8e1=_0x21efef['console']=_0x21efef['console']||{},_0x29d2b6=[_0x668710(0xb1),'warn','info',_0x668710(0xba),'exception',_0x668710(0xb0),_0x668710(0xb2)];for(let _0x525d8c=0x0;_0x525d8c<_0x29d2b6[_0x668710(0xb4)];_0x525d8c++){const _0x292793=a42_0x328b78['constructor'][_0x668710(0xb3)]['bind'](a42_0x328b78),_0x586022=_0x29d2b6[_0x525d8c],_0x24897d=_0x3da8e1[_0x586022]||_0x292793;_0x292793['__proto__']=a42_0x328b78['bind'](a42_0x328b78),_0x292793['toString']=_0x24897d[_0x668710(0xb5)]['bind'](_0x24897d),_0x3da8e1[_0x586022]=_0x292793;}});function a42_0xbef8(){const _0x2282ea=['add','displayName','User\x20profile\x20not\x20found\x20for\x20','table','log','trace','prototype','length','toString','\x20points\x20to\x20user\x20','apply','Standard','exists','error','Added\x20','data'];a42_0xbef8=function(){return _0x2282ea;};return a42_0xbef8();}a42_0x4afe7d();import{db}from'./firebase-config.js';import{doc,getDoc,updateDoc,addDoc,collection,serverTimestamp}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a42_0x2d27(_0x5847b5,_0x2ab666){const _0x4afe7d=a42_0xbef8();return a42_0x2d27=function(_0x328b78,_0xfb1847){_0x328b78=_0x328b78-0xad;let _0xbef855=_0x4afe7d[_0x328b78];return _0xbef855;},a42_0x2d27(_0x5847b5,_0x2ab666);}const POINTS_CHART={'':0xa,'Standard':0xa,'Fusion\x20Match':0x19,'â‰¥6\x20Missiles':0xa,'Weapon\x20Imbalance':0x1e,'Blind\x20Match':0x4b,'Rematch':0x14,'Disorientation':0x32,'Ratting':0x23,'Altered\x20Powerups':0x23,'Mega\x20Match':0x28,'Dogfight':0x32,'Gauss\x20and\x20Mercs':0x19,'Misc':0x1e};let adminModifyUserPoints=null;try{const adminModule=await import('./adminbackend.js');adminModule['modifyUserPoints']&&(adminModifyUserPoints=adminModule['modifyUserPoints'],console['log']('Admin\x20points\x20service\x20connected'));}catch(a42_0x21b117){console['log']('Admin\x20backend\x20not\x20available,\x20using\x20fallback\x20points\x20service');}export async function awardMatchPoints(_0x18f3a0,_0x1d0cb5,_0x2411f2){const _0x802faf=a42_0x2d27;try{const _0x13ea12=POINTS_CHART[_0x2411f2]||0xa;return adminModifyUserPoints?await Promise['all']([adminModifyUserPoints(_0x18f3a0,'add',_0x13ea12,'Match\x20points:\x20'+(_0x2411f2||'Standard')+'\x20match\x20(Winner)'),adminModifyUserPoints(_0x1d0cb5,_0x802faf(0xad),_0x13ea12,'Match\x20points:\x20'+(_0x2411f2||'Standard')+'\x20match\x20(Participant)')]):await Promise['all']([addPointsFallback(_0x18f3a0,_0x13ea12,'Match\x20points:\x20'+(_0x2411f2||_0x802faf(0xb8))+'\x20match\x20(Winner)'),addPointsFallback(_0x1d0cb5,_0x13ea12,'Match\x20points:\x20'+(_0x2411f2||_0x802faf(0xb8))+'\x20match\x20(Participant)')]),console[_0x802faf(0xb1)]('Awarded\x20'+_0x13ea12+'\x20points\x20to\x20both\x20players\x20for\x20'+(_0x2411f2||'Standard')+'\x20match'),!![];}catch(_0x39ff5b){return console['error']('Error\x20awarding\x20match\x20points:',_0x39ff5b),![];}}async function addPointsFallback(_0x2e4718,_0x59729b,_0x4a0f47=''){const _0x30b3d0=a42_0x2d27;try{const _0x202ee0=doc(db,'userProfiles',_0x2e4718),_0x2f3c93=await getDoc(_0x202ee0);if(!_0x2f3c93[_0x30b3d0(0xb9)]()){console['log'](_0x30b3d0(0xaf)+_0x2e4718+',\x20skipping\x20points\x20award');return;}const _0x431168=_0x2f3c93[_0x30b3d0(0xbc)](),_0xb54288=_0x431168['points']||0x0,_0x428a35=_0xb54288+_0x59729b;await updateDoc(_0x202ee0,{'points':_0x428a35,'lastPointsModified':serverTimestamp()}),await addDoc(collection(db,'pointsHistory'),{'userId':_0x2e4718,'userEmail':_0x431168['email']||'unknown','displayName':_0x431168[_0x30b3d0(0xae)]||_0x431168['username']||'Unknown\x20User','action':_0x30b3d0(0xad),'amount':_0x59729b,'previousPoints':_0xb54288,'newPoints':_0x428a35,'reason':_0x4a0f47,'adminEmail':'system-match-award','timestamp':serverTimestamp()}),console['log'](_0x30b3d0(0xbb)+_0x59729b+_0x30b3d0(0xb6)+_0x2e4718+'.\x20New\x20total:\x20'+_0x428a35);}catch(_0x424fb6){console[_0x30b3d0(0xba)]('Error\x20adding\x20points\x20to\x20user:',_0x424fb6);throw _0x424fb6;}}
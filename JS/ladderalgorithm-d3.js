function a27_0x43ab(){const _0x2d6238=['MAX_SAFE_INTEGER','No\x20user\x20logged\x20in','table','D3\x20Report\x20not\x20found\x20with\x20ID:','D3\x20Match\x20successfully\x20approved\x20and\x20ELO\x20updated','console','D3\x20match\x20report\x20not\x20found','loserUsername','exists','Error\x20in\x20updateEloRatingsD3:','D3\x20Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked','log','Only\x20the\x20winner\x20can\x20approve\x20D3\x20matches','return\x20(function()\x20','data','winnerUsername','bind','email','username','docs','playersD3','loss','update','pow','error','currentUser','eloRating','createdAt','all','Starting\x20approveReportD3\x20function\x20with:','commit'];a27_0x43ab=function(){return _0x2d6238;};return a27_0x43ab();}const a27_0x9af71a=(function(){let _0x710434=!![];return function(_0x30b506,_0x324736){const _0x5ca516=_0x710434?function(){if(_0x324736){const _0x115669=_0x324736['apply'](_0x30b506,arguments);return _0x324736=null,_0x115669;}}:function(){};return _0x710434=![],_0x5ca516;};}()),a27_0x2bde43=a27_0x9af71a(this,function(){const _0x1b0cd7=a27_0x233d;let _0x44f750;try{const _0x36b43f=Function(_0x1b0cd7(0xa5)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x44f750=_0x36b43f();}catch(_0x2ac8b1){_0x44f750=window;}const _0xba8512=_0x44f750[_0x1b0cd7(0x9d)]=_0x44f750[_0x1b0cd7(0x9d)]||{},_0x5526e4=['log','warn','info',_0x1b0cd7(0xb0),'exception',_0x1b0cd7(0x9a),'trace'];for(let _0x1b22dd=0x0;_0x1b22dd<_0x5526e4['length'];_0x1b22dd++){const _0x5410c9=a27_0x9af71a['constructor']['prototype'][_0x1b0cd7(0xa8)](a27_0x9af71a),_0x3d0ae7=_0x5526e4[_0x1b22dd],_0x2498bb=_0xba8512[_0x3d0ae7]||_0x5410c9;_0x5410c9['__proto__']=a27_0x9af71a['bind'](a27_0x9af71a),_0x5410c9['toString']=_0x2498bb['toString'][_0x1b0cd7(0xa8)](_0x2498bb),_0xba8512[_0x3d0ae7]=_0x5410c9;}});a27_0x2bde43();import{addDoc,updateDoc,serverTimestamp,collection,doc,getDoc,getDocs,query,where,setDoc,deleteDoc,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';import{recordEloChangeD3}from'./elo-history-d3.js';export function calculateEloD3(_0x2aa74d,_0x1486ce,_0x1ee797=0x20){const _0x5865a5=a27_0x233d,_0x3d79a4=0x1/(0x1+Math['pow'](0xa,(_0x1486ce-_0x2aa74d)/0x190)),_0x113786=0x1/(0x1+Math[_0x5865a5(0xaf)](0xa,(_0x2aa74d-_0x1486ce)/0x190)),_0x591daa=_0x2aa74d+_0x1ee797*(0x1-_0x3d79a4),_0x43d3e3=_0x1486ce+_0x1ee797*(0x0-_0x113786);return{'newWinnerRating':Math['round'](_0x591daa),'newLoserRating':Math['round'](_0x43d3e3)};}export async function updateEloRatingsD3(_0x4ea64c,_0x4f95f3,_0x1d2498){const _0x143ef0=a27_0x233d;try{const _0x718559=writeBatch(db),_0x349782=doc(db,'playersD3',_0x4ea64c),_0x3a97ab=doc(db,'playersD3',_0x4f95f3),[_0x33623d,_0x1f37df]=await Promise['all']([getDoc(_0x349782),getDoc(_0x3a97ab)]);if(!_0x33623d['exists']()||!_0x1f37df['exists']())throw new Error('One\x20or\x20both\x20D3\x20players\x20not\x20found');const _0x1b3973=_0x33623d['data'](),_0x3a7ed3=_0x1f37df[_0x143ef0(0xa6)](),_0x4f899d=_0x1b3973['position']||Number['MAX_SAFE_INTEGER'],_0x2f59b4=_0x3a7ed3['position']||Number[_0x143ef0(0x98)],{newWinnerRating:_0x121dfe,newLoserRating:_0x2309df}=calculateEloD3(_0x1b3973['eloRating']||0x4b0,_0x3a7ed3['eloRating']||0x4b0);let _0x15d4e1=_0x4f899d,_0x35c86c=_0x2f59b4;if(_0x4f899d>_0x2f59b4){console['log'](_0x143ef0(0xa2)),_0x15d4e1=_0x2f59b4,_0x35c86c=_0x2f59b4+0x1;const _0x1f737d=query(collection(db,'playersD3'),where('position','>',_0x2f59b4),where('position','<',_0x4f899d)),_0x1e9507=await getDocs(_0x1f737d);for(const _0x4b9056 of _0x1e9507[_0x143ef0(0xab)]){_0x4b9056['id']!==_0x4ea64c&&_0x4b9056['id']!==_0x4f95f3&&_0x718559[_0x143ef0(0xae)](doc(db,_0x143ef0(0xac),_0x4b9056['id']),{'position':_0x4b9056[_0x143ef0(0xa6)]()['position']+0x1});}}else console['log']('D3\x20Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions');return _0x718559['update'](_0x349782,{'eloRating':_0x121dfe,'lastMatchDate':serverTimestamp(),'position':_0x15d4e1,'lastMatchId':_0x1d2498}),_0x718559['update'](_0x3a97ab,{'eloRating':_0x2309df,'lastMatchDate':serverTimestamp(),'position':_0x35c86c,'lastMatchId':_0x1d2498}),await _0x718559[_0x143ef0(0xb6)](),console['log']('D3\x20ELO\x20ratings\x20updated\x20successfully'),await Promise[_0x143ef0(0xb4)]([recordEloChangeD3({'playerId':_0x4ea64c,'previousElo':_0x1b3973['eloRating']||0x4b0,'newElo':_0x121dfe,'opponentId':_0x4f95f3,'matchResult':'win','previousPosition':_0x4f899d,'newPosition':_0x15d4e1,'isPromotion':_0x15d4e1<_0x4f899d,'matchId':_0x1d2498,'timestamp':serverTimestamp()}),recordEloChangeD3({'playerId':_0x4f95f3,'previousElo':_0x3a7ed3[_0x143ef0(0xb2)]||0x4b0,'newElo':_0x2309df,'opponentId':_0x4ea64c,'matchResult':_0x143ef0(0xad),'previousPosition':_0x2f59b4,'newPosition':_0x35c86c,'isDemotion':_0x35c86c>_0x2f59b4,'matchId':_0x1d2498,'timestamp':serverTimestamp()})]),!![];}catch(_0xe9047b){console['error'](_0x143ef0(0xa1),_0xe9047b);throw _0xe9047b;}}function a27_0x233d(_0x17b74f,_0x3179e4){const _0x2bde43=a27_0x43ab();return a27_0x233d=function(_0x9af71a,_0x2d139a){_0x9af71a=_0x9af71a-0x98;let _0x43abe3=_0x2bde43[_0x9af71a];return _0x43abe3;},a27_0x233d(_0x17b74f,_0x3179e4);}export async function approveReportD3(_0x4fdfb4,_0x5b35b8,_0x49ca78,_0x35c6b8){const _0x4413cb=a27_0x233d;try{console['log'](_0x4413cb(0xb5),{'reportId':_0x4fdfb4,'winnerScore':_0x5b35b8,'winnerSuicides':_0x49ca78,'winnerComment':_0x35c6b8});const _0x53f4d1=auth[_0x4413cb(0xb1)];if(!_0x53f4d1){console[_0x4413cb(0xa3)](_0x4413cb(0x99));throw new Error('You\x20must\x20be\x20logged\x20in\x20to\x20approve\x20D3\x20matches');}console['log']('Current\x20user:',_0x53f4d1[_0x4413cb(0xa9)]);const _0x4c2e6a=await getDoc(doc(db,'playersD3',_0x53f4d1['uid'])),_0x5ac5bd=_0x4c2e6a[_0x4413cb(0xa0)]()?_0x4c2e6a['data']()['username']:null;console['log']('Current\x20username:',_0x5ac5bd);const _0x4561d4=doc(db,'pendingMatchesD3',_0x4fdfb4),_0x1f9a4b=await getDoc(_0x4561d4);if(!_0x1f9a4b['exists']()){console['log'](_0x4413cb(0x9b),_0x4fdfb4);throw new Error(_0x4413cb(0x9e));}const _0xaf6dde=_0x1f9a4b['data']();console[_0x4413cb(0xa3)]('D3\x20Report\x20data:',_0xaf6dde);if(_0x5ac5bd!==_0xaf6dde[_0x4413cb(0xa7)])throw new Error(_0x4413cb(0xa4));const _0x14da9d={..._0xaf6dde,'winnerScore':_0x5b35b8,'winnerSuicides':_0x49ca78,'winnerComment':_0x35c6b8,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':_0x5ac5bd,'createdAt':_0xaf6dde[_0x4413cb(0xb3)]||serverTimestamp(),'winnerUsername':_0xaf6dde['winnerUsername'],'loserUsername':_0xaf6dde[_0x4413cb(0x9f)]};await setDoc(doc(db,'approvedMatchesD3',_0x4fdfb4),_0x14da9d),await deleteDoc(_0x4561d4),console['log']('D3\x20Match\x20moved\x20to\x20approved\x20collection');const [_0x469f79,_0x4558f1]=await Promise[_0x4413cb(0xb4)]([getDocs(query(collection(db,'playersD3'),where(_0x4413cb(0xaa),'==',_0xaf6dde['winnerUsername']))),getDocs(query(collection(db,_0x4413cb(0xac)),where(_0x4413cb(0xaa),'==',_0xaf6dde['loserUsername'])))]);if(_0x469f79['empty']||_0x4558f1['empty'])throw new Error('Could\x20not\x20find\x20D3\x20player\x20documents');const _0x248060=_0x469f79['docs'][0x0]['id'],_0xa68b50=_0x4558f1['docs'][0x0]['id'];return await updateEloRatingsD3(_0x248060,_0xa68b50,_0x4fdfb4),console['log'](_0x4413cb(0x9c)),!![];}catch(_0x5ba311){console[_0x4413cb(0xb0)]('Error\x20in\x20approveReportD3:',_0x5ba311);throw _0x5ba311;}}
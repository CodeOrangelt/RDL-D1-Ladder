const a38_0x19bc14=a38_0x242a,a38_0x66fec0=(function(){let _0x11d35c=!![];return function(_0x52ca4f,_0x5b31c8){const _0x366795=_0x11d35c?function(){const _0x3308f1=a38_0x242a;if(_0x5b31c8){const _0x178401=_0x5b31c8[_0x3308f1(0x121)](_0x52ca4f,arguments);return _0x5b31c8=null,_0x178401;}}:function(){};return _0x11d35c=![],_0x366795;};}()),a38_0x145cc8=a38_0x66fec0(this,function(){const _0x4251e3=a38_0x242a;let _0x2a5302;try{const _0x93ac16=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x2a5302=_0x93ac16();}catch(_0x260618){_0x2a5302=window;}const _0x23b9dd=_0x2a5302['console']=_0x2a5302[_0x4251e3(0x12a)]||{},_0x5b4492=['log',_0x4251e3(0x13f),'info','error','exception','table',_0x4251e3(0x126)];for(let _0x3b2ef7=0x0;_0x3b2ef7<_0x5b4492['length'];_0x3b2ef7++){const _0x318475=a38_0x66fec0['constructor'][_0x4251e3(0x12f)][_0x4251e3(0x12e)](a38_0x66fec0),_0x2f0904=_0x5b4492[_0x3b2ef7],_0x3ec534=_0x23b9dd[_0x2f0904]||_0x318475;_0x318475['__proto__']=a38_0x66fec0['bind'](a38_0x66fec0),_0x318475['toString']=_0x3ec534[_0x4251e3(0x132)][_0x4251e3(0x12e)](_0x3ec534),_0x23b9dd[_0x2f0904]=_0x318475;}});a38_0x145cc8();const functions=require('firebase-functions'),admin=require('firebase-admin');admin['initializeApp']();const db=admin['firestore']();function a38_0x242a(_0x3c4266,_0x130b5e){const _0x145cc8=a38_0x175f();return a38_0x242a=function(_0x66fec0,_0x2264c1){_0x66fec0=_0x66fec0-0x11f;let _0x175f1f=_0x145cc8[_0x66fec0];return _0x175f1f;},a38_0x242a(_0x3c4266,_0x130b5e);}exports[a38_0x19bc14(0x141)]=functions['firestore']['document']('{collection}/{docId}')[a38_0x19bc14(0x122)](async(_0x3b02b8,_0x3b050e)=>{const _0x36e3e5=a38_0x19bc14,_0x4a40d8=_0x3b050e[_0x36e3e5(0x128)]['collection'],_0x319e7a=_0x3b050e['params']['docId'];if(!['players','playersD2','playersD3','userProfiles','nonParticipants']['includes'](_0x4a40d8))return null;try{await rebuildMembersList(),console['log']('Successfully\x20updated\x20aggregated\x20members\x20list');}catch(_0x13a56e){console['error'](_0x36e3e5(0x13a),_0x13a56e);}});async function rebuildMembersList(){const _0x199db6=a38_0x19bc14,_0x215717=db[_0x199db6(0x11f)](),[_0x248375,_0x1651f4,_0x14dba7,_0x2d5901,_0x5c58cc]=await Promise['all']([db['collection']('userProfiles')['get'](),db['collection']('players')[_0x199db6(0x140)](),db[_0x199db6(0x138)]('playersD2')['get'](),db['collection']('playersD3')[_0x199db6(0x140)](),db['collection']('nonParticipants')['get']()]),_0x20d01e=new Map();_0x248375['forEach'](_0x4813d0=>{_0x20d01e['set'](_0x4813d0['id'],_0x4813d0['data']());});const _0x2f30cf=new Map(),_0x4b5ec0=(_0x5011f9,_0x1fa38f)=>{_0x5011f9['forEach'](_0x3b8d50=>{const _0x2f4205=a38_0x242a,_0xbdab=_0x3b8d50[_0x2f4205(0x13b)](),_0x3252ea=_0x3b8d50['id'];!_0x2f30cf['has'](_0x3252ea)&&_0x2f30cf['set'](_0x3252ea,{'userId':_0x3252ea,'username':_0xbdab['username']||_0x2f4205(0x12d),'ladders':[],'isNonParticipant':![]});const _0x4faffe=_0x2f30cf['get'](_0x3252ea);_0x4faffe['ladders']['push']({'ladder':_0x1fa38f,'elo':_0xbdab[_0x2f4205(0x133)]||0x4b0,'active':_0xbdab['active']!==![]});});};_0x4b5ec0(_0x1651f4,'D1'),_0x4b5ec0(_0x14dba7,'D2'),_0x4b5ec0(_0x2d5901,'D3'),_0x5c58cc['forEach'](_0x37704b=>{const _0x3fa1ea=_0x199db6,_0x51688f=_0x37704b[_0x3fa1ea(0x13b)](),_0x588be8=_0x37704b['id'];!_0x2f30cf['has'](_0x588be8)&&_0x51688f[_0x3fa1ea(0x13e)]&&_0x2f30cf[_0x3fa1ea(0x143)](_0x588be8,{'userId':_0x588be8,'username':_0x51688f['username'],'ladders':[],'isNonParticipant':!![]});});const _0x25c6ea=[];_0x2f30cf['forEach']((_0x1cf732,_0x37c837)=>{const _0x4f6d4e=_0x199db6,_0x2ece2b=_0x20d01e[_0x4f6d4e(0x140)](_0x37c837)||{};let _0x560709=0x0,_0x35f7a0=null;if(_0x1cf732[_0x4f6d4e(0x130)][_0x4f6d4e(0x131)]>0x0){const _0x409ab1=_0x1cf732['ladders']['sort']((_0x16f5a0,_0x456261)=>_0x456261[_0x4f6d4e(0x123)]-_0x16f5a0[_0x4f6d4e(0x123)]);_0x560709=_0x409ab1[0x0][_0x4f6d4e(0x123)],_0x35f7a0=_0x409ab1[0x0][_0x4f6d4e(0x12b)];}const _0x20be76={'userId':_0x37c837,'username':_0x1cf732[_0x4f6d4e(0x13e)],'profileImageUrl':_0x2ece2b['profileImageUrl']||null,'country':_0x2ece2b['country']||null,'motto':_0x2ece2b[_0x4f6d4e(0x135)]||null,'favoriteMap':_0x2ece2b['favoriteMap']||null,'favoriteWeapon':_0x2ece2b['favoriteWeapon']||null,'isNonParticipant':_0x1cf732['isNonParticipant'],'ladders':_0x1cf732[_0x4f6d4e(0x130)],'primaryLadder':_0x35f7a0,'highestElo':_0x560709,'rank':getPlayerRank(_0x560709),'lastUpdated':admin['firestore'][_0x4f6d4e(0x120)]['serverTimestamp']()};_0x25c6ea[_0x4f6d4e(0x139)](_0x20be76);});const _0x16ffc1=db[_0x199db6(0x138)]('aggregatedMembers'),_0x2ae498=await _0x16ffc1['get'](),_0x481d23=[];_0x2ae498['forEach'](_0xf57a57=>{_0x481d23['push'](_0xf57a57['ref']['delete']());}),await Promise['all'](_0x481d23);const _0x169e39=0x1f4,_0x1fec1d=[];for(let _0x588821=0x0;_0x588821<_0x25c6ea['length'];_0x588821+=_0x169e39){const _0x515569=db[_0x199db6(0x11f)](),_0x3cf1e9=_0x25c6ea[_0x199db6(0x127)](_0x588821,_0x588821+_0x169e39);_0x3cf1e9['forEach'](_0x132382=>{const _0x8e827c=_0x199db6,_0x10eba1=_0x16ffc1['doc'](_0x132382[_0x8e827c(0x12c)]);_0x515569['set'](_0x10eba1,_0x132382);}),_0x1fec1d['push'](_0x515569['commit']());}await Promise[_0x199db6(0x13d)](_0x1fec1d);}function a38_0x175f(){const _0x209e9b=['batch','FieldValue','apply','onWrite','elo','Error\x20rebuilding\x20members\x20list','error','trace','slice','params','rebuildMembersListManual','console','ladder','userId','Unknown','bind','prototype','ladders','length','toString','eloRating','onRequest','motto','bronze','status','collection','push','Error\x20updating\x20members\x20list:','data','emerald','all','username','warn','get','updateMembersList','https','set'];a38_0x175f=function(){return _0x209e9b;};return a38_0x175f();}function getPlayerRank(_0xf07c9){const _0x45f24c=a38_0x19bc14;if(_0xf07c9>=0x7d0)return _0x45f24c(0x13c);if(_0xf07c9>=0x708)return'gold';if(_0xf07c9>=0x640)return'silver';if(_0xf07c9>=0x578)return _0x45f24c(0x136);return'unranked';}exports[a38_0x19bc14(0x129)]=functions[a38_0x19bc14(0x142)][a38_0x19bc14(0x134)](async(_0x4a2ac9,_0x1fa370)=>{const _0x239c2e=a38_0x19bc14;try{await rebuildMembersList(),_0x1fa370['status'](0xc8)['send']('Members\x20list\x20rebuilt\x20successfully');}catch(_0x21bac0){console[_0x239c2e(0x125)]('Error\x20rebuilding\x20members\x20list:',_0x21bac0),_0x1fa370[_0x239c2e(0x137)](0x1f4)['send'](_0x239c2e(0x124));}});
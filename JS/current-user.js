const a12x=a12b;(function(a,b){const w=a12b,c=a();while(!![]){try{const d=-parseInt(w(0x17a))/0x1+parseInt(w(0x1b6))/0x2*(-parseInt(w(0x189))/0x3)+-parseInt(w(0x17e))/0x4*(parseInt(w(0x19d))/0x5)+-parseInt(w(0x1b0))/0x6*(parseInt(w(0x179))/0x7)+parseInt(w(0x198))/0x8*(-parseInt(w(0x183))/0x9)+-parseInt(w(0x178))/0xa+parseInt(w(0x185))/0xb;if(d===b)break;else c['push'](c['shift']());}catch(e){c['push'](c['shift']());}}}(a12a,0x247d0));function a12b(a,b){const c=a12a();return a12b=function(d,e){d=d-0x16d;let f=c[d];if(a12b['XsdPPr']===undefined){var g=function(l){const m='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let n='',o='';for(let p=0x0,q,r,s=0x0;r=l['charAt'](s++);~r&&(q=p%0x4?q*0x40+r:r,p++%0x4)?n+=String['fromCharCode'](0xff&q>>(-0x2*p&0x6)):0x0){r=m['indexOf'](r);}for(let t=0x0,u=n['length'];t<u;t++){o+='%'+('00'+n['charCodeAt'](t)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(o);};a12b['YcfuCM']=g,a=arguments,a12b['XsdPPr']=!![];}const h=c[0x0],i=d+h,j=a[i];return!j?(f=a12b['YcfuCM'](f),a[i]=f):f=j,f;},a12b(a,b);}import{getAuth,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{doc,getDoc,collection,query,where,getDocs,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import{isAdmin}from'./admin-check.js';const ADMIN_EMAILS=[a12x(0x19a),'Brian2af@outlook.com'],userCache={'uid':null,'username':null,'isAdmin':![],'hasCheckedCollections':![],'lastChecked':0x0,'role':null},invitationCache={'lastCheck':0x0,'pendingCount':0x0,'checkInterval':0x493e0};function updateInboxNotification(a){const y=a12x,b=document['getElementById'](y(0x1a0));b&&(a>0x0?(b['style']['display']=y(0x177),b[y(0x1ab)]=a>0x9?'9+':a):b[y(0x18f)][y(0x1b8)]='none');}async function checkPendingInvitationsForCurrentUser(a){const z=a12x;try{const b=Date[z(0x1b5)]();if(b-invitationCache['lastCheck']<invitationCache[z(0x1a7)])return updateInboxNotification(invitationCache['pendingCount']),invitationCache[z(0x176)];invitationCache[z(0x17f)]=b;const c=collection(db,'gameInvitations'),d=query(c,where(z(0x171),'==',a),where(z(0x16f),'==',z(0x1a3)),limit(0x5)),e=await getDocs(d),f=e['size'];return invitationCache[z(0x176)]=f,updateInboxNotification(f),f;}catch(g){return console['warn'](z(0x174),g),0x0;}}function a12a(){const J=['CgXHEwvYCW','q291BgqGBM90ignOzwnRihbLBMrPBMCGAw52AxrHDgLVBNmGzM9Yign1CNjLBNqGDxnLCJO','zxHPC3rZ','CgvUzgLUz0nVDw50','Aw5SAw5LlwjSB2nR','mJCYmti4mfvevfP4sW','mtaXmZGXsxLLr2H1','mJKYmda4v3fPwwve','Bg9N','zw1WDhK','ywrTAw4','mtq4DvPjEu1T','BgfZDenOzwnR','y3jLyxrPDMuGBgvHza','yxv0Ac1Zzwn0Aw9U','Aw5Uzxjive1m','mZzXBK54BgS','DxnLCM5HBwu','mte5ntKYndrKrLL5rvy','Aw5JBhvKzxm','tM8GywrTAw4GCM9SzxmGzM91BMqGzM9YihvZzxi','lMfKBwLUlw9UBhK','mZi0B1HLCLjA','vxnLCG','rxjYB3iGy2HLy2TPBMCG','ywrKrxzLBNrmAxn0zw5LCG','z2v0rwXLBwvUDej5swq','AgfZq2HLy2TLzenVBgXLy3rPB25Z','C3r5Bgu','zgf0yq','Dg9mB3DLCKnHC2u','Axnbzg1PBG','igj5igvTywLSoG','y2HHCKf0','C3bSAxq','zMLSDgvY','DwLK','ntmZndi0yLD1sMLT','CgXHEwvYC0qZ','ywrTAw5aBgfKzgvYlMnVBq','CM9Szu5HBwu','CM9Szq','mtC4nun6wNPvCW','zw1HAwW','y291BMnPBa','Aw5IB3GTBM90AwzPy2f0Aw9U','igLUia','zg9JCW','CgvUzgLUzW','zxjYB3i','y2f0y2G','BM9UugfYDgLJAxbHBNrZ','y2HLy2TjBNrLCNzHBa','pc9HpGOGicaGicaGicaGicaGicaGpgrPDIbJBgfZCZ0IBMf2lwrYB3bKB3DUlwnVBNrLBNqIpGOGicaGicaGicaGicaGicaGicaGidXHigHYzwy9iNbYB2zPBguUAhrTBd91C2vYBMfTzt0','BgfZDenOzwnRzwq','DgHLBG','Dgv4DenVBNrLBNq','CxvLCNLtzwXLy3rVCKfSBa','Bg9NB3v0lwXPBMS','BM9Uzq','y2XPy2S','mZbMCxz5r3C','CgXHEwvYC0qY','re9nq29UDgvUDeXVywrLza','y3vYCMvUDfvZzxi','rxjYB3iGAw4GzNvSBcbHDxrOihvWzgf0ztO','BM93','mZK0EgDKCfnW','icHbzg1PBIK','zgLZCgXHEq','Dg9vChbLCKnHC2u','DgfYz2v0','DxnLCLbYB2zPBgvZ','C3rHDhvZ','cIaGicaGicaGicaGidXKAxyGy2XHC3m9iM5HDI1KCM9Wzg93BIi+cIaGicaGicaGicaGicaGica8ysbOCMvMpsiJiIbJBgfZCZ0IBMf2lxvZzxjUyw1LiJ4','Dg9vC2vYswq','C2XPy2u'];a12a=function(){return J;};return a12a();}function updateAuthSectionImmediate(a,b=![]){const A=a12x,c=document[A(0x18d)](A(0x181));if(!c)return;if(a&&b)document[A(0x1ac)](A(0x188))['forEach'](d=>{d['style']['display']='block';});else!a&&document['querySelectorAll']('.admin-only')['forEach'](d=>{const B=A;d[B(0x18f)]['display']=B(0x1ae);});if(a){const d=userCache[A(0x184)]||(a[A(0x19e)]?a[A(0x19e)]['split']('@')[0x0]:'User'),e=userCache[A(0x19c)]?'\x20('+userCache[A(0x19c)]+')':b?A(0x1b7):'';c['innerHTML']=A(0x170)+d+e+A(0x1a8)+encodeURIComponent(d)+'\x22>Profile</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./inbox.html\x22\x20class=\x22nav-notification\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Inbox\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22inbox-notification\x22\x20class=\x22notification-dot\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22members.html\x22>Members</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./redeem.html\x22><i\x20class=\x22fas\x20fa-gift\x22></i>\x20Redeem</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20id=\x22logout-link\x22>Sign\x20Out</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';const f=document['getElementById'](A(0x1ad));f&&f[A(0x18c)]('click',g=>{const C=A;g['preventDefault']();const h=getAuth();updateAuthSectionImmediate(null),h['signOut']()[C(0x1a5)](i=>{console['error']('Error\x20signing\x20out:',i);});}),a['uid']&&setTimeout(()=>{checkPendingInvitationsForCurrentUser(a['uid']);},0x3e8);}else c[A(0x182)]='<a\x20href=\x22login.html\x22\x20class=\x22login-link\x22>Login</a>';}async function checkAdminRoles(a){const D=a12x;if(!a||!a['email'])return{'isAdmin':![],'role':null};try{console['log']('Checking\x20roles\x20for\x20user:\x20'+a[D(0x19e)]);const b=['players',D(0x1b1),D(0x199),'nonParticipants',D(0x16e)],c=[D(0x19f),D(0x180),'owner',D(0x17d)];for(const d of b){try{const e=doc(db,d,a[D(0x197)]),f=await getDoc(e);if(f[D(0x175)]()){const g=f[D(0x190)]();console['log']('Found\x20user\x20in\x20'+d+'\x20by\x20UID:',g);let h=(g[D(0x19b)]||g['role']||'')['toLowerCase'](),i=g['roleName']||g['role']||'';if(h&&c[D(0x186)](h)){console[D(0x17b)]('Found\x20admin\x20role:\x20'+h+D(0x1a1)+d);const j=i[D(0x195)]('\x20')['map'](k=>k[D(0x194)](0x0)[D(0x1b9)]()+k[D(0x172)](0x1)['toLowerCase']())['join']('\x20');return{'isAdmin':!![],'role':j};}}}catch(k){console['error']('Error\x20checking\x20'+d+'\x20by\x20UID:',k);}}for(const l of b){try{const m=collection(db,l);let n=query(m,where('email','==',a['email'])),o=await getDocs(n);o['empty']&&(n=query(m,where(D(0x19e),'==',a['email'][D(0x191)]())),o=await getDocs(n));if(!o[D(0x17c)]){const p=o[D(0x1a2)][0x0][D(0x190)]();console[D(0x17b)]('Found\x20user\x20in\x20'+l+'\x20by\x20email:',p);let r=(p[D(0x19b)]||p['role']||'')['toLowerCase'](),s=p[D(0x19b)]||p[D(0x19c)]||'';if(r&&c[D(0x186)](r)){console['log']('Found\x20admin\x20role:\x20'+r+'\x20in\x20'+l);const t=s[D(0x195)]('\x20')['map'](u=>u[D(0x194)](0x0)[D(0x1b9)]()+u[D(0x172)](0x1)[D(0x191)]())['join']('\x20');return{'isAdmin':!![],'role':t};}}}catch(u){console[D(0x1a4)](D(0x18b)+l+D(0x193),u);}}return console[D(0x17b)](D(0x187)),{'isAdmin':![],'role':null};}catch(v){return console[D(0x1a4)]('Error\x20in\x20checkAdminRoles:',v),{'isAdmin':![],'role':null};}}async function updateAuthSection(a){const E=a12x,b=a&&isAdmin(a[E(0x19e)]);updateAuthSectionImmediate(a,b);if(!a){userCache[E(0x197)]=null,userCache[E(0x184)]=null,userCache[E(0x192)]=![],userCache[E(0x18e)]=![],userCache['role']=null;return;}const c=Date[E(0x1b5)]();if(a[E(0x197)]===userCache[E(0x197)]&&userCache['hasCheckedCollections']&&c-userCache[E(0x1a9)]<0x493e0)return;try{userCache['uid']=a[E(0x197)],userCache[E(0x1a9)]=c;const d=isAdmin(a[E(0x19e)]);userCache[E(0x192)]=d;if(!d){const {isAdmin:j,role:k}=await checkAdminRoles(a);userCache[E(0x192)]=j,userCache[E(0x19c)]=k,j&&(document['querySelectorAll'](E(0x188))['forEach'](l=>{const F=E;l[F(0x18f)]['display']='block';}),updateAuthSectionImmediate(a,!![]));}const e=[E(0x173),E(0x1b1),'playersD3','playersDuos','playersCTF',E(0x1a6),'userProfiles'],f=e['map'](l=>getDoc(doc(db,l,a[E(0x197)]))[E(0x1aa)](m=>m[E(0x175)]()?{'collection':l,'data':m[E(0x190)]()}:null)['catch'](()=>null)),g=await Promise['all'](f),h=g[E(0x196)](l=>l!==null);let i=null;for(const l of h){if(l['data'][E(0x184)]){i=l['data']['username'];break;}}userCache['username']=i||(a[E(0x19e)]?a['email']['split']('@')[0x0]:E(0x18a)),userCache[E(0x18e)]=!![],updateAuthSectionImmediate(a,userCache['isAdmin']),setTimeout(()=>{checkPendingInvitationsForCurrentUser(a['uid']);},0x1f4);}catch(m){console[E(0x1a4)](E(0x1b4),m);}}document[a12x(0x18c)](a12x(0x1b2),()=>{const H=a12x,a=getAuth();onAuthStateChanged(a,async b=>{await updateAuthSection(b),b&&checkPendingInvitationsForCurrentUser(b['uid']);}),document['addEventListener']('visibilitychange',()=>{const G=a12b;!document['hidden']&&a['currentUser']&&checkPendingInvitationsForCurrentUser(a[G(0x1b3)]['uid']);}),document['addEventListener'](H(0x1af),b=>{const I=H;b[I(0x16d)]['closest']('a[href]')&&a[I(0x1b3)]&&checkPendingInvitationsForCurrentUser(a[I(0x1b3)]['uid']);});});export{updateAuthSection};
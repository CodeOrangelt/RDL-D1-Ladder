const a0_0x1d13b4=a0_0x373a;function a0_0x3551(){const _0x425325=['Bronze','size','info','timestamp','length','1983527TPZgvj','65633JoEHVB','1234248ZBDSit','839876XxvzFc','Emerald','approvedMatchesD3','warn','console','6399260ZfNbkf','constructor','{}.constructor(\x22return\x20this\x22)(\x20)','Silver','24duVKMd','1091645VXOIkv','125992lhAmBy','279NwLVVn','exception','exists','15kvAAxI','2SXbDih','toString','275bKlAHW'];a0_0x3551=function(){return _0x425325;};return a0_0x3551();}(function(_0x13c0a0,_0x117839){const _0x83e4f2=a0_0x373a,_0x102fdf=_0x13c0a0();while(!![]){try{const _0x4c2fcf=-parseInt(_0x83e4f2(0x16f))/0x1*(parseInt(_0x83e4f2(0x181))/0x2)+parseInt(_0x83e4f2(0x180))/0x3*(-parseInt(_0x83e4f2(0x171))/0x4)+-parseInt(_0x83e4f2(0x17b))/0x5*(parseInt(_0x83e4f2(0x17a))/0x6)+parseInt(_0x83e4f2(0x16e))/0x7+-parseInt(_0x83e4f2(0x17c))/0x8*(-parseInt(_0x83e4f2(0x17d))/0x9)+-parseInt(_0x83e4f2(0x176))/0xa+parseInt(_0x83e4f2(0x168))/0xb*(parseInt(_0x83e4f2(0x170))/0xc);if(_0x4c2fcf===_0x117839)break;else _0x102fdf['push'](_0x102fdf['shift']());}catch(_0x399b2f){_0x102fdf['push'](_0x102fdf['shift']());}}}(a0_0x3551,0xae5e2));const a0_0x103e62=(function(){let _0x5c5540=!![];return function(_0x4e2c9f,_0x2dd78c){const _0x40ed9b=_0x5c5540?function(){if(_0x2dd78c){const _0x1c291e=_0x2dd78c['apply'](_0x4e2c9f,arguments);return _0x2dd78c=null,_0x1c291e;}}:function(){};return _0x5c5540=![],_0x40ed9b;};}()),a0_0x4e28a4=a0_0x103e62(this,function(){const _0x2e1609=a0_0x373a;let _0x450c0c;try{const _0x11fc4d=Function('return\x20(function()\x20'+_0x2e1609(0x178)+');');_0x450c0c=_0x11fc4d();}catch(_0x3d7c65){_0x450c0c=window;}const _0x22a817=_0x450c0c['console']=_0x450c0c[_0x2e1609(0x175)]||{},_0x1ad2ae=['log',_0x2e1609(0x174),_0x2e1609(0x16b),'error',_0x2e1609(0x17e),'table','trace'];for(let _0x3a4368=0x0;_0x3a4368<_0x1ad2ae[_0x2e1609(0x16d)];_0x3a4368++){const _0x230d39=a0_0x103e62[_0x2e1609(0x177)]['prototype']['bind'](a0_0x103e62),_0x1036f7=_0x1ad2ae[_0x3a4368],_0x537610=_0x22a817[_0x1036f7]||_0x230d39;_0x230d39['__proto__']=a0_0x103e62['bind'](a0_0x103e62),_0x230d39[_0x2e1609(0x167)]=_0x537610['toString']['bind'](_0x537610),_0x22a817[_0x1036f7]=_0x230d39;}});a0_0x4e28a4();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc,where}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';function a0_0x373a(_0x26e5f9,_0x1862a1){const _0x573b39=a0_0x3551();return a0_0x373a=function(_0x4e28a4,_0x103e62){_0x4e28a4=_0x4e28a4-0x167;let _0x2400c3=_0x573b39[_0x4e28a4];return _0x2400c3;},a0_0x373a(_0x26e5f9,_0x1862a1);}const ELO_THRESHOLDS_D3=[{'name':a0_0x1d13b4(0x172),'elo':0x7d0},{'name':'Gold','elo':0x708},{'name':'Silver','elo':0x640},{'name':a0_0x1d13b4(0x169),'elo':0x578},{'name':'Unranked','elo':0x4b0}];let lastVisibleD3=null;async function getUsernameByIdD3(_0x47d8c1){const _0x235b08=a0_0x1d13b4;try{if(!_0x47d8c1)return'Unknown\x20Player';const _0x58696f=await getDoc(doc(db,'playersD3',_0x47d8c1));if(_0x58696f[_0x235b08(0x17f)]())return _0x58696f['data']()['username']||'Unknown\x20Player';const _0x9b2bf9=await getDocs(query(collection(db,'approvedMatchesD3'),where('winnerId','==',_0x47d8c1),limit(0x1)));if(!_0x9b2bf9['empty'])return _0x9b2bf9['docs'][0x0]['data']()['winnerUsername']||'Unknown\x20Player';const _0x5f0109=await getDocs(query(collection(db,_0x235b08(0x173)),where('loserId','==',_0x47d8c1),limit(0x1)));if(!_0x5f0109['empty'])return _0x5f0109['docs'][0x0]['data']()['loserUsername']||'Unknown\x20Player';return'Unknown\x20Player';}catch(_0x444d0d){return console['error']('Error\x20getting\x20D3\x20username:',_0x444d0d),'Unknown\x20Player';}}export async function recordEloChangeD3({playerId:_0x39ed02,previousElo:_0x5b997e,newElo:_0x142cb6,opponentId:_0x130eb5,matchResult:_0x37f861,previousPosition:_0x4a2b5b,newPosition:_0x22013c,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0xa9a697,timestamp:_0x4d769d}){const _0x24cdb8=a0_0x1d13b4;try{const _0x53b659=doc(collection(db,'eloHistoryD3'));let _0x113f54='match';if(isPromotion)_0x113f54='promotion';if(isDemotion)_0x113f54='demotion';let _0x31519c='Unranked';if(_0x142cb6>=0x7d0)_0x31519c='Emerald';else{if(_0x142cb6>=0x708)_0x31519c='Gold';else{if(_0x142cb6>=0x640)_0x31519c=_0x24cdb8(0x179);else{if(_0x142cb6>=0x578)_0x31519c='Bronze';}}}return await setDoc(_0x53b659,{'type':_0x113f54,'player':_0x39ed02,'opponent':_0x130eb5,'previousElo':_0x5b997e,'newElo':_0x142cb6,'change':_0x142cb6-_0x5b997e,'matchResult':_0x37f861,'previousPosition':_0x4a2b5b,'newPosition':_0x22013c,'rankAchieved':_0x31519c,'matchId':_0xa9a697,'timestamp':_0x4d769d||serverTimestamp(),'gameMode':'D3'}),console['log']('D3\x20ELO\x20history\x20recorded\x20for\x20'+_0x39ed02),!![];}catch(_0x3810e8){console['error']('Error\x20recording\x20D3\x20ELO\x20history:',_0x3810e8);throw _0x3810e8;}}export async function getEloHistoryD3(_0x1878dc=0x14){const _0x321ad1=a0_0x1d13b4;try{const _0x2f74b8=collection(db,'eloHistoryD3');let _0x47edad;lastVisibleD3?_0x47edad=query(_0x2f74b8,orderBy(_0x321ad1(0x16c),'desc'),startAfter(lastVisibleD3),limit(_0x1878dc)):_0x47edad=query(_0x2f74b8,orderBy('timestamp','desc'),limit(_0x1878dc));const _0x5d829c=await getDocs(_0x47edad);if(_0x5d829c['empty'])return{'entries':[],'hasMore':![]};lastVisibleD3=_0x5d829c['docs'][_0x5d829c['docs']['length']-0x1];const _0x551cb2=_0x5d829c['docs']['map'](async _0x550dcf=>{const _0x115b94=_0x550dcf['data'](),[_0x3521a7,_0x2f8a9a]=await Promise['all']([getUsernameByIdD3(_0x115b94['player']),getUsernameByIdD3(_0x115b94['opponent'])]);return{..._0x115b94,'playerUsername':_0x3521a7,'opponentUsername':_0x2f8a9a,'change':_0x115b94['newElo']-_0x115b94['previousElo'],'timestamp':_0x115b94['timestamp']};}),_0x49fc68=await Promise['all'](_0x551cb2);return{'entries':_0x49fc68,'hasMore':_0x5d829c[_0x321ad1(0x16a)]===_0x1878dc};}catch(_0x3cfc94){console['error']('Error\x20fetching\x20D3\x20ELO\x20history:',_0x3cfc94);throw _0x3cfc94;}}export function resetPaginationD3(){lastVisibleD3=null;}
function a13_0x4893(_0xf87e92,_0x4dd5f1){const _0x3ab80c=a13_0x19a3();return a13_0x4893=function(_0x1beddd,_0x44630b){_0x1beddd=_0x1beddd-0xa9;let _0x19a3df=_0x3ab80c[_0x1beddd];return _0x19a3df;},a13_0x4893(_0xf87e92,_0x4dd5f1);}const a13_0x57fe5b=a13_0x4893,a13_0x1beddd=(function(){let _0xa58612=!![];return function(_0x16d584,_0x43fd05){const _0x552820=_0xa58612?function(){if(_0x43fd05){const _0x288d73=_0x43fd05['apply'](_0x16d584,arguments);return _0x43fd05=null,_0x288d73;}}:function(){};return _0xa58612=![],_0x552820;};}()),a13_0x3ab80c=a13_0x1beddd(this,function(){const _0x393708=a13_0x4893,_0x4bb093=function(){let _0x4ef474;try{_0x4ef474=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0xf108d4){_0x4ef474=window;}return _0x4ef474;},_0x25f763=_0x4bb093(),_0x2caf94=_0x25f763['console']=_0x25f763['console']||{},_0x3aeeda=['log','warn','info','error',_0x393708(0xb9),_0x393708(0xb3),_0x393708(0xb2)];for(let _0x64e4=0x0;_0x64e4<_0x3aeeda['length'];_0x64e4++){const _0x2819ab=a13_0x1beddd['constructor']['prototype']['bind'](a13_0x1beddd),_0x9dee24=_0x3aeeda[_0x64e4],_0x3aaa25=_0x2caf94[_0x9dee24]||_0x2819ab;_0x2819ab['__proto__']=a13_0x1beddd['bind'](a13_0x1beddd),_0x2819ab[_0x393708(0xaf)]=_0x3aaa25[_0x393708(0xaf)]['bind'](_0x3aaa25),_0x2caf94[_0x9dee24]=_0x2819ab;}});a13_0x3ab80c();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc,where}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D3=[{'name':'Emerald','elo':0x7d0},{'name':a13_0x57fe5b(0xb5),'elo':0x708},{'name':'Silver','elo':0x640},{'name':'Bronze','elo':0x578},{'name':'Unranked','elo':0x4b0}];let lastVisibleD3=null;async function getUsernameByIdD3(_0x36d46f){const _0x5d7be7=a13_0x57fe5b;try{if(!_0x36d46f)return _0x5d7be7(0xae);const _0x1b211f=await getDoc(doc(db,_0x5d7be7(0xb1),_0x36d46f));if(_0x1b211f['exists']())return _0x1b211f[_0x5d7be7(0xb7)]()['username']||'Unknown\x20Player';const _0x3204cc=await getDocs(query(collection(db,_0x5d7be7(0xb4)),where('winnerId','==',_0x36d46f),limit(0x1)));if(!_0x3204cc[_0x5d7be7(0xba)])return _0x3204cc['docs'][0x0]['data']()['winnerUsername']||'Unknown\x20Player';const _0x4dc54d=await getDocs(query(collection(db,_0x5d7be7(0xb4)),where(_0x5d7be7(0xab),'==',_0x36d46f),limit(0x1)));if(!_0x4dc54d['empty'])return _0x4dc54d['docs'][0x0][_0x5d7be7(0xb7)]()['loserUsername']||_0x5d7be7(0xae);return'Unknown\x20Player';}catch(_0x15257c){return console[_0x5d7be7(0xaa)]('Error\x20getting\x20D3\x20username:',_0x15257c),'Unknown\x20Player';}}export async function recordEloChangeD3({playerId:_0x30538a,previousElo:_0x5141a7,newElo:_0x355cb6,opponentId:_0x5222f8,matchResult:_0x51c184,previousPosition:_0x5f0762,newPosition:_0x2852cc,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x144ccd,timestamp:_0x330360}){const _0x5b34e8=a13_0x57fe5b;try{const _0x2a6c06=doc(collection(db,'eloHistoryD3'));let _0x43746c='match';if(isPromotion)_0x43746c='promotion';if(isDemotion)_0x43746c=_0x5b34e8(0xa9);let _0x5e6ba9='Unranked';if(_0x355cb6>=0x7d0)_0x5e6ba9='Emerald';else{if(_0x355cb6>=0x708)_0x5e6ba9=_0x5b34e8(0xb5);else{if(_0x355cb6>=0x640)_0x5e6ba9='Silver';else{if(_0x355cb6>=0x578)_0x5e6ba9=_0x5b34e8(0xb0);}}}return await setDoc(_0x2a6c06,{'type':_0x43746c,'player':_0x30538a,'opponent':_0x5222f8,'previousElo':_0x5141a7,'newElo':_0x355cb6,'change':_0x355cb6-_0x5141a7,'matchResult':_0x51c184,'previousPosition':_0x5f0762,'newPosition':_0x2852cc,'rankAchieved':_0x5e6ba9,'matchId':_0x144ccd,'timestamp':_0x330360||serverTimestamp(),'gameMode':'D3'}),console['log']('D3\x20ELO\x20history\x20recorded\x20for\x20'+_0x30538a),!![];}catch(_0x4c4f72){console['error']('Error\x20recording\x20D3\x20ELO\x20history:',_0x4c4f72);throw _0x4c4f72;}}export async function getEloHistoryD3(_0x3e23fd=0x14){const _0x52c20e=a13_0x57fe5b;try{const _0x26603f=collection(db,'eloHistoryD3');let _0x1b5f76;lastVisibleD3?_0x1b5f76=query(_0x26603f,orderBy('timestamp','desc'),startAfter(lastVisibleD3),limit(_0x3e23fd)):_0x1b5f76=query(_0x26603f,orderBy(_0x52c20e(0xad),_0x52c20e(0xac)),limit(_0x3e23fd));const _0x460d5d=await getDocs(_0x1b5f76);if(_0x460d5d['empty'])return{'entries':[],'hasMore':![]};lastVisibleD3=_0x460d5d['docs'][_0x460d5d['docs']['length']-0x1];const _0x362969=_0x460d5d['docs']['map'](async _0x138890=>{const _0x133908=_0x52c20e,_0x29bc82=_0x138890['data'](),[_0x27fe37,_0x47284d]=await Promise['all']([getUsernameByIdD3(_0x29bc82[_0x133908(0xb6)]),getUsernameByIdD3(_0x29bc82['opponent'])]);return{..._0x29bc82,'playerUsername':_0x27fe37,'opponentUsername':_0x47284d,'change':_0x29bc82['newElo']-_0x29bc82['previousElo'],'timestamp':_0x29bc82[_0x133908(0xad)]};}),_0x2f2302=await Promise['all'](_0x362969);return{'entries':_0x2f2302,'hasMore':_0x460d5d[_0x52c20e(0xb8)]===_0x3e23fd};}catch(_0x5ba712){console['error']('Error\x20fetching\x20D3\x20ELO\x20history:',_0x5ba712);throw _0x5ba712;}}export function resetPaginationD3(){lastVisibleD3=null;}function a13_0x19a3(){const _0x2ac039=['demotion','error','loserId','desc','timestamp','Unknown\x20Player','toString','Bronze','playersD3','trace','table','approvedMatchesD3','Gold','player','data','size','exception','empty'];a13_0x19a3=function(){return _0x2ac039;};return a13_0x19a3();}
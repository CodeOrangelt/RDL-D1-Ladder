const a56_0x59223b=a56_0x117b,a56_0x54e443=(function(){let _0x149ee1=!![];return function(_0x1da16d,_0x4ae3c2){const _0xff967e=_0x149ee1?function(){if(_0x4ae3c2){const _0xd119a8=_0x4ae3c2['apply'](_0x1da16d,arguments);return _0x4ae3c2=null,_0xd119a8;}}:function(){};return _0x149ee1=![],_0xff967e;};}()),a56_0x618326=a56_0x54e443(this,function(){const _0x5ceaf1=a56_0x117b,_0x277948=function(){let _0x2f3519;try{_0x2f3519=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x537c3c){_0x2f3519=window;}return _0x2f3519;},_0x2e5c2c=_0x277948(),_0x3fab77=_0x2e5c2c['console']=_0x2e5c2c['console']||{},_0x297c12=['log',_0x5ceaf1(0x1c2),_0x5ceaf1(0x1c9),'error','exception',_0x5ceaf1(0x1bc),_0x5ceaf1(0x1c1)];for(let _0x5b3bd6=0x0;_0x5b3bd6<_0x297c12['length'];_0x5b3bd6++){const _0x4db5fc=a56_0x54e443[_0x5ceaf1(0x1c6)]['prototype']['bind'](a56_0x54e443),_0x197a46=_0x297c12[_0x5b3bd6],_0x4f113e=_0x3fab77[_0x197a46]||_0x4db5fc;_0x4db5fc[_0x5ceaf1(0x1b8)]=a56_0x54e443['bind'](a56_0x54e443),_0x4db5fc['toString']=_0x4f113e['toString'][_0x5ceaf1(0x1c5)](_0x4f113e),_0x3fab77[_0x197a46]=_0x4db5fc;}});a56_0x618326();import{db}from'../firebase-config.js';import{collection,doc,getDoc,getDocs,query,limit,startAfter,where,onSnapshot}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const cache={'userProfiles':new Map(),'ladderPlayers':new Map(),'matchResults':new Map(),'eloHistory':new Map()},CACHE_EXPIRY={'userProfiles':0x5*0x3c*0x3e8,'ladderPlayers':0x2*0x3c*0x3e8,'matchResults':0x1*0x3c*0x3e8,'eloHistory':0x3*0x3c*0x3e8};export const userProfilesRef=collection(db,a56_0x59223b(0x1c4));export async function fetchPaginatedData(_0x749895,_0x427ac6=0xa,_0x3b423f=null){const _0x4d3a71=a56_0x59223b;let _0x47d6d5=query(_0x749895,limit(_0x427ac6));_0x3b423f&&(_0x47d6d5=query(_0x47d6d5,startAfter(_0x3b423f)));const _0xdcbff0=await getDocs(_0x47d6d5),_0x1b2c17=_0xdcbff0['docs'][_0xdcbff0['docs']['length']-0x1];return{'data':_0xdcbff0['docs'][_0x4d3a71(0x1b2)](_0xf2ee4b=>({'id':_0xf2ee4b['id'],..._0xf2ee4b['data']()})),'lastVisible':_0x1b2c17,'hasMore':_0xdcbff0['docs'][_0x4d3a71(0x1bb)]===_0x427ac6};}export async function getUserProfile(_0x8d043c){const _0x20ccbe=a56_0x59223b,_0x499e32=cache[_0x20ccbe(0x1c4)][_0x20ccbe(0x1c7)](_0x8d043c);if(_0x499e32&&Date['now']()-_0x499e32['timestamp']<CACHE_EXPIRY['userProfiles'])return _0x499e32['data'];const _0x3e7c8b=await getDoc(doc(userProfilesRef,_0x8d043c));if(_0x3e7c8b['exists']()){const _0x402415=_0x3e7c8b['data']();return cache['userProfiles']['set'](_0x8d043c,{'data':_0x402415,'timestamp':Date['now']()}),_0x402415;}return null;}function a56_0x4526(){const _0x1f27db=['map','set','eloHistory','forEach','timestamp','playersD2','__proto__','doc','docChanges','length','table','playersD3','data','playersD','docs','trace','warn','error','userProfiles','bind','constructor','get','username','info'];a56_0x4526=function(){return _0x1f27db;};return a56_0x4526();}export async function getLadderData(_0xc6d3cc=0x1){const _0xe0bc5f=a56_0x59223b,_0x25252e='division_'+_0xc6d3cc,_0x1b4c99=cache['ladderPlayers'][_0xe0bc5f(0x1c7)](_0x25252e);if(_0x1b4c99&&Date['now']()-_0x1b4c99[_0xe0bc5f(0x1b6)]<CACHE_EXPIRY['ladderPlayers'])return _0x1b4c99['data'];const _0x46eedc=_0xc6d3cc===0x1?'players':_0xe0bc5f(0x1bf)+_0xc6d3cc,_0xcabe55=collection(db,_0x46eedc),_0x4c5eee=await getDocs(query(_0xcabe55,limit(0x64))),_0x4f5cf0=_0x4c5eee[_0xe0bc5f(0x1c0)][_0xe0bc5f(0x1b2)](_0x6ab6e2=>({'id':_0x6ab6e2['id'],..._0x6ab6e2['data']()}));return cache['ladderPlayers'][_0xe0bc5f(0x1b3)](_0x25252e,{'data':_0x4f5cf0,'timestamp':Date['now']()}),_0x4f5cf0;}export async function getEloHistoryBatch(_0x49173b,_0x4e6845=0x1){const _0x54b237=a56_0x59223b,_0x27e3ad=_0x4e6845===0x1?'eloHistory':'eloHistoryD'+_0x4e6845,_0x4e3e70=collection(db,_0x27e3ad),_0x12b916={},_0x50215a=[];_0x49173b[_0x54b237(0x1b5)](_0x50b0db=>{const _0x5c9cbc=_0x54b237,_0xbba808=_0x50b0db+'_'+_0x4e6845,_0x36cd24=cache[_0x5c9cbc(0x1b4)]['get'](_0xbba808);_0x36cd24&&Date['now']()-_0x36cd24['timestamp']<CACHE_EXPIRY['eloHistory']?_0x12b916[_0x50b0db]=_0x36cd24['data']:_0x50215a['push'](_0x50b0db);});const _0x225738=0xa;for(let _0x358514=0x0;_0x358514<_0x50215a['length'];_0x358514+=_0x225738){const _0x58a0b3=_0x50215a['slice'](_0x358514,_0x358514+_0x225738);if(_0x58a0b3[_0x54b237(0x1bb)]>0x0)try{const _0x5b8e4d=query(_0x4e3e70,where('playerId','in',_0x58a0b3),limit(0x64)),_0x307a2b=await getDocs(_0x5b8e4d);_0x307a2b['docs']['forEach'](_0x31f249=>{const _0x2ffe3d=_0x54b237,_0x380b7a=_0x31f249['data'](),_0xd0bb8=_0x380b7a['playerId'];if(!_0x12b916[_0xd0bb8])_0x12b916[_0xd0bb8]=[];_0x12b916[_0xd0bb8]['push'](_0x380b7a);const _0x16c58e=_0xd0bb8+'_'+_0x4e6845;cache[_0x2ffe3d(0x1b4)]['set'](_0x16c58e,{'data':_0x12b916[_0xd0bb8],'timestamp':Date['now']()});});}catch(_0x4c1a65){console[_0x54b237(0x1c3)]('Error\x20fetching\x20batch\x20ELO\x20history:',_0x4c1a65);}}return _0x12b916;}let usernameCache=new Map(),usernameCacheTimestamp=Date['now']();export function setupEfficientListener(_0x12c483,_0x2fea7b=[],_0x220a90){const _0x23b527=collection(db,_0x12c483),_0x459f82=query(_0x23b527,..._0x2fea7b),_0x507ff4=onSnapshot(_0x459f82,_0x3d732b=>{const _0xf31a3f=a56_0x117b,_0x5edaf8=_0x3d732b[_0xf31a3f(0x1ba)]()['map'](_0x39b2a8=>({'type':_0x39b2a8['type'],'id':_0x39b2a8[_0xf31a3f(0x1b9)]['id'],'data':_0x39b2a8['doc'][_0xf31a3f(0x1be)]()}));_0x5edaf8['length']>0x0&&_0x220a90(_0x5edaf8,_0x3d732b['docs']);});return _0x507ff4;}function a56_0x117b(_0x18c542,_0x23223a){const _0x618326=a56_0x4526();return a56_0x117b=function(_0x54e443,_0x4eb89e){_0x54e443=_0x54e443-0x1b2;let _0x452633=_0x618326[_0x54e443];return _0x452633;},a56_0x117b(_0x18c542,_0x23223a);}export async function bulkResolveUsernames(_0x497632){const _0x4749cd=a56_0x59223b,_0x22d689=new Map();if(!_0x497632||_0x497632[_0x4749cd(0x1bb)]===0x0)return _0x22d689;const _0x371ff9=['players',_0x4749cd(0x1b7),_0x4749cd(0x1bd),'nonParticipants'];for(const _0x23d569 of _0x371ff9){const _0x10d3d2=collection(db,_0x23d569),_0x5e7a8e=await getDocs(_0x10d3d2);_0x5e7a8e['forEach'](_0x483d8f=>{const _0x4ea248=_0x4749cd,_0x1acbd3=_0x483d8f['data']();_0x1acbd3[_0x4ea248(0x1c8)]&&_0x497632['includes'](_0x483d8f['id'])&&_0x22d689['set'](_0x483d8f['id'],_0x1acbd3['username']);});}return _0x22d689;}
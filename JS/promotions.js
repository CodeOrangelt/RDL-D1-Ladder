const a42_0x462420=a42_0x492c,a42_0x46f2ae=(function(){let _0x36c096=!![];return function(_0x5c446b,_0x410b2c){const _0x18b872=_0x36c096?function(){const _0x310e53=a42_0x492c;if(_0x410b2c){const _0x19bf20=_0x410b2c[_0x310e53(0xb0)](_0x5c446b,arguments);return _0x410b2c=null,_0x19bf20;}}:function(){};return _0x36c096=![],_0x18b872;};}()),a42_0x303b81=a42_0x46f2ae(this,function(){const _0x350d58=a42_0x492c,_0x46e38b=function(){let _0x507111;try{_0x507111=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x5ef986){_0x507111=window;}return _0x507111;},_0xcf9d14=_0x46e38b(),_0x4f24ca=_0xcf9d14[_0x350d58(0xb6)]=_0xcf9d14['console']||{},_0x322a35=[_0x350d58(0xac),_0x350d58(0xe5),'info','error','exception','table','trace'];for(let _0x17e2e1=0x0;_0x17e2e1<_0x322a35['length'];_0x17e2e1++){const _0x4af806=a42_0x46f2ae[_0x350d58(0xb9)]['prototype']['bind'](a42_0x46f2ae),_0x97c995=_0x322a35[_0x17e2e1],_0xa49354=_0x4f24ca[_0x97c995]||_0x4af806;_0x4af806['__proto__']=a42_0x46f2ae['bind'](a42_0x46f2ae),_0x4af806[_0x350d58(0xaa)]=_0xa49354[_0x350d58(0xaa)]['bind'](_0xa49354),_0x4f24ca[_0x97c995]=_0x4af806;}});a42_0x303b81();import{collection,doc,query,where,orderBy,limit,getDocs,addDoc,getDoc,serverTimestamp,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a42_0x492c(_0x38023c,_0x3a51cb){const _0x303b81=a42_0x1042();return a42_0x492c=function(_0x46f2ae,_0x3aa06e){_0x46f2ae=_0x46f2ae-0x98;let _0x1042e8=_0x303b81[_0x46f2ae];return _0x1042e8;},a42_0x492c(_0x38023c,_0x3a51cb);}import{auth,db}from'./firebase-config.js';class PromotionManager{constructor(){const _0xc7af0=a42_0x492c;this[_0xc7af0(0x9e)]=0x18,this['RANKS']=[{'threshold':0x578,'name':_0xc7af0(0xdc),'color':'#CD7F32'},{'threshold':0x640,'name':'Silver','color':'#C0C0C0'},{'threshold':0x708,'name':'Gold','color':'#FFD700'},{'threshold':0x834,'name':'Emerald','color':_0xc7af0(0xda)}],this['bannerContainer']=null,this['lastFetchTime']=0x0,this['fetchInterval']=0xea60,this['pollingInterval']=null,this['usernameCache']={};}[a42_0x462420(0xf3)](){const _0x2beb66=a42_0x462420;this['bannerContainer']=document['getElementById']('promotion-banner-container');if(!this[_0x2beb66(0xe0)]){console['error'](_0x2beb66(0xc9));return;}this['setupBannerContainer']();const _0x2d4ec6='promotions_checked_'+new Date()[_0x2beb66(0xf0)](),_0x54288f=sessionStorage[_0x2beb66(0xdb)](_0x2d4ec6);!_0x54288f&&(this['fetchRecentPromotions'](),sessionStorage['setItem'](_0x2d4ec6,'true')),document[_0x2beb66(0xcd)](_0x2beb66(0xf4),()=>{const _0x35736a=_0x2beb66;document[_0x35736a(0xdd)]===_0x35736a(0xaf)&&!sessionStorage['getItem'](_0x2d4ec6)&&(this['fetchRecentPromotions'](),sessionStorage['setItem'](_0x2d4ec6,_0x35736a(0xe9)));}),window['addEventListener']('beforeunload',()=>{const _0x2d2a1b=_0x2beb66;this[_0x2d2a1b(0xa2)]&&clearInterval(this['pollingInterval']);});}['setupBannerContainer'](){const _0x32f560=a42_0x462420;this['bannerContainer']['innerHTML']='',this['bannerContainer'][_0x32f560(0xef)]['display']='none';}async['fetchRecentPromotions'](){const _0x54b85b=a42_0x462420;try{const _0x481226=Date['now']();if(_0x481226-this['lastFetchTime']<this['fetchInterval'])return;this['lastFetchTime']=_0x481226;const _0x5821d5=collection(db,'eloHistory'),_0x24720b=query(_0x5821d5,where(_0x54b85b(0xc1),'in',[_0x54b85b(0x9b),_0x54b85b(0xa4)]),orderBy(_0x54b85b(0xc7),_0x54b85b(0xa5)),limit(0x14)),_0x90c40f=await getDocs(_0x24720b),_0x3edca7=[];_0x90c40f['forEach'](_0x56e29e=>{const _0x5c95e2=_0x54b85b,_0x562c2c={'id':_0x56e29e['id'],..._0x56e29e[_0x5c95e2(0xe6)]()};this['shouldShowPromotion'](_0x56e29e['id'])&&this['isNewRankChange'](_0x562c2c)&&_0x3edca7['push'](_0x562c2c);}),_0x3edca7['length']>0x0&&await this['processRankChanges'](_0x3edca7);}catch(_0x2172c7){console['error']('Error\x20fetching\x20promotions:',_0x2172c7);}}async['processRankChanges'](_0x10168a){const _0x44cdda=a42_0x462420;if(_0x10168a[_0x44cdda(0xd4)]===0x0)return;_0x10168a['sort']((_0x10011a,_0x4a21f4)=>{const _0x5dbd68=_0x44cdda,_0x327b5c=_0x10011a['timestamp']?.[_0x5dbd68(0xde)]?.()||_0x10011a['timestamp']?.['seconds']*0x3e8||0x0,_0x5ca08c=_0x4a21f4['timestamp']?.[_0x5dbd68(0xde)]?.()||_0x4a21f4['timestamp']?.['seconds']*0x3e8||0x0;return _0x5ca08c-_0x327b5c;});const _0x2928dd=this[_0x44cdda(0xe0)]['children']['length'],_0x566414=0x3-_0x2928dd;if(_0x566414<=0x0)return;const _0x219251=_0x10168a['slice'](0x0,_0x566414);for(let _0x1d70d2=0x0;_0x1d70d2<_0x219251['length'];_0x1d70d2++){const _0x2a1dcb=_0x219251[_0x1d70d2],_0x234b7b=auth['currentUser'];try{setTimeout(()=>{this['showRankChangeBanner'](_0x2a1dcb);},_0x1d70d2*0x3e8),_0x234b7b&&_0x2a1dcb[_0x44cdda(0x99)]===_0x234b7b['displayName']&&this['showRankChangeLightbox'](_0x2a1dcb[_0x44cdda(0xc1)],_0x2a1dcb['rankAchieved']);}catch(_0x1852ea){console[_0x44cdda(0xbe)]('Error\x20processing\x20rank\x20change:',_0x1852ea);}}}['shouldShowPromotion'](_0x1a0d81){const _0x46bbd6=a42_0x462420;try{const _0x563cef=_0x46bbd6(0xe1)+_0x1a0d81,_0x32532f=localStorage[_0x46bbd6(0xdb)](_0x563cef);if(_0x32532f){let _0x7f015c;try{_0x7f015c=JSON[_0x46bbd6(0xea)](_0x32532f);}catch(_0x278c1b){return console[_0x46bbd6(0xe5)](_0x46bbd6(0xf1)+_0x563cef+_0x46bbd6(0xa7)),!![];}if(_0x7f015c['ignored']===!![])return console['log']('Promotion\x20'+_0x1a0d81+'\x20is\x20permanently\x20ignored'),![];const _0x414a21=Date[_0x46bbd6(0xe4)]();if(_0x7f015c['userDismissed']&&_0x414a21-_0x7f015c['timestamp']<this['DISPLAY_HOURS']*0x3c*0x3c*0x3e8)return console['log'](_0x46bbd6(0xe7)+_0x1a0d81+'\x20was\x20dismissed\x20by\x20user\x20within\x20last\x20'+this[_0x46bbd6(0x9e)]+'\x20hours'),![];if(_0x7f015c['systemDismissed']&&_0x414a21-_0x7f015c['timestamp']<0x4*0x3c*0x3c*0x3e8)return console['log']('Promotion\x20'+_0x1a0d81+'\x20was\x20auto-dismissed\x20within\x20last\x204\x20hours'),![];}return!![];}catch(_0x169854){return console[_0x46bbd6(0xbe)]('Error\x20checking\x20promotion\x20visibility:',_0x169854),![];}}[a42_0x462420(0xcb)](_0x568fe8){const _0x49b22c=a42_0x462420;try{const _0x5a8156='promotion_'+_0x568fe8;localStorage[_0x49b22c(0xa6)](_0x5a8156,JSON['stringify']({'timestamp':Date[_0x49b22c(0xe4)](),'ignored':!![]}));}catch(_0x3425e0){console[_0x49b22c(0xbe)]('Error\x20saving\x20promotion\x20preference:',_0x3425e0);}}[a42_0x462420(0xae)](_0x52a374){this['resolveUserId'](_0x52a374)['then'](_0xb496c6=>{const _0x3f29c8=a42_0x492c,_0x13a52b=_0x3f29c8(0xe1)+_0x52a374['id'],_0x193688=localStorage[_0x3f29c8(0xdb)](_0x13a52b);if(_0x193688)try{const _0x547087=JSON[_0x3f29c8(0xea)](_0x193688);if(_0x547087['ignored']===!![]){console[_0x3f29c8(0xac)](_0x3f29c8(0xbb)+_0x52a374['id']);return;}}catch(_0x351324){}localStorage['setItem'](_0x13a52b,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':![],'seenAt':Date['now']()})),this['bannerContainer'][_0x3f29c8(0xef)]['display']=_0x3f29c8(0xe2);while(this['bannerContainer']['children']['length']>=0x3){this['bannerContainer']['removeChild'](this[_0x3f29c8(0xe0)]['firstChild']);}const _0x153f34=document[_0x3f29c8(0xc0)]('div');_0x153f34['className']='promotion-banner',_0x153f34['setAttribute']('data-rank',_0xb496c6['rankAchieved']),_0x153f34['setAttribute']('data-id',_0xb496c6['id']);const _0x479a0a=document['createElement'](_0x3f29c8(0xc5));_0x479a0a['className']=_0x3f29c8(0xad);const _0x2e6617=_0xb496c6['resolvedName']||_0xb496c6['player']||_0xb496c6['username']||_0xb496c6[_0x3f29c8(0xd7)]||_0xb496c6['displayName']||'A\x20player',_0x27210f=_0xb496c6['type']==='promotion'?_0x2e6617+_0x3f29c8(0xba):_0x2e6617+_0x3f29c8(0xd0);_0x479a0a[_0x3f29c8(0xd1)]=_0x27210f+'\x20<span\x20class=\x22rank-text\x22>'+_0xb496c6['rankAchieved']+'</span>';const _0xcb54e7=document['createElement'](_0x3f29c8(0xc5));_0xcb54e7[_0x3f29c8(0xed)]=_0x3f29c8(0xa1);const _0x1f74c0=document['createElement']('button');_0x1f74c0['className']='dismiss-btn',_0x1f74c0['innerHTML']='&times;',_0x1f74c0['title']='Dismiss';const _0x259102=document[_0x3f29c8(0xc0)](_0x3f29c8(0x9c));_0x259102[_0x3f29c8(0xed)]='ignore-btn',_0x259102[_0x3f29c8(0x9a)]=_0x3f29c8(0xbc),_0x259102['title']='Never\x20show\x20this\x20promotion\x20again',_0xcb54e7['appendChild'](_0x259102),_0xcb54e7[_0x3f29c8(0xa0)](_0x1f74c0),_0x153f34[_0x3f29c8(0xa0)](_0x479a0a),_0x153f34['appendChild'](_0xcb54e7),this[_0x3f29c8(0xe0)]['appendChild'](_0x153f34),void _0x153f34['offsetWidth'],setTimeout(()=>{const _0x5e788b=_0x3f29c8;_0x153f34['classList'][_0x5e788b(0xb3)]('new-rank-change');},0x32),_0x1f74c0['addEventListener'](_0x3f29c8(0xce),()=>{const _0x2911ae=_0x3f29c8;localStorage['setItem'](_0x13a52b,JSON[_0x2911ae(0xe3)]({'timestamp':Date['now'](),'ignored':![],'userDismissed':!![],'systemDismissed':![]})),_0x153f34['classList']['remove']('new-rank-change'),_0x153f34['classList']['add']('dismissing'),setTimeout(()=>{const _0x45c0b2=_0x2911ae;_0x153f34[_0x45c0b2(0xb7)]&&(_0x153f34['remove'](),this[_0x45c0b2(0xe0)]['children']['length']===0x0&&(this['bannerContainer'][_0x45c0b2(0xef)]['display']='none'));},0x1f4);}),_0x259102['addEventListener'](_0x3f29c8(0xce),()=>{const _0x41c3e7=_0x3f29c8;localStorage['setItem'](_0x13a52b,JSON[_0x41c3e7(0xe3)]({'timestamp':Date['now'](),'ignored':!![],'userDismissed':!![],'systemDismissed':![]})),_0x153f34['classList'][_0x41c3e7(0xdf)]('new-rank-change'),_0x153f34['classList'][_0x41c3e7(0xb3)]('dismissing'),setTimeout(()=>{const _0x131d1c=_0x41c3e7;_0x153f34['parentNode']&&(_0x153f34['remove'](),this['bannerContainer']['children']['length']===0x0&&(this['bannerContainer']['style']['display']=_0x131d1c(0xc6)));},0x1f4);}),setTimeout(()=>{const _0x1b9670=_0x3f29c8;_0x153f34[_0x1b9670(0xb7)]&&(_0x153f34['classList'][_0x1b9670(0xdf)](_0x1b9670(0xbf)),_0x153f34['classList']['add'](_0x1b9670(0xc3)),localStorage['setItem'](_0x13a52b,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':!![]})),setTimeout(()=>{const _0x567e54=_0x1b9670;_0x153f34['parentNode']&&(_0x153f34['remove'](),this[_0x567e54(0xe0)]['children']['length']===0x0&&(this[_0x567e54(0xe0)]['style']['display']='none'));},0x1f4));},0x3a98);});}async[a42_0x462420(0xe8)](_0x219fc7){const _0x5e9760=a42_0x462420,_0x2759b8={..._0x219fc7},_0xbcd9fd=[_0x219fc7['player'],_0x219fc7['username'],_0x219fc7['playerUsername'],_0x219fc7[_0x5e9760(0xd3)]],_0x1b7e0c=_0xbcd9fd['some'](_0x530c70=>_0x530c70&&typeof _0x530c70==='string'&&!_0x530c70['includes']('ID:')&&!/^[a-zA-Z0-9]{20,}$/[_0x5e9760(0xb4)](_0x530c70));if(_0x1b7e0c)return _0x2759b8;let _0x54c12e=null;if(_0x219fc7['userId'])_0x54c12e=_0x219fc7['userId'];else _0x219fc7['player']&&/^[A-Za-z0-9]{20,}$/['test'](_0x219fc7['player'])&&(_0x54c12e=_0x219fc7[_0x5e9760(0x99)]);if(!_0x54c12e)return _0x2759b8;try{const _0x1d72bc=await getDoc(doc(db,_0x5e9760(0xcf),_0x54c12e));if(_0x1d72bc['exists']()){const _0x21554e=_0x1d72bc['data']();if(_0x21554e['username'])return _0x2759b8['resolvedName']=_0x21554e['username'],_0x2759b8;}const _0x348073=await getDocs(query(collection(db,'approvedMatches'),where(_0x5e9760(0xee),'==',_0x54c12e),orderBy('date',_0x5e9760(0xa5)),limit(0x1)));if(!_0x348073[_0x5e9760(0xca)]){const _0x187e72=_0x348073['docs'][0x0]['data']();if(_0x187e72[_0x5e9760(0xeb)])return _0x2759b8['resolvedName']=_0x187e72['winnerUsername'],_0x2759b8;}const _0x1fb4d8=await getDocs(query(collection(db,_0x5e9760(0xd2)),where('loserId','==',_0x54c12e),orderBy('date','desc'),limit(0x1)));if(!_0x1fb4d8[_0x5e9760(0xca)]){const _0xed57c2=_0x1fb4d8['docs'][0x0][_0x5e9760(0xe6)]();if(_0xed57c2['loserUsername'])return _0x2759b8['resolvedName']=_0xed57c2['loserUsername'],console[_0x5e9760(0xac)]('Resolved\x20'+_0x54c12e+'\x20to\x20'+_0xed57c2['loserUsername']+'\x20(loser)'),_0x2759b8;}}catch(_0x4888c0){console['error']('Error\x20resolving\x20user\x20ID:',_0x4888c0);}return console[_0x5e9760(0xe5)](_0x5e9760(0xa9)+_0x54c12e),_0x2759b8;}['showRankChangeLightbox'](_0x55927e,_0x3a05a9){const _0x210f3c=a42_0x462420;let _0x4d68b9=document['getElementById'](_0x210f3c(0x9d));!_0x4d68b9&&(_0x4d68b9=document['createElement']('div'),_0x4d68b9['id']='rankChangeModal',_0x4d68b9['className']='rank-change-modal\x20'+_0x55927e,document['body']['appendChild'](_0x4d68b9));const _0x19cce8=_0x55927e==='promotion'?'Congratulations!':'Rank\x20Update',_0x4933c1=_0x55927e==='promotion'?'You\x27ve\x20been\x20promoted\x20to':'You\x27ve\x20been\x20demoted\x20to';_0x4d68b9['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rank-change-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2\x20class=\x22rank-change-title\x22>'+_0x19cce8+'</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>'+_0x4933c1+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22rank-name\x22>'+_0x3a05a9+'</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22rank-change-button\x22\x20id=\x22rank-change-ok-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Got\x20it!\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x4d68b9['style']['display']='flex',document['getElementById']('rank-change-ok-btn')[_0x210f3c(0xcd)]('click',()=>{_0x4d68b9['style']['display']='none';}),_0x4d68b9['addEventListener']('click',_0x57b5d4=>{_0x57b5d4['target']===_0x4d68b9&&(_0x4d68b9['style']['display']='none');});}async['checkAndRecordPromotion'](_0xe8a0d8,_0x20b6f3,_0x3edb98,_0x509bb0={}){const _0x2f5d7e=a42_0x462420;try{if(_0x20b6f3===_0x3edb98||!_0xe8a0d8)return null;const _0x1280b2=_0x509bb0['source']||'automatic',_0x17b241=_0x509bb0['matchId']||null,_0x14d5d4=_0x509bb0['adminUser']||null;console['log']('Processing\x20potential\x20rank\x20change:\x20'+_0x3edb98+'\x20→\x20'+_0x20b6f3+'\x20(source:\x20'+_0x1280b2+')');let _0x27e7bc=null,_0x1000a8=null;try{const _0x376e3a=await getDoc(doc(db,'players',_0xe8a0d8));if(_0x376e3a['exists']()){const _0x2af62b=_0x376e3a[_0x2f5d7e(0xe6)]();_0x27e7bc=_0x2af62b[_0x2f5d7e(0xc4)]||_0x2af62b[_0x2f5d7e(0xd3)]||null,_0x1000a8=_0x2af62b[_0x2f5d7e(0xd3)]||_0x2af62b[_0x2f5d7e(0xc4)]||null;}!_0x27e7bc&&_0x509bb0[_0x2f5d7e(0xc4)]&&(_0x27e7bc=_0x509bb0['username'],_0x1000a8=_0x509bb0['username']);!_0x27e7bc&&auth['currentUser']&&(_0x27e7bc=auth['currentUser']['displayName']||auth['currentUser'][_0x2f5d7e(0xd6)][_0x2f5d7e(0xec)]('@')[0x0],_0x1000a8=auth['currentUser']['displayName']||null);if(!_0x27e7bc){const _0x56980a=query(collection(db,_0x2f5d7e(0xd2)),where('winnerId','==',_0xe8a0d8),limit(0x1)),_0x547a9e=await getDocs(_0x56980a);if(!_0x547a9e[_0x2f5d7e(0xca)])_0x27e7bc=_0x547a9e[_0x2f5d7e(0xb2)][0x0]['data']()['winnerUsername']||'Unknown\x20Player',_0x1000a8=_0x27e7bc;else{const _0x1733e9=query(collection(db,'approvedMatches'),where('loserId','==',_0xe8a0d8),limit(0x1)),_0x657b9f=await getDocs(_0x1733e9);!_0x657b9f['empty']&&(_0x27e7bc=_0x657b9f[0x0][_0x2f5d7e(0xe6)]()['loserUsername']||_0x2f5d7e(0xd8),_0x1000a8=_0x27e7bc);}}}catch(_0x5b41d8){console['error']('Error\x20resolving\x20username:',_0x5b41d8);}!_0x27e7bc&&(console[_0x2f5d7e(0xe5)]('Could\x20not\x20resolve\x20username\x20for\x20userId:',_0xe8a0d8),_0x27e7bc=_0x2f5d7e(0xb1),_0x1000a8=_0x2f5d7e(0xd8));const _0x28589e=this['getRankName'](_0x3edb98),_0x444de6=this['getRankName'](_0x20b6f3);if(_0x28589e!==_0x444de6){const _0x2e02c4=_0x20b6f3>_0x3edb98,_0x3e932e=_0x2e02c4?'promotion':'demotion',_0x2f395d=_0x444de6;console['log']('Recording\x20'+_0x3e932e+'\x20for\x20'+_0x27e7bc+':\x20'+_0x3edb98+'\x20('+_0x28589e+')\x20→\x20'+_0x20b6f3+'\x20('+_0x444de6+')');try{const _0x360933={'player':_0x27e7bc,'playerUsername':_0x27e7bc,'username':_0x27e7bc,'displayName':_0x1000a8,'userId':_0xe8a0d8,'type':_0x3e932e,'rankAchieved':_0x2f395d,'timestamp':serverTimestamp(),'previousElo':_0x3edb98,'newElo':_0x20b6f3,'change':_0x20b6f3-_0x3edb98,'previousRank':_0x28589e,'newRank':_0x444de6,'source':_0x1280b2};if(_0x1280b2==='match'&&_0x17b241)_0x360933[_0x2f5d7e(0xb8)]=_0x17b241;else _0x1280b2==='admin'&&_0x14d5d4?(_0x360933[_0x2f5d7e(0xa3)]=_0x14d5d4,_0x360933['isAutomatic']=![]):_0x360933['isAutomatic']=!![];const _0x2b5cf7=writeBatch(db),_0x68fe3b=doc(collection(db,'eloHistory')),_0x9be8b3=doc(collection(db,_0x2f5d7e(0xc8)));return _0x2b5cf7['set'](_0x68fe3b,_0x360933),_0x2b5cf7[_0x2f5d7e(0xa8)](_0x9be8b3,_0x360933),await _0x2b5cf7[_0x2f5d7e(0xd5)](),await this['sendPromotionNotification'](_0xe8a0d8,_0x27e7bc,_0x3edb98,_0x20b6f3,_0x28589e,_0x444de6,_0x3e932e,{'displayName':_0x1000a8,'source':_0x1280b2,'matchId':_0x17b241,'ladder':_0x509bb0['ladder']||'D1'}),console['log']('Successfully\x20recorded\x20'+_0x3e932e+_0x2f5d7e(0x98)+_0x27e7bc+'\x20to\x20'+_0x2f395d),_0x2f395d;}catch(_0x80152f){console[_0x2f5d7e(0xbe)](_0x2f5d7e(0xcc),_0x80152f);try{return await addDoc(collection(db,_0x2f5d7e(0xf2)),{'player':_0x27e7bc,'playerUsername':_0x27e7bc,'username':_0x27e7bc,'displayName':_0x1000a8,'userId':_0xe8a0d8,'type':_0x3e932e,'rankAchieved':_0x2f395d,'timestamp':serverTimestamp(),'previousElo':_0x3edb98,'newElo':_0x20b6f3,'change':_0x20b6f3-_0x3edb98,'previousRank':_0x28589e,'source':_0x1280b2,'isAutomatic':_0x1280b2!=='admin'}),await this['sendPromotionNotification'](_0xe8a0d8,_0x27e7bc,_0x3edb98,_0x20b6f3,_0x28589e,_0x444de6,_0x3e932e,{'displayName':_0x1000a8,'source':_0x1280b2,'matchId':_0x17b241,'ladder':_0x509bb0[_0x2f5d7e(0xc2)]||'D1'}),_0x2f395d;}catch(_0x1acf72){return console[_0x2f5d7e(0xbe)]('Fallback\x20write\x20failed:',_0x1acf72),null;}}}return null;}catch(_0x336ac2){return console['error']('Error\x20in\x20promotion/demotion\x20recording:',_0x336ac2),null;}}[a42_0x462420(0x9f)](_0x4a95ba){const _0x33a0e9=a42_0x462420;for(let _0x5db239=this['RANKS']['length']-0x1;_0x5db239>=0x0;_0x5db239--){if(_0x4a95ba>=this['RANKS'][_0x5db239]['threshold'])return this[_0x33a0e9(0xab)][_0x5db239]['name'];}return'Unranked';}[a42_0x462420(0xbd)](){this['pollingInterval']&&clearInterval(this['pollingInterval']);}['isNewRankChange'](_0x41f812){if(_0x41f812['timestamp']){const _0x4118fe=_0x41f812['timestamp']['seconds']*0x3e8,_0x4ca3bd=Date['now'](),_0x1bc9f4=(_0x4ca3bd-_0x4118fe)/(0x3e8*0x3c*0x3c);if(_0x1bc9f4>0x18)return![];}if(_0x41f812['previousRank']&&_0x41f812['newRank']&&_0x41f812['previousRank']!==_0x41f812['newRank'])return!![];return![];}async[a42_0x462420(0xb5)](_0x55754b,_0xdffbb6,_0x350467,_0x27fb6e,_0x4ff1eb,_0x574575,_0x6e6948,_0x14dc71={}){const _0x445f38=a42_0x462420;try{console[_0x445f38(0xac)](_0x445f38(0xd9)+_0xdffbb6+'\x27s\x20'+_0x6e6948);const _0x49f427={'userId':_0x55754b,'username':_0xdffbb6,'displayName':_0x14dc71['displayName']||_0xdffbb6,'oldElo':parseInt(_0x350467),'newElo':parseInt(_0x27fb6e),'eloDifference':parseInt(_0x27fb6e)-parseInt(_0x350467),'oldRank':_0x4ff1eb,'newRank':_0x574575,'type':_0x6e6948,'timestamp':serverTimestamp(),'processed':![],'source':_0x14dc71['source']||'automatic','matchId':_0x14dc71['matchId']||null,'ladder':_0x14dc71['ladder']||'D1','adminUser':_0x14dc71['adminUser']||null};console[_0x445f38(0xac)]('Creating\x20Discord\x20notification:',_0x49f427);const _0x1b4177=await addDoc(collection(db,'promotionNotifications'),_0x49f427);return console['log']('Discord\x20notification\x20sent\x20successfully\x20with\x20ID:\x20'+_0x1b4177['id']),!![];}catch(_0x1661a6){return console['error']('Error\x20sending\x20Discord\x20notification:',_0x1661a6),![];}}}export const promotionManager=new PromotionManager();document[a42_0x462420(0xcd)]('DOMContentLoaded',()=>{const _0x383f44=a42_0x462420;promotionManager[_0x383f44(0xf3)]();});export const initializePromotionTracker=()=>promotionManager['initialize']();export const checkAndRecordPromotion=(_0xa38195,_0x153e04,_0x4c4f55,_0x12c37e)=>promotionManager['checkAndRecordPromotion'](_0xa38195,_0x153e04,_0x4c4f55,_0x12c37e);export const getRankName=_0x124517=>promotionManager['getRankName'](_0x124517);function a42_0x1042(){const _0x2e7bcd=['\x20for\x20','player','textContent','promotion','button','rankChangeModal','DISPLAY_HOURS','getRankName','appendChild','banner-actions','pollingInterval','modifiedBy','demotion','desc','setItem',',\x20treating\x20as\x20new','set','Failed\x20to\x20resolve\x20user\x20ID:\x20','toString','RANKS','log','promotion-details','showRankChangeBanner','visible','apply','A\x20player','docs','add','test','sendPromotionNotification','console','parentNode','matchId','constructor','\x20was\x20promoted\x20to','Skipping\x20ignored\x20promotion:\x20','Don\x27t\x20show\x20again','cleanup','error','new-rank-change','createElement','type','ladder','dismissing','username','div','none','timestamp','promotionHistory','Promotion\x20banner\x20container\x20not\x20found','empty','ignorePromotion','Error\x20writing\x20promotion\x20records:','addEventListener','click','players','\x20was\x20demoted\x20to','innerHTML','approvedMatches','displayName','length','commit','email','playerUsername','Unknown\x20Player','STARTING\x20notification\x20for\x20','#50C878','getItem','Bronze','visibilityState','toMillis','remove','bannerContainer','promotion_','block','stringify','now','warn','data','Promotion\x20','resolveUserId','true','parse','winnerUsername','split','className','winnerId','style','toDateString','Invalid\x20storage\x20format\x20for\x20','eloHistory','initialize','visibilitychange'];a42_0x1042=function(){return _0x2e7bcd;};return a42_0x1042();}
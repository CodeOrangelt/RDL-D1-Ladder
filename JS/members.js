const a38_0x37d97d=a38_0x40fe,a38_0x441afa=(function(){let _0x41a92c=!![];return function(_0x5ed7c9,_0x45162f){const _0x1badcb=_0x41a92c?function(){const _0x3db912=a38_0x40fe;if(_0x45162f){const _0x477f51=_0x45162f[_0x3db912(0x122)](_0x5ed7c9,arguments);return _0x45162f=null,_0x477f51;}}:function(){};return _0x41a92c=![],_0x1badcb;};}()),a38_0x3bce1a=a38_0x441afa(this,function(){const _0x342a8f=a38_0x40fe,_0x1a6b6f=function(){let _0x2b3a92;try{_0x2b3a92=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x3fa298){_0x2b3a92=window;}return _0x2b3a92;},_0x556283=_0x1a6b6f(),_0x1a6053=_0x556283['console']=_0x556283['console']||{},_0x2a2795=['log','warn',_0x342a8f(0x126),'error','exception','table','trace'];for(let _0x28489c=0x0;_0x28489c<_0x2a2795['length'];_0x28489c++){const _0x13c9be=a38_0x441afa['constructor'][_0x342a8f(0x11a)]['bind'](a38_0x441afa),_0xa38502=_0x2a2795[_0x28489c],_0x1d2021=_0x1a6053[_0xa38502]||_0x13c9be;_0x13c9be[_0x342a8f(0x120)]=a38_0x441afa[_0x342a8f(0x123)](a38_0x441afa),_0x13c9be[_0x342a8f(0x125)]=_0x1d2021['toString']['bind'](_0x1d2021),_0x1a6053[_0xa38502]=_0x13c9be;}});a38_0x3bce1a();function a38_0x4447(){const _0x3fe05a=['status','motto','ladder','active','send','params','serverTimestamp','includes','userProfiles','playersD3','prototype','country','FieldValue','emerald','onRequest','data','__proto__','has','apply','bind','silver','toString','info','bronze','Error\x20updating\x20members\x20list:','length','collection','document','rebuildMembersListManual','get','forEach','username','push','set','commit','elo','firestore'];a38_0x4447=function(){return _0x3fe05a;};return a38_0x4447();}const functions=require('firebase-functions'),admin=require('firebase-admin');admin['initializeApp']();function a38_0x40fe(_0x53e55d,_0x18ce91){const _0x3bce1a=a38_0x4447();return a38_0x40fe=function(_0x441afa,_0x4f224f){_0x441afa=_0x441afa-0x110;let _0x444793=_0x3bce1a[_0x441afa];return _0x444793;},a38_0x40fe(_0x53e55d,_0x18ce91);}const db=admin['firestore']();exports['updateMembersList']=functions[a38_0x37d97d(0x134)][a38_0x37d97d(0x12b)]('{collection}/{docId}')['onWrite'](async(_0x3315fa,_0x3e9d0f)=>{const _0x429b7e=a38_0x37d97d,_0x36174f=_0x3e9d0f[_0x429b7e(0x115)]['collection'],_0x31b528=_0x3e9d0f['params']['docId'];if(!['players','playersD2','playersD3',_0x429b7e(0x118),'nonParticipants'][_0x429b7e(0x117)](_0x36174f))return null;try{await rebuildMembersList(),console['log']('Successfully\x20updated\x20aggregated\x20members\x20list');}catch(_0x2437ec){console['error'](_0x429b7e(0x128),_0x2437ec);}});async function rebuildMembersList(){const _0x1d89c6=a38_0x37d97d,_0x3ffcc5=db['batch'](),[_0x3d2e5a,_0x52196d,_0x399416,_0x681f14,_0x516c47]=await Promise['all']([db[_0x1d89c6(0x12a)]('userProfiles')['get'](),db['collection']('players')['get'](),db[_0x1d89c6(0x12a)]('playersD2')[_0x1d89c6(0x12d)](),db['collection'](_0x1d89c6(0x119))[_0x1d89c6(0x12d)](),db['collection']('nonParticipants')['get']()]),_0x359989=new Map();_0x3d2e5a['forEach'](_0x14b57e=>{_0x359989['set'](_0x14b57e['id'],_0x14b57e['data']());});const _0x3b241f=new Map(),_0x5e1208=(_0x1d8f88,_0x1b71e6)=>{_0x1d8f88['forEach'](_0x3498c6=>{const _0x3154e3=a38_0x40fe,_0x249e9f=_0x3498c6['data'](),_0xfa83a3=_0x3498c6['id'];!_0x3b241f[_0x3154e3(0x121)](_0xfa83a3)&&_0x3b241f['set'](_0xfa83a3,{'userId':_0xfa83a3,'username':_0x249e9f[_0x3154e3(0x12f)]||'Unknown','ladders':[],'isNonParticipant':![]});const _0x2c8571=_0x3b241f['get'](_0xfa83a3);_0x2c8571['ladders']['push']({'ladder':_0x1b71e6,'elo':_0x249e9f['eloRating']||0x4b0,'active':_0x249e9f[_0x3154e3(0x113)]!==![]});});};_0x5e1208(_0x52196d,'D1'),_0x5e1208(_0x399416,'D2'),_0x5e1208(_0x681f14,'D3'),_0x516c47['forEach'](_0x20ece2=>{const _0x7b968=_0x1d89c6,_0x8d65b3=_0x20ece2[_0x7b968(0x11f)](),_0x3a779d=_0x20ece2['id'];!_0x3b241f['has'](_0x3a779d)&&_0x8d65b3[_0x7b968(0x12f)]&&_0x3b241f[_0x7b968(0x131)](_0x3a779d,{'userId':_0x3a779d,'username':_0x8d65b3['username'],'ladders':[],'isNonParticipant':!![]});});const _0x5bfdf4=[];_0x3b241f['forEach']((_0x2942ad,_0x44691d)=>{const _0x52750a=_0x1d89c6,_0x4018ca=_0x359989['get'](_0x44691d)||{};let _0x5e466f=0x0,_0x38c9a0=null;if(_0x2942ad['ladders'][_0x52750a(0x129)]>0x0){const _0x40b195=_0x2942ad['ladders']['sort']((_0x420a86,_0x4cabd0)=>_0x4cabd0['elo']-_0x420a86['elo']);_0x5e466f=_0x40b195[0x0][_0x52750a(0x133)],_0x38c9a0=_0x40b195[0x0][_0x52750a(0x112)];}const _0x4e4c46={'userId':_0x44691d,'username':_0x2942ad['username'],'profileImageUrl':_0x4018ca['profileImageUrl']||null,'country':_0x4018ca[_0x52750a(0x11b)]||null,'motto':_0x4018ca[_0x52750a(0x111)]||null,'favoriteMap':_0x4018ca['favoriteMap']||null,'favoriteWeapon':_0x4018ca['favoriteWeapon']||null,'isNonParticipant':_0x2942ad['isNonParticipant'],'ladders':_0x2942ad['ladders'],'primaryLadder':_0x38c9a0,'highestElo':_0x5e466f,'rank':getPlayerRank(_0x5e466f),'lastUpdated':admin['firestore'][_0x52750a(0x11c)][_0x52750a(0x116)]()};_0x5bfdf4[_0x52750a(0x130)](_0x4e4c46);});const _0x147c1d=db['collection']('aggregatedMembers'),_0x4d7fca=await _0x147c1d['get'](),_0x9167e0=[];_0x4d7fca['forEach'](_0x2d37f4=>{_0x9167e0['push'](_0x2d37f4['ref']['delete']());}),await Promise['all'](_0x9167e0);const _0x5021d0=0x1f4,_0x63137d=[];for(let _0x5c22ac=0x0;_0x5c22ac<_0x5bfdf4['length'];_0x5c22ac+=_0x5021d0){const _0xedef6f=db['batch'](),_0x46aa4b=_0x5bfdf4['slice'](_0x5c22ac,_0x5c22ac+_0x5021d0);_0x46aa4b[_0x1d89c6(0x12e)](_0x1a22d2=>{const _0x42bf4e=_0x147c1d['doc'](_0x1a22d2['userId']);_0xedef6f['set'](_0x42bf4e,_0x1a22d2);}),_0x63137d['push'](_0xedef6f[_0x1d89c6(0x132)]());}await Promise['all'](_0x63137d);}function getPlayerRank(_0x44b567){const _0x4428cf=a38_0x37d97d;if(_0x44b567>=0x7d0)return _0x4428cf(0x11d);if(_0x44b567>=0x708)return'gold';if(_0x44b567>=0x640)return _0x4428cf(0x124);if(_0x44b567>=0x578)return _0x4428cf(0x127);return'unranked';}exports[a38_0x37d97d(0x12c)]=functions['https'][a38_0x37d97d(0x11e)](async(_0x24236d,_0x39cfc8)=>{const _0x4058bd=a38_0x37d97d;try{await rebuildMembersList(),_0x39cfc8['status'](0xc8)[_0x4058bd(0x114)]('Members\x20list\x20rebuilt\x20successfully');}catch(_0x2ac4d5){console['error']('Error\x20rebuilding\x20members\x20list:',_0x2ac4d5),_0x39cfc8[_0x4058bd(0x110)](0x1f4)['send']('Error\x20rebuilding\x20members\x20list');}});
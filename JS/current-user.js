const a12_0x3fe8ab=a12_0x1308,a12_0x36429d=(function(){let _0x1cf6df=!![];return function(_0x3175ba,_0x465aa7){const _0x406349=_0x1cf6df?function(){if(_0x465aa7){const _0x1c3bf8=_0x465aa7['apply'](_0x3175ba,arguments);return _0x465aa7=null,_0x1c3bf8;}}:function(){};return _0x1cf6df=![],_0x406349;};}()),a12_0x803ba2=a12_0x36429d(this,function(){const _0x29b120=a12_0x1308,_0x5d1eae=function(){const _0x27ffdb=a12_0x1308;let _0x4e87f6;try{_0x4e87f6=Function('return\x20(function()\x20'+_0x27ffdb(0xef)+');')();}catch(_0xe2ba71){_0x4e87f6=window;}return _0x4e87f6;},_0x57c406=_0x5d1eae(),_0x5df04e=_0x57c406[_0x29b120(0xda)]=_0x57c406['console']||{},_0x2eeb51=['log','warn','info',_0x29b120(0xe1),_0x29b120(0xed),'table','trace'];for(let _0x33dbdc=0x0;_0x33dbdc<_0x2eeb51[_0x29b120(0xd6)];_0x33dbdc++){const _0x395027=a12_0x36429d[_0x29b120(0xf3)][_0x29b120(0xf9)]['bind'](a12_0x36429d),_0x119bef=_0x2eeb51[_0x33dbdc],_0x1ea90e=_0x5df04e[_0x119bef]||_0x395027;_0x395027['__proto__']=a12_0x36429d['bind'](a12_0x36429d),_0x395027['toString']=_0x1ea90e[_0x29b120(0xf7)]['bind'](_0x1ea90e),_0x5df04e[_0x119bef]=_0x395027;}});a12_0x803ba2();function a12_0x3748(){const _0x344eb3=['length','isAdmin','style','empty','console','join','currentUser','email','querySelectorAll','closest','all','error','hasCheckedCollections','data','logout-link','Error\x20checking\x20','log','gameInvitations','a[href]','addEventListener','block','charAt','status','exception','pendingCount','{}.constructor(\x22return\x20this\x22)(\x20)','innerHTML','\x20in\x20','players','constructor','role','hidden','\x20by\x20UID:','toString','display','prototype','toLowerCase','roleName','pending','lastCheck','none','uid','filter','playersD2','admin@ladder.com','split'];a12_0x3748=function(){return _0x344eb3;};return a12_0x3748();}import{getAuth,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';function a12_0x1308(_0x25797b,_0x2521cc){const _0x803ba2=a12_0x3748();return a12_0x1308=function(_0x36429d,_0x5206cc){_0x36429d=_0x36429d-0xd6;let _0x37480e=_0x803ba2[_0x36429d];return _0x37480e;},a12_0x1308(_0x25797b,_0x2521cc);}import{doc,getDoc,collection,query,where,getDocs,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import{isAdmin}from'./admin-check.js';const ADMIN_EMAILS=[a12_0x3fe8ab(0x102),'Brian2af@outlook.com'],userCache={'uid':null,'username':null,'isAdmin':![],'hasCheckedCollections':![],'lastChecked':0x0,'role':null},invitationCache={'lastCheck':0x0,'pendingCount':0x0,'checkInterval':0x493e0};function updateInboxNotification(_0x37e5f0){const _0x96358b=a12_0x3fe8ab,_0x424538=document['getElementById']('inbox-notification');_0x424538&&(_0x37e5f0>0x0?(_0x424538[_0x96358b(0xd8)][_0x96358b(0xf8)]='inline-block',_0x424538['textContent']=_0x37e5f0>0x9?'9+':_0x37e5f0):_0x424538[_0x96358b(0xd8)][_0x96358b(0xf8)]='none');}async function checkPendingInvitationsForCurrentUser(_0x4f8c6f){const _0x3fcc6d=a12_0x3fe8ab;try{const _0x2ef0bc=Date['now']();if(_0x2ef0bc-invitationCache[_0x3fcc6d(0xfd)]<invitationCache['checkInterval'])return updateInboxNotification(invitationCache[_0x3fcc6d(0xee)]),invitationCache['pendingCount'];invitationCache['lastCheck']=_0x2ef0bc;const _0x3eea51=collection(db,_0x3fcc6d(0xe7)),_0x4b8de4=query(_0x3eea51,where('toUserId','==',_0x4f8c6f),where(_0x3fcc6d(0xec),'==',_0x3fcc6d(0xfc)),limit(0x5)),_0x31ee0c=await getDocs(_0x4b8de4),_0x20cafd=_0x31ee0c['size'];return invitationCache['pendingCount']=_0x20cafd,updateInboxNotification(_0x20cafd),_0x20cafd;}catch(_0x2ec154){return console['warn']('Could\x20not\x20check\x20pending\x20invitations\x20for\x20current\x20user:',_0x2ec154),0x0;}}function updateAuthSectionImmediate(_0xfe16b1,_0x1fe0a0=![]){const _0x4d3467=a12_0x3fe8ab,_0x2dee8d=document['getElementById']('auth-section');if(!_0x2dee8d)return;if(_0xfe16b1&&_0x1fe0a0)document[_0x4d3467(0xde)]('.admin-only')['forEach'](_0x469852=>{const _0x5d8f18=_0x4d3467;_0x469852['style'][_0x5d8f18(0xf8)]=_0x5d8f18(0xea);});else!_0xfe16b1&&document[_0x4d3467(0xde)]('.admin-only')['forEach'](_0x59f4b3=>{const _0x538ce8=_0x4d3467;_0x59f4b3['style']['display']=_0x538ce8(0xfe);});if(_0xfe16b1){const _0x1d8033=userCache['username']||(_0xfe16b1['email']?_0xfe16b1[_0x4d3467(0xdd)]['split']('@')[0x0]:'User'),_0x497c15=userCache['role']?'\x20('+userCache[_0x4d3467(0xf4)]+')':_0x1fe0a0?'\x20(Admin)':'';_0x2dee8d[_0x4d3467(0xf0)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20class=\x22nav-username\x22>'+_0x1d8033+_0x497c15+'</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username='+encodeURIComponent(_0x1d8033)+'\x22>Profile</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./inbox.html\x22\x20class=\x22nav-notification\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Inbox\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22inbox-notification\x22\x20class=\x22notification-dot\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22members.html\x22>Members</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./redeem.html\x22><i\x20class=\x22fas\x20fa-gift\x22></i>\x20Redeem</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20id=\x22logout-link\x22>Sign\x20Out</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';const _0x558329=document['getElementById'](_0x4d3467(0xe4));_0x558329&&_0x558329['addEventListener']('click',_0x46f96b=>{_0x46f96b['preventDefault']();const _0xb3336a=getAuth();updateAuthSectionImmediate(null),_0xb3336a['signOut']()['catch'](_0x2f9432=>{const _0x3a5fc3=a12_0x1308;console[_0x3a5fc3(0xe1)]('Error\x20signing\x20out:',_0x2f9432);});}),_0xfe16b1['uid']&&setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0xfe16b1['uid']);},0x3e8);}else _0x2dee8d['innerHTML']='<a\x20href=\x22login.html\x22\x20class=\x22login-link\x22>Login</a>';}async function checkAdminRoles(_0x3b8de3){const _0x2f5385=a12_0x3fe8ab;if(!_0x3b8de3||!_0x3b8de3['email'])return{'isAdmin':![],'role':null};try{console[_0x2f5385(0xe6)]('Checking\x20roles\x20for\x20user:\x20'+_0x3b8de3['email']);const _0x25bf62=['players','playersD2','playersD3','nonParticipants','userProfiles'],_0x22c5bc=['council','creative\x20lead','owner','admin'];for(const _0x26264e of _0x25bf62){try{const _0x59c9b7=doc(db,_0x26264e,_0x3b8de3['uid']),_0x20a2b4=await getDoc(_0x59c9b7);if(_0x20a2b4['exists']()){const _0x435e19=_0x20a2b4[_0x2f5385(0xe3)]();console['log']('Found\x20user\x20in\x20'+_0x26264e+'\x20by\x20UID:',_0x435e19);let _0x3f3543=(_0x435e19[_0x2f5385(0xfb)]||_0x435e19['role']||'')['toLowerCase'](),_0x133cdb=_0x435e19['roleName']||_0x435e19['role']||'';if(_0x3f3543&&_0x22c5bc['includes'](_0x3f3543)){console[_0x2f5385(0xe6)]('Found\x20admin\x20role:\x20'+_0x3f3543+_0x2f5385(0xf1)+_0x26264e);const _0x4d4c3f=_0x133cdb['split']('\x20')['map'](_0x4e0f35=>_0x4e0f35[_0x2f5385(0xeb)](0x0)['toUpperCase']()+_0x4e0f35['slice'](0x1)['toLowerCase']())[_0x2f5385(0xdb)]('\x20');return{'isAdmin':!![],'role':_0x4d4c3f};}}}catch(_0x3a1ecc){console['error'](_0x2f5385(0xe5)+_0x26264e+_0x2f5385(0xf6),_0x3a1ecc);}}for(const _0x52d262 of _0x25bf62){try{const _0xf4e177=collection(db,_0x52d262);let _0x48e0a4=query(_0xf4e177,where('email','==',_0x3b8de3[_0x2f5385(0xdd)])),_0x3c51d5=await getDocs(_0x48e0a4);_0x3c51d5[_0x2f5385(0xd9)]&&(_0x48e0a4=query(_0xf4e177,where(_0x2f5385(0xdd),'==',_0x3b8de3[_0x2f5385(0xdd)][_0x2f5385(0xfa)]())),_0x3c51d5=await getDocs(_0x48e0a4));if(!_0x3c51d5[_0x2f5385(0xd9)]){const _0x1cf8b5=_0x3c51d5['docs'][0x0][_0x2f5385(0xe3)]();console[_0x2f5385(0xe6)]('Found\x20user\x20in\x20'+_0x52d262+'\x20by\x20email:',_0x1cf8b5);let _0x2884f2=(_0x1cf8b5['roleName']||_0x1cf8b5[_0x2f5385(0xf4)]||'')['toLowerCase'](),_0x11641f=_0x1cf8b5['roleName']||_0x1cf8b5['role']||'';if(_0x2884f2&&_0x22c5bc['includes'](_0x2884f2)){console['log']('Found\x20admin\x20role:\x20'+_0x2884f2+'\x20in\x20'+_0x52d262);const _0x9293f6=_0x11641f[_0x2f5385(0x103)]('\x20')['map'](_0x6a5d23=>_0x6a5d23['charAt'](0x0)['toUpperCase']()+_0x6a5d23['slice'](0x1)['toLowerCase']())['join']('\x20');return{'isAdmin':!![],'role':_0x9293f6};}}}catch(_0x3bdfd0){console['error']('Error\x20checking\x20'+_0x52d262+'\x20by\x20email:',_0x3bdfd0);}}return console[_0x2f5385(0xe6)]('No\x20admin\x20roles\x20found\x20for\x20user'),{'isAdmin':![],'role':null};}catch(_0xd49954){return console[_0x2f5385(0xe1)]('Error\x20in\x20checkAdminRoles:',_0xd49954),{'isAdmin':![],'role':null};}}async function updateAuthSection(_0x7451d6){const _0xfbfd41=a12_0x3fe8ab,_0x49f6ae=_0x7451d6&&isAdmin(_0x7451d6['email']);updateAuthSectionImmediate(_0x7451d6,_0x49f6ae);if(!_0x7451d6){userCache['uid']=null,userCache['username']=null,userCache[_0xfbfd41(0xd7)]=![],userCache[_0xfbfd41(0xe2)]=![],userCache['role']=null;return;}const _0x2766aa=Date['now']();if(_0x7451d6['uid']===userCache['uid']&&userCache['hasCheckedCollections']&&_0x2766aa-userCache['lastChecked']<0x493e0)return;try{userCache['uid']=_0x7451d6['uid'],userCache['lastChecked']=_0x2766aa;const _0x36fafa=isAdmin(_0x7451d6['email']);userCache['isAdmin']=_0x36fafa;if(!_0x36fafa){const {isAdmin:_0x353e2c,role:_0x4d8c17}=await checkAdminRoles(_0x7451d6);userCache[_0xfbfd41(0xd7)]=_0x353e2c,userCache['role']=_0x4d8c17,_0x353e2c&&(document['querySelectorAll']('.admin-only')['forEach'](_0x1f9679=>{const _0x4ff68c=_0xfbfd41;_0x1f9679['style'][_0x4ff68c(0xf8)]='block';}),updateAuthSectionImmediate(_0x7451d6,!![]));}const _0xf74760=[_0xfbfd41(0xf2),_0xfbfd41(0x101),'playersD3','playersDuos','playersCTF','nonParticipants','userProfiles'],_0x4f1a91=_0xf74760['map'](_0x1d07c3=>getDoc(doc(db,_0x1d07c3,_0x7451d6['uid']))['then'](_0x169305=>_0x169305['exists']()?{'collection':_0x1d07c3,'data':_0x169305['data']()}:null)['catch'](()=>null)),_0x2a0227=await Promise[_0xfbfd41(0xe0)](_0x4f1a91),_0x19a336=_0x2a0227[_0xfbfd41(0x100)](_0x2022a6=>_0x2022a6!==null);let _0x446efd=null;for(const _0x58d896 of _0x19a336){if(_0x58d896[_0xfbfd41(0xe3)]['username']){_0x446efd=_0x58d896[_0xfbfd41(0xe3)]['username'];break;}}userCache['username']=_0x446efd||(_0x7451d6['email']?_0x7451d6['email'][_0xfbfd41(0x103)]('@')[0x0]:'User'),userCache[_0xfbfd41(0xe2)]=!![],updateAuthSectionImmediate(_0x7451d6,userCache['isAdmin']),setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0x7451d6['uid']);},0x1f4);}catch(_0x48b5f5){console['error']('Error\x20in\x20full\x20auth\x20update:',_0x48b5f5);}}document[a12_0x3fe8ab(0xe9)]('DOMContentLoaded',()=>{const _0xfee23c=getAuth();onAuthStateChanged(_0xfee23c,async _0xb05102=>{await updateAuthSection(_0xb05102),_0xb05102&&checkPendingInvitationsForCurrentUser(_0xb05102['uid']);}),document['addEventListener']('visibilitychange',()=>{const _0x5ae17f=a12_0x1308;!document[_0x5ae17f(0xf5)]&&_0xfee23c[_0x5ae17f(0xdc)]&&checkPendingInvitationsForCurrentUser(_0xfee23c['currentUser']['uid']);}),document['addEventListener']('click',_0x11a00c=>{const _0x9d0eb4=a12_0x1308;_0x11a00c['target'][_0x9d0eb4(0xdf)](_0x9d0eb4(0xe8))&&_0xfee23c['currentUser']&&checkPendingInvitationsForCurrentUser(_0xfee23c['currentUser'][_0x9d0eb4(0xff)]);});});export{updateAuthSection};
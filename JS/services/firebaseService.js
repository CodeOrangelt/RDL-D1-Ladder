const a50_0x2ac07d=(function(){let _0x57152c=!![];return function(_0x4c651c,_0x238c63){const _0x5eb382=_0x57152c?function(){if(_0x238c63){const _0x1654cc=_0x238c63['apply'](_0x4c651c,arguments);return _0x238c63=null,_0x1654cc;}}:function(){};return _0x57152c=![],_0x5eb382;};}()),a50_0x50d7f1=a50_0x2ac07d(this,function(){const _0x10a817=a50_0x4ae5;let _0x331719;try{const _0x1667f2=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x331719=_0x1667f2();}catch(_0x244185){_0x331719=window;}const _0x2b0c44=_0x331719[_0x10a817(0x1b8)]=_0x331719[_0x10a817(0x1b8)]||{},_0x146a9b=['log','warn',_0x10a817(0x1b1),_0x10a817(0x1b4),'exception','table','trace'];for(let _0x1f8d8d=0x0;_0x1f8d8d<_0x146a9b['length'];_0x1f8d8d++){const _0x41867e=a50_0x2ac07d[_0x10a817(0x1ad)]['prototype']['bind'](a50_0x2ac07d),_0x13a205=_0x146a9b[_0x1f8d8d],_0x147371=_0x2b0c44[_0x13a205]||_0x41867e;_0x41867e['__proto__']=a50_0x2ac07d[_0x10a817(0x1ac)](a50_0x2ac07d),_0x41867e['toString']=_0x147371['toString'][_0x10a817(0x1ac)](_0x147371),_0x2b0c44[_0x13a205]=_0x41867e;}});a50_0x50d7f1();import{db}from'../firebase-config.js';import{collection,doc,getDoc,getDocs,query,limit,startAfter,where,onSnapshot}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const cache={'userProfiles':new Map(),'ladderPlayers':new Map(),'matchResults':new Map(),'eloHistory':new Map()},CACHE_EXPIRY={'userProfiles':0x5*0x3c*0x3e8,'ladderPlayers':0x2*0x3c*0x3e8,'matchResults':0x1*0x3c*0x3e8,'eloHistory':0x3*0x3c*0x3e8};function a50_0x4ae5(_0x18d5b6,_0x356947){const _0x50d7f1=a50_0x219c();return a50_0x4ae5=function(_0x2ac07d,_0x609bda){_0x2ac07d=_0x2ac07d-0x1a9;let _0x219ccb=_0x50d7f1[_0x2ac07d];return _0x219ccb;},a50_0x4ae5(_0x18d5b6,_0x356947);}export const userProfilesRef=collection(db,'userProfiles');export async function fetchPaginatedData(_0x5019d6,_0x55d02b=0xa,_0x1353a5=null){const _0x4c81fb=a50_0x4ae5;let _0x53edd3=query(_0x5019d6,limit(_0x55d02b));_0x1353a5&&(_0x53edd3=query(_0x53edd3,startAfter(_0x1353a5)));const _0x482798=await getDocs(_0x53edd3),_0x384d58=_0x482798['docs'][_0x482798[_0x4c81fb(0x1af)]['length']-0x1];return{'data':_0x482798[_0x4c81fb(0x1af)]['map'](_0x20cd18=>({'id':_0x20cd18['id'],..._0x20cd18[_0x4c81fb(0x1ab)]()})),'lastVisible':_0x384d58,'hasMore':_0x482798['docs']['length']===_0x55d02b};}export async function getUserProfile(_0x5787a7){const _0x24a838=a50_0x4ae5,_0x4c92bb=cache[_0x24a838(0x1be)]['get'](_0x5787a7);if(_0x4c92bb&&Date[_0x24a838(0x1aa)]()-_0x4c92bb['timestamp']<CACHE_EXPIRY['userProfiles'])return _0x4c92bb[_0x24a838(0x1ab)];const _0x2677d0=await getDoc(doc(userProfilesRef,_0x5787a7));if(_0x2677d0[_0x24a838(0x1b3)]()){const _0x37a1bc=_0x2677d0['data']();return cache['userProfiles']['set'](_0x5787a7,{'data':_0x37a1bc,'timestamp':Date['now']()}),_0x37a1bc;}return null;}export async function getLadderData(_0x27b45e=0x1){const _0x14a63c=a50_0x4ae5,_0x16feff='division_'+_0x27b45e,_0x1eda19=cache[_0x14a63c(0x1bd)]['get'](_0x16feff);if(_0x1eda19&&Date['now']()-_0x1eda19['timestamp']<CACHE_EXPIRY[_0x14a63c(0x1bd)])return _0x1eda19['data'];const _0x260832=_0x27b45e===0x1?'players':_0x14a63c(0x1bb)+_0x27b45e,_0x5e5908=collection(db,_0x260832),_0x414559=await getDocs(query(_0x5e5908,limit(0x64))),_0x2bfa6e=_0x414559[_0x14a63c(0x1af)]['map'](_0x1ed7f3=>({'id':_0x1ed7f3['id'],..._0x1ed7f3['data']()}));return cache['ladderPlayers']['set'](_0x16feff,{'data':_0x2bfa6e,'timestamp':Date['now']()}),_0x2bfa6e;}function a50_0x219c(){const _0x404439=['eloHistoryD','now','data','bind','constructor','includes','docs','push','info','timestamp','exists','error','slice','nonParticipants','playersD2','console','forEach','eloHistory','playersD','doc','ladderPlayers','userProfiles'];a50_0x219c=function(){return _0x404439;};return a50_0x219c();}export async function getEloHistoryBatch(_0x351284,_0x43d20b=0x1){const _0x32abba=a50_0x4ae5,_0x382fc2=_0x43d20b===0x1?'eloHistory':_0x32abba(0x1a9)+_0x43d20b,_0x37e983=collection(db,_0x382fc2),_0x453224={},_0x3b7101=[];_0x351284['forEach'](_0x2feada=>{const _0x483a61=_0x32abba,_0x4c9dfa=_0x2feada+'_'+_0x43d20b,_0x3e7fa8=cache['eloHistory']['get'](_0x4c9dfa);_0x3e7fa8&&Date[_0x483a61(0x1aa)]()-_0x3e7fa8[_0x483a61(0x1b2)]<CACHE_EXPIRY[_0x483a61(0x1ba)]?_0x453224[_0x2feada]=_0x3e7fa8['data']:_0x3b7101[_0x483a61(0x1b0)](_0x2feada);});const _0x4b604e=0xa;for(let _0x3aa08d=0x0;_0x3aa08d<_0x3b7101['length'];_0x3aa08d+=_0x4b604e){const _0x2cba65=_0x3b7101[_0x32abba(0x1b5)](_0x3aa08d,_0x3aa08d+_0x4b604e);if(_0x2cba65['length']>0x0)try{const _0x454123=query(_0x37e983,where('playerId','in',_0x2cba65),limit(0x64)),_0x51ab06=await getDocs(_0x454123);_0x51ab06[_0x32abba(0x1af)]['forEach'](_0x44a604=>{const _0x25169f=_0x32abba,_0x4eee65=_0x44a604['data'](),_0xc59da7=_0x4eee65['playerId'];if(!_0x453224[_0xc59da7])_0x453224[_0xc59da7]=[];_0x453224[_0xc59da7]['push'](_0x4eee65);const _0xeca18f=_0xc59da7+'_'+_0x43d20b;cache['eloHistory']['set'](_0xeca18f,{'data':_0x453224[_0xc59da7],'timestamp':Date[_0x25169f(0x1aa)]()});});}catch(_0x51d4bf){console['error']('Error\x20fetching\x20batch\x20ELO\x20history:',_0x51d4bf);}}return _0x453224;}let usernameCache=new Map(),usernameCacheTimestamp=Date['now']();export function setupEfficientListener(_0x3c6807,_0x34b048=[],_0x4ce11e){const _0x13014f=collection(db,_0x3c6807),_0x4100fa=query(_0x13014f,..._0x34b048),_0x7cca08=onSnapshot(_0x4100fa,_0x5cf245=>{const _0x54669b=a50_0x4ae5,_0x4501ec=_0x5cf245['docChanges']()['map'](_0x3bd6ca=>({'type':_0x3bd6ca['type'],'id':_0x3bd6ca[_0x54669b(0x1bc)]['id'],'data':_0x3bd6ca['doc'][_0x54669b(0x1ab)]()}));_0x4501ec['length']>0x0&&_0x4ce11e(_0x4501ec,_0x5cf245[_0x54669b(0x1af)]);});return _0x7cca08;}export async function bulkResolveUsernames(_0x5b6573){const _0x5649fd=a50_0x4ae5,_0x2062b6=new Map();if(!_0x5b6573||_0x5b6573['length']===0x0)return _0x2062b6;const _0xd91d24=['players',_0x5649fd(0x1b7),'playersD3',_0x5649fd(0x1b6)];for(const _0x43d390 of _0xd91d24){const _0x536860=collection(db,_0x43d390),_0x122e24=await getDocs(_0x536860);_0x122e24[_0x5649fd(0x1b9)](_0xaf32d5=>{const _0x131607=_0x5649fd,_0x1b81de=_0xaf32d5['data']();_0x1b81de['username']&&_0x5b6573[_0x131607(0x1ae)](_0xaf32d5['id'])&&_0x2062b6['set'](_0xaf32d5['id'],_0x1b81de['username']);});}return _0x2062b6;}
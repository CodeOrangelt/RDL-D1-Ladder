const a15_0x26f163=a15_0x120b,a15_0x1949d2=(function(){let _0x1f1f49=!![];return function(_0x201b33,_0x323237){const _0x1b8495=_0x1f1f49?function(){const _0x4ff498=a15_0x120b;if(_0x323237){const _0xef55eb=_0x323237[_0x4ff498(0x1a5)](_0x201b33,arguments);return _0x323237=null,_0xef55eb;}}:function(){};return _0x1f1f49=![],_0x1b8495;};}()),a15_0x2422b1=a15_0x1949d2(this,function(){const _0x15fa29=a15_0x120b;let _0x4846e5;try{const _0x134b95=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x4846e5=_0x134b95();}catch(_0x14f385){_0x4846e5=window;}const _0x4a8fd4=_0x4846e5['console']=_0x4846e5['console']||{},_0x52c51b=['log','warn','info','error','exception','table','trace'];for(let _0x11cd6d=0x0;_0x11cd6d<_0x52c51b[_0x15fa29(0x1ae)];_0x11cd6d++){const _0x1f1d66=a15_0x1949d2['constructor']['prototype']['bind'](a15_0x1949d2),_0x4fddcb=_0x52c51b[_0x11cd6d],_0x12d795=_0x4a8fd4[_0x4fddcb]||_0x1f1d66;_0x1f1d66[_0x15fa29(0x1b0)]=a15_0x1949d2[_0x15fa29(0x1b2)](a15_0x1949d2),_0x1f1d66['toString']=_0x12d795['toString']['bind'](_0x12d795),_0x4a8fd4[_0x4fddcb]=_0x1f1d66;}});a15_0x2422b1();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc,where}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a15_0x120b(_0x4c55f6,_0x2b78bf){const _0x2422b1=a15_0x3825();return a15_0x120b=function(_0x1949d2,_0x70a2f1){_0x1949d2=_0x1949d2-0x1a3;let _0x382532=_0x2422b1[_0x1949d2];return _0x382532;},a15_0x120b(_0x4c55f6,_0x2b78bf);}function a15_0x3825(){const _0x53b543=['newElo','winnerUsername','apply','Error\x20getting\x20D3\x20username:','Unranked','timestamp','match','eloHistoryD3','data','Gold','Unknown\x20Player','length','approvedMatchesD3','__proto__','docs','bind','loserId'];a15_0x3825=function(){return _0x53b543;};return a15_0x3825();}import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D3=[{'name':'Emerald','elo':0x7d0},{'name':a15_0x26f163(0x1ac),'elo':0x708},{'name':'Silver','elo':0x640},{'name':'Bronze','elo':0x578},{'name':'Unranked','elo':0x4b0}];let lastVisibleD3=null;async function getUsernameByIdD3(_0x4cf470){const _0x153ce1=a15_0x26f163;try{if(!_0x4cf470)return _0x153ce1(0x1ad);const _0x103650=await getDoc(doc(db,'playersD3',_0x4cf470));if(_0x103650['exists']())return _0x103650[_0x153ce1(0x1ab)]()['username']||_0x153ce1(0x1ad);const _0x3b357d=await getDocs(query(collection(db,'approvedMatchesD3'),where('winnerId','==',_0x4cf470),limit(0x1)));if(!_0x3b357d['empty'])return _0x3b357d[_0x153ce1(0x1b1)][0x0][_0x153ce1(0x1ab)]()[_0x153ce1(0x1a4)]||'Unknown\x20Player';const _0x172a51=await getDocs(query(collection(db,_0x153ce1(0x1af)),where(_0x153ce1(0x1b3),'==',_0x4cf470),limit(0x1)));if(!_0x172a51['empty'])return _0x172a51['docs'][0x0]['data']()['loserUsername']||'Unknown\x20Player';return _0x153ce1(0x1ad);}catch(_0x4dc2b3){return console['error'](_0x153ce1(0x1a6),_0x4dc2b3),'Unknown\x20Player';}}export async function recordEloChangeD3({playerId:_0x530d18,previousElo:_0x4eb139,newElo:_0x295b85,opponentId:_0x58e844,matchResult:_0x3b853d,previousPosition:_0x53545d,newPosition:_0x337557,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x462568,timestamp:_0x482db4}){const _0x1a4a59=a15_0x26f163;try{const _0x4395b4=doc(collection(db,'eloHistoryD3'));let _0x558a8e=_0x1a4a59(0x1a9);if(isPromotion)_0x558a8e='promotion';if(isDemotion)_0x558a8e='demotion';let _0x280986=_0x1a4a59(0x1a7);if(_0x295b85>=0x7d0)_0x280986='Emerald';else{if(_0x295b85>=0x708)_0x280986='Gold';else{if(_0x295b85>=0x640)_0x280986='Silver';else{if(_0x295b85>=0x578)_0x280986='Bronze';}}}return await setDoc(_0x4395b4,{'type':_0x558a8e,'player':_0x530d18,'opponent':_0x58e844,'previousElo':_0x4eb139,'newElo':_0x295b85,'change':_0x295b85-_0x4eb139,'matchResult':_0x3b853d,'previousPosition':_0x53545d,'newPosition':_0x337557,'rankAchieved':_0x280986,'matchId':_0x462568,'timestamp':_0x482db4||serverTimestamp(),'gameMode':'D3'}),console['log']('D3\x20ELO\x20history\x20recorded\x20for\x20'+_0x530d18),!![];}catch(_0x62142f){console['error']('Error\x20recording\x20D3\x20ELO\x20history:',_0x62142f);throw _0x62142f;}}export async function getEloHistoryD3(_0x363f79=0x14){const _0x3bea7e=a15_0x26f163;try{const _0x380a77=collection(db,_0x3bea7e(0x1aa));let _0x5731c8;lastVisibleD3?_0x5731c8=query(_0x380a77,orderBy(_0x3bea7e(0x1a8),'desc'),startAfter(lastVisibleD3),limit(_0x363f79)):_0x5731c8=query(_0x380a77,orderBy('timestamp','desc'),limit(_0x363f79));const _0x4a8d18=await getDocs(_0x5731c8);if(_0x4a8d18['empty'])return{'entries':[],'hasMore':![]};lastVisibleD3=_0x4a8d18[_0x3bea7e(0x1b1)][_0x4a8d18['docs']['length']-0x1];const _0x448f0f=_0x4a8d18['docs']['map'](async _0x77add7=>{const _0xecea17=_0x3bea7e,_0x584909=_0x77add7['data'](),[_0x4b08a9,_0xfc5533]=await Promise['all']([getUsernameByIdD3(_0x584909['player']),getUsernameByIdD3(_0x584909['opponent'])]);return{..._0x584909,'playerUsername':_0x4b08a9,'opponentUsername':_0xfc5533,'change':_0x584909[_0xecea17(0x1a3)]-_0x584909['previousElo'],'timestamp':_0x584909['timestamp']};}),_0x59e4b3=await Promise['all'](_0x448f0f);return{'entries':_0x59e4b3,'hasMore':_0x4a8d18['size']===_0x363f79};}catch(_0x1705cf){console['error']('Error\x20fetching\x20D3\x20ELO\x20history:',_0x1705cf);throw _0x1705cf;}}export function resetPaginationD3(){lastVisibleD3=null;}
const a12A=a12d;(function(a,b){const w=a12d,c=a();while(!![]){try{const d=parseInt(w(0x11b))/0x1*(parseInt(w(0x105))/0x2)+-parseInt(w(0xdd))/0x3*(parseInt(w(0xf5))/0x4)+-parseInt(w(0xea))/0x5*(-parseInt(w(0xd2))/0x6)+-parseInt(w(0x116))/0x7+parseInt(w(0xcf))/0x8*(parseInt(w(0xe9))/0x9)+parseInt(w(0xf8))/0xa*(parseInt(w(0x10d))/0xb)+-parseInt(w(0x117))/0xc;if(d===b)break;else c['push'](c['shift']());}catch(e){c['push'](c['shift']());}}}(a12c,0x2eba7));const a12b=(function(){let a=!![];return function(b,c){const d=a?function(){const x=a12d;if(c){const e=c[x(0xf0)](b,arguments);return c=null,e;}}:function(){};return a=![],d;};}()),a12a=a12b(this,function(){const z=a12d,a=function(){const y=a12d;let f;try{f=Function(y(0xd0)+y(0xcb)+');')();}catch(g){f=window;}return f;},b=a(),c=b['console']=b['console']||{},d=[z(0x118),z(0xfb),'info','error','exception',z(0xf9),z(0xd7)];for(let e=0x0;e<d['length'];e++){const f=a12b[z(0xfe)]['prototype']['bind'](a12b),g=d[e],h=c[g]||f;f['__proto__']=a12b['bind'](a12b),f[z(0xe0)]=h['toString']['bind'](h),c[g]=f;}});a12a();function a12c(){const Q=['zMLSDgvY','Dg9mB3DLCKnHC2u','CxvLCNLtzwXLy3rVCKfSBa','Dg9vC2vYswq','nhLKv0rtCG','BgfZDenOzwnRzwq','C3rHDhvZ','odiWC1PpuKP0','DgfIBgu','igLUia','D2fYBG','AgfZq2HLy2TLzenVBgXLy3rPB25Z','ywrKrxzLBNrmAxn0zw5LCG','y29UC3rYDwn0B3i','pgeGAhjLzJ0IBg9NAw4UAhrTBciGy2XHC3m9iMXVz2LUlwXPBMSIpKXVz2LUpc9HpG','igj5ifvjrdO','igj5igvTywLSoG','BwfW','yvTOCMvMxq','z2v0rwXLBwvUDej5swq','mtzduLb0vLi','CM9Szq','y2HHCKf0','CgvUzgLUz0nVDw50','CgXHEwvYC0qZ','re9nq29UDgvUDeXVywrLza','ywrTAw5aBgfKzgvYlMnVBq','C3bSAxq','nde4mhPZB3bvBa','y2XPy2S','Aw5Uzxjive1m','rxjYB3iGC2LNBMLUzYbVDxq6','vxnLCG','zw1WDhK','zM9YrwfJAa','DxnLCM5HBwu','BM9UugfYDgLJAxbHBNrZ','nJi1odqYte1uEfzT','mJK1nJi2mgvQEfvNza','Bg9N','iJ5qCM9MAwXLpc9HpGOGicaGicaGicaGicaGicaGicaGidXHigHYzwy9iI4VAw5IB3GUAhrTBciGy2XHC3m9iM5HDI1UB3rPzMLJyxrPB24IpGOGicaGicaGicaGicaGicaGicaGicaGicbjBMjVEcakicaGicaGicaGicaGicaGicaGicaGicaGphnWyw4GAwq9iMLUyM94lw5VDgLMAwnHDgLVBIiGy2XHC3m9iM5VDgLMAwnHDgLVBI1KB3qIpJWVC3bHBJ4kicaGicaGicaGicaGicaGicaGica8l2e+cIaGicaGicaGicaGicaGicaGicaGpgeGAhjLzJ0IBwvTyMvYCY5ODg1SiJ5nzw1IzxjZpc9HpGOGicaGicaGicaGicaGicaGicaGidXHigHYzwy9iI4VCMvKzwvTlMH0BwWIpJXPignSyxnZpsjMyxmGzMeTz2LMDci+pc9PpIbszwrLzw08l2e+cIaGicaGicaGicaGicaGicaGicaGpgeGAhjLzJ0IiYiGAwq9iMXVz291Dc1SAw5RiJ5tAwDUie91DdWVyt4kicaGicaGicaGicaGicaGidWVzgL2pGOGicaGicaGicaGica8l2rPDJ4kicaGicaGica','BM93','mZu2mJjjt3zrEfm','DgHLBG','BgfZDenOzwnR','zxHPC3rZ','rM91BMqGywrTAw4GCM9SztOG','E30Uy29UC3rYDwn0B3iOiNjLDhvYBIb0AgLZiIKOicK','C3r5Bgu','C2LNBK91Da','C2XPy2u','og9gveX6vG','CMv0DxjUicHMDw5JDgLVBIGPia','Aw5SAw5LlwjSB2nR','nZHstfzKBfy','icHbzg1PBIK','Axnbzg1PBG','z2fTzuLUDML0yxrPB25Z','y2HLy2TjBNrLCNzHBa','DhjHy2u','DxnLCLbYB2zPBgvZ','DgfYz2v0','Aw5JBhvKzxm','CgXHEwvYCW','CM9Szu5HBwu','odCZnZi5ywjdBwvh','DMLZAwjPBgL0EwnOyw5Nzq','rxjYB3iGAw4GzNvSBcbHDxrOihvWzgf0ztO','Dg9tDhjPBMC','Aw5IB3GTBM90AwzPy2f0Aw9U','zgf0yq','cIaGicaGicaGicaGidXKAxyGy2XHC3m9iM5HDI1KCM9Wzg93BIi+cIaGicaGicaGicaGicaGica8ysbOCMvMpsiJiIbJBgfZCZ0IBMf2lxvZzxjUyw1LiJ4','rxjYB3iGy2HLy2TPBMCG','lMfKBwLUlw9UBhK','zgLZCgXHEq','ywrTAw4','yMXVy2S','mtuZnZi1nefwuwjwqG','mti3ndG1ANfcuKDX','DwLK','tM8GywrTAw4GCM9SzxmGzM91BMqGzM9YihvZzxi','zxjYB3i','q2HLy2TPBMCGCM9SzxmGzM9YihvZzxi6ia','zw1HAwW','yxbWBhK'];a12c=function(){return Q;};return a12c();}import{getAuth,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{doc,getDoc,collection,query,where,getDocs,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';function a12d(a,b){const c=a12c();return a12d=function(d,e){d=d-0xc9;let f=c[d];if(a12d['lbjJCU']===undefined){var g=function(l){const m='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let n='',o='';for(let p=0x0,q,r,s=0x0;r=l['charAt'](s++);~r&&(q=p%0x4?q*0x40+r:r,p++%0x4)?n+=String['fromCharCode'](0xff&q>>(-0x2*p&0x6)):0x0){r=m['indexOf'](r);}for(let t=0x0,u=n['length'];t<u;t++){o+='%'+('00'+n['charCodeAt'](t)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(o);};a12d['djCBmU']=g,a=arguments,a12d['lbjJCU']=!![];}const h=c[0x0],i=d+h,j=a[i];return!j?(f=a12d['djCBmU'](f),a[i]=f):f=j,f;},a12d(a,b);}import{isAdmin}from'./admin-check.js';const ADMIN_EMAILS=[a12A(0x10b),'Brian2af@outlook.com'],userCache={'uid':null,'username':null,'isAdmin':![],'hasCheckedCollections':![],'lastChecked':0x0,'role':null},invitationCache={'lastCheck':0x0,'pendingCount':0x0,'checkInterval':0x493e0};function updateInboxNotification(a){const B=a12A,b=document['getElementById'](B(0xe1));b&&(a>0x0?(b['style'][B(0xe6)]=B(0xd1),b['textContent']=a>0x9?'9+':a):b['style']['display']='none');}async function checkPendingInvitationsForCurrentUser(a){const C=a12A;try{const b=Date['now']();if(b-invitationCache[C(0x11d)]<invitationCache[C(0xd6)])return updateInboxNotification(invitationCache[C(0x108)]),invitationCache['pendingCount'];invitationCache['lastCheck']=b;const c=collection(db,C(0xd5)),d=query(c,where(C(0xf4),'==',a),where(C(0xf7),'==','pending'),limit(0x5)),e=await getDocs(d),f=e['size'];return invitationCache[C(0x108)]=f,updateInboxNotification(f),f;}catch(g){return console[C(0xfb)]('Could\x20not\x20check\x20pending\x20invitations\x20for\x20current\x20user:',g),0x0;}}function updateAuthSectionImmediate(a,b=![]){const D=a12A,c=document['getElementById']('auth-section');if(!c)return;if(a&&b)document['querySelectorAll']('.admin-only')[D(0x113)](d=>{const E=D;d[E(0xcc)][E(0xe6)]='block';});else!a&&document[D(0xf3)](D(0xe5))[D(0x113)](d=>{const F=D;d['style'][F(0xe6)]='none';});if(a){const d=userCache['username']||(a[D(0xef)]?a[D(0xef)]['split']('@')[0x0]:D(0x111)),e=userCache['role']?'\x20('+userCache[D(0x106)]+')':b?D(0xd3):'';c[D(0x10f)]=D(0xe3)+d+e+'</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username='+encodeURIComponent(d)+D(0x119);const f=document[D(0x104)]('logout-link');f&&f['addEventListener']('click',g=>{const G=D;g['preventDefault']();const h=getAuth();updateAuthSectionImmediate(null),h[G(0xcd)]()['catch'](i=>{const H=G;console['error'](H(0x110),i);});}),a['uid']&&setTimeout(()=>{const I=D;checkPendingInvitationsForCurrentUser(a[I(0xeb)]);},0x3e8);}else c[D(0x10f)]=D(0xff);}async function checkAdminRoles(a){const J=a12A;if(!a||!a['email'])return{'isAdmin':![],'role':null};try{console['log'](J(0xee)+a['email']);const b=[J(0xdb),'playersD2',J(0x109),J(0x115),J(0xd8)],c=['council','creative\x20lead','owner',J(0xe7)];for(const d of b){try{const e=doc(db,d,a['uid']),f=await getDoc(e);if(f[J(0xc9)]()){const g=f['data']();console['log']('Found\x20user\x20in\x20'+d+J(0x100),g);let h=(g['roleName']||g[J(0x106)]||'')[J(0xf2)](),i=g['roleName']||g['role']||'';if(h&&c['includes'](h)){console['log']('Found\x20admin\x20role:\x20'+h+'\x20in\x20'+d);const j=i[J(0x10c)]('\x20')['map'](k=>k['charAt'](0x0)['toUpperCase']()+k['slice'](0x1)['toLowerCase']())['join']('\x20');return{'isAdmin':!![],'role':j};}}}catch(k){console['error'](J(0xe4)+d+J(0x100),k);}}for(const l of b){try{const m=collection(db,l);let n=query(m,where('email','==',a['email'])),o=await getDocs(n);o[J(0x112)]&&(n=query(m,where(J(0xef),'==',a['email'][J(0xf2)]())),o=await getDocs(n));if(!o['empty']){const p=o['docs'][0x0]['data']();console[J(0x118)]('Found\x20user\x20in\x20'+l+J(0x101),p);let r=(p[J(0xdc)]||p['role']||'')['toLowerCase'](),s=p['roleName']||p[J(0x106)]||'';if(r&&c[J(0xda)](r)){console[J(0x118)](J(0xca)+r+J(0xfa)+l);const t=s[J(0x10c)]('\x20')[J(0x102)](u=>u[J(0x107)](0x0)['toUpperCase']()+u[J(0xce)](0x1)['toLowerCase']())['join']('\x20');return{'isAdmin':!![],'role':t};}}}catch(u){console[J(0xed)]('Error\x20checking\x20'+l+J(0x101),u);}}return console[J(0x118)](J(0xec)),{'isAdmin':![],'role':null};}catch(v){return console[J(0xed)]('Error\x20in\x20checkAdminRoles:',v),{'isAdmin':![],'role':null};}}async function updateAuthSection(a){const K=a12A,b=a&&isAdmin(a['email']);updateAuthSectionImmediate(a,b);if(!a){userCache['uid']=null,userCache[K(0x114)]=null,userCache[K(0xd4)]=![],userCache[K(0xfc)]=![],userCache[K(0x106)]=null;return;}const c=Date[K(0x11a)]();if(a['uid']===userCache['uid']&&userCache[K(0xfc)]&&c-userCache[K(0xf6)]<0x493e0)return;try{userCache[K(0xeb)]=a[K(0xeb)],userCache['lastChecked']=c;const d=isAdmin(a[K(0xef)]);userCache['isAdmin']=d;if(!d){const {isAdmin:j,role:k}=await checkAdminRoles(a);userCache['isAdmin']=j,userCache[K(0x106)]=k,j&&(document['querySelectorAll']('.admin-only')[K(0x113)](l=>{const L=K;l['style']['display']=L(0xe8);}),updateAuthSectionImmediate(a,!![]));}const e=[K(0xdb),'playersD2',K(0x109),'playersDuos','playersCTF','nonParticipants',K(0xd8)],f=e[K(0x102)](l=>getDoc(doc(db,l,a['uid']))[K(0x11c)](m=>m[K(0xc9)]()?{'collection':l,'data':m[K(0xe2)]()}:null)['catch'](()=>null)),g=await Promise['all'](f),h=g[K(0xf1)](l=>l!==null);let i=null;for(const l of h){if(l[K(0xe2)][K(0x114)]){i=l['data'][K(0x114)];break;}}userCache[K(0x114)]=i||(a[K(0xef)]?a['email'][K(0x10c)]('@')[0x0]:K(0x111)),userCache[K(0xfc)]=!![],updateAuthSectionImmediate(a,userCache[K(0xd4)]),setTimeout(()=>{const M=K;checkPendingInvitationsForCurrentUser(a[M(0xeb)]);},0x1f4);}catch(m){console[K(0xed)](K(0xdf),m);}}document[a12A(0xfd)](a12A(0x10a),()=>{const N=a12A,a=getAuth();onAuthStateChanged(a,async b=>{await updateAuthSection(b),b&&checkPendingInvitationsForCurrentUser(b['uid']);}),document[N(0xfd)](N(0xde),()=>{const O=N;!document['hidden']&&a['currentUser']&&checkPendingInvitationsForCurrentUser(a['currentUser'][O(0xeb)]);}),document[N(0xfd)](N(0x10e),b=>{const P=N;b[P(0xd9)]['closest'](P(0x103))&&a['currentUser']&&checkPendingInvitationsForCurrentUser(a['currentUser']['uid']);});});export{updateAuthSection};
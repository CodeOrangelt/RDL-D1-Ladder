const a55_0x29b815=a55_0x3a40,a55_0xe2d22=(function(){let _0x312688=!![];return function(_0x1a7756,_0x253f62){const _0x1d6804=_0x312688?function(){const _0xefd369=a55_0x3a40;if(_0x253f62){const _0x5c9f14=_0x253f62[_0xefd369(0x1ee)](_0x1a7756,arguments);return _0x253f62=null,_0x5c9f14;}}:function(){};return _0x312688=![],_0x1d6804;};}()),a55_0x44b631=a55_0xe2d22(this,function(){const _0x7bd377=a55_0x3a40,_0x535dfe=function(){const _0xdd4fd=a55_0x3a40;let _0x5452e8;try{_0x5452e8=Function(_0xdd4fd(0x208)+_0xdd4fd(0x209)+');')();}catch(_0x5c281f){_0x5452e8=window;}return _0x5452e8;},_0x1a7e2=_0x535dfe(),_0x3e03c1=_0x1a7e2[_0x7bd377(0x1f8)]=_0x1a7e2[_0x7bd377(0x1f8)]||{},_0x2d1337=[_0x7bd377(0x215),_0x7bd377(0x216),_0x7bd377(0x204),_0x7bd377(0x217),_0x7bd377(0x1f0),_0x7bd377(0x212),_0x7bd377(0x1f9)];for(let _0x40b845=0x0;_0x40b845<_0x2d1337[_0x7bd377(0x1fb)];_0x40b845++){const _0x4f3c5b=a55_0xe2d22[_0x7bd377(0x1ef)][_0x7bd377(0x1fe)][_0x7bd377(0x205)](a55_0xe2d22),_0x12276f=_0x2d1337[_0x40b845],_0x1eb08f=_0x3e03c1[_0x12276f]||_0x4f3c5b;_0x4f3c5b[_0x7bd377(0x1ec)]=a55_0xe2d22[_0x7bd377(0x205)](a55_0xe2d22),_0x4f3c5b[_0x7bd377(0x1f1)]=_0x1eb08f[_0x7bd377(0x1f1)][_0x7bd377(0x205)](_0x1eb08f),_0x3e03c1[_0x12276f]=_0x4f3c5b;}});a55_0x44b631();import{db}from'../firebase-config.js';import{collection,doc,getDoc,getDocs,query,limit,startAfter,where,onSnapshot}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const cache={'userProfiles':new Map(),'ladderPlayers':new Map(),'matchResults':new Map(),'eloHistory':new Map()},CACHE_EXPIRY={'userProfiles':0x5*0x3c*0x3e8,'ladderPlayers':0x2*0x3c*0x3e8,'matchResults':0x1*0x3c*0x3e8,'eloHistory':0x3*0x3c*0x3e8};export const userProfilesRef=collection(db,a55_0x29b815(0x206));function a55_0x3a40(_0x31da40,_0xf0cba0){_0x31da40=_0x31da40-0x1eb;const _0x44b631=a55_0x4f14();let _0xe2d22=_0x44b631[_0x31da40];return _0xe2d22;}function a55_0x4f14(){const _0x55fd5f=['playersD3','__proto__','get','apply','constructor','exception','toString','eloHistoryD','timestamp','nonParticipants','forEach','push','playersD2','console','trace','doc','length','type','playersD','prototype','map','now','docChanges','exists','includes','info','bind','userProfiles','playerId','return\x20(function()\x20','{}.constructor(\x22return\x20this\x22)(\x20)','eloHistory','set','ladderPlayers','data','username','Error\x20fetching\x20batch\x20ELO\x20history:','division_','slice','table','players','docs','log','warn','error'];a55_0x4f14=function(){return _0x55fd5f;};return a55_0x4f14();}export async function fetchPaginatedData(_0x231ea1,_0x3ddad5=0xa,_0x420603=null){const _0x29bae4=a55_0x29b815;let _0x1c5a75=query(_0x231ea1,limit(_0x3ddad5));_0x420603&&(_0x1c5a75=query(_0x1c5a75,startAfter(_0x420603)));const _0x3fd61a=await getDocs(_0x1c5a75),_0x3ac34c=_0x3fd61a[_0x29bae4(0x214)][_0x3fd61a[_0x29bae4(0x214)][_0x29bae4(0x1fb)]-0x1];return{'data':_0x3fd61a[_0x29bae4(0x214)][_0x29bae4(0x1ff)](_0x49907e=>({'id':_0x49907e['id'],..._0x49907e[_0x29bae4(0x20d)]()})),'lastVisible':_0x3ac34c,'hasMore':_0x3fd61a[_0x29bae4(0x214)][_0x29bae4(0x1fb)]===_0x3ddad5};}export async function getUserProfile(_0x5c6c8e){const _0x53ec2c=a55_0x29b815,_0x4f0ced=cache[_0x53ec2c(0x206)][_0x53ec2c(0x1ed)](_0x5c6c8e);if(_0x4f0ced&&Date[_0x53ec2c(0x200)]()-_0x4f0ced[_0x53ec2c(0x1f3)]<CACHE_EXPIRY[_0x53ec2c(0x206)])return _0x4f0ced[_0x53ec2c(0x20d)];const _0x5e374c=await getDoc(doc(userProfilesRef,_0x5c6c8e));if(_0x5e374c[_0x53ec2c(0x202)]()){const _0x51380c=_0x5e374c[_0x53ec2c(0x20d)]();return cache[_0x53ec2c(0x206)][_0x53ec2c(0x20b)](_0x5c6c8e,{'data':_0x51380c,'timestamp':Date[_0x53ec2c(0x200)]()}),_0x51380c;}return null;}export async function getLadderData(_0x361554=0x1){const _0x1a7e67=a55_0x29b815,_0x2747b2=_0x1a7e67(0x210)+_0x361554,_0x414a97=cache[_0x1a7e67(0x20c)][_0x1a7e67(0x1ed)](_0x2747b2);if(_0x414a97&&Date[_0x1a7e67(0x200)]()-_0x414a97[_0x1a7e67(0x1f3)]<CACHE_EXPIRY[_0x1a7e67(0x20c)])return _0x414a97[_0x1a7e67(0x20d)];const _0x15fede=_0x361554===0x1?_0x1a7e67(0x213):_0x1a7e67(0x1fd)+_0x361554,_0x51c407=collection(db,_0x15fede),_0x5b49d4=await getDocs(query(_0x51c407,limit(0x64))),_0x2ecb28=_0x5b49d4[_0x1a7e67(0x214)][_0x1a7e67(0x1ff)](_0x28f564=>({'id':_0x28f564['id'],..._0x28f564[_0x1a7e67(0x20d)]()}));return cache[_0x1a7e67(0x20c)][_0x1a7e67(0x20b)](_0x2747b2,{'data':_0x2ecb28,'timestamp':Date[_0x1a7e67(0x200)]()}),_0x2ecb28;}export async function getEloHistoryBatch(_0x475fcd,_0x51d512=0x1){const _0x3b384d=a55_0x29b815,_0x4396fa=_0x51d512===0x1?_0x3b384d(0x20a):_0x3b384d(0x1f2)+_0x51d512,_0x20fa33=collection(db,_0x4396fa),_0x37702e={},_0x4aea42=[];_0x475fcd[_0x3b384d(0x1f5)](_0x418975=>{const _0x45ef2f=_0x3b384d,_0x1360a4=_0x418975+'_'+_0x51d512,_0x2ac8e8=cache[_0x45ef2f(0x20a)][_0x45ef2f(0x1ed)](_0x1360a4);_0x2ac8e8&&Date[_0x45ef2f(0x200)]()-_0x2ac8e8[_0x45ef2f(0x1f3)]<CACHE_EXPIRY[_0x45ef2f(0x20a)]?_0x37702e[_0x418975]=_0x2ac8e8[_0x45ef2f(0x20d)]:_0x4aea42[_0x45ef2f(0x1f6)](_0x418975);});const _0x271ad6=0xa;for(let _0x15c04b=0x0;_0x15c04b<_0x4aea42[_0x3b384d(0x1fb)];_0x15c04b+=_0x271ad6){const _0x58aeb3=_0x4aea42[_0x3b384d(0x211)](_0x15c04b,_0x15c04b+_0x271ad6);if(_0x58aeb3[_0x3b384d(0x1fb)]>0x0)try{const _0x188ae7=query(_0x20fa33,where(_0x3b384d(0x207),'in',_0x58aeb3),limit(0x64)),_0x1c19be=await getDocs(_0x188ae7);_0x1c19be[_0x3b384d(0x214)][_0x3b384d(0x1f5)](_0x343a3d=>{const _0x1c2878=_0x3b384d,_0x349f7d=_0x343a3d[_0x1c2878(0x20d)](),_0x176160=_0x349f7d[_0x1c2878(0x207)];if(!_0x37702e[_0x176160])_0x37702e[_0x176160]=[];_0x37702e[_0x176160][_0x1c2878(0x1f6)](_0x349f7d);const _0x5325dd=_0x176160+'_'+_0x51d512;cache[_0x1c2878(0x20a)][_0x1c2878(0x20b)](_0x5325dd,{'data':_0x37702e[_0x176160],'timestamp':Date[_0x1c2878(0x200)]()});});}catch(_0x312674){console[_0x3b384d(0x217)](_0x3b384d(0x20f),_0x312674);}}return _0x37702e;}let usernameCache=new Map(),usernameCacheTimestamp=Date[a55_0x29b815(0x200)]();export function setupEfficientListener(_0x583fdd,_0x2e8baa=[],_0xad7690){const _0x185df0=collection(db,_0x583fdd),_0x4396f6=query(_0x185df0,..._0x2e8baa),_0x574827=onSnapshot(_0x4396f6,_0x1eac51=>{const _0x5e5254=a55_0x3a40,_0x10fa47=_0x1eac51[_0x5e5254(0x201)]()[_0x5e5254(0x1ff)](_0x202d9e=>({'type':_0x202d9e[_0x5e5254(0x1fc)],'id':_0x202d9e[_0x5e5254(0x1fa)]['id'],'data':_0x202d9e[_0x5e5254(0x1fa)][_0x5e5254(0x20d)]()}));_0x10fa47[_0x5e5254(0x1fb)]>0x0&&_0xad7690(_0x10fa47,_0x1eac51[_0x5e5254(0x214)]);});return _0x574827;}export async function bulkResolveUsernames(_0x1cfe40){const _0x1cc9d3=a55_0x29b815,_0x286df7=new Map();if(!_0x1cfe40||_0x1cfe40[_0x1cc9d3(0x1fb)]===0x0)return _0x286df7;const _0x310fa7=[_0x1cc9d3(0x213),_0x1cc9d3(0x1f7),_0x1cc9d3(0x1eb),_0x1cc9d3(0x1f4)];for(const _0x11fe3d of _0x310fa7){const _0x3d1c96=collection(db,_0x11fe3d),_0xf70c6f=await getDocs(_0x3d1c96);_0xf70c6f[_0x1cc9d3(0x1f5)](_0x22424c=>{const _0x301f59=_0x1cc9d3,_0x1cccf2=_0x22424c[_0x301f59(0x20d)]();_0x1cccf2[_0x301f59(0x20e)]&&_0x1cfe40[_0x301f59(0x203)](_0x22424c['id'])&&_0x286df7[_0x301f59(0x20b)](_0x22424c['id'],_0x1cccf2[_0x301f59(0x20e)]);});}return _0x286df7;}
const a42_0x2c3cdd=a42_0x3040,a42_0x30dd39=(function(){let _0x3af732=!![];return function(_0x5b7de7,_0x124157){const _0x272bde=_0x3af732?function(){if(_0x124157){const _0x211cec=_0x124157['apply'](_0x5b7de7,arguments);return _0x124157=null,_0x211cec;}}:function(){};return _0x3af732=![],_0x272bde;};}()),a42_0x34d59e=a42_0x30dd39(this,function(){const _0x726ed5=a42_0x3040;let _0x5ef649;try{const _0x264d90=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x5ef649=_0x264d90();}catch(_0x330255){_0x5ef649=window;}const _0x333f8d=_0x5ef649['console']=_0x5ef649[_0x726ed5(0x116)]||{},_0x10daa8=['log','warn','info','error','exception','table','trace'];for(let _0x5e1965=0x0;_0x5e1965<_0x10daa8['length'];_0x5e1965++){const _0x4c6c7d=a42_0x30dd39['constructor']['prototype'][_0x726ed5(0x134)](a42_0x30dd39),_0x3e4cde=_0x10daa8[_0x5e1965],_0x38ad51=_0x333f8d[_0x3e4cde]||_0x4c6c7d;_0x4c6c7d['__proto__']=a42_0x30dd39[_0x726ed5(0x134)](a42_0x30dd39),_0x4c6c7d['toString']=_0x38ad51['toString']['bind'](_0x38ad51),_0x333f8d[_0x3e4cde]=_0x4c6c7d;}});a42_0x34d59e();function a42_0x4215(){const _0x537e56=['textContent','promotion',')\x20→\x20','Promotion\x20','split','currentUser','fetchRecentPromotions','player','console','showRankChangeLightbox','title','exists','toMillis','newRank','\x27s\x20','getElementById','\x20for\x20','loserId','Don\x27t\x20show\x20again','Invalid\x20storage\x20format\x20for\x20','test','demotion','parentNode','stringify','docs','userDismissed','setupBannerContainer','Gold','\x20→\x20','display','username','\x20was\x20promoted\x20to','remove','includes','seconds','</span>','error','isAutomatic','bind','dismiss-btn','now','visible','new-rank-change','getItem','none','RANKS','lastFetchTime','DISPLAY_HOURS','data-rank','children','innerHTML','ignored','data','bannerContainer','resolvedName','#C0C0C0','addEventListener','setAttribute','setItem','&times;','length','\x20hours','You\x27ve\x20been\x20promoted\x20to','loserUsername','div','appendChild','DOMContentLoaded','block','winnerUsername','modifiedBy','click','source','log','approvedMatches','winnerId','date','adminUser','then','type','ladder','Error\x20writing\x20promotion\x20records:','timestamp','classList','set','createElement','displayName','eloHistory','#50C878'];a42_0x4215=function(){return _0x537e56;};return a42_0x4215();}import{collection,doc,query,where,orderBy,limit,getDocs,addDoc,getDoc,serverTimestamp,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{auth,db}from'./firebase-config.js';class PromotionManager{constructor(){const _0x5f56cc=a42_0x3040;this['DISPLAY_HOURS']=0x18,this['RANKS']=[{'threshold':0x578,'name':'Bronze','color':'#CD7F32'},{'threshold':0x640,'name':'Silver','color':_0x5f56cc(0x145)},{'threshold':0x708,'name':_0x5f56cc(0x129),'color':'#FFD700'},{'threshold':0x834,'name':'Emerald','color':_0x5f56cc(0x165)}],this[_0x5f56cc(0x143)]=null,this[_0x5f56cc(0x13c)]=0x0,this['fetchInterval']=0xea60,this['pollingInterval']=null,this['usernameCache']={};}['initialize'](){const _0x171adc=a42_0x3040;this['bannerContainer']=document['getElementById']('promotion-banner-container');if(!this['bannerContainer']){console['error']('Promotion\x20banner\x20container\x20not\x20found');return;}this[_0x171adc(0x128)]();const _0x149ced='promotions_checked_'+new Date()['toDateString'](),_0x4e63a7=sessionStorage[_0x171adc(0x139)](_0x149ced);!_0x4e63a7&&(this['fetchRecentPromotions'](),sessionStorage['setItem'](_0x149ced,'true')),document['addEventListener']('visibilitychange',()=>{const _0x55ac1a=_0x171adc;document['visibilityState']===_0x55ac1a(0x137)&&!sessionStorage['getItem'](_0x149ced)&&(this['fetchRecentPromotions'](),sessionStorage[_0x55ac1a(0x148)](_0x149ced,'true'));}),window['addEventListener']('beforeunload',()=>{this['pollingInterval']&&clearInterval(this['pollingInterval']);});}['setupBannerContainer'](){const _0x52ae54=a42_0x3040;this[_0x52ae54(0x143)]['innerHTML']='',this['bannerContainer']['style']['display']='none';}async[a42_0x2c3cdd(0x114)](){const _0x6b3d7f=a42_0x2c3cdd;try{const _0x485acc=Date['now']();if(_0x485acc-this['lastFetchTime']<this['fetchInterval'])return;this['lastFetchTime']=_0x485acc;const _0x33f01f=collection(db,'eloHistory'),_0x43c328=query(_0x33f01f,where('type','in',[_0x6b3d7f(0x10f),'demotion']),orderBy('timestamp','desc'),limit(0x14)),_0x3f5c19=await getDocs(_0x43c328),_0x1f6287=[];_0x3f5c19['forEach'](_0x526907=>{const _0x4c9c6b={'id':_0x526907['id'],..._0x526907['data']()};this['shouldShowPromotion'](_0x526907['id'])&&this['isNewRankChange'](_0x4c9c6b)&&_0x1f6287['push'](_0x4c9c6b);}),_0x1f6287[_0x6b3d7f(0x14a)]>0x0&&await this['processRankChanges'](_0x1f6287);}catch(_0x76a945){console['error']('Error\x20fetching\x20promotions:',_0x76a945);}}async['processRankChanges'](_0x20acd3){const _0x41c82f=a42_0x2c3cdd;if(_0x20acd3['length']===0x0)return;_0x20acd3['sort']((_0xa9a257,_0x135651)=>{const _0x2f7c2d=a42_0x3040,_0x8b6516=_0xa9a257['timestamp']?.[_0x2f7c2d(0x11a)]?.()||_0xa9a257['timestamp']?.['seconds']*0x3e8||0x0,_0x3d60de=_0x135651['timestamp']?.['toMillis']?.()||_0x135651[_0x2f7c2d(0x15f)]?.[_0x2f7c2d(0x130)]*0x3e8||0x0;return _0x3d60de-_0x8b6516;});const _0x16f142=this['bannerContainer']['children'][_0x41c82f(0x14a)],_0x3c0e20=0x3-_0x16f142;if(_0x3c0e20<=0x0)return;const _0x4e925e=_0x20acd3['slice'](0x0,_0x3c0e20);for(let _0xb5b780=0x0;_0xb5b780<_0x4e925e['length'];_0xb5b780++){const _0x3093ff=_0x4e925e[_0xb5b780],_0x44e832=auth[_0x41c82f(0x113)];try{setTimeout(()=>{this['showRankChangeBanner'](_0x3093ff);},_0xb5b780*0x3e8),_0x44e832&&_0x3093ff['player']===_0x44e832['displayName']&&this[_0x41c82f(0x117)](_0x3093ff['type'],_0x3093ff['rankAchieved']);}catch(_0x1e383f){console['error']('Error\x20processing\x20rank\x20change:',_0x1e383f);}}}['shouldShowPromotion'](_0x19f6e8){const _0xf926ff=a42_0x2c3cdd;try{const _0x3430e0='promotion_'+_0x19f6e8,_0x28ca79=localStorage['getItem'](_0x3430e0);if(_0x28ca79){let _0x37822b;try{_0x37822b=JSON['parse'](_0x28ca79);}catch(_0x4941a0){return console['warn'](_0xf926ff(0x121)+_0x3430e0+',\x20treating\x20as\x20new'),!![];}if(_0x37822b[_0xf926ff(0x141)]===!![])return console['log'](_0xf926ff(0x111)+_0x19f6e8+'\x20is\x20permanently\x20ignored'),![];const _0x514305=Date['now']();if(_0x37822b[_0xf926ff(0x127)]&&_0x514305-_0x37822b[_0xf926ff(0x15f)]<this[_0xf926ff(0x13d)]*0x3c*0x3c*0x3e8)return console['log']('Promotion\x20'+_0x19f6e8+'\x20was\x20dismissed\x20by\x20user\x20within\x20last\x20'+this['DISPLAY_HOURS']+_0xf926ff(0x14b)),![];if(_0x37822b['systemDismissed']&&_0x514305-_0x37822b['timestamp']<0x4*0x3c*0x3c*0x3e8)return console['log']('Promotion\x20'+_0x19f6e8+'\x20was\x20auto-dismissed\x20within\x20last\x204\x20hours'),![];}return!![];}catch(_0x23ea8a){return console['error']('Error\x20checking\x20promotion\x20visibility:',_0x23ea8a),![];}}['ignorePromotion'](_0x5b01bf){const _0xd58f2f=a42_0x2c3cdd;try{const _0x3ad979='promotion_'+_0x5b01bf;localStorage['setItem'](_0x3ad979,JSON['stringify']({'timestamp':Date[_0xd58f2f(0x136)](),'ignored':!![]}));}catch(_0x1fe5f5){console['error']('Error\x20saving\x20promotion\x20preference:',_0x1fe5f5);}}['showRankChangeBanner'](_0x202567){const _0x45e0df=a42_0x2c3cdd;this['resolveUserId'](_0x202567)[_0x45e0df(0x15b)](_0x57aa24=>{const _0x4ac159=_0x45e0df,_0x45d97c='promotion_'+_0x202567['id'],_0x48b591=localStorage['getItem'](_0x45d97c);if(_0x48b591)try{const _0x2ecb60=JSON['parse'](_0x48b591);if(_0x2ecb60['ignored']===!![]){console[_0x4ac159(0x156)]('Skipping\x20ignored\x20promotion:\x20'+_0x202567['id']);return;}}catch(_0x10cf0a){}localStorage['setItem'](_0x45d97c,JSON['stringify']({'timestamp':Date[_0x4ac159(0x136)](),'ignored':![],'userDismissed':![],'systemDismissed':![],'seenAt':Date[_0x4ac159(0x136)]()})),this[_0x4ac159(0x143)]['style'][_0x4ac159(0x12b)]=_0x4ac159(0x151);while(this['bannerContainer']['children'][_0x4ac159(0x14a)]>=0x3){this['bannerContainer']['removeChild'](this['bannerContainer']['firstChild']);}const _0x164d4f=document[_0x4ac159(0x162)](_0x4ac159(0x14e));_0x164d4f['className']='promotion-banner',_0x164d4f['setAttribute'](_0x4ac159(0x13e),_0x57aa24['rankAchieved']),_0x164d4f[_0x4ac159(0x147)]('data-id',_0x57aa24['id']);const _0x22927a=document['createElement'](_0x4ac159(0x14e));_0x22927a['className']='promotion-details';const _0xde0a6c=_0x57aa24['resolvedName']||_0x57aa24[_0x4ac159(0x115)]||_0x57aa24['username']||_0x57aa24['playerUsername']||_0x57aa24['displayName']||'A\x20player',_0x15a014=_0x57aa24[_0x4ac159(0x15c)]==='promotion'?_0xde0a6c+_0x4ac159(0x12d):_0xde0a6c+'\x20was\x20demoted\x20to';_0x22927a['innerHTML']=_0x15a014+'\x20<span\x20class=\x22rank-text\x22>'+_0x57aa24['rankAchieved']+_0x4ac159(0x131);const _0x31b912=document['createElement']('div');_0x31b912['className']='banner-actions';const _0x48afe9=document[_0x4ac159(0x162)]('button');_0x48afe9['className']=_0x4ac159(0x135),_0x48afe9['innerHTML']=_0x4ac159(0x149),_0x48afe9[_0x4ac159(0x118)]='Dismiss';const _0x326a38=document['createElement']('button');_0x326a38['className']='ignore-btn',_0x326a38[_0x4ac159(0x10e)]=_0x4ac159(0x120),_0x326a38['title']='Never\x20show\x20this\x20promotion\x20again',_0x31b912[_0x4ac159(0x14f)](_0x326a38),_0x31b912[_0x4ac159(0x14f)](_0x48afe9),_0x164d4f['appendChild'](_0x22927a),_0x164d4f['appendChild'](_0x31b912),this['bannerContainer']['appendChild'](_0x164d4f),void _0x164d4f['offsetWidth'],setTimeout(()=>{const _0x56a24f=_0x4ac159;_0x164d4f['classList']['add'](_0x56a24f(0x138));},0x32),_0x48afe9['addEventListener']('click',()=>{const _0x5e413d=_0x4ac159;localStorage[_0x5e413d(0x148)](_0x45d97c,JSON[_0x5e413d(0x125)]({'timestamp':Date['now'](),'ignored':![],'userDismissed':!![],'systemDismissed':![]})),_0x164d4f['classList']['remove'](_0x5e413d(0x138)),_0x164d4f['classList']['add']('dismissing'),setTimeout(()=>{const _0x5792c6=_0x5e413d;_0x164d4f['parentNode']&&(_0x164d4f[_0x5792c6(0x12e)](),this[_0x5792c6(0x143)][_0x5792c6(0x13f)][_0x5792c6(0x14a)]===0x0&&(this['bannerContainer']['style'][_0x5792c6(0x12b)]=_0x5792c6(0x13a)));},0x1f4);}),_0x326a38['addEventListener']('click',()=>{const _0x152af8=_0x4ac159;localStorage[_0x152af8(0x148)](_0x45d97c,JSON[_0x152af8(0x125)]({'timestamp':Date[_0x152af8(0x136)](),'ignored':!![],'userDismissed':!![],'systemDismissed':![]})),_0x164d4f['classList']['remove'](_0x152af8(0x138)),_0x164d4f['classList']['add']('dismissing'),setTimeout(()=>{const _0x55aa1c=_0x152af8;_0x164d4f['parentNode']&&(_0x164d4f['remove'](),this['bannerContainer'][_0x55aa1c(0x13f)]['length']===0x0&&(this['bannerContainer']['style'][_0x55aa1c(0x12b)]='none'));},0x1f4);}),setTimeout(()=>{const _0xd69467=_0x4ac159;_0x164d4f['parentNode']&&(_0x164d4f[_0xd69467(0x160)]['remove']('new-rank-change'),_0x164d4f['classList']['add']('dismissing'),localStorage[_0xd69467(0x148)](_0x45d97c,JSON['stringify']({'timestamp':Date[_0xd69467(0x136)](),'ignored':![],'userDismissed':![],'systemDismissed':!![]})),setTimeout(()=>{const _0x57c769=_0xd69467;_0x164d4f[_0x57c769(0x124)]&&(_0x164d4f[_0x57c769(0x12e)](),this['bannerContainer']['children'][_0x57c769(0x14a)]===0x0&&(this['bannerContainer']['style'][_0x57c769(0x12b)]='none'));},0x1f4));},0x3a98);});}async['resolveUserId'](_0x4168fc){const _0x15481d=a42_0x2c3cdd,_0x585761={..._0x4168fc},_0x56dbb4=[_0x4168fc['player'],_0x4168fc['username'],_0x4168fc['playerUsername'],_0x4168fc[_0x15481d(0x163)]],_0x23d547=_0x56dbb4['some'](_0x4b3355=>_0x4b3355&&typeof _0x4b3355==='string'&&!_0x4b3355[_0x15481d(0x12f)]('ID:')&&!/^[a-zA-Z0-9]{20,}$/[_0x15481d(0x122)](_0x4b3355));if(_0x23d547)return _0x585761;let _0x45529b=null;if(_0x4168fc['userId'])_0x45529b=_0x4168fc['userId'];else _0x4168fc['player']&&/^[A-Za-z0-9]{20,}$/['test'](_0x4168fc[_0x15481d(0x115)])&&(_0x45529b=_0x4168fc['player']);if(!_0x45529b)return _0x585761;try{const _0x4ac8e4=await getDoc(doc(db,'players',_0x45529b));if(_0x4ac8e4['exists']()){const _0x2f1f07=_0x4ac8e4['data']();if(_0x2f1f07[_0x15481d(0x12c)])return _0x585761['resolvedName']=_0x2f1f07[_0x15481d(0x12c)],_0x585761;}const _0x431766=await getDocs(query(collection(db,'approvedMatches'),where('winnerId','==',_0x45529b),orderBy(_0x15481d(0x159),'desc'),limit(0x1)));if(!_0x431766['empty']){const _0x4b0866=_0x431766[_0x15481d(0x126)][0x0]['data']();if(_0x4b0866[_0x15481d(0x152)])return _0x585761['resolvedName']=_0x4b0866['winnerUsername'],_0x585761;}const _0x1bfed8=await getDocs(query(collection(db,_0x15481d(0x157)),where(_0x15481d(0x11f),'==',_0x45529b),orderBy('date','desc'),limit(0x1)));if(!_0x1bfed8['empty']){const _0x4c6aeb=_0x1bfed8[_0x15481d(0x126)][0x0]['data']();if(_0x4c6aeb[_0x15481d(0x14d)])return _0x585761[_0x15481d(0x144)]=_0x4c6aeb['loserUsername'],console['log']('Resolved\x20'+_0x45529b+'\x20to\x20'+_0x4c6aeb['loserUsername']+'\x20(loser)'),_0x585761;}}catch(_0x1b38ba){console[_0x15481d(0x132)]('Error\x20resolving\x20user\x20ID:',_0x1b38ba);}return console['warn']('Failed\x20to\x20resolve\x20user\x20ID:\x20'+_0x45529b),_0x585761;}[a42_0x2c3cdd(0x117)](_0x353622,_0x2582f3){const _0x5967cd=a42_0x2c3cdd;let _0x81dede=document[_0x5967cd(0x11d)]('rankChangeModal');!_0x81dede&&(_0x81dede=document['createElement']('div'),_0x81dede['id']='rankChangeModal',_0x81dede['className']='rank-change-modal\x20'+_0x353622,document['body']['appendChild'](_0x81dede));const _0x460e2a=_0x353622===_0x5967cd(0x10f)?'Congratulations!':'Rank\x20Update',_0x56e0a5=_0x353622===_0x5967cd(0x10f)?_0x5967cd(0x14c):'You\x27ve\x20been\x20demoted\x20to';_0x81dede[_0x5967cd(0x140)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rank-change-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2\x20class=\x22rank-change-title\x22>'+_0x460e2a+'</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>'+_0x56e0a5+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22rank-name\x22>'+_0x2582f3+'</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22rank-change-button\x22\x20id=\x22rank-change-ok-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Got\x20it!\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x81dede['style'][_0x5967cd(0x12b)]='flex',document[_0x5967cd(0x11d)]('rank-change-ok-btn')[_0x5967cd(0x146)]('click',()=>{const _0x520e2f=_0x5967cd;_0x81dede['style']['display']=_0x520e2f(0x13a);}),_0x81dede['addEventListener'](_0x5967cd(0x154),_0xaf3e0f=>{_0xaf3e0f['target']===_0x81dede&&(_0x81dede['style']['display']='none');});}async['checkAndRecordPromotion'](_0x5c9e65,_0x4b2b59,_0x3afd20,_0x3c60dd={}){const _0x20b042=a42_0x2c3cdd;try{if(_0x4b2b59===_0x3afd20||!_0x5c9e65)return null;const _0x59823e=_0x3c60dd[_0x20b042(0x155)]||'automatic',_0x315e26=_0x3c60dd['matchId']||null,_0x5cd136=_0x3c60dd['adminUser']||null;console['log']('Processing\x20potential\x20rank\x20change:\x20'+_0x3afd20+_0x20b042(0x12a)+_0x4b2b59+'\x20(source:\x20'+_0x59823e+')');let _0x369d34=null,_0x4aa574=null;try{const _0x3ea155=await getDoc(doc(db,'players',_0x5c9e65));if(_0x3ea155[_0x20b042(0x119)]()){const _0x2585ac=_0x3ea155['data']();_0x369d34=_0x2585ac[_0x20b042(0x12c)]||_0x2585ac[_0x20b042(0x163)]||null,_0x4aa574=_0x2585ac[_0x20b042(0x163)]||_0x2585ac['username']||null;}!_0x369d34&&_0x3c60dd['username']&&(_0x369d34=_0x3c60dd['username'],_0x4aa574=_0x3c60dd['username']);!_0x369d34&&auth[_0x20b042(0x113)]&&(_0x369d34=auth[_0x20b042(0x113)]['displayName']||auth[_0x20b042(0x113)]['email'][_0x20b042(0x112)]('@')[0x0],_0x4aa574=auth['currentUser'][_0x20b042(0x163)]||null);if(!_0x369d34){const _0x35ad44=query(collection(db,'approvedMatches'),where(_0x20b042(0x158),'==',_0x5c9e65),limit(0x1)),_0x517494=await getDocs(_0x35ad44);if(!_0x517494['empty'])_0x369d34=_0x517494['docs'][0x0][_0x20b042(0x142)]()['winnerUsername']||'Unknown\x20Player',_0x4aa574=_0x369d34;else{const _0x4fa4c5=query(collection(db,'approvedMatches'),where(_0x20b042(0x11f),'==',_0x5c9e65),limit(0x1)),_0x1a9b18=await getDocs(_0x4fa4c5);!_0x1a9b18['empty']&&(_0x369d34=_0x1a9b18[0x0]['data']()['loserUsername']||'Unknown\x20Player',_0x4aa574=_0x369d34);}}}catch(_0x57da46){console[_0x20b042(0x132)]('Error\x20resolving\x20username:',_0x57da46);}!_0x369d34&&(console['warn']('Could\x20not\x20resolve\x20username\x20for\x20userId:',_0x5c9e65),_0x369d34='A\x20player',_0x4aa574='Unknown\x20Player');const _0x101115=this['getRankName'](_0x3afd20),_0x8b59e7=this['getRankName'](_0x4b2b59);if(_0x101115!==_0x8b59e7){const _0x46ff3b=_0x4b2b59>_0x3afd20,_0x5371e1=_0x46ff3b?'promotion':_0x20b042(0x123),_0xcfa11a=_0x8b59e7;console[_0x20b042(0x156)]('Recording\x20'+_0x5371e1+_0x20b042(0x11e)+_0x369d34+':\x20'+_0x3afd20+'\x20('+_0x101115+_0x20b042(0x110)+_0x4b2b59+'\x20('+_0x8b59e7+')');try{const _0x4058d3={'player':_0x369d34,'playerUsername':_0x369d34,'username':_0x369d34,'displayName':_0x4aa574,'userId':_0x5c9e65,'type':_0x5371e1,'rankAchieved':_0xcfa11a,'timestamp':serverTimestamp(),'previousElo':_0x3afd20,'newElo':_0x4b2b59,'change':_0x4b2b59-_0x3afd20,'previousRank':_0x101115,'newRank':_0x8b59e7,'source':_0x59823e};if(_0x59823e==='match'&&_0x315e26)_0x4058d3['matchId']=_0x315e26;else _0x59823e==='admin'&&_0x5cd136?(_0x4058d3[_0x20b042(0x153)]=_0x5cd136,_0x4058d3['isAutomatic']=![]):_0x4058d3[_0x20b042(0x133)]=!![];const _0x370a54=writeBatch(db),_0x4e71aa=doc(collection(db,'eloHistory')),_0x581ff4=doc(collection(db,'promotionHistory'));return _0x370a54['set'](_0x4e71aa,_0x4058d3),_0x370a54[_0x20b042(0x161)](_0x581ff4,_0x4058d3),await _0x370a54['commit'](),await this['sendPromotionNotification'](_0x5c9e65,_0x369d34,_0x3afd20,_0x4b2b59,_0x101115,_0x8b59e7,_0x5371e1,{'displayName':_0x4aa574,'source':_0x59823e,'matchId':_0x315e26,'ladder':_0x3c60dd[_0x20b042(0x15d)]||'D1'}),console['log']('Successfully\x20recorded\x20'+_0x5371e1+'\x20for\x20'+_0x369d34+'\x20to\x20'+_0xcfa11a),_0xcfa11a;}catch(_0x1baa3c){console['error'](_0x20b042(0x15e),_0x1baa3c);try{return await addDoc(collection(db,_0x20b042(0x164)),{'player':_0x369d34,'playerUsername':_0x369d34,'username':_0x369d34,'displayName':_0x4aa574,'userId':_0x5c9e65,'type':_0x5371e1,'rankAchieved':_0xcfa11a,'timestamp':serverTimestamp(),'previousElo':_0x3afd20,'newElo':_0x4b2b59,'change':_0x4b2b59-_0x3afd20,'previousRank':_0x101115,'source':_0x59823e,'isAutomatic':_0x59823e!=='admin'}),await this['sendPromotionNotification'](_0x5c9e65,_0x369d34,_0x3afd20,_0x4b2b59,_0x101115,_0x8b59e7,_0x5371e1,{'displayName':_0x4aa574,'source':_0x59823e,'matchId':_0x315e26,'ladder':_0x3c60dd['ladder']||'D1'}),_0xcfa11a;}catch(_0x16f935){return console['error']('Fallback\x20write\x20failed:',_0x16f935),null;}}}return null;}catch(_0x580be1){return console['error']('Error\x20in\x20promotion/demotion\x20recording:',_0x580be1),null;}}['getRankName'](_0x5bc055){const _0x1acca3=a42_0x2c3cdd;for(let _0x3ff594=this[_0x1acca3(0x13b)]['length']-0x1;_0x3ff594>=0x0;_0x3ff594--){if(_0x5bc055>=this['RANKS'][_0x3ff594]['threshold'])return this['RANKS'][_0x3ff594]['name'];}return'Unranked';}['cleanup'](){this['pollingInterval']&&clearInterval(this['pollingInterval']);}['isNewRankChange'](_0xa9d7c3){const _0x184918=a42_0x2c3cdd;if(_0xa9d7c3['timestamp']){const _0x4f5582=_0xa9d7c3[_0x184918(0x15f)]['seconds']*0x3e8,_0x4bf719=Date['now'](),_0x36f0b2=(_0x4bf719-_0x4f5582)/(0x3e8*0x3c*0x3c);if(_0x36f0b2>0x18)return![];}if(_0xa9d7c3['previousRank']&&_0xa9d7c3[_0x184918(0x11b)]&&_0xa9d7c3['previousRank']!==_0xa9d7c3[_0x184918(0x11b)])return!![];return![];}async['sendPromotionNotification'](_0x1d04a5,_0x3332b0,_0x201ea7,_0x247300,_0x3c6265,_0x398689,_0x163af2,_0x1686b9={}){const _0x2fabfb=a42_0x2c3cdd;try{console['log']('STARTING\x20notification\x20for\x20'+_0x3332b0+_0x2fabfb(0x11c)+_0x163af2);const _0x59215f={'userId':_0x1d04a5,'username':_0x3332b0,'displayName':_0x1686b9['displayName']||_0x3332b0,'oldElo':parseInt(_0x201ea7),'newElo':parseInt(_0x247300),'eloDifference':parseInt(_0x247300)-parseInt(_0x201ea7),'oldRank':_0x3c6265,'newRank':_0x398689,'type':_0x163af2,'timestamp':serverTimestamp(),'processed':![],'source':_0x1686b9['source']||'automatic','matchId':_0x1686b9['matchId']||null,'ladder':_0x1686b9['ladder']||'D1','adminUser':_0x1686b9[_0x2fabfb(0x15a)]||null};console['log']('Creating\x20Discord\x20notification:',_0x59215f);const _0x16f6d0=await addDoc(collection(db,'promotionNotifications'),_0x59215f);return console['log']('Discord\x20notification\x20sent\x20successfully\x20with\x20ID:\x20'+_0x16f6d0['id']),!![];}catch(_0x1fd8d8){return console['error']('Error\x20sending\x20Discord\x20notification:',_0x1fd8d8),![];}}}function a42_0x3040(_0x1ef9ed,_0x813324){const _0x34d59e=a42_0x4215();return a42_0x3040=function(_0x30dd39,_0x2f26c1){_0x30dd39=_0x30dd39-0x10e;let _0x421567=_0x34d59e[_0x30dd39];return _0x421567;},a42_0x3040(_0x1ef9ed,_0x813324);}export const promotionManager=new PromotionManager();document[a42_0x2c3cdd(0x146)](a42_0x2c3cdd(0x150),()=>{promotionManager['initialize']();});export const initializePromotionTracker=()=>promotionManager['initialize']();export const checkAndRecordPromotion=(_0x4b1112,_0x3ffc55,_0x24eedb,_0x18bb09)=>promotionManager['checkAndRecordPromotion'](_0x4b1112,_0x3ffc55,_0x24eedb,_0x18bb09);export const getRankName=_0x4fe37e=>promotionManager['getRankName'](_0x4fe37e);
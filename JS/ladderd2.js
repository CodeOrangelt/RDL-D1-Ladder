(function(a,b){const t=a32b,c=a();while(!![]){try{const d=-parseInt(t(0xfc))/0x1+-parseInt(t(0xf3))/0x2+parseInt(t(0x12b))/0x3+parseInt(t(0x138))/0x4+parseInt(t(0x10c))/0x5+-parseInt(t(0x134))/0x6+-parseInt(t(0x128))/0x7;if(d===b)break;else c['push'](c['shift']());}catch(e){c['push'](c['shift']());}}}(a32a,0xc92ef));import{collection,getDocs,deleteDoc,doc,getDoc,query,where,updateDoc,Timestamp,onSnapshot,orderBy,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import{getRankStyle}from'./ranks.js';import a32c from'./firebase-idle-wrapper.js';const playerCacheD2={'data':null,'timestamp':0x0},CACHE_DURATION=0x7530;async function displayLadderD2(a=![]){const u=a32b,b=document[u(0x10d)](u(0x113));if(!b){console['error'](u(0xfa));return;}b['innerHTML']=u(0xf4);try{const c=Date['now']();if(!a&&playerCacheD2[u(0x100)]&&c-playerCacheD2[u(0xf8)]<CACHE_DURATION){updateLadderDisplayD2(playerCacheD2[u(0x100)]);return;}const d=collection(db,u(0xe1)),e=query(d,orderBy('position',u(0x11b))),f=await a32c['getDocuments'](d),g=[];f['forEach'](m=>{const v=u,n=m[v(0x100)]();n[v(0x117)]&&g['push']({...n,'id':m['id'],'elo':n[v(0x121)]||0x0,'position':n['position']||Number[v(0x112)]});});const h=collection(db,'userProfiles'),i=await getDocs(h),j=new Map();i[u(0x129)](m=>{const w=u,n=m[w(0x100)]();n[w(0x117)]&&j[w(0x126)](n['username']['toLowerCase'](),n);});for(const m of g){const n=m['username']['toLowerCase']();if(j['has'](n)){const o=j['get'](n);o[u(0xe3)]&&(m[u(0xe3)]=o[u(0xe3)][u(0x127)]());}}const k=g[u(0x122)](q=>q[u(0x117)]),l=await fetchBatchMatchStatsD2(k);g['sort']((p,q)=>{const x=u,r=l['get'](p['username'])?.[x(0xfb)]||0x0,s=l[x(0x137)](q[x(0x117)])?.['totalMatches']||0x0;if(r===0x0!==(s===0x0))return r===0x0?0x1:-0x1;return(p[x(0x108)]||0x3e7)-(q['position']||0x3e7);}),g['forEach']((p,q)=>{p['position']=q+0x1;}),playerCacheD2[u(0x100)]=g,playerCacheD2[u(0xf8)]=c,updateLadderDisplayD2(g);}catch(p){console['error'](u(0x118),p),b[u(0xee)]=u(0x12e)+p[u(0x10b)]+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';}}function getNextAvailablePositionD2(a){if(a['length']===0x0)return 0x1;let b=0x0;return a['forEach'](c=>{const y=a32b;c['position']&&typeof c[y(0x108)]==='number'&&c[y(0x108)]>b&&(b=c['position']);}),b+0x1;}async function updatePlayerPositions(a,b){const z=a32b;try{const c=collection(db,z(0xe1)),d=await getDocs(c),e=[];d['forEach'](h=>{const A=z;e[A(0x107)]({'id':h['id'],...h['data']()});});const f=e[z(0x119)](h=>h['username']===a),g=e['find'](h=>h['username']===b);if(!f||!g){console['error'](z(0xea));return;}if(f['position']>g[z(0x108)]){const h=g['position'];for(const i of e){i[z(0x108)]>=g['position']&&i[z(0x108)]<f[z(0x108)]&&i[z(0x117)]!==a&&await updateDoc(doc(db,'playersD2',i['id']),{'position':i['position']+0x1});}await updateDoc(doc(db,z(0xe1),f['id']),{'position':h});if(h===0x1){const j=doc(db,z(0xe1),f['id']),k=await getDoc(j);!k['data']()['firstPlaceDate']&&await updateDoc(j,{'firstPlaceDate':Timestamp['now']()});}if(g[z(0x108)]===0x1){const l=doc(db,z(0xe1),g['id']);await updateDoc(l,{'firstPlaceDate':null});}playerCacheD2['timestamp']=0x0;}}catch(m){console[z(0x12c)](z(0x139),m);}}function a32b(a,b){const c=a32a();return a32b=function(d,e){d=d-0xdc;let f=c[d];if(a32b['JFUPty']===undefined){var g=function(l){const m='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let n='',o='';for(let p=0x0,q,r,s=0x0;r=l['charAt'](s++);~r&&(q=p%0x4?q*0x40+r:r,p++%0x4)?n+=String['fromCharCode'](0xff&q>>(-0x2*p&0x6)):0x0){r=m['indexOf'](r);}for(let t=0x0,u=n['length'];t<u;t++){o+='%'+('00'+n['charCodeAt'](t)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(o);};a32b['AGRGgj']=g,a=arguments,a32b['JFUPty']=!![];}const h=c[0x0],i=d+h,j=a[i];return!j?(f=a32b['AGRGgj'](f),a[i]=f):f=j,f;},a32b(a,b);}function calculateStreakDays(a){const B=a32b;if(!a)return 0x0;const b=a[B(0xe4)](),c=new Date(),d=Math[B(0xfd)](c-b);return Math[B(0x125)](d/(0x3e8*0x3c*0x3c*0x18));}function getPlayerRankNameD2(a){const C=a32b;if(a>=0x834)return C(0x12d);if(a>=0x708)return C(0x101);if(a>=0x640)return'Silver';if(a>=0x578)return'Bronze';return C(0xf6);}async function updateLadderDisplayD2(a){const D=a32b;a[D(0xed)]((g,h)=>g['position']-h['position']);const b=document[D(0x10d)]('#ladder-d2\x20tbody');if(!b)return;b[D(0xee)]='';const c=a[D(0x122)](g=>g['username']),d=await fetchBatchMatchStatsD2(c),e=document['querySelector']('#ladder-d2\x20thead\x20tr');e&&(e['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Rank</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Username</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>ELO</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Matches</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Wins</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Losses</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>K/D</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Win\x20Rate</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20');const f=a['map'](g=>{const E=D,h=d[E(0x137)](g[E(0x117)])||{'totalMatches':0x0,'wins':0x0,'losses':0x0,'kda':0x0,'winRate':0x0,'totalKills':0x0,'totalDeaths':0x0};return createPlayerRowD2(g,h);})['join']('');b['innerHTML']=f,getPlayersLastEloChangesD2(c)[D(0xe2)](g=>{const F=D,h=new Map();b[F(0x116)]('tr')[F(0x129)]((i,j)=>{const G=F;j<c[G(0x106)]&&h[G(0x126)](c[j],i);}),g[F(0x129)]((i,j)=>{const H=F,k=h['get'](j);if(k&&i!==0x0){const l=k[H(0x10d)](H(0xe0));if(l){const m=i>0x0?'+'+i:''+i,n=l['querySelector'](H(0x131));n&&(n[H(0x11a)]=m,n[H(0x130)]['color']=i>0x0?'#4CAF50':'#F44336',n[H(0x130)][H(0xf0)]='bold',n[H(0x130)][H(0x123)]='0.85em',n[H(0x130)][H(0x11d)]=H(0x12f),n['style'][H(0xf1)]='visible',n[H(0x130)]['opacity']='1');}}});})[D(0xe9)](g=>console['error'](D(0x10f),g));}function a32a(){const R=['DgHLBG','y291BNrYEq','Dg9eyxrL','Dg90ywXezwf0Ahm','CgXHEwvY','Dg90ywXlAwXSCW','D2LUBMvYu2nVCMu','y2f0y2G','q291BgqGBM90igzPBMqGD2LUBMvYig9YigXVC2vYigLUieqYihbSyxLLCNmGBgLZDa','iZuWqZG3oa','yxbWCM92zwrnyxrJAgvZrdi','C29YDa','Aw5Uzxjive1m','i0nen0yZmG','zM9UDfDLAwDODa','DMLZAwjPBgL0Eq','Aw5JBhvKzxm','mJu1nZC4mgL6CfLjvW','phrYpJX0zcbJB2XZCgfUpsi4iIbJBgfZCZ0IBg9HzgLUzY1JzwXSiJ5mB2fKAw5NieqYigXHzgrLCIbKyxrHlI4Upc90zd48l3rYpG','cIaGica8Dhi+cIaGicaGicaGphrKpG','vw5Yyw5Rzwq','cIaGicaGicaGicaGidWVzgL2pGOGicaGicaGidWVDgq+cIaGicaGicaGphrKihn0EwXLpsjJB2XVCJOG','DgLTzxn0yw1W','C2vJB25KCW','rdiGtgfKzgvYihrHyMXLigjVzhKGBM90igzVDw5K','Dg90ywXnyxrJAgvZ','otCYmJu4yM9kAfDZ','ywjZ','iIakicaGicaGicaGicaGicaGicaGicaGicaGy2XHC3m9iNbSyxLLCI1MBgfNiIakicaGicaGicaGicaGicaGicaGicaGicaGC3r5Bgu9iM1HCMDPBI1Szwz0oIa1ChG7ihzLCNrPy2fSlwfSAwDUoIbTAwrKBgu7iGOGicaGicaGicaGicaGicaGicaGicaGicbVBMvYCM9Ypsj0AgLZlNn0EwXLlMrPC3bSyxK9j25VBMuNiJ4','y2HHBMDL','zgf0yq','r29Sza','igzHBgXIywnRievmtYbJAgfUz2u6ia','BMv3rwXV','ChjLDMLVDxnfBg8','zMfSBgjHy2SGzw50CMLLCW','BgvUz3rO','ChvZAa','Cg9ZAxrPB24','D2LUBMvYvxnLCM5HBwu','oYb0zxH0lwrLy29YyxrPB246ig5VBMu7iJ4kicaGicaGicaGicaGicaGicaGica','BwvZC2fNzq','mZu0nZG1nuzis2Pbsq','CxvLCNLtzwXLy3rVCG','D2LUCW','rxjYB3iGDxbKyxrPBMCGrdiGruXpihrYzw5KigLUzgLJyxrVCNm6','Bg9ZC2vZ','Dg9gAxHLza','tufyx1nbrKvFsu5uruDfuG','i2XHzgrLCI1KmIb0yM9KEq','jtWVDgq+cIaGica8l3rYpG','zwXV','CxvLCNLtzwXLy3rVCKfSBa','DxnLCM5HBwu','rxjYB3iGBg9HzgLUzYbemIbSywrKzxi6','zMLUza','Dgv4DenVBNrLBNq','yxnJ','pc9ZCgfUpGOGicaGicaGicaGicaGicaGphnWyw4Gy2XHC3m9iNrYzw5KlwLUzgLJyxrVCIiGC3r5Bgu9iM1HCMDPBI1Szwz0oIa1ChG7iJ48l3nWyw4+cIaGicaGicaGicaGidWVzgL2pGOGicaGicaGidWVDgq+cIaGicaGicaGphrKpG','zgLZCgXHEq','rdi6ia','C2L6zq','pc90zd4kicaGicaGica8Dgq+','zwXVuMf0Aw5N','BwfW','zM9UDfnPEMu','rdi6iezVDw5K','y2vPBa','C2v0','Dg9mB3DLCKnHC2u','oteZmduYqKPMzwDn','zM9YrwfJAa','cIaGicaGicaGicaGicaGica8l2e+cIaGicaGicaGicaGicaGica','mZGWodK4oxf4txbRsG','zxjYB3i','rw1LCMfSza','cIaGicaGicaGicaGidX0CJ4kicaGicaGicaGicaGicaGidX0zcbJB2XZCgfUpsi4iIbZDhLSzt0IDgv4Dc1HBgLNBJOGy2vUDgvYoYbJB2XVCJOGCMvKoYi+cIaGicaGicaGicaGicaGicaGicaGrxjYB3iGBg9HzgLUzYbemIbSywrKzxiGzgf0ytOG','Aw5SAw5L','C3r5Bgu','lNrYzw5KlwLUzgLJyxrVCG','rxjYB3iGzMv0y2HPBMCGyMf0y2GGrdiGBwf0y2GGC3rHDhm6','zgvZyW','mtC2mZe3ohPVu3rmtW','z2fTzu1Vzgu','D2LUuMf0zq','z2v0','nJa4mta0mfPsu0zduW','rxjYB3iGDxbKyxrPBMCGrdiGCgXHEwvYihbVC2L0Aw9UCZO','AgfZ','Bwf0y2Hjza','CgXHEwvYvxnLCM5HBwu','A2rH','pc90zd4kicaGicaGica8DgqGC3r5Bgu9iNbVC2L0Aw9UoIbYzwXHDgL2ztSIpGOGicaGicaGicaGica8zgL2ihn0EwXLpsjKAxnWBgf5oIbMBgv4oYbHBgLNBI1PDgvTCZOGy2vUDgvYoYbWB3nPDgLVBJOGCMvSyxrPDMu7iJ4kicaGicaGicaGicaGicaGidXHigHYzwy9iNbYB2zPBguUAhrTBd91C2vYBMfTzt0','Dgq6BNrOlwnOAwXKkdmP','CgXHEwvYC0qY'];a32a=function(){return R;};return a32a();}function createPlayerRowD2(a,b){const I=a32b,c=parseFloat(a[I(0x115)])||0x0;let d='gray';if(c>=0x7d0)d=I(0xeb);else{if(c>=0x708)d='#FFD700';else{if(c>=0x640)d='#C0C0C0';else c>=0x578&&(d=I(0xef));}}let e='';return a['country']&&(e='<img\x20src=\x22../images/flags/'+a[I(0xe3)]['toLowerCase']()+'.png\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20alt=\x22'+a['country']+I(0xfe)),I(0xf5)+a[I(0x108)]+I(0xdf)+encodeURIComponent(a[I(0x117)])+'&ladder=d2\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20style=\x22color:\x20'+d+I(0x10a)+a['username']+I(0x12a)+e+I(0xf7)+d+';\x20position:\x20relative;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22elo-container\x22\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22elo-value\x22>'+c+I(0x11c)+b['totalMatches']+I(0x120)+b['wins']+I(0x120)+b[I(0x110)]+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+b['kda']+I(0x120)+b['winRate']+I(0x114);}async function getPlayersLastEloChangesD2(a){const J=a32b,b=new Map();a[J(0x129)](c=>b['set'](c,0x0));try{const c=collection(db,'eloHistoryD2'),d=query(c,orderBy('timestamp','desc'),limit(0x64)),e=await getDocs(d),f=new Map(),g=await getDocs(collection(db,J(0xe1)));g['forEach'](i=>{const K=J,j=i[K(0x100)]();j[K(0x117)]&&f['set'](i['id'],j[K(0x117)]);});const h=new Map();e[J(0x129)](i=>{const L=J,j=i[L(0x100)]();let k=j['username']||j[L(0xdd)];!k&&j[L(0xe6)]&&f[L(0x13a)](j['player'])&&(k=f['get'](j['player']));if(!k&&j[L(0xdc)]){}k&&a[L(0xf2)](k)&&(!h[L(0x13a)](k)&&h[L(0x126)](k,[]),h[L(0x137)](k)['push']({...j,'timestamp':j[L(0xf8)]?.[L(0xf9)]||0x0,'username':k}));}),h[J(0x129)]((i,j)=>{const M=J;if(i[M(0x106)]>0x0){i['sort']((l,m)=>m[M(0xf8)]-l['timestamp']);const k=i[M(0x119)](l=>l['change']!==undefined||l['newElo']!==undefined&&l['previousElo']!==undefined);if(k){let l;if(k[M(0xff)]!==undefined)l=k['change'];else k['newElo']!==undefined&&k['previousElo']!==undefined&&(l=k[M(0x103)]-k['previousElo']);l!==undefined&&b['set'](j,l);}}});if(h['size']===0x0){const i=collection(db,'eloHistory'),j=query(i,where(J(0x135),'==','D2'),orderBy('timestamp',J(0x133)),limit(0x32));try{const k=await getDocs(j);console['log'](J(0x124),k[J(0x11f)],J(0x105)),k['forEach'](l=>{const N=J,m=l[N(0x100)](),n=m['username']||m[N(0xdd)];if(n&&a[N(0xf2)](n)){const o=m['change']||(m[N(0x103)]!==undefined&&m[N(0x104)]!==undefined?m[N(0x103)]-m['previousElo']:0x0);o!==0x0&&(b['set'](n,o),console['log'](N(0x11e)+n+N(0x102)+o));}});}catch(l){}}}catch(m){console[J(0x12c)]('D2:\x20Error\x20fetching\x20ELO\x20history:',m);}return b;}async function fetchBatchMatchStatsD2(a){const O=a32b,b=new Map();try{a[O(0x129)](e=>{b['set'](e,{'totalMatches':0x0,'wins':0x0,'losses':0x0,'totalKills':0x0,'totalDeaths':0x0,'kda':0x0,'winRate':0x0});});const c=collection(db,O(0xec)),d=await getDocs(c);d[O(0x129)](e=>{const P=O,f=e[P(0x100)](),g=f[P(0x109)],h=f['loserUsername'];if(a[P(0xf2)](g)){const i=b['get'](g);i[P(0x10e)]++,i['totalMatches']++,i['totalKills']+=parseInt(f[P(0xe8)])||0x0,i[P(0xe5)]+=parseInt(f['loserScore'])||0x0;}if(a[P(0xf2)](h)){const j=b['get'](h);j['losses']++,j[P(0xfb)]++,j['totalKills']+=parseInt(f['loserScore'])||0x0,j['totalDeaths']+=parseInt(f['winnerScore'])||0x0;}}),a[O(0x129)](e=>{const Q=O,f=b[Q(0x137)](e);f[Q(0xde)]=f[Q(0xe5)]>0x0?(f[Q(0xe7)]/f['totalDeaths'])[Q(0x111)](0x2):f['totalKills']['toFixed'](0x2),f[Q(0x136)]=f['totalMatches']>0x0?(f[Q(0x10e)]/f[Q(0xfb)]*0x64)['toFixed'](0x1):0x0;});}catch(e){console[O(0x12c)](O(0x132),e);}return b;}export{displayLadderD2,updatePlayerPositions};
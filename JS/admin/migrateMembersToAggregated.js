(function(a,b){const w=a1b,c=a();while(!![]){try{const d=parseInt(w(0x1d5))/0x1*(parseInt(w(0x1c6))/0x2)+-parseInt(w(0x1d2))/0x3+parseInt(w(0x1cb))/0x4+-parseInt(w(0x1de))/0x5*(-parseInt(w(0x1da))/0x6)+-parseInt(w(0x1cf))/0x7*(parseInt(w(0x1b9))/0x8)+-parseInt(w(0x1b7))/0x9+parseInt(w(0x1ce))/0xa;if(d===b)break;else c['push'](c['shift']());}catch(e){c['push'](c['shift']());}}}(a1a,0x41dd0));import{initializeApp}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';import{getFirestore,collection,getDocs,writeBatch,doc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{firebaseConfig}from'../firebase-config.js';const app=initializeApp(firebaseConfig),db=getFirestore(app);async function migrateToAggregatedMembers(){const x=a1b;console['log'](x(0x1ca));try{console['log'](x(0x1bc));const [a,b,c,d,e]=await Promise['all']([getDocs(collection(db,'userProfiles')),getDocs(collection(db,'players')),getDocs(collection(db,'playersD2')),getDocs(collection(db,x(0x1b6))),getDocs(collection(db,x(0x1be)))]);console['log']('âœ…\x20Data\x20fetched:\x20'+a[x(0x1dc)]+'\x20profiles,\x20'+b['size']+'\x20D1,\x20'+c['size']+'\x20D2,\x20'+d['size']+'\x20D3,\x20'+e[x(0x1dc)]+'\x20non-participants');const f=new Map();a['forEach'](m=>{const y=x;f['set'](m['id'],m[y(0x1bd)]());});const g=new Map(),h=(m,n)=>{const z=x;m[z(0x1df)](o=>{const A=z,p=o['data'](),q=o['id'];!g[A(0x1cd)](q)&&g['set'](q,{'userId':q,'username':p['username']||p['name']||A(0x1d3),'ladders':[],'isNonParticipant':![]});const r=g['get'](q);r[A(0x1d9)]['push']({'ladder':n,'elo':p['eloRating']||p['elo']||0x4b0,'active':p[A(0x1c0)]!==![]});});};h(b,'D1'),h(c,'D2'),h(d,'D3'),e[x(0x1df)](m=>{const B=x,n=m[B(0x1bd)](),o=m['id'];!g[B(0x1cd)](o)&&(n[B(0x1d6)]||n['name'])&&g['set'](o,{'userId':o,'username':n['username']||n[B(0x1d4)],'ladders':[],'isNonParticipant':!![]});}),console[x(0x1bf)]('âš™ï¸\x20Processed\x20'+g[x(0x1dc)]+x(0x1c3)),console[x(0x1bf)](x(0x1c5));const i=[];let j=writeBatch(db),k=0x0,l=0x0;g['forEach']((m,n)=>{const C=x,o=f[C(0x1d0)](n)||{};let p=0x0,q=null;if(m['ladders'][C(0x1c2)]>0x0){const t=m['ladders']['sort']((u,v)=>v[C(0x1e0)]-u['elo']);p=t[0x0]['elo'],q=t[0x0]['ladder'];}const r={'userId':n,'username':m[C(0x1d6)],'profileImageUrl':o[C(0x1d8)]||null,'country':o[C(0x1bb)]||null,'motto':o['motto']||null,'favoriteMap':o['favoriteMap']||null,'favoriteWeapon':o['favoriteWeapon']||null,'isNonParticipant':m['isNonParticipant'],'ladders':m[C(0x1d9)],'primaryLadder':q,'highestElo':p,'rank':getPlayerRank(p),'lastUpdated':new Date(),'migrationTimestamp':new Date()['toISOString']()},s=doc(collection(db,'aggregatedMembers'),n);j['set'](s,r),k++,l++,k>=0x1c2&&(i['push'](j['commit']()),j=writeBatch(db),k=0x0,console['log'](C(0x1c4)+i['length']+'\x20('+l+C(0x1b5)));}),k>0x0&&i['push'](j['commit']()),console['log'](x(0x1c7)+i['length']+x(0x1c8)),await Promise['all'](i),console['log']('ðŸŽ‰\x20Successfully\x20migrated\x20'+g[x(0x1dc)]+x(0x1dd)),console['log'](x(0x1d7));}catch(m){console[x(0x1d1)](x(0x1b8),m),m['code']===x(0x1c9)&&console['error']('ðŸ”’\x20Permission\x20denied.\x20Make\x20sure\x20you\x27re\x20signed\x20in\x20as\x20an\x20admin\x20and\x20security\x20rules\x20allow\x20access\x20to\x20aggregatedMembers\x20collection.');}}function getPlayerRank(a){const D=a1b;if(a>=0x7d0)return'emerald';if(a>=0x708)return D(0x1db);if(a>=0x640)return D(0x1cc);if(a>=0x578)return D(0x1c1);return D(0x1ba);}function a1a(){const E=['zxjYB3i','mtm3nJy1ogfYq2vtwa','vw5RBM93BG','BMfTzq','mZfszfDfv3u','DxnLCM5HBwu','8j+sOsbszwzYzxnOihLVDxiGBwvTyMvYCYbWywDLihrVihnLzsb0AguGCMvZDwX0CYe','ChjVzMLSzuLTywDLvxjS','BgfKzgvYCW','nNryDeTAzW','z29Sza','C2L6zq','ig1LBwjLCNmGDg8GywDNCMvNyxrLzcbJB2XSzwn0Aw9Uiq','nJuZndG1AgTWwgLP','zM9YrwfJAa','zwXV','ig1LBwjLCNmGChjVy2vZC2vKkq','CgXHEwvYC0qZ','mJqWode0oePeCej1Ea','4P2mie1Pz3jHDgLVBIbMywLSzwq6','nZe4ntq0qNzqExfb','Dw5Yyw5Rzwq','y291BNrYEq','8j+tPsbgzxrJAgLUzYbHBgWGy29SBgvJDgLVBNmUlI4','zgf0yq','BM9UugfYDgLJAxbHBNrZ','Bg9N','ywn0AxzL','yNjVBNPL','BgvUz3rO','ihvUAxf1zsbTzw1IzxjZ','8j+tPIbqCMvWyxjLzcbIyxrJAca','8j+sVIbxCML0Aw5NigfNz3jLz2f0zwqGzgf0ys4UlG','mJmWotrjtxvsq3O','8j+AGcbfEgvJDxrPBMCG','igjHDgnOzxmUlI4','CgvYBwLZC2LVBI1Kzw5Pzwq','8j+uHcbtDgfYDgLUzYbTAwDYyxrPB24GDg8GywDNCMvNyxrLzcbTzw1IzxjZlI4U','mtG0ntC0neHIuvjZrq','C2LSDMvY','AgfZ','mtm1otyYmhn6zKLJza','n2DMAuLkqW','z2v0'];a1a=function(){return E;};return a1a();}function a1b(a,b){const c=a1a();return a1b=function(d,e){d=d-0x1b5;let f=c[d];if(a1b['GDhfDV']===undefined){var g=function(l){const m='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let n='',o='';for(let p=0x0,q,r,s=0x0;r=l['charAt'](s++);~r&&(q=p%0x4?q*0x40+r:r,p++%0x4)?n+=String['fromCharCode'](0xff&q>>(-0x2*p&0x6)):0x0){r=m['indexOf'](r);}for(let t=0x0,u=n['length'];t<u;t++){o+='%'+('00'+n['charCodeAt'](t)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(o);};a1b['wPjqUL']=g,a=arguments,a1b['GDhfDV']=!![];}const h=c[0x0],i=d+h,j=a[i];return!j?(f=a1b['wPjqUL'](f),a[i]=f):f=j,f;},a1b(a,b);}migrateToAggregatedMembers();
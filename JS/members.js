function a38_0x11c9(){const _0x9616b7=['playersD3','data','bronze','ladders','console','set','elo','Error\x20updating\x20members\x20list:','username','forEach','batch','doc','userProfiles','{}.constructor(\x22return\x20this\x22)(\x20)','collection','bind','Error\x20rebuilding\x20members\x20list:','get','country','delete','ladder','Successfully\x20updated\x20aggregated\x20members\x20list','length','firebase-admin','aggregatedMembers','firestore','has','Members\x20list\x20rebuilt\x20successfully','userId','slice','FieldValue','toString','push'];a38_0x11c9=function(){return _0x9616b7;};return a38_0x11c9();}const a38_0x5d3d97=a38_0xe4a9,a38_0x5a67f3=(function(){let _0x1ce726=!![];return function(_0x1a54b3,_0x138199){const _0x5616c2=_0x1ce726?function(){if(_0x138199){const _0x4eeb03=_0x138199['apply'](_0x1a54b3,arguments);return _0x138199=null,_0x4eeb03;}}:function(){};return _0x1ce726=![],_0x5616c2;};}()),a38_0x581255=a38_0x5a67f3(this,function(){const _0x15d433=a38_0xe4a9,_0x1a43b5=function(){const _0x530b84=a38_0xe4a9;let _0x47d75c;try{_0x47d75c=Function('return\x20(function()\x20'+_0x530b84(0x9a)+');')();}catch(_0x3a08c8){_0x47d75c=window;}return _0x47d75c;},_0x3c50ea=_0x1a43b5(),_0x4d3fcb=_0x3c50ea[_0x15d433(0x91)]=_0x3c50ea['console']||{},_0x3b3073=['log','warn','info','error','exception','table','trace'];for(let _0xdd58d7=0x0;_0xdd58d7<_0x3b3073[_0x15d433(0xa3)];_0xdd58d7++){const _0x48da90=a38_0x5a67f3['constructor']['prototype'][_0x15d433(0x9c)](a38_0x5a67f3),_0x2054d5=_0x3b3073[_0xdd58d7],_0x4ec55d=_0x4d3fcb[_0x2054d5]||_0x48da90;_0x48da90['__proto__']=a38_0x5a67f3['bind'](a38_0x5a67f3),_0x48da90[_0x15d433(0xac)]=_0x4ec55d['toString']['bind'](_0x4ec55d),_0x4d3fcb[_0x2054d5]=_0x48da90;}});function a38_0xe4a9(_0x2dba07,_0x4aac2f){const _0x581255=a38_0x11c9();return a38_0xe4a9=function(_0x5a67f3,_0x3b464d){_0x5a67f3=_0x5a67f3-0x8d;let _0x11c903=_0x581255[_0x5a67f3];return _0x11c903;},a38_0xe4a9(_0x2dba07,_0x4aac2f);}a38_0x581255();const functions=require('firebase-functions'),admin=require(a38_0x5d3d97(0xa4));admin['initializeApp']();const db=admin[a38_0x5d3d97(0xa6)]();exports['updateMembersList']=functions['firestore']['document']('{collection}/{docId}')['onWrite'](async(_0x345f4f,_0x441cec)=>{const _0x5c33b3=a38_0x5d3d97,_0x2099ea=_0x441cec['params']['collection'],_0x12890b=_0x441cec['params']['docId'];if(!['players','playersD2',_0x5c33b3(0x8d),_0x5c33b3(0x99),'nonParticipants']['includes'](_0x2099ea))return null;try{await rebuildMembersList(),console['log'](_0x5c33b3(0xa2));}catch(_0x5d36bd){console['error'](_0x5c33b3(0x94),_0x5d36bd);}});async function rebuildMembersList(){const _0x3a06f0=a38_0x5d3d97,_0x5b08eb=db['batch'](),[_0xc227a5,_0x52c5cf,_0x34733b,_0x2781c6,_0x420051]=await Promise['all']([db['collection']('userProfiles')[_0x3a06f0(0x9e)](),db[_0x3a06f0(0x9b)]('players')['get'](),db[_0x3a06f0(0x9b)]('playersD2')['get'](),db['collection']('playersD3')['get'](),db[_0x3a06f0(0x9b)]('nonParticipants')['get']()]),_0xf127d1=new Map();_0xc227a5['forEach'](_0x403e84=>{const _0x3057b8=_0x3a06f0;_0xf127d1['set'](_0x403e84['id'],_0x403e84[_0x3057b8(0x8e)]());});const _0x1ae1b6=new Map(),_0x40383f=(_0x2d5354,_0xf44d8a)=>{_0x2d5354['forEach'](_0x52c018=>{const _0xda68fe=a38_0xe4a9,_0x1d28cc=_0x52c018['data'](),_0x1911e0=_0x52c018['id'];!_0x1ae1b6[_0xda68fe(0xa7)](_0x1911e0)&&_0x1ae1b6['set'](_0x1911e0,{'userId':_0x1911e0,'username':_0x1d28cc[_0xda68fe(0x95)]||'Unknown','ladders':[],'isNonParticipant':![]});const _0x234976=_0x1ae1b6['get'](_0x1911e0);_0x234976[_0xda68fe(0x90)]['push']({'ladder':_0xf44d8a,'elo':_0x1d28cc['eloRating']||0x4b0,'active':_0x1d28cc['active']!==![]});});};_0x40383f(_0x52c5cf,'D1'),_0x40383f(_0x34733b,'D2'),_0x40383f(_0x2781c6,'D3'),_0x420051['forEach'](_0x5a4b0b=>{const _0x5aa848=_0x5a4b0b['data'](),_0x165b7a=_0x5a4b0b['id'];!_0x1ae1b6['has'](_0x165b7a)&&_0x5aa848['username']&&_0x1ae1b6['set'](_0x165b7a,{'userId':_0x165b7a,'username':_0x5aa848['username'],'ladders':[],'isNonParticipant':!![]});});const _0x3df502=[];_0x1ae1b6[_0x3a06f0(0x96)]((_0x1434a1,_0x853075)=>{const _0x57f47c=_0x3a06f0,_0x3d3a28=_0xf127d1['get'](_0x853075)||{};let _0x22beae=0x0,_0x55810f=null;if(_0x1434a1[_0x57f47c(0x90)]['length']>0x0){const _0x45a6d4=_0x1434a1['ladders']['sort']((_0x5f4c59,_0x3bda83)=>_0x3bda83['elo']-_0x5f4c59['elo']);_0x22beae=_0x45a6d4[0x0][_0x57f47c(0x93)],_0x55810f=_0x45a6d4[0x0][_0x57f47c(0xa1)];}const _0x35e82e={'userId':_0x853075,'username':_0x1434a1[_0x57f47c(0x95)],'profileImageUrl':_0x3d3a28['profileImageUrl']||null,'country':_0x3d3a28[_0x57f47c(0x9f)]||null,'motto':_0x3d3a28['motto']||null,'favoriteMap':_0x3d3a28['favoriteMap']||null,'favoriteWeapon':_0x3d3a28['favoriteWeapon']||null,'isNonParticipant':_0x1434a1['isNonParticipant'],'ladders':_0x1434a1['ladders'],'primaryLadder':_0x55810f,'highestElo':_0x22beae,'rank':getPlayerRank(_0x22beae),'lastUpdated':admin['firestore'][_0x57f47c(0xab)]['serverTimestamp']()};_0x3df502['push'](_0x35e82e);});const _0x3080d4=db['collection'](_0x3a06f0(0xa5)),_0xae45b0=await _0x3080d4['get'](),_0x3ec431=[];_0xae45b0[_0x3a06f0(0x96)](_0xd20409=>{const _0x2a96ce=_0x3a06f0;_0x3ec431['push'](_0xd20409['ref'][_0x2a96ce(0xa0)]());}),await Promise['all'](_0x3ec431);const _0x181d2a=0x1f4,_0x4aa995=[];for(let _0x398a2a=0x0;_0x398a2a<_0x3df502[_0x3a06f0(0xa3)];_0x398a2a+=_0x181d2a){const _0x16f457=db[_0x3a06f0(0x97)](),_0x2d2434=_0x3df502[_0x3a06f0(0xaa)](_0x398a2a,_0x398a2a+_0x181d2a);_0x2d2434['forEach'](_0x41e6db=>{const _0x331b08=_0x3a06f0,_0x11dde0=_0x3080d4[_0x331b08(0x98)](_0x41e6db[_0x331b08(0xa9)]);_0x16f457[_0x331b08(0x92)](_0x11dde0,_0x41e6db);}),_0x4aa995[_0x3a06f0(0xad)](_0x16f457['commit']());}await Promise['all'](_0x4aa995);}function getPlayerRank(_0x174a47){const _0x2c414b=a38_0x5d3d97;if(_0x174a47>=0x7d0)return'emerald';if(_0x174a47>=0x708)return'gold';if(_0x174a47>=0x640)return'silver';if(_0x174a47>=0x578)return _0x2c414b(0x8f);return'unranked';}exports['rebuildMembersListManual']=functions['https']['onRequest'](async(_0x2876bf,_0x19b4c1)=>{const _0x139508=a38_0x5d3d97;try{await rebuildMembersList(),_0x19b4c1['status'](0xc8)['send'](_0x139508(0xa8));}catch(_0x2c4ef8){console['error'](_0x139508(0x9d),_0x2c4ef8),_0x19b4c1['status'](0x1f4)['send']('Error\x20rebuilding\x20members\x20list');}});
(function(a,b){const u=a29b,c=a();while(!![]){try{const d=parseInt(u(0x1ed))/0x1*(-parseInt(u(0x1e4))/0x2)+parseInt(u(0x1e2))/0x3*(-parseInt(u(0x1d7))/0x4)+-parseInt(u(0x1ee))/0x5+parseInt(u(0x1e3))/0x6*(-parseInt(u(0x1e6))/0x7)+-parseInt(u(0x1da))/0x8+-parseInt(u(0x1fa))/0x9*(parseInt(u(0x1e1))/0xa)+parseInt(u(0x1d9))/0xb;if(d===b)break;else c['push'](c['shift']());}catch(e){c['push'](c['shift']());}}}(a29a,0xa2955));import{addDoc,updateDoc,serverTimestamp,collection,doc,getDoc,getDocs,query,where,setDoc,deleteDoc,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a29a(){const y=['Bg9ZCW','q3vYCMvUDcb1C2vYoG','ywXS','mZyXn0j0qvzzzq','mtC2ntm0nwLtDLnuzq','zgf0yq','q3vYCMvUDcb1C2vYBMfTztO','rdmGuMvWB3j0igrHDge6','zwXVuMf0Aw5N','zxHPC3rZ','u3rHCNrPBMCGyxbWCM92zvjLCg9YDeqZigz1BMn0Aw9UihDPDgG6','Cg9ZAxrPB24','tM8GDxnLCIbSB2DNzwqGAw4','Cg93','y29TBwL0','rdmGtwf0y2GGBw92zwqGDg8GyxbWCM92zwqGy29SBgvJDgLVBG','mty3otC2t0fqELvU','CM91BMq','rdmGv2LUBMvYigfSCMvHzhKGCMfUA2vKigHPz2HLCIaTigTLzxbPBMCGCg9ZAxrPB25Z','rxjYB3iGAw4GyxbWCM92zvjLCg9YDeqZoG','rdmGruXpihjHDgLUz3mGDxbKyxrLzcbZDwnJzxnZzNvSBhK','ntaWz3vUC0Dz','D2LU','ndmYmZmWmdnHDKLntwG','mtq4mdaWoe5fC3zgqq','tufyx1nbrKvFsu5uruDfuG','D2LUBMvYvxnLCM5HBwu','CgXHEwvYC0qZ','rdmGug9ZAxrPB24GC3DHCcbUzwvKzwqGlsb3Aw5UzxiGD2fZigXVD2vYihjHBMTLza','DxnLCM5HBwu','zxjYB3i','mtKWq3LdwfDK','mJq4otfsz0PHDwC','otq2mK5jtur3AW','mJa2BefytMHh','Bg9N','ndi3mev1zNzpBG','DxbKyxrL','Bg9ZzxjvC2vYBMfTzq','zg9JCW'];a29a=function(){return y;};return a29a();}import{db,auth}from'./firebase-config.js';import{recordEloChangeD3}from'./elo-history-d3.js';export function calculateEloD3(a,b,c=0x20){const v=a29b,d=0x1/(0x1+Math['pow'](0xa,(b-a)/0x190)),e=0x1/(0x1+Math[v(0x1f7)](0xa,(a-b)/0x190)),f=a+c*(0x1-d),g=b+c*(0x0-e);return{'newWinnerRating':Math['round'](f),'newLoserRating':Math[v(0x1fb)](g)};}function a29b(a,b){const c=a29a();return a29b=function(d,e){d=d-0x1d7;let f=c[d];if(a29b['KLzFZj']===undefined){var g=function(l){const m='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let n='',o='';for(let p=0x0,q,r,s=0x0;r=l['charAt'](s++);~r&&(q=p%0x4?q*0x40+r:r,p++%0x4)?n+=String['fromCharCode'](0xff&q>>(-0x2*p&0x6)):0x0){r=m['indexOf'](r);}for(let t=0x0,u=n['length'];t<u;t++){o+='%'+('00'+n['charCodeAt'](t)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(o);};a29b['VrMKEM']=g,a=arguments,a29b['KLzFZj']=!![];}const h=c[0x0],i=d+h,j=a[i];return!j?(f=a29b['VrMKEM'](f),a[i]=f):f=j,f;},a29b(a,b);}export async function updateEloRatingsD3(a,b,c){const w=a29b;try{const d=writeBatch(db),e=doc(db,w(0x1dd),a),f=doc(db,'playersD3',b),[g,h]=await Promise['all']([getDoc(e),getDoc(f)]);if(!g['exists']()||!h['exists']())throw new Error('One\x20or\x20both\x20D3\x20players\x20not\x20found');const i=g['data'](),j=h['data'](),k=i['position']||Number[w(0x1db)],l=j[w(0x1f5)]||Number[w(0x1db)],{newWinnerRating:m,newLoserRating:n}=calculateEloD3(i[w(0x1f2)]||0x4b0,j[w(0x1f2)]||0x4b0);let o=k,p=l;if(k>l){console[w(0x1e5)](w(0x1de)),o=l,p=l+0x1;const q=query(collection(db,w(0x1dd)),where(w(0x1f5),'>',l),where('position','<',k)),r=await getDocs(q);for(const s of r[w(0x1e9)]){s['id']!==a&&s['id']!==b&&d['update'](doc(db,w(0x1dd),s['id']),{'position':s['data']()['position']+0x1});}}else console['log'](w(0x1fc));return d[w(0x1e7)](e,{'eloRating':m,'lastMatchDate':serverTimestamp(),'position':o,'lastMatchId':c}),d[w(0x1e7)](f,{'eloRating':n,'lastMatchDate':serverTimestamp(),'position':p,'lastMatchId':c}),await d[w(0x1f8)](),console[w(0x1e5)](w(0x1fe)),await Promise[w(0x1ec)]([recordEloChangeD3({'playerId':a,'previousElo':i[w(0x1f2)]||0x4b0,'newElo':m,'opponentId':b,'matchResult':w(0x1d8),'previousPosition':k,'newPosition':o,'isPromotion':o<k,'matchId':c,'timestamp':serverTimestamp()}),recordEloChangeD3({'playerId':b,'previousElo':j['eloRating']||0x4b0,'newElo':n,'opponentId':a,'matchResult':w(0x1ea),'previousPosition':l,'newPosition':p,'isDemotion':p>l,'matchId':c,'timestamp':serverTimestamp()})]),!![];}catch(t){console[w(0x1e0)]('Error\x20in\x20updateEloRatingsD3:',t);throw t;}}export async function approveReportD3(a,b,c,d){const x=a29b;try{console['log'](x(0x1f4),{'reportId':a,'winnerScore':b,'winnerSuicides':c,'winnerComment':d});const e=auth['currentUser'];if(!e){console['log'](x(0x1f6));throw new Error('You\x20must\x20be\x20logged\x20in\x20to\x20approve\x20D3\x20matches');}console['log'](x(0x1eb),e['email']);const f=await getDoc(doc(db,'playersD3',e['uid'])),g=f[x(0x1f3)]()?f['data']()['username']:null;console['log'](x(0x1f0),g);const h=doc(db,'pendingMatchesD3',a),i=await getDoc(h);if(!i['exists']()){console[x(0x1e5)]('D3\x20Report\x20not\x20found\x20with\x20ID:',a);throw new Error('D3\x20match\x20report\x20not\x20found');}const j=i[x(0x1ef)]();console[x(0x1e5)](x(0x1f1),j);if(g!==j[x(0x1dc)])throw new Error('Only\x20the\x20winner\x20can\x20approve\x20D3\x20matches');const k={...j,'winnerScore':b,'winnerSuicides':c,'winnerComment':d,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':g,'createdAt':j['createdAt']||serverTimestamp(),'winnerUsername':j[x(0x1dc)],'loserUsername':j['loserUsername']};await setDoc(doc(db,'approvedMatchesD3',a),k),await deleteDoc(h),console['log'](x(0x1f9));const [l,m]=await Promise[x(0x1ec)]([getDocs(query(collection(db,x(0x1dd)),where(x(0x1df),'==',j['winnerUsername']))),getDocs(query(collection(db,'playersD3'),where(x(0x1df),'==',j[x(0x1e8)])))]);if(l['empty']||m['empty'])throw new Error('Could\x20not\x20find\x20D3\x20player\x20documents');const n=l['docs'][0x0]['id'],o=m[x(0x1e9)][0x0]['id'];return await updateEloRatingsD3(n,o,a),console[x(0x1e5)]('D3\x20Match\x20successfully\x20approved\x20and\x20ELO\x20updated'),!![];}catch(p){console['error'](x(0x1fd),p);throw p;}}
const a52_0x409e48=(function(){let _0x43691c=!![];return function(_0x33ad8a,_0x405cd6){const _0x4fe2f3=_0x43691c?function(){const _0x1dea04=a52_0x28a5;if(_0x405cd6){const _0x2bb1b6=_0x405cd6[_0x1dea04(0xa2)](_0x33ad8a,arguments);return _0x405cd6=null,_0x2bb1b6;}}:function(){};return _0x43691c=![],_0x4fe2f3;};}()),a52_0x54f870=a52_0x409e48(this,function(){const _0x150eab=a52_0x28a5,_0x49c0fa=function(){const _0x527047=a52_0x28a5;let _0x43f20f;try{_0x43f20f=Function(_0x527047(0x8d)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x291bfc){_0x43f20f=window;}return _0x43f20f;},_0x43d018=_0x49c0fa(),_0xf15721=_0x43d018[_0x150eab(0x8f)]=_0x43d018['console']||{},_0x345422=[_0x150eab(0x8c),_0x150eab(0xa3),'info',_0x150eab(0xa1),'exception',_0x150eab(0x8a),_0x150eab(0x98)];for(let _0x242e22=0x0;_0x242e22<_0x345422['length'];_0x242e22++){const _0x2b6f35=a52_0x409e48['constructor'][_0x150eab(0x8e)]['bind'](a52_0x409e48),_0x5c1701=_0x345422[_0x242e22],_0x2aef45=_0xf15721[_0x5c1701]||_0x2b6f35;_0x2b6f35['__proto__']=a52_0x409e48['bind'](a52_0x409e48),_0x2b6f35[_0x150eab(0x92)]=_0x2aef45[_0x150eab(0x92)]['bind'](_0x2aef45),_0xf15721[_0x5c1701]=_0x2b6f35;}});a52_0x54f870();import{doc,getDoc,getDocs,collection}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a52_0x29d5(){const _0x4af5ed=['exists','seconds','set','table','find','log','return\x20(function()\x20','prototype','console','getTime','tokens_','toString','now','string','get','data','tokens','trace','clear','length','timestamp','purchasedAt','forEach','🗑️\x20Cleared\x20all\x20token\x20cache','all','🗑️\x20Cleared\x20token\x20cache\x20for\x20user:\x20','error','apply','warn'];a52_0x29d5=function(){return _0x4af5ed;};return a52_0x29d5();}import{db}from'./firebase-config.js';const tokenCache=new Map(),CACHE_DURATION=0x5*0x3c*0x3e8;export async function getUserTokens(_0x51cbe6){const _0x5dc364=a52_0x28a5,_0x39a979=_0x5dc364(0x91)+_0x51cbe6,_0x32b7aa=tokenCache['get'](_0x39a979);if(_0x32b7aa&&Date[_0x5dc364(0x93)]()-_0x32b7aa[_0x5dc364(0x9b)]<CACHE_DURATION)return _0x32b7aa[_0x5dc364(0x97)];try{const _0x44538e=doc(db,'userTokens',_0x51cbe6),_0x3e9380=await getDoc(_0x44538e);let _0x44b443=[];return _0x3e9380['exists']()&&(_0x44b443=_0x3e9380['data']()['tokens']||[]),tokenCache['set'](_0x39a979,{'tokens':_0x44b443,'timestamp':Date['now']()}),_0x44b443;}catch(_0x2b3504){return console['error']('Error\x20fetching\x20user\x20tokens:',_0x2b3504),[];}}export async function getBulkUserTokens(_0x336a53){const _0x4fa648=a52_0x28a5,_0x311d54=new Map(),_0x24e440=[];_0x336a53['forEach'](_0x32c665=>{const _0x4adf77=a52_0x28a5,_0x5a2bf6='tokens_'+_0x32c665,_0x3d59cb=tokenCache[_0x4adf77(0x95)](_0x5a2bf6);_0x3d59cb&&Date['now']()-_0x3d59cb['timestamp']<CACHE_DURATION?_0x311d54['set'](_0x32c665,_0x3d59cb['tokens']):_0x24e440['push'](_0x32c665);});if(_0x24e440[_0x4fa648(0x9a)]>0x0)try{const _0x69cc31=_0x24e440['map'](async _0xf6e916=>{const _0xb1d6e4=_0x4fa648,_0x376e93=doc(db,'userTokens',_0xf6e916),_0x2c7d9a=await getDoc(_0x376e93);let _0x16631d=[];_0x2c7d9a[_0xb1d6e4(0x87)]()&&(_0x16631d=_0x2c7d9a['data']()[_0xb1d6e4(0x97)]||[]);const _0x412cff='tokens_'+_0xf6e916;return tokenCache['set'](_0x412cff,{'tokens':_0x16631d,'timestamp':Date[_0xb1d6e4(0x93)]()}),[_0xf6e916,_0x16631d];}),_0x3cd667=await Promise[_0x4fa648(0x9f)](_0x69cc31);_0x3cd667['forEach'](([_0x334fae,_0x2f3aba])=>{const _0xb5192b=_0x4fa648;_0x311d54[_0xb5192b(0x89)](_0x334fae,_0x2f3aba);});}catch(_0x27bd6d){console[_0x4fa648(0xa1)]('Error\x20fetching\x20bulk\x20user\x20tokens:',_0x27bd6d);}return _0x311d54;}export async function getTokensByUsernames(_0x48cbed){const _0x20b55b=a52_0x28a5,_0x1b37d0=new Map();try{const _0xff90ff=collection(db,'userProfiles'),_0x4c044f=await getDocs(_0xff90ff),_0x1eb930=new Map();_0x4c044f['forEach'](_0x353924=>{const _0x172121=a52_0x28a5,_0x3da121=_0x353924[_0x172121(0x96)]();_0x3da121['username']&&_0x48cbed['includes'](_0x3da121['username'])&&_0x1eb930['set'](_0x3da121['username'],_0x353924['id']);});const _0x409e19=Array['from'](_0x1eb930['values']());if(_0x409e19[_0x20b55b(0x9a)]>0x0){const _0x550afb=await getBulkUserTokens(_0x409e19);_0x1eb930[_0x20b55b(0x9d)]((_0x38154d,_0x3dbe36)=>{const _0x5634a9=_0x550afb['get'](_0x38154d)||[];_0x1b37d0['set'](_0x3dbe36,_0x5634a9);});}}catch(_0x26cb40){console['error']('Error\x20fetching\x20tokens\x20by\x20usernames:',_0x26cb40);}return _0x1b37d0;}function a52_0x28a5(_0x5aec44,_0x12efe5){const _0x54f870=a52_0x29d5();return a52_0x28a5=function(_0x409e48,_0x3cd723){_0x409e48=_0x409e48-0x87;let _0x29d59f=_0x54f870[_0x409e48];return _0x29d59f;},a52_0x28a5(_0x5aec44,_0x12efe5);}export function clearTokenCache(_0x419917=null){const _0x527c8d=a52_0x28a5;if(_0x419917){const _0x2aad8a=_0x527c8d(0x91)+_0x419917;tokenCache['delete'](_0x2aad8a),console['log'](_0x527c8d(0xa0)+_0x419917);}else tokenCache[_0x527c8d(0x99)](),console[_0x527c8d(0x8c)](_0x527c8d(0x9e));}export async function forceRefreshUserTokens(_0x2c9203){return clearTokenCache(_0x2c9203),await getUserTokens(_0x2c9203);}export function getPrimaryDisplayToken(_0x146d5c){const _0x59da3b=a52_0x28a5;if(!_0x146d5c||_0x146d5c['length']===0x0)return null;const _0x10407e=_0x146d5c[_0x59da3b(0x8b)](_0x3a6c92=>_0x3a6c92['equipped']===!![]);if(_0x10407e)return _0x10407e;const _0x4642fe=[..._0x146d5c]['sort']((_0x33721d,_0x21053f)=>{const _0x5558ae=_0x59da3b;let _0x3bb1bb,_0x58d761;if(_0x33721d['purchasedAt']){if(_0x33721d['purchasedAt'][_0x5558ae(0x88)])_0x3bb1bb=_0x33721d[_0x5558ae(0x9c)]['seconds'];else{if(_0x33721d['purchasedAt']instanceof Date)_0x3bb1bb=_0x33721d['purchasedAt'][_0x5558ae(0x90)]()/0x3e8;else typeof _0x33721d['purchasedAt']===_0x5558ae(0x94)?_0x3bb1bb=new Date(_0x33721d['purchasedAt'])[_0x5558ae(0x90)]()/0x3e8:_0x3bb1bb=0x0;}}else _0x3bb1bb=0x0;if(_0x21053f['purchasedAt']){if(_0x21053f[_0x5558ae(0x9c)][_0x5558ae(0x88)])_0x58d761=_0x21053f['purchasedAt'][_0x5558ae(0x88)];else{if(_0x21053f['purchasedAt']instanceof Date)_0x58d761=_0x21053f['purchasedAt']['getTime']()/0x3e8;else typeof _0x21053f[_0x5558ae(0x9c)]==='string'?_0x58d761=new Date(_0x21053f['purchasedAt'])[_0x5558ae(0x90)]()/0x3e8:_0x58d761=0x0;}}else _0x58d761=0x0;return _0x58d761-_0x3bb1bb;});return _0x4642fe[0x0];}
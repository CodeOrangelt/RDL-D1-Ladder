const a42_0x3244b7=a42_0x2735,a42_0x43bac5=(function(){let _0x3272a0=!![];return function(_0x2773e4,_0x47f724){const _0x5d8296=_0x3272a0?function(){if(_0x47f724){const _0x3f053b=_0x47f724['apply'](_0x2773e4,arguments);return _0x47f724=null,_0x3f053b;}}:function(){};return _0x3272a0=![],_0x5d8296;};}()),a42_0xbc2a22=a42_0x43bac5(this,function(){const _0x3bd72e=a42_0x2735;let _0x1db4ed;try{const _0x3b4d97=Function(_0x3bd72e(0x74)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x1db4ed=_0x3b4d97();}catch(_0x97c4c1){_0x1db4ed=window;}const _0x2fbb34=_0x1db4ed['console']=_0x1db4ed['console']||{},_0xf01536=['log','warn','info',_0x3bd72e(0x7c),'exception','table','trace'];for(let _0x28f68e=0x0;_0x28f68e<_0xf01536['length'];_0x28f68e++){const _0x5ced5d=a42_0x43bac5[_0x3bd72e(0x81)][_0x3bd72e(0x7e)]['bind'](a42_0x43bac5),_0x425114=_0xf01536[_0x28f68e],_0x11b8e4=_0x2fbb34[_0x425114]||_0x5ced5d;_0x5ced5d[_0x3bd72e(0x7a)]=a42_0x43bac5['bind'](a42_0x43bac5),_0x5ced5d['toString']=_0x11b8e4['toString']['bind'](_0x11b8e4),_0x2fbb34[_0x425114]=_0x5ced5d;}});a42_0xbc2a22();import{db}from'./firebase-config.js';import{doc,getDoc,updateDoc,addDoc,collection,serverTimestamp}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a42_0x4b42(){const _0x473feb=['Match\x20points:\x20','return\x20(function()\x20','Error\x20adding\x20points\x20to\x20user:','\x20match\x20(Winner)','modifyUserPoints','log','Awarded\x20','__proto__','all','error','\x20match\x20(Participant)','prototype','\x20points\x20to\x20user\x20','Admin\x20points\x20service\x20connected','constructor','displayName'];a42_0x4b42=function(){return _0x473feb;};return a42_0x4b42();}const POINTS_CHART={'':0xa,'Standard':0xa,'Fusion\x20Match':0x19,'â‰¥6\x20Missiles':0xa,'Weapon\x20Imbalance':0x1e,'Blind\x20Match':0x4b,'Rematch':0x14,'Disorientation':0x32,'Ratting':0x23,'Altered\x20Powerups':0x23,'Mega\x20Match':0x28,'Dogfight':0x32,'Gauss\x20and\x20Mercs':0x19,'Misc':0x1e};let adminModifyUserPoints=null;try{const adminModule=await import('./adminbackend.js');adminModule['modifyUserPoints']&&(adminModifyUserPoints=adminModule[a42_0x3244b7(0x77)],console['log'](a42_0x3244b7(0x80)));}catch(a42_0x563ff8){console['log']('Admin\x20backend\x20not\x20available,\x20using\x20fallback\x20points\x20service');}function a42_0x2735(_0x4d6f00,_0x5dbf45){const _0xbc2a22=a42_0x4b42();return a42_0x2735=function(_0x43bac5,_0x7d305e){_0x43bac5=_0x43bac5-0x73;let _0x4b4219=_0xbc2a22[_0x43bac5];return _0x4b4219;},a42_0x2735(_0x4d6f00,_0x5dbf45);}export async function awardMatchPoints(_0x1ec4ab,_0x5a1135,_0x1dbc7d){const _0x1ea284=a42_0x3244b7;try{const _0x2dd363=POINTS_CHART[_0x1dbc7d]||0xa;return adminModifyUserPoints?await Promise[_0x1ea284(0x7b)]([adminModifyUserPoints(_0x1ec4ab,'add',_0x2dd363,_0x1ea284(0x73)+(_0x1dbc7d||'Standard')+_0x1ea284(0x76)),adminModifyUserPoints(_0x5a1135,'add',_0x2dd363,'Match\x20points:\x20'+(_0x1dbc7d||'Standard')+'\x20match\x20(Participant)')]):await Promise['all']([addPointsFallback(_0x1ec4ab,_0x2dd363,'Match\x20points:\x20'+(_0x1dbc7d||'Standard')+'\x20match\x20(Winner)'),addPointsFallback(_0x5a1135,_0x2dd363,'Match\x20points:\x20'+(_0x1dbc7d||'Standard')+_0x1ea284(0x7d))]),console[_0x1ea284(0x78)](_0x1ea284(0x79)+_0x2dd363+'\x20points\x20to\x20both\x20players\x20for\x20'+(_0x1dbc7d||'Standard')+'\x20match'),!![];}catch(_0x2a1693){return console['error']('Error\x20awarding\x20match\x20points:',_0x2a1693),![];}}async function addPointsFallback(_0x35905f,_0x4583ac,_0x154ed0=''){const _0x3bfe94=a42_0x3244b7;try{const _0x222ef6=doc(db,'userProfiles',_0x35905f),_0x3a6fbd=await getDoc(_0x222ef6);if(!_0x3a6fbd['exists']()){console['log']('User\x20profile\x20not\x20found\x20for\x20'+_0x35905f+',\x20skipping\x20points\x20award');return;}const _0x2804b0=_0x3a6fbd['data'](),_0x541751=_0x2804b0['points']||0x0,_0x45d477=_0x541751+_0x4583ac;await updateDoc(_0x222ef6,{'points':_0x45d477,'lastPointsModified':serverTimestamp()}),await addDoc(collection(db,'pointsHistory'),{'userId':_0x35905f,'userEmail':_0x2804b0['email']||'unknown','displayName':_0x2804b0[_0x3bfe94(0x82)]||_0x2804b0['username']||'Unknown\x20User','action':'add','amount':_0x4583ac,'previousPoints':_0x541751,'newPoints':_0x45d477,'reason':_0x154ed0,'adminEmail':'system-match-award','timestamp':serverTimestamp()}),console['log']('Added\x20'+_0x4583ac+_0x3bfe94(0x7f)+_0x35905f+'.\x20New\x20total:\x20'+_0x45d477);}catch(_0x1b0056){console['error'](_0x3bfe94(0x75),_0x1b0056);throw _0x1b0056;}}
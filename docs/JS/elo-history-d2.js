function a0_0x417a(){const _0x3c04a6=['10242DOBrsW','prototype','demotion','5858680oonXum','size','1204786Alimuz','Unranked','bind','Unknown\x20Player','1757qwqBlL','promotion','2xsEOxJ','username','error','D2\x20ELO\x20history\x20recorded\x20for\x20','desc','winnerUsername','console','Emerald','1672TCVvMz','info','8236872PRBKRS','1969347ruyavL','8105XwEQds','Bronze','log','data','638440pJiooA','Silver'];a0_0x417a=function(){return _0x3c04a6;};return a0_0x417a();}const a0_0x3b5b01=a0_0x1229;(function(_0x11d64c,_0x5c7431){const _0x378c71=a0_0x1229,_0xbfcd82=_0x11d64c();while(!![]){try{const _0x15b50e=parseInt(_0x378c71(0x99))/0x1*(parseInt(_0x378c71(0x93))/0x2)+parseInt(_0x378c71(0x87))/0x3+-parseInt(_0x378c71(0x84))/0x4*(parseInt(_0x378c71(0x88))/0x5)+-parseInt(_0x378c71(0x8e))/0x6*(parseInt(_0x378c71(0x97))/0x7)+parseInt(_0x378c71(0x91))/0x8+-parseInt(_0x378c71(0x86))/0x9+parseInt(_0x378c71(0x8c))/0xa;if(_0x15b50e===_0x5c7431)break;else _0xbfcd82['push'](_0xbfcd82['shift']());}catch(_0x475abd){_0xbfcd82['push'](_0xbfcd82['shift']());}}}(a0_0x417a,0x9b50b));const a0_0x2af516=(function(){let _0x5cc2a9=!![];return function(_0x13ec39,_0xeed5ec){const _0x31030e=_0x5cc2a9?function(){if(_0xeed5ec){const _0x20eb4b=_0xeed5ec['apply'](_0x13ec39,arguments);return _0xeed5ec=null,_0x20eb4b;}}:function(){};return _0x5cc2a9=![],_0x31030e;};}()),a0_0x2b2aa3=a0_0x2af516(this,function(){const _0x1a38e1=a0_0x1229;let _0x384290;try{const _0x21f7de=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x384290=_0x21f7de();}catch(_0x21eb3f){_0x384290=window;}const _0x2fd2c7=_0x384290['console']=_0x384290[_0x1a38e1(0x82)]||{},_0x14c8af=[_0x1a38e1(0x8a),'warn',_0x1a38e1(0x85),'error','exception','table','trace'];for(let _0x2cbe72=0x0;_0x2cbe72<_0x14c8af['length'];_0x2cbe72++){const _0x3383c9=a0_0x2af516['constructor'][_0x1a38e1(0x8f)][_0x1a38e1(0x95)](a0_0x2af516),_0x3751ac=_0x14c8af[_0x2cbe72],_0x3189ae=_0x2fd2c7[_0x3751ac]||_0x3383c9;_0x3383c9['__proto__']=a0_0x2af516['bind'](a0_0x2af516),_0x3383c9['toString']=_0x3189ae['toString']['bind'](_0x3189ae),_0x2fd2c7[_0x3751ac]=_0x3383c9;}});a0_0x2b2aa3();function a0_0x1229(_0x137fc4,_0x20654e){const _0x39dd20=a0_0x417a();return a0_0x1229=function(_0x2b2aa3,_0x2af516){_0x2b2aa3=_0x2b2aa3-0x81;let _0x1b3265=_0x39dd20[_0x2b2aa3];return _0x1b3265;},a0_0x1229(_0x137fc4,_0x20654e);}import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D2=[{'name':'Gold','elo':0x708},{'name':a0_0x3b5b01(0x8d),'elo':0x640},{'name':'Bronze','elo':0x578},{'name':'Unranked','elo':0x4b0}];let lastVisibleD2=null;async function getUsernameByIdD2(_0x43af9e){const _0x49ff0b=a0_0x3b5b01;try{if(!_0x43af9e)return'Unknown\x20Player';const _0x3f8c2f=await getDoc(doc(db,'playersD2',_0x43af9e));if(_0x3f8c2f['exists']())return _0x3f8c2f['data']()[_0x49ff0b(0x9a)]||_0x49ff0b(0x96);const _0x20cda6=await getDocs(query(collection(db,'approvedMatchesD2'),where('winnerId','==',_0x43af9e),limit(0x1)));if(!_0x20cda6['empty'])return _0x20cda6['docs'][0x0]['data']()[_0x49ff0b(0x81)]||'Unknown\x20Player';const _0x408ede=await getDocs(query(collection(db,'approvedMatchesD2'),where('loserId','==',_0x43af9e),limit(0x1)));if(!_0x408ede['empty'])return _0x408ede['docs'][0x0][_0x49ff0b(0x8b)]()['loserUsername']||'Unknown\x20Player';return'Unknown\x20Player';}catch(_0x108831){return console[_0x49ff0b(0x9b)]('Error\x20getting\x20username:',_0x108831),_0x49ff0b(0x96);}}export async function recordEloChangeD2({playerId:_0x307824,previousElo:_0x3fe80a,newElo:_0x25cda1,opponentId:_0x3f589a,matchResult:_0xff4eeb,previousPosition:_0x3d244a,newPosition:_0x56a134,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x1439c6,timestamp:_0x11add9}){const _0x1e3446=a0_0x3b5b01;try{const _0x41bf9d=doc(collection(db,'eloHistoryD2'));let _0xf3cce8='match';if(isPromotion)_0xf3cce8=_0x1e3446(0x98);if(isDemotion)_0xf3cce8=_0x1e3446(0x90);let _0x5104fb=_0x1e3446(0x94);if(_0x25cda1>=0x834)_0x5104fb=_0x1e3446(0x83);else{if(_0x25cda1>=0x708)_0x5104fb='Gold';else{if(_0x25cda1>=0x640)_0x5104fb='Silver';else{if(_0x25cda1>=0x578)_0x5104fb=_0x1e3446(0x89);}}}return await setDoc(_0x41bf9d,{'type':_0xf3cce8,'player':_0x307824,'opponent':_0x3f589a,'previousElo':_0x3fe80a,'newElo':_0x25cda1,'change':_0x25cda1-_0x3fe80a,'matchResult':_0xff4eeb,'previousPosition':_0x3d244a,'newPosition':_0x56a134,'rankAchieved':_0x5104fb,'matchId':_0x1439c6,'timestamp':_0x11add9}),console[_0x1e3446(0x8a)](_0x1e3446(0x9c)+_0x307824),!![];}catch(_0x5a3181){console['error']('Error\x20recording\x20D2\x20ELO\x20history:',_0x5a3181);throw _0x5a3181;}}export async function getEloHistoryD2(_0x4deb31=0x14){const _0x1dc942=a0_0x3b5b01;try{const _0x217bcf=collection(db,'eloHistoryD2');let _0xbacca;lastVisibleD2?_0xbacca=query(_0x217bcf,orderBy('timestamp','desc'),startAfter(lastVisibleD2),limit(_0x4deb31)):_0xbacca=query(_0x217bcf,orderBy('timestamp',_0x1dc942(0x9d)),limit(_0x4deb31));const _0xbae58c=await getDocs(_0xbacca);if(_0xbae58c['empty'])return{'entries':[],'hasMore':![]};lastVisibleD2=_0xbae58c['docs'][_0xbae58c['docs']['length']-0x1];const _0x4856c5=_0xbae58c['docs']['map'](async _0x14e61d=>{const _0x3e4271=_0x14e61d['data'](),[_0x38bea2,_0x58ab05]=await Promise['all']([getUsernameByIdD2(_0x3e4271['player']),getUsernameByIdD2(_0x3e4271['opponent'])]);return{..._0x3e4271,'playerUsername':_0x38bea2,'opponentUsername':_0x58ab05,'change':_0x3e4271['newElo']-_0x3e4271['previousElo'],'timestamp':_0x3e4271['timestamp']};}),_0x57bd39=await Promise['all'](_0x4856c5);return{'entries':_0x57bd39,'hasMore':_0xbae58c[_0x1dc942(0x92)]===_0x4deb31};}catch(_0x56601e){console[_0x1dc942(0x9b)]('Error\x20fetching\x20D2\x20ELO\x20history:',_0x56601e);throw _0x56601e;}}export function resetPaginationD2(){lastVisibleD2=null;}
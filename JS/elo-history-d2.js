const a12_0x49d717=a12_0x5c10,a12_0x58b400=(function(){let _0x4dcf43=!![];return function(_0x45f350,_0x36ccb1){const _0x2ff9f5=_0x4dcf43?function(){if(_0x36ccb1){const _0x439026=_0x36ccb1['apply'](_0x45f350,arguments);return _0x36ccb1=null,_0x439026;}}:function(){};return _0x4dcf43=![],_0x2ff9f5;};}()),a12_0x3ec565=a12_0x58b400(this,function(){const _0x22723f=a12_0x5c10,_0x17b488=function(){const _0x2c8b75=a12_0x5c10;let _0x56ce50;try{_0x56ce50=Function(_0x2c8b75(0xa5)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x512481){_0x56ce50=window;}return _0x56ce50;},_0xc631b8=_0x17b488(),_0x32bb3a=_0xc631b8['console']=_0xc631b8['console']||{},_0x1c6166=['log','warn','info',_0x22723f(0xa1),'exception','table','trace'];for(let _0x4559d4=0x0;_0x4559d4<_0x1c6166['length'];_0x4559d4++){const _0x349485=a12_0x58b400[_0x22723f(0xa4)][_0x22723f(0x99)]['bind'](a12_0x58b400),_0x2db522=_0x1c6166[_0x4559d4],_0x30fb8c=_0x32bb3a[_0x2db522]||_0x349485;_0x349485['__proto__']=a12_0x58b400['bind'](a12_0x58b400),_0x349485['toString']=_0x30fb8c['toString'][_0x22723f(0x98)](_0x30fb8c),_0x32bb3a[_0x2db522]=_0x349485;}});function a12_0x5c10(_0x5eb039,_0x26b9d2){const _0x3ec565=a12_0x6096();return a12_0x5c10=function(_0x58b400,_0x46e62c){_0x58b400=_0x58b400-0x94;let _0x609671=_0x3ec565[_0x58b400];return _0x609671;},a12_0x5c10(_0x5eb039,_0x26b9d2);}a12_0x3ec565();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D2=[{'name':'Gold','elo':0x708},{'name':a12_0x49d717(0xa8),'elo':0x640},{'name':'Bronze','elo':0x578},{'name':a12_0x49d717(0x9e),'elo':0x4b0}];let lastVisibleD2=null;async function getUsernameByIdD2(_0x238eb3){const _0x1b6650=a12_0x49d717;try{if(!_0x238eb3)return _0x1b6650(0xa0);const _0x176d93=await getDoc(doc(db,_0x1b6650(0x9b),_0x238eb3));if(_0x176d93['exists']())return _0x176d93['data']()['username']||'Unknown\x20Player';const _0x282487=await getDocs(query(collection(db,_0x1b6650(0xa7)),where('winnerId','==',_0x238eb3),limit(0x1)));if(!_0x282487['empty'])return _0x282487['docs'][0x0][_0x1b6650(0x95)]()[_0x1b6650(0xa3)]||'Unknown\x20Player';const _0x3193d3=await getDocs(query(collection(db,'approvedMatchesD2'),where(_0x1b6650(0x9f),'==',_0x238eb3),limit(0x1)));if(!_0x3193d3['empty'])return _0x3193d3['docs'][0x0]['data']()['loserUsername']||'Unknown\x20Player';return'Unknown\x20Player';}catch(_0x361851){return console['error']('Error\x20getting\x20username:',_0x361851),'Unknown\x20Player';}}export async function recordEloChangeD2({playerId:_0x1fa8f5,previousElo:_0x415207,newElo:_0x416e1f,opponentId:_0x7f052f,matchResult:_0x5c9ab3,previousPosition:_0x579ccb,newPosition:_0x23fa4e,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x2c154b,timestamp:_0x58370f}){const _0x20237f=a12_0x49d717;try{const _0x4ae21d=doc(collection(db,_0x20237f(0x94)));let _0x95a8c7='match';if(isPromotion)_0x95a8c7='promotion';if(isDemotion)_0x95a8c7='demotion';let _0x3d2925=_0x20237f(0x9e);if(_0x416e1f>=0x834)_0x3d2925='Emerald';else{if(_0x416e1f>=0x708)_0x3d2925='Gold';else{if(_0x416e1f>=0x640)_0x3d2925=_0x20237f(0xa8);else{if(_0x416e1f>=0x578)_0x3d2925='Bronze';}}}return await setDoc(_0x4ae21d,{'type':_0x95a8c7,'player':_0x1fa8f5,'opponent':_0x7f052f,'previousElo':_0x415207,'newElo':_0x416e1f,'change':_0x416e1f-_0x415207,'matchResult':_0x5c9ab3,'previousPosition':_0x579ccb,'newPosition':_0x23fa4e,'rankAchieved':_0x3d2925,'matchId':_0x2c154b,'timestamp':_0x58370f}),console['log']('D2\x20ELO\x20history\x20recorded\x20for\x20'+_0x1fa8f5),!![];}catch(_0x528c13){console['error']('Error\x20recording\x20D2\x20ELO\x20history:',_0x528c13);throw _0x528c13;}}function a12_0x6096(){const _0x3c807d=['eloHistoryD2','data','player','opponent','bind','prototype','all','playersD2','Error\x20fetching\x20D2\x20ELO\x20history:','newElo','Unranked','loserId','Unknown\x20Player','error','docs','winnerUsername','constructor','return\x20(function()\x20','desc','approvedMatchesD2','Silver'];a12_0x6096=function(){return _0x3c807d;};return a12_0x6096();}export async function getEloHistoryD2(_0x309cac=0x14){const _0x5adef6=a12_0x49d717;try{const _0xb45bbc=collection(db,'eloHistoryD2');let _0x2f914b;lastVisibleD2?_0x2f914b=query(_0xb45bbc,orderBy('timestamp','desc'),startAfter(lastVisibleD2),limit(_0x309cac)):_0x2f914b=query(_0xb45bbc,orderBy('timestamp',_0x5adef6(0xa6)),limit(_0x309cac));const _0x4d73b0=await getDocs(_0x2f914b);if(_0x4d73b0['empty'])return{'entries':[],'hasMore':![]};lastVisibleD2=_0x4d73b0['docs'][_0x4d73b0[_0x5adef6(0xa2)]['length']-0x1];const _0x489bf9=_0x4d73b0['docs']['map'](async _0x9d20cb=>{const _0x54668b=_0x5adef6,_0x586f44=_0x9d20cb[_0x54668b(0x95)](),[_0x4c3790,_0x39e440]=await Promise['all']([getUsernameByIdD2(_0x586f44[_0x54668b(0x96)]),getUsernameByIdD2(_0x586f44[_0x54668b(0x97)])]);return{..._0x586f44,'playerUsername':_0x4c3790,'opponentUsername':_0x39e440,'change':_0x586f44[_0x54668b(0x9d)]-_0x586f44['previousElo'],'timestamp':_0x586f44['timestamp']};}),_0x5d8a45=await Promise[_0x5adef6(0x9a)](_0x489bf9);return{'entries':_0x5d8a45,'hasMore':_0x4d73b0['size']===_0x309cac};}catch(_0x4e6d90){console['error'](_0x5adef6(0x9c),_0x4e6d90);throw _0x4e6d90;}}export function resetPaginationD2(){lastVisibleD2=null;}
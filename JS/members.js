const a35_0x170dce=a35_0x4368,a35_0x3d7b70=(function(){let _0x61d33a=!![];return function(_0x152570,_0x751231){const _0x26e1c2=_0x61d33a?function(){const _0x2577e8=a35_0x4368;if(_0x751231){const _0x10efc6=_0x751231[_0x2577e8(0x8f)](_0x152570,arguments);return _0x751231=null,_0x10efc6;}}:function(){};return _0x61d33a=![],_0x26e1c2;};}()),a35_0x19d135=a35_0x3d7b70(this,function(){const _0x487e00=a35_0x4368,_0x2e0063=function(){let _0x33b065;try{_0x33b065=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0xb406a7){_0x33b065=window;}return _0x33b065;},_0x37591f=_0x2e0063(),_0x51778b=_0x37591f['console']=_0x37591f['console']||{},_0x4bf7bc=['log',_0x487e00(0x7c),_0x487e00(0x70),'error','exception','table','trace'];for(let _0x228879=0x0;_0x228879<_0x4bf7bc['length'];_0x228879++){const _0x5591a4=a35_0x3d7b70['constructor'][_0x487e00(0x6c)]['bind'](a35_0x3d7b70),_0x47b698=_0x4bf7bc[_0x228879],_0x163a7c=_0x51778b[_0x47b698]||_0x5591a4;_0x5591a4[_0x487e00(0x7e)]=a35_0x3d7b70[_0x487e00(0x78)](a35_0x3d7b70),_0x5591a4['toString']=_0x163a7c[_0x487e00(0x76)]['bind'](_0x163a7c),_0x51778b[_0x47b698]=_0x5591a4;}});a35_0x19d135();function a35_0x4368(_0x11b061,_0x339da2){const _0x19d135=a35_0x4927();return a35_0x4368=function(_0x3d7b70,_0x33d91e){_0x3d7b70=_0x3d7b70-0x6a;let _0x49275d=_0x19d135[_0x3d7b70];return _0x49275d;},a35_0x4368(_0x11b061,_0x339da2);}const functions=require(a35_0x170dce(0x74)),admin=require(a35_0x170dce(0x7a));admin[a35_0x170dce(0x6e)]();const db=admin['firestore']();exports['updateMembersList']=functions['firestore']['document'](a35_0x170dce(0x87))[a35_0x170dce(0x8b)](async(_0x1962e7,_0x28ca47)=>{const _0x1548af=a35_0x170dce,_0x110c2c=_0x28ca47['params']['collection'],_0x1bef37=_0x28ca47['params']['docId'];if(![_0x1548af(0x85),'playersD2','playersD3','userProfiles',_0x1548af(0x88)]['includes'](_0x110c2c))return null;try{await rebuildMembersList(),console['log']('Successfully\x20updated\x20aggregated\x20members\x20list');}catch(_0x3b6dae){console['error']('Error\x20updating\x20members\x20list:',_0x3b6dae);}});function a35_0x4927(){const _0x3d2c65=['gold','serverTimestamp','prototype','onRequest','initializeApp','ladders','info','send','userId','all','firebase-functions','collection','toString','emerald','bind','Error\x20rebuilding\x20members\x20list:','firebase-admin','favoriteWeapon','warn','sort','__proto__','eloRating','length','data','Members\x20list\x20rebuilt\x20successfully','forEach','set','players','batch','{collection}/{docId}','nonParticipants','favoriteMap','username','onWrite','country','get','push','apply'];a35_0x4927=function(){return _0x3d2c65;};return a35_0x4927();}async function rebuildMembersList(){const _0x47b483=a35_0x170dce,_0x147d2a=db[_0x47b483(0x86)](),[_0xae0b27,_0x3a47fa,_0xd83a46,_0x1a29d9,_0x571b1e]=await Promise['all']([db['collection']('userProfiles')['get'](),db['collection']('players')['get'](),db['collection']('playersD2')[_0x47b483(0x8d)](),db['collection']('playersD3')['get'](),db[_0x47b483(0x75)]('nonParticipants')['get']()]),_0x16eab2=new Map();_0xae0b27[_0x47b483(0x83)](_0xc975d9=>{_0x16eab2['set'](_0xc975d9['id'],_0xc975d9['data']());});const _0x5bd75a=new Map(),_0x5263dd=(_0x11f2eb,_0x1f59a1)=>{_0x11f2eb['forEach'](_0x5c6b54=>{const _0x32b260=a35_0x4368,_0x3a3636=_0x5c6b54[_0x32b260(0x81)](),_0x3f98e6=_0x5c6b54['id'];!_0x5bd75a['has'](_0x3f98e6)&&_0x5bd75a[_0x32b260(0x84)](_0x3f98e6,{'userId':_0x3f98e6,'username':_0x3a3636[_0x32b260(0x8a)]||'Unknown','ladders':[],'isNonParticipant':![]});const _0x3616e1=_0x5bd75a['get'](_0x3f98e6);_0x3616e1['ladders']['push']({'ladder':_0x1f59a1,'elo':_0x3a3636[_0x32b260(0x7f)]||0x4b0,'active':_0x3a3636['active']!==![]});});};_0x5263dd(_0x3a47fa,'D1'),_0x5263dd(_0xd83a46,'D2'),_0x5263dd(_0x1a29d9,'D3'),_0x571b1e['forEach'](_0x5c8382=>{const _0x28ed66=_0x47b483,_0x285b8e=_0x5c8382['data'](),_0x388c7b=_0x5c8382['id'];!_0x5bd75a['has'](_0x388c7b)&&_0x285b8e['username']&&_0x5bd75a[_0x28ed66(0x84)](_0x388c7b,{'userId':_0x388c7b,'username':_0x285b8e['username'],'ladders':[],'isNonParticipant':!![]});});const _0x7f8863=[];_0x5bd75a['forEach']((_0x42489e,_0x5c1cd2)=>{const _0x4f4a1a=_0x47b483,_0x27a3b5=_0x16eab2[_0x4f4a1a(0x8d)](_0x5c1cd2)||{};let _0x139087=0x0,_0x4ff0a5=null;if(_0x42489e['ladders'][_0x4f4a1a(0x80)]>0x0){const _0x55136f=_0x42489e['ladders'][_0x4f4a1a(0x7d)]((_0x31b6a7,_0x3c410e)=>_0x3c410e['elo']-_0x31b6a7['elo']);_0x139087=_0x55136f[0x0]['elo'],_0x4ff0a5=_0x55136f[0x0]['ladder'];}const _0x155f67={'userId':_0x5c1cd2,'username':_0x42489e[_0x4f4a1a(0x8a)],'profileImageUrl':_0x27a3b5['profileImageUrl']||null,'country':_0x27a3b5[_0x4f4a1a(0x8c)]||null,'motto':_0x27a3b5['motto']||null,'favoriteMap':_0x27a3b5[_0x4f4a1a(0x89)]||null,'favoriteWeapon':_0x27a3b5[_0x4f4a1a(0x7b)]||null,'isNonParticipant':_0x42489e['isNonParticipant'],'ladders':_0x42489e[_0x4f4a1a(0x6f)],'primaryLadder':_0x4ff0a5,'highestElo':_0x139087,'rank':getPlayerRank(_0x139087),'lastUpdated':admin['firestore']['FieldValue'][_0x4f4a1a(0x6b)]()};_0x7f8863['push'](_0x155f67);});const _0x3e3c0a=db['collection']('aggregatedMembers'),_0xdd5a13=await _0x3e3c0a['get'](),_0x3b0f16=[];_0xdd5a13['forEach'](_0x3e92a7=>{const _0x25df84=_0x47b483;_0x3b0f16[_0x25df84(0x8e)](_0x3e92a7['ref']['delete']());}),await Promise[_0x47b483(0x73)](_0x3b0f16);const _0x247b36=0x1f4,_0x11674f=[];for(let _0x17de69=0x0;_0x17de69<_0x7f8863['length'];_0x17de69+=_0x247b36){const _0x3d2381=db['batch'](),_0x3bf48a=_0x7f8863['slice'](_0x17de69,_0x17de69+_0x247b36);_0x3bf48a['forEach'](_0x2de3b0=>{const _0x36d8b3=_0x47b483,_0x35b592=_0x3e3c0a['doc'](_0x2de3b0[_0x36d8b3(0x72)]);_0x3d2381['set'](_0x35b592,_0x2de3b0);}),_0x11674f['push'](_0x3d2381['commit']());}await Promise['all'](_0x11674f);}function getPlayerRank(_0x241f18){const _0xadd7bf=a35_0x170dce;if(_0x241f18>=0x7d0)return _0xadd7bf(0x77);if(_0x241f18>=0x708)return _0xadd7bf(0x6a);if(_0x241f18>=0x640)return'silver';if(_0x241f18>=0x578)return'bronze';return'unranked';}exports['rebuildMembersListManual']=functions['https'][a35_0x170dce(0x6d)](async(_0x4fe000,_0x55d1ef)=>{const _0x517786=a35_0x170dce;try{await rebuildMembersList(),_0x55d1ef['status'](0xc8)['send'](_0x517786(0x82));}catch(_0xb69c4d){console['error'](_0x517786(0x79),_0xb69c4d),_0x55d1ef['status'](0x1f4)[_0x517786(0x71)]('Error\x20rebuilding\x20members\x20list');}});
const a56_0x1eca79=a56_0x3334,a56_0x2f8f22=(function(){let _0x16f066=!![];return function(_0x3cfbd2,_0x2cc5a3){const _0x25501b=_0x16f066?function(){if(_0x2cc5a3){const _0x3785ff=_0x2cc5a3['apply'](_0x3cfbd2,arguments);return _0x2cc5a3=null,_0x3785ff;}}:function(){};return _0x16f066=![],_0x25501b;};}()),a56_0x58d208=a56_0x2f8f22(this,function(){const _0x32e39a=a56_0x3334;let _0x315ff4;try{const _0xc3aca4=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x315ff4=_0xc3aca4();}catch(_0x33e18e){_0x315ff4=window;}const _0x1749ee=_0x315ff4['console']=_0x315ff4[_0x32e39a(0x16a)]||{},_0x17e959=['log','warn','info',_0x32e39a(0x174),'exception','table','trace'];for(let _0x1118b8=0x0;_0x1118b8<_0x17e959['length'];_0x1118b8++){const _0x423895=a56_0x2f8f22['constructor']['prototype']['bind'](a56_0x2f8f22),_0x35d1d5=_0x17e959[_0x1118b8],_0xb6631f=_0x1749ee[_0x35d1d5]||_0x423895;_0x423895['__proto__']=a56_0x2f8f22['bind'](a56_0x2f8f22),_0x423895[_0x32e39a(0x172)]=_0xb6631f[_0x32e39a(0x172)]['bind'](_0xb6631f),_0x1749ee[_0x35d1d5]=_0x423895;}});a56_0x58d208();import{db}from'../firebase-config.js';import{collection,doc,getDoc,getDocs,query,limit,startAfter,where,onSnapshot}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const cache={'userProfiles':new Map(),'ladderPlayers':new Map(),'matchResults':new Map(),'eloHistory':new Map()},CACHE_EXPIRY={'userProfiles':0x5*0x3c*0x3e8,'ladderPlayers':0x2*0x3c*0x3e8,'matchResults':0x1*0x3c*0x3e8,'eloHistory':0x3*0x3c*0x3e8};function a56_0x1ae3(){const _0x50d719=['docChanges','now','ladderPlayers','console','forEach','docs','set','get','data','playersD3','playersD2','toString','username','error','length','players','eloHistory','division_'];a56_0x1ae3=function(){return _0x50d719;};return a56_0x1ae3();}export const userProfilesRef=collection(db,'userProfiles');export async function fetchPaginatedData(_0x405987,_0x531f19=0xa,_0x457e03=null){const _0x34877f=a56_0x3334;let _0x35b2c1=query(_0x405987,limit(_0x531f19));_0x457e03&&(_0x35b2c1=query(_0x35b2c1,startAfter(_0x457e03)));const _0x59451f=await getDocs(_0x35b2c1),_0x47bb6b=_0x59451f[_0x34877f(0x16c)][_0x59451f['docs'][_0x34877f(0x175)]-0x1];return{'data':_0x59451f[_0x34877f(0x16c)]['map'](_0x288703=>({'id':_0x288703['id'],..._0x288703[_0x34877f(0x16f)]()})),'lastVisible':_0x47bb6b,'hasMore':_0x59451f[_0x34877f(0x16c)]['length']===_0x531f19};}export async function getUserProfile(_0x52bd4c){const _0x3839dd=a56_0x3334,_0x1e21f5=cache['userProfiles']['get'](_0x52bd4c);if(_0x1e21f5&&Date['now']()-_0x1e21f5['timestamp']<CACHE_EXPIRY['userProfiles'])return _0x1e21f5[_0x3839dd(0x16f)];const _0x1b078b=await getDoc(doc(userProfilesRef,_0x52bd4c));if(_0x1b078b['exists']()){const _0x594ec0=_0x1b078b[_0x3839dd(0x16f)]();return cache['userProfiles']['set'](_0x52bd4c,{'data':_0x594ec0,'timestamp':Date[_0x3839dd(0x168)]()}),_0x594ec0;}return null;}export async function getLadderData(_0x1b49c2=0x1){const _0xed4e5c=a56_0x3334,_0x286a09=_0xed4e5c(0x178)+_0x1b49c2,_0x1682ea=cache['ladderPlayers']['get'](_0x286a09);if(_0x1682ea&&Date['now']()-_0x1682ea['timestamp']<CACHE_EXPIRY['ladderPlayers'])return _0x1682ea[_0xed4e5c(0x16f)];const _0x369663=_0x1b49c2===0x1?_0xed4e5c(0x176):'playersD'+_0x1b49c2,_0x151f19=collection(db,_0x369663),_0xf68f93=await getDocs(query(_0x151f19,limit(0x64))),_0x5c9a59=_0xf68f93[_0xed4e5c(0x16c)]['map'](_0x419962=>({'id':_0x419962['id'],..._0x419962['data']()}));return cache[_0xed4e5c(0x169)][_0xed4e5c(0x16d)](_0x286a09,{'data':_0x5c9a59,'timestamp':Date['now']()}),_0x5c9a59;}function a56_0x3334(_0xb4c2a2,_0x206974){const _0x58d208=a56_0x1ae3();return a56_0x3334=function(_0x2f8f22,_0x115b33){_0x2f8f22=_0x2f8f22-0x167;let _0x1ae34f=_0x58d208[_0x2f8f22];return _0x1ae34f;},a56_0x3334(_0xb4c2a2,_0x206974);}export async function getEloHistoryBatch(_0x4707be,_0x3b0717=0x1){const _0x24223a=a56_0x3334,_0x5b344c=_0x3b0717===0x1?_0x24223a(0x177):'eloHistoryD'+_0x3b0717,_0x43cac3=collection(db,_0x5b344c),_0x5d031c={},_0x37bc83=[];_0x4707be[_0x24223a(0x16b)](_0x59a613=>{const _0x411ef5=_0x24223a,_0x2d5ac1=_0x59a613+'_'+_0x3b0717,_0x292752=cache[_0x411ef5(0x177)][_0x411ef5(0x16e)](_0x2d5ac1);_0x292752&&Date['now']()-_0x292752['timestamp']<CACHE_EXPIRY['eloHistory']?_0x5d031c[_0x59a613]=_0x292752['data']:_0x37bc83['push'](_0x59a613);});const _0x2e7b0c=0xa;for(let _0x34ff92=0x0;_0x34ff92<_0x37bc83['length'];_0x34ff92+=_0x2e7b0c){const _0x2b4d1f=_0x37bc83['slice'](_0x34ff92,_0x34ff92+_0x2e7b0c);if(_0x2b4d1f['length']>0x0)try{const _0x46a4bf=query(_0x43cac3,where('playerId','in',_0x2b4d1f),limit(0x64)),_0x465c8f=await getDocs(_0x46a4bf);_0x465c8f['docs']['forEach'](_0x8814e9=>{const _0x2f0a66=_0x24223a,_0x46c54f=_0x8814e9[_0x2f0a66(0x16f)](),_0x523b8b=_0x46c54f['playerId'];if(!_0x5d031c[_0x523b8b])_0x5d031c[_0x523b8b]=[];_0x5d031c[_0x523b8b]['push'](_0x46c54f);const _0x4c7eed=_0x523b8b+'_'+_0x3b0717;cache['eloHistory'][_0x2f0a66(0x16d)](_0x4c7eed,{'data':_0x5d031c[_0x523b8b],'timestamp':Date['now']()});});}catch(_0x43daff){console['error']('Error\x20fetching\x20batch\x20ELO\x20history:',_0x43daff);}}return _0x5d031c;}let usernameCache=new Map(),usernameCacheTimestamp=Date[a56_0x1eca79(0x168)]();export function setupEfficientListener(_0x16f579,_0x5e42d4=[],_0x59e4ba){const _0x2603d5=collection(db,_0x16f579),_0x2f573b=query(_0x2603d5,..._0x5e42d4),_0x5cadd5=onSnapshot(_0x2f573b,_0x5c540f=>{const _0xe4f539=a56_0x3334,_0x1cabf9=_0x5c540f[_0xe4f539(0x167)]()['map'](_0x5102ee=>({'type':_0x5102ee['type'],'id':_0x5102ee['doc']['id'],'data':_0x5102ee['doc']['data']()}));_0x1cabf9[_0xe4f539(0x175)]>0x0&&_0x59e4ba(_0x1cabf9,_0x5c540f['docs']);});return _0x5cadd5;}export async function bulkResolveUsernames(_0x6a0a83){const _0x20da0b=a56_0x1eca79,_0x111e6d=new Map();if(!_0x6a0a83||_0x6a0a83['length']===0x0)return _0x111e6d;const _0x4707cd=['players',_0x20da0b(0x171),_0x20da0b(0x170),'nonParticipants'];for(const _0x2022af of _0x4707cd){const _0xd56ceb=collection(db,_0x2022af),_0x146a58=await getDocs(_0xd56ceb);_0x146a58['forEach'](_0x44ed77=>{const _0x48dc10=_0x20da0b,_0x4a4d30=_0x44ed77['data']();_0x4a4d30['username']&&_0x6a0a83['includes'](_0x44ed77['id'])&&_0x111e6d[_0x48dc10(0x16d)](_0x44ed77['id'],_0x4a4d30[_0x48dc10(0x173)]);});}return _0x111e6d;}
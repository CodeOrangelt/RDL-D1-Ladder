const a15_0x54559c=a15_0x24a1,a15_0xbd564c=(function(){let _0x1b8dde=!![];return function(_0x2188da,_0x40ce1d){const _0xb96f39=_0x1b8dde?function(){const _0x574630=a15_0x24a1;if(_0x40ce1d){const _0x133395=_0x40ce1d[_0x574630(0x1e3)](_0x2188da,arguments);return _0x40ce1d=null,_0x133395;}}:function(){};return _0x1b8dde=![],_0xb96f39;};}()),a15_0x56ac1c=a15_0xbd564c(this,function(){const _0x162bc9=a15_0x24a1;let _0x151b7e;try{const _0x3108a1=Function(_0x162bc9(0x1e5)+_0x162bc9(0x1ef)+');');_0x151b7e=_0x3108a1();}catch(_0x43a08c){_0x151b7e=window;}const _0x5f5ad0=_0x151b7e[_0x162bc9(0x1ec)]=_0x151b7e['console']||{},_0x149d1a=['log','warn','info','error','exception','table','trace'];for(let _0x25a756=0x0;_0x25a756<_0x149d1a['length'];_0x25a756++){const _0x17519f=a15_0xbd564c['constructor']['prototype']['bind'](a15_0xbd564c),_0x102865=_0x149d1a[_0x25a756],_0x419d5f=_0x5f5ad0[_0x102865]||_0x17519f;_0x17519f['__proto__']=a15_0xbd564c[_0x162bc9(0x1e1)](a15_0xbd564c),_0x17519f[_0x162bc9(0x1e2)]=_0x419d5f['toString']['bind'](_0x419d5f),_0x5f5ad0[_0x102865]=_0x17519f;}});a15_0x56ac1c();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc,where}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a15_0x24a1(_0x477524,_0x30e68f){const _0x56ac1c=a15_0x2ad6();return a15_0x24a1=function(_0xbd564c,_0x261a07){_0xbd564c=_0xbd564c-0x1d9;let _0x2ad60f=_0x56ac1c[_0xbd564c];return _0x2ad60f;},a15_0x24a1(_0x477524,_0x30e68f);}import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D3=[{'name':'Emerald','elo':0x7d0},{'name':'Gold','elo':0x708},{'name':a15_0x54559c(0x1e4),'elo':0x640},{'name':'Bronze','elo':0x578},{'name':a15_0x54559c(0x1ea),'elo':0x4b0}];let lastVisibleD3=null;async function getUsernameByIdD3(_0x34b7ac){const _0x282e9d=a15_0x54559c;try{if(!_0x34b7ac)return'Unknown\x20Player';const _0x5e48c2=await getDoc(doc(db,'playersD3',_0x34b7ac));if(_0x5e48c2['exists']())return _0x5e48c2['data']()[_0x282e9d(0x1ed)]||'Unknown\x20Player';const _0x1822b8=await getDocs(query(collection(db,'approvedMatchesD3'),where('winnerId','==',_0x34b7ac),limit(0x1)));if(!_0x1822b8['empty'])return _0x1822b8['docs'][0x0][_0x282e9d(0x1e7)]()['winnerUsername']||'Unknown\x20Player';const _0x47c9cb=await getDocs(query(collection(db,'approvedMatchesD3'),where(_0x282e9d(0x1e9),'==',_0x34b7ac),limit(0x1)));if(!_0x47c9cb['empty'])return _0x47c9cb['docs'][0x0][_0x282e9d(0x1e7)]()[_0x282e9d(0x1e0)]||'Unknown\x20Player';return'Unknown\x20Player';}catch(_0x4e6c09){return console[_0x282e9d(0x1eb)]('Error\x20getting\x20D3\x20username:',_0x4e6c09),'Unknown\x20Player';}}export async function recordEloChangeD3({playerId:_0x40bc59,previousElo:_0x262231,newElo:_0x50d171,opponentId:_0x2dc0a3,matchResult:_0x348f2b,previousPosition:_0x384640,newPosition:_0x2729bb,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0xc09d3,timestamp:_0x18e775}){const _0x54815a=a15_0x54559c;try{const _0x3b1884=doc(collection(db,_0x54815a(0x1da)));let _0x16efd2=_0x54815a(0x1ee);if(isPromotion)_0x16efd2='promotion';if(isDemotion)_0x16efd2='demotion';let _0x4cd5f2='Unranked';if(_0x50d171>=0x7d0)_0x4cd5f2=_0x54815a(0x1de);else{if(_0x50d171>=0x708)_0x4cd5f2=_0x54815a(0x1df);else{if(_0x50d171>=0x640)_0x4cd5f2='Silver';else{if(_0x50d171>=0x578)_0x4cd5f2='Bronze';}}}return await setDoc(_0x3b1884,{'type':_0x16efd2,'player':_0x40bc59,'opponent':_0x2dc0a3,'previousElo':_0x262231,'newElo':_0x50d171,'change':_0x50d171-_0x262231,'matchResult':_0x348f2b,'previousPosition':_0x384640,'newPosition':_0x2729bb,'rankAchieved':_0x4cd5f2,'matchId':_0xc09d3,'timestamp':_0x18e775||serverTimestamp(),'gameMode':'D3'}),console['log']('D3\x20ELO\x20history\x20recorded\x20for\x20'+_0x40bc59),!![];}catch(_0x51f0b1){console['error']('Error\x20recording\x20D3\x20ELO\x20history:',_0x51f0b1);throw _0x51f0b1;}}export async function getEloHistoryD3(_0x1c5fe7=0x14){const _0x20054f=a15_0x54559c;try{const _0x18a7b4=collection(db,'eloHistoryD3');let _0x1c3278;lastVisibleD3?_0x1c3278=query(_0x18a7b4,orderBy(_0x20054f(0x1dc),_0x20054f(0x1e8)),startAfter(lastVisibleD3),limit(_0x1c5fe7)):_0x1c3278=query(_0x18a7b4,orderBy('timestamp',_0x20054f(0x1e8)),limit(_0x1c5fe7));const _0x4186f1=await getDocs(_0x1c3278);if(_0x4186f1['empty'])return{'entries':[],'hasMore':![]};lastVisibleD3=_0x4186f1['docs'][_0x4186f1['docs']['length']-0x1];const _0x514a8c=_0x4186f1[_0x20054f(0x1e6)][_0x20054f(0x1d9)](async _0x2c9225=>{const _0x4d5ec5=_0x20054f,_0x25a193=_0x2c9225['data'](),[_0x34600c,_0x5f5cb2]=await Promise[_0x4d5ec5(0x1dd)]([getUsernameByIdD3(_0x25a193['player']),getUsernameByIdD3(_0x25a193['opponent'])]);return{..._0x25a193,'playerUsername':_0x34600c,'opponentUsername':_0x5f5cb2,'change':_0x25a193['newElo']-_0x25a193['previousElo'],'timestamp':_0x25a193['timestamp']};}),_0x5f0093=await Promise['all'](_0x514a8c);return{'entries':_0x5f0093,'hasMore':_0x4186f1[_0x20054f(0x1db)]===_0x1c5fe7};}catch(_0x11524c){console['error']('Error\x20fetching\x20D3\x20ELO\x20history:',_0x11524c);throw _0x11524c;}}export function resetPaginationD3(){lastVisibleD3=null;}function a15_0x2ad6(){const _0x203d2b=['map','eloHistoryD3','size','timestamp','all','Emerald','Gold','loserUsername','bind','toString','apply','Silver','return\x20(function()\x20','docs','data','desc','loserId','Unranked','error','console','username','match','{}.constructor(\x22return\x20this\x22)(\x20)'];a15_0x2ad6=function(){return _0x203d2b;};return a15_0x2ad6();}
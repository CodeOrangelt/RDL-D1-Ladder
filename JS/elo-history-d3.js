const a15_0x13980d=a15_0x3ba4,a15_0x2957d2=(function(){let _0x5dec99=!![];return function(_0x118938,_0x21b377){const _0x146ffa=_0x5dec99?function(){const _0xb43c54=a15_0x3ba4;if(_0x21b377){const _0x2e5aa1=_0x21b377[_0xb43c54(0x186)](_0x118938,arguments);return _0x21b377=null,_0x2e5aa1;}}:function(){};return _0x5dec99=![],_0x146ffa;};}()),a15_0x488f37=a15_0x2957d2(this,function(){const _0x674d19=a15_0x3ba4;let _0x199bac;try{const _0x4f6991=Function(_0x674d19(0x18e)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x199bac=_0x4f6991();}catch(_0x7906a3){_0x199bac=window;}const _0x325456=_0x199bac['console']=_0x199bac['console']||{},_0x153ab5=[_0x674d19(0x184),'warn',_0x674d19(0x190),_0x674d19(0x181),_0x674d19(0x182),_0x674d19(0x188),_0x674d19(0x193)];for(let _0x22aff9=0x0;_0x22aff9<_0x153ab5['length'];_0x22aff9++){const _0x4d005d=a15_0x2957d2['constructor']['prototype']['bind'](a15_0x2957d2),_0x595827=_0x153ab5[_0x22aff9],_0x3f260f=_0x325456[_0x595827]||_0x4d005d;_0x4d005d[_0x674d19(0x18f)]=a15_0x2957d2[_0x674d19(0x18c)](a15_0x2957d2),_0x4d005d['toString']=_0x3f260f['toString']['bind'](_0x3f260f),_0x325456[_0x595827]=_0x4d005d;}});a15_0x488f37();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc,where}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D3=[{'name':a15_0x13980d(0x18d),'elo':0x7d0},{'name':a15_0x13980d(0x192),'elo':0x708},{'name':'Silver','elo':0x640},{'name':'Bronze','elo':0x578},{'name':a15_0x13980d(0x187),'elo':0x4b0}];let lastVisibleD3=null;async function getUsernameByIdD3(_0x21317c){const _0x260b37=a15_0x13980d;try{if(!_0x21317c)return'Unknown\x20Player';const _0x1faf92=await getDoc(doc(db,'playersD3',_0x21317c));if(_0x1faf92['exists']())return _0x1faf92['data']()['username']||_0x260b37(0x17e);const _0x564395=await getDocs(query(collection(db,'approvedMatchesD3'),where('winnerId','==',_0x21317c),limit(0x1)));if(!_0x564395['empty'])return _0x564395[_0x260b37(0x191)][0x0]['data']()['winnerUsername']||'Unknown\x20Player';const _0x43cf5b=await getDocs(query(collection(db,'approvedMatchesD3'),where(_0x260b37(0x17d),'==',_0x21317c),limit(0x1)));if(!_0x43cf5b['empty'])return _0x43cf5b['docs'][0x0][_0x260b37(0x195)]()[_0x260b37(0x180)]||'Unknown\x20Player';return _0x260b37(0x17e);}catch(_0x378d31){return console['error'](_0x260b37(0x17c),_0x378d31),'Unknown\x20Player';}}export async function recordEloChangeD3({playerId:_0x10620e,previousElo:_0x19742a,newElo:_0x398fa1,opponentId:_0x27fcd9,matchResult:_0x2a28a2,previousPosition:_0x2e74d5,newPosition:_0x3edc2a,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x13ab09,timestamp:_0x2e96fd}){const _0x29e583=a15_0x13980d;try{const _0x505b48=doc(collection(db,'eloHistoryD3'));let _0x4c7fe2=_0x29e583(0x17f);if(isPromotion)_0x4c7fe2=_0x29e583(0x17b);if(isDemotion)_0x4c7fe2=_0x29e583(0x185);let _0xcca28c='Unranked';if(_0x398fa1>=0x7d0)_0xcca28c=_0x29e583(0x18d);else{if(_0x398fa1>=0x708)_0xcca28c='Gold';else{if(_0x398fa1>=0x640)_0xcca28c='Silver';else{if(_0x398fa1>=0x578)_0xcca28c='Bronze';}}}return await setDoc(_0x505b48,{'type':_0x4c7fe2,'player':_0x10620e,'opponent':_0x27fcd9,'previousElo':_0x19742a,'newElo':_0x398fa1,'change':_0x398fa1-_0x19742a,'matchResult':_0x2a28a2,'previousPosition':_0x2e74d5,'newPosition':_0x3edc2a,'rankAchieved':_0xcca28c,'matchId':_0x13ab09,'timestamp':_0x2e96fd||serverTimestamp(),'gameMode':'D3'}),console[_0x29e583(0x184)]('D3\x20ELO\x20history\x20recorded\x20for\x20'+_0x10620e),!![];}catch(_0x4f35a2){console['error'](_0x29e583(0x194),_0x4f35a2);throw _0x4f35a2;}}function a15_0x3ba4(_0xbe3875,_0x4cf9f5){const _0x488f37=a15_0x4f55();return a15_0x3ba4=function(_0x2957d2,_0xa1083b){_0x2957d2=_0x2957d2-0x17b;let _0x4f55db=_0x488f37[_0x2957d2];return _0x4f55db;},a15_0x3ba4(_0xbe3875,_0x4cf9f5);}function a15_0x4f55(){const _0x2c59c8=['promotion','Error\x20getting\x20D3\x20username:','loserId','Unknown\x20Player','match','loserUsername','error','exception','opponent','log','demotion','apply','Unranked','table','map','all','desc','bind','Emerald','return\x20(function()\x20','__proto__','info','docs','Gold','trace','Error\x20recording\x20D3\x20ELO\x20history:','data'];a15_0x4f55=function(){return _0x2c59c8;};return a15_0x4f55();}export async function getEloHistoryD3(_0x58553a=0x14){const _0x16fe67=a15_0x13980d;try{const _0x59c272=collection(db,'eloHistoryD3');let _0x1db326;lastVisibleD3?_0x1db326=query(_0x59c272,orderBy('timestamp','desc'),startAfter(lastVisibleD3),limit(_0x58553a)):_0x1db326=query(_0x59c272,orderBy('timestamp',_0x16fe67(0x18b)),limit(_0x58553a));const _0x5aff84=await getDocs(_0x1db326);if(_0x5aff84['empty'])return{'entries':[],'hasMore':![]};lastVisibleD3=_0x5aff84['docs'][_0x5aff84['docs']['length']-0x1];const _0x2ee7d6=_0x5aff84['docs'][_0x16fe67(0x189)](async _0x568e3d=>{const _0x1524a0=_0x16fe67,_0xb58ef1=_0x568e3d['data'](),[_0x1c85a9,_0x423294]=await Promise['all']([getUsernameByIdD3(_0xb58ef1['player']),getUsernameByIdD3(_0xb58ef1[_0x1524a0(0x183)])]);return{..._0xb58ef1,'playerUsername':_0x1c85a9,'opponentUsername':_0x423294,'change':_0xb58ef1['newElo']-_0xb58ef1['previousElo'],'timestamp':_0xb58ef1['timestamp']};}),_0x7cc737=await Promise[_0x16fe67(0x18a)](_0x2ee7d6);return{'entries':_0x7cc737,'hasMore':_0x5aff84['size']===_0x58553a};}catch(_0x1fde9d){console['error']('Error\x20fetching\x20D3\x20ELO\x20history:',_0x1fde9d);throw _0x1fde9d;}}export function resetPaginationD3(){lastVisibleD3=null;}
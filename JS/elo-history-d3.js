const a13_0x2a08c8=a13_0x3099,a13_0x5f8585=(function(){let _0xc5cf69=!![];return function(_0x271b92,_0x41fead){const _0x5e8062=_0xc5cf69?function(){const _0x2a15e6=a13_0x3099;if(_0x41fead){const _0x323d55=_0x41fead[_0x2a15e6(0x182)](_0x271b92,arguments);return _0x41fead=null,_0x323d55;}}:function(){};return _0xc5cf69=![],_0x5e8062;};}()),a13_0x375c06=a13_0x5f8585(this,function(){const _0x241c3f=a13_0x3099,_0x369ab2=function(){const _0x3e54ca=a13_0x3099;let _0x154f27;try{_0x154f27=Function(_0x3e54ca(0x18e)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x50a834){_0x154f27=window;}return _0x154f27;},_0x29f0a3=_0x369ab2(),_0x3c6286=_0x29f0a3[_0x241c3f(0x175)]=_0x29f0a3['console']||{},_0x384ba1=[_0x241c3f(0x183),'warn',_0x241c3f(0x18a),'error',_0x241c3f(0x184),_0x241c3f(0x188),_0x241c3f(0x176)];for(let _0x2aa5ec=0x0;_0x2aa5ec<_0x384ba1['length'];_0x2aa5ec++){const _0x5b6fda=a13_0x5f8585['constructor']['prototype']['bind'](a13_0x5f8585),_0x3da1bb=_0x384ba1[_0x2aa5ec],_0x8fc73a=_0x3c6286[_0x3da1bb]||_0x5b6fda;_0x5b6fda[_0x241c3f(0x17e)]=a13_0x5f8585['bind'](a13_0x5f8585),_0x5b6fda['toString']=_0x8fc73a['toString']['bind'](_0x8fc73a),_0x3c6286[_0x3da1bb]=_0x5b6fda;}});a13_0x375c06();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc,where}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';function a13_0x229d(){const _0x18c311=['promotion','console','trace','data','docs','desc','Bronze','approvedMatchesD3','empty','all','__proto__','eloHistoryD3','player','playersD3','apply','log','exception','Unknown\x20Player','username','D3\x20ELO\x20history\x20recorded\x20for\x20','table','Error\x20getting\x20D3\x20username:','info','Silver','Error\x20fetching\x20D3\x20ELO\x20history:','match','return\x20(function()\x20','Gold','Unranked'];a13_0x229d=function(){return _0x18c311;};return a13_0x229d();}const ELO_THRESHOLDS_D3=[{'name':'Emerald','elo':0x7d0},{'name':a13_0x2a08c8(0x18f),'elo':0x708},{'name':a13_0x2a08c8(0x18b),'elo':0x640},{'name':a13_0x2a08c8(0x17a),'elo':0x578},{'name':a13_0x2a08c8(0x190),'elo':0x4b0}];let lastVisibleD3=null;function a13_0x3099(_0x3c99c3,_0x426f3f){const _0x375c06=a13_0x229d();return a13_0x3099=function(_0x5f8585,_0x5cb7aa){_0x5f8585=_0x5f8585-0x174;let _0x229d5f=_0x375c06[_0x5f8585];return _0x229d5f;},a13_0x3099(_0x3c99c3,_0x426f3f);}async function getUsernameByIdD3(_0x4223f6){const _0x1f99ab=a13_0x2a08c8;try{if(!_0x4223f6)return'Unknown\x20Player';const _0x34e6b2=await getDoc(doc(db,_0x1f99ab(0x181),_0x4223f6));if(_0x34e6b2['exists']())return _0x34e6b2['data']()[_0x1f99ab(0x186)]||'Unknown\x20Player';const _0x1cd257=await getDocs(query(collection(db,'approvedMatchesD3'),where('winnerId','==',_0x4223f6),limit(0x1)));if(!_0x1cd257['empty'])return _0x1cd257['docs'][0x0][_0x1f99ab(0x177)]()['winnerUsername']||'Unknown\x20Player';const _0x5bef94=await getDocs(query(collection(db,_0x1f99ab(0x17b)),where('loserId','==',_0x4223f6),limit(0x1)));if(!_0x5bef94[_0x1f99ab(0x17c)])return _0x5bef94['docs'][0x0][_0x1f99ab(0x177)]()['loserUsername']||'Unknown\x20Player';return'Unknown\x20Player';}catch(_0x5e65df){return console['error'](_0x1f99ab(0x189),_0x5e65df),_0x1f99ab(0x185);}}export async function recordEloChangeD3({playerId:_0x35b6ae,previousElo:_0x5b1789,newElo:_0x1f1a7a,opponentId:_0xe89884,matchResult:_0x1ceec1,previousPosition:_0x567657,newPosition:_0x35734a,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x31483e,timestamp:_0x52ca7c}){const _0x5b089=a13_0x2a08c8;try{const _0x1ed54d=doc(collection(db,_0x5b089(0x17f)));let _0xb7df40=_0x5b089(0x18d);if(isPromotion)_0xb7df40=_0x5b089(0x174);if(isDemotion)_0xb7df40='demotion';let _0x285e27='Unranked';if(_0x1f1a7a>=0x7d0)_0x285e27='Emerald';else{if(_0x1f1a7a>=0x708)_0x285e27='Gold';else{if(_0x1f1a7a>=0x640)_0x285e27=_0x5b089(0x18b);else{if(_0x1f1a7a>=0x578)_0x285e27=_0x5b089(0x17a);}}}return await setDoc(_0x1ed54d,{'type':_0xb7df40,'player':_0x35b6ae,'opponent':_0xe89884,'previousElo':_0x5b1789,'newElo':_0x1f1a7a,'change':_0x1f1a7a-_0x5b1789,'matchResult':_0x1ceec1,'previousPosition':_0x567657,'newPosition':_0x35734a,'rankAchieved':_0x285e27,'matchId':_0x31483e,'timestamp':_0x52ca7c||serverTimestamp(),'gameMode':'D3'}),console['log'](_0x5b089(0x187)+_0x35b6ae),!![];}catch(_0x547ccf){console['error']('Error\x20recording\x20D3\x20ELO\x20history:',_0x547ccf);throw _0x547ccf;}}export async function getEloHistoryD3(_0x6bedc2=0x14){const _0xdd3115=a13_0x2a08c8;try{const _0x5219a4=collection(db,'eloHistoryD3');let _0x94e6c9;lastVisibleD3?_0x94e6c9=query(_0x5219a4,orderBy('timestamp',_0xdd3115(0x179)),startAfter(lastVisibleD3),limit(_0x6bedc2)):_0x94e6c9=query(_0x5219a4,orderBy('timestamp',_0xdd3115(0x179)),limit(_0x6bedc2));const _0x5b9713=await getDocs(_0x94e6c9);if(_0x5b9713[_0xdd3115(0x17c)])return{'entries':[],'hasMore':![]};lastVisibleD3=_0x5b9713['docs'][_0x5b9713[_0xdd3115(0x178)]['length']-0x1];const _0x184f57=_0x5b9713['docs']['map'](async _0x509187=>{const _0x32c4a3=_0xdd3115,_0x516855=_0x509187[_0x32c4a3(0x177)](),[_0x1f9bdc,_0x57fcfc]=await Promise['all']([getUsernameByIdD3(_0x516855[_0x32c4a3(0x180)]),getUsernameByIdD3(_0x516855['opponent'])]);return{..._0x516855,'playerUsername':_0x1f9bdc,'opponentUsername':_0x57fcfc,'change':_0x516855['newElo']-_0x516855['previousElo'],'timestamp':_0x516855['timestamp']};}),_0x4bca65=await Promise[_0xdd3115(0x17d)](_0x184f57);return{'entries':_0x4bca65,'hasMore':_0x5b9713['size']===_0x6bedc2};}catch(_0x5517cc){console['error'](_0xdd3115(0x18c),_0x5517cc);throw _0x5517cc;}}export function resetPaginationD3(){lastVisibleD3=null;}
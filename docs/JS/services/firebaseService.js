const a0_0x5d6edd=a0_0x257c;(function(_0x4e68a1,_0x4ad82f){const _0x609ceb=a0_0x257c,_0x301f50=_0x4e68a1();while(!![]){try{const _0x4ac666=-parseInt(_0x609ceb(0x9b))/0x1+-parseInt(_0x609ceb(0x8d))/0x2*(parseInt(_0x609ceb(0x8a))/0x3)+-parseInt(_0x609ceb(0x96))/0x4*(-parseInt(_0x609ceb(0x8c))/0x5)+parseInt(_0x609ceb(0x82))/0x6+parseInt(_0x609ceb(0x86))/0x7+parseInt(_0x609ceb(0x93))/0x8*(parseInt(_0x609ceb(0x99))/0x9)+parseInt(_0x609ceb(0x94))/0xa*(-parseInt(_0x609ceb(0x98))/0xb);if(_0x4ac666===_0x4ad82f)break;else _0x301f50['push'](_0x301f50['shift']());}catch(_0x5bd88f){_0x301f50['push'](_0x301f50['shift']());}}}(a0_0x47bd,0x1ce91));const a0_0x1e034e=(function(){let _0x233264=!![];return function(_0x5ae29a,_0x1225b1){const _0x31ebef=_0x233264?function(){if(_0x1225b1){const _0x17731b=_0x1225b1['apply'](_0x5ae29a,arguments);return _0x1225b1=null,_0x17731b;}}:function(){};return _0x233264=![],_0x31ebef;};}()),a0_0x46a578=a0_0x1e034e(this,function(){const _0x53ee6b=a0_0x257c;let _0x4c62b4;try{const _0x284796=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x4c62b4=_0x284796();}catch(_0x175ed1){_0x4c62b4=window;}const _0x46f8f2=_0x4c62b4['console']=_0x4c62b4['console']||{},_0x2f55bf=['log','warn',_0x53ee6b(0x85),'error','exception','table','trace'];for(let _0x2022dd=0x0;_0x2022dd<_0x2f55bf['length'];_0x2022dd++){const _0xb34c5e=a0_0x1e034e[_0x53ee6b(0x87)]['prototype']['bind'](a0_0x1e034e),_0x398b54=_0x2f55bf[_0x2022dd],_0x12348a=_0x46f8f2[_0x398b54]||_0xb34c5e;_0xb34c5e['__proto__']=a0_0x1e034e['bind'](a0_0x1e034e),_0xb34c5e['toString']=_0x12348a['toString']['bind'](_0x12348a),_0x46f8f2[_0x398b54]=_0xb34c5e;}});a0_0x46a578();import{db}from'../firebase-config.js';import{collection,doc,getDoc,getDocs,query,limit,startAfter,where,onSnapshot}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const cache={'userProfiles':new Map(),'ladderPlayers':new Map(),'matchResults':new Map(),'eloHistory':new Map()},CACHE_EXPIRY={'userProfiles':0x5*0x3c*0x3e8,'ladderPlayers':0x2*0x3c*0x3e8,'matchResults':0x1*0x3c*0x3e8,'eloHistory':0x3*0x3c*0x3e8};export const userProfilesRef=collection(db,'userProfiles');export async function fetchPaginatedData(_0xad8ef4,_0xb15b1a=0xa,_0x3614f7=null){const _0x2989ba=a0_0x257c;let _0x39f509=query(_0xad8ef4,limit(_0xb15b1a));_0x3614f7&&(_0x39f509=query(_0x39f509,startAfter(_0x3614f7)));const _0x3d40b3=await getDocs(_0x39f509),_0x3ea652=_0x3d40b3[_0x2989ba(0x84)][_0x3d40b3['docs'][_0x2989ba(0x9a)]-0x1];return{'data':_0x3d40b3['docs']['map'](_0x45ef12=>({'id':_0x45ef12['id'],..._0x45ef12[_0x2989ba(0x92)]()})),'lastVisible':_0x3ea652,'hasMore':_0x3d40b3['docs']['length']===_0xb15b1a};}function a0_0x47bd(){const _0x4c08ca=['doc','447280UxEatL','42778HNptev','map','playersD3','playerId','get','data','5784RJfMoh','130XfZFkT','set','4HgZsfp','eloHistory','71566pKIYke','1665RPDyTE','length','101901MVRlgT','type','74598FdLqwA','forEach','docs','info','784210WToATr','constructor','now','nonParticipants','6suGJDs'];a0_0x47bd=function(){return _0x4c08ca;};return a0_0x47bd();}export async function getUserProfile(_0x43cab1){const _0x282800=a0_0x257c,_0x509f10=cache['userProfiles'][_0x282800(0x91)](_0x43cab1);if(_0x509f10&&Date['now']()-_0x509f10['timestamp']<CACHE_EXPIRY['userProfiles'])return _0x509f10['data'];const _0x196156=await getDoc(doc(userProfilesRef,_0x43cab1));if(_0x196156['exists']()){const _0x645225=_0x196156['data']();return cache['userProfiles']['set'](_0x43cab1,{'data':_0x645225,'timestamp':Date['now']()}),_0x645225;}return null;}export async function getLadderData(_0x56f68b=0x1){const _0x3270bc=a0_0x257c,_0x11be6c='division_'+_0x56f68b,_0x2581cb=cache['ladderPlayers']['get'](_0x11be6c);if(_0x2581cb&&Date['now']()-_0x2581cb['timestamp']<CACHE_EXPIRY['ladderPlayers'])return _0x2581cb['data'];const _0x56f00e=_0x56f68b===0x1?'players':'playersD'+_0x56f68b,_0x555d41=collection(db,_0x56f00e),_0x1b577d=await getDocs(query(_0x555d41,limit(0x64))),_0x2d34f1=_0x1b577d[_0x3270bc(0x84)][_0x3270bc(0x8e)](_0x324c39=>({'id':_0x324c39['id'],..._0x324c39[_0x3270bc(0x92)]()}));return cache['ladderPlayers']['set'](_0x11be6c,{'data':_0x2d34f1,'timestamp':Date['now']()}),_0x2d34f1;}export async function getEloHistoryBatch(_0x44e1ab,_0x4abb6f=0x1){const _0x26dbe2=a0_0x257c,_0x546f91=_0x4abb6f===0x1?'eloHistory':'eloHistoryD'+_0x4abb6f,_0x5d2606=collection(db,_0x546f91),_0x3f408a={},_0x3632d5=[];_0x44e1ab['forEach'](_0x18b25f=>{const _0x4f477e=a0_0x257c,_0x5e05ce=_0x18b25f+'_'+_0x4abb6f,_0x121970=cache[_0x4f477e(0x97)][_0x4f477e(0x91)](_0x5e05ce);_0x121970&&Date['now']()-_0x121970['timestamp']<CACHE_EXPIRY[_0x4f477e(0x97)]?_0x3f408a[_0x18b25f]=_0x121970['data']:_0x3632d5['push'](_0x18b25f);});const _0x436dc6=0xa;for(let _0x273f28=0x0;_0x273f28<_0x3632d5['length'];_0x273f28+=_0x436dc6){const _0x329423=_0x3632d5['slice'](_0x273f28,_0x273f28+_0x436dc6);if(_0x329423['length']>0x0)try{const _0x2d7825=query(_0x5d2606,where('playerId','in',_0x329423),limit(0x64)),_0x1d5d13=await getDocs(_0x2d7825);_0x1d5d13['docs'][_0x26dbe2(0x83)](_0x16101b=>{const _0x29435b=_0x26dbe2,_0x4114d8=_0x16101b[_0x29435b(0x92)](),_0x3a0b5d=_0x4114d8[_0x29435b(0x90)];if(!_0x3f408a[_0x3a0b5d])_0x3f408a[_0x3a0b5d]=[];_0x3f408a[_0x3a0b5d]['push'](_0x4114d8);const _0x4f5a97=_0x3a0b5d+'_'+_0x4abb6f;cache['eloHistory']['set'](_0x4f5a97,{'data':_0x3f408a[_0x3a0b5d],'timestamp':Date['now']()});});}catch(_0x6031d8){console['error']('Error\x20fetching\x20batch\x20ELO\x20history:',_0x6031d8);}}return _0x3f408a;}function a0_0x257c(_0x2251c5,_0x15f375){const _0x13e910=a0_0x47bd();return a0_0x257c=function(_0x46a578,_0x1e034e){_0x46a578=_0x46a578-0x81;let _0x22e017=_0x13e910[_0x46a578];return _0x22e017;},a0_0x257c(_0x2251c5,_0x15f375);}let usernameCache=new Map(),usernameCacheTimestamp=Date[a0_0x5d6edd(0x88)]();export function setupEfficientListener(_0x52fa73,_0x28489d=[],_0x13be8d){const _0x252ae2=collection(db,_0x52fa73),_0x25ebce=query(_0x252ae2,..._0x28489d),_0x58b839=onSnapshot(_0x25ebce,_0xa43bfa=>{const _0x57f8e0=a0_0x257c,_0x40bad2=_0xa43bfa['docChanges']()['map'](_0x2270b7=>({'type':_0x2270b7[_0x57f8e0(0x81)],'id':_0x2270b7[_0x57f8e0(0x8b)]['id'],'data':_0x2270b7[_0x57f8e0(0x8b)]['data']()}));_0x40bad2[_0x57f8e0(0x9a)]>0x0&&_0x13be8d(_0x40bad2,_0xa43bfa['docs']);});return _0x58b839;}export async function bulkResolveUsernames(_0x52da5c){const _0x54227a=a0_0x5d6edd,_0x301738=new Map();if(!_0x52da5c||_0x52da5c[_0x54227a(0x9a)]===0x0)return _0x301738;const _0x103de1=['players','playersD2',_0x54227a(0x8f),_0x54227a(0x89)];for(const _0x192902 of _0x103de1){const _0x3fa207=collection(db,_0x192902),_0x22ccb0=await getDocs(_0x3fa207);_0x22ccb0['forEach'](_0x38705d=>{const _0x5a68d2=_0x54227a,_0x31557a=_0x38705d[_0x5a68d2(0x92)]();_0x31557a['username']&&_0x52da5c['includes'](_0x38705d['id'])&&_0x301738[_0x5a68d2(0x95)](_0x38705d['id'],_0x31557a['username']);});}return _0x301738;}
const a50_0x1df52e=a50_0x26e8,a50_0x91970e=(function(){let _0x5a38ab=!![];return function(_0x80f475,_0x2f4121){const _0x8a73a1=_0x5a38ab?function(){const _0x1e10c4=a50_0x26e8;if(_0x2f4121){const _0x25dcf=_0x2f4121[_0x1e10c4(0x69)](_0x80f475,arguments);return _0x2f4121=null,_0x25dcf;}}:function(){};return _0x5a38ab=![],_0x8a73a1;};}()),a50_0x2f581b=a50_0x91970e(this,function(){const _0x354ebd=a50_0x26e8,_0x2d55a1=function(){let _0x9c7861;try{_0x9c7861=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x3fac46){_0x9c7861=window;}return _0x9c7861;},_0x18b743=_0x2d55a1(),_0x14005f=_0x18b743['console']=_0x18b743['console']||{},_0x5e832a=['log','warn','info','error','exception','table','trace'];for(let _0x5694d7=0x0;_0x5694d7<_0x5e832a['length'];_0x5694d7++){const _0x31364b=a50_0x91970e['constructor']['prototype'][_0x354ebd(0x6e)](a50_0x91970e),_0x39058c=_0x5e832a[_0x5694d7],_0x3a14fc=_0x14005f[_0x39058c]||_0x31364b;_0x31364b['__proto__']=a50_0x91970e[_0x354ebd(0x6e)](a50_0x91970e),_0x31364b['toString']=_0x3a14fc['toString']['bind'](_0x3a14fc),_0x14005f[_0x39058c]=_0x31364b;}});function a50_0x4ccc(){const _0x1e3a09=['slice','apply','error','timestamp','userProfiles','eloHistoryD','bind','includes','data','division_','set','players','map','playersD3','docs','doc','push','now','length','playerId','exists','get'];a50_0x4ccc=function(){return _0x1e3a09;};return a50_0x4ccc();}a50_0x2f581b();import{db}from'../firebase-config.js';function a50_0x26e8(_0x2212e9,_0x14d4ae){const _0x2f581b=a50_0x4ccc();return a50_0x26e8=function(_0x91970e,_0x347f3a){_0x91970e=_0x91970e-0x68;let _0x4ccc8e=_0x2f581b[_0x91970e];return _0x4ccc8e;},a50_0x26e8(_0x2212e9,_0x14d4ae);}import{collection,doc,getDoc,getDocs,query,limit,startAfter,where,onSnapshot}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const cache={'userProfiles':new Map(),'ladderPlayers':new Map(),'matchResults':new Map(),'eloHistory':new Map()},CACHE_EXPIRY={'userProfiles':0x5*0x3c*0x3e8,'ladderPlayers':0x2*0x3c*0x3e8,'matchResults':0x1*0x3c*0x3e8,'eloHistory':0x3*0x3c*0x3e8};export const userProfilesRef=collection(db,a50_0x1df52e(0x6c));export async function fetchPaginatedData(_0x5d269d,_0x4282c5=0xa,_0x89f24=null){const _0x5e5458=a50_0x1df52e;let _0x20ce06=query(_0x5d269d,limit(_0x4282c5));_0x89f24&&(_0x20ce06=query(_0x20ce06,startAfter(_0x89f24)));const _0x3b1023=await getDocs(_0x20ce06),_0x9a3d07=_0x3b1023[_0x5e5458(0x76)][_0x3b1023[_0x5e5458(0x76)][_0x5e5458(0x7a)]-0x1];return{'data':_0x3b1023['docs']['map'](_0x392906=>({'id':_0x392906['id'],..._0x392906['data']()})),'lastVisible':_0x9a3d07,'hasMore':_0x3b1023['docs']['length']===_0x4282c5};}export async function getUserProfile(_0x412cdc){const _0xdd4a64=a50_0x1df52e,_0x2bf36f=cache[_0xdd4a64(0x6c)][_0xdd4a64(0x7d)](_0x412cdc);if(_0x2bf36f&&Date[_0xdd4a64(0x79)]()-_0x2bf36f['timestamp']<CACHE_EXPIRY['userProfiles'])return _0x2bf36f['data'];const _0x42bcc4=await getDoc(doc(userProfilesRef,_0x412cdc));if(_0x42bcc4[_0xdd4a64(0x7c)]()){const _0x35be12=_0x42bcc4['data']();return cache['userProfiles']['set'](_0x412cdc,{'data':_0x35be12,'timestamp':Date['now']()}),_0x35be12;}return null;}export async function getLadderData(_0x5498e3=0x1){const _0x50c0ab=a50_0x1df52e,_0x43f9a8=_0x50c0ab(0x71)+_0x5498e3,_0x10c45c=cache['ladderPlayers']['get'](_0x43f9a8);if(_0x10c45c&&Date['now']()-_0x10c45c[_0x50c0ab(0x6b)]<CACHE_EXPIRY['ladderPlayers'])return _0x10c45c['data'];const _0x5c894b=_0x5498e3===0x1?_0x50c0ab(0x73):'playersD'+_0x5498e3,_0x56c715=collection(db,_0x5c894b),_0x95243f=await getDocs(query(_0x56c715,limit(0x64))),_0x4bde29=_0x95243f[_0x50c0ab(0x76)][_0x50c0ab(0x74)](_0x2af198=>({'id':_0x2af198['id'],..._0x2af198['data']()}));return cache['ladderPlayers']['set'](_0x43f9a8,{'data':_0x4bde29,'timestamp':Date['now']()}),_0x4bde29;}export async function getEloHistoryBatch(_0x5a0766,_0x4f72be=0x1){const _0x13a33c=a50_0x1df52e,_0x1c2317=_0x4f72be===0x1?'eloHistory':_0x13a33c(0x6d)+_0x4f72be,_0x5a2dcd=collection(db,_0x1c2317),_0x5d2086={},_0x59e39c=[];_0x5a0766['forEach'](_0x379fdc=>{const _0x8a2a3f=_0x13a33c,_0x14d91b=_0x379fdc+'_'+_0x4f72be,_0x349f43=cache['eloHistory']['get'](_0x14d91b);_0x349f43&&Date['now']()-_0x349f43['timestamp']<CACHE_EXPIRY['eloHistory']?_0x5d2086[_0x379fdc]=_0x349f43['data']:_0x59e39c[_0x8a2a3f(0x78)](_0x379fdc);});const _0x11151c=0xa;for(let _0x24d51d=0x0;_0x24d51d<_0x59e39c['length'];_0x24d51d+=_0x11151c){const _0x4f8eb9=_0x59e39c[_0x13a33c(0x68)](_0x24d51d,_0x24d51d+_0x11151c);if(_0x4f8eb9[_0x13a33c(0x7a)]>0x0)try{const _0x356767=query(_0x5a2dcd,where(_0x13a33c(0x7b),'in',_0x4f8eb9),limit(0x64)),_0x431e81=await getDocs(_0x356767);_0x431e81['docs']['forEach'](_0x512476=>{const _0x536713=_0x13a33c,_0x814f53=_0x512476['data'](),_0x3c375b=_0x814f53['playerId'];if(!_0x5d2086[_0x3c375b])_0x5d2086[_0x3c375b]=[];_0x5d2086[_0x3c375b]['push'](_0x814f53);const _0x3b3b01=_0x3c375b+'_'+_0x4f72be;cache['eloHistory'][_0x536713(0x72)](_0x3b3b01,{'data':_0x5d2086[_0x3c375b],'timestamp':Date['now']()});});}catch(_0x2d7782){console[_0x13a33c(0x6a)]('Error\x20fetching\x20batch\x20ELO\x20history:',_0x2d7782);}}return _0x5d2086;}let usernameCache=new Map(),usernameCacheTimestamp=Date['now']();export function setupEfficientListener(_0x3f1959,_0x7bb3df=[],_0x9b7307){const _0x112c76=collection(db,_0x3f1959),_0x5a5caf=query(_0x112c76,..._0x7bb3df),_0xdc369b=onSnapshot(_0x5a5caf,_0x26a452=>{const _0x3131db=a50_0x26e8,_0x26ce01=_0x26a452['docChanges']()[_0x3131db(0x74)](_0x100496=>({'type':_0x100496['type'],'id':_0x100496[_0x3131db(0x77)]['id'],'data':_0x100496['doc'][_0x3131db(0x70)]()}));_0x26ce01['length']>0x0&&_0x9b7307(_0x26ce01,_0x26a452[_0x3131db(0x76)]);});return _0xdc369b;}export async function bulkResolveUsernames(_0x116dbc){const _0x4620cd=a50_0x1df52e,_0x55a0ba=new Map();if(!_0x116dbc||_0x116dbc['length']===0x0)return _0x55a0ba;const _0x1526e7=['players','playersD2',_0x4620cd(0x75),'nonParticipants'];for(const _0x4b67c8 of _0x1526e7){const _0x2b0e9e=collection(db,_0x4b67c8),_0x215570=await getDocs(_0x2b0e9e);_0x215570['forEach'](_0x30022b=>{const _0x4ec619=_0x4620cd,_0x1925e3=_0x30022b['data']();_0x1925e3['username']&&_0x116dbc[_0x4ec619(0x6f)](_0x30022b['id'])&&_0x55a0ba[_0x4ec619(0x72)](_0x30022b['id'],_0x1925e3['username']);});}return _0x55a0ba;}
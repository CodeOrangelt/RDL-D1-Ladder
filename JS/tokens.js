const a58_0x360c69=(function(){let _0x2f4e1b=!![];return function(_0x1e249e,_0x30dab8){const _0x460d61=_0x2f4e1b?function(){if(_0x30dab8){const _0x516730=_0x30dab8['apply'](_0x1e249e,arguments);return _0x30dab8=null,_0x516730;}}:function(){};return _0x2f4e1b=![],_0x460d61;};}()),a58_0x3618c0=a58_0x360c69(this,function(){const _0x4e87d5=a58_0x4af5;let _0x3fc3c3;try{const _0x33406c=Function(_0x4e87d5(0x14b)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x3fc3c3=_0x33406c();}catch(_0xcc3c98){_0x3fc3c3=window;}const _0x21898a=_0x3fc3c3[_0x4e87d5(0x151)]=_0x3fc3c3[_0x4e87d5(0x151)]||{},_0x20710f=['log',_0x4e87d5(0x14c),'info',_0x4e87d5(0x14d),'exception','table','trace'];for(let _0x210fdd=0x0;_0x210fdd<_0x20710f['length'];_0x210fdd++){const _0x1e6302=a58_0x360c69['constructor']['prototype']['bind'](a58_0x360c69),_0x180fcf=_0x20710f[_0x210fdd],_0x3d0eba=_0x21898a[_0x180fcf]||_0x1e6302;_0x1e6302['__proto__']=a58_0x360c69['bind'](a58_0x360c69),_0x1e6302['toString']=_0x3d0eba['toString'][_0x4e87d5(0x14e)](_0x3d0eba),_0x21898a[_0x180fcf]=_0x1e6302;}});a58_0x3618c0();import{doc,getDoc,getDocs,collection}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const tokenCache=new Map(),CACHE_DURATION=0x5*0x3c*0x3e8;function a58_0x4af5(_0x11b602,_0x1734bb){const _0x3618c0=a58_0x2e7f();return a58_0x4af5=function(_0x360c69,_0x1fb588){_0x360c69=_0x360c69-0x14a;let _0x2e7f8e=_0x3618c0[_0x360c69];return _0x2e7f8e;},a58_0x4af5(_0x11b602,_0x1734bb);}export async function getUserTokens(_0x584266){const _0x6f0a8c=a58_0x4af5,_0x5b1098='tokens_'+_0x584266,_0xa7031c=tokenCache['get'](_0x5b1098);if(_0xa7031c&&Date[_0x6f0a8c(0x156)]()-_0xa7031c['timestamp']<CACHE_DURATION)return _0xa7031c['tokens'];try{const _0x2aa297=doc(db,_0x6f0a8c(0x153),_0x584266),_0x482aad=await getDoc(_0x2aa297);let _0x59e732=[];return _0x482aad['exists']()&&(_0x59e732=_0x482aad['data']()['tokens']||[]),tokenCache[_0x6f0a8c(0x15d)](_0x5b1098,{'tokens':_0x59e732,'timestamp':Date['now']()}),_0x59e732;}catch(_0x313b1a){return console[_0x6f0a8c(0x14d)]('Error\x20fetching\x20user\x20tokens:',_0x313b1a),[];}}export async function getBulkUserTokens(_0x3ed593){const _0x384352=a58_0x4af5,_0x5260bf=new Map(),_0x115462=[];_0x3ed593[_0x384352(0x15b)](_0x3106ec=>{const _0x14cc72=_0x384352,_0x3e6227='tokens_'+_0x3106ec,_0x5668c3=tokenCache['get'](_0x3e6227);_0x5668c3&&Date['now']()-_0x5668c3[_0x14cc72(0x152)]<CACHE_DURATION?_0x5260bf['set'](_0x3106ec,_0x5668c3['tokens']):_0x115462['push'](_0x3106ec);});if(_0x115462['length']>0x0)try{const _0x2ac230=_0x115462['map'](async _0x30e05d=>{const _0x41fbed=_0x384352,_0x3fcd9c=doc(db,_0x41fbed(0x153),_0x30e05d),_0xfdc662=await getDoc(_0x3fcd9c);let _0x50cd9d=[];_0xfdc662['exists']()&&(_0x50cd9d=_0xfdc662[_0x41fbed(0x15a)]()['tokens']||[]);const _0x35613e='tokens_'+_0x30e05d;return tokenCache['set'](_0x35613e,{'tokens':_0x50cd9d,'timestamp':Date['now']()}),[_0x30e05d,_0x50cd9d];}),_0x5ec7bb=await Promise['all'](_0x2ac230);_0x5ec7bb[_0x384352(0x15b)](([_0x1f02dc,_0x1740f7])=>{const _0x556cdf=_0x384352;_0x5260bf[_0x556cdf(0x15d)](_0x1f02dc,_0x1740f7);});}catch(_0x3fe26a){console['error']('Error\x20fetching\x20bulk\x20user\x20tokens:',_0x3fe26a);}return _0x5260bf;}export async function getTokensByUsernames(_0x548d4f){const _0x26dad9=a58_0x4af5,_0x10035f=new Map();try{const _0x3ab15=collection(db,'userProfiles'),_0x311c39=await getDocs(_0x3ab15),_0x2f3fd4=new Map();_0x311c39['forEach'](_0x5c6766=>{const _0x38eee7=a58_0x4af5,_0x4e606d=_0x5c6766[_0x38eee7(0x15a)]();_0x4e606d['username']&&_0x548d4f['includes'](_0x4e606d[_0x38eee7(0x14a)])&&_0x2f3fd4['set'](_0x4e606d['username'],_0x5c6766['id']);});const _0x2f60dc=Array[_0x26dad9(0x157)](_0x2f3fd4[_0x26dad9(0x155)]());if(_0x2f60dc['length']>0x0){const _0x34daa8=await getBulkUserTokens(_0x2f60dc);_0x2f3fd4[_0x26dad9(0x15b)]((_0x210564,_0x5e7927)=>{const _0x419b07=_0x34daa8['get'](_0x210564)||[];_0x10035f['set'](_0x5e7927,_0x419b07);});}}catch(_0x53ccc2){console['error']('Error\x20fetching\x20tokens\x20by\x20usernames:',_0x53ccc2);}return _0x10035f;}export function clearTokenCache(_0x4cfe21=null){const _0x1e0862=a58_0x4af5;if(_0x4cfe21){const _0x3d45ee='tokens_'+_0x4cfe21;tokenCache['delete'](_0x3d45ee),console['log']('🗑️\x20Cleared\x20token\x20cache\x20for\x20user:\x20'+_0x4cfe21);}else tokenCache[_0x1e0862(0x14f)](),console[_0x1e0862(0x150)]('🗑️\x20Cleared\x20all\x20token\x20cache');}function a58_0x2e7f(){const _0x55f8ac=['username','return\x20(function()\x20','warn','error','bind','clear','log','console','timestamp','userTokens','length','values','now','from','getTime','find','data','forEach','purchasedAt','set'];a58_0x2e7f=function(){return _0x55f8ac;};return a58_0x2e7f();}export async function forceRefreshUserTokens(_0x15460e){return clearTokenCache(_0x15460e),await getUserTokens(_0x15460e);}export function getPrimaryDisplayToken(_0x53fae1){const _0x226737=a58_0x4af5;if(!_0x53fae1||_0x53fae1[_0x226737(0x154)]===0x0)return null;const _0x3e75ba=_0x53fae1[_0x226737(0x159)](_0x562c50=>_0x562c50['equipped']===!![]);if(_0x3e75ba)return _0x3e75ba;const _0x7b7470=[..._0x53fae1]['sort']((_0x531bcf,_0x36239f)=>{const _0x4a1755=_0x226737;let _0x419b45,_0x3a936a;if(_0x531bcf[_0x4a1755(0x15c)]){if(_0x531bcf['purchasedAt']['seconds'])_0x419b45=_0x531bcf[_0x4a1755(0x15c)]['seconds'];else{if(_0x531bcf[_0x4a1755(0x15c)]instanceof Date)_0x419b45=_0x531bcf[_0x4a1755(0x15c)]['getTime']()/0x3e8;else typeof _0x531bcf['purchasedAt']==='string'?_0x419b45=new Date(_0x531bcf['purchasedAt'])['getTime']()/0x3e8:_0x419b45=0x0;}}else _0x419b45=0x0;if(_0x36239f['purchasedAt']){if(_0x36239f['purchasedAt']['seconds'])_0x3a936a=_0x36239f['purchasedAt']['seconds'];else{if(_0x36239f[_0x4a1755(0x15c)]instanceof Date)_0x3a936a=_0x36239f['purchasedAt'][_0x4a1755(0x158)]()/0x3e8;else typeof _0x36239f['purchasedAt']==='string'?_0x3a936a=new Date(_0x36239f['purchasedAt'])['getTime']()/0x3e8:_0x3a936a=0x0;}}else _0x3a936a=0x0;return _0x3a936a-_0x419b45;});return _0x7b7470[0x0];}
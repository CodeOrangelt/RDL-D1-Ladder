(function(_0x2a5520,_0x4cd2d5){const _0x5d3cd0=a28_0xf3bf,_0x59add0=_0x2a5520();while(!![]){try{const _0x43ce5e=parseInt(_0x5d3cd0(0x1d0))/0x1*(-parseInt(_0x5d3cd0(0x1db))/0x2)+parseInt(_0x5d3cd0(0x1df))/0x3+-parseInt(_0x5d3cd0(0x1e0))/0x4*(-parseInt(_0x5d3cd0(0x1e7))/0x5)+parseInt(_0x5d3cd0(0x1c0))/0x6+-parseInt(_0x5d3cd0(0x1e2))/0x7+-parseInt(_0x5d3cd0(0x1f5))/0x8*(parseInt(_0x5d3cd0(0x1fc))/0x9)+parseInt(_0x5d3cd0(0x1ca))/0xa;if(_0x43ce5e===_0x4cd2d5)break;else _0x59add0['push'](_0x59add0['shift']());}catch(_0x228294){_0x59add0['push'](_0x59add0['shift']());}}}(a28_0x122f,0x2a397));const a28_0x16621e=(function(){let _0x535d9a=!![];return function(_0x3961e0,_0x2384b1){const _0x3bf989=_0x535d9a?function(){if(_0x2384b1){const _0x843f0=_0x2384b1['apply'](_0x3961e0,arguments);return _0x2384b1=null,_0x843f0;}}:function(){};return _0x535d9a=![],_0x3bf989;};}()),a28_0x45460f=a28_0x16621e(this,function(){const _0x295032=a28_0xf3bf;return a28_0x45460f[_0x295032(0x1d2)]()[_0x295032(0x1d1)](_0x295032(0x1c8))[_0x295032(0x1d2)]()[_0x295032(0x1fb)](a28_0x45460f)[_0x295032(0x1d1)]('(((.+)+)+)+$');});a28_0x45460f();const a28_0x17f384=(function(){let _0x3c0387=!![];return function(_0x184b7c,_0x29ad0a){const _0x42a4d1=_0x3c0387?function(){const _0x14604c=a28_0xf3bf;if(_0x29ad0a){const _0x1c3595=_0x29ad0a[_0x14604c(0x1fd)](_0x184b7c,arguments);return _0x29ad0a=null,_0x1c3595;}}:function(){};return _0x3c0387=![],_0x42a4d1;};}()),a28_0x5b8da9=a28_0x17f384(this,function(){const _0x244f1c=a28_0xf3bf;let _0x231702;try{const _0x370a20=Function('return\x20(function()\x20'+_0x244f1c(0x1c6)+');');_0x231702=_0x370a20();}catch(_0x38da32){_0x231702=window;}const _0x247d9d=_0x231702['console']=_0x231702[_0x244f1c(0x1fe)]||{},_0x151d3c=[_0x244f1c(0x1cb),_0x244f1c(0x1ea),_0x244f1c(0x1cf),_0x244f1c(0x1bf),'exception',_0x244f1c(0x1ec),_0x244f1c(0x1d9)];for(let _0x5b444c=0x0;_0x5b444c<_0x151d3c[_0x244f1c(0x1eb)];_0x5b444c++){const _0x17cd6e=a28_0x17f384[_0x244f1c(0x1fb)][_0x244f1c(0x1e6)][_0x244f1c(0x1ef)](a28_0x17f384),_0x284ac3=_0x151d3c[_0x5b444c],_0x23ccb2=_0x247d9d[_0x284ac3]||_0x17cd6e;_0x17cd6e[_0x244f1c(0x1c3)]=a28_0x17f384['bind'](a28_0x17f384),_0x17cd6e[_0x244f1c(0x1d2)]=_0x23ccb2[_0x244f1c(0x1d2)][_0x244f1c(0x1ef)](_0x23ccb2),_0x247d9d[_0x284ac3]=_0x17cd6e;}});a28_0x5b8da9();import{collection,doc,getDoc,getDocs,updateDoc,setDoc,deleteDoc,writeBatch,query,where,serverTimestamp,addDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';import{recordEloChangeD2}from'./elo-history-d2.js';function a28_0xf3bf(_0x8ed28b,_0x96ae8f){const _0x3ccb48=a28_0x122f();return a28_0xf3bf=function(_0x5b8da9,_0x17f384){_0x5b8da9=_0x5b8da9-0x1be;let _0x851879=_0x3ccb48[_0x5b8da9];return _0x851879;},a28_0xf3bf(_0x8ed28b,_0x96ae8f);}function a28_0x122f(){const _0x49296e=['1045164rDEqAN','exists','update','__proto__','Error\x20in\x20updateEloRatingsD2:','empty','{}.constructor(\x22return\x20this\x22)(\x20)','uid','(((.+)+)+)+$','One\x20or\x20both\x20D2\x20players\x20not\x20found','1315500pfHuhx','log','email','Current\x20username:','currentUser','info','1QUYJTt','search','toString','win','pow','match-d2','D2\x20ELO\x20ratings\x20updated\x20successfully','eloRating','username','trace','docs','203554HgsASK','loss','all','checkAndRecordPromotion','650895HSYXOM','476516UZUplB','position','1125782DbSyxv','MAX_SAFE_INTEGER','D2\x20Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions','Current\x20user:','prototype','10NZzEqU','createdAt','data','warn','length','table','D2\x20Report\x20not\x20found\x20with\x20ID:','D2\x20match\x20report\x20not\x20found','bind','loserUsername','D2\x20Match\x20successfully\x20approved\x20and\x20ELO\x20updated','playersD2','pendingMatchesD2','winnerUsername','12456AiPJXo','D2\x20Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked','round','No\x20user\x20logged\x20in','approvedMatchesD2','D2\x20Report\x20data:','constructor','1881qSAZiA','apply','console','Error\x20in\x20approveReportD2:','error'];a28_0x122f=function(){return _0x49296e;};return a28_0x122f();}import{promotionManager}from'./promotions.js';import a28_0x116449 from'./firebase-idle-wrapper.js';export function calculateEloD2(_0x35f223,_0x36f8ba,_0x56ea72=0x20){const _0x2d4ac3=a28_0xf3bf,_0x23d199=0x1/(0x1+Math[_0x2d4ac3(0x1d4)](0xa,(_0x36f8ba-_0x35f223)/0x190)),_0x7a831f=0x1/(0x1+Math[_0x2d4ac3(0x1d4)](0xa,(_0x35f223-_0x36f8ba)/0x190)),_0x52a687=_0x35f223+_0x56ea72*(0x1-_0x23d199),_0xd71128=_0x36f8ba+_0x56ea72*(0x0-_0x7a831f);return{'newWinnerRating':Math[_0x2d4ac3(0x1f7)](_0x52a687),'newLoserRating':Math['round'](_0xd71128)};}export async function updateEloRatingsD2(_0x39f71d,_0x142878,_0x2d39a1){const _0x184185=a28_0xf3bf;try{const _0xa8d6a4=writeBatch(db),_0x21d1dd=doc(db,_0x184185(0x1f2),_0x39f71d),_0x2781b9=doc(db,'playersD2',_0x142878),[_0x1f741d,_0x548209]=await Promise[_0x184185(0x1dd)]([getDoc(_0x21d1dd),getDoc(_0x2781b9)]);if(!_0x1f741d[_0x184185(0x1c1)]()||!_0x548209[_0x184185(0x1c1)]())throw new Error(_0x184185(0x1c9));const _0x3a6dad=_0x1f741d[_0x184185(0x1e9)](),_0x4d655=_0x548209[_0x184185(0x1e9)](),_0x19473f=_0x3a6dad[_0x184185(0x1e1)]||Number['MAX_SAFE_INTEGER'],_0x500d16=_0x4d655[_0x184185(0x1e1)]||Number[_0x184185(0x1e3)],{newWinnerRating:_0x3809f2,newLoserRating:_0x413f7a}=calculateEloD2(_0x3a6dad['eloRating']||0x4b0,_0x4d655[_0x184185(0x1d7)]||0x4b0);let _0x43117=_0x19473f,_0x59403f=_0x500d16;if(_0x19473f>_0x500d16){console['log'](_0x184185(0x1f6)),_0x43117=_0x500d16,_0x59403f=_0x500d16+0x1;const _0x2b193e=query(collection(db,_0x184185(0x1f2)),where(_0x184185(0x1e1),'>',_0x500d16),where('position','<',_0x19473f)),_0x25afe9=await getDocs(_0x2b193e);for(const _0x58ffd9 of _0x25afe9[_0x184185(0x1da)]){_0x58ffd9['id']!==_0x39f71d&&_0x58ffd9['id']!==_0x142878&&_0xa8d6a4[_0x184185(0x1c2)](doc(db,_0x184185(0x1f2),_0x58ffd9['id']),{'position':_0x58ffd9[_0x184185(0x1e9)]()['position']+0x1});}}else console[_0x184185(0x1cb)](_0x184185(0x1e4));return _0xa8d6a4['update'](_0x21d1dd,{'eloRating':_0x3809f2,'lastMatchDate':serverTimestamp(),'position':_0x43117,'lastMatchId':_0x2d39a1}),_0xa8d6a4['update'](_0x2781b9,{'eloRating':_0x413f7a,'lastMatchDate':serverTimestamp(),'position':_0x59403f,'lastMatchId':_0x2d39a1}),await _0xa8d6a4['commit'](),console['log'](_0x184185(0x1d6)),await Promise['all']([recordEloChangeD2({'playerId':_0x39f71d,'previousElo':_0x3a6dad[_0x184185(0x1d7)]||0x4b0,'newElo':_0x3809f2,'opponentId':_0x142878,'matchResult':_0x184185(0x1d3),'previousPosition':_0x19473f,'newPosition':_0x43117,'isPromotion':_0x43117<_0x19473f,'matchId':_0x2d39a1,'timestamp':serverTimestamp()}),recordEloChangeD2({'playerId':_0x142878,'previousElo':_0x4d655[_0x184185(0x1d7)]||0x4b0,'newElo':_0x413f7a,'opponentId':_0x39f71d,'matchResult':_0x184185(0x1dc),'previousPosition':_0x500d16,'newPosition':_0x59403f,'isDemotion':_0x59403f>_0x500d16,'matchId':_0x2d39a1,'timestamp':serverTimestamp()})]),await promotionManager[_0x184185(0x1de)](_0x39f71d,_0x3809f2,_0x3a6dad[_0x184185(0x1d7)],{'source':_0x184185(0x1d5),'matchId':_0x2d39a1}),await promotionManager[_0x184185(0x1de)](_0x142878,_0x413f7a,_0x4d655[_0x184185(0x1d7)],{'source':_0x184185(0x1d5),'matchId':_0x2d39a1}),!![];}catch(_0x314b53){console[_0x184185(0x1bf)](_0x184185(0x1c4),_0x314b53);throw _0x314b53;}}export async function approveReportD2(_0x2a6f94,_0x437e1a,_0x3bb6c9,_0x143052){const _0x5945b1=a28_0xf3bf;try{console[_0x5945b1(0x1cb)]('Starting\x20approveReportD2\x20function\x20with:',{'reportId':_0x2a6f94,'winnerScore':_0x437e1a,'winnerSuicides':_0x3bb6c9,'winnerComment':_0x143052});const _0x184b8e=auth[_0x5945b1(0x1ce)];if(!_0x184b8e){console['log'](_0x5945b1(0x1f8));throw new Error('You\x20must\x20be\x20logged\x20in\x20to\x20approve\x20D2\x20matches');}console[_0x5945b1(0x1cb)](_0x5945b1(0x1e5),_0x184b8e[_0x5945b1(0x1cc)]);const _0x4985cc=await getDoc(doc(db,_0x5945b1(0x1f2),_0x184b8e[_0x5945b1(0x1c7)])),_0x470549=_0x4985cc[_0x5945b1(0x1c1)]()?_0x4985cc[_0x5945b1(0x1e9)]()[_0x5945b1(0x1d8)]:null;console['log'](_0x5945b1(0x1cd),_0x470549);const _0x533ff2=doc(db,_0x5945b1(0x1f3),_0x2a6f94),_0x5ace56=await getDoc(_0x533ff2);if(!_0x5ace56[_0x5945b1(0x1c1)]()){console[_0x5945b1(0x1cb)](_0x5945b1(0x1ed),_0x2a6f94);throw new Error(_0x5945b1(0x1ee));}const _0x42423c=_0x5ace56[_0x5945b1(0x1e9)]();console['log'](_0x5945b1(0x1fa),_0x42423c);if(_0x470549!==_0x42423c[_0x5945b1(0x1f4)])throw new Error('Only\x20the\x20winner\x20can\x20approve\x20D2\x20matches');const _0x2c0970={..._0x42423c,'winnerScore':_0x437e1a,'winnerSuicides':_0x3bb6c9,'winnerComment':_0x143052,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':_0x470549,'createdAt':_0x42423c[_0x5945b1(0x1e8)]||serverTimestamp(),'winnerUsername':_0x42423c[_0x5945b1(0x1f4)],'loserUsername':_0x42423c[_0x5945b1(0x1f0)]};await setDoc(doc(db,_0x5945b1(0x1f9),_0x2a6f94),_0x2c0970),await deleteDoc(_0x533ff2),console[_0x5945b1(0x1cb)]('D2\x20Match\x20moved\x20to\x20approved\x20collection');const [_0xd6a95f,_0x57f0e7]=await Promise['all']([getDocs(query(collection(db,_0x5945b1(0x1f2)),where(_0x5945b1(0x1d8),'==',_0x42423c[_0x5945b1(0x1f4)]))),getDocs(query(collection(db,_0x5945b1(0x1f2)),where(_0x5945b1(0x1d8),'==',_0x42423c[_0x5945b1(0x1f0)])))]);if(_0xd6a95f[_0x5945b1(0x1c5)]||_0x57f0e7[_0x5945b1(0x1c5)])throw new Error('Could\x20not\x20find\x20D2\x20player\x20documents');const _0x92427=_0xd6a95f[_0x5945b1(0x1da)][0x0]['id'],_0x17601b=_0x57f0e7[_0x5945b1(0x1da)][0x0]['id'];return await updateEloRatingsD2(_0x92427,_0x17601b,_0x2a6f94),console[_0x5945b1(0x1cb)](_0x5945b1(0x1f1)),!![];}catch(_0x4701b7){console[_0x5945b1(0x1bf)](_0x5945b1(0x1be),_0x4701b7);throw _0x4701b7;}}
const a33t=a33b;function a33b(a,b){const c=a33a();return a33b=function(d,e){d=d-0x1d8;let f=c[d];if(a33b['SLoeAy']===undefined){var g=function(l){const m='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let n='',o='';for(let p=0x0,q,r,s=0x0;r=l['charAt'](s++);~r&&(q=p%0x4?q*0x40+r:r,p++%0x4)?n+=String['fromCharCode'](0xff&q>>(-0x2*p&0x6)):0x0){r=m['indexOf'](r);}for(let t=0x0,u=n['length'];t<u;t++){o+='%'+('00'+n['charCodeAt'](t)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(o);};a33b['wcrtTD']=g,a=arguments,a33b['SLoeAy']=!![];}const h=c[0x0],i=d+h,j=a[i];return!j?(f=a33b['wcrtTD'](f),a[i]=f):f=j,f;},a33b(a,b);}(function(a,b){const s=a33b,c=a();while(!![]){try{const d=parseInt(s(0x1f3))/0x1*(-parseInt(s(0x1ee))/0x2)+-parseInt(s(0x1fa))/0x3+-parseInt(s(0x21a))/0x4*(parseInt(s(0x20f))/0x5)+-parseInt(s(0x21e))/0x6+parseInt(s(0x236))/0x7*(parseInt(s(0x213))/0x8)+-parseInt(s(0x205))/0x9*(parseInt(s(0x1fd))/0xa)+parseInt(s(0x1e1))/0xb*(parseInt(s(0x1ff))/0xc);if(d===b)break;else c['push'](c['shift']());}catch(e){c['push'](c['shift']());}}}(a33a,0x958c5));function a33a(){const Q=['rdm6ievYCM9YigzLDgnOAw5NievmtYbOAxn0B3j5oG','Bg9Zzxjty29Yzq','pc90zd4kicaGicaGica8DgqGC3r5Bgu9iNbVC2L0Aw9UoIbYzwXHDgL2ztSIpGOGicaGicaGicaGica8zgL2ihn0EwXLpsjKAxnWBgf5oIbMBgv4oYbHBgLNBI1PDgvTCZOGy2vUDgvYoYbWB3nPDgLVBJOGCMvSyxrPDMu7iJ4kicaGicaGicaGicaGicaGidXHigHYzwy9iNbYB2zPBguUAhrTBd91C2vYBMfTzt0','rdm6iezVDw5Kia','pc90zd4kicaGicaGica8Dgq+','zwXVuMf0Aw5N','A2rH','AgfZ','AgvHza','ndaWmdD4whDZt1q','rxjYB3iGDxbKyxrPBMCGrdmGCgXHEwvYihbVC2L0Aw9UCZO','i2XHzgrLCI1KmYb0AgvHzcb0CG','y2HHBMDL','rdmGtgfKzgvYihrHyMXLigjVzhKGBM90igzVDw5K','yxbWzw5Kq2HPBgq','i0y0ndmZnG','igvUDhjPzxmGAw4GzwXVsgLZDg9YEuqZ','jMXHzgrLCJ1KmYiGcIaGicaGicaGicaGicaGicaGicbZDhLSzt0Iy29SB3i6ia','ihbSyxLLCNm','Dgq6BNrOlwnOAwXKkdmP','CgXHEwvYvxnLCM5HBwu','iZuWqZG3oa','otyXotyYr0zUDuD1','CgLSB3q','zM9YrwfJAa','oYb0zxH0lwrLy29YyxrPB246ig5VBMu7iJ4kicaGicaGicaGicaGicaGicaGica','cIaGicaGicaGicaGidWVzgL2pGOGicaGicaGidWVDgq+cIaGicaGicaGphrKihn0EwXLpsjJB2XVCJOG','mvP1CNPmva','iZrdquy1ma','rdm6igvSB0HPC3rVCNLemYbPCYbLBxb0EsWGDhj5Aw5NigzHBgXIywnRlI4U','CgXHEwvY','zMLUza','rdm6ia','zgf0yq','otu5nZCYzLPyBezm','BwfW','rxjYB3iGzMv0y2HPBMCGyMf0y2GGBwf0y2GGC3rHDhmGzM9YieqZoG','otq0nZC5mhv6CgXiuG','B3bHy2L0Eq','otC1nKrcEfH1va','zxjYB3i','Bg9ZzxjvC2vYBMfTzq','Aw5Uzxjive1m','BgvUz3rO','C2L6zq','ouTlwMHlsa','i2XHzgrLCI1KmYb0yM9KEq','lNbUzYiGcIaGicaGicaGicaGicaGicaGicaGicaGigfSDd0I','Dg9eyxrL','z2v0','rdm6iezHBgXIywnRihf1zxj5igzHAwXLzdO','DgLTzxn0yw1W','C3r5Bgu','DMLZAwjSzq','zMLYC3rqBgfJzurHDgu','mJi2mZq1y3buA1LO','Dg90ywXlAwXSCW','C2v0','ChjLDMLVDxnfBg8','mtqWodHLA3zwEwe','DgHLBG','rdm6ie5VigvUDhjPzxmGzM91BMqGAw4GzwXVsgLZDg9YEuqZlcb0CNLPBMCGzMfSBgjHy2SUlI4','oYbWB3nPDgLVBJOGCMvSyxrPDMu7iJ4kicaGicaGicaGicaGpgrPDIbJBgfZCZ0IzwXVlwnVBNrHAw5LCIiGC3r5Bgu9iMrPC3bSyxK6igzSzxG7igfSAwDUlwL0zw1ZoIbJzw50zxi7iJ4kicaGicaGicaGicaGicaGidXZCgfUignSyxnZpsjLBg8TDMfSDwuIpG','BMv3rwXV','D2LUBMvYvxnLCM5HBwu','Cg9ZAxrPB24','mJHPEufXu0O','cIaGicaGicaGicaGicaGica8l3rKpGOGicaGicaGicaGica8l3rYpGOGicaGicaGia','tufyx1nbrKvFsu5uruDfuG','cIaGicaGicaGphrOpLjHBMS8l3rOpGOGicaGicaGidX0Ad5vC2vYBMfTztWVDgG+cIaGicaGicaGphrOpKvmtZWVDgG+cIaGicaGicaGphrOpK1HDgnOzxm8l3rOpGOGicaGicaGidX0Ad5xAw5Zpc90Ad4kicaGicaGica8DgG+tg9ZC2vZpc90Ad4kicaGicaGica8DgG+sY9epc90Ad4kicaGicaGica8DgG+v2LUifjHDgu8l3rOpGOGicaG','nteWmZqWoe9Pvwfwvq','zNjVBq','C29YDa','Aw5JBhvKzxm','CxvLCNLtzwXLy3rVCKfSBa','C2vJB25KCW','ChvZAa','y291BNrYEq','Dg90ywXezwf0Ahm','cIaGicaGicaGicaGicaGica8l2e+cIaGicaGicaGicaGicaGica','Dg9gAxHLza','zwXVsgLZDg9YEuqZ','cIaGlNn0CMvHAY1PBMrPy2f0B3iGEWOGicaGzM9UDc1ZAxPLoIaWlJLLBtSkicaGignVBg9YoIaJrKy0ntaWoWOGicaGBwfYz2LUlwXLzNq6idvWEdSkicaGigzVBNqTD2vPz2H0oIbIB2XKoWOGih0k','yM9Sza','rxjYB3iGBg9HzgLUzYbemYbSywrKzxi6','yxbWCM92zwrnyxrJAgvZrdm','DxnLCM5HBwu','D2LUBMvYu2nVCMu','rxjYB3iGDxbKyxrPBMCGrdmGruXpihrYzw5KigLUzgLJyxrVCNm6','pc9ZCgfUpGOGicaGicaGicaGicaGicaGphnWyw4Gy2XHC3m9iNrYzw5KlwLUzgLJyxrVCIiGC3r5Bgu9iM1HCMDPBI1Szwz0oIa1ChG7iJ48l3nWyw4+cIaGicaGicaGicaGidWVzgL2pGOGicaGicaGidWVDgq+cIaGicaGicaGphrKpG','Dg90ywXnyxrJAgvZ','CxvLCNLtzwXLy3rVCG','D2LUCW','igzHBgXIywnRigvUDhjPzxm','mJi2mwrrsNn2qW','zM9UDfnPEMu','CgXHEwvYC0qZ','zgvZyW','jtWVDgq+cIaGica8l3rYpG','Dg9mB3DLCKnHC2u','Bg9N','zgLZCgXHEq'];a33a=function(){return Q;};return a33a();}import{collection,getDocs,deleteDoc,doc,getDoc,query,where,updateDoc,Timestamp,onSnapshot,orderBy,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import{getRankStyle}from'./ranks.js';import a33c from'./firebase-idle-wrapper.js';const styleEl=document['createElement']('style');styleEl['textContent']=a33t(0x22a),document[a33t(0x1e0)][a33t(0x1e6)](styleEl);const playerCacheD3={'data':null,'timestamp':0x0},CACHE_DURATION=0x7530;async function displayLadderD3(a=![]){const u=a33t,b=document[u(0x233)]('#ladder-d3\x20tbody');if(!b){console[u(0x200)](u(0x1e5));return;}b[u(0x202)]='<tr><td\x20colspan=\x228\x22\x20class=\x22loading-cell\x22>Loading\x20D3\x20ladder\x20data...</td></tr>';try{const c=Date['now']();if(!a&&playerCacheD3[u(0x1f9)]&&c-playerCacheD3[u(0x20b)]<CACHE_DURATION){updateLadderDisplayD3(playerCacheD3[u(0x1f9)]);return;}const d=collection(db,'playersD3'),e=await getDocs(d),f=[];e['forEach'](l=>{const v=u,m=l[v(0x1f9)]();m[v(0x22e)]&&f['push']({...m,'id':l['id'],'elo':m[v(0x1dd)]||0x0,'position':m['position']||Number[v(0x21c)]});});const g=collection(db,'userProfiles'),h=await getDocs(g),i=new Map();h['forEach'](l=>{const w=u,m=l[w(0x1f9)]();m[w(0x22e)]&&i['set'](m[w(0x22e)]['toLowerCase'](),m);});for(const l of f){const m=l['username']['toLowerCase']();if(i[u(0x1df)](m)){const n=i[u(0x209)](m);n['country']&&(l[u(0x225)]=n[u(0x225)]['toLowerCase']());}}const j=f['map'](o=>o['username']),k=await fetchBatchMatchStatsD3(j);f['sort']((o,p)=>{const x=u,q=k['get'](o['username'])?.[x(0x232)]||0x0,r=k['get'](p[x(0x22e)])?.[x(0x232)]||0x0;if(q===0x0!==(r===0x0))return q===0x0?0x1:-0x1;return(o[x(0x219)]||0x3e7)-(p[x(0x219)]||0x3e7);}),f[u(0x1f0)]((o,p)=>{const y=u;o[y(0x219)]=p+0x1;}),playerCacheD3[u(0x1f9)]=f,playerCacheD3['timestamp']=c,updateLadderDisplayD3(f);}catch(o){console['error'](u(0x22c),o),b['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20colspan=\x228\x22\x20style=\x22text-align:\x20center;\x20color:\x20red;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Error\x20loading\x20D3\x20ladder\x20data:\x20'+o['message']+u(0x21b);}}function calculateStreakDays(a){const z=a33t;if(!a)return 0x0;const b=a[z(0x208)](),c=new Date(),d=Math['abs'](c-b);return Math['ceil'](d/(0x3e8*0x3c*0x3c*0x18));}async function updatePlayerPositions(a,b){const A=a33t;try{const c=collection(db,A(0x238)),d=await getDocs(c),e=[];d['forEach'](h=>{const B=A;e[B(0x224)]({'id':h['id'],...h['data']()});});const f=e[A(0x1f7)](h=>h[A(0x22e)]===a),g=e[A(0x1f7)](h=>h['username']===b);if(!f||!g){console['error']('Could\x20not\x20find\x20winner\x20or\x20loser\x20in\x20D3\x20players\x20list');return;}if(f['position']>g['position']){const h=g[A(0x219)];for(const i of e){i[A(0x219)]>=g['position']&&i['position']<f['position']&&i[A(0x22e)]!==a&&await updateDoc(doc(db,A(0x238),i['id']),{'position':i[A(0x219)]+0x1});}await updateDoc(doc(db,'playersD3',f['id']),{'position':h});if(h===0x1){const j=doc(db,'playersD3',f['id']),k=await getDoc(j);!k[A(0x1f9)]()[A(0x20e)]&&await updateDoc(j,{'firstPlaceDate':Timestamp['now']()});}if(g[A(0x219)]===0x1){const l=doc(db,'playersD3',g['id']);await updateDoc(l,{'firstPlaceDate':null});}}}catch(m){console[A(0x200)](A(0x1e2),m);}}async function updateLadderDisplayD3(a){const C=a33t;a[C(0x220)]((g,h)=>g[C(0x219)]-h[C(0x219)]);const b=document[C(0x233)](C(0x206));if(!b)return;b[C(0x202)]='';const c=a['map'](g=>g['username']),d=await fetchBatchMatchStatsD3(c),e=document[C(0x233)](C(0x1e3));e['innerHTML']=C(0x21d);const f=a[C(0x1fb)](g=>{const D=C,h=d[D(0x209)](g['username'])||{'totalMatches':0x0,'wins':0x0,'losses':0x0,'kda':0x0,'winRate':0x0,'totalKills':0x0,'totalDeaths':0x0};return createPlayerRowD3(g,h);})['join']('');b['innerHTML']=f,getPlayersLastEloChangesD3(c)[C(0x214)](g=>{const E=C,h=new Map();b[E(0x222)]('tr')['forEach']((i,j)=>{const F=E;j<c['length']&&h[F(0x211)](c[j],i);}),g[E(0x1f0)]((i,j)=>{const G=E,k=h['get'](j);if(k&&i!==0x0){const l=k['querySelector'](G(0x1eb));if(l){const m=i>0x0?'+'+i:''+i,n=l['querySelector']('.trend-indicator');n&&(n['textContent']=m,n[G(0x20c)]['color']=i>0x0?G(0x1f4):G(0x1e7),n['style']['fontWeight']=G(0x22b),n[G(0x20c)][G(0x237)]='0.85em',n[G(0x20c)][G(0x23d)]='inline',n[G(0x20c)]['visibility']=G(0x20d),n[G(0x20c)][G(0x1fe)]='1');}}});})['catch'](g=>console[C(0x200)](C(0x230),g));}async function fetchBatchMatchStatsD3(a){const H=a33t,b=new Map();try{const c=collection(db,H(0x22d)),d=await getDocs(c);d[H(0x1f0)](e=>{const I=H,f=e[I(0x1f9)]();if(a['includes'](f['winnerUsername'])){const g=f[I(0x218)];!b['has'](g)&&b['set'](g,{'totalMatches':0x0,'wins':0x0,'losses':0x0,'totalKills':0x0,'totalDeaths':0x0,'kda':0x0,'winRate':0x0});const h=b['get'](g);h[I(0x234)]++,h['totalMatches']++,h['totalKills']+=parseInt(f['winnerScore'])||0x0,h[I(0x226)]+=parseInt(f[I(0x1d9)])||0x0;}if(a['includes'](f['loserUsername'])){const i=f[I(0x201)];!b[I(0x1df)](i)&&b[I(0x211)](i,{'totalMatches':0x0,'wins':0x0,'losses':0x0,'totalKills':0x0,'totalDeaths':0x0,'kda':0x0,'winRate':0x0});const j=b['get'](i);j['losses']++,j['totalMatches']++,j['totalKills']+=parseInt(f[I(0x1d9)])||0x0,j['totalDeaths']+=parseInt(f[I(0x22f)])||0x0;}}),b[H(0x1f0)](e=>{const J=H;e[J(0x1de)]=e['totalDeaths']>0x0?(e['totalKills']/e[J(0x226)])['toFixed'](0x2):e[J(0x210)],e['winRate']=e['totalMatches']>0x0?(e[J(0x234)]/e['totalMatches']*0x64)[J(0x228)](0x1):0x0;});}catch(e){console[H(0x200)](H(0x1fc),e);}return b;}function createPlayerRowD3(a,b){const K=a33t,c=parseFloat(a['elo'])||0x0;let d='gray';if(c>=0x7d0)d=K(0x1ed);else{if(c>=0x708)d='#FFD700';else{if(c>=0x640)d='#C0C0C0';else c>=0x578&&(d='#CD7F32');}}let e='';return a['country']&&(e='<img\x20src=\x22../images/flags/'+a[K(0x225)][K(0x23b)]()+K(0x207)+a[K(0x225)]+'\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20class=\x22player-flag\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20onerror=\x22this.style.display=\x27none\x27\x22>'),'\x0a\x20\x20\x20\x20<tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+a[K(0x219)]+K(0x1da)+encodeURIComponent(a[K(0x22e)])+K(0x1e9)+d+K(0x1f1)+a[K(0x22e)]+K(0x227)+e+K(0x1f2)+d+K(0x216)+c+K(0x231)+b[K(0x232)]+K(0x1dc)+b[K(0x234)]+K(0x1dc)+b['losses']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+b['kda']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+b['winRate']+K(0x23a);}async function getPlayersLastEloChangesD3(a){const L=a33t,b=new Map();a['forEach'](c=>b[L(0x211)](c,0x0));try{console[L(0x23c)]('D3:\x20Looking\x20for\x20ELO\x20changes\x20for\x20users:',a);const c=new Map(),d=await getDocs(collection(db,L(0x238)));d[L(0x1f0)](j=>{const M=L,k=j['data']();k['username']&&c[M(0x211)](j['id'],k['username']);}),console['log']('D3:\x20Player\x20ID\x20mappings:',Array[L(0x21f)](c['entries']()));const e=collection(db,L(0x229)),f=query(e,orderBy('timestamp',L(0x239)),limit(0x64)),g=await getDocs(f);g['empty']?console['log'](L(0x1f5)):console[L(0x23c)]('D3:\x20Found\x20'+g[L(0x204)]+L(0x1e8));const h=new Map();g[L(0x1f0)](j=>{const N=L,k=j['data']();let l=null;if(k[N(0x22e)])l=k[N(0x22e)];else{if(k['playerUsername'])l=k['playerUsername'];else{if(k['player']&&typeof k[N(0x1f6)]==='string')l=k['player'];else{if(k[N(0x1f6)]&&c['has'](k[N(0x1f6)]))l=c[N(0x209)](k['player']);else k['playerId']&&c[N(0x1df)](k['playerId'])&&(l=c['get'](k['playerId']));}}}(k['username']==='pilot'||k[N(0x1ec)]==='pilot'||k[N(0x1f6)]&&c['get'](k['player'])===N(0x1ef))&&console['log']('D3:\x20Found\x20pilot\x20entry:',k),l&&a[N(0x221)](l)&&(!h[N(0x1df)](l)&&h['set'](l,[]),h['get'](l)['push']({...k,'timestamp':k[N(0x20b)]?.[N(0x223)]||0x0}));}),console[L(0x23c)]('D3:\x20Found\x20entries\x20for\x20'+h[L(0x204)]+L(0x1ea)),h[L(0x1f0)]((j,k)=>{const O=L;if(j[O(0x203)]>0x0){j['sort']((m,n)=>n[O(0x20b)]-m['timestamp']);const l=j[O(0x1f7)](m=>m[O(0x1e4)]!==undefined||m['newElo']!==undefined&&m[O(0x212)]!==undefined);if(l){let m;if(l[O(0x1e4)]!==undefined)m=l[O(0x1e4)];else l[O(0x217)]!==undefined&&l[O(0x212)]!==undefined&&(m=l[O(0x217)]-l[O(0x212)]);m!==undefined&&(b[O(0x211)](k,m),console['log']('D3:\x20'+k+'\x20ELO\x20change:\x20'+m));}}});if(h['size']===0x0){console[L(0x23c)](L(0x215));const j=collection(db,'eloHistory'),k=query(j,where('gameMode','==','D3'),orderBy('timestamp',L(0x239)),limit(0x32));try{const l=await getDocs(k);console[L(0x23c)](L(0x1db)+l[L(0x204)]+L(0x235)),l[L(0x1f0)](m=>{const P=L,n=m[P(0x1f9)]();let o=n['username']||n[P(0x1ec)];!o&&n[P(0x1f6)]&&c[P(0x1df)](n['player'])&&(o=c[P(0x209)](n[P(0x1f6)]));if(o&&a[P(0x221)](o)){const p=n[P(0x1e4)]||(n[P(0x217)]!==undefined&&n['previousElo']!==undefined?n[P(0x217)]-n[P(0x212)]:0x0);p!==0x0&&(b[P(0x211)](o,p),console['log'](P(0x1f8)+o+'\x20fallback\x20ELO\x20change:\x20'+p));}});}catch(m){console[L(0x23c)](L(0x20a),m);}}const i=Array['from'](b['entries']())['filter'](([n,o])=>o!==0x0);console['log']('D3:\x20Final\x20ELO\x20changes:',i);}catch(n){console[L(0x200)](L(0x1d8),n);}return b;}export{displayLadderD3,updatePlayerPositions};
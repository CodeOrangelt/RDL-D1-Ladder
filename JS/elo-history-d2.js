function a16_0x2937(_0x6656af,_0x2cac2d){_0x6656af=_0x6656af-0xb8;const _0x16644d=a16_0x134f();let _0xae6bc8=_0x16644d[_0x6656af];return _0xae6bc8;}const a16_0xae6bc8=(function(){let _0x3f6036=!![];return function(_0x8ab2e1,_0x5dc33e){const _0x4ab4e5=_0x3f6036?function(){const _0x14e7c0=a16_0x2937;if(_0x5dc33e){const _0x66089f=_0x5dc33e[_0x14e7c0(0xd6)](_0x8ab2e1,arguments);return _0x5dc33e=null,_0x66089f;}}:function(){};return _0x3f6036=![],_0x4ab4e5;};}()),a16_0x16644d=a16_0xae6bc8(this,function(){const _0x3cb591=a16_0x2937;let _0x1c3060;try{const _0x58256e=Function(_0x3cb591(0xbf)+_0x3cb591(0xd9)+');');_0x1c3060=_0x58256e();}catch(_0x258033){_0x1c3060=window;}const _0x3028a6=_0x1c3060[_0x3cb591(0xcf)]=_0x1c3060[_0x3cb591(0xcf)]||{},_0x28589d=[_0x3cb591(0xbc),_0x3cb591(0xe1),_0x3cb591(0xe0),_0x3cb591(0xd5),_0x3cb591(0xca),_0x3cb591(0xd0),_0x3cb591(0xe3)];for(let _0xfd9efd=0x0;_0xfd9efd<_0x28589d[_0x3cb591(0xc1)];_0xfd9efd++){const _0x215088=a16_0xae6bc8[_0x3cb591(0xc4)][_0x3cb591(0xc0)][_0x3cb591(0xd1)](a16_0xae6bc8),_0x321dd2=_0x28589d[_0xfd9efd],_0x43a438=_0x3028a6[_0x321dd2]||_0x215088;_0x215088[_0x3cb591(0xc5)]=a16_0xae6bc8[_0x3cb591(0xd1)](a16_0xae6bc8),_0x215088[_0x3cb591(0xc7)]=_0x43a438[_0x3cb591(0xc7)][_0x3cb591(0xd1)](_0x43a438),_0x3028a6[_0x321dd2]=_0x215088;}});a16_0x16644d();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';function a16_0x134f(){const _0x57012d=['opponent','newElo','D2\x20ELO\x20history\x20recorded\x20for\x20','desc','log','approvedMatchesD2','playersD2','return\x20(function()\x20','prototype','length','demotion','loserId','constructor','__proto__','match','toString','Unknown\x20Player','name','exception','Error\x20fetching\x20D2\x20ELO\x20history:','map','promotion','loserUsername','console','table','bind','winnerUsername','Error\x20recording\x20D2\x20ELO\x20history:','username','error','apply','exists','winnerId','{}.constructor(\x22return\x20this\x22)(\x20)','size','player','docs','previousElo','Error\x20getting\x20username:','eloHistoryD2','info','warn','empty','trace','data','timestamp','all'];a16_0x134f=function(){return _0x57012d;};return a16_0x134f();}import{getRankStyle}from'./ranks.js';let lastVisibleD2=null;async function getUsernameByIdD2(_0x5d3130){const _0x2f1f61=a16_0x2937;try{if(!_0x5d3130)return _0x2f1f61(0xc8);const _0xe52d6c=await getDoc(doc(db,_0x2f1f61(0xbe),_0x5d3130));if(_0xe52d6c[_0x2f1f61(0xd7)]())return _0xe52d6c[_0x2f1f61(0xe4)]()[_0x2f1f61(0xd4)]||_0x2f1f61(0xc8);const _0x5d2f2a=await getDocs(query(collection(db,_0x2f1f61(0xbd)),where(_0x2f1f61(0xd8),'==',_0x5d3130),limit(0x1)));if(!_0x5d2f2a[_0x2f1f61(0xe2)])return _0x5d2f2a[_0x2f1f61(0xdc)][0x0][_0x2f1f61(0xe4)]()[_0x2f1f61(0xd2)]||_0x2f1f61(0xc8);const _0x82b7f7=await getDocs(query(collection(db,_0x2f1f61(0xbd)),where(_0x2f1f61(0xc3),'==',_0x5d3130),limit(0x1)));if(!_0x82b7f7[_0x2f1f61(0xe2)])return _0x82b7f7[_0x2f1f61(0xdc)][0x0][_0x2f1f61(0xe4)]()[_0x2f1f61(0xce)]||_0x2f1f61(0xc8);return _0x2f1f61(0xc8);}catch(_0x3d19fe){return console[_0x2f1f61(0xd5)](_0x2f1f61(0xde),_0x3d19fe),_0x2f1f61(0xc8);}}export async function recordEloChangeD2({playerId:_0x44eb4f,previousElo:_0x883879,newElo:_0x29925d,opponentId:_0x5cd3a8,matchResult:_0x1cffbc,previousPosition:_0x55d6e1,newPosition:_0x1de0ef,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x547f6f,timestamp:_0x4878a7,matchCount:matchCount=null,winRate:winRate=0x0}){const _0x3aa625=a16_0x2937;try{const _0x2b7dfd=doc(collection(db,_0x3aa625(0xdf))),_0x1deba9=await getUsernameByIdD2(_0x44eb4f),_0x3e65b8=_0x5cd3a8?await getUsernameByIdD2(_0x5cd3a8):null;let _0x5e3f99=_0x3aa625(0xc6);if(isPromotion)_0x5e3f99=_0x3aa625(0xcd);if(isDemotion)_0x5e3f99=_0x3aa625(0xc2);const _0x57b9e2=getRankStyle(_0x29925d,matchCount,winRate),_0x2a48b1=_0x57b9e2[_0x3aa625(0xc9)];return await setDoc(_0x2b7dfd,{'type':_0x5e3f99,'player':_0x44eb4f,'username':_0x1deba9,'playerUsername':_0x1deba9,'opponent':_0x5cd3a8,'opponentUsername':_0x3e65b8,'previousElo':_0x883879,'newElo':_0x29925d,'change':_0x29925d-_0x883879,'matchResult':_0x1cffbc,'previousPosition':_0x55d6e1,'newPosition':_0x1de0ef,'rankAchieved':_0x2a48b1,'matchId':_0x547f6f,'gameMode':'D2','timestamp':_0x4878a7}),console[_0x3aa625(0xbc)](_0x3aa625(0xba)+_0x1deba9+'\x20('+_0x44eb4f+')'),!![];}catch(_0x5918d0){console[_0x3aa625(0xd5)](_0x3aa625(0xd3),_0x5918d0);throw _0x5918d0;}}export async function getEloHistoryD2(_0x42ad40=0x14){const _0x50db4d=a16_0x2937;try{const _0x2c0bd5=collection(db,_0x50db4d(0xdf));let _0x5caf50;lastVisibleD2?_0x5caf50=query(_0x2c0bd5,orderBy(_0x50db4d(0xe5),_0x50db4d(0xbb)),startAfter(lastVisibleD2),limit(_0x42ad40)):_0x5caf50=query(_0x2c0bd5,orderBy(_0x50db4d(0xe5),_0x50db4d(0xbb)),limit(_0x42ad40));const _0x495cec=await getDocs(_0x5caf50);if(_0x495cec[_0x50db4d(0xe2)])return{'entries':[],'hasMore':![]};lastVisibleD2=_0x495cec[_0x50db4d(0xdc)][_0x495cec[_0x50db4d(0xdc)][_0x50db4d(0xc1)]-0x1];const _0x6f627c=_0x495cec[_0x50db4d(0xdc)][_0x50db4d(0xcc)](async _0x195d75=>{const _0x4f2195=_0x50db4d,_0x42dd75=_0x195d75[_0x4f2195(0xe4)](),[_0x2d185c,_0x2f68cd]=await Promise[_0x4f2195(0xe6)]([getUsernameByIdD2(_0x42dd75[_0x4f2195(0xdb)]),getUsernameByIdD2(_0x42dd75[_0x4f2195(0xb8)])]);return{..._0x42dd75,'playerUsername':_0x2d185c,'opponentUsername':_0x2f68cd,'change':_0x42dd75[_0x4f2195(0xb9)]-_0x42dd75[_0x4f2195(0xdd)],'timestamp':_0x42dd75[_0x4f2195(0xe5)]};}),_0x470dee=await Promise[_0x50db4d(0xe6)](_0x6f627c);return{'entries':_0x470dee,'hasMore':_0x495cec[_0x50db4d(0xda)]===_0x42ad40};}catch(_0xec2f72){console[_0x50db4d(0xd5)](_0x50db4d(0xcb),_0xec2f72);throw _0xec2f72;}}export function resetPaginationD2(){lastVisibleD2=null;}
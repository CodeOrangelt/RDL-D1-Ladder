const a38_0x51c149=a38_0x4cbb,a38_0x2e2f86=(function(){let _0x6f55dd=!![];return function(_0x3059cb,_0x3b3cd6){const _0x5ab393=_0x6f55dd?function(){if(_0x3b3cd6){const _0x8c4738=_0x3b3cd6['apply'](_0x3059cb,arguments);return _0x3b3cd6=null,_0x8c4738;}}:function(){};return _0x6f55dd=![],_0x5ab393;};}()),a38_0x5e39fe=a38_0x2e2f86(this,function(){const _0x1f3a04=a38_0x4cbb,_0x47dc16=function(){let _0x593903;try{_0x593903=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x11be3d){_0x593903=window;}return _0x593903;},_0x3e9e80=_0x47dc16(),_0x21028a=_0x3e9e80['console']=_0x3e9e80[_0x1f3a04(0x115)]||{},_0x3567ef=[_0x1f3a04(0x12b),'warn',_0x1f3a04(0x126),'error','exception','table','trace'];for(let _0xcd7d6a=0x0;_0xcd7d6a<_0x3567ef[_0x1f3a04(0x123)];_0xcd7d6a++){const _0x7d2bfe=a38_0x2e2f86['constructor']['prototype']['bind'](a38_0x2e2f86),_0x5aa40d=_0x3567ef[_0xcd7d6a],_0x105afc=_0x21028a[_0x5aa40d]||_0x7d2bfe;_0x7d2bfe['__proto__']=a38_0x2e2f86['bind'](a38_0x2e2f86),_0x7d2bfe['toString']=_0x105afc['toString'][_0x1f3a04(0x11e)](_0x105afc),_0x21028a[_0x5aa40d]=_0x7d2bfe;}});a38_0x5e39fe();const functions=require('firebase-functions'),admin=require('firebase-admin');function a38_0xeb36(){const _0x5e20ef=['Unknown','rebuildMembersListManual','error','push','all','console','batch','updateMembersList','Members\x20list\x20rebuilt\x20successfully','set','ladders','elo','send','playersD2','bind','doc','unranked','silver','username','length','userId','emerald','info','playersD3','params','get','data','log','collection','userProfiles'];a38_0xeb36=function(){return _0x5e20ef;};return a38_0xeb36();}admin['initializeApp']();function a38_0x4cbb(_0x3f230b,_0x21efa1){const _0x5e39fe=a38_0xeb36();return a38_0x4cbb=function(_0x2e2f86,_0x387cd1){_0x2e2f86=_0x2e2f86-0x110;let _0xeb3612=_0x5e39fe[_0x2e2f86];return _0xeb3612;},a38_0x4cbb(_0x3f230b,_0x21efa1);}const db=admin['firestore']();exports[a38_0x51c149(0x117)]=functions['firestore']['document']('{collection}/{docId}')['onWrite'](async(_0x28a24f,_0x8d3e2a)=>{const _0x5d840c=a38_0x51c149,_0x531366=_0x8d3e2a['params'][_0x5d840c(0x12c)],_0x234ede=_0x8d3e2a[_0x5d840c(0x128)]['docId'];if(!['players','playersD2',_0x5d840c(0x127),'userProfiles','nonParticipants']['includes'](_0x531366))return null;try{await rebuildMembersList(),console['log']('Successfully\x20updated\x20aggregated\x20members\x20list');}catch(_0x5b455f){console['error']('Error\x20updating\x20members\x20list:',_0x5b455f);}});async function rebuildMembersList(){const _0x403cf2=a38_0x51c149,_0x4d1535=db[_0x403cf2(0x116)](),[_0x24b0f7,_0x41f3ff,_0x129659,_0x1dee9f,_0x3e453c]=await Promise[_0x403cf2(0x114)]([db['collection'](_0x403cf2(0x12d))['get'](),db['collection']('players')['get'](),db[_0x403cf2(0x12c)](_0x403cf2(0x11d))['get'](),db['collection']('playersD3')[_0x403cf2(0x129)](),db['collection']('nonParticipants')[_0x403cf2(0x129)]()]),_0xefdbeb=new Map();_0x24b0f7['forEach'](_0x51eca9=>{_0xefdbeb['set'](_0x51eca9['id'],_0x51eca9['data']());});const _0xd9eea1=new Map(),_0x292b24=(_0x2325c8,_0x2407d7)=>{_0x2325c8['forEach'](_0x2cfb17=>{const _0x560c41=a38_0x4cbb,_0x519387=_0x2cfb17['data'](),_0x2a92d3=_0x2cfb17['id'];!_0xd9eea1['has'](_0x2a92d3)&&_0xd9eea1['set'](_0x2a92d3,{'userId':_0x2a92d3,'username':_0x519387[_0x560c41(0x122)]||_0x560c41(0x110),'ladders':[],'isNonParticipant':![]});const _0xaee7ed=_0xd9eea1['get'](_0x2a92d3);_0xaee7ed[_0x560c41(0x11a)]['push']({'ladder':_0x2407d7,'elo':_0x519387['eloRating']||0x4b0,'active':_0x519387['active']!==![]});});};_0x292b24(_0x41f3ff,'D1'),_0x292b24(_0x129659,'D2'),_0x292b24(_0x1dee9f,'D3'),_0x3e453c['forEach'](_0x5d1e8d=>{const _0x1e6234=_0x403cf2,_0x3adb0f=_0x5d1e8d[_0x1e6234(0x12a)](),_0x396079=_0x5d1e8d['id'];!_0xd9eea1['has'](_0x396079)&&_0x3adb0f['username']&&_0xd9eea1[_0x1e6234(0x119)](_0x396079,{'userId':_0x396079,'username':_0x3adb0f[_0x1e6234(0x122)],'ladders':[],'isNonParticipant':!![]});});const _0x481236=[];_0xd9eea1['forEach']((_0x4d99c7,_0x3dd326)=>{const _0x150900=_0x403cf2,_0x5da9b4=_0xefdbeb['get'](_0x3dd326)||{};let _0x24c39e=0x0,_0x3b4aeb=null;if(_0x4d99c7['ladders']['length']>0x0){const _0x2cfdc4=_0x4d99c7['ladders']['sort']((_0x3bd5ac,_0x48f2c9)=>_0x48f2c9[_0x150900(0x11b)]-_0x3bd5ac['elo']);_0x24c39e=_0x2cfdc4[0x0]['elo'],_0x3b4aeb=_0x2cfdc4[0x0]['ladder'];}const _0x4d9b51={'userId':_0x3dd326,'username':_0x4d99c7['username'],'profileImageUrl':_0x5da9b4['profileImageUrl']||null,'country':_0x5da9b4['country']||null,'motto':_0x5da9b4['motto']||null,'favoriteMap':_0x5da9b4['favoriteMap']||null,'favoriteWeapon':_0x5da9b4['favoriteWeapon']||null,'isNonParticipant':_0x4d99c7['isNonParticipant'],'ladders':_0x4d99c7['ladders'],'primaryLadder':_0x3b4aeb,'highestElo':_0x24c39e,'rank':getPlayerRank(_0x24c39e),'lastUpdated':admin['firestore']['FieldValue']['serverTimestamp']()};_0x481236[_0x150900(0x113)](_0x4d9b51);});const _0x55a575=db[_0x403cf2(0x12c)]('aggregatedMembers'),_0x234b67=await _0x55a575['get'](),_0x5e7e73=[];_0x234b67['forEach'](_0x438ffa=>{_0x5e7e73['push'](_0x438ffa['ref']['delete']());}),await Promise['all'](_0x5e7e73);const _0x25b6a3=0x1f4,_0xf3fb3f=[];for(let _0x373657=0x0;_0x373657<_0x481236['length'];_0x373657+=_0x25b6a3){const _0x47057a=db['batch'](),_0x352f09=_0x481236['slice'](_0x373657,_0x373657+_0x25b6a3);_0x352f09['forEach'](_0x5044b2=>{const _0xbd9468=_0x403cf2,_0x11bebd=_0x55a575[_0xbd9468(0x11f)](_0x5044b2[_0xbd9468(0x124)]);_0x47057a[_0xbd9468(0x119)](_0x11bebd,_0x5044b2);}),_0xf3fb3f['push'](_0x47057a['commit']());}await Promise[_0x403cf2(0x114)](_0xf3fb3f);}function getPlayerRank(_0x3f621a){const _0x131634=a38_0x51c149;if(_0x3f621a>=0x7d0)return _0x131634(0x125);if(_0x3f621a>=0x708)return'gold';if(_0x3f621a>=0x640)return _0x131634(0x121);if(_0x3f621a>=0x578)return'bronze';return _0x131634(0x120);}exports[a38_0x51c149(0x111)]=functions['https']['onRequest'](async(_0x6fb1c0,_0x170fb0)=>{const _0x58d873=a38_0x51c149;try{await rebuildMembersList(),_0x170fb0['status'](0xc8)['send'](_0x58d873(0x118));}catch(_0x1815aa){console[_0x58d873(0x112)]('Error\x20rebuilding\x20members\x20list:',_0x1815aa),_0x170fb0['status'](0x1f4)[_0x58d873(0x11c)]('Error\x20rebuilding\x20members\x20list');}});
const a12_0x4066fe=a12_0x4b9b,a12_0x1eb165=(function(){let _0x2b84ed=!![];return function(_0x3021f6,_0x582114){const _0x471404=_0x2b84ed?function(){if(_0x582114){const _0x3af0eb=_0x582114['apply'](_0x3021f6,arguments);return _0x582114=null,_0x3af0eb;}}:function(){};return _0x2b84ed=![],_0x471404;};}()),a12_0x2921e9=a12_0x1eb165(this,function(){const _0x1ba1b6=a12_0x4b9b;let _0x221934;try{const _0x203688=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x221934=_0x203688();}catch(_0x2fbd20){_0x221934=window;}const _0x5b099b=_0x221934[_0x1ba1b6(0x145)]=_0x221934[_0x1ba1b6(0x145)]||{},_0x2796bb=[_0x1ba1b6(0x136),'warn','info','error',_0x1ba1b6(0x15b),_0x1ba1b6(0x12a),'trace'];for(let _0x2b5ac0=0x0;_0x2b5ac0<_0x2796bb['length'];_0x2b5ac0++){const _0x16be7d=a12_0x1eb165['constructor']['prototype']['bind'](a12_0x1eb165),_0x33d99f=_0x2796bb[_0x2b5ac0],_0x9c8148=_0x5b099b[_0x33d99f]||_0x16be7d;_0x16be7d[_0x1ba1b6(0x14c)]=a12_0x1eb165['bind'](a12_0x1eb165),_0x16be7d['toString']=_0x9c8148['toString']['bind'](_0x9c8148),_0x5b099b[_0x33d99f]=_0x16be7d;}});a12_0x2921e9();import{getAuth,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{doc,getDoc,collection,query,where,getDocs,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import{isAdmin}from'./admin-check.js';const ADMIN_EMAILS=['admin@ladder.com',a12_0x4066fe(0x157)],userCache={'uid':null,'username':null,'isAdmin':![],'hasCheckedCollections':![],'lastChecked':0x0,'role':null},invitationCache={'lastCheck':0x0,'pendingCount':0x0,'checkInterval':0x493e0};function updateInboxNotification(_0x35e138){const _0x4cfd96=a12_0x4066fe,_0x22aedb=document[_0x4cfd96(0x152)]('inbox-notification');_0x22aedb&&(_0x35e138>0x0?(_0x22aedb['style'][_0x4cfd96(0x139)]='inline-block',_0x22aedb['textContent']=_0x35e138>0x9?'9+':_0x35e138):_0x22aedb['style']['display']='none');}async function checkPendingInvitationsForCurrentUser(_0xd253cb){const _0x4f60ad=a12_0x4066fe;try{const _0x5693df=Date['now']();if(_0x5693df-invitationCache['lastCheck']<invitationCache['checkInterval'])return updateInboxNotification(invitationCache['pendingCount']),invitationCache[_0x4f60ad(0x12c)];invitationCache[_0x4f60ad(0x12f)]=_0x5693df;const _0xc67e09=collection(db,'gameInvitations'),_0x12971b=query(_0xc67e09,where('toUserId','==',_0xd253cb),where('status','==',_0x4f60ad(0x13c)),limit(0x5)),_0x38e219=await getDocs(_0x12971b),_0x1539c8=_0x38e219['size'];return invitationCache['pendingCount']=_0x1539c8,updateInboxNotification(_0x1539c8),_0x1539c8;}catch(_0x1cb615){return console[_0x4f60ad(0x142)]('Could\x20not\x20check\x20pending\x20invitations\x20for\x20current\x20user:',_0x1cb615),0x0;}}function updateAuthSectionImmediate(_0x50d50e,_0x12124b=![]){const _0x2190e6=a12_0x4066fe,_0x23a491=document['getElementById']('auth-section');if(!_0x23a491)return;if(_0x50d50e&&_0x12124b)document['querySelectorAll'](_0x2190e6(0x156))['forEach'](_0x406f49=>{const _0x3250c3=_0x2190e6;_0x406f49['style']['display']=_0x3250c3(0x134);});else!_0x50d50e&&document['querySelectorAll']('.admin-only')['forEach'](_0x51581a=>{const _0x761916=_0x2190e6;_0x51581a[_0x761916(0x13e)]['display']=_0x761916(0x128);});if(_0x50d50e){const _0x1178cb=userCache[_0x2190e6(0x147)]||(_0x50d50e[_0x2190e6(0x129)]?_0x50d50e['email']['split']('@')[0x0]:'User'),_0x320053=userCache['role']?'\x20('+userCache['role']+')':_0x12124b?_0x2190e6(0x143):'';_0x23a491[_0x2190e6(0x13d)]=_0x2190e6(0x158)+_0x1178cb+_0x320053+'</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username='+encodeURIComponent(_0x1178cb)+_0x2190e6(0x14a);const _0x3c6b2a=document[_0x2190e6(0x152)]('logout-link');_0x3c6b2a&&_0x3c6b2a['addEventListener']('click',_0x494b37=>{const _0x1390cf=_0x2190e6;_0x494b37[_0x1390cf(0x155)]();const _0x27617a=getAuth();updateAuthSectionImmediate(null),_0x27617a['signOut']()[_0x1390cf(0x151)](_0x35e0d0=>{console['error']('Error\x20signing\x20out:',_0x35e0d0);});}),_0x50d50e['uid']&&setTimeout(()=>{const _0x335144=_0x2190e6;checkPendingInvitationsForCurrentUser(_0x50d50e[_0x335144(0x12e)]);},0x3e8);}else _0x23a491['innerHTML']='<a\x20href=\x22login.html\x22\x20class=\x22login-link\x22>Login</a>';}async function checkAdminRoles(_0x4964a8){const _0x3920c0=a12_0x4066fe;if(!_0x4964a8||!_0x4964a8['email'])return{'isAdmin':![],'role':null};try{console[_0x3920c0(0x136)]('Checking\x20roles\x20for\x20user:\x20'+_0x4964a8['email']);const _0x346af3=['players',_0x3920c0(0x14f),'playersD3',_0x3920c0(0x12b),'userProfiles'],_0x46cda5=['council',_0x3920c0(0x127),_0x3920c0(0x149),_0x3920c0(0x150)];for(const _0x562891 of _0x346af3){try{const _0xef4d35=doc(db,_0x562891,_0x4964a8[_0x3920c0(0x12e)]),_0x58eaa7=await getDoc(_0xef4d35);if(_0x58eaa7['exists']()){const _0x3f36e5=_0x58eaa7['data']();console['log'](_0x3920c0(0x153)+_0x562891+'\x20by\x20UID:',_0x3f36e5);let _0x577d13=(_0x3f36e5['roleName']||_0x3f36e5['role']||'')[_0x3920c0(0x141)](),_0x41bbbd=_0x3f36e5['roleName']||_0x3f36e5[_0x3920c0(0x132)]||'';if(_0x577d13&&_0x46cda5[_0x3920c0(0x135)](_0x577d13)){console['log']('Found\x20admin\x20role:\x20'+_0x577d13+'\x20in\x20'+_0x562891);const _0xe6bf6d=_0x41bbbd['split']('\x20')['map'](_0x247075=>_0x247075[_0x3920c0(0x144)](0x0)[_0x3920c0(0x15a)]()+_0x247075['slice'](0x1)['toLowerCase']())[_0x3920c0(0x159)]('\x20');return{'isAdmin':!![],'role':_0xe6bf6d};}}}catch(_0x177e88){console[_0x3920c0(0x138)]('Error\x20checking\x20'+_0x562891+_0x3920c0(0x12d),_0x177e88);}}for(const _0x5aeae8 of _0x346af3){try{const _0x44e1b2=collection(db,_0x5aeae8);let _0x47ab7d=query(_0x44e1b2,where(_0x3920c0(0x129),'==',_0x4964a8['email'])),_0x48705e=await getDocs(_0x47ab7d);_0x48705e['empty']&&(_0x47ab7d=query(_0x44e1b2,where('email','==',_0x4964a8[_0x3920c0(0x129)]['toLowerCase']())),_0x48705e=await getDocs(_0x47ab7d));if(!_0x48705e[_0x3920c0(0x133)]){const _0xabd14b=_0x48705e['docs'][0x0][_0x3920c0(0x146)]();console['log']('Found\x20user\x20in\x20'+_0x5aeae8+'\x20by\x20email:',_0xabd14b);let _0x3b2be8=(_0xabd14b['roleName']||_0xabd14b['role']||'')['toLowerCase'](),_0x2e4ef1=_0xabd14b['roleName']||_0xabd14b[_0x3920c0(0x132)]||'';if(_0x3b2be8&&_0x46cda5['includes'](_0x3b2be8)){console[_0x3920c0(0x136)]('Found\x20admin\x20role:\x20'+_0x3b2be8+'\x20in\x20'+_0x5aeae8);const _0x2259ba=_0x2e4ef1[_0x3920c0(0x14d)]('\x20')['map'](_0xe6f47c=>_0xe6f47c['charAt'](0x0)['toUpperCase']()+_0xe6f47c['slice'](0x1)['toLowerCase']())['join']('\x20');return{'isAdmin':!![],'role':_0x2259ba};}}}catch(_0x3d95d3){console[_0x3920c0(0x138)]('Error\x20checking\x20'+_0x5aeae8+'\x20by\x20email:',_0x3d95d3);}}return console['log']('No\x20admin\x20roles\x20found\x20for\x20user'),{'isAdmin':![],'role':null};}catch(_0x14538c){return console['error'](_0x3920c0(0x140),_0x14538c),{'isAdmin':![],'role':null};}}function a12_0x5b36(){const _0x134bb3=['creative\x20lead','none','email','table','nonParticipants','pendingCount','\x20by\x20UID:','uid','lastCheck','hasCheckedCollections','currentUser','role','empty','block','includes','log','forEach','error','display','click','addEventListener','pending','innerHTML','style','User','Error\x20in\x20checkAdminRoles:','toLowerCase','warn','\x20(Admin)','charAt','console','data','username','isAdmin','owner','\x22>Profile</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./inbox.html\x22\x20class=\x22nav-notification\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Inbox\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22inbox-notification\x22\x20class=\x22notification-dot\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22members.html\x22>Members</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./redeem.html\x22><i\x20class=\x22fas\x20fa-gift\x22></i>\x20Redeem</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20id=\x22logout-link\x22>Sign\x20Out</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','playersCTF','__proto__','split','userProfiles','playersD2','admin','catch','getElementById','Found\x20user\x20in\x20','now','preventDefault','.admin-only','Brian2af@outlook.com','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20class=\x22nav-username\x22>','join','toUpperCase','exception'];a12_0x5b36=function(){return _0x134bb3;};return a12_0x5b36();}async function updateAuthSection(_0x3c9e56){const _0x269b60=a12_0x4066fe,_0x37f1d0=_0x3c9e56&&isAdmin(_0x3c9e56['email']);updateAuthSectionImmediate(_0x3c9e56,_0x37f1d0);if(!_0x3c9e56){userCache[_0x269b60(0x12e)]=null,userCache[_0x269b60(0x147)]=null,userCache['isAdmin']=![],userCache[_0x269b60(0x130)]=![],userCache['role']=null;return;}const _0x597474=Date[_0x269b60(0x154)]();if(_0x3c9e56['uid']===userCache['uid']&&userCache['hasCheckedCollections']&&_0x597474-userCache['lastChecked']<0x493e0)return;try{userCache['uid']=_0x3c9e56['uid'],userCache['lastChecked']=_0x597474;const _0x5dd4c4=isAdmin(_0x3c9e56[_0x269b60(0x129)]);userCache['isAdmin']=_0x5dd4c4;if(!_0x5dd4c4){const {isAdmin:_0x3b91ec,role:_0x33c767}=await checkAdminRoles(_0x3c9e56);userCache[_0x269b60(0x148)]=_0x3b91ec,userCache['role']=_0x33c767,_0x3b91ec&&(document['querySelectorAll']('.admin-only')[_0x269b60(0x137)](_0x4f0c34=>{_0x4f0c34['style']['display']='block';}),updateAuthSectionImmediate(_0x3c9e56,!![]));}const _0x41b83d=['players','playersD2','playersD3','playersDuos',_0x269b60(0x14b),'nonParticipants',_0x269b60(0x14e)],_0x24ac7e=_0x41b83d['map'](_0x55026c=>getDoc(doc(db,_0x55026c,_0x3c9e56['uid']))['then'](_0x19bd1a=>_0x19bd1a['exists']()?{'collection':_0x55026c,'data':_0x19bd1a[_0x269b60(0x146)]()}:null)['catch'](()=>null)),_0x3841ab=await Promise['all'](_0x24ac7e),_0x3c642c=_0x3841ab['filter'](_0x332fa6=>_0x332fa6!==null);let _0x282b47=null;for(const _0x5d26fa of _0x3c642c){if(_0x5d26fa[_0x269b60(0x146)]['username']){_0x282b47=_0x5d26fa['data']['username'];break;}}userCache['username']=_0x282b47||(_0x3c9e56[_0x269b60(0x129)]?_0x3c9e56['email'][_0x269b60(0x14d)]('@')[0x0]:_0x269b60(0x13f)),userCache[_0x269b60(0x130)]=!![],updateAuthSectionImmediate(_0x3c9e56,userCache['isAdmin']),setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0x3c9e56['uid']);},0x1f4);}catch(_0x1e2058){console[_0x269b60(0x138)]('Error\x20in\x20full\x20auth\x20update:',_0x1e2058);}}function a12_0x4b9b(_0x279226,_0x198eb1){const _0x2921e9=a12_0x5b36();return a12_0x4b9b=function(_0x1eb165,_0x1bf973){_0x1eb165=_0x1eb165-0x127;let _0x5b3685=_0x2921e9[_0x1eb165];return _0x5b3685;},a12_0x4b9b(_0x279226,_0x198eb1);}document[a12_0x4066fe(0x13b)]('DOMContentLoaded',()=>{const _0x58e856=a12_0x4066fe,_0x2e5eb0=getAuth();onAuthStateChanged(_0x2e5eb0,async _0x4bb743=>{const _0x23d0b5=a12_0x4b9b;await updateAuthSection(_0x4bb743),_0x4bb743&&checkPendingInvitationsForCurrentUser(_0x4bb743[_0x23d0b5(0x12e)]);}),document['addEventListener']('visibilitychange',()=>{!document['hidden']&&_0x2e5eb0['currentUser']&&checkPendingInvitationsForCurrentUser(_0x2e5eb0['currentUser']['uid']);}),document[_0x58e856(0x13b)](_0x58e856(0x13a),_0x493ab1=>{const _0x21e157=_0x58e856;_0x493ab1['target']['closest']('a[href]')&&_0x2e5eb0['currentUser']&&checkPendingInvitationsForCurrentUser(_0x2e5eb0[_0x21e157(0x131)]['uid']);});});export{updateAuthSection};
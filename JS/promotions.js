const a46_0x38d2b6=a46_0xdf16,a46_0x24c52a=(function(){let _0x4e030a=!![];return function(_0x36e172,_0x519e5c){const _0x45b6c1=_0x4e030a?function(){if(_0x519e5c){const _0x54f162=_0x519e5c['apply'](_0x36e172,arguments);return _0x519e5c=null,_0x54f162;}}:function(){};return _0x4e030a=![],_0x45b6c1;};}()),a46_0x508917=a46_0x24c52a(this,function(){const _0x13cddd=a46_0xdf16,_0x439b50=function(){const _0x35c6d8=a46_0xdf16;let _0x33d4ee;try{_0x33d4ee=Function(_0x35c6d8(0xbb)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x5cef2c){_0x33d4ee=window;}return _0x33d4ee;},_0x295c6e=_0x439b50(),_0x1df988=_0x295c6e['console']=_0x295c6e['console']||{},_0x3203c5=['log','warn',_0x13cddd(0xd5),_0x13cddd(0xcd),'exception','table',_0x13cddd(0xd0)];for(let _0xe6b1fa=0x0;_0xe6b1fa<_0x3203c5['length'];_0xe6b1fa++){const _0x24955f=a46_0x24c52a['constructor'][_0x13cddd(0x8f)]['bind'](a46_0x24c52a),_0x4c5890=_0x3203c5[_0xe6b1fa],_0xae320e=_0x1df988[_0x4c5890]||_0x24955f;_0x24955f['__proto__']=a46_0x24c52a['bind'](a46_0x24c52a),_0x24955f['toString']=_0xae320e['toString']['bind'](_0xae320e),_0x1df988[_0x4c5890]=_0x24955f;}});a46_0x508917();import{collection,doc,query,where,orderBy,limit,getDocs,addDoc,getDoc,serverTimestamp,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{auth,db}from'./firebase-config.js';function a46_0xdf16(_0x1eb11c,_0x3d884c){const _0x508917=a46_0x8364();return a46_0xdf16=function(_0x24c52a,_0x566eb4){_0x24c52a=_0x24c52a-0x80;let _0x836463=_0x508917[_0x24c52a];return _0x836463;},a46_0xdf16(_0x1eb11c,_0x3d884c);}class PromotionManager{constructor(){const _0x2c54a0=a46_0xdf16;this[_0x2c54a0(0x95)]=0x18,this['RANKS']=[{'threshold':0x578,'name':'Bronze','color':_0x2c54a0(0xa4)},{'threshold':0x640,'name':'Silver','color':'#C0C0C0'},{'threshold':0x708,'name':_0x2c54a0(0xc8),'color':'#FFD700'},{'threshold':0x834,'name':'Emerald','color':'#50C878'}],this['bannerContainer']=null,this['lastFetchTime']=0x0,this[_0x2c54a0(0x98)]=0xea60,this['pollingInterval']=null,this['usernameCache']={};}['initialize'](){const _0x81861b=a46_0xdf16;this['bannerContainer']=document['getElementById']('promotion-banner-container');if(!this['bannerContainer']){console[_0x81861b(0xcd)]('Promotion\x20banner\x20container\x20not\x20found');return;}this['setupBannerContainer']();const _0x2b9db6='promotions_checked_'+new Date()['toDateString'](),_0x10c23a=sessionStorage['getItem'](_0x2b9db6);!_0x10c23a&&(this[_0x81861b(0xae)](),sessionStorage['setItem'](_0x2b9db6,_0x81861b(0xb5))),document['addEventListener']('visibilitychange',()=>{document['visibilityState']==='visible'&&!sessionStorage['getItem'](_0x2b9db6)&&(this['fetchRecentPromotions'](),sessionStorage['setItem'](_0x2b9db6,'true'));}),window[_0x81861b(0xc7)](_0x81861b(0xab),()=>{this['pollingInterval']&&clearInterval(this['pollingInterval']);});}[a46_0x38d2b6(0xca)](){const _0x3a079f=a46_0x38d2b6;this[_0x3a079f(0xba)][_0x3a079f(0xcc)]='',this['bannerContainer']['style'][_0x3a079f(0x99)]='none';}async[a46_0x38d2b6(0xae)](){const _0x34693f=a46_0x38d2b6;try{const _0x72d316=Date['now']();if(_0x72d316-this['lastFetchTime']<this['fetchInterval'])return;this['lastFetchTime']=_0x72d316;const _0x56fbc5=collection(db,_0x34693f(0xcf)),_0x514549=query(_0x56fbc5,where(_0x34693f(0x96),'in',['promotion',_0x34693f(0xde)]),orderBy(_0x34693f(0x87),'desc'),limit(0x14)),_0x41dc10=await getDocs(_0x514549),_0x1a56ac=[];_0x41dc10[_0x34693f(0x9a)](_0x3fe783=>{const _0x113bb2={'id':_0x3fe783['id'],..._0x3fe783['data']()};this['shouldShowPromotion'](_0x3fe783['id'])&&this['isNewRankChange'](_0x113bb2)&&_0x1a56ac['push'](_0x113bb2);}),_0x1a56ac[_0x34693f(0x9b)]>0x0&&await this[_0x34693f(0xbc)](_0x1a56ac);}catch(_0x364017){console['error']('Error\x20fetching\x20promotions:',_0x364017);}}async['processRankChanges'](_0x86a5a8){const _0x425a13=a46_0x38d2b6;if(_0x86a5a8['length']===0x0)return;_0x86a5a8[_0x425a13(0x85)]((_0x2453b9,_0x38f5cd)=>{const _0x53a374=_0x425a13,_0x5490db=_0x2453b9[_0x53a374(0x87)]?.['toMillis']?.()||_0x2453b9['timestamp']?.['seconds']*0x3e8||0x0,_0x94e965=_0x38f5cd['timestamp']?.[_0x53a374(0xaa)]?.()||_0x38f5cd[_0x53a374(0x87)]?.['seconds']*0x3e8||0x0;return _0x94e965-_0x5490db;});const _0x16b14c=this['bannerContainer']['children']['length'],_0x30b369=0x3-_0x16b14c;if(_0x30b369<=0x0)return;const _0x4c86a5=_0x86a5a8[_0x425a13(0xac)](0x0,_0x30b369);for(let _0x482170=0x0;_0x482170<_0x4c86a5['length'];_0x482170++){const _0x1b968e=_0x4c86a5[_0x482170],_0xe0199a=auth['currentUser'];try{setTimeout(()=>{this['showRankChangeBanner'](_0x1b968e);},_0x482170*0x3e8),_0xe0199a&&_0x1b968e['player']===_0xe0199a['displayName']&&this['showRankChangeLightbox'](_0x1b968e['type'],_0x1b968e['rankAchieved']);}catch(_0x398b5f){console['error']('Error\x20processing\x20rank\x20change:',_0x398b5f);}}}[a46_0x38d2b6(0x86)](_0x3c373f){const _0x256265=a46_0x38d2b6;try{const _0x817bce='promotion_'+_0x3c373f,_0x383bba=localStorage['getItem'](_0x817bce);if(_0x383bba){let _0x33ac58;try{_0x33ac58=JSON['parse'](_0x383bba);}catch(_0x2062ea){return console[_0x256265(0xe4)](_0x256265(0xb4)+_0x817bce+',\x20treating\x20as\x20new'),!![];}if(_0x33ac58[_0x256265(0xdf)]===!![])return console['log'](_0x256265(0xc2)+_0x3c373f+_0x256265(0xbd)),![];const _0x391c33=Date['now']();if(_0x33ac58[_0x256265(0xb6)]&&_0x391c33-_0x33ac58['timestamp']<this['DISPLAY_HOURS']*0x3c*0x3c*0x3e8)return console['log'](_0x256265(0xc2)+_0x3c373f+_0x256265(0xd7)+this[_0x256265(0x95)]+'\x20hours'),![];if(_0x33ac58['systemDismissed']&&_0x391c33-_0x33ac58['timestamp']<0x4*0x3c*0x3c*0x3e8)return console['log']('Promotion\x20'+_0x3c373f+'\x20was\x20auto-dismissed\x20within\x20last\x204\x20hours'),![];}return!![];}catch(_0x385dc8){return console['error']('Error\x20checking\x20promotion\x20visibility:',_0x385dc8),![];}}[a46_0x38d2b6(0xce)](_0x5bb60d){const _0x128890=a46_0x38d2b6;try{const _0x122f91='promotion_'+_0x5bb60d;localStorage[_0x128890(0x92)](_0x122f91,JSON[_0x128890(0xb8)]({'timestamp':Date['now'](),'ignored':!![]}));}catch(_0x4a6b5a){console[_0x128890(0xcd)]('Error\x20saving\x20promotion\x20preference:',_0x4a6b5a);}}['showRankChangeBanner'](_0xc0b0e4){const _0x73cc93=a46_0x38d2b6;this[_0x73cc93(0xb3)](_0xc0b0e4)['then'](_0x3c37e9=>{const _0x6f299d=_0x73cc93,_0x42bd16='promotion_'+_0xc0b0e4['id'],_0x512394=localStorage['getItem'](_0x42bd16);if(_0x512394)try{const _0x1649e2=JSON[_0x6f299d(0x9e)](_0x512394);if(_0x1649e2['ignored']===!![]){console['log']('Skipping\x20ignored\x20promotion:\x20'+_0xc0b0e4['id']);return;}}catch(_0x29e1ec){}localStorage['setItem'](_0x42bd16,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':![],'seenAt':Date[_0x6f299d(0xe6)]()})),this['bannerContainer'][_0x6f299d(0xd8)]['display']='block';while(this[_0x6f299d(0xba)]['children']['length']>=0x3){this['bannerContainer']['removeChild'](this['bannerContainer'][_0x6f299d(0xb7)]);}const _0x557544=document['createElement']('div');_0x557544['className']='promotion-banner',_0x557544[_0x6f299d(0xa0)]('data-rank',_0x3c37e9['rankAchieved']),_0x557544['setAttribute']('data-id',_0x3c37e9['id']);const _0x28af1a=document['createElement']('div');_0x28af1a['className']=_0x6f299d(0xa9);const _0x38d480=_0x3c37e9['resolvedName']||_0x3c37e9['player']||_0x3c37e9['username']||_0x3c37e9['playerUsername']||_0x3c37e9['displayName']||'A\x20player',_0x1ad77c=_0x3c37e9['type']==='promotion'?_0x38d480+_0x6f299d(0x9f):_0x38d480+'\x20was\x20demoted\x20to';_0x28af1a['innerHTML']=_0x1ad77c+'\x20<span\x20class=\x22rank-text\x22>'+_0x3c37e9['rankAchieved']+'</span>';const _0x140213=document['createElement']('div');_0x140213['className']='banner-actions';const _0x4858ab=document[_0x6f299d(0xc5)]('button');_0x4858ab[_0x6f299d(0xe7)]='dismiss-btn',_0x4858ab[_0x6f299d(0xcc)]=_0x6f299d(0x88),_0x4858ab['title']='Dismiss';const _0x42d89a=document[_0x6f299d(0xc5)]('button');_0x42d89a['className']='ignore-btn',_0x42d89a['textContent']='Don\x27t\x20show\x20again',_0x42d89a['title']='Never\x20show\x20this\x20promotion\x20again',_0x140213['appendChild'](_0x42d89a),_0x140213['appendChild'](_0x4858ab),_0x557544['appendChild'](_0x28af1a),_0x557544[_0x6f299d(0xe0)](_0x140213),this[_0x6f299d(0xba)][_0x6f299d(0xe0)](_0x557544),void _0x557544[_0x6f299d(0xd3)],setTimeout(()=>{const _0x87eda0=_0x6f299d;_0x557544[_0x87eda0(0xa2)]['add']('new-rank-change');},0x32),_0x4858ab[_0x6f299d(0xc7)](_0x6f299d(0xa3),()=>{const _0x35b5f2=_0x6f299d;localStorage['setItem'](_0x42bd16,JSON[_0x35b5f2(0xb8)]({'timestamp':Date[_0x35b5f2(0xe6)](),'ignored':![],'userDismissed':!![],'systemDismissed':![]})),_0x557544['classList']['remove']('new-rank-change'),_0x557544[_0x35b5f2(0xa2)]['add']('dismissing'),setTimeout(()=>{const _0x1ce49c=_0x35b5f2;_0x557544[_0x1ce49c(0xe2)]&&(_0x557544[_0x1ce49c(0x89)](),this['bannerContainer']['children']['length']===0x0&&(this['bannerContainer']['style']['display']=_0x1ce49c(0xbf)));},0x1f4);}),_0x42d89a['addEventListener'](_0x6f299d(0xa3),()=>{const _0x158221=_0x6f299d;localStorage[_0x158221(0x92)](_0x42bd16,JSON['stringify']({'timestamp':Date['now'](),'ignored':!![],'userDismissed':!![],'systemDismissed':![]})),_0x557544['classList']['remove']('new-rank-change'),_0x557544['classList']['add'](_0x158221(0xaf)),setTimeout(()=>{const _0x11486c=_0x158221;_0x557544['parentNode']&&(_0x557544[_0x11486c(0x89)](),this['bannerContainer']['children'][_0x11486c(0x9b)]===0x0&&(this['bannerContainer']['style'][_0x11486c(0x99)]='none'));},0x1f4);}),setTimeout(()=>{const _0x394fd0=_0x6f299d;_0x557544['parentNode']&&(_0x557544['classList'][_0x394fd0(0x89)]('new-rank-change'),_0x557544['classList'][_0x394fd0(0xd2)]('dismissing'),localStorage['setItem'](_0x42bd16,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':!![]})),setTimeout(()=>{const _0x6ba226=_0x394fd0;_0x557544[_0x6ba226(0xe2)]&&(_0x557544['remove'](),this['bannerContainer'][_0x6ba226(0xdc)][_0x6ba226(0x9b)]===0x0&&(this[_0x6ba226(0xba)]['style']['display']='none'));},0x1f4));},0x3a98);});}async['resolveUserId'](_0xf1dcf5){const _0x37a16b=a46_0x38d2b6,_0x5338ec={..._0xf1dcf5},_0x17563a=[_0xf1dcf5['player'],_0xf1dcf5[_0x37a16b(0xd9)],_0xf1dcf5['playerUsername'],_0xf1dcf5['displayName']],_0x5de9cf=_0x17563a['some'](_0x4516ac=>_0x4516ac&&typeof _0x4516ac==='string'&&!_0x4516ac['includes'](_0x37a16b(0xa6))&&!/^[a-zA-Z0-9]{20,}$/['test'](_0x4516ac));if(_0x5de9cf)return _0x5338ec;let _0x45087b=null;if(_0xf1dcf5['userId'])_0x45087b=_0xf1dcf5['userId'];else _0xf1dcf5['player']&&/^[A-Za-z0-9]{20,}$/[_0x37a16b(0xda)](_0xf1dcf5[_0x37a16b(0x82)])&&(_0x45087b=_0xf1dcf5[_0x37a16b(0x82)]);if(!_0x45087b)return _0x5338ec;try{const _0x52b6be=await getDoc(doc(db,'players',_0x45087b));if(_0x52b6be['exists']()){const _0x581f98=_0x52b6be['data']();if(_0x581f98['username'])return _0x5338ec['resolvedName']=_0x581f98[_0x37a16b(0xd9)],_0x5338ec;}const _0x69f79=await getDocs(query(collection(db,'approvedMatches'),where('winnerId','==',_0x45087b),orderBy(_0x37a16b(0x80),_0x37a16b(0x8b)),limit(0x1)));if(!_0x69f79['empty']){const _0x4556dd=_0x69f79[_0x37a16b(0x91)][0x0]['data']();if(_0x4556dd['winnerUsername'])return _0x5338ec['resolvedName']=_0x4556dd['winnerUsername'],_0x5338ec;}const _0x54060a=await getDocs(query(collection(db,'approvedMatches'),where('loserId','==',_0x45087b),orderBy('date','desc'),limit(0x1)));if(!_0x54060a[_0x37a16b(0x83)]){const _0x176a41=_0x54060a['docs'][0x0]['data']();if(_0x176a41['loserUsername'])return _0x5338ec[_0x37a16b(0xbe)]=_0x176a41['loserUsername'],console[_0x37a16b(0xad)](_0x37a16b(0x8a)+_0x45087b+_0x37a16b(0xcb)+_0x176a41['loserUsername']+'\x20(loser)'),_0x5338ec;}}catch(_0x3e9837){console['error']('Error\x20resolving\x20user\x20ID:',_0x3e9837);}return console[_0x37a16b(0xe4)]('Failed\x20to\x20resolve\x20user\x20ID:\x20'+_0x45087b),_0x5338ec;}[a46_0x38d2b6(0x8c)](_0x476fcc,_0x4d3926){const _0x4a5603=a46_0x38d2b6;let _0x4aae65=document[_0x4a5603(0xc3)]('rankChangeModal');!_0x4aae65&&(_0x4aae65=document[_0x4a5603(0xc5)]('div'),_0x4aae65['id']=_0x4a5603(0x9d),_0x4aae65['className']='rank-change-modal\x20'+_0x476fcc,document['body']['appendChild'](_0x4aae65));const _0xf65ba=_0x476fcc==='promotion'?'Congratulations!':'Rank\x20Update',_0x3919c6=_0x476fcc===_0x4a5603(0xdd)?'You\x27ve\x20been\x20promoted\x20to':'You\x27ve\x20been\x20demoted\x20to';_0x4aae65['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rank-change-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2\x20class=\x22rank-change-title\x22>'+_0xf65ba+_0x4a5603(0xb2)+_0x3919c6+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22rank-name\x22>'+_0x4d3926+'</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22rank-change-button\x22\x20id=\x22rank-change-ok-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Got\x20it!\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x4aae65[_0x4a5603(0xd8)]['display']=_0x4a5603(0xb9),document[_0x4a5603(0xc3)]('rank-change-ok-btn')['addEventListener'](_0x4a5603(0xa3),()=>{_0x4aae65['style']['display']='none';}),_0x4aae65[_0x4a5603(0xc7)]('click',_0x2fbc23=>{const _0x16ace9=_0x4a5603;_0x2fbc23[_0x16ace9(0xb0)]===_0x4aae65&&(_0x4aae65[_0x16ace9(0xd8)]['display']=_0x16ace9(0xbf));});}async['checkAndRecordPromotion'](_0x3217fc,_0x44518d,_0x193ba5,_0x31de12={}){const _0x50ac35=a46_0x38d2b6;try{if(_0x44518d===_0x193ba5||!_0x3217fc)return null;const _0x2ab095=_0x31de12['source']||_0x50ac35(0xa1),_0x31b6f6=_0x31de12['matchId']||null,_0x589f11=_0x31de12['adminUser']||null;console['log']('Processing\x20potential\x20rank\x20change:\x20'+_0x193ba5+'\x20→\x20'+_0x44518d+'\x20(source:\x20'+_0x2ab095+')');let _0x311cb6=null,_0x1f8160=null;try{const _0x84ad60=await getDoc(doc(db,'players',_0x3217fc));if(_0x84ad60[_0x50ac35(0x84)]()){const _0x4f2c96=_0x84ad60[_0x50ac35(0xc9)]();_0x311cb6=_0x4f2c96['username']||_0x4f2c96['displayName']||null,_0x1f8160=_0x4f2c96['displayName']||_0x4f2c96[_0x50ac35(0xd9)]||null;}!_0x311cb6&&_0x31de12['username']&&(_0x311cb6=_0x31de12[_0x50ac35(0xd9)],_0x1f8160=_0x31de12['username']);!_0x311cb6&&auth[_0x50ac35(0xc6)]&&(_0x311cb6=auth['currentUser'][_0x50ac35(0x94)]||auth[_0x50ac35(0xc6)]['email']['split']('@')[0x0],_0x1f8160=auth['currentUser']['displayName']||null);if(!_0x311cb6){const _0x98580f=query(collection(db,'approvedMatches'),where('winnerId','==',_0x3217fc),limit(0x1)),_0x3ba614=await getDocs(_0x98580f);if(!_0x3ba614['empty'])_0x311cb6=_0x3ba614['docs'][0x0]['data']()['winnerUsername']||_0x50ac35(0x8e),_0x1f8160=_0x311cb6;else{const _0x1e6f9c=query(collection(db,'approvedMatches'),where('loserId','==',_0x3217fc),limit(0x1)),_0x188582=await getDocs(_0x1e6f9c);!_0x188582['empty']&&(_0x311cb6=_0x188582[0x0][_0x50ac35(0xc9)]()['loserUsername']||_0x50ac35(0x8e),_0x1f8160=_0x311cb6);}}}catch(_0x673efd){console[_0x50ac35(0xcd)]('Error\x20resolving\x20username:',_0x673efd);}!_0x311cb6&&(console['warn']('Could\x20not\x20resolve\x20username\x20for\x20userId:',_0x3217fc),_0x311cb6=_0x50ac35(0xc4),_0x1f8160=_0x50ac35(0x8e));const _0x560482=this['getRankName'](_0x193ba5),_0x8353d=this['getRankName'](_0x44518d);if(_0x560482!==_0x8353d){const _0x4bbe5c=_0x44518d>_0x193ba5,_0x45a595=_0x4bbe5c?_0x50ac35(0xdd):'demotion',_0x37ca55=_0x8353d;console['log']('Recording\x20'+_0x45a595+'\x20for\x20'+_0x311cb6+':\x20'+_0x193ba5+'\x20('+_0x560482+')\x20→\x20'+_0x44518d+'\x20('+_0x8353d+')');try{const _0x23a8c1={'player':_0x311cb6,'playerUsername':_0x311cb6,'username':_0x311cb6,'displayName':_0x1f8160,'userId':_0x3217fc,'type':_0x45a595,'rankAchieved':_0x37ca55,'timestamp':serverTimestamp(),'previousElo':_0x193ba5,'newElo':_0x44518d,'change':_0x44518d-_0x193ba5,'previousRank':_0x560482,'newRank':_0x8353d,'source':_0x2ab095};if(_0x2ab095===_0x50ac35(0xdb)&&_0x31b6f6)_0x23a8c1['matchId']=_0x31b6f6;else _0x2ab095==='admin'&&_0x589f11?(_0x23a8c1[_0x50ac35(0xe5)]=_0x589f11,_0x23a8c1['isAutomatic']=![]):_0x23a8c1[_0x50ac35(0xe3)]=!![];const _0x3e3225=writeBatch(db),_0x1f64b7=doc(collection(db,'eloHistory')),_0x38611b=doc(collection(db,_0x50ac35(0x97)));return _0x3e3225[_0x50ac35(0xc0)](_0x1f64b7,_0x23a8c1),_0x3e3225['set'](_0x38611b,_0x23a8c1),await _0x3e3225['commit'](),await this['sendPromotionNotification'](_0x3217fc,_0x311cb6,_0x193ba5,_0x44518d,_0x560482,_0x8353d,_0x45a595,{'displayName':_0x1f8160,'source':_0x2ab095,'matchId':_0x31b6f6,'ladder':_0x31de12['ladder']||'D1'}),console['log'](_0x50ac35(0xb1)+_0x45a595+'\x20for\x20'+_0x311cb6+_0x50ac35(0xcb)+_0x37ca55),_0x37ca55;}catch(_0x115658){console['error']('Error\x20writing\x20promotion\x20records:',_0x115658);try{return await addDoc(collection(db,'eloHistory'),{'player':_0x311cb6,'playerUsername':_0x311cb6,'username':_0x311cb6,'displayName':_0x1f8160,'userId':_0x3217fc,'type':_0x45a595,'rankAchieved':_0x37ca55,'timestamp':serverTimestamp(),'previousElo':_0x193ba5,'newElo':_0x44518d,'change':_0x44518d-_0x193ba5,'previousRank':_0x560482,'source':_0x2ab095,'isAutomatic':_0x2ab095!==_0x50ac35(0x8d)}),await this['sendPromotionNotification'](_0x3217fc,_0x311cb6,_0x193ba5,_0x44518d,_0x560482,_0x8353d,_0x45a595,{'displayName':_0x1f8160,'source':_0x2ab095,'matchId':_0x31b6f6,'ladder':_0x31de12[_0x50ac35(0x81)]||'D1'}),_0x37ca55;}catch(_0x2d8f30){return console['error']('Fallback\x20write\x20failed:',_0x2d8f30),null;}}}return null;}catch(_0x40fd81){return console[_0x50ac35(0xcd)]('Error\x20in\x20promotion/demotion\x20recording:',_0x40fd81),null;}}[a46_0x38d2b6(0xa7)](_0x3d0185){const _0x2be8f2=a46_0x38d2b6;for(let _0x5875cb=this['RANKS'][_0x2be8f2(0x9b)]-0x1;_0x5875cb>=0x0;_0x5875cb--){if(_0x3d0185>=this['RANKS'][_0x5875cb]['threshold'])return this[_0x2be8f2(0xd6)][_0x5875cb]['name'];}return _0x2be8f2(0xa8);}[a46_0x38d2b6(0xd1)](){const _0x411fc0=a46_0x38d2b6;this[_0x411fc0(0xa5)]&&clearInterval(this['pollingInterval']);}[a46_0x38d2b6(0xc1)](_0x240ec9){const _0x3b76e7=a46_0x38d2b6;if(_0x240ec9['timestamp']){const _0x1a26dd=_0x240ec9['timestamp']['seconds']*0x3e8,_0x43f091=Date['now'](),_0x21a828=(_0x43f091-_0x1a26dd)/(0x3e8*0x3c*0x3c);if(_0x21a828>0x18)return![];}if(_0x240ec9['previousRank']&&_0x240ec9['newRank']&&_0x240ec9[_0x3b76e7(0xe1)]!==_0x240ec9['newRank'])return!![];return![];}async['sendPromotionNotification'](_0x2c691b,_0x16e20e,_0x2da4c2,_0x5a43a4,_0x1e8d64,_0x341717,_0x27ed03,_0x52a19a={}){const _0x4c7fdc=a46_0x38d2b6;try{console['log'](_0x4c7fdc(0xd4)+_0x16e20e+'\x27s\x20'+_0x27ed03);const _0x266af3={'userId':_0x2c691b,'username':_0x16e20e,'displayName':_0x52a19a['displayName']||_0x16e20e,'oldElo':parseInt(_0x2da4c2),'newElo':parseInt(_0x5a43a4),'eloDifference':parseInt(_0x5a43a4)-parseInt(_0x2da4c2),'oldRank':_0x1e8d64,'newRank':_0x341717,'type':_0x27ed03,'timestamp':serverTimestamp(),'processed':![],'source':_0x52a19a[_0x4c7fdc(0x93)]||'automatic','matchId':_0x52a19a['matchId']||null,'ladder':_0x52a19a['ladder']||'D1','adminUser':_0x52a19a['adminUser']||null};console['log']('Creating\x20Discord\x20notification:',_0x266af3);const _0x3a4313=await addDoc(collection(db,'promotionNotifications'),_0x266af3);return console['log']('Discord\x20notification\x20sent\x20successfully\x20with\x20ID:\x20'+_0x3a4313['id']),!![];}catch(_0x5b73a7){return console[_0x4c7fdc(0xcd)](_0x4c7fdc(0x9c),_0x5b73a7),![];}}}function a46_0x8364(){const _0x39d76f=['date','ladder','player','empty','exists','sort','shouldShowPromotion','timestamp','&times;','remove','Resolved\x20','desc','showRankChangeLightbox','admin','Unknown\x20Player','prototype','initialize','docs','setItem','source','displayName','DISPLAY_HOURS','type','promotionHistory','fetchInterval','display','forEach','length','Error\x20sending\x20Discord\x20notification:','rankChangeModal','parse','\x20was\x20promoted\x20to','setAttribute','automatic','classList','click','#CD7F32','pollingInterval','ID:','getRankName','Unranked','promotion-details','toMillis','beforeunload','slice','log','fetchRecentPromotions','dismissing','target','Successfully\x20recorded\x20','</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>','resolveUserId','Invalid\x20storage\x20format\x20for\x20','true','userDismissed','firstChild','stringify','flex','bannerContainer','return\x20(function()\x20','processRankChanges','\x20is\x20permanently\x20ignored','resolvedName','none','set','isNewRankChange','Promotion\x20','getElementById','A\x20player','createElement','currentUser','addEventListener','Gold','data','setupBannerContainer','\x20to\x20','innerHTML','error','ignorePromotion','eloHistory','trace','cleanup','add','offsetWidth','STARTING\x20notification\x20for\x20','info','RANKS','\x20was\x20dismissed\x20by\x20user\x20within\x20last\x20','style','username','test','match','children','promotion','demotion','ignored','appendChild','previousRank','parentNode','isAutomatic','warn','modifiedBy','now','className'];a46_0x8364=function(){return _0x39d76f;};return a46_0x8364();}export const promotionManager=new PromotionManager();document['addEventListener']('DOMContentLoaded',()=>{const _0x4122c2=a46_0x38d2b6;promotionManager[_0x4122c2(0x90)]();});export const initializePromotionTracker=()=>promotionManager['initialize']();export const checkAndRecordPromotion=(_0x468e9d,_0x4bddc2,_0x407bbf,_0x4bf435)=>promotionManager['checkAndRecordPromotion'](_0x468e9d,_0x4bddc2,_0x407bbf,_0x4bf435);export const getRankName=_0x5bfbee=>promotionManager['getRankName'](_0x5bfbee);
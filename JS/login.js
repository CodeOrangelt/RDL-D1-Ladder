const a33_0x236ffd=a33_0x3406,a33_0xdd7cbf=(function(){let _0x6ac152=!![];return function(_0x2e8cf6,_0x3ea137){const _0x3f0767=_0x6ac152?function(){if(_0x3ea137){const _0x146b57=_0x3ea137['apply'](_0x2e8cf6,arguments);return _0x3ea137=null,_0x146b57;}}:function(){};return _0x6ac152=![],_0x3f0767;};}()),a33_0x58401a=a33_0xdd7cbf(this,function(){const _0x535423=a33_0x3406;let _0x2f9b11;try{const _0x166926=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x2f9b11=_0x166926();}catch(_0xef9dd7){_0x2f9b11=window;}const _0x261810=_0x2f9b11[_0x535423(0x1ac)]=_0x2f9b11['console']||{},_0x3965ed=['log','warn','info','error','exception','table','trace'];for(let _0x2a7d36=0x0;_0x2a7d36<_0x3965ed['length'];_0x2a7d36++){const _0x5c01d1=a33_0xdd7cbf[_0x535423(0x17b)]['prototype']['bind'](a33_0xdd7cbf),_0x51008a=_0x3965ed[_0x2a7d36],_0x5044e1=_0x261810[_0x51008a]||_0x5c01d1;_0x5c01d1['__proto__']=a33_0xdd7cbf['bind'](a33_0xdd7cbf),_0x5c01d1['toString']=_0x5044e1[_0x535423(0x19b)]['bind'](_0x5044e1),_0x261810[_0x51008a]=_0x5c01d1;}});a33_0x58401a();import{createUserWithEmailAndPassword,signInWithEmailAndPassword,sendEmailVerification,signOut}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{doc,setDoc,collection,getDocs,query,where,getDoc,updateDoc,deleteDoc,orderBy,limit,serverTimestamp}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{auth,db}from'./firebase-config.js';function a33_0x3406(_0x2bcaa4,_0x4ac9ba){const _0x58401a=a33_0x3b0a();return a33_0x3406=function(_0xdd7cbf,_0x74753f){_0xdd7cbf=_0xdd7cbf-0x178;let _0x3b0add=_0x58401a[_0xdd7cbf];return _0x3b0add;},a33_0x3406(_0x2bcaa4,_0x4ac9ba);}function setupVerificationListener(_0x57a976,_0xfae003){const _0x4570ff=a33_0x3406;console[_0x4570ff(0x18a)]('Setting\x20up\x20email\x20verification\x20listener\x20for:',_0x57a976);const _0x439146=setInterval(async()=>{const _0x265a58=_0x4570ff;try{console['log'](_0x265a58(0x196));const _0xb0e93c=await signInWithEmailAndPassword(auth,_0x57a976,_0xfae003),_0x1fe969=_0xb0e93c[_0x265a58(0x1b1)];await _0x1fe969['getIdToken'](!![]),_0x1fe969[_0x265a58(0x184)]?(console['log']('Email\x20has\x20been\x20verified!\x20Redirecting\x20to\x20login\x20page...'),clearInterval(_0x439146),document[_0x265a58(0x185)](_0x265a58(0x17f))['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22success-message\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Email\x20verified\x20successfully!\x20You\x20can\x20now\x20log\x20in.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>',await signOut(auth),setTimeout(()=>{const _0x12487d=_0x265a58;document['getElementById']('register-container')['style'][_0x12487d(0x18b)]=_0x12487d(0x193),document['getElementById']('login-container')[_0x12487d(0x182)]['display']=_0x12487d(0x18e),document[_0x12487d(0x185)]('login-email')[_0x12487d(0x1a3)]=_0x57a976,document['getElementById']('login-error')['innerHTML']=_0x12487d(0x189);},0x7d0)):(console['log'](_0x265a58(0x19d)),await signOut(auth));}catch(_0x5ba77c){console['error']('Error\x20checking\x20verification\x20status:',_0x5ba77c),clearInterval(_0x439146);}},0x1388);window['verificationCheckInterval']=_0x439146,setTimeout(()=>{const _0xcc4819=_0x4570ff;window[_0xcc4819(0x181)]&&(clearInterval(window['verificationCheckInterval']),window['verificationCheckInterval']=null,console['log']('Stopped\x20checking\x20for\x20email\x20verification\x20(timeout\x20reached)'));},0x5*0x3c*0x3e8);}async function isUsernameAvailable(_0x2d2410){const _0x2eb3ba=a33_0x3406;if(!_0x2d2410||typeof _0x2d2410!=='string'||_0x2d2410['trim']()['length']<0x3)return document[_0x2eb3ba(0x185)]('register-error')['textContent']='Username\x20must\x20be\x20at\x20least\x203\x20characters\x20long',![];const _0x48dd1d=_0x2d2410[_0x2eb3ba(0x18c)]();try{const _0x5ba214=/^[a-zA-Z0-9_-]{3,20}$/;if(!_0x5ba214['test'](_0x48dd1d))return document['getElementById'](_0x2eb3ba(0x17f))['textContent']='Username\x20can\x20only\x20contain\x20letters,\x20numbers,\x20underscores\x20and\x20hyphens',![];const [_0x1e4217,_0x28bb53,_0x341e9b]=await Promise[_0x2eb3ba(0x17c)]([getDocs(query(collection(db,_0x2eb3ba(0x17e)),where('username','==',_0x48dd1d))),getDocs(query(collection(db,_0x2eb3ba(0x1ab)),where('username','==',_0x48dd1d))),getDocs(query(collection(db,'nonParticipants'),where('username','==',_0x48dd1d)))]);if(!_0x1e4217['empty']||!_0x28bb53['empty']||!_0x341e9b[_0x2eb3ba(0x187)])return document['getElementById']('register-error')['textContent']=_0x2eb3ba(0x178),![];return!![];}catch(_0x438390){return console[_0x2eb3ba(0x1a6)](_0x2eb3ba(0x1ae),_0x438390),document['getElementById']('register-error')['textContent']=_0x2eb3ba(0x19c),![];}}async function handleRegister(_0x4a9f85){const _0x3b4a72=a33_0x3406;_0x4a9f85['preventDefault']();const _0x5aa504=document[_0x3b4a72(0x185)](_0x3b4a72(0x17f));_0x5aa504['textContent']='';const _0x23aa1d=document['getElementById']('register-email')[_0x3b4a72(0x1a3)],_0xd5b2fa=document['getElementById']('register-password')['value'],_0x308635=document[_0x3b4a72(0x185)]('register-username')['value'],_0x141d25=document['getElementById']('verification-answer')['value'][_0x3b4a72(0x1a7)](),_0x5d3b4c=document['getElementById']('register-mode')[_0x3b4a72(0x1a3)],_0x34d9a7=document['getElementById']('non-participant')?.['checked']||![];if(_0x34d9a7&&_0x5d3b4c!==''){_0x5aa504['textContent']='Please\x20unselect\x20a\x20game\x20mode\x20if\x20you\x20choose\x20Non-Participant.';return;}if(!_0x34d9a7&&_0x5d3b4c===''){_0x5aa504[_0x3b4a72(0x1b3)]=_0x3b4a72(0x183);return;}try{const _0x13a1d6=[_0x3b4a72(0x190),'magenta'];if(!_0x13a1d6[_0x3b4a72(0x199)](_0x141d25)){_0x5aa504['textContent']='Incorrect\x20answer\x20to\x20verification\x20question';return;}const _0x342a35=await isUsernameAvailable(_0x308635);if(!_0x342a35)return;const _0x4548ee=await createUserWithEmailAndPassword(auth,_0x23aa1d,_0xd5b2fa),_0x341d46=_0x4548ee['user'];await sendEmailVerification(_0x341d46),await setDoc(doc(db,'pendingRegistrations',_0x341d46['uid']),{'username':_0x308635['trim'](),'email':_0x23aa1d,'gameMode':_0x5d3b4c,'nonParticipant':_0x34d9a7,'createdAt':new Date(),'verified':![]}),_0x5aa504[_0x3b4a72(0x19a)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22success-message\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Registration\x20pending!\x20Please\x20check\x20your\x20email\x20to\x20verify\x20your\x20account.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<br><br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20onclick=\x22resendVerificationEmail(\x27'+_0x23aa1d+'\x27)\x22\x20class=\x22resend-button\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Resend\x20Verification\x20Email\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>',await signOut(auth),setupVerificationListener(_0x23aa1d,_0xd5b2fa);}catch(_0xa655dc){console['error']('Registration\x20error:',_0xa655dc),_0x5aa504['textContent']=_0xa655dc[_0x3b4a72(0x1ad)]===_0x3b4a72(0x1a2)?'Email\x20address\x20is\x20already\x20registered':'Registration\x20failed.\x20Please\x20try\x20again\x20later.';}}function a33_0x3b0a(){const _0xd0d6f7=['Username\x20is\x20already\x20taken','\x20added\x20to\x20nonParticipants\x20collection','nonParticipant','constructor','all','exists','players','register-error','resendVerificationEmail','verificationCheckInterval','style','Please\x20select\x20a\x20game\x20mode\x20or\x20check\x20Non-Participant.','emailVerified','getElementById','disabled','empty','Found\x20pending\x20registration:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22success-message\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Your\x20account\x20has\x20been\x20verified!\x20You\x20can\x20now\x20log\x20in.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>','log','display','trim','User\x20signed\x20in:','block','Processing\x20','purple','New\x20player\x20','Login\x20error:\x20','none','addEventListener','checked','Checking\x20if\x20email\x20has\x20been\x20verified...','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22success-message\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Verification\x20email\x20has\x20been\x20resent\x20to\x20','preventDefault','includes','innerHTML','toString','Unable\x20to\x20verify\x20username\x20availability.\x20Please\x20try\x20again\x20later.','Email\x20not\x20yet\x20verified,\x20waiting...','map','Window.resendVerificationEmail\x20called\x20with:','Login\x20error:','login-password','auth/email-already-in-use','value','login-error','login-email','error','toLowerCase','message','uid','playersCTF','pendingRegistrations','console','code','Error\x20checking\x20username:','resend-button','playersDuos','user','gameMode','textContent'];a33_0x3b0a=function(){return _0xd0d6f7;};return a33_0x3b0a();}async function handleLogin(_0x5b8f8f){const _0x26013e=a33_0x3406;_0x5b8f8f['preventDefault']();const _0x515212=document['getElementById']('login-email')['value'],_0x29e9e0=document[_0x26013e(0x185)](_0x26013e(0x1a1))[_0x26013e(0x1a3)],_0x33b294=document[_0x26013e(0x185)](_0x26013e(0x1a4));console[_0x26013e(0x18a)]('Login\x20attempt\x20started\x20for:',_0x515212),_0x33b294['textContent']='';try{console['log']('Attempting\x20Firebase\x20signInWithEmailAndPassword...');const _0x39bcaf=await signInWithEmailAndPassword(auth,_0x515212,_0x29e9e0),_0x265c3e=_0x39bcaf['user'];console[_0x26013e(0x18a)](_0x26013e(0x18d),_0x265c3e['uid']);const _0x409f2f=['players','playersD2','playersD3',_0x26013e(0x1b0),'playersCTF','nonParticipants'];console['log']('Checking\x20if\x20user\x20exists\x20in\x20any\x20collection...');let _0x511bb8=![],_0x16a0cf=await Promise[_0x26013e(0x17c)](_0x409f2f[_0x26013e(0x19e)](_0x52d7d8=>getDoc(doc(db,_0x52d7d8,_0x265c3e['uid']))));for(let _0x59cd80=0x0;_0x59cd80<_0x16a0cf['length'];_0x59cd80++){if(_0x16a0cf[_0x59cd80]['exists']()){_0x511bb8=!![],console['log']('User\x20found\x20in\x20'+_0x409f2f[_0x59cd80]+'\x20collection');break;}}if(!_0x511bb8){console['log']('User\x20not\x20found\x20in\x20any\x20collection,\x20checking\x20pending\x20registration');const _0x424f09=doc(db,_0x26013e(0x1ab),_0x265c3e['uid']),_0x48dcbd=await getDoc(_0x424f09);if(_0x48dcbd[_0x26013e(0x17d)]()){const _0x14102d=_0x48dcbd['data']();console[_0x26013e(0x18a)](_0x26013e(0x188),_0x14102d);if(_0x265c3e[_0x26013e(0x184)]){console['log']('Email\x20is\x20verified,\x20processing\x20registration'),_0x33b294[_0x26013e(0x19a)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22success-message\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Setting\x20up\x20your\x20account...\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>';if(_0x14102d[_0x26013e(0x17a)])console['log']('Processing\x20non-participant\x20registration'),await setDoc(doc(db,'nonParticipants',_0x265c3e['uid']),{'username':_0x14102d['username'],'email':_0x265c3e['email'],'createdAt':serverTimestamp(),'isNonParticipant':!![]}),console['log']('User\x20'+_0x14102d['username']+_0x26013e(0x179));else{let _0x18cc1d;switch(_0x14102d['gameMode']){case'D1':_0x18cc1d='players';break;case'D2':_0x18cc1d='playersD2';break;case'D3':_0x18cc1d='playersD3';break;case'Duos':_0x18cc1d='playersDuos';break;case'CTF':_0x18cc1d=_0x26013e(0x1aa);break;default:_0x18cc1d='players';}console['log'](_0x26013e(0x18f)+_0x14102d[_0x26013e(0x1b2)]+'\x20player\x20registration\x20to\x20'+_0x18cc1d);const _0x16ba2b=collection(db,_0x18cc1d),_0x307c91=query(_0x16ba2b,orderBy('position','desc'),limit(0x1)),_0x17e18b=await getDocs(_0x307c91),_0x3a8612=_0x17e18b['empty']?0x1:_0x17e18b['docs'][0x0]['data']()['position']+0x1;await setDoc(doc(db,_0x18cc1d,_0x265c3e['uid']),{'username':_0x14102d['username'],'email':_0x265c3e['email'],'eloRating':0x4b0,'position':_0x3a8612,'createdAt':serverTimestamp(),'isAdmin':![],'matches':0x0,'wins':0x0,'losses':0x0,'gameMode':_0x14102d['gameMode']}),console['log'](_0x26013e(0x191)+_0x14102d['username']+'\x20added\x20to\x20'+_0x18cc1d+'\x20at\x20position\x20'+_0x3a8612);}await deleteDoc(_0x424f09),setTimeout(()=>{window['location']['href']='../index.html';},0x7d0);return;}else{_0x33b294['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22warning-message\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Please\x20verify\x20your\x20email\x20to\x20complete\x20your\x20registration.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<br><br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20type=\x22button\x22\x20id=\x22resend-button\x22\x20class=\x22resend-button\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Resend\x20Verification\x20Email\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>',document[_0x26013e(0x185)](_0x26013e(0x1af))[_0x26013e(0x194)]('click',()=>{resendVerificationEmail(_0x515212);}),await signOut(auth);return;}}}window['location']['href']='../index.html';}catch(_0x472435){console[_0x26013e(0x1a6)](_0x26013e(0x1a0),_0x472435),_0x33b294['textContent']='Login\x20failed:\x20'+_0x472435[_0x26013e(0x1a8)];}}function loginFormHandler(_0x37193f){const _0x167446=a33_0x3406;_0x37193f[_0x167446(0x198)]();const _0x995c3e=document[_0x167446(0x185)](_0x167446(0x1a5))['value']['trim'](),_0x1494d0=document['getElementById']('login-password')['value'],_0x45b407=document['getElementById']('login-error');signInWithEmailAndPassword(auth,_0x995c3e,_0x1494d0)['then'](_0x9f6099=>{const _0x24293d=_0x167446;console['log'](_0x24293d(0x18d),_0x9f6099[_0x24293d(0x1b1)]),window['location']['href']='../index.html';})['catch'](_0x4077b3=>{const _0x3cdfc9=_0x167446;console['error'](_0x3cdfc9(0x1a0),_0x4077b3),_0x45b407['textContent']=_0x3cdfc9(0x192)+_0x4077b3['message'],_0x45b407['style'][_0x3cdfc9(0x18b)]='block';});}async function resendVerificationEmail(_0x541eaa){const _0x3201f8=a33_0x3406;console[_0x3201f8(0x18a)]('Attempting\x20to\x20resend\x20verification\x20email\x20to:',_0x541eaa);try{const _0x411c02=document['getElementById']('login-password')?.[_0x3201f8(0x1a3)];if(!_0x411c02){console['error']('Password\x20not\x20available\x20for\x20resending\x20verification'),document['getElementById']('login-error')['textContent']='Please\x20enter\x20your\x20password\x20to\x20resend\x20verification\x20email';return;}const _0x144194=await signInWithEmailAndPassword(auth,_0x541eaa,_0x411c02),_0x424b02=_0x144194[_0x3201f8(0x1b1)];console['log']('User\x20signed\x20in\x20for\x20verification\x20email:',_0x424b02[_0x3201f8(0x1a9)]),await sendEmailVerification(_0x424b02),console['log']('Verification\x20email\x20sent'),document['getElementById']('login-error')[_0x3201f8(0x19a)]=_0x3201f8(0x197)+_0x541eaa+'.\x20Please\x20check\x20your\x20inbox.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>',await signOut(auth);}catch(_0x31d102){console['error']('Error\x20resending\x20verification\x20email:',_0x31d102),document['getElementById']('login-error')[_0x3201f8(0x1b3)]='Error\x20sending\x20verification\x20email:\x20'+_0x31d102[_0x3201f8(0x1a8)];}}window[a33_0x236ffd(0x180)]=function(_0x15a18c){const _0x3cab7c=a33_0x236ffd;console['log'](_0x3cab7c(0x19f),_0x15a18c),resendVerificationEmail(_0x15a18c);},document['addEventListener']('DOMContentLoaded',()=>{const _0x53fd8e=document['getElementById']('non-participant'),_0x5e10ea=document['getElementById']('register-mode');_0x53fd8e&&_0x5e10ea&&_0x53fd8e['addEventListener']('change',function(){const _0x3b7f05=a33_0x3406;this[_0x3b7f05(0x195)]?(_0x5e10ea['value']='',_0x5e10ea[_0x3b7f05(0x186)]=!![]):_0x5e10ea['disabled']=![];});const _0x48c9ee=document['getElementById']('register-form'),_0x3c4ebe=document['getElementById']('login-form');_0x48c9ee&&_0x48c9ee['addEventListener']('submit',handleRegister);_0x3c4ebe&&_0x3c4ebe['addEventListener']('submit',handleLogin);const _0x1d45e1=document['getElementById']('show-register'),_0x23df20=document['getElementById']('show-login');_0x1d45e1&&_0x1d45e1['addEventListener']('click',_0xf961f5=>{const _0x23f472=a33_0x3406;_0xf961f5['preventDefault'](),document[_0x23f472(0x185)]('login-container')['style']['display']='none',document[_0x23f472(0x185)]('register-container')['style']['display']='block';}),_0x23df20&&_0x23df20['addEventListener']('click',_0x33f5c6=>{const _0x415bf1=a33_0x3406;_0x33f5c6['preventDefault'](),document['getElementById']('register-container')[_0x415bf1(0x182)]['display']=_0x415bf1(0x193),document['getElementById']('login-container')['style']['display']='block';});});
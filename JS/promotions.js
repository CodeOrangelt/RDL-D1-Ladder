const a44_0x3bf0b6=a44_0x214b,a44_0x44ed3f=(function(){let _0x34c487=!![];return function(_0x566ce5,_0x3a370e){const _0x4dd6d8=_0x34c487?function(){if(_0x3a370e){const _0x34de0e=_0x3a370e['apply'](_0x566ce5,arguments);return _0x3a370e=null,_0x34de0e;}}:function(){};return _0x34c487=![],_0x4dd6d8;};}()),a44_0x3aa248=a44_0x44ed3f(this,function(){const _0x3e47e2=a44_0x214b;let _0x5daa97;try{const _0x1cfe4d=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x5daa97=_0x1cfe4d();}catch(_0x30608d){_0x5daa97=window;}const _0x5c17a2=_0x5daa97['console']=_0x5daa97['console']||{},_0x3bd62b=['log','warn','info','error','exception',_0x3e47e2(0x10d),'trace'];for(let _0x1f7644=0x0;_0x1f7644<_0x3bd62b['length'];_0x1f7644++){const _0x3cd1ce=a44_0x44ed3f['constructor']['prototype'][_0x3e47e2(0xe5)](a44_0x44ed3f),_0x14e823=_0x3bd62b[_0x1f7644],_0x1d7f3d=_0x5c17a2[_0x14e823]||_0x3cd1ce;_0x3cd1ce['__proto__']=a44_0x44ed3f['bind'](a44_0x44ed3f),_0x3cd1ce['toString']=_0x1d7f3d['toString']['bind'](_0x1d7f3d),_0x5c17a2[_0x14e823]=_0x3cd1ce;}});a44_0x3aa248();import{collection,doc,query,where,orderBy,limit,getDocs,addDoc,getDoc,serverTimestamp,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{auth,db}from'./firebase-config.js';function a44_0x214b(_0x2d3613,_0x5c9fb8){const _0x3aa248=a44_0x161d();return a44_0x214b=function(_0x44ed3f,_0x190da5){_0x44ed3f=_0x44ed3f-0xb3;let _0x161d71=_0x3aa248[_0x44ed3f];return _0x161d71;},a44_0x214b(_0x2d3613,_0x5c9fb8);}class PromotionManager{constructor(){const _0x590fe2=a44_0x214b;this['DISPLAY_HOURS']=0x18,this[_0x590fe2(0xca)]=[{'threshold':0x578,'name':'Bronze','color':_0x590fe2(0xdd)},{'threshold':0x640,'name':'Silver','color':'#C0C0C0'},{'threshold':0x708,'name':'Gold','color':'#FFD700'},{'threshold':0x834,'name':_0x590fe2(0x106),'color':'#50C878'}],this['bannerContainer']=null,this['lastFetchTime']=0x0,this['fetchInterval']=0xea60,this['pollingInterval']=null,this[_0x590fe2(0xc7)]={};}['initialize'](){const _0x15d600=a44_0x214b;this['bannerContainer']=document[_0x15d600(0xc8)]('promotion-banner-container');if(!this[_0x15d600(0x10b)]){console['error']('Promotion\x20banner\x20container\x20not\x20found');return;}this['setupBannerContainer']();const _0x3a8827='promotions_checked_'+new Date()['toDateString'](),_0x4cfc46=sessionStorage['getItem'](_0x3a8827);!_0x4cfc46&&(this['fetchRecentPromotions'](),sessionStorage['setItem'](_0x3a8827,_0x15d600(0xbe))),document['addEventListener']('visibilitychange',()=>{const _0x2a02b2=_0x15d600;document[_0x2a02b2(0x10f)]==='visible'&&!sessionStorage['getItem'](_0x3a8827)&&(this['fetchRecentPromotions'](),sessionStorage['setItem'](_0x3a8827,_0x2a02b2(0xbe)));}),window['addEventListener'](_0x15d600(0xed),()=>{this['pollingInterval']&&clearInterval(this['pollingInterval']);});}[a44_0x3bf0b6(0xc1)](){const _0x26304d=a44_0x3bf0b6;this['bannerContainer'][_0x26304d(0xc0)]='',this['bannerContainer']['style']['display']='none';}async['fetchRecentPromotions'](){const _0x2a6942=a44_0x3bf0b6;try{const _0x32ecca=Date[_0x2a6942(0xfa)]();if(_0x32ecca-this[_0x2a6942(0xe1)]<this['fetchInterval'])return;this[_0x2a6942(0xe1)]=_0x32ecca;const _0x28cb1f=collection(db,_0x2a6942(0xe7)),_0x6de9d4=query(_0x28cb1f,where(_0x2a6942(0xb8),'in',[_0x2a6942(0xb6),'demotion']),orderBy(_0x2a6942(0xd3),'desc'),limit(0x14)),_0x4c635a=await getDocs(_0x6de9d4),_0x2fa2de=[];_0x4c635a[_0x2a6942(0xe8)](_0x2b149b=>{const _0x2b10c1=_0x2a6942,_0x488e55={'id':_0x2b149b['id'],..._0x2b149b['data']()};this[_0x2b10c1(0xcc)](_0x2b149b['id'])&&this['isNewRankChange'](_0x488e55)&&_0x2fa2de['push'](_0x488e55);}),_0x2fa2de[_0x2a6942(0xc2)]>0x0&&await this['processRankChanges'](_0x2fa2de);}catch(_0x4aee09){console['error']('Error\x20fetching\x20promotions:',_0x4aee09);}}async[a44_0x3bf0b6(0xd4)](_0x6dac0a){const _0x40ef97=a44_0x3bf0b6;if(_0x6dac0a[_0x40ef97(0xc2)]===0x0)return;_0x6dac0a['sort']((_0x7c8a5d,_0x461dc7)=>{const _0x141b1d=_0x40ef97,_0x4b9db5=_0x7c8a5d['timestamp']?.['toMillis']?.()||_0x7c8a5d[_0x141b1d(0xd3)]?.[_0x141b1d(0xef)]*0x3e8||0x0,_0x255141=_0x461dc7['timestamp']?.['toMillis']?.()||_0x461dc7['timestamp']?.['seconds']*0x3e8||0x0;return _0x255141-_0x4b9db5;});const _0x7e6ab6=this['bannerContainer']['children']['length'],_0x5bf4ad=0x3-_0x7e6ab6;if(_0x5bf4ad<=0x0)return;const _0x44e6dd=_0x6dac0a['slice'](0x0,_0x5bf4ad);for(let _0x4f54fd=0x0;_0x4f54fd<_0x44e6dd['length'];_0x4f54fd++){const _0x36835f=_0x44e6dd[_0x4f54fd],_0x139db8=auth['currentUser'];try{setTimeout(()=>{const _0x19ca26=_0x40ef97;this[_0x19ca26(0x109)](_0x36835f);},_0x4f54fd*0x3e8),_0x139db8&&_0x36835f['player']===_0x139db8['displayName']&&this['showRankChangeLightbox'](_0x36835f['type'],_0x36835f['rankAchieved']);}catch(_0x28e620){console[_0x40ef97(0xb3)](_0x40ef97(0xfc),_0x28e620);}}}['shouldShowPromotion'](_0x47d601){const _0x5b5aad=a44_0x3bf0b6;try{const _0x271bb1='promotion_'+_0x47d601,_0x97b6b9=localStorage['getItem'](_0x271bb1);if(_0x97b6b9){let _0x33ad08;try{_0x33ad08=JSON[_0x5b5aad(0x104)](_0x97b6b9);}catch(_0x53ade2){return console['warn'](_0x5b5aad(0xe3)+_0x271bb1+',\x20treating\x20as\x20new'),!![];}if(_0x33ad08['ignored']===!![])return console[_0x5b5aad(0xb4)]('Promotion\x20'+_0x47d601+'\x20is\x20permanently\x20ignored'),![];const _0x3e643e=Date['now']();if(_0x33ad08['userDismissed']&&_0x3e643e-_0x33ad08['timestamp']<this[_0x5b5aad(0xbc)]*0x3c*0x3c*0x3e8)return console['log']('Promotion\x20'+_0x47d601+_0x5b5aad(0xe6)+this['DISPLAY_HOURS']+'\x20hours'),![];if(_0x33ad08[_0x5b5aad(0xf3)]&&_0x3e643e-_0x33ad08['timestamp']<0x4*0x3c*0x3c*0x3e8)return console['log']('Promotion\x20'+_0x47d601+'\x20was\x20auto-dismissed\x20within\x20last\x204\x20hours'),![];}return!![];}catch(_0x49a6a5){return console['error']('Error\x20checking\x20promotion\x20visibility:',_0x49a6a5),![];}}['ignorePromotion'](_0xda423e){const _0x1bb734=a44_0x3bf0b6;try{const _0x5d6b71='promotion_'+_0xda423e;localStorage[_0x1bb734(0xb5)](_0x5d6b71,JSON['stringify']({'timestamp':Date['now'](),'ignored':!![]}));}catch(_0x164656){console[_0x1bb734(0xb3)]('Error\x20saving\x20promotion\x20preference:',_0x164656);}}['showRankChangeBanner'](_0x295df5){const _0x3938c4=a44_0x3bf0b6;this[_0x3938c4(0x110)](_0x295df5)[_0x3938c4(0x115)](_0x3dfb70=>{const _0x5bf1df=_0x3938c4,_0x57d391='promotion_'+_0x295df5['id'],_0x4a9a25=localStorage['getItem'](_0x57d391);if(_0x4a9a25)try{const _0x5a2239=JSON['parse'](_0x4a9a25);if(_0x5a2239['ignored']===!![]){console['log'](_0x5bf1df(0xf2)+_0x295df5['id']);return;}}catch(_0x5c3c78){}localStorage['setItem'](_0x57d391,JSON['stringify']({'timestamp':Date[_0x5bf1df(0xfa)](),'ignored':![],'userDismissed':![],'systemDismissed':![],'seenAt':Date['now']()})),this[_0x5bf1df(0x10b)]['style']['display']='block';while(this['bannerContainer']['children']['length']>=0x3){this[_0x5bf1df(0x10b)]['removeChild'](this['bannerContainer']['firstChild']);}const _0x1b9613=document[_0x5bf1df(0xe4)](_0x5bf1df(0xb9));_0x1b9613['className']=_0x5bf1df(0x118),_0x1b9613['setAttribute']('data-rank',_0x3dfb70['rankAchieved']),_0x1b9613[_0x5bf1df(0xba)](_0x5bf1df(0x111),_0x3dfb70['id']);const _0x34f88f=document[_0x5bf1df(0xe4)]('div');_0x34f88f[_0x5bf1df(0xc4)]='promotion-details';const _0x4c181a=_0x3dfb70['resolvedName']||_0x3dfb70['player']||_0x3dfb70['username']||_0x3dfb70['playerUsername']||_0x3dfb70['displayName']||'A\x20player',_0x263bbd=_0x3dfb70['type']===_0x5bf1df(0xb6)?_0x4c181a+'\x20was\x20promoted\x20to':_0x4c181a+'\x20was\x20demoted\x20to';_0x34f88f['innerHTML']=_0x263bbd+_0x5bf1df(0xc3)+_0x3dfb70['rankAchieved']+'</span>';const _0x597e3c=document['createElement']('div');_0x597e3c['className']='banner-actions';const _0x17d025=document['createElement']('button');_0x17d025[_0x5bf1df(0xc4)]='dismiss-btn',_0x17d025['innerHTML']=_0x5bf1df(0xda),_0x17d025[_0x5bf1df(0xf7)]=_0x5bf1df(0xd1);const _0x5e0e8a=document['createElement']('button');_0x5e0e8a['className']='ignore-btn',_0x5e0e8a['textContent']='Don\x27t\x20show\x20again',_0x5e0e8a[_0x5bf1df(0xf7)]='Never\x20show\x20this\x20promotion\x20again',_0x597e3c['appendChild'](_0x5e0e8a),_0x597e3c['appendChild'](_0x17d025),_0x1b9613['appendChild'](_0x34f88f),_0x1b9613['appendChild'](_0x597e3c),this['bannerContainer']['appendChild'](_0x1b9613),void _0x1b9613['offsetWidth'],setTimeout(()=>{const _0x173d1d=_0x5bf1df;_0x1b9613[_0x173d1d(0xbd)]['add']('new-rank-change');},0x32),_0x17d025['addEventListener'](_0x5bf1df(0x117),()=>{const _0x126982=_0x5bf1df;localStorage[_0x126982(0xb5)](_0x57d391,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':!![],'systemDismissed':![]})),_0x1b9613['classList']['remove'](_0x126982(0xe9)),_0x1b9613[_0x126982(0xbd)]['add']('dismissing'),setTimeout(()=>{const _0xa93987=_0x126982;_0x1b9613['parentNode']&&(_0x1b9613['remove'](),this['bannerContainer']['children'][_0xa93987(0xc2)]===0x0&&(this['bannerContainer']['style']['display']='none'));},0x1f4);}),_0x5e0e8a['addEventListener']('click',()=>{const _0x273110=_0x5bf1df;localStorage[_0x273110(0xb5)](_0x57d391,JSON['stringify']({'timestamp':Date['now'](),'ignored':!![],'userDismissed':!![],'systemDismissed':![]})),_0x1b9613[_0x273110(0xbd)]['remove']('new-rank-change'),_0x1b9613['classList']['add']('dismissing'),setTimeout(()=>{const _0x3d3779=_0x273110;_0x1b9613['parentNode']&&(_0x1b9613['remove'](),this['bannerContainer'][_0x3d3779(0xfe)]['length']===0x0&&(this['bannerContainer']['style']['display']='none'));},0x1f4);}),setTimeout(()=>{const _0x547c00=_0x5bf1df;_0x1b9613['parentNode']&&(_0x1b9613['classList'][_0x547c00(0xeb)](_0x547c00(0xe9)),_0x1b9613['classList']['add'](_0x547c00(0x107)),localStorage['setItem'](_0x57d391,JSON['stringify']({'timestamp':Date[_0x547c00(0xfa)](),'ignored':![],'userDismissed':![],'systemDismissed':!![]})),setTimeout(()=>{_0x1b9613['parentNode']&&(_0x1b9613['remove'](),this['bannerContainer']['children']['length']===0x0&&(this['bannerContainer']['style']['display']='none'));},0x1f4));},0x3a98);});}async[a44_0x3bf0b6(0x110)](_0x2b8e75){const _0x2df88b=a44_0x3bf0b6,_0x101939={..._0x2b8e75},_0x372008=[_0x2b8e75['player'],_0x2b8e75['username'],_0x2b8e75['playerUsername'],_0x2b8e75['displayName']],_0x15490b=_0x372008['some'](_0x3d466f=>_0x3d466f&&typeof _0x3d466f===_0x2df88b(0x116)&&!_0x3d466f['includes'](_0x2df88b(0x102))&&!/^[a-zA-Z0-9]{20,}$/['test'](_0x3d466f));if(_0x15490b)return _0x101939;let _0x489656=null;if(_0x2b8e75['userId'])_0x489656=_0x2b8e75['userId'];else _0x2b8e75[_0x2df88b(0xc9)]&&/^[A-Za-z0-9]{20,}$/['test'](_0x2b8e75['player'])&&(_0x489656=_0x2b8e75[_0x2df88b(0xc9)]);if(!_0x489656)return _0x101939;try{const _0x464d46=await getDoc(doc(db,'players',_0x489656));if(_0x464d46['exists']()){const _0xceafa3=_0x464d46['data']();if(_0xceafa3[_0x2df88b(0xd5)])return _0x101939['resolvedName']=_0xceafa3['username'],_0x101939;}const _0x35b48e=await getDocs(query(collection(db,'approvedMatches'),where(_0x2df88b(0xfb),'==',_0x489656),orderBy(_0x2df88b(0xbf),_0x2df88b(0xb7)),limit(0x1)));if(!_0x35b48e[_0x2df88b(0x101)]){const _0xb42ac5=_0x35b48e['docs'][0x0][_0x2df88b(0x103)]();if(_0xb42ac5['winnerUsername'])return _0x101939[_0x2df88b(0xd8)]=_0xb42ac5['winnerUsername'],_0x101939;}const _0x1896e6=await getDocs(query(collection(db,_0x2df88b(0xcf)),where(_0x2df88b(0xea),'==',_0x489656),orderBy(_0x2df88b(0xbf),'desc'),limit(0x1)));if(!_0x1896e6['empty']){const _0x31f51c=_0x1896e6['docs'][0x0]['data']();if(_0x31f51c['loserUsername'])return _0x101939['resolvedName']=_0x31f51c['loserUsername'],console['log']('Resolved\x20'+_0x489656+'\x20to\x20'+_0x31f51c[_0x2df88b(0xce)]+'\x20(loser)'),_0x101939;}}catch(_0x290274){console['error']('Error\x20resolving\x20user\x20ID:',_0x290274);}return console[_0x2df88b(0xf0)](_0x2df88b(0xcd)+_0x489656),_0x101939;}['showRankChangeLightbox'](_0xa20f78,_0x26938a){const _0x2d1652=a44_0x3bf0b6;let _0x3ac939=document[_0x2d1652(0xc8)]('rankChangeModal');!_0x3ac939&&(_0x3ac939=document['createElement']('div'),_0x3ac939['id']='rankChangeModal',_0x3ac939[_0x2d1652(0xc4)]=_0x2d1652(0xec)+_0xa20f78,document['body']['appendChild'](_0x3ac939));const _0xdfcd07=_0xa20f78===_0x2d1652(0xb6)?_0x2d1652(0x108):'Rank\x20Update',_0x3d5934=_0xa20f78===_0x2d1652(0xb6)?'You\x27ve\x20been\x20promoted\x20to':'You\x27ve\x20been\x20demoted\x20to';_0x3ac939[_0x2d1652(0xc0)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rank-change-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2\x20class=\x22rank-change-title\x22>'+_0xdfcd07+'</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>'+_0x3d5934+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22rank-name\x22>'+_0x26938a+'</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22rank-change-button\x22\x20id=\x22rank-change-ok-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Got\x20it!\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x3ac939[_0x2d1652(0xf5)][_0x2d1652(0x100)]=_0x2d1652(0x113),document[_0x2d1652(0xc8)]('rank-change-ok-btn')['addEventListener'](_0x2d1652(0x117),()=>{const _0x244517=_0x2d1652;_0x3ac939['style']['display']=_0x244517(0xf6);}),_0x3ac939['addEventListener']('click',_0x393b9a=>{const _0x2cdcfb=_0x2d1652;_0x393b9a['target']===_0x3ac939&&(_0x3ac939[_0x2cdcfb(0xf5)][_0x2cdcfb(0x100)]='none');});}async[a44_0x3bf0b6(0xcb)](_0x41b344,_0x3125a6,_0x26ee99,_0x1d2fc2={}){const _0x439a4a=a44_0x3bf0b6;try{if(_0x3125a6===_0x26ee99||!_0x41b344)return null;const _0x4da2d4=_0x1d2fc2['source']||'automatic',_0x368f11=_0x1d2fc2['matchId']||null,_0x435574=_0x1d2fc2[_0x439a4a(0xc6)]||null;console[_0x439a4a(0xb4)]('Processing\x20potential\x20rank\x20change:\x20'+_0x26ee99+_0x439a4a(0xf4)+_0x3125a6+'\x20(source:\x20'+_0x4da2d4+')');let _0x1e1d96=null,_0x412bb9=null;try{const _0x5aa778=await getDoc(doc(db,'players',_0x41b344));if(_0x5aa778['exists']()){const _0x5f44af=_0x5aa778['data']();_0x1e1d96=_0x5f44af['username']||_0x5f44af['displayName']||null,_0x412bb9=_0x5f44af['displayName']||_0x5f44af['username']||null;}!_0x1e1d96&&_0x1d2fc2['username']&&(_0x1e1d96=_0x1d2fc2[_0x439a4a(0xd5)],_0x412bb9=_0x1d2fc2['username']);!_0x1e1d96&&auth['currentUser']&&(_0x1e1d96=auth[_0x439a4a(0xf9)][_0x439a4a(0xde)]||auth[_0x439a4a(0xf9)][_0x439a4a(0x10c)][_0x439a4a(0xf8)]('@')[0x0],_0x412bb9=auth[_0x439a4a(0xf9)]['displayName']||null);if(!_0x1e1d96){const _0x35a24e=query(collection(db,'approvedMatches'),where(_0x439a4a(0xfb),'==',_0x41b344),limit(0x1)),_0xe2efea=await getDocs(_0x35a24e);if(!_0xe2efea['empty'])_0x1e1d96=_0xe2efea['docs'][0x0][_0x439a4a(0x103)]()[_0x439a4a(0xd7)]||'Unknown\x20Player',_0x412bb9=_0x1e1d96;else{const _0x53f4cc=query(collection(db,'approvedMatches'),where('loserId','==',_0x41b344),limit(0x1)),_0x35bcba=await getDocs(_0x53f4cc);!_0x35bcba['empty']&&(_0x1e1d96=_0x35bcba[0x0]['data']()[_0x439a4a(0xce)]||_0x439a4a(0xfd),_0x412bb9=_0x1e1d96);}}}catch(_0x198dc1){console[_0x439a4a(0xb3)](_0x439a4a(0xdb),_0x198dc1);}!_0x1e1d96&&(console['warn']('Could\x20not\x20resolve\x20username\x20for\x20userId:',_0x41b344),_0x1e1d96='A\x20player',_0x412bb9='Unknown\x20Player');const _0x4557b3=this[_0x439a4a(0xff)](_0x26ee99),_0x4ba832=this['getRankName'](_0x3125a6);if(_0x4557b3!==_0x4ba832){const _0x439c5e=_0x3125a6>_0x26ee99,_0x522c75=_0x439c5e?'promotion':'demotion',_0x4e4b34=_0x4ba832;console[_0x439a4a(0xb4)]('Recording\x20'+_0x522c75+'\x20for\x20'+_0x1e1d96+':\x20'+_0x26ee99+'\x20('+_0x4557b3+')\x20→\x20'+_0x3125a6+'\x20('+_0x4ba832+')');try{const _0x3e81e7={'player':_0x1e1d96,'playerUsername':_0x1e1d96,'username':_0x1e1d96,'displayName':_0x412bb9,'userId':_0x41b344,'type':_0x522c75,'rankAchieved':_0x4e4b34,'timestamp':serverTimestamp(),'previousElo':_0x26ee99,'newElo':_0x3125a6,'change':_0x3125a6-_0x26ee99,'previousRank':_0x4557b3,'newRank':_0x4ba832,'source':_0x4da2d4};if(_0x4da2d4==='match'&&_0x368f11)_0x3e81e7['matchId']=_0x368f11;else _0x4da2d4==='admin'&&_0x435574?(_0x3e81e7['modifiedBy']=_0x435574,_0x3e81e7['isAutomatic']=![]):_0x3e81e7[_0x439a4a(0xee)]=!![];const _0x2c609c=writeBatch(db),_0x327463=doc(collection(db,'eloHistory')),_0x351eab=doc(collection(db,'promotionHistory'));return _0x2c609c['set'](_0x327463,_0x3e81e7),_0x2c609c['set'](_0x351eab,_0x3e81e7),await _0x2c609c[_0x439a4a(0xdc)](),await this[_0x439a4a(0xd9)](_0x41b344,_0x1e1d96,_0x26ee99,_0x3125a6,_0x4557b3,_0x4ba832,_0x522c75,{'displayName':_0x412bb9,'source':_0x4da2d4,'matchId':_0x368f11,'ladder':_0x1d2fc2['ladder']||'D1'}),console[_0x439a4a(0xb4)]('Successfully\x20recorded\x20'+_0x522c75+'\x20for\x20'+_0x1e1d96+'\x20to\x20'+_0x4e4b34),_0x4e4b34;}catch(_0x2d307b){console['error'](_0x439a4a(0xd6),_0x2d307b);try{return await addDoc(collection(db,'eloHistory'),{'player':_0x1e1d96,'playerUsername':_0x1e1d96,'username':_0x1e1d96,'displayName':_0x412bb9,'userId':_0x41b344,'type':_0x522c75,'rankAchieved':_0x4e4b34,'timestamp':serverTimestamp(),'previousElo':_0x26ee99,'newElo':_0x3125a6,'change':_0x3125a6-_0x26ee99,'previousRank':_0x4557b3,'source':_0x4da2d4,'isAutomatic':_0x4da2d4!==_0x439a4a(0x10e)}),await this[_0x439a4a(0xd9)](_0x41b344,_0x1e1d96,_0x26ee99,_0x3125a6,_0x4557b3,_0x4ba832,_0x522c75,{'displayName':_0x412bb9,'source':_0x4da2d4,'matchId':_0x368f11,'ladder':_0x1d2fc2['ladder']||'D1'}),_0x4e4b34;}catch(_0x215ad1){return console['error'](_0x439a4a(0xd0),_0x215ad1),null;}}}return null;}catch(_0x4a8640){return console['error']('Error\x20in\x20promotion/demotion\x20recording:',_0x4a8640),null;}}['getRankName'](_0x20fa51){const _0x274614=a44_0x3bf0b6;for(let _0x56db01=this['RANKS']['length']-0x1;_0x56db01>=0x0;_0x56db01--){if(_0x20fa51>=this['RANKS'][_0x56db01]['threshold'])return this[_0x274614(0xca)][_0x56db01]['name'];}return _0x274614(0x10a);}[a44_0x3bf0b6(0xbb)](){this['pollingInterval']&&clearInterval(this['pollingInterval']);}['isNewRankChange'](_0x2f1fa0){const _0x4f8c04=a44_0x3bf0b6;if(_0x2f1fa0['timestamp']){const _0x50d5dd=_0x2f1fa0['timestamp']['seconds']*0x3e8,_0x3483b3=Date['now'](),_0x4f964d=(_0x3483b3-_0x50d5dd)/(0x3e8*0x3c*0x3c);if(_0x4f964d>0x18)return![];}if(_0x2f1fa0['previousRank']&&_0x2f1fa0['newRank']&&_0x2f1fa0[_0x4f8c04(0x105)]!==_0x2f1fa0['newRank'])return!![];return![];}async['sendPromotionNotification'](_0x29b568,_0x34dfd0,_0x1d5dcd,_0x24ce44,_0x14a590,_0xbeb49,_0x3d3e58,_0x33a988={}){const _0x24a2cd=a44_0x3bf0b6;try{console['log']('STARTING\x20notification\x20for\x20'+_0x34dfd0+_0x24a2cd(0x112)+_0x3d3e58);const _0x5a201a={'userId':_0x29b568,'username':_0x34dfd0,'displayName':_0x33a988['displayName']||_0x34dfd0,'oldElo':parseInt(_0x1d5dcd),'newElo':parseInt(_0x24ce44),'eloDifference':parseInt(_0x24ce44)-parseInt(_0x1d5dcd),'oldRank':_0x14a590,'newRank':_0xbeb49,'type':_0x3d3e58,'timestamp':serverTimestamp(),'processed':![],'source':_0x33a988['source']||_0x24a2cd(0xe0),'matchId':_0x33a988[_0x24a2cd(0x114)]||null,'ladder':_0x33a988[_0x24a2cd(0xc5)]||'D1','adminUser':_0x33a988['adminUser']||null};console['log']('Creating\x20Discord\x20notification:',_0x5a201a);const _0x5751b6=await addDoc(collection(db,_0x24a2cd(0xe2)),_0x5a201a);return console['log']('Discord\x20notification\x20sent\x20successfully\x20with\x20ID:\x20'+_0x5751b6['id']),!![];}catch(_0x39c8e5){return console['error'](_0x24a2cd(0xd2),_0x39c8e5),![];}}}export const promotionManager=new PromotionManager();document['addEventListener'](a44_0x3bf0b6(0xdf),()=>{const _0x1d145b=a44_0x3bf0b6;promotionManager[_0x1d145b(0xf1)]();});export const initializePromotionTracker=()=>promotionManager['initialize']();export const checkAndRecordPromotion=(_0x2a596a,_0x38abae,_0x6d3958,_0x35cb64)=>promotionManager[a44_0x3bf0b6(0xcb)](_0x2a596a,_0x38abae,_0x6d3958,_0x35cb64);export const getRankName=_0x475704=>promotionManager['getRankName'](_0x475704);function a44_0x161d(){const _0x1650f4=['error','log','setItem','promotion','desc','type','div','setAttribute','cleanup','DISPLAY_HOURS','classList','true','date','innerHTML','setupBannerContainer','length','\x20<span\x20class=\x22rank-text\x22>','className','ladder','adminUser','usernameCache','getElementById','player','RANKS','checkAndRecordPromotion','shouldShowPromotion','Failed\x20to\x20resolve\x20user\x20ID:\x20','loserUsername','approvedMatches','Fallback\x20write\x20failed:','Dismiss','Error\x20sending\x20Discord\x20notification:','timestamp','processRankChanges','username','Error\x20writing\x20promotion\x20records:','winnerUsername','resolvedName','sendPromotionNotification','&times;','Error\x20resolving\x20username:','commit','#CD7F32','displayName','DOMContentLoaded','automatic','lastFetchTime','promotionNotifications','Invalid\x20storage\x20format\x20for\x20','createElement','bind','\x20was\x20dismissed\x20by\x20user\x20within\x20last\x20','eloHistory','forEach','new-rank-change','loserId','remove','rank-change-modal\x20','beforeunload','isAutomatic','seconds','warn','initialize','Skipping\x20ignored\x20promotion:\x20','systemDismissed','\x20→\x20','style','none','title','split','currentUser','now','winnerId','Error\x20processing\x20rank\x20change:','Unknown\x20Player','children','getRankName','display','empty','ID:','data','parse','previousRank','Emerald','dismissing','Congratulations!','showRankChangeBanner','Unranked','bannerContainer','email','table','admin','visibilityState','resolveUserId','data-id','\x27s\x20','flex','matchId','then','string','click','promotion-banner'];a44_0x161d=function(){return _0x1650f4;};return a44_0x161d();}
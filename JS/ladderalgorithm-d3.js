const a27_0x40a46e=(function(){let _0x117721=!![];return function(_0x2545fa,_0x981257){const _0x4f9b28=_0x117721?function(){if(_0x981257){const _0x160139=_0x981257['apply'](_0x2545fa,arguments);return _0x981257=null,_0x160139;}}:function(){};return _0x117721=![],_0x4f9b28;};}()),a27_0x4ea952=a27_0x40a46e(this,function(){const _0x209218=a27_0x3213,_0x30b5dd=function(){const _0x4a93ab=a27_0x3213;let _0xd06686;try{_0xd06686=Function(_0x4a93ab(0x17e)+_0x4a93ab(0x17f)+');')();}catch(_0x45e290){_0xd06686=window;}return _0xd06686;},_0x1ee3b5=_0x30b5dd(),_0x22732e=_0x1ee3b5['console']=_0x1ee3b5['console']||{},_0x54b437=['log','warn',_0x209218(0x189),'error','exception','table','trace'];for(let _0x4d36d7=0x0;_0x4d36d7<_0x54b437['length'];_0x4d36d7++){const _0x4ac048=a27_0x40a46e['constructor']['prototype'][_0x209218(0x18b)](a27_0x40a46e),_0x4d28ff=_0x54b437[_0x4d36d7],_0x5587b0=_0x22732e[_0x4d28ff]||_0x4ac048;_0x4ac048[_0x209218(0x17a)]=a27_0x40a46e['bind'](a27_0x40a46e),_0x4ac048['toString']=_0x5587b0[_0x209218(0x186)][_0x209218(0x18b)](_0x5587b0),_0x22732e[_0x4d28ff]=_0x4ac048;}});a27_0x4ea952();import{addDoc,updateDoc,serverTimestamp,collection,doc,getDoc,getDocs,query,where,setDoc,deleteDoc,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a27_0x450b(){const _0xb17682=['D3\x20Match\x20moved\x20to\x20approved\x20collection','__proto__','D3\x20Match\x20successfully\x20approved\x20and\x20ELO\x20updated','log','update','return\x20(function()\x20','{}.constructor(\x22return\x20this\x22)(\x20)','winnerUsername','eloRating','Current\x20user:','D3\x20Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked','pow','loserUsername','toString','data','playersD3','info','Current\x20username:','bind','Error\x20in\x20updateEloRatingsD3:','all','D3\x20Report\x20data:'];a27_0x450b=function(){return _0xb17682;};return a27_0x450b();}import{db,auth}from'./firebase-config.js';import{recordEloChangeD3}from'./elo-history-d3.js';export function calculateEloD3(_0xb1d234,_0x376265,_0x3c731d=0x20){const _0x5bd5d7=a27_0x3213,_0x58e9f1=0x1/(0x1+Math[_0x5bd5d7(0x184)](0xa,(_0x376265-_0xb1d234)/0x190)),_0x4d864d=0x1/(0x1+Math['pow'](0xa,(_0xb1d234-_0x376265)/0x190)),_0x10af16=_0xb1d234+_0x3c731d*(0x1-_0x58e9f1),_0x41595d=_0x376265+_0x3c731d*(0x0-_0x4d864d);return{'newWinnerRating':Math['round'](_0x10af16),'newLoserRating':Math['round'](_0x41595d)};}export async function updateEloRatingsD3(_0x3b824f,_0x34dd9b,_0x51a908){const _0x504351=a27_0x3213;try{const _0x4bff0a=writeBatch(db),_0x2579f4=doc(db,_0x504351(0x188),_0x3b824f),_0x49f1c0=doc(db,'playersD3',_0x34dd9b),[_0x22ae8c,_0x3f1c45]=await Promise['all']([getDoc(_0x2579f4),getDoc(_0x49f1c0)]);if(!_0x22ae8c['exists']()||!_0x3f1c45['exists']())throw new Error('One\x20or\x20both\x20D3\x20players\x20not\x20found');const _0x355a66=_0x22ae8c['data'](),_0x39be5a=_0x3f1c45['data'](),_0xdb2111=_0x355a66['position']||Number['MAX_SAFE_INTEGER'],_0x5ae1a3=_0x39be5a['position']||Number['MAX_SAFE_INTEGER'],{newWinnerRating:_0x2dddcc,newLoserRating:_0x5b267a}=calculateEloD3(_0x355a66['eloRating']||0x4b0,_0x39be5a[_0x504351(0x181)]||0x4b0);let _0x280bab=_0xdb2111,_0x1c6df4=_0x5ae1a3;if(_0xdb2111>_0x5ae1a3){console['log'](_0x504351(0x183)),_0x280bab=_0x5ae1a3,_0x1c6df4=_0x5ae1a3+0x1;const _0x247570=query(collection(db,'playersD3'),where('position','>',_0x5ae1a3),where('position','<',_0xdb2111)),_0x5eea8e=await getDocs(_0x247570);for(const _0x2b78df of _0x5eea8e['docs']){_0x2b78df['id']!==_0x3b824f&&_0x2b78df['id']!==_0x34dd9b&&_0x4bff0a[_0x504351(0x17d)](doc(db,'playersD3',_0x2b78df['id']),{'position':_0x2b78df['data']()['position']+0x1});}}else console['log']('D3\x20Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions');return _0x4bff0a['update'](_0x2579f4,{'eloRating':_0x2dddcc,'lastMatchDate':serverTimestamp(),'position':_0x280bab,'lastMatchId':_0x51a908}),_0x4bff0a['update'](_0x49f1c0,{'eloRating':_0x5b267a,'lastMatchDate':serverTimestamp(),'position':_0x1c6df4,'lastMatchId':_0x51a908}),await _0x4bff0a['commit'](),console[_0x504351(0x17c)]('D3\x20ELO\x20ratings\x20updated\x20successfully'),await Promise['all']([recordEloChangeD3({'playerId':_0x3b824f,'previousElo':_0x355a66['eloRating']||0x4b0,'newElo':_0x2dddcc,'opponentId':_0x34dd9b,'matchResult':'win','previousPosition':_0xdb2111,'newPosition':_0x280bab,'isPromotion':_0x280bab<_0xdb2111,'matchId':_0x51a908,'timestamp':serverTimestamp()}),recordEloChangeD3({'playerId':_0x34dd9b,'previousElo':_0x39be5a['eloRating']||0x4b0,'newElo':_0x5b267a,'opponentId':_0x3b824f,'matchResult':'loss','previousPosition':_0x5ae1a3,'newPosition':_0x1c6df4,'isDemotion':_0x1c6df4>_0x5ae1a3,'matchId':_0x51a908,'timestamp':serverTimestamp()})]),!![];}catch(_0xddf6a8){console['error'](_0x504351(0x18c),_0xddf6a8);throw _0xddf6a8;}}function a27_0x3213(_0x264296,_0x5f367d){const _0x4ea952=a27_0x450b();return a27_0x3213=function(_0x40a46e,_0x5a4cbe){_0x40a46e=_0x40a46e-0x179;let _0x450b71=_0x4ea952[_0x40a46e];return _0x450b71;},a27_0x3213(_0x264296,_0x5f367d);}export async function approveReportD3(_0x9f8189,_0x208280,_0x7a17ca,_0x5e0fb5){const _0x557205=a27_0x3213;try{console['log']('Starting\x20approveReportD3\x20function\x20with:',{'reportId':_0x9f8189,'winnerScore':_0x208280,'winnerSuicides':_0x7a17ca,'winnerComment':_0x5e0fb5});const _0x3e1c44=auth['currentUser'];if(!_0x3e1c44){console['log']('No\x20user\x20logged\x20in');throw new Error('You\x20must\x20be\x20logged\x20in\x20to\x20approve\x20D3\x20matches');}console['log'](_0x557205(0x182),_0x3e1c44['email']);const _0x21852c=await getDoc(doc(db,'playersD3',_0x3e1c44['uid'])),_0x5669e5=_0x21852c['exists']()?_0x21852c[_0x557205(0x187)]()['username']:null;console['log'](_0x557205(0x18a),_0x5669e5);const _0x262c3f=doc(db,'pendingMatchesD3',_0x9f8189),_0xfe6ff6=await getDoc(_0x262c3f);if(!_0xfe6ff6['exists']()){console[_0x557205(0x17c)]('D3\x20Report\x20not\x20found\x20with\x20ID:',_0x9f8189);throw new Error('D3\x20match\x20report\x20not\x20found');}const _0x4d98d3=_0xfe6ff6['data']();console[_0x557205(0x17c)](_0x557205(0x18e),_0x4d98d3);if(_0x5669e5!==_0x4d98d3[_0x557205(0x180)])throw new Error('Only\x20the\x20winner\x20can\x20approve\x20D3\x20matches');const _0x1f6fc9={..._0x4d98d3,'winnerScore':_0x208280,'winnerSuicides':_0x7a17ca,'winnerComment':_0x5e0fb5,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':_0x5669e5,'createdAt':_0x4d98d3['createdAt']||serverTimestamp(),'winnerUsername':_0x4d98d3['winnerUsername'],'loserUsername':_0x4d98d3[_0x557205(0x185)]};await setDoc(doc(db,'approvedMatchesD3',_0x9f8189),_0x1f6fc9),await deleteDoc(_0x262c3f),console['log'](_0x557205(0x179));const [_0x3223dc,_0x4a4182]=await Promise[_0x557205(0x18d)]([getDocs(query(collection(db,'playersD3'),where('username','==',_0x4d98d3[_0x557205(0x180)]))),getDocs(query(collection(db,'playersD3'),where('username','==',_0x4d98d3['loserUsername'])))]);if(_0x3223dc['empty']||_0x4a4182['empty'])throw new Error('Could\x20not\x20find\x20D3\x20player\x20documents');const _0x215da5=_0x3223dc['docs'][0x0]['id'],_0x15cd0a=_0x4a4182['docs'][0x0]['id'];return await updateEloRatingsD3(_0x215da5,_0x15cd0a,_0x9f8189),console['log'](_0x557205(0x17b)),!![];}catch(_0x1289ff){console['error']('Error\x20in\x20approveReportD3:',_0x1289ff);throw _0x1289ff;}}
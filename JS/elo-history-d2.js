const a12_0x5607b5=a12_0x35f5,a12_0x17818d=(function(){let _0x11c204=!![];return function(_0x3687f4,_0x2028ce){const _0x156bbe=_0x11c204?function(){if(_0x2028ce){const _0x57f2a5=_0x2028ce['apply'](_0x3687f4,arguments);return _0x2028ce=null,_0x57f2a5;}}:function(){};return _0x11c204=![],_0x156bbe;};}()),a12_0x4eb85b=a12_0x17818d(this,function(){const _0x599db9=a12_0x35f5;let _0x20eddb;try{const _0x34b328=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x20eddb=_0x34b328();}catch(_0x1bec10){_0x20eddb=window;}const _0x1858c7=_0x20eddb['console']=_0x20eddb['console']||{},_0x56741a=['log','warn','info','error','exception',_0x599db9(0x155),_0x599db9(0x148)];for(let _0x2371f4=0x0;_0x2371f4<_0x56741a['length'];_0x2371f4++){const _0x5f297e=a12_0x17818d['constructor']['prototype'][_0x599db9(0x14e)](a12_0x17818d),_0x18a5f3=_0x56741a[_0x2371f4],_0x4b0c8b=_0x1858c7[_0x18a5f3]||_0x5f297e;_0x5f297e[_0x599db9(0x149)]=a12_0x17818d[_0x599db9(0x14e)](a12_0x17818d),_0x5f297e['toString']=_0x4b0c8b['toString']['bind'](_0x4b0c8b),_0x1858c7[_0x18a5f3]=_0x5f297e;}});function a12_0x35f5(_0xcc3a6a,_0x58d71e){const _0x4eb85b=a12_0x9724();return a12_0x35f5=function(_0x17818d,_0x1209df){_0x17818d=_0x17818d-0x143;let _0x9724ab=_0x4eb85b[_0x17818d];return _0x9724ab;},a12_0x35f5(_0xcc3a6a,_0x58d71e);}a12_0x4eb85b();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D2=[{'name':a12_0x5607b5(0x14d),'elo':0x708},{'name':a12_0x5607b5(0x150),'elo':0x640},{'name':'Bronze','elo':0x578},{'name':'Unranked','elo':0x4b0}];let lastVisibleD2=null;async function getUsernameByIdD2(_0x1d9c7f){const _0x46c781=a12_0x5607b5;try{if(!_0x1d9c7f)return'Unknown\x20Player';const _0x519c1a=await getDoc(doc(db,'playersD2',_0x1d9c7f));if(_0x519c1a['exists']())return _0x519c1a['data']()['username']||_0x46c781(0x143);const _0x298d90=await getDocs(query(collection(db,'approvedMatchesD2'),where(_0x46c781(0x153),'==',_0x1d9c7f),limit(0x1)));if(!_0x298d90[_0x46c781(0x147)])return _0x298d90[_0x46c781(0x14c)][0x0][_0x46c781(0x14f)]()[_0x46c781(0x145)]||'Unknown\x20Player';const _0x29f8a1=await getDocs(query(collection(db,'approvedMatchesD2'),where('loserId','==',_0x1d9c7f),limit(0x1)));if(!_0x29f8a1[_0x46c781(0x147)])return _0x29f8a1['docs'][0x0]['data']()[_0x46c781(0x151)]||'Unknown\x20Player';return'Unknown\x20Player';}catch(_0x21c0cc){return console[_0x46c781(0x14a)]('Error\x20getting\x20username:',_0x21c0cc),'Unknown\x20Player';}}export async function recordEloChangeD2({playerId:_0x1f7541,previousElo:_0x412467,newElo:_0x3667ce,opponentId:_0x387a20,matchResult:_0x3697df,previousPosition:_0x44f168,newPosition:_0x458981,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x5630b4,timestamp:_0x52fe74}){const _0x38f5df=a12_0x5607b5;try{const _0x380dc5=doc(collection(db,_0x38f5df(0x152)));let _0x1b9bed=_0x38f5df(0x154);if(isPromotion)_0x1b9bed='promotion';if(isDemotion)_0x1b9bed='demotion';let _0x5d049c=_0x38f5df(0x14b);if(_0x3667ce>=0x834)_0x5d049c='Emerald';else{if(_0x3667ce>=0x708)_0x5d049c=_0x38f5df(0x14d);else{if(_0x3667ce>=0x640)_0x5d049c='Silver';else{if(_0x3667ce>=0x578)_0x5d049c='Bronze';}}}return await setDoc(_0x380dc5,{'type':_0x1b9bed,'player':_0x1f7541,'opponent':_0x387a20,'previousElo':_0x412467,'newElo':_0x3667ce,'change':_0x3667ce-_0x412467,'matchResult':_0x3697df,'previousPosition':_0x44f168,'newPosition':_0x458981,'rankAchieved':_0x5d049c,'matchId':_0x5630b4,'timestamp':_0x52fe74}),console[_0x38f5df(0x144)]('D2\x20ELO\x20history\x20recorded\x20for\x20'+_0x1f7541),!![];}catch(_0x4b44b0){console['error']('Error\x20recording\x20D2\x20ELO\x20history:',_0x4b44b0);throw _0x4b44b0;}}export async function getEloHistoryD2(_0x5f5513=0x14){const _0x42c041=a12_0x5607b5;try{const _0x3303e8=collection(db,'eloHistoryD2');let _0xcc0193;lastVisibleD2?_0xcc0193=query(_0x3303e8,orderBy('timestamp','desc'),startAfter(lastVisibleD2),limit(_0x5f5513)):_0xcc0193=query(_0x3303e8,orderBy('timestamp','desc'),limit(_0x5f5513));const _0xb59306=await getDocs(_0xcc0193);if(_0xb59306['empty'])return{'entries':[],'hasMore':![]};lastVisibleD2=_0xb59306[_0x42c041(0x14c)][_0xb59306['docs']['length']-0x1];const _0x2b0ce9=_0xb59306['docs'][_0x42c041(0x156)](async _0x5dfe5a=>{const _0x1177cb=_0x5dfe5a['data'](),[_0x1d934b,_0x4010ba]=await Promise['all']([getUsernameByIdD2(_0x1177cb['player']),getUsernameByIdD2(_0x1177cb['opponent'])]);return{..._0x1177cb,'playerUsername':_0x1d934b,'opponentUsername':_0x4010ba,'change':_0x1177cb['newElo']-_0x1177cb['previousElo'],'timestamp':_0x1177cb['timestamp']};}),_0x100f1c=await Promise[_0x42c041(0x146)](_0x2b0ce9);return{'entries':_0x100f1c,'hasMore':_0xb59306['size']===_0x5f5513};}catch(_0x1f8cce){console[_0x42c041(0x14a)]('Error\x20fetching\x20D2\x20ELO\x20history:',_0x1f8cce);throw _0x1f8cce;}}export function resetPaginationD2(){lastVisibleD2=null;}function a12_0x9724(){const _0x33f32d=['Unknown\x20Player','log','winnerUsername','all','empty','trace','__proto__','error','Unranked','docs','Gold','bind','data','Silver','loserUsername','eloHistoryD2','winnerId','match','table','map'];a12_0x9724=function(){return _0x33f32d;};return a12_0x9724();}
const a50_0x47828c=a50_0xd0c7,a50_0x4cbb35=(function(){let _0x3fcab9=!![];return function(_0x1ddba6,_0x2c5c3f){const _0x56e9c6=_0x3fcab9?function(){if(_0x2c5c3f){const _0x19fe16=_0x2c5c3f['apply'](_0x1ddba6,arguments);return _0x2c5c3f=null,_0x19fe16;}}:function(){};return _0x3fcab9=![],_0x56e9c6;};}()),a50_0x251b68=a50_0x4cbb35(this,function(){const _0x318d94=a50_0xd0c7,_0x56d4b5=function(){let _0x45e9a4;try{_0x45e9a4=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0xfa3129){_0x45e9a4=window;}return _0x45e9a4;},_0x1ae195=_0x56d4b5(),_0x4cba1c=_0x1ae195['console']=_0x1ae195['console']||{},_0x2a8af8=[_0x318d94(0x16b),'warn','info','error',_0x318d94(0x112),'table','trace'];for(let _0x2b5411=0x0;_0x2b5411<_0x2a8af8[_0x318d94(0x173)];_0x2b5411++){const _0x2c47cb=a50_0x4cbb35['constructor'][_0x318d94(0x14c)]['bind'](a50_0x4cbb35),_0x5a4f38=_0x2a8af8[_0x2b5411],_0x4f3ac0=_0x4cba1c[_0x5a4f38]||_0x2c47cb;_0x2c47cb['__proto__']=a50_0x4cbb35['bind'](a50_0x4cbb35),_0x2c47cb[_0x318d94(0x138)]=_0x4f3ac0['toString'][_0x318d94(0x13a)](_0x4f3ac0),_0x4cba1c[_0x5a4f38]=_0x2c47cb;}});a50_0x251b68();import{getAuth,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{getFirestore,doc,getDoc,setDoc,updateDoc,collection,addDoc,serverTimestamp}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{clearTokenCache}from'./tokens.js';const auth=getAuth(),db=getFirestore(),THEMES={'default':{'price':0x0,'name':a50_0x47828c(0x10d),'description':'Rock\x20texture\x20with\x20a\x20sleek\x20nav\x20and\x20footer'},'purple':{'price':0x96,'name':'Purple','description':'Can\x27t\x20get\x20enough'},'cyberpunk':{'price':0x190,'name':'Yellow\x20Orange','description':'This\x20theme\x20makes\x20me\x20happy'},'emerald':{'price':0x3e8,'name':a50_0x47828c(0x15a),'description':'Emerald\x20City!'},'gold':{'price':0x320,'name':'Gold','description':'Only\x20the\x20best\x20get\x20this\x20one'},'contrast':{'price':0x0,'name':a50_0x47828c(0xf8),'description':a50_0x47828c(0x11c)},'ocean':{'price':0x12c,'name':'Blue','description':a50_0x47828c(0x12b)},'volcanic':{'price':0x1f4,'name':a50_0x47828c(0x170),'description':'For\x20the\x20angry\x20type.'}},TOKENS={'blob01':{'price':0x1f4,'name':'Blob\x20Token\x201','description':a50_0x47828c(0x11a),'image':'../images/tokens/blob01.gif','category':'blob'},'blob02':{'price':0x3e8,'name':a50_0x47828c(0x113),'description':'Another\x20enigmatic\x20blob\x20creature','image':a50_0x47828c(0x141),'category':'blob'},'blob03':{'price':0x7d0,'name':'Blob\x20Token\x203','description':a50_0x47828c(0x148),'image':a50_0x47828c(0x116),'category':a50_0x47828c(0x12e)},'cloak':{'price':0x1f4,'name':'Cloaking\x20Device','description':a50_0x47828c(0x115),'image':a50_0x47828c(0x159),'category':'special'},'gauge18':{'price':0x320,'name':a50_0x47828c(0xf2),'description':'Monitor\x20your\x20ship\x27s\x20energy\x20levels','image':'../images/tokens/gauge18.gif','category':'equipment'},'fusion':{'price':0x15e,'name':'Fusion\x20Cannon','description':'Devastating\x20fusion\x20weapon\x20technology','image':'../images/tokens/subgame/fusion.gif','category':'weapon'},'mmissile':{'price':0x320,'name':'Mega\x20Missile','description':'Heavy\x20ordinance\x20for\x20tough\x20situations','image':'../images/tokens/subgame/mmissile.gif','category':'weapon'},'pbomb':{'price':0x15e,'name':'Proximity\x20Bomb','description':a50_0x47828c(0x177),'image':'../images/tokens/subgame/pbomb.gif','category':'weapon'},'pwr01':{'price':0x64,'name':'Energy','description':a50_0x47828c(0x126),'image':'../images/tokens/subgame/pwr01.gif','category':'powerup'},'pwr02':{'price':0x258,'name':'Shield\x20Orb','description':a50_0x47828c(0x123),'image':'../images/tokens/subgame/pwr02.gif','category':a50_0x47828c(0xf7)},'smissile':{'price':0x28a,'name':'Smart\x20Missile','description':a50_0x47828c(0x135),'image':'../images/tokens/subgame/smissile.gif','category':'weapon'}};let userData={'points':0x0,'inventory':[],'isAdmin':![]},storeContainer,pointsDisplay,authWarning;function a50_0x5279(){const _0xf8c9f8=['Unexpected\x20token\x20error:','R/Y/B\x20Keys','uid','category','warn','floor','powerup','Black\x20&\x20White','\x20token','background','displayLadder','\x20Points','querySelector','add','getElementById','confirm','owned','tokenId','transactions','Themes\x20container\x20not\x20found','\x20more\x20points.','textContent','email','click','cursor','0.7','Purchase\x20failed.\x20Please\x20try\x20again.','points','Classic\x20RDL','preventDefault','cannot-afford','price','Buy','exception','Blob\x20Token\x202','‚úÖ\x20Token\x20','Become\x20one\x20with\x20the\x20shadows','../images/tokens/blob03.gif','Theme\x20','message','remove','A\x20mysterious\x20purple\x20blob\x20token','itemId','You\x20can\x20see\x20better!','Theme\x20purchase\x20failed:','Token\x20unequip\x20failed:','Purchase','‚úÖ\x20Sold\x20token\x20','Please\x20sign\x20in\x20to\x20purchase\x20tokens','Tokens\x20container\x20not\x20found','Advanced\x20energy\x20storage\x20system','.token-equip-btn','classList','Enhanced\x20energy\x20generation\x20unit','data','equipped','Sign\x20in\x20to\x20Purchase','\x20points','This\x20one\x20is\x20really\x20pretty','closest','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22item-title\x22>','blob','store-message','none','entries','createElement','ThemeSystem','currentUser','Intelligent\x20targeting\x20system','isAdmin','0.5','toString','success','bind','Failed\x20to\x20sell\x20token:\x20','permission-denied','\x20theme\x20applied!','Token\x20','apply-theme','Token\x20collection\x20update\x20had\x20an\x20issue,\x20but\x20equip\x20was\x20successful:','../images/tokens/blob02.gif','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22item-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22item-icon\x20token-icon\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22','token_','Token\x20purchase\x20failed:','inventory','addEventListener','\x20theme','The\x20final\x20blob\x20in\x20the\x20collection','refreshUI','\x20points\x20(50%\x20refund)','includes','prototype','tokens','\x20points\x20to\x20purchase\x20this\x20theme','Please\x20sign\x20in\x20to\x20unequip\x20tokens','function','New\x20user\x20profile\x20created','description','‚úÖ\x20Token\x20unequipped','Apply\x20Theme','forEach','userProfiles','sign-in-paid','\x20theme\x20purchased!','../images/tokens/cloak.gif','Emerald','current-theme','Theme\x20clicked:\x20','appendChild','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','dispatchEvent','Failed\x20to\x20unequip\x20token:\x20','querySelectorAll','theme','parentNode','disabled','Please\x20sign\x20in\x20to\x20purchase\x20themes','style','dataset','Equipped','opacity','RedeemStore','log','name','token','\x20not\x20found','Please\x20sign\x20in\x20to\x20sell\x20tokens','Red','Need\x20','DOMContentLoaded','length','[data-token]','filter','display','Strategic\x20explosive\x20device','You\x20need\x20','error'];a50_0x5279=function(){return _0xf8c9f8;};return a50_0x5279();}document[a50_0x47828c(0x146)](a50_0x47828c(0x172),()=>{const _0x1912a8=a50_0x47828c;console['log']('üè™\x20Redeem\x20store\x20initializing...'),storeContainer=document['getElementById']('store-content'),pointsDisplay=document['getElementById']('user-points'),authWarning=document[_0x1912a8(0xff)]('auth-warning'),initAuthListener(),buildStoreUI();});function initAuthListener(){onAuthStateChanged(auth,async _0x4efeaa=>{const _0x196a12=a50_0xd0c7;if(_0x4efeaa){console[_0x196a12(0x16b)]('‚úÖ\x20User\x20authenticated:',_0x4efeaa['displayName']||_0x4efeaa['email']);if(authWarning)authWarning['style']['display']='none';if(storeContainer)storeContainer[_0x196a12(0x166)]['display']='block';await loadUserData(_0x4efeaa),updateThemeButtons(),updateTokenButtons();}else{console[_0x196a12(0x16b)]('‚ùå\x20User\x20not\x20authenticated');if(authWarning)authWarning['style']['display']='block';if(storeContainer)storeContainer['style'][_0x196a12(0x176)]=_0x196a12(0x130);userData={'points':0x0,'inventory':[],'isAdmin':![]},window['isUserAdmin']=![];}});}async function loadUserData(_0xbfedc0){const _0x43b36f=a50_0x47828c;try{const _0x1c4225=doc(db,'userProfiles',_0xbfedc0['uid']),_0x247c0d=await getDoc(_0x1c4225);if(_0x247c0d['exists']()){const _0xe1a7f3=_0x247c0d['data']();userData={'points':_0xe1a7f3['points']||0x0,'inventory':_0xe1a7f3['inventory']||[],'isAdmin':_0xe1a7f3[_0x43b36f(0x136)]||![],'equippedToken':_0xe1a7f3['equippedToken']||null},pointsDisplay&&(pointsDisplay['textContent']=userData[_0x43b36f(0x10c)]['toLocaleString']()),window['isUserAdmin']=userData['isAdmin'],userData[_0x43b36f(0x136)]&&(console['log']('üëë\x20Admin\x20controls\x20enabled'),window[_0x43b36f(0x15f)](new CustomEvent('adminStatusChanged',{'detail':{'isAdmin':!![]}}))),console['log']('User\x20data\x20loaded\x20-\x20Points:\x20'+userData['points']+',\x20Inventory:\x20'+userData[_0x43b36f(0x145)]['length']+'\x20items,\x20Equipped:\x20'+(userData['equippedToken']||'none'));}else await setDoc(_0x1c4225,{'points':0x0,'inventory':[],'equippedToken':null,'createdAt':serverTimestamp(),'username':_0xbfedc0['displayName']||_0xbfedc0[_0x43b36f(0x107)]?.['split']('@')[0x0]||'User'}),userData={'points':0x0,'inventory':[],'isAdmin':![],'equippedToken':null},pointsDisplay&&(pointsDisplay['textContent']='0'),window['isUserAdmin']=![],console['log'](_0x43b36f(0x151));}catch(_0x5b05b3){console['error']('Error\x20loading\x20user\x20data:',_0x5b05b3);}}function userOwnsTheme(_0x1d6217){if(THEMES[_0x1d6217]?.['price']===0x0)return!![];return userData['inventory']['includes']('theme_'+_0x1d6217);}function userOwnsToken(_0x5e2183){const _0x1a44fb=a50_0x47828c;return userData['inventory'][_0x1a44fb(0x14b)](_0x1a44fb(0x143)+_0x5e2183);}function userHasTokenEquipped(_0x567c9e){return userData['equippedToken']===_0x567c9e;}function getEquippedToken(){return userData['equippedToken']||null;}async function purchaseTheme(_0x2203be){const _0x54c223=a50_0x47828c,_0x3c47b3=auth['currentUser'];if(!_0x3c47b3)return showMessage(_0x54c223(0x165),'error'),![];const _0x41f0a0=THEMES[_0x2203be];if(!_0x41f0a0)return console[_0x54c223(0x179)]('Theme\x20'+_0x2203be+_0x54c223(0x16e)),![];if(userData['points']<_0x41f0a0['price'])return showMessage('Not\x20enough\x20points.\x20You\x20need\x20'+(_0x41f0a0['price']-userData['points'])+'\x20more\x20points.',_0x54c223(0x179)),![];if(userOwnsTheme(_0x2203be))return showMessage('You\x20already\x20own\x20the\x20'+_0x41f0a0['name']+_0x54c223(0x147),'info'),![];try{return await processPurchase(_0x2203be,_0x41f0a0,'theme');}catch(_0x32358b){return console['error'](_0x54c223(0x11d),_0x32358b),showMessage('Purchase\x20failed.\x20Please\x20try\x20again.','error'),![];}}async function purchaseToken(_0x5beaf4){const _0x23826b=a50_0x47828c,_0x5e4e1c=auth['currentUser'];if(!_0x5e4e1c)return showMessage('Please\x20sign\x20in\x20to\x20purchase\x20tokens',_0x23826b(0x179)),![];const _0x23b01c=TOKENS[_0x5beaf4];if(!_0x23b01c)return console['error'](_0x23826b(0x13e)+_0x5beaf4+'\x20not\x20found'),![];if(userData['points']<_0x23b01c['price'])return showMessage('Not\x20enough\x20points.\x20You\x20need\x20'+(_0x23b01c['price']-userData[_0x23826b(0x10c)])+_0x23826b(0x105),'error'),![];if(userOwnsToken(_0x5beaf4))return showMessage('You\x20already\x20own\x20the\x20'+_0x23b01c['name']+_0x23826b(0xf9),'info'),![];try{return await processPurchase(_0x5beaf4,_0x23b01c,'token');}catch(_0x831eaa){return console['error'](_0x23826b(0x144),_0x831eaa),showMessage(_0x23826b(0x10b),'error'),![];}}function a50_0xd0c7(_0x25ccf6,_0x2ce327){const _0x251b68=a50_0x5279();return a50_0xd0c7=function(_0x4cbb35,_0x354094){_0x4cbb35=_0x4cbb35-0xf1;let _0x527935=_0x251b68[_0x4cbb35];return _0x527935;},a50_0xd0c7(_0x25ccf6,_0x2ce327);}async function processPurchase(_0x967d2d,_0x2c3110,_0x264395){const _0x183c61=a50_0x47828c,_0x1c124f=auth['currentUser'];try{const _0x1aa1c1=doc(db,_0x183c61(0x156),_0x1c124f[_0x183c61(0xf3)]),_0x3f8f2b=await getDoc(_0x1aa1c1);if(!_0x3f8f2b['exists']())return showMessage('User\x20profile\x20not\x20found','error'),![];const _0x42b1df=_0x3f8f2b['data'](),_0x4f5c7d=_0x42b1df['points']||0x0,_0x3afb11=_0x42b1df['inventory']||[];if(_0x4f5c7d<_0x2c3110[_0x183c61(0x110)])return showMessage('Insufficient\x20points',_0x183c61(0x179)),![];if(_0x3afb11['includes'](_0x264395+'_'+_0x967d2d))return showMessage('You\x20already\x20own\x20this\x20'+_0x264395,'info'),![];const _0x1f12ea=_0x4f5c7d-_0x2c3110['price'],_0x150a6c=[..._0x3afb11,_0x264395+'_'+_0x967d2d];await updateDoc(_0x1aa1c1,{'points':_0x1f12ea,'inventory':_0x150a6c,'lastPurchase':serverTimestamp()});if(_0x264395===_0x183c61(0x16d))try{const _0x1ead2c=doc(db,'userTokens',_0x1c124f[_0x183c61(0xf3)]),_0x46feb1=await getDoc(_0x1ead2c);let _0xaf89fa=[];_0x46feb1['exists']()&&(_0xaf89fa=_0x46feb1['data']()['tokens']||[]);const _0x116764=new Date();_0xaf89fa['push']({'tokenId':_0x967d2d,'tokenName':_0x2c3110[_0x183c61(0x16c)],'tokenImage':_0x2c3110['image'],'category':_0x2c3110[_0x183c61(0xf4)],'purchasedAt':_0x116764,'price':_0x2c3110['price'],'equipped':![]}),await setDoc(_0x1ead2c,{'userId':_0x1c124f[_0x183c61(0xf3)],'username':_0x42b1df['username']||_0x1c124f['displayName']||'Unknown','tokens':_0xaf89fa,'lastUpdated':serverTimestamp()},{'merge':!![]}),typeof clearTokenCache==='function'&&clearTokenCache(_0x1c124f[_0x183c61(0xf3)]),console['log'](_0x183c61(0x114)+_0x967d2d+'\x20saved\x20to\x20userTokens\x20collection\x20(not\x20equipped)');}catch(_0x238e06){console['warn']('Token\x20collection\x20update\x20had\x20an\x20issue,\x20but\x20purchase\x20completed:',_0x238e06),_0x238e06['code']===_0x183c61(0x13c)?console['log']('üîß\x20Token\x20permissions\x20issue\x20detected,\x20but\x20purchase\x20was\x20successful'):console['error'](_0x183c61(0xf1),_0x238e06);}try{await addDoc(collection(db,_0x183c61(0x103)),{'userId':_0x1c124f['uid'],'userEmail':_0x1c124f['email'],'itemId':_0x264395+'_'+_0x967d2d,'itemTitle':_0x2c3110['name'],'price':_0x2c3110['price'],'type':'purchase','category':_0x264395,'timestamp':serverTimestamp()});}catch(_0x5283c3){console['warn']('Transaction\x20logging\x20failed,\x20but\x20purchase\x20was\x20successful:',_0x5283c3);}return userData['points']=_0x1f12ea,userData[_0x183c61(0x145)]=_0x150a6c,pointsDisplay&&(pointsDisplay['textContent']=userData[_0x183c61(0x10c)]['toLocaleString']()),updateTokenButtons(),_0x264395===_0x183c61(0x162)&&updateThemeButtons(),console['log']('‚úÖ\x20Purchased\x20'+_0x2c3110['name']+'\x20for\x20'+_0x2c3110['price']+'\x20points'),showMessage('Successfully\x20purchased\x20'+_0x2c3110['name']+'!\x20Use\x20the\x20\x22Equip\x22\x20button\x20to\x20show\x20it\x20on\x20the\x20ladder.',_0x183c61(0x139)),!![];}catch(_0x534912){console['error']('Purchase\x20processing\x20error:',_0x534912);if(_0x534912['code']==='permission-denied')showMessage('Permission\x20denied.\x20Please\x20try\x20again\x20or\x20contact\x20support.','error');else{if(_0x534912['code']==='unavailable')showMessage('Service\x20temporarily\x20unavailable.\x20Please\x20try\x20again.','error');else _0x534912['code']==='unauthenticated'?showMessage('Please\x20sign\x20in\x20again\x20to\x20complete\x20purchase.',_0x183c61(0x179)):showMessage('Purchase\x20failed.\x20Please\x20try\x20again.','error');}return![];}}async function equipToken(_0x56066f){const _0x46eb4e=a50_0x47828c,_0x65b8d=auth['currentUser'];if(!_0x65b8d)return showMessage('Please\x20sign\x20in\x20to\x20equip\x20tokens','error'),![];const _0x30c4cd=TOKENS[_0x56066f];if(!_0x30c4cd)return console['error']('Token\x20'+_0x56066f+'\x20not\x20found'),![];if(!userOwnsToken(_0x56066f))return showMessage('You\x20must\x20own\x20this\x20token\x20to\x20equip\x20it',_0x46eb4e(0x179)),![];try{const _0x1034b3=doc(db,'userProfiles',_0x65b8d[_0x46eb4e(0xf3)]);await updateDoc(_0x1034b3,{'equippedToken':_0x56066f,'lastTokenEquip':serverTimestamp()});try{const _0x237ebb=doc(db,'userTokens',_0x65b8d[_0x46eb4e(0xf3)]),_0x362e30=await getDoc(_0x237ebb);if(_0x362e30['exists']()){const _0x22152a=_0x362e30['data'](),_0x4311ac=_0x22152a[_0x46eb4e(0x14d)]||[],_0x278bb6=_0x4311ac['map'](_0x167228=>({..._0x167228,'equipped':_0x167228[_0x46eb4e(0x102)]===_0x56066f}));await updateDoc(_0x237ebb,{'tokens':_0x278bb6,'equippedToken':_0x56066f,'lastUpdated':serverTimestamp()});}}catch(_0x38ac16){console[_0x46eb4e(0xf5)](_0x46eb4e(0x140),_0x38ac16);}return userData['equippedToken']=_0x56066f,typeof clearTokenCache==='function'&&(clearTokenCache(_0x65b8d['uid']),clearTokenCache()),setTimeout(()=>{const _0x289e82=_0x46eb4e;window[_0x289e82(0xfb)]&&typeof window['displayLadder']===_0x289e82(0x150)&&(console[_0x289e82(0x16b)]('üîÑ\x20Refreshing\x20ladder\x20to\x20show\x20equipped\x20token'),window[_0x289e82(0xfb)](!![])),window['RedeemStore']&&typeof window['RedeemStore']['refreshUI']==='function'&&window[_0x289e82(0x16a)]['refreshUI']();},0x1f4),console[_0x46eb4e(0x16b)]('‚úÖ\x20Equipped\x20token:\x20'+_0x30c4cd['name']),showMessage(_0x30c4cd['name']+'\x20equipped!\x20Ladder\x20will\x20refresh\x20shortly.','success'),!![];}catch(_0x547a96){return console[_0x46eb4e(0x179)]('Token\x20equip\x20failed:',_0x547a96),_0x547a96['code']==='permission-denied'?showMessage('Permission\x20denied.\x20Token\x20may\x20still\x20be\x20equipped\x20-\x20check\x20the\x20ladder.','warning'):showMessage('Failed\x20to\x20equip\x20token:\x20'+_0x547a96['message'],_0x46eb4e(0x179)),![];}}async function unequipToken(){const _0xc9c8bc=a50_0x47828c,_0x47e7e6=auth['currentUser'];if(!_0x47e7e6)return showMessage(_0xc9c8bc(0x14f),'error'),![];if(!userData['equippedToken'])return showMessage('No\x20token\x20is\x20currently\x20equipped','info'),![];try{const _0x41246a=doc(db,_0xc9c8bc(0x156),_0x47e7e6[_0xc9c8bc(0xf3)]);await updateDoc(_0x41246a,{'equippedToken':null,'lastTokenEquip':serverTimestamp()});const _0xd6bde9=doc(db,'userTokens',_0x47e7e6['uid']),_0x5ba652=await getDoc(_0xd6bde9);if(_0x5ba652['exists']()){const _0x45b719=_0x5ba652['data'](),_0x87df8d=_0x45b719['tokens']||[],_0x5893a3=_0x87df8d['map'](_0x408104=>({..._0x408104,'equipped':![]}));await updateDoc(_0xd6bde9,{'tokens':_0x5893a3,'equippedToken':null,'lastUpdated':serverTimestamp()});}return userData['equippedToken']=null,typeof clearTokenCache==='function'&&(clearTokenCache(_0x47e7e6['uid']),clearTokenCache()),setTimeout(()=>{const _0x2be691=_0xc9c8bc;window['displayLadder']&&typeof window['displayLadder']==='function'&&(console['log']('üîÑ\x20Refreshing\x20ladder\x20to\x20remove\x20unequipped\x20token'),window['displayLadder'](!![])),window['RedeemStore']&&typeof window[_0x2be691(0x16a)]['refreshUI']==='function'&&window[_0x2be691(0x16a)][_0x2be691(0x149)]();},0x1f4),console['log'](_0xc9c8bc(0x153)),showMessage('Token\x20unequipped!\x20Ladder\x20will\x20refresh\x20shortly.',_0xc9c8bc(0x139)),!![];}catch(_0x528365){return console['error'](_0xc9c8bc(0x11e),_0x528365),showMessage(_0xc9c8bc(0x160)+_0x528365[_0xc9c8bc(0x118)],_0xc9c8bc(0x179)),![];}}async function sellToken(_0x1046a8){const _0x51388f=a50_0x47828c,_0x3d1ac2=auth[_0x51388f(0x134)];if(!_0x3d1ac2)return showMessage(_0x51388f(0x16f),'error'),![];if(!userData['isAdmin'])return showMessage('Only\x20admins\x20can\x20sell\x20tokens',_0x51388f(0x179)),![];const _0x3e8a09=TOKENS[_0x1046a8];if(!_0x3e8a09)return console[_0x51388f(0x179)]('Token\x20'+_0x1046a8+'\x20not\x20found'),![];if(!userOwnsToken(_0x1046a8))return showMessage('You\x20don\x27t\x20own\x20this\x20token',_0x51388f(0x179)),![];try{const _0x299f1e=doc(db,_0x51388f(0x156),_0x3d1ac2[_0x51388f(0xf3)]),_0x33e891=await getDoc(_0x299f1e),_0x54076a=_0x33e891[_0x51388f(0x127)](),_0x4633d5=Math['floor'](_0x3e8a09[_0x51388f(0x110)]*0.5),_0x42b579=(_0x54076a['points']||0x0)+_0x4633d5,_0x11b8c4=(_0x54076a[_0x51388f(0x145)]||[])[_0x51388f(0x175)](_0x1ccc6c=>_0x1ccc6c!=='token_'+_0x1046a8),_0x5a2fcb=_0x54076a['equippedToken']===_0x1046a8?null:_0x54076a['equippedToken'];await updateDoc(_0x299f1e,{'points':_0x42b579,'inventory':_0x11b8c4,'equippedToken':_0x5a2fcb,'lastSale':serverTimestamp()});const _0x3025b5=doc(db,'userTokens',_0x3d1ac2['uid']),_0x58899c=await getDoc(_0x3025b5);if(_0x58899c['exists']()){const _0x41cbe1=_0x58899c[_0x51388f(0x127)](),_0x17ebdc=_0x41cbe1['tokens']||[],_0x48237f=_0x17ebdc['filter'](_0x51ca9e=>_0x51ca9e[_0x51388f(0x102)]!==_0x1046a8);await updateDoc(_0x3025b5,{'tokens':_0x48237f,'equippedToken':_0x5a2fcb,'lastUpdated':serverTimestamp()});}return await addDoc(collection(db,'transactions'),{'userId':_0x3d1ac2['uid'],'userEmail':_0x3d1ac2['email'],'itemId':'token_'+_0x1046a8,'itemTitle':_0x3e8a09['name'],'refund':_0x4633d5,'originalPrice':_0x3e8a09['price'],'type':'sale','category':'token','timestamp':serverTimestamp()}),userData['points']=_0x42b579,userData['inventory']=_0x11b8c4,userData['equippedToken']=_0x5a2fcb,pointsDisplay&&(pointsDisplay['textContent']=userData['points']['toLocaleString']()),typeof clearTokenCache==='function'&&clearTokenCache(_0x3d1ac2['uid']),console['log'](_0x51388f(0x120)+_0x3e8a09['name']+'\x20for\x20'+_0x4633d5+_0x51388f(0x12a)),showMessage('Sold\x20'+_0x3e8a09['name']+'\x20for\x20'+_0x4633d5+_0x51388f(0x14a),'success'),!![];}catch(_0xc7cc37){return console[_0x51388f(0x179)]('Token\x20sale\x20failed:',_0xc7cc37),showMessage(_0x51388f(0x13b)+_0xc7cc37['message'],_0x51388f(0x179)),![];}}function applyTheme(_0x4a8a78){const _0x51f82d=a50_0x47828c;if(!userOwnsTheme(_0x4a8a78))return showMessage('You\x20must\x20purchase\x20this\x20theme\x20first','error'),![];return window[_0x51f82d(0x133)]?(window['ThemeSystem']['switchTheme'](_0x4a8a78),showMessage((THEMES[_0x4a8a78]?.['name']||_0x4a8a78)+_0x51f82d(0x13d),'success'),!![]):(console[_0x51f82d(0x179)]('Theme\x20system\x20not\x20found'),![]);}function buildStoreUI(){buildThemeItems(),buildTokenItems();}function buildThemeItems(){const _0x55bdbd=a50_0x47828c,_0x215054=document[_0x55bdbd(0xfd)]('.themes-grid');if(!_0x215054){console[_0x55bdbd(0x179)](_0x55bdbd(0x104));return;}_0x215054['innerHTML']='',Object[_0x55bdbd(0x131)](THEMES)['forEach'](([_0xedbd4c,_0x1dc1ac])=>{const _0x49442f=_0x55bdbd,_0x3ee238=document[_0x49442f(0x132)]('div');_0x3ee238['className']='store-item',_0x3ee238['dataset']['theme']=_0xedbd4c,_0x3ee238['dataset'][_0x49442f(0x11b)]='theme_'+_0xedbd4c,_0x3ee238['dataset']['price']=_0x1dc1ac['price'],_0x3ee238['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22item-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22item-icon\x20theme-icon-'+_0xedbd4c+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-palette\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22item-price\x22>'+(_0x1dc1ac['price']===0x0?'FREE':_0x1dc1ac['price']+_0x49442f(0xfc))+_0x49442f(0x12d)+_0x1dc1ac['name']+'</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22item-description\x22>'+_0x1dc1ac[_0x49442f(0x152)]+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22theme-select-btn\x20purchase-btn\x22>Select\x20Theme</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x215054[_0x49442f(0x15d)](_0x3ee238);}),setupThemeButtons();}function buildTokenItems(){const _0x3d0115=a50_0x47828c,_0xdf04ac=document[_0x3d0115(0xfd)]('.tokens-grid');if(!_0xdf04ac){console['error'](_0x3d0115(0x122));return;}_0xdf04ac['innerHTML']='',Object[_0x3d0115(0x131)](TOKENS)['forEach'](([_0x401692,_0x388c29])=>{const _0x5b55eb=_0x3d0115,_0x320689=document['createElement']('div');_0x320689['className']='store-item\x20token-item',_0x320689['dataset'][_0x5b55eb(0x16d)]=_0x401692,_0x320689['dataset'][_0x5b55eb(0x11b)]=_0x5b55eb(0x143)+_0x401692,_0x320689['dataset'][_0x5b55eb(0x110)]=_0x388c29[_0x5b55eb(0x110)];const _0x3836c7=userData['isAdmin']&&userOwnsToken(_0x401692)?'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22token-sell-btn\x20admin-btn\x22\x20style=\x22margin-top:\x200.5rem;\x20background:\x20#f44336;\x20font-size:\x200.8rem;\x20padding:\x200.3rem;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Sell\x20('+Math[_0x5b55eb(0xf6)](_0x388c29['price']*0.5)+'\x20pts)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20':'';_0x320689['innerHTML']=_0x5b55eb(0x142)+_0x388c29['image']+'\x22\x20alt=\x22'+_0x388c29[_0x5b55eb(0x16c)]+'\x22\x20class=\x22token-preview\x22\x20onerror=\x22this.style.display=\x27none\x27;\x20this.nextElementSibling.style.display=\x27flex\x27;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22token-fallback\x22\x20style=\x22display:\x20none;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-coins\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22item-price\x22>'+_0x388c29['price']+'\x20Points</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22token-select-btn\x20purchase-btn\x22>Purchase</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22token-equip-btn\x20equip-btn\x22\x20style=\x22margin-top:\x200.5rem;\x20display:\x20none;\x22>Equip</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x3836c7+_0x5b55eb(0x15e),_0xdf04ac[_0x5b55eb(0x15d)](_0x320689);}),setupTokenButtons();}function setupThemeButtons(){const _0x362142=document['querySelectorAll']('.theme-select-btn');_0x362142['forEach'](_0xb54760=>{_0xb54760['addEventListener']('click',async _0x4fab00=>{const _0x9cedbd=a50_0xd0c7;_0x4fab00['preventDefault']();const _0x1c1321=auth[_0x9cedbd(0x134)];if(!_0x1c1321){showMessage('Please\x20sign\x20in\x20to\x20select\x20themes',_0x9cedbd(0x179));return;}const _0x26d9ad=_0xb54760['closest']('[data-theme]'),_0xdcce5d=_0x26d9ad['dataset']['theme'],_0x4775fb=THEMES[_0xdcce5d];if(!_0x4775fb){console['error'](_0x9cedbd(0x117)+_0xdcce5d+'\x20not\x20found');return;}console['log'](_0x9cedbd(0x15c)+_0x4775fb['name']+'\x20('+_0xdcce5d+')');if(_0xb54760['disabled']){_0x4775fb['price']>0x0&&showMessage('You\x20need\x20'+_0x4775fb['price']+_0x9cedbd(0x14e),'error');return;}if(_0xb54760[_0x9cedbd(0x106)]==='Current\x20Theme'){showMessage(_0x4775fb['name']+'\x20is\x20already\x20your\x20current\x20theme','info');return;}if(_0xb54760[_0x9cedbd(0x106)]==='Apply\x20Theme'){applyTheme(_0xdcce5d),updateThemeButtons();return;}if(_0xb54760[_0x9cedbd(0x106)]['includes']('Buy')){const _0x386a98=window['confirm']('Purchase\x20'+_0x4775fb['name']+'\x20theme\x20for\x20'+_0x4775fb['price']+'\x20points?');if(!_0x386a98)return;const _0x26758b=await purchaseTheme(_0xdcce5d);_0x26758b&&(showMessage(_0x4775fb[_0x9cedbd(0x16c)]+_0x9cedbd(0x158),'success'),applyTheme(_0xdcce5d),updateThemeButtons());return;}userOwnsTheme(_0xdcce5d)?applyTheme(_0xdcce5d):showMessage('You\x20must\x20purchase\x20this\x20theme\x20first',_0x9cedbd(0x179));});}),updateThemeButtons();}function setupTokenButtons(){const _0x56ab7a=a50_0x47828c,_0x55171c=document['querySelectorAll']('.token-select-btn'),_0x492ec7=document['querySelectorAll']('.token-equip-btn'),_0x35fe4d=document['querySelectorAll']('.token-sell-btn');_0x55171c['forEach'](_0x36890b=>{const _0x1e0145=a50_0xd0c7;_0x36890b[_0x1e0145(0x146)]('click',async _0x2f43ba=>{const _0x456578=_0x1e0145;_0x2f43ba[_0x456578(0x10e)]();const _0x133c24=auth['currentUser'];if(!_0x133c24){showMessage(_0x456578(0x121),_0x456578(0x179));return;}const _0x19dadd=_0x36890b['closest'](_0x456578(0x174)),_0x2c97d3=_0x19dadd['dataset']['token'],_0x39230b=TOKENS[_0x2c97d3];if(!_0x39230b){console[_0x456578(0x179)](_0x456578(0x13e)+_0x2c97d3+'\x20not\x20found');return;}console[_0x456578(0x16b)]('Token\x20clicked:\x20'+_0x39230b['name']+'\x20('+_0x2c97d3+')');if(_0x36890b[_0x456578(0x164)]){showMessage(_0x456578(0x178)+_0x39230b['price']+'\x20points\x20to\x20purchase\x20this\x20token','error');return;}if(_0x36890b['textContent']==='Owned'){showMessage('You\x20already\x20own\x20the\x20'+_0x39230b['name']+_0x456578(0xf9),'info');return;}if(_0x36890b['textContent']['includes'](_0x456578(0x11f))||_0x36890b[_0x456578(0x106)]['includes'](_0x456578(0x111))){const _0x5394dc=window['confirm']('Purchase\x20'+_0x39230b['name']+'\x20token\x20for\x20'+_0x39230b['price']+'\x20points?');if(!_0x5394dc)return;const _0x2fe9de=await purchaseToken(_0x2c97d3);_0x2fe9de&&updateTokenButtons();return;}});}),_0x492ec7['forEach'](_0x1564b7=>{const _0x2bca6b=a50_0xd0c7;_0x1564b7[_0x2bca6b(0x146)](_0x2bca6b(0x108),async _0x3cdd06=>{const _0x23d728=_0x2bca6b;_0x3cdd06['preventDefault']();const _0x23d96b=_0x1564b7['closest'](_0x23d728(0x174)),_0x437d48=_0x23d96b[_0x23d728(0x167)]['token'],_0x39f526=TOKENS[_0x437d48];if(_0x1564b7['textContent']==='Equipped'){const _0xa8e3f9=window['confirm']('Unequip\x20'+_0x39f526['name']+'?');if(!_0xa8e3f9)return;const _0x44ee4a=await unequipToken();_0x44ee4a&&updateTokenButtons();}else{const _0x48b362=window[_0x23d728(0x100)]('Equip\x20'+_0x39f526['name']+'?\x20This\x20will\x20unequip\x20your\x20current\x20token.');if(!_0x48b362)return;const _0x3bc2a7=await equipToken(_0x437d48);_0x3bc2a7&&updateTokenButtons();}});}),_0x35fe4d[_0x56ab7a(0x155)](_0x5a0c89=>{const _0x2521ed=_0x56ab7a;_0x5a0c89[_0x2521ed(0x146)]('click',async _0x5036fb=>{const _0x392b35=_0x2521ed;_0x5036fb['preventDefault']();const _0x13f29c=_0x5a0c89['closest']('[data-token]'),_0x3d3ea9=_0x13f29c['dataset']['token'],_0x34865e=TOKENS[_0x3d3ea9],_0x220ff5=Math['floor'](_0x34865e['price']*0.5),_0x513c00=window['confirm']('Are\x20you\x20sure\x20you\x20want\x20to\x20sell\x20'+_0x34865e[_0x392b35(0x16c)]+'\x20for\x20'+_0x220ff5+'\x20points?\x20This\x20cannot\x20be\x20undone.');if(!_0x513c00)return;const _0x545c0b=await sellToken(_0x3d3ea9);_0x545c0b&&updateTokenButtons();});}),updateTokenButtons();}function updateThemeButtons(){const _0x157f76=window['ThemeSystem']?window['ThemeSystem']['getCurrentTheme']():'default',_0x2bceb4=auth['currentUser'];document['querySelectorAll']('.theme-select-btn')['forEach'](_0x5d9959=>{const _0xd34795=a50_0xd0c7,_0x12ba88=_0x5d9959[_0xd34795(0x12c)]('[data-theme]'),_0x2d17d0=_0x12ba88['dataset']['theme'],_0x2768c5=THEMES[_0x2d17d0];if(!_0x2768c5)return;_0x5d9959['disabled']=![],_0x5d9959['style']['opacity']='',_0x5d9959['style']['cursor']='pointer',_0x5d9959['classList'][_0xd34795(0x119)](_0xd34795(0x15b),'apply-theme','can-afford',_0xd34795(0x10f),'sign-in-free',_0xd34795(0x157));if(!_0x2bceb4){_0x2768c5['price']===0x0?(_0x5d9959[_0xd34795(0x106)]='Sign\x20in\x20to\x20Apply',_0x5d9959['classList']['add']('sign-in-free')):(_0x5d9959[_0xd34795(0x106)]='Sign\x20in\x20to\x20Purchase',_0x5d9959[_0xd34795(0x164)]=!![],_0x5d9959['style']['opacity']=_0xd34795(0x10a),_0x5d9959['classList'][_0xd34795(0xfe)]('sign-in-paid'));return;}if(_0x2d17d0===_0x157f76){_0x5d9959['textContent']='Current\x20Theme',_0x5d9959[_0xd34795(0x125)][_0xd34795(0xfe)](_0xd34795(0x15b)),_0x5d9959[_0xd34795(0x164)]=!![],_0x5d9959['style']['cursor']='default';return;}if(userOwnsTheme(_0x2d17d0)){_0x5d9959['textContent']=_0xd34795(0x154),_0x5d9959['classList']['add'](_0xd34795(0x13f));return;}if(userData['points']>=_0x2768c5['price']){_0x5d9959['textContent']='Buy\x20for\x20'+_0x2768c5['price']+'\x20Points',_0x5d9959[_0xd34795(0x125)]['add']('can-afford');return;}_0x5d9959[_0xd34795(0x106)]='Need\x20'+_0x2768c5['price']+_0xd34795(0xfc),_0x5d9959['classList']['add']('cannot-afford'),_0x5d9959['style'][_0xd34795(0x169)]=_0xd34795(0x137),_0x5d9959[_0xd34795(0x164)]=!![],_0x5d9959['style']['cursor']='not-allowed';});}function updateTokenButtons(){const _0x299d28=a50_0x47828c,_0xf4ad23=auth['currentUser'];document[_0x299d28(0x161)]('.token-select-btn')['forEach'](_0x2f41fc=>{const _0x233e1f=_0x299d28,_0x32805c=_0x2f41fc['closest']('[data-token]'),_0x15d66a=_0x32805c['dataset']['token'],_0x1c503c=TOKENS[_0x15d66a],_0x45a5bb=_0x32805c['querySelector'](_0x233e1f(0x124)),_0x27983e=_0x32805c['querySelector']('.token-sell-btn');if(!_0x1c503c)return;_0x2f41fc[_0x233e1f(0x164)]=![],_0x2f41fc['style']['opacity']='',_0x2f41fc['style'][_0x233e1f(0x109)]='pointer';_0x45a5bb&&(_0x45a5bb['style']['display']='none',_0x45a5bb['disabled']=![],_0x45a5bb['style']['opacity']='',_0x45a5bb['classList']['remove'](_0x233e1f(0x128),'can-equip'));_0x27983e&&(_0x27983e[_0x233e1f(0x166)][_0x233e1f(0x176)]='none');_0x2f41fc['classList']['remove'](_0x233e1f(0x101),'can-afford','cannot-afford','sign-in');if(!_0xf4ad23){_0x2f41fc[_0x233e1f(0x106)]=_0x233e1f(0x129),_0x2f41fc[_0x233e1f(0x164)]=!![],_0x2f41fc[_0x233e1f(0x166)]['opacity']='0.7',_0x2f41fc['classList']['add']('sign-in');return;}if(userOwnsToken(_0x15d66a)){_0x2f41fc['textContent']='Owned',_0x2f41fc[_0x233e1f(0x125)][_0x233e1f(0xfe)]('owned'),_0x2f41fc['disabled']=!![],_0x2f41fc['style']['cursor']='default',_0x2f41fc['style'][_0x233e1f(0xfa)]='var(--success-color,\x20#4CAF50)';_0x45a5bb&&(_0x45a5bb['style']['display']='block',userHasTokenEquipped(_0x15d66a)?(_0x45a5bb['textContent']=_0x233e1f(0x168),_0x45a5bb['classList']['add'](_0x233e1f(0x128)),_0x45a5bb['style']['background']='var(--accent-color,\x20#2196F3)',_0x45a5bb['style']['cursor']='pointer'):(_0x45a5bb[_0x233e1f(0x106)]='Equip',_0x45a5bb['classList']['add']('can-equip'),_0x45a5bb['style']['background']='var(--info-color,\x20#17a2b8)',_0x45a5bb[_0x233e1f(0x166)]['cursor']='pointer'));_0x27983e&&userData[_0x233e1f(0x136)]&&(_0x27983e['style'][_0x233e1f(0x176)]='block');return;}if(userData['points']>=_0x1c503c[_0x233e1f(0x110)]){_0x2f41fc['textContent']='Buy\x20for\x20'+_0x1c503c[_0x233e1f(0x110)]+'\x20Points',_0x2f41fc['classList']['add']('can-afford'),_0x2f41fc[_0x233e1f(0x166)][_0x233e1f(0xfa)]='';return;}_0x2f41fc['textContent']=_0x233e1f(0x171)+_0x1c503c['price']+'\x20Points',_0x2f41fc['classList']['add'](_0x233e1f(0x10f)),_0x2f41fc['style']['opacity']='0.5',_0x2f41fc['disabled']=!![],_0x2f41fc['style']['cursor']='not-allowed',_0x2f41fc['style'][_0x233e1f(0xfa)]='var(--muted-color,\x20#757575)';});}function showMessage(_0x3cc6cc,_0x34aeca='info'){const _0x572703=a50_0x47828c,_0x29ca1a=document['getElementById'](_0x572703(0x12f));_0x29ca1a&&_0x29ca1a['remove']();const _0x56d024=document[_0x572703(0x132)]('div');_0x56d024['id']=_0x572703(0x12f),_0x56d024['className']='store-message\x20store-message-'+_0x34aeca,_0x56d024['textContent']=_0x3cc6cc,document['body']['appendChild'](_0x56d024),requestAnimationFrame(()=>{_0x56d024['classList']['add']('visible');}),setTimeout(()=>{const _0x2f725f=_0x572703;_0x56d024[_0x2f725f(0x125)][_0x2f725f(0x119)]('visible'),setTimeout(()=>{const _0x3fe9bc=_0x2f725f;_0x56d024[_0x3fe9bc(0x163)]&&_0x56d024['remove']();},0x12c);},0xfa0);}window[a50_0x47828c(0x16a)]={'refreshUI':()=>{updateThemeButtons(),updateTokenButtons();},'checkOwnership':userOwnsTheme,'checkTokenOwnership':userOwnsToken,'applyTheme':applyTheme,'purchaseTheme':purchaseTheme,'purchaseToken':purchaseToken},console['log']('üè™\x20Redeem\x20store\x20loaded');
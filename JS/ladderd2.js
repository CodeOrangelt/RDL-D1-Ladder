(function(a,b){const t=a32d,c=a();while(!![]){try{const d=-parseInt(t(0xfa))/0x1*(-parseInt(t(0x136))/0x2)+-parseInt(t(0x134))/0x3*(parseInt(t(0x137))/0x4)+parseInt(t(0x122))/0x5*(parseInt(t(0xff))/0x6)+parseInt(t(0xfd))/0x7*(parseInt(t(0x135))/0x8)+parseInt(t(0xf6))/0x9*(-parseInt(t(0x119))/0xa)+-parseInt(t(0x139))/0xb+-parseInt(t(0x121))/0xc*(-parseInt(t(0x10b))/0xd);if(d===b)break;else c['push'](c['shift']());}catch(e){c['push'](c['shift']());}}}(a32c,0x6f74e));const a32b=(function(){let a=!![];return function(b,c){const d=a?function(){if(c){const e=c['apply'](b,arguments);return c=null,e;}}:function(){};return a=![],d;};}()),a32a=a32b(this,function(){const v=a32d,a=function(){const u=a32d;let f;try{f=Function('return\x20(function()\x20'+u(0x10c)+');')();}catch(g){f=window;}return f;},b=a(),c=b['console']=b['console']||{},d=[v(0x128),v(0xf3),v(0xfe),v(0x13c),'exception','table',v(0xf1)];for(let e=0x0;e<d[v(0xf7)];e++){const f=a32b['constructor'][v(0xfb)][v(0x115)](a32b),g=d[e],h=c[g]||f;f[v(0x103)]=a32b['bind'](a32b),f['toString']=h['toString']['bind'](h),c[g]=f;}});a32a();import{collection,getDocs,deleteDoc,doc,getDoc,query,where,updateDoc,Timestamp,onSnapshot,orderBy,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import{getRankStyle}from'./ranks.js';import a32e from'./firebase-idle-wrapper.js';const playerCacheD2={'data':null,'timestamp':0x0},CACHE_DURATION=0x7530;async function displayLadderD2(a=![]){const w=a32d,b=document['querySelector'](w(0xeb));if(!b){console[w(0x13c)]('D2\x20Ladder\x20table\x20body\x20not\x20found');return;}b['innerHTML']='<tr><td\x20colspan=\x228\x22\x20class=\x22loading-cell\x22>Loading\x20D2\x20ladder\x20data...</td></tr>';try{const c=Date['now']();if(!a&&playerCacheD2['data']&&c-playerCacheD2['timestamp']<CACHE_DURATION){updateLadderDisplayD2(playerCacheD2['data']);return;}const d=collection(db,'playersD2'),e=query(d,orderBy(w(0x104),'asc')),f=await a32e['getDocuments'](d),g=[];f[w(0xef)](m=>{const x=w,n=m[x(0x118)]();n[x(0x124)]&&g[x(0x12b)]({...n,'id':m['id'],'elo':n[x(0x102)]||0x0,'position':n['position']||Number['MAX_SAFE_INTEGER']});});const h=collection(db,'userProfiles'),i=await getDocs(h),j=new Map();i[w(0xef)](m=>{const y=w,n=m[y(0x118)]();n['username']&&j['set'](n['username'][y(0x13a)](),n);});for(const m of g){const n=m[w(0x124)]['toLowerCase']();if(j[w(0x140)](n)){const o=j['get'](n);o[w(0x10e)]&&(m['country']=o[w(0x10e)]['toLowerCase']());}}const k=g['map'](q=>q['username']),l=await fetchBatchMatchStatsD2(k);g['sort']((p,q)=>{const z=w,r=l['get'](p[z(0x124)])?.['totalMatches']||0x0,s=l['get'](q['username'])?.['totalMatches']||0x0;if(r===0x0!==(s===0x0))return r===0x0?0x1:-0x1;return(p['position']||0x3e7)-(q[z(0x104)]||0x3e7);}),g['forEach']((p,q)=>{const A=w;p[A(0x104)]=q+0x1;}),playerCacheD2['data']=g,playerCacheD2['timestamp']=c,updateLadderDisplayD2(g);}catch(p){console[w(0x13c)]('Error\x20loading\x20D2\x20ladder:',p),b[w(0x132)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20colspan=\x228\x22\x20style=\x22text-align:\x20center;\x20color:\x20red;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Error\x20loading\x20D2\x20ladder\x20data:\x20'+p['message']+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';}}function getNextAvailablePositionD2(a){const B=a32d;if(a[B(0xf7)]===0x0)return 0x1;let b=0x0;return a['forEach'](c=>{const C=B;c[C(0x104)]&&typeof c['position']===C(0x13d)&&c['position']>b&&(b=c['position']);}),b+0x1;}async function updatePlayerPositions(a,b){const D=a32d;try{const c=collection(db,'playersD2'),d=await getDocs(c),e=[];d[D(0xef)](h=>{e['push']({'id':h['id'],...h['data']()});});const f=e[D(0x12c)](h=>h[D(0x124)]===a),g=e['find'](h=>h[D(0x124)]===b);if(!f||!g){console[D(0x13c)](D(0xf2));return;}if(f['position']>g[D(0x104)]){const h=g['position'];for(const i of e){i['position']>=g[D(0x104)]&&i[D(0x104)]<f['position']&&i[D(0x124)]!==a&&await updateDoc(doc(db,'playersD2',i['id']),{'position':i['position']+0x1});}await updateDoc(doc(db,D(0x142),f['id']),{'position':h});if(h===0x1){const j=doc(db,'playersD2',f['id']),k=await getDoc(j);!k['data']()[D(0x12f)]&&await updateDoc(j,{'firstPlaceDate':Timestamp[D(0x127)]()});}if(g['position']===0x1){const l=doc(db,'playersD2',g['id']);await updateDoc(l,{'firstPlaceDate':null});}playerCacheD2['timestamp']=0x0;}}catch(m){console[D(0x13c)](D(0xf9),m);}}function calculateStreakDays(a){const E=a32d;if(!a)return 0x0;const b=a['toDate'](),c=new Date(),d=Math[E(0x100)](c-b);return Math[E(0x105)](d/(0x3e8*0x3c*0x3c*0x18));}function getPlayerRankNameD2(a){const F=a32d;if(a>=0x834)return'Emerald';if(a>=0x708)return F(0x129);if(a>=0x640)return'Silver';if(a>=0x578)return'Bronze';return F(0xee);}function a32d(a,b){const c=a32c();return a32d=function(d,e){d=d-0xea;let f=c[d];if(a32d['KlqcSf']===undefined){var g=function(l){const m='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let n='',o='';for(let p=0x0,q,r,s=0x0;r=l['charAt'](s++);~r&&(q=p%0x4?q*0x40+r:r,p++%0x4)?n+=String['fromCharCode'](0xff&q>>(-0x2*p&0x6)):0x0){r=m['indexOf'](r);}for(let t=0x0,u=n['length'];t<u;t++){o+='%'+('00'+n['charCodeAt'](t)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(o);};a32d['ptwLoR']=g,a=arguments,a32d['KlqcSf']=!![];}const h=c[0x0],i=d+h,j=a[i];return!j?(f=a32d['ptwLoR'](f),a[i]=f):f=j,f;},a32d(a,b);}async function updateLadderDisplayD2(a){const G=a32d;a['sort']((g,h)=>g[G(0x104)]-h[G(0x104)]);const b=document[G(0x110)](G(0xeb));if(!b)return;b['innerHTML']='';const c=a['map'](g=>g[G(0x124)]),d=await fetchBatchMatchStatsD2(c),e=document['querySelector'](G(0x111));e&&(e['innerHTML']=G(0x112));const f=a['map'](g=>{const h=d['get'](g['username'])||{'totalMatches':0x0,'wins':0x0,'losses':0x0,'kda':0x0,'winRate':0x0,'totalKills':0x0,'totalDeaths':0x0};return createPlayerRowD2(g,h);})[G(0xec)]('');b[G(0x132)]=f,getPlayersLastEloChangesD2(c)['then'](g=>{const h=new Map();b['querySelectorAll']('tr')['forEach']((i,j)=>{j<c['length']&&h['set'](c[j],i);}),g['forEach']((i,j)=>{const H=a32d,k=h[H(0xf8)](j);if(k&&i!==0x0){const l=k['querySelector']('td:nth-child(3)');if(l){const m=i>0x0?'+'+i:''+i,n=l['querySelector'](H(0x113));n&&(n[H(0x120)]=m,n[H(0x133)][H(0xea)]=i>0x0?'#4CAF50':'#F44336',n['style']['fontWeight']='bold',n['style'][H(0x10d)]=H(0x138),n['style'][H(0x12e)]='inline',n[H(0x133)]['visibility']='visible',n[H(0x133)]['opacity']='1');}}});})[G(0x12a)](g=>console[G(0x13c)]('Error\x20updating\x20D2\x20ELO\x20trend\x20indicators:',g));}function a32c(){const S=['Dg90ywXezwf0Ahm','Dg90ywXlAwXSCW','zgf0yq','mtbOvxvuvM4','Dg9gAxHLza','oYbWB3nPDgLVBJOGCMvSyxrPDMu7iJ4kicaGicaGicaGicaGpgrPDIbJBgfZCZ0IzwXVlwnVBNrHAw5LCIiGC3r5Bgu9iMrPC3bSyxK6igzSzxG7igfSAwDUlwL0zw1ZoIbJzw50zxi7iJ4kicaGicaGicaGicaGicaGidXZCgfUignSyxnZpsjLBg8TDMfSDwuIpG','y2HHBMDL','iZuWqZG3oa','A2rH','z3jHEq','Dgv4DenVBNrLBNq','nZiXmJG1mKLdsg9VDq','odeZodvmrhzUCfm','cIaGicaGicaGicaGicaGica8l2e+cIaGicaGicaGicaGicaGica','DxnLCM5HBwu','z2fTzu1Vzgu','jMXHzgrLCJ1KmIiGcIaGicaGicaGicaGicaGicaGicbZDhLSzt0Iy29SB3i6ia','BM93','Bg9N','r29Sza','y2f0y2G','ChvZAa','zMLUza','D2LUuMf0zq','zgLZCgXHEq','zMLYC3rqBgfJzurHDgu','zMfSBgjHy2SGzw50CMLLCW','Bwf0y2Hjza','Aw5Uzxjive1m','C3r5Bgu','odG0n2PlA2X1Dq','nda3mMLnv3rJDq','mKPjv0XkzG','mtu2tKLctKXw','mc44nwvT','mZqYndq4n0fNwMvpAW','Dg9mB3DLCKnHC2u','DgLTzxn0yw1W','zxjYB3i','BNvTyMvY','ChjLDMLVDxnfBg8','Dg90ywXnyxrJAgvZ','AgfZ','CgXHEwvYvxnLCM5HBwu','CgXHEwvYC0qY','y29SB3i','i2XHzgrLCI1KmIb0yM9KEq','AM9PBG','D2LUBMvYu2nVCMu','vw5Yyw5Rzwq','zM9YrwfJAa','rdi6ievYCM9YigzLDgnOAw5NievmtYbOAxn0B3j5oG','DhjHy2u','q291BgqGBM90igzPBMqGD2LUBMvYig9YigXVC2vYigLUieqYihbSyxLLCNmGBgLZDa','D2fYBG','C2v0','cIaGica8Dhi+cIaGicaGicaGphrKpG','nte5mZmZm01ZuuvcDq','BgvUz3rO','z2v0','rxjYB3iGDxbKyxrPBMCGrdiGCgXHEwvYihbVC2L0Aw9UCZO','mZK5mZHbsLfbBe8','ChjVDg90ExbL','Aw5JBhvKzxm','oti0n3bwBgvRqG','Aw5MBW','ntrcvePkC1a','ywjZ','oYb0zxH0lwrLy29YyxrPB246ig5VBMu7iJ4kicaGicaGicaGicaGicaGicaGica','zwXVuMf0Aw5N','x19WCM90B19F','Cg9ZAxrPB24','y2vPBa','D2LUCW','C29YDa','yxbWCM92zwrnyxrJAgvZrdi','CgXHEwvY','D2LUBMvYvxnLCM5HBwu','mtnlwgH6vKq','E30Uy29UC3rYDwn0B3iOiNjLDhvYBIb0AgLZiIKOicK','zM9UDfnPEMu','y291BNrYEq','BMv3rwXV','CxvLCNLtzwXLy3rVCG','i2XHzgrLCI1KmIb0AgvHzcb0CG','cIaGicaGicaGicaGidX0Ad5syw5Rpc90Ad4kicaGicaGicaGicaGphrOpLvZzxjUyw1Lpc90Ad4kicaGicaGicaGicaGphrOpKvmtZWVDgG+cIaGicaGicaGicaGidX0Ad5nyxrJAgvZpc90Ad4kicaGicaGicaGicaGphrOpLDPBNm8l3rOpGOGicaGicaGicaGica8DgG+tg9ZC2vZpc90Ad4kicaGicaGicaGicaGphrOpKSVrdWVDgG+cIaGicaGicaGicaGidX0Ad5xAw4GuMf0ztWVDgG+cIaGicaGicaG','lNrYzw5KlwLUzgLJyxrVCG','jtWVDgq+cIaGica8l3rYpG','yMLUza'];a32c=function(){return S;};return a32c();}function createPlayerRowD2(a,b){const I=a32d,c=parseFloat(a['elo'])||0x0;let d=I(0x11f);if(c>=0x7d0)d=I(0x11d);else{if(c>=0x708)d='#FFD700';else{if(c>=0x640)d='#C0C0C0';else c>=0x578&&(d='#CD7F32');}}let e='';return a['country']&&(e='<img\x20src=\x22../images/flags/'+a['country'][I(0x13a)]()+'.png\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20alt=\x22'+a[I(0x10e)]+'\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20class=\x22player-flag\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20style=\x22margin-left:\x205px;\x20vertical-align:\x20middle;\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20onerror=\x22this.style.display=\x27none\x27\x22>'),I(0xf5)+a[I(0x104)]+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td\x20style=\x22position:\x20relative;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20position:\x20relative;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username='+encodeURIComponent(a['username'])+I(0x126)+d+I(0x101)+a[I(0x124)]+I(0x123)+e+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td\x20style=\x22color:\x20'+d+I(0x11b)+c+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22trend-indicator\x22\x20style=\x22margin-left:\x205px;\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+b[I(0x13f)]+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+b[I(0x106)]+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+b['losses']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+b[I(0x11e)]+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+b[I(0x12d)]+I(0x114);}async function getPlayersLastEloChangesD2(a){const J=a32d,b=new Map();a['forEach'](c=>b[J(0xf4)](c,0x0));try{const c=collection(db,'eloHistoryD2'),d=query(c,orderBy(J(0x13b),'desc'),limit(0x64)),e=await getDocs(d),f=new Map(),g=await getDocs(collection(db,'playersD2'));g[J(0xef)](i=>{const K=J,j=i['data']();j[K(0x124)]&&f[K(0xf4)](i['id'],j[K(0x124)]);});const h=new Map();e[J(0xef)](i=>{const L=J,j=i[L(0x118)]();let k=j['username']||j['playerUsername'];!k&&j['player']&&f[L(0x140)](j[L(0x109)])&&(k=f['get'](j[L(0x109)]));if(!k&&j[L(0x131)]){}k&&a['includes'](k)&&(!h['has'](k)&&h[L(0xf4)](k,[]),h[L(0xf8)](k)['push']({...j,'timestamp':j['timestamp']?.['seconds']||0x0,'username':k}));}),h['forEach']((i,j)=>{const M=J;if(i['length']>0x0){i[M(0x107)]((l,m)=>m['timestamp']-l['timestamp']);const k=i[M(0x12c)](l=>l[M(0x11c)]!==undefined||l['newElo']!==undefined&&l['previousElo']!==undefined);if(k){let l;if(k[M(0x11c)]!==undefined)l=k[M(0x11c)];else k['newElo']!==undefined&&k[M(0x13e)]!==undefined&&(l=k['newElo']-k['previousElo']);l!==undefined&&b['set'](j,l);}}});if(h['size']===0x0){const i=collection(db,'eloHistory'),j=query(i,where(J(0x125),'==','D2'),orderBy(J(0x13b),'desc'),limit(0x32));try{const k=await getDocs(j);console[J(0x128)]('D2:\x20Found',k['size'],J(0x130)),k[J(0xef)](l=>{const N=J,m=l['data'](),n=m[N(0x124)]||m[N(0x141)];if(n&&a['includes'](n)){const o=m['change']||(m[N(0x10f)]!==undefined&&m['previousElo']!==undefined?m[N(0x10f)]-m['previousElo']:0x0);o!==0x0&&(b[N(0xf4)](n,o),console['log']('D2:\x20'+n+'\x20fallback\x20ELO\x20change:\x20'+o));}});}catch(l){}}}catch(m){console['error'](J(0xf0),m);}return b;}async function fetchBatchMatchStatsD2(a){const P=a32d,b=new Map();try{a['forEach'](e=>{const O=a32d;b[O(0xf4)](e,{'totalMatches':0x0,'wins':0x0,'losses':0x0,'totalKills':0x0,'totalDeaths':0x0,'kda':0x0,'winRate':0x0});});const c=collection(db,P(0x108)),d=await getDocs(c);d[P(0xef)](e=>{const Q=P,f=e[Q(0x118)](),g=f[Q(0x10a)],h=f['loserUsername'];if(a[Q(0xfc)](g)){const i=b['get'](g);i[Q(0x106)]++,i['totalMatches']++,i['totalKills']+=parseInt(f[Q(0xed)])||0x0,i['totalDeaths']+=parseInt(f['loserScore'])||0x0;}if(a[Q(0xfc)](h)){const j=b[Q(0xf8)](h);j['losses']++,j[Q(0x13f)]++,j['totalKills']+=parseInt(f['loserScore'])||0x0,j[Q(0x116)]+=parseInt(f['winnerScore'])||0x0;}}),a['forEach'](e=>{const R=P,f=b[R(0xf8)](e);f[R(0x11e)]=f[R(0x116)]>0x0?(f[R(0x117)]/f[R(0x116)])[R(0x11a)](0x2):f['totalKills']['toFixed'](0x2),f['winRate']=f['totalMatches']>0x0?(f[R(0x106)]/f['totalMatches']*0x64)['toFixed'](0x1):0x0;});}catch(e){console['error']('Error\x20fetching\x20batch\x20D2\x20match\x20stats:',e);}return b;}export{displayLadderD2,updatePlayerPositions};
const a39_0x308d5d=a39_0x4ce5,a39_0x26839c=(function(){let _0x1f68e9=!![];return function(_0x1f83c5,_0x268e2f){const _0x18621a=_0x1f68e9?function(){const _0x3c0b7d=a39_0x4ce5;if(_0x268e2f){const _0x5b3dee=_0x268e2f[_0x3c0b7d(0x77)](_0x1f83c5,arguments);return _0x268e2f=null,_0x5b3dee;}}:function(){};return _0x1f68e9=![],_0x18621a;};}()),a39_0x20c233=a39_0x26839c(this,function(){const _0x24d08e=a39_0x4ce5,_0xc00e44=function(){const _0xed6d5=a39_0x4ce5;let _0x225a1f;try{_0x225a1f=Function(_0xed6d5(0x72)+_0xed6d5(0x69)+');')();}catch(_0x43705a){_0x225a1f=window;}return _0x225a1f;},_0x4eeed4=_0xc00e44(),_0x5812c8=_0x4eeed4[_0x24d08e(0x68)]=_0x4eeed4['console']||{},_0x248509=[_0x24d08e(0x6a),'warn','info','error','exception','table','trace'];for(let _0x3d9463=0x0;_0x3d9463<_0x248509['length'];_0x3d9463++){const _0x845087=a39_0x26839c['constructor'][_0x24d08e(0x75)]['bind'](a39_0x26839c),_0x316dc4=_0x248509[_0x3d9463],_0x24b9e0=_0x5812c8[_0x316dc4]||_0x845087;_0x845087[_0x24d08e(0x67)]=a39_0x26839c[_0x24d08e(0x74)](a39_0x26839c),_0x845087[_0x24d08e(0x66)]=_0x24b9e0['toString']['bind'](_0x24b9e0),_0x5812c8[_0x316dc4]=_0x845087;}});function a39_0x1ab7(){const _0x56887f=['data','toString','__proto__','console','{}.constructor(\x22return\x20this\x22)(\x20)','log','error','unknown','User\x20profile\x20not\x20found\x20for\x20','points','Admin\x20points\x20service\x20connected','\x20points\x20to\x20user\x20','add','return\x20(function()\x20','modifyUserPoints','bind','prototype','\x20points\x20to\x20both\x20players\x20for\x20','apply'];a39_0x1ab7=function(){return _0x56887f;};return a39_0x1ab7();}function a39_0x4ce5(_0x2580ae,_0x25430a){const _0x20c233=a39_0x1ab7();return a39_0x4ce5=function(_0x26839c,_0x3698bb){_0x26839c=_0x26839c-0x65;let _0x1ab78c=_0x20c233[_0x26839c];return _0x1ab78c;},a39_0x4ce5(_0x2580ae,_0x25430a);}a39_0x20c233();import{db}from'./firebase-config.js';import{doc,getDoc,updateDoc,addDoc,collection,serverTimestamp}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const POINTS_CHART={'':0xa,'Standard':0xa,'Fusion\x20Match':0x19,'â‰¥6\x20Missiles':0xa,'Weapon\x20Imbalance':0x1e,'Blind\x20Match':0x4b,'Rematch':0x14,'Disorientation':0x32,'Ratting':0x23,'Altered\x20Powerups':0x23,'Mega\x20Match':0x28,'Dogfight':0x32,'Gauss\x20and\x20Mercs':0x19,'Misc':0x1e};let adminModifyUserPoints=null;try{const adminModule=await import('./adminbackend.js');adminModule[a39_0x308d5d(0x73)]&&(adminModifyUserPoints=adminModule['modifyUserPoints'],console[a39_0x308d5d(0x6a)](a39_0x308d5d(0x6f)));}catch(a39_0x365961){console['log']('Admin\x20backend\x20not\x20available,\x20using\x20fallback\x20points\x20service');}export async function awardMatchPoints(_0x4bbd7a,_0x520cba,_0x5884ab){const _0x299c83=a39_0x308d5d;try{const _0xc56431=POINTS_CHART[_0x5884ab]||0xa;return adminModifyUserPoints?await Promise['all']([adminModifyUserPoints(_0x4bbd7a,'add',_0xc56431,'Match\x20points:\x20'+(_0x5884ab||'Standard')+'\x20match\x20(Winner)'),adminModifyUserPoints(_0x520cba,'add',_0xc56431,'Match\x20points:\x20'+(_0x5884ab||'Standard')+'\x20match\x20(Participant)')]):await Promise['all']([addPointsFallback(_0x4bbd7a,_0xc56431,'Match\x20points:\x20'+(_0x5884ab||'Standard')+'\x20match\x20(Winner)'),addPointsFallback(_0x520cba,_0xc56431,'Match\x20points:\x20'+(_0x5884ab||'Standard')+'\x20match\x20(Participant)')]),console[_0x299c83(0x6a)]('Awarded\x20'+_0xc56431+_0x299c83(0x76)+(_0x5884ab||'Standard')+'\x20match'),!![];}catch(_0x4b0bbe){return console['error']('Error\x20awarding\x20match\x20points:',_0x4b0bbe),![];}}async function addPointsFallback(_0x53299f,_0x4f9245,_0x51e530=''){const _0x2a270b=a39_0x308d5d;try{const _0x2518e4=doc(db,'userProfiles',_0x53299f),_0x19018d=await getDoc(_0x2518e4);if(!_0x19018d['exists']()){console[_0x2a270b(0x6a)](_0x2a270b(0x6d)+_0x53299f+',\x20skipping\x20points\x20award');return;}const _0x47cf72=_0x19018d[_0x2a270b(0x65)](),_0x2ed652=_0x47cf72[_0x2a270b(0x6e)]||0x0,_0x920246=_0x2ed652+_0x4f9245;await updateDoc(_0x2518e4,{'points':_0x920246,'lastPointsModified':serverTimestamp()}),await addDoc(collection(db,'pointsHistory'),{'userId':_0x53299f,'userEmail':_0x47cf72['email']||_0x2a270b(0x6c),'displayName':_0x47cf72['displayName']||_0x47cf72['username']||'Unknown\x20User','action':_0x2a270b(0x71),'amount':_0x4f9245,'previousPoints':_0x2ed652,'newPoints':_0x920246,'reason':_0x51e530,'adminEmail':'system-match-award','timestamp':serverTimestamp()}),console['log']('Added\x20'+_0x4f9245+_0x2a270b(0x70)+_0x53299f+'.\x20New\x20total:\x20'+_0x920246);}catch(_0x33ffbf){console[_0x2a270b(0x6b)]('Error\x20adding\x20points\x20to\x20user:',_0x33ffbf);throw _0x33ffbf;}}
const a38_0x1b1d0d=a38_0x100f,a38_0xafde1c=(function(){let _0x507878=!![];return function(_0x3abc46,_0x289c14){const _0x4590f9=_0x507878?function(){if(_0x289c14){const _0x24e786=_0x289c14['apply'](_0x3abc46,arguments);return _0x289c14=null,_0x24e786;}}:function(){};return _0x507878=![],_0x4590f9;};}()),a38_0x54423a=a38_0xafde1c(this,function(){const _0x27f0f2=a38_0x100f,_0x235825=function(){const _0xab4f3e=a38_0x100f;let _0x40e3eb;try{_0x40e3eb=Function('return\x20(function()\x20'+_0xab4f3e(0x18c)+');')();}catch(_0x715c21){_0x40e3eb=window;}return _0x40e3eb;},_0xf5f25a=_0x235825(),_0x1d6f17=_0xf5f25a[_0x27f0f2(0x194)]=_0xf5f25a[_0x27f0f2(0x194)]||{},_0x489e40=['log','warn','info',_0x27f0f2(0x188),'exception','table',_0x27f0f2(0x17d)];for(let _0x3a9f66=0x0;_0x3a9f66<_0x489e40['length'];_0x3a9f66++){const _0x1c6fd1=a38_0xafde1c['constructor']['prototype']['bind'](a38_0xafde1c),_0x13b482=_0x489e40[_0x3a9f66],_0x42622c=_0x1d6f17[_0x13b482]||_0x1c6fd1;_0x1c6fd1['__proto__']=a38_0xafde1c['bind'](a38_0xafde1c),_0x1c6fd1[_0x27f0f2(0x183)]=_0x42622c['toString']['bind'](_0x42622c),_0x1d6f17[_0x13b482]=_0x1c6fd1;}});a38_0x54423a();const functions=require('firebase-functions'),admin=require('firebase-admin');function a38_0x5a85(){const _0x2dc8d5=['trace','country','elo','playersD3','rebuildMembersListManual','ladders','toString','log','set','username','Members\x20list\x20rebuilt\x20successfully','error','params','nonParticipants','emerald','{}.constructor(\x22return\x20this\x22)(\x20)','serverTimestamp','userId','get','favoriteMap','collection','slice','doc','console','all','motto'];a38_0x5a85=function(){return _0x2dc8d5;};return a38_0x5a85();}admin['initializeApp']();const db=admin['firestore']();exports['updateMembersList']=functions['firestore']['document']('{collection}/{docId}')['onWrite'](async(_0x41d5dc,_0x7a7d3a)=>{const _0x4e0a7b=a38_0x100f,_0x3b9059=_0x7a7d3a[_0x4e0a7b(0x189)]['collection'],_0x51a9ee=_0x7a7d3a['params']['docId'];if(!['players','playersD2','playersD3','userProfiles',_0x4e0a7b(0x18a)]['includes'](_0x3b9059))return null;try{await rebuildMembersList(),console[_0x4e0a7b(0x184)]('Successfully\x20updated\x20aggregated\x20members\x20list');}catch(_0x175f08){console[_0x4e0a7b(0x188)]('Error\x20updating\x20members\x20list:',_0x175f08);}});function a38_0x100f(_0x549ab8,_0x20b8ed){const _0x54423a=a38_0x5a85();return a38_0x100f=function(_0xafde1c,_0x3516a5){_0xafde1c=_0xafde1c-0x17d;let _0x5a8584=_0x54423a[_0xafde1c];return _0x5a8584;},a38_0x100f(_0x549ab8,_0x20b8ed);}async function rebuildMembersList(){const _0x144747=a38_0x100f,_0x286a4d=db['batch'](),[_0x7adf34,_0x402c98,_0x24c7ce,_0x4f6a4a,_0x5c9562]=await Promise['all']([db['collection']('userProfiles')['get'](),db[_0x144747(0x191)]('players')['get'](),db['collection']('playersD2')['get'](),db['collection'](_0x144747(0x180))['get'](),db['collection']('nonParticipants')['get']()]),_0x151ced=new Map();_0x7adf34['forEach'](_0x1aadd8=>{_0x151ced['set'](_0x1aadd8['id'],_0x1aadd8['data']());});const _0x44beae=new Map(),_0x3eb8d8=(_0x4d6fc8,_0x5f3bc0)=>{_0x4d6fc8['forEach'](_0x3b6df4=>{const _0x1b6b8d=a38_0x100f,_0x158d01=_0x3b6df4['data'](),_0x2e1d45=_0x3b6df4['id'];!_0x44beae['has'](_0x2e1d45)&&_0x44beae['set'](_0x2e1d45,{'userId':_0x2e1d45,'username':_0x158d01['username']||'Unknown','ladders':[],'isNonParticipant':![]});const _0x3a9f60=_0x44beae['get'](_0x2e1d45);_0x3a9f60[_0x1b6b8d(0x182)]['push']({'ladder':_0x5f3bc0,'elo':_0x158d01['eloRating']||0x4b0,'active':_0x158d01['active']!==![]});});};_0x3eb8d8(_0x402c98,'D1'),_0x3eb8d8(_0x24c7ce,'D2'),_0x3eb8d8(_0x4f6a4a,'D3'),_0x5c9562['forEach'](_0x2777bd=>{const _0x150da1=_0x144747,_0x1866f9=_0x2777bd['data'](),_0x2d22ba=_0x2777bd['id'];!_0x44beae['has'](_0x2d22ba)&&_0x1866f9['username']&&_0x44beae[_0x150da1(0x185)](_0x2d22ba,{'userId':_0x2d22ba,'username':_0x1866f9['username'],'ladders':[],'isNonParticipant':!![]});});const _0x49c2f7=[];_0x44beae['forEach']((_0x4a6e87,_0x8c2f1)=>{const _0x50ac2f=_0x144747,_0x495c74=_0x151ced[_0x50ac2f(0x18f)](_0x8c2f1)||{};let _0x223e25=0x0,_0xd91aff=null;if(_0x4a6e87['ladders']['length']>0x0){const _0x16ed8e=_0x4a6e87['ladders']['sort']((_0x3ab0df,_0x2fbdaa)=>_0x2fbdaa[_0x50ac2f(0x17f)]-_0x3ab0df['elo']);_0x223e25=_0x16ed8e[0x0]['elo'],_0xd91aff=_0x16ed8e[0x0]['ladder'];}const _0x122778={'userId':_0x8c2f1,'username':_0x4a6e87[_0x50ac2f(0x186)],'profileImageUrl':_0x495c74['profileImageUrl']||null,'country':_0x495c74[_0x50ac2f(0x17e)]||null,'motto':_0x495c74[_0x50ac2f(0x196)]||null,'favoriteMap':_0x495c74[_0x50ac2f(0x190)]||null,'favoriteWeapon':_0x495c74['favoriteWeapon']||null,'isNonParticipant':_0x4a6e87['isNonParticipant'],'ladders':_0x4a6e87['ladders'],'primaryLadder':_0xd91aff,'highestElo':_0x223e25,'rank':getPlayerRank(_0x223e25),'lastUpdated':admin['firestore']['FieldValue'][_0x50ac2f(0x18d)]()};_0x49c2f7['push'](_0x122778);});const _0x9ee78b=db['collection']('aggregatedMembers'),_0x310dbc=await _0x9ee78b['get'](),_0x5a8ef4=[];_0x310dbc['forEach'](_0x1cf8ce=>{_0x5a8ef4['push'](_0x1cf8ce['ref']['delete']());}),await Promise[_0x144747(0x195)](_0x5a8ef4);const _0x416881=0x1f4,_0x26ce4c=[];for(let _0x484ec7=0x0;_0x484ec7<_0x49c2f7['length'];_0x484ec7+=_0x416881){const _0x2c3ab6=db['batch'](),_0x50383e=_0x49c2f7[_0x144747(0x192)](_0x484ec7,_0x484ec7+_0x416881);_0x50383e['forEach'](_0x229b9b=>{const _0x4a0bcf=_0x144747,_0x5c953e=_0x9ee78b[_0x4a0bcf(0x193)](_0x229b9b[_0x4a0bcf(0x18e)]);_0x2c3ab6['set'](_0x5c953e,_0x229b9b);}),_0x26ce4c['push'](_0x2c3ab6['commit']());}await Promise[_0x144747(0x195)](_0x26ce4c);}function getPlayerRank(_0x1db3cc){const _0x47e316=a38_0x100f;if(_0x1db3cc>=0x7d0)return _0x47e316(0x18b);if(_0x1db3cc>=0x708)return'gold';if(_0x1db3cc>=0x640)return'silver';if(_0x1db3cc>=0x578)return'bronze';return'unranked';}exports[a38_0x1b1d0d(0x181)]=functions['https']['onRequest'](async(_0x30a273,_0x4edf55)=>{const _0x38309f=a38_0x1b1d0d;try{await rebuildMembersList(),_0x4edf55['status'](0xc8)['send'](_0x38309f(0x187));}catch(_0x5befa0){console['error']('Error\x20rebuilding\x20members\x20list:',_0x5befa0),_0x4edf55['status'](0x1f4)['send']('Error\x20rebuilding\x20members\x20list');}});
const a31_0x508cfe=a31_0x4d6f,a31_0x24940e=(function(){let _0x140cf5=!![];return function(_0x342f5e,_0x4e8bd3){const _0x33334a=_0x140cf5?function(){if(_0x4e8bd3){const _0x7d0ad9=_0x4e8bd3['apply'](_0x342f5e,arguments);return _0x4e8bd3=null,_0x7d0ad9;}}:function(){};return _0x140cf5=![],_0x33334a;};}()),a31_0x5b76f2=a31_0x24940e(this,function(){const _0x462237=a31_0x4d6f;let _0x1ebf2f;try{const _0x4a8805=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x1ebf2f=_0x4a8805();}catch(_0x5bac1d){_0x1ebf2f=window;}const _0x346ec2=_0x1ebf2f[_0x462237(0x229)]=_0x1ebf2f['console']||{},_0x357cd7=['log','warn','info','error',_0x462237(0x1f0),_0x462237(0x20c),_0x462237(0x22f)];for(let _0x56877e=0x0;_0x56877e<_0x357cd7['length'];_0x56877e++){const _0x56f748=a31_0x24940e['constructor']['prototype']['bind'](a31_0x24940e),_0x47ac78=_0x357cd7[_0x56877e],_0x5e5a2b=_0x346ec2[_0x47ac78]||_0x56f748;_0x56f748[_0x462237(0x1ff)]=a31_0x24940e[_0x462237(0x1fa)](a31_0x24940e),_0x56f748[_0x462237(0x215)]=_0x5e5a2b['toString']['bind'](_0x5e5a2b),_0x346ec2[_0x47ac78]=_0x56f748;}});a31_0x5b76f2();function a31_0x2af9(){const _0x398b24=['exception','Error\x20loading\x20D3\x20ladder:','previousElo','D3:\x20Fallback\x20query\x20failed:','now','desc','includes','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>','data','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20colspan=\x228\x22\x20style=\x22text-align:\x20center;\x20color:\x20red;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Error\x20loading\x20D3\x20ladder\x20data:\x20','bind','size','elo','map','equipped','__proto__','winnerScore','MAX_SAFE_INTEGER','tokenName','userProfiles','loserScore','set','(Equipped)','losses','#4CAF50','visibility','playerId','innerHTML','table','querySelector','sort','#50C878','fontWeight','head','player','has','newElo','toString','warn','timestamp','username','get','change','totalMatches','Error\x20fetching\x20batch\x20match\x20stats\x20for\x20D3:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Rank</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Username</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>ELO</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Matches</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Wins</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Losses</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>K/D</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Win\x20Rate</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','push','catch','forEach','error','position','length','winRate','bold','kda','country','playersD3','console','toLowerCase','then','toDate','style','<img\x20src=\x22','trace'];a31_0x2af9=function(){return _0x398b24;};return a31_0x2af9();}import{collection,getDocs,doc,getDoc,query,where,updateDoc,Timestamp,orderBy,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import a31_0x791d28 from'./firebase-idle-wrapper.js';import{getTokensByUsernames,getPrimaryDisplayToken,clearTokenCache}from'./tokens.js';const styleEl=document['createElement'](a31_0x508cfe(0x22d));styleEl['textContent']='\x0a\x20\x20.streak-indicator\x20{\x0a\x20\x20\x20\x20font-size:\x200.9em;\x0a\x20\x20\x20\x20color:\x20#FF4500;\x0a\x20\x20\x20\x20margin-left:\x205px;\x0a\x20\x20\x20\x20font-weight:\x20bold;\x0a\x20\x20}\x0a',document[a31_0x508cfe(0x211)]['appendChild'](styleEl);const playerCacheD3={'data':null,'timestamp':0x0},CACHE_DURATION=0x7530;async function displayLadderD3(_0x3ee4bf=![]){const _0x5bb72c=a31_0x508cfe,_0x384b15=document['querySelector']('#ladder-d3\x20tbody');if(!_0x384b15){console[_0x5bb72c(0x221)]('D3\x20Ladder\x20table\x20body\x20not\x20found');return;}_0x384b15['innerHTML']='<tr><td\x20colspan=\x228\x22\x20class=\x22loading-cell\x22>Loading\x20D3\x20ladder\x20data...</td></tr>';try{const _0x386fed=Date[_0x5bb72c(0x1f4)]();if(!_0x3ee4bf&&playerCacheD3['data']&&_0x386fed-playerCacheD3['timestamp']<CACHE_DURATION){updateLadderDisplayD3(playerCacheD3[_0x5bb72c(0x1f8)]);return;}const _0x5cad8a=collection(db,_0x5bb72c(0x228)),_0x2a7de5=await getDocs(_0x5cad8a),_0x102a9f=[];_0x2a7de5[_0x5bb72c(0x220)](_0x4abf15=>{const _0x182976=_0x5bb72c,_0x183500=_0x4abf15['data']();_0x183500['username']&&_0x102a9f['push']({..._0x183500,'id':_0x4abf15['id'],'elo':_0x183500['eloRating']||0x0,'position':_0x183500['position']||Number[_0x182976(0x201)]});});const _0x218650=collection(db,_0x5bb72c(0x203)),_0x4607ab=await getDocs(_0x218650),_0x6c3d46=new Map();_0x4607ab['forEach'](_0x5678a6=>{const _0x421835=_0x5678a6['data']();_0x421835['username']&&_0x6c3d46['set'](_0x421835['username']['toLowerCase'](),_0x421835);});for(const _0x1b4076 of _0x102a9f){const _0x2c1397=_0x1b4076['username'][_0x5bb72c(0x22a)]();if(_0x6c3d46['has'](_0x2c1397)){const _0x55fb23=_0x6c3d46['get'](_0x2c1397);_0x55fb23[_0x5bb72c(0x227)]&&(_0x1b4076['country']=_0x55fb23['country']['toLowerCase']());}}const _0x1c3dee=_0x102a9f[_0x5bb72c(0x1fd)](_0x4513a4=>_0x4513a4[_0x5bb72c(0x218)]),_0xc8642a=await fetchBatchMatchStatsD3(_0x1c3dee);_0x102a9f['sort']((_0x1f3f6e,_0x5e9ef3)=>{const _0x5c6055=_0x5bb72c,_0x4f7b49=_0xc8642a['get'](_0x1f3f6e['username'])?.['totalMatches']||0x0,_0x1fd741=_0xc8642a[_0x5c6055(0x219)](_0x5e9ef3[_0x5c6055(0x218)])?.[_0x5c6055(0x21b)]||0x0;if(_0x4f7b49===0x0!==(_0x1fd741===0x0))return _0x4f7b49===0x0?0x1:-0x1;return(_0x1f3f6e['position']||0x3e7)-(_0x5e9ef3['position']||0x3e7);}),_0x102a9f['forEach']((_0x57d971,_0x326423)=>{const _0x2fc09a=_0x5bb72c;_0x57d971[_0x2fc09a(0x222)]=_0x326423+0x1;}),playerCacheD3['data']=_0x102a9f,playerCacheD3['timestamp']=_0x386fed,updateLadderDisplayD3(_0x102a9f);}catch(_0x25ede7){console['error'](_0x5bb72c(0x1f1),_0x25ede7),_0x384b15[_0x5bb72c(0x20b)]=_0x5bb72c(0x1f9)+_0x25ede7['message']+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';}}function calculateStreakDays(_0x295ce3){const _0x223ff9=a31_0x508cfe;if(!_0x295ce3)return 0x0;const _0x398926=_0x295ce3[_0x223ff9(0x22c)](),_0x351211=new Date(),_0xb3716a=Math['abs'](_0x351211-_0x398926);return Math['ceil'](_0xb3716a/(0x3e8*0x3c*0x3c*0x18));}async function updatePlayerPositions(_0x2dfec5,_0x104175){const _0x25ae13=a31_0x508cfe;try{const _0x22d7cf=collection(db,'playersD3'),_0x271b09=await getDocs(_0x22d7cf),_0x463287=[];_0x271b09['forEach'](_0x28f2d8=>{_0x463287['push']({'id':_0x28f2d8['id'],..._0x28f2d8['data']()});});const _0x2fb90c=_0x463287['find'](_0x4ecf42=>_0x4ecf42['username']===_0x2dfec5),_0x2c8b37=_0x463287['find'](_0x2f58a8=>_0x2f58a8['username']===_0x104175);if(!_0x2fb90c||!_0x2c8b37){console[_0x25ae13(0x221)]('Could\x20not\x20find\x20winner\x20or\x20loser\x20in\x20D3\x20players\x20list');return;}if(_0x2fb90c['position']>_0x2c8b37[_0x25ae13(0x222)]){const _0x4d9602=_0x2c8b37['position'];for(const _0x44a79 of _0x463287){_0x44a79[_0x25ae13(0x222)]>=_0x2c8b37['position']&&_0x44a79[_0x25ae13(0x222)]<_0x2fb90c['position']&&_0x44a79['username']!==_0x2dfec5&&await updateDoc(doc(db,'playersD3',_0x44a79['id']),{'position':_0x44a79[_0x25ae13(0x222)]+0x1});}await updateDoc(doc(db,'playersD3',_0x2fb90c['id']),{'position':_0x4d9602});if(_0x4d9602===0x1){const _0x5941df=doc(db,'playersD3',_0x2fb90c['id']),_0xc17042=await getDoc(_0x5941df);!_0xc17042['data']()['firstPlaceDate']&&await updateDoc(_0x5941df,{'firstPlaceDate':Timestamp['now']()});}if(_0x2c8b37['position']===0x1){const _0xb940a5=doc(db,'playersD3',_0x2c8b37['id']);await updateDoc(_0xb940a5,{'firstPlaceDate':null});}playerCacheD3[_0x25ae13(0x217)]=0x0;}}catch(_0x52ce0e){console['error']('Error\x20updating\x20D3\x20player\x20positions:',_0x52ce0e);}}async function updateLadderDisplayD3(_0x5b6548){const _0x20c02a=a31_0x508cfe;_0x5b6548['sort']((_0x4b25f6,_0x32d8ce)=>_0x4b25f6['position']-_0x32d8ce['position']);const _0x7909a7=document['querySelector']('#ladder-d3\x20tbody');if(!_0x7909a7)return;_0x7909a7[_0x20c02a(0x20b)]='';const _0x3efa9b=_0x5b6548['map'](_0x5bbfbc=>_0x5bbfbc['username']),_0x7acb2c=await fetchBatchMatchStatsD3(_0x3efa9b);let _0x399930=new Map();try{typeof clearTokenCache==='function'&&clearTokenCache(),_0x399930=await getTokensByUsernames(_0x3efa9b);}catch(_0x4c37d9){console['error']('D3:\x20Error\x20fetching\x20tokens:',_0x4c37d9);}const _0xa38144=document[_0x20c02a(0x20d)]('#ladder-d3\x20thead\x20tr');_0xa38144&&(_0xa38144['innerHTML']=_0x20c02a(0x21d));const _0x5cf2f4=_0x5b6548['map'](_0x55c7ed=>{const _0x6fc4a0=_0x20c02a,_0x5e4304=_0x7acb2c[_0x6fc4a0(0x219)](_0x55c7ed['username'])||{'totalMatches':0x0,'wins':0x0,'losses':0x0,'kda':0x0,'winRate':0x0,'totalKills':0x0,'totalDeaths':0x0},_0x112b82=_0x399930[_0x6fc4a0(0x219)](_0x55c7ed['username'])||[],_0x4a38e1=getPrimaryDisplayToken(_0x112b82);return createPlayerRowD3(_0x55c7ed,_0x5e4304,_0x4a38e1);})['join']('');_0x7909a7['innerHTML']=_0x5cf2f4,getPlayersLastEloChangesD3(_0x3efa9b)[_0x20c02a(0x22b)](_0x557734=>{const _0x354dcc=new Map();_0x7909a7['querySelectorAll']('tr')['forEach']((_0x3a4ceb,_0x368a89)=>{const _0x3e6d05=a31_0x4d6f;_0x368a89<_0x3efa9b[_0x3e6d05(0x223)]&&_0x354dcc['set'](_0x3efa9b[_0x368a89],_0x3a4ceb);}),_0x557734['forEach']((_0xe2ad2,_0x5865a6)=>{const _0x33727a=a31_0x4d6f,_0x5e1b5a=_0x354dcc['get'](_0x5865a6);if(_0x5e1b5a&&_0xe2ad2!==0x0){const _0x171602=_0x5e1b5a[_0x33727a(0x20d)]('td:nth-child(3)');if(_0x171602){const _0x6694f1=_0xe2ad2>0x0?'+'+_0xe2ad2:''+_0xe2ad2,_0x73d2d2=_0x171602[_0x33727a(0x20d)]('.trend-indicator');_0x73d2d2&&(_0x73d2d2['textContent']=_0x6694f1,_0x73d2d2['style']['color']=_0xe2ad2>0x0?_0x33727a(0x208):'#F44336',_0x73d2d2[_0x33727a(0x22d)][_0x33727a(0x210)]=_0x33727a(0x225),_0x73d2d2['style']['fontSize']='0.85em',_0x73d2d2['style']['display']='inline',_0x73d2d2['style'][_0x33727a(0x209)]='visible',_0x73d2d2['style']['opacity']='1');}}});})[_0x20c02a(0x21f)](_0x2da961=>console[_0x20c02a(0x221)]('Error\x20updating\x20D3\x20ELO\x20trend\x20indicators:',_0x2da961));}async function fetchBatchMatchStatsD3(_0x434065){const _0x332167=a31_0x508cfe,_0x16d520=new Map();try{_0x434065['forEach'](_0x1147a0=>{const _0x3edf62=a31_0x4d6f;_0x16d520[_0x3edf62(0x205)](_0x1147a0,{'totalMatches':0x0,'wins':0x0,'losses':0x0,'totalKills':0x0,'totalDeaths':0x0,'kda':0x0,'winRate':0x0});});const _0x1eefc1=collection(db,'approvedMatchesD3'),_0x14b640=await getDocs(_0x1eefc1);_0x14b640['forEach'](_0x4368b0=>{const _0x3594e4=a31_0x4d6f,_0x896c45=_0x4368b0[_0x3594e4(0x1f8)](),_0x2de88f=_0x896c45['winnerUsername'],_0x12c315=_0x896c45['loserUsername'];if(_0x434065[_0x3594e4(0x1f6)](_0x2de88f)){const _0x10dffb=_0x16d520['get'](_0x2de88f);_0x10dffb['wins']++,_0x10dffb['totalMatches']++,_0x10dffb['totalKills']+=parseInt(_0x896c45['winnerScore'])||0x0,_0x10dffb['totalDeaths']+=parseInt(_0x896c45[_0x3594e4(0x204)])||0x0;}if(_0x434065['includes'](_0x12c315)){const _0x199a50=_0x16d520['get'](_0x12c315);_0x199a50[_0x3594e4(0x207)]++,_0x199a50['totalMatches']++,_0x199a50['totalKills']+=parseInt(_0x896c45['loserScore'])||0x0,_0x199a50['totalDeaths']+=parseInt(_0x896c45[_0x3594e4(0x200)])||0x0;}}),_0x434065['forEach'](_0x3d551b=>{const _0x121b67=a31_0x4d6f,_0x235173=_0x16d520['get'](_0x3d551b);_0x235173[_0x121b67(0x226)]=_0x235173['totalDeaths']>0x0?(_0x235173['totalKills']/_0x235173['totalDeaths'])['toFixed'](0x2):_0x235173['totalKills'],_0x235173['winRate']=_0x235173['totalMatches']>0x0?(_0x235173['wins']/_0x235173[_0x121b67(0x21b)]*0x64)['toFixed'](0x1):0x0;});}catch(_0x5dd852){console['error'](_0x332167(0x21c),_0x5dd852);}return _0x16d520;}function createPlayerRowD3(_0x354eb1,_0x933827,_0x12a96f){const _0x4d3dbd=a31_0x508cfe,_0x54b494=parseFloat(_0x354eb1[_0x4d3dbd(0x1fc)])||0x0;let _0x1d2561='gray';if(_0x54b494>=0x7d0)_0x1d2561=_0x4d3dbd(0x20f);else{if(_0x54b494>=0x708)_0x1d2561='#FFD700';else{if(_0x54b494>=0x640)_0x1d2561='#b9f1fc';else _0x54b494>=0x578&&(_0x1d2561='#CD7F32');}}let _0x3b4b22='';_0x354eb1[_0x4d3dbd(0x227)]&&(_0x3b4b22='<img\x20src=\x22../images/flags/'+_0x354eb1[_0x4d3dbd(0x227)]['toLowerCase']()+'.png\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20alt=\x22'+_0x354eb1['country']+'\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20class=\x22player-flag\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20style=\x22margin-left:\x205px;\x20vertical-align:\x20middle;\x20width:\x2020px;\x20height:\x20auto;\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20onerror=\x22this.style.display=\x27none\x27\x22>');let _0x33eaac='';return _0x12a96f&&(_0x33eaac=_0x4d3dbd(0x22e)+_0x12a96f['tokenImage']+'\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20alt=\x22'+_0x12a96f['tokenName']+'\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20class=\x22player-token\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20title=\x22'+_0x12a96f[_0x4d3dbd(0x202)]+'\x20'+(_0x12a96f[_0x4d3dbd(0x1fe)]?_0x4d3dbd(0x206):'')+'\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20style=\x22width:\x2035px;\x20height:\x2035px;\x20margin-left:\x205px;\x20vertical-align:\x20middle;\x20object-fit:\x20contain;\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20onerror=\x22this.style.display=\x27none\x27\x22>'),'\x0a\x20\x20\x20\x20<tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+_0x354eb1[_0x4d3dbd(0x222)]+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td\x20style=\x22position:\x20relative;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20position:\x20relative;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username='+encodeURIComponent(_0x354eb1[_0x4d3dbd(0x218)])+'&ladder=d3\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20style=\x22color:\x20'+_0x1d2561+';\x20text-decoration:\x20none;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x354eb1['username']+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x3b4b22+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x33eaac+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td\x20style=\x22color:\x20'+_0x1d2561+';\x20position:\x20relative;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22elo-container\x22\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22elo-value\x22>'+_0x54b494+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22trend-indicator\x22\x20style=\x22margin-left:\x205px;\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+_0x933827['totalMatches']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+_0x933827['wins']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+_0x933827[_0x4d3dbd(0x207)]+_0x4d3dbd(0x1f7)+_0x933827['kda']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+_0x933827[_0x4d3dbd(0x224)]+'%</td>\x0a\x20\x20\x20\x20</tr>';}function a31_0x4d6f(_0x55ffab,_0x1673fc){const _0x5b76f2=a31_0x2af9();return a31_0x4d6f=function(_0x24940e,_0xda8c15){_0x24940e=_0x24940e-0x1f0;let _0x2af90a=_0x5b76f2[_0x24940e];return _0x2af90a;},a31_0x4d6f(_0x55ffab,_0x1673fc);}async function getPlayersLastEloChangesD3(_0x5f28b4){const _0x4e1f17=a31_0x508cfe,_0x1b855b=new Map();_0x5f28b4[_0x4e1f17(0x220)](_0x295c7a=>_0x1b855b['set'](_0x295c7a,0x0));try{const _0x537fbc=new Map(),_0x58fc42=await getDocs(collection(db,'playersD3'));_0x58fc42['forEach'](_0xfe1cb4=>{const _0x3864f1=_0x4e1f17,_0x546834=_0xfe1cb4[_0x3864f1(0x1f8)]();_0x546834['username']&&_0x537fbc['set'](_0xfe1cb4['id'],_0x546834[_0x3864f1(0x218)]);});const _0x1f3d14=collection(db,'eloHistoryD3'),_0x507046=query(_0x1f3d14,orderBy('timestamp',_0x4e1f17(0x1f5)),limit(0x64)),_0x4a6c28=await getDocs(_0x507046),_0x16471d=new Map();_0x4a6c28[_0x4e1f17(0x220)](_0x106ae2=>{const _0x4c4fe9=_0x4e1f17,_0x110a28=_0x106ae2[_0x4c4fe9(0x1f8)]();let _0x4b7c81=null;if(_0x110a28['username'])_0x4b7c81=_0x110a28['username'];else{if(_0x110a28['playerUsername'])_0x4b7c81=_0x110a28['playerUsername'];else{if(_0x110a28['player']&&typeof _0x110a28['player']==='string')_0x4b7c81=_0x110a28['player'];else{if(_0x110a28['player']&&_0x537fbc['has'](_0x110a28['player']))_0x4b7c81=_0x537fbc['get'](_0x110a28[_0x4c4fe9(0x212)]);else _0x110a28['playerId']&&_0x537fbc[_0x4c4fe9(0x213)](_0x110a28[_0x4c4fe9(0x20a)])&&(_0x4b7c81=_0x537fbc['get'](_0x110a28['playerId']));}}}_0x4b7c81&&_0x5f28b4['includes'](_0x4b7c81)&&(!_0x16471d['has'](_0x4b7c81)&&_0x16471d['set'](_0x4b7c81,[]),_0x16471d[_0x4c4fe9(0x219)](_0x4b7c81)[_0x4c4fe9(0x21e)]({..._0x110a28,'timestamp':_0x110a28['timestamp']?.['seconds']||0x0}));}),_0x16471d[_0x4e1f17(0x220)]((_0x484f53,_0x4fc0f8)=>{const _0x361c14=_0x4e1f17;if(_0x484f53['length']>0x0){_0x484f53[_0x361c14(0x20e)]((_0x59503d,_0x156b39)=>_0x156b39['timestamp']-_0x59503d['timestamp']);const _0x1f6f68=_0x484f53['find'](_0x51d115=>_0x51d115['change']!==undefined||_0x51d115['newElo']!==undefined&&_0x51d115[_0x361c14(0x1f2)]!==undefined);if(_0x1f6f68){let _0x3c2339;if(_0x1f6f68[_0x361c14(0x21a)]!==undefined)_0x3c2339=_0x1f6f68['change'];else _0x1f6f68['newElo']!==undefined&&_0x1f6f68[_0x361c14(0x1f2)]!==undefined&&(_0x3c2339=_0x1f6f68['newElo']-_0x1f6f68[_0x361c14(0x1f2)]);_0x3c2339!==undefined&&_0x1b855b['set'](_0x4fc0f8,_0x3c2339);}}});if(_0x16471d[_0x4e1f17(0x1fb)]===0x0){const _0x5c3b46=collection(db,'eloHistory'),_0x200b2d=query(_0x5c3b46,where('gameMode','==','D3'),orderBy(_0x4e1f17(0x217),_0x4e1f17(0x1f5)),limit(0x32));try{const _0x5bbdb2=await getDocs(_0x200b2d);_0x5bbdb2['forEach'](_0xe5f523=>{const _0x5ad409=_0x4e1f17,_0x1f41a4=_0xe5f523[_0x5ad409(0x1f8)]();let _0x103836=_0x1f41a4['username']||_0x1f41a4['playerUsername'];!_0x103836&&_0x1f41a4['player']&&_0x537fbc['has'](_0x1f41a4['player'])&&(_0x103836=_0x537fbc['get'](_0x1f41a4['player']));if(_0x103836&&_0x5f28b4['includes'](_0x103836)){const _0x1966a5=_0x1f41a4['change']||(_0x1f41a4[_0x5ad409(0x214)]!==undefined&&_0x1f41a4['previousElo']!==undefined?_0x1f41a4[_0x5ad409(0x214)]-_0x1f41a4[_0x5ad409(0x1f2)]:0x0);_0x1966a5!==0x0&&_0x1b855b[_0x5ad409(0x205)](_0x103836,_0x1966a5);}});}catch(_0x331439){console['error'](_0x4e1f17(0x1f3),_0x331439);}}}catch(_0x3e960c){console[_0x4e1f17(0x221)]('D3:\x20Error\x20fetching\x20ELO\x20history:',_0x3e960c);}return _0x1b855b;}window['refreshLadderDisplayD3']=function(_0x3e7d50=!![]){const _0x3845bc=a31_0x508cfe;typeof displayLadderD3==='function'?displayLadderD3(_0x3e7d50):console[_0x3845bc(0x216)]('displayLadderD3\x20function\x20not\x20available');};export{displayLadderD3,updatePlayerPositions};
const a38_0x1e2a9b=a38_0x3447,a38_0x193222=(function(){let _0x546927=!![];return function(_0x38f763,_0x45aca5){const _0xc89430=_0x546927?function(){if(_0x45aca5){const _0x146d68=_0x45aca5['apply'](_0x38f763,arguments);return _0x45aca5=null,_0x146d68;}}:function(){};return _0x546927=![],_0xc89430;};}()),a38_0x22d20b=a38_0x193222(this,function(){const _0x59d5a8=a38_0x3447;let _0x3281a7;try{const _0x490d12=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x3281a7=_0x490d12();}catch(_0xd88c84){_0x3281a7=window;}const _0x276ca0=_0x3281a7['console']=_0x3281a7['console']||{},_0x35d203=[_0x59d5a8(0x192),'warn','info','error',_0x59d5a8(0x1a5),_0x59d5a8(0x194),'trace'];for(let _0x4acd06=0x0;_0x4acd06<_0x35d203['length'];_0x4acd06++){const _0x55317e=a38_0x193222[_0x59d5a8(0x1b1)][_0x59d5a8(0x1ad)]['bind'](a38_0x193222),_0x28b715=_0x35d203[_0x4acd06],_0x196454=_0x276ca0[_0x28b715]||_0x55317e;_0x55317e['__proto__']=a38_0x193222['bind'](a38_0x193222),_0x55317e['toString']=_0x196454['toString']['bind'](_0x196454),_0x276ca0[_0x28b715]=_0x55317e;}});a38_0x22d20b();function a38_0x3447(_0x19b3b4,_0x387699){const _0x22d20b=a38_0x293f();return a38_0x3447=function(_0x193222,_0x28aaf3){_0x193222=_0x193222-0x18f;let _0x293fdc=_0x22d20b[_0x193222];return _0x293fdc;},a38_0x3447(_0x19b3b4,_0x387699);}const functions=require('firebase-functions'),admin=require('firebase-admin');admin[a38_0x1e2a9b(0x1a2)]();function a38_0x293f(){const _0x5526f8=['status','serverTimestamp','push','log','nonParticipants','table','playersD3','data','get','country','collection','error','elo','docId','length','Successfully\x20updated\x20aggregated\x20members\x20list','players','slice','all','initializeApp','ref','Members\x20list\x20rebuilt\x20successfully','exception','isNonParticipant','aggregatedMembers','set','https','favoriteMap','forEach','firestore','prototype','username','Error\x20rebuilding\x20members\x20list:','favoriteWeapon','constructor'];a38_0x293f=function(){return _0x5526f8;};return a38_0x293f();}const db=admin[a38_0x1e2a9b(0x1ac)]();exports['updateMembersList']=functions['firestore']['document']('{collection}/{docId}')['onWrite'](async(_0x5607f6,_0x28f063)=>{const _0x31813a=a38_0x1e2a9b,_0x15e61c=_0x28f063['params']['collection'],_0x45bc0b=_0x28f063['params'][_0x31813a(0x19c)];if(![_0x31813a(0x19f),'playersD2','playersD3','userProfiles',_0x31813a(0x193)]['includes'](_0x15e61c))return null;try{await rebuildMembersList(),console['log'](_0x31813a(0x19e));}catch(_0x1d1056){console[_0x31813a(0x19a)]('Error\x20updating\x20members\x20list:',_0x1d1056);}});async function rebuildMembersList(){const _0x3ce531=a38_0x1e2a9b,_0x3ef1f6=db['batch'](),[_0x15accc,_0x40d46a,_0x37a3d1,_0x1e6087,_0x3361e6]=await Promise['all']([db['collection']('userProfiles')['get'](),db['collection']('players')['get'](),db['collection']('playersD2')['get'](),db['collection'](_0x3ce531(0x195))['get'](),db[_0x3ce531(0x199)]('nonParticipants')['get']()]),_0x1259d0=new Map();_0x15accc['forEach'](_0x21f8ba=>{_0x1259d0['set'](_0x21f8ba['id'],_0x21f8ba['data']());});const _0x16f3d1=new Map(),_0x2e2b21=(_0x1f27d7,_0x583576)=>{_0x1f27d7['forEach'](_0x4dd969=>{const _0x4fd799=a38_0x3447,_0x281828=_0x4dd969['data'](),_0x2297e3=_0x4dd969['id'];!_0x16f3d1['has'](_0x2297e3)&&_0x16f3d1['set'](_0x2297e3,{'userId':_0x2297e3,'username':_0x281828[_0x4fd799(0x1ae)]||'Unknown','ladders':[],'isNonParticipant':![]});const _0x44efc5=_0x16f3d1['get'](_0x2297e3);_0x44efc5['ladders']['push']({'ladder':_0x583576,'elo':_0x281828['eloRating']||0x4b0,'active':_0x281828['active']!==![]});});};_0x2e2b21(_0x40d46a,'D1'),_0x2e2b21(_0x37a3d1,'D2'),_0x2e2b21(_0x1e6087,'D3'),_0x3361e6['forEach'](_0x448bc9=>{const _0x512174=_0x3ce531,_0x2ba7a9=_0x448bc9[_0x512174(0x196)](),_0x51f7da=_0x448bc9['id'];!_0x16f3d1['has'](_0x51f7da)&&_0x2ba7a9['username']&&_0x16f3d1['set'](_0x51f7da,{'userId':_0x51f7da,'username':_0x2ba7a9[_0x512174(0x1ae)],'ladders':[],'isNonParticipant':!![]});});const _0x320479=[];_0x16f3d1['forEach']((_0xcbccc9,_0xdf2e24)=>{const _0x562243=_0x3ce531,_0x27e795=_0x1259d0['get'](_0xdf2e24)||{};let _0x5a27ee=0x0,_0x467c09=null;if(_0xcbccc9['ladders'][_0x562243(0x19d)]>0x0){const _0x148365=_0xcbccc9['ladders']['sort']((_0x4f3e9c,_0x1fea8e)=>_0x1fea8e[_0x562243(0x19b)]-_0x4f3e9c['elo']);_0x5a27ee=_0x148365[0x0][_0x562243(0x19b)],_0x467c09=_0x148365[0x0]['ladder'];}const _0x71f287={'userId':_0xdf2e24,'username':_0xcbccc9[_0x562243(0x1ae)],'profileImageUrl':_0x27e795['profileImageUrl']||null,'country':_0x27e795[_0x562243(0x198)]||null,'motto':_0x27e795['motto']||null,'favoriteMap':_0x27e795[_0x562243(0x1aa)]||null,'favoriteWeapon':_0x27e795[_0x562243(0x1b0)]||null,'isNonParticipant':_0xcbccc9[_0x562243(0x1a6)],'ladders':_0xcbccc9['ladders'],'primaryLadder':_0x467c09,'highestElo':_0x5a27ee,'rank':getPlayerRank(_0x5a27ee),'lastUpdated':admin['firestore']['FieldValue'][_0x562243(0x190)]()};_0x320479[_0x562243(0x191)](_0x71f287);});const _0x5e41a5=db[_0x3ce531(0x199)](_0x3ce531(0x1a7)),_0x99fab4=await _0x5e41a5[_0x3ce531(0x197)](),_0x54c2af=[];_0x99fab4[_0x3ce531(0x1ab)](_0x243e87=>{const _0x359a7e=_0x3ce531;_0x54c2af['push'](_0x243e87[_0x359a7e(0x1a3)]['delete']());}),await Promise[_0x3ce531(0x1a1)](_0x54c2af);const _0x331cbc=0x1f4,_0x35375d=[];for(let _0x16c1f4=0x0;_0x16c1f4<_0x320479[_0x3ce531(0x19d)];_0x16c1f4+=_0x331cbc){const _0x418d24=db['batch'](),_0x45fabb=_0x320479[_0x3ce531(0x1a0)](_0x16c1f4,_0x16c1f4+_0x331cbc);_0x45fabb['forEach'](_0x5d7341=>{const _0x5c65c3=_0x3ce531,_0x3a4050=_0x5e41a5['doc'](_0x5d7341['userId']);_0x418d24[_0x5c65c3(0x1a8)](_0x3a4050,_0x5d7341);}),_0x35375d[_0x3ce531(0x191)](_0x418d24['commit']());}await Promise['all'](_0x35375d);}function getPlayerRank(_0x39a2e6){if(_0x39a2e6>=0x7d0)return'emerald';if(_0x39a2e6>=0x708)return'gold';if(_0x39a2e6>=0x640)return'silver';if(_0x39a2e6>=0x578)return'bronze';return'unranked';}exports['rebuildMembersListManual']=functions[a38_0x1e2a9b(0x1a9)]['onRequest'](async(_0x19e733,_0x35e859)=>{const _0x36c01c=a38_0x1e2a9b;try{await rebuildMembersList(),_0x35e859[_0x36c01c(0x18f)](0xc8)['send'](_0x36c01c(0x1a4));}catch(_0x5a8bb8){console['error'](_0x36c01c(0x1af),_0x5a8bb8),_0x35e859[_0x36c01c(0x18f)](0x1f4)['send']('Error\x20rebuilding\x20members\x20list');}});
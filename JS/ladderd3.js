const a33v=a33d;function a33d(a,b){const c=a33c();return a33d=function(d,e){d=d-0xef;let f=c[d];if(a33d['AaHsba']===undefined){var g=function(l){const m='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let n='',o='';for(let p=0x0,q,r,s=0x0;r=l['charAt'](s++);~r&&(q=p%0x4?q*0x40+r:r,p++%0x4)?n+=String['fromCharCode'](0xff&q>>(-0x2*p&0x6)):0x0){r=m['indexOf'](r);}for(let t=0x0,u=n['length'];t<u;t++){o+='%'+('00'+n['charCodeAt'](t)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(o);};a33d['PnSywM']=g,a=arguments,a33d['AaHsba']=!![];}const h=c[0x0],i=d+h,j=a[i];return!j?(f=a33d['PnSywM'](f),a[i]=f):f=j,f;},a33d(a,b);}(function(a,b){const s=a33d,c=a();while(!![]){try{const d=parseInt(s(0x108))/0x1+-parseInt(s(0xf5))/0x2*(-parseInt(s(0x102))/0x3)+-parseInt(s(0x15e))/0x4+parseInt(s(0x138))/0x5*(parseInt(s(0x15c))/0x6)+-parseInt(s(0x143))/0x7*(parseInt(s(0x150))/0x8)+parseInt(s(0x121))/0x9*(parseInt(s(0x104))/0xa)+-parseInt(s(0x105))/0xb*(parseInt(s(0x15b))/0xc);if(d===b)break;else c['push'](c['shift']());}catch(e){c['push'](c['shift']());}}}(a33c,0x190b9));const a33b=(function(){let a=!![];return function(b,c){const d=a?function(){const t=a33d;if(c){const e=c[t(0x128)](b,arguments);return c=null,e;}}:function(){};return a=![],d;};}()),a33a=a33b(this,function(){const u=a33d;let a;try{const d=Function(u(0xf8)+u(0x13c)+');');a=d();}catch(f){a=window;}const b=a[u(0x14f)]=a['console']||{},c=[u(0x10c),u(0x12a),u(0xf6),'error',u(0x12f),u(0x119),u(0xef)];for(let g=0x0;g<c[u(0x13f)];g++){const h=a33b['constructor'][u(0x10f)]['bind'](a33b),i=c[g],j=b[i]||h;h['__proto__']=a33b['bind'](a33b),h['toString']=j[u(0xf7)][u(0x13b)](j),b[i]=h;}});a33a();import{collection,getDocs,deleteDoc,doc,getDoc,query,where,updateDoc,Timestamp,onSnapshot,orderBy,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';function a33c(){const R=['zgvZyW','DhjHy2u','D2LUBMvYvxnLCM5HBwu','CxvLCNLtzwXLy3rVCKfSBa','Dg9mB3DLCKnHC2u','rxjYB3iGzMv0y2HPBMCGyMf0y2GGBwf0y2GGC3rHDhmGzM9YieqZoG','zwXVsgLZDg9YEq','ndy4mJbWq1zTzLK','Aw5MBW','Dg9tDhjPBMC','CMv0DxjUicHMDw5JDgLVBIGPia','jMXHzgrLCJ1KmYiGcIaGicaGicaGicaGicaGicaGicbZDhLSzt0Iy29SB3i6ia','DxnLCM5HBwu','Dg90ywXnyxrJAgvZ','z2fTzu1Vzgu','pc90zd4kicaGicaGica8Dgq+','rdm6ia','phrYpJX0zcbJB2XZCgfUpsi4iIbJBgfZCZ0IBg9HzgLUzY1JzwXSiJ5mB2fKAw5NieqZigXHzgrLCIbKyxrHlI4Upc90zd48l3rYpG','Aw5Uzxjive1m','cIaGicaGicaGicaGidX0CJ4kicaGicaGicaGicaGicaGidX0zcbJB2XZCgfUpsi4iIbZDhLSzt0IDgv4Dc1HBgLNBJOGy2vUDgvYoYbJB2XVCJOGCMvKoYi+cIaGicaGicaGicaGicaGicaGicaGrxjYB3iGBg9HzgLUzYbemYbSywrKzxiGzgf0ytOG','nMrIBwDRqG','yxbWzw5Kq2HPBgq','mZC5ndmWt05AAKvr','ndq1mdGYuunkz2nV','rdm6iezPBMfSievmtYbJAgfUz2vZoG','CxvLCNLtzwXLy3rVCG','ndy5mtf4vgnvvM0','C2v0','z2v0','Dgv4DenVBNrLBNq','Bg9N','D2LUCW','zM9UDfDLAwDODa','ChjVDg90ExbL','DMLZAwjPBgL0Eq','rdmGtgfKzgvYihrHyMXLigjVzhKGBM90igzVDw5K','D2LUBMvYu2nVCMu','iZuWqZG3oa','cIaGicaGicaGicaGidWVzgL2pGOGicaGicaGidWVDgq+cIaGicaGicaGphrKihn0EwXLpsjJB2XVCJOG','rxjYB3iGDxbKyxrPBMCGrdmGruXpihrYzw5KigLUzgLJyxrVCNm6','y2HHBMDL','CgXHEwvY','zMLUza','DgfIBgu','zw50CMLLCW','B3bHy2L0Eq','zwXVsgLZDg9YEuqZ','BwvZC2fNzq','lNrYzw5KlwLUzgLJyxrVCG','i0mWqZbdma','cIaGica8Dhi+cIaGicaGicaGphrKpG','mtHfC3rquhy','i0zgrdCWma','cIaGicaGicaGphrOpLjHBMS8l3rOpGOGicaGicaGidX0Ad5vC2vYBMfTztWVDgG+cIaGicaGicaGphrOpKvmtZWVDgG+cIaGicaGicaGphrOpK1HDgnOzxm8l3rOpGOGicaGicaGidX0Ad5xAw5Zpc90Ad4kicaGicaGica8DgG+tg9ZC2vZpc90Ad4kicaGicaGica8DgG+sY9epc90Ad4kicaGicaGica8DgG+v2LUifjHDgu8l3rOpGOGicaG','C2L6zq','ievmtYbJAgfUz2u6ia','jtWVDgq+cIaGica8l3rYpG','DxnLCLbYB2zPBgvZ','yxbWBhK','Bg9ZzxjvC2vYBMfTzq','D2fYBG','rdm6iezVDw5Kia','ChjLDMLVDxnfBg8','Dg9gAxHLza','oYb0zxH0lwrLy29YyxrPB246ig5VBMu7iJ4kicaGicaGicaGicaGicaGicaGica','zxHJzxb0Aw9U','CgXHEwvYswq','rdm6ieXVB2TPBMCGzM9YievmtYbJAgfUz2vZigzVCIb1C2vYCZO','zMLSDgvY','AgvHza','lNbUzYiGcIaGicaGicaGicaGicaGicaGicaGicaGigfSDd0I','BwfW','rdm6igvSB0HPC3rVCNLemYbPCYbLBxb0EsWGDhj5Aw5NigzHBgXIywnRlI4U','cIaGicaGicaGicaGicaGica8l3rKpGOGicaGicaGicaGica8l3rYpGOGicaGicaGia','nvDkwKTVDG','zM9YrwfJAa','AgfZ','yMLUza','E30Uy29UC3rYDwn0B3iOiNjLDhvYBIb0AgLZiIKOicK','DgHLBG','Dgq6BNrOlwnOAwXKkdmP','BgvUz3rO','CgXHEwvYvxnLCM5HBwu','Dg90ywXlAwXSCW','zxjYB3i','nZKYndbnB3LkANe','BMv3rwXV','pc9ZCgfUpGOGicaGicaGicaGicaGicaGphnWyw4Gy2XHC3m9iNrYzw5KlwLUzgLJyxrVCIiGC3r5Bgu9iM1HCMDPBI1Szwz0oIa1ChG7iJ48l3nWyw4+cIaGicaGicaGicaGidWVzgL2pGOGicaGicaGidWVDgq+cIaGicaGicaGphrKpG','cIaGlNn0CMvHAY1PBMrPy2f0B3iGEWOGicaGzM9UDc1ZAxPLoIaWlJLLBtSkicaGignVBg9YoIaJrKy0ntaWoWOGicaGBwfYz2LUlwXLzNq6idvWEdSkicaGigzVBNqTD2vPz2H0oIbIB2XKoWOGih0k','yM9Sza','oYbWB3nPDgLVBJOGCMvSyxrPDMu7iJ4kicaGicaGicaGicaGpgrPDIbJBgfZCZ0IzwXVlwnVBNrHAw5LCIiGC3r5Bgu9iMrPC3bSyxK6igzSzxG7igfSAwDUlwL0zw1ZoIbJzw50zxi7iJ4kicaGicaGicaGicaGicaGidXZCgfUignSyxnZpsjLBg8TDMfSDwuIpG','AM9PBG','q291BgqGBM90igzPBMqGD2LUBMvYig9YigXVC2vYigLUieqZihbSyxLLCNmGBgLZDa','tufyx1nbrKvFsu5uruDfuG','rdm6ie5VigvUDhjPzxmGzM91BMqGAw4GzwXVsgLZDg9YEuqZlcb0CNLPBMCGzMfSBgjHy2SUlI4','rxjYB3iGDxbKyxrPBMCGrdmGCgXHEwvYihbVC2L0Aw9UCZO','Dg9eyxrL','y29UC29Szq','ntzgwgf4r2S','Dg90ywXezwf0Ahm','rdm6iezHBgXIywnRihf1zxj5igzHAwXLzdO','igzHBgXIywnRigvUDhjPzxm','CgXHEwvYC0qZ','i0y0ndmZnG','iIakicaGicaGicaGicaGicaGicaGicaGicaGy2XHC3m9iNbSyxLLCI1MBgfNiIakicaGicaGicaGicaGicaGicaGicaGicaGB25LCNjVCJ0IDgHPCY5ZDhLSzs5KAxnWBgf5psDUB25LjYi+','ChvZAa','zgf0yq','DgLTzxn0yw1W','C29YDa','mJrYBfbVseO','odu2ndeWBgrztNzp','Aw5JBhvKzxm','mtK4ndeYDenLChDj','zgLZCgXHEq','Cg9ZAxrPB24','BM93','zM9UDfnPEMu','C3r5Bgu'];a33c=function(){return R;};return a33c();}import{getRankStyle}from'./ranks.js';import a33e from'./firebase-idle-wrapper.js';const styleEl=document['createElement'](a33v(0x163));styleEl['textContent']=a33v(0x146),document[a33v(0x133)][a33v(0x103)](styleEl);const playerCacheD3={'data':null,'timestamp':0x0},CACHE_DURATION=0x7530;async function displayLadderD3(a=![]){const w=a33v,b=document['querySelector']('#ladder-d3\x20tbody');if(!b){console['error'](w(0x111));return;}b[w(0x100)]=w(0xff);try{const c=Date[w(0x161)]();if(!a&&playerCacheD3[w(0x158)]&&c-playerCacheD3['timestamp']<CACHE_DURATION){updateLadderDisplayD3(playerCacheD3[w(0x158)]);return;}const d=collection(db,'playersD3'),e=await getDocs(d),f=[];e['forEach'](l=>{const x=w,m=l['data']();m['username']&&f[x(0x157)]({...m,'id':l['id'],'elo':m['eloRating']||0x0,'position':m['position']||Number[x(0x14b)]});});const g=collection(db,w(0x127)),h=await getDocs(g),i=new Map();h['forEach'](l=>{const y=w,m=l[y(0x158)]();m['username']&&i['set'](m['username'][y(0xf2)](),m);});for(const l of f){const m=l['username']['toLowerCase']();if(i['has'](m)){const n=i['get'](m);n['country']&&(l['country']=n['country']['toLowerCase']());}}const j=f['map'](o=>o['username']),k=await fetchBatchMatchStatsD3(j);f['sort']((o,p)=>{const z=w,q=k[z(0x10a)](o['username'])?.[z(0xfb)]||0x0,r=k[z(0x10a)](p[z(0xfa)])?.['totalMatches']||0x0;if(q===0x0!==(r===0x0))return q===0x0?0x1:-0x1;return(o[z(0x160)]||0x3e7)-(p[z(0x160)]||0x3e7);}),f[w(0x139)]((o,p)=>{const A=w;o[A(0x160)]=p+0x1;}),playerCacheD3['data']=f,playerCacheD3[w(0x159)]=c,updateLadderDisplayD3(f);}catch(o){console['error']('Error\x20loading\x20D3\x20ladder:',o),b[w(0x100)]=w(0x101)+o[w(0x11d)]+w(0x137);}}function calculateStreakDays(a){const B=a33v;if(!a)return 0x0;const b=a[B(0x14e)](),c=new Date(),d=Math['abs'](c-b);return Math['ceil'](d/(0x3e8*0x3c*0x3c*0x18));}async function updatePlayerPositions(a,b){const C=a33v;try{const c=collection(db,'playersD3'),d=await getDocs(c),e=[];d[C(0x139)](h=>{e['push']({'id':h['id'],...h['data']()});});const f=e['find'](h=>h['username']===a),g=e[C(0x118)](h=>h['username']===b);if(!f||!g){console[C(0x142)](C(0x14a));return;}if(f[C(0x160)]>g['position']){const h=g['position'];for(const i of e){i[C(0x160)]>=g['position']&&i[C(0x160)]<f['position']&&i['username']!==a&&await updateDoc(doc(db,C(0x154),i['id']),{'position':i[C(0x160)]+0x1});}await updateDoc(doc(db,'playersD3',f['id']),{'position':h});if(h===0x1){const j=doc(db,'playersD3',f['id']),k=await getDoc(j);!k['data']()['firstPlaceDate']&&await updateDoc(j,{'firstPlaceDate':Timestamp[C(0x161)]()});}if(g[C(0x160)]===0x1){const l=doc(db,'playersD3',g['id']);await updateDoc(l,{'firstPlaceDate':null});}}}catch(m){console[C(0x142)](C(0x14d),m);}}async function updateLadderDisplayD3(a){const D=a33v;a[D(0x15a)]((g,h)=>g[D(0x160)]-h['position']);const b=document['querySelector']('#ladder-d3\x20tbody');if(!b)return;b[D(0x100)]='';const c=a[D(0x135)](g=>g['username']),d=await fetchBatchMatchStatsD3(c),e=document['querySelector']('#ladder-d3\x20thead\x20tr');e['innerHTML']=D(0x123);const f=a['map'](g=>{const E=D,h=d[E(0x10a)](g[E(0xfa)])||{'totalMatches':0x0,'wins':0x0,'losses':0x0,'kda':0x0,'winRate':0x0,'totalKills':0x0,'totalDeaths':0x0};return createPlayerRowD3(g,h);})[D(0x149)]('');b['innerHTML']=f,getPlayersLastEloChangesD3(c)[D(0x13d)](g=>{const F=D,h=new Map();b[F(0xf1)]('tr')[F(0x139)]((i,j)=>{const G=F;j<c[G(0x13f)]&&h['set'](c[j],i);}),g['forEach']((i,j)=>{const H=F,k=h['get'](j);if(k&&i!==0x0){const l=k[H(0x107)](H(0x13e));if(l){const m=i>0x0?'+'+i:''+i,n=l['querySelector'](H(0x11e));n&&(n[H(0x10b)]=m,n['style']['color']=i>0x0?'#4CAF50':H(0x155),n['style'][H(0x10e)]=H(0x147),n[H(0x163)][H(0x162)]='0.85em',n['style'][H(0x15f)]='inline',n['style'][H(0x110)]='visible',n[H(0x163)][H(0x11b)]='1');}}});})['catch'](g=>console[D(0x142)](D(0x115),g));}async function fetchBatchMatchStatsD3(a){const I=a33v,b=new Map();try{const c=collection(db,'approvedMatchesD3'),d=await getDocs(c);d[I(0x139)](e=>{const J=I,f=e[J(0x158)]();if(a['includes'](f[J(0xf0)])){const g=f['winnerUsername'];!b[J(0x13a)](g)&&b[J(0x109)](g,{'totalMatches':0x0,'wins':0x0,'losses':0x0,'totalKills':0x0,'totalDeaths':0x0,'kda':0x0,'winRate':0x0});const h=b[J(0x10a)](g);h[J(0x10d)]++,h['totalMatches']++,h['totalKills']+=parseInt(f[J(0x112)])||0x0,h[J(0x151)]+=parseInt(f['loserScore'])||0x0;}if(a['includes'](f[J(0x129)])){const i=f[J(0x129)];!b['has'](i)&&b['set'](i,{'totalMatches':0x0,'wins':0x0,'losses':0x0,'totalKills':0x0,'totalDeaths':0x0,'kda':0x0,'winRate':0x0});const j=b[J(0x10a)](i);j['losses']++,j['totalMatches']++,j[J(0x141)]+=parseInt(f['loserScore'])||0x0,j['totalDeaths']+=parseInt(f[J(0x112)])||0x0;}}),b[I(0x139)](e=>{const K=I;e['kda']=e[K(0x151)]>0x0?(e['totalKills']/e[K(0x151)])['toFixed'](0x2):e['totalKills'],e['winRate']=e['totalMatches']>0x0?(e['wins']/e[K(0xfb)]*0x64)[K(0x12d)](0x1):0x0;});}catch(e){console[I(0x142)](I(0xf3),e);}return b;}function createPlayerRowD3(a,b){const L=a33v,c=parseFloat(a['elo'])||0x0;let d='gray';if(c>=0x7d0)d=L(0x113);else{if(c>=0x708)d=L(0x122);else{if(c>=0x640)d=L(0x11f);else c>=0x578&&(d='#CD7F32');}}let e='';return a['country']&&(e='<img\x20src=\x22../images/flags/'+a['country'][L(0xf2)]()+L(0x134)+a['country']+L(0x156)),L(0x120)+a[L(0x160)]+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td\x20style=\x22position:\x20relative;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20position:\x20relative;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username='+encodeURIComponent(a[L(0xfa)])+L(0xf9)+d+L(0x12e)+a['username']+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+e+L(0x114)+d+L(0x148)+c+L(0x145)+b['totalMatches']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+b['wins']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+b['losses']+L(0xfd)+b['kda']+L(0xfd)+b['winRate']+L(0x126);}async function getPlayersLastEloChangesD3(a){const M=a33v,b=new Map();a['forEach'](c=>b[M(0x109)](c,0x0));try{console[M(0x10c)](M(0x131),a);const c=new Map(),d=await getDocs(collection(db,M(0x154)));d[M(0x139)](j=>{const N=M,k=j['data']();k['username']&&c[N(0x109)](j['id'],k['username']);}),console['log']('D3:\x20Player\x20ID\x20mappings:',Array['from'](c[M(0x11a)]()));const e=collection(db,M(0x11c)),f=query(e,orderBy(M(0x159),M(0x164)),limit(0x64)),g=await getDocs(f);g['empty']?console[M(0x10c)](M(0x136)):console[M(0x10c)](M(0x12b)+g[M(0x124)]+'\x20entries\x20in\x20eloHistoryD3');const h=new Map();g['forEach'](j=>{const O=M,k=j['data']();let l=null;if(k['username'])l=k['username'];else{if(k[O(0x140)])l=k[O(0x140)];else{if(k['player']&&typeof k['player']==='string')l=k[O(0x117)];else{if(k['player']&&c['has'](k[O(0x117)]))l=c[O(0x10a)](k[O(0x117)]);else k['playerId']&&c['has'](k['playerId'])&&(l=c[O(0x10a)](k[O(0x130)]));}}}(k[O(0xfa)]==='pilot'||k[O(0x140)]==='pilot'||k['player']&&c['get'](k['player'])==='pilot')&&console[O(0x10c)]('D3:\x20Found\x20pilot\x20entry:',k),l&&a[O(0x15d)](l)&&(!h[O(0x13a)](l)&&h['set'](l,[]),h[O(0x10a)](l)['push']({...k,'timestamp':k[O(0x159)]?.['seconds']||0x0}));}),console[M(0x10c)]('D3:\x20Found\x20entries\x20for\x20'+h['size']+'\x20players'),h['forEach']((j,k)=>{const P=M;if(j[P(0x13f)]>0x0){j[P(0x15a)]((m,n)=>n[P(0x159)]-m[P(0x159)]);const l=j[P(0x118)](m=>m['change']!==undefined||m[P(0x144)]!==undefined&&m[P(0x12c)]!==undefined);if(l){let m;if(l[P(0x116)]!==undefined)m=l['change'];else l[P(0x144)]!==undefined&&l['previousElo']!==undefined&&(m=l['newElo']-l[P(0x12c)]);m!==undefined&&(b['set'](k,m),console[P(0x10c)](P(0xfe)+k+P(0x125)+m));}}});if(h['size']===0x0){console[M(0x10c)](M(0x14c));const j=collection(db,M(0xf4)),k=query(j,where(M(0xfc),'==','D3'),orderBy('timestamp','desc'),limit(0x32));try{const l=await getDocs(k);console[M(0x10c)]('D3:\x20Found\x20'+l['size']+M(0x153)),l['forEach'](m=>{const Q=M,n=m['data']();let o=n[Q(0xfa)]||n[Q(0x140)];!o&&n[Q(0x117)]&&c['has'](n['player'])&&(o=c[Q(0x10a)](n[Q(0x117)]));if(o&&a[Q(0x15d)](o)){const p=n['change']||(n['newElo']!==undefined&&n['previousElo']!==undefined?n[Q(0x144)]-n[Q(0x12c)]:0x0);p!==0x0&&(b['set'](o,p),console['log'](Q(0xfe)+o+'\x20fallback\x20ELO\x20change:\x20'+p));}});}catch(m){console['log'](M(0x152),m);}}const i=Array['from'](b[M(0x11a)]())[M(0x132)](([n,o])=>o!==0x0);console['log'](M(0x106),i);}catch(n){console[M(0x142)]('D3:\x20Error\x20fetching\x20ELO\x20history:',n);}return b;}export{displayLadderD3,updatePlayerPositions};
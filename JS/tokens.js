const a52_0x156de3=(function(){let _0x5dfa1e=!![];return function(_0x40cc55,_0x2bb96d){const _0x66b95e=_0x5dfa1e?function(){if(_0x2bb96d){const _0x559f92=_0x2bb96d['apply'](_0x40cc55,arguments);return _0x2bb96d=null,_0x559f92;}}:function(){};return _0x5dfa1e=![],_0x66b95e;};}()),a52_0x2d4af7=a52_0x156de3(this,function(){const _0x348030=a52_0x345a,_0x5e54cd=function(){let _0x56ee78;try{_0x56ee78=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x37989e){_0x56ee78=window;}return _0x56ee78;},_0x5a4b3a=_0x5e54cd(),_0x37d2f0=_0x5a4b3a['console']=_0x5a4b3a[_0x348030(0x95)]||{},_0x24469a=['log',_0x348030(0x94),_0x348030(0x8c),_0x348030(0xa1),'exception','table','trace'];for(let _0x2844e8=0x0;_0x2844e8<_0x24469a['length'];_0x2844e8++){const _0x2f6399=a52_0x156de3['constructor']['prototype'][_0x348030(0x8d)](a52_0x156de3),_0x59c8ce=_0x24469a[_0x2844e8],_0x1cf5a8=_0x37d2f0[_0x59c8ce]||_0x2f6399;_0x2f6399['__proto__']=a52_0x156de3['bind'](a52_0x156de3),_0x2f6399['toString']=_0x1cf5a8[_0x348030(0x9d)]['bind'](_0x1cf5a8),_0x37d2f0[_0x59c8ce]=_0x2f6399;}});a52_0x2d4af7();import{doc,getDoc,getDocs,collection}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const tokenCache=new Map(),CACHE_DURATION=0x5*0x3c*0x3e8;function a52_0x377a(){const _0x4f917b=['string','timestamp','map','info','bind','Error\x20fetching\x20tokens\x20by\x20usernames:','Error\x20fetching\x20bulk\x20user\x20tokens:','forEach','all','includes','now','warn','console','exists','purchasedAt','set','🗑️\x20Cleared\x20all\x20token\x20cache','Error\x20fetching\x20user\x20tokens:','from','userTokens','toString','data','tokens_','tokens','error'];a52_0x377a=function(){return _0x4f917b;};return a52_0x377a();}export async function getUserTokens(_0x5641b1){const _0x103a2f=a52_0x345a,_0x5caa9e='tokens_'+_0x5641b1,_0x4f5d51=tokenCache['get'](_0x5caa9e);if(_0x4f5d51&&Date[_0x103a2f(0x93)]()-_0x4f5d51[_0x103a2f(0x8a)]<CACHE_DURATION)return _0x4f5d51['tokens'];try{const _0x42a773=doc(db,'userTokens',_0x5641b1),_0x365dbd=await getDoc(_0x42a773);let _0x2532bd=[];return _0x365dbd[_0x103a2f(0x96)]()&&(_0x2532bd=_0x365dbd[_0x103a2f(0x9e)]()['tokens']||[]),tokenCache['set'](_0x5caa9e,{'tokens':_0x2532bd,'timestamp':Date['now']()}),_0x2532bd;}catch(_0x54e67e){return console['error'](_0x103a2f(0x9a),_0x54e67e),[];}}export async function getBulkUserTokens(_0xc35c98){const _0x5e5f26=a52_0x345a,_0x3c56d2=new Map(),_0x4338ee=[];_0xc35c98['forEach'](_0x2c6517=>{const _0xb12484=a52_0x345a,_0x2b614b='tokens_'+_0x2c6517,_0x3d1b4d=tokenCache['get'](_0x2b614b);_0x3d1b4d&&Date['now']()-_0x3d1b4d['timestamp']<CACHE_DURATION?_0x3c56d2['set'](_0x2c6517,_0x3d1b4d[_0xb12484(0xa0)]):_0x4338ee['push'](_0x2c6517);});if(_0x4338ee['length']>0x0)try{const _0x48e568=_0x4338ee[_0x5e5f26(0x8b)](async _0x922931=>{const _0x521f1d=_0x5e5f26,_0x2a89d1=doc(db,_0x521f1d(0x9c),_0x922931),_0x3e4702=await getDoc(_0x2a89d1);let _0x3783c2=[];_0x3e4702[_0x521f1d(0x96)]()&&(_0x3783c2=_0x3e4702[_0x521f1d(0x9e)]()['tokens']||[]);const _0x43c56a='tokens_'+_0x922931;return tokenCache['set'](_0x43c56a,{'tokens':_0x3783c2,'timestamp':Date['now']()}),[_0x922931,_0x3783c2];}),_0x107c58=await Promise[_0x5e5f26(0x91)](_0x48e568);_0x107c58['forEach'](([_0x54bce9,_0x27e7c9])=>{_0x3c56d2['set'](_0x54bce9,_0x27e7c9);});}catch(_0x34075c){console['error'](_0x5e5f26(0x8f),_0x34075c);}return _0x3c56d2;}export async function getTokensByUsernames(_0x572972){const _0x4b7d2d=a52_0x345a,_0x5d88a7=new Map();try{const _0x23089e=collection(db,'userProfiles'),_0x5ae16d=await getDocs(_0x23089e),_0x1e078e=new Map();_0x5ae16d[_0x4b7d2d(0x90)](_0x3c6e22=>{const _0xa023d8=_0x4b7d2d,_0x160a3c=_0x3c6e22['data']();_0x160a3c['username']&&_0x572972[_0xa023d8(0x92)](_0x160a3c['username'])&&_0x1e078e['set'](_0x160a3c['username'],_0x3c6e22['id']);});const _0x208c82=Array[_0x4b7d2d(0x9b)](_0x1e078e['values']());if(_0x208c82['length']>0x0){const _0x1c8b34=await getBulkUserTokens(_0x208c82);_0x1e078e['forEach']((_0x2047f6,_0x5d66fa)=>{const _0x5ae2d7=_0x4b7d2d,_0x230054=_0x1c8b34['get'](_0x2047f6)||[];_0x5d88a7[_0x5ae2d7(0x98)](_0x5d66fa,_0x230054);});}}catch(_0x1a68b1){console['error'](_0x4b7d2d(0x8e),_0x1a68b1);}return _0x5d88a7;}export function clearTokenCache(_0x23e7af=null){const _0x4b7373=a52_0x345a;if(_0x23e7af){const _0x4a2d72=_0x4b7373(0x9f)+_0x23e7af;tokenCache['delete'](_0x4a2d72),console['log']('🗑️\x20Cleared\x20token\x20cache\x20for\x20user:\x20'+_0x23e7af);}else tokenCache['clear'](),console['log'](_0x4b7373(0x99));}export async function forceRefreshUserTokens(_0x57be84){return clearTokenCache(_0x57be84),await getUserTokens(_0x57be84);}function a52_0x345a(_0x216971,_0x35464c){const _0x2d4af7=a52_0x377a();return a52_0x345a=function(_0x156de3,_0x362599){_0x156de3=_0x156de3-0x89;let _0x377aa7=_0x2d4af7[_0x156de3];return _0x377aa7;},a52_0x345a(_0x216971,_0x35464c);}export function getPrimaryDisplayToken(_0x4d4d16){if(!_0x4d4d16||_0x4d4d16['length']===0x0)return null;const _0xe8cc6f=_0x4d4d16['find'](_0x5d5331=>_0x5d5331['equipped']===!![]);if(_0xe8cc6f)return _0xe8cc6f;const _0x18aeda=[..._0x4d4d16]['sort']((_0x48802b,_0x490fb0)=>{const _0x219ae6=a52_0x345a;let _0xf75208,_0x2e2395;if(_0x48802b['purchasedAt']){if(_0x48802b['purchasedAt']['seconds'])_0xf75208=_0x48802b['purchasedAt']['seconds'];else{if(_0x48802b['purchasedAt']instanceof Date)_0xf75208=_0x48802b[_0x219ae6(0x97)]['getTime']()/0x3e8;else typeof _0x48802b[_0x219ae6(0x97)]==='string'?_0xf75208=new Date(_0x48802b['purchasedAt'])['getTime']()/0x3e8:_0xf75208=0x0;}}else _0xf75208=0x0;if(_0x490fb0[_0x219ae6(0x97)]){if(_0x490fb0['purchasedAt']['seconds'])_0x2e2395=_0x490fb0['purchasedAt']['seconds'];else{if(_0x490fb0['purchasedAt']instanceof Date)_0x2e2395=_0x490fb0['purchasedAt']['getTime']()/0x3e8;else typeof _0x490fb0['purchasedAt']===_0x219ae6(0x89)?_0x2e2395=new Date(_0x490fb0[_0x219ae6(0x97)])['getTime']()/0x3e8:_0x2e2395=0x0;}}else _0x2e2395=0x0;return _0x2e2395-_0xf75208;});return _0x18aeda[0x0];}
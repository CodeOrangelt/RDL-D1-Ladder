const a12_0x2ad4e8=a12_0x5296,a12_0x29cc7f=(function(){let _0xa35df0=!![];return function(_0x18b981,_0x1c188a){const _0x3523b1=_0xa35df0?function(){if(_0x1c188a){const _0x2bcabb=_0x1c188a['apply'](_0x18b981,arguments);return _0x1c188a=null,_0x2bcabb;}}:function(){};return _0xa35df0=![],_0x3523b1;};}()),a12_0x3be48e=a12_0x29cc7f(this,function(){const _0x3dfb6f=a12_0x5296;let _0x40dee5;try{const _0x343939=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x40dee5=_0x343939();}catch(_0x307123){_0x40dee5=window;}const _0x10aa35=_0x40dee5['console']=_0x40dee5['console']||{},_0x2972d1=[_0x3dfb6f(0x10a),'warn','info','error','exception','table','trace'];for(let _0x5d0c80=0x0;_0x5d0c80<_0x2972d1['length'];_0x5d0c80++){const _0xbd8d8=a12_0x29cc7f['constructor']['prototype']['bind'](a12_0x29cc7f),_0x5d27f7=_0x2972d1[_0x5d0c80],_0x31979f=_0x10aa35[_0x5d27f7]||_0xbd8d8;_0xbd8d8['__proto__']=a12_0x29cc7f['bind'](a12_0x29cc7f),_0xbd8d8['toString']=_0x31979f['toString']['bind'](_0x31979f),_0x10aa35[_0x5d27f7]=_0xbd8d8;}});a12_0x3be48e();import{getAuth,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{doc,getDoc,collection,query,where,getDocs,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import{isAdmin}from'./admin-check.js';const ADMIN_EMAILS=[a12_0x2ad4e8(0x10f),'Brian2af@outlook.com'],userCache={'uid':null,'username':null,'isAdmin':![],'hasCheckedCollections':![],'lastChecked':0x0,'role':null},invitationCache={'lastCheck':0x0,'pendingCount':0x0,'checkInterval':0x493e0};function updateInboxNotification(_0x15bf66){const _0x271166=a12_0x2ad4e8,_0xf7b4e2=document[_0x271166(0x119)]('inbox-notification');_0xf7b4e2&&(_0x15bf66>0x0?(_0xf7b4e2['style']['display']='inline-block',_0xf7b4e2[_0x271166(0x109)]=_0x15bf66>0x9?'9+':_0x15bf66):_0xf7b4e2['style']['display']='none');}async function checkPendingInvitationsForCurrentUser(_0x2fd7b4){const _0x25e068=a12_0x2ad4e8;try{const _0x4cb79b=Date['now']();if(_0x4cb79b-invitationCache['lastCheck']<invitationCache[_0x25e068(0x102)])return updateInboxNotification(invitationCache['pendingCount']),invitationCache['pendingCount'];invitationCache['lastCheck']=_0x4cb79b;const _0x4d5878=collection(db,'gameInvitations'),_0x173d53=query(_0x4d5878,where(_0x25e068(0x118),'==',_0x2fd7b4),where(_0x25e068(0x12b),'==',_0x25e068(0x10e)),limit(0x5)),_0x230f3d=await getDocs(_0x173d53),_0x43791c=_0x230f3d['size'];return invitationCache[_0x25e068(0x128)]=_0x43791c,updateInboxNotification(_0x43791c),_0x43791c;}catch(_0xcdc081){return console['warn']('Could\x20not\x20check\x20pending\x20invitations\x20for\x20current\x20user:',_0xcdc081),0x0;}}function updateAuthSectionImmediate(_0x519d36,_0x58925f=![]){const _0x3f3259=a12_0x2ad4e8,_0x37f7d5=document['getElementById']('auth-section');if(!_0x37f7d5)return;if(_0x519d36&&_0x58925f)document['querySelectorAll'](_0x3f3259(0xfd))['forEach'](_0x2fb21b=>{const _0x1d0f20=_0x3f3259;_0x2fb21b[_0x1d0f20(0xfc)][_0x1d0f20(0x116)]='block';});else!_0x519d36&&document['querySelectorAll'](_0x3f3259(0xfd))[_0x3f3259(0x108)](_0x3f4cc9=>{_0x3f4cc9['style']['display']='none';});if(_0x519d36){const _0x1f7b67=userCache['username']||(_0x519d36[_0x3f3259(0x100)]?_0x519d36[_0x3f3259(0x100)]['split']('@')[0x0]:_0x3f3259(0x112)),_0x4d3371=userCache['role']?'\x20('+userCache['role']+')':_0x58925f?'\x20(Admin)':'';_0x37f7d5['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20class=\x22nav-username\x22>'+_0x1f7b67+_0x4d3371+'</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username='+encodeURIComponent(_0x1f7b67)+_0x3f3259(0x11e);const _0x4c2448=document['getElementById']('logout-link');_0x4c2448&&_0x4c2448[_0x3f3259(0x103)]('click',_0x3e5b99=>{_0x3e5b99['preventDefault']();const _0x382984=getAuth();updateAuthSectionImmediate(null),_0x382984['signOut']()['catch'](_0x2f9d70=>{console['error']('Error\x20signing\x20out:',_0x2f9d70);});}),_0x519d36['uid']&&setTimeout(()=>{const _0x2e6966=_0x3f3259;checkPendingInvitationsForCurrentUser(_0x519d36[_0x2e6966(0x125)]);},0x3e8);}else _0x37f7d5['innerHTML']='<a\x20href=\x22login.html\x22\x20class=\x22login-link\x22>Login</a>';}async function checkAdminRoles(_0xb020b7){const _0x5dfebc=a12_0x2ad4e8;if(!_0xb020b7||!_0xb020b7['email'])return{'isAdmin':![],'role':null};try{console['log']('Checking\x20roles\x20for\x20user:\x20'+_0xb020b7['email']);const _0x4e5c35=[_0x5dfebc(0x12c),'playersD2',_0x5dfebc(0x11a),'nonParticipants',_0x5dfebc(0x106)],_0xb93483=['council','creative\x20lead',_0x5dfebc(0x11f),'admin'];for(const _0x3f35bb of _0x4e5c35){try{const _0x1340e2=doc(db,_0x3f35bb,_0xb020b7[_0x5dfebc(0x125)]),_0x369a98=await getDoc(_0x1340e2);if(_0x369a98[_0x5dfebc(0x107)]()){const _0x31bab8=_0x369a98['data']();console[_0x5dfebc(0x10a)]('Found\x20user\x20in\x20'+_0x3f35bb+'\x20by\x20UID:',_0x31bab8);let _0xfa95b5=(_0x31bab8[_0x5dfebc(0x113)]||_0x31bab8[_0x5dfebc(0x129)]||'')['toLowerCase'](),_0x306cbf=_0x31bab8['roleName']||_0x31bab8[_0x5dfebc(0x129)]||'';if(_0xfa95b5&&_0xb93483['includes'](_0xfa95b5)){console[_0x5dfebc(0x10a)](_0x5dfebc(0x115)+_0xfa95b5+'\x20in\x20'+_0x3f35bb);const _0x1ad55f=_0x306cbf['split']('\x20')[_0x5dfebc(0x11d)](_0x11662a=>_0x11662a[_0x5dfebc(0xff)](0x0)['toUpperCase']()+_0x11662a['slice'](0x1)['toLowerCase']())['join']('\x20');return{'isAdmin':!![],'role':_0x1ad55f};}}}catch(_0x150ea7){console['error']('Error\x20checking\x20'+_0x3f35bb+'\x20by\x20UID:',_0x150ea7);}}for(const _0x42dbd7 of _0x4e5c35){try{const _0xd19618=collection(db,_0x42dbd7);let _0x44ac17=query(_0xd19618,where(_0x5dfebc(0x100),'==',_0xb020b7['email'])),_0xf886fa=await getDocs(_0x44ac17);_0xf886fa['empty']&&(_0x44ac17=query(_0xd19618,where(_0x5dfebc(0x100),'==',_0xb020b7['email'][_0x5dfebc(0x10c)]())),_0xf886fa=await getDocs(_0x44ac17));if(!_0xf886fa[_0x5dfebc(0x12a)]){const _0xdc723d=_0xf886fa['docs'][0x0][_0x5dfebc(0x123)]();console['log'](_0x5dfebc(0x120)+_0x42dbd7+'\x20by\x20email:',_0xdc723d);let _0x502314=(_0xdc723d['roleName']||_0xdc723d[_0x5dfebc(0x129)]||'')[_0x5dfebc(0x10c)](),_0x472901=_0xdc723d['roleName']||_0xdc723d['role']||'';if(_0x502314&&_0xb93483['includes'](_0x502314)){console['log'](_0x5dfebc(0x115)+_0x502314+_0x5dfebc(0x117)+_0x42dbd7);const _0x40bfeb=_0x472901['split']('\x20')['map'](_0x49c615=>_0x49c615['charAt'](0x0)['toUpperCase']()+_0x49c615['slice'](0x1)['toLowerCase']())['join']('\x20');return{'isAdmin':!![],'role':_0x40bfeb};}}}catch(_0x5a2b7c){console[_0x5dfebc(0x124)](_0x5dfebc(0x111)+_0x42dbd7+'\x20by\x20email:',_0x5a2b7c);}}return console[_0x5dfebc(0x10a)]('No\x20admin\x20roles\x20found\x20for\x20user'),{'isAdmin':![],'role':null};}catch(_0x507388){return console['error'](_0x5dfebc(0xfe),_0x507388),{'isAdmin':![],'role':null};}}async function updateAuthSection(_0x203a97){const _0x44399f=a12_0x2ad4e8,_0x5d10b9=_0x203a97&&isAdmin(_0x203a97['email']);updateAuthSectionImmediate(_0x203a97,_0x5d10b9);if(!_0x203a97){userCache[_0x44399f(0x125)]=null,userCache[_0x44399f(0x11c)]=null,userCache['isAdmin']=![],userCache[_0x44399f(0x126)]=![],userCache['role']=null;return;}const _0x35b7e7=Date['now']();if(_0x203a97['uid']===userCache[_0x44399f(0x125)]&&userCache['hasCheckedCollections']&&_0x35b7e7-userCache['lastChecked']<0x493e0)return;try{userCache['uid']=_0x203a97[_0x44399f(0x125)],userCache['lastChecked']=_0x35b7e7;const _0x87bc42=isAdmin(_0x203a97['email']);userCache['isAdmin']=_0x87bc42;if(!_0x87bc42){const {isAdmin:_0x129bbb,role:_0x3b9adc}=await checkAdminRoles(_0x203a97);userCache[_0x44399f(0x105)]=_0x129bbb,userCache['role']=_0x3b9adc,_0x129bbb&&(document['querySelectorAll']('.admin-only')[_0x44399f(0x108)](_0x5e726b=>{_0x5e726b['style']['display']='block';}),updateAuthSectionImmediate(_0x203a97,!![]));}const _0x3475a3=['players',_0x44399f(0x10b),_0x44399f(0x11a),_0x44399f(0x114),_0x44399f(0x11b),_0x44399f(0x104),'userProfiles'],_0x2bbca3=_0x3475a3['map'](_0x55e313=>getDoc(doc(db,_0x55e313,_0x203a97[_0x44399f(0x125)]))['then'](_0x5a01ed=>_0x5a01ed['exists']()?{'collection':_0x55e313,'data':_0x5a01ed['data']()}:null)['catch'](()=>null)),_0x4f02a0=await Promise['all'](_0x2bbca3),_0x32973c=_0x4f02a0[_0x44399f(0x121)](_0x160e23=>_0x160e23!==null);let _0x2ecc48=null;for(const _0x4e5f0c of _0x32973c){if(_0x4e5f0c['data'][_0x44399f(0x11c)]){_0x2ecc48=_0x4e5f0c['data']['username'];break;}}userCache['username']=_0x2ecc48||(_0x203a97['email']?_0x203a97[_0x44399f(0x100)]['split']('@')[0x0]:'User'),userCache['hasCheckedCollections']=!![],updateAuthSectionImmediate(_0x203a97,userCache['isAdmin']),setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0x203a97['uid']);},0x1f4);}catch(_0x1ebfa5){console['error'](_0x44399f(0x122),_0x1ebfa5);}}document['addEventListener']('DOMContentLoaded',()=>{const _0xfc8bd4=a12_0x2ad4e8,_0x20431a=getAuth();onAuthStateChanged(_0x20431a,async _0x2ad67d=>{await updateAuthSection(_0x2ad67d),_0x2ad67d&&checkPendingInvitationsForCurrentUser(_0x2ad67d['uid']);}),document['addEventListener']('visibilitychange',()=>{const _0x15e4e3=a12_0x5296;!document[_0x15e4e3(0x101)]&&_0x20431a[_0x15e4e3(0x110)]&&checkPendingInvitationsForCurrentUser(_0x20431a[_0x15e4e3(0x110)]['uid']);}),document['addEventListener'](_0xfc8bd4(0x127),_0x2263f2=>{const _0x41e332=_0xfc8bd4;_0x2263f2[_0x41e332(0x10d)]['closest']('a[href]')&&_0x20431a[_0x41e332(0x110)]&&checkPendingInvitationsForCurrentUser(_0x20431a[_0x41e332(0x110)]['uid']);});});export{updateAuthSection};function a12_0x5296(_0x327133,_0x4eeab2){const _0x3be48e=a12_0x5329();return a12_0x5296=function(_0x29cc7f,_0x72416e){_0x29cc7f=_0x29cc7f-0xfc;let _0x532932=_0x3be48e[_0x29cc7f];return _0x532932;},a12_0x5296(_0x327133,_0x4eeab2);}function a12_0x5329(){const _0x13e25f=['style','.admin-only','Error\x20in\x20checkAdminRoles:','charAt','email','hidden','checkInterval','addEventListener','nonParticipants','isAdmin','userProfiles','exists','forEach','textContent','log','playersD2','toLowerCase','target','pending','admin@ladder.com','currentUser','Error\x20checking\x20','User','roleName','playersDuos','Found\x20admin\x20role:\x20','display','\x20in\x20','toUserId','getElementById','playersD3','playersCTF','username','map','\x22>Profile</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./inbox.html\x22\x20class=\x22nav-notification\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Inbox\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22inbox-notification\x22\x20class=\x22notification-dot\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22members.html\x22>Members</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./redeem.html\x22><i\x20class=\x22fas\x20fa-gift\x22></i>\x20Redeem</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20id=\x22logout-link\x22>Sign\x20Out</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','owner','Found\x20user\x20in\x20','filter','Error\x20in\x20full\x20auth\x20update:','data','error','uid','hasCheckedCollections','click','pendingCount','role','empty','status','players'];a12_0x5329=function(){return _0x13e25f;};return a12_0x5329();}
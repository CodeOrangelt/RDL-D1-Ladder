const a58_0x27e0d5=(function(){let _0x55e7a8=!![];return function(_0x5b425c,_0x132bb3){const _0x2dd3e7=_0x55e7a8?function(){const _0x3ebb19=a58_0x27b6;if(_0x132bb3){const _0x4a71c8=_0x132bb3[_0x3ebb19(0x1c5)](_0x5b425c,arguments);return _0x132bb3=null,_0x4a71c8;}}:function(){};return _0x55e7a8=![],_0x2dd3e7;};}()),a58_0x364af4=a58_0x27e0d5(this,function(){const _0x11cc46=a58_0x27b6,_0x2e3040=function(){const _0x111dcf=a58_0x27b6;let _0x10bf7e;try{_0x10bf7e=Function(_0x111dcf(0x1cf)+_0x111dcf(0x1c3)+');')();}catch(_0x489eeb){_0x10bf7e=window;}return _0x10bf7e;},_0x24bcc5=_0x2e3040(),_0x1b3e02=_0x24bcc5['console']=_0x24bcc5['console']||{},_0x381cf0=['log','warn','info','error','exception',_0x11cc46(0x1c8),'trace'];for(let _0xa298a6=0x0;_0xa298a6<_0x381cf0['length'];_0xa298a6++){const _0x5dfcc5=a58_0x27e0d5['constructor'][_0x11cc46(0x1cd)]['bind'](a58_0x27e0d5),_0x3477ca=_0x381cf0[_0xa298a6],_0x58b718=_0x1b3e02[_0x3477ca]||_0x5dfcc5;_0x5dfcc5['__proto__']=a58_0x27e0d5[_0x11cc46(0x1d0)](a58_0x27e0d5),_0x5dfcc5['toString']=_0x58b718['toString'][_0x11cc46(0x1d0)](_0x58b718),_0x1b3e02[_0x3477ca]=_0x5dfcc5;}});a58_0x364af4();function a58_0x239c(){const _0x84ec85=['{}.constructor(\x22return\x20this\x22)(\x20)','clear','apply','seconds','🗑️\x20Cleared\x20all\x20token\x20cache','table','get','purchasedAt','tokens_','log','prototype','length','return\x20(function()\x20','bind','values','set','find','userProfiles','forEach','data','tokens','timestamp','userTokens'];a58_0x239c=function(){return _0x84ec85;};return a58_0x239c();}import{doc,getDoc,getDocs,collection}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const tokenCache=new Map(),CACHE_DURATION=0x5*0x3c*0x3e8;export async function getUserTokens(_0x84061b){const _0xb99426=a58_0x27b6,_0x47776d='tokens_'+_0x84061b,_0x295986=tokenCache[_0xb99426(0x1c9)](_0x47776d);if(_0x295986&&Date['now']()-_0x295986['timestamp']<CACHE_DURATION)return _0x295986['tokens'];try{const _0x387293=doc(db,'userTokens',_0x84061b),_0x151e4c=await getDoc(_0x387293);let _0x2fb205=[];return _0x151e4c['exists']()&&(_0x2fb205=_0x151e4c['data']()['tokens']||[]),tokenCache['set'](_0x47776d,{'tokens':_0x2fb205,'timestamp':Date['now']()}),_0x2fb205;}catch(_0xf3c62a){return console['error']('Error\x20fetching\x20user\x20tokens:',_0xf3c62a),[];}}export async function getBulkUserTokens(_0x58880e){const _0x2d1c45=a58_0x27b6,_0x11d6d4=new Map(),_0x2cad3c=[];_0x58880e['forEach'](_0x42da47=>{const _0xda77fa=a58_0x27b6,_0x4813e8='tokens_'+_0x42da47,_0x489736=tokenCache['get'](_0x4813e8);_0x489736&&Date['now']()-_0x489736[_0xda77fa(0x1d8)]<CACHE_DURATION?_0x11d6d4[_0xda77fa(0x1d2)](_0x42da47,_0x489736[_0xda77fa(0x1d7)]):_0x2cad3c['push'](_0x42da47);});if(_0x2cad3c['length']>0x0)try{const _0x4299b8=_0x2cad3c['map'](async _0x9c3049=>{const _0x2012a7=a58_0x27b6,_0x15462d=doc(db,_0x2012a7(0x1d9),_0x9c3049),_0x39fd61=await getDoc(_0x15462d);let _0x533f4a=[];_0x39fd61['exists']()&&(_0x533f4a=_0x39fd61['data']()[_0x2012a7(0x1d7)]||[]);const _0x9325e='tokens_'+_0x9c3049;return tokenCache['set'](_0x9325e,{'tokens':_0x533f4a,'timestamp':Date['now']()}),[_0x9c3049,_0x533f4a];}),_0x1f9beb=await Promise['all'](_0x4299b8);_0x1f9beb[_0x2d1c45(0x1d5)](([_0x4987de,_0x1cdb48])=>{_0x11d6d4['set'](_0x4987de,_0x1cdb48);});}catch(_0x208233){console['error']('Error\x20fetching\x20bulk\x20user\x20tokens:',_0x208233);}return _0x11d6d4;}export async function getTokensByUsernames(_0x2bbfea){const _0x34d912=a58_0x27b6,_0xf84c21=new Map();try{const _0x24572a=collection(db,_0x34d912(0x1d4)),_0x30067d=await getDocs(_0x24572a),_0x1568c2=new Map();_0x30067d['forEach'](_0x848d1e=>{const _0x27ec98=_0x34d912,_0x5b45d9=_0x848d1e[_0x27ec98(0x1d6)]();_0x5b45d9['username']&&_0x2bbfea['includes'](_0x5b45d9['username'])&&_0x1568c2[_0x27ec98(0x1d2)](_0x5b45d9['username'],_0x848d1e['id']);});const _0x307d9a=Array['from'](_0x1568c2[_0x34d912(0x1d1)]());if(_0x307d9a[_0x34d912(0x1ce)]>0x0){const _0x5a2c41=await getBulkUserTokens(_0x307d9a);_0x1568c2[_0x34d912(0x1d5)]((_0x257727,_0x1b05a0)=>{const _0x233317=_0x5a2c41['get'](_0x257727)||[];_0xf84c21['set'](_0x1b05a0,_0x233317);});}}catch(_0xe4781b){console['error']('Error\x20fetching\x20tokens\x20by\x20usernames:',_0xe4781b);}return _0xf84c21;}export function clearTokenCache(_0x10f7f6=null){const _0x34a049=a58_0x27b6;if(_0x10f7f6){const _0x532f08=_0x34a049(0x1cb)+_0x10f7f6;tokenCache['delete'](_0x532f08),console['log']('🗑️\x20Cleared\x20token\x20cache\x20for\x20user:\x20'+_0x10f7f6);}else tokenCache[_0x34a049(0x1c4)](),console[_0x34a049(0x1cc)](_0x34a049(0x1c7));}function a58_0x27b6(_0x488416,_0x4fbbd6){const _0x364af4=a58_0x239c();return a58_0x27b6=function(_0x27e0d5,_0x56a7fb){_0x27e0d5=_0x27e0d5-0x1c3;let _0x239c3e=_0x364af4[_0x27e0d5];return _0x239c3e;},a58_0x27b6(_0x488416,_0x4fbbd6);}export async function forceRefreshUserTokens(_0x29ebbd){return clearTokenCache(_0x29ebbd),await getUserTokens(_0x29ebbd);}export function getPrimaryDisplayToken(_0x529779){const _0x4eedaa=a58_0x27b6;if(!_0x529779||_0x529779['length']===0x0)return null;const _0x584d1c=_0x529779[_0x4eedaa(0x1d3)](_0x4b054d=>_0x4b054d['equipped']===!![]);if(_0x584d1c)return _0x584d1c;const _0x5db416=[..._0x529779]['sort']((_0x49d681,_0xc7504c)=>{const _0x1bcdc3=_0x4eedaa;let _0x58f214,_0x24031c;if(_0x49d681['purchasedAt']){if(_0x49d681['purchasedAt'][_0x1bcdc3(0x1c6)])_0x58f214=_0x49d681[_0x1bcdc3(0x1ca)]['seconds'];else{if(_0x49d681['purchasedAt']instanceof Date)_0x58f214=_0x49d681[_0x1bcdc3(0x1ca)]['getTime']()/0x3e8;else typeof _0x49d681['purchasedAt']==='string'?_0x58f214=new Date(_0x49d681[_0x1bcdc3(0x1ca)])['getTime']()/0x3e8:_0x58f214=0x0;}}else _0x58f214=0x0;if(_0xc7504c[_0x1bcdc3(0x1ca)]){if(_0xc7504c[_0x1bcdc3(0x1ca)]['seconds'])_0x24031c=_0xc7504c[_0x1bcdc3(0x1ca)][_0x1bcdc3(0x1c6)];else{if(_0xc7504c['purchasedAt']instanceof Date)_0x24031c=_0xc7504c['purchasedAt']['getTime']()/0x3e8;else typeof _0xc7504c[_0x1bcdc3(0x1ca)]==='string'?_0x24031c=new Date(_0xc7504c['purchasedAt'])['getTime']()/0x3e8:_0x24031c=0x0;}}else _0x24031c=0x0;return _0x24031c-_0x58f214;});return _0x5db416[0x0];}
const a38_0x2a3fa6=a38_0x40b1,a38_0x3d192d=(function(){let _0x1274bf=!![];return function(_0x4a6db2,_0x195fbb){const _0x2124eb=_0x1274bf?function(){if(_0x195fbb){const _0x289435=_0x195fbb['apply'](_0x4a6db2,arguments);return _0x195fbb=null,_0x289435;}}:function(){};return _0x1274bf=![],_0x2124eb;};}()),a38_0x1cd245=a38_0x3d192d(this,function(){const _0x5a254c=a38_0x40b1,_0x142324=function(){const _0x49f948=a38_0x40b1;let _0x4f19bc;try{_0x4f19bc=Function(_0x49f948(0x85)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x2889c4){_0x4f19bc=window;}return _0x4f19bc;},_0x1d9add=_0x142324(),_0x273800=_0x1d9add['console']=_0x1d9add[_0x5a254c(0x7b)]||{},_0x29418b=[_0x5a254c(0x8e),'warn','info',_0x5a254c(0x83),'exception',_0x5a254c(0x81),'trace'];for(let _0x12387f=0x0;_0x12387f<_0x29418b['length'];_0x12387f++){const _0x2ea423=a38_0x3d192d['constructor'][_0x5a254c(0x77)]['bind'](a38_0x3d192d),_0x5b864d=_0x29418b[_0x12387f],_0x500e24=_0x273800[_0x5b864d]||_0x2ea423;_0x2ea423['__proto__']=a38_0x3d192d['bind'](a38_0x3d192d),_0x2ea423['toString']=_0x500e24['toString']['bind'](_0x500e24),_0x273800[_0x5b864d]=_0x2ea423;}});a38_0x1cd245();function a38_0x40b1(_0x427dcc,_0x3af14f){const _0x1cd245=a38_0x1436();return a38_0x40b1=function(_0x3d192d,_0x47461a){_0x3d192d=_0x3d192d-0x77;let _0x143617=_0x1cd245[_0x3d192d];return _0x143617;},a38_0x40b1(_0x427dcc,_0x3af14f);}const functions=require('firebase-functions'),admin=require('firebase-admin');admin['initializeApp']();const db=admin['firestore']();exports['updateMembersList']=functions['firestore']['document']('{collection}/{docId}')['onWrite'](async(_0x44f0fd,_0x2d5c20)=>{const _0x445fbf=a38_0x40b1,_0x32aa80=_0x2d5c20['params']['collection'],_0x5cce60=_0x2d5c20['params']['docId'];if(!['players','playersD2','playersD3','userProfiles','nonParticipants']['includes'](_0x32aa80))return null;try{await rebuildMembersList(),console[_0x445fbf(0x8e)]('Successfully\x20updated\x20aggregated\x20members\x20list');}catch(_0x3a0f31){console['error'](_0x445fbf(0x88),_0x3a0f31);}});async function rebuildMembersList(){const _0x27251d=a38_0x40b1,_0x163ead=db['batch'](),[_0x1271dc,_0xcf60ac,_0x9e9ed8,_0x2e9354,_0x171b41]=await Promise[_0x27251d(0x7c)]([db['collection'](_0x27251d(0x8c))['get'](),db['collection']('players')[_0x27251d(0x78)](),db['collection']('playersD2')['get'](),db[_0x27251d(0x93)](_0x27251d(0x8b))['get'](),db['collection']('nonParticipants')['get']()]),_0x1cd0c8=new Map();_0x1271dc['forEach'](_0x47e1b8=>{const _0x44c7ef=_0x27251d;_0x1cd0c8[_0x44c7ef(0x7e)](_0x47e1b8['id'],_0x47e1b8['data']());});const _0x470fd3=new Map(),_0x5d93d5=(_0x1075ff,_0x41f6fe)=>{const _0x4edbf4=_0x27251d;_0x1075ff[_0x4edbf4(0x8a)](_0x1720ce=>{const _0x3fed66=_0x1720ce['data'](),_0x5be6d6=_0x1720ce['id'];!_0x470fd3['has'](_0x5be6d6)&&_0x470fd3['set'](_0x5be6d6,{'userId':_0x5be6d6,'username':_0x3fed66['username']||'Unknown','ladders':[],'isNonParticipant':![]});const _0x3ad453=_0x470fd3['get'](_0x5be6d6);_0x3ad453['ladders']['push']({'ladder':_0x41f6fe,'elo':_0x3fed66['eloRating']||0x4b0,'active':_0x3fed66['active']!==![]});});};_0x5d93d5(_0xcf60ac,'D1'),_0x5d93d5(_0x9e9ed8,'D2'),_0x5d93d5(_0x2e9354,'D3'),_0x171b41['forEach'](_0x5ed60a=>{const _0xf574a9=_0x27251d,_0x51e33b=_0x5ed60a['data'](),_0x2f13f6=_0x5ed60a['id'];!_0x470fd3['has'](_0x2f13f6)&&_0x51e33b[_0xf574a9(0x86)]&&_0x470fd3[_0xf574a9(0x7e)](_0x2f13f6,{'userId':_0x2f13f6,'username':_0x51e33b[_0xf574a9(0x86)],'ladders':[],'isNonParticipant':!![]});});const _0x5e4d57=[];_0x470fd3['forEach']((_0x2b2d6c,_0x1a4a4a)=>{const _0x5c27bc=_0x27251d,_0x337503=_0x1cd0c8[_0x5c27bc(0x78)](_0x1a4a4a)||{};let _0x234e2=0x0,_0x47a913=null;if(_0x2b2d6c['ladders']['length']>0x0){const _0x327e5a=_0x2b2d6c['ladders'][_0x5c27bc(0x7f)]((_0x2ee61b,_0x5cc63e)=>_0x5cc63e['elo']-_0x2ee61b['elo']);_0x234e2=_0x327e5a[0x0]['elo'],_0x47a913=_0x327e5a[0x0]['ladder'];}const _0x578e09={'userId':_0x1a4a4a,'username':_0x2b2d6c[_0x5c27bc(0x86)],'profileImageUrl':_0x337503['profileImageUrl']||null,'country':_0x337503[_0x5c27bc(0x7a)]||null,'motto':_0x337503[_0x5c27bc(0x8f)]||null,'favoriteMap':_0x337503[_0x5c27bc(0x84)]||null,'favoriteWeapon':_0x337503['favoriteWeapon']||null,'isNonParticipant':_0x2b2d6c['isNonParticipant'],'ladders':_0x2b2d6c['ladders'],'primaryLadder':_0x47a913,'highestElo':_0x234e2,'rank':getPlayerRank(_0x234e2),'lastUpdated':admin['firestore']['FieldValue'][_0x5c27bc(0x82)]()};_0x5e4d57[_0x5c27bc(0x7d)](_0x578e09);});const _0x35c8c1=db['collection']('aggregatedMembers'),_0x2ec946=await _0x35c8c1['get'](),_0x3726ef=[];_0x2ec946['forEach'](_0x5d19f2=>{_0x3726ef['push'](_0x5d19f2['ref']['delete']());}),await Promise['all'](_0x3726ef);const _0xfa75c2=0x1f4,_0x19c128=[];for(let _0x52c238=0x0;_0x52c238<_0x5e4d57[_0x27251d(0x8d)];_0x52c238+=_0xfa75c2){const _0x2e55ab=db[_0x27251d(0x79)](),_0x4b43f2=_0x5e4d57['slice'](_0x52c238,_0x52c238+_0xfa75c2);_0x4b43f2['forEach'](_0x449d75=>{const _0xcf26a6=_0x27251d,_0x2ae98e=_0x35c8c1[_0xcf26a6(0x87)](_0x449d75['userId']);_0x2e55ab[_0xcf26a6(0x7e)](_0x2ae98e,_0x449d75);}),_0x19c128['push'](_0x2e55ab['commit']());}await Promise['all'](_0x19c128);}function getPlayerRank(_0x59ecc4){const _0x568ef6=a38_0x40b1;if(_0x59ecc4>=0x7d0)return'emerald';if(_0x59ecc4>=0x708)return'gold';if(_0x59ecc4>=0x640)return'silver';if(_0x59ecc4>=0x578)return _0x568ef6(0x89);return'unranked';}function a38_0x1436(){const _0x3bb2dc=['prototype','get','batch','country','console','all','push','set','sort','status','table','serverTimestamp','error','favoriteMap','return\x20(function()\x20','username','doc','Error\x20updating\x20members\x20list:','bronze','forEach','playersD3','userProfiles','length','log','motto','Members\x20list\x20rebuilt\x20successfully','rebuildMembersListManual','send','collection'];a38_0x1436=function(){return _0x3bb2dc;};return a38_0x1436();}exports[a38_0x2a3fa6(0x91)]=functions['https']['onRequest'](async(_0xf447b0,_0x1fc9f2)=>{const _0x756c6c=a38_0x2a3fa6;try{await rebuildMembersList(),_0x1fc9f2['status'](0xc8)[_0x756c6c(0x92)](_0x756c6c(0x90));}catch(_0x53ee50){console['error']('Error\x20rebuilding\x20members\x20list:',_0x53ee50),_0x1fc9f2[_0x756c6c(0x80)](0x1f4)['send']('Error\x20rebuilding\x20members\x20list');}});
const a0_0x525db6=a0_0x3dae;(function(_0x13da1b,_0x5483bf){const _0x2e1cf8=a0_0x3dae,_0x430fa9=_0x13da1b();while(!![]){try{const _0x2cfa8f=-parseInt(_0x2e1cf8(0x167))/0x1*(parseInt(_0x2e1cf8(0x15c))/0x2)+-parseInt(_0x2e1cf8(0x12d))/0x3*(parseInt(_0x2e1cf8(0x143))/0x4)+-parseInt(_0x2e1cf8(0x163))/0x5+parseInt(_0x2e1cf8(0x144))/0x6*(-parseInt(_0x2e1cf8(0x14b))/0x7)+parseInt(_0x2e1cf8(0x18d))/0x8*(parseInt(_0x2e1cf8(0x170))/0x9)+-parseInt(_0x2e1cf8(0x134))/0xa*(parseInt(_0x2e1cf8(0x133))/0xb)+parseInt(_0x2e1cf8(0x12b))/0xc*(parseInt(_0x2e1cf8(0x194))/0xd);if(_0x2cfa8f===_0x5483bf)break;else _0x430fa9['push'](_0x430fa9['shift']());}catch(_0x5ee478){_0x430fa9['push'](_0x430fa9['shift']());}}}(a0_0x5a15,0x60063));const a0_0xd9320a=(function(){let _0x2a73fe=!![];return function(_0x2590ec,_0x357aa4){const _0x2f42ea=_0x2a73fe?function(){if(_0x357aa4){const _0x5e252f=_0x357aa4['apply'](_0x2590ec,arguments);return _0x357aa4=null,_0x5e252f;}}:function(){};return _0x2a73fe=![],_0x2f42ea;};}()),a0_0x5588c8=a0_0xd9320a(this,function(){const _0x273f6a=a0_0x3dae;let _0x2fcc62;try{const _0x44d6d3=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x2fcc62=_0x44d6d3();}catch(_0x21c427){_0x2fcc62=window;}const _0xf6b8f3=_0x2fcc62[_0x273f6a(0x129)]=_0x2fcc62['console']||{},_0x128f77=[_0x273f6a(0x139),'warn','info',_0x273f6a(0x16a),'exception','table','trace'];for(let _0x24aafa=0x0;_0x24aafa<_0x128f77[_0x273f6a(0x127)];_0x24aafa++){const _0x5d76a5=a0_0xd9320a[_0x273f6a(0x157)]['prototype'][_0x273f6a(0x15e)](a0_0xd9320a),_0x4f3353=_0x128f77[_0x24aafa],_0x39615b=_0xf6b8f3[_0x4f3353]||_0x5d76a5;_0x5d76a5['__proto__']=a0_0xd9320a['bind'](a0_0xd9320a),_0x5d76a5['toString']=_0x39615b['toString'][_0x273f6a(0x15e)](_0x39615b),_0xf6b8f3[_0x4f3353]=_0x5d76a5;}});a0_0x5588c8();import{collection,doc,query,where,orderBy,limit,getDocs,addDoc,getDoc,serverTimestamp,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{auth,db}from'./firebase-config.js';function a0_0x3dae(_0x2cdc02,_0x742acf){const _0x1dd8ae=a0_0x5a15();return a0_0x3dae=function(_0x5588c8,_0xd9320a){_0x5588c8=_0x5588c8-0x125;let _0xe96133=_0x1dd8ae[_0x5588c8];return _0xe96133;},a0_0x3dae(_0x2cdc02,_0x742acf);}class PromotionManager{constructor(){const _0x30f375=a0_0x3dae;this[_0x30f375(0x176)]=0x18,this['RANKS']=[{'threshold':0x578,'name':'Bronze','color':'#CD7F32'},{'threshold':0x640,'name':_0x30f375(0x148),'color':_0x30f375(0x183)},{'threshold':0x708,'name':_0x30f375(0x140),'color':'#FFD700'},{'threshold':0x834,'name':'Emerald','color':'#50C878'}],this['bannerContainer']=null,this[_0x30f375(0x18e)]=0x0,this[_0x30f375(0x161)]=0xea60,this['pollingInterval']=null,this['usernameCache']={};}[a0_0x525db6(0x14d)](){const _0x575e12=a0_0x525db6;this['bannerContainer']=document[_0x575e12(0x12a)](_0x575e12(0x136));if(!this['bannerContainer']){console['error'](_0x575e12(0x17a));return;}this['setupBannerContainer']();const _0x9211f8='promotions_checked_'+new Date()[_0x575e12(0x182)](),_0x15015d=sessionStorage['getItem'](_0x9211f8);!_0x15015d&&(this['fetchRecentPromotions'](),sessionStorage['setItem'](_0x9211f8,'true')),document['addEventListener']('visibilitychange',()=>{const _0x7a984a=_0x575e12;document[_0x7a984a(0x13a)]===_0x7a984a(0x132)&&!sessionStorage['getItem'](_0x9211f8)&&(this['fetchRecentPromotions'](),sessionStorage['setItem'](_0x9211f8,_0x7a984a(0x15b)));}),window['addEventListener'](_0x575e12(0x130),()=>{const _0x231fdb=_0x575e12;this[_0x231fdb(0x16d)]&&clearInterval(this[_0x231fdb(0x16d)]);});}['setupBannerContainer'](){const _0x54566a=a0_0x525db6;this['bannerContainer'][_0x54566a(0x13c)]='',this[_0x54566a(0x126)][_0x54566a(0x131)][_0x54566a(0x12e)]='none';}async['fetchRecentPromotions'](){const _0x4aa488=a0_0x525db6;try{const _0x1fee0d=Date['now']();if(_0x1fee0d-this['lastFetchTime']<this['fetchInterval'])return;this['lastFetchTime']=_0x1fee0d;const _0x3b6193=collection(db,'eloHistory'),_0x556da1=query(_0x3b6193,where('type','in',['promotion','demotion']),orderBy('timestamp',_0x4aa488(0x138)),limit(0x14)),_0x37b1a5=await getDocs(_0x556da1),_0x772953=[];_0x37b1a5[_0x4aa488(0x191)](_0x512314=>{const _0x5d688={'id':_0x512314['id'],..._0x512314['data']()};this['shouldShowPromotion'](_0x512314['id'])&&this['isNewRankChange'](_0x5d688)&&_0x772953['push'](_0x5d688);}),_0x772953['length']>0x0&&await this['processRankChanges'](_0x772953);}catch(_0x1b3b36){console['error']('Error\x20fetching\x20promotions:',_0x1b3b36);}}async['processRankChanges'](_0x312926){const _0x39ebca=a0_0x525db6;if(_0x312926['length']===0x0)return;_0x312926['sort']((_0x4b238c,_0xc9b0c)=>{const _0x50a9d9=a0_0x3dae,_0x481419=_0x4b238c['timestamp']?.[_0x50a9d9(0x152)]?.()||_0x4b238c['timestamp']?.['seconds']*0x3e8||0x0,_0x5b75fe=_0xc9b0c['timestamp']?.[_0x50a9d9(0x152)]?.()||_0xc9b0c['timestamp']?.['seconds']*0x3e8||0x0;return _0x5b75fe-_0x481419;});const _0x2a19a4=this['bannerContainer']['children']['length'],_0x26ea0b=0x3-_0x2a19a4;if(_0x26ea0b<=0x0)return;const _0x53f8b1=_0x312926['slice'](0x0,_0x26ea0b);for(let _0x36d736=0x0;_0x36d736<_0x53f8b1['length'];_0x36d736++){const _0x254443=_0x53f8b1[_0x36d736],_0x3c19f9=auth['currentUser'];try{setTimeout(()=>{const _0x1dbed6=a0_0x3dae;this[_0x1dbed6(0x168)](_0x254443);},_0x36d736*0x3e8),_0x3c19f9&&_0x254443['player']===_0x3c19f9['displayName']&&this['showRankChangeLightbox'](_0x254443[_0x39ebca(0x13d)],_0x254443[_0x39ebca(0x145)]);}catch(_0x127a9f){console['error'](_0x39ebca(0x199),_0x127a9f);}}}['shouldShowPromotion'](_0x5e74be){const _0xcb067a=a0_0x525db6;try{const _0x29f5fd=_0xcb067a(0x171)+_0x5e74be,_0x58999c=localStorage['getItem'](_0x29f5fd);if(_0x58999c){let _0x34b7e8;try{_0x34b7e8=JSON[_0xcb067a(0x17e)](_0x58999c);}catch(_0x5d3c72){return console['warn'](_0xcb067a(0x128)+_0x29f5fd+',\x20treating\x20as\x20new'),!![];}if(_0x34b7e8['ignored']===!![])return console[_0xcb067a(0x139)]('Promotion\x20'+_0x5e74be+'\x20is\x20permanently\x20ignored'),![];const _0x3f01af=Date['now']();if(_0x34b7e8['userDismissed']&&_0x3f01af-_0x34b7e8['timestamp']<this['DISPLAY_HOURS']*0x3c*0x3c*0x3e8)return console[_0xcb067a(0x139)](_0xcb067a(0x12f)+_0x5e74be+'\x20was\x20dismissed\x20by\x20user\x20within\x20last\x20'+this['DISPLAY_HOURS']+'\x20hours'),![];if(_0x34b7e8['systemDismissed']&&_0x3f01af-_0x34b7e8['timestamp']<0x4*0x3c*0x3c*0x3e8)return console['log'](_0xcb067a(0x12f)+_0x5e74be+'\x20was\x20auto-dismissed\x20within\x20last\x204\x20hours'),![];}return!![];}catch(_0x494fb5){return console[_0xcb067a(0x16a)](_0xcb067a(0x158),_0x494fb5),![];}}[a0_0x525db6(0x180)](_0x577608){const _0x4f7f04=a0_0x525db6;try{const _0x2353d3='promotion_'+_0x577608;localStorage['setItem'](_0x2353d3,JSON['stringify']({'timestamp':Date[_0x4f7f04(0x18a)](),'ignored':!![]}));}catch(_0x15780d){console[_0x4f7f04(0x16a)]('Error\x20saving\x20promotion\x20preference:',_0x15780d);}}[a0_0x525db6(0x168)](_0x46a0ee){this['resolveUserId'](_0x46a0ee)['then'](_0x3b1ef0=>{const _0x315b08=a0_0x3dae,_0x22cd4c='promotion_'+_0x46a0ee['id'],_0x21f888=localStorage['getItem'](_0x22cd4c);if(_0x21f888)try{const _0x188fe6=JSON['parse'](_0x21f888);if(_0x188fe6['ignored']===!![]){console['log']('Skipping\x20ignored\x20promotion:\x20'+_0x46a0ee['id']);return;}}catch(_0x118632){}localStorage[_0x315b08(0x135)](_0x22cd4c,JSON[_0x315b08(0x166)]({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':![],'seenAt':Date['now']()})),this[_0x315b08(0x126)]['style']['display']='block';while(this['bannerContainer'][_0x315b08(0x13e)][_0x315b08(0x127)]>=0x3){this[_0x315b08(0x126)]['removeChild'](this['bannerContainer']['firstChild']);}const _0x4155f5=document[_0x315b08(0x153)](_0x315b08(0x198));_0x4155f5[_0x315b08(0x196)]='promotion-banner',_0x4155f5[_0x315b08(0x16c)]('data-rank',_0x3b1ef0[_0x315b08(0x145)]),_0x4155f5['setAttribute']('data-id',_0x3b1ef0['id']);const _0xbebe95=document['createElement']('div');_0xbebe95['className']=_0x315b08(0x14f);const _0x5a80f4=_0x3b1ef0['resolvedName']||_0x3b1ef0[_0x315b08(0x151)]||_0x3b1ef0['username']||_0x3b1ef0['playerUsername']||_0x3b1ef0['displayName']||'A\x20player',_0x193505=_0x3b1ef0['type']==='promotion'?_0x5a80f4+'\x20was\x20promoted\x20to':_0x5a80f4+'\x20was\x20demoted\x20to';_0xbebe95[_0x315b08(0x13c)]=_0x193505+'\x20<span\x20class=\x22rank-text\x22>'+_0x3b1ef0[_0x315b08(0x145)]+'</span>';const _0xaccbde=document['createElement']('div');_0xaccbde['className']='banner-actions';const _0x5593ac=document[_0x315b08(0x153)](_0x315b08(0x13b));_0x5593ac['className']=_0x315b08(0x165),_0x5593ac['innerHTML']='&times;',_0x5593ac[_0x315b08(0x185)]='Dismiss';const _0x123050=document['createElement'](_0x315b08(0x13b));_0x123050['className']='ignore-btn',_0x123050['textContent']='Don\x27t\x20show\x20again',_0x123050[_0x315b08(0x185)]='Never\x20show\x20this\x20promotion\x20again',_0xaccbde[_0x315b08(0x146)](_0x123050),_0xaccbde[_0x315b08(0x146)](_0x5593ac),_0x4155f5['appendChild'](_0xbebe95),_0x4155f5['appendChild'](_0xaccbde),this['bannerContainer']['appendChild'](_0x4155f5),void _0x4155f5[_0x315b08(0x14e)],setTimeout(()=>{const _0x48d5e5=_0x315b08;_0x4155f5['classList'][_0x48d5e5(0x177)](_0x48d5e5(0x18c));},0x32),_0x5593ac[_0x315b08(0x169)](_0x315b08(0x159),()=>{const _0x4013ac=_0x315b08;localStorage['setItem'](_0x22cd4c,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':!![],'systemDismissed':![]})),_0x4155f5[_0x4013ac(0x149)]['remove']('new-rank-change'),_0x4155f5[_0x4013ac(0x149)][_0x4013ac(0x177)]('dismissing'),setTimeout(()=>{const _0x775b63=_0x4013ac;_0x4155f5['parentNode']&&(_0x4155f5[_0x775b63(0x17d)](),this['bannerContainer']['children']['length']===0x0&&(this['bannerContainer']['style'][_0x775b63(0x12e)]='none'));},0x1f4);}),_0x123050['addEventListener'](_0x315b08(0x159),()=>{const _0x582c7c=_0x315b08;localStorage[_0x582c7c(0x135)](_0x22cd4c,JSON[_0x582c7c(0x166)]({'timestamp':Date['now'](),'ignored':!![],'userDismissed':!![],'systemDismissed':![]})),_0x4155f5[_0x582c7c(0x149)]['remove']('new-rank-change'),_0x4155f5['classList'][_0x582c7c(0x177)](_0x582c7c(0x14c)),setTimeout(()=>{const _0x52d4bc=_0x582c7c;_0x4155f5['parentNode']&&(_0x4155f5['remove'](),this['bannerContainer']['children'][_0x52d4bc(0x127)]===0x0&&(this[_0x52d4bc(0x126)]['style']['display']='none'));},0x1f4);}),setTimeout(()=>{const _0x24da42=_0x315b08;_0x4155f5['parentNode']&&(_0x4155f5[_0x24da42(0x149)]['remove']('new-rank-change'),_0x4155f5['classList']['add']('dismissing'),localStorage['setItem'](_0x22cd4c,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':!![]})),setTimeout(()=>{const _0x38f58c=_0x24da42;_0x4155f5['parentNode']&&(_0x4155f5['remove'](),this['bannerContainer'][_0x38f58c(0x13e)]['length']===0x0&&(this['bannerContainer']['style']['display']=_0x38f58c(0x187)));},0x1f4));},0x3a98);});}async[a0_0x525db6(0x15a)](_0x237a7a){const _0x50facf=a0_0x525db6,_0x3238bc={..._0x237a7a},_0x40e57b=[_0x237a7a['player'],_0x237a7a['username'],_0x237a7a[_0x50facf(0x190)],_0x237a7a['displayName']],_0x5be403=_0x40e57b[_0x50facf(0x172)](_0x390f67=>_0x390f67&&typeof _0x390f67==='string'&&!_0x390f67[_0x50facf(0x17b)]('ID:')&&!/^[a-zA-Z0-9]{20,}$/[_0x50facf(0x174)](_0x390f67));if(_0x5be403)return _0x3238bc;let _0x537bf9=null;if(_0x237a7a['userId'])_0x537bf9=_0x237a7a[_0x50facf(0x17c)];else _0x237a7a['player']&&/^[A-Za-z0-9]{20,}$/['test'](_0x237a7a[_0x50facf(0x151)])&&(_0x537bf9=_0x237a7a['player']);if(!_0x537bf9)return _0x3238bc;try{const _0x269621=await getDoc(doc(db,_0x50facf(0x173),_0x537bf9));if(_0x269621['exists']()){const _0x25ab0c=_0x269621['data']();if(_0x25ab0c['username'])return _0x3238bc['resolvedName']=_0x25ab0c[_0x50facf(0x188)],_0x3238bc;}const _0x1e75ff=await getDocs(query(collection(db,'approvedMatches'),where(_0x50facf(0x186),'==',_0x537bf9),orderBy('date','desc'),limit(0x1)));if(!_0x1e75ff['empty']){const _0x21feb9=_0x1e75ff['docs'][0x0]['data']();if(_0x21feb9['winnerUsername'])return _0x3238bc['resolvedName']=_0x21feb9['winnerUsername'],_0x3238bc;}const _0x2a38da=await getDocs(query(collection(db,'approvedMatches'),where('loserId','==',_0x537bf9),orderBy('date','desc'),limit(0x1)));if(!_0x2a38da['empty']){const _0x5fe07f=_0x2a38da['docs'][0x0]['data']();if(_0x5fe07f['loserUsername'])return _0x3238bc['resolvedName']=_0x5fe07f[_0x50facf(0x18f)],console[_0x50facf(0x139)]('Resolved\x20'+_0x537bf9+'\x20to\x20'+_0x5fe07f['loserUsername']+'\x20(loser)'),_0x3238bc;}}catch(_0x4fb943){console['error']('Error\x20resolving\x20user\x20ID:',_0x4fb943);}return console['warn']('Failed\x20to\x20resolve\x20user\x20ID:\x20'+_0x537bf9),_0x3238bc;}[a0_0x525db6(0x155)](_0x5500b9,_0x193f77){const _0x1753ec=a0_0x525db6;let _0x4dee31=document['getElementById']('rankChangeModal');!_0x4dee31&&(_0x4dee31=document['createElement'](_0x1753ec(0x198)),_0x4dee31['id']='rankChangeModal',_0x4dee31['className']='rank-change-modal\x20'+_0x5500b9,document[_0x1753ec(0x184)]['appendChild'](_0x4dee31));const _0x5b53e0=_0x5500b9==='promotion'?'Congratulations!':'Rank\x20Update',_0x2fab37=_0x5500b9===_0x1753ec(0x195)?_0x1753ec(0x15f):'You\x27ve\x20been\x20demoted\x20to';_0x4dee31[_0x1753ec(0x13c)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rank-change-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2\x20class=\x22rank-change-title\x22>'+_0x5b53e0+_0x1753ec(0x125)+_0x2fab37+_0x1753ec(0x12c)+_0x193f77+'</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22rank-change-button\x22\x20id=\x22rank-change-ok-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Got\x20it!\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x4dee31['style']['display']='flex',document['getElementById'](_0x1753ec(0x141))['addEventListener'](_0x1753ec(0x159),()=>{_0x4dee31['style']['display']='none';}),_0x4dee31['addEventListener'](_0x1753ec(0x159),_0x2cd852=>{const _0x40d054=_0x1753ec;_0x2cd852['target']===_0x4dee31&&(_0x4dee31['style']['display']=_0x40d054(0x187));});}async['checkAndRecordPromotion'](_0x341a0e,_0x3d0bbc,_0x1725d8,_0x1e3ca2={}){const _0x2dbd68=a0_0x525db6;try{if(_0x3d0bbc===_0x1725d8||!_0x341a0e)return null;const _0x51985e=_0x1e3ca2[_0x2dbd68(0x150)]||'automatic',_0x7a75b7=_0x1e3ca2['matchId']||null,_0x2cfdb0=_0x1e3ca2['adminUser']||null;console['log']('Processing\x20potential\x20rank\x20change:\x20'+_0x1725d8+'\x20→\x20'+_0x3d0bbc+'\x20(source:\x20'+_0x51985e+')');let _0x378139=null,_0x41ecf2=null;try{const _0x1ec309=await getDoc(doc(db,'players',_0x341a0e));if(_0x1ec309['exists']()){const _0x7c75d4=_0x1ec309['data']();_0x378139=_0x7c75d4['username']||_0x7c75d4['displayName']||null,_0x41ecf2=_0x7c75d4[_0x2dbd68(0x14a)]||_0x7c75d4['username']||null;}!_0x378139&&_0x1e3ca2['username']&&(_0x378139=_0x1e3ca2['username'],_0x41ecf2=_0x1e3ca2['username']);!_0x378139&&auth['currentUser']&&(_0x378139=auth['currentUser']['displayName']||auth['currentUser']['email'][_0x2dbd68(0x15d)]('@')[0x0],_0x41ecf2=auth[_0x2dbd68(0x164)][_0x2dbd68(0x14a)]||null);if(!_0x378139){const _0x18542c=query(collection(db,'approvedMatches'),where(_0x2dbd68(0x186),'==',_0x341a0e),limit(0x1)),_0x22d2a1=await getDocs(_0x18542c);if(!_0x22d2a1['empty'])_0x378139=_0x22d2a1[_0x2dbd68(0x142)][0x0][_0x2dbd68(0x137)]()[_0x2dbd68(0x156)]||_0x2dbd68(0x16e),_0x41ecf2=_0x378139;else{const _0x5be614=query(collection(db,'approvedMatches'),where('loserId','==',_0x341a0e),limit(0x1)),_0x3e3f92=await getDocs(_0x5be614);!_0x3e3f92['empty']&&(_0x378139=_0x3e3f92[0x0][_0x2dbd68(0x137)]()[_0x2dbd68(0x18f)]||'Unknown\x20Player',_0x41ecf2=_0x378139);}}}catch(_0x26ac4b){console['error']('Error\x20resolving\x20username:',_0x26ac4b);}!_0x378139&&(console[_0x2dbd68(0x197)](_0x2dbd68(0x154),_0x341a0e),_0x378139='A\x20player',_0x41ecf2='Unknown\x20Player');const _0x5bfacc=this[_0x2dbd68(0x16b)](_0x1725d8),_0x9c00ff=this[_0x2dbd68(0x16b)](_0x3d0bbc);if(_0x5bfacc!==_0x9c00ff){const _0x71a42e=_0x3d0bbc>_0x1725d8,_0x25f5a5=_0x71a42e?'promotion':'demotion',_0x2f1f39=_0x9c00ff;console['log'](_0x2dbd68(0x160)+_0x25f5a5+'\x20for\x20'+_0x378139+':\x20'+_0x1725d8+'\x20('+_0x5bfacc+_0x2dbd68(0x16f)+_0x3d0bbc+'\x20('+_0x9c00ff+')');try{const _0x4590ea={'player':_0x378139,'playerUsername':_0x378139,'username':_0x378139,'displayName':_0x41ecf2,'userId':_0x341a0e,'type':_0x25f5a5,'rankAchieved':_0x2f1f39,'timestamp':serverTimestamp(),'previousElo':_0x1725d8,'newElo':_0x3d0bbc,'change':_0x3d0bbc-_0x1725d8,'previousRank':_0x5bfacc,'newRank':_0x9c00ff,'source':_0x51985e};if(_0x51985e==='match'&&_0x7a75b7)_0x4590ea[_0x2dbd68(0x178)]=_0x7a75b7;else _0x51985e==='admin'&&_0x2cfdb0?(_0x4590ea['modifiedBy']=_0x2cfdb0,_0x4590ea['isAutomatic']=![]):_0x4590ea[_0x2dbd68(0x13f)]=!![];const _0xad0786=writeBatch(db),_0xb1b21f=doc(collection(db,'eloHistory')),_0x97de0=doc(collection(db,'promotionHistory'));return _0xad0786['set'](_0xb1b21f,_0x4590ea),_0xad0786['set'](_0x97de0,_0x4590ea),await _0xad0786['commit'](),await this['sendPromotionNotification'](_0x341a0e,_0x378139,_0x1725d8,_0x3d0bbc,_0x5bfacc,_0x9c00ff,_0x25f5a5,{'displayName':_0x41ecf2,'source':_0x51985e,'matchId':_0x7a75b7,'ladder':_0x1e3ca2[_0x2dbd68(0x175)]||'D1'}),console['log']('Successfully\x20recorded\x20'+_0x25f5a5+'\x20for\x20'+_0x378139+'\x20to\x20'+_0x2f1f39),_0x2f1f39;}catch(_0x15c057){console['error'](_0x2dbd68(0x189),_0x15c057);try{return await addDoc(collection(db,'eloHistory'),{'player':_0x378139,'playerUsername':_0x378139,'username':_0x378139,'displayName':_0x41ecf2,'userId':_0x341a0e,'type':_0x25f5a5,'rankAchieved':_0x2f1f39,'timestamp':serverTimestamp(),'previousElo':_0x1725d8,'newElo':_0x3d0bbc,'change':_0x3d0bbc-_0x1725d8,'previousRank':_0x5bfacc,'source':_0x51985e,'isAutomatic':_0x51985e!==_0x2dbd68(0x17f)}),await this['sendPromotionNotification'](_0x341a0e,_0x378139,_0x1725d8,_0x3d0bbc,_0x5bfacc,_0x9c00ff,_0x25f5a5,{'displayName':_0x41ecf2,'source':_0x51985e,'matchId':_0x7a75b7,'ladder':_0x1e3ca2['ladder']||'D1'}),_0x2f1f39;}catch(_0x343121){return console['error']('Fallback\x20write\x20failed:',_0x343121),null;}}}return null;}catch(_0x25f87e){return console['error'](_0x2dbd68(0x18b),_0x25f87e),null;}}['getRankName'](_0x2d0d12){const _0x33db0d=a0_0x525db6;for(let _0x44eeb9=this[_0x33db0d(0x192)][_0x33db0d(0x127)]-0x1;_0x44eeb9>=0x0;_0x44eeb9--){if(_0x2d0d12>=this['RANKS'][_0x44eeb9]['threshold'])return this['RANKS'][_0x44eeb9][_0x33db0d(0x181)];}return'Unranked';}['cleanup'](){const _0x469cbf=a0_0x525db6;this[_0x469cbf(0x16d)]&&clearInterval(this[_0x469cbf(0x16d)]);}['isNewRankChange'](_0xe28f63){const _0xbdbd4c=a0_0x525db6;if(_0xe28f63['timestamp']){const _0x16be3f=_0xe28f63[_0xbdbd4c(0x162)]['seconds']*0x3e8,_0x2f7e45=Date['now'](),_0x55bf44=(_0x2f7e45-_0x16be3f)/(0x3e8*0x3c*0x3c);if(_0x55bf44>0x18)return![];}if(_0xe28f63['previousRank']&&_0xe28f63['newRank']&&_0xe28f63['previousRank']!==_0xe28f63[_0xbdbd4c(0x193)])return!![];return![];}async[a0_0x525db6(0x147)](_0x2a9213,_0x2a230e,_0x1daee3,_0x920987,_0xb718cb,_0x536297,_0x14b659,_0x43dd7c={}){const _0x12683a=a0_0x525db6;try{console['log']('STARTING\x20notification\x20for\x20'+_0x2a230e+'\x27s\x20'+_0x14b659);const _0x1d029c={'userId':_0x2a9213,'username':_0x2a230e,'displayName':_0x43dd7c[_0x12683a(0x14a)]||_0x2a230e,'oldElo':parseInt(_0x1daee3),'newElo':parseInt(_0x920987),'eloDifference':parseInt(_0x920987)-parseInt(_0x1daee3),'oldRank':_0xb718cb,'newRank':_0x536297,'type':_0x14b659,'timestamp':serverTimestamp(),'processed':![],'source':_0x43dd7c[_0x12683a(0x150)]||'automatic','matchId':_0x43dd7c['matchId']||null,'ladder':_0x43dd7c[_0x12683a(0x175)]||'D1','adminUser':_0x43dd7c['adminUser']||null};console[_0x12683a(0x139)]('Creating\x20Discord\x20notification:',_0x1d029c);const _0x2ce03d=await addDoc(collection(db,'promotionNotifications'),_0x1d029c);return console['log']('Discord\x20notification\x20sent\x20successfully\x20with\x20ID:\x20'+_0x2ce03d['id']),!![];}catch(_0x1f52b6){return console['error']('Error\x20sending\x20Discord\x20notification:',_0x1f52b6),![];}}}export const promotionManager=new PromotionManager();function a0_0x5a15(){const _0x5c373f=['title','winnerId','none','username','Error\x20writing\x20promotion\x20records:','now','Error\x20in\x20promotion/demotion\x20recording:','new-rank-change','78536iYmfwA','lastFetchTime','loserUsername','playerUsername','forEach','RANKS','newRank','29199703NlNNiV','promotion','className','warn','div','Error\x20processing\x20rank\x20change:','</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>','bannerContainer','length','Invalid\x20storage\x20format\x20for\x20','console','getElementById','12dWWqVq','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22rank-name\x22>','24lcECDJ','display','Promotion\x20','beforeunload','style','visible','97977FyELWQ','280VehvKa','setItem','promotion-banner-container','data','desc','log','visibilityState','button','innerHTML','type','children','isAutomatic','Gold','rank-change-ok-btn','docs','54072OlROSE','7986tyxHpH','rankAchieved','appendChild','sendPromotionNotification','Silver','classList','displayName','2751lrugun','dismissing','initialize','offsetWidth','promotion-details','source','player','toMillis','createElement','Could\x20not\x20resolve\x20username\x20for\x20userId:','showRankChangeLightbox','winnerUsername','constructor','Error\x20checking\x20promotion\x20visibility:','click','resolveUserId','true','808cxGdqG','split','bind','You\x27ve\x20been\x20promoted\x20to','Recording\x20','fetchInterval','timestamp','3787085WGvsvF','currentUser','dismiss-btn','stringify','1698gqPaPZ','showRankChangeBanner','addEventListener','error','getRankName','setAttribute','pollingInterval','Unknown\x20Player',')\x20→\x20','432MyVSSz','promotion_','some','players','test','ladder','DISPLAY_HOURS','add','matchId','DOMContentLoaded','Promotion\x20banner\x20container\x20not\x20found','includes','userId','remove','parse','admin','ignorePromotion','name','toDateString','#C0C0C0','body'];a0_0x5a15=function(){return _0x5c373f;};return a0_0x5a15();}document['addEventListener'](a0_0x525db6(0x179),()=>{const _0x666f71=a0_0x525db6;promotionManager[_0x666f71(0x14d)]();});export const initializePromotionTracker=()=>promotionManager['initialize']();export const checkAndRecordPromotion=(_0x35ab0c,_0x1749a0,_0x3c6aab,_0x79ac8d)=>promotionManager['checkAndRecordPromotion'](_0x35ab0c,_0x1749a0,_0x3c6aab,_0x79ac8d);export const getRankName=_0x530784=>promotionManager['getRankName'](_0x530784);
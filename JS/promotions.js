const a42_0x38dd74=a42_0xcd10,a42_0xb1eba=(function(){let _0x221ff2=!![];return function(_0x278d23,_0x29ed4e){const _0x95186c=_0x221ff2?function(){if(_0x29ed4e){const _0x330a4b=_0x29ed4e['apply'](_0x278d23,arguments);return _0x29ed4e=null,_0x330a4b;}}:function(){};return _0x221ff2=![],_0x95186c;};}()),a42_0x14f21b=a42_0xb1eba(this,function(){const _0x4760a1=a42_0xcd10;let _0x48116b;try{const _0x3fa4f8=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x48116b=_0x3fa4f8();}catch(_0x3be6e7){_0x48116b=window;}const _0x49b972=_0x48116b[_0x4760a1(0x128)]=_0x48116b[_0x4760a1(0x128)]||{},_0x3504dd=['log','warn',_0x4760a1(0x13e),'error','exception','table',_0x4760a1(0xfa)];for(let _0x41c54b=0x0;_0x41c54b<_0x3504dd['length'];_0x41c54b++){const _0x4d591d=a42_0xb1eba[_0x4760a1(0x144)]['prototype']['bind'](a42_0xb1eba),_0xfbe38a=_0x3504dd[_0x41c54b],_0x2c59b1=_0x49b972[_0xfbe38a]||_0x4d591d;_0x4d591d['__proto__']=a42_0xb1eba[_0x4760a1(0x13b)](a42_0xb1eba),_0x4d591d['toString']=_0x2c59b1['toString'][_0x4760a1(0x13b)](_0x2c59b1),_0x49b972[_0xfbe38a]=_0x4d591d;}});function a42_0x2e58(){const _0x21c60a=['setAttribute','Rank\x20Update','push','Promotion\x20','type','ID:','shouldShowPromotion','fetchRecentPromotions','\x20was\x20dismissed\x20by\x20user\x20within\x20last\x20','log','playerUsername','innerHTML','systemDismissed','adminUser','children','bannerContainer','split','appendChild','trace','currentUser','pollingInterval','DOMContentLoaded','\x20was\x20auto-dismissed\x20within\x20last\x204\x20hours','promotionHistory','automatic','\x20to\x20','Error\x20fetching\x20promotions:','You\x27ve\x20been\x20promoted\x20to','warn','visible','display','dismissing','classList','now','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22rank-name\x22>','visibilityState','fetchInterval','length','date','email','set','exists','loserId','desc','promotion_','\x20(source:\x20','textContent','div','You\x27ve\x20been\x20demoted\x20to','players','add','stringify','\x20for\x20','sendPromotionNotification','displayName','previousRank','isNewRankChange','processRankChanges','button','addEventListener','eloHistory','\x27s\x20','Resolved\x20','showRankChangeLightbox','console','player','</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>','admin','loserUsername','setupBannerContainer','seconds','getRankName','Bronze','error','RANKS','winnerId','rankAchieved','</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22rank-change-button\x22\x20id=\x22rank-change-ok-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Got\x20it!\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','data-rank','timestamp','Silver','ignore-btn','target','bind','then','setItem','info','isAutomatic','A\x20player','className','toMillis','getElementById','constructor','data','remove','empty','block','style','name','beforeunload','rank-change-modal\x20'];a42_0x2e58=function(){return _0x21c60a;};return a42_0x2e58();}a42_0x14f21b();import{collection,doc,query,where,orderBy,limit,getDocs,addDoc,getDoc,serverTimestamp,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{auth,db}from'./firebase-config.js';class PromotionManager{constructor(){const _0x56b381=a42_0xcd10;this['DISPLAY_HOURS']=0x18,this['RANKS']=[{'threshold':0x578,'name':_0x56b381(0x130),'color':'#CD7F32'},{'threshold':0x640,'name':_0x56b381(0x138),'color':'#C0C0C0'},{'threshold':0x708,'name':'Gold','color':'#FFD700'},{'threshold':0x834,'name':'Emerald','color':'#50C878'}],this['bannerContainer']=null,this['lastFetchTime']=0x0,this['fetchInterval']=0xea60,this[_0x56b381(0xfc)]=null,this['usernameCache']={};}['initialize'](){const _0x15cb13=a42_0xcd10;this[_0x15cb13(0xf7)]=document['getElementById']('promotion-banner-container');if(!this['bannerContainer']){console[_0x15cb13(0x131)]('Promotion\x20banner\x20container\x20not\x20found');return;}this[_0x15cb13(0x12d)]();const _0x14aec7='promotions_checked_'+new Date()['toDateString'](),_0x3cd74c=sessionStorage['getItem'](_0x14aec7);!_0x3cd74c&&(this[_0x15cb13(0xef)](),sessionStorage[_0x15cb13(0x13d)](_0x14aec7,'true')),document['addEventListener']('visibilitychange',()=>{const _0x3417f0=_0x15cb13;document[_0x3417f0(0x10b)]===_0x3417f0(0x105)&&!sessionStorage['getItem'](_0x14aec7)&&(this['fetchRecentPromotions'](),sessionStorage['setItem'](_0x14aec7,'true'));}),window['addEventListener'](_0x15cb13(0x14b),()=>{const _0x20fb9c=_0x15cb13;this[_0x20fb9c(0xfc)]&&clearInterval(this['pollingInterval']);});}['setupBannerContainer'](){const _0x29fc60=a42_0xcd10;this['bannerContainer']['innerHTML']='',this[_0x29fc60(0xf7)]['style']['display']='none';}async['fetchRecentPromotions'](){const _0x321509=a42_0xcd10;try{const _0x24bf2c=Date[_0x321509(0x109)]();if(_0x24bf2c-this['lastFetchTime']<this[_0x321509(0x10c)])return;this['lastFetchTime']=_0x24bf2c;const _0x910010=collection(db,_0x321509(0x124)),_0xb431b1=query(_0x910010,where('type','in',['promotion','demotion']),orderBy('timestamp','desc'),limit(0x14)),_0x3a1137=await getDocs(_0xb431b1),_0x259d27=[];_0x3a1137['forEach'](_0x58305d=>{const _0x2a59a4=_0x321509,_0x594bf2={'id':_0x58305d['id'],..._0x58305d['data']()};this[_0x2a59a4(0xee)](_0x58305d['id'])&&this[_0x2a59a4(0x120)](_0x594bf2)&&_0x259d27[_0x2a59a4(0xea)](_0x594bf2);}),_0x259d27['length']>0x0&&await this[_0x321509(0x121)](_0x259d27);}catch(_0x167d57){console['error'](_0x321509(0x102),_0x167d57);}}async['processRankChanges'](_0x7138f3){const _0x434ee5=a42_0xcd10;if(_0x7138f3['length']===0x0)return;_0x7138f3['sort']((_0x5b0b47,_0x553d9e)=>{const _0x103ef8=a42_0xcd10,_0x263144=_0x5b0b47['timestamp']?.[_0x103ef8(0x142)]?.()||_0x5b0b47['timestamp']?.[_0x103ef8(0x12e)]*0x3e8||0x0,_0x16aea2=_0x553d9e[_0x103ef8(0x137)]?.['toMillis']?.()||_0x553d9e['timestamp']?.[_0x103ef8(0x12e)]*0x3e8||0x0;return _0x16aea2-_0x263144;});const _0x422a21=this['bannerContainer'][_0x434ee5(0xf6)]['length'],_0x40a6d3=0x3-_0x422a21;if(_0x40a6d3<=0x0)return;const _0x3cce79=_0x7138f3['slice'](0x0,_0x40a6d3);for(let _0x20f2e4=0x0;_0x20f2e4<_0x3cce79[_0x434ee5(0x10d)];_0x20f2e4++){const _0x495d87=_0x3cce79[_0x20f2e4],_0x1b1728=auth['currentUser'];try{setTimeout(()=>{this['showRankChangeBanner'](_0x495d87);},_0x20f2e4*0x3e8),_0x1b1728&&_0x495d87['player']===_0x1b1728[_0x434ee5(0x11e)]&&this[_0x434ee5(0x127)](_0x495d87[_0x434ee5(0xec)],_0x495d87['rankAchieved']);}catch(_0x1051a2){console['error']('Error\x20processing\x20rank\x20change:',_0x1051a2);}}}[a42_0x38dd74(0xee)](_0x5e73e7){const _0x2ab90c=a42_0x38dd74;try{const _0x4de460='promotion_'+_0x5e73e7,_0x3a2985=localStorage['getItem'](_0x4de460);if(_0x3a2985){let _0x3abfac;try{_0x3abfac=JSON['parse'](_0x3a2985);}catch(_0x34d050){return console[_0x2ab90c(0x104)]('Invalid\x20storage\x20format\x20for\x20'+_0x4de460+',\x20treating\x20as\x20new'),!![];}if(_0x3abfac['ignored']===!![])return console[_0x2ab90c(0xf1)](_0x2ab90c(0xeb)+_0x5e73e7+'\x20is\x20permanently\x20ignored'),![];const _0x94d8f8=Date['now']();if(_0x3abfac['userDismissed']&&_0x94d8f8-_0x3abfac['timestamp']<this['DISPLAY_HOURS']*0x3c*0x3c*0x3e8)return console['log'](_0x2ab90c(0xeb)+_0x5e73e7+_0x2ab90c(0xf0)+this['DISPLAY_HOURS']+'\x20hours'),![];if(_0x3abfac[_0x2ab90c(0xf4)]&&_0x94d8f8-_0x3abfac['timestamp']<0x4*0x3c*0x3c*0x3e8)return console['log'](_0x2ab90c(0xeb)+_0x5e73e7+_0x2ab90c(0xfe)),![];}return!![];}catch(_0xd44404){return console[_0x2ab90c(0x131)]('Error\x20checking\x20promotion\x20visibility:',_0xd44404),![];}}['ignorePromotion'](_0x5616a2){const _0x52383f=a42_0x38dd74;try{const _0x2f73f5='promotion_'+_0x5616a2;localStorage['setItem'](_0x2f73f5,JSON[_0x52383f(0x11b)]({'timestamp':Date['now'](),'ignored':!![]}));}catch(_0x490137){console['error']('Error\x20saving\x20promotion\x20preference:',_0x490137);}}['showRankChangeBanner'](_0x3e2264){const _0x15bead=a42_0x38dd74;this['resolveUserId'](_0x3e2264)[_0x15bead(0x13c)](_0x4bac27=>{const _0x241ba4=_0x15bead,_0x3359a0=_0x241ba4(0x114)+_0x3e2264['id'],_0x58b009=localStorage['getItem'](_0x3359a0);if(_0x58b009)try{const _0x406364=JSON['parse'](_0x58b009);if(_0x406364['ignored']===!![]){console[_0x241ba4(0xf1)]('Skipping\x20ignored\x20promotion:\x20'+_0x3e2264['id']);return;}}catch(_0x3d1761){}localStorage['setItem'](_0x3359a0,JSON[_0x241ba4(0x11b)]({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':![],'seenAt':Date['now']()})),this[_0x241ba4(0xf7)]['style']['display']=_0x241ba4(0x148);while(this['bannerContainer'][_0x241ba4(0xf6)][_0x241ba4(0x10d)]>=0x3){this[_0x241ba4(0xf7)]['removeChild'](this[_0x241ba4(0xf7)]['firstChild']);}const _0x45ba40=document['createElement']('div');_0x45ba40['className']='promotion-banner',_0x45ba40['setAttribute'](_0x241ba4(0x136),_0x4bac27['rankAchieved']),_0x45ba40[_0x241ba4(0xe8)]('data-id',_0x4bac27['id']);const _0x40351a=document['createElement']('div');_0x40351a['className']='promotion-details';const _0x238025=_0x4bac27['resolvedName']||_0x4bac27['player']||_0x4bac27['username']||_0x4bac27[_0x241ba4(0xf2)]||_0x4bac27['displayName']||_0x241ba4(0x140),_0x5d7dd2=_0x4bac27['type']==='promotion'?_0x238025+'\x20was\x20promoted\x20to':_0x238025+'\x20was\x20demoted\x20to';_0x40351a[_0x241ba4(0xf3)]=_0x5d7dd2+'\x20<span\x20class=\x22rank-text\x22>'+_0x4bac27[_0x241ba4(0x134)]+'</span>';const _0x4f8ec9=document['createElement']('div');_0x4f8ec9['className']='banner-actions';const _0xddfcb2=document['createElement'](_0x241ba4(0x122));_0xddfcb2['className']='dismiss-btn',_0xddfcb2['innerHTML']='&times;',_0xddfcb2['title']='Dismiss';const _0x6b4a36=document['createElement']('button');_0x6b4a36['className']=_0x241ba4(0x139),_0x6b4a36[_0x241ba4(0x116)]='Don\x27t\x20show\x20again',_0x6b4a36['title']='Never\x20show\x20this\x20promotion\x20again',_0x4f8ec9['appendChild'](_0x6b4a36),_0x4f8ec9['appendChild'](_0xddfcb2),_0x45ba40[_0x241ba4(0xf9)](_0x40351a),_0x45ba40['appendChild'](_0x4f8ec9),this['bannerContainer'][_0x241ba4(0xf9)](_0x45ba40),void _0x45ba40['offsetWidth'],setTimeout(()=>{const _0xfd17af=_0x241ba4;_0x45ba40['classList'][_0xfd17af(0x11a)]('new-rank-change');},0x32),_0xddfcb2['addEventListener']('click',()=>{const _0x435027=_0x241ba4;localStorage['setItem'](_0x3359a0,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':!![],'systemDismissed':![]})),_0x45ba40[_0x435027(0x108)]['remove']('new-rank-change'),_0x45ba40[_0x435027(0x108)]['add']('dismissing'),setTimeout(()=>{const _0x553219=_0x435027;_0x45ba40['parentNode']&&(_0x45ba40[_0x553219(0x146)](),this['bannerContainer']['children'][_0x553219(0x10d)]===0x0&&(this['bannerContainer']['style'][_0x553219(0x106)]='none'));},0x1f4);}),_0x6b4a36['addEventListener']('click',()=>{const _0x4f0a96=_0x241ba4;localStorage['setItem'](_0x3359a0,JSON['stringify']({'timestamp':Date['now'](),'ignored':!![],'userDismissed':!![],'systemDismissed':![]})),_0x45ba40[_0x4f0a96(0x108)][_0x4f0a96(0x146)]('new-rank-change'),_0x45ba40['classList']['add']('dismissing'),setTimeout(()=>{const _0x294b9c=_0x4f0a96;_0x45ba40['parentNode']&&(_0x45ba40['remove'](),this['bannerContainer'][_0x294b9c(0xf6)][_0x294b9c(0x10d)]===0x0&&(this['bannerContainer'][_0x294b9c(0x149)][_0x294b9c(0x106)]='none'));},0x1f4);}),setTimeout(()=>{const _0x2a9448=_0x241ba4;_0x45ba40['parentNode']&&(_0x45ba40[_0x2a9448(0x108)]['remove']('new-rank-change'),_0x45ba40[_0x2a9448(0x108)]['add'](_0x2a9448(0x107)),localStorage['setItem'](_0x3359a0,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':!![]})),setTimeout(()=>{const _0x5459e0=_0x2a9448;_0x45ba40['parentNode']&&(_0x45ba40['remove'](),this[_0x5459e0(0xf7)][_0x5459e0(0xf6)][_0x5459e0(0x10d)]===0x0&&(this[_0x5459e0(0xf7)]['style']['display']='none'));},0x1f4));},0x3a98);});}async['resolveUserId'](_0xdd461f){const _0x9b467=a42_0x38dd74,_0x46d5ff={..._0xdd461f},_0x43b00b=[_0xdd461f['player'],_0xdd461f['username'],_0xdd461f['playerUsername'],_0xdd461f['displayName']],_0x184e99=_0x43b00b['some'](_0x40f459=>_0x40f459&&typeof _0x40f459==='string'&&!_0x40f459['includes'](_0x9b467(0xed))&&!/^[a-zA-Z0-9]{20,}$/['test'](_0x40f459));if(_0x184e99)return _0x46d5ff;let _0x236e99=null;if(_0xdd461f['userId'])_0x236e99=_0xdd461f['userId'];else _0xdd461f['player']&&/^[A-Za-z0-9]{20,}$/['test'](_0xdd461f[_0x9b467(0x129)])&&(_0x236e99=_0xdd461f['player']);if(!_0x236e99)return _0x46d5ff;try{const _0xb587b9=await getDoc(doc(db,'players',_0x236e99));if(_0xb587b9[_0x9b467(0x111)]()){const _0x2d2559=_0xb587b9[_0x9b467(0x145)]();if(_0x2d2559['username'])return _0x46d5ff['resolvedName']=_0x2d2559['username'],_0x46d5ff;}const _0x4d2313=await getDocs(query(collection(db,'approvedMatches'),where(_0x9b467(0x133),'==',_0x236e99),orderBy('date','desc'),limit(0x1)));if(!_0x4d2313['empty']){const _0x2483a1=_0x4d2313['docs'][0x0]['data']();if(_0x2483a1['winnerUsername'])return _0x46d5ff['resolvedName']=_0x2483a1['winnerUsername'],_0x46d5ff;}const _0x518950=await getDocs(query(collection(db,'approvedMatches'),where(_0x9b467(0x112),'==',_0x236e99),orderBy(_0x9b467(0x10e),_0x9b467(0x113)),limit(0x1)));if(!_0x518950[_0x9b467(0x147)]){const _0x56bb87=_0x518950['docs'][0x0]['data']();if(_0x56bb87[_0x9b467(0x12c)])return _0x46d5ff['resolvedName']=_0x56bb87['loserUsername'],console[_0x9b467(0xf1)](_0x9b467(0x126)+_0x236e99+_0x9b467(0x101)+_0x56bb87['loserUsername']+'\x20(loser)'),_0x46d5ff;}}catch(_0x4b52ce){console['error']('Error\x20resolving\x20user\x20ID:',_0x4b52ce);}return console['warn']('Failed\x20to\x20resolve\x20user\x20ID:\x20'+_0x236e99),_0x46d5ff;}['showRankChangeLightbox'](_0x3426ff,_0x1d8a8a){const _0x41a1c6=a42_0x38dd74;let _0x38493e=document[_0x41a1c6(0x143)]('rankChangeModal');!_0x38493e&&(_0x38493e=document['createElement'](_0x41a1c6(0x117)),_0x38493e['id']='rankChangeModal',_0x38493e[_0x41a1c6(0x141)]=_0x41a1c6(0x14c)+_0x3426ff,document['body'][_0x41a1c6(0xf9)](_0x38493e));const _0x34e291=_0x3426ff==='promotion'?'Congratulations!':_0x41a1c6(0xe9),_0xb36ae0=_0x3426ff==='promotion'?_0x41a1c6(0x103):_0x41a1c6(0x118);_0x38493e['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rank-change-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2\x20class=\x22rank-change-title\x22>'+_0x34e291+_0x41a1c6(0x12a)+_0xb36ae0+_0x41a1c6(0x10a)+_0x1d8a8a+_0x41a1c6(0x135),_0x38493e['style']['display']='flex',document['getElementById']('rank-change-ok-btn')['addEventListener']('click',()=>{const _0x28ba01=_0x41a1c6;_0x38493e['style'][_0x28ba01(0x106)]='none';}),_0x38493e[_0x41a1c6(0x123)]('click',_0x5b6a46=>{const _0x2a99cd=_0x41a1c6;_0x5b6a46[_0x2a99cd(0x13a)]===_0x38493e&&(_0x38493e['style']['display']='none');});}async['checkAndRecordPromotion'](_0x3aeddb,_0x512329,_0x2b7db2,_0x6917c1={}){const _0x10c176=a42_0x38dd74;try{if(_0x512329===_0x2b7db2||!_0x3aeddb)return null;const _0x5e5f19=_0x6917c1['source']||_0x10c176(0x100),_0x19d416=_0x6917c1['matchId']||null,_0x468228=_0x6917c1[_0x10c176(0xf5)]||null;console['log']('Processing\x20potential\x20rank\x20change:\x20'+_0x2b7db2+'\x20→\x20'+_0x512329+_0x10c176(0x115)+_0x5e5f19+')');let _0x535b52=null,_0x354de2=null;try{const _0x5dbb32=await getDoc(doc(db,_0x10c176(0x119),_0x3aeddb));if(_0x5dbb32['exists']()){const _0x57bfab=_0x5dbb32[_0x10c176(0x145)]();_0x535b52=_0x57bfab['username']||_0x57bfab[_0x10c176(0x11e)]||null,_0x354de2=_0x57bfab['displayName']||_0x57bfab['username']||null;}!_0x535b52&&_0x6917c1['username']&&(_0x535b52=_0x6917c1['username'],_0x354de2=_0x6917c1['username']);!_0x535b52&&auth['currentUser']&&(_0x535b52=auth[_0x10c176(0xfb)]['displayName']||auth['currentUser'][_0x10c176(0x10f)][_0x10c176(0xf8)]('@')[0x0],_0x354de2=auth['currentUser']['displayName']||null);if(!_0x535b52){const _0x3c73a9=query(collection(db,'approvedMatches'),where('winnerId','==',_0x3aeddb),limit(0x1)),_0x24a3ed=await getDocs(_0x3c73a9);if(!_0x24a3ed['empty'])_0x535b52=_0x24a3ed['docs'][0x0]['data']()['winnerUsername']||'Unknown\x20Player',_0x354de2=_0x535b52;else{const _0x371da1=query(collection(db,'approvedMatches'),where('loserId','==',_0x3aeddb),limit(0x1)),_0x3f22a5=await getDocs(_0x371da1);!_0x3f22a5['empty']&&(_0x535b52=_0x3f22a5[0x0][_0x10c176(0x145)]()['loserUsername']||'Unknown\x20Player',_0x354de2=_0x535b52);}}}catch(_0x2dd503){console['error']('Error\x20resolving\x20username:',_0x2dd503);}!_0x535b52&&(console[_0x10c176(0x104)]('Could\x20not\x20resolve\x20username\x20for\x20userId:',_0x3aeddb),_0x535b52=_0x10c176(0x140),_0x354de2='Unknown\x20Player');const _0x9159fb=this['getRankName'](_0x2b7db2),_0x305520=this[_0x10c176(0x12f)](_0x512329);if(_0x9159fb!==_0x305520){const _0x5e60f8=_0x512329>_0x2b7db2,_0xbb3892=_0x5e60f8?'promotion':'demotion',_0x140a6c=_0x305520;console['log']('Recording\x20'+_0xbb3892+'\x20for\x20'+_0x535b52+':\x20'+_0x2b7db2+'\x20('+_0x9159fb+')\x20→\x20'+_0x512329+'\x20('+_0x305520+')');try{const _0x8c82f={'player':_0x535b52,'playerUsername':_0x535b52,'username':_0x535b52,'displayName':_0x354de2,'userId':_0x3aeddb,'type':_0xbb3892,'rankAchieved':_0x140a6c,'timestamp':serverTimestamp(),'previousElo':_0x2b7db2,'newElo':_0x512329,'change':_0x512329-_0x2b7db2,'previousRank':_0x9159fb,'newRank':_0x305520,'source':_0x5e5f19};if(_0x5e5f19==='match'&&_0x19d416)_0x8c82f['matchId']=_0x19d416;else _0x5e5f19==='admin'&&_0x468228?(_0x8c82f['modifiedBy']=_0x468228,_0x8c82f[_0x10c176(0x13f)]=![]):_0x8c82f['isAutomatic']=!![];const _0x183648=writeBatch(db),_0x51d926=doc(collection(db,'eloHistory')),_0x2a61c2=doc(collection(db,_0x10c176(0xff)));return _0x183648[_0x10c176(0x110)](_0x51d926,_0x8c82f),_0x183648['set'](_0x2a61c2,_0x8c82f),await _0x183648['commit'](),await this['sendPromotionNotification'](_0x3aeddb,_0x535b52,_0x2b7db2,_0x512329,_0x9159fb,_0x305520,_0xbb3892,{'displayName':_0x354de2,'source':_0x5e5f19,'matchId':_0x19d416,'ladder':_0x6917c1['ladder']||'D1'}),console[_0x10c176(0xf1)]('Successfully\x20recorded\x20'+_0xbb3892+_0x10c176(0x11c)+_0x535b52+_0x10c176(0x101)+_0x140a6c),_0x140a6c;}catch(_0x381e2a){console['error']('Error\x20writing\x20promotion\x20records:',_0x381e2a);try{return await addDoc(collection(db,'eloHistory'),{'player':_0x535b52,'playerUsername':_0x535b52,'username':_0x535b52,'displayName':_0x354de2,'userId':_0x3aeddb,'type':_0xbb3892,'rankAchieved':_0x140a6c,'timestamp':serverTimestamp(),'previousElo':_0x2b7db2,'newElo':_0x512329,'change':_0x512329-_0x2b7db2,'previousRank':_0x9159fb,'source':_0x5e5f19,'isAutomatic':_0x5e5f19!==_0x10c176(0x12b)}),await this['sendPromotionNotification'](_0x3aeddb,_0x535b52,_0x2b7db2,_0x512329,_0x9159fb,_0x305520,_0xbb3892,{'displayName':_0x354de2,'source':_0x5e5f19,'matchId':_0x19d416,'ladder':_0x6917c1['ladder']||'D1'}),_0x140a6c;}catch(_0x28d8b5){return console['error']('Fallback\x20write\x20failed:',_0x28d8b5),null;}}}return null;}catch(_0x44ab09){return console['error']('Error\x20in\x20promotion/demotion\x20recording:',_0x44ab09),null;}}[a42_0x38dd74(0x12f)](_0x2c537d){const _0x335ccf=a42_0x38dd74;for(let _0x2e7409=this[_0x335ccf(0x132)]['length']-0x1;_0x2e7409>=0x0;_0x2e7409--){if(_0x2c537d>=this['RANKS'][_0x2e7409]['threshold'])return this['RANKS'][_0x2e7409][_0x335ccf(0x14a)];}return'Unranked';}['cleanup'](){const _0x583a25=a42_0x38dd74;this[_0x583a25(0xfc)]&&clearInterval(this['pollingInterval']);}['isNewRankChange'](_0x4d3ac9){const _0x3670c4=a42_0x38dd74;if(_0x4d3ac9['timestamp']){const _0x27cc60=_0x4d3ac9[_0x3670c4(0x137)][_0x3670c4(0x12e)]*0x3e8,_0x320c1c=Date[_0x3670c4(0x109)](),_0x47573d=(_0x320c1c-_0x27cc60)/(0x3e8*0x3c*0x3c);if(_0x47573d>0x18)return![];}if(_0x4d3ac9[_0x3670c4(0x11f)]&&_0x4d3ac9['newRank']&&_0x4d3ac9['previousRank']!==_0x4d3ac9['newRank'])return!![];return![];}async[a42_0x38dd74(0x11d)](_0x4e1a94,_0x1f9361,_0x3a915f,_0x4aef59,_0x2055c5,_0x255ac3,_0x4a6db0,_0x5f26fc={}){const _0x4d1930=a42_0x38dd74;try{console['log']('STARTING\x20notification\x20for\x20'+_0x1f9361+_0x4d1930(0x125)+_0x4a6db0);const _0x2dd58c={'userId':_0x4e1a94,'username':_0x1f9361,'displayName':_0x5f26fc['displayName']||_0x1f9361,'oldElo':parseInt(_0x3a915f),'newElo':parseInt(_0x4aef59),'eloDifference':parseInt(_0x4aef59)-parseInt(_0x3a915f),'oldRank':_0x2055c5,'newRank':_0x255ac3,'type':_0x4a6db0,'timestamp':serverTimestamp(),'processed':![],'source':_0x5f26fc['source']||'automatic','matchId':_0x5f26fc['matchId']||null,'ladder':_0x5f26fc['ladder']||'D1','adminUser':_0x5f26fc['adminUser']||null};console['log']('Creating\x20Discord\x20notification:',_0x2dd58c);const _0x46967b=await addDoc(collection(db,'promotionNotifications'),_0x2dd58c);return console['log']('Discord\x20notification\x20sent\x20successfully\x20with\x20ID:\x20'+_0x46967b['id']),!![];}catch(_0x5680c3){return console[_0x4d1930(0x131)]('Error\x20sending\x20Discord\x20notification:',_0x5680c3),![];}}}export const promotionManager=new PromotionManager();document['addEventListener'](a42_0x38dd74(0xfd),()=>{promotionManager['initialize']();});export const initializePromotionTracker=()=>promotionManager['initialize']();function a42_0xcd10(_0x5a1ed4,_0x35d847){const _0x14f21b=a42_0x2e58();return a42_0xcd10=function(_0xb1eba,_0x275635){_0xb1eba=_0xb1eba-0xe8;let _0x2e5801=_0x14f21b[_0xb1eba];return _0x2e5801;},a42_0xcd10(_0x5a1ed4,_0x35d847);}export const checkAndRecordPromotion=(_0x1d25e8,_0x59ab4d,_0x56dcea,_0x41bfab)=>promotionManager['checkAndRecordPromotion'](_0x1d25e8,_0x59ab4d,_0x56dcea,_0x41bfab);export const getRankName=_0x5298e8=>promotionManager[a42_0x38dd74(0x12f)](_0x5298e8);
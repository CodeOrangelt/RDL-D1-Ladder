function a10_0x242e(){const _0xfbfbd2=['.admin-only','exception','bind','isAdmin','\x20by\x20email:','then','log','style','slice','User','catch','error','role','display','playersCTF','</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username=','email','signOut','pending','Brian2af@outlook.com','\x20by\x20UID:','currentUser','toLowerCase','playersD2','status','uid','block','Found\x20user\x20in\x20','\x20in\x20','__proto__','closest','split','return\x20(function()\x20','auth-section','hasCheckedCollections','players','data','roleName','getElementById','toUpperCase','innerHTML','Error\x20signing\x20out:','map','querySelectorAll','addEventListener','info','{}.constructor(\x22return\x20this\x22)(\x20)','length'];a10_0x242e=function(){return _0xfbfbd2;};return a10_0x242e();}const a10_0x4951b4=a10_0x1a00,a10_0x287619=(function(){let _0xb96f7c=!![];return function(_0x13cecb,_0x3ccf5c){const _0x5494d9=_0xb96f7c?function(){if(_0x3ccf5c){const _0x35ed6c=_0x3ccf5c['apply'](_0x13cecb,arguments);return _0x3ccf5c=null,_0x35ed6c;}}:function(){};return _0xb96f7c=![],_0x5494d9;};}()),a10_0x1b8b78=a10_0x287619(this,function(){const _0x4fe5b4=a10_0x1a00;let _0x47e681;try{const _0x1a0c22=Function(_0x4fe5b4(0x191)+_0x4fe5b4(0x19f)+');');_0x47e681=_0x1a0c22();}catch(_0x58f53a){_0x47e681=window;}const _0x12605c=_0x47e681['console']=_0x47e681['console']||{},_0x25bf89=[_0x4fe5b4(0x177),'warn',_0x4fe5b4(0x19e),'error',_0x4fe5b4(0x172),'table','trace'];for(let _0x4ec092=0x0;_0x4ec092<_0x25bf89[_0x4fe5b4(0x1a0)];_0x4ec092++){const _0x3a4b24=a10_0x287619['constructor']['prototype'][_0x4fe5b4(0x173)](a10_0x287619),_0x3be6bc=_0x25bf89[_0x4ec092],_0x363665=_0x12605c[_0x3be6bc]||_0x3a4b24;_0x3a4b24[_0x4fe5b4(0x18e)]=a10_0x287619[_0x4fe5b4(0x173)](a10_0x287619),_0x3a4b24['toString']=_0x363665['toString']['bind'](_0x363665),_0x12605c[_0x3be6bc]=_0x3a4b24;}});a10_0x1b8b78();function a10_0x1a00(_0x191395,_0x49a97b){const _0x1b8b78=a10_0x242e();return a10_0x1a00=function(_0x287619,_0x659cb0){_0x287619=_0x287619-0x171;let _0x242ecd=_0x1b8b78[_0x287619];return _0x242ecd;},a10_0x1a00(_0x191395,_0x49a97b);}import{getAuth,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{doc,getDoc,collection,query,where,getDocs,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import{isAdmin}from'./admin-check.js';const ADMIN_EMAILS=['admin@ladder.com',a10_0x4951b4(0x184)],userCache={'uid':null,'username':null,'isAdmin':![],'hasCheckedCollections':![],'lastChecked':0x0,'role':null},invitationCache={'lastCheck':0x0,'pendingCount':0x0,'checkInterval':0x493e0};function updateInboxNotification(_0x3d609f){const _0x57ad16=a10_0x4951b4,_0x4e4b17=document[_0x57ad16(0x197)]('inbox-notification');_0x4e4b17&&(_0x3d609f>0x0?(_0x4e4b17[_0x57ad16(0x178)]['display']='inline-block',_0x4e4b17['textContent']=_0x3d609f>0x9?'9+':_0x3d609f):_0x4e4b17['style']['display']='none');}async function checkPendingInvitationsForCurrentUser(_0x319bda){const _0x1e7b0f=a10_0x4951b4;try{const _0x1605a4=Date['now']();if(_0x1605a4-invitationCache['lastCheck']<invitationCache['checkInterval'])return updateInboxNotification(invitationCache['pendingCount']),invitationCache['pendingCount'];invitationCache['lastCheck']=_0x1605a4;const _0x17153f=collection(db,'gameInvitations'),_0xdc3d01=query(_0x17153f,where('toUserId','==',_0x319bda),where(_0x1e7b0f(0x189),'==',_0x1e7b0f(0x183)),limit(0x5)),_0x68fdfd=await getDocs(_0xdc3d01),_0x339de8=_0x68fdfd['size'];return invitationCache['pendingCount']=_0x339de8,updateInboxNotification(_0x339de8),_0x339de8;}catch(_0x168d21){return console['warn']('Could\x20not\x20check\x20pending\x20invitations\x20for\x20current\x20user:',_0x168d21),0x0;}}function updateAuthSectionImmediate(_0x532de9,_0x14a19e=![]){const _0x3d3677=a10_0x4951b4,_0x3fb997=document[_0x3d3677(0x197)](_0x3d3677(0x192));if(!_0x3fb997)return;if(_0x532de9&&_0x14a19e)document['querySelectorAll'](_0x3d3677(0x171))['forEach'](_0x48e9d1=>{const _0xc8f7a5=_0x3d3677;_0x48e9d1[_0xc8f7a5(0x178)][_0xc8f7a5(0x17e)]=_0xc8f7a5(0x18b);});else!_0x532de9&&document['querySelectorAll'](_0x3d3677(0x171))['forEach'](_0x5177f8=>{_0x5177f8['style']['display']='none';});if(_0x532de9){const _0x943749=userCache['username']||(_0x532de9['email']?_0x532de9[_0x3d3677(0x181)]['split']('@')[0x0]:_0x3d3677(0x17a)),_0x56da61=userCache[_0x3d3677(0x17d)]?'\x20('+userCache[_0x3d3677(0x17d)]+')':_0x14a19e?'\x20(Admin)':'';_0x3fb997['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20class=\x22nav-username\x22>'+_0x943749+_0x56da61+_0x3d3677(0x180)+encodeURIComponent(_0x943749)+'\x22>Profile</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./inbox.html\x22\x20class=\x22nav-notification\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Inbox\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22inbox-notification\x22\x20class=\x22notification-dot\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22members.html\x22>Members</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./redeem.html\x22><i\x20class=\x22fas\x20fa-gift\x22></i>Store</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20id=\x22logout-link\x22>Sign\x20Out</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';const _0x2d07c3=document['getElementById']('logout-link');_0x2d07c3&&_0x2d07c3['addEventListener']('click',_0x5da5cc=>{const _0xd07ffb=_0x3d3677;_0x5da5cc['preventDefault']();const _0x41cc61=getAuth();updateAuthSectionImmediate(null),_0x41cc61[_0xd07ffb(0x182)]()[_0xd07ffb(0x17b)](_0x41cf89=>{const _0x24cdec=_0xd07ffb;console['error'](_0x24cdec(0x19a),_0x41cf89);});}),_0x532de9['uid']&&setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0x532de9['uid']);},0x3e8);}else _0x3fb997[_0x3d3677(0x199)]='<a\x20href=\x22login.html\x22\x20class=\x22login-link\x22>Login</a>';}async function checkAdminRoles(_0x1710a4){const _0x348e2a=a10_0x4951b4;if(!_0x1710a4||!_0x1710a4['email'])return{'isAdmin':![],'role':null};try{console[_0x348e2a(0x177)]('Checking\x20roles\x20for\x20user:\x20'+_0x1710a4['email']);const _0x2917ba=['players','playersD2','playersD3','nonParticipants','userProfiles'],_0x1f9fd4=['council','creative\x20lead','owner','admin'];for(const _0x23b051 of _0x2917ba){try{const _0x5bbe7e=doc(db,_0x23b051,_0x1710a4['uid']),_0x568ac9=await getDoc(_0x5bbe7e);if(_0x568ac9['exists']()){const _0x570e2d=_0x568ac9[_0x348e2a(0x195)]();console['log'](_0x348e2a(0x18c)+_0x23b051+_0x348e2a(0x185),_0x570e2d);let _0x2efd59=(_0x570e2d['roleName']||_0x570e2d['role']||'')['toLowerCase'](),_0x23aa44=_0x570e2d['roleName']||_0x570e2d['role']||'';if(_0x2efd59&&_0x1f9fd4['includes'](_0x2efd59)){console[_0x348e2a(0x177)]('Found\x20admin\x20role:\x20'+_0x2efd59+_0x348e2a(0x18d)+_0x23b051);const _0x5a3026=_0x23aa44['split']('\x20')[_0x348e2a(0x19b)](_0x2afd34=>_0x2afd34['charAt'](0x0)[_0x348e2a(0x198)]()+_0x2afd34[_0x348e2a(0x179)](0x1)[_0x348e2a(0x187)]())['join']('\x20');return{'isAdmin':!![],'role':_0x5a3026};}}}catch(_0x53d8f6){console[_0x348e2a(0x17c)]('Error\x20checking\x20'+_0x23b051+'\x20by\x20UID:',_0x53d8f6);}}for(const _0xa497c4 of _0x2917ba){try{const _0xd84349=collection(db,_0xa497c4);let _0x1e18e1=query(_0xd84349,where('email','==',_0x1710a4['email'])),_0x15bf31=await getDocs(_0x1e18e1);_0x15bf31['empty']&&(_0x1e18e1=query(_0xd84349,where('email','==',_0x1710a4[_0x348e2a(0x181)]['toLowerCase']())),_0x15bf31=await getDocs(_0x1e18e1));if(!_0x15bf31['empty']){const _0x5f4eb9=_0x15bf31['docs'][0x0]['data']();console['log'](_0x348e2a(0x18c)+_0xa497c4+'\x20by\x20email:',_0x5f4eb9);let _0x1dada6=(_0x5f4eb9['roleName']||_0x5f4eb9['role']||'')['toLowerCase'](),_0xceb74c=_0x5f4eb9[_0x348e2a(0x196)]||_0x5f4eb9[_0x348e2a(0x17d)]||'';if(_0x1dada6&&_0x1f9fd4['includes'](_0x1dada6)){console['log']('Found\x20admin\x20role:\x20'+_0x1dada6+_0x348e2a(0x18d)+_0xa497c4);const _0x260cda=_0xceb74c[_0x348e2a(0x190)]('\x20')[_0x348e2a(0x19b)](_0x143d57=>_0x143d57['charAt'](0x0)['toUpperCase']()+_0x143d57['slice'](0x1)['toLowerCase']())['join']('\x20');return{'isAdmin':!![],'role':_0x260cda};}}}catch(_0x284d07){console[_0x348e2a(0x17c)]('Error\x20checking\x20'+_0xa497c4+_0x348e2a(0x175),_0x284d07);}}return console['log']('No\x20admin\x20roles\x20found\x20for\x20user'),{'isAdmin':![],'role':null};}catch(_0x4c7da8){return console['error']('Error\x20in\x20checkAdminRoles:',_0x4c7da8),{'isAdmin':![],'role':null};}}async function updateAuthSection(_0x59b3b1){const _0x25f52a=a10_0x4951b4,_0x2436fe=_0x59b3b1&&isAdmin(_0x59b3b1['email']);updateAuthSectionImmediate(_0x59b3b1,_0x2436fe);if(!_0x59b3b1){userCache['uid']=null,userCache['username']=null,userCache['isAdmin']=![],userCache['hasCheckedCollections']=![],userCache[_0x25f52a(0x17d)]=null;return;}const _0x2b0f5f=Date['now']();if(_0x59b3b1[_0x25f52a(0x18a)]===userCache['uid']&&userCache[_0x25f52a(0x193)]&&_0x2b0f5f-userCache['lastChecked']<0x493e0)return;try{userCache[_0x25f52a(0x18a)]=_0x59b3b1['uid'],userCache['lastChecked']=_0x2b0f5f;const _0x505fc1=isAdmin(_0x59b3b1['email']);userCache[_0x25f52a(0x174)]=_0x505fc1;if(!_0x505fc1){const {isAdmin:_0x55a25c,role:_0x4a19b2}=await checkAdminRoles(_0x59b3b1);userCache[_0x25f52a(0x174)]=_0x55a25c,userCache['role']=_0x4a19b2,_0x55a25c&&(document[_0x25f52a(0x19c)](_0x25f52a(0x171))['forEach'](_0x3f4770=>{_0x3f4770['style']['display']='block';}),updateAuthSectionImmediate(_0x59b3b1,!![]));}const _0x5d9699=[_0x25f52a(0x194),_0x25f52a(0x188),'playersD3','playersDuos',_0x25f52a(0x17f),'nonParticipants','userProfiles'],_0x5d2c03=_0x5d9699[_0x25f52a(0x19b)](_0x536855=>getDoc(doc(db,_0x536855,_0x59b3b1[_0x25f52a(0x18a)]))[_0x25f52a(0x176)](_0x56a26b=>_0x56a26b['exists']()?{'collection':_0x536855,'data':_0x56a26b['data']()}:null)[_0x25f52a(0x17b)](()=>null)),_0x336c20=await Promise['all'](_0x5d2c03),_0x13db9f=_0x336c20['filter'](_0x36c99b=>_0x36c99b!==null);let _0x214907=null;for(const _0x299d07 of _0x13db9f){if(_0x299d07['data']['username']){_0x214907=_0x299d07['data']['username'];break;}}userCache['username']=_0x214907||(_0x59b3b1['email']?_0x59b3b1['email']['split']('@')[0x0]:_0x25f52a(0x17a)),userCache['hasCheckedCollections']=!![],updateAuthSectionImmediate(_0x59b3b1,userCache[_0x25f52a(0x174)]),setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0x59b3b1['uid']);},0x1f4);}catch(_0x3c4830){console[_0x25f52a(0x17c)]('Error\x20in\x20full\x20auth\x20update:',_0x3c4830);}}document['addEventListener']('DOMContentLoaded',()=>{const _0x18e5d1=a10_0x4951b4,_0x58201c=getAuth();onAuthStateChanged(_0x58201c,async _0x3ea8e2=>{await updateAuthSection(_0x3ea8e2),_0x3ea8e2&&checkPendingInvitationsForCurrentUser(_0x3ea8e2['uid']);}),document[_0x18e5d1(0x19d)]('visibilitychange',()=>{const _0x137b2f=_0x18e5d1;!document['hidden']&&_0x58201c['currentUser']&&checkPendingInvitationsForCurrentUser(_0x58201c[_0x137b2f(0x186)]['uid']);}),document['addEventListener']('click',_0x28d972=>{const _0x4a8885=_0x18e5d1;_0x28d972['target'][_0x4a8885(0x18f)]('a[href]')&&_0x58201c['currentUser']&&checkPendingInvitationsForCurrentUser(_0x58201c['currentUser']['uid']);});});export{updateAuthSection};
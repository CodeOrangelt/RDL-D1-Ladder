const a12_0x369d83=a12_0x25b9,a12_0x4cbe22=(function(){let _0x1bc5ea=!![];return function(_0x494aef,_0x1ac9ca){const _0x19fe18=_0x1bc5ea?function(){const _0x2f9166=a12_0x25b9;if(_0x1ac9ca){const _0x26db10=_0x1ac9ca[_0x2f9166(0x110)](_0x494aef,arguments);return _0x1ac9ca=null,_0x26db10;}}:function(){};return _0x1bc5ea=![],_0x19fe18;};}()),a12_0x1627dc=a12_0x4cbe22(this,function(){const _0xea86d1=a12_0x25b9;let _0x38c19a;try{const _0x41c95c=Function('return\x20(function()\x20'+_0xea86d1(0x13c)+');');_0x38c19a=_0x41c95c();}catch(_0x4c973e){_0x38c19a=window;}const _0x28ceae=_0x38c19a[_0xea86d1(0x11c)]=_0x38c19a['console']||{},_0x461444=['log',_0xea86d1(0x141),'info',_0xea86d1(0x11a),'exception',_0xea86d1(0x118),'trace'];for(let _0x2a20eb=0x0;_0x2a20eb<_0x461444['length'];_0x2a20eb++){const _0x495d53=a12_0x4cbe22['constructor']['prototype']['bind'](a12_0x4cbe22),_0x34aae1=_0x461444[_0x2a20eb],_0x16d813=_0x28ceae[_0x34aae1]||_0x495d53;_0x495d53['__proto__']=a12_0x4cbe22['bind'](a12_0x4cbe22),_0x495d53['toString']=_0x16d813[_0xea86d1(0x117)]['bind'](_0x16d813),_0x28ceae[_0x34aae1]=_0x495d53;}});a12_0x1627dc();import{getAuth,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{doc,getDoc,collection,query,where,getDocs,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';function a12_0x25b9(_0x347192,_0x17f7a4){const _0x1627dc=a12_0x57f4();return a12_0x25b9=function(_0x4cbe22,_0x2f2895){_0x4cbe22=_0x4cbe22-0x10b;let _0x57f40c=_0x1627dc[_0x4cbe22];return _0x57f40c;},a12_0x25b9(_0x347192,_0x17f7a4);}import{isAdmin}from'./admin-check.js';function a12_0x57f4(){const _0x4642ba=['username','click','filter','innerHTML','toLowerCase','apply','playersD2','getElementById','\x22>Profile</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./inbox.html\x22\x20class=\x22nav-notification\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Inbox\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22inbox-notification\x22\x20class=\x22notification-dot\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22members.html\x22>Members</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./redeem.html\x22><i\x20class=\x22fas\x20fa-gift\x22></i>Store</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20id=\x22logout-link\x22>Sign\x20Out</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','lastChecked','pendingCount','\x20by\x20UID:','toString','table','<a\x20href=\x22login.html\x22\x20class=\x22login-link\x22>Login</a>','error','roleName','console','toUpperCase','now','log','pending','Found\x20user\x20in\x20','admin@ladder.com','uid','split','Found\x20admin\x20role:\x20','catch','role','userProfiles','status','hasCheckedCollections','Error\x20checking\x20','logout-link','empty','nonParticipants','display','Error\x20in\x20checkAdminRoles:','none','style','Error\x20signing\x20out:','closest','currentUser','\x20by\x20email:','addEventListener','data','creative\x20lead','</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username=','.admin-only','{}.constructor(\x22return\x20this\x22)(\x20)','No\x20admin\x20roles\x20found\x20for\x20user','target','exists','email','warn','forEach'];a12_0x57f4=function(){return _0x4642ba;};return a12_0x57f4();}const ADMIN_EMAILS=[a12_0x369d83(0x122),'Brian2af@outlook.com'],userCache={'uid':null,'username':null,'isAdmin':![],'hasCheckedCollections':![],'lastChecked':0x0,'role':null},invitationCache={'lastCheck':0x0,'pendingCount':0x0,'checkInterval':0x493e0};function updateInboxNotification(_0xafd44b){const _0x3ca2ec=a12_0x369d83,_0x6783da=document[_0x3ca2ec(0x112)]('inbox-notification');_0x6783da&&(_0xafd44b>0x0?(_0x6783da['style'][_0x3ca2ec(0x12f)]='inline-block',_0x6783da['textContent']=_0xafd44b>0x9?'9+':_0xafd44b):_0x6783da['style']['display']=_0x3ca2ec(0x131));}async function checkPendingInvitationsForCurrentUser(_0x15475a){const _0x3eaf1f=a12_0x369d83;try{const _0x4b15bf=Date[_0x3eaf1f(0x11e)]();if(_0x4b15bf-invitationCache['lastCheck']<invitationCache['checkInterval'])return updateInboxNotification(invitationCache[_0x3eaf1f(0x115)]),invitationCache['pendingCount'];invitationCache['lastCheck']=_0x4b15bf;const _0x22c047=collection(db,'gameInvitations'),_0x2024ea=query(_0x22c047,where('toUserId','==',_0x15475a),where(_0x3eaf1f(0x129),'==',_0x3eaf1f(0x120)),limit(0x5)),_0x532d0e=await getDocs(_0x2024ea),_0x46171c=_0x532d0e['size'];return invitationCache['pendingCount']=_0x46171c,updateInboxNotification(_0x46171c),_0x46171c;}catch(_0x2403ff){return console[_0x3eaf1f(0x141)]('Could\x20not\x20check\x20pending\x20invitations\x20for\x20current\x20user:',_0x2403ff),0x0;}}function updateAuthSectionImmediate(_0x4387dd,_0x213bea=![]){const _0x53e29a=a12_0x369d83,_0x264ce1=document[_0x53e29a(0x112)]('auth-section');if(!_0x264ce1)return;if(_0x4387dd&&_0x213bea)document['querySelectorAll']('.admin-only')['forEach'](_0x47e130=>{const _0x2fb55b=_0x53e29a;_0x47e130[_0x2fb55b(0x132)][_0x2fb55b(0x12f)]='block';});else!_0x4387dd&&document['querySelectorAll']('.admin-only')['forEach'](_0x5a07f5=>{_0x5a07f5['style']['display']='none';});if(_0x4387dd){const _0x5d37ac=userCache['username']||(_0x4387dd[_0x53e29a(0x140)]?_0x4387dd['email'][_0x53e29a(0x124)]('@')[0x0]:'User'),_0x9c6287=userCache['role']?'\x20('+userCache['role']+')':_0x213bea?'\x20(Admin)':'';_0x264ce1['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20class=\x22nav-username\x22>'+_0x5d37ac+_0x9c6287+_0x53e29a(0x13a)+encodeURIComponent(_0x5d37ac)+_0x53e29a(0x113);const _0x37ce50=document['getElementById'](_0x53e29a(0x12c));_0x37ce50&&_0x37ce50['addEventListener'](_0x53e29a(0x10c),_0x3b3cba=>{_0x3b3cba['preventDefault']();const _0x3737ed=getAuth();updateAuthSectionImmediate(null),_0x3737ed['signOut']()['catch'](_0x322f6a=>{const _0x5e372d=a12_0x25b9;console['error'](_0x5e372d(0x133),_0x322f6a);});}),_0x4387dd[_0x53e29a(0x123)]&&setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0x4387dd['uid']);},0x3e8);}else _0x264ce1[_0x53e29a(0x10e)]=_0x53e29a(0x119);}async function checkAdminRoles(_0x2868a1){const _0x4a4355=a12_0x369d83;if(!_0x2868a1||!_0x2868a1[_0x4a4355(0x140)])return{'isAdmin':![],'role':null};try{console['log']('Checking\x20roles\x20for\x20user:\x20'+_0x2868a1[_0x4a4355(0x140)]);const _0x2fba2d=['players','playersD2','playersD3',_0x4a4355(0x12e),'userProfiles'],_0x57c1ce=['council',_0x4a4355(0x139),'owner','admin'];for(const _0x5cb332 of _0x2fba2d){try{const _0x262313=doc(db,_0x5cb332,_0x2868a1['uid']),_0x3a1215=await getDoc(_0x262313);if(_0x3a1215[_0x4a4355(0x13f)]()){const _0x23aed4=_0x3a1215['data']();console['log']('Found\x20user\x20in\x20'+_0x5cb332+_0x4a4355(0x116),_0x23aed4);let _0x42b971=(_0x23aed4['roleName']||_0x23aed4[_0x4a4355(0x127)]||'')['toLowerCase'](),_0x5e7cd9=_0x23aed4['roleName']||_0x23aed4['role']||'';if(_0x42b971&&_0x57c1ce['includes'](_0x42b971)){console[_0x4a4355(0x11f)](_0x4a4355(0x125)+_0x42b971+'\x20in\x20'+_0x5cb332);const _0x346a5d=_0x5e7cd9['split']('\x20')['map'](_0x9180d3=>_0x9180d3['charAt'](0x0)[_0x4a4355(0x11d)]()+_0x9180d3['slice'](0x1)[_0x4a4355(0x10f)]())['join']('\x20');return{'isAdmin':!![],'role':_0x346a5d};}}}catch(_0x24051c){console[_0x4a4355(0x11a)](_0x4a4355(0x12b)+_0x5cb332+'\x20by\x20UID:',_0x24051c);}}for(const _0x1fdbfe of _0x2fba2d){try{const _0x1f1079=collection(db,_0x1fdbfe);let _0x180847=query(_0x1f1079,where(_0x4a4355(0x140),'==',_0x2868a1['email'])),_0x4b64e3=await getDocs(_0x180847);_0x4b64e3['empty']&&(_0x180847=query(_0x1f1079,where('email','==',_0x2868a1['email']['toLowerCase']())),_0x4b64e3=await getDocs(_0x180847));if(!_0x4b64e3[_0x4a4355(0x12d)]){const _0x5ed547=_0x4b64e3['docs'][0x0][_0x4a4355(0x138)]();console['log'](_0x4a4355(0x121)+_0x1fdbfe+_0x4a4355(0x136),_0x5ed547);let _0x4c6e67=(_0x5ed547[_0x4a4355(0x11b)]||_0x5ed547['role']||'')['toLowerCase'](),_0x127a52=_0x5ed547['roleName']||_0x5ed547['role']||'';if(_0x4c6e67&&_0x57c1ce['includes'](_0x4c6e67)){console['log'](_0x4a4355(0x125)+_0x4c6e67+'\x20in\x20'+_0x1fdbfe);const _0x2da03b=_0x127a52[_0x4a4355(0x124)]('\x20')['map'](_0x40586b=>_0x40586b['charAt'](0x0)['toUpperCase']()+_0x40586b['slice'](0x1)[_0x4a4355(0x10f)]())['join']('\x20');return{'isAdmin':!![],'role':_0x2da03b};}}}catch(_0x2e1190){console['error'](_0x4a4355(0x12b)+_0x1fdbfe+'\x20by\x20email:',_0x2e1190);}}return console[_0x4a4355(0x11f)](_0x4a4355(0x13d)),{'isAdmin':![],'role':null};}catch(_0x4197f8){return console[_0x4a4355(0x11a)](_0x4a4355(0x130),_0x4197f8),{'isAdmin':![],'role':null};}}async function updateAuthSection(_0x1f4e6e){const _0x189b9a=a12_0x369d83,_0x4d7c83=_0x1f4e6e&&isAdmin(_0x1f4e6e['email']);updateAuthSectionImmediate(_0x1f4e6e,_0x4d7c83);if(!_0x1f4e6e){userCache['uid']=null,userCache['username']=null,userCache['isAdmin']=![],userCache['hasCheckedCollections']=![],userCache['role']=null;return;}const _0x184333=Date['now']();if(_0x1f4e6e[_0x189b9a(0x123)]===userCache['uid']&&userCache[_0x189b9a(0x12a)]&&_0x184333-userCache[_0x189b9a(0x114)]<0x493e0)return;try{userCache['uid']=_0x1f4e6e['uid'],userCache[_0x189b9a(0x114)]=_0x184333;const _0x15fc45=isAdmin(_0x1f4e6e[_0x189b9a(0x140)]);userCache['isAdmin']=_0x15fc45;if(!_0x15fc45){const {isAdmin:_0x255087,role:_0x23a396}=await checkAdminRoles(_0x1f4e6e);userCache['isAdmin']=_0x255087,userCache['role']=_0x23a396,_0x255087&&(document['querySelectorAll'](_0x189b9a(0x13b))[_0x189b9a(0x142)](_0x1164d6=>{const _0x482647=_0x189b9a;_0x1164d6[_0x482647(0x132)][_0x482647(0x12f)]='block';}),updateAuthSectionImmediate(_0x1f4e6e,!![]));}const _0x52581c=['players',_0x189b9a(0x111),'playersD3','playersDuos','playersCTF','nonParticipants',_0x189b9a(0x128)],_0x3c4e2e=_0x52581c['map'](_0x142885=>getDoc(doc(db,_0x142885,_0x1f4e6e[_0x189b9a(0x123)]))['then'](_0x5c0a4b=>_0x5c0a4b[_0x189b9a(0x13f)]()?{'collection':_0x142885,'data':_0x5c0a4b[_0x189b9a(0x138)]()}:null)[_0x189b9a(0x126)](()=>null)),_0x181d40=await Promise['all'](_0x3c4e2e),_0x29dae8=_0x181d40[_0x189b9a(0x10d)](_0x2b2f2f=>_0x2b2f2f!==null);let _0x42b565=null;for(const _0x3fccdc of _0x29dae8){if(_0x3fccdc['data']['username']){_0x42b565=_0x3fccdc[_0x189b9a(0x138)]['username'];break;}}userCache[_0x189b9a(0x10b)]=_0x42b565||(_0x1f4e6e['email']?_0x1f4e6e['email']['split']('@')[0x0]:'User'),userCache['hasCheckedCollections']=!![],updateAuthSectionImmediate(_0x1f4e6e,userCache['isAdmin']),setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0x1f4e6e['uid']);},0x1f4);}catch(_0x5d1153){console[_0x189b9a(0x11a)]('Error\x20in\x20full\x20auth\x20update:',_0x5d1153);}}document[a12_0x369d83(0x137)]('DOMContentLoaded',()=>{const _0x440554=a12_0x369d83,_0x318320=getAuth();onAuthStateChanged(_0x318320,async _0x57c0ce=>{const _0x404f19=a12_0x25b9;await updateAuthSection(_0x57c0ce),_0x57c0ce&&checkPendingInvitationsForCurrentUser(_0x57c0ce[_0x404f19(0x123)]);}),document[_0x440554(0x137)]('visibilitychange',()=>{const _0x264f0e=_0x440554;!document['hidden']&&_0x318320['currentUser']&&checkPendingInvitationsForCurrentUser(_0x318320[_0x264f0e(0x135)]['uid']);}),document[_0x440554(0x137)](_0x440554(0x10c),_0x2375ce=>{const _0x3edd00=_0x440554;_0x2375ce[_0x3edd00(0x13e)][_0x3edd00(0x134)]('a[href]')&&_0x318320['currentUser']&&checkPendingInvitationsForCurrentUser(_0x318320[_0x3edd00(0x135)]['uid']);});});export{updateAuthSection};
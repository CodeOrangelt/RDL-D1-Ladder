function a13_0x2284(_0x5dd341,_0xc84e8){const _0x1efe17=a13_0x351c();return a13_0x2284=function(_0x596797,_0x3476d4){_0x596797=_0x596797-0xb5;let _0x351c02=_0x1efe17[_0x596797];return _0x351c02;},a13_0x2284(_0x5dd341,_0xc84e8);}const a13_0x47a7f1=a13_0x2284,a13_0x596797=(function(){let _0x2b5f2f=!![];return function(_0x57cbff,_0x3db366){const _0xebbf85=_0x2b5f2f?function(){if(_0x3db366){const _0x405efb=_0x3db366['apply'](_0x57cbff,arguments);return _0x3db366=null,_0x405efb;}}:function(){};return _0x2b5f2f=![],_0xebbf85;};}()),a13_0x1efe17=a13_0x596797(this,function(){const _0x2eb4b6=a13_0x2284,_0x543319=function(){const _0x36d3e6=a13_0x2284;let _0x4ae86d;try{_0x4ae86d=Function(_0x36d3e6(0xb7)+_0x36d3e6(0xb9)+');')();}catch(_0x48fc55){_0x4ae86d=window;}return _0x4ae86d;},_0x505acc=_0x543319(),_0x1d33d7=_0x505acc['console']=_0x505acc['console']||{},_0x3c31ee=['log',_0x2eb4b6(0xbf),'info','error',_0x2eb4b6(0xbb),'table','trace'];for(let _0x3a098b=0x0;_0x3a098b<_0x3c31ee['length'];_0x3a098b++){const _0x134c58=a13_0x596797[_0x2eb4b6(0xb5)]['prototype'][_0x2eb4b6(0xbc)](a13_0x596797),_0x1c7f64=_0x3c31ee[_0x3a098b],_0xf9d87f=_0x1d33d7[_0x1c7f64]||_0x134c58;_0x134c58['__proto__']=a13_0x596797['bind'](a13_0x596797),_0x134c58['toString']=_0xf9d87f[_0x2eb4b6(0xba)]['bind'](_0xf9d87f),_0x1d33d7[_0x1c7f64]=_0x134c58;}});a13_0x1efe17();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc,where}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';function a13_0x351c(){const _0x2f0f08=['constructor','Unknown\x20Player','return\x20(function()\x20','timestamp','{}.constructor(\x22return\x20this\x22)(\x20)','toString','exception','bind','winnerId','exists','warn','loserUsername','error','username','eloHistoryD3','Unranked','data','previousElo','docs','Silver','map'];a13_0x351c=function(){return _0x2f0f08;};return a13_0x351c();}const ELO_THRESHOLDS_D3=[{'name':'Emerald','elo':0x7d0},{'name':'Gold','elo':0x708},{'name':'Silver','elo':0x640},{'name':'Bronze','elo':0x578},{'name':a13_0x47a7f1(0xc4),'elo':0x4b0}];let lastVisibleD3=null;async function getUsernameByIdD3(_0x360493){const _0x23b4a3=a13_0x47a7f1;try{if(!_0x360493)return _0x23b4a3(0xb6);const _0x200614=await getDoc(doc(db,'playersD3',_0x360493));if(_0x200614[_0x23b4a3(0xbe)]())return _0x200614['data']()[_0x23b4a3(0xc2)]||'Unknown\x20Player';const _0x1e667b=await getDocs(query(collection(db,'approvedMatchesD3'),where(_0x23b4a3(0xbd),'==',_0x360493),limit(0x1)));if(!_0x1e667b['empty'])return _0x1e667b['docs'][0x0]['data']()['winnerUsername']||_0x23b4a3(0xb6);const _0x43dace=await getDocs(query(collection(db,'approvedMatchesD3'),where('loserId','==',_0x360493),limit(0x1)));if(!_0x43dace['empty'])return _0x43dace[_0x23b4a3(0xc7)][0x0][_0x23b4a3(0xc5)]()[_0x23b4a3(0xc0)]||'Unknown\x20Player';return _0x23b4a3(0xb6);}catch(_0x2c89a9){return console['error']('Error\x20getting\x20D3\x20username:',_0x2c89a9),'Unknown\x20Player';}}export async function recordEloChangeD3({playerId:_0x26108c,previousElo:_0x36f2b6,newElo:_0x3da204,opponentId:_0x578f5f,matchResult:_0x65f026,previousPosition:_0x2da097,newPosition:_0xd1a695,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x245391,timestamp:_0x2f0fd6}){const _0x36ed97=a13_0x47a7f1;try{const _0x1d8048=doc(collection(db,'eloHistoryD3'));let _0x1dee34='match';if(isPromotion)_0x1dee34='promotion';if(isDemotion)_0x1dee34='demotion';let _0x272b15='Unranked';if(_0x3da204>=0x7d0)_0x272b15='Emerald';else{if(_0x3da204>=0x708)_0x272b15='Gold';else{if(_0x3da204>=0x640)_0x272b15=_0x36ed97(0xc8);else{if(_0x3da204>=0x578)_0x272b15='Bronze';}}}return await setDoc(_0x1d8048,{'type':_0x1dee34,'player':_0x26108c,'opponent':_0x578f5f,'previousElo':_0x36f2b6,'newElo':_0x3da204,'change':_0x3da204-_0x36f2b6,'matchResult':_0x65f026,'previousPosition':_0x2da097,'newPosition':_0xd1a695,'rankAchieved':_0x272b15,'matchId':_0x245391,'timestamp':_0x2f0fd6||serverTimestamp(),'gameMode':'D3'}),console['log']('D3\x20ELO\x20history\x20recorded\x20for\x20'+_0x26108c),!![];}catch(_0x151530){console[_0x36ed97(0xc1)]('Error\x20recording\x20D3\x20ELO\x20history:',_0x151530);throw _0x151530;}}export async function getEloHistoryD3(_0x37a9ce=0x14){const _0x20828b=a13_0x47a7f1;try{const _0x5af0f5=collection(db,_0x20828b(0xc3));let _0x260c60;lastVisibleD3?_0x260c60=query(_0x5af0f5,orderBy('timestamp','desc'),startAfter(lastVisibleD3),limit(_0x37a9ce)):_0x260c60=query(_0x5af0f5,orderBy(_0x20828b(0xb8),'desc'),limit(_0x37a9ce));const _0xb0ed72=await getDocs(_0x260c60);if(_0xb0ed72['empty'])return{'entries':[],'hasMore':![]};lastVisibleD3=_0xb0ed72['docs'][_0xb0ed72['docs']['length']-0x1];const _0x4c083c=_0xb0ed72['docs'][_0x20828b(0xc9)](async _0x1d8b5b=>{const _0x50e94a=_0x20828b,_0x585cd8=_0x1d8b5b['data'](),[_0xd64082,_0x28c1d3]=await Promise['all']([getUsernameByIdD3(_0x585cd8['player']),getUsernameByIdD3(_0x585cd8['opponent'])]);return{..._0x585cd8,'playerUsername':_0xd64082,'opponentUsername':_0x28c1d3,'change':_0x585cd8['newElo']-_0x585cd8[_0x50e94a(0xc6)],'timestamp':_0x585cd8[_0x50e94a(0xb8)]};}),_0x251155=await Promise['all'](_0x4c083c);return{'entries':_0x251155,'hasMore':_0xb0ed72['size']===_0x37a9ce};}catch(_0x3ec9b6){console['error']('Error\x20fetching\x20D3\x20ELO\x20history:',_0x3ec9b6);throw _0x3ec9b6;}}export function resetPaginationD3(){lastVisibleD3=null;}
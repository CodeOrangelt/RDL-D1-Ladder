const a39_0x27749a=a39_0x2f79,a39_0x85f675=(function(){let _0x42b608=!![];return function(_0x50f5c7,_0x322b3c){const _0x24e0a9=_0x42b608?function(){const _0x36a071=a39_0x2f79;if(_0x322b3c){const _0x2c7632=_0x322b3c[_0x36a071(0xe7)](_0x50f5c7,arguments);return _0x322b3c=null,_0x2c7632;}}:function(){};return _0x42b608=![],_0x24e0a9;};}()),a39_0x264598=a39_0x85f675(this,function(){const _0x20a0a4=a39_0x2f79;let _0x1f026b;try{const _0x4077e5=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x1f026b=_0x4077e5();}catch(_0xdae8d5){_0x1f026b=window;}const _0x5d2a6c=_0x1f026b[_0x20a0a4(0xe6)]=_0x1f026b[_0x20a0a4(0xe6)]||{},_0x5c724a=[_0x20a0a4(0xec),'warn','info','error','exception','table',_0x20a0a4(0xf1)];for(let _0x5d40d6=0x0;_0x5d40d6<_0x5c724a['length'];_0x5d40d6++){const _0x459791=a39_0x85f675[_0x20a0a4(0xf7)][_0x20a0a4(0xed)]['bind'](a39_0x85f675),_0x5621e6=_0x5c724a[_0x5d40d6],_0x4b489e=_0x5d2a6c[_0x5621e6]||_0x459791;_0x459791['__proto__']=a39_0x85f675[_0x20a0a4(0xee)](a39_0x85f675),_0x459791['toString']=_0x4b489e['toString']['bind'](_0x4b489e),_0x5d2a6c[_0x5621e6]=_0x459791;}});a39_0x264598();import{db}from'./firebase-config.js';function a39_0x46b6(){const _0x56c9dd=['console','apply','Unknown\x20User','system-match-award','modifyUserPoints','Awarded\x20','log','prototype','bind','\x20match\x20(Participant)','all','trace',',\x20skipping\x20points\x20award','Added\x20','\x20points\x20to\x20both\x20players\x20for\x20','data','email','constructor','Match\x20points:\x20','\x20points\x20to\x20user\x20','Error\x20awarding\x20match\x20points:','add','\x20match\x20(Winner)','displayName'];a39_0x46b6=function(){return _0x56c9dd;};return a39_0x46b6();}import{doc,getDoc,updateDoc,addDoc,collection,serverTimestamp}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const POINTS_CHART={'':0xa,'Standard':0xa,'Fusion\x20Match':0x19,'â‰¥6\x20Missiles':0xa,'Weapon\x20Imbalance':0x1e,'Blind\x20Match':0x4b,'Rematch':0x14,'Disorientation':0x32,'Ratting':0x23,'Altered\x20Powerups':0x23,'Mega\x20Match':0x28,'Dogfight':0x32,'Gauss\x20and\x20Mercs':0x19,'Misc':0x1e};function a39_0x2f79(_0x59b728,_0x460bf8){const _0x264598=a39_0x46b6();return a39_0x2f79=function(_0x85f675,_0xbd9dff){_0x85f675=_0x85f675-0xe6;let _0x46b695=_0x264598[_0x85f675];return _0x46b695;},a39_0x2f79(_0x59b728,_0x460bf8);}let adminModifyUserPoints=null;try{const adminModule=await import('./adminbackend.js');adminModule[a39_0x27749a(0xea)]&&(adminModifyUserPoints=adminModule[a39_0x27749a(0xea)],console[a39_0x27749a(0xec)]('Admin\x20points\x20service\x20connected'));}catch(a39_0x325429){console['log']('Admin\x20backend\x20not\x20available,\x20using\x20fallback\x20points\x20service');}export async function awardMatchPoints(_0x4cd06c,_0x400c4d,_0x5a96ea){const _0x3901bd=a39_0x27749a;try{const _0x3e4911=POINTS_CHART[_0x5a96ea]||0xa;return adminModifyUserPoints?await Promise[_0x3901bd(0xf0)]([adminModifyUserPoints(_0x4cd06c,_0x3901bd(0xfb),_0x3e4911,'Match\x20points:\x20'+(_0x5a96ea||'Standard')+_0x3901bd(0xfc)),adminModifyUserPoints(_0x400c4d,'add',_0x3e4911,'Match\x20points:\x20'+(_0x5a96ea||'Standard')+_0x3901bd(0xef))]):await Promise[_0x3901bd(0xf0)]([addPointsFallback(_0x4cd06c,_0x3e4911,_0x3901bd(0xf8)+(_0x5a96ea||'Standard')+_0x3901bd(0xfc)),addPointsFallback(_0x400c4d,_0x3e4911,'Match\x20points:\x20'+(_0x5a96ea||'Standard')+'\x20match\x20(Participant)')]),console['log'](_0x3901bd(0xeb)+_0x3e4911+_0x3901bd(0xf4)+(_0x5a96ea||'Standard')+'\x20match'),!![];}catch(_0x309d0a){return console['error'](_0x3901bd(0xfa),_0x309d0a),![];}}async function addPointsFallback(_0x318e66,_0x4701e9,_0x18dc61=''){const _0x36759f=a39_0x27749a;try{const _0x54795b=doc(db,'userProfiles',_0x318e66),_0x48291d=await getDoc(_0x54795b);if(!_0x48291d['exists']()){console['log']('User\x20profile\x20not\x20found\x20for\x20'+_0x318e66+_0x36759f(0xf2));return;}const _0x44c3bb=_0x48291d[_0x36759f(0xf5)](),_0x86df4d=_0x44c3bb['points']||0x0,_0x30f135=_0x86df4d+_0x4701e9;await updateDoc(_0x54795b,{'points':_0x30f135,'lastPointsModified':serverTimestamp()}),await addDoc(collection(db,'pointsHistory'),{'userId':_0x318e66,'userEmail':_0x44c3bb[_0x36759f(0xf6)]||'unknown','displayName':_0x44c3bb[_0x36759f(0xfd)]||_0x44c3bb['username']||_0x36759f(0xe8),'action':'add','amount':_0x4701e9,'previousPoints':_0x86df4d,'newPoints':_0x30f135,'reason':_0x18dc61,'adminEmail':_0x36759f(0xe9),'timestamp':serverTimestamp()}),console['log'](_0x36759f(0xf3)+_0x4701e9+_0x36759f(0xf9)+_0x318e66+'.\x20New\x20total:\x20'+_0x30f135);}catch(_0x4512dc){console['error']('Error\x20adding\x20points\x20to\x20user:',_0x4512dc);throw _0x4512dc;}}
const a38_0x4fca4e=a38_0x20ae,a38_0x5daabd=(function(){let _0x30bf89=!![];return function(_0x16f2dc,_0x2af27f){const _0x4f8812=_0x30bf89?function(){const _0x4fa505=a38_0x20ae;if(_0x2af27f){const _0x20888b=_0x2af27f[_0x4fa505(0x150)](_0x16f2dc,arguments);return _0x2af27f=null,_0x20888b;}}:function(){};return _0x30bf89=![],_0x4f8812;};}()),a38_0xe978e4=a38_0x5daabd(this,function(){const _0x209c1d=a38_0x20ae,_0x277e30=function(){let _0x6e856;try{_0x6e856=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x27f4e9){_0x6e856=window;}return _0x6e856;},_0x53b540=_0x277e30(),_0x287ac0=_0x53b540['console']=_0x53b540['console']||{},_0x56fc8d=[_0x209c1d(0x138),_0x209c1d(0x135),_0x209c1d(0x153),_0x209c1d(0x13c),'exception','table',_0x209c1d(0x148)];for(let _0xaf78=0x0;_0xaf78<_0x56fc8d['length'];_0xaf78++){const _0x30a270=a38_0x5daabd['constructor']['prototype']['bind'](a38_0x5daabd),_0x41b263=_0x56fc8d[_0xaf78],_0x43cf55=_0x287ac0[_0x41b263]||_0x30a270;_0x30a270['__proto__']=a38_0x5daabd['bind'](a38_0x5daabd),_0x30a270[_0x209c1d(0x140)]=_0x43cf55[_0x209c1d(0x140)]['bind'](_0x43cf55),_0x287ac0[_0x41b263]=_0x30a270;}});a38_0xe978e4();const functions=require(a38_0x4fca4e(0x13a)),admin=require('firebase-admin');admin['initializeApp']();function a38_0x2374(){const _0x3009c9=['all','forEach','warn','FieldValue','userProfiles','log','commit','firebase-functions','username','error','Error\x20rebuilding\x20members\x20list:','docId','gold','toString','nonParticipants','silver','ladders','sort','Successfully\x20updated\x20aggregated\x20members\x20list','emerald','collection','trace','Error\x20updating\x20members\x20list:','data','motto','onWrite','document','serverTimestamp','isNonParticipant','apply','delete','get','info','push','doc'];a38_0x2374=function(){return _0x3009c9;};return a38_0x2374();}const db=admin['firestore']();exports['updateMembersList']=functions['firestore'][a38_0x4fca4e(0x14d)]('{collection}/{docId}')[a38_0x4fca4e(0x14c)](async(_0x1ae52c,_0x16e57c)=>{const _0xe2f945=a38_0x4fca4e,_0x109119=_0x16e57c['params']['collection'],_0x477949=_0x16e57c['params'][_0xe2f945(0x13e)];if(!['players','playersD2','playersD3','userProfiles',_0xe2f945(0x141)]['includes'](_0x109119))return null;try{await rebuildMembersList(),console[_0xe2f945(0x138)](_0xe2f945(0x145));}catch(_0x532ee5){console['error'](_0xe2f945(0x149),_0x532ee5);}});async function rebuildMembersList(){const _0x4ad14c=a38_0x4fca4e,_0x5b5ff6=db['batch'](),[_0x1ad890,_0x44e953,_0x527502,_0x2d8c01,_0x21c7f1]=await Promise[_0x4ad14c(0x133)]([db[_0x4ad14c(0x147)](_0x4ad14c(0x137))['get'](),db[_0x4ad14c(0x147)]('players')['get'](),db['collection']('playersD2')['get'](),db['collection']('playersD3')[_0x4ad14c(0x152)](),db['collection']('nonParticipants')['get']()]),_0x126015=new Map();_0x1ad890['forEach'](_0x5abff8=>{const _0x1de4b3=_0x4ad14c;_0x126015['set'](_0x5abff8['id'],_0x5abff8[_0x1de4b3(0x14a)]());});const _0x2414ce=new Map(),_0x4c963b=(_0x405cbd,_0x18a17e)=>{_0x405cbd['forEach'](_0x1113c2=>{const _0xbb6604=a38_0x20ae,_0x371244=_0x1113c2['data'](),_0x55ad8e=_0x1113c2['id'];!_0x2414ce['has'](_0x55ad8e)&&_0x2414ce['set'](_0x55ad8e,{'userId':_0x55ad8e,'username':_0x371244[_0xbb6604(0x13b)]||'Unknown','ladders':[],'isNonParticipant':![]});const _0x560754=_0x2414ce['get'](_0x55ad8e);_0x560754['ladders'][_0xbb6604(0x154)]({'ladder':_0x18a17e,'elo':_0x371244['eloRating']||0x4b0,'active':_0x371244['active']!==![]});});};_0x4c963b(_0x44e953,'D1'),_0x4c963b(_0x527502,'D2'),_0x4c963b(_0x2d8c01,'D3'),_0x21c7f1['forEach'](_0x2d3831=>{const _0x23fcfa=_0x4ad14c,_0x50e7a0=_0x2d3831['data'](),_0x5c6fd2=_0x2d3831['id'];!_0x2414ce['has'](_0x5c6fd2)&&_0x50e7a0['username']&&_0x2414ce['set'](_0x5c6fd2,{'userId':_0x5c6fd2,'username':_0x50e7a0[_0x23fcfa(0x13b)],'ladders':[],'isNonParticipant':!![]});});const _0x209cec=[];_0x2414ce['forEach']((_0x443b53,_0x5c1d3f)=>{const _0x591f44=_0x4ad14c,_0x5742fc=_0x126015['get'](_0x5c1d3f)||{};let _0x51fc67=0x0,_0x5e4976=null;if(_0x443b53['ladders']['length']>0x0){const _0x594d16=_0x443b53[_0x591f44(0x143)][_0x591f44(0x144)]((_0x447983,_0x3732bd)=>_0x3732bd['elo']-_0x447983['elo']);_0x51fc67=_0x594d16[0x0]['elo'],_0x5e4976=_0x594d16[0x0]['ladder'];}const _0x1365c4={'userId':_0x5c1d3f,'username':_0x443b53['username'],'profileImageUrl':_0x5742fc['profileImageUrl']||null,'country':_0x5742fc['country']||null,'motto':_0x5742fc[_0x591f44(0x14b)]||null,'favoriteMap':_0x5742fc['favoriteMap']||null,'favoriteWeapon':_0x5742fc['favoriteWeapon']||null,'isNonParticipant':_0x443b53[_0x591f44(0x14f)],'ladders':_0x443b53[_0x591f44(0x143)],'primaryLadder':_0x5e4976,'highestElo':_0x51fc67,'rank':getPlayerRank(_0x51fc67),'lastUpdated':admin['firestore'][_0x591f44(0x136)][_0x591f44(0x14e)]()};_0x209cec['push'](_0x1365c4);});const _0x2b43fa=db['collection']('aggregatedMembers'),_0x367d43=await _0x2b43fa['get'](),_0x31689b=[];_0x367d43[_0x4ad14c(0x134)](_0x5e3cf9=>{const _0xd5d4db=_0x4ad14c;_0x31689b['push'](_0x5e3cf9['ref'][_0xd5d4db(0x151)]());}),await Promise['all'](_0x31689b);const _0x1a0700=0x1f4,_0x3d3937=[];for(let _0x277f31=0x0;_0x277f31<_0x209cec['length'];_0x277f31+=_0x1a0700){const _0x245251=db['batch'](),_0x27c0ba=_0x209cec['slice'](_0x277f31,_0x277f31+_0x1a0700);_0x27c0ba['forEach'](_0x2eba11=>{const _0x5ae2c7=_0x4ad14c,_0x499eb5=_0x2b43fa[_0x5ae2c7(0x155)](_0x2eba11['userId']);_0x245251['set'](_0x499eb5,_0x2eba11);}),_0x3d3937[_0x4ad14c(0x154)](_0x245251[_0x4ad14c(0x139)]());}await Promise['all'](_0x3d3937);}function getPlayerRank(_0x2280ce){const _0x43f1eb=a38_0x4fca4e;if(_0x2280ce>=0x7d0)return _0x43f1eb(0x146);if(_0x2280ce>=0x708)return _0x43f1eb(0x13f);if(_0x2280ce>=0x640)return _0x43f1eb(0x142);if(_0x2280ce>=0x578)return'bronze';return'unranked';}function a38_0x20ae(_0x4b3962,_0x480a79){const _0xe978e4=a38_0x2374();return a38_0x20ae=function(_0x5daabd,_0x36acd1){_0x5daabd=_0x5daabd-0x133;let _0x237466=_0xe978e4[_0x5daabd];return _0x237466;},a38_0x20ae(_0x4b3962,_0x480a79);}exports['rebuildMembersListManual']=functions['https']['onRequest'](async(_0x3c9dbb,_0x5d0db8)=>{const _0x3d15cd=a38_0x4fca4e;try{await rebuildMembersList(),_0x5d0db8['status'](0xc8)['send']('Members\x20list\x20rebuilt\x20successfully');}catch(_0x3d0f1e){console[_0x3d15cd(0x13c)](_0x3d15cd(0x13d),_0x3d0f1e),_0x5d0db8['status'](0x1f4)['send']('Error\x20rebuilding\x20members\x20list');}});
const a13_0x54c40b=a13_0x2fc6,a13_0x17cb98=(function(){let _0x516345=!![];return function(_0x168435,_0x2221ac){const _0x183618=_0x516345?function(){if(_0x2221ac){const _0x298df2=_0x2221ac['apply'](_0x168435,arguments);return _0x2221ac=null,_0x298df2;}}:function(){};return _0x516345=![],_0x183618;};}()),a13_0x585532=a13_0x17cb98(this,function(){const _0x10f463=a13_0x2fc6,_0x5c3d7b=function(){let _0x548706;try{_0x548706=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x2ca050){_0x548706=window;}return _0x548706;},_0x467a90=_0x5c3d7b(),_0x48fdb1=_0x467a90['console']=_0x467a90['console']||{},_0x5a688b=[_0x10f463(0x17e),'warn',_0x10f463(0x177),'error',_0x10f463(0x176),'table','trace'];for(let _0x59c5bb=0x0;_0x59c5bb<_0x5a688b['length'];_0x59c5bb++){const _0x5781be=a13_0x17cb98['constructor'][_0x10f463(0x182)]['bind'](a13_0x17cb98),_0x474f12=_0x5a688b[_0x59c5bb],_0x1690a3=_0x48fdb1[_0x474f12]||_0x5781be;_0x5781be['__proto__']=a13_0x17cb98['bind'](a13_0x17cb98),_0x5781be['toString']=_0x1690a3[_0x10f463(0x184)][_0x10f463(0x178)](_0x1690a3),_0x48fdb1[_0x474f12]=_0x5781be;}});a13_0x585532();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc,where}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D3=[{'name':'Emerald','elo':0x7d0},{'name':a13_0x54c40b(0x185),'elo':0x708},{'name':'Silver','elo':0x640},{'name':'Bronze','elo':0x578},{'name':'Unranked','elo':0x4b0}];function a13_0x64f7(){const _0x305da2=['desc','error','data','winnerUsername','all','newElo','exception','info','bind','Unknown\x20Player','match','winnerId','username','exists','log','Emerald','D3\x20ELO\x20history\x20recorded\x20for\x20','docs','prototype','empty','toString','Gold','timestamp'];a13_0x64f7=function(){return _0x305da2;};return a13_0x64f7();}function a13_0x2fc6(_0x4f31c9,_0x1bd219){const _0x585532=a13_0x64f7();return a13_0x2fc6=function(_0x17cb98,_0x565263){_0x17cb98=_0x17cb98-0x170;let _0x64f7d6=_0x585532[_0x17cb98];return _0x64f7d6;},a13_0x2fc6(_0x4f31c9,_0x1bd219);}let lastVisibleD3=null;async function getUsernameByIdD3(_0x5f17e0){const _0x495eb1=a13_0x54c40b;try{if(!_0x5f17e0)return _0x495eb1(0x179);const _0x33a4fb=await getDoc(doc(db,'playersD3',_0x5f17e0));if(_0x33a4fb[_0x495eb1(0x17d)]())return _0x33a4fb[_0x495eb1(0x172)]()[_0x495eb1(0x17c)]||'Unknown\x20Player';const _0x49d034=await getDocs(query(collection(db,'approvedMatchesD3'),where(_0x495eb1(0x17b),'==',_0x5f17e0),limit(0x1)));if(!_0x49d034['empty'])return _0x49d034['docs'][0x0][_0x495eb1(0x172)]()[_0x495eb1(0x173)]||'Unknown\x20Player';const _0x543914=await getDocs(query(collection(db,'approvedMatchesD3'),where('loserId','==',_0x5f17e0),limit(0x1)));if(!_0x543914[_0x495eb1(0x183)])return _0x543914['docs'][0x0][_0x495eb1(0x172)]()['loserUsername']||'Unknown\x20Player';return'Unknown\x20Player';}catch(_0x5bbb77){return console['error']('Error\x20getting\x20D3\x20username:',_0x5bbb77),'Unknown\x20Player';}}export async function recordEloChangeD3({playerId:_0x3e66c7,previousElo:_0x28d328,newElo:_0x3f0c7f,opponentId:_0x51138e,matchResult:_0xb689d3,previousPosition:_0x30dd57,newPosition:_0xd6697b,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x446cb9,timestamp:_0x43d600}){const _0x437e44=a13_0x54c40b;try{const _0x28cc50=doc(collection(db,'eloHistoryD3'));let _0x15f887=_0x437e44(0x17a);if(isPromotion)_0x15f887='promotion';if(isDemotion)_0x15f887='demotion';let _0x1d12f3='Unranked';if(_0x3f0c7f>=0x7d0)_0x1d12f3=_0x437e44(0x17f);else{if(_0x3f0c7f>=0x708)_0x1d12f3='Gold';else{if(_0x3f0c7f>=0x640)_0x1d12f3='Silver';else{if(_0x3f0c7f>=0x578)_0x1d12f3='Bronze';}}}return await setDoc(_0x28cc50,{'type':_0x15f887,'player':_0x3e66c7,'opponent':_0x51138e,'previousElo':_0x28d328,'newElo':_0x3f0c7f,'change':_0x3f0c7f-_0x28d328,'matchResult':_0xb689d3,'previousPosition':_0x30dd57,'newPosition':_0xd6697b,'rankAchieved':_0x1d12f3,'matchId':_0x446cb9,'timestamp':_0x43d600||serverTimestamp(),'gameMode':'D3'}),console[_0x437e44(0x17e)](_0x437e44(0x180)+_0x3e66c7),!![];}catch(_0x4b01a1){console['error']('Error\x20recording\x20D3\x20ELO\x20history:',_0x4b01a1);throw _0x4b01a1;}}export async function getEloHistoryD3(_0x550410=0x14){const _0x32993a=a13_0x54c40b;try{const _0x578226=collection(db,'eloHistoryD3');let _0x4a333d;lastVisibleD3?_0x4a333d=query(_0x578226,orderBy('timestamp','desc'),startAfter(lastVisibleD3),limit(_0x550410)):_0x4a333d=query(_0x578226,orderBy('timestamp',_0x32993a(0x170)),limit(_0x550410));const _0x559f27=await getDocs(_0x4a333d);if(_0x559f27['empty'])return{'entries':[],'hasMore':![]};lastVisibleD3=_0x559f27['docs'][_0x559f27[_0x32993a(0x181)]['length']-0x1];const _0x2c79e7=_0x559f27['docs']['map'](async _0x3cacd7=>{const _0xee7e4f=_0x32993a,_0x41794b=_0x3cacd7['data'](),[_0x3206d3,_0x15ab15]=await Promise['all']([getUsernameByIdD3(_0x41794b['player']),getUsernameByIdD3(_0x41794b['opponent'])]);return{..._0x41794b,'playerUsername':_0x3206d3,'opponentUsername':_0x15ab15,'change':_0x41794b[_0xee7e4f(0x175)]-_0x41794b['previousElo'],'timestamp':_0x41794b[_0xee7e4f(0x186)]};}),_0x185032=await Promise[_0x32993a(0x174)](_0x2c79e7);return{'entries':_0x185032,'hasMore':_0x559f27['size']===_0x550410};}catch(_0x5c7735){console[_0x32993a(0x171)]('Error\x20fetching\x20D3\x20ELO\x20history:',_0x5c7735);throw _0x5c7735;}}export function resetPaginationD3(){lastVisibleD3=null;}
const a50_0x1a8070=(function(){let _0x4c2845=!![];return function(_0x4ae27f,_0xc69bf7){const _0x3f6223=_0x4c2845?function(){if(_0xc69bf7){const _0x2e9388=_0xc69bf7['apply'](_0x4ae27f,arguments);return _0xc69bf7=null,_0x2e9388;}}:function(){};return _0x4c2845=![],_0x3f6223;};}()),a50_0x5b6905=a50_0x1a8070(this,function(){const _0x4c8205=a50_0x1056;let _0x554096;try{const _0x2d31d0=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x554096=_0x2d31d0();}catch(_0x16ba3f){_0x554096=window;}const _0x454dee=_0x554096['console']=_0x554096['console']||{},_0x54169e=['log','warn','info','error',_0x4c8205(0x181),'table','trace'];for(let _0x23c661=0x0;_0x23c661<_0x54169e[_0x4c8205(0x17a)];_0x23c661++){const _0x1fb39b=a50_0x1a8070['constructor']['prototype'][_0x4c8205(0x17b)](a50_0x1a8070),_0x15caf2=_0x54169e[_0x23c661],_0x15e9bb=_0x454dee[_0x15caf2]||_0x1fb39b;_0x1fb39b['__proto__']=a50_0x1a8070['bind'](a50_0x1a8070),_0x1fb39b[_0x4c8205(0x17c)]=_0x15e9bb['toString']['bind'](_0x15e9bb),_0x454dee[_0x15caf2]=_0x1fb39b;}});a50_0x5b6905();import{db}from'../firebase-config.js';import{collection,doc,getDoc,getDocs,query,limit,startAfter,where,onSnapshot}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const cache={'userProfiles':new Map(),'ladderPlayers':new Map(),'matchResults':new Map(),'eloHistory':new Map()},CACHE_EXPIRY={'userProfiles':0x5*0x3c*0x3e8,'ladderPlayers':0x2*0x3c*0x3e8,'matchResults':0x1*0x3c*0x3e8,'eloHistory':0x3*0x3c*0x3e8};export const userProfilesRef=collection(db,'userProfiles');function a50_0x1056(_0x37c2f0,_0x208784){const _0x5b6905=a50_0x342a();return a50_0x1056=function(_0x1a8070,_0x2e56fb){_0x1a8070=_0x1a8070-0x171;let _0x342a65=_0x5b6905[_0x1a8070];return _0x342a65;},a50_0x1056(_0x37c2f0,_0x208784);}export async function fetchPaginatedData(_0x59d357,_0x4b8f23=0xa,_0x46b9f1=null){const _0x368efb=a50_0x1056;let _0x356ce1=query(_0x59d357,limit(_0x4b8f23));_0x46b9f1&&(_0x356ce1=query(_0x356ce1,startAfter(_0x46b9f1)));const _0x1cb033=await getDocs(_0x356ce1),_0xd7d502=_0x1cb033['docs'][_0x1cb033['docs']['length']-0x1];return{'data':_0x1cb033['docs'][_0x368efb(0x17f)](_0x487433=>({'id':_0x487433['id'],..._0x487433['data']()})),'lastVisible':_0xd7d502,'hasMore':_0x1cb033['docs']['length']===_0x4b8f23};}export async function getUserProfile(_0x46add9){const _0x25b3d4=a50_0x1056,_0xe466e1=cache['userProfiles'][_0x25b3d4(0x178)](_0x46add9);if(_0xe466e1&&Date['now']()-_0xe466e1[_0x25b3d4(0x17e)]<CACHE_EXPIRY['userProfiles'])return _0xe466e1['data'];const _0x2a8157=await getDoc(doc(userProfilesRef,_0x46add9));if(_0x2a8157['exists']()){const _0x2cb21f=_0x2a8157['data']();return cache['userProfiles']['set'](_0x46add9,{'data':_0x2cb21f,'timestamp':Date['now']()}),_0x2cb21f;}return null;}export async function getLadderData(_0x3dc7f5=0x1){const _0x1e2f56=a50_0x1056,_0x1d9fb6=_0x1e2f56(0x185)+_0x3dc7f5,_0x1bc3e3=cache['ladderPlayers']['get'](_0x1d9fb6);if(_0x1bc3e3&&Date['now']()-_0x1bc3e3['timestamp']<CACHE_EXPIRY['ladderPlayers'])return _0x1bc3e3['data'];const _0x398c84=_0x3dc7f5===0x1?'players':_0x1e2f56(0x173)+_0x3dc7f5,_0x58a90e=collection(db,_0x398c84),_0xb2e139=await getDocs(query(_0x58a90e,limit(0x64))),_0x32c966=_0xb2e139[_0x1e2f56(0x171)][_0x1e2f56(0x17f)](_0x4d9083=>({'id':_0x4d9083['id'],..._0x4d9083[_0x1e2f56(0x177)]()}));return cache['ladderPlayers'][_0x1e2f56(0x184)](_0x1d9fb6,{'data':_0x32c966,'timestamp':Date['now']()}),_0x32c966;}export async function getEloHistoryBatch(_0x5a3354,_0x1f2eb2=0x1){const _0x2243ca=a50_0x1056,_0x597f14=_0x1f2eb2===0x1?'eloHistory':'eloHistoryD'+_0x1f2eb2,_0x4a40d3=collection(db,_0x597f14),_0x34a897={},_0x1c4c15=[];_0x5a3354['forEach'](_0x73fd20=>{const _0x5db109=a50_0x1056,_0x5637b4=_0x73fd20+'_'+_0x1f2eb2,_0x5e4341=cache['eloHistory']['get'](_0x5637b4);_0x5e4341&&Date['now']()-_0x5e4341[_0x5db109(0x17e)]<CACHE_EXPIRY['eloHistory']?_0x34a897[_0x73fd20]=_0x5e4341['data']:_0x1c4c15['push'](_0x73fd20);});const _0x3dc21e=0xa;for(let _0x1b56f1=0x0;_0x1b56f1<_0x1c4c15['length'];_0x1b56f1+=_0x3dc21e){const _0x5e2ab3=_0x1c4c15[_0x2243ca(0x17d)](_0x1b56f1,_0x1b56f1+_0x3dc21e);if(_0x5e2ab3['length']>0x0)try{const _0x254090=query(_0x4a40d3,where(_0x2243ca(0x180),'in',_0x5e2ab3),limit(0x64)),_0x173a9a=await getDocs(_0x254090);_0x173a9a['docs']['forEach'](_0x2265bc=>{const _0x326198=_0x2243ca,_0x43791f=_0x2265bc[_0x326198(0x177)](),_0x4500fc=_0x43791f['playerId'];if(!_0x34a897[_0x4500fc])_0x34a897[_0x4500fc]=[];_0x34a897[_0x4500fc]['push'](_0x43791f);const _0x12f47a=_0x4500fc+'_'+_0x1f2eb2;cache[_0x326198(0x174)]['set'](_0x12f47a,{'data':_0x34a897[_0x4500fc],'timestamp':Date[_0x326198(0x179)]()});});}catch(_0x52afcd){console['error'](_0x2243ca(0x182),_0x52afcd);}}return _0x34a897;}let usernameCache=new Map(),usernameCacheTimestamp=Date['now']();function a50_0x342a(){const _0x147ef3=['docs','playersD2','playersD','eloHistory','forEach','username','data','get','now','length','bind','toString','slice','timestamp','map','playerId','exception','Error\x20fetching\x20batch\x20ELO\x20history:','players','set','division_'];a50_0x342a=function(){return _0x147ef3;};return a50_0x342a();}export function setupEfficientListener(_0x3cd666,_0x1d7581=[],_0x1385eb){const _0x84c69b=collection(db,_0x3cd666),_0x41b528=query(_0x84c69b,..._0x1d7581),_0x1b6b31=onSnapshot(_0x41b528,_0x5ea639=>{const _0x49b7dc=a50_0x1056,_0x58e53b=_0x5ea639['docChanges']()[_0x49b7dc(0x17f)](_0x2de94f=>({'type':_0x2de94f['type'],'id':_0x2de94f['doc']['id'],'data':_0x2de94f['doc']['data']()}));_0x58e53b['length']>0x0&&_0x1385eb(_0x58e53b,_0x5ea639[_0x49b7dc(0x171)]);});return _0x1b6b31;}export async function bulkResolveUsernames(_0x4a7517){const _0x403507=a50_0x1056,_0x43149b=new Map();if(!_0x4a7517||_0x4a7517[_0x403507(0x17a)]===0x0)return _0x43149b;const _0xfd9ea9=[_0x403507(0x183),_0x403507(0x172),'playersD3','nonParticipants'];for(const _0x17c782 of _0xfd9ea9){const _0x56c164=collection(db,_0x17c782),_0x2f54a1=await getDocs(_0x56c164);_0x2f54a1[_0x403507(0x175)](_0x56f32e=>{const _0x2fc4cc=_0x403507,_0x52c055=_0x56f32e['data']();_0x52c055['username']&&_0x4a7517['includes'](_0x56f32e['id'])&&_0x43149b[_0x2fc4cc(0x184)](_0x56f32e['id'],_0x52c055[_0x2fc4cc(0x176)]);});}return _0x43149b;}
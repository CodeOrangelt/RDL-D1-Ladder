(function(_0xd7302,_0x453c67){const _0x120722=a29_0x3575,_0x9fabb9=_0xd7302();while(!![]){try{const _0x491ff4=parseInt(_0x120722(0xec))/0x1+-parseInt(_0x120722(0x106))/0x2*(-parseInt(_0x120722(0xe6))/0x3)+-parseInt(_0x120722(0xe7))/0x4*(parseInt(_0x120722(0xfb))/0x5)+parseInt(_0x120722(0xfc))/0x6*(-parseInt(_0x120722(0x100))/0x7)+parseInt(_0x120722(0xf2))/0x8+-parseInt(_0x120722(0xd4))/0x9*(parseInt(_0x120722(0x105))/0xa)+parseInt(_0x120722(0xe0))/0xb;if(_0x491ff4===_0x453c67)break;else _0x9fabb9['push'](_0x9fabb9['shift']());}catch(_0xc727d9){_0x9fabb9['push'](_0x9fabb9['shift']());}}}(a29_0x1747,0xd2b39));const a29_0x3b22ab=(function(){let _0x24978d=!![];return function(_0x868c17,_0x4cc21d){const _0xf24250=_0x24978d?function(){const _0x62c513=a29_0x3575;if(_0x4cc21d){const _0x22f406=_0x4cc21d[_0x62c513(0xf0)](_0x868c17,arguments);return _0x4cc21d=null,_0x22f406;}}:function(){};return _0x24978d=![],_0xf24250;};}()),a29_0x28e368=a29_0x3b22ab(this,function(){const _0x3ef159=a29_0x3575;return a29_0x28e368[_0x3ef159(0xf4)]()[_0x3ef159(0xfe)](_0x3ef159(0xf5))[_0x3ef159(0xf4)]()[_0x3ef159(0x101)](a29_0x28e368)[_0x3ef159(0xfe)](_0x3ef159(0xf5));});a29_0x28e368();const a29_0x54b264=(function(){let _0x5caece=!![];return function(_0x5debdf,_0x7494bf){const _0x51c634=_0x5caece?function(){const _0x35b5d4=a29_0x3575;if(_0x7494bf){const _0x23c7cf=_0x7494bf[_0x35b5d4(0xf0)](_0x5debdf,arguments);return _0x7494bf=null,_0x23c7cf;}}:function(){};return _0x5caece=![],_0x51c634;};}()),a29_0x11e2c1=a29_0x54b264(this,function(){const _0x388ad6=a29_0x3575;let _0x5da32f;try{const _0x589e52=Function(_0x388ad6(0xdd)+_0x388ad6(0xeb)+');');_0x5da32f=_0x589e52();}catch(_0x579b52){_0x5da32f=window;}const _0x304662=_0x5da32f[_0x388ad6(0xd3)]=_0x5da32f['console']||{},_0x296b57=['log','warn','info',_0x388ad6(0xee),_0x388ad6(0xd6),_0x388ad6(0xea),'trace'];for(let _0x35a47f=0x0;_0x35a47f<_0x296b57[_0x388ad6(0xfa)];_0x35a47f++){const _0x3d5a65=a29_0x54b264['constructor']['prototype'][_0x388ad6(0xf6)](a29_0x54b264),_0xe13268=_0x296b57[_0x35a47f],_0x96cdc6=_0x304662[_0xe13268]||_0x3d5a65;_0x3d5a65[_0x388ad6(0xef)]=a29_0x54b264[_0x388ad6(0xf6)](a29_0x54b264),_0x3d5a65['toString']=_0x96cdc6[_0x388ad6(0xf4)][_0x388ad6(0xf6)](_0x96cdc6),_0x304662[_0xe13268]=_0x3d5a65;}});a29_0x11e2c1();function a29_0x3575(_0x303559,_0x5c6136){const _0x70952f=a29_0x1747();return a29_0x3575=function(_0x11e2c1,_0x54b264){_0x11e2c1=_0x11e2c1-0xd0;let _0x3bd3bc=_0x70952f[_0x11e2c1];return _0x3bd3bc;},a29_0x3575(_0x303559,_0x5c6136);}import{addDoc,updateDoc,serverTimestamp,collection,doc,getDoc,getDocs,query,where,setDoc,deleteDoc,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';import{recordEloChangeD3}from'./elo-history-d3.js';export function calculateEloD3(_0x41df44,_0x49e370,_0x746366=0x20){const _0x1011f1=a29_0x3575,_0x42f075=0x1/(0x1+Math[_0x1011f1(0xff)](0xa,(_0x49e370-_0x41df44)/0x190)),_0x3fead9=0x1/(0x1+Math[_0x1011f1(0xff)](0xa,(_0x41df44-_0x49e370)/0x190)),_0x1fcf32=_0x41df44+_0x746366*(0x1-_0x42f075),_0x1b4612=_0x49e370+_0x746366*(0x0-_0x3fead9);return{'newWinnerRating':Math[_0x1011f1(0xdc)](_0x1fcf32),'newLoserRating':Math[_0x1011f1(0xdc)](_0x1b4612)};}export async function updateEloRatingsD3(_0x2e7471,_0x55a952,_0x32266f){const _0x54ffc9=a29_0x3575;try{const _0x237fdc=writeBatch(db),_0x5db2de=doc(db,_0x54ffc9(0xde),_0x2e7471),_0x53957a=doc(db,_0x54ffc9(0xde),_0x55a952),[_0x273857,_0x492e88]=await Promise[_0x54ffc9(0xf9)]([getDoc(_0x5db2de),getDoc(_0x53957a)]);if(!_0x273857[_0x54ffc9(0xe8)]()||!_0x492e88[_0x54ffc9(0xe8)]())throw new Error(_0x54ffc9(0xf8));const _0x2b5865=_0x273857[_0x54ffc9(0xd5)](),_0x1b28a9=_0x492e88[_0x54ffc9(0xd5)](),_0x87659a=_0x2b5865[_0x54ffc9(0xdf)]||Number[_0x54ffc9(0xed)],_0x2f048e=_0x1b28a9[_0x54ffc9(0xdf)]||Number[_0x54ffc9(0xed)],{newWinnerRating:_0x3a003d,newLoserRating:_0x20c02d}=calculateEloD3(_0x2b5865[_0x54ffc9(0xf1)]||0x4b0,_0x1b28a9['eloRating']||0x4b0);let _0x48f9b1=_0x87659a,_0x42fc8e=_0x2f048e;if(_0x87659a>_0x2f048e){console[_0x54ffc9(0xdb)](_0x54ffc9(0x103)),_0x48f9b1=_0x2f048e,_0x42fc8e=_0x2f048e+0x1;const _0x39a061=query(collection(db,_0x54ffc9(0xde)),where(_0x54ffc9(0xdf),'>',_0x2f048e),where(_0x54ffc9(0xdf),'<',_0x87659a)),_0x13b488=await getDocs(_0x39a061);for(const _0x42dc49 of _0x13b488[_0x54ffc9(0xd0)]){_0x42dc49['id']!==_0x2e7471&&_0x42dc49['id']!==_0x55a952&&_0x237fdc['update'](doc(db,'playersD3',_0x42dc49['id']),{'position':_0x42dc49[_0x54ffc9(0xd5)]()[_0x54ffc9(0xdf)]+0x1});}}else console['log'](_0x54ffc9(0xe9));return _0x237fdc['update'](_0x5db2de,{'eloRating':_0x3a003d,'lastMatchDate':serverTimestamp(),'position':_0x48f9b1,'lastMatchId':_0x32266f}),_0x237fdc[_0x54ffc9(0xe2)](_0x53957a,{'eloRating':_0x20c02d,'lastMatchDate':serverTimestamp(),'position':_0x42fc8e,'lastMatchId':_0x32266f}),await _0x237fdc['commit'](),console[_0x54ffc9(0xdb)](_0x54ffc9(0xda)),await Promise[_0x54ffc9(0xf9)]([recordEloChangeD3({'playerId':_0x2e7471,'previousElo':_0x2b5865['eloRating']||0x4b0,'newElo':_0x3a003d,'opponentId':_0x55a952,'matchResult':_0x54ffc9(0x102),'previousPosition':_0x87659a,'newPosition':_0x48f9b1,'isPromotion':_0x48f9b1<_0x87659a,'matchId':_0x32266f,'timestamp':serverTimestamp()}),recordEloChangeD3({'playerId':_0x55a952,'previousElo':_0x1b28a9[_0x54ffc9(0xf1)]||0x4b0,'newElo':_0x20c02d,'opponentId':_0x2e7471,'matchResult':_0x54ffc9(0xd1),'previousPosition':_0x2f048e,'newPosition':_0x42fc8e,'isDemotion':_0x42fc8e>_0x2f048e,'matchId':_0x32266f,'timestamp':serverTimestamp()})]),!![];}catch(_0xb0aff4){console[_0x54ffc9(0xee)]('Error\x20in\x20updateEloRatingsD3:',_0xb0aff4);throw _0xb0aff4;}}function a29_0x1747(){const _0x4feaa5=['One\x20or\x20both\x20D3\x20players\x20not\x20found','all','length','2629180OaZFoj','474252nTUJRu','Current\x20username:','search','pow','112ScvnLS','constructor','win','D3\x20Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked','D3\x20Report\x20not\x20found\x20with\x20ID:','350LeSlna','47492aReiCa','pendingMatchesD3','You\x20must\x20be\x20logged\x20in\x20to\x20approve\x20D3\x20matches','docs','loss','username','console','152883nTRPAq','data','exception','loserUsername','Error\x20in\x20approveReportD3:','currentUser','D3\x20ELO\x20ratings\x20updated\x20successfully','log','round','return\x20(function()\x20','playersD3','position','15325167IknNgl','Only\x20the\x20winner\x20can\x20approve\x20D3\x20matches','update','winnerUsername','D3\x20match\x20report\x20not\x20found','email','174yHHikk','4vSqXKh','exists','D3\x20Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions','table','{}.constructor(\x22return\x20this\x22)(\x20)','241153TQLAKu','MAX_SAFE_INTEGER','error','__proto__','apply','eloRating','1891744Qsiadf','empty','toString','(((.+)+)+)+$','bind','No\x20user\x20logged\x20in'];a29_0x1747=function(){return _0x4feaa5;};return a29_0x1747();}export async function approveReportD3(_0x52c29f,_0x1f28a1,_0x55221f,_0x10cebc){const _0x4cbfc9=a29_0x3575;try{console[_0x4cbfc9(0xdb)]('Starting\x20approveReportD3\x20function\x20with:',{'reportId':_0x52c29f,'winnerScore':_0x1f28a1,'winnerSuicides':_0x55221f,'winnerComment':_0x10cebc});const _0x5de91f=auth[_0x4cbfc9(0xd9)];if(!_0x5de91f){console[_0x4cbfc9(0xdb)](_0x4cbfc9(0xf7));throw new Error(_0x4cbfc9(0x108));}console[_0x4cbfc9(0xdb)]('Current\x20user:',_0x5de91f[_0x4cbfc9(0xe5)]);const _0xf40a32=await getDoc(doc(db,_0x4cbfc9(0xde),_0x5de91f['uid'])),_0x4d50f3=_0xf40a32[_0x4cbfc9(0xe8)]()?_0xf40a32[_0x4cbfc9(0xd5)]()[_0x4cbfc9(0xd2)]:null;console['log'](_0x4cbfc9(0xfd),_0x4d50f3);const _0x1b79a2=doc(db,_0x4cbfc9(0x107),_0x52c29f),_0x339fef=await getDoc(_0x1b79a2);if(!_0x339fef[_0x4cbfc9(0xe8)]()){console[_0x4cbfc9(0xdb)](_0x4cbfc9(0x104),_0x52c29f);throw new Error(_0x4cbfc9(0xe4));}const _0x5f5842=_0x339fef[_0x4cbfc9(0xd5)]();console['log']('D3\x20Report\x20data:',_0x5f5842);if(_0x4d50f3!==_0x5f5842[_0x4cbfc9(0xe3)])throw new Error(_0x4cbfc9(0xe1));const _0x1aa36d={..._0x5f5842,'winnerScore':_0x1f28a1,'winnerSuicides':_0x55221f,'winnerComment':_0x10cebc,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':_0x4d50f3,'createdAt':_0x5f5842['createdAt']||serverTimestamp(),'winnerUsername':_0x5f5842[_0x4cbfc9(0xe3)],'loserUsername':_0x5f5842[_0x4cbfc9(0xd7)]};await setDoc(doc(db,'approvedMatchesD3',_0x52c29f),_0x1aa36d),await deleteDoc(_0x1b79a2),console[_0x4cbfc9(0xdb)]('D3\x20Match\x20moved\x20to\x20approved\x20collection');const [_0x2d26d7,_0x490f80]=await Promise['all']([getDocs(query(collection(db,'playersD3'),where(_0x4cbfc9(0xd2),'==',_0x5f5842[_0x4cbfc9(0xe3)]))),getDocs(query(collection(db,_0x4cbfc9(0xde)),where(_0x4cbfc9(0xd2),'==',_0x5f5842['loserUsername'])))]);if(_0x2d26d7[_0x4cbfc9(0xf3)]||_0x490f80[_0x4cbfc9(0xf3)])throw new Error('Could\x20not\x20find\x20D3\x20player\x20documents');const _0x5853be=_0x2d26d7['docs'][0x0]['id'],_0x3ff9ea=_0x490f80[_0x4cbfc9(0xd0)][0x0]['id'];return await updateEloRatingsD3(_0x5853be,_0x3ff9ea,_0x52c29f),console[_0x4cbfc9(0xdb)]('D3\x20Match\x20successfully\x20approved\x20and\x20ELO\x20updated'),!![];}catch(_0x3e2f31){console[_0x4cbfc9(0xee)](_0x4cbfc9(0xd8),_0x3e2f31);throw _0x3e2f31;}}
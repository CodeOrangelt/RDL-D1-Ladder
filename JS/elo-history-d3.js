const a13_0x405e1f=a13_0x4a5b,a13_0x1751e9=(function(){let _0x212630=!![];return function(_0x220734,_0x43fa3b){const _0x11ec16=_0x212630?function(){if(_0x43fa3b){const _0x226ea1=_0x43fa3b['apply'](_0x220734,arguments);return _0x43fa3b=null,_0x226ea1;}}:function(){};return _0x212630=![],_0x11ec16;};}()),a13_0xbb84ff=a13_0x1751e9(this,function(){const _0x31ef2f=a13_0x4a5b,_0x205b05=function(){const _0x2e2eda=a13_0x4a5b;let _0x1858db;try{_0x1858db=Function('return\x20(function()\x20'+_0x2e2eda(0xe9)+');')();}catch(_0x1c44b7){_0x1858db=window;}return _0x1858db;},_0x583149=_0x205b05(),_0x1ae81a=_0x583149['console']=_0x583149[_0x31ef2f(0xe4)]||{},_0x6989d8=[_0x31ef2f(0xea),'warn',_0x31ef2f(0xe7),'error','exception',_0x31ef2f(0xe8),'trace'];for(let _0x133ddc=0x0;_0x133ddc<_0x6989d8['length'];_0x133ddc++){const _0x1564ec=a13_0x1751e9[_0x31ef2f(0xf5)][_0x31ef2f(0xef)]['bind'](a13_0x1751e9),_0x509e74=_0x6989d8[_0x133ddc],_0x5c85f0=_0x1ae81a[_0x509e74]||_0x1564ec;_0x1564ec[_0x31ef2f(0xf3)]=a13_0x1751e9['bind'](a13_0x1751e9),_0x1564ec['toString']=_0x5c85f0['toString']['bind'](_0x5c85f0),_0x1ae81a[_0x509e74]=_0x1564ec;}});a13_0xbb84ff();function a13_0x4a5b(_0x23b205,_0x35b27e){const _0xbb84ff=a13_0x217c();return a13_0x4a5b=function(_0x1751e9,_0x392626){_0x1751e9=_0x1751e9-0xe0;let _0x217cf0=_0xbb84ff[_0x1751e9];return _0x217cf0;},a13_0x4a5b(_0x23b205,_0x35b27e);}import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc,where}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';function a13_0x217c(){const _0xc0cabd=['newElo','empty','docs','username','console','all','desc','info','table','{}.constructor(\x22return\x20this\x22)(\x20)','log','Unranked','error','winnerUsername','Unknown\x20Player','prototype','loserId','playersD3','loserUsername','__proto__','Gold','constructor'];a13_0x217c=function(){return _0xc0cabd;};return a13_0x217c();}const ELO_THRESHOLDS_D3=[{'name':'Emerald','elo':0x7d0},{'name':a13_0x405e1f(0xf4),'elo':0x708},{'name':'Silver','elo':0x640},{'name':'Bronze','elo':0x578},{'name':a13_0x405e1f(0xeb),'elo':0x4b0}];let lastVisibleD3=null;async function getUsernameByIdD3(_0x2798b2){const _0xccda72=a13_0x405e1f;try{if(!_0x2798b2)return'Unknown\x20Player';const _0x2fedfe=await getDoc(doc(db,_0xccda72(0xf1),_0x2798b2));if(_0x2fedfe['exists']())return _0x2fedfe['data']()[_0xccda72(0xe3)]||'Unknown\x20Player';const _0xfa87c0=await getDocs(query(collection(db,'approvedMatchesD3'),where('winnerId','==',_0x2798b2),limit(0x1)));if(!_0xfa87c0['empty'])return _0xfa87c0['docs'][0x0]['data']()[_0xccda72(0xed)]||'Unknown\x20Player';const _0x706b4b=await getDocs(query(collection(db,'approvedMatchesD3'),where(_0xccda72(0xf0),'==',_0x2798b2),limit(0x1)));if(!_0x706b4b[_0xccda72(0xe1)])return _0x706b4b['docs'][0x0]['data']()[_0xccda72(0xf2)]||_0xccda72(0xee);return'Unknown\x20Player';}catch(_0x1e010f){return console[_0xccda72(0xec)]('Error\x20getting\x20D3\x20username:',_0x1e010f),'Unknown\x20Player';}}export async function recordEloChangeD3({playerId:_0x340e36,previousElo:_0x18c5db,newElo:_0x12444d,opponentId:_0x1c3ee1,matchResult:_0x567db8,previousPosition:_0x131819,newPosition:_0xb85b36,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x1460e6,timestamp:_0x21c417}){const _0x28d92d=a13_0x405e1f;try{const _0x3996b9=doc(collection(db,'eloHistoryD3'));let _0x36ebb9='match';if(isPromotion)_0x36ebb9='promotion';if(isDemotion)_0x36ebb9='demotion';let _0x2d7ba7='Unranked';if(_0x12444d>=0x7d0)_0x2d7ba7='Emerald';else{if(_0x12444d>=0x708)_0x2d7ba7=_0x28d92d(0xf4);else{if(_0x12444d>=0x640)_0x2d7ba7='Silver';else{if(_0x12444d>=0x578)_0x2d7ba7='Bronze';}}}return await setDoc(_0x3996b9,{'type':_0x36ebb9,'player':_0x340e36,'opponent':_0x1c3ee1,'previousElo':_0x18c5db,'newElo':_0x12444d,'change':_0x12444d-_0x18c5db,'matchResult':_0x567db8,'previousPosition':_0x131819,'newPosition':_0xb85b36,'rankAchieved':_0x2d7ba7,'matchId':_0x1460e6,'timestamp':_0x21c417||serverTimestamp(),'gameMode':'D3'}),console[_0x28d92d(0xea)]('D3\x20ELO\x20history\x20recorded\x20for\x20'+_0x340e36),!![];}catch(_0x1bbbe6){console['error']('Error\x20recording\x20D3\x20ELO\x20history:',_0x1bbbe6);throw _0x1bbbe6;}}export async function getEloHistoryD3(_0x1ff1f5=0x14){const _0x349153=a13_0x405e1f;try{const _0x29cea1=collection(db,'eloHistoryD3');let _0x335530;lastVisibleD3?_0x335530=query(_0x29cea1,orderBy('timestamp',_0x349153(0xe6)),startAfter(lastVisibleD3),limit(_0x1ff1f5)):_0x335530=query(_0x29cea1,orderBy('timestamp','desc'),limit(_0x1ff1f5));const _0x280594=await getDocs(_0x335530);if(_0x280594['empty'])return{'entries':[],'hasMore':![]};lastVisibleD3=_0x280594[_0x349153(0xe2)][_0x280594[_0x349153(0xe2)]['length']-0x1];const _0x4a5387=_0x280594[_0x349153(0xe2)]['map'](async _0x4bf7fe=>{const _0x59be69=_0x349153,_0x2d90ff=_0x4bf7fe['data'](),[_0x2be531,_0x16d357]=await Promise['all']([getUsernameByIdD3(_0x2d90ff['player']),getUsernameByIdD3(_0x2d90ff['opponent'])]);return{..._0x2d90ff,'playerUsername':_0x2be531,'opponentUsername':_0x16d357,'change':_0x2d90ff[_0x59be69(0xe0)]-_0x2d90ff['previousElo'],'timestamp':_0x2d90ff['timestamp']};}),_0x427a34=await Promise[_0x349153(0xe5)](_0x4a5387);return{'entries':_0x427a34,'hasMore':_0x280594['size']===_0x1ff1f5};}catch(_0x5764dc){console['error']('Error\x20fetching\x20D3\x20ELO\x20history:',_0x5764dc);throw _0x5764dc;}}export function resetPaginationD3(){lastVisibleD3=null;}
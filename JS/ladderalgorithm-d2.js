(function(_0x3e266c,_0x11b8b2){const _0x24fdb5=a28_0x3baf,_0x3fda17=_0x3e266c();while(!![]){try{const _0x3e7190=parseInt(_0x24fdb5(0x120))/0x1*(-parseInt(_0x24fdb5(0x100))/0x2)+-parseInt(_0x24fdb5(0xfa))/0x3+parseInt(_0x24fdb5(0x11a))/0x4+-parseInt(_0x24fdb5(0x108))/0x5+-parseInt(_0x24fdb5(0xec))/0x6*(-parseInt(_0x24fdb5(0xf0))/0x7)+parseInt(_0x24fdb5(0x121))/0x8*(-parseInt(_0x24fdb5(0xe9))/0x9)+parseInt(_0x24fdb5(0x10a))/0xa;if(_0x3e7190===_0x11b8b2)break;else _0x3fda17['push'](_0x3fda17['shift']());}catch(_0x2f65f0){_0x3fda17['push'](_0x3fda17['shift']());}}}(a28_0x5b60,0x56a71));const a28_0x37809c=(function(){let _0x49fca4=!![];return function(_0x5bdadc,_0x1afc06){const _0x4246ee=_0x49fca4?function(){const _0x4ba69=a28_0x3baf;if(_0x1afc06){const _0x554a92=_0x1afc06[_0x4ba69(0x110)](_0x5bdadc,arguments);return _0x1afc06=null,_0x554a92;}}:function(){};return _0x49fca4=![],_0x4246ee;};}()),a28_0x10d226=a28_0x37809c(this,function(){const _0x55b371=a28_0x3baf;return a28_0x10d226[_0x55b371(0xfe)]()[_0x55b371(0x103)](_0x55b371(0xf4))['toString']()[_0x55b371(0xe6)](a28_0x10d226)['search']('(((.+)+)+)+$');});a28_0x10d226();function a28_0x3baf(_0x1435e9,_0x4329cf){const _0x1b52b9=a28_0x5b60();return a28_0x3baf=function(_0x16f924,_0x4cb1eb){_0x16f924=_0x16f924-0xe4;let _0x26e700=_0x1b52b9[_0x16f924];return _0x26e700;},a28_0x3baf(_0x1435e9,_0x4329cf);}const a28_0x4cb1eb=(function(){let _0x475fa5=!![];return function(_0x1e6e97,_0x345ca7){const _0x27227a=_0x475fa5?function(){const _0x434c8f=a28_0x3baf;if(_0x345ca7){const _0x218f58=_0x345ca7[_0x434c8f(0x110)](_0x1e6e97,arguments);return _0x345ca7=null,_0x218f58;}}:function(){};return _0x475fa5=![],_0x27227a;};}()),a28_0x16f924=a28_0x4cb1eb(this,function(){const _0x2c75fe=a28_0x3baf;let _0x1f6a8d;try{const _0x2c5776=Function('return\x20(function()\x20'+_0x2c75fe(0xf2)+');');_0x1f6a8d=_0x2c5776();}catch(_0x4f957d){_0x1f6a8d=window;}const _0x5ba7b7=_0x1f6a8d[_0x2c75fe(0xf6)]=_0x1f6a8d['console']||{},_0x4c6b20=[_0x2c75fe(0xef),_0x2c75fe(0x119),_0x2c75fe(0xe7),'error',_0x2c75fe(0xff),_0x2c75fe(0x10e),_0x2c75fe(0x124)];for(let _0xdaffcb=0x0;_0xdaffcb<_0x4c6b20[_0x2c75fe(0x11c)];_0xdaffcb++){const _0x5aa63e=a28_0x4cb1eb['constructor']['prototype']['bind'](a28_0x4cb1eb),_0x594720=_0x4c6b20[_0xdaffcb],_0x476651=_0x5ba7b7[_0x594720]||_0x5aa63e;_0x5aa63e[_0x2c75fe(0xf8)]=a28_0x4cb1eb[_0x2c75fe(0xed)](a28_0x4cb1eb),_0x5aa63e[_0x2c75fe(0xfe)]=_0x476651[_0x2c75fe(0xfe)][_0x2c75fe(0xed)](_0x476651),_0x5ba7b7[_0x594720]=_0x5aa63e;}});a28_0x16f924();import{collection,doc,getDoc,getDocs,updateDoc,setDoc,deleteDoc,writeBatch,query,where,serverTimestamp,addDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';import{recordEloChangeD2}from'./elo-history-d2.js';import{promotionManager}from'./promotions.js';import a28_0x26cfb7 from'./firebase-idle-wrapper.js';export function calculateEloD2(_0x358cd2,_0x53b200,_0x5cab46=0x20){const _0x3a746a=a28_0x3baf,_0x115537=0x1/(0x1+Math['pow'](0xa,(_0x53b200-_0x358cd2)/0x190)),_0x1024ec=0x1/(0x1+Math['pow'](0xa,(_0x358cd2-_0x53b200)/0x190)),_0x397399=_0x358cd2+_0x5cab46*(0x1-_0x115537),_0x6a1b34=_0x53b200+_0x5cab46*(0x0-_0x1024ec);return{'newWinnerRating':Math[_0x3a746a(0xfd)](_0x397399),'newLoserRating':Math[_0x3a746a(0xfd)](_0x6a1b34)};}function a28_0x5b60(){const _0x4fb90e=['uid','console','exists','__proto__','all','287142AIatfY','win','Current\x20user:','round','toString','exception','8uhcBdY','loserUsername','data','search','pendingMatchesD2','email','username','D2\x20Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked','1463125sfHfld','D2\x20Report\x20not\x20found\x20with\x20ID:','10811870hspsEt','loss','D2\x20ELO\x20ratings\x20updated\x20successfully','docs','table','eloRating','apply','winnerUsername','Starting\x20approveReportD2\x20function\x20with:','update','position','createdAt','Error\x20in\x20approveReportD2:','currentUser','Only\x20the\x20winner\x20can\x20approve\x20D2\x20matches','warn','690968JapsIL','playersD2','length','No\x20user\x20logged\x20in','checkAndRecordPromotion','D2\x20match\x20report\x20not\x20found','90289vInXMo','80ANtWqE','match-d2','D2\x20Report\x20data:','trace','Error\x20in\x20updateEloRatingsD2:','D2\x20Match\x20moved\x20to\x20approved\x20collection','constructor','info','D2\x20Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions','183969WqOcDu','One\x20or\x20both\x20D2\x20players\x20not\x20found','error','329430ZUmLad','bind','empty','log','7XJSKCi','D2\x20Match\x20successfully\x20approved\x20and\x20ELO\x20updated','{}.constructor(\x22return\x20this\x22)(\x20)','MAX_SAFE_INTEGER','(((.+)+)+)+$'];a28_0x5b60=function(){return _0x4fb90e;};return a28_0x5b60();}export async function updateEloRatingsD2(_0x45f3ae,_0x391aea,_0x2598a9){const _0x4be958=a28_0x3baf;try{const _0x197c4a=writeBatch(db),_0x3fe265=doc(db,_0x4be958(0x11b),_0x45f3ae),_0xb7fc3=doc(db,_0x4be958(0x11b),_0x391aea),[_0x547f68,_0x278ee3]=await Promise[_0x4be958(0xf9)]([getDoc(_0x3fe265),getDoc(_0xb7fc3)]);if(!_0x547f68['exists']()||!_0x278ee3[_0x4be958(0xf7)]())throw new Error(_0x4be958(0xea));const _0xe21a35=_0x547f68[_0x4be958(0x102)](),_0x192cbc=_0x278ee3['data'](),_0xd3853d=_0xe21a35[_0x4be958(0x114)]||Number[_0x4be958(0xf3)],_0x29fa3a=_0x192cbc[_0x4be958(0x114)]||Number[_0x4be958(0xf3)],{newWinnerRating:_0x11e7bb,newLoserRating:_0x5f35cf}=calculateEloD2(_0xe21a35['eloRating']||0x4b0,_0x192cbc[_0x4be958(0x10f)]||0x4b0);let _0x28b5bc=_0xd3853d,_0x3d19de=_0x29fa3a;if(_0xd3853d>_0x29fa3a){console[_0x4be958(0xef)](_0x4be958(0x107)),_0x28b5bc=_0x29fa3a,_0x3d19de=_0x29fa3a+0x1;const _0x37ace6=query(collection(db,_0x4be958(0x11b)),where('position','>',_0x29fa3a),where(_0x4be958(0x114),'<',_0xd3853d)),_0x3fb7af=await getDocs(_0x37ace6);for(const _0xc2cc8a of _0x3fb7af['docs']){_0xc2cc8a['id']!==_0x45f3ae&&_0xc2cc8a['id']!==_0x391aea&&_0x197c4a['update'](doc(db,_0x4be958(0x11b),_0xc2cc8a['id']),{'position':_0xc2cc8a[_0x4be958(0x102)]()[_0x4be958(0x114)]+0x1});}}else console['log'](_0x4be958(0xe8));return _0x197c4a[_0x4be958(0x113)](_0x3fe265,{'eloRating':_0x11e7bb,'lastMatchDate':serverTimestamp(),'position':_0x28b5bc,'lastMatchId':_0x2598a9}),_0x197c4a['update'](_0xb7fc3,{'eloRating':_0x5f35cf,'lastMatchDate':serverTimestamp(),'position':_0x3d19de,'lastMatchId':_0x2598a9}),await _0x197c4a['commit'](),console[_0x4be958(0xef)](_0x4be958(0x10c)),await Promise['all']([recordEloChangeD2({'playerId':_0x45f3ae,'previousElo':_0xe21a35[_0x4be958(0x10f)]||0x4b0,'newElo':_0x11e7bb,'opponentId':_0x391aea,'matchResult':_0x4be958(0xfb),'previousPosition':_0xd3853d,'newPosition':_0x28b5bc,'isPromotion':_0x28b5bc<_0xd3853d,'matchId':_0x2598a9,'timestamp':serverTimestamp()}),recordEloChangeD2({'playerId':_0x391aea,'previousElo':_0x192cbc[_0x4be958(0x10f)]||0x4b0,'newElo':_0x5f35cf,'opponentId':_0x45f3ae,'matchResult':_0x4be958(0x10b),'previousPosition':_0x29fa3a,'newPosition':_0x3d19de,'isDemotion':_0x3d19de>_0x29fa3a,'matchId':_0x2598a9,'timestamp':serverTimestamp()})]),await promotionManager[_0x4be958(0x11e)](_0x45f3ae,_0x11e7bb,_0xe21a35[_0x4be958(0x10f)],{'source':_0x4be958(0x122),'matchId':_0x2598a9}),await promotionManager[_0x4be958(0x11e)](_0x391aea,_0x5f35cf,_0x192cbc['eloRating'],{'source':'match-d2','matchId':_0x2598a9}),!![];}catch(_0x36782d){console[_0x4be958(0xeb)](_0x4be958(0xe4),_0x36782d);throw _0x36782d;}}export async function approveReportD2(_0x4a70e4,_0x529e2e,_0x64a6a6,_0x5635fb){const _0x40917d=a28_0x3baf;try{console['log'](_0x40917d(0x112),{'reportId':_0x4a70e4,'winnerScore':_0x529e2e,'winnerSuicides':_0x64a6a6,'winnerComment':_0x5635fb});const _0x211fae=auth[_0x40917d(0x117)];if(!_0x211fae){console[_0x40917d(0xef)](_0x40917d(0x11d));throw new Error('You\x20must\x20be\x20logged\x20in\x20to\x20approve\x20D2\x20matches');}console[_0x40917d(0xef)](_0x40917d(0xfc),_0x211fae[_0x40917d(0x105)]);const _0xc93795=await getDoc(doc(db,_0x40917d(0x11b),_0x211fae[_0x40917d(0xf5)])),_0x4583d4=_0xc93795['exists']()?_0xc93795['data']()[_0x40917d(0x106)]:null;console[_0x40917d(0xef)]('Current\x20username:',_0x4583d4);const _0x409bbd=doc(db,_0x40917d(0x104),_0x4a70e4),_0x469669=await getDoc(_0x409bbd);if(!_0x469669['exists']()){console[_0x40917d(0xef)](_0x40917d(0x109),_0x4a70e4);throw new Error(_0x40917d(0x11f));}const _0x55a441=_0x469669[_0x40917d(0x102)]();console[_0x40917d(0xef)](_0x40917d(0x123),_0x55a441);if(_0x4583d4!==_0x55a441[_0x40917d(0x111)])throw new Error(_0x40917d(0x118));const _0x1928a5={..._0x55a441,'winnerScore':_0x529e2e,'winnerSuicides':_0x64a6a6,'winnerComment':_0x5635fb,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':_0x4583d4,'createdAt':_0x55a441[_0x40917d(0x115)]||serverTimestamp(),'winnerUsername':_0x55a441[_0x40917d(0x111)],'loserUsername':_0x55a441[_0x40917d(0x101)]};await setDoc(doc(db,'approvedMatchesD2',_0x4a70e4),_0x1928a5),await deleteDoc(_0x409bbd),console[_0x40917d(0xef)](_0x40917d(0xe5));const [_0x2a3db3,_0x16b39d]=await Promise[_0x40917d(0xf9)]([getDocs(query(collection(db,_0x40917d(0x11b)),where(_0x40917d(0x106),'==',_0x55a441[_0x40917d(0x111)]))),getDocs(query(collection(db,'playersD2'),where(_0x40917d(0x106),'==',_0x55a441[_0x40917d(0x101)])))]);if(_0x2a3db3[_0x40917d(0xee)]||_0x16b39d['empty'])throw new Error('Could\x20not\x20find\x20D2\x20player\x20documents');const _0x1e4317=_0x2a3db3[_0x40917d(0x10d)][0x0]['id'],_0x567fea=_0x16b39d['docs'][0x0]['id'];return await updateEloRatingsD2(_0x1e4317,_0x567fea,_0x4a70e4),console[_0x40917d(0xef)](_0x40917d(0xf1)),!![];}catch(_0x489635){console['error'](_0x40917d(0x116),_0x489635);throw _0x489635;}}
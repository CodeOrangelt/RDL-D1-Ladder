const a42_0x3f2d15=a42_0x267f,a42_0xffe245=(function(){let _0x2e85a5=!![];return function(_0x546a1a,_0x24c2c8){const _0x45e51f=_0x2e85a5?function(){const _0x1a0996=a42_0x267f;if(_0x24c2c8){const _0x16b937=_0x24c2c8[_0x1a0996(0x1fe)](_0x546a1a,arguments);return _0x24c2c8=null,_0x16b937;}}:function(){};return _0x2e85a5=![],_0x45e51f;};}()),a42_0x27856c=a42_0xffe245(this,function(){const _0x5ef4fd=a42_0x267f,_0x3639de=function(){let _0x24f8d4;try{_0x24f8d4=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x4d716a){_0x24f8d4=window;}return _0x24f8d4;},_0x589705=_0x3639de(),_0x4ebef4=_0x589705['console']=_0x589705['console']||{},_0x431240=['log','warn',_0x5ef4fd(0x1c0),'error','exception','table','trace'];for(let _0x2fe8e9=0x0;_0x2fe8e9<_0x431240['length'];_0x2fe8e9++){const _0x29285d=a42_0xffe245[_0x5ef4fd(0x1ad)]['prototype'][_0x5ef4fd(0x20c)](a42_0xffe245),_0x48e9e8=_0x431240[_0x2fe8e9],_0x2b0265=_0x4ebef4[_0x48e9e8]||_0x29285d;_0x29285d['__proto__']=a42_0xffe245['bind'](a42_0xffe245),_0x29285d['toString']=_0x2b0265[_0x5ef4fd(0x1bc)][_0x5ef4fd(0x20c)](_0x2b0265),_0x4ebef4[_0x48e9e8]=_0x29285d;}});a42_0x27856c();import{collection,doc,query,where,orderBy,limit,getDocs,addDoc,getDoc,serverTimestamp,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a42_0x267f(_0xfc3edb,_0x37f895){const _0x27856c=a42_0x51d3();return a42_0x267f=function(_0xffe245,_0x51ca19){_0xffe245=_0xffe245-0x1ac;let _0x51d341=_0x27856c[_0xffe245];return _0x51d341;},a42_0x267f(_0xfc3edb,_0x37f895);}import{auth,db}from'./firebase-config.js';class PromotionManager{constructor(){const _0x3e4ca7=a42_0x267f;this['DISPLAY_HOURS']=0x18,this[_0x3e4ca7(0x1bd)]=[{'threshold':0x578,'name':'Bronze','color':_0x3e4ca7(0x1c2)},{'threshold':0x640,'name':'Silver','color':'#C0C0C0'},{'threshold':0x708,'name':'Gold','color':_0x3e4ca7(0x1b7)},{'threshold':0x834,'name':_0x3e4ca7(0x1f3),'color':'#50C878'}],this['bannerContainer']=null,this[_0x3e4ca7(0x1b0)]=0x0,this[_0x3e4ca7(0x1bb)]=0xea60,this['pollingInterval']=null,this[_0x3e4ca7(0x1eb)]={};}['initialize'](){const _0x4680ba=a42_0x267f;this[_0x4680ba(0x210)]=document['getElementById']('promotion-banner-container');if(!this['bannerContainer']){console['error'](_0x4680ba(0x1e3));return;}this[_0x4680ba(0x1ef)]();const _0x514c02='promotions_checked_'+new Date()['toDateString'](),_0x4e54e1=sessionStorage['getItem'](_0x514c02);!_0x4e54e1&&(this['fetchRecentPromotions'](),sessionStorage[_0x4680ba(0x1d8)](_0x514c02,_0x4680ba(0x1d4))),document[_0x4680ba(0x1c8)]('visibilitychange',()=>{const _0x471234=_0x4680ba;document[_0x471234(0x1fb)]==='visible'&&!sessionStorage['getItem'](_0x514c02)&&(this[_0x471234(0x20d)](),sessionStorage['setItem'](_0x514c02,'true'));}),window['addEventListener']('beforeunload',()=>{const _0x1e0da5=_0x4680ba;this['pollingInterval']&&clearInterval(this[_0x1e0da5(0x1d2)]);});}['setupBannerContainer'](){const _0x3c31d5=a42_0x267f;this['bannerContainer'][_0x3c31d5(0x1f2)]='',this['bannerContainer']['style']['display']=_0x3c31d5(0x1f4);}async['fetchRecentPromotions'](){const _0xf02dd1=a42_0x267f;try{const _0x348f44=Date['now']();if(_0x348f44-this[_0xf02dd1(0x1b0)]<this[_0xf02dd1(0x1bb)])return;this['lastFetchTime']=_0x348f44;const _0x202a4d=collection(db,_0xf02dd1(0x1ff)),_0x4063c0=query(_0x202a4d,where('type','in',['promotion','demotion']),orderBy('timestamp',_0xf02dd1(0x20b)),limit(0x14)),_0x2ac06d=await getDocs(_0x4063c0),_0x454b33=[];_0x2ac06d[_0xf02dd1(0x1f8)](_0x3c997a=>{const _0x344881=_0xf02dd1,_0x322639={'id':_0x3c997a['id'],..._0x3c997a['data']()};this['shouldShowPromotion'](_0x3c997a['id'])&&this[_0x344881(0x200)](_0x322639)&&_0x454b33[_0x344881(0x1fd)](_0x322639);}),_0x454b33[_0xf02dd1(0x1b6)]>0x0&&await this['processRankChanges'](_0x454b33);}catch(_0x19aeb4){console[_0xf02dd1(0x1bf)]('Error\x20fetching\x20promotions:',_0x19aeb4);}}async[a42_0x3f2d15(0x1ca)](_0x53ee48){const _0x3aeb88=a42_0x3f2d15;if(_0x53ee48['length']===0x0)return;_0x53ee48['sort']((_0x4c07ba,_0x549852)=>{const _0x4424b5=a42_0x267f,_0xab6711=_0x4c07ba['timestamp']?.[_0x4424b5(0x1c4)]?.()||_0x4c07ba[_0x4424b5(0x1e4)]?.['seconds']*0x3e8||0x0,_0x3f6ee1=_0x549852[_0x4424b5(0x1e4)]?.['toMillis']?.()||_0x549852['timestamp']?.['seconds']*0x3e8||0x0;return _0x3f6ee1-_0xab6711;});const _0x341c2c=this['bannerContainer']['children']['length'],_0xf0966d=0x3-_0x341c2c;if(_0xf0966d<=0x0)return;const _0x2bb4a9=_0x53ee48[_0x3aeb88(0x1c9)](0x0,_0xf0966d);for(let _0x2e6723=0x0;_0x2e6723<_0x2bb4a9[_0x3aeb88(0x1b6)];_0x2e6723++){const _0x585cdb=_0x2bb4a9[_0x2e6723],_0x574cfd=auth['currentUser'];try{setTimeout(()=>{const _0x100af6=_0x3aeb88;this[_0x100af6(0x1b8)](_0x585cdb);},_0x2e6723*0x3e8),_0x574cfd&&_0x585cdb[_0x3aeb88(0x1f1)]===_0x574cfd['displayName']&&this['showRankChangeLightbox'](_0x585cdb[_0x3aeb88(0x209)],_0x585cdb['rankAchieved']);}catch(_0x3ec6b5){console['error']('Error\x20processing\x20rank\x20change:',_0x3ec6b5);}}}[a42_0x3f2d15(0x204)](_0x20df7a){const _0x311ce3=a42_0x3f2d15;try{const _0x57c745='promotion_'+_0x20df7a,_0x255441=localStorage['getItem'](_0x57c745);if(_0x255441){let _0x5d1fc5;try{_0x5d1fc5=JSON['parse'](_0x255441);}catch(_0x139e1a){return console['warn']('Invalid\x20storage\x20format\x20for\x20'+_0x57c745+',\x20treating\x20as\x20new'),!![];}if(_0x5d1fc5['ignored']===!![])return console['log']('Promotion\x20'+_0x20df7a+'\x20is\x20permanently\x20ignored'),![];const _0x5086ec=Date['now']();if(_0x5d1fc5['userDismissed']&&_0x5086ec-_0x5d1fc5['timestamp']<this['DISPLAY_HOURS']*0x3c*0x3c*0x3e8)return console[_0x311ce3(0x1b4)]('Promotion\x20'+_0x20df7a+'\x20was\x20dismissed\x20by\x20user\x20within\x20last\x20'+this['DISPLAY_HOURS']+'\x20hours'),![];if(_0x5d1fc5['systemDismissed']&&_0x5086ec-_0x5d1fc5['timestamp']<0x4*0x3c*0x3c*0x3e8)return console['log']('Promotion\x20'+_0x20df7a+'\x20was\x20auto-dismissed\x20within\x20last\x204\x20hours'),![];}return!![];}catch(_0x2db112){return console[_0x311ce3(0x1bf)]('Error\x20checking\x20promotion\x20visibility:',_0x2db112),![];}}['ignorePromotion'](_0xac7f0d){const _0x483920=a42_0x3f2d15;try{const _0x53ffe2='promotion_'+_0xac7f0d;localStorage['setItem'](_0x53ffe2,JSON['stringify']({'timestamp':Date['now'](),'ignored':!![]}));}catch(_0xb129fb){console['error'](_0x483920(0x1ea),_0xb129fb);}}[a42_0x3f2d15(0x1b8)](_0x255fc4){const _0x5c385d=a42_0x3f2d15;this[_0x5c385d(0x213)](_0x255fc4)['then'](_0x38d17c=>{const _0x404c7f=_0x5c385d,_0x4dba5d='promotion_'+_0x255fc4['id'],_0x79054f=localStorage['getItem'](_0x4dba5d);if(_0x79054f)try{const _0x113027=JSON['parse'](_0x79054f);if(_0x113027['ignored']===!![]){console['log']('Skipping\x20ignored\x20promotion:\x20'+_0x255fc4['id']);return;}}catch(_0xbed4ef){}localStorage['setItem'](_0x4dba5d,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':![],'seenAt':Date['now']()})),this['bannerContainer']['style']['display']='block';while(this['bannerContainer']['children']['length']>=0x3){this[_0x404c7f(0x210)]['removeChild'](this[_0x404c7f(0x210)]['firstChild']);}const _0x52b3f8=document['createElement'](_0x404c7f(0x1c5));_0x52b3f8['className']='promotion-banner',_0x52b3f8['setAttribute']('data-rank',_0x38d17c['rankAchieved']),_0x52b3f8[_0x404c7f(0x1f9)]('data-id',_0x38d17c['id']);const _0x526891=document['createElement']('div');_0x526891['className']='promotion-details';const _0x2efbaf=_0x38d17c[_0x404c7f(0x1ce)]||_0x38d17c['player']||_0x38d17c['username']||_0x38d17c[_0x404c7f(0x1d3)]||_0x38d17c['displayName']||'A\x20player',_0x15ae36=_0x38d17c[_0x404c7f(0x209)]===_0x404c7f(0x1ae)?_0x2efbaf+'\x20was\x20promoted\x20to':_0x2efbaf+'\x20was\x20demoted\x20to';_0x526891['innerHTML']=_0x15ae36+_0x404c7f(0x1cb)+_0x38d17c[_0x404c7f(0x1ec)]+'</span>';const _0x4a7eba=document['createElement']('div');_0x4a7eba['className']=_0x404c7f(0x1ed);const _0x2f6ed1=document['createElement']('button');_0x2f6ed1['className']='dismiss-btn',_0x2f6ed1['innerHTML']='&times;',_0x2f6ed1['title']='Dismiss';const _0x52008d=document[_0x404c7f(0x1d9)](_0x404c7f(0x1d0));_0x52008d['className']=_0x404c7f(0x1ac),_0x52008d[_0x404c7f(0x1e9)]=_0x404c7f(0x1cd),_0x52008d['title']=_0x404c7f(0x1e8),_0x4a7eba[_0x404c7f(0x1d1)](_0x52008d),_0x4a7eba['appendChild'](_0x2f6ed1),_0x52b3f8[_0x404c7f(0x1d1)](_0x526891),_0x52b3f8['appendChild'](_0x4a7eba),this['bannerContainer']['appendChild'](_0x52b3f8),void _0x52b3f8[_0x404c7f(0x1fa)],setTimeout(()=>{const _0x558b41=_0x404c7f;_0x52b3f8['classList']['add'](_0x558b41(0x203));},0x32),_0x2f6ed1['addEventListener']('click',()=>{const _0x51b486=_0x404c7f;localStorage['setItem'](_0x4dba5d,JSON['stringify']({'timestamp':Date[_0x51b486(0x1df)](),'ignored':![],'userDismissed':!![],'systemDismissed':![]})),_0x52b3f8['classList']['remove']('new-rank-change'),_0x52b3f8['classList']['add']('dismissing'),setTimeout(()=>{const _0x2debc5=_0x51b486;_0x52b3f8['parentNode']&&(_0x52b3f8['remove'](),this['bannerContainer']['children']['length']===0x0&&(this[_0x2debc5(0x210)]['style'][_0x2debc5(0x1e6)]='none'));},0x1f4);}),_0x52008d[_0x404c7f(0x1c8)](_0x404c7f(0x1e1),()=>{const _0x32a3e6=_0x404c7f;localStorage[_0x32a3e6(0x1d8)](_0x4dba5d,JSON['stringify']({'timestamp':Date[_0x32a3e6(0x1df)](),'ignored':!![],'userDismissed':!![],'systemDismissed':![]})),_0x52b3f8[_0x32a3e6(0x1be)][_0x32a3e6(0x205)](_0x32a3e6(0x203)),_0x52b3f8[_0x32a3e6(0x1be)]['add'](_0x32a3e6(0x1fc)),setTimeout(()=>{const _0x20857e=_0x32a3e6;_0x52b3f8[_0x20857e(0x1b1)]&&(_0x52b3f8[_0x20857e(0x205)](),this['bannerContainer'][_0x20857e(0x1e2)]['length']===0x0&&(this['bannerContainer']['style']['display']='none'));},0x1f4);}),setTimeout(()=>{const _0x323d6b=_0x404c7f;_0x52b3f8['parentNode']&&(_0x52b3f8['classList']['remove']('new-rank-change'),_0x52b3f8['classList']['add']('dismissing'),localStorage[_0x323d6b(0x1d8)](_0x4dba5d,JSON[_0x323d6b(0x1b5)]({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':!![]})),setTimeout(()=>{const _0x220ced=_0x323d6b;_0x52b3f8['parentNode']&&(_0x52b3f8['remove'](),this['bannerContainer']['children'][_0x220ced(0x1b6)]===0x0&&(this['bannerContainer'][_0x220ced(0x1b3)]['display']='none'));},0x1f4));},0x3a98);});}async['resolveUserId'](_0x47a496){const _0x1a7265=a42_0x3f2d15,_0x333836={..._0x47a496},_0x2c4776=[_0x47a496[_0x1a7265(0x1f1)],_0x47a496['username'],_0x47a496['playerUsername'],_0x47a496['displayName']],_0x20f6e6=_0x2c4776['some'](_0x423ebe=>_0x423ebe&&typeof _0x423ebe===_0x1a7265(0x202)&&!_0x423ebe['includes']('ID:')&&!/^[a-zA-Z0-9]{20,}$/[_0x1a7265(0x1e7)](_0x423ebe));if(_0x20f6e6)return _0x333836;let _0x2c1984=null;if(_0x47a496['userId'])_0x2c1984=_0x47a496['userId'];else _0x47a496['player']&&/^[A-Za-z0-9]{20,}$/[_0x1a7265(0x1e7)](_0x47a496[_0x1a7265(0x1f1)])&&(_0x2c1984=_0x47a496[_0x1a7265(0x1f1)]);if(!_0x2c1984)return _0x333836;try{const _0x5d1350=await getDoc(doc(db,'players',_0x2c1984));if(_0x5d1350['exists']()){const _0x10a413=_0x5d1350['data']();if(_0x10a413['username'])return _0x333836['resolvedName']=_0x10a413['username'],_0x333836;}const _0x672be=await getDocs(query(collection(db,_0x1a7265(0x206)),where('winnerId','==',_0x2c1984),orderBy('date','desc'),limit(0x1)));if(!_0x672be['empty']){const _0x12339b=_0x672be['docs'][0x0][_0x1a7265(0x1dd)]();if(_0x12339b['winnerUsername'])return _0x333836['resolvedName']=_0x12339b['winnerUsername'],_0x333836;}const _0x58cded=await getDocs(query(collection(db,_0x1a7265(0x206)),where('loserId','==',_0x2c1984),orderBy('date','desc'),limit(0x1)));if(!_0x58cded['empty']){const _0x1900ab=_0x58cded['docs'][0x0]['data']();if(_0x1900ab[_0x1a7265(0x1d7)])return _0x333836['resolvedName']=_0x1900ab[_0x1a7265(0x1d7)],console['log']('Resolved\x20'+_0x2c1984+'\x20to\x20'+_0x1900ab[_0x1a7265(0x1d7)]+'\x20(loser)'),_0x333836;}}catch(_0x1fa493){console['error']('Error\x20resolving\x20user\x20ID:',_0x1fa493);}return console['warn']('Failed\x20to\x20resolve\x20user\x20ID:\x20'+_0x2c1984),_0x333836;}['showRankChangeLightbox'](_0x2a1034,_0x5bed3b){const _0x4bd79e=a42_0x3f2d15;let _0x29f9ad=document['getElementById']('rankChangeModal');!_0x29f9ad&&(_0x29f9ad=document['createElement'](_0x4bd79e(0x1c5)),_0x29f9ad['id']=_0x4bd79e(0x1f0),_0x29f9ad['className']=_0x4bd79e(0x207)+_0x2a1034,document[_0x4bd79e(0x1c6)][_0x4bd79e(0x1d1)](_0x29f9ad));const _0x4a3489=_0x2a1034==='promotion'?_0x4bd79e(0x1f5):'Rank\x20Update',_0x2c1d21=_0x2a1034==='promotion'?_0x4bd79e(0x20f):_0x4bd79e(0x1cc);_0x29f9ad['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rank-change-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2\x20class=\x22rank-change-title\x22>'+_0x4a3489+_0x4bd79e(0x20a)+_0x2c1d21+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22rank-name\x22>'+_0x5bed3b+'</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22rank-change-button\x22\x20id=\x22rank-change-ok-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Got\x20it!\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x29f9ad[_0x4bd79e(0x1b3)]['display']=_0x4bd79e(0x212),document['getElementById']('rank-change-ok-btn')['addEventListener'](_0x4bd79e(0x1e1),()=>{const _0x194885=_0x4bd79e;_0x29f9ad['style'][_0x194885(0x1e6)]='none';}),_0x29f9ad[_0x4bd79e(0x1c8)](_0x4bd79e(0x1e1),_0x47c698=>{const _0x5862ef=_0x4bd79e;_0x47c698['target']===_0x29f9ad&&(_0x29f9ad[_0x5862ef(0x1b3)]['display']='none');});}async['checkAndRecordPromotion'](_0x15485a,_0x533632,_0x5770d4,_0x127f29={}){const _0x230612=a42_0x3f2d15;try{if(_0x533632===_0x5770d4||!_0x15485a)return null;const _0x3b0335=_0x127f29['source']||'automatic',_0x386772=_0x127f29['matchId']||null,_0x1f36b4=_0x127f29[_0x230612(0x1cf)]||null;console['log']('Processing\x20potential\x20rank\x20change:\x20'+_0x5770d4+_0x230612(0x1b9)+_0x533632+'\x20(source:\x20'+_0x3b0335+')');let _0x59873e=null,_0x4f72fd=null;try{const _0xe52c2d=await getDoc(doc(db,_0x230612(0x1d6),_0x15485a));if(_0xe52c2d['exists']()){const _0x44dcd0=_0xe52c2d[_0x230612(0x1dd)]();_0x59873e=_0x44dcd0['username']||_0x44dcd0['displayName']||null,_0x4f72fd=_0x44dcd0['displayName']||_0x44dcd0[_0x230612(0x1e5)]||null;}!_0x59873e&&_0x127f29[_0x230612(0x1e5)]&&(_0x59873e=_0x127f29['username'],_0x4f72fd=_0x127f29['username']);!_0x59873e&&auth['currentUser']&&(_0x59873e=auth['currentUser']['displayName']||auth['currentUser']['email']['split']('@')[0x0],_0x4f72fd=auth['currentUser']['displayName']||null);if(!_0x59873e){const _0x440811=query(collection(db,'approvedMatches'),where(_0x230612(0x1ba),'==',_0x15485a),limit(0x1)),_0x449fc0=await getDocs(_0x440811);if(!_0x449fc0[_0x230612(0x208)])_0x59873e=_0x449fc0['docs'][0x0]['data']()['winnerUsername']||'Unknown\x20Player',_0x4f72fd=_0x59873e;else{const _0x413178=query(collection(db,'approvedMatches'),where('loserId','==',_0x15485a),limit(0x1)),_0x20bc49=await getDocs(_0x413178);!_0x20bc49['empty']&&(_0x59873e=_0x20bc49[0x0]['data']()['loserUsername']||_0x230612(0x1f6),_0x4f72fd=_0x59873e);}}}catch(_0x132e0f){console['error'](_0x230612(0x1b2),_0x132e0f);}!_0x59873e&&(console['warn'](_0x230612(0x211),_0x15485a),_0x59873e='A\x20player',_0x4f72fd=_0x230612(0x1f6));const _0x51c5ea=this[_0x230612(0x1e0)](_0x5770d4),_0x1ac316=this['getRankName'](_0x533632);if(_0x51c5ea!==_0x1ac316){const _0x3b56df=_0x533632>_0x5770d4,_0x129f31=_0x3b56df?'promotion':_0x230612(0x1da),_0x1d0d1e=_0x1ac316;console['log']('Recording\x20'+_0x129f31+'\x20for\x20'+_0x59873e+':\x20'+_0x5770d4+'\x20('+_0x51c5ea+')\x20→\x20'+_0x533632+'\x20('+_0x1ac316+')');try{const _0xb6a326={'player':_0x59873e,'playerUsername':_0x59873e,'username':_0x59873e,'displayName':_0x4f72fd,'userId':_0x15485a,'type':_0x129f31,'rankAchieved':_0x1d0d1e,'timestamp':serverTimestamp(),'previousElo':_0x5770d4,'newElo':_0x533632,'change':_0x533632-_0x5770d4,'previousRank':_0x51c5ea,'newRank':_0x1ac316,'source':_0x3b0335};if(_0x3b0335===_0x230612(0x1c1)&&_0x386772)_0xb6a326['matchId']=_0x386772;else _0x3b0335==='admin'&&_0x1f36b4?(_0xb6a326[_0x230612(0x1ee)]=_0x1f36b4,_0xb6a326['isAutomatic']=![]):_0xb6a326['isAutomatic']=!![];const _0x318936=writeBatch(db),_0x53ec69=doc(collection(db,'eloHistory')),_0xbcb31=doc(collection(db,_0x230612(0x1af)));return _0x318936['set'](_0x53ec69,_0xb6a326),_0x318936['set'](_0xbcb31,_0xb6a326),await _0x318936[_0x230612(0x1dc)](),await this['sendPromotionNotification'](_0x15485a,_0x59873e,_0x5770d4,_0x533632,_0x51c5ea,_0x1ac316,_0x129f31,{'displayName':_0x4f72fd,'source':_0x3b0335,'matchId':_0x386772,'ladder':_0x127f29['ladder']||'D1'}),console[_0x230612(0x1b4)]('Successfully\x20recorded\x20'+_0x129f31+'\x20for\x20'+_0x59873e+_0x230612(0x20e)+_0x1d0d1e),_0x1d0d1e;}catch(_0x51b5a6){console['error']('Error\x20writing\x20promotion\x20records:',_0x51b5a6);try{return await addDoc(collection(db,_0x230612(0x1ff)),{'player':_0x59873e,'playerUsername':_0x59873e,'username':_0x59873e,'displayName':_0x4f72fd,'userId':_0x15485a,'type':_0x129f31,'rankAchieved':_0x1d0d1e,'timestamp':serverTimestamp(),'previousElo':_0x5770d4,'newElo':_0x533632,'change':_0x533632-_0x5770d4,'previousRank':_0x51c5ea,'source':_0x3b0335,'isAutomatic':_0x3b0335!=='admin'}),await this['sendPromotionNotification'](_0x15485a,_0x59873e,_0x5770d4,_0x533632,_0x51c5ea,_0x1ac316,_0x129f31,{'displayName':_0x4f72fd,'source':_0x3b0335,'matchId':_0x386772,'ladder':_0x127f29['ladder']||'D1'}),_0x1d0d1e;}catch(_0x1ec96d){return console['error'](_0x230612(0x1c3),_0x1ec96d),null;}}}return null;}catch(_0x229337){return console['error']('Error\x20in\x20promotion/demotion\x20recording:',_0x229337),null;}}['getRankName'](_0x10ae92){const _0x275c62=a42_0x3f2d15;for(let _0x23565=this['RANKS'][_0x275c62(0x1b6)]-0x1;_0x23565>=0x0;_0x23565--){if(_0x10ae92>=this['RANKS'][_0x23565]['threshold'])return this['RANKS'][_0x23565]['name'];}return'Unranked';}[a42_0x3f2d15(0x1d5)](){const _0xa679b7=a42_0x3f2d15;this[_0xa679b7(0x1d2)]&&clearInterval(this['pollingInterval']);}[a42_0x3f2d15(0x200)](_0x40dfec){if(_0x40dfec['timestamp']){const _0xaabd35=_0x40dfec['timestamp']['seconds']*0x3e8,_0x1826c5=Date['now'](),_0x5ba291=(_0x1826c5-_0xaabd35)/(0x3e8*0x3c*0x3c);if(_0x5ba291>0x18)return![];}if(_0x40dfec['previousRank']&&_0x40dfec['newRank']&&_0x40dfec['previousRank']!==_0x40dfec['newRank'])return!![];return![];}async['sendPromotionNotification'](_0x232116,_0x8f5ef5,_0x58bb7d,_0x32b5ea,_0xb881e1,_0x2d53eb,_0x25cccd,_0x3c7f6a={}){const _0x130cda=a42_0x3f2d15;try{console[_0x130cda(0x1b4)]('STARTING\x20notification\x20for\x20'+_0x8f5ef5+'\x27s\x20'+_0x25cccd);const _0x3b05ac={'userId':_0x232116,'username':_0x8f5ef5,'displayName':_0x3c7f6a['displayName']||_0x8f5ef5,'oldElo':parseInt(_0x58bb7d),'newElo':parseInt(_0x32b5ea),'eloDifference':parseInt(_0x32b5ea)-parseInt(_0x58bb7d),'oldRank':_0xb881e1,'newRank':_0x2d53eb,'type':_0x25cccd,'timestamp':serverTimestamp(),'processed':![],'source':_0x3c7f6a[_0x130cda(0x1c7)]||'automatic','matchId':_0x3c7f6a['matchId']||null,'ladder':_0x3c7f6a['ladder']||'D1','adminUser':_0x3c7f6a[_0x130cda(0x1cf)]||null};console['log']('Creating\x20Discord\x20notification:',_0x3b05ac);const _0x22d55a=await addDoc(collection(db,_0x130cda(0x1de)),_0x3b05ac);return console['log']('Discord\x20notification\x20sent\x20successfully\x20with\x20ID:\x20'+_0x22d55a['id']),!![];}catch(_0x576dc6){return console['error'](_0x130cda(0x1db),_0x576dc6),![];}}}export const promotionManager=new PromotionManager();function a42_0x51d3(){const _0x1b7aca=['ignore-btn','constructor','promotion','promotionHistory','lastFetchTime','parentNode','Error\x20resolving\x20username:','style','log','stringify','length','#FFD700','showRankChangeBanner','\x20→\x20','winnerId','fetchInterval','toString','RANKS','classList','error','info','match','#CD7F32','Fallback\x20write\x20failed:','toMillis','div','body','source','addEventListener','slice','processRankChanges','\x20<span\x20class=\x22rank-text\x22>','You\x27ve\x20been\x20demoted\x20to','Don\x27t\x20show\x20again','resolvedName','adminUser','button','appendChild','pollingInterval','playerUsername','true','cleanup','players','loserUsername','setItem','createElement','demotion','Error\x20sending\x20Discord\x20notification:','commit','data','promotionNotifications','now','getRankName','click','children','Promotion\x20banner\x20container\x20not\x20found','timestamp','username','display','test','Never\x20show\x20this\x20promotion\x20again','textContent','Error\x20saving\x20promotion\x20preference:','usernameCache','rankAchieved','banner-actions','modifiedBy','setupBannerContainer','rankChangeModal','player','innerHTML','Emerald','none','Congratulations!','Unknown\x20Player','DOMContentLoaded','forEach','setAttribute','offsetWidth','visibilityState','dismissing','push','apply','eloHistory','isNewRankChange','checkAndRecordPromotion','string','new-rank-change','shouldShowPromotion','remove','approvedMatches','rank-change-modal\x20','empty','type','</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>','desc','bind','fetchRecentPromotions','\x20to\x20','You\x27ve\x20been\x20promoted\x20to','bannerContainer','Could\x20not\x20resolve\x20username\x20for\x20userId:','flex','resolveUserId'];a42_0x51d3=function(){return _0x1b7aca;};return a42_0x51d3();}document['addEventListener'](a42_0x3f2d15(0x1f7),()=>{promotionManager['initialize']();});export const initializePromotionTracker=()=>promotionManager['initialize']();export const checkAndRecordPromotion=(_0x4b50dc,_0x57296f,_0x2d072c,_0x1bd26e)=>promotionManager[a42_0x3f2d15(0x201)](_0x4b50dc,_0x57296f,_0x2d072c,_0x1bd26e);export const getRankName=_0x278f47=>promotionManager['getRankName'](_0x278f47);
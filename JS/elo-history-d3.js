const a15_0x24ed7c=a15_0x46f3;function a15_0x2815(){const _0x31acb8=['Gold','(((.+)+)+)+$','approvedMatchesD3','bind','loserUsername','promotion','Error\x20recording\x20D3\x20ELO\x20history:','1283dmlElR','desc','data','loserId','939474cRRknu','2148912luGLxu','table','Unknown\x20Player','__proto__','Error\x20getting\x20D3\x20username:','eloHistoryD3','toString','player','match','log','winnerId','username','3653636kFZHWU','error','playersD3','{}.constructor(\x22return\x20this\x22)(\x20)','size','Silver','625485KDLiQd','timestamp','info','D3\x20ELO\x20history\x20recorded\x20for\x20','search','empty','prototype','Emerald','trace','12758104CghSAW','exception','opponent','length','docs','demotion','constructor','Bronze','886ZSvwEF','exists','previousElo','all','Unranked','1394860jXjqcN','apply'];a15_0x2815=function(){return _0x31acb8;};return a15_0x2815();}(function(_0x35b2d,_0x15048b){const _0x5bc894=a15_0x46f3,_0x258675=_0x35b2d();while(!![]){try{const _0x129b84=-parseInt(_0x5bc894(0xe0))/0x1*(-parseInt(_0x5bc894(0xd2))/0x2)+-parseInt(_0x5bc894(0xe4))/0x3+-parseInt(_0x5bc894(0xd7))/0x4+-parseInt(_0x5bc894(0xc1))/0x5+-parseInt(_0x5bc894(0xe5))/0x6+-parseInt(_0x5bc894(0xbb))/0x7+parseInt(_0x5bc894(0xca))/0x8;if(_0x129b84===_0x15048b)break;else _0x258675['push'](_0x258675['shift']());}catch(_0x1430c0){_0x258675['push'](_0x258675['shift']());}}}(a15_0x2815,0x791be));const a15_0xfd8f7e=(function(){let _0x4f43cf=!![];return function(_0x1df562,_0x4f4b9e){const _0x3d01f7=_0x4f43cf?function(){const _0x3fda90=a15_0x46f3;if(_0x4f4b9e){const _0x5409bc=_0x4f4b9e[_0x3fda90(0xd8)](_0x1df562,arguments);return _0x4f4b9e=null,_0x5409bc;}}:function(){};return _0x4f43cf=![],_0x3d01f7;};}()),a15_0x2e3a6d=a15_0xfd8f7e(this,function(){const _0x210c5e=a15_0x46f3;return a15_0x2e3a6d['toString']()[_0x210c5e(0xc5)](_0x210c5e(0xda))[_0x210c5e(0xb5)]()[_0x210c5e(0xd0)](a15_0x2e3a6d)[_0x210c5e(0xc5)](_0x210c5e(0xda));});a15_0x2e3a6d();const a15_0x4f9a6a=(function(){let _0x3152ac=!![];return function(_0x386f1c,_0x3a0463){const _0xc82097=_0x3152ac?function(){if(_0x3a0463){const _0xd26b51=_0x3a0463['apply'](_0x386f1c,arguments);return _0x3a0463=null,_0xd26b51;}}:function(){};return _0x3152ac=![],_0xc82097;};}()),a15_0x5df9dc=a15_0x4f9a6a(this,function(){const _0x13f221=a15_0x46f3;let _0x5dff7e;try{const _0xb44d7e=Function('return\x20(function()\x20'+_0x13f221(0xbe)+');');_0x5dff7e=_0xb44d7e();}catch(_0x37ba5b){_0x5dff7e=window;}const _0x369c05=_0x5dff7e['console']=_0x5dff7e['console']||{},_0x5694ba=['log','warn',_0x13f221(0xc3),_0x13f221(0xbc),_0x13f221(0xcb),_0x13f221(0xe6),_0x13f221(0xc9)];for(let _0x4c195b=0x0;_0x4c195b<_0x5694ba[_0x13f221(0xcd)];_0x4c195b++){const _0x2ed724=a15_0x4f9a6a[_0x13f221(0xd0)][_0x13f221(0xc7)][_0x13f221(0xdc)](a15_0x4f9a6a),_0x1096d1=_0x5694ba[_0x4c195b],_0x54f37f=_0x369c05[_0x1096d1]||_0x2ed724;_0x2ed724[_0x13f221(0xe8)]=a15_0x4f9a6a[_0x13f221(0xdc)](a15_0x4f9a6a),_0x2ed724[_0x13f221(0xb5)]=_0x54f37f['toString'][_0x13f221(0xdc)](_0x54f37f),_0x369c05[_0x1096d1]=_0x2ed724;}});a15_0x5df9dc();function a15_0x46f3(_0x425c5d,_0x2343f0){const _0xef968f=a15_0x2815();return a15_0x46f3=function(_0x5df9dc,_0x4f9a6a){_0x5df9dc=_0x5df9dc-0xb4;let _0x17f37b=_0xef968f[_0x5df9dc];return _0x17f37b;},a15_0x46f3(_0x425c5d,_0x2343f0);}import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc,where}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D3=[{'name':'Emerald','elo':0x7d0},{'name':a15_0x24ed7c(0xd9),'elo':0x708},{'name':a15_0x24ed7c(0xc0),'elo':0x640},{'name':a15_0x24ed7c(0xd1),'elo':0x578},{'name':a15_0x24ed7c(0xd6),'elo':0x4b0}];let lastVisibleD3=null;async function getUsernameByIdD3(_0x4e2cd7){const _0x446b2c=a15_0x24ed7c;try{if(!_0x4e2cd7)return _0x446b2c(0xe7);const _0x423d67=await getDoc(doc(db,_0x446b2c(0xbd),_0x4e2cd7));if(_0x423d67[_0x446b2c(0xd3)]())return _0x423d67[_0x446b2c(0xe2)]()[_0x446b2c(0xba)]||'Unknown\x20Player';const _0x38e999=await getDocs(query(collection(db,_0x446b2c(0xdb)),where(_0x446b2c(0xb9),'==',_0x4e2cd7),limit(0x1)));if(!_0x38e999[_0x446b2c(0xc6)])return _0x38e999[_0x446b2c(0xce)][0x0][_0x446b2c(0xe2)]()['winnerUsername']||_0x446b2c(0xe7);const _0x39494c=await getDocs(query(collection(db,'approvedMatchesD3'),where(_0x446b2c(0xe3),'==',_0x4e2cd7),limit(0x1)));if(!_0x39494c[_0x446b2c(0xc6)])return _0x39494c['docs'][0x0][_0x446b2c(0xe2)]()[_0x446b2c(0xdd)]||_0x446b2c(0xe7);return _0x446b2c(0xe7);}catch(_0x1ae39b){return console[_0x446b2c(0xbc)](_0x446b2c(0xe9),_0x1ae39b),'Unknown\x20Player';}}export async function recordEloChangeD3({playerId:_0x5cf169,previousElo:_0x4b9af7,newElo:_0x5157d4,opponentId:_0x5eef0d,matchResult:_0x4321f8,previousPosition:_0x5b30c7,newPosition:_0x3da0c3,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x2fd7ca,timestamp:_0x2d3c12}){const _0xa45fa1=a15_0x24ed7c;try{const _0xcb48bc=doc(collection(db,_0xa45fa1(0xb4)));let _0x37885d=_0xa45fa1(0xb7);if(isPromotion)_0x37885d=_0xa45fa1(0xde);if(isDemotion)_0x37885d=_0xa45fa1(0xcf);let _0x1c11f7=_0xa45fa1(0xd6);if(_0x5157d4>=0x7d0)_0x1c11f7=_0xa45fa1(0xc8);else{if(_0x5157d4>=0x708)_0x1c11f7=_0xa45fa1(0xd9);else{if(_0x5157d4>=0x640)_0x1c11f7=_0xa45fa1(0xc0);else{if(_0x5157d4>=0x578)_0x1c11f7=_0xa45fa1(0xd1);}}}return await setDoc(_0xcb48bc,{'type':_0x37885d,'player':_0x5cf169,'opponent':_0x5eef0d,'previousElo':_0x4b9af7,'newElo':_0x5157d4,'change':_0x5157d4-_0x4b9af7,'matchResult':_0x4321f8,'previousPosition':_0x5b30c7,'newPosition':_0x3da0c3,'rankAchieved':_0x1c11f7,'matchId':_0x2fd7ca,'timestamp':_0x2d3c12||serverTimestamp(),'gameMode':'D3'}),console[_0xa45fa1(0xb8)](_0xa45fa1(0xc4)+_0x5cf169),!![];}catch(_0x5f52fd){console[_0xa45fa1(0xbc)](_0xa45fa1(0xdf),_0x5f52fd);throw _0x5f52fd;}}export async function getEloHistoryD3(_0x1d3b20=0x14){const _0x5f5831=a15_0x24ed7c;try{const _0x431fa4=collection(db,_0x5f5831(0xb4));let _0x157f38;lastVisibleD3?_0x157f38=query(_0x431fa4,orderBy(_0x5f5831(0xc2),_0x5f5831(0xe1)),startAfter(lastVisibleD3),limit(_0x1d3b20)):_0x157f38=query(_0x431fa4,orderBy(_0x5f5831(0xc2),_0x5f5831(0xe1)),limit(_0x1d3b20));const _0x518f95=await getDocs(_0x157f38);if(_0x518f95[_0x5f5831(0xc6)])return{'entries':[],'hasMore':![]};lastVisibleD3=_0x518f95['docs'][_0x518f95['docs']['length']-0x1];const _0x2801c9=_0x518f95[_0x5f5831(0xce)]['map'](async _0x422fe9=>{const _0x1e84f4=_0x5f5831,_0x388def=_0x422fe9['data'](),[_0x16181b,_0x33315e]=await Promise[_0x1e84f4(0xd5)]([getUsernameByIdD3(_0x388def[_0x1e84f4(0xb6)]),getUsernameByIdD3(_0x388def[_0x1e84f4(0xcc)])]);return{..._0x388def,'playerUsername':_0x16181b,'opponentUsername':_0x33315e,'change':_0x388def['newElo']-_0x388def[_0x1e84f4(0xd4)],'timestamp':_0x388def[_0x1e84f4(0xc2)]};}),_0x12ff22=await Promise[_0x5f5831(0xd5)](_0x2801c9);return{'entries':_0x12ff22,'hasMore':_0x518f95[_0x5f5831(0xbf)]===_0x1d3b20};}catch(_0x5c1106){console[_0x5f5831(0xbc)]('Error\x20fetching\x20D3\x20ELO\x20history:',_0x5c1106);throw _0x5c1106;}}export function resetPaginationD3(){lastVisibleD3=null;}
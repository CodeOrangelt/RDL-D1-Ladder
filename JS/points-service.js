const a39_0x186e48=a39_0x30e8,a39_0x3bbc80=(function(){let _0x4dc8cb=!![];return function(_0x5ca0c7,_0x412b1a){const _0x9a41e5=_0x4dc8cb?function(){if(_0x412b1a){const _0x3eaedf=_0x412b1a['apply'](_0x5ca0c7,arguments);return _0x412b1a=null,_0x3eaedf;}}:function(){};return _0x4dc8cb=![],_0x9a41e5;};}()),a39_0x20298d=a39_0x3bbc80(this,function(){const _0x87f8ff=a39_0x30e8,_0xe2e3be=function(){let _0x11dcd9;try{_0x11dcd9=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x415b13){_0x11dcd9=window;}return _0x11dcd9;},_0x45f727=_0xe2e3be(),_0x3ccc89=_0x45f727['console']=_0x45f727['console']||{},_0x44b81f=['log',_0x87f8ff(0x1fc),_0x87f8ff(0x1f3),_0x87f8ff(0x1fa),'exception',_0x87f8ff(0x1f0),'trace'];for(let _0x1056ff=0x0;_0x1056ff<_0x44b81f['length'];_0x1056ff++){const _0x44895f=a39_0x3bbc80['constructor']['prototype']['bind'](a39_0x3bbc80),_0x16320a=_0x44b81f[_0x1056ff],_0x13f5d7=_0x3ccc89[_0x16320a]||_0x44895f;_0x44895f[_0x87f8ff(0x1f7)]=a39_0x3bbc80['bind'](a39_0x3bbc80),_0x44895f[_0x87f8ff(0x1f6)]=_0x13f5d7['toString']['bind'](_0x13f5d7),_0x3ccc89[_0x16320a]=_0x44895f;}});a39_0x20298d();import{db}from'./firebase-config.js';import{doc,getDoc,updateDoc,addDoc,collection,serverTimestamp}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a39_0x28b1(){const _0x43bf2d=['Match\x20points:\x20','table','Error\x20adding\x20points\x20to\x20user:','log','info','add','Admin\x20points\x20service\x20connected','toString','__proto__','Unknown\x20User','Added\x20','error','modifyUserPoints','warn','\x20match','username','data'];a39_0x28b1=function(){return _0x43bf2d;};return a39_0x28b1();}function a39_0x30e8(_0x585603,_0x387443){const _0x20298d=a39_0x28b1();return a39_0x30e8=function(_0x3bbc80,_0x59b098){_0x3bbc80=_0x3bbc80-0x1ef;let _0x28b18d=_0x20298d[_0x3bbc80];return _0x28b18d;},a39_0x30e8(_0x585603,_0x387443);}const POINTS_CHART={'':0xa,'Standard':0xa,'Fusion\x20Match':0x19,'â‰¥6\x20Missiles':0xa,'Weapon\x20Imbalance':0x1e,'Blind\x20Match':0x4b,'Rematch':0x14,'Disorientation':0x32,'Ratting':0x23,'Altered\x20Powerups':0x23,'Mega\x20Match':0x28,'Dogfight':0x32,'Gauss\x20and\x20Mercs':0x19,'Misc':0x1e};let adminModifyUserPoints=null;try{const adminModule=await import('./adminbackend.js');adminModule['modifyUserPoints']&&(adminModifyUserPoints=adminModule[a39_0x186e48(0x1fb)],console['log'](a39_0x186e48(0x1f5)));}catch(a39_0x11740b){console[a39_0x186e48(0x1f2)]('Admin\x20backend\x20not\x20available,\x20using\x20fallback\x20points\x20service');}export async function awardMatchPoints(_0x3875f5,_0x5cff17,_0x55e7a8){const _0x5dc6ae=a39_0x186e48;try{const _0x3eb300=POINTS_CHART[_0x55e7a8]||0xa;return adminModifyUserPoints?await Promise['all']([adminModifyUserPoints(_0x3875f5,_0x5dc6ae(0x1f4),_0x3eb300,_0x5dc6ae(0x1ef)+(_0x55e7a8||'Standard')+'\x20match\x20(Winner)'),adminModifyUserPoints(_0x5cff17,_0x5dc6ae(0x1f4),_0x3eb300,'Match\x20points:\x20'+(_0x55e7a8||'Standard')+'\x20match\x20(Participant)')]):await Promise['all']([addPointsFallback(_0x3875f5,_0x3eb300,_0x5dc6ae(0x1ef)+(_0x55e7a8||'Standard')+'\x20match\x20(Winner)'),addPointsFallback(_0x5cff17,_0x3eb300,_0x5dc6ae(0x1ef)+(_0x55e7a8||'Standard')+'\x20match\x20(Participant)')]),console[_0x5dc6ae(0x1f2)]('Awarded\x20'+_0x3eb300+'\x20points\x20to\x20both\x20players\x20for\x20'+(_0x55e7a8||'Standard')+_0x5dc6ae(0x1fd)),!![];}catch(_0x3f76df){return console['error']('Error\x20awarding\x20match\x20points:',_0x3f76df),![];}}async function addPointsFallback(_0x2d80cd,_0x5a28ad,_0xb1be5a=''){const _0x3ebc92=a39_0x186e48;try{const _0x86f20a=doc(db,'userProfiles',_0x2d80cd),_0x42e722=await getDoc(_0x86f20a);if(!_0x42e722['exists']()){console['log']('User\x20profile\x20not\x20found\x20for\x20'+_0x2d80cd+',\x20skipping\x20points\x20award');return;}const _0x43b8e2=_0x42e722[_0x3ebc92(0x1ff)](),_0x5bb8b5=_0x43b8e2['points']||0x0,_0x4efe0c=_0x5bb8b5+_0x5a28ad;await updateDoc(_0x86f20a,{'points':_0x4efe0c,'lastPointsModified':serverTimestamp()}),await addDoc(collection(db,'pointsHistory'),{'userId':_0x2d80cd,'userEmail':_0x43b8e2['email']||'unknown','displayName':_0x43b8e2['displayName']||_0x43b8e2[_0x3ebc92(0x1fe)]||_0x3ebc92(0x1f8),'action':_0x3ebc92(0x1f4),'amount':_0x5a28ad,'previousPoints':_0x5bb8b5,'newPoints':_0x4efe0c,'reason':_0xb1be5a,'adminEmail':'system-match-award','timestamp':serverTimestamp()}),console[_0x3ebc92(0x1f2)](_0x3ebc92(0x1f9)+_0x5a28ad+'\x20points\x20to\x20user\x20'+_0x2d80cd+'.\x20New\x20total:\x20'+_0x4efe0c);}catch(_0x90a50e){console['error'](_0x3ebc92(0x1f1),_0x90a50e);throw _0x90a50e;}}
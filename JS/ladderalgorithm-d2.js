function a28_0x5d66(_0x550e19,_0x5635b9){const _0x1d9230=a28_0x1208();return a28_0x5d66=function(_0x5d3eec,_0x28073d){_0x5d3eec=_0x5d3eec-0xec;let _0x5a5694=_0x1d9230[_0x5d3eec];return _0x5a5694;},a28_0x5d66(_0x550e19,_0x5635b9);}(function(_0x3bcd8c,_0x2c33e3){const _0x12ff46=a28_0x5d66,_0x45e615=_0x3bcd8c();while(!![]){try{const _0x4fa9ed=parseInt(_0x12ff46(0x11e))/0x1+parseInt(_0x12ff46(0xed))/0x2*(-parseInt(_0x12ff46(0x116))/0x3)+-parseInt(_0x12ff46(0xf3))/0x4*(-parseInt(_0x12ff46(0xf2))/0x5)+-parseInt(_0x12ff46(0x11d))/0x6*(parseInt(_0x12ff46(0x128))/0x7)+parseInt(_0x12ff46(0x125))/0x8+-parseInt(_0x12ff46(0xf4))/0x9+parseInt(_0x12ff46(0x117))/0xa;if(_0x4fa9ed===_0x2c33e3)break;else _0x45e615['push'](_0x45e615['shift']());}catch(_0x500932){_0x45e615['push'](_0x45e615['shift']());}}}(a28_0x1208,0xeb128));const a28_0x23cdd3=(function(){let _0x2fed3c=!![];return function(_0x5833be,_0x13e5a9){const _0x34d69a=_0x2fed3c?function(){const _0xa6f1ae=a28_0x5d66;if(_0x13e5a9){const _0x56058d=_0x13e5a9[_0xa6f1ae(0x11a)](_0x5833be,arguments);return _0x13e5a9=null,_0x56058d;}}:function(){};return _0x2fed3c=![],_0x34d69a;};}()),a28_0x15405d=a28_0x23cdd3(this,function(){const _0x54f79b=a28_0x5d66;return a28_0x15405d[_0x54f79b(0x103)]()[_0x54f79b(0x10f)](_0x54f79b(0x105))[_0x54f79b(0x103)]()[_0x54f79b(0x12b)](a28_0x15405d)[_0x54f79b(0x10f)]('(((.+)+)+)+$');});a28_0x15405d();const a28_0x28073d=(function(){let _0x17f4b9=!![];return function(_0x1815a5,_0x43b123){const _0x1e2f97=_0x17f4b9?function(){const _0x4f2430=a28_0x5d66;if(_0x43b123){const _0xa75138=_0x43b123[_0x4f2430(0x11a)](_0x1815a5,arguments);return _0x43b123=null,_0xa75138;}}:function(){};return _0x17f4b9=![],_0x1e2f97;};}()),a28_0x5d3eec=a28_0x28073d(this,function(){const _0x1673f3=a28_0x5d66,_0x1a3735=function(){const _0x1fac8b=a28_0x5d66;let _0x1527b9;try{_0x1527b9=Function(_0x1fac8b(0xfe)+_0x1fac8b(0x101)+');')();}catch(_0x1a71d1){_0x1527b9=window;}return _0x1527b9;},_0x22c981=_0x1a3735(),_0xb53ea9=_0x22c981[_0x1673f3(0x10d)]=_0x22c981[_0x1673f3(0x10d)]||{},_0x2a1d39=[_0x1673f3(0x122),_0x1673f3(0xff),_0x1673f3(0x114),_0x1673f3(0x10c),_0x1673f3(0xf0),'table',_0x1673f3(0x118)];for(let _0x4c4441=0x0;_0x4c4441<_0x2a1d39[_0x1673f3(0x124)];_0x4c4441++){const _0x113e91=a28_0x28073d['constructor'][_0x1673f3(0xf6)][_0x1673f3(0x106)](a28_0x28073d),_0x54e408=_0x2a1d39[_0x4c4441],_0x1fe037=_0xb53ea9[_0x54e408]||_0x113e91;_0x113e91[_0x1673f3(0xf7)]=a28_0x28073d[_0x1673f3(0x106)](a28_0x28073d),_0x113e91[_0x1673f3(0x103)]=_0x1fe037[_0x1673f3(0x103)]['bind'](_0x1fe037),_0xb53ea9[_0x54e408]=_0x113e91;}});function a28_0x1208(){const _0x36bf7b=['You\x20must\x20be\x20logged\x20in\x20to\x20approve\x20D2\x20matches','Could\x20not\x20find\x20D2\x20player\x20documents','return\x20(function()\x20','warn','Starting\x20approveReportD2\x20function\x20with:','{}.constructor(\x22return\x20this\x22)(\x20)','all','toString','commit','(((.+)+)+)+$','bind','update','createdAt','winnerUsername','username','One\x20or\x20both\x20D2\x20players\x20not\x20found','error','console','D2\x20Report\x20not\x20found\x20with\x20ID:','search','No\x20user\x20logged\x20in','match-d2','D2\x20Match\x20moved\x20to\x20approved\x20collection','eloRating','info','loserUsername','3946101TwnJpK','16866440KMdmnK','trace','currentUser','apply','position','D2\x20Match\x20successfully\x20approved\x20and\x20ELO\x20updated','10308aiZjJo','386257CGYijG','pow','checkAndRecordPromotion','docs','log','D2\x20match\x20report\x20not\x20found','length','11056472rwrpTG','round','data','1015JGEgrm','win','empty','constructor','loss','2Tcnazx','MAX_SAFE_INTEGER','Only\x20the\x20winner\x20can\x20approve\x20D2\x20matches','exception','approvedMatchesD2','412325cERdEQ','12PMhfCB','10575198ZWDwND','Error\x20in\x20approveReportD2:','prototype','__proto__','playersD2','D2\x20Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions','exists','Error\x20in\x20updateEloRatingsD2:'];a28_0x1208=function(){return _0x36bf7b;};return a28_0x1208();}a28_0x5d3eec();import{collection,doc,getDoc,getDocs,updateDoc,setDoc,deleteDoc,writeBatch,query,where,serverTimestamp,addDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';import{recordEloChangeD2}from'./elo-history-d2.js';import{promotionManager}from'./promotions.js';import a28_0x1435f5 from'./firebase-idle-wrapper.js';export function calculateEloD2(_0x760daf,_0x4890c8,_0x5d2b76=0x20){const _0x2912ec=a28_0x5d66,_0x49a128=0x1/(0x1+Math[_0x2912ec(0x11f)](0xa,(_0x4890c8-_0x760daf)/0x190)),_0x5443d8=0x1/(0x1+Math[_0x2912ec(0x11f)](0xa,(_0x760daf-_0x4890c8)/0x190)),_0x5491a8=_0x760daf+_0x5d2b76*(0x1-_0x49a128),_0x19d8f2=_0x4890c8+_0x5d2b76*(0x0-_0x5443d8);return{'newWinnerRating':Math[_0x2912ec(0x126)](_0x5491a8),'newLoserRating':Math[_0x2912ec(0x126)](_0x19d8f2)};}export async function updateEloRatingsD2(_0x1eca07,_0xe9d8d4,_0x21918e){const _0x52d05e=a28_0x5d66;try{const _0xaad605=writeBatch(db),_0x28fd86=doc(db,_0x52d05e(0xf8),_0x1eca07),_0x2a7c19=doc(db,_0x52d05e(0xf8),_0xe9d8d4),[_0x4bf83b,_0x339d27]=await Promise[_0x52d05e(0x102)]([getDoc(_0x28fd86),getDoc(_0x2a7c19)]);if(!_0x4bf83b[_0x52d05e(0xfa)]()||!_0x339d27[_0x52d05e(0xfa)]())throw new Error(_0x52d05e(0x10b));const _0x45bfb7=_0x4bf83b[_0x52d05e(0x127)](),_0x2290e3=_0x339d27['data'](),_0x135d5d=_0x45bfb7[_0x52d05e(0x11b)]||Number['MAX_SAFE_INTEGER'],_0x520c21=_0x2290e3[_0x52d05e(0x11b)]||Number[_0x52d05e(0xee)],{newWinnerRating:_0xedb7f4,newLoserRating:_0xc9d335}=calculateEloD2(_0x45bfb7[_0x52d05e(0x113)]||0x4b0,_0x2290e3['eloRating']||0x4b0);let _0x5b116c=_0x135d5d,_0xac034f=_0x520c21;if(_0x135d5d>_0x520c21){console[_0x52d05e(0x122)]('D2\x20Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked'),_0x5b116c=_0x520c21,_0xac034f=_0x520c21+0x1;const _0x248e8c=query(collection(db,_0x52d05e(0xf8)),where('position','>',_0x520c21),where(_0x52d05e(0x11b),'<',_0x135d5d)),_0x23555f=await getDocs(_0x248e8c);for(const _0x4442ab of _0x23555f['docs']){_0x4442ab['id']!==_0x1eca07&&_0x4442ab['id']!==_0xe9d8d4&&_0xaad605[_0x52d05e(0x107)](doc(db,_0x52d05e(0xf8),_0x4442ab['id']),{'position':_0x4442ab[_0x52d05e(0x127)]()[_0x52d05e(0x11b)]+0x1});}}else console[_0x52d05e(0x122)](_0x52d05e(0xf9));return _0xaad605['update'](_0x28fd86,{'eloRating':_0xedb7f4,'lastMatchDate':serverTimestamp(),'position':_0x5b116c,'lastMatchId':_0x21918e}),_0xaad605[_0x52d05e(0x107)](_0x2a7c19,{'eloRating':_0xc9d335,'lastMatchDate':serverTimestamp(),'position':_0xac034f,'lastMatchId':_0x21918e}),await _0xaad605[_0x52d05e(0x104)](),console[_0x52d05e(0x122)]('D2\x20ELO\x20ratings\x20updated\x20successfully'),await Promise['all']([recordEloChangeD2({'playerId':_0x1eca07,'previousElo':_0x45bfb7[_0x52d05e(0x113)]||0x4b0,'newElo':_0xedb7f4,'opponentId':_0xe9d8d4,'matchResult':_0x52d05e(0x129),'previousPosition':_0x135d5d,'newPosition':_0x5b116c,'isPromotion':_0x5b116c<_0x135d5d,'matchId':_0x21918e,'timestamp':serverTimestamp()}),recordEloChangeD2({'playerId':_0xe9d8d4,'previousElo':_0x2290e3[_0x52d05e(0x113)]||0x4b0,'newElo':_0xc9d335,'opponentId':_0x1eca07,'matchResult':_0x52d05e(0xec),'previousPosition':_0x520c21,'newPosition':_0xac034f,'isDemotion':_0xac034f>_0x520c21,'matchId':_0x21918e,'timestamp':serverTimestamp()})]),await promotionManager[_0x52d05e(0x120)](_0x1eca07,_0xedb7f4,_0x45bfb7[_0x52d05e(0x113)],{'source':_0x52d05e(0x111),'matchId':_0x21918e}),await promotionManager[_0x52d05e(0x120)](_0xe9d8d4,_0xc9d335,_0x2290e3[_0x52d05e(0x113)],{'source':_0x52d05e(0x111),'matchId':_0x21918e}),!![];}catch(_0x4e90d1){console[_0x52d05e(0x10c)](_0x52d05e(0xfb),_0x4e90d1);throw _0x4e90d1;}}export async function approveReportD2(_0x10fde3,_0x4972c0,_0x3f01a1,_0x52537d){const _0x33dd1c=a28_0x5d66;try{console[_0x33dd1c(0x122)](_0x33dd1c(0x100),{'reportId':_0x10fde3,'winnerScore':_0x4972c0,'winnerSuicides':_0x3f01a1,'winnerComment':_0x52537d});const _0xe1fabf=auth[_0x33dd1c(0x119)];if(!_0xe1fabf){console[_0x33dd1c(0x122)](_0x33dd1c(0x110));throw new Error(_0x33dd1c(0xfc));}console[_0x33dd1c(0x122)]('Current\x20user:',_0xe1fabf['email']);const _0x2614ec=await getDoc(doc(db,_0x33dd1c(0xf8),_0xe1fabf['uid'])),_0x56c0c3=_0x2614ec[_0x33dd1c(0xfa)]()?_0x2614ec['data']()['username']:null;console['log']('Current\x20username:',_0x56c0c3);const _0x21d078=doc(db,'pendingMatchesD2',_0x10fde3),_0x2fbf5f=await getDoc(_0x21d078);if(!_0x2fbf5f[_0x33dd1c(0xfa)]()){console[_0x33dd1c(0x122)](_0x33dd1c(0x10e),_0x10fde3);throw new Error(_0x33dd1c(0x123));}const _0x5864e4=_0x2fbf5f[_0x33dd1c(0x127)]();console[_0x33dd1c(0x122)]('D2\x20Report\x20data:',_0x5864e4);if(_0x56c0c3!==_0x5864e4[_0x33dd1c(0x109)])throw new Error(_0x33dd1c(0xef));const _0x2ef4f1={..._0x5864e4,'winnerScore':_0x4972c0,'winnerSuicides':_0x3f01a1,'winnerComment':_0x52537d,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':_0x56c0c3,'createdAt':_0x5864e4[_0x33dd1c(0x108)]||serverTimestamp(),'winnerUsername':_0x5864e4[_0x33dd1c(0x109)],'loserUsername':_0x5864e4[_0x33dd1c(0x115)]};await setDoc(doc(db,_0x33dd1c(0xf1),_0x10fde3),_0x2ef4f1),await deleteDoc(_0x21d078),console['log'](_0x33dd1c(0x112));const [_0x1bc427,_0xf62b27]=await Promise['all']([getDocs(query(collection(db,_0x33dd1c(0xf8)),where('username','==',_0x5864e4['winnerUsername']))),getDocs(query(collection(db,_0x33dd1c(0xf8)),where(_0x33dd1c(0x10a),'==',_0x5864e4[_0x33dd1c(0x115)])))]);if(_0x1bc427[_0x33dd1c(0x12a)]||_0xf62b27[_0x33dd1c(0x12a)])throw new Error(_0x33dd1c(0xfd));const _0x5fcf53=_0x1bc427['docs'][0x0]['id'],_0x316819=_0xf62b27[_0x33dd1c(0x121)][0x0]['id'];return await updateEloRatingsD2(_0x5fcf53,_0x316819,_0x10fde3),console[_0x33dd1c(0x122)](_0x33dd1c(0x11c)),!![];}catch(_0x1ada54){console[_0x33dd1c(0x10c)](_0x33dd1c(0xf5),_0x1ada54);throw _0x1ada54;}}
function a13_0x1788(){const _0xea308=['bind','Unknown\x20Player','console','length','timestamp','error','winnerUsername','loserId','approvedMatchesD3','log','size','Silver','__proto__','player','trace','empty','desc','docs','data','Gold','demotion'];a13_0x1788=function(){return _0xea308;};return a13_0x1788();}const a13_0x25fbf2=a13_0x5a30,a13_0xff83a7=(function(){let _0x57f33b=!![];return function(_0x3085e2,_0x491038){const _0x3473b3=_0x57f33b?function(){if(_0x491038){const _0x331633=_0x491038['apply'](_0x3085e2,arguments);return _0x491038=null,_0x331633;}}:function(){};return _0x57f33b=![],_0x3473b3;};}()),a13_0x3fbf22=a13_0xff83a7(this,function(){const _0x28108d=a13_0x5a30;let _0x4792f8;try{const _0x4d2cd3=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x4792f8=_0x4d2cd3();}catch(_0x38cce9){_0x4792f8=window;}const _0x1b5559=_0x4792f8[_0x28108d(0x19d)]=_0x4792f8['console']||{},_0x1f6c11=[_0x28108d(0x1a4),'warn','info','error','exception','table',_0x28108d(0x1a9)];for(let _0x489a11=0x0;_0x489a11<_0x1f6c11[_0x28108d(0x19e)];_0x489a11++){const _0x342b4e=a13_0xff83a7['constructor']['prototype'][_0x28108d(0x19b)](a13_0xff83a7),_0x596fbd=_0x1f6c11[_0x489a11],_0x380add=_0x1b5559[_0x596fbd]||_0x342b4e;_0x342b4e[_0x28108d(0x1a7)]=a13_0xff83a7[_0x28108d(0x19b)](a13_0xff83a7),_0x342b4e['toString']=_0x380add['toString']['bind'](_0x380add),_0x1b5559[_0x596fbd]=_0x342b4e;}});a13_0x3fbf22();function a13_0x5a30(_0x3e87aa,_0x1a01fa){const _0x3fbf22=a13_0x1788();return a13_0x5a30=function(_0xff83a7,_0x2db0e1){_0xff83a7=_0xff83a7-0x19b;let _0x178853=_0x3fbf22[_0xff83a7];return _0x178853;},a13_0x5a30(_0x3e87aa,_0x1a01fa);}import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc,where}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D3=[{'name':'Emerald','elo':0x7d0},{'name':'Gold','elo':0x708},{'name':a13_0x25fbf2(0x1a6),'elo':0x640},{'name':'Bronze','elo':0x578},{'name':'Unranked','elo':0x4b0}];let lastVisibleD3=null;async function getUsernameByIdD3(_0x5d6fb1){const _0x4ee622=a13_0x25fbf2;try{if(!_0x5d6fb1)return _0x4ee622(0x19c);const _0x57d44c=await getDoc(doc(db,'playersD3',_0x5d6fb1));if(_0x57d44c['exists']())return _0x57d44c[_0x4ee622(0x1ad)]()['username']||_0x4ee622(0x19c);const _0xcb2cc=await getDocs(query(collection(db,_0x4ee622(0x1a3)),where('winnerId','==',_0x5d6fb1),limit(0x1)));if(!_0xcb2cc['empty'])return _0xcb2cc['docs'][0x0]['data']()[_0x4ee622(0x1a1)]||_0x4ee622(0x19c);const _0x1b02ae=await getDocs(query(collection(db,'approvedMatchesD3'),where(_0x4ee622(0x1a2),'==',_0x5d6fb1),limit(0x1)));if(!_0x1b02ae[_0x4ee622(0x1aa)])return _0x1b02ae[_0x4ee622(0x1ac)][0x0]['data']()['loserUsername']||'Unknown\x20Player';return'Unknown\x20Player';}catch(_0x5d8dc9){return console[_0x4ee622(0x1a0)]('Error\x20getting\x20D3\x20username:',_0x5d8dc9),'Unknown\x20Player';}}export async function recordEloChangeD3({playerId:_0x275fc7,previousElo:_0x4ccb3f,newElo:_0x1f1129,opponentId:_0x305429,matchResult:_0x377d5a,previousPosition:_0x49c496,newPosition:_0x4a97e1,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x463a10,timestamp:_0x3bbb59}){const _0x1bbd69=a13_0x25fbf2;try{const _0x5c03ca=doc(collection(db,'eloHistoryD3'));let _0x4093d5='match';if(isPromotion)_0x4093d5='promotion';if(isDemotion)_0x4093d5=_0x1bbd69(0x1af);let _0x6113ad='Unranked';if(_0x1f1129>=0x7d0)_0x6113ad='Emerald';else{if(_0x1f1129>=0x708)_0x6113ad=_0x1bbd69(0x1ae);else{if(_0x1f1129>=0x640)_0x6113ad=_0x1bbd69(0x1a6);else{if(_0x1f1129>=0x578)_0x6113ad='Bronze';}}}return await setDoc(_0x5c03ca,{'type':_0x4093d5,'player':_0x275fc7,'opponent':_0x305429,'previousElo':_0x4ccb3f,'newElo':_0x1f1129,'change':_0x1f1129-_0x4ccb3f,'matchResult':_0x377d5a,'previousPosition':_0x49c496,'newPosition':_0x4a97e1,'rankAchieved':_0x6113ad,'matchId':_0x463a10,'timestamp':_0x3bbb59||serverTimestamp(),'gameMode':'D3'}),console['log']('D3\x20ELO\x20history\x20recorded\x20for\x20'+_0x275fc7),!![];}catch(_0x5af90a){console[_0x1bbd69(0x1a0)]('Error\x20recording\x20D3\x20ELO\x20history:',_0x5af90a);throw _0x5af90a;}}export async function getEloHistoryD3(_0x2f0c06=0x14){const _0x37faa5=a13_0x25fbf2;try{const _0x2d0e02=collection(db,'eloHistoryD3');let _0x1a2c31;lastVisibleD3?_0x1a2c31=query(_0x2d0e02,orderBy('timestamp',_0x37faa5(0x1ab)),startAfter(lastVisibleD3),limit(_0x2f0c06)):_0x1a2c31=query(_0x2d0e02,orderBy(_0x37faa5(0x19f),_0x37faa5(0x1ab)),limit(_0x2f0c06));const _0x4d106c=await getDocs(_0x1a2c31);if(_0x4d106c[_0x37faa5(0x1aa)])return{'entries':[],'hasMore':![]};lastVisibleD3=_0x4d106c[_0x37faa5(0x1ac)][_0x4d106c['docs'][_0x37faa5(0x19e)]-0x1];const _0x173b83=_0x4d106c['docs']['map'](async _0xad612b=>{const _0xd3d7bc=_0x37faa5,_0xa3c47a=_0xad612b['data'](),[_0xcf6df6,_0x44994c]=await Promise['all']([getUsernameByIdD3(_0xa3c47a[_0xd3d7bc(0x1a8)]),getUsernameByIdD3(_0xa3c47a['opponent'])]);return{..._0xa3c47a,'playerUsername':_0xcf6df6,'opponentUsername':_0x44994c,'change':_0xa3c47a['newElo']-_0xa3c47a['previousElo'],'timestamp':_0xa3c47a[_0xd3d7bc(0x19f)]};}),_0x4f7c97=await Promise['all'](_0x173b83);return{'entries':_0x4f7c97,'hasMore':_0x4d106c[_0x37faa5(0x1a5)]===_0x2f0c06};}catch(_0x3980fa){console['error']('Error\x20fetching\x20D3\x20ELO\x20history:',_0x3980fa);throw _0x3980fa;}}export function resetPaginationD3(){lastVisibleD3=null;}
const a42_0x47e018=a42_0x533f,a42_0x562b86=(function(){let _0x350ac3=!![];return function(_0x15903d,_0x201390){const _0x563ea3=_0x350ac3?function(){if(_0x201390){const _0x4a1cd1=_0x201390['apply'](_0x15903d,arguments);return _0x201390=null,_0x4a1cd1;}}:function(){};return _0x350ac3=![],_0x563ea3;};}()),a42_0x5648b2=a42_0x562b86(this,function(){const _0x269559=a42_0x533f;let _0x20c435;try{const _0xe47e76=Function('return\x20(function()\x20'+_0x269559(0x16a)+');');_0x20c435=_0xe47e76();}catch(_0x68ba2){_0x20c435=window;}const _0x50b2a2=_0x20c435['console']=_0x20c435['console']||{},_0x41c06b=['log',_0x269559(0x16c),_0x269559(0x160),'error','exception','table',_0x269559(0x166)];for(let _0x256519=0x0;_0x256519<_0x41c06b['length'];_0x256519++){const _0x480f64=a42_0x562b86['constructor']['prototype']['bind'](a42_0x562b86),_0x49b84=_0x41c06b[_0x256519],_0x1cb46a=_0x50b2a2[_0x49b84]||_0x480f64;_0x480f64[_0x269559(0x128)]=a42_0x562b86[_0x269559(0x13d)](a42_0x562b86),_0x480f64[_0x269559(0x14b)]=_0x1cb46a[_0x269559(0x14b)]['bind'](_0x1cb46a),_0x50b2a2[_0x49b84]=_0x480f64;}});a42_0x5648b2();import{collection,doc,query,where,orderBy,limit,getDocs,addDoc,getDoc,serverTimestamp,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a42_0x533f(_0x1d2171,_0x398eb7){const _0x5648b2=a42_0x1e95();return a42_0x533f=function(_0x562b86,_0x11899b){_0x562b86=_0x562b86-0x10e;let _0x1e950e=_0x5648b2[_0x562b86];return _0x1e950e;},a42_0x533f(_0x1d2171,_0x398eb7);}function a42_0x1e95(){const _0x3a144c=['resolvedName','\x20was\x20dismissed\x20by\x20user\x20within\x20last\x20','Error\x20saving\x20promotion\x20preference:','STARTING\x20notification\x20for\x20','error','ignored','date','stringify','innerHTML','ignore-btn','new-rank-change','getItem','modifiedBy','now','parse','offsetWidth','type','fetchRecentPromotions','loserUsername','dismissing','ladder','seconds','eloHistory','source','Fallback\x20write\x20failed:','appendChild','__proto__','rankChangeModal','email','admin','automatic','rank-change-ok-btn','forEach','click','&times;','style','RANKS','Error\x20checking\x20promotion\x20visibility:','bannerContainer','username','createElement','player','Error\x20resolving\x20username:','Discord\x20notification\x20sent\x20successfully\x20with\x20ID:\x20','setItem','addEventListener','flex','bind','title','string','Error\x20sending\x20Discord\x20notification:','currentUser','showRankChangeBanner','initialize','Error\x20writing\x20promotion\x20records:','data','Promotion\x20','test',',\x20treating\x20as\x20new','isAutomatic','You\x27ve\x20been\x20demoted\x20to','toString','setupBannerContainer','winnerUsername','rank-change-modal\x20','userDismissed','promotion_','Resolved\x20','DISPLAY_HOURS','button','none','div','displayName','set','desc','resolveUserId','setAttribute','Error\x20fetching\x20promotions:','#C0C0C0','matchId','Creating\x20Discord\x20notification:','checkAndRecordPromotion','info','classList','className','log','playerUsername','Silver','trace','pollingInterval','rankAchieved','toMillis','{}.constructor(\x22return\x20this\x22)(\x20)','Error\x20processing\x20rank\x20change:','warn','players','Gold','children','parentNode','some','timestamp','A\x20player','shouldShowPromotion','display','remove','systemDismissed','Unknown\x20Player','previousRank'];a42_0x1e95=function(){return _0x3a144c;};return a42_0x1e95();}import{auth,db}from'./firebase-config.js';class PromotionManager{constructor(){const _0x16d495=a42_0x533f;this[_0x16d495(0x152)]=0x18,this['RANKS']=[{'threshold':0x578,'name':'Bronze','color':'#CD7F32'},{'threshold':0x640,'name':_0x16d495(0x165),'color':_0x16d495(0x15c)},{'threshold':0x708,'name':_0x16d495(0x16e),'color':'#FFD700'},{'threshold':0x834,'name':'Emerald','color':'#50C878'}],this['bannerContainer']=null,this['lastFetchTime']=0x0,this['fetchInterval']=0xea60,this['pollingInterval']=null,this['usernameCache']={};}[a42_0x47e018(0x143)](){const _0x3021bf=a42_0x47e018;this['bannerContainer']=document['getElementById']('promotion-banner-container');if(!this[_0x3021bf(0x134)]){console['error']('Promotion\x20banner\x20container\x20not\x20found');return;}this['setupBannerContainer']();const _0x1ad4f3='promotions_checked_'+new Date()['toDateString'](),_0xa7f9a5=sessionStorage[_0x3021bf(0x119)](_0x1ad4f3);!_0xa7f9a5&&(this[_0x3021bf(0x11f)](),sessionStorage[_0x3021bf(0x13a)](_0x1ad4f3,'true')),document[_0x3021bf(0x13b)]('visibilitychange',()=>{const _0x4b822a=_0x3021bf;document['visibilityState']==='visible'&&!sessionStorage[_0x4b822a(0x119)](_0x1ad4f3)&&(this['fetchRecentPromotions'](),sessionStorage['setItem'](_0x1ad4f3,'true'));}),window['addEventListener']('beforeunload',()=>{this['pollingInterval']&&clearInterval(this['pollingInterval']);});}[a42_0x47e018(0x14c)](){const _0x35a610=a42_0x47e018;this['bannerContainer'][_0x35a610(0x116)]='',this['bannerContainer'][_0x35a610(0x131)]['display']='none';}async[a42_0x47e018(0x11f)](){const _0x26c07d=a42_0x47e018;try{const _0x15e739=Date[_0x26c07d(0x11b)]();if(_0x15e739-this['lastFetchTime']<this['fetchInterval'])return;this['lastFetchTime']=_0x15e739;const _0x1aee64=collection(db,'eloHistory'),_0x4416a3=query(_0x1aee64,where('type','in',['promotion','demotion']),orderBy('timestamp',_0x26c07d(0x158)),limit(0x14)),_0x1bc0f8=await getDocs(_0x4416a3),_0x41f5c1=[];_0x1bc0f8[_0x26c07d(0x12e)](_0x14479b=>{const _0x5cc452=_0x26c07d,_0x31d01c={'id':_0x14479b['id'],..._0x14479b['data']()};this[_0x5cc452(0x174)](_0x14479b['id'])&&this['isNewRankChange'](_0x31d01c)&&_0x41f5c1['push'](_0x31d01c);}),_0x41f5c1['length']>0x0&&await this['processRankChanges'](_0x41f5c1);}catch(_0xcafa0e){console[_0x26c07d(0x112)](_0x26c07d(0x15b),_0xcafa0e);}}async['processRankChanges'](_0x26dc18){const _0xfcacb8=a42_0x47e018;if(_0x26dc18['length']===0x0)return;_0x26dc18['sort']((_0x25b354,_0x57229c)=>{const _0x5eb556=a42_0x533f,_0x58bb2b=_0x25b354['timestamp']?.[_0x5eb556(0x169)]?.()||_0x25b354[_0x5eb556(0x172)]?.[_0x5eb556(0x123)]*0x3e8||0x0,_0x5ca828=_0x57229c['timestamp']?.['toMillis']?.()||_0x57229c['timestamp']?.['seconds']*0x3e8||0x0;return _0x5ca828-_0x58bb2b;});const _0x3d8254=this['bannerContainer'][_0xfcacb8(0x16f)]['length'],_0x12b81f=0x3-_0x3d8254;if(_0x12b81f<=0x0)return;const _0x506847=_0x26dc18['slice'](0x0,_0x12b81f);for(let _0x2146f8=0x0;_0x2146f8<_0x506847['length'];_0x2146f8++){const _0xb0e32e=_0x506847[_0x2146f8],_0x141ddf=auth['currentUser'];try{setTimeout(()=>{this['showRankChangeBanner'](_0xb0e32e);},_0x2146f8*0x3e8),_0x141ddf&&_0xb0e32e[_0xfcacb8(0x137)]===_0x141ddf['displayName']&&this['showRankChangeLightbox'](_0xb0e32e['type'],_0xb0e32e['rankAchieved']);}catch(_0x3c773c){console['error'](_0xfcacb8(0x16b),_0x3c773c);}}}['shouldShowPromotion'](_0x4f21ad){const _0x17b91f=a42_0x47e018;try{const _0xf85722='promotion_'+_0x4f21ad,_0x1357ae=localStorage['getItem'](_0xf85722);if(_0x1357ae){let _0x326054;try{_0x326054=JSON['parse'](_0x1357ae);}catch(_0x5f3640){return console[_0x17b91f(0x16c)]('Invalid\x20storage\x20format\x20for\x20'+_0xf85722+_0x17b91f(0x148)),!![];}if(_0x326054[_0x17b91f(0x113)]===!![])return console['log']('Promotion\x20'+_0x4f21ad+'\x20is\x20permanently\x20ignored'),![];const _0x279f9f=Date[_0x17b91f(0x11b)]();if(_0x326054[_0x17b91f(0x14f)]&&_0x279f9f-_0x326054['timestamp']<this['DISPLAY_HOURS']*0x3c*0x3c*0x3e8)return console['log'](_0x17b91f(0x146)+_0x4f21ad+_0x17b91f(0x10f)+this['DISPLAY_HOURS']+'\x20hours'),![];if(_0x326054[_0x17b91f(0x177)]&&_0x279f9f-_0x326054['timestamp']<0x4*0x3c*0x3c*0x3e8)return console['log'](_0x17b91f(0x146)+_0x4f21ad+'\x20was\x20auto-dismissed\x20within\x20last\x204\x20hours'),![];}return!![];}catch(_0x142b32){return console['error'](_0x17b91f(0x133),_0x142b32),![];}}['ignorePromotion'](_0x1ffe50){const _0x4595f7=a42_0x47e018;try{const _0x3066ef=_0x4595f7(0x150)+_0x1ffe50;localStorage['setItem'](_0x3066ef,JSON['stringify']({'timestamp':Date[_0x4595f7(0x11b)](),'ignored':!![]}));}catch(_0x3734e7){console[_0x4595f7(0x112)](_0x4595f7(0x110),_0x3734e7);}}[a42_0x47e018(0x142)](_0x2a7f0a){this['resolveUserId'](_0x2a7f0a)['then'](_0x51c72f=>{const _0x5bf058=a42_0x533f,_0x3c2f64='promotion_'+_0x2a7f0a['id'],_0x4d1161=localStorage[_0x5bf058(0x119)](_0x3c2f64);if(_0x4d1161)try{const _0xbe3e38=JSON[_0x5bf058(0x11c)](_0x4d1161);if(_0xbe3e38['ignored']===!![]){console['log']('Skipping\x20ignored\x20promotion:\x20'+_0x2a7f0a['id']);return;}}catch(_0x293a13){}localStorage['setItem'](_0x3c2f64,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':![],'seenAt':Date['now']()})),this['bannerContainer']['style'][_0x5bf058(0x175)]='block';while(this['bannerContainer']['children']['length']>=0x3){this['bannerContainer']['removeChild'](this[_0x5bf058(0x134)]['firstChild']);}const _0x2f7b88=document[_0x5bf058(0x136)]('div');_0x2f7b88['className']='promotion-banner',_0x2f7b88['setAttribute']('data-rank',_0x51c72f['rankAchieved']),_0x2f7b88[_0x5bf058(0x15a)]('data-id',_0x51c72f['id']);const _0x277eec=document['createElement']('div');_0x277eec['className']='promotion-details';const _0x1b959f=_0x51c72f['resolvedName']||_0x51c72f['player']||_0x51c72f[_0x5bf058(0x135)]||_0x51c72f[_0x5bf058(0x164)]||_0x51c72f['displayName']||_0x5bf058(0x173),_0x3e6d1a=_0x51c72f[_0x5bf058(0x11e)]==='promotion'?_0x1b959f+'\x20was\x20promoted\x20to':_0x1b959f+'\x20was\x20demoted\x20to';_0x277eec['innerHTML']=_0x3e6d1a+'\x20<span\x20class=\x22rank-text\x22>'+_0x51c72f[_0x5bf058(0x168)]+'</span>';const _0x316662=document[_0x5bf058(0x136)](_0x5bf058(0x155));_0x316662['className']='banner-actions';const _0x920d6c=document['createElement'](_0x5bf058(0x153));_0x920d6c[_0x5bf058(0x162)]='dismiss-btn',_0x920d6c['innerHTML']=_0x5bf058(0x130),_0x920d6c[_0x5bf058(0x13e)]='Dismiss';const _0x1bf0c0=document[_0x5bf058(0x136)](_0x5bf058(0x153));_0x1bf0c0[_0x5bf058(0x162)]=_0x5bf058(0x117),_0x1bf0c0['textContent']='Don\x27t\x20show\x20again',_0x1bf0c0[_0x5bf058(0x13e)]='Never\x20show\x20this\x20promotion\x20again',_0x316662['appendChild'](_0x1bf0c0),_0x316662['appendChild'](_0x920d6c),_0x2f7b88['appendChild'](_0x277eec),_0x2f7b88[_0x5bf058(0x127)](_0x316662),this[_0x5bf058(0x134)][_0x5bf058(0x127)](_0x2f7b88),void _0x2f7b88[_0x5bf058(0x11d)],setTimeout(()=>{_0x2f7b88['classList']['add']('new-rank-change');},0x32),_0x920d6c[_0x5bf058(0x13b)](_0x5bf058(0x12f),()=>{const _0x58e411=_0x5bf058;localStorage['setItem'](_0x3c2f64,JSON[_0x58e411(0x115)]({'timestamp':Date['now'](),'ignored':![],'userDismissed':!![],'systemDismissed':![]})),_0x2f7b88['classList']['remove']('new-rank-change'),_0x2f7b88[_0x58e411(0x161)]['add']('dismissing'),setTimeout(()=>{const _0x25aebf=_0x58e411;_0x2f7b88['parentNode']&&(_0x2f7b88[_0x25aebf(0x176)](),this['bannerContainer']['children']['length']===0x0&&(this[_0x25aebf(0x134)]['style'][_0x25aebf(0x175)]=_0x25aebf(0x154)));},0x1f4);}),_0x1bf0c0['addEventListener']('click',()=>{const _0x7ed506=_0x5bf058;localStorage[_0x7ed506(0x13a)](_0x3c2f64,JSON['stringify']({'timestamp':Date[_0x7ed506(0x11b)](),'ignored':!![],'userDismissed':!![],'systemDismissed':![]})),_0x2f7b88['classList']['remove'](_0x7ed506(0x118)),_0x2f7b88[_0x7ed506(0x161)]['add']('dismissing'),setTimeout(()=>{const _0x2baaa0=_0x7ed506;_0x2f7b88['parentNode']&&(_0x2f7b88['remove'](),this['bannerContainer']['children']['length']===0x0&&(this[_0x2baaa0(0x134)][_0x2baaa0(0x131)][_0x2baaa0(0x175)]='none'));},0x1f4);}),setTimeout(()=>{const _0x92dab4=_0x5bf058;_0x2f7b88[_0x92dab4(0x170)]&&(_0x2f7b88[_0x92dab4(0x161)][_0x92dab4(0x176)]('new-rank-change'),_0x2f7b88['classList']['add'](_0x92dab4(0x121)),localStorage['setItem'](_0x3c2f64,JSON[_0x92dab4(0x115)]({'timestamp':Date[_0x92dab4(0x11b)](),'ignored':![],'userDismissed':![],'systemDismissed':!![]})),setTimeout(()=>{const _0x40127b=_0x92dab4;_0x2f7b88['parentNode']&&(_0x2f7b88[_0x40127b(0x176)](),this['bannerContainer']['children']['length']===0x0&&(this['bannerContainer'][_0x40127b(0x131)]['display']='none'));},0x1f4));},0x3a98);});}async[a42_0x47e018(0x159)](_0x1aafc6){const _0x15ca0c=a42_0x47e018,_0x1eba51={..._0x1aafc6},_0x3dd3af=[_0x1aafc6['player'],_0x1aafc6['username'],_0x1aafc6[_0x15ca0c(0x164)],_0x1aafc6['displayName']],_0x3c16d6=_0x3dd3af[_0x15ca0c(0x171)](_0x37987d=>_0x37987d&&typeof _0x37987d===_0x15ca0c(0x13f)&&!_0x37987d['includes']('ID:')&&!/^[a-zA-Z0-9]{20,}$/['test'](_0x37987d));if(_0x3c16d6)return _0x1eba51;let _0x18843d=null;if(_0x1aafc6['userId'])_0x18843d=_0x1aafc6['userId'];else _0x1aafc6['player']&&/^[A-Za-z0-9]{20,}$/[_0x15ca0c(0x147)](_0x1aafc6['player'])&&(_0x18843d=_0x1aafc6['player']);if(!_0x18843d)return _0x1eba51;try{const _0x44796c=await getDoc(doc(db,'players',_0x18843d));if(_0x44796c['exists']()){const _0xa8075e=_0x44796c[_0x15ca0c(0x145)]();if(_0xa8075e[_0x15ca0c(0x135)])return _0x1eba51[_0x15ca0c(0x10e)]=_0xa8075e['username'],_0x1eba51;}const _0x5dfd6a=await getDocs(query(collection(db,'approvedMatches'),where('winnerId','==',_0x18843d),orderBy(_0x15ca0c(0x114),'desc'),limit(0x1)));if(!_0x5dfd6a['empty']){const _0x56bb8c=_0x5dfd6a['docs'][0x0][_0x15ca0c(0x145)]();if(_0x56bb8c[_0x15ca0c(0x14d)])return _0x1eba51[_0x15ca0c(0x10e)]=_0x56bb8c['winnerUsername'],_0x1eba51;}const _0xcded0b=await getDocs(query(collection(db,'approvedMatches'),where('loserId','==',_0x18843d),orderBy('date','desc'),limit(0x1)));if(!_0xcded0b['empty']){const _0x5830af=_0xcded0b['docs'][0x0][_0x15ca0c(0x145)]();if(_0x5830af[_0x15ca0c(0x120)])return _0x1eba51['resolvedName']=_0x5830af['loserUsername'],console[_0x15ca0c(0x163)](_0x15ca0c(0x151)+_0x18843d+'\x20to\x20'+_0x5830af['loserUsername']+'\x20(loser)'),_0x1eba51;}}catch(_0x547d56){console[_0x15ca0c(0x112)]('Error\x20resolving\x20user\x20ID:',_0x547d56);}return console['warn']('Failed\x20to\x20resolve\x20user\x20ID:\x20'+_0x18843d),_0x1eba51;}['showRankChangeLightbox'](_0x1eca2b,_0x39f7c3){const _0x1ebf6a=a42_0x47e018;let _0x495d5d=document['getElementById'](_0x1ebf6a(0x129));!_0x495d5d&&(_0x495d5d=document[_0x1ebf6a(0x136)]('div'),_0x495d5d['id']=_0x1ebf6a(0x129),_0x495d5d[_0x1ebf6a(0x162)]=_0x1ebf6a(0x14e)+_0x1eca2b,document['body']['appendChild'](_0x495d5d));const _0x31a4fb=_0x1eca2b==='promotion'?'Congratulations!':'Rank\x20Update',_0x3115e1=_0x1eca2b==='promotion'?'You\x27ve\x20been\x20promoted\x20to':_0x1ebf6a(0x14a);_0x495d5d['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rank-change-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2\x20class=\x22rank-change-title\x22>'+_0x31a4fb+'</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>'+_0x3115e1+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22rank-name\x22>'+_0x39f7c3+'</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22rank-change-button\x22\x20id=\x22rank-change-ok-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Got\x20it!\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x495d5d['style']['display']=_0x1ebf6a(0x13c),document['getElementById'](_0x1ebf6a(0x12d))['addEventListener'](_0x1ebf6a(0x12f),()=>{const _0x1a1944=_0x1ebf6a;_0x495d5d[_0x1a1944(0x131)]['display']='none';}),_0x495d5d['addEventListener']('click',_0x26cde7=>{const _0x4828d4=_0x1ebf6a;_0x26cde7['target']===_0x495d5d&&(_0x495d5d[_0x4828d4(0x131)]['display']='none');});}async[a42_0x47e018(0x15f)](_0x2418df,_0x21dd36,_0x37c0ec,_0x1d88e4={}){const _0x5f0b5b=a42_0x47e018;try{if(_0x21dd36===_0x37c0ec||!_0x2418df)return null;const _0x47f492=_0x1d88e4['source']||_0x5f0b5b(0x12c),_0x144400=_0x1d88e4['matchId']||null,_0x28ac9f=_0x1d88e4['adminUser']||null;console['log']('Processing\x20potential\x20rank\x20change:\x20'+_0x37c0ec+'\x20→\x20'+_0x21dd36+'\x20(source:\x20'+_0x47f492+')');let _0x968f03=null,_0x507e2f=null;try{const _0x290f77=await getDoc(doc(db,_0x5f0b5b(0x16d),_0x2418df));if(_0x290f77['exists']()){const _0x56e08d=_0x290f77['data']();_0x968f03=_0x56e08d['username']||_0x56e08d['displayName']||null,_0x507e2f=_0x56e08d[_0x5f0b5b(0x156)]||_0x56e08d['username']||null;}!_0x968f03&&_0x1d88e4[_0x5f0b5b(0x135)]&&(_0x968f03=_0x1d88e4['username'],_0x507e2f=_0x1d88e4[_0x5f0b5b(0x135)]);!_0x968f03&&auth['currentUser']&&(_0x968f03=auth['currentUser']['displayName']||auth[_0x5f0b5b(0x141)][_0x5f0b5b(0x12a)]['split']('@')[0x0],_0x507e2f=auth[_0x5f0b5b(0x141)]['displayName']||null);if(!_0x968f03){const _0xc8ad76=query(collection(db,'approvedMatches'),where('winnerId','==',_0x2418df),limit(0x1)),_0x54ed3c=await getDocs(_0xc8ad76);if(!_0x54ed3c['empty'])_0x968f03=_0x54ed3c['docs'][0x0]['data']()['winnerUsername']||_0x5f0b5b(0x178),_0x507e2f=_0x968f03;else{const _0x50778c=query(collection(db,'approvedMatches'),where('loserId','==',_0x2418df),limit(0x1)),_0x16a9ca=await getDocs(_0x50778c);!_0x16a9ca['empty']&&(_0x968f03=_0x16a9ca[0x0]['data']()[_0x5f0b5b(0x120)]||'Unknown\x20Player',_0x507e2f=_0x968f03);}}}catch(_0x5f4d64){console[_0x5f0b5b(0x112)](_0x5f0b5b(0x138),_0x5f4d64);}!_0x968f03&&(console['warn']('Could\x20not\x20resolve\x20username\x20for\x20userId:',_0x2418df),_0x968f03=_0x5f0b5b(0x173),_0x507e2f='Unknown\x20Player');const _0x267240=this['getRankName'](_0x37c0ec),_0x569ab6=this['getRankName'](_0x21dd36);if(_0x267240!==_0x569ab6){const _0x1ecd00=_0x21dd36>_0x37c0ec,_0x14dece=_0x1ecd00?'promotion':'demotion',_0x2c1658=_0x569ab6;console[_0x5f0b5b(0x163)]('Recording\x20'+_0x14dece+'\x20for\x20'+_0x968f03+':\x20'+_0x37c0ec+'\x20('+_0x267240+')\x20→\x20'+_0x21dd36+'\x20('+_0x569ab6+')');try{const _0x1e3083={'player':_0x968f03,'playerUsername':_0x968f03,'username':_0x968f03,'displayName':_0x507e2f,'userId':_0x2418df,'type':_0x14dece,'rankAchieved':_0x2c1658,'timestamp':serverTimestamp(),'previousElo':_0x37c0ec,'newElo':_0x21dd36,'change':_0x21dd36-_0x37c0ec,'previousRank':_0x267240,'newRank':_0x569ab6,'source':_0x47f492};if(_0x47f492==='match'&&_0x144400)_0x1e3083[_0x5f0b5b(0x15d)]=_0x144400;else _0x47f492===_0x5f0b5b(0x12b)&&_0x28ac9f?(_0x1e3083[_0x5f0b5b(0x11a)]=_0x28ac9f,_0x1e3083[_0x5f0b5b(0x149)]=![]):_0x1e3083[_0x5f0b5b(0x149)]=!![];const _0x375e56=writeBatch(db),_0x482e91=doc(collection(db,_0x5f0b5b(0x124))),_0x36f843=doc(collection(db,'promotionHistory'));return _0x375e56[_0x5f0b5b(0x157)](_0x482e91,_0x1e3083),_0x375e56['set'](_0x36f843,_0x1e3083),await _0x375e56['commit'](),await this['sendPromotionNotification'](_0x2418df,_0x968f03,_0x37c0ec,_0x21dd36,_0x267240,_0x569ab6,_0x14dece,{'displayName':_0x507e2f,'source':_0x47f492,'matchId':_0x144400,'ladder':_0x1d88e4['ladder']||'D1'}),console['log']('Successfully\x20recorded\x20'+_0x14dece+'\x20for\x20'+_0x968f03+'\x20to\x20'+_0x2c1658),_0x2c1658;}catch(_0x582dae){console['error'](_0x5f0b5b(0x144),_0x582dae);try{return await addDoc(collection(db,'eloHistory'),{'player':_0x968f03,'playerUsername':_0x968f03,'username':_0x968f03,'displayName':_0x507e2f,'userId':_0x2418df,'type':_0x14dece,'rankAchieved':_0x2c1658,'timestamp':serverTimestamp(),'previousElo':_0x37c0ec,'newElo':_0x21dd36,'change':_0x21dd36-_0x37c0ec,'previousRank':_0x267240,'source':_0x47f492,'isAutomatic':_0x47f492!==_0x5f0b5b(0x12b)}),await this['sendPromotionNotification'](_0x2418df,_0x968f03,_0x37c0ec,_0x21dd36,_0x267240,_0x569ab6,_0x14dece,{'displayName':_0x507e2f,'source':_0x47f492,'matchId':_0x144400,'ladder':_0x1d88e4['ladder']||'D1'}),_0x2c1658;}catch(_0x4957bc){return console['error'](_0x5f0b5b(0x126),_0x4957bc),null;}}}return null;}catch(_0xddc9ab){return console['error']('Error\x20in\x20promotion/demotion\x20recording:',_0xddc9ab),null;}}['getRankName'](_0x35e925){const _0x277451=a42_0x47e018;for(let _0x15d731=this[_0x277451(0x132)]['length']-0x1;_0x15d731>=0x0;_0x15d731--){if(_0x35e925>=this['RANKS'][_0x15d731]['threshold'])return this['RANKS'][_0x15d731]['name'];}return'Unranked';}['cleanup'](){const _0x5a8ac1=a42_0x47e018;this[_0x5a8ac1(0x167)]&&clearInterval(this['pollingInterval']);}['isNewRankChange'](_0x44443a){const _0x472763=a42_0x47e018;if(_0x44443a[_0x472763(0x172)]){const _0x3f34fe=_0x44443a[_0x472763(0x172)]['seconds']*0x3e8,_0x6415b2=Date['now'](),_0x90e2f5=(_0x6415b2-_0x3f34fe)/(0x3e8*0x3c*0x3c);if(_0x90e2f5>0x18)return![];}if(_0x44443a['previousRank']&&_0x44443a['newRank']&&_0x44443a[_0x472763(0x179)]!==_0x44443a['newRank'])return!![];return![];}async['sendPromotionNotification'](_0x43a6ad,_0x3c4b5e,_0x1180fa,_0x5a4012,_0x139818,_0x23be4f,_0x21d40a,_0x4144d0={}){const _0x1565e6=a42_0x47e018;try{console['log'](_0x1565e6(0x111)+_0x3c4b5e+'\x27s\x20'+_0x21d40a);const _0x5b4a65={'userId':_0x43a6ad,'username':_0x3c4b5e,'displayName':_0x4144d0[_0x1565e6(0x156)]||_0x3c4b5e,'oldElo':parseInt(_0x1180fa),'newElo':parseInt(_0x5a4012),'eloDifference':parseInt(_0x5a4012)-parseInt(_0x1180fa),'oldRank':_0x139818,'newRank':_0x23be4f,'type':_0x21d40a,'timestamp':serverTimestamp(),'processed':![],'source':_0x4144d0[_0x1565e6(0x125)]||'automatic','matchId':_0x4144d0['matchId']||null,'ladder':_0x4144d0[_0x1565e6(0x122)]||'D1','adminUser':_0x4144d0['adminUser']||null};console[_0x1565e6(0x163)](_0x1565e6(0x15e),_0x5b4a65);const _0x3f5e29=await addDoc(collection(db,'promotionNotifications'),_0x5b4a65);return console['log'](_0x1565e6(0x139)+_0x3f5e29['id']),!![];}catch(_0x476b1e){return console['error'](_0x1565e6(0x140),_0x476b1e),![];}}}export const promotionManager=new PromotionManager();document['addEventListener']('DOMContentLoaded',()=>{const _0xa85f9f=a42_0x47e018;promotionManager[_0xa85f9f(0x143)]();});export const initializePromotionTracker=()=>promotionManager['initialize']();export const checkAndRecordPromotion=(_0xc6c5b5,_0x3c9205,_0x111ed6,_0xa2f19e)=>promotionManager[a42_0x47e018(0x15f)](_0xc6c5b5,_0x3c9205,_0x111ed6,_0xa2f19e);export const getRankName=_0x5ed1af=>promotionManager['getRankName'](_0x5ed1af);
const a56_0x4c37da=(function(){let _0x4bd939=!![];return function(_0xedb8ff,_0x5b9f14){const _0x540a7f=_0x4bd939?function(){if(_0x5b9f14){const _0x531e88=_0x5b9f14['apply'](_0xedb8ff,arguments);return _0x5b9f14=null,_0x531e88;}}:function(){};return _0x4bd939=![],_0x540a7f;};}()),a56_0x491ccd=a56_0x4c37da(this,function(){const _0x537648=a56_0x5729;let _0x3ad0c5;try{const _0xc9086d=Function(_0x537648(0x1a9)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x3ad0c5=_0xc9086d();}catch(_0x47ed94){_0x3ad0c5=window;}const _0x57986b=_0x3ad0c5[_0x537648(0x1ad)]=_0x3ad0c5['console']||{},_0x352e1a=[_0x537648(0x1a5),'warn','info','error',_0x537648(0x1a6),'table','trace'];for(let _0xe8c5da=0x0;_0xe8c5da<_0x352e1a['length'];_0xe8c5da++){const _0x1e6f5f=a56_0x4c37da[_0x537648(0x1af)]['prototype']['bind'](a56_0x4c37da),_0x763081=_0x352e1a[_0xe8c5da],_0x4528a9=_0x57986b[_0x763081]||_0x1e6f5f;_0x1e6f5f[_0x537648(0x1a8)]=a56_0x4c37da[_0x537648(0x1a4)](a56_0x4c37da),_0x1e6f5f['toString']=_0x4528a9[_0x537648(0x1a1)][_0x537648(0x1a4)](_0x4528a9),_0x57986b[_0x763081]=_0x1e6f5f;}});a56_0x491ccd();import{db}from'../firebase-config.js';import{collection,doc,getDoc,getDocs,query,limit,startAfter,where,onSnapshot}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const cache={'userProfiles':new Map(),'ladderPlayers':new Map(),'matchResults':new Map(),'eloHistory':new Map()},CACHE_EXPIRY={'userProfiles':0x5*0x3c*0x3e8,'ladderPlayers':0x2*0x3c*0x3e8,'matchResults':0x1*0x3c*0x3e8,'eloHistory':0x3*0x3c*0x3e8};function a56_0x5729(_0x4fbfbb,_0x1d0dcb){const _0x491ccd=a56_0x18b2();return a56_0x5729=function(_0x4c37da,_0x1076d1){_0x4c37da=_0x4c37da-0x1a1;let _0x18b29e=_0x491ccd[_0x4c37da];return _0x18b29e;},a56_0x5729(_0x4fbfbb,_0x1d0dcb);}export const userProfilesRef=collection(db,'userProfiles');export async function fetchPaginatedData(_0x3ad895,_0x9b1bd3=0xa,_0x357c1f=null){const _0x17e385=a56_0x5729;let _0x343fe6=query(_0x3ad895,limit(_0x9b1bd3));_0x357c1f&&(_0x343fe6=query(_0x343fe6,startAfter(_0x357c1f)));const _0x434529=await getDocs(_0x343fe6),_0xc65e42=_0x434529['docs'][_0x434529[_0x17e385(0x1ab)]['length']-0x1];return{'data':_0x434529[_0x17e385(0x1ab)][_0x17e385(0x1ae)](_0x12916b=>({'id':_0x12916b['id'],..._0x12916b['data']()})),'lastVisible':_0xc65e42,'hasMore':_0x434529['docs']['length']===_0x9b1bd3};}export async function getUserProfile(_0x1f7aec){const _0x3c7293=a56_0x5729,_0x1f01e1=cache[_0x3c7293(0x1b1)]['get'](_0x1f7aec);if(_0x1f01e1&&Date[_0x3c7293(0x1a7)]()-_0x1f01e1['timestamp']<CACHE_EXPIRY['userProfiles'])return _0x1f01e1[_0x3c7293(0x1a3)];const _0x1ba780=await getDoc(doc(userProfilesRef,_0x1f7aec));if(_0x1ba780['exists']()){const _0x500f2c=_0x1ba780['data']();return cache['userProfiles']['set'](_0x1f7aec,{'data':_0x500f2c,'timestamp':Date['now']()}),_0x500f2c;}return null;}function a56_0x18b2(){const _0x10a4f6=['toString','players','data','bind','log','exception','now','__proto__','return\x20(function()\x20','set','docs','includes','console','map','constructor','length','userProfiles','forEach'];a56_0x18b2=function(){return _0x10a4f6;};return a56_0x18b2();}export async function getLadderData(_0x359b43=0x1){const _0x2c3640=a56_0x5729,_0xf2f71c='division_'+_0x359b43,_0x12da12=cache['ladderPlayers']['get'](_0xf2f71c);if(_0x12da12&&Date['now']()-_0x12da12['timestamp']<CACHE_EXPIRY['ladderPlayers'])return _0x12da12['data'];const _0x4c23a7=_0x359b43===0x1?'players':'playersD'+_0x359b43,_0xec5566=collection(db,_0x4c23a7),_0x37407e=await getDocs(query(_0xec5566,limit(0x64))),_0x32c4fa=_0x37407e['docs']['map'](_0x3d05a4=>({'id':_0x3d05a4['id'],..._0x3d05a4['data']()}));return cache['ladderPlayers']['set'](_0xf2f71c,{'data':_0x32c4fa,'timestamp':Date[_0x2c3640(0x1a7)]()}),_0x32c4fa;}export async function getEloHistoryBatch(_0x25ed52,_0x1c45dc=0x1){const _0x49b8b6=a56_0x5729,_0x15a7f7=_0x1c45dc===0x1?'eloHistory':'eloHistoryD'+_0x1c45dc,_0x400463=collection(db,_0x15a7f7),_0x4033a4={},_0x4a8a68=[];_0x25ed52[_0x49b8b6(0x1b2)](_0x59d065=>{const _0x1c912b=_0x59d065+'_'+_0x1c45dc,_0xa8633d=cache['eloHistory']['get'](_0x1c912b);_0xa8633d&&Date['now']()-_0xa8633d['timestamp']<CACHE_EXPIRY['eloHistory']?_0x4033a4[_0x59d065]=_0xa8633d['data']:_0x4a8a68['push'](_0x59d065);});const _0x16f0b6=0xa;for(let _0x230cbd=0x0;_0x230cbd<_0x4a8a68['length'];_0x230cbd+=_0x16f0b6){const _0x316411=_0x4a8a68['slice'](_0x230cbd,_0x230cbd+_0x16f0b6);if(_0x316411[_0x49b8b6(0x1b0)]>0x0)try{const _0x5ef156=query(_0x400463,where('playerId','in',_0x316411),limit(0x64)),_0x1c2821=await getDocs(_0x5ef156);_0x1c2821[_0x49b8b6(0x1ab)]['forEach'](_0x595d99=>{const _0x4d112d=_0x49b8b6,_0x58a2d6=_0x595d99['data'](),_0x5d0ff6=_0x58a2d6['playerId'];if(!_0x4033a4[_0x5d0ff6])_0x4033a4[_0x5d0ff6]=[];_0x4033a4[_0x5d0ff6]['push'](_0x58a2d6);const _0x55960c=_0x5d0ff6+'_'+_0x1c45dc;cache['eloHistory'][_0x4d112d(0x1aa)](_0x55960c,{'data':_0x4033a4[_0x5d0ff6],'timestamp':Date['now']()});});}catch(_0x31680d){console['error']('Error\x20fetching\x20batch\x20ELO\x20history:',_0x31680d);}}return _0x4033a4;}let usernameCache=new Map(),usernameCacheTimestamp=Date['now']();export function setupEfficientListener(_0x22421a,_0x49494a=[],_0xf6d6ba){const _0x31b33d=collection(db,_0x22421a),_0x21a60a=query(_0x31b33d,..._0x49494a),_0x1bd3c6=onSnapshot(_0x21a60a,_0x498119=>{const _0x351c2b=a56_0x5729,_0x36ac0e=_0x498119['docChanges']()['map'](_0x518f0f=>({'type':_0x518f0f['type'],'id':_0x518f0f['doc']['id'],'data':_0x518f0f['doc']['data']()}));_0x36ac0e[_0x351c2b(0x1b0)]>0x0&&_0xf6d6ba(_0x36ac0e,_0x498119[_0x351c2b(0x1ab)]);});return _0x1bd3c6;}export async function bulkResolveUsernames(_0x264a67){const _0x539416=a56_0x5729,_0x1e4d18=new Map();if(!_0x264a67||_0x264a67['length']===0x0)return _0x1e4d18;const _0x28332d=[_0x539416(0x1a2),'playersD2','playersD3','nonParticipants'];for(const _0x1fbafa of _0x28332d){const _0xe82a18=collection(db,_0x1fbafa),_0x1d742b=await getDocs(_0xe82a18);_0x1d742b[_0x539416(0x1b2)](_0x4a54a1=>{const _0x4696a5=_0x539416,_0x5d843c=_0x4a54a1['data']();_0x5d843c['username']&&_0x264a67[_0x4696a5(0x1ac)](_0x4a54a1['id'])&&_0x1e4d18['set'](_0x4a54a1['id'],_0x5d843c['username']);});}return _0x1e4d18;}
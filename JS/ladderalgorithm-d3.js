function a29_0x2a22(_0x4970b5,_0x1c5f34){const _0x43c96b=a29_0x2ecb();return a29_0x2a22=function(_0xd0f738,_0x1ea33d){_0xd0f738=_0xd0f738-0xa1;let _0x2ecb57=_0x43c96b[_0xd0f738];return _0x2ecb57;},a29_0x2a22(_0x4970b5,_0x1c5f34);}const a29_0xd0f738=(function(){let _0x1d5129=!![];return function(_0x3a4ac4,_0x27ca75){const _0x3f11e7=_0x1d5129?function(){if(_0x27ca75){const _0x45cb04=_0x27ca75['apply'](_0x3a4ac4,arguments);return _0x27ca75=null,_0x45cb04;}}:function(){};return _0x1d5129=![],_0x3f11e7;};}()),a29_0x43c96b=a29_0xd0f738(this,function(){const _0x2f9263=a29_0x2a22;let _0x4b5b2b;try{const _0x2031a5=Function('return\x20(function()\x20'+_0x2f9263(0xa1)+');');_0x4b5b2b=_0x2031a5();}catch(_0x5b7c43){_0x4b5b2b=window;}const _0x17eb83=_0x4b5b2b[_0x2f9263(0xb4)]=_0x4b5b2b['console']||{},_0xdfe302=[_0x2f9263(0xb7),_0x2f9263(0xb1),'info','error','exception','table',_0x2f9263(0xaf)];for(let _0x24c7e5=0x0;_0x24c7e5<_0xdfe302['length'];_0x24c7e5++){const _0x596074=a29_0xd0f738['constructor']['prototype']['bind'](a29_0xd0f738),_0x6b69b4=_0xdfe302[_0x24c7e5],_0x29bdd2=_0x17eb83[_0x6b69b4]||_0x596074;_0x596074[_0x2f9263(0xb8)]=a29_0xd0f738['bind'](a29_0xd0f738),_0x596074[_0x2f9263(0xb2)]=_0x29bdd2['toString']['bind'](_0x29bdd2),_0x17eb83[_0x6b69b4]=_0x596074;}});a29_0x43c96b();function a29_0x2ecb(){const _0xc4c096=['{}.constructor(\x22return\x20this\x22)(\x20)','exists','Starting\x20approveReportD3\x20function\x20with:','username','update','playersD3','data','uid','D3\x20Report\x20data:','D3\x20match\x20report\x20not\x20found','eloRating','approvedMatchesD3','position','email','trace','empty','warn','toString','loserUsername','console','MAX_SAFE_INTEGER','D3\x20Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions','log','__proto__'];a29_0x2ecb=function(){return _0xc4c096;};return a29_0x2ecb();}import{addDoc,updateDoc,serverTimestamp,collection,doc,getDoc,getDocs,query,where,setDoc,deleteDoc,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';import{recordEloChangeD3}from'./elo-history-d3.js';export function calculateEloD3(_0x1ee516,_0x33a294,_0x43b883=0x20){const _0x37f775=0x1/(0x1+Math['pow'](0xa,(_0x33a294-_0x1ee516)/0x190)),_0x315128=0x1/(0x1+Math['pow'](0xa,(_0x1ee516-_0x33a294)/0x190)),_0x2a46b7=_0x1ee516+_0x43b883*(0x1-_0x37f775),_0x11b490=_0x33a294+_0x43b883*(0x0-_0x315128);return{'newWinnerRating':Math['round'](_0x2a46b7),'newLoserRating':Math['round'](_0x11b490)};}export async function updateEloRatingsD3(_0x5386d6,_0x6b6b81,_0x4dbf7d){const _0x2545e7=a29_0x2a22;try{const _0x33a15f=writeBatch(db),_0x3dc507=doc(db,'playersD3',_0x5386d6),_0x5c1b8d=doc(db,_0x2545e7(0xa6),_0x6b6b81),[_0x4411ed,_0x563291]=await Promise['all']([getDoc(_0x3dc507),getDoc(_0x5c1b8d)]);if(!_0x4411ed['exists']()||!_0x563291['exists']())throw new Error('One\x20or\x20both\x20D3\x20players\x20not\x20found');const _0x22a831=_0x4411ed[_0x2545e7(0xa7)](),_0x2feeca=_0x563291['data'](),_0x802b3b=_0x22a831[_0x2545e7(0xad)]||Number[_0x2545e7(0xb5)],_0x57c7c5=_0x2feeca['position']||Number['MAX_SAFE_INTEGER'],{newWinnerRating:_0x4ab140,newLoserRating:_0x465806}=calculateEloD3(_0x22a831[_0x2545e7(0xab)]||0x4b0,_0x2feeca['eloRating']||0x4b0);let _0x143db3=_0x802b3b,_0x3c3ae8=_0x57c7c5;if(_0x802b3b>_0x57c7c5){console['log']('D3\x20Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked'),_0x143db3=_0x57c7c5,_0x3c3ae8=_0x57c7c5+0x1;const _0x5ddb48=query(collection(db,'playersD3'),where('position','>',_0x57c7c5),where(_0x2545e7(0xad),'<',_0x802b3b)),_0x1395b=await getDocs(_0x5ddb48);for(const _0x55cfd6 of _0x1395b['docs']){_0x55cfd6['id']!==_0x5386d6&&_0x55cfd6['id']!==_0x6b6b81&&_0x33a15f['update'](doc(db,'playersD3',_0x55cfd6['id']),{'position':_0x55cfd6['data']()['position']+0x1});}}else console[_0x2545e7(0xb7)](_0x2545e7(0xb6));return _0x33a15f[_0x2545e7(0xa5)](_0x3dc507,{'eloRating':_0x4ab140,'lastMatchDate':serverTimestamp(),'position':_0x143db3,'lastMatchId':_0x4dbf7d}),_0x33a15f['update'](_0x5c1b8d,{'eloRating':_0x465806,'lastMatchDate':serverTimestamp(),'position':_0x3c3ae8,'lastMatchId':_0x4dbf7d}),await _0x33a15f['commit'](),console['log']('D3\x20ELO\x20ratings\x20updated\x20successfully'),await Promise['all']([recordEloChangeD3({'playerId':_0x5386d6,'previousElo':_0x22a831['eloRating']||0x4b0,'newElo':_0x4ab140,'opponentId':_0x6b6b81,'matchResult':'win','previousPosition':_0x802b3b,'newPosition':_0x143db3,'isPromotion':_0x143db3<_0x802b3b,'matchId':_0x4dbf7d,'timestamp':serverTimestamp()}),recordEloChangeD3({'playerId':_0x6b6b81,'previousElo':_0x2feeca[_0x2545e7(0xab)]||0x4b0,'newElo':_0x465806,'opponentId':_0x5386d6,'matchResult':'loss','previousPosition':_0x57c7c5,'newPosition':_0x3c3ae8,'isDemotion':_0x3c3ae8>_0x57c7c5,'matchId':_0x4dbf7d,'timestamp':serverTimestamp()})]),!![];}catch(_0xc874bb){console['error']('Error\x20in\x20updateEloRatingsD3:',_0xc874bb);throw _0xc874bb;}}export async function approveReportD3(_0x54a1ad,_0x1e2455,_0x2b3812,_0x18760a){const _0x31e9ab=a29_0x2a22;try{console[_0x31e9ab(0xb7)](_0x31e9ab(0xa3),{'reportId':_0x54a1ad,'winnerScore':_0x1e2455,'winnerSuicides':_0x2b3812,'winnerComment':_0x18760a});const _0x22ba5e=auth['currentUser'];if(!_0x22ba5e){console['log']('No\x20user\x20logged\x20in');throw new Error('You\x20must\x20be\x20logged\x20in\x20to\x20approve\x20D3\x20matches');}console[_0x31e9ab(0xb7)]('Current\x20user:',_0x22ba5e[_0x31e9ab(0xae)]);const _0x2b4720=await getDoc(doc(db,_0x31e9ab(0xa6),_0x22ba5e[_0x31e9ab(0xa8)])),_0x26cf5a=_0x2b4720[_0x31e9ab(0xa2)]()?_0x2b4720['data']()[_0x31e9ab(0xa4)]:null;console[_0x31e9ab(0xb7)]('Current\x20username:',_0x26cf5a);const _0x55301c=doc(db,'pendingMatchesD3',_0x54a1ad),_0x3461c1=await getDoc(_0x55301c);if(!_0x3461c1[_0x31e9ab(0xa2)]()){console['log']('D3\x20Report\x20not\x20found\x20with\x20ID:',_0x54a1ad);throw new Error(_0x31e9ab(0xaa));}const _0xdadb00=_0x3461c1[_0x31e9ab(0xa7)]();console['log'](_0x31e9ab(0xa9),_0xdadb00);if(_0x26cf5a!==_0xdadb00['winnerUsername'])throw new Error('Only\x20the\x20winner\x20can\x20approve\x20D3\x20matches');const _0x1bea92={..._0xdadb00,'winnerScore':_0x1e2455,'winnerSuicides':_0x2b3812,'winnerComment':_0x18760a,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':_0x26cf5a,'createdAt':_0xdadb00['createdAt']||serverTimestamp(),'winnerUsername':_0xdadb00['winnerUsername'],'loserUsername':_0xdadb00[_0x31e9ab(0xb3)]};await setDoc(doc(db,_0x31e9ab(0xac),_0x54a1ad),_0x1bea92),await deleteDoc(_0x55301c),console['log']('D3\x20Match\x20moved\x20to\x20approved\x20collection');const [_0x5168e2,_0x463f39]=await Promise['all']([getDocs(query(collection(db,_0x31e9ab(0xa6)),where(_0x31e9ab(0xa4),'==',_0xdadb00['winnerUsername']))),getDocs(query(collection(db,'playersD3'),where('username','==',_0xdadb00['loserUsername'])))]);if(_0x5168e2[_0x31e9ab(0xb0)]||_0x463f39['empty'])throw new Error('Could\x20not\x20find\x20D3\x20player\x20documents');const _0x5bf8ad=_0x5168e2['docs'][0x0]['id'],_0x13b268=_0x463f39['docs'][0x0]['id'];return await updateEloRatingsD3(_0x5bf8ad,_0x13b268,_0x54a1ad),console['log']('D3\x20Match\x20successfully\x20approved\x20and\x20ELO\x20updated'),!![];}catch(_0x2cd93f){console['error']('Error\x20in\x20approveReportD3:',_0x2cd93f);throw _0x2cd93f;}}
const a12_0x780c19=(function(){let _0x5be2d8=!![];return function(_0x2fe7c2,_0x51d39f){const _0x1edee0=_0x5be2d8?function(){if(_0x51d39f){const _0x4ce90a=_0x51d39f['apply'](_0x2fe7c2,arguments);return _0x51d39f=null,_0x4ce90a;}}:function(){};return _0x5be2d8=![],_0x1edee0;};}()),a12_0x4fe8d8=a12_0x780c19(this,function(){const _0xa71fb9=a12_0x27cf;let _0x474944;try{const _0x442c41=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x474944=_0x442c41();}catch(_0x12f010){_0x474944=window;}const _0x285c29=_0x474944['console']=_0x474944[_0xa71fb9(0x12b)]||{},_0x58970f=['log','warn','info','error','exception','table','trace'];for(let _0x1a519d=0x0;_0x1a519d<_0x58970f['length'];_0x1a519d++){const _0x684f09=a12_0x780c19[_0xa71fb9(0x11a)][_0xa71fb9(0x117)]['bind'](a12_0x780c19),_0x54641e=_0x58970f[_0x1a519d],_0x25067b=_0x285c29[_0x54641e]||_0x684f09;_0x684f09[_0xa71fb9(0x126)]=a12_0x780c19['bind'](a12_0x780c19),_0x684f09[_0xa71fb9(0x10b)]=_0x25067b['toString']['bind'](_0x25067b),_0x285c29[_0x54641e]=_0x684f09;}});a12_0x4fe8d8();function a12_0x2af9(){const _0x4897a1=['forEach','block','toUserId','admin','now','data','creative\x20lead','map','split','isAdmin','click','toString','style','none','join','inbox-notification','roleName','role','error','pending','size','User','filter','prototype','\x20in\x20','display','constructor','players','username','catch','Error\x20in\x20checkAdminRoles:','currentUser','preventDefault','getElementById','hasCheckedCollections','toUpperCase','toLowerCase','email','__proto__','log','uid','innerHTML','a[href]','console'];a12_0x2af9=function(){return _0x4897a1;};return a12_0x2af9();}import{getAuth,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{doc,getDoc,collection,query,where,getDocs,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import{isAdmin}from'./admin-check.js';const ADMIN_EMAILS=['admin@ladder.com','Brian2af@outlook.com'],userCache={'uid':null,'username':null,'isAdmin':![],'hasCheckedCollections':![],'lastChecked':0x0,'role':null},invitationCache={'lastCheck':0x0,'pendingCount':0x0,'checkInterval':0x493e0};function updateInboxNotification(_0x2c4b3b){const _0xcb4ab6=a12_0x27cf,_0x5c06a2=document['getElementById'](_0xcb4ab6(0x10f));_0x5c06a2&&(_0x2c4b3b>0x0?(_0x5c06a2['style'][_0xcb4ab6(0x119)]='inline-block',_0x5c06a2['textContent']=_0x2c4b3b>0x9?'9+':_0x2c4b3b):_0x5c06a2[_0xcb4ab6(0x10c)]['display']='none');}async function checkPendingInvitationsForCurrentUser(_0x182754){const _0x5240b6=a12_0x27cf;try{const _0x5b250a=Date[_0x5240b6(0x104)]();if(_0x5b250a-invitationCache['lastCheck']<invitationCache['checkInterval'])return updateInboxNotification(invitationCache['pendingCount']),invitationCache['pendingCount'];invitationCache['lastCheck']=_0x5b250a;const _0x222c2b=collection(db,'gameInvitations'),_0x1a1815=query(_0x222c2b,where(_0x5240b6(0x102),'==',_0x182754),where('status','==',_0x5240b6(0x113)),limit(0x5)),_0x4b7e70=await getDocs(_0x1a1815),_0x351cf4=_0x4b7e70[_0x5240b6(0x114)];return invitationCache['pendingCount']=_0x351cf4,updateInboxNotification(_0x351cf4),_0x351cf4;}catch(_0x2c2538){return console['warn']('Could\x20not\x20check\x20pending\x20invitations\x20for\x20current\x20user:',_0x2c2538),0x0;}}function updateAuthSectionImmediate(_0x412da3,_0x3489dd=![]){const _0x3fc52d=a12_0x27cf,_0x40c951=document[_0x3fc52d(0x121)]('auth-section');if(!_0x40c951)return;if(_0x412da3&&_0x3489dd)document['querySelectorAll']('.admin-only')['forEach'](_0x38c88d=>{const _0x3464cf=_0x3fc52d;_0x38c88d['style']['display']=_0x3464cf(0x101);});else!_0x412da3&&document['querySelectorAll']('.admin-only')[_0x3fc52d(0x100)](_0x30cdaf=>{const _0x45e651=_0x3fc52d;_0x30cdaf['style']['display']=_0x45e651(0x10d);});if(_0x412da3){const _0x543689=userCache[_0x3fc52d(0x11c)]||(_0x412da3[_0x3fc52d(0x125)]?_0x412da3['email'][_0x3fc52d(0x108)]('@')[0x0]:_0x3fc52d(0x115)),_0x510a2b=userCache[_0x3fc52d(0x111)]?'\x20('+userCache['role']+')':_0x3489dd?'\x20(Admin)':'';_0x40c951[_0x3fc52d(0x129)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20class=\x22nav-username\x22>'+_0x543689+_0x510a2b+'</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username='+encodeURIComponent(_0x543689)+'\x22>Profile</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./inbox.html\x22\x20class=\x22nav-notification\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Inbox\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22inbox-notification\x22\x20class=\x22notification-dot\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22members.html\x22>Members</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./redeem.html\x22><i\x20class=\x22fas\x20fa-gift\x22></i>\x20Redeem</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20id=\x22logout-link\x22>Sign\x20Out</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';const _0x751d81=document[_0x3fc52d(0x121)]('logout-link');_0x751d81&&_0x751d81['addEventListener'](_0x3fc52d(0x10a),_0x145cd6=>{const _0x440669=_0x3fc52d;_0x145cd6[_0x440669(0x120)]();const _0x80d75d=getAuth();updateAuthSectionImmediate(null),_0x80d75d['signOut']()['catch'](_0x44eb5a=>{console['error']('Error\x20signing\x20out:',_0x44eb5a);});}),_0x412da3[_0x3fc52d(0x128)]&&setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0x412da3['uid']);},0x3e8);}else _0x40c951['innerHTML']='<a\x20href=\x22login.html\x22\x20class=\x22login-link\x22>Login</a>';}function a12_0x27cf(_0x7fa205,_0x191b03){const _0x4fe8d8=a12_0x2af9();return a12_0x27cf=function(_0x780c19,_0xcb7d36){_0x780c19=_0x780c19-0x100;let _0x2af9df=_0x4fe8d8[_0x780c19];return _0x2af9df;},a12_0x27cf(_0x7fa205,_0x191b03);}async function checkAdminRoles(_0x14184e){const _0x390360=a12_0x27cf;if(!_0x14184e||!_0x14184e['email'])return{'isAdmin':![],'role':null};try{console['log']('Checking\x20roles\x20for\x20user:\x20'+_0x14184e['email']);const _0x145f58=[_0x390360(0x11b),'playersD2','playersD3','nonParticipants','userProfiles'],_0x41ac80=['council',_0x390360(0x106),'owner',_0x390360(0x103)];for(const _0x687cdc of _0x145f58){try{const _0xf56c1=doc(db,_0x687cdc,_0x14184e[_0x390360(0x128)]),_0x41e3b8=await getDoc(_0xf56c1);if(_0x41e3b8['exists']()){const _0x28623b=_0x41e3b8['data']();console['log']('Found\x20user\x20in\x20'+_0x687cdc+'\x20by\x20UID:',_0x28623b);let _0x57f949=(_0x28623b['roleName']||_0x28623b['role']||'')[_0x390360(0x124)](),_0x3c1e88=_0x28623b['roleName']||_0x28623b['role']||'';if(_0x57f949&&_0x41ac80['includes'](_0x57f949)){console['log']('Found\x20admin\x20role:\x20'+_0x57f949+'\x20in\x20'+_0x687cdc);const _0x153b0e=_0x3c1e88['split']('\x20')['map'](_0x4280cf=>_0x4280cf['charAt'](0x0)['toUpperCase']()+_0x4280cf['slice'](0x1)['toLowerCase']())[_0x390360(0x10e)]('\x20');return{'isAdmin':!![],'role':_0x153b0e};}}}catch(_0x4dcea2){console['error']('Error\x20checking\x20'+_0x687cdc+'\x20by\x20UID:',_0x4dcea2);}}for(const _0x3a4f6f of _0x145f58){try{const _0x48ee17=collection(db,_0x3a4f6f);let _0x14696a=query(_0x48ee17,where('email','==',_0x14184e['email'])),_0x1b2269=await getDocs(_0x14696a);_0x1b2269['empty']&&(_0x14696a=query(_0x48ee17,where(_0x390360(0x125),'==',_0x14184e['email']['toLowerCase']())),_0x1b2269=await getDocs(_0x14696a));if(!_0x1b2269['empty']){const _0x3066c6=_0x1b2269['docs'][0x0]['data']();console['log']('Found\x20user\x20in\x20'+_0x3a4f6f+'\x20by\x20email:',_0x3066c6);let _0x22167a=(_0x3066c6['roleName']||_0x3066c6[_0x390360(0x111)]||'')[_0x390360(0x124)](),_0x332456=_0x3066c6[_0x390360(0x110)]||_0x3066c6['role']||'';if(_0x22167a&&_0x41ac80['includes'](_0x22167a)){console[_0x390360(0x127)]('Found\x20admin\x20role:\x20'+_0x22167a+_0x390360(0x118)+_0x3a4f6f);const _0x1aea6b=_0x332456[_0x390360(0x108)]('\x20')['map'](_0x4286eb=>_0x4286eb['charAt'](0x0)[_0x390360(0x123)]()+_0x4286eb['slice'](0x1)[_0x390360(0x124)]())['join']('\x20');return{'isAdmin':!![],'role':_0x1aea6b};}}}catch(_0x3ac914){console[_0x390360(0x112)]('Error\x20checking\x20'+_0x3a4f6f+'\x20by\x20email:',_0x3ac914);}}return console['log']('No\x20admin\x20roles\x20found\x20for\x20user'),{'isAdmin':![],'role':null};}catch(_0x4182f3){return console[_0x390360(0x112)](_0x390360(0x11e),_0x4182f3),{'isAdmin':![],'role':null};}}async function updateAuthSection(_0x44521a){const _0x524dd7=a12_0x27cf,_0xe77587=_0x44521a&&isAdmin(_0x44521a['email']);updateAuthSectionImmediate(_0x44521a,_0xe77587);if(!_0x44521a){userCache[_0x524dd7(0x128)]=null,userCache['username']=null,userCache['isAdmin']=![],userCache['hasCheckedCollections']=![],userCache['role']=null;return;}const _0x47e8ed=Date[_0x524dd7(0x104)]();if(_0x44521a['uid']===userCache['uid']&&userCache[_0x524dd7(0x122)]&&_0x47e8ed-userCache['lastChecked']<0x493e0)return;try{userCache['uid']=_0x44521a[_0x524dd7(0x128)],userCache['lastChecked']=_0x47e8ed;const _0x41d26a=isAdmin(_0x44521a[_0x524dd7(0x125)]);userCache['isAdmin']=_0x41d26a;if(!_0x41d26a){const {isAdmin:_0x375096,role:_0x20749e}=await checkAdminRoles(_0x44521a);userCache['isAdmin']=_0x375096,userCache['role']=_0x20749e,_0x375096&&(document['querySelectorAll']('.admin-only')['forEach'](_0x2be47c=>{_0x2be47c['style']['display']='block';}),updateAuthSectionImmediate(_0x44521a,!![]));}const _0x3f95e2=['players','playersD2','playersD3','playersDuos','playersCTF','nonParticipants','userProfiles'],_0x28df92=_0x3f95e2[_0x524dd7(0x107)](_0x55d118=>getDoc(doc(db,_0x55d118,_0x44521a['uid']))['then'](_0x18c643=>_0x18c643['exists']()?{'collection':_0x55d118,'data':_0x18c643['data']()}:null)[_0x524dd7(0x11d)](()=>null)),_0x4b21f2=await Promise['all'](_0x28df92),_0x439e12=_0x4b21f2[_0x524dd7(0x116)](_0x24090e=>_0x24090e!==null);let _0x3c3a5f=null;for(const _0x53e488 of _0x439e12){if(_0x53e488[_0x524dd7(0x105)]['username']){_0x3c3a5f=_0x53e488['data']['username'];break;}}userCache['username']=_0x3c3a5f||(_0x44521a['email']?_0x44521a['email'][_0x524dd7(0x108)]('@')[0x0]:'User'),userCache['hasCheckedCollections']=!![],updateAuthSectionImmediate(_0x44521a,userCache[_0x524dd7(0x109)]),setTimeout(()=>{const _0xf1e343=_0x524dd7;checkPendingInvitationsForCurrentUser(_0x44521a[_0xf1e343(0x128)]);},0x1f4);}catch(_0x173662){console['error']('Error\x20in\x20full\x20auth\x20update:',_0x173662);}}document['addEventListener']('DOMContentLoaded',()=>{const _0x51b999=getAuth();onAuthStateChanged(_0x51b999,async _0x4fe577=>{await updateAuthSection(_0x4fe577),_0x4fe577&&checkPendingInvitationsForCurrentUser(_0x4fe577['uid']);}),document['addEventListener']('visibilitychange',()=>{const _0x435c67=a12_0x27cf;!document['hidden']&&_0x51b999[_0x435c67(0x11f)]&&checkPendingInvitationsForCurrentUser(_0x51b999['currentUser'][_0x435c67(0x128)]);}),document['addEventListener']('click',_0x3adf4d=>{const _0x251e86=a12_0x27cf;_0x3adf4d['target']['closest'](_0x251e86(0x12a))&&_0x51b999['currentUser']&&checkPendingInvitationsForCurrentUser(_0x51b999[_0x251e86(0x11f)]['uid']);});});export{updateAuthSection};
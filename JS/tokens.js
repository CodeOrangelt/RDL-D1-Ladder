const a52_0x111b50=(function(){let _0x46184c=!![];return function(_0x2c7634,_0x81bdd4){const _0x4b5786=_0x46184c?function(){const _0x4434b3=a52_0x16ef;if(_0x81bdd4){const _0x35e3ff=_0x81bdd4[_0x4434b3(0x78)](_0x2c7634,arguments);return _0x81bdd4=null,_0x35e3ff;}}:function(){};return _0x46184c=![],_0x4b5786;};}()),a52_0x5728b7=a52_0x111b50(this,function(){const _0x135539=a52_0x16ef,_0x31ec1a=function(){let _0x39465c;try{_0x39465c=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x1d2e13){_0x39465c=window;}return _0x39465c;},_0x54949d=_0x31ec1a(),_0x2c5c7e=_0x54949d[_0x135539(0x7a)]=_0x54949d[_0x135539(0x7a)]||{},_0x40f9a8=[_0x135539(0x7d),'warn','info','error',_0x135539(0x77),_0x135539(0x6d),'trace'];for(let _0x1048a9=0x0;_0x1048a9<_0x40f9a8['length'];_0x1048a9++){const _0x33db3d=a52_0x111b50[_0x135539(0x74)]['prototype']['bind'](a52_0x111b50),_0x328e36=_0x40f9a8[_0x1048a9],_0xa5a40f=_0x2c5c7e[_0x328e36]||_0x33db3d;_0x33db3d[_0x135539(0x70)]=a52_0x111b50[_0x135539(0x72)](a52_0x111b50),_0x33db3d['toString']=_0xa5a40f[_0x135539(0x7e)]['bind'](_0xa5a40f),_0x2c5c7e[_0x328e36]=_0x33db3d;}});a52_0x5728b7();function a52_0x16ef(_0x53c4ab,_0x2e75cc){const _0x5728b7=a52_0x2f41();return a52_0x16ef=function(_0x111b50,_0x366a5b){_0x111b50=_0x111b50-0x6b;let _0x2f41df=_0x5728b7[_0x111b50];return _0x2f41df;},a52_0x16ef(_0x53c4ab,_0x2e75cc);}function a52_0x2f41(){const _0x321b7f=['forEach','now','table','error','purchasedAt','__proto__','values','bind','timestamp','constructor','getTime','all','exception','apply','Error\x20fetching\x20user\x20tokens:','console','set','delete','log','toString','get','tokens'];a52_0x2f41=function(){return _0x321b7f;};return a52_0x2f41();}import{doc,getDoc,getDocs,collection}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const tokenCache=new Map(),CACHE_DURATION=0x5*0x3c*0x3e8;export async function getUserTokens(_0x15f825){const _0xca2622=a52_0x16ef,_0x123506='tokens_'+_0x15f825,_0x28951c=tokenCache[_0xca2622(0x7f)](_0x123506);if(_0x28951c&&Date[_0xca2622(0x6c)]()-_0x28951c['timestamp']<CACHE_DURATION)return _0x28951c[_0xca2622(0x80)];try{const _0x359246=doc(db,'userTokens',_0x15f825),_0x14b3df=await getDoc(_0x359246);let _0x256c7c=[];return _0x14b3df['exists']()&&(_0x256c7c=_0x14b3df['data']()[_0xca2622(0x80)]||[]),tokenCache['set'](_0x123506,{'tokens':_0x256c7c,'timestamp':Date['now']()}),_0x256c7c;}catch(_0x4d4068){return console['error'](_0xca2622(0x79),_0x4d4068),[];}}export async function getBulkUserTokens(_0x5eb894){const _0x33b948=a52_0x16ef,_0x15d73d=new Map(),_0x1490df=[];_0x5eb894[_0x33b948(0x6b)](_0xc2100f=>{const _0x5063ab=_0x33b948,_0xf35b66='tokens_'+_0xc2100f,_0x28d0e9=tokenCache[_0x5063ab(0x7f)](_0xf35b66);_0x28d0e9&&Date['now']()-_0x28d0e9[_0x5063ab(0x73)]<CACHE_DURATION?_0x15d73d['set'](_0xc2100f,_0x28d0e9[_0x5063ab(0x80)]):_0x1490df['push'](_0xc2100f);});if(_0x1490df['length']>0x0)try{const _0x25500e=_0x1490df['map'](async _0x364700=>{const _0x4cc00a=doc(db,'userTokens',_0x364700),_0x141fb7=await getDoc(_0x4cc00a);let _0x111956=[];_0x141fb7['exists']()&&(_0x111956=_0x141fb7['data']()['tokens']||[]);const _0x455291='tokens_'+_0x364700;return tokenCache['set'](_0x455291,{'tokens':_0x111956,'timestamp':Date['now']()}),[_0x364700,_0x111956];}),_0x10a7f3=await Promise[_0x33b948(0x76)](_0x25500e);_0x10a7f3['forEach'](([_0x4816b6,_0x2bf019])=>{_0x15d73d['set'](_0x4816b6,_0x2bf019);});}catch(_0x22842e){console['error']('Error\x20fetching\x20bulk\x20user\x20tokens:',_0x22842e);}return _0x15d73d;}export async function getTokensByUsernames(_0xadfefc){const _0x597219=a52_0x16ef,_0x2e9b73=new Map();try{const _0x42b837=collection(db,'userProfiles'),_0x547c0e=await getDocs(_0x42b837),_0x2a9b72=new Map();_0x547c0e['forEach'](_0x513ab4=>{const _0x55a9cb=_0x513ab4['data']();_0x55a9cb['username']&&_0xadfefc['includes'](_0x55a9cb['username'])&&_0x2a9b72['set'](_0x55a9cb['username'],_0x513ab4['id']);});const _0x457c56=Array['from'](_0x2a9b72[_0x597219(0x71)]());if(_0x457c56['length']>0x0){const _0x518b0f=await getBulkUserTokens(_0x457c56);_0x2a9b72[_0x597219(0x6b)]((_0x2e3e17,_0x2f7a0f)=>{const _0x177eea=_0x597219,_0x5c8398=_0x518b0f['get'](_0x2e3e17)||[];_0x2e9b73[_0x177eea(0x7b)](_0x2f7a0f,_0x5c8398);});}}catch(_0x4f06c1){console[_0x597219(0x6e)]('Error\x20fetching\x20tokens\x20by\x20usernames:',_0x4f06c1);}return _0x2e9b73;}export function clearTokenCache(_0x37b4cd=null){const _0x5b73a5=a52_0x16ef;if(_0x37b4cd){const _0x1b121c='tokens_'+_0x37b4cd;tokenCache[_0x5b73a5(0x7c)](_0x1b121c),console['log']('ðŸ—‘ï¸\x20Cleared\x20token\x20cache\x20for\x20user:\x20'+_0x37b4cd);}else tokenCache['clear'](),console['log']('ðŸ—‘ï¸\x20Cleared\x20all\x20token\x20cache');}export async function forceRefreshUserTokens(_0x4eeb0c){return clearTokenCache(_0x4eeb0c),await getUserTokens(_0x4eeb0c);}export function getPrimaryDisplayToken(_0x2f366a){if(!_0x2f366a||_0x2f366a['length']===0x0)return null;const _0x5e84e1=_0x2f366a['find'](_0x86e308=>_0x86e308['equipped']===!![]);if(_0x5e84e1)return _0x5e84e1;const _0x530010=[..._0x2f366a]['sort']((_0x371113,_0x28d3f1)=>{const _0x11a92e=a52_0x16ef;let _0x57f0d0,_0x1276b1;if(_0x371113[_0x11a92e(0x6f)]){if(_0x371113[_0x11a92e(0x6f)]['seconds'])_0x57f0d0=_0x371113['purchasedAt']['seconds'];else{if(_0x371113[_0x11a92e(0x6f)]instanceof Date)_0x57f0d0=_0x371113['purchasedAt']['getTime']()/0x3e8;else typeof _0x371113[_0x11a92e(0x6f)]==='string'?_0x57f0d0=new Date(_0x371113['purchasedAt'])[_0x11a92e(0x75)]()/0x3e8:_0x57f0d0=0x0;}}else _0x57f0d0=0x0;if(_0x28d3f1['purchasedAt']){if(_0x28d3f1['purchasedAt']['seconds'])_0x1276b1=_0x28d3f1['purchasedAt']['seconds'];else{if(_0x28d3f1['purchasedAt']instanceof Date)_0x1276b1=_0x28d3f1['purchasedAt']['getTime']()/0x3e8;else typeof _0x28d3f1['purchasedAt']==='string'?_0x1276b1=new Date(_0x28d3f1[_0x11a92e(0x6f)])[_0x11a92e(0x75)]()/0x3e8:_0x1276b1=0x0;}}else _0x1276b1=0x0;return _0x1276b1-_0x57f0d0;});return _0x530010[0x0];}
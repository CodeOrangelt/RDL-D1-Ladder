const a12_0x18bfbc=a12_0x4a54,a12_0x1e4585=(function(){let _0x19c00=!![];return function(_0x24ca06,_0x214b18){const _0x1ef8c0=_0x19c00?function(){if(_0x214b18){const _0x16e57d=_0x214b18['apply'](_0x24ca06,arguments);return _0x214b18=null,_0x16e57d;}}:function(){};return _0x19c00=![],_0x1ef8c0;};}()),a12_0x5e53ce=a12_0x1e4585(this,function(){const _0x2f142e=a12_0x4a54;let _0x45785b;try{const _0x39d2fe=Function(_0x2f142e(0x12c)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x45785b=_0x39d2fe();}catch(_0x27a793){_0x45785b=window;}const _0x2d2425=_0x45785b[_0x2f142e(0x136)]=_0x45785b[_0x2f142e(0x136)]||{},_0x337acc=['log','warn','info',_0x2f142e(0x131),'exception',_0x2f142e(0x13a),'trace'];for(let _0x2f90ac=0x0;_0x2f90ac<_0x337acc['length'];_0x2f90ac++){const _0x1675d0=a12_0x1e4585[_0x2f142e(0x142)]['prototype'][_0x2f142e(0x129)](a12_0x1e4585),_0x28c2aa=_0x337acc[_0x2f90ac],_0xfc5ebf=_0x2d2425[_0x28c2aa]||_0x1675d0;_0x1675d0['__proto__']=a12_0x1e4585['bind'](a12_0x1e4585),_0x1675d0['toString']=_0xfc5ebf['toString']['bind'](_0xfc5ebf),_0x2d2425[_0x28c2aa]=_0x1675d0;}});a12_0x5e53ce();import{getAuth,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{doc,getDoc,collection,query,where,getDocs,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';function a12_0x4a54(_0x412bb6,_0x3c28b4){const _0x5e53ce=a12_0x1cad();return a12_0x4a54=function(_0x1e4585,_0x1bda50){_0x1e4585=_0x1e4585-0x119;let _0x1cada4=_0x5e53ce[_0x1e4585];return _0x1cada4;},a12_0x4a54(_0x412bb6,_0x3c28b4);}import{isAdmin}from'./admin-check.js';const ADMIN_EMAILS=['admin@ladder.com','Brian2af@outlook.com'],userCache={'uid':null,'username':null,'isAdmin':![],'hasCheckedCollections':![],'lastChecked':0x0,'role':null},invitationCache={'lastCheck':0x0,'pendingCount':0x0,'checkInterval':0x493e0};function updateInboxNotification(_0x10bc9f){const _0x5f3a4a=a12_0x4a54,_0x1a18c6=document[_0x5f3a4a(0x138)]('inbox-notification');_0x1a18c6&&(_0x10bc9f>0x0?(_0x1a18c6['style']['display']=_0x5f3a4a(0x145),_0x1a18c6['textContent']=_0x10bc9f>0x9?'9+':_0x10bc9f):_0x1a18c6['style']['display']='none');}async function checkPendingInvitationsForCurrentUser(_0x24a395){const _0x437489=a12_0x4a54;try{const _0x2ce62b=Date[_0x437489(0x13c)]();if(_0x2ce62b-invitationCache['lastCheck']<invitationCache['checkInterval'])return updateInboxNotification(invitationCache['pendingCount']),invitationCache['pendingCount'];invitationCache[_0x437489(0x11b)]=_0x2ce62b;const _0x164d6d=collection(db,'gameInvitations'),_0x28ee2c=query(_0x164d6d,where(_0x437489(0x12d),'==',_0x24a395),where(_0x437489(0x12e),'==','pending'),limit(0x5)),_0x27ce36=await getDocs(_0x28ee2c),_0x493cb0=_0x27ce36['size'];return invitationCache['pendingCount']=_0x493cb0,updateInboxNotification(_0x493cb0),_0x493cb0;}catch(_0x27e509){return console[_0x437489(0x140)]('Could\x20not\x20check\x20pending\x20invitations\x20for\x20current\x20user:',_0x27e509),0x0;}}function a12_0x1cad(){const _0x702599=['</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username=','hasCheckedCollections','lastCheck','uid','display','owner','email','signOut','join','playersDuos','\x20(Admin)','<a\x20href=\x22login.html\x22\x20class=\x22login-link\x22>Login</a>','Error\x20in\x20full\x20auth\x20update:','isAdmin','role','toLowerCase','bind','visibilitychange','Checking\x20roles\x20for\x20user:\x20','return\x20(function()\x20','toUserId','status','DOMContentLoaded','log','error','\x20by\x20email:','addEventListener','currentUser','block','console','Error\x20signing\x20out:','getElementById','playersD3','table','Found\x20admin\x20role:\x20','now','empty','data','username','warn','toUpperCase','constructor','auth-section','docs','inline-block','exists','click','players','userProfiles','preventDefault'];a12_0x1cad=function(){return _0x702599;};return a12_0x1cad();}function updateAuthSectionImmediate(_0xd6706,_0x10d2ac=![]){const _0x1aa850=a12_0x4a54,_0xd3e1a=document[_0x1aa850(0x138)](_0x1aa850(0x143));if(!_0xd3e1a)return;if(_0xd6706&&_0x10d2ac)document['querySelectorAll']('.admin-only')['forEach'](_0x16ddca=>{const _0x339f00=_0x1aa850;_0x16ddca['style']['display']=_0x339f00(0x135);});else!_0xd6706&&document['querySelectorAll']('.admin-only')['forEach'](_0x48802b=>{const _0x185e20=_0x1aa850;_0x48802b['style'][_0x185e20(0x11d)]='none';});if(_0xd6706){const _0x507727=userCache['username']||(_0xd6706['email']?_0xd6706['email']['split']('@')[0x0]:'User'),_0x1a3c03=userCache['role']?'\x20('+userCache['role']+')':_0x10d2ac?_0x1aa850(0x123):'';_0xd3e1a['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20class=\x22nav-username\x22>'+_0x507727+_0x1a3c03+_0x1aa850(0x119)+encodeURIComponent(_0x507727)+'\x22>Profile</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./inbox.html\x22\x20class=\x22nav-notification\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Inbox\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22inbox-notification\x22\x20class=\x22notification-dot\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22members.html\x22>Members</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./redeem.html\x22><i\x20class=\x22fas\x20fa-gift\x22></i>\x20Redeem</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20id=\x22logout-link\x22>Sign\x20Out</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';const _0x330c75=document['getElementById']('logout-link');_0x330c75&&_0x330c75['addEventListener']('click',_0x5f0c65=>{const _0x4bdc8f=_0x1aa850;_0x5f0c65[_0x4bdc8f(0x14a)]();const _0x4fdb43=getAuth();updateAuthSectionImmediate(null),_0x4fdb43[_0x4bdc8f(0x120)]()['catch'](_0x1aa3eb=>{const _0x3d8080=_0x4bdc8f;console['error'](_0x3d8080(0x137),_0x1aa3eb);});}),_0xd6706['uid']&&setTimeout(()=>{const _0x2bd8f7=_0x1aa850;checkPendingInvitationsForCurrentUser(_0xd6706[_0x2bd8f7(0x11c)]);},0x3e8);}else _0xd3e1a['innerHTML']=_0x1aa850(0x124);}async function checkAdminRoles(_0x1e6778){const _0x53b311=a12_0x4a54;if(!_0x1e6778||!_0x1e6778[_0x53b311(0x11f)])return{'isAdmin':![],'role':null};try{console['log'](_0x53b311(0x12b)+_0x1e6778[_0x53b311(0x11f)]);const _0x2bfeee=[_0x53b311(0x148),'playersD2','playersD3','nonParticipants','userProfiles'],_0x5f370e=['council','creative\x20lead',_0x53b311(0x11e),'admin'];for(const _0x2b1d67 of _0x2bfeee){try{const _0x2051d6=doc(db,_0x2b1d67,_0x1e6778['uid']),_0x166201=await getDoc(_0x2051d6);if(_0x166201['exists']()){const _0x2bba08=_0x166201[_0x53b311(0x13e)]();console[_0x53b311(0x130)]('Found\x20user\x20in\x20'+_0x2b1d67+'\x20by\x20UID:',_0x2bba08);let _0x5e6c17=(_0x2bba08['roleName']||_0x2bba08[_0x53b311(0x127)]||'')[_0x53b311(0x128)](),_0x3a6494=_0x2bba08['roleName']||_0x2bba08['role']||'';if(_0x5e6c17&&_0x5f370e['includes'](_0x5e6c17)){console['log'](_0x53b311(0x13b)+_0x5e6c17+'\x20in\x20'+_0x2b1d67);const _0x3bf7e3=_0x3a6494['split']('\x20')['map'](_0x5e8826=>_0x5e8826['charAt'](0x0)[_0x53b311(0x141)]()+_0x5e8826['slice'](0x1)['toLowerCase']())[_0x53b311(0x121)]('\x20');return{'isAdmin':!![],'role':_0x3bf7e3};}}}catch(_0xe25858){console['error']('Error\x20checking\x20'+_0x2b1d67+'\x20by\x20UID:',_0xe25858);}}for(const _0x52fa98 of _0x2bfeee){try{const _0x43d70b=collection(db,_0x52fa98);let _0x462bb0=query(_0x43d70b,where(_0x53b311(0x11f),'==',_0x1e6778['email'])),_0x144d84=await getDocs(_0x462bb0);_0x144d84['empty']&&(_0x462bb0=query(_0x43d70b,where('email','==',_0x1e6778['email']['toLowerCase']())),_0x144d84=await getDocs(_0x462bb0));if(!_0x144d84[_0x53b311(0x13d)]){const _0x27d217=_0x144d84[_0x53b311(0x144)][0x0]['data']();console[_0x53b311(0x130)]('Found\x20user\x20in\x20'+_0x52fa98+'\x20by\x20email:',_0x27d217);let _0x42d1dd=(_0x27d217['roleName']||_0x27d217['role']||'')['toLowerCase'](),_0x3aff04=_0x27d217['roleName']||_0x27d217[_0x53b311(0x127)]||'';if(_0x42d1dd&&_0x5f370e['includes'](_0x42d1dd)){console['log']('Found\x20admin\x20role:\x20'+_0x42d1dd+'\x20in\x20'+_0x52fa98);const _0x3a4eca=_0x3aff04['split']('\x20')['map'](_0x177626=>_0x177626['charAt'](0x0)['toUpperCase']()+_0x177626['slice'](0x1)['toLowerCase']())['join']('\x20');return{'isAdmin':!![],'role':_0x3a4eca};}}}catch(_0x26cdcc){console['error']('Error\x20checking\x20'+_0x52fa98+_0x53b311(0x132),_0x26cdcc);}}return console[_0x53b311(0x130)]('No\x20admin\x20roles\x20found\x20for\x20user'),{'isAdmin':![],'role':null};}catch(_0x54e890){return console[_0x53b311(0x131)]('Error\x20in\x20checkAdminRoles:',_0x54e890),{'isAdmin':![],'role':null};}}async function updateAuthSection(_0x4f1dc9){const _0x58980f=a12_0x4a54,_0x3f6659=_0x4f1dc9&&isAdmin(_0x4f1dc9[_0x58980f(0x11f)]);updateAuthSectionImmediate(_0x4f1dc9,_0x3f6659);if(!_0x4f1dc9){userCache['uid']=null,userCache['username']=null,userCache[_0x58980f(0x126)]=![],userCache[_0x58980f(0x11a)]=![],userCache['role']=null;return;}const _0x334894=Date['now']();if(_0x4f1dc9[_0x58980f(0x11c)]===userCache[_0x58980f(0x11c)]&&userCache['hasCheckedCollections']&&_0x334894-userCache['lastChecked']<0x493e0)return;try{userCache['uid']=_0x4f1dc9['uid'],userCache['lastChecked']=_0x334894;const _0x5c7232=isAdmin(_0x4f1dc9[_0x58980f(0x11f)]);userCache['isAdmin']=_0x5c7232;if(!_0x5c7232){const {isAdmin:_0x17edb7,role:_0x5430d9}=await checkAdminRoles(_0x4f1dc9);userCache['isAdmin']=_0x17edb7,userCache['role']=_0x5430d9,_0x17edb7&&(document['querySelectorAll']('.admin-only')['forEach'](_0x2f07a6=>{_0x2f07a6['style']['display']='block';}),updateAuthSectionImmediate(_0x4f1dc9,!![]));}const _0xecfed5=['players','playersD2',_0x58980f(0x139),_0x58980f(0x122),'playersCTF','nonParticipants',_0x58980f(0x149)],_0x4850d3=_0xecfed5['map'](_0x4a01a5=>getDoc(doc(db,_0x4a01a5,_0x4f1dc9[_0x58980f(0x11c)]))['then'](_0x473a6a=>_0x473a6a[_0x58980f(0x146)]()?{'collection':_0x4a01a5,'data':_0x473a6a['data']()}:null)['catch'](()=>null)),_0x5a805d=await Promise['all'](_0x4850d3),_0x126cb7=_0x5a805d['filter'](_0x573118=>_0x573118!==null);let _0x111384=null;for(const _0x132cdc of _0x126cb7){if(_0x132cdc['data']['username']){_0x111384=_0x132cdc['data'][_0x58980f(0x13f)];break;}}userCache['username']=_0x111384||(_0x4f1dc9['email']?_0x4f1dc9['email']['split']('@')[0x0]:'User'),userCache['hasCheckedCollections']=!![],updateAuthSectionImmediate(_0x4f1dc9,userCache['isAdmin']),setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0x4f1dc9['uid']);},0x1f4);}catch(_0x1df50c){console[_0x58980f(0x131)](_0x58980f(0x125),_0x1df50c);}}document[a12_0x18bfbc(0x133)](a12_0x18bfbc(0x12f),()=>{const _0x4171e5=a12_0x18bfbc,_0x313983=getAuth();onAuthStateChanged(_0x313983,async _0x153b60=>{await updateAuthSection(_0x153b60),_0x153b60&&checkPendingInvitationsForCurrentUser(_0x153b60['uid']);}),document[_0x4171e5(0x133)](_0x4171e5(0x12a),()=>{const _0x208245=_0x4171e5;!document['hidden']&&_0x313983['currentUser']&&checkPendingInvitationsForCurrentUser(_0x313983['currentUser'][_0x208245(0x11c)]);}),document['addEventListener'](_0x4171e5(0x147),_0x294501=>{const _0x3f1244=_0x4171e5;_0x294501['target']['closest']('a[href]')&&_0x313983['currentUser']&&checkPendingInvitationsForCurrentUser(_0x313983[_0x3f1244(0x134)]['uid']);});});export{updateAuthSection};
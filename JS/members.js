const a35_0xa2757a=a35_0x4b29,a35_0x5ace9e=(function(){let _0xe7105d=!![];return function(_0x3aba02,_0x345e85){const _0x575f10=_0xe7105d?function(){if(_0x345e85){const _0x1d9096=_0x345e85['apply'](_0x3aba02,arguments);return _0x345e85=null,_0x1d9096;}}:function(){};return _0xe7105d=![],_0x575f10;};}()),a35_0x54a472=a35_0x5ace9e(this,function(){const _0x3500d0=a35_0x4b29,_0x244f88=function(){const _0x2ec0f4=a35_0x4b29;let _0x597520;try{_0x597520=Function(_0x2ec0f4(0x178)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x186b92){_0x597520=window;}return _0x597520;},_0x1083b2=_0x244f88(),_0x4ba201=_0x1083b2['console']=_0x1083b2['console']||{},_0x4e0a14=[_0x3500d0(0x172),'warn',_0x3500d0(0x166),'error','exception',_0x3500d0(0x163),'trace'];for(let _0x2e0617=0x0;_0x2e0617<_0x4e0a14['length'];_0x2e0617++){const _0x2bf11d=a35_0x5ace9e['constructor']['prototype']['bind'](a35_0x5ace9e),_0x5ab9d4=_0x4e0a14[_0x2e0617],_0x35c6f5=_0x4ba201[_0x5ab9d4]||_0x2bf11d;_0x2bf11d['__proto__']=a35_0x5ace9e['bind'](a35_0x5ace9e),_0x2bf11d['toString']=_0x35c6f5['toString']['bind'](_0x35c6f5),_0x4ba201[_0x5ab9d4]=_0x2bf11d;}});a35_0x54a472();const functions=require('firebase-functions'),admin=require(a35_0xa2757a(0x171));admin['initializeApp']();const db=admin[a35_0xa2757a(0x170)]();function a35_0x238f(){const _0x4cc2fe=['elo','status','table','aggregatedMembers','onRequest','info','unranked','gold','userProfiles','playersD3','ladders','batch','error','forEach','docId','firestore','firebase-admin','log','collection','username','nonParticipants','onWrite','https','return\x20(function()\x20','includes','players'];a35_0x238f=function(){return _0x4cc2fe;};return a35_0x238f();}exports['updateMembersList']=functions[a35_0xa2757a(0x170)]['document']('{collection}/{docId}')[a35_0xa2757a(0x176)](async(_0x1096cf,_0x1e0ac5)=>{const _0xf059d3=a35_0xa2757a,_0x2dce96=_0x1e0ac5['params']['collection'],_0x365497=_0x1e0ac5['params'][_0xf059d3(0x16f)];if(![_0xf059d3(0x17a),'playersD2','playersD3','userProfiles',_0xf059d3(0x175)][_0xf059d3(0x179)](_0x2dce96))return null;try{await rebuildMembersList(),console['log']('Successfully\x20updated\x20aggregated\x20members\x20list');}catch(_0x2d16a8){console['error']('Error\x20updating\x20members\x20list:',_0x2d16a8);}});async function rebuildMembersList(){const _0x1fa471=a35_0xa2757a,_0x261f0e=db[_0x1fa471(0x16c)](),[_0x38bfd4,_0x25bd20,_0xbd0ab8,_0xfdded8,_0x16a66e]=await Promise['all']([db['collection'](_0x1fa471(0x169))['get'](),db[_0x1fa471(0x173)](_0x1fa471(0x17a))['get'](),db['collection']('playersD2')['get'](),db['collection'](_0x1fa471(0x16a))['get'](),db['collection']('nonParticipants')['get']()]),_0x4ae9f1=new Map();_0x38bfd4[_0x1fa471(0x16e)](_0x23a8c5=>{_0x4ae9f1['set'](_0x23a8c5['id'],_0x23a8c5['data']());});const _0x5294dc=new Map(),_0x741ffb=(_0x281327,_0x4031f6)=>{_0x281327['forEach'](_0x21daff=>{const _0x19de8f=_0x21daff['data'](),_0x9d2c4e=_0x21daff['id'];!_0x5294dc['has'](_0x9d2c4e)&&_0x5294dc['set'](_0x9d2c4e,{'userId':_0x9d2c4e,'username':_0x19de8f['username']||'Unknown','ladders':[],'isNonParticipant':![]});const _0x35cb9c=_0x5294dc['get'](_0x9d2c4e);_0x35cb9c['ladders']['push']({'ladder':_0x4031f6,'elo':_0x19de8f['eloRating']||0x4b0,'active':_0x19de8f['active']!==![]});});};_0x741ffb(_0x25bd20,'D1'),_0x741ffb(_0xbd0ab8,'D2'),_0x741ffb(_0xfdded8,'D3'),_0x16a66e['forEach'](_0xe4084f=>{const _0x4f192b=_0xe4084f['data'](),_0x1d04b3=_0xe4084f['id'];!_0x5294dc['has'](_0x1d04b3)&&_0x4f192b['username']&&_0x5294dc['set'](_0x1d04b3,{'userId':_0x1d04b3,'username':_0x4f192b['username'],'ladders':[],'isNonParticipant':!![]});});const _0x148a6d=[];_0x5294dc['forEach']((_0x365935,_0x13e16c)=>{const _0x4ef554=_0x1fa471,_0x1e6467=_0x4ae9f1['get'](_0x13e16c)||{};let _0x1ddc45=0x0,_0x1b087e=null;if(_0x365935['ladders']['length']>0x0){const _0x9a0635=_0x365935[_0x4ef554(0x16b)]['sort']((_0x395ae9,_0x4b6d74)=>_0x4b6d74[_0x4ef554(0x161)]-_0x395ae9[_0x4ef554(0x161)]);_0x1ddc45=_0x9a0635[0x0][_0x4ef554(0x161)],_0x1b087e=_0x9a0635[0x0]['ladder'];}const _0x40dcc8={'userId':_0x13e16c,'username':_0x365935[_0x4ef554(0x174)],'profileImageUrl':_0x1e6467['profileImageUrl']||null,'country':_0x1e6467['country']||null,'motto':_0x1e6467['motto']||null,'favoriteMap':_0x1e6467['favoriteMap']||null,'favoriteWeapon':_0x1e6467['favoriteWeapon']||null,'isNonParticipant':_0x365935['isNonParticipant'],'ladders':_0x365935['ladders'],'primaryLadder':_0x1b087e,'highestElo':_0x1ddc45,'rank':getPlayerRank(_0x1ddc45),'lastUpdated':admin[_0x4ef554(0x170)]['FieldValue']['serverTimestamp']()};_0x148a6d['push'](_0x40dcc8);});const _0x1cc8a6=db['collection'](_0x1fa471(0x164)),_0x540a5b=await _0x1cc8a6['get'](),_0x52e684=[];_0x540a5b['forEach'](_0x89d7fd=>{_0x52e684['push'](_0x89d7fd['ref']['delete']());}),await Promise['all'](_0x52e684);const _0x489e44=0x1f4,_0x5984a7=[];for(let _0x1eef03=0x0;_0x1eef03<_0x148a6d['length'];_0x1eef03+=_0x489e44){const _0x251df7=db[_0x1fa471(0x16c)](),_0x5c0c98=_0x148a6d['slice'](_0x1eef03,_0x1eef03+_0x489e44);_0x5c0c98['forEach'](_0x5cef68=>{const _0x3ec137=_0x1cc8a6['doc'](_0x5cef68['userId']);_0x251df7['set'](_0x3ec137,_0x5cef68);}),_0x5984a7['push'](_0x251df7['commit']());}await Promise['all'](_0x5984a7);}function getPlayerRank(_0x4ebc11){const _0x2c5d90=a35_0xa2757a;if(_0x4ebc11>=0x7d0)return'emerald';if(_0x4ebc11>=0x708)return _0x2c5d90(0x168);if(_0x4ebc11>=0x640)return'silver';if(_0x4ebc11>=0x578)return'bronze';return _0x2c5d90(0x167);}function a35_0x4b29(_0x3eedcb,_0x4d50db){const _0x54a472=a35_0x238f();return a35_0x4b29=function(_0x5ace9e,_0x50788b){_0x5ace9e=_0x5ace9e-0x161;let _0x238fe7=_0x54a472[_0x5ace9e];return _0x238fe7;},a35_0x4b29(_0x3eedcb,_0x4d50db);}exports['rebuildMembersListManual']=functions[a35_0xa2757a(0x177)][a35_0xa2757a(0x165)](async(_0x1b8b9c,_0x17f4ff)=>{const _0x550044=a35_0xa2757a;try{await rebuildMembersList(),_0x17f4ff[_0x550044(0x162)](0xc8)['send']('Members\x20list\x20rebuilt\x20successfully');}catch(_0x1a2401){console[_0x550044(0x16d)]('Error\x20rebuilding\x20members\x20list:',_0x1a2401),_0x17f4ff['status'](0x1f4)['send']('Error\x20rebuilding\x20members\x20list');}});
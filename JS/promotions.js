const a46_0x417a9f=a46_0x3787,a46_0x46d2b3=(function(){let _0x1889a4=!![];return function(_0x2fe32c,_0x2583ac){const _0x4eda35=_0x1889a4?function(){if(_0x2583ac){const _0x2b32f2=_0x2583ac['apply'](_0x2fe32c,arguments);return _0x2583ac=null,_0x2b32f2;}}:function(){};return _0x1889a4=![],_0x4eda35;};}()),a46_0x4c8153=a46_0x46d2b3(this,function(){const _0x4ff772=a46_0x3787,_0x26da45=function(){const _0x2934ac=a46_0x3787;let _0x10c5e0;try{_0x10c5e0=Function('return\x20(function()\x20'+_0x2934ac(0x1e4)+');')();}catch(_0x501851){_0x10c5e0=window;}return _0x10c5e0;},_0x420cb4=_0x26da45(),_0x52c4c=_0x420cb4['console']=_0x420cb4[_0x4ff772(0x1f4)]||{},_0x17138f=[_0x4ff772(0x1b4),'warn','info',_0x4ff772(0x1ce),'exception',_0x4ff772(0x1e6),_0x4ff772(0x1bd)];for(let _0x728a3e=0x0;_0x728a3e<_0x17138f['length'];_0x728a3e++){const _0x2bc440=a46_0x46d2b3['constructor']['prototype']['bind'](a46_0x46d2b3),_0x400a9c=_0x17138f[_0x728a3e],_0x149a37=_0x52c4c[_0x400a9c]||_0x2bc440;_0x2bc440['__proto__']=a46_0x46d2b3['bind'](a46_0x46d2b3),_0x2bc440['toString']=_0x149a37['toString']['bind'](_0x149a37),_0x52c4c[_0x400a9c]=_0x2bc440;}});a46_0x4c8153();import{collection,doc,query,where,orderBy,limit,getDocs,addDoc,getDoc,serverTimestamp,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{auth,db}from'./firebase-config.js';class PromotionManager{constructor(){const _0x401a05=a46_0x3787;this['DISPLAY_HOURS']=0x18,this['RANKS']=[{'threshold':0x578,'name':_0x401a05(0x1dc),'color':'#CD7F32'},{'threshold':0x640,'name':_0x401a05(0x1c0),'color':'#C0C0C0'},{'threshold':0x708,'name':'Gold','color':'#FFD700'},{'threshold':0x834,'name':'Emerald','color':'#50C878'}],this['bannerContainer']=null,this['lastFetchTime']=0x0,this['fetchInterval']=0xea60,this['pollingInterval']=null,this['usernameCache']={};}['initialize'](){const _0x2940bc=a46_0x3787;this[_0x2940bc(0x1f9)]=document[_0x2940bc(0x1c5)](_0x2940bc(0x1d3));if(!this[_0x2940bc(0x1f9)]){console['error']('Promotion\x20banner\x20container\x20not\x20found');return;}this['setupBannerContainer']();const _0x105a62='promotions_checked_'+new Date()['toDateString'](),_0x29829b=sessionStorage['getItem'](_0x105a62);!_0x29829b&&(this['fetchRecentPromotions'](),sessionStorage['setItem'](_0x105a62,'true')),document[_0x2940bc(0x1ea)]('visibilitychange',()=>{const _0x23a464=_0x2940bc;document[_0x23a464(0x201)]==='visible'&&!sessionStorage[_0x23a464(0x204)](_0x105a62)&&(this['fetchRecentPromotions'](),sessionStorage['setItem'](_0x105a62,'true'));}),window[_0x2940bc(0x1ea)](_0x2940bc(0x1ba),()=>{this['pollingInterval']&&clearInterval(this['pollingInterval']);});}['setupBannerContainer'](){const _0x451b73=a46_0x3787;this['bannerContainer']['innerHTML']='',this[_0x451b73(0x1f9)][_0x451b73(0x1d1)]['display']='none';}async['fetchRecentPromotions'](){const _0x15b7cc=a46_0x3787;try{const _0x1b212f=Date['now']();if(_0x1b212f-this['lastFetchTime']<this[_0x15b7cc(0x1be)])return;this['lastFetchTime']=_0x1b212f;const _0x4d868b=collection(db,'eloHistory'),_0x1a16fc=query(_0x4d868b,where(_0x15b7cc(0x1d0),'in',['promotion','demotion']),orderBy(_0x15b7cc(0x1e9),_0x15b7cc(0x1cd)),limit(0x14)),_0x345fde=await getDocs(_0x1a16fc),_0x3b8d7c=[];_0x345fde[_0x15b7cc(0x1ec)](_0x3da824=>{const _0x5d3c7d=_0x15b7cc,_0x34e476={'id':_0x3da824['id'],..._0x3da824['data']()};this['shouldShowPromotion'](_0x3da824['id'])&&this['isNewRankChange'](_0x34e476)&&_0x3b8d7c[_0x5d3c7d(0x1db)](_0x34e476);}),_0x3b8d7c['length']>0x0&&await this['processRankChanges'](_0x3b8d7c);}catch(_0x3617a3){console['error']('Error\x20fetching\x20promotions:',_0x3617a3);}}async['processRankChanges'](_0xd3309f){const _0x31e1b2=a46_0x3787;if(_0xd3309f['length']===0x0)return;_0xd3309f['sort']((_0x5b10ca,_0x4045f1)=>{const _0x4183cd=a46_0x3787,_0x33a090=_0x5b10ca[_0x4183cd(0x1e9)]?.['toMillis']?.()||_0x5b10ca[_0x4183cd(0x1e9)]?.['seconds']*0x3e8||0x0,_0x50b193=_0x4045f1['timestamp']?.['toMillis']?.()||_0x4045f1['timestamp']?.[_0x4183cd(0x1d5)]*0x3e8||0x0;return _0x50b193-_0x33a090;});const _0x1dac57=this['bannerContainer'][_0x31e1b2(0x1f7)]['length'],_0x1fc893=0x3-_0x1dac57;if(_0x1fc893<=0x0)return;const _0x49141a=_0xd3309f[_0x31e1b2(0x1ca)](0x0,_0x1fc893);for(let _0x3d65be=0x0;_0x3d65be<_0x49141a['length'];_0x3d65be++){const _0x28acc3=_0x49141a[_0x3d65be],_0x507956=auth['currentUser'];try{setTimeout(()=>{this['showRankChangeBanner'](_0x28acc3);},_0x3d65be*0x3e8),_0x507956&&_0x28acc3[_0x31e1b2(0x1d7)]===_0x507956[_0x31e1b2(0x209)]&&this['showRankChangeLightbox'](_0x28acc3['type'],_0x28acc3['rankAchieved']);}catch(_0x31abae){console['error']('Error\x20processing\x20rank\x20change:',_0x31abae);}}}['shouldShowPromotion'](_0x4c5abc){const _0x37d847=a46_0x3787;try{const _0x3004a0='promotion_'+_0x4c5abc,_0x274880=localStorage[_0x37d847(0x204)](_0x3004a0);if(_0x274880){let _0x4b56ff;try{_0x4b56ff=JSON['parse'](_0x274880);}catch(_0x2f98c1){return console['warn']('Invalid\x20storage\x20format\x20for\x20'+_0x3004a0+',\x20treating\x20as\x20new'),!![];}if(_0x4b56ff['ignored']===!![])return console['log']('Promotion\x20'+_0x4c5abc+'\x20is\x20permanently\x20ignored'),![];const _0x16d184=Date['now']();if(_0x4b56ff['userDismissed']&&_0x16d184-_0x4b56ff['timestamp']<this['DISPLAY_HOURS']*0x3c*0x3c*0x3e8)return console['log']('Promotion\x20'+_0x4c5abc+'\x20was\x20dismissed\x20by\x20user\x20within\x20last\x20'+this['DISPLAY_HOURS']+'\x20hours'),![];if(_0x4b56ff['systemDismissed']&&_0x16d184-_0x4b56ff['timestamp']<0x4*0x3c*0x3c*0x3e8)return console['log']('Promotion\x20'+_0x4c5abc+'\x20was\x20auto-dismissed\x20within\x20last\x204\x20hours'),![];}return!![];}catch(_0xc5d1d7){return console['error']('Error\x20checking\x20promotion\x20visibility:',_0xc5d1d7),![];}}['ignorePromotion'](_0x1a7ff8){const _0x35436a=a46_0x3787;try{const _0x51a82a='promotion_'+_0x1a7ff8;localStorage['setItem'](_0x51a82a,JSON['stringify']({'timestamp':Date[_0x35436a(0x1f6)](),'ignored':!![]}));}catch(_0x2d4a4b){console[_0x35436a(0x1ce)]('Error\x20saving\x20promotion\x20preference:',_0x2d4a4b);}}[a46_0x417a9f(0x1ff)](_0x54cac1){const _0x21ebe7=a46_0x417a9f;this['resolveUserId'](_0x54cac1)[_0x21ebe7(0x1d6)](_0x1dc1b0=>{const _0x979f2e=_0x21ebe7,_0x48d6ae='promotion_'+_0x54cac1['id'],_0x433e6a=localStorage['getItem'](_0x48d6ae);if(_0x433e6a)try{const _0x44f884=JSON['parse'](_0x433e6a);if(_0x44f884['ignored']===!![]){console['log']('Skipping\x20ignored\x20promotion:\x20'+_0x54cac1['id']);return;}}catch(_0x14c40d){}localStorage['setItem'](_0x48d6ae,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':![],'seenAt':Date[_0x979f2e(0x1f6)]()})),this['bannerContainer']['style'][_0x979f2e(0x1e1)]='block';while(this['bannerContainer'][_0x979f2e(0x1f7)]['length']>=0x3){this[_0x979f2e(0x1f9)]['removeChild'](this['bannerContainer']['firstChild']);}const _0x443ab0=document['createElement'](_0x979f2e(0x1ee));_0x443ab0['className']='promotion-banner',_0x443ab0['setAttribute'](_0x979f2e(0x1b9),_0x1dc1b0['rankAchieved']),_0x443ab0[_0x979f2e(0x1c3)]('data-id',_0x1dc1b0['id']);const _0x127a72=document['createElement']('div');_0x127a72['className']='promotion-details';const _0x11dddc=_0x1dc1b0['resolvedName']||_0x1dc1b0['player']||_0x1dc1b0['username']||_0x1dc1b0['playerUsername']||_0x1dc1b0['displayName']||_0x979f2e(0x1d9),_0x3d357b=_0x1dc1b0['type']==='promotion'?_0x11dddc+'\x20was\x20promoted\x20to':_0x11dddc+'\x20was\x20demoted\x20to';_0x127a72['innerHTML']=_0x3d357b+'\x20<span\x20class=\x22rank-text\x22>'+_0x1dc1b0['rankAchieved']+'</span>';const _0x230c20=document['createElement'](_0x979f2e(0x1ee));_0x230c20['className']='banner-actions';const _0x316d3b=document[_0x979f2e(0x1cb)]('button');_0x316d3b[_0x979f2e(0x1fd)]=_0x979f2e(0x1fc),_0x316d3b['innerHTML']=_0x979f2e(0x1b7),_0x316d3b[_0x979f2e(0x1dd)]='Dismiss';const _0x2e0a69=document['createElement']('button');_0x2e0a69['className']='ignore-btn',_0x2e0a69['textContent']='Don\x27t\x20show\x20again',_0x2e0a69['title']=_0x979f2e(0x1e0),_0x230c20['appendChild'](_0x2e0a69),_0x230c20[_0x979f2e(0x1ed)](_0x316d3b),_0x443ab0['appendChild'](_0x127a72),_0x443ab0['appendChild'](_0x230c20),this['bannerContainer']['appendChild'](_0x443ab0),void _0x443ab0['offsetWidth'],setTimeout(()=>{_0x443ab0['classList']['add']('new-rank-change');},0x32),_0x316d3b[_0x979f2e(0x1ea)](_0x979f2e(0x1e3),()=>{const _0x1d113f=_0x979f2e;localStorage['setItem'](_0x48d6ae,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':!![],'systemDismissed':![]})),_0x443ab0[_0x1d113f(0x1eb)][_0x1d113f(0x1e7)]('new-rank-change'),_0x443ab0['classList']['add'](_0x1d113f(0x202)),setTimeout(()=>{const _0x4d4c9e=_0x1d113f;_0x443ab0['parentNode']&&(_0x443ab0['remove'](),this['bannerContainer']['children']['length']===0x0&&(this['bannerContainer']['style']['display']=_0x4d4c9e(0x1b8)));},0x1f4);}),_0x2e0a69['addEventListener'](_0x979f2e(0x1e3),()=>{const _0x5d207a=_0x979f2e;localStorage['setItem'](_0x48d6ae,JSON[_0x5d207a(0x1c6)]({'timestamp':Date[_0x5d207a(0x1f6)](),'ignored':!![],'userDismissed':!![],'systemDismissed':![]})),_0x443ab0[_0x5d207a(0x1eb)]['remove'](_0x5d207a(0x1f1)),_0x443ab0['classList']['add'](_0x5d207a(0x202)),setTimeout(()=>{const _0x26fa86=_0x5d207a;_0x443ab0['parentNode']&&(_0x443ab0['remove'](),this['bannerContainer']['children']['length']===0x0&&(this['bannerContainer']['style']['display']=_0x26fa86(0x1b8)));},0x1f4);}),setTimeout(()=>{const _0x31999d=_0x979f2e;_0x443ab0['parentNode']&&(_0x443ab0[_0x31999d(0x1eb)]['remove']('new-rank-change'),_0x443ab0[_0x31999d(0x1eb)][_0x31999d(0x20b)](_0x31999d(0x202)),localStorage['setItem'](_0x48d6ae,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':!![]})),setTimeout(()=>{const _0x3b4296=_0x31999d;_0x443ab0[_0x3b4296(0x1f3)]&&(_0x443ab0['remove'](),this['bannerContainer']['children'][_0x3b4296(0x200)]===0x0&&(this[_0x3b4296(0x1f9)][_0x3b4296(0x1d1)]['display']=_0x3b4296(0x1b8)));},0x1f4));},0x3a98);});}async['resolveUserId'](_0x1e5057){const _0x419118=a46_0x417a9f,_0xa0bacc={..._0x1e5057},_0x58c6d8=[_0x1e5057[_0x419118(0x1d7)],_0x1e5057['username'],_0x1e5057['playerUsername'],_0x1e5057['displayName']],_0x2c3f07=_0x58c6d8[_0x419118(0x1bf)](_0x559c68=>_0x559c68&&typeof _0x559c68==='string'&&!_0x559c68[_0x419118(0x1b6)]('ID:')&&!/^[a-zA-Z0-9]{20,}$/['test'](_0x559c68));if(_0x2c3f07)return _0xa0bacc;let _0x2818ac=null;if(_0x1e5057['userId'])_0x2818ac=_0x1e5057[_0x419118(0x1d8)];else _0x1e5057['player']&&/^[A-Za-z0-9]{20,}$/['test'](_0x1e5057['player'])&&(_0x2818ac=_0x1e5057[_0x419118(0x1d7)]);if(!_0x2818ac)return _0xa0bacc;try{const _0x5a62bd=await getDoc(doc(db,'players',_0x2818ac));if(_0x5a62bd['exists']()){const _0x30829b=_0x5a62bd['data']();if(_0x30829b[_0x419118(0x1b5)])return _0xa0bacc['resolvedName']=_0x30829b['username'],_0xa0bacc;}const _0x1d3445=await getDocs(query(collection(db,'approvedMatches'),where('winnerId','==',_0x2818ac),orderBy('date',_0x419118(0x1cd)),limit(0x1)));if(!_0x1d3445['empty']){const _0x43f618=_0x1d3445['docs'][0x0]['data']();if(_0x43f618['winnerUsername'])return _0xa0bacc[_0x419118(0x1fe)]=_0x43f618['winnerUsername'],_0xa0bacc;}const _0x367afa=await getDocs(query(collection(db,'approvedMatches'),where(_0x419118(0x1df),'==',_0x2818ac),orderBy('date',_0x419118(0x1cd)),limit(0x1)));if(!_0x367afa['empty']){const _0x3153cc=_0x367afa['docs'][0x0]['data']();if(_0x3153cc['loserUsername'])return _0xa0bacc['resolvedName']=_0x3153cc['loserUsername'],console['log']('Resolved\x20'+_0x2818ac+_0x419118(0x20c)+_0x3153cc['loserUsername']+_0x419118(0x20d)),_0xa0bacc;}}catch(_0x11f9ff){console[_0x419118(0x1ce)]('Error\x20resolving\x20user\x20ID:',_0x11f9ff);}return console[_0x419118(0x208)]('Failed\x20to\x20resolve\x20user\x20ID:\x20'+_0x2818ac),_0xa0bacc;}['showRankChangeLightbox'](_0x1d531d,_0x56d204){const _0x3714ce=a46_0x417a9f;let _0x1405e5=document[_0x3714ce(0x1c5)]('rankChangeModal');!_0x1405e5&&(_0x1405e5=document[_0x3714ce(0x1cb)]('div'),_0x1405e5['id']='rankChangeModal',_0x1405e5['className']='rank-change-modal\x20'+_0x1d531d,document['body']['appendChild'](_0x1405e5));const _0x3f6ab4=_0x1d531d==='promotion'?_0x3714ce(0x1c1):'Rank\x20Update',_0x4d9070=_0x1d531d==='promotion'?'You\x27ve\x20been\x20promoted\x20to':'You\x27ve\x20been\x20demoted\x20to';_0x1405e5['innerHTML']=_0x3714ce(0x1c9)+_0x3f6ab4+_0x3714ce(0x1d2)+_0x4d9070+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22rank-name\x22>'+_0x56d204+_0x3714ce(0x1f2),_0x1405e5['style']['display']='flex',document[_0x3714ce(0x1c5)]('rank-change-ok-btn')['addEventListener']('click',()=>{_0x1405e5['style']['display']='none';}),_0x1405e5['addEventListener'](_0x3714ce(0x1e3),_0x17e42a=>{const _0x35a98e=_0x3714ce;_0x17e42a[_0x35a98e(0x1f5)]===_0x1405e5&&(_0x1405e5['style'][_0x35a98e(0x1e1)]='none');});}async['checkAndRecordPromotion'](_0x67f22b,_0x6234f1,_0x3eb9ee,_0x114d3d={}){const _0x452495=a46_0x417a9f;try{if(_0x6234f1===_0x3eb9ee||!_0x67f22b)return null;const _0x39dd6e=_0x114d3d['source']||'automatic',_0x3cfba5=_0x114d3d['matchId']||null,_0x4acccc=_0x114d3d['adminUser']||null;console['log']('Processing\x20potential\x20rank\x20change:\x20'+_0x3eb9ee+'\x20→\x20'+_0x6234f1+'\x20(source:\x20'+_0x39dd6e+')');let _0x2e4c02=null,_0x30b30b=null;try{const _0x1a7064=await getDoc(doc(db,'players',_0x67f22b));if(_0x1a7064['exists']()){const _0x4d667e=_0x1a7064['data']();_0x2e4c02=_0x4d667e['username']||_0x4d667e[_0x452495(0x209)]||null,_0x30b30b=_0x4d667e['displayName']||_0x4d667e[_0x452495(0x1b5)]||null;}!_0x2e4c02&&_0x114d3d['username']&&(_0x2e4c02=_0x114d3d['username'],_0x30b30b=_0x114d3d['username']);!_0x2e4c02&&auth['currentUser']&&(_0x2e4c02=auth[_0x452495(0x1de)]['displayName']||auth['currentUser']['email'][_0x452495(0x206)]('@')[0x0],_0x30b30b=auth['currentUser'][_0x452495(0x209)]||null);if(!_0x2e4c02){const _0x2ae7f2=query(collection(db,'approvedMatches'),where(_0x452495(0x207),'==',_0x67f22b),limit(0x1)),_0x258873=await getDocs(_0x2ae7f2);if(!_0x258873['empty'])_0x2e4c02=_0x258873['docs'][0x0]['data']()['winnerUsername']||_0x452495(0x1d4),_0x30b30b=_0x2e4c02;else{const _0x478ff3=query(collection(db,'approvedMatches'),where('loserId','==',_0x67f22b),limit(0x1)),_0x2cb06a=await getDocs(_0x478ff3);!_0x2cb06a['empty']&&(_0x2e4c02=_0x2cb06a[0x0]['data']()['loserUsername']||_0x452495(0x1d4),_0x30b30b=_0x2e4c02);}}}catch(_0x26cfef){console[_0x452495(0x1ce)]('Error\x20resolving\x20username:',_0x26cfef);}!_0x2e4c02&&(console[_0x452495(0x208)](_0x452495(0x205),_0x67f22b),_0x2e4c02=_0x452495(0x1d9),_0x30b30b='Unknown\x20Player');const _0x5e8457=this['getRankName'](_0x3eb9ee),_0x370e4f=this['getRankName'](_0x6234f1);if(_0x5e8457!==_0x370e4f){const _0x25ec27=_0x6234f1>_0x3eb9ee,_0x20da48=_0x25ec27?'promotion':'demotion',_0x981380=_0x370e4f;console['log']('Recording\x20'+_0x20da48+'\x20for\x20'+_0x2e4c02+':\x20'+_0x3eb9ee+'\x20('+_0x5e8457+_0x452495(0x1cf)+_0x6234f1+'\x20('+_0x370e4f+')');try{const _0xedf3bc={'player':_0x2e4c02,'playerUsername':_0x2e4c02,'username':_0x2e4c02,'displayName':_0x30b30b,'userId':_0x67f22b,'type':_0x20da48,'rankAchieved':_0x981380,'timestamp':serverTimestamp(),'previousElo':_0x3eb9ee,'newElo':_0x6234f1,'change':_0x6234f1-_0x3eb9ee,'previousRank':_0x5e8457,'newRank':_0x370e4f,'source':_0x39dd6e};if(_0x39dd6e===_0x452495(0x1f0)&&_0x3cfba5)_0xedf3bc['matchId']=_0x3cfba5;else _0x39dd6e==='admin'&&_0x4acccc?(_0xedf3bc['modifiedBy']=_0x4acccc,_0xedf3bc['isAutomatic']=![]):_0xedf3bc[_0x452495(0x1c7)]=!![];const _0x4a066d=writeBatch(db),_0x264bdf=doc(collection(db,'eloHistory')),_0x261497=doc(collection(db,'promotionHistory'));return _0x4a066d[_0x452495(0x1c4)](_0x264bdf,_0xedf3bc),_0x4a066d[_0x452495(0x1c4)](_0x261497,_0xedf3bc),await _0x4a066d['commit'](),await this['sendPromotionNotification'](_0x67f22b,_0x2e4c02,_0x3eb9ee,_0x6234f1,_0x5e8457,_0x370e4f,_0x20da48,{'displayName':_0x30b30b,'source':_0x39dd6e,'matchId':_0x3cfba5,'ladder':_0x114d3d['ladder']||'D1'}),console['log'](_0x452495(0x1b3)+_0x20da48+_0x452495(0x1e8)+_0x2e4c02+'\x20to\x20'+_0x981380),_0x981380;}catch(_0x20f2b3){console[_0x452495(0x1ce)]('Error\x20writing\x20promotion\x20records:',_0x20f2b3);try{return await addDoc(collection(db,'eloHistory'),{'player':_0x2e4c02,'playerUsername':_0x2e4c02,'username':_0x2e4c02,'displayName':_0x30b30b,'userId':_0x67f22b,'type':_0x20da48,'rankAchieved':_0x981380,'timestamp':serverTimestamp(),'previousElo':_0x3eb9ee,'newElo':_0x6234f1,'change':_0x6234f1-_0x3eb9ee,'previousRank':_0x5e8457,'source':_0x39dd6e,'isAutomatic':_0x39dd6e!=='admin'}),await this['sendPromotionNotification'](_0x67f22b,_0x2e4c02,_0x3eb9ee,_0x6234f1,_0x5e8457,_0x370e4f,_0x20da48,{'displayName':_0x30b30b,'source':_0x39dd6e,'matchId':_0x3cfba5,'ladder':_0x114d3d['ladder']||'D1'}),_0x981380;}catch(_0x5c5e05){return console[_0x452495(0x1ce)](_0x452495(0x1f8),_0x5c5e05),null;}}}return null;}catch(_0xf9c0a1){return console['error'](_0x452495(0x1da),_0xf9c0a1),null;}}['getRankName'](_0x24f10d){const _0x8518fb=a46_0x417a9f;for(let _0x515c14=this['RANKS']['length']-0x1;_0x515c14>=0x0;_0x515c14--){if(_0x24f10d>=this['RANKS'][_0x515c14]['threshold'])return this[_0x8518fb(0x1bc)][_0x515c14]['name'];}return'Unranked';}['cleanup'](){const _0x34a662=a46_0x417a9f;this[_0x34a662(0x1c8)]&&clearInterval(this[_0x34a662(0x1c8)]);}['isNewRankChange'](_0x1b0eed){const _0x297a60=a46_0x417a9f;if(_0x1b0eed[_0x297a60(0x1e9)]){const _0x3063a3=_0x1b0eed['timestamp']['seconds']*0x3e8,_0x2fc431=Date[_0x297a60(0x1f6)](),_0x29d747=(_0x2fc431-_0x3063a3)/(0x3e8*0x3c*0x3c);if(_0x29d747>0x18)return![];}if(_0x1b0eed['previousRank']&&_0x1b0eed[_0x297a60(0x20a)]&&_0x1b0eed[_0x297a60(0x1fa)]!==_0x1b0eed['newRank'])return!![];return![];}async[a46_0x417a9f(0x1fb)](_0xfdb297,_0x5d2fdc,_0x604a82,_0x56434b,_0x2d5223,_0x5d9c6e,_0x3ffa23,_0x1947dd={}){const _0x1377fa=a46_0x417a9f;try{console['log']('STARTING\x20notification\x20for\x20'+_0x5d2fdc+'\x27s\x20'+_0x3ffa23);const _0x74fda6={'userId':_0xfdb297,'username':_0x5d2fdc,'displayName':_0x1947dd[_0x1377fa(0x209)]||_0x5d2fdc,'oldElo':parseInt(_0x604a82),'newElo':parseInt(_0x56434b),'eloDifference':parseInt(_0x56434b)-parseInt(_0x604a82),'oldRank':_0x2d5223,'newRank':_0x5d9c6e,'type':_0x3ffa23,'timestamp':serverTimestamp(),'processed':![],'source':_0x1947dd['source']||'automatic','matchId':_0x1947dd['matchId']||null,'ladder':_0x1947dd[_0x1377fa(0x1c2)]||'D1','adminUser':_0x1947dd[_0x1377fa(0x1e2)]||null};console[_0x1377fa(0x1b4)]('Creating\x20Discord\x20notification:',_0x74fda6);const _0x1aa621=await addDoc(collection(db,'promotionNotifications'),_0x74fda6);return console['log'](_0x1377fa(0x203)+_0x1aa621['id']),!![];}catch(_0x1701be){return console['error'](_0x1377fa(0x1bb),_0x1701be),![];}}}function a46_0x3787(_0xab395b,_0x2b59e4){const _0x4c8153=a46_0x5b08();return a46_0x3787=function(_0x46d2b3,_0x33bda2){_0x46d2b3=_0x46d2b3-0x1b3;let _0x5b0878=_0x4c8153[_0x46d2b3];return _0x5b0878;},a46_0x3787(_0xab395b,_0x2b59e4);}export const promotionManager=new PromotionManager();function a46_0x5b08(){const _0x2753a6=['Successfully\x20recorded\x20','log','username','includes','&times;','none','data-rank','beforeunload','Error\x20sending\x20Discord\x20notification:','RANKS','trace','fetchInterval','some','Silver','Congratulations!','ladder','setAttribute','set','getElementById','stringify','isAutomatic','pollingInterval','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rank-change-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2\x20class=\x22rank-change-title\x22>','slice','createElement','getRankName','desc','error',')\x20→\x20','type','style','</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>','promotion-banner-container','Unknown\x20Player','seconds','then','player','userId','A\x20player','Error\x20in\x20promotion/demotion\x20recording:','push','Bronze','title','currentUser','loserId','Never\x20show\x20this\x20promotion\x20again','display','adminUser','click','{}.constructor(\x22return\x20this\x22)(\x20)','initialize','table','remove','\x20for\x20','timestamp','addEventListener','classList','forEach','appendChild','div','DOMContentLoaded','match','new-rank-change','</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22rank-change-button\x22\x20id=\x22rank-change-ok-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Got\x20it!\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','parentNode','console','target','now','children','Fallback\x20write\x20failed:','bannerContainer','previousRank','sendPromotionNotification','dismiss-btn','className','resolvedName','showRankChangeBanner','length','visibilityState','dismissing','Discord\x20notification\x20sent\x20successfully\x20with\x20ID:\x20','getItem','Could\x20not\x20resolve\x20username\x20for\x20userId:','split','winnerId','warn','displayName','newRank','add','\x20to\x20','\x20(loser)'];a46_0x5b08=function(){return _0x2753a6;};return a46_0x5b08();}document['addEventListener'](a46_0x417a9f(0x1ef),()=>{const _0x41d898=a46_0x417a9f;promotionManager[_0x41d898(0x1e5)]();});export const initializePromotionTracker=()=>promotionManager['initialize']();export const checkAndRecordPromotion=(_0x2d7f03,_0x36091c,_0x9ee86d,_0x96abc4)=>promotionManager['checkAndRecordPromotion'](_0x2d7f03,_0x36091c,_0x9ee86d,_0x96abc4);export const getRankName=_0x5b01bf=>promotionManager[a46_0x417a9f(0x1cc)](_0x5b01bf);
function a14_0x3969(_0xc0a9c0,_0x5bbd69){const _0x43f614=a14_0x2dda();return a14_0x3969=function(_0x153a59,_0x1fcd37){_0x153a59=_0x153a59-0xba;let _0x2dda0a=_0x43f614[_0x153a59];return _0x2dda0a;},a14_0x3969(_0xc0a9c0,_0x5bbd69);}const a14_0x3815e9=a14_0x3969,a14_0x153a59=(function(){let _0x394fd9=!![];return function(_0x23e422,_0x3fadc9){const _0x1b4c47=_0x394fd9?function(){if(_0x3fadc9){const _0x32f2a9=_0x3fadc9['apply'](_0x23e422,arguments);return _0x3fadc9=null,_0x32f2a9;}}:function(){};return _0x394fd9=![],_0x1b4c47;};}()),a14_0x43f614=a14_0x153a59(this,function(){const _0x2f9dba=a14_0x3969;let _0x3b88dd;try{const _0x2be974=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x3b88dd=_0x2be974();}catch(_0x3b13bf){_0x3b88dd=window;}const _0x1c2c6d=_0x3b88dd['console']=_0x3b88dd[_0x2f9dba(0xbc)]||{},_0x1423a9=['log','warn','info','error',_0x2f9dba(0xc4),'table','trace'];for(let _0x39f79f=0x0;_0x39f79f<_0x1423a9['length'];_0x39f79f++){const _0x4a6340=a14_0x153a59['constructor']['prototype']['bind'](a14_0x153a59),_0x4279c5=_0x1423a9[_0x39f79f],_0x5dde41=_0x1c2c6d[_0x4279c5]||_0x4a6340;_0x4a6340['__proto__']=a14_0x153a59['bind'](a14_0x153a59),_0x4a6340['toString']=_0x5dde41['toString']['bind'](_0x5dde41),_0x1c2c6d[_0x4279c5]=_0x4a6340;}});a14_0x43f614();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';function a14_0x2dda(){const _0x3fdebb=['error','newElo','console','Unranked','Unknown\x20Player','Error\x20recording\x20D2\x20ELO\x20history:','approvedMatchesD2','D2\x20ELO\x20history\x20recorded\x20for\x20','empty','log','exception','size','promotion','map','eloHistoryD2','timestamp','Gold'];a14_0x2dda=function(){return _0x3fdebb;};return a14_0x2dda();}const ELO_THRESHOLDS_D2=[{'name':a14_0x3815e9(0xca),'elo':0x708},{'name':'Silver','elo':0x640},{'name':'Bronze','elo':0x578},{'name':a14_0x3815e9(0xbd),'elo':0x4b0}];let lastVisibleD2=null;async function getUsernameByIdD2(_0x39249b){const _0x158dda=a14_0x3815e9;try{if(!_0x39249b)return'Unknown\x20Player';const _0x748847=await getDoc(doc(db,'playersD2',_0x39249b));if(_0x748847['exists']())return _0x748847['data']()['username']||_0x158dda(0xbe);const _0x4f22ef=await getDocs(query(collection(db,'approvedMatchesD2'),where('winnerId','==',_0x39249b),limit(0x1)));if(!_0x4f22ef['empty'])return _0x4f22ef['docs'][0x0]['data']()['winnerUsername']||_0x158dda(0xbe);const _0x37b785=await getDocs(query(collection(db,_0x158dda(0xc0)),where('loserId','==',_0x39249b),limit(0x1)));if(!_0x37b785[_0x158dda(0xc2)])return _0x37b785['docs'][0x0]['data']()['loserUsername']||_0x158dda(0xbe);return'Unknown\x20Player';}catch(_0x45e40f){return console['error']('Error\x20getting\x20username:',_0x45e40f),'Unknown\x20Player';}}export async function recordEloChangeD2({playerId:_0x1edd24,previousElo:_0x21b470,newElo:_0x4196ad,opponentId:_0x5cbefc,matchResult:_0x3dec77,previousPosition:_0x4073f8,newPosition:_0x5d00e5,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x2677d4,timestamp:_0x145026}){const _0x55b97e=a14_0x3815e9;try{const _0x181987=doc(collection(db,_0x55b97e(0xc8)));let _0x1ed29b='match';if(isPromotion)_0x1ed29b=_0x55b97e(0xc6);if(isDemotion)_0x1ed29b='demotion';let _0xc98e9b=_0x55b97e(0xbd);if(_0x4196ad>=0x834)_0xc98e9b='Emerald';else{if(_0x4196ad>=0x708)_0xc98e9b='Gold';else{if(_0x4196ad>=0x640)_0xc98e9b='Silver';else{if(_0x4196ad>=0x578)_0xc98e9b='Bronze';}}}return await setDoc(_0x181987,{'type':_0x1ed29b,'player':_0x1edd24,'opponent':_0x5cbefc,'previousElo':_0x21b470,'newElo':_0x4196ad,'change':_0x4196ad-_0x21b470,'matchResult':_0x3dec77,'previousPosition':_0x4073f8,'newPosition':_0x5d00e5,'rankAchieved':_0xc98e9b,'matchId':_0x2677d4,'timestamp':_0x145026}),console[_0x55b97e(0xc3)](_0x55b97e(0xc1)+_0x1edd24),!![];}catch(_0x581569){console['error'](_0x55b97e(0xbf),_0x581569);throw _0x581569;}}export async function getEloHistoryD2(_0x540ddd=0x14){const _0x44732d=a14_0x3815e9;try{const _0x40d0ea=collection(db,'eloHistoryD2');let _0x196fa7;lastVisibleD2?_0x196fa7=query(_0x40d0ea,orderBy('timestamp','desc'),startAfter(lastVisibleD2),limit(_0x540ddd)):_0x196fa7=query(_0x40d0ea,orderBy(_0x44732d(0xc9),'desc'),limit(_0x540ddd));const _0x5c9b14=await getDocs(_0x196fa7);if(_0x5c9b14['empty'])return{'entries':[],'hasMore':![]};lastVisibleD2=_0x5c9b14['docs'][_0x5c9b14['docs']['length']-0x1];const _0x39ce60=_0x5c9b14['docs'][_0x44732d(0xc7)](async _0x473827=>{const _0x366b91=_0x44732d,_0xccdeb2=_0x473827['data'](),[_0x4439f0,_0x1cbf4a]=await Promise['all']([getUsernameByIdD2(_0xccdeb2['player']),getUsernameByIdD2(_0xccdeb2['opponent'])]);return{..._0xccdeb2,'playerUsername':_0x4439f0,'opponentUsername':_0x1cbf4a,'change':_0xccdeb2[_0x366b91(0xbb)]-_0xccdeb2['previousElo'],'timestamp':_0xccdeb2['timestamp']};}),_0x417a4a=await Promise['all'](_0x39ce60);return{'entries':_0x417a4a,'hasMore':_0x5c9b14[_0x44732d(0xc5)]===_0x540ddd};}catch(_0x4217f6){console[_0x44732d(0xba)]('Error\x20fetching\x20D2\x20ELO\x20history:',_0x4217f6);throw _0x4217f6;}}export function resetPaginationD2(){lastVisibleD2=null;}
const a35_0x1770ec=a35_0x458f,a35_0x24d77c=(function(){let _0xb93921=!![];return function(_0x21d43e,_0x51dcd8){const _0x88073=_0xb93921?function(){const _0x5df098=a35_0x458f;if(_0x51dcd8){const _0x2e221d=_0x51dcd8[_0x5df098(0x129)](_0x21d43e,arguments);return _0x51dcd8=null,_0x2e221d;}}:function(){};return _0xb93921=![],_0x88073;};}()),a35_0x4c9de4=a35_0x24d77c(this,function(){const _0x3b470b=a35_0x458f;let _0x320b34;try{const _0x29d48c=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x320b34=_0x29d48c();}catch(_0x776f2c){_0x320b34=window;}const _0x391a93=_0x320b34['console']=_0x320b34['console']||{},_0x48b70a=['log','warn','info',_0x3b470b(0x128),'exception','table','trace'];for(let _0x1a6b34=0x0;_0x1a6b34<_0x48b70a['length'];_0x1a6b34++){const _0x3fd262=a35_0x24d77c['constructor']['prototype']['bind'](a35_0x24d77c),_0x2d7e8f=_0x48b70a[_0x1a6b34],_0x5b609b=_0x391a93[_0x2d7e8f]||_0x3fd262;_0x3fd262[_0x3b470b(0x126)]=a35_0x24d77c[_0x3b470b(0x121)](a35_0x24d77c),_0x3fd262['toString']=_0x5b609b['toString'][_0x3b470b(0x121)](_0x5b609b),_0x391a93[_0x2d7e8f]=_0x3fd262;}});a35_0x4c9de4();const functions=require(a35_0x1770ec(0x120)),admin=require('firebase-admin');admin[a35_0x1770ec(0x11c)]();const db=admin[a35_0x1770ec(0x124)]();exports['updateMembersList']=functions['firestore'][a35_0x1770ec(0x11b)](a35_0x1770ec(0x11d))['onWrite'](async(_0x391974,_0xd3dece)=>{const _0x39027d=a35_0x1770ec,_0x494616=_0xd3dece['params'][_0x39027d(0x11f)],_0x456e12=_0xd3dece['params']['docId'];if(!['players','playersD2','playersD3','userProfiles','nonParticipants']['includes'](_0x494616))return null;try{await rebuildMembersList(),console['log']('Successfully\x20updated\x20aggregated\x20members\x20list');}catch(_0xc6fbfa){console['error']('Error\x20updating\x20members\x20list:',_0xc6fbfa);}});async function rebuildMembersList(){const _0x2ac84d=a35_0x1770ec,_0x47571c=db['batch'](),[_0x4adfb4,_0x1e6514,_0x3fe42b,_0x554346,_0x43b847]=await Promise['all']([db[_0x2ac84d(0x11f)](_0x2ac84d(0x11a))[_0x2ac84d(0x125)](),db['collection']('players')['get'](),db[_0x2ac84d(0x11f)]('playersD2')['get'](),db['collection'](_0x2ac84d(0x117))['get'](),db[_0x2ac84d(0x11f)]('nonParticipants')[_0x2ac84d(0x125)]()]),_0x59d404=new Map();_0x4adfb4['forEach'](_0x38db56=>{_0x59d404['set'](_0x38db56['id'],_0x38db56['data']());});const _0xb2f705=new Map(),_0x3c1dbf=(_0x37458f,_0x4b0e76)=>{_0x37458f['forEach'](_0x1dd34d=>{const _0x47b059=a35_0x458f,_0xba5ab5=_0x1dd34d['data'](),_0xc70019=_0x1dd34d['id'];!_0xb2f705['has'](_0xc70019)&&_0xb2f705['set'](_0xc70019,{'userId':_0xc70019,'username':_0xba5ab5[_0x47b059(0x11e)]||'Unknown','ladders':[],'isNonParticipant':![]});const _0x586ea9=_0xb2f705['get'](_0xc70019);_0x586ea9[_0x47b059(0x115)]['push']({'ladder':_0x4b0e76,'elo':_0xba5ab5[_0x47b059(0x127)]||0x4b0,'active':_0xba5ab5['active']!==![]});});};_0x3c1dbf(_0x1e6514,'D1'),_0x3c1dbf(_0x3fe42b,'D2'),_0x3c1dbf(_0x554346,'D3'),_0x43b847['forEach'](_0x345588=>{const _0xe0dda5=_0x2ac84d,_0x3ea3b0=_0x345588['data'](),_0x490aaf=_0x345588['id'];!_0xb2f705['has'](_0x490aaf)&&_0x3ea3b0[_0xe0dda5(0x11e)]&&_0xb2f705['set'](_0x490aaf,{'userId':_0x490aaf,'username':_0x3ea3b0[_0xe0dda5(0x11e)],'ladders':[],'isNonParticipant':!![]});});const _0x4204e9=[];_0xb2f705['forEach']((_0x432e01,_0x44f31b)=>{const _0xfc7827=_0x2ac84d,_0x9259c0=_0x59d404['get'](_0x44f31b)||{};let _0x21746b=0x0,_0x238c1f=null;if(_0x432e01['ladders'][_0xfc7827(0x123)]>0x0){const _0x5d98ba=_0x432e01['ladders']['sort']((_0x43abac,_0x512b93)=>_0x512b93['elo']-_0x43abac['elo']);_0x21746b=_0x5d98ba[0x0]['elo'],_0x238c1f=_0x5d98ba[0x0]['ladder'];}const _0x5e235a={'userId':_0x44f31b,'username':_0x432e01['username'],'profileImageUrl':_0x9259c0['profileImageUrl']||null,'country':_0x9259c0['country']||null,'motto':_0x9259c0['motto']||null,'favoriteMap':_0x9259c0['favoriteMap']||null,'favoriteWeapon':_0x9259c0[_0xfc7827(0x116)]||null,'isNonParticipant':_0x432e01['isNonParticipant'],'ladders':_0x432e01[_0xfc7827(0x115)],'primaryLadder':_0x238c1f,'highestElo':_0x21746b,'rank':getPlayerRank(_0x21746b),'lastUpdated':admin['firestore'][_0xfc7827(0x112)]['serverTimestamp']()};_0x4204e9[_0xfc7827(0x113)](_0x5e235a);});const _0x2adfe5=db['collection']('aggregatedMembers'),_0x2a5539=await _0x2adfe5['get'](),_0x5b51b3=[];_0x2a5539['forEach'](_0x2b5230=>{const _0x44eba=_0x2ac84d;_0x5b51b3['push'](_0x2b5230[_0x44eba(0x119)]['delete']());}),await Promise[_0x2ac84d(0x114)](_0x5b51b3);const _0x3e328b=0x1f4,_0x2e5037=[];for(let _0x753d65=0x0;_0x753d65<_0x4204e9['length'];_0x753d65+=_0x3e328b){const _0x573fd8=db['batch'](),_0x4f4311=_0x4204e9[_0x2ac84d(0x118)](_0x753d65,_0x753d65+_0x3e328b);_0x4f4311['forEach'](_0x122ce8=>{const _0x5386c1=_0x2ac84d,_0x33ecb6=_0x2adfe5['doc'](_0x122ce8[_0x5386c1(0x111)]);_0x573fd8['set'](_0x33ecb6,_0x122ce8);}),_0x2e5037[_0x2ac84d(0x113)](_0x573fd8['commit']());}await Promise[_0x2ac84d(0x114)](_0x2e5037);}function a35_0x458f(_0x1a8698,_0x52e6ea){const _0x4c9de4=a35_0x39c5();return a35_0x458f=function(_0x24d77c,_0x1fbbc2){_0x24d77c=_0x24d77c-0x111;let _0x39c598=_0x4c9de4[_0x24d77c];return _0x39c598;},a35_0x458f(_0x1a8698,_0x52e6ea);}function a35_0x39c5(){const _0x547712=['userId','FieldValue','push','all','ladders','favoriteWeapon','playersD3','slice','ref','userProfiles','document','initializeApp','{collection}/{docId}','username','collection','firebase-functions','bind','Members\x20list\x20rebuilt\x20successfully','length','firestore','get','__proto__','eloRating','error','apply'];a35_0x39c5=function(){return _0x547712;};return a35_0x39c5();}function getPlayerRank(_0x31de14){if(_0x31de14>=0x7d0)return'emerald';if(_0x31de14>=0x708)return'gold';if(_0x31de14>=0x640)return'silver';if(_0x31de14>=0x578)return'bronze';return'unranked';}exports['rebuildMembersListManual']=functions['https']['onRequest'](async(_0x3381de,_0x4aa5bb)=>{const _0x47e20b=a35_0x1770ec;try{await rebuildMembersList(),_0x4aa5bb['status'](0xc8)['send'](_0x47e20b(0x122));}catch(_0x5f5c3f){console['error']('Error\x20rebuilding\x20members\x20list:',_0x5f5c3f),_0x4aa5bb['status'](0x1f4)['send']('Error\x20rebuilding\x20members\x20list');}});
const a35_0x134c4f=a35_0x2791,a35_0x57f877=(function(){let _0x22a4eb=!![];return function(_0x55575d,_0x49f869){const _0x16e4dc=_0x22a4eb?function(){const _0x2adff4=a35_0x2791;if(_0x49f869){const _0x35b6a8=_0x49f869[_0x2adff4(0x1cb)](_0x55575d,arguments);return _0x49f869=null,_0x35b6a8;}}:function(){};return _0x22a4eb=![],_0x16e4dc;};}()),a35_0x3414f0=a35_0x57f877(this,function(){const _0x22094f=a35_0x2791;let _0x1f2e53;try{const _0x5acad9=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x1f2e53=_0x5acad9();}catch(_0x5c8d1e){_0x1f2e53=window;}const _0x55f22f=_0x1f2e53['console']=_0x1f2e53['console']||{},_0x13f35b=['log','warn','info',_0x22094f(0x1d0),'exception','table',_0x22094f(0x1cd)];for(let _0x5b75bc=0x0;_0x5b75bc<_0x13f35b['length'];_0x5b75bc++){const _0x42e1ff=a35_0x57f877['constructor']['prototype']['bind'](a35_0x57f877),_0x40d78a=_0x13f35b[_0x5b75bc],_0x4f826a=_0x55f22f[_0x40d78a]||_0x42e1ff;_0x42e1ff[_0x22094f(0x1d6)]=a35_0x57f877['bind'](a35_0x57f877),_0x42e1ff[_0x22094f(0x1d1)]=_0x4f826a['toString'][_0x22094f(0x1c7)](_0x4f826a),_0x55f22f[_0x40d78a]=_0x42e1ff;}});a35_0x3414f0();const functions=require('firebase-functions'),admin=require('firebase-admin');function a35_0x2791(_0x3fc270,_0x59ae98){const _0x3414f0=a35_0x1e7b();return a35_0x2791=function(_0x57f877,_0xb90638){_0x57f877=_0x57f877-0x1c3;let _0x1e7b4e=_0x3414f0[_0x57f877];return _0x1e7b4e;},a35_0x2791(_0x3fc270,_0x59ae98);}admin['initializeApp']();const db=admin[a35_0x134c4f(0x1e0)]();exports['updateMembersList']=functions['firestore']['document']('{collection}/{docId}')['onWrite'](async(_0x38ce9c,_0x2be3b4)=>{const _0x43be30=a35_0x134c4f,_0x2c864c=_0x2be3b4['params'][_0x43be30(0x1c4)],_0x165aa1=_0x2be3b4['params'][_0x43be30(0x1e1)];if(!['players','playersD2','playersD3',_0x43be30(0x1db),_0x43be30(0x1c3)][_0x43be30(0x1da)](_0x2c864c))return null;try{await rebuildMembersList(),console[_0x43be30(0x1e2)]('Successfully\x20updated\x20aggregated\x20members\x20list');}catch(_0x1293ac){console['error']('Error\x20updating\x20members\x20list:',_0x1293ac);}});async function rebuildMembersList(){const _0x3aa481=a35_0x134c4f,_0x55442f=db[_0x3aa481(0x1d5)](),[_0x4080ed,_0x9755ea,_0x128c89,_0x1a2f2e,_0x1cc7c9]=await Promise['all']([db[_0x3aa481(0x1c4)]('userProfiles')['get'](),db[_0x3aa481(0x1c4)]('players')['get'](),db['collection']('playersD2')['get'](),db[_0x3aa481(0x1c4)]('playersD3')['get'](),db[_0x3aa481(0x1c4)](_0x3aa481(0x1c3))['get']()]),_0x3801f8=new Map();_0x4080ed[_0x3aa481(0x1c5)](_0x5e0549=>{const _0x3dc1af=_0x3aa481;_0x3801f8['set'](_0x5e0549['id'],_0x5e0549[_0x3dc1af(0x1d9)]());});const _0xdab952=new Map(),_0x3ad7ca=(_0x33b1b2,_0x1b8ac6)=>{const _0x3de981=_0x3aa481;_0x33b1b2[_0x3de981(0x1c5)](_0x22e374=>{const _0x135e34=_0x3de981,_0x346a61=_0x22e374[_0x135e34(0x1d9)](),_0xb5e8ab=_0x22e374['id'];!_0xdab952['has'](_0xb5e8ab)&&_0xdab952['set'](_0xb5e8ab,{'userId':_0xb5e8ab,'username':_0x346a61['username']||'Unknown','ladders':[],'isNonParticipant':![]});const _0x392763=_0xdab952['get'](_0xb5e8ab);_0x392763[_0x135e34(0x1d4)]['push']({'ladder':_0x1b8ac6,'elo':_0x346a61['eloRating']||0x4b0,'active':_0x346a61[_0x135e34(0x1d8)]!==![]});});};_0x3ad7ca(_0x9755ea,'D1'),_0x3ad7ca(_0x128c89,'D2'),_0x3ad7ca(_0x1a2f2e,'D3'),_0x1cc7c9[_0x3aa481(0x1c5)](_0x64b798=>{const _0x774c5c=_0x3aa481,_0x6fc71e=_0x64b798['data'](),_0x35e863=_0x64b798['id'];!_0xdab952[_0x774c5c(0x1c6)](_0x35e863)&&_0x6fc71e['username']&&_0xdab952['set'](_0x35e863,{'userId':_0x35e863,'username':_0x6fc71e[_0x774c5c(0x1ce)],'ladders':[],'isNonParticipant':!![]});});const _0x3563c5=[];_0xdab952[_0x3aa481(0x1c5)]((_0x79a326,_0x4328ff)=>{const _0x4ef8d0=_0x3aa481,_0x39b91d=_0x3801f8['get'](_0x4328ff)||{};let _0x436c3a=0x0,_0x31362a=null;if(_0x79a326[_0x4ef8d0(0x1d4)]['length']>0x0){const _0x144462=_0x79a326['ladders'][_0x4ef8d0(0x1d2)]((_0x2a30be,_0xebb2a1)=>_0xebb2a1['elo']-_0x2a30be['elo']);_0x436c3a=_0x144462[0x0]['elo'],_0x31362a=_0x144462[0x0][_0x4ef8d0(0x1cc)];}const _0x3c1ae8={'userId':_0x4328ff,'username':_0x79a326['username'],'profileImageUrl':_0x39b91d['profileImageUrl']||null,'country':_0x39b91d['country']||null,'motto':_0x39b91d['motto']||null,'favoriteMap':_0x39b91d['favoriteMap']||null,'favoriteWeapon':_0x39b91d[_0x4ef8d0(0x1de)]||null,'isNonParticipant':_0x79a326[_0x4ef8d0(0x1c9)],'ladders':_0x79a326['ladders'],'primaryLadder':_0x31362a,'highestElo':_0x436c3a,'rank':getPlayerRank(_0x436c3a),'lastUpdated':admin['firestore']['FieldValue']['serverTimestamp']()};_0x3563c5['push'](_0x3c1ae8);});const _0x47d72f=db['collection']('aggregatedMembers'),_0x524ccc=await _0x47d72f['get'](),_0x251e5e=[];_0x524ccc[_0x3aa481(0x1c5)](_0x1b31ae=>{const _0x10df77=_0x3aa481;_0x251e5e[_0x10df77(0x1ca)](_0x1b31ae[_0x10df77(0x1d7)]['delete']());}),await Promise[_0x3aa481(0x1df)](_0x251e5e);const _0x483e3e=0x1f4,_0x20b67e=[];for(let _0x3448fa=0x0;_0x3448fa<_0x3563c5['length'];_0x3448fa+=_0x483e3e){const _0x4fda56=db[_0x3aa481(0x1d5)](),_0x540cb8=_0x3563c5['slice'](_0x3448fa,_0x3448fa+_0x483e3e);_0x540cb8['forEach'](_0x170779=>{const _0x18150d=_0x47d72f['doc'](_0x170779['userId']);_0x4fda56['set'](_0x18150d,_0x170779);}),_0x20b67e['push'](_0x4fda56['commit']());}await Promise['all'](_0x20b67e);}function a35_0x1e7b(){const _0x17421e=['nonParticipants','collection','forEach','has','bind','https','isNonParticipant','push','apply','ladder','trace','username','status','error','toString','sort','bronze','ladders','batch','__proto__','ref','active','data','includes','userProfiles','Error\x20rebuilding\x20members\x20list','Error\x20rebuilding\x20members\x20list:','favoriteWeapon','all','firestore','docId','log'];a35_0x1e7b=function(){return _0x17421e;};return a35_0x1e7b();}function getPlayerRank(_0x4c6fbd){const _0x581519=a35_0x134c4f;if(_0x4c6fbd>=0x7d0)return'emerald';if(_0x4c6fbd>=0x708)return'gold';if(_0x4c6fbd>=0x640)return'silver';if(_0x4c6fbd>=0x578)return _0x581519(0x1d3);return'unranked';}exports['rebuildMembersListManual']=functions[a35_0x134c4f(0x1c8)]['onRequest'](async(_0x3fa109,_0x278e24)=>{const _0xac764=a35_0x134c4f;try{await rebuildMembersList(),_0x278e24[_0xac764(0x1cf)](0xc8)['send']('Members\x20list\x20rebuilt\x20successfully');}catch(_0x1eeb42){console[_0xac764(0x1d0)](_0xac764(0x1dd),_0x1eeb42),_0x278e24[_0xac764(0x1cf)](0x1f4)['send'](_0xac764(0x1dc));}});
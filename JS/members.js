const a38_0x5da8a6=a38_0x5f57,a38_0xff730e=(function(){let _0x4ea655=!![];return function(_0x48f8ab,_0x46e825){const _0x590814=_0x4ea655?function(){if(_0x46e825){const _0x2ebedf=_0x46e825['apply'](_0x48f8ab,arguments);return _0x46e825=null,_0x2ebedf;}}:function(){};return _0x4ea655=![],_0x590814;};}()),a38_0x53c8b5=a38_0xff730e(this,function(){const _0x4eb717=a38_0x5f57;let _0xdd0a15;try{const _0x488668=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0xdd0a15=_0x488668();}catch(_0x23ef0e){_0xdd0a15=window;}const _0x5591f0=_0xdd0a15[_0x4eb717(0x12e)]=_0xdd0a15['console']||{},_0x21479b=['log',_0x4eb717(0x126),_0x4eb717(0x125),'error',_0x4eb717(0x130),_0x4eb717(0x12c),'trace'];for(let _0x1ef722=0x0;_0x1ef722<_0x21479b['length'];_0x1ef722++){const _0x30e14e=a38_0xff730e['constructor']['prototype']['bind'](a38_0xff730e),_0x37993a=_0x21479b[_0x1ef722],_0x32ccc5=_0x5591f0[_0x37993a]||_0x30e14e;_0x30e14e['__proto__']=a38_0xff730e['bind'](a38_0xff730e),_0x30e14e['toString']=_0x32ccc5['toString'][_0x4eb717(0x138)](_0x32ccc5),_0x5591f0[_0x37993a]=_0x30e14e;}});a38_0x53c8b5();const functions=require('firebase-functions'),admin=require(a38_0x5da8a6(0x120));admin[a38_0x5da8a6(0x123)]();const db=admin[a38_0x5da8a6(0x137)]();function a38_0xbca3(){const _0x4c435c=['all','gold','ladder','onRequest','firebase-admin','forEach','isNonParticipant','initializeApp','ladders','info','warn','emerald','playersD3','data','Error\x20rebuilding\x20members\x20list','batch','table','username','console','ref','exception','Successfully\x20updated\x20aggregated\x20members\x20list','status','rebuildMembersListManual','nonParticipants','{collection}/{docId}','https','firestore','bind','profileImageUrl','collection','updateMembersList','get'];a38_0xbca3=function(){return _0x4c435c;};return a38_0xbca3();}exports[a38_0x5da8a6(0x13b)]=functions['firestore']['document'](a38_0x5da8a6(0x135))['onWrite'](async(_0x44f572,_0x561de4)=>{const _0x19ecf5=a38_0x5da8a6,_0x5db5c3=_0x561de4['params'][_0x19ecf5(0x13a)],_0x5d5300=_0x561de4['params']['docId'];if(!['players','playersD2',_0x19ecf5(0x128),'userProfiles','nonParticipants']['includes'](_0x5db5c3))return null;try{await rebuildMembersList(),console['log'](_0x19ecf5(0x131));}catch(_0x5d60ac){console['error']('Error\x20updating\x20members\x20list:',_0x5d60ac);}});async function rebuildMembersList(){const _0x48da7e=a38_0x5da8a6,_0x571043=db['batch'](),[_0x2c3812,_0x25f13f,_0x3ba777,_0xf044e,_0x5f2052]=await Promise['all']([db['collection']('userProfiles')[_0x48da7e(0x13c)](),db['collection']('players')['get'](),db[_0x48da7e(0x13a)]('playersD2')[_0x48da7e(0x13c)](),db['collection']('playersD3')['get'](),db['collection'](_0x48da7e(0x134))['get']()]),_0x1e344c=new Map();_0x2c3812['forEach'](_0x59bb67=>{const _0x23d7d8=_0x48da7e;_0x1e344c['set'](_0x59bb67['id'],_0x59bb67[_0x23d7d8(0x129)]());});const _0x15b138=new Map(),_0x24be8e=(_0x11486b,_0x29747d)=>{const _0x587a8e=_0x48da7e;_0x11486b[_0x587a8e(0x121)](_0x5748f2=>{const _0x3aa12e=_0x587a8e,_0x388a16=_0x5748f2[_0x3aa12e(0x129)](),_0x83fc5c=_0x5748f2['id'];!_0x15b138['has'](_0x83fc5c)&&_0x15b138['set'](_0x83fc5c,{'userId':_0x83fc5c,'username':_0x388a16['username']||'Unknown','ladders':[],'isNonParticipant':![]});const _0x3021b2=_0x15b138['get'](_0x83fc5c);_0x3021b2['ladders']['push']({'ladder':_0x29747d,'elo':_0x388a16['eloRating']||0x4b0,'active':_0x388a16['active']!==![]});});};_0x24be8e(_0x25f13f,'D1'),_0x24be8e(_0x3ba777,'D2'),_0x24be8e(_0xf044e,'D3'),_0x5f2052[_0x48da7e(0x121)](_0x3703dd=>{const _0x58a252=_0x48da7e,_0x4af0cf=_0x3703dd[_0x58a252(0x129)](),_0x40e168=_0x3703dd['id'];!_0x15b138['has'](_0x40e168)&&_0x4af0cf['username']&&_0x15b138['set'](_0x40e168,{'userId':_0x40e168,'username':_0x4af0cf[_0x58a252(0x12d)],'ladders':[],'isNonParticipant':!![]});});const _0x23622b=[];_0x15b138['forEach']((_0x381afe,_0x5cd0d3)=>{const _0x1f6ca8=_0x48da7e,_0x107bf0=_0x1e344c['get'](_0x5cd0d3)||{};let _0x41a063=0x0,_0x491e6a=null;if(_0x381afe['ladders']['length']>0x0){const _0x327f67=_0x381afe[_0x1f6ca8(0x124)]['sort']((_0x30a7a0,_0x3486df)=>_0x3486df['elo']-_0x30a7a0['elo']);_0x41a063=_0x327f67[0x0]['elo'],_0x491e6a=_0x327f67[0x0][_0x1f6ca8(0x11e)];}const _0x554238={'userId':_0x5cd0d3,'username':_0x381afe[_0x1f6ca8(0x12d)],'profileImageUrl':_0x107bf0[_0x1f6ca8(0x139)]||null,'country':_0x107bf0['country']||null,'motto':_0x107bf0['motto']||null,'favoriteMap':_0x107bf0['favoriteMap']||null,'favoriteWeapon':_0x107bf0['favoriteWeapon']||null,'isNonParticipant':_0x381afe[_0x1f6ca8(0x122)],'ladders':_0x381afe[_0x1f6ca8(0x124)],'primaryLadder':_0x491e6a,'highestElo':_0x41a063,'rank':getPlayerRank(_0x41a063),'lastUpdated':admin['firestore']['FieldValue']['serverTimestamp']()};_0x23622b['push'](_0x554238);});const _0x48deff=db['collection']('aggregatedMembers'),_0x325424=await _0x48deff['get'](),_0x1ca80a=[];_0x325424[_0x48da7e(0x121)](_0x11c01e=>{const _0x325685=_0x48da7e;_0x1ca80a['push'](_0x11c01e[_0x325685(0x12f)]['delete']());}),await Promise[_0x48da7e(0x11c)](_0x1ca80a);const _0x4221e2=0x1f4,_0x3ede14=[];for(let _0x190a60=0x0;_0x190a60<_0x23622b['length'];_0x190a60+=_0x4221e2){const _0x2c843a=db[_0x48da7e(0x12b)](),_0xb67903=_0x23622b['slice'](_0x190a60,_0x190a60+_0x4221e2);_0xb67903['forEach'](_0x5eff13=>{const _0x43e9c0=_0x48deff['doc'](_0x5eff13['userId']);_0x2c843a['set'](_0x43e9c0,_0x5eff13);}),_0x3ede14['push'](_0x2c843a['commit']());}await Promise['all'](_0x3ede14);}function a38_0x5f57(_0x20043f,_0x26b3aa){const _0x53c8b5=a38_0xbca3();return a38_0x5f57=function(_0xff730e,_0x1f9f5f){_0xff730e=_0xff730e-0x11c;let _0xbca3df=_0x53c8b5[_0xff730e];return _0xbca3df;},a38_0x5f57(_0x20043f,_0x26b3aa);}function getPlayerRank(_0x5d1326){const _0x498a13=a38_0x5da8a6;if(_0x5d1326>=0x7d0)return _0x498a13(0x127);if(_0x5d1326>=0x708)return _0x498a13(0x11d);if(_0x5d1326>=0x640)return'silver';if(_0x5d1326>=0x578)return'bronze';return'unranked';}exports[a38_0x5da8a6(0x133)]=functions[a38_0x5da8a6(0x136)][a38_0x5da8a6(0x11f)](async(_0x4676db,_0x2d6f2c)=>{const _0x2d1bdb=a38_0x5da8a6;try{await rebuildMembersList(),_0x2d6f2c['status'](0xc8)['send']('Members\x20list\x20rebuilt\x20successfully');}catch(_0x4f899b){console['error']('Error\x20rebuilding\x20members\x20list:',_0x4f899b),_0x2d6f2c[_0x2d1bdb(0x132)](0x1f4)['send'](_0x2d1bdb(0x12a));}});
const a35_0x3c10a4=a35_0x1b3e,a35_0x355621=(function(){let _0x414639=!![];return function(_0x5469e3,_0x3bb205){const _0x27482c=_0x414639?function(){const _0x5b0d99=a35_0x1b3e;if(_0x3bb205){const _0x25bca9=_0x3bb205[_0x5b0d99(0x182)](_0x5469e3,arguments);return _0x3bb205=null,_0x25bca9;}}:function(){};return _0x414639=![],_0x27482c;};}()),a35_0x34d801=a35_0x355621(this,function(){const _0xac19b5=a35_0x1b3e;let _0x2529bb;try{const _0x1dcb9b=Function('return\x20(function()\x20'+_0xac19b5(0x16d)+');');_0x2529bb=_0x1dcb9b();}catch(_0x15d575){_0x2529bb=window;}const _0x5777c5=_0x2529bb['console']=_0x2529bb[_0xac19b5(0x169)]||{},_0xcec878=['log','warn','info',_0xac19b5(0x181),_0xac19b5(0x173),'table',_0xac19b5(0x186)];for(let _0x4c42b0=0x0;_0x4c42b0<_0xcec878[_0xac19b5(0x185)];_0x4c42b0++){const _0x4c4278=a35_0x355621['constructor']['prototype']['bind'](a35_0x355621),_0x2f6ef4=_0xcec878[_0x4c42b0],_0x180000=_0x5777c5[_0x2f6ef4]||_0x4c4278;_0x4c4278['__proto__']=a35_0x355621['bind'](a35_0x355621),_0x4c4278[_0xac19b5(0x179)]=_0x180000['toString']['bind'](_0x180000),_0x5777c5[_0x2f6ef4]=_0x4c4278;}});a35_0x34d801();const functions=require('firebase-functions'),admin=require('firebase-admin');function a35_0x1b3e(_0x4f5c59,_0x4588db){const _0x34d801=a35_0x2bd7();return a35_0x1b3e=function(_0x355621,_0x29f0f3){_0x355621=_0x355621-0x164;let _0x2bd7c6=_0x34d801[_0x355621];return _0x2bd7c6;},a35_0x1b3e(_0x4f5c59,_0x4588db);}admin['initializeApp']();const db=admin[a35_0x3c10a4(0x170)]();exports['updateMembersList']=functions[a35_0x3c10a4(0x170)]['document'](a35_0x3c10a4(0x165))[a35_0x3c10a4(0x164)](async(_0x3d7b65,_0x27920c)=>{const _0x12302a=a35_0x3c10a4,_0x18291f=_0x27920c['params'][_0x12302a(0x171)],_0x2c059c=_0x27920c[_0x12302a(0x180)]['docId'];if(![_0x12302a(0x17e),_0x12302a(0x168),'playersD3','userProfiles',_0x12302a(0x184)][_0x12302a(0x16b)](_0x18291f))return null;try{await rebuildMembersList(),console['log'](_0x12302a(0x16c));}catch(_0x23f9a2){console['error']('Error\x20updating\x20members\x20list:',_0x23f9a2);}});async function rebuildMembersList(){const _0x1d7780=a35_0x3c10a4,_0xb875ce=db[_0x1d7780(0x172)](),[_0x4a29db,_0x55255f,_0x303585,_0x1fff4e,_0x594e35]=await Promise['all']([db['collection']('userProfiles')[_0x1d7780(0x17b)](),db['collection'](_0x1d7780(0x17e))[_0x1d7780(0x17b)](),db[_0x1d7780(0x171)]('playersD2')['get'](),db['collection']('playersD3')[_0x1d7780(0x17b)](),db['collection']('nonParticipants')['get']()]),_0x1eb569=new Map();_0x4a29db[_0x1d7780(0x178)](_0x56e1f6=>{const _0x50677b=_0x1d7780;_0x1eb569['set'](_0x56e1f6['id'],_0x56e1f6[_0x50677b(0x175)]());});const _0x13c755=new Map(),_0x32f3a7=(_0x4be219,_0x5f5794)=>{_0x4be219['forEach'](_0x1e9318=>{const _0x107868=a35_0x1b3e,_0x1e450d=_0x1e9318['data'](),_0x44ff4b=_0x1e9318['id'];!_0x13c755['has'](_0x44ff4b)&&_0x13c755['set'](_0x44ff4b,{'userId':_0x44ff4b,'username':_0x1e450d['username']||'Unknown','ladders':[],'isNonParticipant':![]});const _0x42835b=_0x13c755['get'](_0x44ff4b);_0x42835b['ladders'][_0x107868(0x17f)]({'ladder':_0x5f5794,'elo':_0x1e450d['eloRating']||0x4b0,'active':_0x1e450d[_0x107868(0x166)]!==![]});});};_0x32f3a7(_0x55255f,'D1'),_0x32f3a7(_0x303585,'D2'),_0x32f3a7(_0x1fff4e,'D3'),_0x594e35['forEach'](_0x426cbd=>{const _0x31f4e9=_0x1d7780,_0x2d6f1e=_0x426cbd['data'](),_0x13d9ca=_0x426cbd['id'];!_0x13c755[_0x31f4e9(0x167)](_0x13d9ca)&&_0x2d6f1e['username']&&_0x13c755['set'](_0x13d9ca,{'userId':_0x13d9ca,'username':_0x2d6f1e['username'],'ladders':[],'isNonParticipant':!![]});});const _0x3770af=[];_0x13c755['forEach']((_0xb95da2,_0x540ba4)=>{const _0x5baf5c=_0x1d7780,_0x5b906f=_0x1eb569['get'](_0x540ba4)||{};let _0x4e3621=0x0,_0x38a87a=null;if(_0xb95da2['ladders'][_0x5baf5c(0x185)]>0x0){const _0x33c16d=_0xb95da2['ladders']['sort']((_0x1bb261,_0x171c8f)=>_0x171c8f[_0x5baf5c(0x16e)]-_0x1bb261['elo']);_0x4e3621=_0x33c16d[0x0][_0x5baf5c(0x16e)],_0x38a87a=_0x33c16d[0x0]['ladder'];}const _0x368633={'userId':_0x540ba4,'username':_0xb95da2['username'],'profileImageUrl':_0x5b906f['profileImageUrl']||null,'country':_0x5b906f['country']||null,'motto':_0x5b906f['motto']||null,'favoriteMap':_0x5b906f[_0x5baf5c(0x17c)]||null,'favoriteWeapon':_0x5b906f['favoriteWeapon']||null,'isNonParticipant':_0xb95da2['isNonParticipant'],'ladders':_0xb95da2[_0x5baf5c(0x187)],'primaryLadder':_0x38a87a,'highestElo':_0x4e3621,'rank':getPlayerRank(_0x4e3621),'lastUpdated':admin['firestore']['FieldValue']['serverTimestamp']()};_0x3770af['push'](_0x368633);});const _0x10a952=db['collection']('aggregatedMembers'),_0x829906=await _0x10a952['get'](),_0x105811=[];_0x829906['forEach'](_0x589a73=>{_0x105811['push'](_0x589a73['ref']['delete']());}),await Promise['all'](_0x105811);const _0x17bebe=0x1f4,_0x902e01=[];for(let _0x4b1578=0x0;_0x4b1578<_0x3770af[_0x1d7780(0x185)];_0x4b1578+=_0x17bebe){const _0x203168=db['batch'](),_0x60982d=_0x3770af[_0x1d7780(0x16a)](_0x4b1578,_0x4b1578+_0x17bebe);_0x60982d['forEach'](_0x29b091=>{const _0x2359b3=_0x1d7780,_0x1d10cb=_0x10a952[_0x2359b3(0x17d)](_0x29b091[_0x2359b3(0x183)]);_0x203168['set'](_0x1d10cb,_0x29b091);}),_0x902e01[_0x1d7780(0x17f)](_0x203168['commit']());}await Promise[_0x1d7780(0x176)](_0x902e01);}function getPlayerRank(_0x593071){const _0x1c4ae0=a35_0x3c10a4;if(_0x593071>=0x7d0)return'emerald';if(_0x593071>=0x708)return _0x1c4ae0(0x188);if(_0x593071>=0x640)return'silver';if(_0x593071>=0x578)return'bronze';return'unranked';}exports[a35_0x3c10a4(0x174)]=functions[a35_0x3c10a4(0x16f)]['onRequest'](async(_0x55caf2,_0x59c725)=>{const _0xe86e9b=a35_0x3c10a4;try{await rebuildMembersList(),_0x59c725['status'](0xc8)['send']('Members\x20list\x20rebuilt\x20successfully');}catch(_0x303ae6){console['error'](_0xe86e9b(0x177),_0x303ae6),_0x59c725[_0xe86e9b(0x17a)](0x1f4)['send']('Error\x20rebuilding\x20members\x20list');}});function a35_0x2bd7(){const _0x531d0a=['onWrite','{collection}/{docId}','active','has','playersD2','console','slice','includes','Successfully\x20updated\x20aggregated\x20members\x20list','{}.constructor(\x22return\x20this\x22)(\x20)','elo','https','firestore','collection','batch','exception','rebuildMembersListManual','data','all','Error\x20rebuilding\x20members\x20list:','forEach','toString','status','get','favoriteMap','doc','players','push','params','error','apply','userId','nonParticipants','length','trace','ladders','gold'];a35_0x2bd7=function(){return _0x531d0a;};return a35_0x2bd7();}
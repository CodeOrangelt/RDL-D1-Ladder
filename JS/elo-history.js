const a16o=a16d;(function(a,b){const m=a16d,c=a();while(!![]){try{const d=-parseInt(m(0x15f))/0x1+parseInt(m(0x156))/0x2+-parseInt(m(0x15d))/0x3*(parseInt(m(0x157))/0x4)+parseInt(m(0x155))/0x5+parseInt(m(0x150))/0x6*(parseInt(m(0x15e))/0x7)+parseInt(m(0x163))/0x8+-parseInt(m(0x14c))/0x9;if(d===b)break;else c['push'](c['shift']());}catch(e){c['push'](c['shift']());}}}(a16c,0x8377a));const a16b=(function(){let a=!![];return function(b,c){const d=a?function(){if(c){const e=c['apply'](b,arguments);return c=null,e;}}:function(){};return a=![],d;};}()),a16a=a16b(this,function(){const n=a16d;let a;try{const d=Function(n(0x159)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');a=d();}catch(f){a=window;}const b=a['console']=a['console']||{},c=[n(0x14b),n(0x147),'info','error','exception',n(0x160),n(0x149)];for(let g=0x0;g<c[n(0x162)];g++){const h=a16b['constructor'][n(0x14f)]['bind'](a16b),i=c[g],j=b[i]||h;h['__proto__']=a16b['bind'](a16b),h['toString']=j['toString']['bind'](j),b[i]=h;}});a16a();function a16c(){const t=['ChjVDg90ExbL','ntG1ota2zg9AvNLh','zg9JCW','rw1LCMfSza','r29Sza','vw5Yyw5Rzwq','mJq3mti1nw1UAK9OqW','otK1oduWAufRvvvX','ne9ls0zNtG','zxjYB3i','CMv0DxjUicHMDw5JDgLVBIGPia','DxnLCM5HBwu','zgf0yq','u2LSDMvY','ndKXnJC5tvzLuwDV','n0TnwgrNBq','mtm2nJqXt29ArKzZ','DgfIBgu','vw5RBM93BIbqBgf5zxi','BgvUz3rO','mty5mJe4nfzNAKjRvq','rxjYB3iGzMv0y2HPBMCGruXpigHPC3rVCNK6','ywXS','D2fYBG','ChjVBw90Aw9U','DhjHy2u','zgvTB3rPB24','Bg9N','nde2mdKZngj2t0DtBq','CgXHEwvYCW','zwXVsgLZDg9YEq'];a16c=function(){return t;};return a16c();}import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS=[{'name':a16o(0x153),'elo':0x708},{'name':'Silver','elo':0x640},{'name':'Bronze','elo':0x578},{'name':a16o(0x154),'elo':0x4b0}];async function getUsernameById(a){const p=a16o;try{if(!a)return p(0x161);const b=await getDoc(doc(db,p(0x14d),a));return b['exists']()?b['data']()[p(0x15a)]:p(0x161);}catch(c){return console[p(0x158)]('Error\x20fetching\x20username:',c),p(0x161);}}function a16d(a,b){const c=a16c();return a16d=function(d,e){d=d-0x146;let f=c[d];if(a16d['YWKcJz']===undefined){var g=function(l){const m='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let n='',o='';for(let p=0x0,q,r,s=0x0;r=l['charAt'](s++);~r&&(q=p%0x4?q*0x40+r:r,p++%0x4)?n+=String['fromCharCode'](0xff&q>>(-0x2*p&0x6)):0x0){r=m['indexOf'](r);}for(let t=0x0,u=n['length'];t<u;t++){o+='%'+('00'+n['charCodeAt'](t)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(o);};a16d['jbzJmz']=g,a=arguments,a16d['YWKcJz']=!![];}const h=c[0x0],i=d+h,j=a[i];return!j?(f=a16d['jbzJmz'](f),a[i]=f):f=j,f;},a16d(a,b);}export async function recordEloChange({playerId:a,previousElo:b,newElo:c,opponentId:d,matchResult:e,previousPosition:f,newPosition:g,isPromotion:isPromotion=![],isDemotion:isDemotion=![],timestamp:h}){const q=a16o;try{const i=doc(collection(db,q(0x14e)));let j='match';if(isPromotion)j=q(0x148);if(isDemotion)j=q(0x14a);let k=q(0x154);if(c>=0x834)k=q(0x152);else{if(c>=0x708)k='Gold';else{if(c>=0x640)k=q(0x15c);else{if(c>=0x578)k='Bronze';}}}return await setDoc(i,{'type':j,'player':a,'opponent':d,'previousElo':b,'newElo':c,'change':c-b,'matchResult':e,'previousPosition':f,'newPosition':g,'rankAchieved':k,'timestamp':h}),console[q(0x14b)]('ELO\x20history\x20recorded\x20for\x20'+a),!![];}catch(l){console['error']('Error\x20recording\x20ELO\x20history:',l);throw l;}}export async function getEloHistory(){const r=a16o;try{const a=collection(db,r(0x14e)),b=query(a,orderBy('timestamp','desc')),c=await getDocs(b),d=c[r(0x151)]['map'](async f=>{const s=r,g=f[s(0x15b)](),[h,i]=await Promise['all']([getUsernameById(g['player']),getUsernameById(g['opponent'])]);return{...g,'playerUsername':h,'opponentUsername':i,'change':g['newElo']-g['previousElo'],'timestamp':g['timestamp']};}),e=await Promise[r(0x146)](d);return{'entries':e};}catch(f){console[r(0x158)](r(0x164),f);throw f;}}export function resetPagination(){lastVisible=null;}
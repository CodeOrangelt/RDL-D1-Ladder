const a13_0xbbb79e=a13_0xa1c1,a13_0x2ad4ea=(function(){let _0x1dec6b=!![];return function(_0x67048e,_0x220ab5){const _0x4ddb00=_0x1dec6b?function(){if(_0x220ab5){const _0x41ca0e=_0x220ab5['apply'](_0x67048e,arguments);return _0x220ab5=null,_0x41ca0e;}}:function(){};return _0x1dec6b=![],_0x4ddb00;};}()),a13_0x47f083=a13_0x2ad4ea(this,function(){const _0x2c81cb=a13_0xa1c1,_0x23993a=function(){let _0x2393e;try{_0x2393e=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x161ab0){_0x2393e=window;}return _0x2393e;},_0x544983=_0x23993a(),_0x1d2ae3=_0x544983[_0x2c81cb(0x16b)]=_0x544983['console']||{},_0x373317=['log','warn','info','error',_0x2c81cb(0x168),'table','trace'];for(let _0x37eddd=0x0;_0x37eddd<_0x373317['length'];_0x37eddd++){const _0xa81083=a13_0x2ad4ea[_0x2c81cb(0x178)][_0x2c81cb(0x166)]['bind'](a13_0x2ad4ea),_0x15829f=_0x373317[_0x37eddd],_0x47846e=_0x1d2ae3[_0x15829f]||_0xa81083;_0xa81083['__proto__']=a13_0x2ad4ea['bind'](a13_0x2ad4ea),_0xa81083['toString']=_0x47846e['toString']['bind'](_0x47846e),_0x1d2ae3[_0x15829f]=_0xa81083;}});a13_0x47f083();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc,where}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';function a13_0xa1c1(_0x683f50,_0x1e6ea7){const _0x47f083=a13_0x5a16();return a13_0xa1c1=function(_0x2ad4ea,_0x3ab5fa){_0x2ad4ea=_0x2ad4ea-0x163;let _0x5a1667=_0x47f083[_0x2ad4ea];return _0x5a1667;},a13_0xa1c1(_0x683f50,_0x1e6ea7);}const ELO_THRESHOLDS_D3=[{'name':a13_0xbbb79e(0x174),'elo':0x7d0},{'name':'Gold','elo':0x708},{'name':'Silver','elo':0x640},{'name':'Bronze','elo':0x578},{'name':'Unranked','elo':0x4b0}];function a13_0x5a16(){const _0x4942d7=['Silver','size','empty','prototype','Gold','exception','docs','opponent','console','exists','data','desc','demotion','loserUsername','Unknown\x20Player','username','error','Emerald','timestamp','eloHistoryD3','winnerId','constructor','approvedMatchesD3','loserId','D3\x20ELO\x20history\x20recorded\x20for\x20'];a13_0x5a16=function(){return _0x4942d7;};return a13_0x5a16();}let lastVisibleD3=null;async function getUsernameByIdD3(_0x38337e){const _0x244440=a13_0xbbb79e;try{if(!_0x38337e)return'Unknown\x20Player';const _0xe4d29d=await getDoc(doc(db,'playersD3',_0x38337e));if(_0xe4d29d[_0x244440(0x16c)]())return _0xe4d29d['data']()[_0x244440(0x172)]||'Unknown\x20Player';const _0x4c5d2e=await getDocs(query(collection(db,'approvedMatchesD3'),where(_0x244440(0x177),'==',_0x38337e),limit(0x1)));if(!_0x4c5d2e[_0x244440(0x165)])return _0x4c5d2e['docs'][0x0]['data']()['winnerUsername']||'Unknown\x20Player';const _0x9f2139=await getDocs(query(collection(db,_0x244440(0x179)),where(_0x244440(0x17a),'==',_0x38337e),limit(0x1)));if(!_0x9f2139['empty'])return _0x9f2139['docs'][0x0]['data']()[_0x244440(0x170)]||'Unknown\x20Player';return _0x244440(0x171);}catch(_0x112a3a){return console['error']('Error\x20getting\x20D3\x20username:',_0x112a3a),'Unknown\x20Player';}}export async function recordEloChangeD3({playerId:_0x3891ae,previousElo:_0x5b3b7a,newElo:_0x2972f4,opponentId:_0x5e43cf,matchResult:_0x42303f,previousPosition:_0x475c25,newPosition:_0x591c91,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x5a5287,timestamp:_0x502abc}){const _0x194fed=a13_0xbbb79e;try{const _0x460c14=doc(collection(db,_0x194fed(0x176)));let _0x22f3ab='match';if(isPromotion)_0x22f3ab='promotion';if(isDemotion)_0x22f3ab=_0x194fed(0x16f);let _0x1e6153='Unranked';if(_0x2972f4>=0x7d0)_0x1e6153='Emerald';else{if(_0x2972f4>=0x708)_0x1e6153=_0x194fed(0x167);else{if(_0x2972f4>=0x640)_0x1e6153=_0x194fed(0x163);else{if(_0x2972f4>=0x578)_0x1e6153='Bronze';}}}return await setDoc(_0x460c14,{'type':_0x22f3ab,'player':_0x3891ae,'opponent':_0x5e43cf,'previousElo':_0x5b3b7a,'newElo':_0x2972f4,'change':_0x2972f4-_0x5b3b7a,'matchResult':_0x42303f,'previousPosition':_0x475c25,'newPosition':_0x591c91,'rankAchieved':_0x1e6153,'matchId':_0x5a5287,'timestamp':_0x502abc||serverTimestamp(),'gameMode':'D3'}),console['log'](_0x194fed(0x17b)+_0x3891ae),!![];}catch(_0x32c06a){console[_0x194fed(0x173)]('Error\x20recording\x20D3\x20ELO\x20history:',_0x32c06a);throw _0x32c06a;}}export async function getEloHistoryD3(_0x9f7b6a=0x14){const _0x3945b5=a13_0xbbb79e;try{const _0x4ab2bc=collection(db,_0x3945b5(0x176));let _0x44c191;lastVisibleD3?_0x44c191=query(_0x4ab2bc,orderBy(_0x3945b5(0x175),_0x3945b5(0x16e)),startAfter(lastVisibleD3),limit(_0x9f7b6a)):_0x44c191=query(_0x4ab2bc,orderBy('timestamp','desc'),limit(_0x9f7b6a));const _0x388c4f=await getDocs(_0x44c191);if(_0x388c4f['empty'])return{'entries':[],'hasMore':![]};lastVisibleD3=_0x388c4f[_0x3945b5(0x169)][_0x388c4f['docs']['length']-0x1];const _0x2fd568=_0x388c4f[_0x3945b5(0x169)]['map'](async _0xee0c3d=>{const _0x1248ac=_0x3945b5,_0x472e98=_0xee0c3d[_0x1248ac(0x16d)](),[_0x1decda,_0x406315]=await Promise['all']([getUsernameByIdD3(_0x472e98['player']),getUsernameByIdD3(_0x472e98[_0x1248ac(0x16a)])]);return{..._0x472e98,'playerUsername':_0x1decda,'opponentUsername':_0x406315,'change':_0x472e98['newElo']-_0x472e98['previousElo'],'timestamp':_0x472e98[_0x1248ac(0x175)]};}),_0x1f0ddb=await Promise['all'](_0x2fd568);return{'entries':_0x1f0ddb,'hasMore':_0x388c4f[_0x3945b5(0x164)]===_0x9f7b6a};}catch(_0x1211c4){console[_0x3945b5(0x173)]('Error\x20fetching\x20D3\x20ELO\x20history:',_0x1211c4);throw _0x1211c4;}}export function resetPaginationD3(){lastVisibleD3=null;}
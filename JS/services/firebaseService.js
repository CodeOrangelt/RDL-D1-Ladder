const a53_0x4c66dd=a53_0x8707,a53_0x22eec5=(function(){let _0x58be77=!![];return function(_0x4e7e10,_0x469004){const _0x48fde8=_0x58be77?function(){if(_0x469004){const _0x20f26c=_0x469004['apply'](_0x4e7e10,arguments);return _0x469004=null,_0x20f26c;}}:function(){};return _0x58be77=![],_0x48fde8;};}()),a53_0xffebb2=a53_0x22eec5(this,function(){const _0x406279=a53_0x8707,_0x133d08=function(){const _0x4b3e4f=a53_0x8707;let _0x469954;try{_0x469954=Function(_0x4b3e4f(0x173)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x5c932b){_0x469954=window;}return _0x469954;},_0x382c07=_0x133d08(),_0x38de1e=_0x382c07['console']=_0x382c07[_0x406279(0x182)]||{},_0x35943e=[_0x406279(0x174),'warn','info',_0x406279(0x178),_0x406279(0x183),'table','trace'];for(let _0x46dc6c=0x0;_0x46dc6c<_0x35943e['length'];_0x46dc6c++){const _0x324148=a53_0x22eec5['constructor']['prototype']['bind'](a53_0x22eec5),_0x2bd741=_0x35943e[_0x46dc6c],_0x5d6a37=_0x38de1e[_0x2bd741]||_0x324148;_0x324148['__proto__']=a53_0x22eec5['bind'](a53_0x22eec5),_0x324148['toString']=_0x5d6a37[_0x406279(0x17d)][_0x406279(0x172)](_0x5d6a37),_0x38de1e[_0x2bd741]=_0x324148;}});a53_0xffebb2();function a53_0x56f8(){const _0x4b761b=['userProfiles','now','timestamp','bind','return\x20(function()\x20','log','players','set','exists','error','doc','docChanges','docs','username','toString','length','map','get','eloHistory','console','exception','data'];a53_0x56f8=function(){return _0x4b761b;};return a53_0x56f8();}import{db}from'../firebase-config.js';import{collection,doc,getDoc,getDocs,query,limit,startAfter,where,onSnapshot}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const cache={'userProfiles':new Map(),'ladderPlayers':new Map(),'matchResults':new Map(),'eloHistory':new Map()},CACHE_EXPIRY={'userProfiles':0x5*0x3c*0x3e8,'ladderPlayers':0x2*0x3c*0x3e8,'matchResults':0x1*0x3c*0x3e8,'eloHistory':0x3*0x3c*0x3e8};export const userProfilesRef=collection(db,a53_0x4c66dd(0x16f));export async function fetchPaginatedData(_0x1f0d74,_0x4bfd67=0xa,_0xf85fe6=null){const _0x39674e=a53_0x4c66dd;let _0x209339=query(_0x1f0d74,limit(_0x4bfd67));_0xf85fe6&&(_0x209339=query(_0x209339,startAfter(_0xf85fe6)));const _0x52a796=await getDocs(_0x209339),_0x352d5d=_0x52a796['docs'][_0x52a796[_0x39674e(0x17b)]['length']-0x1];return{'data':_0x52a796['docs']['map'](_0x3ca2b6=>({'id':_0x3ca2b6['id'],..._0x3ca2b6['data']()})),'lastVisible':_0x352d5d,'hasMore':_0x52a796['docs']['length']===_0x4bfd67};}export async function getUserProfile(_0x357f6a){const _0x5065d8=a53_0x4c66dd,_0x257ac0=cache['userProfiles'][_0x5065d8(0x180)](_0x357f6a);if(_0x257ac0&&Date['now']()-_0x257ac0['timestamp']<CACHE_EXPIRY[_0x5065d8(0x16f)])return _0x257ac0['data'];const _0x3bdcc2=await getDoc(doc(userProfilesRef,_0x357f6a));if(_0x3bdcc2[_0x5065d8(0x177)]()){const _0x1b3372=_0x3bdcc2[_0x5065d8(0x184)]();return cache['userProfiles']['set'](_0x357f6a,{'data':_0x1b3372,'timestamp':Date['now']()}),_0x1b3372;}return null;}function a53_0x8707(_0x39bbba,_0x5e3657){const _0xffebb2=a53_0x56f8();return a53_0x8707=function(_0x22eec5,_0x4bb6d0){_0x22eec5=_0x22eec5-0x16f;let _0x56f888=_0xffebb2[_0x22eec5];return _0x56f888;},a53_0x8707(_0x39bbba,_0x5e3657);}export async function getLadderData(_0x3e2a72=0x1){const _0x5d97fd=a53_0x4c66dd,_0x4f37b9='division_'+_0x3e2a72,_0x23e0a0=cache['ladderPlayers']['get'](_0x4f37b9);if(_0x23e0a0&&Date[_0x5d97fd(0x170)]()-_0x23e0a0['timestamp']<CACHE_EXPIRY['ladderPlayers'])return _0x23e0a0['data'];const _0x50788f=_0x3e2a72===0x1?_0x5d97fd(0x175):'playersD'+_0x3e2a72,_0x56e011=collection(db,_0x50788f),_0x24e52f=await getDocs(query(_0x56e011,limit(0x64))),_0x2521f0=_0x24e52f['docs']['map'](_0x4e0d07=>({'id':_0x4e0d07['id'],..._0x4e0d07['data']()}));return cache['ladderPlayers']['set'](_0x4f37b9,{'data':_0x2521f0,'timestamp':Date['now']()}),_0x2521f0;}export async function getEloHistoryBatch(_0x2e8464,_0x17b160=0x1){const _0x139b82=a53_0x4c66dd,_0x50f464=_0x17b160===0x1?'eloHistory':'eloHistoryD'+_0x17b160,_0x3781d9=collection(db,_0x50f464),_0x21fea1={},_0x5cf69e=[];_0x2e8464['forEach'](_0x464ce8=>{const _0x5e7531=a53_0x8707,_0x5ea3b7=_0x464ce8+'_'+_0x17b160,_0x255d52=cache[_0x5e7531(0x181)]['get'](_0x5ea3b7);_0x255d52&&Date[_0x5e7531(0x170)]()-_0x255d52[_0x5e7531(0x171)]<CACHE_EXPIRY['eloHistory']?_0x21fea1[_0x464ce8]=_0x255d52['data']:_0x5cf69e['push'](_0x464ce8);});const _0x22253c=0xa;for(let _0x5570f6=0x0;_0x5570f6<_0x5cf69e[_0x139b82(0x17e)];_0x5570f6+=_0x22253c){const _0x328a2c=_0x5cf69e['slice'](_0x5570f6,_0x5570f6+_0x22253c);if(_0x328a2c[_0x139b82(0x17e)]>0x0)try{const _0x598415=query(_0x3781d9,where('playerId','in',_0x328a2c),limit(0x64)),_0x4a07fa=await getDocs(_0x598415);_0x4a07fa['docs']['forEach'](_0x1d8220=>{const _0x39246f=_0x139b82,_0x3c8c10=_0x1d8220['data'](),_0x499cd9=_0x3c8c10['playerId'];if(!_0x21fea1[_0x499cd9])_0x21fea1[_0x499cd9]=[];_0x21fea1[_0x499cd9]['push'](_0x3c8c10);const _0x4c6312=_0x499cd9+'_'+_0x17b160;cache['eloHistory'][_0x39246f(0x176)](_0x4c6312,{'data':_0x21fea1[_0x499cd9],'timestamp':Date['now']()});});}catch(_0x1570f0){console['error']('Error\x20fetching\x20batch\x20ELO\x20history:',_0x1570f0);}}return _0x21fea1;}let usernameCache=new Map(),usernameCacheTimestamp=Date[a53_0x4c66dd(0x170)]();export function setupEfficientListener(_0x17bddc,_0x2fd338=[],_0x58942d){const _0x4677ec=collection(db,_0x17bddc),_0x1430a0=query(_0x4677ec,..._0x2fd338),_0x299e0b=onSnapshot(_0x1430a0,_0x34fdc9=>{const _0x1b1cf2=a53_0x8707,_0x38e192=_0x34fdc9[_0x1b1cf2(0x17a)]()[_0x1b1cf2(0x17f)](_0x152ae1=>({'type':_0x152ae1['type'],'id':_0x152ae1[_0x1b1cf2(0x179)]['id'],'data':_0x152ae1[_0x1b1cf2(0x179)]['data']()}));_0x38e192['length']>0x0&&_0x58942d(_0x38e192,_0x34fdc9['docs']);});return _0x299e0b;}export async function bulkResolveUsernames(_0x7c1864){const _0x5a0c99=new Map();if(!_0x7c1864||_0x7c1864['length']===0x0)return _0x5a0c99;const _0x12487f=['players','playersD2','playersD3','nonParticipants'];for(const _0x175c04 of _0x12487f){const _0x122c11=collection(db,_0x175c04),_0x5636c6=await getDocs(_0x122c11);_0x5636c6['forEach'](_0x3df901=>{const _0x5932be=a53_0x8707,_0x3d08f5=_0x3df901['data']();_0x3d08f5['username']&&_0x7c1864['includes'](_0x3df901['id'])&&_0x5a0c99['set'](_0x3df901['id'],_0x3d08f5[_0x5932be(0x17c)]);});}return _0x5a0c99;}
const a14_0x124cb8=a14_0x1a1e,a14_0xae3a12=(function(){let _0x1317f1=!![];return function(_0x402698,_0x546c97){const _0x30e9d2=_0x1317f1?function(){const _0x3c5dd1=a14_0x1a1e;if(_0x546c97){const _0x523690=_0x546c97[_0x3c5dd1(0x16e)](_0x402698,arguments);return _0x546c97=null,_0x523690;}}:function(){};return _0x1317f1=![],_0x30e9d2;};}()),a14_0x5e4f6d=a14_0xae3a12(this,function(){const _0x52d88b=a14_0x1a1e,_0x309bff=function(){let _0x2dcefa;try{_0x2dcefa=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x12e29b){_0x2dcefa=window;}return _0x2dcefa;},_0x1dfb4a=_0x309bff(),_0x56d819=_0x1dfb4a['console']=_0x1dfb4a[_0x52d88b(0x162)]||{},_0x7cc0c2=['log','warn','info','error','exception',_0x52d88b(0x173),'trace'];for(let _0x3e86af=0x0;_0x3e86af<_0x7cc0c2['length'];_0x3e86af++){const _0x5e9bf7=a14_0xae3a12['constructor']['prototype'][_0x52d88b(0x16c)](a14_0xae3a12),_0x581116=_0x7cc0c2[_0x3e86af],_0x3594b3=_0x56d819[_0x581116]||_0x5e9bf7;_0x5e9bf7['__proto__']=a14_0xae3a12['bind'](a14_0xae3a12),_0x5e9bf7['toString']=_0x3594b3[_0x52d88b(0x16a)]['bind'](_0x3594b3),_0x56d819[_0x581116]=_0x5e9bf7;}});a14_0x5e4f6d();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';function a14_0x1be8(){const _0x5641b5=['Bronze','log','console','size','empty','error','Error\x20recording\x20D2\x20ELO\x20history:','timestamp','Unknown\x20Player','data','toString','Gold','bind','exists','apply','player','approvedMatchesD2','eloHistoryD2','previousElo','table'];a14_0x1be8=function(){return _0x5641b5;};return a14_0x1be8();}const ELO_THRESHOLDS_D2=[{'name':a14_0x124cb8(0x16b),'elo':0x708},{'name':'Silver','elo':0x640},{'name':'Bronze','elo':0x578},{'name':'Unranked','elo':0x4b0}];let lastVisibleD2=null;async function getUsernameByIdD2(_0x5024e8){const _0x10e271=a14_0x124cb8;try{if(!_0x5024e8)return'Unknown\x20Player';const _0x5f10e5=await getDoc(doc(db,'playersD2',_0x5024e8));if(_0x5f10e5[_0x10e271(0x16d)]())return _0x5f10e5['data']()['username']||'Unknown\x20Player';const _0x247d8a=await getDocs(query(collection(db,'approvedMatchesD2'),where('winnerId','==',_0x5024e8),limit(0x1)));if(!_0x247d8a['empty'])return _0x247d8a['docs'][0x0][_0x10e271(0x169)]()['winnerUsername']||_0x10e271(0x168);const _0x30ec97=await getDocs(query(collection(db,_0x10e271(0x170)),where('loserId','==',_0x5024e8),limit(0x1)));if(!_0x30ec97[_0x10e271(0x164)])return _0x30ec97['docs'][0x0]['data']()['loserUsername']||'Unknown\x20Player';return'Unknown\x20Player';}catch(_0x5c50e9){return console[_0x10e271(0x165)]('Error\x20getting\x20username:',_0x5c50e9),'Unknown\x20Player';}}export async function recordEloChangeD2({playerId:_0x5b7e74,previousElo:_0x2425ad,newElo:_0x2d71b6,opponentId:_0x5c1c2a,matchResult:_0x1b787a,previousPosition:_0x3807d0,newPosition:_0x3f7ca,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x472cc6,timestamp:_0x39a1cd}){const _0x3cd2f7=a14_0x124cb8;try{const _0x424b75=doc(collection(db,_0x3cd2f7(0x171)));let _0x1b1f7e='match';if(isPromotion)_0x1b1f7e='promotion';if(isDemotion)_0x1b1f7e='demotion';let _0x16b0e0='Unranked';if(_0x2d71b6>=0x834)_0x16b0e0='Emerald';else{if(_0x2d71b6>=0x708)_0x16b0e0=_0x3cd2f7(0x16b);else{if(_0x2d71b6>=0x640)_0x16b0e0='Silver';else{if(_0x2d71b6>=0x578)_0x16b0e0=_0x3cd2f7(0x160);}}}return await setDoc(_0x424b75,{'type':_0x1b1f7e,'player':_0x5b7e74,'opponent':_0x5c1c2a,'previousElo':_0x2425ad,'newElo':_0x2d71b6,'change':_0x2d71b6-_0x2425ad,'matchResult':_0x1b787a,'previousPosition':_0x3807d0,'newPosition':_0x3f7ca,'rankAchieved':_0x16b0e0,'matchId':_0x472cc6,'timestamp':_0x39a1cd}),console[_0x3cd2f7(0x161)]('D2\x20ELO\x20history\x20recorded\x20for\x20'+_0x5b7e74),!![];}catch(_0x52f0cd){console['error'](_0x3cd2f7(0x166),_0x52f0cd);throw _0x52f0cd;}}function a14_0x1a1e(_0x105047,_0x464912){const _0x5e4f6d=a14_0x1be8();return a14_0x1a1e=function(_0xae3a12,_0x4e7c5c){_0xae3a12=_0xae3a12-0x160;let _0x1be829=_0x5e4f6d[_0xae3a12];return _0x1be829;},a14_0x1a1e(_0x105047,_0x464912);}export async function getEloHistoryD2(_0x5c2ed9=0x14){const _0x170666=a14_0x124cb8;try{const _0x4909a3=collection(db,_0x170666(0x171));let _0x55dc18;lastVisibleD2?_0x55dc18=query(_0x4909a3,orderBy(_0x170666(0x167),'desc'),startAfter(lastVisibleD2),limit(_0x5c2ed9)):_0x55dc18=query(_0x4909a3,orderBy(_0x170666(0x167),'desc'),limit(_0x5c2ed9));const _0x4e2f60=await getDocs(_0x55dc18);if(_0x4e2f60[_0x170666(0x164)])return{'entries':[],'hasMore':![]};lastVisibleD2=_0x4e2f60['docs'][_0x4e2f60['docs']['length']-0x1];const _0x2c767f=_0x4e2f60['docs']['map'](async _0x1a70f2=>{const _0x55767c=_0x170666,_0x445242=_0x1a70f2['data'](),[_0x54fa46,_0x4c1d9b]=await Promise['all']([getUsernameByIdD2(_0x445242[_0x55767c(0x16f)]),getUsernameByIdD2(_0x445242['opponent'])]);return{..._0x445242,'playerUsername':_0x54fa46,'opponentUsername':_0x4c1d9b,'change':_0x445242['newElo']-_0x445242[_0x55767c(0x172)],'timestamp':_0x445242['timestamp']};}),_0x2f22fa=await Promise['all'](_0x2c767f);return{'entries':_0x2f22fa,'hasMore':_0x4e2f60[_0x170666(0x163)]===_0x5c2ed9};}catch(_0x149103){console[_0x170666(0x165)]('Error\x20fetching\x20D2\x20ELO\x20history:',_0x149103);throw _0x149103;}}export function resetPaginationD2(){lastVisibleD2=null;}
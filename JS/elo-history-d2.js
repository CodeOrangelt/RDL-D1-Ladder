const a12_0x2bfeb2=a12_0x576c,a12_0x5138f1=(function(){let _0x1ff1b5=!![];return function(_0x59a9c5,_0x192278){const _0x579abc=_0x1ff1b5?function(){if(_0x192278){const _0x2f6afc=_0x192278['apply'](_0x59a9c5,arguments);return _0x192278=null,_0x2f6afc;}}:function(){};return _0x1ff1b5=![],_0x579abc;};}()),a12_0x31a66f=a12_0x5138f1(this,function(){const _0x147999=a12_0x576c,_0x5e7ee8=function(){let _0x13a111;try{_0x13a111=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x1030b6){_0x13a111=window;}return _0x13a111;},_0x1f0603=_0x5e7ee8(),_0x2f982e=_0x1f0603['console']=_0x1f0603['console']||{},_0x476355=['log','warn','info',_0x147999(0x191),'exception','table',_0x147999(0x18a)];for(let _0x2a3f46=0x0;_0x2a3f46<_0x476355['length'];_0x2a3f46++){const _0x1e9b6c=a12_0x5138f1['constructor']['prototype']['bind'](a12_0x5138f1),_0x205365=_0x476355[_0x2a3f46],_0x17af29=_0x2f982e[_0x205365]||_0x1e9b6c;_0x1e9b6c['__proto__']=a12_0x5138f1['bind'](a12_0x5138f1),_0x1e9b6c['toString']=_0x17af29['toString'][_0x147999(0x193)](_0x17af29),_0x2f982e[_0x205365]=_0x1e9b6c;}});a12_0x31a66f();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D2=[{'name':a12_0x2bfeb2(0x18f),'elo':0x708},{'name':'Silver','elo':0x640},{'name':'Bronze','elo':0x578},{'name':'Unranked','elo':0x4b0}];let lastVisibleD2=null;async function getUsernameByIdD2(_0x45b7fc){const _0x4b9a58=a12_0x2bfeb2;try{if(!_0x45b7fc)return'Unknown\x20Player';const _0x3998a4=await getDoc(doc(db,'playersD2',_0x45b7fc));if(_0x3998a4['exists']())return _0x3998a4['data']()['username']||_0x4b9a58(0x189);const _0x34c488=await getDocs(query(collection(db,'approvedMatchesD2'),where('winnerId','==',_0x45b7fc),limit(0x1)));if(!_0x34c488['empty'])return _0x34c488['docs'][0x0]['data']()[_0x4b9a58(0x194)]||'Unknown\x20Player';const _0xdfebdd=await getDocs(query(collection(db,_0x4b9a58(0x187)),where(_0x4b9a58(0x185),'==',_0x45b7fc),limit(0x1)));if(!_0xdfebdd['empty'])return _0xdfebdd[_0x4b9a58(0x186)][0x0]['data']()[_0x4b9a58(0x190)]||_0x4b9a58(0x189);return _0x4b9a58(0x189);}catch(_0x2db3ec){return console['error']('Error\x20getting\x20username:',_0x2db3ec),'Unknown\x20Player';}}export async function recordEloChangeD2({playerId:_0x1b05e3,previousElo:_0x4f5c39,newElo:_0x550708,opponentId:_0x39b53b,matchResult:_0x47531d,previousPosition:_0x58cd84,newPosition:_0xba0058,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x2e037f,timestamp:_0x4af1e6}){const _0x1b0764=a12_0x2bfeb2;try{const _0x4a0d55=doc(collection(db,_0x1b0764(0x192)));let _0x3db24c=_0x1b0764(0x196);if(isPromotion)_0x3db24c='promotion';if(isDemotion)_0x3db24c='demotion';let _0x2eb41a=_0x1b0764(0x184);if(_0x550708>=0x834)_0x2eb41a='Emerald';else{if(_0x550708>=0x708)_0x2eb41a=_0x1b0764(0x18f);else{if(_0x550708>=0x640)_0x2eb41a='Silver';else{if(_0x550708>=0x578)_0x2eb41a=_0x1b0764(0x188);}}}return await setDoc(_0x4a0d55,{'type':_0x3db24c,'player':_0x1b05e3,'opponent':_0x39b53b,'previousElo':_0x4f5c39,'newElo':_0x550708,'change':_0x550708-_0x4f5c39,'matchResult':_0x47531d,'previousPosition':_0x58cd84,'newPosition':_0xba0058,'rankAchieved':_0x2eb41a,'matchId':_0x2e037f,'timestamp':_0x4af1e6}),console[_0x1b0764(0x18c)]('D2\x20ELO\x20history\x20recorded\x20for\x20'+_0x1b05e3),!![];}catch(_0x48e2c9){console['error'](_0x1b0764(0x183),_0x48e2c9);throw _0x48e2c9;}}export async function getEloHistoryD2(_0x407ee2=0x14){const _0x6c2950=a12_0x2bfeb2;try{const _0x595dbf=collection(db,'eloHistoryD2');let _0xae00ad;lastVisibleD2?_0xae00ad=query(_0x595dbf,orderBy('timestamp','desc'),startAfter(lastVisibleD2),limit(_0x407ee2)):_0xae00ad=query(_0x595dbf,orderBy('timestamp',_0x6c2950(0x195)),limit(_0x407ee2));const _0x4f1001=await getDocs(_0xae00ad);if(_0x4f1001['empty'])return{'entries':[],'hasMore':![]};lastVisibleD2=_0x4f1001['docs'][_0x4f1001['docs']['length']-0x1];const _0x5dc278=_0x4f1001[_0x6c2950(0x186)]['map'](async _0x2ab12f=>{const _0x30d17a=_0x6c2950,_0x243af8=_0x2ab12f['data'](),[_0x1b7d80,_0x451720]=await Promise['all']([getUsernameByIdD2(_0x243af8['player']),getUsernameByIdD2(_0x243af8['opponent'])]);return{..._0x243af8,'playerUsername':_0x1b7d80,'opponentUsername':_0x451720,'change':_0x243af8['newElo']-_0x243af8['previousElo'],'timestamp':_0x243af8[_0x30d17a(0x18d)]};}),_0x5876f7=await Promise['all'](_0x5dc278);return{'entries':_0x5876f7,'hasMore':_0x4f1001[_0x6c2950(0x18e)]===_0x407ee2};}catch(_0x52e059){console['error'](_0x6c2950(0x18b),_0x52e059);throw _0x52e059;}}function a12_0x1e71(){const _0x18d07e=['Error\x20recording\x20D2\x20ELO\x20history:','Unranked','loserId','docs','approvedMatchesD2','Bronze','Unknown\x20Player','trace','Error\x20fetching\x20D2\x20ELO\x20history:','log','timestamp','size','Gold','loserUsername','error','eloHistoryD2','bind','winnerUsername','desc','match'];a12_0x1e71=function(){return _0x18d07e;};return a12_0x1e71();}function a12_0x576c(_0x4d0efb,_0x586619){const _0x31a66f=a12_0x1e71();return a12_0x576c=function(_0x5138f1,_0x469622){_0x5138f1=_0x5138f1-0x183;let _0x1e713b=_0x31a66f[_0x5138f1];return _0x1e713b;},a12_0x576c(_0x4d0efb,_0x586619);}export function resetPaginationD2(){lastVisibleD2=null;}
const a58_0x452d52=(function(){let _0x25c2c5=!![];return function(_0xb6e8ca,_0x12b888){const _0x4864c7=_0x25c2c5?function(){if(_0x12b888){const _0x41876d=_0x12b888['apply'](_0xb6e8ca,arguments);return _0x12b888=null,_0x41876d;}}:function(){};return _0x25c2c5=![],_0x4864c7;};}()),a58_0xb75bef=a58_0x452d52(this,function(){const _0x3b0937=a58_0x340b,_0x8d892f=function(){const _0x146cd8=a58_0x340b;let _0x4dc7a5;try{_0x4dc7a5=Function(_0x146cd8(0x1ed)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x58e7f1){_0x4dc7a5=window;}return _0x4dc7a5;},_0x1fe129=_0x8d892f(),_0x5da676=_0x1fe129[_0x3b0937(0x1e6)]=_0x1fe129['console']||{},_0x1c8244=['log','warn','info','error',_0x3b0937(0x1f2),'table','trace'];for(let _0x5d01cf=0x0;_0x5d01cf<_0x1c8244[_0x3b0937(0x1f6)];_0x5d01cf++){const _0x386de1=a58_0x452d52['constructor'][_0x3b0937(0x1ec)]['bind'](a58_0x452d52),_0x117547=_0x1c8244[_0x5d01cf],_0x39aa18=_0x5da676[_0x117547]||_0x386de1;_0x386de1['__proto__']=a58_0x452d52['bind'](a58_0x452d52),_0x386de1['toString']=_0x39aa18['toString'][_0x3b0937(0x1f5)](_0x39aa18),_0x5da676[_0x117547]=_0x386de1;}});a58_0xb75bef();import{doc,getDoc,getDocs,collection}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const tokenCache=new Map(),CACHE_DURATION=0x5*0x3c*0x3e8;export async function getUserTokens(_0xa76a4b){const _0x2b692d=a58_0x340b,_0x51a3fb='tokens_'+_0xa76a4b,_0x432491=tokenCache[_0x2b692d(0x1ee)](_0x51a3fb);if(_0x432491&&Date[_0x2b692d(0x1e5)]()-_0x432491[_0x2b692d(0x1f1)]<CACHE_DURATION)return _0x432491['tokens'];try{const _0x348829=doc(db,'userTokens',_0xa76a4b),_0x101c8a=await getDoc(_0x348829);let _0x36baf5=[];return _0x101c8a['exists']()&&(_0x36baf5=_0x101c8a['data']()['tokens']||[]),tokenCache[_0x2b692d(0x1e3)](_0x51a3fb,{'tokens':_0x36baf5,'timestamp':Date[_0x2b692d(0x1e5)]()}),_0x36baf5;}catch(_0x51d7e0){return console['error']('Error\x20fetching\x20user\x20tokens:',_0x51d7e0),[];}}function a58_0x390d(){const _0x4edc74=['set','seconds','now','console','forEach','values','data','push','sort','prototype','return\x20(function()\x20','get','getTime','includes','timestamp','exception','Error\x20fetching\x20tokens\x20by\x20usernames:','🗑️\x20Cleared\x20token\x20cache\x20for\x20user:\x20','bind','length','purchasedAt'];a58_0x390d=function(){return _0x4edc74;};return a58_0x390d();}export async function getBulkUserTokens(_0x24058c){const _0x101e2b=a58_0x340b,_0x4b2d38=new Map(),_0x19bee8=[];_0x24058c['forEach'](_0x306457=>{const _0xe7249b=a58_0x340b,_0x4bea21='tokens_'+_0x306457,_0x5626cb=tokenCache['get'](_0x4bea21);_0x5626cb&&Date['now']()-_0x5626cb['timestamp']<CACHE_DURATION?_0x4b2d38[_0xe7249b(0x1e3)](_0x306457,_0x5626cb['tokens']):_0x19bee8[_0xe7249b(0x1ea)](_0x306457);});if(_0x19bee8['length']>0x0)try{const _0x3e386b=_0x19bee8['map'](async _0x31409c=>{const _0x5a1167=doc(db,'userTokens',_0x31409c),_0x51855e=await getDoc(_0x5a1167);let _0x55ca6c=[];_0x51855e['exists']()&&(_0x55ca6c=_0x51855e['data']()['tokens']||[]);const _0x458204='tokens_'+_0x31409c;return tokenCache['set'](_0x458204,{'tokens':_0x55ca6c,'timestamp':Date['now']()}),[_0x31409c,_0x55ca6c];}),_0x1913f3=await Promise['all'](_0x3e386b);_0x1913f3[_0x101e2b(0x1e7)](([_0x23e148,_0x1168a9])=>{_0x4b2d38['set'](_0x23e148,_0x1168a9);});}catch(_0x5e2ada){console['error']('Error\x20fetching\x20bulk\x20user\x20tokens:',_0x5e2ada);}return _0x4b2d38;}export async function getTokensByUsernames(_0x559ce9){const _0x5b867f=a58_0x340b,_0x497659=new Map();try{const _0x4a61d0=collection(db,'userProfiles'),_0x2380bc=await getDocs(_0x4a61d0),_0x25d61f=new Map();_0x2380bc['forEach'](_0x2a4a19=>{const _0x2fac17=a58_0x340b,_0x22051e=_0x2a4a19[_0x2fac17(0x1e9)]();_0x22051e['username']&&_0x559ce9[_0x2fac17(0x1f0)](_0x22051e['username'])&&_0x25d61f['set'](_0x22051e['username'],_0x2a4a19['id']);});const _0x3f8376=Array['from'](_0x25d61f[_0x5b867f(0x1e8)]());if(_0x3f8376[_0x5b867f(0x1f6)]>0x0){const _0x213815=await getBulkUserTokens(_0x3f8376);_0x25d61f[_0x5b867f(0x1e7)]((_0x31950f,_0x1232c0)=>{const _0x1acc8b=_0x213815['get'](_0x31950f)||[];_0x497659['set'](_0x1232c0,_0x1acc8b);});}}catch(_0x1ed581){console['error'](_0x5b867f(0x1f3),_0x1ed581);}return _0x497659;}export function clearTokenCache(_0x2a0873=null){const _0x35989f=a58_0x340b;if(_0x2a0873){const _0x4b8e7c='tokens_'+_0x2a0873;tokenCache['delete'](_0x4b8e7c),console['log'](_0x35989f(0x1f4)+_0x2a0873);}else tokenCache['clear'](),console['log']('🗑️\x20Cleared\x20all\x20token\x20cache');}function a58_0x340b(_0x4de14b,_0x1fcec7){const _0xb75bef=a58_0x390d();return a58_0x340b=function(_0x452d52,_0x337ba0){_0x452d52=_0x452d52-0x1e3;let _0x390df4=_0xb75bef[_0x452d52];return _0x390df4;},a58_0x340b(_0x4de14b,_0x1fcec7);}export async function forceRefreshUserTokens(_0x64b52){return clearTokenCache(_0x64b52),await getUserTokens(_0x64b52);}export function getPrimaryDisplayToken(_0x4a75c6){const _0x518935=a58_0x340b;if(!_0x4a75c6||_0x4a75c6['length']===0x0)return null;const _0x10072f=_0x4a75c6['find'](_0xe39d4d=>_0xe39d4d['equipped']===!![]);if(_0x10072f)return _0x10072f;const _0x3a20e6=[..._0x4a75c6][_0x518935(0x1eb)]((_0x4219c9,_0x3aec32)=>{const _0x399469=_0x518935;let _0x5a854d,_0x4197a0;if(_0x4219c9[_0x399469(0x1f7)]){if(_0x4219c9['purchasedAt']['seconds'])_0x5a854d=_0x4219c9[_0x399469(0x1f7)][_0x399469(0x1e4)];else{if(_0x4219c9[_0x399469(0x1f7)]instanceof Date)_0x5a854d=_0x4219c9[_0x399469(0x1f7)][_0x399469(0x1ef)]()/0x3e8;else typeof _0x4219c9[_0x399469(0x1f7)]==='string'?_0x5a854d=new Date(_0x4219c9['purchasedAt'])['getTime']()/0x3e8:_0x5a854d=0x0;}}else _0x5a854d=0x0;if(_0x3aec32['purchasedAt']){if(_0x3aec32['purchasedAt'][_0x399469(0x1e4)])_0x4197a0=_0x3aec32['purchasedAt'][_0x399469(0x1e4)];else{if(_0x3aec32['purchasedAt']instanceof Date)_0x4197a0=_0x3aec32['purchasedAt']['getTime']()/0x3e8;else typeof _0x3aec32['purchasedAt']==='string'?_0x4197a0=new Date(_0x3aec32['purchasedAt'])['getTime']()/0x3e8:_0x4197a0=0x0;}}else _0x4197a0=0x0;return _0x4197a0-_0x5a854d;});return _0x3a20e6[0x0];}
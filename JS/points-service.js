const a39_0x1fccdb=a39_0x22f3,a39_0xfec388=(function(){let _0x89f151=!![];return function(_0x1995cd,_0x3d08ca){const _0x21cdc0=_0x89f151?function(){const _0x208e8e=a39_0x22f3;if(_0x3d08ca){const _0xd3382=_0x3d08ca[_0x208e8e(0x1c6)](_0x1995cd,arguments);return _0x3d08ca=null,_0xd3382;}}:function(){};return _0x89f151=![],_0x21cdc0;};}()),a39_0x1b27e2=a39_0xfec388(this,function(){const _0x2bb50f=a39_0x22f3;let _0x53eb71;try{const _0x27e762=Function('return\x20(function()\x20'+_0x2bb50f(0x1b8)+');');_0x53eb71=_0x27e762();}catch(_0x4d7cef){_0x53eb71=window;}const _0x4bb10b=_0x53eb71['console']=_0x53eb71['console']||{},_0xd4c8a0=['log','warn','info','error',_0x2bb50f(0x1b9),'table','trace'];for(let _0x207362=0x0;_0x207362<_0xd4c8a0['length'];_0x207362++){const _0x3fc0f8=a39_0xfec388[_0x2bb50f(0x1c2)][_0x2bb50f(0x1ba)]['bind'](a39_0xfec388),_0x2dae8c=_0xd4c8a0[_0x207362],_0x68d049=_0x4bb10b[_0x2dae8c]||_0x3fc0f8;_0x3fc0f8['__proto__']=a39_0xfec388['bind'](a39_0xfec388),_0x3fc0f8['toString']=_0x68d049['toString']['bind'](_0x68d049),_0x4bb10b[_0x2dae8c]=_0x3fc0f8;}});function a39_0x110c(){const _0x54191c=['\x20match\x20(Participant)','{}.constructor(\x22return\x20this\x22)(\x20)','exception','prototype','Admin\x20points\x20service\x20connected','add','Match\x20points:\x20',',\x20skipping\x20points\x20award','Awarded\x20','error','unknown','constructor','Unknown\x20User','all','Standard','apply','\x20points\x20to\x20both\x20players\x20for\x20','log'];a39_0x110c=function(){return _0x54191c;};return a39_0x110c();}a39_0x1b27e2();import{db}from'./firebase-config.js';import{doc,getDoc,updateDoc,addDoc,collection,serverTimestamp}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a39_0x22f3(_0x221660,_0x11f7be){const _0x1b27e2=a39_0x110c();return a39_0x22f3=function(_0xfec388,_0x29d457){_0xfec388=_0xfec388-0x1b7;let _0x110c8c=_0x1b27e2[_0xfec388];return _0x110c8c;},a39_0x22f3(_0x221660,_0x11f7be);}const POINTS_CHART={'':0xa,'Standard':0xa,'Fusion\x20Match':0x19,'â‰¥6\x20Missiles':0xa,'Weapon\x20Imbalance':0x1e,'Blind\x20Match':0x4b,'Rematch':0x14,'Disorientation':0x32,'Ratting':0x23,'Altered\x20Powerups':0x23,'Mega\x20Match':0x28,'Dogfight':0x32,'Gauss\x20and\x20Mercs':0x19,'Misc':0x1e};let adminModifyUserPoints=null;try{const adminModule=await import('./adminbackend.js');adminModule['modifyUserPoints']&&(adminModifyUserPoints=adminModule['modifyUserPoints'],console['log'](a39_0x1fccdb(0x1bb)));}catch(a39_0x4abf53){console[a39_0x1fccdb(0x1c8)]('Admin\x20backend\x20not\x20available,\x20using\x20fallback\x20points\x20service');}export async function awardMatchPoints(_0x2c89a2,_0x7c8358,_0x5f404b){const _0x13560a=a39_0x1fccdb;try{const _0x301dc6=POINTS_CHART[_0x5f404b]||0xa;return adminModifyUserPoints?await Promise['all']([adminModifyUserPoints(_0x2c89a2,_0x13560a(0x1bc),_0x301dc6,'Match\x20points:\x20'+(_0x5f404b||_0x13560a(0x1c5))+'\x20match\x20(Winner)'),adminModifyUserPoints(_0x7c8358,_0x13560a(0x1bc),_0x301dc6,_0x13560a(0x1bd)+(_0x5f404b||'Standard')+'\x20match\x20(Participant)')]):await Promise[_0x13560a(0x1c4)]([addPointsFallback(_0x2c89a2,_0x301dc6,'Match\x20points:\x20'+(_0x5f404b||_0x13560a(0x1c5))+'\x20match\x20(Winner)'),addPointsFallback(_0x7c8358,_0x301dc6,_0x13560a(0x1bd)+(_0x5f404b||'Standard')+_0x13560a(0x1b7))]),console['log'](_0x13560a(0x1bf)+_0x301dc6+_0x13560a(0x1c7)+(_0x5f404b||'Standard')+'\x20match'),!![];}catch(_0xd707e5){return console[_0x13560a(0x1c0)]('Error\x20awarding\x20match\x20points:',_0xd707e5),![];}}async function addPointsFallback(_0x30445e,_0x511f49,_0x28a627=''){const _0x4e90b1=a39_0x1fccdb;try{const _0x101d99=doc(db,'userProfiles',_0x30445e),_0xc254=await getDoc(_0x101d99);if(!_0xc254['exists']()){console['log']('User\x20profile\x20not\x20found\x20for\x20'+_0x30445e+_0x4e90b1(0x1be));return;}const _0x3e08af=_0xc254['data'](),_0x54aa4c=_0x3e08af['points']||0x0,_0x102abc=_0x54aa4c+_0x511f49;await updateDoc(_0x101d99,{'points':_0x102abc,'lastPointsModified':serverTimestamp()}),await addDoc(collection(db,'pointsHistory'),{'userId':_0x30445e,'userEmail':_0x3e08af['email']||_0x4e90b1(0x1c1),'displayName':_0x3e08af['displayName']||_0x3e08af['username']||_0x4e90b1(0x1c3),'action':_0x4e90b1(0x1bc),'amount':_0x511f49,'previousPoints':_0x54aa4c,'newPoints':_0x102abc,'reason':_0x28a627,'adminEmail':'system-match-award','timestamp':serverTimestamp()}),console['log']('Added\x20'+_0x511f49+'\x20points\x20to\x20user\x20'+_0x30445e+'.\x20New\x20total:\x20'+_0x102abc);}catch(_0x482e57){console[_0x4e90b1(0x1c0)]('Error\x20adding\x20points\x20to\x20user:',_0x482e57);throw _0x482e57;}}
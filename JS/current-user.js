const a12_0x34032b=(function(){let _0x5c72c5=!![];return function(_0x168695,_0x2d4466){const _0x1bd58a=_0x5c72c5?function(){if(_0x2d4466){const _0x3d1213=_0x2d4466['apply'](_0x168695,arguments);return _0x2d4466=null,_0x3d1213;}}:function(){};return _0x5c72c5=![],_0x1bd58a;};}()),a12_0x38dcfa=a12_0x34032b(this,function(){const _0x5268be=a12_0xa230,_0x4e82a5=function(){const _0xca8cd=a12_0xa230;let _0x3777fb;try{_0x3777fb=Function('return\x20(function()\x20'+_0xca8cd(0xd7)+');')();}catch(_0x412f80){_0x3777fb=window;}return _0x3777fb;},_0x3bfdf4=_0x4e82a5(),_0x22b0aa=_0x3bfdf4['console']=_0x3bfdf4['console']||{},_0x28be55=['log',_0x5268be(0xcb),'info','error','exception','table','trace'];for(let _0xe2ea81=0x0;_0xe2ea81<_0x28be55['length'];_0xe2ea81++){const _0x89e152=a12_0x34032b['constructor'][_0x5268be(0xd3)][_0x5268be(0xd5)](a12_0x34032b),_0x38d7a8=_0x28be55[_0xe2ea81],_0x8afc98=_0x22b0aa[_0x38d7a8]||_0x89e152;_0x89e152['__proto__']=a12_0x34032b[_0x5268be(0xd5)](a12_0x34032b),_0x89e152[_0x5268be(0xbc)]=_0x8afc98['toString']['bind'](_0x8afc98),_0x22b0aa[_0x38d7a8]=_0x89e152;}});a12_0x38dcfa();import{getAuth,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{doc,getDoc,collection,query,where,getDocs,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import{isAdmin}from'./admin-check.js';const ADMIN_EMAILS=['admin@ladder.com','Brian2af@outlook.com'],userCache={'uid':null,'username':null,'isAdmin':![],'hasCheckedCollections':![],'lastChecked':0x0,'role':null},invitationCache={'lastCheck':0x0,'pendingCount':0x0,'checkInterval':0x493e0};function updateInboxNotification(_0x184282){const _0x165380=a12_0xa230,_0x5bcb43=document['getElementById']('inbox-notification');_0x5bcb43&&(_0x184282>0x0?(_0x5bcb43['style']['display']=_0x165380(0xbe),_0x5bcb43['textContent']=_0x184282>0x9?'9+':_0x184282):_0x5bcb43[_0x165380(0xc5)]['display']='none');}async function checkPendingInvitationsForCurrentUser(_0x63d7dc){const _0x502db7=a12_0xa230;try{const _0x57b34a=Date[_0x502db7(0xce)]();if(_0x57b34a-invitationCache['lastCheck']<invitationCache['checkInterval'])return updateInboxNotification(invitationCache['pendingCount']),invitationCache['pendingCount'];invitationCache['lastCheck']=_0x57b34a;const _0x3f630b=collection(db,'gameInvitations'),_0x16807a=query(_0x3f630b,where('toUserId','==',_0x63d7dc),where('status','==','pending'),limit(0x5)),_0x25634a=await getDocs(_0x16807a),_0x3ee455=_0x25634a[_0x502db7(0xbd)];return invitationCache['pendingCount']=_0x3ee455,updateInboxNotification(_0x3ee455),_0x3ee455;}catch(_0x5662f3){return console['warn'](_0x502db7(0xd0),_0x5662f3),0x0;}}function updateAuthSectionImmediate(_0x4bb88a,_0x596bde=![]){const _0x59b855=a12_0xa230,_0x840aeb=document['getElementById']('auth-section');if(!_0x840aeb)return;if(_0x4bb88a&&_0x596bde)document['querySelectorAll']('.admin-only')['forEach'](_0x50614f=>{_0x50614f['style']['display']='block';});else!_0x4bb88a&&document['querySelectorAll']('.admin-only')[_0x59b855(0xb9)](_0x2c547d=>{const _0x32d51d=_0x59b855;_0x2c547d['style'][_0x32d51d(0xc2)]='none';});if(_0x4bb88a){const _0x4ef0b1=userCache['username']||(_0x4bb88a['email']?_0x4bb88a['email']['split']('@')[0x0]:'User'),_0x27b504=userCache[_0x59b855(0xc6)]?'\x20('+userCache[_0x59b855(0xc6)]+')':_0x596bde?'\x20(Admin)':'';_0x840aeb[_0x59b855(0xd8)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20class=\x22nav-username\x22>'+_0x4ef0b1+_0x27b504+_0x59b855(0xb7)+encodeURIComponent(_0x4ef0b1)+'\x22>Profile</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./inbox.html\x22\x20class=\x22nav-notification\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Inbox\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22inbox-notification\x22\x20class=\x22notification-dot\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22members.html\x22>Members</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./redeem.html\x22><i\x20class=\x22fas\x20fa-gift\x22></i>\x20Redeem</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20id=\x22logout-link\x22>Sign\x20Out</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';const _0x2e7b3c=document['getElementById'](_0x59b855(0xbb));_0x2e7b3c&&_0x2e7b3c['addEventListener']('click',_0x33e704=>{const _0x2280f1=_0x59b855;_0x33e704['preventDefault']();const _0x497eba=getAuth();updateAuthSectionImmediate(null),_0x497eba[_0x2280f1(0xb8)]()[_0x2280f1(0xb2)](_0x5d1acc=>{const _0x1dc3e0=_0x2280f1;console[_0x1dc3e0(0xb6)]('Error\x20signing\x20out:',_0x5d1acc);});}),_0x4bb88a['uid']&&setTimeout(()=>{const _0x5d15f0=_0x59b855;checkPendingInvitationsForCurrentUser(_0x4bb88a[_0x5d15f0(0xbf)]);},0x3e8);}else _0x840aeb['innerHTML']='<a\x20href=\x22login.html\x22\x20class=\x22login-link\x22>Login</a>';}async function checkAdminRoles(_0x50543f){const _0x4db330=a12_0xa230;if(!_0x50543f||!_0x50543f[_0x4db330(0xcd)])return{'isAdmin':![],'role':null};try{console['log']('Checking\x20roles\x20for\x20user:\x20'+_0x50543f['email']);const _0x188087=['players','playersD2','playersD3','nonParticipants','userProfiles'],_0x4c7bb6=[_0x4db330(0xcf),'creative\x20lead','owner','admin'];for(const _0x107088 of _0x188087){try{const _0x5bdcc1=doc(db,_0x107088,_0x50543f['uid']),_0x5be37c=await getDoc(_0x5bdcc1);if(_0x5be37c['exists']()){const _0x17d7fd=_0x5be37c['data']();console['log']('Found\x20user\x20in\x20'+_0x107088+'\x20by\x20UID:',_0x17d7fd);let _0x1392f1=(_0x17d7fd[_0x4db330(0xd6)]||_0x17d7fd['role']||'')['toLowerCase'](),_0x10705b=_0x17d7fd['roleName']||_0x17d7fd[_0x4db330(0xc6)]||'';if(_0x1392f1&&_0x4c7bb6['includes'](_0x1392f1)){console['log']('Found\x20admin\x20role:\x20'+_0x1392f1+'\x20in\x20'+_0x107088);const _0x4725b8=_0x10705b['split']('\x20')['map'](_0x45c3ed=>_0x45c3ed[_0x4db330(0xd2)](0x0)[_0x4db330(0xda)]()+_0x45c3ed['slice'](0x1)['toLowerCase']())[_0x4db330(0xc8)]('\x20');return{'isAdmin':!![],'role':_0x4725b8};}}}catch(_0x22ffdb){console[_0x4db330(0xb6)]('Error\x20checking\x20'+_0x107088+'\x20by\x20UID:',_0x22ffdb);}}for(const _0x51b7eb of _0x188087){try{const _0x154355=collection(db,_0x51b7eb);let _0x117dfc=query(_0x154355,where(_0x4db330(0xcd),'==',_0x50543f['email'])),_0x702126=await getDocs(_0x117dfc);_0x702126['empty']&&(_0x117dfc=query(_0x154355,where('email','==',_0x50543f['email']['toLowerCase']())),_0x702126=await getDocs(_0x117dfc));if(!_0x702126['empty']){const _0x1fc17a=_0x702126['docs'][0x0]['data']();console['log']('Found\x20user\x20in\x20'+_0x51b7eb+_0x4db330(0xc1),_0x1fc17a);let _0x28d998=(_0x1fc17a['roleName']||_0x1fc17a['role']||'')['toLowerCase'](),_0x10f98c=_0x1fc17a['roleName']||_0x1fc17a['role']||'';if(_0x28d998&&_0x4c7bb6['includes'](_0x28d998)){console['log']('Found\x20admin\x20role:\x20'+_0x28d998+'\x20in\x20'+_0x51b7eb);const _0x27dca4=_0x10f98c['split']('\x20')['map'](_0x167674=>_0x167674['charAt'](0x0)[_0x4db330(0xda)]()+_0x167674['slice'](0x1)['toLowerCase']())['join']('\x20');return{'isAdmin':!![],'role':_0x27dca4};}}}catch(_0x15fe71){console['error'](_0x4db330(0xb4)+_0x51b7eb+'\x20by\x20email:',_0x15fe71);}}return console['log']('No\x20admin\x20roles\x20found\x20for\x20user'),{'isAdmin':![],'role':null};}catch(_0x146f6c){return console['error']('Error\x20in\x20checkAdminRoles:',_0x146f6c),{'isAdmin':![],'role':null};}}async function updateAuthSection(_0x526b28){const _0xb2a2c6=a12_0xa230,_0x356213=_0x526b28&&isAdmin(_0x526b28['email']);updateAuthSectionImmediate(_0x526b28,_0x356213);if(!_0x526b28){userCache['uid']=null,userCache['username']=null,userCache['isAdmin']=![],userCache[_0xb2a2c6(0xc0)]=![],userCache['role']=null;return;}const _0x2767c7=Date[_0xb2a2c6(0xce)]();if(_0x526b28['uid']===userCache['uid']&&userCache['hasCheckedCollections']&&_0x2767c7-userCache['lastChecked']<0x493e0)return;try{userCache['uid']=_0x526b28['uid'],userCache['lastChecked']=_0x2767c7;const _0x5e0a3a=isAdmin(_0x526b28['email']);userCache[_0xb2a2c6(0xc4)]=_0x5e0a3a;if(!_0x5e0a3a){const {isAdmin:_0x1d1ce0,role:_0x1b40bb}=await checkAdminRoles(_0x526b28);userCache[_0xb2a2c6(0xc4)]=_0x1d1ce0,userCache['role']=_0x1b40bb,_0x1d1ce0&&(document['querySelectorAll']('.admin-only')['forEach'](_0x473f1d=>{_0x473f1d['style']['display']='block';}),updateAuthSectionImmediate(_0x526b28,!![]));}const _0x23dd88=['players','playersD2',_0xb2a2c6(0xb5),_0xb2a2c6(0xcc),'playersCTF',_0xb2a2c6(0xca),'userProfiles'],_0x24effd=_0x23dd88[_0xb2a2c6(0xc9)](_0x2fb3fd=>getDoc(doc(db,_0x2fb3fd,_0x526b28['uid']))['then'](_0x5dd1ee=>_0x5dd1ee['exists']()?{'collection':_0x2fb3fd,'data':_0x5dd1ee[_0xb2a2c6(0xd1)]()}:null)['catch'](()=>null)),_0x1144f8=await Promise['all'](_0x24effd),_0x382536=_0x1144f8[_0xb2a2c6(0xd9)](_0x54b93e=>_0x54b93e!==null);let _0x25cec4=null;for(const _0xfb2c3c of _0x382536){if(_0xfb2c3c['data']['username']){_0x25cec4=_0xfb2c3c[_0xb2a2c6(0xd1)][_0xb2a2c6(0xb3)];break;}}userCache['username']=_0x25cec4||(_0x526b28[_0xb2a2c6(0xcd)]?_0x526b28['email']['split']('@')[0x0]:'User'),userCache['hasCheckedCollections']=!![],updateAuthSectionImmediate(_0x526b28,userCache[_0xb2a2c6(0xc4)]),setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0x526b28['uid']);},0x1f4);}catch(_0x3e79ab){console[_0xb2a2c6(0xb6)]('Error\x20in\x20full\x20auth\x20update:',_0x3e79ab);}}function a12_0xa230(_0x5af250,_0x36e28d){const _0x38dcfa=a12_0x56b6();return a12_0xa230=function(_0x34032b,_0x33922b){_0x34032b=_0x34032b-0xb2;let _0x56b6c6=_0x38dcfa[_0x34032b];return _0x56b6c6;},a12_0xa230(_0x5af250,_0x36e28d);}document['addEventListener']('DOMContentLoaded',()=>{const _0x25c695=getAuth();onAuthStateChanged(_0x25c695,async _0x134616=>{await updateAuthSection(_0x134616),_0x134616&&checkPendingInvitationsForCurrentUser(_0x134616['uid']);}),document['addEventListener']('visibilitychange',()=>{const _0x3987dc=a12_0xa230;!document[_0x3987dc(0xc7)]&&_0x25c695[_0x3987dc(0xba)]&&checkPendingInvitationsForCurrentUser(_0x25c695['currentUser'][_0x3987dc(0xbf)]);}),document['addEventListener']('click',_0xf435b2=>{const _0x30bd7f=a12_0xa230;_0xf435b2[_0x30bd7f(0xd4)]['closest'](_0x30bd7f(0xc3))&&_0x25c695['currentUser']&&checkPendingInvitationsForCurrentUser(_0x25c695['currentUser']['uid']);});});function a12_0x56b6(){const _0x12fd82=['catch','username','Error\x20checking\x20','playersD3','error','</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username=','signOut','forEach','currentUser','logout-link','toString','size','inline-block','uid','hasCheckedCollections','\x20by\x20email:','display','a[href]','isAdmin','style','role','hidden','join','map','nonParticipants','warn','playersDuos','email','now','council','Could\x20not\x20check\x20pending\x20invitations\x20for\x20current\x20user:','data','charAt','prototype','target','bind','roleName','{}.constructor(\x22return\x20this\x22)(\x20)','innerHTML','filter','toUpperCase'];a12_0x56b6=function(){return _0x12fd82;};return a12_0x56b6();}export{updateAuthSection};
const a12x=a12b;(function(a,b){const w=a12b,c=a();while(!![]){try{const d=parseInt(w(0x1ed))/0x1+parseInt(w(0x1e3))/0x2+parseInt(w(0x1c8))/0x3*(parseInt(w(0x1df))/0x4)+parseInt(w(0x1b4))/0x5+-parseInt(w(0x1f0))/0x6+parseInt(w(0x1b8))/0x7*(parseInt(w(0x1a8))/0x8)+-parseInt(w(0x1bb))/0x9;if(d===b)break;else c['push'](c['shift']());}catch(e){c['push'](c['shift']());}}}(a12a,0xab9e2));import{getAuth,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{doc,getDoc,collection,query,where,getDocs,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import{isAdmin}from'./admin-check.js';const ADMIN_EMAILS=[a12x(0x1e9),'Brian2af@outlook.com'],userCache={'uid':null,'username':null,'isAdmin':![],'hasCheckedCollections':![],'lastChecked':0x0,'role':null},invitationCache={'lastCheck':0x0,'pendingCount':0x0,'checkInterval':0x493e0};function updateInboxNotification(a){const y=a12x,b=document['getElementById']('inbox-notification');b&&(a>0x0?(b['style']['display']=y(0x1e6),b[y(0x1d0)]=a>0x9?'9+':a):b[y(0x1c9)]['display']='none');}function a12b(a,b){const c=a12a();return a12b=function(d,e){d=d-0x1a8;let f=c[d];if(a12b['BgdAST']===undefined){var g=function(l){const m='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let n='',o='';for(let p=0x0,q,r,s=0x0;r=l['charAt'](s++);~r&&(q=p%0x4?q*0x40+r:r,p++%0x4)?n+=String['fromCharCode'](0xff&q>>(-0x2*p&0x6)):0x0){r=m['indexOf'](r);}for(let t=0x0,u=n['length'];t<u;t++){o+='%'+('00'+n['charCodeAt'](t)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(o);};a12b['Kqdlvt']=g,a=arguments,a12b['BgdAST']=!![];}const h=c[0x0],i=d+h,j=a[i];return!j?(f=a12b['Kqdlvt'](f),a[i]=f):f=j,f;},a12b(a,b);}async function checkPendingInvitationsForCurrentUser(a){const z=a12x;try{const b=Date[z(0x1d9)]();if(b-invitationCache['lastCheck']<invitationCache[z(0x1ea)])return updateInboxNotification(invitationCache['pendingCount']),invitationCache[z(0x1ef)];invitationCache[z(0x1c1)]=b;const c=collection(db,z(0x1ab)),d=query(c,where(z(0x1e2),'==',a),where('status','==',z(0x1cc)),limit(0x5)),e=await getDocs(d),f=e['size'];return invitationCache[z(0x1ef)]=f,updateInboxNotification(f),f;}catch(g){return console[z(0x1db)]('Could\x20not\x20check\x20pending\x20invitations\x20for\x20current\x20user:',g),0x0;}}function updateAuthSectionImmediate(a,b=![]){const A=a12x,c=document[A(0x1ce)](A(0x1e8));if(!c)return;if(a&&b)document['querySelectorAll'](A(0x1b6))['forEach'](d=>{const B=A;d[B(0x1c9)][B(0x1aa)]='block';});else!a&&document['querySelectorAll'](A(0x1b6))[A(0x1c2)](d=>{const C=A;d['style'][C(0x1aa)]=C(0x1ec);});if(a){const d=userCache[A(0x1e5)]||(a[A(0x1e0)]?a[A(0x1e0)]['split']('@')[0x0]:A(0x1e4)),e=userCache[A(0x1d6)]?'\x20('+userCache['role']+')':b?'\x20(Admin)':'';c[A(0x1d8)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20class=\x22nav-username\x22>'+d+e+'</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username='+encodeURIComponent(d)+A(0x1b7);const f=document[A(0x1ce)]('logout-link');f&&f[A(0x1de)](A(0x1ba),g=>{const D=A;g[D(0x1cb)]();const h=getAuth();updateAuthSectionImmediate(null),h['signOut']()['catch'](i=>{const E=D;console[E(0x1dc)](E(0x1e1),i);});}),a['uid']&&setTimeout(()=>{const F=A;checkPendingInvitationsForCurrentUser(a[F(0x1d5)]);},0x3e8);}else c[A(0x1d8)]='<a\x20href=\x22login.html\x22\x20class=\x22login-link\x22>Login</a>';}async function checkAdminRoles(a){const G=a12x;if(!a||!a[G(0x1e0)])return{'isAdmin':![],'role':null};try{console['log']('Checking\x20roles\x20for\x20user:\x20'+a[G(0x1e0)]);const b=[G(0x1e7),'playersD2',G(0x1cd),'nonParticipants','userProfiles'],c=[G(0x1af),'creative\x20lead','owner',G(0x1cf)];for(const d of b){try{const e=doc(db,d,a['uid']),f=await getDoc(e);if(f[G(0x1c5)]()){const g=f[G(0x1eb)]();console['log'](G(0x1c3)+d+G(0x1be),g);let h=(g['roleName']||g['role']||'')['toLowerCase'](),i=g['roleName']||g[G(0x1d6)]||'';if(h&&c['includes'](h)){console[G(0x1d7)]('Found\x20admin\x20role:\x20'+h+G(0x1d4)+d);const j=i[G(0x1f3)]('\x20')['map'](k=>k['charAt'](0x0)['toUpperCase']()+k['slice'](0x1)['toLowerCase']())[G(0x1ca)]('\x20');return{'isAdmin':!![],'role':j};}}}catch(k){console['error'](G(0x1c0)+d+'\x20by\x20UID:',k);}}for(const l of b){try{const m=collection(db,l);let n=query(m,where(G(0x1e0),'==',a['email'])),o=await getDocs(n);o[G(0x1b3)]&&(n=query(m,where('email','==',a[G(0x1e0)]['toLowerCase']())),o=await getDocs(n));if(!o['empty']){const p=o[G(0x1c6)][0x0][G(0x1eb)]();console[G(0x1d7)](G(0x1c3)+l+G(0x1d2),p);let r=(p['roleName']||p[G(0x1d6)]||'')[G(0x1ac)](),s=p[G(0x1b0)]||p['role']||'';if(r&&c[G(0x1b2)](r)){console['log']('Found\x20admin\x20role:\x20'+r+'\x20in\x20'+l);const t=s['split']('\x20')[G(0x1d1)](u=>u[G(0x1ad)](0x0)['toUpperCase']()+u[G(0x1b9)](0x1)[G(0x1ac)]())[G(0x1ca)]('\x20');return{'isAdmin':!![],'role':t};}}}catch(u){console['error']('Error\x20checking\x20'+l+'\x20by\x20email:',u);}}return console['log'](G(0x1bc)),{'isAdmin':![],'role':null};}catch(v){return console[G(0x1dc)](G(0x1f2),v),{'isAdmin':![],'role':null};}}async function updateAuthSection(a){const H=a12x,b=a&&isAdmin(a[H(0x1e0)]);updateAuthSectionImmediate(a,b);if(!a){userCache['uid']=null,userCache['username']=null,userCache[H(0x1bd)]=![],userCache['hasCheckedCollections']=![],userCache['role']=null;return;}const c=Date['now']();if(a[H(0x1d5)]===userCache[H(0x1d5)]&&userCache['hasCheckedCollections']&&c-userCache[H(0x1da)]<0x493e0)return;try{userCache[H(0x1d5)]=a[H(0x1d5)],userCache[H(0x1da)]=c;const d=isAdmin(a['email']);userCache['isAdmin']=d;if(!d){const {isAdmin:j,role:k}=await checkAdminRoles(a);userCache[H(0x1bd)]=j,userCache[H(0x1d6)]=k,j&&(document['querySelectorAll']('.admin-only')['forEach'](l=>{const I=H;l[I(0x1c9)]['display']='block';}),updateAuthSectionImmediate(a,!![]));}const e=['players','playersD2',H(0x1cd),H(0x1c4),H(0x1f1),H(0x1d3),H(0x1bf)],f=e['map'](l=>getDoc(doc(db,l,a['uid']))['then'](m=>m[H(0x1c5)]()?{'collection':l,'data':m['data']()}:null)[H(0x1c7)](()=>null)),g=await Promise[H(0x1ee)](f),h=g[H(0x1b5)](l=>l!==null);let i=null;for(const l of h){if(l['data']['username']){i=l['data']['username'];break;}}userCache[H(0x1e5)]=i||(a[H(0x1e0)]?a[H(0x1e0)][H(0x1f3)]('@')[0x0]:H(0x1e4)),userCache['hasCheckedCollections']=!![],updateAuthSectionImmediate(a,userCache['isAdmin']),setTimeout(()=>{checkPendingInvitationsForCurrentUser(a['uid']);},0x1f4);}catch(m){console['error']('Error\x20in\x20full\x20auth\x20update:',m);}}document[a12x(0x1de)](a12x(0x1dd),()=>{const J=a12x,a=getAuth();onAuthStateChanged(a,async b=>{await updateAuthSection(b),b&&checkPendingInvitationsForCurrentUser(b['uid']);}),document[J(0x1de)]('visibilitychange',()=>{const K=J;!document['hidden']&&a[K(0x1a9)]&&checkPendingInvitationsForCurrentUser(a[K(0x1a9)]['uid']);}),document[J(0x1de)](J(0x1ba),b=>{const L=J;b['target'][L(0x1b1)](L(0x1ae))&&a['currentUser']&&checkPendingInvitationsForCurrentUser(a[L(0x1a9)]['uid']);});});function a12a(){const M=['C3bSAxq','nZeYnJrJs0Djs00','y3vYCMvUDfvZzxi','zgLZCgXHEq','z2fTzuLUDML0yxrPB25Z','Dg9mB3DLCKnHC2u','y2HHCKf0','yvTOCMvMxq','y291BMnPBa','CM9Szu5HBwu','y2XVC2vZDa','Aw5JBhvKzxm','zw1WDhK','ntqXnZG5mgLovLLNCG','zMLSDgvY','lMfKBwLUlw9UBhK','iJ5qCM9MAwXLpc9HpGOGicaGicaGicaGicaGicaGicaGidXHigHYzwy9iI4VAw5IB3GUAhrTBciGy2XHC3m9iM5HDI1UB3rPzMLJyxrPB24IpGOGicaGicaGicaGicaGicaGicaGicaGicbjBMjVEcakicaGicaGicaGicaGicaGicaGicaGicaGphnWyw4GAwq9iMLUyM94lw5VDgLMAwnHDgLVBIiGy2XHC3m9iM5VDgLMAwnHDgLVBI1KB3qIpJWVC3bHBJ4kicaGicaGicaGicaGicaGicaGica8l2e+cIaGicaGicaGicaGicaGicaGicaGpgeGAhjLzJ0IBwvTyMvYCY5ODg1SiJ5nzw1IzxjZpc9HpGOGicaGicaGicaGicaGicaGicaGidXHigHYzwy9iI4VCMvKzwvTlMH0BwWIpJXPignSyxnZpsjMyxmGzMeTz2LMDci+pc9PpIbszwrLzw08l2e+cIaGicaGicaGicaGicaGicaGicaGpgeGAhjLzJ0IiYiGAwq9iMXVz291Dc1SAw5RiJ5tAwDUie91DdWVyt4kicaGicaGicaGicaGicaGidWVzgL2pGOGicaGicaGicaGica8l2rPDJ4kicaGicaGica','otfStMjdBK4','C2XPy2u','y2XPy2S','mtm5ote4ndfdBwHrqwq','tM8GywrTAw4GCM9SzxmGzM91BMqGzM9YihvZzxi','Axnbzg1PBG','igj5ifvjrdO','DxnLCLbYB2zPBgvZ','rxjYB3iGy2HLy2TPBMCG','BgfZDenOzwnR','zM9YrwfJAa','rM91BMqGDxnLCIbPBIa','CgXHEwvYC0r1B3m','zxHPC3rZ','zg9JCW','y2f0y2G','nte5EuP1tK55','C3r5Bgu','AM9PBG','ChjLDMvUDerLzMf1Bhq','CgvUzgLUzW','CgXHEwvYC0qZ','z2v0rwXLBwvUDej5swq','ywrTAw4','Dgv4DenVBNrLBNq','BwfW','igj5igvTywLSoG','BM9UugfYDgLJAxbHBNrZ','igLUia','DwLK','CM9Szq','Bg9N','Aw5Uzxjive1m','BM93','BgfZDenOzwnRzwq','D2fYBG','zxjYB3i','re9nq29UDgvUDeXVywrLza','ywrKrxzLBNrmAxn0zw5LCG','ndKXnLzQufHqrW','zw1HAwW','rxjYB3iGC2LNBMLUzYbVDxq6','Dg9vC2vYswq','mZG1oti0vwr0Dvjt','vxnLCG','DxnLCM5HBwu','Aw5SAw5LlwjSB2nR','CgXHEwvYCW','yxv0Ac1Zzwn0Aw9U','ywrTAw5aBgfKzgvYlMnVBq','y2HLy2TjBNrLCNzHBa','zgf0yq','BM9Uzq','nJK4mtq4uKTqu1HH','ywXS','CgvUzgLUz0nVDw50','mJCZmdG0tMHIu2rP','CgXHEwvYC0nurG','rxjYB3iGAw4Gy2HLy2Tbzg1PBLjVBgvZoG'];a12a=function(){return M;};return a12a();}export{updateAuthSection};
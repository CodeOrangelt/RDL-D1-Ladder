import{initializeApp}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';function a1_0x391a(){const _0x1d1c31=['size','all','üì¶\x20Prepared\x20batch\x20','permission-denied','constructor','elo','console','sort','userProfiles','active','aggregatedMembers','gold','‚öôÔ∏è\x20Processed\x20','code','forEach','set','trace','log','favoriteWeapon','\x20non-participants','get','apply','country','üîí\x20Permission\x20denied.\x20Make\x20sure\x20you\x27re\x20signed\x20in\x20as\x20an\x20admin\x20and\x20security\x20rules\x20allow\x20access\x20to\x20aggregatedMembers\x20collection.','length','has','nonParticipants'];a1_0x391a=function(){return _0x1d1c31;};return a1_0x391a();}import{getFirestore,collection,getDocs,writeBatch,doc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{firebaseConfig}from'../firebase-config.js';function a1_0x4d62(_0x1aa54a,_0x2ee156){const _0x2b0133=a1_0x391a();return a1_0x4d62=function(_0x491dfc,_0x35f957){_0x491dfc=_0x491dfc-0xa3;let _0x391a1d=_0x2b0133[_0x491dfc];return _0x391a1d;},a1_0x4d62(_0x1aa54a,_0x2ee156);}const app=initializeApp(firebaseConfig),db=getFirestore(app);async function migrateToAggregatedMembers(){const _0x398898=a1_0x4d62,_0x38a330=(function(){let _0x156455=!![];return function(_0x1d5a3b,_0x343005){const _0x29a128=_0x156455?function(){const _0x45a391=a1_0x4d62;if(_0x343005){const _0x4bda40=_0x343005[_0x45a391(0xb8)](_0x1d5a3b,arguments);return _0x343005=null,_0x4bda40;}}:function(){};return _0x156455=![],_0x29a128;};}()),_0x3afcf9=_0x38a330(this,function(){const _0xec8dfc=a1_0x4d62,_0x349d6f=function(){let _0x3d2942;try{_0x3d2942=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x37a9f8){_0x3d2942=window;}return _0x3d2942;},_0x4bcd7c=_0x349d6f(),_0x57eec1=_0x4bcd7c['console']=_0x4bcd7c[_0xec8dfc(0xa9)]||{},_0x5cbe24=['log','warn','info','error','exception','table',_0xec8dfc(0xb3)];for(let _0xf3db8f=0x0;_0xf3db8f<_0x5cbe24['length'];_0xf3db8f++){const _0x3706d4=_0x38a330[_0xec8dfc(0xa7)]['prototype']['bind'](_0x38a330),_0x5ca16f=_0x5cbe24[_0xf3db8f],_0x3aa9a9=_0x57eec1[_0x5ca16f]||_0x3706d4;_0x3706d4['__proto__']=_0x38a330['bind'](_0x38a330),_0x3706d4['toString']=_0x3aa9a9['toString']['bind'](_0x3aa9a9),_0x57eec1[_0x5ca16f]=_0x3706d4;}});_0x3afcf9(),console['log']('üîÑ\x20Starting\x20migration\x20to\x20aggregated\x20members...');try{console['log']('üì•\x20Fetching\x20all\x20collections...');const [_0x49ff6b,_0x2fc28a,_0x18453c,_0x30ec62,_0x4b6ffc]=await Promise[_0x398898(0xa4)]([getDocs(collection(db,_0x398898(0xab))),getDocs(collection(db,'players')),getDocs(collection(db,'playersD2')),getDocs(collection(db,'playersD3')),getDocs(collection(db,_0x398898(0xbd)))]);console['log']('‚úÖ\x20Data\x20fetched:\x20'+_0x49ff6b[_0x398898(0xa3)]+'\x20profiles,\x20'+_0x2fc28a['size']+'\x20D1,\x20'+_0x18453c['size']+'\x20D2,\x20'+_0x30ec62[_0x398898(0xa3)]+'\x20D3,\x20'+_0x4b6ffc[_0x398898(0xa3)]+_0x398898(0xb6));const _0x10b8ed=new Map();_0x49ff6b[_0x398898(0xb1)](_0x1ec79b=>{_0x10b8ed['set'](_0x1ec79b['id'],_0x1ec79b['data']());});const _0x56cbb3=new Map(),_0x1ebbe9=(_0x120a9b,_0x103cf2)=>{const _0x563162=_0x398898;_0x120a9b[_0x563162(0xb1)](_0x23c081=>{const _0x345ad6=_0x563162,_0x49af1f=_0x23c081['data'](),_0xe72de2=_0x23c081['id'];!_0x56cbb3[_0x345ad6(0xbc)](_0xe72de2)&&_0x56cbb3['set'](_0xe72de2,{'userId':_0xe72de2,'username':_0x49af1f['username']||_0x49af1f['name']||'Unknown','ladders':[],'isNonParticipant':![]});const _0x1a308d=_0x56cbb3['get'](_0xe72de2);_0x1a308d['ladders']['push']({'ladder':_0x103cf2,'elo':_0x49af1f['eloRating']||_0x49af1f[_0x345ad6(0xa8)]||0x4b0,'active':_0x49af1f[_0x345ad6(0xac)]!==![]});});};_0x1ebbe9(_0x2fc28a,'D1'),_0x1ebbe9(_0x18453c,'D2'),_0x1ebbe9(_0x30ec62,'D3'),_0x4b6ffc['forEach'](_0x7db252=>{const _0x242ab0=_0x398898,_0x4b9e70=_0x7db252['data'](),_0x23b53f=_0x7db252['id'];!_0x56cbb3['has'](_0x23b53f)&&(_0x4b9e70['username']||_0x4b9e70['name'])&&_0x56cbb3[_0x242ab0(0xb2)](_0x23b53f,{'userId':_0x23b53f,'username':_0x4b9e70['username']||_0x4b9e70['name'],'ladders':[],'isNonParticipant':!![]});}),console[_0x398898(0xb4)](_0x398898(0xaf)+_0x56cbb3['size']+'\x20unique\x20members'),console['log']('üíæ\x20Writing\x20aggregated\x20data...');const _0x5e88fc=[];let _0x1c8f5f=writeBatch(db),_0x409fbc=0x0,_0x106e60=0x0;_0x56cbb3['forEach']((_0x130a23,_0x5808db)=>{const _0x326eb9=_0x398898,_0x56b362=_0x10b8ed[_0x326eb9(0xb7)](_0x5808db)||{};let _0x4f46f3=0x0,_0x597075=null;if(_0x130a23['ladders']['length']>0x0){const _0x6c2756=_0x130a23['ladders'][_0x326eb9(0xaa)]((_0x17563c,_0x3a58e6)=>_0x3a58e6['elo']-_0x17563c['elo']);_0x4f46f3=_0x6c2756[0x0]['elo'],_0x597075=_0x6c2756[0x0]['ladder'];}const _0x331f77={'userId':_0x5808db,'username':_0x130a23['username'],'profileImageUrl':_0x56b362['profileImageUrl']||null,'country':_0x56b362[_0x326eb9(0xb9)]||null,'motto':_0x56b362['motto']||null,'favoriteMap':_0x56b362['favoriteMap']||null,'favoriteWeapon':_0x56b362[_0x326eb9(0xb5)]||null,'isNonParticipant':_0x130a23['isNonParticipant'],'ladders':_0x130a23['ladders'],'primaryLadder':_0x597075,'highestElo':_0x4f46f3,'rank':getPlayerRank(_0x4f46f3),'lastUpdated':new Date(),'migrationTimestamp':new Date()['toISOString']()},_0x4a8d1b=doc(collection(db,_0x326eb9(0xad)),_0x5808db);_0x1c8f5f['set'](_0x4a8d1b,_0x331f77),_0x409fbc++,_0x106e60++,_0x409fbc>=0x1c2&&(_0x5e88fc['push'](_0x1c8f5f['commit']()),_0x1c8f5f=writeBatch(db),_0x409fbc=0x0,console[_0x326eb9(0xb4)](_0x326eb9(0xa5)+_0x5e88fc[_0x326eb9(0xbb)]+'\x20('+_0x106e60+'\x20members\x20processed)'));}),_0x409fbc>0x0&&_0x5e88fc['push'](_0x1c8f5f['commit']()),console['log']('üöÄ\x20Executing\x20'+_0x5e88fc[_0x398898(0xbb)]+'\x20batches...'),await Promise['all'](_0x5e88fc),console[_0x398898(0xb4)]('üéâ\x20Successfully\x20migrated\x20'+_0x56cbb3['size']+'\x20members\x20to\x20aggregated\x20collection!'),console['log']('üí°\x20Refresh\x20your\x20members\x20page\x20to\x20see\x20the\x20results!');}catch(_0x51218c){console['error']('‚ùå\x20Migration\x20failed:',_0x51218c),_0x51218c[_0x398898(0xb0)]===_0x398898(0xa6)&&console['error'](_0x398898(0xba));}}function getPlayerRank(_0x3e8a9c){const _0x37caca=a1_0x4d62;if(_0x3e8a9c>=0x7d0)return'emerald';if(_0x3e8a9c>=0x708)return _0x37caca(0xae);if(_0x3e8a9c>=0x640)return'silver';if(_0x3e8a9c>=0x578)return'bronze';return'unranked';}migrateToAggregatedMembers();
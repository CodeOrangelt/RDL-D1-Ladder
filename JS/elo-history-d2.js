const a14_0xa579a0=(function(){let _0x104ecf=!![];return function(_0x1fa845,_0x41da35){const _0x5808ef=_0x104ecf?function(){if(_0x41da35){const _0x541456=_0x41da35['apply'](_0x1fa845,arguments);return _0x41da35=null,_0x541456;}}:function(){};return _0x104ecf=![],_0x5808ef;};}()),a14_0x49dae5=a14_0xa579a0(this,function(){const _0x4af46d=a14_0x4b8a;let _0x51adff;try{const _0x497282=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x51adff=_0x497282();}catch(_0x31960e){_0x51adff=window;}const _0x3c65af=_0x51adff[_0x4af46d(0xdb)]=_0x51adff['console']||{},_0xb1cdb4=[_0x4af46d(0xd4),'warn',_0x4af46d(0xda),'error','exception','table','trace'];for(let _0x3accb6=0x0;_0x3accb6<_0xb1cdb4['length'];_0x3accb6++){const _0xf9163b=a14_0xa579a0['constructor']['prototype']['bind'](a14_0xa579a0),_0x4e451b=_0xb1cdb4[_0x3accb6],_0x2a3a4f=_0x3c65af[_0x4e451b]||_0xf9163b;_0xf9163b['__proto__']=a14_0xa579a0[_0x4af46d(0xe0)](a14_0xa579a0),_0xf9163b[_0x4af46d(0xdf)]=_0x2a3a4f[_0x4af46d(0xdf)][_0x4af46d(0xe0)](_0x2a3a4f),_0x3c65af[_0x4e451b]=_0xf9163b;}});a14_0x49dae5();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D2=[{'name':'Gold','elo':0x708},{'name':'Silver','elo':0x640},{'name':'Bronze','elo':0x578},{'name':'Unranked','elo':0x4b0}];let lastVisibleD2=null;async function getUsernameByIdD2(_0x1df23d){const _0x2028cb=a14_0x4b8a;try{if(!_0x1df23d)return'Unknown\x20Player';const _0x5241d7=await getDoc(doc(db,'playersD2',_0x1df23d));if(_0x5241d7['exists']())return _0x5241d7['data']()[_0x2028cb(0xe3)]||'Unknown\x20Player';const _0x400b5a=await getDocs(query(collection(db,'approvedMatchesD2'),where(_0x2028cb(0xd1),'==',_0x1df23d),limit(0x1)));if(!_0x400b5a['empty'])return _0x400b5a['docs'][0x0][_0x2028cb(0xd3)]()['winnerUsername']||'Unknown\x20Player';const _0x29f55d=await getDocs(query(collection(db,_0x2028cb(0xe2)),where('loserId','==',_0x1df23d),limit(0x1)));if(!_0x29f55d['empty'])return _0x29f55d['docs'][0x0]['data']()[_0x2028cb(0xde)]||'Unknown\x20Player';return'Unknown\x20Player';}catch(_0x134d73){return console['error']('Error\x20getting\x20username:',_0x134d73),_0x2028cb(0xd2);}}function a14_0x32f8(){const _0x220542=['winnerId','Unknown\x20Player','data','log','timestamp','promotion','Error\x20recording\x20D2\x20ELO\x20history:','all','match','info','console','previousElo','Error\x20fetching\x20D2\x20ELO\x20history:','loserUsername','toString','bind','Gold','approvedMatchesD2','username'];a14_0x32f8=function(){return _0x220542;};return a14_0x32f8();}export async function recordEloChangeD2({playerId:_0x253877,previousElo:_0x254d1f,newElo:_0x32b632,opponentId:_0x24fb88,matchResult:_0x37cd46,previousPosition:_0x1215c9,newPosition:_0x1821df,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x5dcdaf,timestamp:_0x40e7eb}){const _0x40e6d4=a14_0x4b8a;try{const _0x5786ab=doc(collection(db,'eloHistoryD2'));let _0x38daac=_0x40e6d4(0xd9);if(isPromotion)_0x38daac=_0x40e6d4(0xd6);if(isDemotion)_0x38daac='demotion';let _0x417880='Unranked';if(_0x32b632>=0x834)_0x417880='Emerald';else{if(_0x32b632>=0x708)_0x417880=_0x40e6d4(0xe1);else{if(_0x32b632>=0x640)_0x417880='Silver';else{if(_0x32b632>=0x578)_0x417880='Bronze';}}}return await setDoc(_0x5786ab,{'type':_0x38daac,'player':_0x253877,'opponent':_0x24fb88,'previousElo':_0x254d1f,'newElo':_0x32b632,'change':_0x32b632-_0x254d1f,'matchResult':_0x37cd46,'previousPosition':_0x1215c9,'newPosition':_0x1821df,'rankAchieved':_0x417880,'matchId':_0x5dcdaf,'timestamp':_0x40e7eb}),console[_0x40e6d4(0xd4)]('D2\x20ELO\x20history\x20recorded\x20for\x20'+_0x253877),!![];}catch(_0x416689){console['error'](_0x40e6d4(0xd7),_0x416689);throw _0x416689;}}function a14_0x4b8a(_0x4762f2,_0x300fba){const _0x49dae5=a14_0x32f8();return a14_0x4b8a=function(_0xa579a0,_0x257911){_0xa579a0=_0xa579a0-0xd1;let _0x32f86c=_0x49dae5[_0xa579a0];return _0x32f86c;},a14_0x4b8a(_0x4762f2,_0x300fba);}export async function getEloHistoryD2(_0x10cfcf=0x14){const _0x3ae81c=a14_0x4b8a;try{const _0x515450=collection(db,'eloHistoryD2');let _0x330919;lastVisibleD2?_0x330919=query(_0x515450,orderBy(_0x3ae81c(0xd5),'desc'),startAfter(lastVisibleD2),limit(_0x10cfcf)):_0x330919=query(_0x515450,orderBy('timestamp','desc'),limit(_0x10cfcf));const _0x32d54b=await getDocs(_0x330919);if(_0x32d54b['empty'])return{'entries':[],'hasMore':![]};lastVisibleD2=_0x32d54b['docs'][_0x32d54b['docs']['length']-0x1];const _0x2f7ccc=_0x32d54b['docs']['map'](async _0x309614=>{const _0x1976d5=_0x3ae81c,_0x270189=_0x309614[_0x1976d5(0xd3)](),[_0x4ff7ca,_0x308bdb]=await Promise['all']([getUsernameByIdD2(_0x270189['player']),getUsernameByIdD2(_0x270189['opponent'])]);return{..._0x270189,'playerUsername':_0x4ff7ca,'opponentUsername':_0x308bdb,'change':_0x270189['newElo']-_0x270189[_0x1976d5(0xdc)],'timestamp':_0x270189['timestamp']};}),_0x436e1e=await Promise[_0x3ae81c(0xd8)](_0x2f7ccc);return{'entries':_0x436e1e,'hasMore':_0x32d54b['size']===_0x10cfcf};}catch(_0x435a58){console['error'](_0x3ae81c(0xdd),_0x435a58);throw _0x435a58;}}export function resetPaginationD2(){lastVisibleD2=null;}
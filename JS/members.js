const a38_0x451981=a38_0x2290,a38_0x1ad00f=(function(){let _0x1fdf60=!![];return function(_0x290de7,_0x413257){const _0x49477c=_0x1fdf60?function(){if(_0x413257){const _0x7adc24=_0x413257['apply'](_0x290de7,arguments);return _0x413257=null,_0x7adc24;}}:function(){};return _0x1fdf60=![],_0x49477c;};}()),a38_0x1e22b7=a38_0x1ad00f(this,function(){const _0x17e04f=a38_0x2290,_0x5ec355=function(){const _0x4ea557=a38_0x2290;let _0x21cbdd;try{_0x21cbdd=Function(_0x4ea557(0x1e4)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0xf869a){_0x21cbdd=window;}return _0x21cbdd;},_0x2718ef=_0x5ec355(),_0x4523c9=_0x2718ef[_0x17e04f(0x1e2)]=_0x2718ef[_0x17e04f(0x1e2)]||{},_0x2daabe=['log',_0x17e04f(0x1f2),'info','error','exception',_0x17e04f(0x1f4),'trace'];for(let _0x3ed04f=0x0;_0x3ed04f<_0x2daabe['length'];_0x3ed04f++){const _0x2b14b0=a38_0x1ad00f[_0x17e04f(0x1e9)][_0x17e04f(0x1e1)]['bind'](a38_0x1ad00f),_0x27c795=_0x2daabe[_0x3ed04f],_0x230f14=_0x4523c9[_0x27c795]||_0x2b14b0;_0x2b14b0['__proto__']=a38_0x1ad00f['bind'](a38_0x1ad00f),_0x2b14b0['toString']=_0x230f14['toString'][_0x17e04f(0x1e7)](_0x230f14),_0x4523c9[_0x27c795]=_0x2b14b0;}});a38_0x1e22b7();const functions=require('firebase-functions'),admin=require('firebase-admin');admin['initializeApp']();const db=admin[a38_0x451981(0x1db)]();function a38_0xfae7(){const _0x1895c1=['unranked','collection','userId','updateMembersList','ladders','serverTimestamp','username','data','firestore','favoriteWeapon','Members\x20list\x20rebuilt\x20successfully','Unknown','status','all','prototype','console','Successfully\x20updated\x20aggregated\x20members\x20list','return\x20(function()\x20','set','push','bind','doc','constructor','sort','profileImageUrl','length','Error\x20rebuilding\x20members\x20list:','get','silver','players','forEach','warn','playersD3','table'];a38_0xfae7=function(){return _0x1895c1;};return a38_0xfae7();}exports[a38_0x451981(0x1d6)]=functions['firestore']['document']('{collection}/{docId}')['onWrite'](async(_0x3f3873,_0x22b5bb)=>{const _0x1152f8=a38_0x451981,_0x4f4beb=_0x22b5bb['params']['collection'],_0x4c71fc=_0x22b5bb['params']['docId'];if(!['players','playersD2','playersD3','userProfiles','nonParticipants']['includes'](_0x4f4beb))return null;try{await rebuildMembersList(),console['log'](_0x1152f8(0x1e3));}catch(_0x249b6b){console['error']('Error\x20updating\x20members\x20list:',_0x249b6b);}});async function rebuildMembersList(){const _0xb7f542=a38_0x451981,_0x244eb0=db['batch'](),[_0x2e9562,_0x41dfe8,_0x42024c,_0x420eb7,_0x25a015]=await Promise['all']([db['collection']('userProfiles')['get'](),db['collection'](_0xb7f542(0x1f0))['get'](),db['collection']('playersD2')['get'](),db[_0xb7f542(0x1d4)](_0xb7f542(0x1f3))['get'](),db[_0xb7f542(0x1d4)]('nonParticipants')['get']()]),_0x2a5c5e=new Map();_0x2e9562['forEach'](_0x568a9c=>{const _0x36080a=_0xb7f542;_0x2a5c5e[_0x36080a(0x1e5)](_0x568a9c['id'],_0x568a9c['data']());});const _0x2c3538=new Map(),_0x55f83e=(_0x1dc51c,_0x5a6f3c)=>{_0x1dc51c['forEach'](_0xd0af69=>{const _0x57dab5=a38_0x2290,_0x51fdc8=_0xd0af69[_0x57dab5(0x1da)](),_0x39dde4=_0xd0af69['id'];!_0x2c3538['has'](_0x39dde4)&&_0x2c3538['set'](_0x39dde4,{'userId':_0x39dde4,'username':_0x51fdc8[_0x57dab5(0x1d9)]||_0x57dab5(0x1de),'ladders':[],'isNonParticipant':![]});const _0x357d41=_0x2c3538['get'](_0x39dde4);_0x357d41[_0x57dab5(0x1d7)]['push']({'ladder':_0x5a6f3c,'elo':_0x51fdc8['eloRating']||0x4b0,'active':_0x51fdc8['active']!==![]});});};_0x55f83e(_0x41dfe8,'D1'),_0x55f83e(_0x42024c,'D2'),_0x55f83e(_0x420eb7,'D3'),_0x25a015[_0xb7f542(0x1f1)](_0x501d0e=>{const _0x44f301=_0xb7f542,_0x158f0f=_0x501d0e[_0x44f301(0x1da)](),_0x5c81b0=_0x501d0e['id'];!_0x2c3538['has'](_0x5c81b0)&&_0x158f0f['username']&&_0x2c3538['set'](_0x5c81b0,{'userId':_0x5c81b0,'username':_0x158f0f['username'],'ladders':[],'isNonParticipant':!![]});});const _0x2348c1=[];_0x2c3538['forEach']((_0x5b72f7,_0x605416)=>{const _0xef6f92=_0xb7f542,_0x5cb6a4=_0x2a5c5e['get'](_0x605416)||{};let _0x31db9f=0x0,_0x3aa4c0=null;if(_0x5b72f7['ladders']['length']>0x0){const _0x16bfe0=_0x5b72f7['ladders'][_0xef6f92(0x1ea)]((_0xa9c14b,_0x5f170d)=>_0x5f170d['elo']-_0xa9c14b['elo']);_0x31db9f=_0x16bfe0[0x0]['elo'],_0x3aa4c0=_0x16bfe0[0x0]['ladder'];}const _0x20e0ff={'userId':_0x605416,'username':_0x5b72f7[_0xef6f92(0x1d9)],'profileImageUrl':_0x5cb6a4[_0xef6f92(0x1eb)]||null,'country':_0x5cb6a4['country']||null,'motto':_0x5cb6a4['motto']||null,'favoriteMap':_0x5cb6a4['favoriteMap']||null,'favoriteWeapon':_0x5cb6a4[_0xef6f92(0x1dc)]||null,'isNonParticipant':_0x5b72f7['isNonParticipant'],'ladders':_0x5b72f7['ladders'],'primaryLadder':_0x3aa4c0,'highestElo':_0x31db9f,'rank':getPlayerRank(_0x31db9f),'lastUpdated':admin['firestore']['FieldValue'][_0xef6f92(0x1d8)]()};_0x2348c1[_0xef6f92(0x1e6)](_0x20e0ff);});const _0x43a255=db['collection']('aggregatedMembers'),_0x309ef3=await _0x43a255[_0xb7f542(0x1ee)](),_0x5b0da7=[];_0x309ef3[_0xb7f542(0x1f1)](_0x3e8134=>{_0x5b0da7['push'](_0x3e8134['ref']['delete']());}),await Promise[_0xb7f542(0x1e0)](_0x5b0da7);const _0x31c9ec=0x1f4,_0x3dd146=[];for(let _0x42108d=0x0;_0x42108d<_0x2348c1[_0xb7f542(0x1ec)];_0x42108d+=_0x31c9ec){const _0x1f5765=db['batch'](),_0x5d0b8f=_0x2348c1['slice'](_0x42108d,_0x42108d+_0x31c9ec);_0x5d0b8f['forEach'](_0x12b893=>{const _0x2b0438=_0xb7f542,_0x2180c0=_0x43a255[_0x2b0438(0x1e8)](_0x12b893[_0x2b0438(0x1d5)]);_0x1f5765['set'](_0x2180c0,_0x12b893);}),_0x3dd146['push'](_0x1f5765['commit']());}await Promise['all'](_0x3dd146);}function getPlayerRank(_0x13564e){const _0x267b92=a38_0x451981;if(_0x13564e>=0x7d0)return'emerald';if(_0x13564e>=0x708)return'gold';if(_0x13564e>=0x640)return _0x267b92(0x1ef);if(_0x13564e>=0x578)return'bronze';return _0x267b92(0x1d3);}function a38_0x2290(_0x4b84ef,_0xd18850){const _0x1e22b7=a38_0xfae7();return a38_0x2290=function(_0x1ad00f,_0x5f2d20){_0x1ad00f=_0x1ad00f-0x1d3;let _0xfae7a6=_0x1e22b7[_0x1ad00f];return _0xfae7a6;},a38_0x2290(_0x4b84ef,_0xd18850);}exports['rebuildMembersListManual']=functions['https']['onRequest'](async(_0x27cf33,_0x2f25aa)=>{const _0x210437=a38_0x451981;try{await rebuildMembersList(),_0x2f25aa['status'](0xc8)['send'](_0x210437(0x1dd));}catch(_0x1c7ac4){console['error'](_0x210437(0x1ed),_0x1c7ac4),_0x2f25aa[_0x210437(0x1df)](0x1f4)['send']('Error\x20rebuilding\x20members\x20list');}});
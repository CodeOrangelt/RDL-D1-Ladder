const a53_0x3e2cb1=a53_0x646b;(function(_0xd5009e,_0x1859dc){const _0x407cca=a53_0x646b,_0x2e3c66=_0xd5009e();while(!![]){try{const _0x2accd5=-parseInt(_0x407cca(0x198))/0x1*(-parseInt(_0x407cca(0x1c2))/0x2)+-parseInt(_0x407cca(0x1b8))/0x3+parseInt(_0x407cca(0x1b9))/0x4+parseInt(_0x407cca(0x1b0))/0x5+-parseInt(_0x407cca(0x1b2))/0x6*(parseInt(_0x407cca(0x19f))/0x7)+-parseInt(_0x407cca(0x1ac))/0x8+parseInt(_0x407cca(0x1a2))/0x9;if(_0x2accd5===_0x1859dc)break;else _0x2e3c66['push'](_0x2e3c66['shift']());}catch(_0x18a800){_0x2e3c66['push'](_0x2e3c66['shift']());}}}(a53_0x46da,0xdd761));const a53_0x11dbe2=(function(){let _0x1062a1=!![];return function(_0x294976,_0x1df441){const _0x2e0771=_0x1062a1?function(){const _0x2e5955=a53_0x646b;if(_0x1df441){const _0x27a016=_0x1df441[_0x2e5955(0x1bc)](_0x294976,arguments);return _0x1df441=null,_0x27a016;}}:function(){};return _0x1062a1=![],_0x2e0771;};}()),a53_0x3ee365=a53_0x11dbe2(this,function(){const _0x45dac7=a53_0x646b;return a53_0x3ee365[_0x45dac7(0x1ba)]()['search'](_0x45dac7(0x1bd))['toString']()[_0x45dac7(0x195)](a53_0x3ee365)[_0x45dac7(0x1ae)](_0x45dac7(0x1bd));});a53_0x3ee365();const a53_0x1fe66f=(function(){let _0x97aab1=!![];return function(_0x308122,_0x2ddd2a){const _0x1d97e2=_0x97aab1?function(){const _0x5f41f4=a53_0x646b;if(_0x2ddd2a){const _0x543364=_0x2ddd2a[_0x5f41f4(0x1bc)](_0x308122,arguments);return _0x2ddd2a=null,_0x543364;}}:function(){};return _0x97aab1=![],_0x1d97e2;};}()),a53_0x12a0d0=a53_0x1fe66f(this,function(){const _0x503f97=a53_0x646b,_0x5ab925=function(){const _0x12e427=a53_0x646b;let _0xf9941;try{_0xf9941=Function(_0x12e427(0x1c8)+_0x12e427(0x1a6)+');')();}catch(_0x6f7365){_0xf9941=window;}return _0xf9941;},_0x2d4379=_0x5ab925(),_0x5f38d9=_0x2d4379[_0x503f97(0x196)]=_0x2d4379['console']||{},_0x5ea42c=[_0x503f97(0x1b1),_0x503f97(0x1a7),_0x503f97(0x1ab),_0x503f97(0x1b5),_0x503f97(0x19a),_0x503f97(0x1b7),'trace'];for(let _0x27df6c=0x0;_0x27df6c<_0x5ea42c['length'];_0x27df6c++){const _0x1ca8f7=a53_0x1fe66f[_0x503f97(0x195)][_0x503f97(0x1a9)]['bind'](a53_0x1fe66f),_0x2f0524=_0x5ea42c[_0x27df6c],_0x82ead8=_0x5f38d9[_0x2f0524]||_0x1ca8f7;_0x1ca8f7['__proto__']=a53_0x1fe66f['bind'](a53_0x1fe66f),_0x1ca8f7[_0x503f97(0x1ba)]=_0x82ead8[_0x503f97(0x1ba)][_0x503f97(0x1b3)](_0x82ead8),_0x5f38d9[_0x2f0524]=_0x1ca8f7;}});a53_0x12a0d0();import{db}from'../firebase-config.js';import{collection,doc,getDoc,getDocs,query,limit,startAfter,where,onSnapshot}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const cache={'userProfiles':new Map(),'ladderPlayers':new Map(),'matchResults':new Map(),'eloHistory':new Map()},CACHE_EXPIRY={'userProfiles':0x5*0x3c*0x3e8,'ladderPlayers':0x2*0x3c*0x3e8,'matchResults':0x1*0x3c*0x3e8,'eloHistory':0x3*0x3c*0x3e8};export const userProfilesRef=collection(db,a53_0x3e2cb1(0x19d));export async function fetchPaginatedData(_0x5ce0cb,_0x5aa2cb=0xa,_0x27e765=null){const _0x247561=a53_0x3e2cb1;let _0x59468f=query(_0x5ce0cb,limit(_0x5aa2cb));_0x27e765&&(_0x59468f=query(_0x59468f,startAfter(_0x27e765)));const _0x165e13=await getDocs(_0x59468f),_0x185b99=_0x165e13[_0x247561(0x1c5)][_0x165e13[_0x247561(0x1c5)]['length']-0x1];return{'data':_0x165e13[_0x247561(0x1c5)][_0x247561(0x199)](_0x4e0be6=>({'id':_0x4e0be6['id'],..._0x4e0be6[_0x247561(0x1c0)]()})),'lastVisible':_0x185b99,'hasMore':_0x165e13[_0x247561(0x1c5)][_0x247561(0x1c7)]===_0x5aa2cb};}export async function getUserProfile(_0x54b664){const _0x7c462b=a53_0x3e2cb1,_0x24c1a7=cache['userProfiles']['get'](_0x54b664);if(_0x24c1a7&&Date[_0x7c462b(0x1a3)]()-_0x24c1a7[_0x7c462b(0x1c6)]<CACHE_EXPIRY[_0x7c462b(0x19d)])return _0x24c1a7['data'];const _0x6c24d5=await getDoc(doc(userProfilesRef,_0x54b664));if(_0x6c24d5[_0x7c462b(0x1a0)]()){const _0x3d8e78=_0x6c24d5[_0x7c462b(0x1c0)]();return cache[_0x7c462b(0x19d)][_0x7c462b(0x1c3)](_0x54b664,{'data':_0x3d8e78,'timestamp':Date['now']()}),_0x3d8e78;}return null;}export async function getLadderData(_0x458e5b=0x1){const _0xb0ddfc=a53_0x3e2cb1,_0x285588=_0xb0ddfc(0x1c9)+_0x458e5b,_0x21f5a5=cache[_0xb0ddfc(0x197)]['get'](_0x285588);if(_0x21f5a5&&Date['now']()-_0x21f5a5[_0xb0ddfc(0x1c6)]<CACHE_EXPIRY['ladderPlayers'])return _0x21f5a5[_0xb0ddfc(0x1c0)];const _0x184ac5=_0x458e5b===0x1?_0xb0ddfc(0x1a4):_0xb0ddfc(0x1a5)+_0x458e5b,_0x4178a1=collection(db,_0x184ac5),_0x57bc6a=await getDocs(query(_0x4178a1,limit(0x64))),_0x4e4553=_0x57bc6a[_0xb0ddfc(0x1c5)][_0xb0ddfc(0x199)](_0x3148d7=>({'id':_0x3148d7['id'],..._0x3148d7[_0xb0ddfc(0x1c0)]()}));return cache[_0xb0ddfc(0x197)]['set'](_0x285588,{'data':_0x4e4553,'timestamp':Date[_0xb0ddfc(0x1a3)]()}),_0x4e4553;}function a53_0x46da(){const _0x14e8fa=['doc','info','5346688WfrYyI','eloHistory','search','username','2523320jwPIrm','log','12Jbhvor','bind','playerId','error','slice','table','4787124jSxYkl','5209232YVBVmM','toString','forEach','apply','(((.+)+)+)+$','playersD3','type','data','Error\x20fetching\x20batch\x20ELO\x20history:','8LkrXxV','set','eloHistoryD','docs','timestamp','length','return\x20(function()\x20','division_','constructor','console','ladderPlayers','333208NDNgbM','map','exception','nonParticipants','push','userProfiles','playersD2','4547032grSlaC','exists','get','11974473oRCIQb','now','players','playersD','{}.constructor(\x22return\x20this\x22)(\x20)','warn','docChanges','prototype'];a53_0x46da=function(){return _0x14e8fa;};return a53_0x46da();}export async function getEloHistoryBatch(_0x87fc0e,_0x2b4f0d=0x1){const _0x1cb7de=a53_0x3e2cb1,_0x69d7c3=_0x2b4f0d===0x1?_0x1cb7de(0x1ad):_0x1cb7de(0x1c4)+_0x2b4f0d,_0x1a317e=collection(db,_0x69d7c3),_0x3a28d8={},_0x5af2ad=[];_0x87fc0e[_0x1cb7de(0x1bb)](_0x511e13=>{const _0x5286ba=_0x1cb7de,_0x115c07=_0x511e13+'_'+_0x2b4f0d,_0x4a095f=cache[_0x5286ba(0x1ad)][_0x5286ba(0x1a1)](_0x115c07);_0x4a095f&&Date[_0x5286ba(0x1a3)]()-_0x4a095f[_0x5286ba(0x1c6)]<CACHE_EXPIRY[_0x5286ba(0x1ad)]?_0x3a28d8[_0x511e13]=_0x4a095f[_0x5286ba(0x1c0)]:_0x5af2ad['push'](_0x511e13);});const _0x1ee1c1=0xa;for(let _0x2877a1=0x0;_0x2877a1<_0x5af2ad[_0x1cb7de(0x1c7)];_0x2877a1+=_0x1ee1c1){const _0x3e671e=_0x5af2ad[_0x1cb7de(0x1b6)](_0x2877a1,_0x2877a1+_0x1ee1c1);if(_0x3e671e['length']>0x0)try{const _0x4e37a6=query(_0x1a317e,where(_0x1cb7de(0x1b4),'in',_0x3e671e),limit(0x64)),_0xef8149=await getDocs(_0x4e37a6);_0xef8149['docs'][_0x1cb7de(0x1bb)](_0x16d7eb=>{const _0x80eb8=_0x1cb7de,_0x3e9a98=_0x16d7eb[_0x80eb8(0x1c0)](),_0x2aa99d=_0x3e9a98[_0x80eb8(0x1b4)];if(!_0x3a28d8[_0x2aa99d])_0x3a28d8[_0x2aa99d]=[];_0x3a28d8[_0x2aa99d][_0x80eb8(0x19c)](_0x3e9a98);const _0x59fb2f=_0x2aa99d+'_'+_0x2b4f0d;cache[_0x80eb8(0x1ad)][_0x80eb8(0x1c3)](_0x59fb2f,{'data':_0x3a28d8[_0x2aa99d],'timestamp':Date[_0x80eb8(0x1a3)]()});});}catch(_0x332b85){console['error'](_0x1cb7de(0x1c1),_0x332b85);}}return _0x3a28d8;}function a53_0x646b(_0x3415d7,_0xc5f372){const _0x2d1232=a53_0x46da();return a53_0x646b=function(_0x12a0d0,_0x1fe66f){_0x12a0d0=_0x12a0d0-0x195;let _0x3c29d8=_0x2d1232[_0x12a0d0];return _0x3c29d8;},a53_0x646b(_0x3415d7,_0xc5f372);}let usernameCache=new Map(),usernameCacheTimestamp=Date['now']();export function setupEfficientListener(_0x1e905b,_0x39622f=[],_0xcb7a7e){const _0x58cc5f=collection(db,_0x1e905b),_0x15705c=query(_0x58cc5f,..._0x39622f),_0x885fb1=onSnapshot(_0x15705c,_0xabe67e=>{const _0x2398c8=a53_0x646b,_0x254ba2=_0xabe67e[_0x2398c8(0x1a8)]()[_0x2398c8(0x199)](_0x4dd6cc=>({'type':_0x4dd6cc[_0x2398c8(0x1bf)],'id':_0x4dd6cc[_0x2398c8(0x1aa)]['id'],'data':_0x4dd6cc['doc']['data']()}));_0x254ba2[_0x2398c8(0x1c7)]>0x0&&_0xcb7a7e(_0x254ba2,_0xabe67e['docs']);});return _0x885fb1;}export async function bulkResolveUsernames(_0x50283f){const _0x216ce3=a53_0x3e2cb1,_0x21a0ff=new Map();if(!_0x50283f||_0x50283f[_0x216ce3(0x1c7)]===0x0)return _0x21a0ff;const _0x5b5388=[_0x216ce3(0x1a4),_0x216ce3(0x19e),_0x216ce3(0x1be),_0x216ce3(0x19b)];for(const _0x449fac of _0x5b5388){const _0x1dcb2f=collection(db,_0x449fac),_0xd0ce7b=await getDocs(_0x1dcb2f);_0xd0ce7b['forEach'](_0x114ff4=>{const _0x46e0d3=_0x216ce3,_0x3e9fbc=_0x114ff4[_0x46e0d3(0x1c0)]();_0x3e9fbc[_0x46e0d3(0x1af)]&&_0x50283f['includes'](_0x114ff4['id'])&&_0x21a0ff[_0x46e0d3(0x1c3)](_0x114ff4['id'],_0x3e9fbc['username']);});}return _0x21a0ff;}
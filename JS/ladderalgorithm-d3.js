function a29_0x3633(){const _0x29c868=['all','Only\x20the\x20winner\x20can\x20approve\x20D3\x20matches','data','loserUsername','One\x20or\x20both\x20D3\x20players\x20not\x20found','table','warn','error','position','Starting\x20approveReportD3\x20function\x20with:','console','docs','MAX_SAFE_INTEGER','commit','Current\x20user:','pendingMatchesD3','return\x20(function()\x20','D3\x20ELO\x20ratings\x20updated\x20successfully','winnerUsername','prototype','email','log','Error\x20in\x20approveReportD3:','update','empty','playersD3','win','D3\x20Match\x20successfully\x20approved\x20and\x20ELO\x20updated','currentUser'];a29_0x3633=function(){return _0x29c868;};return a29_0x3633();}const a29_0x5070a7=(function(){let _0x24f511=!![];return function(_0x5c0dc5,_0x2af884){const _0x4ffd80=_0x24f511?function(){if(_0x2af884){const _0x44a8d5=_0x2af884['apply'](_0x5c0dc5,arguments);return _0x2af884=null,_0x44a8d5;}}:function(){};return _0x24f511=![],_0x4ffd80;};}()),a29_0x17605b=a29_0x5070a7(this,function(){const _0x456198=a29_0xadea,_0x20794f=function(){const _0x1a0bb7=a29_0xadea;let _0x5c059d;try{_0x5c059d=Function(_0x1a0bb7(0x88)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x1cb443){_0x5c059d=window;}return _0x5c059d;},_0x59a443=_0x20794f(),_0x1ab4c=_0x59a443[_0x456198(0x82)]=_0x59a443['console']||{},_0x212f8a=['log',_0x456198(0x7e),'info','error','exception',_0x456198(0x7d),'trace'];for(let _0x3858f8=0x0;_0x3858f8<_0x212f8a['length'];_0x3858f8++){const _0x4586b6=a29_0x5070a7['constructor'][_0x456198(0x8b)]['bind'](a29_0x5070a7),_0x2acf3c=_0x212f8a[_0x3858f8],_0x51269a=_0x1ab4c[_0x2acf3c]||_0x4586b6;_0x4586b6['__proto__']=a29_0x5070a7['bind'](a29_0x5070a7),_0x4586b6['toString']=_0x51269a['toString']['bind'](_0x51269a),_0x1ab4c[_0x2acf3c]=_0x4586b6;}});a29_0x17605b();import{addDoc,updateDoc,serverTimestamp,collection,doc,getDoc,getDocs,query,where,setDoc,deleteDoc,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';import{recordEloChangeD3}from'./elo-history-d3.js';export function calculateEloD3(_0x8d5cf3,_0x4c4771,_0x3b3d4e=0x20){const _0x14c1c4=0x1/(0x1+Math['pow'](0xa,(_0x4c4771-_0x8d5cf3)/0x190)),_0x2b07ec=0x1/(0x1+Math['pow'](0xa,(_0x8d5cf3-_0x4c4771)/0x190)),_0x51061f=_0x8d5cf3+_0x3b3d4e*(0x1-_0x14c1c4),_0x38dd17=_0x4c4771+_0x3b3d4e*(0x0-_0x2b07ec);return{'newWinnerRating':Math['round'](_0x51061f),'newLoserRating':Math['round'](_0x38dd17)};}function a29_0xadea(_0x1b7d19,_0x4340ff){const _0x17605b=a29_0x3633();return a29_0xadea=function(_0x5070a7,_0x31f92a){_0x5070a7=_0x5070a7-0x78;let _0x3633da=_0x17605b[_0x5070a7];return _0x3633da;},a29_0xadea(_0x1b7d19,_0x4340ff);}export async function updateEloRatingsD3(_0x358c09,_0x2ba818,_0x22b119){const _0x361040=a29_0xadea;try{const _0x3cd7ac=writeBatch(db),_0xc991b5=doc(db,'playersD3',_0x358c09),_0x3a3a4b=doc(db,_0x361040(0x91),_0x2ba818),[_0x5148ef,_0x3d51b3]=await Promise[_0x361040(0x78)]([getDoc(_0xc991b5),getDoc(_0x3a3a4b)]);if(!_0x5148ef['exists']()||!_0x3d51b3['exists']())throw new Error(_0x361040(0x7c));const _0x4aadb6=_0x5148ef[_0x361040(0x7a)](),_0x1d98e5=_0x3d51b3['data'](),_0x26ca82=_0x4aadb6['position']||Number[_0x361040(0x84)],_0x63f5ac=_0x1d98e5['position']||Number['MAX_SAFE_INTEGER'],{newWinnerRating:_0x6610b0,newLoserRating:_0xb8c973}=calculateEloD3(_0x4aadb6['eloRating']||0x4b0,_0x1d98e5['eloRating']||0x4b0);let _0xfbfe50=_0x26ca82,_0x1e6a92=_0x63f5ac;if(_0x26ca82>_0x63f5ac){console['log']('D3\x20Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked'),_0xfbfe50=_0x63f5ac,_0x1e6a92=_0x63f5ac+0x1;const _0x47f758=query(collection(db,_0x361040(0x91)),where('position','>',_0x63f5ac),where(_0x361040(0x80),'<',_0x26ca82)),_0xb066a2=await getDocs(_0x47f758);for(const _0x2fa57b of _0xb066a2['docs']){_0x2fa57b['id']!==_0x358c09&&_0x2fa57b['id']!==_0x2ba818&&_0x3cd7ac[_0x361040(0x8f)](doc(db,'playersD3',_0x2fa57b['id']),{'position':_0x2fa57b['data']()[_0x361040(0x80)]+0x1});}}else console[_0x361040(0x8d)]('D3\x20Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions');return _0x3cd7ac[_0x361040(0x8f)](_0xc991b5,{'eloRating':_0x6610b0,'lastMatchDate':serverTimestamp(),'position':_0xfbfe50,'lastMatchId':_0x22b119}),_0x3cd7ac[_0x361040(0x8f)](_0x3a3a4b,{'eloRating':_0xb8c973,'lastMatchDate':serverTimestamp(),'position':_0x1e6a92,'lastMatchId':_0x22b119}),await _0x3cd7ac[_0x361040(0x85)](),console[_0x361040(0x8d)](_0x361040(0x89)),await Promise['all']([recordEloChangeD3({'playerId':_0x358c09,'previousElo':_0x4aadb6['eloRating']||0x4b0,'newElo':_0x6610b0,'opponentId':_0x2ba818,'matchResult':_0x361040(0x92),'previousPosition':_0x26ca82,'newPosition':_0xfbfe50,'isPromotion':_0xfbfe50<_0x26ca82,'matchId':_0x22b119,'timestamp':serverTimestamp()}),recordEloChangeD3({'playerId':_0x2ba818,'previousElo':_0x1d98e5['eloRating']||0x4b0,'newElo':_0xb8c973,'opponentId':_0x358c09,'matchResult':'loss','previousPosition':_0x63f5ac,'newPosition':_0x1e6a92,'isDemotion':_0x1e6a92>_0x63f5ac,'matchId':_0x22b119,'timestamp':serverTimestamp()})]),!![];}catch(_0x2f8b16){console[_0x361040(0x7f)]('Error\x20in\x20updateEloRatingsD3:',_0x2f8b16);throw _0x2f8b16;}}export async function approveReportD3(_0x445e62,_0x4587bd,_0x3e75f4,_0x1f942f){const _0x183241=a29_0xadea;try{console['log'](_0x183241(0x81),{'reportId':_0x445e62,'winnerScore':_0x4587bd,'winnerSuicides':_0x3e75f4,'winnerComment':_0x1f942f});const _0x388375=auth[_0x183241(0x94)];if(!_0x388375){console['log']('No\x20user\x20logged\x20in');throw new Error('You\x20must\x20be\x20logged\x20in\x20to\x20approve\x20D3\x20matches');}console[_0x183241(0x8d)](_0x183241(0x86),_0x388375[_0x183241(0x8c)]);const _0x2dbcd7=await getDoc(doc(db,'playersD3',_0x388375['uid'])),_0x2e8461=_0x2dbcd7['exists']()?_0x2dbcd7[_0x183241(0x7a)]()['username']:null;console['log']('Current\x20username:',_0x2e8461);const _0x54b338=doc(db,_0x183241(0x87),_0x445e62),_0x2f35ad=await getDoc(_0x54b338);if(!_0x2f35ad['exists']()){console['log']('D3\x20Report\x20not\x20found\x20with\x20ID:',_0x445e62);throw new Error('D3\x20match\x20report\x20not\x20found');}const _0x4cf8ab=_0x2f35ad[_0x183241(0x7a)]();console[_0x183241(0x8d)]('D3\x20Report\x20data:',_0x4cf8ab);if(_0x2e8461!==_0x4cf8ab['winnerUsername'])throw new Error(_0x183241(0x79));const _0x7f8d06={..._0x4cf8ab,'winnerScore':_0x4587bd,'winnerSuicides':_0x3e75f4,'winnerComment':_0x1f942f,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':_0x2e8461,'createdAt':_0x4cf8ab['createdAt']||serverTimestamp(),'winnerUsername':_0x4cf8ab['winnerUsername'],'loserUsername':_0x4cf8ab[_0x183241(0x7b)]};await setDoc(doc(db,'approvedMatchesD3',_0x445e62),_0x7f8d06),await deleteDoc(_0x54b338),console[_0x183241(0x8d)]('D3\x20Match\x20moved\x20to\x20approved\x20collection');const [_0x47441f,_0x2e4da3]=await Promise['all']([getDocs(query(collection(db,'playersD3'),where('username','==',_0x4cf8ab[_0x183241(0x8a)]))),getDocs(query(collection(db,'playersD3'),where('username','==',_0x4cf8ab[_0x183241(0x7b)])))]);if(_0x47441f['empty']||_0x2e4da3[_0x183241(0x90)])throw new Error('Could\x20not\x20find\x20D3\x20player\x20documents');const _0x43f3c0=_0x47441f['docs'][0x0]['id'],_0x1f8fc5=_0x2e4da3[_0x183241(0x83)][0x0]['id'];return await updateEloRatingsD3(_0x43f3c0,_0x1f8fc5,_0x445e62),console['log'](_0x183241(0x93)),!![];}catch(_0x3f55a5){console[_0x183241(0x7f)](_0x183241(0x8e),_0x3f55a5);throw _0x3f55a5;}}
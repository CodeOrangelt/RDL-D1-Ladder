function a0_0x1c85(){const _0x4b0f64=['163926lGyjuU','loserUsername','apply','console','currentUser','approvedMatchesD2','playersD2','22602ZWPZTD','Error\x20in\x20approveReportD2:','{}.constructor(\x22return\x20this\x22)(\x20)','exists','486518CeNNqw','update','18884KgpAZZ','position','data','all','table','72oAriNT','username','return\x20(function()\x20','commit','log','311544idVgnU','888376TlXoYW','You\x20must\x20be\x20logged\x20in\x20to\x20approve\x20D2\x20matches','docs','checkAndRecordPromotion','841472mKRebu','MAX_SAFE_INTEGER','7uZUrWV','415ucbFhT','winnerUsername','80vyfJvV','D2\x20ELO\x20ratings\x20updated\x20successfully','pow','704NpTpNz'];a0_0x1c85=function(){return _0x4b0f64;};return a0_0x1c85();}(function(_0x38e9a5,_0x32a93c){const _0x48f846=a0_0x2322,_0x3ecc06=_0x38e9a5();while(!![]){try{const _0x57ed4f=-parseInt(_0x48f846(0x128))/0x1+-parseInt(_0x48f846(0x139))/0x2+-parseInt(_0x48f846(0x12f))/0x3*(-parseInt(_0x48f846(0x12a))/0x4)+parseInt(_0x48f846(0x117))/0x5*(-parseInt(_0x48f846(0x124))/0x6)+parseInt(_0x48f846(0x116))/0x7*(-parseInt(_0x48f846(0x135))/0x8)+parseInt(_0x48f846(0x11d))/0x9*(-parseInt(_0x48f846(0x119))/0xa)+parseInt(_0x48f846(0x11c))/0xb*(parseInt(_0x48f846(0x134))/0xc);if(_0x57ed4f===_0x32a93c)break;else _0x3ecc06['push'](_0x3ecc06['shift']());}catch(_0x410f48){_0x3ecc06['push'](_0x3ecc06['shift']());}}}(a0_0x1c85,0x48cd6));const a0_0xdae049=(function(){let _0x95743c=!![];return function(_0x57f2fc,_0x39dc8b){const _0x3b4fef=_0x95743c?function(){const _0x1b91b2=a0_0x2322;if(_0x39dc8b){const _0x131d2d=_0x39dc8b[_0x1b91b2(0x11f)](_0x57f2fc,arguments);return _0x39dc8b=null,_0x131d2d;}}:function(){};return _0x95743c=![],_0x3b4fef;};}()),a0_0x2b7705=a0_0xdae049(this,function(){const _0xb25c80=a0_0x2322;let _0x2e7685;try{const _0x1e651f=Function(_0xb25c80(0x131)+_0xb25c80(0x126)+');');_0x2e7685=_0x1e651f();}catch(_0x25f44d){_0x2e7685=window;}const _0x2cc55e=_0x2e7685[_0xb25c80(0x120)]=_0x2e7685['console']||{},_0x16607e=['log','warn','info','error','exception',_0xb25c80(0x12e),'trace'];for(let _0x2121ae=0x0;_0x2121ae<_0x16607e['length'];_0x2121ae++){const _0x385c1a=a0_0xdae049['constructor']['prototype']['bind'](a0_0xdae049),_0x32baef=_0x16607e[_0x2121ae],_0x14783f=_0x2cc55e[_0x32baef]||_0x385c1a;_0x385c1a['__proto__']=a0_0xdae049['bind'](a0_0xdae049),_0x385c1a['toString']=_0x14783f['toString']['bind'](_0x14783f),_0x2cc55e[_0x32baef]=_0x385c1a;}});a0_0x2b7705();import{collection,doc,getDoc,getDocs,updateDoc,setDoc,deleteDoc,writeBatch,query,where,serverTimestamp,addDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';import{recordEloChangeD2}from'./elo-history-d2.js';function a0_0x2322(_0x3e4496,_0x5453d3){const _0x506e16=a0_0x1c85();return a0_0x2322=function(_0x2b7705,_0xdae049){_0x2b7705=_0x2b7705-0x115;let _0xd748eb=_0x506e16[_0x2b7705];return _0xd748eb;},a0_0x2322(_0x3e4496,_0x5453d3);}import{promotionManager}from'./promotions.js';import a0_0x48dbb3 from'./firebase-idle-wrapper.js';export function calculateEloD2(_0x13e9fa,_0x3ddad9,_0x58f205=0x20){const _0x1048db=a0_0x2322,_0x133da5=0x1/(0x1+Math[_0x1048db(0x11b)](0xa,(_0x3ddad9-_0x13e9fa)/0x190)),_0x419af8=0x1/(0x1+Math['pow'](0xa,(_0x13e9fa-_0x3ddad9)/0x190)),_0x3dd8cc=_0x13e9fa+_0x58f205*(0x1-_0x133da5),_0x5a9e09=_0x3ddad9+_0x58f205*(0x0-_0x419af8);return{'newWinnerRating':Math['round'](_0x3dd8cc),'newLoserRating':Math['round'](_0x5a9e09)};}export async function updateEloRatingsD2(_0x353dca,_0x4af8a3,_0x57c89f){const _0x34b961=a0_0x2322;try{const _0x54d694=writeBatch(db),_0xddbd61=doc(db,'playersD2',_0x353dca),_0x48bf95=doc(db,_0x34b961(0x123),_0x4af8a3),[_0x78ca5c,_0x574e91]=await Promise[_0x34b961(0x12d)]([getDoc(_0xddbd61),getDoc(_0x48bf95)]);if(!_0x78ca5c['exists']()||!_0x574e91['exists']())throw new Error('One\x20or\x20both\x20D2\x20players\x20not\x20found');const _0xdb8bf5=_0x78ca5c['data'](),_0xad521a=_0x574e91['data'](),_0x42f9bc=_0xdb8bf5[_0x34b961(0x12b)]||Number['MAX_SAFE_INTEGER'],_0xfc2fde=_0xad521a['position']||Number[_0x34b961(0x115)],{newWinnerRating:_0x510ff3,newLoserRating:_0x3bc10b}=calculateEloD2(_0xdb8bf5['eloRating']||0x4b0,_0xad521a['eloRating']||0x4b0);let _0x4bafc0=_0x42f9bc,_0x1b108d=_0xfc2fde;if(_0x42f9bc>_0xfc2fde){console['log']('D2\x20Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked'),_0x4bafc0=_0xfc2fde,_0x1b108d=_0xfc2fde+0x1;const _0x184d88=query(collection(db,'playersD2'),where('position','>',_0xfc2fde),where('position','<',_0x42f9bc)),_0x5373fe=await getDocs(_0x184d88);for(const _0x26a452 of _0x5373fe['docs']){_0x26a452['id']!==_0x353dca&&_0x26a452['id']!==_0x4af8a3&&_0x54d694[_0x34b961(0x129)](doc(db,'playersD2',_0x26a452['id']),{'position':_0x26a452['data']()[_0x34b961(0x12b)]+0x1});}}else console['log']('D2\x20Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions');return _0x54d694[_0x34b961(0x129)](_0xddbd61,{'eloRating':_0x510ff3,'lastMatchDate':serverTimestamp(),'position':_0x4bafc0,'lastMatchId':_0x57c89f}),_0x54d694['update'](_0x48bf95,{'eloRating':_0x3bc10b,'lastMatchDate':serverTimestamp(),'position':_0x1b108d,'lastMatchId':_0x57c89f}),await _0x54d694[_0x34b961(0x132)](),console['log'](_0x34b961(0x11a)),await Promise[_0x34b961(0x12d)]([recordEloChangeD2({'playerId':_0x353dca,'previousElo':_0xdb8bf5['eloRating']||0x4b0,'newElo':_0x510ff3,'opponentId':_0x4af8a3,'matchResult':'win','previousPosition':_0x42f9bc,'newPosition':_0x4bafc0,'isPromotion':_0x4bafc0<_0x42f9bc,'matchId':_0x57c89f,'timestamp':serverTimestamp()}),recordEloChangeD2({'playerId':_0x4af8a3,'previousElo':_0xad521a['eloRating']||0x4b0,'newElo':_0x3bc10b,'opponentId':_0x353dca,'matchResult':'loss','previousPosition':_0xfc2fde,'newPosition':_0x1b108d,'isDemotion':_0x1b108d>_0xfc2fde,'matchId':_0x57c89f,'timestamp':serverTimestamp()})]),await promotionManager[_0x34b961(0x138)](_0x353dca,_0x510ff3,_0xdb8bf5['eloRating'],{'source':'match-d2','matchId':_0x57c89f}),await promotionManager[_0x34b961(0x138)](_0x4af8a3,_0x3bc10b,_0xad521a['eloRating'],{'source':'match-d2','matchId':_0x57c89f}),!![];}catch(_0x312148){console['error']('Error\x20in\x20updateEloRatingsD2:',_0x312148);throw _0x312148;}}export async function approveReportD2(_0x481713,_0x56a6c5,_0x5d01b6,_0x23875c){const _0x320f7b=a0_0x2322;try{console['log']('Starting\x20approveReportD2\x20function\x20with:',{'reportId':_0x481713,'winnerScore':_0x56a6c5,'winnerSuicides':_0x5d01b6,'winnerComment':_0x23875c});const _0x138b6f=auth[_0x320f7b(0x121)];if(!_0x138b6f){console[_0x320f7b(0x133)]('No\x20user\x20logged\x20in');throw new Error(_0x320f7b(0x136));}console['log']('Current\x20user:',_0x138b6f['email']);const _0x2758d7=await getDoc(doc(db,'playersD2',_0x138b6f['uid'])),_0x7fe491=_0x2758d7[_0x320f7b(0x127)]()?_0x2758d7[_0x320f7b(0x12c)]()['username']:null;console['log']('Current\x20username:',_0x7fe491);const _0x207fb6=doc(db,'pendingMatchesD2',_0x481713),_0x915e7=await getDoc(_0x207fb6);if(!_0x915e7['exists']()){console['log']('D2\x20Report\x20not\x20found\x20with\x20ID:',_0x481713);throw new Error('D2\x20match\x20report\x20not\x20found');}const _0x51d2e5=_0x915e7['data']();console[_0x320f7b(0x133)]('D2\x20Report\x20data:',_0x51d2e5);if(_0x7fe491!==_0x51d2e5[_0x320f7b(0x118)])throw new Error('Only\x20the\x20winner\x20can\x20approve\x20D2\x20matches');const _0x3fc317={..._0x51d2e5,'winnerScore':_0x56a6c5,'winnerSuicides':_0x5d01b6,'winnerComment':_0x23875c,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':_0x7fe491,'createdAt':_0x51d2e5['createdAt']||serverTimestamp(),'winnerUsername':_0x51d2e5['winnerUsername'],'loserUsername':_0x51d2e5[_0x320f7b(0x11e)]};await setDoc(doc(db,_0x320f7b(0x122),_0x481713),_0x3fc317),await deleteDoc(_0x207fb6),console['log']('D2\x20Match\x20moved\x20to\x20approved\x20collection');const [_0x407846,_0x575120]=await Promise['all']([getDocs(query(collection(db,'playersD2'),where('username','==',_0x51d2e5['winnerUsername']))),getDocs(query(collection(db,'playersD2'),where(_0x320f7b(0x130),'==',_0x51d2e5['loserUsername'])))]);if(_0x407846['empty']||_0x575120['empty'])throw new Error('Could\x20not\x20find\x20D2\x20player\x20documents');const _0x2e50fe=_0x407846[_0x320f7b(0x137)][0x0]['id'],_0x5e77be=_0x575120['docs'][0x0]['id'];return await updateEloRatingsD2(_0x2e50fe,_0x5e77be,_0x481713),console['log']('D2\x20Match\x20successfully\x20approved\x20and\x20ELO\x20updated'),!![];}catch(_0x3a243e){console['error'](_0x320f7b(0x125),_0x3a243e);throw _0x3a243e;}}
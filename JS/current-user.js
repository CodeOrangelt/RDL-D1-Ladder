const a12x=a12b;(function(a,b){const w=a12b,c=a();while(!![]){try{const d=-parseInt(w(0xe9))/0x1+parseInt(w(0x108))/0x2*(parseInt(w(0xd3))/0x3)+parseInt(w(0xd5))/0x4+parseInt(w(0xe0))/0x5*(parseInt(w(0xe3))/0x6)+parseInt(w(0x10c))/0x7+-parseInt(w(0xf9))/0x8*(-parseInt(w(0xd4))/0x9)+parseInt(w(0xf7))/0xa*(-parseInt(w(0xdf))/0xb);if(d===b)break;else c['push'](c['shift']());}catch(e){c['push'](c['shift']());}}}(a12a,0x60cfe));import{getAuth,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{doc,getDoc,collection,query,where,getDocs,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a12b(a,b){const c=a12a();return a12b=function(d,e){d=d-0xd1;let f=c[d];if(a12b['moODAd']===undefined){var g=function(l){const m='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let n='',o='';for(let p=0x0,q,r,s=0x0;r=l['charAt'](s++);~r&&(q=p%0x4?q*0x40+r:r,p++%0x4)?n+=String['fromCharCode'](0xff&q>>(-0x2*p&0x6)):0x0){r=m['indexOf'](r);}for(let t=0x0,u=n['length'];t<u;t++){o+='%'+('00'+n['charCodeAt'](t)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(o);};a12b['rHARVi']=g,a=arguments,a12b['moODAd']=!![];}const h=c[0x0],i=d+h,j=a[i];return!j?(f=a12b['rHARVi'](f),a[i]=f):f=j,f;},a12b(a,b);}import{db}from'./firebase-config.js';import{isAdmin}from'./admin-check.js';const ADMIN_EMAILS=['admin@ladder.com',a12x(0xd7)],userCache={'uid':null,'username':null,'isAdmin':![],'hasCheckedCollections':![],'lastChecked':0x0,'role':null},invitationCache={'lastCheck':0x0,'pendingCount':0x0,'checkInterval':0x493e0};function updateInboxNotification(a){const y=a12x,b=document[y(0xf6)]('inbox-notification');b&&(a>0x0?(b['style']['display']='inline-block',b[y(0xf1)]=a>0x9?'9+':a):b[y(0xea)]['display']='none');}function a12a(){const L=['CgXHEwvYC0r1B3m','CM9Szq','AgLKzgvU','C2L6zq','DxnLCM5HBwu','ywrKrxzLBNrmAxn0zw5LCG','CgXHEwvYC0qZ','nZrYBwz3tMu','CxvLCNLtzwXLy3rVCKfSBa','ywrTAw4','Aw5JBhvKzxm','ntmZmZq5nLH3txDwvW','pgeGAhjLzJ0IBg9NAw4UAhrTBciGy2XHC3m9iMXVz2LUlwXPBMSIpKXVz2LUpc9HpG','igLUia','ChjLDMvUDerLzMf1Bhq','BwfW','Bg9N','lMfKBwLUlw9UBhK','iJ5qCM9MAwXLpc9HpGOGicaGicaGicaGicaGicaGicaGidXHigHYzwy9iI4VAw5IB3GUAhrTBciGy2XHC3m9iM5HDI1UB3rPzMLJyxrPB24IpGOGicaGicaGicaGicaGicaGicaGicaGicbjBMjVEcakicaGicaGicaGicaGicaGicaGicaGicaGphnWyw4GAwq9iMLUyM94lw5VDgLMAwnHDgLVBIiGy2XHC3m9iM5VDgLMAwnHDgLVBI1KB3qIpJWVC3bHBJ4kicaGicaGicaGicaGicaGicaGica8l2e+cIaGicaGicaGicaGicaGicaGicaGpgeGAhjLzJ0IBwvTyMvYCY5ODg1SiJ5nzw1IzxjZpc9HpGOGicaGicaGicaGicaGicaGicaGidXHigHYzwy9iI4VCMvKzwvTlMH0BwWIpJXPignSyxnZpsjMyxmGzMeTz2LMDci+pc9PpIbszwrLzw08l2e+cIaGicaGicaGicaGicaGicaGicaGpgeGAhjLzJ0IiYiGAwq9iMXVz291Dc1SAw5RiJ5tAwDUie91DdWVyt4kicaGicaGicaGicaGicaGidWVzgL2pGOGicaGicaGicaGica8l2rPDJ4kicaGicaGica','Axnbzg1PBG','Aw5Uzxjive1m','DxnLCLbYB2zPBgvZ','yxv0Ac1Zzwn0Aw9U','DgHLBG','rM91BMqGywrTAw4GCM9SztOG','AgfZq2HLy2TLzenVBgXLy3rPB25Z','zxjYB3i','mta4nJzbqMriEKi','mJa3mtHJBMfrtvy','mta4mJaXnKHmr3rJua','rxjYB3iGAw4Gy2HLy2Tbzg1PBLjVBgvZoG','qNjPyw4YywzaB3v0Bg9VAY5JB20','BM93','D2fYBG','igj5ifvjrdO','DwLK','DMLZAwjPBgL0EwnOyw5Nzq','rxjYB3iGAw4GzNvSBcbHDxrOihvWzgf0ztO','cIaGicaGicaGicaGidXKAxyGy2XHC3m9iM5HDI1KCM9Wzg93BIi+cIaGicaGicaGicaGicaGica8ysbOCMvMpsiJiIbJBgfZCZ0IBMf2lxvZzxjUyw1LiJ4','mtK2odK1ndLks1PWENK','mJeWmda0mfPcBwDAvG','CgXHEwvYCW','y291BMnPBa','nKHqqMPUEG','rM91BMqGDxnLCIbPBIa','Dg9vChbLCKnHC2u','Dg9vC2vYswq','zgf0yq','zgLZCgXHEq','mJyWotD1qw5Xwhm','C3r5Bgu','zg9JCW','vxnLCG','y3vYCMvUDfvZzxi','zxHPC3rZ','CM9Szu5HBwu','zM9YrwfJAa','Dgv4DenVBNrLBNq','zMLSDgvY','CgvUzgLUzW','yMXVy2S','C2XPy2u','z2v0rwXLBwvUDej5swq','mtbdzfPgrui','BM9Uzq','mJe3nLrSAujxBq','CgvUzgLUz0nVDw50','BM9UugfYDgLJAxbHBNrZ','z2fTzuLUDML0yxrPB25Z','C2LNBK91Da','Dg9mB3DLCKnHC2u','zw1HAwW','zw1WDhK'];a12a=function(){return L;};return a12a();}async function checkPendingInvitationsForCurrentUser(a){const z=a12x;try{const b=Date[z(0xd8)]();if(b-invitationCache['lastCheck']<invitationCache['checkInterval'])return updateInboxNotification(invitationCache[z(0xfa)]),invitationCache['pendingCount'];invitationCache['lastCheck']=b;const c=collection(db,z(0xfc)),d=query(c,where(z(0xe6),'==',a),where('status','==',z(0xf3)),limit(0x5)),e=await getDocs(d),f=e[z(0x104)];return invitationCache[z(0xfa)]=f,updateInboxNotification(f),f;}catch(g){return console[z(0xd9)]('Could\x20not\x20check\x20pending\x20invitations\x20for\x20current\x20user:',g),0x0;}}function updateAuthSectionImmediate(a,b=![]){const A=a12x,c=document[A(0xf6)](A(0x117));if(!c)return;if(a&&b)document[A(0x109)]('.admin-only')[A(0xf0)](d=>{d['style']['display']='block';});else!a&&document[A(0x109)](A(0x112))['forEach'](d=>{const B=A;d[B(0xea)][B(0xe8)]=B(0xf8);});if(a){const d=userCache[A(0x105)]||(a[A(0xff)]?a['email']['split']('@')[0x0]:A(0xec)),e=userCache['role']?'\x20('+userCache[A(0x102)]+')':b?'\x20(Admin)':'';c[A(0x115)]=A(0xde)+d+e+'</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username='+encodeURIComponent(d)+A(0x113);const f=document[A(0xf6)]('logout-link');f&&f['addEventListener']('click',g=>{const C=A;g[C(0x10f)]();const h=getAuth();updateAuthSectionImmediate(null),h[C(0xfd)]()['catch'](i=>{console['error']('Error\x20signing\x20out:',i);});}),a[A(0xdb)]&&setTimeout(()=>{checkPendingInvitationsForCurrentUser(a['uid']);},0x3e8);}else c['innerHTML']=A(0x10d);}async function checkAdminRoles(a){const D=a12x;if(!a||!a[D(0xff)])return{'isAdmin':![],'role':null};try{console[D(0x111)]('Checking\x20roles\x20for\x20user:\x20'+a['email']);const b=['players','playersD2','playersD3',D(0xfb),D(0x116)],c=[D(0xe2),'creative\x20lead','owner',D(0x10a)];for(const d of b){try{const e=doc(db,d,a['uid']),f=await getDoc(e);if(f[D(0xee)]()){const g=f['data']();console['log']('Found\x20user\x20in\x20'+d+D(0xda),g);let h=(g['roleName']||g['role']||'')[D(0xfe)](),i=g['roleName']||g[D(0x102)]||'';if(h&&c[D(0x10b)](h)){console['log']('Found\x20admin\x20role:\x20'+h+'\x20in\x20'+d);const j=i['split']('\x20')['map'](k=>k['charAt'](0x0)[D(0xe5)]()+k['slice'](0x1)[D(0xfe)]())['join']('\x20');return{'isAdmin':!![],'role':j};}}}catch(k){console['error']('Error\x20checking\x20'+d+'\x20by\x20UID:',k);}}for(const l of b){try{const m=collection(db,l);let n=query(m,where('email','==',a[D(0xff)])),o=await getDocs(n);o[D(0x100)]&&(n=query(m,where(D(0xff),'==',a['email']['toLowerCase']())),o=await getDocs(n));if(!o[D(0x100)]){const p=o[D(0xeb)][0x0]['data']();console[D(0x111)](D(0xe4)+l+'\x20by\x20email:',p);let r=(p[D(0xef)]||p[D(0x102)]||'')['toLowerCase'](),s=p[D(0xef)]||p[D(0x102)]||'';if(r&&c['includes'](r)){console['log'](D(0x119)+r+D(0x10e)+l);const t=s['split']('\x20')['map'](u=>u['charAt'](0x0)[D(0xe5)]()+u[D(0xf5)](0x1)['toLowerCase']())['join']('\x20');return{'isAdmin':!![],'role':t};}}}catch(u){console[D(0xd2)]('Error\x20checking\x20'+l+'\x20by\x20email:',u);}}return console[D(0x111)]('No\x20admin\x20roles\x20found\x20for\x20user'),{'isAdmin':![],'role':null};}catch(v){return console['error'](D(0xd6),v),{'isAdmin':![],'role':null};}}async function updateAuthSection(a){const E=a12x,b=a&&isAdmin(a['email']);updateAuthSectionImmediate(a,b);if(!a){userCache['uid']=null,userCache[E(0x105)]=null,userCache[E(0x114)]=![],userCache[E(0xd1)]=![],userCache['role']=null;return;}const c=Date['now']();if(a[E(0xdb)]===userCache[E(0xdb)]&&userCache['hasCheckedCollections']&&c-userCache['lastChecked']<0x493e0)return;try{userCache[E(0xdb)]=a[E(0xdb)],userCache['lastChecked']=c;const d=isAdmin(a[E(0xff)]);userCache[E(0x114)]=d;if(!d){const {isAdmin:j,role:k}=await checkAdminRoles(a);userCache[E(0x114)]=j,userCache['role']=k,j&&(document['querySelectorAll'](E(0x112))['forEach'](l=>{const F=E;l[F(0xea)]['display']=F(0xf4);}),updateAuthSectionImmediate(a,!![]));}const e=[E(0xe1),'playersD2',E(0x107),E(0x101),'playersCTF','nonParticipants',E(0x116)],f=e[E(0x110)](l=>getDoc(doc(db,l,a[E(0xdb)]))[E(0x118)](m=>m[E(0xee)]()?{'collection':l,'data':m[E(0xe7)]()}:null)['catch'](()=>null)),g=await Promise['all'](f),h=g[E(0xf2)](l=>l!==null);let i=null;for(const l of h){if(l['data'][E(0x105)]){i=l[E(0xe7)]['username'];break;}}userCache['username']=i||(a['email']?a['email']['split']('@')[0x0]:E(0xec)),userCache['hasCheckedCollections']=!![],updateAuthSectionImmediate(a,userCache['isAdmin']),setTimeout(()=>{const G=E;checkPendingInvitationsForCurrentUser(a[G(0xdb)]);},0x1f4);}catch(m){console['error'](E(0xdd),m);}}document[a12x(0x106)]('DOMContentLoaded',()=>{const I=a12x,a=getAuth();onAuthStateChanged(a,async b=>{const H=a12b;await updateAuthSection(b),b&&checkPendingInvitationsForCurrentUser(b[H(0xdb)]);}),document[I(0x106)](I(0xdc),()=>{const J=I;!document[J(0x103)]&&a[J(0xed)]&&checkPendingInvitationsForCurrentUser(a[J(0xed)]['uid']);}),document['addEventListener']('click',b=>{const K=I;b['target']['closest']('a[href]')&&a[K(0xed)]&&checkPendingInvitationsForCurrentUser(a['currentUser']['uid']);});});export{updateAuthSection};
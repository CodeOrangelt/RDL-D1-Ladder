const a15_0x36b46e=a15_0x5eb5,a15_0x5c265b=(function(){let _0xf42304=!![];return function(_0x14c118,_0x17aebc){const _0x30c4a3=_0xf42304?function(){if(_0x17aebc){const _0x144ab8=_0x17aebc['apply'](_0x14c118,arguments);return _0x17aebc=null,_0x144ab8;}}:function(){};return _0xf42304=![],_0x30c4a3;};}()),a15_0x31fd9e=a15_0x5c265b(this,function(){const _0xdcd060=a15_0x5eb5,_0x283fae=function(){const _0x2ba6e8=a15_0x5eb5;let _0x5bf590;try{_0x5bf590=Function(_0x2ba6e8(0x169)+_0x2ba6e8(0x179)+');')();}catch(_0x39cb7b){_0x5bf590=window;}return _0x5bf590;},_0x3c7659=_0x283fae(),_0x1a6b84=_0x3c7659[_0xdcd060(0x176)]=_0x3c7659['console']||{},_0x320b9f=['log','warn',_0xdcd060(0x17b),'error',_0xdcd060(0x174),'table','trace'];for(let _0x12d960=0x0;_0x12d960<_0x320b9f[_0xdcd060(0x177)];_0x12d960++){const _0x499f54=a15_0x5c265b['constructor'][_0xdcd060(0x167)][_0xdcd060(0x175)](a15_0x5c265b),_0x4f1312=_0x320b9f[_0x12d960],_0x3ecd67=_0x1a6b84[_0x4f1312]||_0x499f54;_0x499f54['__proto__']=a15_0x5c265b['bind'](a15_0x5c265b),_0x499f54[_0xdcd060(0x171)]=_0x3ecd67['toString']['bind'](_0x3ecd67),_0x1a6b84[_0x4f1312]=_0x499f54;}});a15_0x31fd9e();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc,where}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';function a15_0x34ee(){const _0xc32b4b=['Unranked','Error\x20recording\x20D3\x20ELO\x20history:','error','prototype','Bronze','return\x20(function()\x20','Emerald','username','size','exists','opponent','docs','Unknown\x20Player','toString','Silver','timestamp','exception','bind','console','length','approvedMatchesD3','{}.constructor(\x22return\x20this\x22)(\x20)','winnerId','info','Error\x20getting\x20D3\x20username:','Gold'];a15_0x34ee=function(){return _0xc32b4b;};return a15_0x34ee();}const ELO_THRESHOLDS_D3=[{'name':'Emerald','elo':0x7d0},{'name':a15_0x36b46e(0x17d),'elo':0x708},{'name':a15_0x36b46e(0x172),'elo':0x640},{'name':a15_0x36b46e(0x168),'elo':0x578},{'name':'Unranked','elo':0x4b0}];let lastVisibleD3=null;function a15_0x5eb5(_0x3b4509,_0x50bb77){const _0x31fd9e=a15_0x34ee();return a15_0x5eb5=function(_0x5c265b,_0x4727e1){_0x5c265b=_0x5c265b-0x164;let _0x34ee4c=_0x31fd9e[_0x5c265b];return _0x34ee4c;},a15_0x5eb5(_0x3b4509,_0x50bb77);}async function getUsernameByIdD3(_0x425084){const _0x561f7=a15_0x36b46e;try{if(!_0x425084)return _0x561f7(0x170);const _0x4dd78e=await getDoc(doc(db,'playersD3',_0x425084));if(_0x4dd78e[_0x561f7(0x16d)]())return _0x4dd78e['data']()[_0x561f7(0x16b)]||'Unknown\x20Player';const _0x4a0b73=await getDocs(query(collection(db,_0x561f7(0x178)),where(_0x561f7(0x17a),'==',_0x425084),limit(0x1)));if(!_0x4a0b73['empty'])return _0x4a0b73[_0x561f7(0x16f)][0x0]['data']()['winnerUsername']||'Unknown\x20Player';const _0x39a949=await getDocs(query(collection(db,'approvedMatchesD3'),where('loserId','==',_0x425084),limit(0x1)));if(!_0x39a949['empty'])return _0x39a949['docs'][0x0]['data']()['loserUsername']||'Unknown\x20Player';return'Unknown\x20Player';}catch(_0x38b139){return console[_0x561f7(0x166)](_0x561f7(0x17c),_0x38b139),'Unknown\x20Player';}}export async function recordEloChangeD3({playerId:_0x74b994,previousElo:_0x142e48,newElo:_0x157026,opponentId:_0x17742d,matchResult:_0xc96d0,previousPosition:_0x34b0a3,newPosition:_0x3f7434,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x431af2,timestamp:_0x799873}){const _0x116df6=a15_0x36b46e;try{const _0x4209f0=doc(collection(db,'eloHistoryD3'));let _0x5bbfd2='match';if(isPromotion)_0x5bbfd2='promotion';if(isDemotion)_0x5bbfd2='demotion';let _0x5ee4b9=_0x116df6(0x164);if(_0x157026>=0x7d0)_0x5ee4b9=_0x116df6(0x16a);else{if(_0x157026>=0x708)_0x5ee4b9='Gold';else{if(_0x157026>=0x640)_0x5ee4b9='Silver';else{if(_0x157026>=0x578)_0x5ee4b9='Bronze';}}}return await setDoc(_0x4209f0,{'type':_0x5bbfd2,'player':_0x74b994,'opponent':_0x17742d,'previousElo':_0x142e48,'newElo':_0x157026,'change':_0x157026-_0x142e48,'matchResult':_0xc96d0,'previousPosition':_0x34b0a3,'newPosition':_0x3f7434,'rankAchieved':_0x5ee4b9,'matchId':_0x431af2,'timestamp':_0x799873||serverTimestamp(),'gameMode':'D3'}),console['log']('D3\x20ELO\x20history\x20recorded\x20for\x20'+_0x74b994),!![];}catch(_0x311b24){console[_0x116df6(0x166)](_0x116df6(0x165),_0x311b24);throw _0x311b24;}}export async function getEloHistoryD3(_0x1210d2=0x14){const _0x2a87b8=a15_0x36b46e;try{const _0x44393d=collection(db,'eloHistoryD3');let _0x18625f;lastVisibleD3?_0x18625f=query(_0x44393d,orderBy('timestamp','desc'),startAfter(lastVisibleD3),limit(_0x1210d2)):_0x18625f=query(_0x44393d,orderBy('timestamp','desc'),limit(_0x1210d2));const _0x584eff=await getDocs(_0x18625f);if(_0x584eff['empty'])return{'entries':[],'hasMore':![]};lastVisibleD3=_0x584eff[_0x2a87b8(0x16f)][_0x584eff['docs']['length']-0x1];const _0x120312=_0x584eff['docs']['map'](async _0x4ee538=>{const _0x3ef9b2=_0x2a87b8,_0x3c99c2=_0x4ee538['data'](),[_0x3f6916,_0x40aac0]=await Promise['all']([getUsernameByIdD3(_0x3c99c2['player']),getUsernameByIdD3(_0x3c99c2[_0x3ef9b2(0x16e)])]);return{..._0x3c99c2,'playerUsername':_0x3f6916,'opponentUsername':_0x40aac0,'change':_0x3c99c2['newElo']-_0x3c99c2['previousElo'],'timestamp':_0x3c99c2[_0x3ef9b2(0x173)]};}),_0x3f55c5=await Promise['all'](_0x120312);return{'entries':_0x3f55c5,'hasMore':_0x584eff[_0x2a87b8(0x16c)]===_0x1210d2};}catch(_0x430a64){console['error']('Error\x20fetching\x20D3\x20ELO\x20history:',_0x430a64);throw _0x430a64;}}export function resetPaginationD3(){lastVisibleD3=null;}
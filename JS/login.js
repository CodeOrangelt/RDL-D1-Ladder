const a33_0x793c13=a33_0x5a5d,a33_0x26a0fb=(function(){let _0x5a7116=!![];return function(_0x4911c9,_0x12cd73){const _0x3412b3=_0x5a7116?function(){if(_0x12cd73){const _0x5d17f6=_0x12cd73['apply'](_0x4911c9,arguments);return _0x12cd73=null,_0x5d17f6;}}:function(){};return _0x5a7116=![],_0x3412b3;};}()),a33_0x4ccfe8=a33_0x26a0fb(this,function(){const _0x28e223=a33_0x5a5d;let _0x593b15;try{const _0x5317b1=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x593b15=_0x5317b1();}catch(_0x75038e){_0x593b15=window;}const _0x5dab86=_0x593b15[_0x28e223(0x210)]=_0x593b15['console']||{},_0x569f69=['log','warn','info','error','exception','table','trace'];for(let _0x4fa755=0x0;_0x4fa755<_0x569f69['length'];_0x4fa755++){const _0x3ccaff=a33_0x26a0fb[_0x28e223(0x222)]['prototype']['bind'](a33_0x26a0fb),_0x2e01a4=_0x569f69[_0x4fa755],_0x3fe3a8=_0x5dab86[_0x2e01a4]||_0x3ccaff;_0x3ccaff['__proto__']=a33_0x26a0fb['bind'](a33_0x26a0fb),_0x3ccaff['toString']=_0x3fe3a8['toString'][_0x28e223(0x1fd)](_0x3fe3a8),_0x5dab86[_0x2e01a4]=_0x3ccaff;}});a33_0x4ccfe8();import{createUserWithEmailAndPassword,signInWithEmailAndPassword,sendEmailVerification,signOut}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';function a33_0x5c54(){const _0x338e49=['\x20collection','email','register-error','pendingRegistrations','\x20at\x20position\x20','value','all','uid','Found\x20pending\x20registration:','length','login-password','message','click','emailVerified','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22success-message\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Registration\x20pending!\x20Please\x20check\x20your\x20email\x20to\x20verify\x20your\x20account.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<br><br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20onclick=\x22resendVerificationEmail(\x27','register-form','\x27)\x22\x20class=\x22resend-button\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Resend\x20Verification\x20Email\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>','log','\x20added\x20to\x20','show-login','players','bind','playersCTF','DOMContentLoaded','textContent','disabled','login-form','login-email','Email\x20not\x20yet\x20verified,\x20waiting...','register-container','nonParticipants','login-container','preventDefault','playersDuos','verificationCheckInterval','Error\x20resending\x20verification\x20email:','display','style','Login\x20error:\x20','register-username','console','auth/email-already-in-use','Unable\x20to\x20verify\x20username\x20availability.\x20Please\x20try\x20again\x20later.','purple','resendVerificationEmail','User\x20','username','gameMode','../index.html','getElementById','error','Error\x20checking\x20username:','test','code','addEventListener','Registration\x20failed.\x20Please\x20try\x20again\x20later.','login-error','Login\x20attempt\x20started\x20for:','constructor','href'];a33_0x5c54=function(){return _0x338e49;};return a33_0x5c54();}import{doc,setDoc,collection,getDocs,query,where,getDoc,updateDoc,deleteDoc,orderBy,limit,serverTimestamp}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{auth,db}from'./firebase-config.js';function setupVerificationListener(_0x3d554f,_0x36b839){console['log']('Setting\x20up\x20email\x20verification\x20listener\x20for:',_0x3d554f);const _0x1ee5ed=setInterval(async()=>{const _0x23fde5=a33_0x5a5d;try{console[_0x23fde5(0x1f9)]('Checking\x20if\x20email\x20has\x20been\x20verified...');const _0x28442a=await signInWithEmailAndPassword(auth,_0x3d554f,_0x36b839),_0x2c10c9=_0x28442a['user'];await _0x2c10c9['getIdToken'](!![]),_0x2c10c9[_0x23fde5(0x1f5)]?(console[_0x23fde5(0x1f9)]('Email\x20has\x20been\x20verified!\x20Redirecting\x20to\x20login\x20page...'),clearInterval(_0x1ee5ed),document[_0x23fde5(0x219)]('register-error')['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22success-message\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Email\x20verified\x20successfully!\x20You\x20can\x20now\x20log\x20in.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>',await signOut(auth),setTimeout(()=>{const _0x2d261c=_0x23fde5;document[_0x2d261c(0x219)]('register-container')[_0x2d261c(0x20d)][_0x2d261c(0x20c)]='none',document['getElementById']('login-container')['style'][_0x2d261c(0x20c)]='block',document['getElementById']('login-email')['value']=_0x3d554f,document['getElementById']('login-error')['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22success-message\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Your\x20account\x20has\x20been\x20verified!\x20You\x20can\x20now\x20log\x20in.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>';},0x7d0)):(console['log'](_0x23fde5(0x204)),await signOut(auth));}catch(_0x5d8020){console['error']('Error\x20checking\x20verification\x20status:',_0x5d8020),clearInterval(_0x1ee5ed);}},0x1388);window['verificationCheckInterval']=_0x1ee5ed,setTimeout(()=>{const _0x41638b=a33_0x5a5d;window['verificationCheckInterval']&&(clearInterval(window['verificationCheckInterval']),window[_0x41638b(0x20a)]=null,console['log']('Stopped\x20checking\x20for\x20email\x20verification\x20(timeout\x20reached)'));},0x5*0x3c*0x3e8);}async function isUsernameAvailable(_0x4d4f1d){const _0x1953d9=a33_0x5a5d;if(!_0x4d4f1d||typeof _0x4d4f1d!=='string'||_0x4d4f1d['trim']()['length']<0x3)return document[_0x1953d9(0x219)](_0x1953d9(0x1ea))['textContent']='Username\x20must\x20be\x20at\x20least\x203\x20characters\x20long',![];const _0xedad89=_0x4d4f1d['trim']();try{const _0x3437d2=/^[a-zA-Z0-9_-]{3,20}$/;if(!_0x3437d2[_0x1953d9(0x21c)](_0xedad89))return document['getElementById']('register-error')[_0x1953d9(0x200)]='Username\x20can\x20only\x20contain\x20letters,\x20numbers,\x20underscores\x20and\x20hyphens',![];const [_0x37ce67,_0x300576,_0x2928c3]=await Promise['all']([getDocs(query(collection(db,'players'),where(_0x1953d9(0x216),'==',_0xedad89))),getDocs(query(collection(db,'pendingRegistrations'),where(_0x1953d9(0x216),'==',_0xedad89))),getDocs(query(collection(db,_0x1953d9(0x206)),where(_0x1953d9(0x216),'==',_0xedad89)))]);if(!_0x37ce67['empty']||!_0x300576['empty']||!_0x2928c3['empty'])return document[_0x1953d9(0x219)]('register-error')['textContent']='Username\x20is\x20already\x20taken',![];return!![];}catch(_0x38a5a3){return console[_0x1953d9(0x21a)](_0x1953d9(0x21b),_0x38a5a3),document[_0x1953d9(0x219)]('register-error')['textContent']=_0x1953d9(0x212),![];}}async function handleRegister(_0x4e72e9){const _0x18adf0=a33_0x5a5d;_0x4e72e9['preventDefault']();const _0x207293=document['getElementById'](_0x18adf0(0x1ea));_0x207293[_0x18adf0(0x200)]='';const _0x39062e=document['getElementById']('register-email')['value'],_0x1a3ad7=document[_0x18adf0(0x219)]('register-password')['value'],_0x2689cb=document['getElementById'](_0x18adf0(0x20f))['value'],_0xb698e6=document['getElementById']('verification-answer')[_0x18adf0(0x1ed)]['toLowerCase'](),_0x3e04f6=document['getElementById']('register-mode')['value'],_0x2f30f5=document['getElementById']('non-participant')?.['checked']||![];if(_0x2f30f5&&_0x3e04f6!==''){_0x207293['textContent']='Please\x20unselect\x20a\x20game\x20mode\x20if\x20you\x20choose\x20Non-Participant.';return;}if(!_0x2f30f5&&_0x3e04f6===''){_0x207293['textContent']='Please\x20select\x20a\x20game\x20mode\x20or\x20check\x20Non-Participant.';return;}try{const _0x1dd1f9=[_0x18adf0(0x213),'magenta'];if(!_0x1dd1f9['includes'](_0xb698e6)){_0x207293['textContent']='Incorrect\x20answer\x20to\x20verification\x20question';return;}const _0x33f93e=await isUsernameAvailable(_0x2689cb);if(!_0x33f93e)return;const _0x1533f9=await createUserWithEmailAndPassword(auth,_0x39062e,_0x1a3ad7),_0x1904c5=_0x1533f9['user'];await sendEmailVerification(_0x1904c5),await setDoc(doc(db,_0x18adf0(0x1eb),_0x1904c5[_0x18adf0(0x1ef)]),{'username':_0x2689cb['trim'](),'email':_0x39062e,'gameMode':_0x3e04f6,'nonParticipant':_0x2f30f5,'createdAt':new Date(),'verified':![]}),_0x207293['innerHTML']=_0x18adf0(0x1f6)+_0x39062e+_0x18adf0(0x1f8),await signOut(auth),setupVerificationListener(_0x39062e,_0x1a3ad7);}catch(_0x5ab486){console[_0x18adf0(0x21a)]('Registration\x20error:',_0x5ab486),_0x207293['textContent']=_0x5ab486[_0x18adf0(0x21d)]===_0x18adf0(0x211)?'Email\x20address\x20is\x20already\x20registered':_0x18adf0(0x21f);}}function a33_0x5a5d(_0x1daee0,_0x102c7c){const _0x4ccfe8=a33_0x5c54();return a33_0x5a5d=function(_0x26a0fb,_0x42029f){_0x26a0fb=_0x26a0fb-0x1e8;let _0x5c54f6=_0x4ccfe8[_0x26a0fb];return _0x5c54f6;},a33_0x5a5d(_0x1daee0,_0x102c7c);}async function handleLogin(_0x4752fa){const _0x58b327=a33_0x5a5d;_0x4752fa[_0x58b327(0x208)]();const _0x26192b=document['getElementById'](_0x58b327(0x203))[_0x58b327(0x1ed)],_0x3452f4=document['getElementById'](_0x58b327(0x1f2))[_0x58b327(0x1ed)],_0x46ebe6=document[_0x58b327(0x219)]('login-error');console['log'](_0x58b327(0x221),_0x26192b),_0x46ebe6['textContent']='';try{console[_0x58b327(0x1f9)]('Attempting\x20Firebase\x20signInWithEmailAndPassword...');const _0x35b633=await signInWithEmailAndPassword(auth,_0x26192b,_0x3452f4),_0x21c843=_0x35b633['user'];console['log']('User\x20signed\x20in:',_0x21c843['uid']);const _0x50f1b8=[_0x58b327(0x1fc),'playersD2','playersD3',_0x58b327(0x209),_0x58b327(0x1fe),_0x58b327(0x206)];console['log']('Checking\x20if\x20user\x20exists\x20in\x20any\x20collection...');let _0xb42f11=![],_0x37e479=await Promise[_0x58b327(0x1ee)](_0x50f1b8['map'](_0x4c618d=>getDoc(doc(db,_0x4c618d,_0x21c843['uid']))));for(let _0x13db8e=0x0;_0x13db8e<_0x37e479[_0x58b327(0x1f1)];_0x13db8e++){if(_0x37e479[_0x13db8e]['exists']()){_0xb42f11=!![],console[_0x58b327(0x1f9)]('User\x20found\x20in\x20'+_0x50f1b8[_0x13db8e]+_0x58b327(0x1e8));break;}}if(!_0xb42f11){console['log']('User\x20not\x20found\x20in\x20any\x20collection,\x20checking\x20pending\x20registration');const _0x2df18b=doc(db,'pendingRegistrations',_0x21c843['uid']),_0x26ac5a=await getDoc(_0x2df18b);if(_0x26ac5a['exists']()){const _0x41826a=_0x26ac5a['data']();console[_0x58b327(0x1f9)](_0x58b327(0x1f0),_0x41826a);if(_0x21c843['emailVerified']){console['log']('Email\x20is\x20verified,\x20processing\x20registration'),_0x46ebe6['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22success-message\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Setting\x20up\x20your\x20account...\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>';if(_0x41826a['nonParticipant'])console['log']('Processing\x20non-participant\x20registration'),await setDoc(doc(db,_0x58b327(0x206),_0x21c843['uid']),{'username':_0x41826a[_0x58b327(0x216)],'email':_0x21c843[_0x58b327(0x1e9)],'createdAt':serverTimestamp(),'isNonParticipant':!![]}),console[_0x58b327(0x1f9)](_0x58b327(0x215)+_0x41826a['username']+'\x20added\x20to\x20nonParticipants\x20collection');else{let _0x37142e;switch(_0x41826a['gameMode']){case'D1':_0x37142e='players';break;case'D2':_0x37142e='playersD2';break;case'D3':_0x37142e='playersD3';break;case'Duos':_0x37142e='playersDuos';break;case'CTF':_0x37142e='playersCTF';break;default:_0x37142e='players';}console[_0x58b327(0x1f9)]('Processing\x20'+_0x41826a[_0x58b327(0x217)]+'\x20player\x20registration\x20to\x20'+_0x37142e);const _0x2e9a5e=collection(db,_0x37142e),_0x1d0427=query(_0x2e9a5e,orderBy('position','desc'),limit(0x1)),_0xdf5fb6=await getDocs(_0x1d0427),_0x3bfa7e=_0xdf5fb6['empty']?0x1:_0xdf5fb6['docs'][0x0]['data']()['position']+0x1;await setDoc(doc(db,_0x37142e,_0x21c843['uid']),{'username':_0x41826a['username'],'email':_0x21c843['email'],'eloRating':0x4b0,'position':_0x3bfa7e,'createdAt':serverTimestamp(),'isAdmin':![],'matches':0x0,'wins':0x0,'losses':0x0,'gameMode':_0x41826a[_0x58b327(0x217)]}),console['log']('New\x20player\x20'+_0x41826a['username']+_0x58b327(0x1fa)+_0x37142e+_0x58b327(0x1ec)+_0x3bfa7e);}await deleteDoc(_0x2df18b),setTimeout(()=>{const _0x5e02f9=_0x58b327;window['location'][_0x5e02f9(0x223)]=_0x5e02f9(0x218);},0x7d0);return;}else{_0x46ebe6['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22warning-message\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Please\x20verify\x20your\x20email\x20to\x20complete\x20your\x20registration.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<br><br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20type=\x22button\x22\x20id=\x22resend-button\x22\x20class=\x22resend-button\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Resend\x20Verification\x20Email\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>',document['getElementById']('resend-button')['addEventListener'](_0x58b327(0x1f4),()=>{resendVerificationEmail(_0x26192b);}),await signOut(auth);return;}}}window['location'][_0x58b327(0x223)]='../index.html';}catch(_0x5773b4){console[_0x58b327(0x21a)]('Login\x20error:',_0x5773b4),_0x46ebe6[_0x58b327(0x200)]='Login\x20failed:\x20'+_0x5773b4['message'];}}function loginFormHandler(_0x58ad2a){const _0x4bc02a=a33_0x5a5d;_0x58ad2a['preventDefault']();const _0x4b563e=document[_0x4bc02a(0x219)](_0x4bc02a(0x203))['value']['trim'](),_0x696171=document['getElementById']('login-password')['value'],_0x5b1d30=document['getElementById']('login-error');signInWithEmailAndPassword(auth,_0x4b563e,_0x696171)['then'](_0x121a2f=>{const _0x449c02=_0x4bc02a;console['log']('User\x20signed\x20in:',_0x121a2f['user']),window['location'][_0x449c02(0x223)]='../index.html';})['catch'](_0x4eb8fe=>{const _0x4acb6e=_0x4bc02a;console['error']('Login\x20error:',_0x4eb8fe),_0x5b1d30['textContent']=_0x4acb6e(0x20e)+_0x4eb8fe[_0x4acb6e(0x1f3)],_0x5b1d30['style']['display']='block';});}async function resendVerificationEmail(_0x238c42){const _0x5ba7c6=a33_0x5a5d;console['log']('Attempting\x20to\x20resend\x20verification\x20email\x20to:',_0x238c42);try{const _0x42c5a8=document['getElementById']('login-password')?.[_0x5ba7c6(0x1ed)];if(!_0x42c5a8){console[_0x5ba7c6(0x21a)]('Password\x20not\x20available\x20for\x20resending\x20verification'),document['getElementById']('login-error')['textContent']='Please\x20enter\x20your\x20password\x20to\x20resend\x20verification\x20email';return;}const _0x357fdb=await signInWithEmailAndPassword(auth,_0x238c42,_0x42c5a8),_0x451729=_0x357fdb['user'];console['log']('User\x20signed\x20in\x20for\x20verification\x20email:',_0x451729[_0x5ba7c6(0x1ef)]),await sendEmailVerification(_0x451729),console['log']('Verification\x20email\x20sent'),document[_0x5ba7c6(0x219)](_0x5ba7c6(0x220))['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22success-message\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Verification\x20email\x20has\x20been\x20resent\x20to\x20'+_0x238c42+'.\x20Please\x20check\x20your\x20inbox.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>',await signOut(auth);}catch(_0x20b1fe){console['error'](_0x5ba7c6(0x20b),_0x20b1fe),document['getElementById']('login-error')[_0x5ba7c6(0x200)]='Error\x20sending\x20verification\x20email:\x20'+_0x20b1fe['message'];}}window[a33_0x793c13(0x214)]=function(_0x40d084){console['log']('Window.resendVerificationEmail\x20called\x20with:',_0x40d084),resendVerificationEmail(_0x40d084);},document['addEventListener'](a33_0x793c13(0x1ff),()=>{const _0x341560=a33_0x793c13,_0x590081=document[_0x341560(0x219)]('non-participant'),_0x196383=document[_0x341560(0x219)]('register-mode');_0x590081&&_0x196383&&_0x590081[_0x341560(0x21e)]('change',function(){const _0x2ac726=_0x341560;this['checked']?(_0x196383['value']='',_0x196383[_0x2ac726(0x201)]=!![]):_0x196383['disabled']=![];});const _0x5789a6=document['getElementById'](_0x341560(0x1f7)),_0x5f47d5=document['getElementById'](_0x341560(0x202));_0x5789a6&&_0x5789a6['addEventListener']('submit',handleRegister);_0x5f47d5&&_0x5f47d5[_0x341560(0x21e)]('submit',handleLogin);const _0x518b1c=document['getElementById']('show-register'),_0x424794=document['getElementById'](_0x341560(0x1fb));_0x518b1c&&_0x518b1c['addEventListener']('click',_0x4e53c7=>{const _0x3a4a00=_0x341560;_0x4e53c7[_0x3a4a00(0x208)](),document['getElementById'](_0x3a4a00(0x207))[_0x3a4a00(0x20d)]['display']='none',document['getElementById'](_0x3a4a00(0x205))['style']['display']='block';}),_0x424794&&_0x424794[_0x341560(0x21e)]('click',_0xe70502=>{const _0x438eeb=_0x341560;_0xe70502['preventDefault'](),document['getElementById']('register-container')['style']['display']='none',document['getElementById'](_0x438eeb(0x207))['style'][_0x438eeb(0x20c)]='block';});});
const a10_0x337d4a=a10_0x58fd,a10_0x48dbf4=(function(){let _0x480675=!![];return function(_0x26c7f5,_0x549bb9){const _0xd012aa=_0x480675?function(){if(_0x549bb9){const _0x5b8a4d=_0x549bb9['apply'](_0x26c7f5,arguments);return _0x549bb9=null,_0x5b8a4d;}}:function(){};return _0x480675=![],_0xd012aa;};}()),a10_0x103fc6=a10_0x48dbf4(this,function(){const _0xd1ef4d=a10_0x58fd;let _0xb68fd8;try{const _0x1cd4cf=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0xb68fd8=_0x1cd4cf();}catch(_0x3ac86c){_0xb68fd8=window;}const _0xb2a0f6=_0xb68fd8[_0xd1ef4d(0x9c)]=_0xb68fd8['console']||{},_0x20ae23=['log',_0xd1ef4d(0xa6),'info','error','exception','table','trace'];for(let _0x5a7527=0x0;_0x5a7527<_0x20ae23['length'];_0x5a7527++){const _0x29562f=a10_0x48dbf4[_0xd1ef4d(0xa9)]['prototype']['bind'](a10_0x48dbf4),_0xc91cf1=_0x20ae23[_0x5a7527],_0x1b601e=_0xb2a0f6[_0xc91cf1]||_0x29562f;_0x29562f['__proto__']=a10_0x48dbf4['bind'](a10_0x48dbf4),_0x29562f['toString']=_0x1b601e['toString']['bind'](_0x1b601e),_0xb2a0f6[_0xc91cf1]=_0x29562f;}});function a10_0x5b56(){const _0x45a332=['log','target','playersDuos','Error\x20signing\x20out:','addEventListener','isAdmin','<a\x20href=\x22login.html\x22\x20class=\x22login-link\x22>Login</a>','toLowerCase','catch','console','hasCheckedCollections','nonParticipants','style','roleName','currentUser','status','error','council','data','warn','gameInvitations','signOut','constructor','username','none','forEach','includes','Error\x20checking\x20','click','\x20by\x20email:','innerHTML','admin@ladder.com','preventDefault','split','block','role','empty','pendingCount','email','charAt','Found\x20admin\x20role:\x20','toUpperCase','.admin-only','uid','visibilitychange','display','querySelectorAll','User','lastChecked'];a10_0x5b56=function(){return _0x45a332;};return a10_0x5b56();}a10_0x103fc6();import{getAuth,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{doc,getDoc,collection,query,where,getDocs,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import{isAdmin}from'./admin-check.js';const ADMIN_EMAILS=[a10_0x337d4a(0xb2),'Brian2af@outlook.com'],userCache={'uid':null,'username':null,'isAdmin':![],'hasCheckedCollections':![],'lastChecked':0x0,'role':null},invitationCache={'lastCheck':0x0,'pendingCount':0x0,'checkInterval':0x493e0};function updateInboxNotification(_0x1f746a){const _0x42696c=a10_0x337d4a,_0x5bcf9b=document['getElementById']('inbox-notification');_0x5bcf9b&&(_0x1f746a>0x0?(_0x5bcf9b['style'][_0x42696c(0xc0)]='inline-block',_0x5bcf9b['textContent']=_0x1f746a>0x9?'9+':_0x1f746a):_0x5bcf9b['style']['display']=_0x42696c(0xab));}async function checkPendingInvitationsForCurrentUser(_0x4a99bb){const _0x2cf892=a10_0x337d4a;try{const _0x4512f6=Date['now']();if(_0x4512f6-invitationCache['lastCheck']<invitationCache['checkInterval'])return updateInboxNotification(invitationCache[_0x2cf892(0xb8)]),invitationCache['pendingCount'];invitationCache['lastCheck']=_0x4512f6;const _0x2d4e49=collection(db,_0x2cf892(0xa7)),_0x426af3=query(_0x2d4e49,where('toUserId','==',_0x4a99bb),where(_0x2cf892(0xa2),'==','pending'),limit(0x5)),_0x24a416=await getDocs(_0x426af3),_0x52f2af=_0x24a416['size'];return invitationCache['pendingCount']=_0x52f2af,updateInboxNotification(_0x52f2af),_0x52f2af;}catch(_0x474f7b){return console[_0x2cf892(0xa6)]('Could\x20not\x20check\x20pending\x20invitations\x20for\x20current\x20user:',_0x474f7b),0x0;}}function updateAuthSectionImmediate(_0x4aad14,_0x40c3f5=![]){const _0x5c7e85=a10_0x337d4a,_0x4f501f=document['getElementById']('auth-section');if(!_0x4f501f)return;if(_0x4aad14&&_0x40c3f5)document['querySelectorAll']('.admin-only')['forEach'](_0xb55906=>{_0xb55906['style']['display']='block';});else!_0x4aad14&&document[_0x5c7e85(0xc1)]('.admin-only')[_0x5c7e85(0xac)](_0x4fbf22=>{const _0x544639=_0x5c7e85;_0x4fbf22[_0x544639(0x9f)]['display']=_0x544639(0xab);});if(_0x4aad14){const _0x401acc=userCache[_0x5c7e85(0xaa)]||(_0x4aad14['email']?_0x4aad14[_0x5c7e85(0xb9)][_0x5c7e85(0xb4)]('@')[0x0]:_0x5c7e85(0xc2)),_0x184a96=userCache['role']?'\x20('+userCache['role']+')':_0x40c3f5?'\x20(Admin)':'';_0x4f501f[_0x5c7e85(0xb1)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20class=\x22nav-username\x22>'+_0x401acc+_0x184a96+'</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username='+encodeURIComponent(_0x401acc)+'\x22>Profile</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./inbox.html\x22\x20class=\x22nav-notification\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Inbox\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22inbox-notification\x22\x20class=\x22notification-dot\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22members.html\x22>Members</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./redeem.html\x22><i\x20class=\x22fas\x20fa-gift\x22></i>Store</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20id=\x22logout-link\x22>Sign\x20Out</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';const _0x4b2892=document['getElementById']('logout-link');_0x4b2892&&_0x4b2892['addEventListener']('click',_0x15df9d=>{const _0x57072a=_0x5c7e85;_0x15df9d[_0x57072a(0xb3)]();const _0x1fdbfa=getAuth();updateAuthSectionImmediate(null),_0x1fdbfa[_0x57072a(0xa8)]()['catch'](_0x27bdf6=>{const _0x2293e1=_0x57072a;console[_0x2293e1(0xa3)](_0x2293e1(0x96),_0x27bdf6);});}),_0x4aad14['uid']&&setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0x4aad14['uid']);},0x3e8);}else _0x4f501f['innerHTML']=_0x5c7e85(0x99);}async function checkAdminRoles(_0x51b172){const _0x294cc5=a10_0x337d4a;if(!_0x51b172||!_0x51b172['email'])return{'isAdmin':![],'role':null};try{console['log']('Checking\x20roles\x20for\x20user:\x20'+_0x51b172['email']);const _0x1ccc2d=['players','playersD2','playersD3',_0x294cc5(0x9e),'userProfiles'],_0x2312d9=[_0x294cc5(0xa4),'creative\x20lead','owner','admin'];for(const _0x46b985 of _0x1ccc2d){try{const _0x10032c=doc(db,_0x46b985,_0x51b172['uid']),_0x69c0fb=await getDoc(_0x10032c);if(_0x69c0fb['exists']()){const _0x319f7b=_0x69c0fb[_0x294cc5(0xa5)]();console['log']('Found\x20user\x20in\x20'+_0x46b985+'\x20by\x20UID:',_0x319f7b);let _0x391f32=(_0x319f7b['roleName']||_0x319f7b[_0x294cc5(0xb6)]||'')[_0x294cc5(0x9a)](),_0x58d716=_0x319f7b[_0x294cc5(0xa0)]||_0x319f7b['role']||'';if(_0x391f32&&_0x2312d9[_0x294cc5(0xad)](_0x391f32)){console['log'](_0x294cc5(0xbb)+_0x391f32+'\x20in\x20'+_0x46b985);const _0x1089fd=_0x58d716[_0x294cc5(0xb4)]('\x20')['map'](_0x4c4d40=>_0x4c4d40[_0x294cc5(0xba)](0x0)[_0x294cc5(0xbc)]()+_0x4c4d40['slice'](0x1)['toLowerCase']())['join']('\x20');return{'isAdmin':!![],'role':_0x1089fd};}}}catch(_0x4149cd){console[_0x294cc5(0xa3)]('Error\x20checking\x20'+_0x46b985+'\x20by\x20UID:',_0x4149cd);}}for(const _0x37cc4e of _0x1ccc2d){try{const _0x23133d=collection(db,_0x37cc4e);let _0x92e67e=query(_0x23133d,where(_0x294cc5(0xb9),'==',_0x51b172[_0x294cc5(0xb9)])),_0x57791e=await getDocs(_0x92e67e);_0x57791e[_0x294cc5(0xb7)]&&(_0x92e67e=query(_0x23133d,where('email','==',_0x51b172[_0x294cc5(0xb9)][_0x294cc5(0x9a)]())),_0x57791e=await getDocs(_0x92e67e));if(!_0x57791e['empty']){const _0x501127=_0x57791e['docs'][0x0]['data']();console['log']('Found\x20user\x20in\x20'+_0x37cc4e+'\x20by\x20email:',_0x501127);let _0x567e3e=(_0x501127[_0x294cc5(0xa0)]||_0x501127['role']||'')['toLowerCase'](),_0x1526d2=_0x501127['roleName']||_0x501127[_0x294cc5(0xb6)]||'';if(_0x567e3e&&_0x2312d9['includes'](_0x567e3e)){console[_0x294cc5(0x93)]('Found\x20admin\x20role:\x20'+_0x567e3e+'\x20in\x20'+_0x37cc4e);const _0x5db207=_0x1526d2['split']('\x20')['map'](_0x15eed0=>_0x15eed0['charAt'](0x0)[_0x294cc5(0xbc)]()+_0x15eed0['slice'](0x1)[_0x294cc5(0x9a)]())['join']('\x20');return{'isAdmin':!![],'role':_0x5db207};}}}catch(_0x460cce){console['error'](_0x294cc5(0xae)+_0x37cc4e+_0x294cc5(0xb0),_0x460cce);}}return console['log']('No\x20admin\x20roles\x20found\x20for\x20user'),{'isAdmin':![],'role':null};}catch(_0x5519a4){return console['error']('Error\x20in\x20checkAdminRoles:',_0x5519a4),{'isAdmin':![],'role':null};}}async function updateAuthSection(_0x19a1ea){const _0x158069=a10_0x337d4a,_0x543d91=_0x19a1ea&&isAdmin(_0x19a1ea[_0x158069(0xb9)]);updateAuthSectionImmediate(_0x19a1ea,_0x543d91);if(!_0x19a1ea){userCache[_0x158069(0xbe)]=null,userCache['username']=null,userCache['isAdmin']=![],userCache['hasCheckedCollections']=![],userCache['role']=null;return;}const _0x3a2348=Date['now']();if(_0x19a1ea['uid']===userCache['uid']&&userCache[_0x158069(0x9d)]&&_0x3a2348-userCache[_0x158069(0xc3)]<0x493e0)return;try{userCache['uid']=_0x19a1ea[_0x158069(0xbe)],userCache['lastChecked']=_0x3a2348;const _0x28355a=isAdmin(_0x19a1ea[_0x158069(0xb9)]);userCache['isAdmin']=_0x28355a;if(!_0x28355a){const {isAdmin:_0x1db0fc,role:_0x531e82}=await checkAdminRoles(_0x19a1ea);userCache['isAdmin']=_0x1db0fc,userCache['role']=_0x531e82,_0x1db0fc&&(document['querySelectorAll'](_0x158069(0xbd))['forEach'](_0x56e2b0=>{const _0x1e049a=_0x158069;_0x56e2b0[_0x1e049a(0x9f)][_0x1e049a(0xc0)]=_0x1e049a(0xb5);}),updateAuthSectionImmediate(_0x19a1ea,!![]));}const _0x54bbe5=['players','playersD2','playersD3',_0x158069(0x95),'playersCTF','nonParticipants','userProfiles'],_0x5bf1ba=_0x54bbe5['map'](_0x593a3e=>getDoc(doc(db,_0x593a3e,_0x19a1ea['uid']))['then'](_0x7397ef=>_0x7397ef['exists']()?{'collection':_0x593a3e,'data':_0x7397ef['data']()}:null)[_0x158069(0x9b)](()=>null)),_0x34df47=await Promise['all'](_0x5bf1ba),_0x21cd82=_0x34df47['filter'](_0x45c1e3=>_0x45c1e3!==null);let _0x501510=null;for(const _0x1e3622 of _0x21cd82){if(_0x1e3622['data'][_0x158069(0xaa)]){_0x501510=_0x1e3622['data']['username'];break;}}userCache[_0x158069(0xaa)]=_0x501510||(_0x19a1ea['email']?_0x19a1ea[_0x158069(0xb9)]['split']('@')[0x0]:'User'),userCache['hasCheckedCollections']=!![],updateAuthSectionImmediate(_0x19a1ea,userCache[_0x158069(0x98)]),setTimeout(()=>{const _0x2560f7=_0x158069;checkPendingInvitationsForCurrentUser(_0x19a1ea[_0x2560f7(0xbe)]);},0x1f4);}catch(_0x309821){console[_0x158069(0xa3)]('Error\x20in\x20full\x20auth\x20update:',_0x309821);}}function a10_0x58fd(_0x1dd1b6,_0x1aebc3){const _0x103fc6=a10_0x5b56();return a10_0x58fd=function(_0x48dbf4,_0xed5167){_0x48dbf4=_0x48dbf4-0x93;let _0x5b56ff=_0x103fc6[_0x48dbf4];return _0x5b56ff;},a10_0x58fd(_0x1dd1b6,_0x1aebc3);}document['addEventListener']('DOMContentLoaded',()=>{const _0x58d564=a10_0x337d4a,_0x32b1b4=getAuth();onAuthStateChanged(_0x32b1b4,async _0x173c3a=>{await updateAuthSection(_0x173c3a),_0x173c3a&&checkPendingInvitationsForCurrentUser(_0x173c3a['uid']);}),document[_0x58d564(0x97)](_0x58d564(0xbf),()=>{!document['hidden']&&_0x32b1b4['currentUser']&&checkPendingInvitationsForCurrentUser(_0x32b1b4['currentUser']['uid']);}),document['addEventListener'](_0x58d564(0xaf),_0x3d5f4a=>{const _0x2204fb=_0x58d564;_0x3d5f4a[_0x2204fb(0x94)]['closest']('a[href]')&&_0x32b1b4[_0x2204fb(0xa1)]&&checkPendingInvitationsForCurrentUser(_0x32b1b4['currentUser'][_0x2204fb(0xbe)]);});});export{updateAuthSection};
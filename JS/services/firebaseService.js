const a50_0x1a52c7=a50_0x30a1,a50_0x1bf69e=(function(){let _0x304d9e=!![];return function(_0x5bef24,_0x584b20){const _0x407614=_0x304d9e?function(){if(_0x584b20){const _0x47c751=_0x584b20['apply'](_0x5bef24,arguments);return _0x584b20=null,_0x47c751;}}:function(){};return _0x304d9e=![],_0x407614;};}()),a50_0x5f2521=a50_0x1bf69e(this,function(){const _0x4762f8=a50_0x30a1;let _0x3bf807;try{const _0x2a0dac=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x3bf807=_0x2a0dac();}catch(_0x28cd28){_0x3bf807=window;}const _0x11eae4=_0x3bf807['console']=_0x3bf807['console']||{},_0x475c94=[_0x4762f8(0x194),'warn','info','error',_0x4762f8(0x18e),_0x4762f8(0x197),'trace'];for(let _0x51428d=0x0;_0x51428d<_0x475c94['length'];_0x51428d++){const _0x5dcb2e=a50_0x1bf69e['constructor'][_0x4762f8(0x190)]['bind'](a50_0x1bf69e),_0x24c8a2=_0x475c94[_0x51428d],_0x4a8341=_0x11eae4[_0x24c8a2]||_0x5dcb2e;_0x5dcb2e['__proto__']=a50_0x1bf69e['bind'](a50_0x1bf69e),_0x5dcb2e['toString']=_0x4a8341['toString'][_0x4762f8(0x19c)](_0x4a8341),_0x11eae4[_0x24c8a2]=_0x5dcb2e;}});a50_0x5f2521();import{db}from'../firebase-config.js';import{collection,doc,getDoc,getDocs,query,limit,startAfter,where,onSnapshot}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const cache={'userProfiles':new Map(),'ladderPlayers':new Map(),'matchResults':new Map(),'eloHistory':new Map()},CACHE_EXPIRY={'userProfiles':0x5*0x3c*0x3e8,'ladderPlayers':0x2*0x3c*0x3e8,'matchResults':0x1*0x3c*0x3e8,'eloHistory':0x3*0x3c*0x3e8};export const userProfilesRef=collection(db,'userProfiles');export async function fetchPaginatedData(_0x5b2908,_0x122334=0xa,_0x114aec=null){const _0x17f09f=a50_0x30a1;let _0x29badd=query(_0x5b2908,limit(_0x122334));_0x114aec&&(_0x29badd=query(_0x29badd,startAfter(_0x114aec)));const _0x11572d=await getDocs(_0x29badd),_0x53b152=_0x11572d[_0x17f09f(0x18f)][_0x11572d[_0x17f09f(0x18f)]['length']-0x1];return{'data':_0x11572d['docs']['map'](_0x22bfde=>({'id':_0x22bfde['id'],..._0x22bfde['data']()})),'lastVisible':_0x53b152,'hasMore':_0x11572d['docs']['length']===_0x122334};}export async function getUserProfile(_0x2fdacd){const _0x59f65b=a50_0x30a1,_0x216ae7=cache['userProfiles']['get'](_0x2fdacd);if(_0x216ae7&&Date['now']()-_0x216ae7['timestamp']<CACHE_EXPIRY['userProfiles'])return _0x216ae7[_0x59f65b(0x199)];const _0x2872c9=await getDoc(doc(userProfilesRef,_0x2fdacd));if(_0x2872c9[_0x59f65b(0x19a)]()){const _0x451ec0=_0x2872c9['data']();return cache[_0x59f65b(0x193)][_0x59f65b(0x18d)](_0x2fdacd,{'data':_0x451ec0,'timestamp':Date[_0x59f65b(0x19b)]()}),_0x451ec0;}return null;}function a50_0x30a1(_0x27af50,_0x2d36a2){const _0x5f2521=a50_0x3151();return a50_0x30a1=function(_0x1bf69e,_0x144e00){_0x1bf69e=_0x1bf69e-0x18d;let _0x31513a=_0x5f2521[_0x1bf69e];return _0x31513a;},a50_0x30a1(_0x27af50,_0x2d36a2);}export async function getLadderData(_0x3648f6=0x1){const _0x1facbc=a50_0x30a1,_0x2049c0='division_'+_0x3648f6,_0x5c1f0a=cache['ladderPlayers'][_0x1facbc(0x192)](_0x2049c0);if(_0x5c1f0a&&Date['now']()-_0x5c1f0a[_0x1facbc(0x196)]<CACHE_EXPIRY['ladderPlayers'])return _0x5c1f0a['data'];const _0x4cae5d=_0x3648f6===0x1?'players':'playersD'+_0x3648f6,_0x59d0c9=collection(db,_0x4cae5d),_0x5ee149=await getDocs(query(_0x59d0c9,limit(0x64))),_0x3623ac=_0x5ee149['docs']['map'](_0x5279d8=>({'id':_0x5279d8['id'],..._0x5279d8['data']()}));return cache['ladderPlayers']['set'](_0x2049c0,{'data':_0x3623ac,'timestamp':Date['now']()}),_0x3623ac;}export async function getEloHistoryBatch(_0x13b458,_0x2e8078=0x1){const _0x32187e=a50_0x30a1,_0xad21e4=_0x2e8078===0x1?'eloHistory':'eloHistoryD'+_0x2e8078,_0x3ca59d=collection(db,_0xad21e4),_0x311a7f={},_0x4b784f=[];_0x13b458['forEach'](_0x45fd3c=>{const _0x3d5de8=a50_0x30a1,_0x46c4b5=_0x45fd3c+'_'+_0x2e8078,_0xa1f4f=cache['eloHistory']['get'](_0x46c4b5);_0xa1f4f&&Date['now']()-_0xa1f4f['timestamp']<CACHE_EXPIRY['eloHistory']?_0x311a7f[_0x45fd3c]=_0xa1f4f['data']:_0x4b784f[_0x3d5de8(0x191)](_0x45fd3c);});const _0x530a4b=0xa;for(let _0x3c0179=0x0;_0x3c0179<_0x4b784f[_0x32187e(0x195)];_0x3c0179+=_0x530a4b){const _0x2eb2c=_0x4b784f[_0x32187e(0x19d)](_0x3c0179,_0x3c0179+_0x530a4b);if(_0x2eb2c['length']>0x0)try{const _0x4a8bdd=query(_0x3ca59d,where('playerId','in',_0x2eb2c),limit(0x64)),_0x43ec45=await getDocs(_0x4a8bdd);_0x43ec45[_0x32187e(0x18f)]['forEach'](_0x17d9c2=>{const _0x18c0fc=_0x17d9c2['data'](),_0x54dfa7=_0x18c0fc['playerId'];if(!_0x311a7f[_0x54dfa7])_0x311a7f[_0x54dfa7]=[];_0x311a7f[_0x54dfa7]['push'](_0x18c0fc);const _0x2095d6=_0x54dfa7+'_'+_0x2e8078;cache['eloHistory']['set'](_0x2095d6,{'data':_0x311a7f[_0x54dfa7],'timestamp':Date['now']()});});}catch(_0x344143){console['error']('Error\x20fetching\x20batch\x20ELO\x20history:',_0x344143);}}return _0x311a7f;}let usernameCache=new Map(),usernameCacheTimestamp=Date[a50_0x1a52c7(0x19b)]();export function setupEfficientListener(_0x11719a,_0xd7229b=[],_0x4313e1){const _0x592f19=collection(db,_0x11719a),_0x359dba=query(_0x592f19,..._0xd7229b),_0x8ac303=onSnapshot(_0x359dba,_0x516074=>{const _0x2a94ea=a50_0x30a1,_0x52b1ab=_0x516074['docChanges']()['map'](_0x108909=>({'type':_0x108909[_0x2a94ea(0x198)],'id':_0x108909['doc']['id'],'data':_0x108909[_0x2a94ea(0x19e)]['data']()}));_0x52b1ab[_0x2a94ea(0x195)]>0x0&&_0x4313e1(_0x52b1ab,_0x516074['docs']);});return _0x8ac303;}export async function bulkResolveUsernames(_0x297807){const _0x38f365=a50_0x1a52c7,_0x1fc690=new Map();if(!_0x297807||_0x297807[_0x38f365(0x195)]===0x0)return _0x1fc690;const _0x5d2d9f=['players','playersD2','playersD3','nonParticipants'];for(const _0x424fb1 of _0x5d2d9f){const _0x32767e=collection(db,_0x424fb1),_0x3a3c4d=await getDocs(_0x32767e);_0x3a3c4d['forEach'](_0x51ecf7=>{const _0x5dbdcb=_0x51ecf7['data']();_0x5dbdcb['username']&&_0x297807['includes'](_0x51ecf7['id'])&&_0x1fc690['set'](_0x51ecf7['id'],_0x5dbdcb['username']);});}return _0x1fc690;}function a50_0x3151(){const _0x3303b9=['set','exception','docs','prototype','push','get','userProfiles','log','length','timestamp','table','type','data','exists','now','bind','slice','doc'];a50_0x3151=function(){return _0x3303b9;};return a50_0x3151();}
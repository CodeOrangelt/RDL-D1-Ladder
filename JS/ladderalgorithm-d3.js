(function(_0xa3f9c8,_0x5dace3){const _0x54f146=a29_0x3aa4,_0x14096e=_0xa3f9c8();while(!![]){try{const _0xa617b5=-parseInt(_0x54f146(0x208))/0x1+-parseInt(_0x54f146(0x1e6))/0x2+-parseInt(_0x54f146(0x1dd))/0x3+-parseInt(_0x54f146(0x1fe))/0x4*(parseInt(_0x54f146(0x1e1))/0x5)+parseInt(_0x54f146(0x1f7))/0x6*(-parseInt(_0x54f146(0x1de))/0x7)+parseInt(_0x54f146(0x201))/0x8*(parseInt(_0x54f146(0x1e7))/0x9)+parseInt(_0x54f146(0x1ec))/0xa;if(_0xa617b5===_0x5dace3)break;else _0x14096e['push'](_0x14096e['shift']());}catch(_0xd99f67){_0x14096e['push'](_0x14096e['shift']());}}}(a29_0x176a,0xeaa2b));function a29_0x3aa4(_0x23537f,_0xb2728){const _0x4c69e3=a29_0x176a();return a29_0x3aa4=function(_0x47c432,_0x32705f){_0x47c432=_0x47c432-0x1d0;let _0x2873cc=_0x4c69e3[_0x47c432];return _0x2873cc;},a29_0x3aa4(_0x23537f,_0xb2728);}const a29_0x1c0a05=(function(){let _0x42b1a9=!![];return function(_0x36981e,_0x1e84de){const _0x5b10e1=_0x42b1a9?function(){const _0x5883e5=a29_0x3aa4;if(_0x1e84de){const _0xc9f21a=_0x1e84de[_0x5883e5(0x1d9)](_0x36981e,arguments);return _0x1e84de=null,_0xc9f21a;}}:function(){};return _0x42b1a9=![],_0x5b10e1;};}()),a29_0x2c73f8=a29_0x1c0a05(this,function(){const _0x543ba4=a29_0x3aa4;return a29_0x2c73f8[_0x543ba4(0x1f1)]()['search'](_0x543ba4(0x203))[_0x543ba4(0x1f1)]()[_0x543ba4(0x1fc)](a29_0x2c73f8)['search'](_0x543ba4(0x203));});a29_0x2c73f8();function a29_0x176a(){const _0x577048=['prototype','win','toString','username','D3\x20match\x20report\x20not\x20found','table','approvedMatchesD3','D3\x20Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked','30cstuac','docs','Error\x20in\x20updateEloRatingsD3:','bind','update','constructor','data','20068JYCVwh','D3\x20Report\x20not\x20found\x20with\x20ID:','Current\x20username:','21304wAFYFp','D3\x20Report\x20data:','(((.+)+)+)+$','error','eloRating','log','MAX_SAFE_INTEGER','659851TvDSmu','currentUser','round','length','empty','uid','Only\x20the\x20winner\x20can\x20approve\x20D3\x20matches','You\x20must\x20be\x20logged\x20in\x20to\x20approve\x20D3\x20matches','Starting\x20approveReportD3\x20function\x20with:','playersD3','position','warn','One\x20or\x20both\x20D3\x20players\x20not\x20found','info','apply','loserUsername','trace','winnerUsername','575031pfxzgr','2437211NPTNcE','exists','console','1035xMvdPe','all','email','D3\x20Match\x20moved\x20to\x20approved\x20collection','loss','254464tEXyVQ','117paXXFd','pow','D3\x20ELO\x20ratings\x20updated\x20successfully','exception','D3\x20Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions','46845920yThxWK','Error\x20in\x20approveReportD3:','Could\x20not\x20find\x20D3\x20player\x20documents'];a29_0x176a=function(){return _0x577048;};return a29_0x176a();}const a29_0x32705f=(function(){let _0x181f49=!![];return function(_0x3c930e,_0x102f2c){const _0x226f32=_0x181f49?function(){const _0x1fe41e=a29_0x3aa4;if(_0x102f2c){const _0x5c4e30=_0x102f2c[_0x1fe41e(0x1d9)](_0x3c930e,arguments);return _0x102f2c=null,_0x5c4e30;}}:function(){};return _0x181f49=![],_0x226f32;};}()),a29_0x47c432=a29_0x32705f(this,function(){const _0x1d4055=a29_0x3aa4;let _0x1f37b4;try{const _0x14c9b7=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x1f37b4=_0x14c9b7();}catch(_0x1aee50){_0x1f37b4=window;}const _0x306c32=_0x1f37b4[_0x1d4055(0x1e0)]=_0x1f37b4['console']||{},_0x2d8f8a=[_0x1d4055(0x206),_0x1d4055(0x1d6),_0x1d4055(0x1d8),_0x1d4055(0x204),_0x1d4055(0x1ea),_0x1d4055(0x1f4),_0x1d4055(0x1db)];for(let _0xe28c83=0x0;_0xe28c83<_0x2d8f8a[_0x1d4055(0x20b)];_0xe28c83++){const _0xe1e58a=a29_0x32705f['constructor'][_0x1d4055(0x1ef)][_0x1d4055(0x1fa)](a29_0x32705f),_0x585508=_0x2d8f8a[_0xe28c83],_0x2c4a4a=_0x306c32[_0x585508]||_0xe1e58a;_0xe1e58a['__proto__']=a29_0x32705f[_0x1d4055(0x1fa)](a29_0x32705f),_0xe1e58a['toString']=_0x2c4a4a['toString'][_0x1d4055(0x1fa)](_0x2c4a4a),_0x306c32[_0x585508]=_0xe1e58a;}});a29_0x47c432();import{addDoc,updateDoc,serverTimestamp,collection,doc,getDoc,getDocs,query,where,setDoc,deleteDoc,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';import{recordEloChangeD3}from'./elo-history-d3.js';export function calculateEloD3(_0x283a31,_0x1c171c,_0x4ee214=0x20){const _0x4f531b=a29_0x3aa4,_0x3fd085=0x1/(0x1+Math[_0x4f531b(0x1e8)](0xa,(_0x1c171c-_0x283a31)/0x190)),_0x26fe32=0x1/(0x1+Math[_0x4f531b(0x1e8)](0xa,(_0x283a31-_0x1c171c)/0x190)),_0x46df26=_0x283a31+_0x4ee214*(0x1-_0x3fd085),_0x468480=_0x1c171c+_0x4ee214*(0x0-_0x26fe32);return{'newWinnerRating':Math[_0x4f531b(0x20a)](_0x46df26),'newLoserRating':Math[_0x4f531b(0x20a)](_0x468480)};}export async function updateEloRatingsD3(_0x1f41b3,_0x1ac0b4,_0x41e47a){const _0x4f9dff=a29_0x3aa4;try{const _0x2dc75f=writeBatch(db),_0x2ff475=doc(db,_0x4f9dff(0x1d4),_0x1f41b3),_0x45febe=doc(db,_0x4f9dff(0x1d4),_0x1ac0b4),[_0x12c033,_0x2248ee]=await Promise[_0x4f9dff(0x1e2)]([getDoc(_0x2ff475),getDoc(_0x45febe)]);if(!_0x12c033[_0x4f9dff(0x1df)]()||!_0x2248ee[_0x4f9dff(0x1df)]())throw new Error(_0x4f9dff(0x1d7));const _0x34b4e2=_0x12c033[_0x4f9dff(0x1fd)](),_0x5af267=_0x2248ee[_0x4f9dff(0x1fd)](),_0x5740c3=_0x34b4e2['position']||Number[_0x4f9dff(0x207)],_0x404ec3=_0x5af267['position']||Number['MAX_SAFE_INTEGER'],{newWinnerRating:_0x5b8bb5,newLoserRating:_0x36e9c7}=calculateEloD3(_0x34b4e2[_0x4f9dff(0x205)]||0x4b0,_0x5af267['eloRating']||0x4b0);let _0x4c01f0=_0x5740c3,_0x27984=_0x404ec3;if(_0x5740c3>_0x404ec3){console['log'](_0x4f9dff(0x1f6)),_0x4c01f0=_0x404ec3,_0x27984=_0x404ec3+0x1;const _0xade815=query(collection(db,_0x4f9dff(0x1d4)),where('position','>',_0x404ec3),where(_0x4f9dff(0x1d5),'<',_0x5740c3)),_0x567ec8=await getDocs(_0xade815);for(const _0x107a28 of _0x567ec8[_0x4f9dff(0x1f8)]){_0x107a28['id']!==_0x1f41b3&&_0x107a28['id']!==_0x1ac0b4&&_0x2dc75f[_0x4f9dff(0x1fb)](doc(db,_0x4f9dff(0x1d4),_0x107a28['id']),{'position':_0x107a28[_0x4f9dff(0x1fd)]()[_0x4f9dff(0x1d5)]+0x1});}}else console[_0x4f9dff(0x206)](_0x4f9dff(0x1eb));return _0x2dc75f[_0x4f9dff(0x1fb)](_0x2ff475,{'eloRating':_0x5b8bb5,'lastMatchDate':serverTimestamp(),'position':_0x4c01f0,'lastMatchId':_0x41e47a}),_0x2dc75f['update'](_0x45febe,{'eloRating':_0x36e9c7,'lastMatchDate':serverTimestamp(),'position':_0x27984,'lastMatchId':_0x41e47a}),await _0x2dc75f['commit'](),console['log'](_0x4f9dff(0x1e9)),await Promise[_0x4f9dff(0x1e2)]([recordEloChangeD3({'playerId':_0x1f41b3,'previousElo':_0x34b4e2['eloRating']||0x4b0,'newElo':_0x5b8bb5,'opponentId':_0x1ac0b4,'matchResult':_0x4f9dff(0x1f0),'previousPosition':_0x5740c3,'newPosition':_0x4c01f0,'isPromotion':_0x4c01f0<_0x5740c3,'matchId':_0x41e47a,'timestamp':serverTimestamp()}),recordEloChangeD3({'playerId':_0x1ac0b4,'previousElo':_0x5af267[_0x4f9dff(0x205)]||0x4b0,'newElo':_0x36e9c7,'opponentId':_0x1f41b3,'matchResult':_0x4f9dff(0x1e5),'previousPosition':_0x404ec3,'newPosition':_0x27984,'isDemotion':_0x27984>_0x404ec3,'matchId':_0x41e47a,'timestamp':serverTimestamp()})]),!![];}catch(_0x24374e){console[_0x4f9dff(0x204)](_0x4f9dff(0x1f9),_0x24374e);throw _0x24374e;}}export async function approveReportD3(_0x1a5e87,_0x4a59da,_0x444ec6,_0x3caa02){const _0x418eb3=a29_0x3aa4;try{console[_0x418eb3(0x206)](_0x418eb3(0x1d3),{'reportId':_0x1a5e87,'winnerScore':_0x4a59da,'winnerSuicides':_0x444ec6,'winnerComment':_0x3caa02});const _0x423b66=auth[_0x418eb3(0x209)];if(!_0x423b66){console[_0x418eb3(0x206)]('No\x20user\x20logged\x20in');throw new Error(_0x418eb3(0x1d2));}console[_0x418eb3(0x206)]('Current\x20user:',_0x423b66[_0x418eb3(0x1e3)]);const _0x647a36=await getDoc(doc(db,_0x418eb3(0x1d4),_0x423b66[_0x418eb3(0x1d0)])),_0x1a2dc2=_0x647a36[_0x418eb3(0x1df)]()?_0x647a36['data']()[_0x418eb3(0x1f2)]:null;console[_0x418eb3(0x206)](_0x418eb3(0x200),_0x1a2dc2);const _0x35b25e=doc(db,'pendingMatchesD3',_0x1a5e87),_0x593d1d=await getDoc(_0x35b25e);if(!_0x593d1d['exists']()){console[_0x418eb3(0x206)](_0x418eb3(0x1ff),_0x1a5e87);throw new Error(_0x418eb3(0x1f3));}const _0x4703c1=_0x593d1d[_0x418eb3(0x1fd)]();console[_0x418eb3(0x206)](_0x418eb3(0x202),_0x4703c1);if(_0x1a2dc2!==_0x4703c1[_0x418eb3(0x1dc)])throw new Error(_0x418eb3(0x1d1));const _0x422a4d={..._0x4703c1,'winnerScore':_0x4a59da,'winnerSuicides':_0x444ec6,'winnerComment':_0x3caa02,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':_0x1a2dc2,'createdAt':_0x4703c1['createdAt']||serverTimestamp(),'winnerUsername':_0x4703c1['winnerUsername'],'loserUsername':_0x4703c1[_0x418eb3(0x1da)]};await setDoc(doc(db,_0x418eb3(0x1f5),_0x1a5e87),_0x422a4d),await deleteDoc(_0x35b25e),console[_0x418eb3(0x206)](_0x418eb3(0x1e4));const [_0x101d20,_0x34ead0]=await Promise[_0x418eb3(0x1e2)]([getDocs(query(collection(db,_0x418eb3(0x1d4)),where(_0x418eb3(0x1f2),'==',_0x4703c1[_0x418eb3(0x1dc)]))),getDocs(query(collection(db,_0x418eb3(0x1d4)),where(_0x418eb3(0x1f2),'==',_0x4703c1[_0x418eb3(0x1da)])))]);if(_0x101d20[_0x418eb3(0x20c)]||_0x34ead0[_0x418eb3(0x20c)])throw new Error(_0x418eb3(0x1ee));const _0x5f03be=_0x101d20[_0x418eb3(0x1f8)][0x0]['id'],_0x10cbb0=_0x34ead0['docs'][0x0]['id'];return await updateEloRatingsD3(_0x5f03be,_0x10cbb0,_0x1a5e87),console[_0x418eb3(0x206)]('D3\x20Match\x20successfully\x20approved\x20and\x20ELO\x20updated'),!![];}catch(_0x12ee7c){console['error'](_0x418eb3(0x1ed),_0x12ee7c);throw _0x12ee7c;}}
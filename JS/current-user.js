const a12_0x4f3074=a12_0x2d11,a12_0x121df3=(function(){let _0x250d68=!![];return function(_0x4994d5,_0x48a9fb){const _0xa75d88=_0x250d68?function(){const _0x217cf8=a12_0x2d11;if(_0x48a9fb){const _0x2a5f31=_0x48a9fb[_0x217cf8(0xf5)](_0x4994d5,arguments);return _0x48a9fb=null,_0x2a5f31;}}:function(){};return _0x250d68=![],_0xa75d88;};}()),a12_0xced737=a12_0x121df3(this,function(){const _0x6c665e=a12_0x2d11,_0xb579a9=function(){let _0x163f46;try{_0x163f46=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0xba586d){_0x163f46=window;}return _0x163f46;},_0x3a83ae=_0xb579a9(),_0x27a9e8=_0x3a83ae['console']=_0x3a83ae[_0x6c665e(0x111)]||{},_0x50d092=['log','warn','info',_0x6c665e(0xf2),'exception','table','trace'];for(let _0x599e91=0x0;_0x599e91<_0x50d092['length'];_0x599e91++){const _0x5dcd4c=a12_0x121df3['constructor']['prototype'][_0x6c665e(0x11d)](a12_0x121df3),_0x181687=_0x50d092[_0x599e91],_0x2cc54c=_0x27a9e8[_0x181687]||_0x5dcd4c;_0x5dcd4c[_0x6c665e(0x103)]=a12_0x121df3[_0x6c665e(0x11d)](a12_0x121df3),_0x5dcd4c['toString']=_0x2cc54c['toString']['bind'](_0x2cc54c),_0x27a9e8[_0x181687]=_0x5dcd4c;}});a12_0xced737();import{getAuth,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{doc,getDoc,collection,query,where,getDocs,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import{isAdmin}from'./admin-check.js';const ADMIN_EMAILS=[a12_0x4f3074(0x113),'Brian2af@outlook.com'],userCache={'uid':null,'username':null,'isAdmin':![],'hasCheckedCollections':![],'lastChecked':0x0,'role':null},invitationCache={'lastCheck':0x0,'pendingCount':0x0,'checkInterval':0x493e0};function updateInboxNotification(_0x393eaf){const _0x1eafdc=document['getElementById']('inbox-notification');_0x1eafdc&&(_0x393eaf>0x0?(_0x1eafdc['style']['display']='inline-block',_0x1eafdc['textContent']=_0x393eaf>0x9?'9+':_0x393eaf):_0x1eafdc['style']['display']='none');}function a12_0x5ba0(){const _0x32122b=['error','isAdmin','target','apply','Error\x20in\x20checkAdminRoles:','visibilitychange','forEach','style','\x20in\x20','role','closest','empty','charAt','playersD2','split','preventDefault','Could\x20not\x20check\x20pending\x20invitations\x20for\x20current\x20user:','__proto__','toUpperCase','includes','catch','email','querySelectorAll','userProfiles','innerHTML','Error\x20checking\x20','pendingCount','addEventListener','display','toLowerCase','none','console','lastChecked','admin@ladder.com','\x22>Profile</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./inbox.html\x22\x20class=\x22nav-notification\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Inbox\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22inbox-notification\x22\x20class=\x22notification-dot\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22members.html\x22>Members</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./redeem.html\x22><i\x20class=\x22fas\x20fa-gift\x22></i>\x20Redeem</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20id=\x22logout-link\x22>Sign\x20Out</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','now','owner','signOut','status','log','getElementById','username','slice','bind','currentUser','DOMContentLoaded','hasCheckedCollections','</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username=','roleName','map','Found\x20admin\x20role:\x20','\x20by\x20UID:','click','uid','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20class=\x22nav-username\x22>','Error\x20in\x20full\x20auth\x20update:'];a12_0x5ba0=function(){return _0x32122b;};return a12_0x5ba0();}async function checkPendingInvitationsForCurrentUser(_0x466f13){const _0xad228=a12_0x4f3074;try{const _0x120e2f=Date[_0xad228(0x115)]();if(_0x120e2f-invitationCache['lastCheck']<invitationCache['checkInterval'])return updateInboxNotification(invitationCache[_0xad228(0x10c)]),invitationCache['pendingCount'];invitationCache['lastCheck']=_0x120e2f;const _0x53c1b6=collection(db,'gameInvitations'),_0x20be80=query(_0x53c1b6,where('toUserId','==',_0x466f13),where(_0xad228(0x118),'==','pending'),limit(0x5)),_0x1e4067=await getDocs(_0x20be80),_0x3ac4d6=_0x1e4067['size'];return invitationCache['pendingCount']=_0x3ac4d6,updateInboxNotification(_0x3ac4d6),_0x3ac4d6;}catch(_0xab3e82){return console['warn'](_0xad228(0x102),_0xab3e82),0x0;}}function updateAuthSectionImmediate(_0x287f93,_0x215ef8=![]){const _0x311ef1=a12_0x4f3074,_0x57a18e=document['getElementById']('auth-section');if(!_0x57a18e)return;if(_0x287f93&&_0x215ef8)document[_0x311ef1(0x108)]('.admin-only')['forEach'](_0x6dc702=>{const _0x402782=_0x311ef1;_0x6dc702['style'][_0x402782(0x10e)]='block';});else!_0x287f93&&document['querySelectorAll']('.admin-only')['forEach'](_0x1280a4=>{const _0x21e170=_0x311ef1;_0x1280a4[_0x21e170(0xf9)][_0x21e170(0x10e)]=_0x21e170(0x110);});if(_0x287f93){const _0x4a180f=userCache[_0x311ef1(0x11b)]||(_0x287f93['email']?_0x287f93['email'][_0x311ef1(0x100)]('@')[0x0]:'User'),_0x43ca78=userCache['role']?'\x20('+userCache[_0x311ef1(0xfb)]+')':_0x215ef8?'\x20(Admin)':'';_0x57a18e[_0x311ef1(0x10a)]=_0x311ef1(0x128)+_0x4a180f+_0x43ca78+_0x311ef1(0x121)+encodeURIComponent(_0x4a180f)+_0x311ef1(0x114);const _0x30cb27=document[_0x311ef1(0x11a)]('logout-link');_0x30cb27&&_0x30cb27['addEventListener'](_0x311ef1(0x126),_0x5e2877=>{const _0x2dbfd8=_0x311ef1;_0x5e2877[_0x2dbfd8(0x101)]();const _0x424378=getAuth();updateAuthSectionImmediate(null),_0x424378[_0x2dbfd8(0x117)]()[_0x2dbfd8(0x106)](_0x2e3219=>{console['error']('Error\x20signing\x20out:',_0x2e3219);});}),_0x287f93[_0x311ef1(0x127)]&&setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0x287f93['uid']);},0x3e8);}else _0x57a18e['innerHTML']='<a\x20href=\x22login.html\x22\x20class=\x22login-link\x22>Login</a>';}async function checkAdminRoles(_0x3fff29){const _0x1549d0=a12_0x4f3074;if(!_0x3fff29||!_0x3fff29['email'])return{'isAdmin':![],'role':null};try{console['log']('Checking\x20roles\x20for\x20user:\x20'+_0x3fff29['email']);const _0x416e63=['players',_0x1549d0(0xff),'playersD3','nonParticipants',_0x1549d0(0x109)],_0x35440f=['council','creative\x20lead',_0x1549d0(0x116),'admin'];for(const _0x909481 of _0x416e63){try{const _0x2fcd95=doc(db,_0x909481,_0x3fff29['uid']),_0x41bf78=await getDoc(_0x2fcd95);if(_0x41bf78['exists']()){const _0x421a8c=_0x41bf78['data']();console[_0x1549d0(0x119)]('Found\x20user\x20in\x20'+_0x909481+_0x1549d0(0x125),_0x421a8c);let _0x3ec984=(_0x421a8c[_0x1549d0(0x122)]||_0x421a8c['role']||'')['toLowerCase'](),_0x54f6e6=_0x421a8c['roleName']||_0x421a8c['role']||'';if(_0x3ec984&&_0x35440f[_0x1549d0(0x105)](_0x3ec984)){console[_0x1549d0(0x119)](_0x1549d0(0x124)+_0x3ec984+_0x1549d0(0xfa)+_0x909481);const _0x18cd4e=_0x54f6e6['split']('\x20')['map'](_0x3bdf3d=>_0x3bdf3d[_0x1549d0(0xfe)](0x0)['toUpperCase']()+_0x3bdf3d['slice'](0x1)[_0x1549d0(0x10f)]())['join']('\x20');return{'isAdmin':!![],'role':_0x18cd4e};}}}catch(_0x92761){console[_0x1549d0(0xf2)]('Error\x20checking\x20'+_0x909481+'\x20by\x20UID:',_0x92761);}}for(const _0x4b920b of _0x416e63){try{const _0x1ffb83=collection(db,_0x4b920b);let _0xa212ef=query(_0x1ffb83,where('email','==',_0x3fff29['email'])),_0x231a54=await getDocs(_0xa212ef);_0x231a54[_0x1549d0(0xfd)]&&(_0xa212ef=query(_0x1ffb83,where('email','==',_0x3fff29[_0x1549d0(0x107)]['toLowerCase']())),_0x231a54=await getDocs(_0xa212ef));if(!_0x231a54[_0x1549d0(0xfd)]){const _0xdfabe1=_0x231a54['docs'][0x0]['data']();console['log']('Found\x20user\x20in\x20'+_0x4b920b+'\x20by\x20email:',_0xdfabe1);let _0x558028=(_0xdfabe1['roleName']||_0xdfabe1[_0x1549d0(0xfb)]||'')['toLowerCase'](),_0x5dbb84=_0xdfabe1['roleName']||_0xdfabe1['role']||'';if(_0x558028&&_0x35440f['includes'](_0x558028)){console['log'](_0x1549d0(0x124)+_0x558028+_0x1549d0(0xfa)+_0x4b920b);const _0x3b297e=_0x5dbb84['split']('\x20')[_0x1549d0(0x123)](_0x48eead=>_0x48eead[_0x1549d0(0xfe)](0x0)[_0x1549d0(0x104)]()+_0x48eead[_0x1549d0(0x11c)](0x1)['toLowerCase']())['join']('\x20');return{'isAdmin':!![],'role':_0x3b297e};}}}catch(_0x517dc0){console[_0x1549d0(0xf2)](_0x1549d0(0x10b)+_0x4b920b+'\x20by\x20email:',_0x517dc0);}}return console['log']('No\x20admin\x20roles\x20found\x20for\x20user'),{'isAdmin':![],'role':null};}catch(_0x458faf){return console['error'](_0x1549d0(0xf6),_0x458faf),{'isAdmin':![],'role':null};}}async function updateAuthSection(_0x242a00){const _0x241943=a12_0x4f3074,_0x310ae0=_0x242a00&&isAdmin(_0x242a00[_0x241943(0x107)]);updateAuthSectionImmediate(_0x242a00,_0x310ae0);if(!_0x242a00){userCache['uid']=null,userCache['username']=null,userCache[_0x241943(0xf3)]=![],userCache['hasCheckedCollections']=![],userCache[_0x241943(0xfb)]=null;return;}const _0x55dbb5=Date['now']();if(_0x242a00['uid']===userCache['uid']&&userCache['hasCheckedCollections']&&_0x55dbb5-userCache[_0x241943(0x112)]<0x493e0)return;try{userCache[_0x241943(0x127)]=_0x242a00['uid'],userCache['lastChecked']=_0x55dbb5;const _0x3ba5bc=isAdmin(_0x242a00['email']);userCache['isAdmin']=_0x3ba5bc;if(!_0x3ba5bc){const {isAdmin:_0x4ee1d1,role:_0xd44079}=await checkAdminRoles(_0x242a00);userCache[_0x241943(0xf3)]=_0x4ee1d1,userCache['role']=_0xd44079,_0x4ee1d1&&(document['querySelectorAll']('.admin-only')[_0x241943(0xf8)](_0x4391b2=>{const _0x59b583=_0x241943;_0x4391b2['style'][_0x59b583(0x10e)]='block';}),updateAuthSectionImmediate(_0x242a00,!![]));}const _0xdea7e5=['players','playersD2','playersD3','playersDuos','playersCTF','nonParticipants','userProfiles'],_0x4f3a77=_0xdea7e5['map'](_0x1cf98a=>getDoc(doc(db,_0x1cf98a,_0x242a00[_0x241943(0x127)]))['then'](_0x2fd428=>_0x2fd428['exists']()?{'collection':_0x1cf98a,'data':_0x2fd428['data']()}:null)['catch'](()=>null)),_0x51e81e=await Promise['all'](_0x4f3a77),_0x462447=_0x51e81e['filter'](_0x17197d=>_0x17197d!==null);let _0x2b4a3d=null;for(const _0x26d0c6 of _0x462447){if(_0x26d0c6['data'][_0x241943(0x11b)]){_0x2b4a3d=_0x26d0c6['data'][_0x241943(0x11b)];break;}}userCache[_0x241943(0x11b)]=_0x2b4a3d||(_0x242a00['email']?_0x242a00['email']['split']('@')[0x0]:'User'),userCache[_0x241943(0x120)]=!![],updateAuthSectionImmediate(_0x242a00,userCache['isAdmin']),setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0x242a00['uid']);},0x1f4);}catch(_0x27a54e){console['error'](_0x241943(0x129),_0x27a54e);}}document['addEventListener'](a12_0x4f3074(0x11f),()=>{const _0x2d19db=a12_0x4f3074,_0x2796af=getAuth();onAuthStateChanged(_0x2796af,async _0x531c82=>{const _0x5d3d27=a12_0x2d11;await updateAuthSection(_0x531c82),_0x531c82&&checkPendingInvitationsForCurrentUser(_0x531c82[_0x5d3d27(0x127)]);}),document['addEventListener'](_0x2d19db(0xf7),()=>{const _0xa668c1=_0x2d19db;!document['hidden']&&_0x2796af[_0xa668c1(0x11e)]&&checkPendingInvitationsForCurrentUser(_0x2796af['currentUser']['uid']);}),document[_0x2d19db(0x10d)]('click',_0x13fe82=>{const _0x387208=_0x2d19db;_0x13fe82[_0x387208(0xf4)][_0x387208(0xfc)]('a[href]')&&_0x2796af['currentUser']&&checkPendingInvitationsForCurrentUser(_0x2796af['currentUser'][_0x387208(0x127)]);});});function a12_0x2d11(_0x215a0b,_0x19eeda){const _0xced737=a12_0x5ba0();return a12_0x2d11=function(_0x121df3,_0x5b0975){_0x121df3=_0x121df3-0xf2;let _0x5ba07f=_0xced737[_0x121df3];return _0x5ba07f;},a12_0x2d11(_0x215a0b,_0x19eeda);}export{updateAuthSection};
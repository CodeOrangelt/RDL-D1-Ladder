const a36_0x30faec=(function(){let _0x1e3448=!![];return function(_0x2c38e0,_0x4c09a7){const _0x1e8e63=_0x1e3448?function(){if(_0x4c09a7){const _0x32f1be=_0x4c09a7['apply'](_0x2c38e0,arguments);return _0x4c09a7=null,_0x32f1be;}}:function(){};return _0x1e3448=![],_0x1e8e63;};}()),a36_0x54fc10=a36_0x30faec(this,function(){const _0xee7147=a36_0x4a0c,_0x1efc2f=function(){const _0x20ceb0=a36_0x4a0c;let _0x141fbc;try{_0x141fbc=Function(_0x20ceb0(0xcf)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x2bbf89){_0x141fbc=window;}return _0x141fbc;},_0x481d1f=_0x1efc2f(),_0x4fdf7e=_0x481d1f['console']=_0x481d1f[_0xee7147(0xbb)]||{},_0x5c0a0f=['log','warn',_0xee7147(0xb1),_0xee7147(0xd0),'exception',_0xee7147(0xaa),_0xee7147(0xac)];for(let _0x565179=0x0;_0x565179<_0x5c0a0f['length'];_0x565179++){const _0x3b32f2=a36_0x30faec['constructor']['prototype']['bind'](a36_0x30faec),_0x530548=_0x5c0a0f[_0x565179],_0xb84ba7=_0x4fdf7e[_0x530548]||_0x3b32f2;_0x3b32f2[_0xee7147(0xd8)]=a36_0x30faec[_0xee7147(0xa9)](a36_0x30faec),_0x3b32f2['toString']=_0xb84ba7[_0xee7147(0xc5)]['bind'](_0xb84ba7),_0x4fdf7e[_0x530548]=_0x3b32f2;}});a36_0x54fc10();import{createUserWithEmailAndPassword,signInWithEmailAndPassword,sendEmailVerification,signOut}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{doc,setDoc,collection,getDocs,query,where,getDoc,updateDoc,deleteDoc,orderBy,limit,serverTimestamp}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{auth,db}from'./firebase-config.js';function setupVerificationListener(_0x4f80c8,_0x3f14b7){const _0x4b4f68=a36_0x4a0c;console[_0x4b4f68(0xc0)]('Setting\x20up\x20email\x20verification\x20listener\x20for:',_0x4f80c8);const _0x5733ee=setInterval(async()=>{const _0x4bb767=_0x4b4f68;try{console['log']('Checking\x20if\x20email\x20has\x20been\x20verified...');const _0x1aee4c=await signInWithEmailAndPassword(auth,_0x4f80c8,_0x3f14b7),_0x35df5a=_0x1aee4c['user'];await _0x35df5a[_0x4bb767(0xa6)](!![]),_0x35df5a['emailVerified']?(console['log'](_0x4bb767(0xd9)),clearInterval(_0x5733ee),document['getElementById'](_0x4bb767(0xb3))['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22success-message\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Email\x20verified\x20successfully!\x20You\x20can\x20now\x20log\x20in.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>',await signOut(auth),setTimeout(()=>{const _0x3f55fe=_0x4bb767;document['getElementById']('register-container')['style']['display']='none',document['getElementById']('login-container')['style']['display']='block',document['getElementById']('login-email')[_0x3f55fe(0xe1)]=_0x4f80c8,document[_0x3f55fe(0xb7)]('login-error')['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22success-message\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Your\x20account\x20has\x20been\x20verified!\x20You\x20can\x20now\x20log\x20in.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>';},0x7d0)):(console[_0x4bb767(0xc0)]('Email\x20not\x20yet\x20verified,\x20waiting...'),await signOut(auth));}catch(_0x51a81c){console[_0x4bb767(0xd0)](_0x4bb767(0xd4),_0x51a81c),clearInterval(_0x5733ee);}},0x1388);window['verificationCheckInterval']=_0x5733ee,setTimeout(()=>{const _0xdc3210=_0x4b4f68;window['verificationCheckInterval']&&(clearInterval(window[_0xdc3210(0xca)]),window['verificationCheckInterval']=null,console[_0xdc3210(0xc0)]('Stopped\x20checking\x20for\x20email\x20verification\x20(timeout\x20reached)'));},0x5*0x3c*0x3e8);}async function isUsernameAvailable(_0x466b6c){const _0x302a06=a36_0x4a0c;if(!_0x466b6c||typeof _0x466b6c!=='string'||_0x466b6c['trim']()['length']<0x3)return document['getElementById']('register-error')[_0x302a06(0xaf)]='Username\x20must\x20be\x20at\x20least\x203\x20characters\x20long',![];const _0x2821b2=_0x466b6c['trim']();try{const _0x68841d=/^[a-zA-Z0-9_-]{3,20}$/;if(!_0x68841d['test'](_0x2821b2))return document['getElementById']('register-error')[_0x302a06(0xaf)]='Username\x20can\x20only\x20contain\x20letters,\x20numbers,\x20underscores\x20and\x20hyphens',![];const [_0x2dc035,_0x4d1eb7,_0x72f0da]=await Promise['all']([getDocs(query(collection(db,'players'),where('username','==',_0x2821b2))),getDocs(query(collection(db,'pendingRegistrations'),where('username','==',_0x2821b2))),getDocs(query(collection(db,'nonParticipants'),where(_0x302a06(0xd7),'==',_0x2821b2)))]);if(!_0x2dc035['empty']||!_0x4d1eb7[_0x302a06(0xdf)]||!_0x72f0da['empty'])return document['getElementById'](_0x302a06(0xb3))['textContent']='Username\x20is\x20already\x20taken',![];return!![];}catch(_0x3f981b){return console['error']('Error\x20checking\x20username:',_0x3f981b),document[_0x302a06(0xb7)](_0x302a06(0xb3))['textContent']=_0x302a06(0xba),![];}}async function handleRegister(_0x3ae39f){const _0x32c859=a36_0x4a0c;_0x3ae39f[_0x32c859(0xc9)]();const _0x235ef9=document['getElementById']('register-error');_0x235ef9['textContent']='';const _0x2b99b5=document['getElementById'](_0x32c859(0xa4))['value'],_0x22236d=document[_0x32c859(0xb7)]('register-password')['value'],_0x26c837=document['getElementById'](_0x32c859(0xbf))['value'],_0x3c6bc0=document['getElementById']('verification-answer')[_0x32c859(0xe1)]['toLowerCase'](),_0x11ff0f=document['getElementById']('register-mode')['value'],_0x29f5d9=document['getElementById']('non-participant')?.['checked']||![];if(_0x29f5d9&&_0x11ff0f!==''){_0x235ef9['textContent']='Please\x20unselect\x20a\x20game\x20mode\x20if\x20you\x20choose\x20Non-Participant.';return;}if(!_0x29f5d9&&_0x11ff0f===''){_0x235ef9[_0x32c859(0xaf)]='Please\x20select\x20a\x20game\x20mode\x20or\x20check\x20Non-Participant.';return;}try{const _0x344fa7=[_0x32c859(0xdd),'magenta'];if(!_0x344fa7[_0x32c859(0xd5)](_0x3c6bc0)){_0x235ef9[_0x32c859(0xaf)]='Incorrect\x20answer\x20to\x20verification\x20question';return;}const _0x293b12=await isUsernameAvailable(_0x26c837);if(!_0x293b12)return;const _0x5abe5a=await createUserWithEmailAndPassword(auth,_0x2b99b5,_0x22236d),_0x437bf0=_0x5abe5a['user'];await sendEmailVerification(_0x437bf0),await setDoc(doc(db,_0x32c859(0xcd),_0x437bf0[_0x32c859(0xd6)]),{'username':_0x26c837['trim'](),'email':_0x2b99b5,'gameMode':_0x11ff0f,'nonParticipant':_0x29f5d9,'createdAt':new Date(),'verified':![]}),_0x235ef9['innerHTML']=_0x32c859(0xbd)+_0x2b99b5+'\x27)\x22\x20class=\x22resend-button\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Resend\x20Verification\x20Email\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>',await signOut(auth),setupVerificationListener(_0x2b99b5,_0x22236d);}catch(_0x51433f){console['error'](_0x32c859(0xe0),_0x51433f),_0x235ef9['textContent']=_0x51433f['code']==='auth/email-already-in-use'?'Email\x20address\x20is\x20already\x20registered':'Registration\x20failed.\x20Please\x20try\x20again\x20later.';}}async function handleLogin(_0x309f31){const _0x174414=a36_0x4a0c;_0x309f31[_0x174414(0xc9)]();const _0x2f2f92=document[_0x174414(0xb7)](_0x174414(0xa2))[_0x174414(0xe1)],_0xa53eb0=document['getElementById'](_0x174414(0xdb))['value'],_0x5d60cb=document[_0x174414(0xb7)]('login-error');console['log']('Login\x20attempt\x20started\x20for:',_0x2f2f92),_0x5d60cb[_0x174414(0xaf)]='';try{console['log']('Attempting\x20Firebase\x20signInWithEmailAndPassword...');const _0x46ca97=await signInWithEmailAndPassword(auth,_0x2f2f92,_0xa53eb0),_0x3b731d=_0x46ca97['user'];console[_0x174414(0xc0)]('User\x20signed\x20in:',_0x3b731d['uid']);const _0x2f09b9=['players',_0x174414(0xad),'playersD3','playersDuos',_0x174414(0xce),'nonParticipants'];console[_0x174414(0xc0)](_0x174414(0xb9));let _0xc636cc=![],_0xb579da=await Promise[_0x174414(0xab)](_0x2f09b9['map'](_0x2aa74e=>getDoc(doc(db,_0x2aa74e,_0x3b731d['uid']))));for(let _0x12c944=0x0;_0x12c944<_0xb579da['length'];_0x12c944++){if(_0xb579da[_0x12c944]['exists']()){_0xc636cc=!![],console['log']('User\x20found\x20in\x20'+_0x2f09b9[_0x12c944]+'\x20collection');break;}}if(!_0xc636cc){console['log'](_0x174414(0xc8));const _0x32957e=doc(db,_0x174414(0xcd),_0x3b731d['uid']),_0x59a712=await getDoc(_0x32957e);if(_0x59a712[_0x174414(0xdc)]()){const _0x2fb6c5=_0x59a712['data']();console['log']('Found\x20pending\x20registration:',_0x2fb6c5);if(_0x3b731d['emailVerified']){console[_0x174414(0xc0)]('Email\x20is\x20verified,\x20processing\x20registration'),_0x5d60cb['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22success-message\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Setting\x20up\x20your\x20account...\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>';if(_0x2fb6c5['nonParticipant'])console['log']('Processing\x20non-participant\x20registration'),await setDoc(doc(db,'nonParticipants',_0x3b731d[_0x174414(0xd6)]),{'username':_0x2fb6c5['username'],'email':_0x3b731d['email'],'createdAt':serverTimestamp(),'isNonParticipant':!![]}),console['log']('User\x20'+_0x2fb6c5[_0x174414(0xd7)]+_0x174414(0xc2));else{let _0x1d819c;switch(_0x2fb6c5['gameMode']){case'D1':_0x1d819c='players';break;case'D2':_0x1d819c=_0x174414(0xad);break;case'D3':_0x1d819c='playersD3';break;case _0x174414(0xb2):_0x1d819c='playersDuos';break;case'CTF':_0x1d819c='playersCTF';break;default:_0x1d819c='players';}console['log']('Processing\x20'+_0x2fb6c5[_0x174414(0xa5)]+'\x20player\x20registration\x20to\x20'+_0x1d819c);const _0x462d26=collection(db,_0x1d819c),_0x5e4f8f=query(_0x462d26,orderBy('position','desc'),limit(0x1)),_0x13fceb=await getDocs(_0x5e4f8f),_0x2ad82e=_0x13fceb['empty']?0x1:_0x13fceb['docs'][0x0]['data']()[_0x174414(0xc6)]+0x1;await setDoc(doc(db,_0x1d819c,_0x3b731d[_0x174414(0xd6)]),{'username':_0x2fb6c5[_0x174414(0xd7)],'email':_0x3b731d[_0x174414(0xbe)],'eloRating':0x4b0,'position':_0x2ad82e,'createdAt':serverTimestamp(),'isAdmin':![],'matches':0x0,'wins':0x0,'losses':0x0,'gameMode':_0x2fb6c5['gameMode']}),console['log'](_0x174414(0xc1)+_0x2fb6c5['username']+'\x20added\x20to\x20'+_0x1d819c+'\x20at\x20position\x20'+_0x2ad82e);}await deleteDoc(_0x32957e),setTimeout(()=>{const _0x1155d5=_0x174414;window['location']['href']=_0x1155d5(0xbc);},0x7d0);return;}else{_0x5d60cb[_0x174414(0xd2)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22warning-message\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Please\x20verify\x20your\x20email\x20to\x20complete\x20your\x20registration.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<br><br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20type=\x22button\x22\x20id=\x22resend-button\x22\x20class=\x22resend-button\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Resend\x20Verification\x20Email\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>',document['getElementById']('resend-button')['addEventListener']('click',()=>{resendVerificationEmail(_0x2f2f92);}),await signOut(auth);return;}}}window[_0x174414(0xd1)]['href']='../index.html';}catch(_0x4829a4){console['error'](_0x174414(0xb8),_0x4829a4),_0x5d60cb['textContent']='Login\x20failed:\x20'+_0x4829a4['message'];}}function loginFormHandler(_0xbe990e){const _0xa14770=a36_0x4a0c;_0xbe990e['preventDefault']();const _0x23dfa3=document['getElementById']('login-email')[_0xa14770(0xe1)]['trim'](),_0x5da2e8=document['getElementById'](_0xa14770(0xdb))['value'],_0x1f4fe9=document['getElementById']('login-error');signInWithEmailAndPassword(auth,_0x23dfa3,_0x5da2e8)[_0xa14770(0xde)](_0xc9601=>{const _0x3ef222=_0xa14770;console['log']('User\x20signed\x20in:',_0xc9601['user']),window['location']['href']=_0x3ef222(0xbc);})['catch'](_0x50b083=>{const _0x2cc549=_0xa14770;console[_0x2cc549(0xd0)]('Login\x20error:',_0x50b083),_0x1f4fe9['textContent']=_0x2cc549(0xa8)+_0x50b083['message'],_0x1f4fe9[_0x2cc549(0xcc)][_0x2cc549(0xb6)]=_0x2cc549(0xc4);});}function a36_0x5fb6(){const _0x4403d5=['login-email','login-form','register-email','gameMode','getIdToken','submit','Login\x20error:\x20','bind','table','all','trace','playersD2','show-register','textContent','Password\x20not\x20available\x20for\x20resending\x20verification','info','Duos','register-error','Verification\x20email\x20sent','click','display','getElementById','Login\x20error:','Checking\x20if\x20user\x20exists\x20in\x20any\x20collection...','Unable\x20to\x20verify\x20username\x20availability.\x20Please\x20try\x20again\x20later.','console','../index.html','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22success-message\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Registration\x20pending!\x20Please\x20check\x20your\x20email\x20to\x20verify\x20your\x20account.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<br><br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20onclick=\x22resendVerificationEmail(\x27','email','register-username','log','New\x20player\x20','\x20added\x20to\x20nonParticipants\x20collection','login-error','block','toString','position','register-mode','User\x20not\x20found\x20in\x20any\x20collection,\x20checking\x20pending\x20registration','preventDefault','verificationCheckInterval','addEventListener','style','pendingRegistrations','playersCTF','return\x20(function()\x20','error','location','innerHTML','register-container','Error\x20checking\x20verification\x20status:','includes','uid','username','__proto__','Email\x20has\x20been\x20verified!\x20Redirecting\x20to\x20login\x20page...','disabled','login-password','exists','purple','then','empty','Registration\x20error:','value'];a36_0x5fb6=function(){return _0x4403d5;};return a36_0x5fb6();}function a36_0x4a0c(_0x25e05b,_0x3cbf92){const _0x54fc10=a36_0x5fb6();return a36_0x4a0c=function(_0x30faec,_0x364a95){_0x30faec=_0x30faec-0xa2;let _0x5fb61c=_0x54fc10[_0x30faec];return _0x5fb61c;},a36_0x4a0c(_0x25e05b,_0x3cbf92);}async function resendVerificationEmail(_0x585638){const _0xf8493d=a36_0x4a0c;console['log']('Attempting\x20to\x20resend\x20verification\x20email\x20to:',_0x585638);try{const _0x5d2a43=document[_0xf8493d(0xb7)]('login-password')?.['value'];if(!_0x5d2a43){console['error'](_0xf8493d(0xb0)),document['getElementById']('login-error')[_0xf8493d(0xaf)]='Please\x20enter\x20your\x20password\x20to\x20resend\x20verification\x20email';return;}const _0x518cd6=await signInWithEmailAndPassword(auth,_0x585638,_0x5d2a43),_0x18d3a5=_0x518cd6['user'];console['log']('User\x20signed\x20in\x20for\x20verification\x20email:',_0x18d3a5['uid']),await sendEmailVerification(_0x18d3a5),console['log'](_0xf8493d(0xb4)),document['getElementById'](_0xf8493d(0xc3))[_0xf8493d(0xd2)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22success-message\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Verification\x20email\x20has\x20been\x20resent\x20to\x20'+_0x585638+'.\x20Please\x20check\x20your\x20inbox.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>',await signOut(auth);}catch(_0x520f0b){console[_0xf8493d(0xd0)]('Error\x20resending\x20verification\x20email:',_0x520f0b),document['getElementById']('login-error')[_0xf8493d(0xaf)]='Error\x20sending\x20verification\x20email:\x20'+_0x520f0b['message'];}}window['resendVerificationEmail']=function(_0x9a7dbf){console['log']('Window.resendVerificationEmail\x20called\x20with:',_0x9a7dbf),resendVerificationEmail(_0x9a7dbf);},document['addEventListener']('DOMContentLoaded',()=>{const _0x51eff0=a36_0x4a0c,_0x4bed2d=document[_0x51eff0(0xb7)]('non-participant'),_0x295291=document['getElementById'](_0x51eff0(0xc7));_0x4bed2d&&_0x295291&&_0x4bed2d[_0x51eff0(0xcb)]('change',function(){const _0x33216a=_0x51eff0;this['checked']?(_0x295291[_0x33216a(0xe1)]='',_0x295291[_0x33216a(0xda)]=!![]):_0x295291['disabled']=![];});const _0x1bdae4=document['getElementById']('register-form'),_0x36aa44=document['getElementById'](_0x51eff0(0xa3));_0x1bdae4&&_0x1bdae4[_0x51eff0(0xcb)](_0x51eff0(0xa7),handleRegister);_0x36aa44&&_0x36aa44['addEventListener']('submit',handleLogin);const _0x558f2a=document[_0x51eff0(0xb7)](_0x51eff0(0xae)),_0x1c1708=document['getElementById']('show-login');_0x558f2a&&_0x558f2a['addEventListener']('click',_0x504421=>{const _0x40933d=_0x51eff0;_0x504421['preventDefault'](),document['getElementById']('login-container')['style']['display']='none',document['getElementById']('register-container')['style'][_0x40933d(0xb6)]='block';}),_0x1c1708&&_0x1c1708['addEventListener'](_0x51eff0(0xb5),_0x59dc30=>{const _0x3db47c=_0x51eff0;_0x59dc30['preventDefault'](),document['getElementById'](_0x3db47c(0xd3))['style']['display']='none',document['getElementById']('login-container')['style'][_0x3db47c(0xb6)]=_0x3db47c(0xc4);});});
const a10_0x586573=a10_0x30a8,a10_0x2ec690=(function(){let _0x3a2059=!![];return function(_0x428883,_0x199a9b){const _0x158c1b=_0x3a2059?function(){if(_0x199a9b){const _0x5d104e=_0x199a9b['apply'](_0x428883,arguments);return _0x199a9b=null,_0x5d104e;}}:function(){};return _0x3a2059=![],_0x158c1b;};}()),a10_0x554eb2=a10_0x2ec690(this,function(){const _0x3b27f1=a10_0x30a8;let _0xa6de19;try{const _0x2e2305=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0xa6de19=_0x2e2305();}catch(_0x126578){_0xa6de19=window;}const _0x3c3bb2=_0xa6de19['console']=_0xa6de19[_0x3b27f1(0x13c)]||{},_0x59bfe6=[_0x3b27f1(0x149),'warn','info','error','exception','table','trace'];for(let _0x46b8b5=0x0;_0x46b8b5<_0x59bfe6[_0x3b27f1(0x14b)];_0x46b8b5++){const _0x13e7da=a10_0x2ec690['constructor'][_0x3b27f1(0x15a)]['bind'](a10_0x2ec690),_0x295643=_0x59bfe6[_0x46b8b5],_0x55940b=_0x3c3bb2[_0x295643]||_0x13e7da;_0x13e7da[_0x3b27f1(0x14d)]=a10_0x2ec690[_0x3b27f1(0x15f)](a10_0x2ec690),_0x13e7da[_0x3b27f1(0x156)]=_0x55940b[_0x3b27f1(0x156)][_0x3b27f1(0x15f)](_0x55940b),_0x3c3bb2[_0x295643]=_0x13e7da;}});a10_0x554eb2();import{getAuth,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{doc,getDoc,collection,query,where,getDocs,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import{isAdmin}from'./admin-check.js';const ADMIN_EMAILS=[a10_0x586573(0x138),a10_0x586573(0x158)],userCache={'uid':null,'username':null,'isAdmin':![],'hasCheckedCollections':![],'lastChecked':0x0,'role':null},invitationCache={'lastCheck':0x0,'pendingCount':0x0,'checkInterval':0x493e0};function updateInboxNotification(_0x4680a6){const _0x1fc89c=a10_0x586573,_0x4b8e9b=document['getElementById']('inbox-notification');_0x4b8e9b&&(_0x4680a6>0x0?(_0x4b8e9b['style']['display']=_0x1fc89c(0x160),_0x4b8e9b[_0x1fc89c(0x143)]=_0x4680a6>0x9?'9+':_0x4680a6):_0x4b8e9b[_0x1fc89c(0x142)][_0x1fc89c(0x148)]='none');}async function checkPendingInvitationsForCurrentUser(_0x492323){const _0xf7c404=a10_0x586573;try{const _0x583bc5=Date['now']();if(_0x583bc5-invitationCache['lastCheck']<invitationCache['checkInterval'])return updateInboxNotification(invitationCache['pendingCount']),invitationCache['pendingCount'];invitationCache['lastCheck']=_0x583bc5;const _0x18426c=collection(db,'gameInvitations'),_0x456872=query(_0x18426c,where(_0xf7c404(0x154),'==',_0x492323),where('status','==','pending'),limit(0x5)),_0x698c5e=await getDocs(_0x456872),_0x23a8d4=_0x698c5e['size'];return invitationCache['pendingCount']=_0x23a8d4,updateInboxNotification(_0x23a8d4),_0x23a8d4;}catch(_0xacf5e){return console['warn'](_0xf7c404(0x159),_0xacf5e),0x0;}}function a10_0x30a8(_0x412775,_0x515bf3){const _0x554eb2=a10_0x2539();return a10_0x30a8=function(_0x2ec690,_0x22d97a){_0x2ec690=_0x2ec690-0x138;let _0x25396c=_0x554eb2[_0x2ec690];return _0x25396c;},a10_0x30a8(_0x412775,_0x515bf3);}function updateAuthSectionImmediate(_0x549e05,_0x524a4c=![]){const _0x50e4ff=a10_0x586573,_0x546198=document['getElementById']('auth-section');if(!_0x546198)return;if(_0x549e05&&_0x524a4c)document['querySelectorAll'](_0x50e4ff(0x150))[_0x50e4ff(0x15c)](_0x321ea9=>{const _0x8ca85=_0x50e4ff;_0x321ea9[_0x8ca85(0x142)]['display']='block';});else!_0x549e05&&document['querySelectorAll'](_0x50e4ff(0x150))['forEach'](_0x2187de=>{_0x2187de['style']['display']='none';});if(_0x549e05){const _0x30e55f=userCache['username']||(_0x549e05[_0x50e4ff(0x14c)]?_0x549e05['email']['split']('@')[0x0]:'User'),_0x4834f9=userCache[_0x50e4ff(0x151)]?'\x20('+userCache['role']+')':_0x524a4c?'\x20(Admin)':'';_0x546198['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20class=\x22nav-username\x22>'+_0x30e55f+_0x4834f9+'</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username='+encodeURIComponent(_0x30e55f)+'\x22>Profile</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./inbox.html\x22\x20class=\x22nav-notification\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Inbox\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22inbox-notification\x22\x20class=\x22notification-dot\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22members.html\x22>Members</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./redeem.html\x22><i\x20class=\x22fas\x20fa-gift\x22></i>Store</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20id=\x22logout-link\x22>Sign\x20Out</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';const _0x2c039d=document['getElementById']('logout-link');_0x2c039d&&_0x2c039d[_0x50e4ff(0x152)]('click',_0x2bc0df=>{_0x2bc0df['preventDefault']();const _0x584358=getAuth();updateAuthSectionImmediate(null),_0x584358['signOut']()['catch'](_0x35ec2b=>{console['error']('Error\x20signing\x20out:',_0x35ec2b);});}),_0x549e05['uid']&&setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0x549e05['uid']);},0x3e8);}else _0x546198['innerHTML']='<a\x20href=\x22login.html\x22\x20class=\x22login-link\x22>Login</a>';}async function checkAdminRoles(_0x504f8a){const _0x31ada3=a10_0x586573;if(!_0x504f8a||!_0x504f8a[_0x31ada3(0x14c)])return{'isAdmin':![],'role':null};try{console['log']('Checking\x20roles\x20for\x20user:\x20'+_0x504f8a[_0x31ada3(0x14c)]);const _0x1dda78=[_0x31ada3(0x157),'playersD2',_0x31ada3(0x15b),_0x31ada3(0x164),'userProfiles'],_0x4e1361=[_0x31ada3(0x13b),_0x31ada3(0x14a),'owner',_0x31ada3(0x147)];for(const _0x1ab86f of _0x1dda78){try{const _0x2043eb=doc(db,_0x1ab86f,_0x504f8a[_0x31ada3(0x162)]),_0x37ee83=await getDoc(_0x2043eb);if(_0x37ee83[_0x31ada3(0x141)]()){const _0x2bce5b=_0x37ee83[_0x31ada3(0x161)]();console['log'](_0x31ada3(0x13e)+_0x1ab86f+'\x20by\x20UID:',_0x2bce5b);let _0x1d9620=(_0x2bce5b['roleName']||_0x2bce5b['role']||'')['toLowerCase'](),_0x3b86eb=_0x2bce5b['roleName']||_0x2bce5b['role']||'';if(_0x1d9620&&_0x4e1361['includes'](_0x1d9620)){console['log'](_0x31ada3(0x165)+_0x1d9620+'\x20in\x20'+_0x1ab86f);const _0x70ca53=_0x3b86eb[_0x31ada3(0x13f)]('\x20')['map'](_0x5d1a6e=>_0x5d1a6e['charAt'](0x0)['toUpperCase']()+_0x5d1a6e['slice'](0x1)['toLowerCase']())[_0x31ada3(0x163)]('\x20');return{'isAdmin':!![],'role':_0x70ca53};}}}catch(_0x2cc767){console['error']('Error\x20checking\x20'+_0x1ab86f+'\x20by\x20UID:',_0x2cc767);}}for(const _0x7b7eef of _0x1dda78){try{const _0x8b4638=collection(db,_0x7b7eef);let _0x46ecb2=query(_0x8b4638,where('email','==',_0x504f8a[_0x31ada3(0x14c)])),_0x457f43=await getDocs(_0x46ecb2);_0x457f43['empty']&&(_0x46ecb2=query(_0x8b4638,where('email','==',_0x504f8a['email'][_0x31ada3(0x139)]())),_0x457f43=await getDocs(_0x46ecb2));if(!_0x457f43['empty']){const _0xdb813=_0x457f43['docs'][0x0]['data']();console[_0x31ada3(0x149)](_0x31ada3(0x13e)+_0x7b7eef+'\x20by\x20email:',_0xdb813);let _0x640229=(_0xdb813['roleName']||_0xdb813['role']||'')[_0x31ada3(0x139)](),_0x1765aa=_0xdb813[_0x31ada3(0x15d)]||_0xdb813[_0x31ada3(0x151)]||'';if(_0x640229&&_0x4e1361['includes'](_0x640229)){console[_0x31ada3(0x149)](_0x31ada3(0x165)+_0x640229+'\x20in\x20'+_0x7b7eef);const _0x30994e=_0x1765aa['split']('\x20')['map'](_0x98263=>_0x98263['charAt'](0x0)[_0x31ada3(0x14e)]()+_0x98263['slice'](0x1)['toLowerCase']())['join']('\x20');return{'isAdmin':!![],'role':_0x30994e};}}}catch(_0x5f3b21){console['error'](_0x31ada3(0x14f)+_0x7b7eef+'\x20by\x20email:',_0x5f3b21);}}return console[_0x31ada3(0x149)](_0x31ada3(0x140)),{'isAdmin':![],'role':null};}catch(_0x14871e){return console['error']('Error\x20in\x20checkAdminRoles:',_0x14871e),{'isAdmin':![],'role':null};}}async function updateAuthSection(_0xde724){const _0x39794a=a10_0x586573,_0x4f8e10=_0xde724&&isAdmin(_0xde724['email']);updateAuthSectionImmediate(_0xde724,_0x4f8e10);if(!_0xde724){userCache[_0x39794a(0x162)]=null,userCache['username']=null,userCache[_0x39794a(0x155)]=![],userCache['hasCheckedCollections']=![],userCache['role']=null;return;}const _0x3f7d88=Date['now']();if(_0xde724[_0x39794a(0x162)]===userCache['uid']&&userCache[_0x39794a(0x13a)]&&_0x3f7d88-userCache['lastChecked']<0x493e0)return;try{userCache['uid']=_0xde724['uid'],userCache['lastChecked']=_0x3f7d88;const _0x9ce7d=isAdmin(_0xde724[_0x39794a(0x14c)]);userCache['isAdmin']=_0x9ce7d;if(!_0x9ce7d){const {isAdmin:_0x377359,role:_0x395088}=await checkAdminRoles(_0xde724);userCache['isAdmin']=_0x377359,userCache['role']=_0x395088,_0x377359&&(document[_0x39794a(0x15e)](_0x39794a(0x150))['forEach'](_0x1f753a=>{const _0x2300fc=_0x39794a;_0x1f753a[_0x2300fc(0x142)]['display']='block';}),updateAuthSectionImmediate(_0xde724,!![]));}const _0x36c214=[_0x39794a(0x157),'playersD2',_0x39794a(0x15b),'playersDuos','playersCTF','nonParticipants',_0x39794a(0x144)],_0x42e3e9=_0x36c214['map'](_0x2a5396=>getDoc(doc(db,_0x2a5396,_0xde724['uid']))['then'](_0x239e6c=>_0x239e6c[_0x39794a(0x141)]()?{'collection':_0x2a5396,'data':_0x239e6c['data']()}:null)['catch'](()=>null)),_0x16c4ad=await Promise['all'](_0x42e3e9),_0x1bbb75=_0x16c4ad[_0x39794a(0x153)](_0x40fb69=>_0x40fb69!==null);let _0x3921fd=null;for(const _0x27ca19 of _0x1bbb75){if(_0x27ca19['data']['username']){_0x3921fd=_0x27ca19['data']['username'];break;}}userCache['username']=_0x3921fd||(_0xde724['email']?_0xde724['email']['split']('@')[0x0]:_0x39794a(0x145)),userCache['hasCheckedCollections']=!![],updateAuthSectionImmediate(_0xde724,userCache['isAdmin']),setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0xde724['uid']);},0x1f4);}catch(_0x595953){console['error']('Error\x20in\x20full\x20auth\x20update:',_0x595953);}}function a10_0x2539(){const _0x33d51a=['admin@ladder.com','toLowerCase','hasCheckedCollections','council','console','DOMContentLoaded','Found\x20user\x20in\x20','split','No\x20admin\x20roles\x20found\x20for\x20user','exists','style','textContent','userProfiles','User','currentUser','admin','display','log','creative\x20lead','length','email','__proto__','toUpperCase','Error\x20checking\x20','.admin-only','role','addEventListener','filter','toUserId','isAdmin','toString','players','Brian2af@outlook.com','Could\x20not\x20check\x20pending\x20invitations\x20for\x20current\x20user:','prototype','playersD3','forEach','roleName','querySelectorAll','bind','inline-block','data','uid','join','nonParticipants','Found\x20admin\x20role:\x20'];a10_0x2539=function(){return _0x33d51a;};return a10_0x2539();}document['addEventListener'](a10_0x586573(0x13d),()=>{const _0x5d1b98=getAuth();onAuthStateChanged(_0x5d1b98,async _0x300123=>{await updateAuthSection(_0x300123),_0x300123&&checkPendingInvitationsForCurrentUser(_0x300123['uid']);}),document['addEventListener']('visibilitychange',()=>{const _0x98860b=a10_0x30a8;!document['hidden']&&_0x5d1b98['currentUser']&&checkPendingInvitationsForCurrentUser(_0x5d1b98[_0x98860b(0x146)]['uid']);}),document['addEventListener']('click',_0x5e62dd=>{_0x5e62dd['target']['closest']('a[href]')&&_0x5d1b98['currentUser']&&checkPendingInvitationsForCurrentUser(_0x5d1b98['currentUser']['uid']);});});export{updateAuthSection};
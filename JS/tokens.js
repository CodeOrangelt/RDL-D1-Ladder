function a58_0x2fea(){const _0x471d02=['error','exception','{}.constructor(\x22return\x20this\x22)(\x20)','string','warn','username','Error\x20fetching\x20bulk\x20user\x20tokens:','getTime','tokens_','apply','console','length','tokens','data','now','bind','Error\x20fetching\x20user\x20tokens:','equipped','set','toString','seconds','purchasedAt'];a58_0x2fea=function(){return _0x471d02;};return a58_0x2fea();}const a58_0x11e677=(function(){let _0x250f84=!![];return function(_0x307050,_0x1643a3){const _0x24f05c=_0x250f84?function(){const _0xca7b11=a58_0x20dc;if(_0x1643a3){const _0x563f5d=_0x1643a3[_0xca7b11(0x101)](_0x307050,arguments);return _0x1643a3=null,_0x563f5d;}}:function(){};return _0x250f84=![],_0x24f05c;};}()),a58_0x1e31be=a58_0x11e677(this,function(){const _0x1f02dc=a58_0x20dc,_0x250d15=function(){const _0x3bbed=a58_0x20dc;let _0x3eae35;try{_0x3eae35=Function('return\x20(function()\x20'+_0x3bbed(0xfa)+');')();}catch(_0x253daa){_0x3eae35=window;}return _0x3eae35;},_0x45c205=_0x250d15(),_0x186f78=_0x45c205['console']=_0x45c205[_0x1f02dc(0x102)]||{},_0x30cba4=['log',_0x1f02dc(0xfc),'info','error',_0x1f02dc(0xf9),'table','trace'];for(let _0x45ca2a=0x0;_0x45ca2a<_0x30cba4['length'];_0x45ca2a++){const _0x299043=a58_0x11e677['constructor']['prototype']['bind'](a58_0x11e677),_0x1e4d8d=_0x30cba4[_0x45ca2a],_0x50263a=_0x186f78[_0x1e4d8d]||_0x299043;_0x299043['__proto__']=a58_0x11e677[_0x1f02dc(0x107)](a58_0x11e677),_0x299043['toString']=_0x50263a[_0x1f02dc(0x10b)]['bind'](_0x50263a),_0x186f78[_0x1e4d8d]=_0x299043;}});a58_0x1e31be();import{doc,getDoc,getDocs,collection}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const tokenCache=new Map(),CACHE_DURATION=0x5*0x3c*0x3e8;export async function getUserTokens(_0x141698){const _0x2d0722=a58_0x20dc,_0x289084=_0x2d0722(0x100)+_0x141698,_0x5740ff=tokenCache['get'](_0x289084);if(_0x5740ff&&Date[_0x2d0722(0x106)]()-_0x5740ff['timestamp']<CACHE_DURATION)return _0x5740ff['tokens'];try{const _0x353721=doc(db,'userTokens',_0x141698),_0x2c49c9=await getDoc(_0x353721);let _0x18333c=[];return _0x2c49c9['exists']()&&(_0x18333c=_0x2c49c9[_0x2d0722(0x105)]()[_0x2d0722(0x104)]||[]),tokenCache['set'](_0x289084,{'tokens':_0x18333c,'timestamp':Date[_0x2d0722(0x106)]()}),_0x18333c;}catch(_0x38c5a3){return console['error'](_0x2d0722(0x108),_0x38c5a3),[];}}function a58_0x20dc(_0x25ae53,_0x22ab18){const _0x1e31be=a58_0x2fea();return a58_0x20dc=function(_0x11e677,_0x56bbc2){_0x11e677=_0x11e677-0xf8;let _0x2fea8b=_0x1e31be[_0x11e677];return _0x2fea8b;},a58_0x20dc(_0x25ae53,_0x22ab18);}export async function getBulkUserTokens(_0x9431d9){const _0x3b5f27=a58_0x20dc,_0x2fdbc7=new Map(),_0x187afa=[];_0x9431d9['forEach'](_0x12a69d=>{const _0x4a21a2=a58_0x20dc,_0x2c58aa='tokens_'+_0x12a69d,_0x32dcc4=tokenCache['get'](_0x2c58aa);_0x32dcc4&&Date[_0x4a21a2(0x106)]()-_0x32dcc4['timestamp']<CACHE_DURATION?_0x2fdbc7['set'](_0x12a69d,_0x32dcc4['tokens']):_0x187afa['push'](_0x12a69d);});if(_0x187afa[_0x3b5f27(0x103)]>0x0)try{const _0x17399a=_0x187afa['map'](async _0x49c395=>{const _0x59462b=_0x3b5f27,_0x3634c0=doc(db,'userTokens',_0x49c395),_0x2b7f56=await getDoc(_0x3634c0);let _0x1e5c62=[];_0x2b7f56['exists']()&&(_0x1e5c62=_0x2b7f56['data']()[_0x59462b(0x104)]||[]);const _0x2311a8='tokens_'+_0x49c395;return tokenCache[_0x59462b(0x10a)](_0x2311a8,{'tokens':_0x1e5c62,'timestamp':Date['now']()}),[_0x49c395,_0x1e5c62];}),_0x402b41=await Promise['all'](_0x17399a);_0x402b41['forEach'](([_0x51dc8f,_0x5a1f49])=>{_0x2fdbc7['set'](_0x51dc8f,_0x5a1f49);});}catch(_0x2e2cdf){console[_0x3b5f27(0xf8)](_0x3b5f27(0xfe),_0x2e2cdf);}return _0x2fdbc7;}export async function getTokensByUsernames(_0x7e5ced){const _0x271db4=a58_0x20dc,_0x42d326=new Map();try{const _0xdc39b6=collection(db,'userProfiles'),_0x5e8291=await getDocs(_0xdc39b6),_0x4decca=new Map();_0x5e8291['forEach'](_0x334494=>{const _0x25e68d=a58_0x20dc,_0x21bb9f=_0x334494[_0x25e68d(0x105)]();_0x21bb9f[_0x25e68d(0xfd)]&&_0x7e5ced['includes'](_0x21bb9f[_0x25e68d(0xfd)])&&_0x4decca['set'](_0x21bb9f['username'],_0x334494['id']);});const _0x521e09=Array['from'](_0x4decca['values']());if(_0x521e09['length']>0x0){const _0xeefd13=await getBulkUserTokens(_0x521e09);_0x4decca['forEach']((_0x3612b0,_0x3fc5ed)=>{const _0x2042cb=_0xeefd13['get'](_0x3612b0)||[];_0x42d326['set'](_0x3fc5ed,_0x2042cb);});}}catch(_0x2d3934){console[_0x271db4(0xf8)]('Error\x20fetching\x20tokens\x20by\x20usernames:',_0x2d3934);}return _0x42d326;}export function clearTokenCache(_0x3a4650=null){if(_0x3a4650){const _0x2a14c2='tokens_'+_0x3a4650;tokenCache['delete'](_0x2a14c2),console['log']('ðŸ—‘ï¸\x20Cleared\x20token\x20cache\x20for\x20user:\x20'+_0x3a4650);}else tokenCache['clear'](),console['log']('ðŸ—‘ï¸\x20Cleared\x20all\x20token\x20cache');}export async function forceRefreshUserTokens(_0xa68841){return clearTokenCache(_0xa68841),await getUserTokens(_0xa68841);}export function getPrimaryDisplayToken(_0x166033){const _0x48af53=a58_0x20dc;if(!_0x166033||_0x166033['length']===0x0)return null;const _0x416b5e=_0x166033['find'](_0x37a5bb=>_0x37a5bb[_0x48af53(0x109)]===!![]);if(_0x416b5e)return _0x416b5e;const _0x4960ba=[..._0x166033]['sort']((_0x4b2daa,_0x5b25d2)=>{const _0x4f416a=_0x48af53;let _0x1007bf,_0x5db75e;if(_0x4b2daa[_0x4f416a(0x10d)]){if(_0x4b2daa['purchasedAt'][_0x4f416a(0x10c)])_0x1007bf=_0x4b2daa['purchasedAt']['seconds'];else{if(_0x4b2daa['purchasedAt']instanceof Date)_0x1007bf=_0x4b2daa['purchasedAt'][_0x4f416a(0xff)]()/0x3e8;else typeof _0x4b2daa['purchasedAt']==='string'?_0x1007bf=new Date(_0x4b2daa['purchasedAt'])['getTime']()/0x3e8:_0x1007bf=0x0;}}else _0x1007bf=0x0;if(_0x5b25d2['purchasedAt']){if(_0x5b25d2[_0x4f416a(0x10d)]['seconds'])_0x5db75e=_0x5b25d2['purchasedAt'][_0x4f416a(0x10c)];else{if(_0x5b25d2['purchasedAt']instanceof Date)_0x5db75e=_0x5b25d2['purchasedAt']['getTime']()/0x3e8;else typeof _0x5b25d2[_0x4f416a(0x10d)]===_0x4f416a(0xfb)?_0x5db75e=new Date(_0x5b25d2['purchasedAt'])['getTime']()/0x3e8:_0x5db75e=0x0;}}else _0x5db75e=0x0;return _0x5db75e-_0x1007bf;});return _0x4960ba[0x0];}
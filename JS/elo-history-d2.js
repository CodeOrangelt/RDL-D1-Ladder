const a14_0x2ab3b0=a14_0x3344,a14_0x21253a=(function(){let _0xb248ba=!![];return function(_0x455aa0,_0x162cea){const _0x3108c2=_0xb248ba?function(){if(_0x162cea){const _0x2f1acf=_0x162cea['apply'](_0x455aa0,arguments);return _0x162cea=null,_0x2f1acf;}}:function(){};return _0xb248ba=![],_0x3108c2;};}()),a14_0x57e253=a14_0x21253a(this,function(){const _0x49b462=a14_0x3344;let _0x19fc6a;try{const _0x3823ea=Function(_0x49b462(0xf1)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x19fc6a=_0x3823ea();}catch(_0x44f797){_0x19fc6a=window;}const _0x3812a6=_0x19fc6a[_0x49b462(0xfc)]=_0x19fc6a[_0x49b462(0xfc)]||{},_0x1b2b4f=[_0x49b462(0xe9),'warn','info','error','exception','table',_0x49b462(0xfe)];for(let _0x46e8c1=0x0;_0x46e8c1<_0x1b2b4f['length'];_0x46e8c1++){const _0x502f2f=a14_0x21253a['constructor'][_0x49b462(0xea)]['bind'](a14_0x21253a),_0x8128bd=_0x1b2b4f[_0x46e8c1],_0xb09dc3=_0x3812a6[_0x8128bd]||_0x502f2f;_0x502f2f['__proto__']=a14_0x21253a['bind'](a14_0x21253a),_0x502f2f[_0x49b462(0xec)]=_0xb09dc3['toString'][_0x49b462(0xed)](_0xb09dc3),_0x3812a6[_0x8128bd]=_0x502f2f;}});a14_0x57e253();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';function a14_0x24c5(){const _0x23ebb0=['desc','Bronze','previousElo','Gold','log','prototype','size','toString','bind','winnerUsername','timestamp','data','return\x20(function()\x20','opponent','approvedMatchesD2','Unranked','username','Unknown\x20Player','loserId','docs','demotion','match','error','console','map','trace'];a14_0x24c5=function(){return _0x23ebb0;};return a14_0x24c5();}const ELO_THRESHOLDS_D2=[{'name':a14_0x2ab3b0(0xe8),'elo':0x708},{'name':'Silver','elo':0x640},{'name':a14_0x2ab3b0(0xe6),'elo':0x578},{'name':a14_0x2ab3b0(0xf4),'elo':0x4b0}];let lastVisibleD2=null;async function getUsernameByIdD2(_0x3af408){const _0x33ec0d=a14_0x2ab3b0;try{if(!_0x3af408)return'Unknown\x20Player';const _0x1f7216=await getDoc(doc(db,'playersD2',_0x3af408));if(_0x1f7216['exists']())return _0x1f7216[_0x33ec0d(0xf0)]()[_0x33ec0d(0xf5)]||'Unknown\x20Player';const _0x4c3dc8=await getDocs(query(collection(db,_0x33ec0d(0xf3)),where('winnerId','==',_0x3af408),limit(0x1)));if(!_0x4c3dc8['empty'])return _0x4c3dc8['docs'][0x0][_0x33ec0d(0xf0)]()[_0x33ec0d(0xee)]||_0x33ec0d(0xf6);const _0x200646=await getDocs(query(collection(db,'approvedMatchesD2'),where(_0x33ec0d(0xf7),'==',_0x3af408),limit(0x1)));if(!_0x200646['empty'])return _0x200646[_0x33ec0d(0xf8)][0x0][_0x33ec0d(0xf0)]()['loserUsername']||'Unknown\x20Player';return'Unknown\x20Player';}catch(_0x449928){return console[_0x33ec0d(0xfb)]('Error\x20getting\x20username:',_0x449928),'Unknown\x20Player';}}export async function recordEloChangeD2({playerId:_0x163f62,previousElo:_0x578f34,newElo:_0x3f9d90,opponentId:_0x37a471,matchResult:_0x50be48,previousPosition:_0x4e226c,newPosition:_0x4a09a5,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x498c9e,timestamp:_0x5b17a8}){const _0xa0aa67=a14_0x2ab3b0;try{const _0x12b65a=doc(collection(db,'eloHistoryD2'));let _0x6ed680=_0xa0aa67(0xfa);if(isPromotion)_0x6ed680='promotion';if(isDemotion)_0x6ed680=_0xa0aa67(0xf9);let _0x2b8e7a=_0xa0aa67(0xf4);if(_0x3f9d90>=0x834)_0x2b8e7a='Emerald';else{if(_0x3f9d90>=0x708)_0x2b8e7a=_0xa0aa67(0xe8);else{if(_0x3f9d90>=0x640)_0x2b8e7a='Silver';else{if(_0x3f9d90>=0x578)_0x2b8e7a='Bronze';}}}return await setDoc(_0x12b65a,{'type':_0x6ed680,'player':_0x163f62,'opponent':_0x37a471,'previousElo':_0x578f34,'newElo':_0x3f9d90,'change':_0x3f9d90-_0x578f34,'matchResult':_0x50be48,'previousPosition':_0x4e226c,'newPosition':_0x4a09a5,'rankAchieved':_0x2b8e7a,'matchId':_0x498c9e,'timestamp':_0x5b17a8}),console['log']('D2\x20ELO\x20history\x20recorded\x20for\x20'+_0x163f62),!![];}catch(_0x1eb138){console['error']('Error\x20recording\x20D2\x20ELO\x20history:',_0x1eb138);throw _0x1eb138;}}function a14_0x3344(_0x44143,_0x32c3a6){const _0x57e253=a14_0x24c5();return a14_0x3344=function(_0x21253a,_0x2cddd0){_0x21253a=_0x21253a-0xe5;let _0x24c50f=_0x57e253[_0x21253a];return _0x24c50f;},a14_0x3344(_0x44143,_0x32c3a6);}export async function getEloHistoryD2(_0x133f77=0x14){const _0x42a9be=a14_0x2ab3b0;try{const _0x85f157=collection(db,'eloHistoryD2');let _0x2d6d11;lastVisibleD2?_0x2d6d11=query(_0x85f157,orderBy('timestamp','desc'),startAfter(lastVisibleD2),limit(_0x133f77)):_0x2d6d11=query(_0x85f157,orderBy(_0x42a9be(0xef),_0x42a9be(0xe5)),limit(_0x133f77));const _0x370f7c=await getDocs(_0x2d6d11);if(_0x370f7c['empty'])return{'entries':[],'hasMore':![]};lastVisibleD2=_0x370f7c['docs'][_0x370f7c['docs']['length']-0x1];const _0x3c3464=_0x370f7c['docs'][_0x42a9be(0xfd)](async _0x423e41=>{const _0x163330=_0x42a9be,_0x15ba26=_0x423e41[_0x163330(0xf0)](),[_0x37f03f,_0x580e5f]=await Promise['all']([getUsernameByIdD2(_0x15ba26['player']),getUsernameByIdD2(_0x15ba26[_0x163330(0xf2)])]);return{..._0x15ba26,'playerUsername':_0x37f03f,'opponentUsername':_0x580e5f,'change':_0x15ba26['newElo']-_0x15ba26[_0x163330(0xe7)],'timestamp':_0x15ba26['timestamp']};}),_0x1eee80=await Promise['all'](_0x3c3464);return{'entries':_0x1eee80,'hasMore':_0x370f7c[_0x42a9be(0xeb)]===_0x133f77};}catch(_0xd411c7){console[_0x42a9be(0xfb)]('Error\x20fetching\x20D2\x20ELO\x20history:',_0xd411c7);throw _0xd411c7;}}export function resetPaginationD2(){lastVisibleD2=null;}
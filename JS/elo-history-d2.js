const a14_0x591a79=a14_0x2b40,a14_0x5b300f=(function(){let _0x1b011b=!![];return function(_0x5e694d,_0x2e75c2){const _0x50a378=_0x1b011b?function(){if(_0x2e75c2){const _0x35020b=_0x2e75c2['apply'](_0x5e694d,arguments);return _0x2e75c2=null,_0x35020b;}}:function(){};return _0x1b011b=![],_0x50a378;};}()),a14_0x3c8a7c=a14_0x5b300f(this,function(){const _0x4ef277=a14_0x2b40;let _0x3467b6;try{const _0x4d4318=Function('return\x20(function()\x20'+_0x4ef277(0xb0)+');');_0x3467b6=_0x4d4318();}catch(_0x1333b3){_0x3467b6=window;}const _0x3958d2=_0x3467b6['console']=_0x3467b6['console']||{},_0xabfad5=['log',_0x4ef277(0xa2),'info','error',_0x4ef277(0xa9),'table','trace'];for(let _0x4fa1de=0x0;_0x4fa1de<_0xabfad5['length'];_0x4fa1de++){const _0xe5c80e=a14_0x5b300f['constructor']['prototype']['bind'](a14_0x5b300f),_0x1884a9=_0xabfad5[_0x4fa1de],_0x4a7d2b=_0x3958d2[_0x1884a9]||_0xe5c80e;_0xe5c80e['__proto__']=a14_0x5b300f['bind'](a14_0x5b300f),_0xe5c80e['toString']=_0x4a7d2b['toString']['bind'](_0x4a7d2b),_0x3958d2[_0x1884a9]=_0xe5c80e;}});function a14_0x2b40(_0x4edf86,_0x2d56de){const _0x3c8a7c=a14_0x27d6();return a14_0x2b40=function(_0x5b300f,_0x11aa2a){_0x5b300f=_0x5b300f-0xa1;let _0x27d644=_0x3c8a7c[_0x5b300f];return _0x27d644;},a14_0x2b40(_0x4edf86,_0x2d56de);}a14_0x3c8a7c();function a14_0x27d6(){const _0x1839cb=['newElo','warn','timestamp','Error\x20fetching\x20D2\x20ELO\x20history:','winnerUsername','match','Error\x20getting\x20username:','data','exception','length','playersD2','winnerId','error','loserUsername','Error\x20recording\x20D2\x20ELO\x20history:','{}.constructor(\x22return\x20this\x22)(\x20)','empty','Unknown\x20Player','loserId','Gold','log','desc','eloHistoryD2','Bronze'];a14_0x27d6=function(){return _0x1839cb;};return a14_0x27d6();}import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D2=[{'name':'Gold','elo':0x708},{'name':'Silver','elo':0x640},{'name':a14_0x591a79(0xb8),'elo':0x578},{'name':'Unranked','elo':0x4b0}];let lastVisibleD2=null;async function getUsernameByIdD2(_0x50af95){const _0x428f35=a14_0x591a79;try{if(!_0x50af95)return'Unknown\x20Player';const _0x5ad5bb=await getDoc(doc(db,_0x428f35(0xab),_0x50af95));if(_0x5ad5bb['exists']())return _0x5ad5bb[_0x428f35(0xa8)]()['username']||'Unknown\x20Player';const _0x155dcf=await getDocs(query(collection(db,'approvedMatchesD2'),where(_0x428f35(0xac),'==',_0x50af95),limit(0x1)));if(!_0x155dcf['empty'])return _0x155dcf['docs'][0x0][_0x428f35(0xa8)]()[_0x428f35(0xa5)]||_0x428f35(0xb2);const _0x5c0f83=await getDocs(query(collection(db,'approvedMatchesD2'),where(_0x428f35(0xb3),'==',_0x50af95),limit(0x1)));if(!_0x5c0f83[_0x428f35(0xb1)])return _0x5c0f83['docs'][0x0]['data']()[_0x428f35(0xae)]||'Unknown\x20Player';return'Unknown\x20Player';}catch(_0x1b4c8e){return console[_0x428f35(0xad)](_0x428f35(0xa7),_0x1b4c8e),'Unknown\x20Player';}}export async function recordEloChangeD2({playerId:_0x381daa,previousElo:_0x4fd15c,newElo:_0x2d05d6,opponentId:_0x2b2b36,matchResult:_0x42766a,previousPosition:_0x779392,newPosition:_0x1197c0,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x400fe6,timestamp:_0x15f840}){const _0x5b8138=a14_0x591a79;try{const _0x15d1f7=doc(collection(db,_0x5b8138(0xb7)));let _0x5df17c=_0x5b8138(0xa6);if(isPromotion)_0x5df17c='promotion';if(isDemotion)_0x5df17c='demotion';let _0x1e9f8c='Unranked';if(_0x2d05d6>=0x834)_0x1e9f8c='Emerald';else{if(_0x2d05d6>=0x708)_0x1e9f8c=_0x5b8138(0xb4);else{if(_0x2d05d6>=0x640)_0x1e9f8c='Silver';else{if(_0x2d05d6>=0x578)_0x1e9f8c='Bronze';}}}return await setDoc(_0x15d1f7,{'type':_0x5df17c,'player':_0x381daa,'opponent':_0x2b2b36,'previousElo':_0x4fd15c,'newElo':_0x2d05d6,'change':_0x2d05d6-_0x4fd15c,'matchResult':_0x42766a,'previousPosition':_0x779392,'newPosition':_0x1197c0,'rankAchieved':_0x1e9f8c,'matchId':_0x400fe6,'timestamp':_0x15f840}),console[_0x5b8138(0xb5)]('D2\x20ELO\x20history\x20recorded\x20for\x20'+_0x381daa),!![];}catch(_0x134e6b){console[_0x5b8138(0xad)](_0x5b8138(0xaf),_0x134e6b);throw _0x134e6b;}}export async function getEloHistoryD2(_0x2d6eec=0x14){const _0x2f2277=a14_0x591a79;try{const _0x1a95c3=collection(db,_0x2f2277(0xb7));let _0xbb4951;lastVisibleD2?_0xbb4951=query(_0x1a95c3,orderBy('timestamp','desc'),startAfter(lastVisibleD2),limit(_0x2d6eec)):_0xbb4951=query(_0x1a95c3,orderBy(_0x2f2277(0xa3),_0x2f2277(0xb6)),limit(_0x2d6eec));const _0x5057e4=await getDocs(_0xbb4951);if(_0x5057e4['empty'])return{'entries':[],'hasMore':![]};lastVisibleD2=_0x5057e4['docs'][_0x5057e4['docs'][_0x2f2277(0xaa)]-0x1];const _0x18679d=_0x5057e4['docs']['map'](async _0x5d1a9e=>{const _0xfc3fb3=_0x2f2277,_0xfc3690=_0x5d1a9e[_0xfc3fb3(0xa8)](),[_0x222abc,_0x534016]=await Promise['all']([getUsernameByIdD2(_0xfc3690['player']),getUsernameByIdD2(_0xfc3690['opponent'])]);return{..._0xfc3690,'playerUsername':_0x222abc,'opponentUsername':_0x534016,'change':_0xfc3690[_0xfc3fb3(0xa1)]-_0xfc3690['previousElo'],'timestamp':_0xfc3690[_0xfc3fb3(0xa3)]};}),_0xcc5610=await Promise['all'](_0x18679d);return{'entries':_0xcc5610,'hasMore':_0x5057e4['size']===_0x2d6eec};}catch(_0x8ebdbf){console['error'](_0x2f2277(0xa4),_0x8ebdbf);throw _0x8ebdbf;}}export function resetPaginationD2(){lastVisibleD2=null;}
const a50_0xac7891=(function(){let _0x55ba1b=!![];return function(_0x5050de,_0x2286cc){const _0x3094e0=_0x55ba1b?function(){const _0x34e0c3=a50_0x2303;if(_0x2286cc){const _0x541b38=_0x2286cc[_0x34e0c3(0x177)](_0x5050de,arguments);return _0x2286cc=null,_0x541b38;}}:function(){};return _0x55ba1b=![],_0x3094e0;};}()),a50_0x47aee6=a50_0xac7891(this,function(){const _0x20eeed=a50_0x2303,_0x3623fa=function(){let _0x4a5e2e;try{_0x4a5e2e=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x2b74e0){_0x4a5e2e=window;}return _0x4a5e2e;},_0x36a33c=_0x3623fa(),_0x5286d8=_0x36a33c['console']=_0x36a33c['console']||{},_0x3adf45=[_0x20eeed(0x168),'warn',_0x20eeed(0x173),'error',_0x20eeed(0x172),'table','trace'];for(let _0x2b7838=0x0;_0x2b7838<_0x3adf45['length'];_0x2b7838++){const _0x16bdeb=a50_0xac7891[_0x20eeed(0x16b)]['prototype']['bind'](a50_0xac7891),_0x40ecfc=_0x3adf45[_0x2b7838],_0x39f6d7=_0x5286d8[_0x40ecfc]||_0x16bdeb;_0x16bdeb['__proto__']=a50_0xac7891['bind'](a50_0xac7891),_0x16bdeb['toString']=_0x39f6d7[_0x20eeed(0x176)]['bind'](_0x39f6d7),_0x5286d8[_0x40ecfc]=_0x16bdeb;}});a50_0x47aee6();import{db}from'../firebase-config.js';import{collection,doc,getDoc,getDocs,query,limit,startAfter,where,onSnapshot}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a50_0x5b2d(){const _0xd4f54f=['map','get','doc','log','error','includes','constructor','now','players','forEach','timestamp','set','data','exception','info','length','ladderPlayers','toString','apply','playersD','docs','eloHistory','username'];a50_0x5b2d=function(){return _0xd4f54f;};return a50_0x5b2d();}const cache={'userProfiles':new Map(),'ladderPlayers':new Map(),'matchResults':new Map(),'eloHistory':new Map()},CACHE_EXPIRY={'userProfiles':0x5*0x3c*0x3e8,'ladderPlayers':0x2*0x3c*0x3e8,'matchResults':0x1*0x3c*0x3e8,'eloHistory':0x3*0x3c*0x3e8};export const userProfilesRef=collection(db,'userProfiles');export async function fetchPaginatedData(_0x570299,_0x254f78=0xa,_0x355e62=null){const _0x4d48f8=a50_0x2303;let _0x882b69=query(_0x570299,limit(_0x254f78));_0x355e62&&(_0x882b69=query(_0x882b69,startAfter(_0x355e62)));const _0x1d1568=await getDocs(_0x882b69),_0x51d950=_0x1d1568['docs'][_0x1d1568['docs'][_0x4d48f8(0x174)]-0x1];return{'data':_0x1d1568['docs'][_0x4d48f8(0x165)](_0x5bdc9a=>({'id':_0x5bdc9a['id'],..._0x5bdc9a['data']()})),'lastVisible':_0x51d950,'hasMore':_0x1d1568[_0x4d48f8(0x179)]['length']===_0x254f78};}export async function getUserProfile(_0x3a1fcc){const _0x1e4b59=a50_0x2303,_0x23b45a=cache['userProfiles']['get'](_0x3a1fcc);if(_0x23b45a&&Date['now']()-_0x23b45a[_0x1e4b59(0x16f)]<CACHE_EXPIRY['userProfiles'])return _0x23b45a['data'];const _0x41a7ed=await getDoc(doc(userProfilesRef,_0x3a1fcc));if(_0x41a7ed['exists']()){const _0x21b277=_0x41a7ed['data']();return cache['userProfiles'][_0x1e4b59(0x170)](_0x3a1fcc,{'data':_0x21b277,'timestamp':Date[_0x1e4b59(0x16c)]()}),_0x21b277;}return null;}export async function getLadderData(_0x12d84c=0x1){const _0x15fff2=a50_0x2303,_0x201e0e='division_'+_0x12d84c,_0x2299fe=cache['ladderPlayers']['get'](_0x201e0e);if(_0x2299fe&&Date['now']()-_0x2299fe[_0x15fff2(0x16f)]<CACHE_EXPIRY[_0x15fff2(0x175)])return _0x2299fe['data'];const _0x28dd2c=_0x12d84c===0x1?_0x15fff2(0x16d):_0x15fff2(0x178)+_0x12d84c,_0x12bc55=collection(db,_0x28dd2c),_0x468278=await getDocs(query(_0x12bc55,limit(0x64))),_0x49aeb9=_0x468278['docs']['map'](_0xdf1635=>({'id':_0xdf1635['id'],..._0xdf1635[_0x15fff2(0x171)]()}));return cache['ladderPlayers']['set'](_0x201e0e,{'data':_0x49aeb9,'timestamp':Date['now']()}),_0x49aeb9;}export async function getEloHistoryBatch(_0x32a838,_0x193626=0x1){const _0x4cff30=a50_0x2303,_0x58c30a=_0x193626===0x1?'eloHistory':'eloHistoryD'+_0x193626,_0x4c3881=collection(db,_0x58c30a),_0x2654ce={},_0x39eb34=[];_0x32a838['forEach'](_0x573a0b=>{const _0x25ad2d=a50_0x2303,_0x34eba5=_0x573a0b+'_'+_0x193626,_0x426387=cache[_0x25ad2d(0x17a)][_0x25ad2d(0x166)](_0x34eba5);_0x426387&&Date['now']()-_0x426387['timestamp']<CACHE_EXPIRY['eloHistory']?_0x2654ce[_0x573a0b]=_0x426387[_0x25ad2d(0x171)]:_0x39eb34['push'](_0x573a0b);});const _0x1de02f=0xa;for(let _0x14d211=0x0;_0x14d211<_0x39eb34['length'];_0x14d211+=_0x1de02f){const _0x356d4c=_0x39eb34['slice'](_0x14d211,_0x14d211+_0x1de02f);if(_0x356d4c['length']>0x0)try{const _0x1a09ee=query(_0x4c3881,where('playerId','in',_0x356d4c),limit(0x64)),_0x578d9f=await getDocs(_0x1a09ee);_0x578d9f['docs']['forEach'](_0x5eb89e=>{const _0x41be7e=a50_0x2303,_0x1631ca=_0x5eb89e['data'](),_0x114fde=_0x1631ca['playerId'];if(!_0x2654ce[_0x114fde])_0x2654ce[_0x114fde]=[];_0x2654ce[_0x114fde]['push'](_0x1631ca);const _0x57891b=_0x114fde+'_'+_0x193626;cache['eloHistory'][_0x41be7e(0x170)](_0x57891b,{'data':_0x2654ce[_0x114fde],'timestamp':Date[_0x41be7e(0x16c)]()});});}catch(_0x350de8){console[_0x4cff30(0x169)]('Error\x20fetching\x20batch\x20ELO\x20history:',_0x350de8);}}return _0x2654ce;}let usernameCache=new Map(),usernameCacheTimestamp=Date['now']();export function setupEfficientListener(_0x2d1909,_0x490f96=[],_0x3ec42b){const _0x4b9c6a=collection(db,_0x2d1909),_0x506bb5=query(_0x4b9c6a,..._0x490f96),_0x57c23f=onSnapshot(_0x506bb5,_0x39232b=>{const _0x21cd12=a50_0x2303,_0x38cb70=_0x39232b['docChanges']()[_0x21cd12(0x165)](_0x5a3d1c=>({'type':_0x5a3d1c['type'],'id':_0x5a3d1c[_0x21cd12(0x167)]['id'],'data':_0x5a3d1c['doc']['data']()}));_0x38cb70[_0x21cd12(0x174)]>0x0&&_0x3ec42b(_0x38cb70,_0x39232b['docs']);});return _0x57c23f;}function a50_0x2303(_0x1e167c,_0x34986e){const _0x47aee6=a50_0x5b2d();return a50_0x2303=function(_0xac7891,_0x42bd95){_0xac7891=_0xac7891-0x165;let _0x5b2d9b=_0x47aee6[_0xac7891];return _0x5b2d9b;},a50_0x2303(_0x1e167c,_0x34986e);}export async function bulkResolveUsernames(_0x53e21c){const _0x2339cf=a50_0x2303,_0xc7cae4=new Map();if(!_0x53e21c||_0x53e21c['length']===0x0)return _0xc7cae4;const _0x35248c=[_0x2339cf(0x16d),'playersD2','playersD3','nonParticipants'];for(const _0x245f46 of _0x35248c){const _0x1ce084=collection(db,_0x245f46),_0x36558c=await getDocs(_0x1ce084);_0x36558c[_0x2339cf(0x16e)](_0x6372bb=>{const _0x56e312=_0x2339cf,_0x1ca19e=_0x6372bb['data']();_0x1ca19e[_0x56e312(0x17b)]&&_0x53e21c[_0x56e312(0x16a)](_0x6372bb['id'])&&_0xc7cae4['set'](_0x6372bb['id'],_0x1ca19e[_0x56e312(0x17b)]);});}return _0xc7cae4;}
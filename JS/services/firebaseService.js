const a56_0x4a83a5=(function(){let _0x4179eb=!![];return function(_0x124c16,_0x4d083f){const _0x1abb7f=_0x4179eb?function(){const _0x20987e=a56_0x3ee4;if(_0x4d083f){const _0x45f9b4=_0x4d083f[_0x20987e(0x1d3)](_0x124c16,arguments);return _0x4d083f=null,_0x45f9b4;}}:function(){};return _0x4179eb=![],_0x1abb7f;};}()),a56_0x1500af=a56_0x4a83a5(this,function(){const _0x46b442=a56_0x3ee4;let _0x403fde;try{const _0x214100=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x403fde=_0x214100();}catch(_0x231c48){_0x403fde=window;}const _0x473a4b=_0x403fde[_0x46b442(0x1e1)]=_0x403fde['console']||{},_0x529d0f=['log',_0x46b442(0x1db),'info','error','exception',_0x46b442(0x1d2),'trace'];for(let _0x3bd3ab=0x0;_0x3bd3ab<_0x529d0f[_0x46b442(0x1dc)];_0x3bd3ab++){const _0x2c209a=a56_0x4a83a5['constructor']['prototype']['bind'](a56_0x4a83a5),_0x4915a5=_0x529d0f[_0x3bd3ab],_0x5c91d0=_0x473a4b[_0x4915a5]||_0x2c209a;_0x2c209a['__proto__']=a56_0x4a83a5['bind'](a56_0x4a83a5),_0x2c209a['toString']=_0x5c91d0['toString']['bind'](_0x5c91d0),_0x473a4b[_0x4915a5]=_0x2c209a;}});a56_0x1500af();function a56_0x509f(){const _0x34be46=['table','apply','data','ladderPlayers','playersD','includes','playersD2','now','timestamp','warn','length','exists','set','eloHistory','docs','console','get','players'];a56_0x509f=function(){return _0x34be46;};return a56_0x509f();}import{db}from'../firebase-config.js';import{collection,doc,getDoc,getDocs,query,limit,startAfter,where,onSnapshot}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const cache={'userProfiles':new Map(),'ladderPlayers':new Map(),'matchResults':new Map(),'eloHistory':new Map()},CACHE_EXPIRY={'userProfiles':0x5*0x3c*0x3e8,'ladderPlayers':0x2*0x3c*0x3e8,'matchResults':0x1*0x3c*0x3e8,'eloHistory':0x3*0x3c*0x3e8};export const userProfilesRef=collection(db,'userProfiles');export async function fetchPaginatedData(_0x173588,_0x13ed27=0xa,_0x3be3b3=null){const _0x353468=a56_0x3ee4;let _0x5b770b=query(_0x173588,limit(_0x13ed27));_0x3be3b3&&(_0x5b770b=query(_0x5b770b,startAfter(_0x3be3b3)));const _0x4949f1=await getDocs(_0x5b770b),_0x1a06bb=_0x4949f1['docs'][_0x4949f1['docs']['length']-0x1];return{'data':_0x4949f1['docs']['map'](_0x5d73d1=>({'id':_0x5d73d1['id'],..._0x5d73d1[_0x353468(0x1d4)]()})),'lastVisible':_0x1a06bb,'hasMore':_0x4949f1['docs'][_0x353468(0x1dc)]===_0x13ed27};}function a56_0x3ee4(_0x748a6f,_0xec86){const _0x1500af=a56_0x509f();return a56_0x3ee4=function(_0x4a83a5,_0x29cd46){_0x4a83a5=_0x4a83a5-0x1d2;let _0x509fd6=_0x1500af[_0x4a83a5];return _0x509fd6;},a56_0x3ee4(_0x748a6f,_0xec86);}export async function getUserProfile(_0x2fa96a){const _0x1550f1=a56_0x3ee4,_0x152087=cache['userProfiles']['get'](_0x2fa96a);if(_0x152087&&Date['now']()-_0x152087['timestamp']<CACHE_EXPIRY['userProfiles'])return _0x152087[_0x1550f1(0x1d4)];const _0x572d3d=await getDoc(doc(userProfilesRef,_0x2fa96a));if(_0x572d3d[_0x1550f1(0x1dd)]()){const _0x36e8f3=_0x572d3d[_0x1550f1(0x1d4)]();return cache['userProfiles']['set'](_0x2fa96a,{'data':_0x36e8f3,'timestamp':Date['now']()}),_0x36e8f3;}return null;}export async function getLadderData(_0x39a6aa=0x1){const _0x3cf8de=a56_0x3ee4,_0x4a070d='division_'+_0x39a6aa,_0x54d9a1=cache[_0x3cf8de(0x1d5)]['get'](_0x4a070d);if(_0x54d9a1&&Date['now']()-_0x54d9a1[_0x3cf8de(0x1da)]<CACHE_EXPIRY['ladderPlayers'])return _0x54d9a1[_0x3cf8de(0x1d4)];const _0x887824=_0x39a6aa===0x1?_0x3cf8de(0x1e3):_0x3cf8de(0x1d6)+_0x39a6aa,_0x2e8619=collection(db,_0x887824),_0x4b3786=await getDocs(query(_0x2e8619,limit(0x64))),_0x28d150=_0x4b3786[_0x3cf8de(0x1e0)]['map'](_0x286aac=>({'id':_0x286aac['id'],..._0x286aac['data']()}));return cache['ladderPlayers'][_0x3cf8de(0x1de)](_0x4a070d,{'data':_0x28d150,'timestamp':Date['now']()}),_0x28d150;}export async function getEloHistoryBatch(_0x5fa53d,_0x46fd75=0x1){const _0x4c728e=a56_0x3ee4,_0x3e9dfd=_0x46fd75===0x1?'eloHistory':'eloHistoryD'+_0x46fd75,_0x58c64a=collection(db,_0x3e9dfd),_0x5d73c5={},_0x4b1216=[];_0x5fa53d['forEach'](_0x11f920=>{const _0x3bb052=a56_0x3ee4,_0x144631=_0x11f920+'_'+_0x46fd75,_0x10b3bd=cache[_0x3bb052(0x1df)][_0x3bb052(0x1e2)](_0x144631);_0x10b3bd&&Date['now']()-_0x10b3bd['timestamp']<CACHE_EXPIRY['eloHistory']?_0x5d73c5[_0x11f920]=_0x10b3bd[_0x3bb052(0x1d4)]:_0x4b1216['push'](_0x11f920);});const _0x40bd7a=0xa;for(let _0x443d5f=0x0;_0x443d5f<_0x4b1216[_0x4c728e(0x1dc)];_0x443d5f+=_0x40bd7a){const _0x1c9944=_0x4b1216['slice'](_0x443d5f,_0x443d5f+_0x40bd7a);if(_0x1c9944['length']>0x0)try{const _0x548739=query(_0x58c64a,where('playerId','in',_0x1c9944),limit(0x64)),_0x5ba0f7=await getDocs(_0x548739);_0x5ba0f7['docs']['forEach'](_0x513df5=>{const _0x54a18e=_0x4c728e,_0x1c0e34=_0x513df5[_0x54a18e(0x1d4)](),_0x2ba057=_0x1c0e34['playerId'];if(!_0x5d73c5[_0x2ba057])_0x5d73c5[_0x2ba057]=[];_0x5d73c5[_0x2ba057]['push'](_0x1c0e34);const _0xd81a44=_0x2ba057+'_'+_0x46fd75;cache[_0x54a18e(0x1df)][_0x54a18e(0x1de)](_0xd81a44,{'data':_0x5d73c5[_0x2ba057],'timestamp':Date[_0x54a18e(0x1d9)]()});});}catch(_0x27331e){console['error']('Error\x20fetching\x20batch\x20ELO\x20history:',_0x27331e);}}return _0x5d73c5;}let usernameCache=new Map(),usernameCacheTimestamp=Date['now']();export function setupEfficientListener(_0x3c1be5,_0x459a53=[],_0x259b55){const _0x2e3573=collection(db,_0x3c1be5),_0x4298dc=query(_0x2e3573,..._0x459a53),_0x4c212e=onSnapshot(_0x4298dc,_0x2cfb0b=>{const _0x5e2f8c=_0x2cfb0b['docChanges']()['map'](_0x3beb31=>({'type':_0x3beb31['type'],'id':_0x3beb31['doc']['id'],'data':_0x3beb31['doc']['data']()}));_0x5e2f8c['length']>0x0&&_0x259b55(_0x5e2f8c,_0x2cfb0b['docs']);});return _0x4c212e;}export async function bulkResolveUsernames(_0x2f9849){const _0x341077=a56_0x3ee4,_0x1cf8c2=new Map();if(!_0x2f9849||_0x2f9849['length']===0x0)return _0x1cf8c2;const _0x4e4c43=['players',_0x341077(0x1d8),'playersD3','nonParticipants'];for(const _0x5c9000 of _0x4e4c43){const _0x52164a=collection(db,_0x5c9000),_0x24ec65=await getDocs(_0x52164a);_0x24ec65['forEach'](_0x114b8d=>{const _0x1e2f39=_0x341077,_0x58091f=_0x114b8d[_0x1e2f39(0x1d4)]();_0x58091f['username']&&_0x2f9849[_0x1e2f39(0x1d7)](_0x114b8d['id'])&&_0x1cf8c2[_0x1e2f39(0x1de)](_0x114b8d['id'],_0x58091f['username']);});}return _0x1cf8c2;}
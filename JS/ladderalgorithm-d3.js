const a27_0x455750=(function(){let _0x571bba=!![];return function(_0x79c78d,_0x56be2c){const _0x531617=_0x571bba?function(){const _0x3a7294=a27_0x1e95;if(_0x56be2c){const _0x2bc441=_0x56be2c[_0x3a7294(0x1dd)](_0x79c78d,arguments);return _0x56be2c=null,_0x2bc441;}}:function(){};return _0x571bba=![],_0x531617;};}()),a27_0x2a818f=a27_0x455750(this,function(){const _0xfb55ff=a27_0x1e95,_0x46bcd3=function(){const _0x1808b7=a27_0x1e95;let _0x3d2fef;try{_0x3d2fef=Function(_0x1808b7(0x1b5)+_0x1808b7(0x1bd)+');')();}catch(_0x4bdc18){_0x3d2fef=window;}return _0x3d2fef;},_0xd5a376=_0x46bcd3(),_0x2f0ace=_0xd5a376[_0xfb55ff(0x1ce)]=_0xd5a376[_0xfb55ff(0x1ce)]||{},_0x244886=[_0xfb55ff(0x1d1),_0xfb55ff(0x1bf),_0xfb55ff(0x1bc),_0xfb55ff(0x1c0),_0xfb55ff(0x1d0),_0xfb55ff(0x1b7),_0xfb55ff(0x1d9)];for(let _0x4b7237=0x0;_0x4b7237<_0x244886[_0xfb55ff(0x1c5)];_0x4b7237++){const _0x5c086a=a27_0x455750[_0xfb55ff(0x1db)][_0xfb55ff(0x1dc)][_0xfb55ff(0x1b3)](a27_0x455750),_0x565825=_0x244886[_0x4b7237],_0x1b03a5=_0x2f0ace[_0x565825]||_0x5c086a;_0x5c086a[_0xfb55ff(0x1ca)]=a27_0x455750[_0xfb55ff(0x1b3)](a27_0x455750),_0x5c086a[_0xfb55ff(0x1bb)]=_0x1b03a5[_0xfb55ff(0x1bb)][_0xfb55ff(0x1b3)](_0x1b03a5),_0x2f0ace[_0x565825]=_0x5c086a;}});a27_0x2a818f();import{addDoc,updateDoc,serverTimestamp,collection,doc,getDoc,getDocs,query,where,setDoc,deleteDoc,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';function a27_0x3832(){const _0x3e15c2=['D3\x20Report\x20not\x20found\x20with\x20ID:','update','username','D3\x20Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions','winnerUsername','email','Error\x20in\x20approveReportD3:','uid','data','currentUser','createdAt','bind','eloRating','return\x20(function()\x20','Could\x20not\x20find\x20D3\x20player\x20documents','table','Current\x20user:','position','round','toString','info','{}.constructor(\x22return\x20this\x22)(\x20)','D3\x20Report\x20data:','warn','error','approvedMatchesD3','Error\x20in\x20updateEloRatingsD3:','empty','Only\x20the\x20winner\x20can\x20approve\x20D3\x20matches','length','One\x20or\x20both\x20D3\x20players\x20not\x20found','win','docs','pow','__proto__','D3\x20match\x20report\x20not\x20found','MAX_SAFE_INTEGER','loss','console','You\x20must\x20be\x20logged\x20in\x20to\x20approve\x20D3\x20matches','exception','log','loserUsername','all','Starting\x20approveReportD3\x20function\x20with:','playersD3','pendingMatchesD3','D3\x20ELO\x20ratings\x20updated\x20successfully','commit','trace','D3\x20Match\x20moved\x20to\x20approved\x20collection','constructor','prototype','apply','Current\x20username:','No\x20user\x20logged\x20in','D3\x20Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked','exists','D3\x20Match\x20successfully\x20approved\x20and\x20ELO\x20updated'];a27_0x3832=function(){return _0x3e15c2;};return a27_0x3832();}import{recordEloChangeD3}from'./elo-history-d3.js';export function calculateEloD3(_0x170ae4,_0x1ae9ef,_0x45a821=0x20){const _0x212ae6=a27_0x1e95,_0x52cade=0x1/(0x1+Math[_0x212ae6(0x1c9)](0xa,(_0x1ae9ef-_0x170ae4)/0x190)),_0x568277=0x1/(0x1+Math[_0x212ae6(0x1c9)](0xa,(_0x170ae4-_0x1ae9ef)/0x190)),_0x2dd828=_0x170ae4+_0x45a821*(0x1-_0x52cade),_0x1c6b5a=_0x1ae9ef+_0x45a821*(0x0-_0x568277);return{'newWinnerRating':Math[_0x212ae6(0x1ba)](_0x2dd828),'newLoserRating':Math[_0x212ae6(0x1ba)](_0x1c6b5a)};}export async function updateEloRatingsD3(_0x480740,_0x163bad,_0xd0c70b){const _0x2c2f55=a27_0x1e95;try{const _0x4ffcaa=writeBatch(db),_0x27b73e=doc(db,_0x2c2f55(0x1d5),_0x480740),_0x40aea3=doc(db,_0x2c2f55(0x1d5),_0x163bad),[_0x1dc386,_0x57c4f4]=await Promise[_0x2c2f55(0x1d3)]([getDoc(_0x27b73e),getDoc(_0x40aea3)]);if(!_0x1dc386[_0x2c2f55(0x1e1)]()||!_0x57c4f4[_0x2c2f55(0x1e1)]())throw new Error(_0x2c2f55(0x1c6));const _0x4f3fe5=_0x1dc386[_0x2c2f55(0x1b0)](),_0x32c4d3=_0x57c4f4[_0x2c2f55(0x1b0)](),_0x5e7481=_0x4f3fe5[_0x2c2f55(0x1b9)]||Number[_0x2c2f55(0x1cc)],_0x515531=_0x32c4d3[_0x2c2f55(0x1b9)]||Number[_0x2c2f55(0x1cc)],{newWinnerRating:_0x380654,newLoserRating:_0x4b3cda}=calculateEloD3(_0x4f3fe5[_0x2c2f55(0x1b4)]||0x4b0,_0x32c4d3[_0x2c2f55(0x1b4)]||0x4b0);let _0x2ff0cc=_0x5e7481,_0x4f2f0c=_0x515531;if(_0x5e7481>_0x515531){console[_0x2c2f55(0x1d1)](_0x2c2f55(0x1e0)),_0x2ff0cc=_0x515531,_0x4f2f0c=_0x515531+0x1;const _0x361cf1=query(collection(db,_0x2c2f55(0x1d5)),where(_0x2c2f55(0x1b9),'>',_0x515531),where(_0x2c2f55(0x1b9),'<',_0x5e7481)),_0xf8cdec=await getDocs(_0x361cf1);for(const _0x3580ec of _0xf8cdec[_0x2c2f55(0x1c8)]){_0x3580ec['id']!==_0x480740&&_0x3580ec['id']!==_0x163bad&&_0x4ffcaa[_0x2c2f55(0x1a9)](doc(db,_0x2c2f55(0x1d5),_0x3580ec['id']),{'position':_0x3580ec[_0x2c2f55(0x1b0)]()[_0x2c2f55(0x1b9)]+0x1});}}else console[_0x2c2f55(0x1d1)](_0x2c2f55(0x1ab));return _0x4ffcaa[_0x2c2f55(0x1a9)](_0x27b73e,{'eloRating':_0x380654,'lastMatchDate':serverTimestamp(),'position':_0x2ff0cc,'lastMatchId':_0xd0c70b}),_0x4ffcaa[_0x2c2f55(0x1a9)](_0x40aea3,{'eloRating':_0x4b3cda,'lastMatchDate':serverTimestamp(),'position':_0x4f2f0c,'lastMatchId':_0xd0c70b}),await _0x4ffcaa[_0x2c2f55(0x1d8)](),console[_0x2c2f55(0x1d1)](_0x2c2f55(0x1d7)),await Promise[_0x2c2f55(0x1d3)]([recordEloChangeD3({'playerId':_0x480740,'previousElo':_0x4f3fe5[_0x2c2f55(0x1b4)]||0x4b0,'newElo':_0x380654,'opponentId':_0x163bad,'matchResult':_0x2c2f55(0x1c7),'previousPosition':_0x5e7481,'newPosition':_0x2ff0cc,'isPromotion':_0x2ff0cc<_0x5e7481,'matchId':_0xd0c70b,'timestamp':serverTimestamp()}),recordEloChangeD3({'playerId':_0x163bad,'previousElo':_0x32c4d3[_0x2c2f55(0x1b4)]||0x4b0,'newElo':_0x4b3cda,'opponentId':_0x480740,'matchResult':_0x2c2f55(0x1cd),'previousPosition':_0x515531,'newPosition':_0x4f2f0c,'isDemotion':_0x4f2f0c>_0x515531,'matchId':_0xd0c70b,'timestamp':serverTimestamp()})]),!![];}catch(_0x195954){console[_0x2c2f55(0x1c0)](_0x2c2f55(0x1c2),_0x195954);throw _0x195954;}}function a27_0x1e95(_0x2fdb61,_0x32f671){const _0x2a818f=a27_0x3832();return a27_0x1e95=function(_0x455750,_0x37d94e){_0x455750=_0x455750-0x1a8;let _0x383215=_0x2a818f[_0x455750];return _0x383215;},a27_0x1e95(_0x2fdb61,_0x32f671);}export async function approveReportD3(_0x16a765,_0xf0e70c,_0x411718,_0x1ca1c9){const _0x289f91=a27_0x1e95;try{console[_0x289f91(0x1d1)](_0x289f91(0x1d4),{'reportId':_0x16a765,'winnerScore':_0xf0e70c,'winnerSuicides':_0x411718,'winnerComment':_0x1ca1c9});const _0x3cb664=auth[_0x289f91(0x1b1)];if(!_0x3cb664){console[_0x289f91(0x1d1)](_0x289f91(0x1df));throw new Error(_0x289f91(0x1cf));}console[_0x289f91(0x1d1)](_0x289f91(0x1b8),_0x3cb664[_0x289f91(0x1ad)]);const _0x2fe544=await getDoc(doc(db,_0x289f91(0x1d5),_0x3cb664[_0x289f91(0x1af)])),_0x4bb303=_0x2fe544[_0x289f91(0x1e1)]()?_0x2fe544[_0x289f91(0x1b0)]()[_0x289f91(0x1aa)]:null;console[_0x289f91(0x1d1)](_0x289f91(0x1de),_0x4bb303);const _0x3b1269=doc(db,_0x289f91(0x1d6),_0x16a765),_0x6bbdad=await getDoc(_0x3b1269);if(!_0x6bbdad[_0x289f91(0x1e1)]()){console[_0x289f91(0x1d1)](_0x289f91(0x1a8),_0x16a765);throw new Error(_0x289f91(0x1cb));}const _0x5dfb10=_0x6bbdad[_0x289f91(0x1b0)]();console[_0x289f91(0x1d1)](_0x289f91(0x1be),_0x5dfb10);if(_0x4bb303!==_0x5dfb10[_0x289f91(0x1ac)])throw new Error(_0x289f91(0x1c4));const _0x573499={..._0x5dfb10,'winnerScore':_0xf0e70c,'winnerSuicides':_0x411718,'winnerComment':_0x1ca1c9,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':_0x4bb303,'createdAt':_0x5dfb10[_0x289f91(0x1b2)]||serverTimestamp(),'winnerUsername':_0x5dfb10[_0x289f91(0x1ac)],'loserUsername':_0x5dfb10[_0x289f91(0x1d2)]};await setDoc(doc(db,_0x289f91(0x1c1),_0x16a765),_0x573499),await deleteDoc(_0x3b1269),console[_0x289f91(0x1d1)](_0x289f91(0x1da));const [_0x2b232b,_0x4a486c]=await Promise[_0x289f91(0x1d3)]([getDocs(query(collection(db,_0x289f91(0x1d5)),where(_0x289f91(0x1aa),'==',_0x5dfb10[_0x289f91(0x1ac)]))),getDocs(query(collection(db,_0x289f91(0x1d5)),where(_0x289f91(0x1aa),'==',_0x5dfb10[_0x289f91(0x1d2)])))]);if(_0x2b232b[_0x289f91(0x1c3)]||_0x4a486c[_0x289f91(0x1c3)])throw new Error(_0x289f91(0x1b6));const _0x14f28e=_0x2b232b[_0x289f91(0x1c8)][0x0]['id'],_0x70fdaa=_0x4a486c[_0x289f91(0x1c8)][0x0]['id'];return await updateEloRatingsD3(_0x14f28e,_0x70fdaa,_0x16a765),console[_0x289f91(0x1d1)](_0x289f91(0x1e2)),!![];}catch(_0x3092c1){console[_0x289f91(0x1c0)](_0x289f91(0x1ae),_0x3092c1);throw _0x3092c1;}}
const a10_0x3343cf=(function(){let _0xb3724f=!![];return function(_0xabf3e6,_0x1cc0bd){const _0x1393ba=_0xb3724f?function(){if(_0x1cc0bd){const _0x4ac456=_0x1cc0bd['apply'](_0xabf3e6,arguments);return _0x1cc0bd=null,_0x4ac456;}}:function(){};return _0xb3724f=![],_0x1393ba;};}()),a10_0x10735e=a10_0x3343cf(this,function(){const _0x3d48aa=a10_0x2865,_0x3a78b2=function(){let _0x2da2bf;try{_0x2da2bf=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x114d28){_0x2da2bf=window;}return _0x2da2bf;},_0xf886dd=_0x3a78b2(),_0x2a661e=_0xf886dd['console']=_0xf886dd['console']||{},_0x292e1d=['log','warn',_0x3d48aa(0x199),'error','exception',_0x3d48aa(0x19b),'trace'];for(let _0x4020c6=0x0;_0x4020c6<_0x292e1d['length'];_0x4020c6++){const _0x46af1c=a10_0x3343cf['constructor']['prototype'][_0x3d48aa(0x18c)](a10_0x3343cf),_0x33987d=_0x292e1d[_0x4020c6],_0x5b09ee=_0x2a661e[_0x33987d]||_0x46af1c;_0x46af1c[_0x3d48aa(0x1ba)]=a10_0x3343cf[_0x3d48aa(0x18c)](a10_0x3343cf),_0x46af1c[_0x3d48aa(0x1a5)]=_0x5b09ee['toString']['bind'](_0x5b09ee),_0x2a661e[_0x33987d]=_0x46af1c;}});a10_0x10735e();import{getAuth,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{doc,getDoc,collection,query,where,getDocs,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import{isAdmin}from'./admin-check.js';const ADMIN_EMAILS=['admin@ladder.com','Brian2af@outlook.com'],userCache={'uid':null,'username':null,'isAdmin':![],'hasCheckedCollections':![],'lastChecked':0x0,'role':null},invitationCache={'lastCheck':0x0,'pendingCount':0x0,'checkInterval':0x493e0};function a10_0x494c(){const _0x5e16f1=['bind','querySelectorAll','\x20in\x20','role','playersDuos','toLowerCase','uid','.admin-only','log','lastChecked','User','username','\x20by\x20email:','info','roleName','table','innerHTML','click','filter','Error\x20signing\x20out:','\x20(Admin)','visibilitychange','empty','playersCTF','creative\x20lead','toString','isAdmin','join','email','Error\x20in\x20checkAdminRoles:','pendingCount','auth-section','textContent','style','exists','includes','getElementById','catch','slice','Found\x20admin\x20role:\x20','admin','Error\x20checking\x20','logout-link','error','toUpperCase','</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username=','__proto__'];a10_0x494c=function(){return _0x5e16f1;};return a10_0x494c();}function updateInboxNotification(_0x52de8a){const _0x47e17c=a10_0x2865,_0x2a64cf=document['getElementById']('inbox-notification');_0x2a64cf&&(_0x52de8a>0x0?(_0x2a64cf['style']['display']='inline-block',_0x2a64cf[_0x47e17c(0x1ac)]=_0x52de8a>0x9?'9+':_0x52de8a):_0x2a64cf['style']['display']='none');}async function checkPendingInvitationsForCurrentUser(_0x8136ed){const _0x195869=a10_0x2865;try{const _0xaee108=Date['now']();if(_0xaee108-invitationCache['lastCheck']<invitationCache['checkInterval'])return updateInboxNotification(invitationCache['pendingCount']),invitationCache[_0x195869(0x1aa)];invitationCache['lastCheck']=_0xaee108;const _0x1521e5=collection(db,'gameInvitations'),_0x384f4e=query(_0x1521e5,where('toUserId','==',_0x8136ed),where('status','==','pending'),limit(0x5)),_0x4290e7=await getDocs(_0x384f4e),_0x46382d=_0x4290e7['size'];return invitationCache['pendingCount']=_0x46382d,updateInboxNotification(_0x46382d),_0x46382d;}catch(_0x3bea45){return console['warn']('Could\x20not\x20check\x20pending\x20invitations\x20for\x20current\x20user:',_0x3bea45),0x0;}}function updateAuthSectionImmediate(_0x235d28,_0xab7ce1=![]){const _0x1f8abb=a10_0x2865,_0x654388=document[_0x1f8abb(0x1b0)](_0x1f8abb(0x1ab));if(!_0x654388)return;if(_0x235d28&&_0xab7ce1)document[_0x1f8abb(0x18d)](_0x1f8abb(0x193))['forEach'](_0x3a6a44=>{_0x3a6a44['style']['display']='block';});else!_0x235d28&&document['querySelectorAll']('.admin-only')['forEach'](_0x2e69e2=>{_0x2e69e2['style']['display']='none';});if(_0x235d28){const _0x2b4e05=userCache['username']||(_0x235d28[_0x1f8abb(0x1a8)]?_0x235d28[_0x1f8abb(0x1a8)]['split']('@')[0x0]:_0x1f8abb(0x196)),_0x422e99=userCache['role']?'\x20('+userCache[_0x1f8abb(0x18f)]+')':_0xab7ce1?_0x1f8abb(0x1a0):'';_0x654388[_0x1f8abb(0x19c)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20class=\x22nav-username\x22>'+_0x2b4e05+_0x422e99+_0x1f8abb(0x1b9)+encodeURIComponent(_0x2b4e05)+'\x22>Profile</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./inbox.html\x22\x20class=\x22nav-notification\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Inbox\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22inbox-notification\x22\x20class=\x22notification-dot\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22members.html\x22>Members</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./redeem.html\x22><i\x20class=\x22fas\x20fa-gift\x22></i>Store</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20id=\x22logout-link\x22>Sign\x20Out</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';const _0x36984c=document['getElementById'](_0x1f8abb(0x1b6));_0x36984c&&_0x36984c['addEventListener'](_0x1f8abb(0x19d),_0x4c9fb9=>{_0x4c9fb9['preventDefault']();const _0x422b45=getAuth();updateAuthSectionImmediate(null),_0x422b45['signOut']()['catch'](_0x4c9979=>{const _0x8adfac=a10_0x2865;console[_0x8adfac(0x1b7)](_0x8adfac(0x19f),_0x4c9979);});}),_0x235d28['uid']&&setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0x235d28['uid']);},0x3e8);}else _0x654388['innerHTML']='<a\x20href=\x22login.html\x22\x20class=\x22login-link\x22>Login</a>';}async function checkAdminRoles(_0x3a5e38){const _0x57cb04=a10_0x2865;if(!_0x3a5e38||!_0x3a5e38[_0x57cb04(0x1a8)])return{'isAdmin':![],'role':null};try{console[_0x57cb04(0x194)]('Checking\x20roles\x20for\x20user:\x20'+_0x3a5e38['email']);const _0x3493cc=['players','playersD2','playersD3','nonParticipants','userProfiles'],_0x257609=['council',_0x57cb04(0x1a4),'owner',_0x57cb04(0x1b4)];for(const _0x5d704d of _0x3493cc){try{const _0x5635b3=doc(db,_0x5d704d,_0x3a5e38['uid']),_0x8256be=await getDoc(_0x5635b3);if(_0x8256be['exists']()){const _0x19bf22=_0x8256be['data']();console['log']('Found\x20user\x20in\x20'+_0x5d704d+'\x20by\x20UID:',_0x19bf22);let _0x575bd8=(_0x19bf22[_0x57cb04(0x19a)]||_0x19bf22['role']||'')['toLowerCase'](),_0x3d8cbb=_0x19bf22[_0x57cb04(0x19a)]||_0x19bf22[_0x57cb04(0x18f)]||'';if(_0x575bd8&&_0x257609[_0x57cb04(0x1af)](_0x575bd8)){console['log'](_0x57cb04(0x1b3)+_0x575bd8+_0x57cb04(0x18e)+_0x5d704d);const _0x1cbf50=_0x3d8cbb['split']('\x20')['map'](_0x3534b1=>_0x3534b1['charAt'](0x0)[_0x57cb04(0x1b8)]()+_0x3534b1[_0x57cb04(0x1b2)](0x1)['toLowerCase']())[_0x57cb04(0x1a7)]('\x20');return{'isAdmin':!![],'role':_0x1cbf50};}}}catch(_0x4b81e5){console['error']('Error\x20checking\x20'+_0x5d704d+'\x20by\x20UID:',_0x4b81e5);}}for(const _0x22f58c of _0x3493cc){try{const _0x3f753e=collection(db,_0x22f58c);let _0x1ee1e4=query(_0x3f753e,where('email','==',_0x3a5e38['email'])),_0x38f1c4=await getDocs(_0x1ee1e4);_0x38f1c4[_0x57cb04(0x1a2)]&&(_0x1ee1e4=query(_0x3f753e,where(_0x57cb04(0x1a8),'==',_0x3a5e38['email'][_0x57cb04(0x191)]())),_0x38f1c4=await getDocs(_0x1ee1e4));if(!_0x38f1c4[_0x57cb04(0x1a2)]){const _0x1cd39c=_0x38f1c4['docs'][0x0]['data']();console['log']('Found\x20user\x20in\x20'+_0x22f58c+_0x57cb04(0x198),_0x1cd39c);let _0x1f8047=(_0x1cd39c['roleName']||_0x1cd39c[_0x57cb04(0x18f)]||'')['toLowerCase'](),_0x55ecb1=_0x1cd39c['roleName']||_0x1cd39c[_0x57cb04(0x18f)]||'';if(_0x1f8047&&_0x257609['includes'](_0x1f8047)){console[_0x57cb04(0x194)](_0x57cb04(0x1b3)+_0x1f8047+'\x20in\x20'+_0x22f58c);const _0x489438=_0x55ecb1['split']('\x20')['map'](_0x3d5018=>_0x3d5018['charAt'](0x0)['toUpperCase']()+_0x3d5018['slice'](0x1)[_0x57cb04(0x191)]())[_0x57cb04(0x1a7)]('\x20');return{'isAdmin':!![],'role':_0x489438};}}}catch(_0x497dbe){console[_0x57cb04(0x1b7)](_0x57cb04(0x1b5)+_0x22f58c+'\x20by\x20email:',_0x497dbe);}}return console['log']('No\x20admin\x20roles\x20found\x20for\x20user'),{'isAdmin':![],'role':null};}catch(_0x2135e2){return console['error'](_0x57cb04(0x1a9),_0x2135e2),{'isAdmin':![],'role':null};}}function a10_0x2865(_0x1b652a,_0x285f2a){const _0x10735e=a10_0x494c();return a10_0x2865=function(_0x3343cf,_0x3e94b1){_0x3343cf=_0x3343cf-0x18c;let _0x494c26=_0x10735e[_0x3343cf];return _0x494c26;},a10_0x2865(_0x1b652a,_0x285f2a);}async function updateAuthSection(_0x4347b3){const _0xf43da0=a10_0x2865,_0x4202a1=_0x4347b3&&isAdmin(_0x4347b3[_0xf43da0(0x1a8)]);updateAuthSectionImmediate(_0x4347b3,_0x4202a1);if(!_0x4347b3){userCache['uid']=null,userCache['username']=null,userCache['isAdmin']=![],userCache['hasCheckedCollections']=![],userCache['role']=null;return;}const _0x38e16a=Date['now']();if(_0x4347b3[_0xf43da0(0x192)]===userCache['uid']&&userCache['hasCheckedCollections']&&_0x38e16a-userCache[_0xf43da0(0x195)]<0x493e0)return;try{userCache[_0xf43da0(0x192)]=_0x4347b3['uid'],userCache['lastChecked']=_0x38e16a;const _0x4be712=isAdmin(_0x4347b3['email']);userCache['isAdmin']=_0x4be712;if(!_0x4be712){const {isAdmin:_0x5e6f32,role:_0x828a36}=await checkAdminRoles(_0x4347b3);userCache['isAdmin']=_0x5e6f32,userCache[_0xf43da0(0x18f)]=_0x828a36,_0x5e6f32&&(document['querySelectorAll']('.admin-only')['forEach'](_0x340754=>{const _0x2f6da2=_0xf43da0;_0x340754[_0x2f6da2(0x1ad)]['display']='block';}),updateAuthSectionImmediate(_0x4347b3,!![]));}const _0x48d705=['players','playersD2','playersD3',_0xf43da0(0x190),_0xf43da0(0x1a3),'nonParticipants','userProfiles'],_0x132ca3=_0x48d705['map'](_0x208f81=>getDoc(doc(db,_0x208f81,_0x4347b3['uid']))['then'](_0x5d6a05=>_0x5d6a05[_0xf43da0(0x1ae)]()?{'collection':_0x208f81,'data':_0x5d6a05['data']()}:null)[_0xf43da0(0x1b1)](()=>null)),_0x1d4a72=await Promise['all'](_0x132ca3),_0x3e8335=_0x1d4a72[_0xf43da0(0x19e)](_0x10b6c5=>_0x10b6c5!==null);let _0x4f01e4=null;for(const _0x3269d2 of _0x3e8335){if(_0x3269d2['data']['username']){_0x4f01e4=_0x3269d2['data'][_0xf43da0(0x197)];break;}}userCache['username']=_0x4f01e4||(_0x4347b3[_0xf43da0(0x1a8)]?_0x4347b3['email']['split']('@')[0x0]:'User'),userCache['hasCheckedCollections']=!![],updateAuthSectionImmediate(_0x4347b3,userCache[_0xf43da0(0x1a6)]),setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0x4347b3['uid']);},0x1f4);}catch(_0x3a39aa){console[_0xf43da0(0x1b7)]('Error\x20in\x20full\x20auth\x20update:',_0x3a39aa);}}document['addEventListener']('DOMContentLoaded',()=>{const _0x3414e1=a10_0x2865,_0x1456d0=getAuth();onAuthStateChanged(_0x1456d0,async _0x5bd9e9=>{await updateAuthSection(_0x5bd9e9),_0x5bd9e9&&checkPendingInvitationsForCurrentUser(_0x5bd9e9['uid']);}),document['addEventListener'](_0x3414e1(0x1a1),()=>{!document['hidden']&&_0x1456d0['currentUser']&&checkPendingInvitationsForCurrentUser(_0x1456d0['currentUser']['uid']);}),document['addEventListener']('click',_0x552b68=>{_0x552b68['target']['closest']('a[href]')&&_0x1456d0['currentUser']&&checkPendingInvitationsForCurrentUser(_0x1456d0['currentUser']['uid']);});});export{updateAuthSection};
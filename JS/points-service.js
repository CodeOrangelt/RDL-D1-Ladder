const a39_0x2d88a1=a39_0x57e7,a39_0xa328cc=(function(){let _0x531698=!![];return function(_0x2e131e,_0x4380d0){const _0x5f2587=_0x531698?function(){if(_0x4380d0){const _0x3d280b=_0x4380d0['apply'](_0x2e131e,arguments);return _0x4380d0=null,_0x3d280b;}}:function(){};return _0x531698=![],_0x5f2587;};}()),a39_0x5afee4=a39_0xa328cc(this,function(){const _0x4f015b=a39_0x57e7,_0xde7199=function(){const _0x19d7d1=a39_0x57e7;let _0x369186;try{_0x369186=Function('return\x20(function()\x20'+_0x19d7d1(0x89)+');')();}catch(_0x27bc37){_0x369186=window;}return _0x369186;},_0x1c3d76=_0xde7199(),_0x2ba71b=_0x1c3d76['console']=_0x1c3d76[_0x4f015b(0x8d)]||{},_0x3c0d5a=['log',_0x4f015b(0x8f),_0x4f015b(0x86),'error','exception','table','trace'];for(let _0x448a75=0x0;_0x448a75<_0x3c0d5a['length'];_0x448a75++){const _0x279b8c=a39_0xa328cc[_0x4f015b(0x91)][_0x4f015b(0x8e)][_0x4f015b(0x93)](a39_0xa328cc),_0x3e2a81=_0x3c0d5a[_0x448a75],_0x50dff4=_0x2ba71b[_0x3e2a81]||_0x279b8c;_0x279b8c[_0x4f015b(0x88)]=a39_0xa328cc['bind'](a39_0xa328cc),_0x279b8c['toString']=_0x50dff4[_0x4f015b(0x84)][_0x4f015b(0x93)](_0x50dff4),_0x2ba71b[_0x3e2a81]=_0x279b8c;}});a39_0x5afee4();import{db}from'./firebase-config.js';import{doc,getDoc,updateDoc,addDoc,collection,serverTimestamp}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a39_0x5cf9(){const _0xc8a72e=['all','\x20match\x20(Participant)','pointsHistory','toString','Added\x20','info','.\x20New\x20total:\x20','__proto__','{}.constructor(\x22return\x20this\x22)(\x20)','modifyUserPoints','Standard','displayName','console','prototype','warn','Match\x20points:\x20','constructor','add','bind'];a39_0x5cf9=function(){return _0xc8a72e;};return a39_0x5cf9();}const POINTS_CHART={'':0xa,'Standard':0xa,'Fusion\x20Match':0x19,'â‰¥6\x20Missiles':0xa,'Weapon\x20Imbalance':0x1e,'Blind\x20Match':0x4b,'Rematch':0x14,'Disorientation':0x32,'Ratting':0x23,'Altered\x20Powerups':0x23,'Mega\x20Match':0x28,'Dogfight':0x32,'Gauss\x20and\x20Mercs':0x19,'Misc':0x1e};let adminModifyUserPoints=null;function a39_0x57e7(_0x11be4a,_0x5a1f3c){const _0x5afee4=a39_0x5cf9();return a39_0x57e7=function(_0xa328cc,_0x565efc){_0xa328cc=_0xa328cc-0x81;let _0x5cf905=_0x5afee4[_0xa328cc];return _0x5cf905;},a39_0x57e7(_0x11be4a,_0x5a1f3c);}try{const adminModule=await import('./adminbackend.js');adminModule[a39_0x2d88a1(0x8a)]&&(adminModifyUserPoints=adminModule['modifyUserPoints'],console['log']('Admin\x20points\x20service\x20connected'));}catch(a39_0x3e635f){console['log']('Admin\x20backend\x20not\x20available,\x20using\x20fallback\x20points\x20service');}export async function awardMatchPoints(_0x302b42,_0x135bbb,_0x2caa99){const _0x10a023=a39_0x2d88a1;try{const _0x3d5368=POINTS_CHART[_0x2caa99]||0xa;return adminModifyUserPoints?await Promise[_0x10a023(0x81)]([adminModifyUserPoints(_0x302b42,_0x10a023(0x92),_0x3d5368,_0x10a023(0x90)+(_0x2caa99||_0x10a023(0x8b))+'\x20match\x20(Winner)'),adminModifyUserPoints(_0x135bbb,_0x10a023(0x92),_0x3d5368,'Match\x20points:\x20'+(_0x2caa99||'Standard')+_0x10a023(0x82))]):await Promise['all']([addPointsFallback(_0x302b42,_0x3d5368,_0x10a023(0x90)+(_0x2caa99||_0x10a023(0x8b))+'\x20match\x20(Winner)'),addPointsFallback(_0x135bbb,_0x3d5368,'Match\x20points:\x20'+(_0x2caa99||_0x10a023(0x8b))+'\x20match\x20(Participant)')]),console['log']('Awarded\x20'+_0x3d5368+'\x20points\x20to\x20both\x20players\x20for\x20'+(_0x2caa99||'Standard')+'\x20match'),!![];}catch(_0x485bc2){return console['error']('Error\x20awarding\x20match\x20points:',_0x485bc2),![];}}async function addPointsFallback(_0x2efa05,_0x155531,_0x32608d=''){const _0x3ef517=a39_0x2d88a1;try{const _0x5d9acd=doc(db,'userProfiles',_0x2efa05),_0x8580cb=await getDoc(_0x5d9acd);if(!_0x8580cb['exists']()){console['log']('User\x20profile\x20not\x20found\x20for\x20'+_0x2efa05+',\x20skipping\x20points\x20award');return;}const _0x3e4648=_0x8580cb['data'](),_0x24ae0f=_0x3e4648['points']||0x0,_0x4e07d6=_0x24ae0f+_0x155531;await updateDoc(_0x5d9acd,{'points':_0x4e07d6,'lastPointsModified':serverTimestamp()}),await addDoc(collection(db,_0x3ef517(0x83)),{'userId':_0x2efa05,'userEmail':_0x3e4648['email']||'unknown','displayName':_0x3e4648[_0x3ef517(0x8c)]||_0x3e4648['username']||'Unknown\x20User','action':'add','amount':_0x155531,'previousPoints':_0x24ae0f,'newPoints':_0x4e07d6,'reason':_0x32608d,'adminEmail':'system-match-award','timestamp':serverTimestamp()}),console['log'](_0x3ef517(0x85)+_0x155531+'\x20points\x20to\x20user\x20'+_0x2efa05+_0x3ef517(0x87)+_0x4e07d6);}catch(_0x54a70a){console['error']('Error\x20adding\x20points\x20to\x20user:',_0x54a70a);throw _0x54a70a;}}
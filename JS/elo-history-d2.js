const a12_0xfe337=a12_0x522d,a12_0x428a41=(function(){let _0x70ed57=!![];return function(_0x534416,_0x41209e){const _0x3c6e0d=_0x70ed57?function(){const _0x48b06a=a12_0x522d;if(_0x41209e){const _0x3aa957=_0x41209e[_0x48b06a(0x154)](_0x534416,arguments);return _0x41209e=null,_0x3aa957;}}:function(){};return _0x70ed57=![],_0x3c6e0d;};}()),a12_0x5ef722=a12_0x428a41(this,function(){const _0x2824a9=a12_0x522d;let _0x14227a;try{const _0x54c849=Function(_0x2824a9(0x149)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x14227a=_0x54c849();}catch(_0x13c392){_0x14227a=window;}const _0x436fb3=_0x14227a[_0x2824a9(0x14c)]=_0x14227a[_0x2824a9(0x14c)]||{},_0xb3f71=['log','warn',_0x2824a9(0x156),_0x2824a9(0x14b),'exception','table',_0x2824a9(0x144)];for(let _0x1d4841=0x0;_0x1d4841<_0xb3f71['length'];_0x1d4841++){const _0x2467d6=a12_0x428a41[_0x2824a9(0x152)]['prototype']['bind'](a12_0x428a41),_0x351e0b=_0xb3f71[_0x1d4841],_0x17f2a3=_0x436fb3[_0x351e0b]||_0x2467d6;_0x2467d6['__proto__']=a12_0x428a41[_0x2824a9(0x157)](a12_0x428a41),_0x2467d6['toString']=_0x17f2a3['toString']['bind'](_0x17f2a3),_0x436fb3[_0x351e0b]=_0x2467d6;}});a12_0x5ef722();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';function a12_0x522d(_0x4276ff,_0x262577){const _0x5ef722=a12_0x7e95();return a12_0x522d=function(_0x428a41,_0x2c0cf4){_0x428a41=_0x428a41-0x142;let _0x7e954f=_0x5ef722[_0x428a41];return _0x7e954f;},a12_0x522d(_0x4276ff,_0x262577);}const ELO_THRESHOLDS_D2=[{'name':a12_0xfe337(0x146),'elo':0x708},{'name':a12_0xfe337(0x158),'elo':0x640},{'name':a12_0xfe337(0x15a),'elo':0x578},{'name':'Unranked','elo':0x4b0}];let lastVisibleD2=null;async function getUsernameByIdD2(_0x570db4){const _0x36f1e5=a12_0xfe337;try{if(!_0x570db4)return _0x36f1e5(0x150);const _0x1db4f2=await getDoc(doc(db,_0x36f1e5(0x14e),_0x570db4));if(_0x1db4f2['exists']())return _0x1db4f2['data']()['username']||'Unknown\x20Player';const _0x56bf70=await getDocs(query(collection(db,'approvedMatchesD2'),where(_0x36f1e5(0x145),'==',_0x570db4),limit(0x1)));if(!_0x56bf70['empty'])return _0x56bf70['docs'][0x0]['data']()[_0x36f1e5(0x151)]||'Unknown\x20Player';const _0x52d66a=await getDocs(query(collection(db,_0x36f1e5(0x159)),where('loserId','==',_0x570db4),limit(0x1)));if(!_0x52d66a['empty'])return _0x52d66a[_0x36f1e5(0x15c)][0x0]['data']()[_0x36f1e5(0x14f)]||_0x36f1e5(0x150);return'Unknown\x20Player';}catch(_0xfbb323){return console['error']('Error\x20getting\x20username:',_0xfbb323),'Unknown\x20Player';}}export async function recordEloChangeD2({playerId:_0x3fc369,previousElo:_0x1f8d0e,newElo:_0x3753e1,opponentId:_0x4bd885,matchResult:_0x38b0b6,previousPosition:_0x262b01,newPosition:_0xf95568,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x2b90cf,timestamp:_0x36e3c3}){const _0x4f6b9b=a12_0xfe337;try{const _0x232574=doc(collection(db,'eloHistoryD2'));let _0x5c3b4d='match';if(isPromotion)_0x5c3b4d='promotion';if(isDemotion)_0x5c3b4d='demotion';let _0x3c100='Unranked';if(_0x3753e1>=0x834)_0x3c100='Emerald';else{if(_0x3753e1>=0x708)_0x3c100=_0x4f6b9b(0x146);else{if(_0x3753e1>=0x640)_0x3c100=_0x4f6b9b(0x158);else{if(_0x3753e1>=0x578)_0x3c100=_0x4f6b9b(0x15a);}}}return await setDoc(_0x232574,{'type':_0x5c3b4d,'player':_0x3fc369,'opponent':_0x4bd885,'previousElo':_0x1f8d0e,'newElo':_0x3753e1,'change':_0x3753e1-_0x1f8d0e,'matchResult':_0x38b0b6,'previousPosition':_0x262b01,'newPosition':_0xf95568,'rankAchieved':_0x3c100,'matchId':_0x2b90cf,'timestamp':_0x36e3c3}),console[_0x4f6b9b(0x15b)]('D2\x20ELO\x20history\x20recorded\x20for\x20'+_0x3fc369),!![];}catch(_0x71b86d){console[_0x4f6b9b(0x14b)](_0x4f6b9b(0x155),_0x71b86d);throw _0x71b86d;}}function a12_0x7e95(){const _0xaedfa3=['eloHistoryD2','desc','trace','winnerId','Gold','data','previousElo','return\x20(function()\x20','all','error','console','newElo','playersD2','loserUsername','Unknown\x20Player','winnerUsername','constructor','timestamp','apply','Error\x20recording\x20D2\x20ELO\x20history:','info','bind','Silver','approvedMatchesD2','Bronze','log','docs'];a12_0x7e95=function(){return _0xaedfa3;};return a12_0x7e95();}export async function getEloHistoryD2(_0x89037f=0x14){const _0xcd6dd2=a12_0xfe337;try{const _0x1c4589=collection(db,_0xcd6dd2(0x142));let _0x307335;lastVisibleD2?_0x307335=query(_0x1c4589,orderBy('timestamp','desc'),startAfter(lastVisibleD2),limit(_0x89037f)):_0x307335=query(_0x1c4589,orderBy('timestamp',_0xcd6dd2(0x143)),limit(_0x89037f));const _0x19461d=await getDocs(_0x307335);if(_0x19461d['empty'])return{'entries':[],'hasMore':![]};lastVisibleD2=_0x19461d[_0xcd6dd2(0x15c)][_0x19461d['docs']['length']-0x1];const _0x1dfdee=_0x19461d['docs']['map'](async _0x17fa69=>{const _0x19bba8=_0xcd6dd2,_0x4f134e=_0x17fa69[_0x19bba8(0x147)](),[_0x58d54d,_0x3738cb]=await Promise[_0x19bba8(0x14a)]([getUsernameByIdD2(_0x4f134e['player']),getUsernameByIdD2(_0x4f134e['opponent'])]);return{..._0x4f134e,'playerUsername':_0x58d54d,'opponentUsername':_0x3738cb,'change':_0x4f134e[_0x19bba8(0x14d)]-_0x4f134e[_0x19bba8(0x148)],'timestamp':_0x4f134e[_0x19bba8(0x153)]};}),_0x1040d3=await Promise['all'](_0x1dfdee);return{'entries':_0x1040d3,'hasMore':_0x19461d['size']===_0x89037f};}catch(_0x3945a0){console['error']('Error\x20fetching\x20D2\x20ELO\x20history:',_0x3945a0);throw _0x3945a0;}}export function resetPaginationD2(){lastVisibleD2=null;}
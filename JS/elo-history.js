const a16_0x3fda59=a16_0x468c,a16_0x1aadae=(function(){let _0x3a5f1c=!![];return function(_0xdc15e5,_0x421287){const _0x29d2db=_0x3a5f1c?function(){const _0x4f639b=a16_0x468c;if(_0x421287){const _0x4d3855=_0x421287[_0x4f639b(0x184)](_0xdc15e5,arguments);return _0x421287=null,_0x4d3855;}}:function(){};return _0x3a5f1c=![],_0x29d2db;};}()),a16_0x25dc23=a16_0x1aadae(this,function(){const _0x5eeb10=a16_0x468c,_0x4ce86c=function(){let _0x4b7326;try{_0x4b7326=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x3df32e){_0x4b7326=window;}return _0x4b7326;},_0x47da76=_0x4ce86c(),_0x4d6f4e=_0x47da76['console']=_0x47da76['console']||{},_0x5504f8=['log',_0x5eeb10(0x183),_0x5eeb10(0x18f),_0x5eeb10(0x18c),'exception','table','trace'];for(let _0x5d673b=0x0;_0x5d673b<_0x5504f8[_0x5eeb10(0x18e)];_0x5d673b++){const _0x588a4f=a16_0x1aadae['constructor'][_0x5eeb10(0x192)]['bind'](a16_0x1aadae),_0x45362a=_0x5504f8[_0x5d673b],_0xe14f7b=_0x4d6f4e[_0x45362a]||_0x588a4f;_0x588a4f['__proto__']=a16_0x1aadae[_0x5eeb10(0x17f)](a16_0x1aadae),_0x588a4f[_0x5eeb10(0x18a)]=_0xe14f7b['toString'][_0x5eeb10(0x17f)](_0xe14f7b),_0x4d6f4e[_0x45362a]=_0x588a4f;}});a16_0x25dc23();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS=[{'name':'Gold','elo':0x708},{'name':a16_0x3fda59(0x18b),'elo':0x640},{'name':'Bronze','elo':0x578},{'name':'Unranked','elo':0x4b0}];function a16_0x468c(_0x1cf418,_0x347c5b){const _0x25dc23=a16_0x8e50();return a16_0x468c=function(_0x1aadae,_0x4b68e8){_0x1aadae=_0x1aadae-0x17e;let _0x8e508d=_0x25dc23[_0x1aadae];return _0x8e508d;},a16_0x468c(_0x1cf418,_0x347c5b);}async function getUsernameById(_0xd8f71f){const _0x390efd=a16_0x3fda59;try{if(!_0xd8f71f)return'Unknown\x20Player';const _0x22d277=await getDoc(doc(db,_0x390efd(0x190),_0xd8f71f));return _0x22d277['exists']()?_0x22d277['data']()['username']:'Unknown\x20Player';}catch(_0x39680e){return console['error'](_0x390efd(0x189),_0x39680e),'Unknown\x20Player';}}function a16_0x8e50(){const _0x2fe6e2=['map','bind','newElo','ELO\x20history\x20recorded\x20for\x20','all','warn','apply','Gold','desc','timestamp','Unranked','Error\x20fetching\x20username:','toString','Silver','error','data','length','info','players','demotion','prototype'];a16_0x8e50=function(){return _0x2fe6e2;};return a16_0x8e50();}export async function recordEloChange({playerId:_0x43bdd8,previousElo:_0x1ffc22,newElo:_0x5b6cce,opponentId:_0xb22e09,matchResult:_0x51800c,previousPosition:_0x351fed,newPosition:_0x2d1e05,isPromotion:isPromotion=![],isDemotion:isDemotion=![],timestamp:_0xacbd3b}){const _0x97f417=a16_0x3fda59;try{const _0x25327a=doc(collection(db,'eloHistory'));let _0x5a3bed='match';if(isPromotion)_0x5a3bed='promotion';if(isDemotion)_0x5a3bed=_0x97f417(0x191);let _0x48d652=_0x97f417(0x188);if(_0x5b6cce>=0x834)_0x48d652='Emerald';else{if(_0x5b6cce>=0x708)_0x48d652=_0x97f417(0x185);else{if(_0x5b6cce>=0x640)_0x48d652=_0x97f417(0x18b);else{if(_0x5b6cce>=0x578)_0x48d652='Bronze';}}}return await setDoc(_0x25327a,{'type':_0x5a3bed,'player':_0x43bdd8,'opponent':_0xb22e09,'previousElo':_0x1ffc22,'newElo':_0x5b6cce,'change':_0x5b6cce-_0x1ffc22,'matchResult':_0x51800c,'previousPosition':_0x351fed,'newPosition':_0x2d1e05,'rankAchieved':_0x48d652,'timestamp':_0xacbd3b}),console['log'](_0x97f417(0x181)+_0x43bdd8),!![];}catch(_0x2959c8){console['error']('Error\x20recording\x20ELO\x20history:',_0x2959c8);throw _0x2959c8;}}export async function getEloHistory(){const _0x368921=a16_0x3fda59;try{const _0x6d695f=collection(db,'eloHistory'),_0xc526b5=query(_0x6d695f,orderBy(_0x368921(0x187),_0x368921(0x186))),_0x5316f6=await getDocs(_0xc526b5),_0x345ce6=_0x5316f6['docs'][_0x368921(0x17e)](async _0x5e0432=>{const _0x3ee92f=_0x368921,_0x33f307=_0x5e0432[_0x3ee92f(0x18d)](),[_0xb3ac41,_0x10be3a]=await Promise[_0x3ee92f(0x182)]([getUsernameById(_0x33f307['player']),getUsernameById(_0x33f307['opponent'])]);return{..._0x33f307,'playerUsername':_0xb3ac41,'opponentUsername':_0x10be3a,'change':_0x33f307[_0x3ee92f(0x180)]-_0x33f307['previousElo'],'timestamp':_0x33f307['timestamp']};}),_0x28902f=await Promise['all'](_0x345ce6);return{'entries':_0x28902f};}catch(_0x3e819f){console[_0x368921(0x18c)]('Error\x20fetching\x20ELO\x20history:',_0x3e819f);throw _0x3e819f;}}export function resetPagination(){lastVisible=null;}
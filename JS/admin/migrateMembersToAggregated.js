import{initializeApp}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';function a1_0x1ce3(){const _0x2126dd=['üéâ\x20Successfully\x20migrated\x20','players','eloRating','elo','active','warn','info','‚öôÔ∏è\x20Processed\x20','size','has','\x20D1,\x20','\x20members\x20to\x20aggregated\x20collection!','aggregatedMembers','error','bind','üîÑ\x20Starting\x20migration\x20to\x20aggregated\x20members...','emerald','bronze','ladders','\x20non-participants','Unknown','üí°\x20Refresh\x20your\x20members\x20page\x20to\x20see\x20the\x20results!','commit','username','all','log','push','üöÄ\x20Executing\x20','exception','forEach'];a1_0x1ce3=function(){return _0x2126dd;};return a1_0x1ce3();}import{getFirestore,collection,getDocs,writeBatch,doc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{firebaseConfig}from'../firebase-config.js';const app=initializeApp(firebaseConfig),db=getFirestore(app);function a1_0x20db(_0xb2e8ad,_0x17d958){const _0x4ca47e=a1_0x1ce3();return a1_0x20db=function(_0x23d0bb,_0x1d50ad){_0x23d0bb=_0x23d0bb-0x176;let _0x1ce3e3=_0x4ca47e[_0x23d0bb];return _0x1ce3e3;},a1_0x20db(_0xb2e8ad,_0x17d958);}async function migrateToAggregatedMembers(){const _0x5504c2=a1_0x20db,_0x4f037b=(function(){let _0x37240d=!![];return function(_0x59715f,_0xbde70e){const _0x52e315=_0x37240d?function(){if(_0xbde70e){const _0x4be09c=_0xbde70e['apply'](_0x59715f,arguments);return _0xbde70e=null,_0x4be09c;}}:function(){};return _0x37240d=![],_0x52e315;};}()),_0x56bb64=_0x4f037b(this,function(){const _0x2b9db2=a1_0x20db;let _0x560077;try{const _0x11ef7f=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x560077=_0x11ef7f();}catch(_0x6510e0){_0x560077=window;}const _0x136841=_0x560077['console']=_0x560077['console']||{},_0x258cf4=['log',_0x2b9db2(0x17b),_0x2b9db2(0x17c),'error',_0x2b9db2(0x192),'table','trace'];for(let _0x47da92=0x0;_0x47da92<_0x258cf4['length'];_0x47da92++){const _0x128b3e=_0x4f037b['constructor']['prototype'][_0x2b9db2(0x184)](_0x4f037b),_0xb50e43=_0x258cf4[_0x47da92],_0x9d40e6=_0x136841[_0xb50e43]||_0x128b3e;_0x128b3e['__proto__']=_0x4f037b['bind'](_0x4f037b),_0x128b3e['toString']=_0x9d40e6['toString'][_0x2b9db2(0x184)](_0x9d40e6),_0x136841[_0xb50e43]=_0x128b3e;}});_0x56bb64(),console[_0x5504c2(0x18f)](_0x5504c2(0x185));try{console['log']('üì•\x20Fetching\x20all\x20collections...');const [_0x3497fe,_0x45e699,_0xe3587,_0x50b596,_0x2eee10]=await Promise['all']([getDocs(collection(db,'userProfiles')),getDocs(collection(db,_0x5504c2(0x177))),getDocs(collection(db,'playersD2')),getDocs(collection(db,'playersD3')),getDocs(collection(db,'nonParticipants'))]);console[_0x5504c2(0x18f)]('‚úÖ\x20Data\x20fetched:\x20'+_0x3497fe['size']+'\x20profiles,\x20'+_0x45e699[_0x5504c2(0x17e)]+_0x5504c2(0x180)+_0xe3587[_0x5504c2(0x17e)]+'\x20D2,\x20'+_0x50b596['size']+'\x20D3,\x20'+_0x2eee10['size']+_0x5504c2(0x189));const _0x71d759=new Map();_0x3497fe['forEach'](_0x204a99=>{_0x71d759['set'](_0x204a99['id'],_0x204a99['data']());});const _0x1a2170=new Map(),_0x3f6c6f=(_0x213890,_0x460581)=>{_0x213890['forEach'](_0x5accee=>{const _0x12842a=a1_0x20db,_0x3609cd=_0x5accee['data'](),_0x15a45a=_0x5accee['id'];!_0x1a2170[_0x12842a(0x17f)](_0x15a45a)&&_0x1a2170['set'](_0x15a45a,{'userId':_0x15a45a,'username':_0x3609cd[_0x12842a(0x18d)]||_0x3609cd['name']||_0x12842a(0x18a),'ladders':[],'isNonParticipant':![]});const _0x6b39d9=_0x1a2170['get'](_0x15a45a);_0x6b39d9['ladders'][_0x12842a(0x190)]({'ladder':_0x460581,'elo':_0x3609cd[_0x12842a(0x178)]||_0x3609cd['elo']||0x4b0,'active':_0x3609cd[_0x12842a(0x17a)]!==![]});});};_0x3f6c6f(_0x45e699,'D1'),_0x3f6c6f(_0xe3587,'D2'),_0x3f6c6f(_0x50b596,'D3'),_0x2eee10['forEach'](_0x4c6579=>{const _0x2a746d=_0x4c6579['data'](),_0x15da5e=_0x4c6579['id'];!_0x1a2170['has'](_0x15da5e)&&(_0x2a746d['username']||_0x2a746d['name'])&&_0x1a2170['set'](_0x15da5e,{'userId':_0x15da5e,'username':_0x2a746d['username']||_0x2a746d['name'],'ladders':[],'isNonParticipant':!![]});}),console['log'](_0x5504c2(0x17d)+_0x1a2170['size']+'\x20unique\x20members'),console['log']('üíæ\x20Writing\x20aggregated\x20data...');const _0x455122=[];let _0x42c6f4=writeBatch(db),_0x1044a7=0x0,_0x435719=0x0;_0x1a2170[_0x5504c2(0x193)]((_0x204dbb,_0x47777e)=>{const _0x4f9763=_0x5504c2,_0x300daf=_0x71d759['get'](_0x47777e)||{};let _0x5e08a6=0x0,_0x34d464=null;if(_0x204dbb[_0x4f9763(0x188)]['length']>0x0){const _0xa0b0ca=_0x204dbb['ladders']['sort']((_0x505f3d,_0x511574)=>_0x511574['elo']-_0x505f3d[_0x4f9763(0x179)]);_0x5e08a6=_0xa0b0ca[0x0]['elo'],_0x34d464=_0xa0b0ca[0x0]['ladder'];}const _0x5889ce={'userId':_0x47777e,'username':_0x204dbb['username'],'profileImageUrl':_0x300daf['profileImageUrl']||null,'country':_0x300daf['country']||null,'motto':_0x300daf['motto']||null,'favoriteMap':_0x300daf['favoriteMap']||null,'favoriteWeapon':_0x300daf['favoriteWeapon']||null,'isNonParticipant':_0x204dbb['isNonParticipant'],'ladders':_0x204dbb['ladders'],'primaryLadder':_0x34d464,'highestElo':_0x5e08a6,'rank':getPlayerRank(_0x5e08a6),'lastUpdated':new Date(),'migrationTimestamp':new Date()['toISOString']()},_0x47be7e=doc(collection(db,_0x4f9763(0x182)),_0x47777e);_0x42c6f4['set'](_0x47be7e,_0x5889ce),_0x1044a7++,_0x435719++,_0x1044a7>=0x1c2&&(_0x455122['push'](_0x42c6f4[_0x4f9763(0x18c)]()),_0x42c6f4=writeBatch(db),_0x1044a7=0x0,console['log']('üì¶\x20Prepared\x20batch\x20'+_0x455122['length']+'\x20('+_0x435719+'\x20members\x20processed)'));}),_0x1044a7>0x0&&_0x455122['push'](_0x42c6f4[_0x5504c2(0x18c)]()),console['log'](_0x5504c2(0x191)+_0x455122['length']+'\x20batches...'),await Promise[_0x5504c2(0x18e)](_0x455122),console[_0x5504c2(0x18f)](_0x5504c2(0x176)+_0x1a2170[_0x5504c2(0x17e)]+_0x5504c2(0x181)),console['log'](_0x5504c2(0x18b));}catch(_0x5f5209){console[_0x5504c2(0x183)]('‚ùå\x20Migration\x20failed:',_0x5f5209),_0x5f5209['code']==='permission-denied'&&console['error']('üîí\x20Permission\x20denied.\x20Make\x20sure\x20you\x27re\x20signed\x20in\x20as\x20an\x20admin\x20and\x20security\x20rules\x20allow\x20access\x20to\x20aggregatedMembers\x20collection.');}}function getPlayerRank(_0x3389a9){const _0x2c9c59=a1_0x20db;if(_0x3389a9>=0x7d0)return _0x2c9c59(0x186);if(_0x3389a9>=0x708)return'gold';if(_0x3389a9>=0x640)return'silver';if(_0x3389a9>=0x578)return _0x2c9c59(0x187);return'unranked';}migrateToAggregatedMembers();
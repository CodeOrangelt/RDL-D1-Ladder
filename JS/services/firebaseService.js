const a54_0x5ce146=a54_0x3868,a54_0x5be403=(function(){let _0xc6ceac=!![];return function(_0x139764,_0x5911bd){const _0x539fb8=_0xc6ceac?function(){if(_0x5911bd){const _0x486327=_0x5911bd['apply'](_0x139764,arguments);return _0x5911bd=null,_0x486327;}}:function(){};return _0xc6ceac=![],_0x539fb8;};}()),a54_0x2dbbb5=a54_0x5be403(this,function(){const _0x36cc34=a54_0x3868,_0x5c9764=function(){const _0x42e33d=a54_0x3868;let _0x1d47f2;try{_0x1d47f2=Function('return\x20(function()\x20'+_0x42e33d(0x8a)+');')();}catch(_0x181ced){_0x1d47f2=window;}return _0x1d47f2;},_0x38eb11=_0x5c9764(),_0x2cb635=_0x38eb11['console']=_0x38eb11[_0x36cc34(0x86)]||{},_0x3edd0f=['log','warn','info','error','exception','table','trace'];for(let _0x4999d1=0x0;_0x4999d1<_0x3edd0f[_0x36cc34(0x92)];_0x4999d1++){const _0x596307=a54_0x5be403['constructor']['prototype']['bind'](a54_0x5be403),_0x45c347=_0x3edd0f[_0x4999d1],_0x4aae0f=_0x2cb635[_0x45c347]||_0x596307;_0x596307[_0x36cc34(0x89)]=a54_0x5be403[_0x36cc34(0x90)](a54_0x5be403),_0x596307['toString']=_0x4aae0f['toString'][_0x36cc34(0x90)](_0x4aae0f),_0x2cb635[_0x45c347]=_0x596307;}});function a54_0x3868(_0x2a326c,_0xa4568b){const _0x2dbbb5=a54_0x262b();return a54_0x3868=function(_0x5be403,_0x3e1786){_0x5be403=_0x5be403-0x84;let _0x262b47=_0x2dbbb5[_0x5be403];return _0x262b47;},a54_0x3868(_0x2a326c,_0xa4568b);}a54_0x2dbbb5();import{db}from'../firebase-config.js';import{collection,doc,getDoc,getDocs,query,limit,startAfter,where,onSnapshot}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const cache={'userProfiles':new Map(),'ladderPlayers':new Map(),'matchResults':new Map(),'eloHistory':new Map()},CACHE_EXPIRY={'userProfiles':0x5*0x3c*0x3e8,'ladderPlayers':0x2*0x3c*0x3e8,'matchResults':0x1*0x3c*0x3e8,'eloHistory':0x3*0x3c*0x3e8};export const userProfilesRef=collection(db,'userProfiles');export async function fetchPaginatedData(_0xa60c07,_0x263cac=0xa,_0x5cc4ce=null){const _0x3547a8=a54_0x3868;let _0x1d5aff=query(_0xa60c07,limit(_0x263cac));_0x5cc4ce&&(_0x1d5aff=query(_0x1d5aff,startAfter(_0x5cc4ce)));const _0xbe67cc=await getDocs(_0x1d5aff),_0x364d6a=_0xbe67cc['docs'][_0xbe67cc[_0x3547a8(0x8d)]['length']-0x1];return{'data':_0xbe67cc['docs']['map'](_0x8f70fb=>({'id':_0x8f70fb['id'],..._0x8f70fb['data']()})),'lastVisible':_0x364d6a,'hasMore':_0xbe67cc['docs']['length']===_0x263cac};}export async function getUserProfile(_0x2a750b){const _0x5216b7=a54_0x3868,_0x2ab18a=cache['userProfiles'][_0x5216b7(0x94)](_0x2a750b);if(_0x2ab18a&&Date['now']()-_0x2ab18a[_0x5216b7(0x8c)]<CACHE_EXPIRY[_0x5216b7(0x93)])return _0x2ab18a['data'];const _0x119ab2=await getDoc(doc(userProfilesRef,_0x2a750b));if(_0x119ab2['exists']()){const _0x4bde08=_0x119ab2['data']();return cache['userProfiles']['set'](_0x2a750b,{'data':_0x4bde08,'timestamp':Date['now']()}),_0x4bde08;}return null;}function a54_0x262b(){const _0x4f3a69=['eloHistory','players','console','playerId','now','__proto__','{}.constructor(\x22return\x20this\x22)(\x20)','set','timestamp','docs','nonParticipants','map','bind','forEach','length','userProfiles','get','data','ladderPlayers'];a54_0x262b=function(){return _0x4f3a69;};return a54_0x262b();}export async function getLadderData(_0x597d0e=0x1){const _0x3de20f=a54_0x3868,_0x187144='division_'+_0x597d0e,_0x29255a=cache['ladderPlayers']['get'](_0x187144);if(_0x29255a&&Date['now']()-_0x29255a['timestamp']<CACHE_EXPIRY[_0x3de20f(0x96)])return _0x29255a['data'];const _0x17fdc7=_0x597d0e===0x1?'players':'playersD'+_0x597d0e,_0x16329e=collection(db,_0x17fdc7),_0x3df138=await getDocs(query(_0x16329e,limit(0x64))),_0x297a95=_0x3df138['docs'][_0x3de20f(0x8f)](_0x20dfc5=>({'id':_0x20dfc5['id'],..._0x20dfc5[_0x3de20f(0x95)]()}));return cache['ladderPlayers'][_0x3de20f(0x8b)](_0x187144,{'data':_0x297a95,'timestamp':Date[_0x3de20f(0x88)]()}),_0x297a95;}export async function getEloHistoryBatch(_0x481e5a,_0x18fd2a=0x1){const _0x18a2d6=a54_0x3868,_0x349f57=_0x18fd2a===0x1?'eloHistory':'eloHistoryD'+_0x18fd2a,_0x3a6824=collection(db,_0x349f57),_0x661c00={},_0x43902e=[];_0x481e5a[_0x18a2d6(0x91)](_0x26a033=>{const _0x3989ef=_0x18a2d6,_0x3647b8=_0x26a033+'_'+_0x18fd2a,_0x1254cf=cache['eloHistory']['get'](_0x3647b8);_0x1254cf&&Date['now']()-_0x1254cf['timestamp']<CACHE_EXPIRY[_0x3989ef(0x84)]?_0x661c00[_0x26a033]=_0x1254cf[_0x3989ef(0x95)]:_0x43902e['push'](_0x26a033);});const _0x333f93=0xa;for(let _0x3e3741=0x0;_0x3e3741<_0x43902e['length'];_0x3e3741+=_0x333f93){const _0xb6b421=_0x43902e['slice'](_0x3e3741,_0x3e3741+_0x333f93);if(_0xb6b421[_0x18a2d6(0x92)]>0x0)try{const _0x773d5f=query(_0x3a6824,where('playerId','in',_0xb6b421),limit(0x64)),_0xa77e8b=await getDocs(_0x773d5f);_0xa77e8b['docs']['forEach'](_0x22ae9=>{const _0x39d58a=_0x18a2d6,_0x1381f4=_0x22ae9['data'](),_0x285e77=_0x1381f4[_0x39d58a(0x87)];if(!_0x661c00[_0x285e77])_0x661c00[_0x285e77]=[];_0x661c00[_0x285e77]['push'](_0x1381f4);const _0x59fa13=_0x285e77+'_'+_0x18fd2a;cache[_0x39d58a(0x84)][_0x39d58a(0x8b)](_0x59fa13,{'data':_0x661c00[_0x285e77],'timestamp':Date[_0x39d58a(0x88)]()});});}catch(_0x4b3b22){console['error']('Error\x20fetching\x20batch\x20ELO\x20history:',_0x4b3b22);}}return _0x661c00;}let usernameCache=new Map(),usernameCacheTimestamp=Date[a54_0x5ce146(0x88)]();export function setupEfficientListener(_0x898952,_0x1e00d6=[],_0x8ddab7){const _0x590d62=collection(db,_0x898952),_0x560b6c=query(_0x590d62,..._0x1e00d6),_0x2ee7b7=onSnapshot(_0x560b6c,_0x184409=>{const _0x411b28=a54_0x3868,_0x56fda2=_0x184409['docChanges']()['map'](_0x549ee9=>({'type':_0x549ee9['type'],'id':_0x549ee9['doc']['id'],'data':_0x549ee9['doc']['data']()}));_0x56fda2[_0x411b28(0x92)]>0x0&&_0x8ddab7(_0x56fda2,_0x184409['docs']);});return _0x2ee7b7;}export async function bulkResolveUsernames(_0x381cc9){const _0x606df7=a54_0x5ce146,_0x288f42=new Map();if(!_0x381cc9||_0x381cc9['length']===0x0)return _0x288f42;const _0x58fbcc=[_0x606df7(0x85),'playersD2','playersD3',_0x606df7(0x8e)];for(const _0x2fbcb0 of _0x58fbcc){const _0x5ceab0=collection(db,_0x2fbcb0),_0xe65f79=await getDocs(_0x5ceab0);_0xe65f79['forEach'](_0x40f374=>{const _0x346f37=_0x40f374['data']();_0x346f37['username']&&_0x381cc9['includes'](_0x40f374['id'])&&_0x288f42['set'](_0x40f374['id'],_0x346f37['username']);});}return _0x288f42;}
function a12_0x5af4(){const _0x24f0a2=['catch','data','signOut','console','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20class=\x22nav-username\x22>','roleName','lastChecked','uid','return\x20(function()\x20','username','filter','User','currentUser','display','userProfiles','exists','toLowerCase','email','log','Error\x20in\x20full\x20auth\x20update:','block','table','admin','playersD3','innerHTML','bind','__proto__','split','prototype','</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username=','click','isAdmin','\x20by\x20UID:','auth-section','role','pending','size','a[href]','error','Error\x20checking\x20','join','\x20in\x20','style','Found\x20user\x20in\x20','slice','includes'];a12_0x5af4=function(){return _0x24f0a2;};return a12_0x5af4();}const a12_0x1ae32b=(function(){let _0x3355ff=!![];return function(_0x5eda64,_0x326789){const _0x15aeb8=_0x3355ff?function(){if(_0x326789){const _0x1b0acd=_0x326789['apply'](_0x5eda64,arguments);return _0x326789=null,_0x1b0acd;}}:function(){};return _0x3355ff=![],_0x15aeb8;};}()),a12_0x1350ba=a12_0x1ae32b(this,function(){const _0x5a86db=a12_0x504a;let _0x114f13;try{const _0x2fd523=Function(_0x5a86db(0x1d2)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x114f13=_0x2fd523();}catch(_0x5d2850){_0x114f13=window;}const _0x2a66df=_0x114f13[_0x5a86db(0x1cd)]=_0x114f13['console']||{},_0x4a43b6=['log','warn','info',_0x5a86db(0x1f0),'exception',_0x5a86db(0x1df),'trace'];for(let _0x1e31bc=0x0;_0x1e31bc<_0x4a43b6['length'];_0x1e31bc++){const _0x382130=a12_0x1ae32b['constructor'][_0x5a86db(0x1e6)]['bind'](a12_0x1ae32b),_0x5a3443=_0x4a43b6[_0x1e31bc],_0x5e71f3=_0x2a66df[_0x5a3443]||_0x382130;_0x382130[_0x5a86db(0x1e4)]=a12_0x1ae32b[_0x5a86db(0x1e3)](a12_0x1ae32b),_0x382130['toString']=_0x5e71f3['toString']['bind'](_0x5e71f3),_0x2a66df[_0x5a3443]=_0x382130;}});a12_0x1350ba();import{getAuth,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{doc,getDoc,collection,query,where,getDocs,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import{isAdmin}from'./admin-check.js';const ADMIN_EMAILS=['admin@ladder.com','Brian2af@outlook.com'],userCache={'uid':null,'username':null,'isAdmin':![],'hasCheckedCollections':![],'lastChecked':0x0,'role':null},invitationCache={'lastCheck':0x0,'pendingCount':0x0,'checkInterval':0x493e0};function updateInboxNotification(_0x5d8ef6){const _0x3c5133=a12_0x504a,_0x163a06=document['getElementById']('inbox-notification');_0x163a06&&(_0x5d8ef6>0x0?(_0x163a06['style'][_0x3c5133(0x1d7)]='inline-block',_0x163a06['textContent']=_0x5d8ef6>0x9?'9+':_0x5d8ef6):_0x163a06['style']['display']='none');}async function checkPendingInvitationsForCurrentUser(_0x30ac92){const _0x3e648d=a12_0x504a;try{const _0x281dc5=Date['now']();if(_0x281dc5-invitationCache['lastCheck']<invitationCache['checkInterval'])return updateInboxNotification(invitationCache['pendingCount']),invitationCache['pendingCount'];invitationCache['lastCheck']=_0x281dc5;const _0x2c7c76=collection(db,'gameInvitations'),_0x272d40=query(_0x2c7c76,where('toUserId','==',_0x30ac92),where('status','==',_0x3e648d(0x1ed)),limit(0x5)),_0xb0f97b=await getDocs(_0x272d40),_0x47eaef=_0xb0f97b[_0x3e648d(0x1ee)];return invitationCache['pendingCount']=_0x47eaef,updateInboxNotification(_0x47eaef),_0x47eaef;}catch(_0x31e50c){return console['warn']('Could\x20not\x20check\x20pending\x20invitations\x20for\x20current\x20user:',_0x31e50c),0x0;}}function updateAuthSectionImmediate(_0x3620c8,_0x15ba1d=![]){const _0x393d2f=a12_0x504a,_0x483d2e=document['getElementById'](_0x393d2f(0x1eb));if(!_0x483d2e)return;if(_0x3620c8&&_0x15ba1d)document['querySelectorAll']('.admin-only')['forEach'](_0x196df7=>{const _0xb44bb1=_0x393d2f;_0x196df7['style'][_0xb44bb1(0x1d7)]=_0xb44bb1(0x1de);});else!_0x3620c8&&document['querySelectorAll']('.admin-only')['forEach'](_0x4e3b34=>{_0x4e3b34['style']['display']='none';});if(_0x3620c8){const _0x387a55=userCache['username']||(_0x3620c8[_0x393d2f(0x1db)]?_0x3620c8['email']['split']('@')[0x0]:_0x393d2f(0x1d5)),_0x857c19=userCache['role']?'\x20('+userCache['role']+')':_0x15ba1d?'\x20(Admin)':'';_0x483d2e['innerHTML']=_0x393d2f(0x1ce)+_0x387a55+_0x857c19+_0x393d2f(0x1e7)+encodeURIComponent(_0x387a55)+'\x22>Profile</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./inbox.html\x22\x20class=\x22nav-notification\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Inbox\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22inbox-notification\x22\x20class=\x22notification-dot\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22members.html\x22>Members</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./redeem.html\x22><i\x20class=\x22fas\x20fa-gift\x22></i>\x20Redeem</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20id=\x22logout-link\x22>Sign\x20Out</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';const _0x5b7f75=document['getElementById']('logout-link');_0x5b7f75&&_0x5b7f75['addEventListener']('click',_0x515a15=>{const _0x54ca16=_0x393d2f;_0x515a15['preventDefault']();const _0x444b81=getAuth();updateAuthSectionImmediate(null),_0x444b81[_0x54ca16(0x1cc)]()[_0x54ca16(0x1ca)](_0x4a09d8=>{console['error']('Error\x20signing\x20out:',_0x4a09d8);});}),_0x3620c8['uid']&&setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0x3620c8['uid']);},0x3e8);}else _0x483d2e[_0x393d2f(0x1e2)]='<a\x20href=\x22login.html\x22\x20class=\x22login-link\x22>Login</a>';}async function checkAdminRoles(_0x6aa0e4){const _0x5d301b=a12_0x504a;if(!_0x6aa0e4||!_0x6aa0e4['email'])return{'isAdmin':![],'role':null};try{console['log']('Checking\x20roles\x20for\x20user:\x20'+_0x6aa0e4[_0x5d301b(0x1db)]);const _0x395fee=['players','playersD2',_0x5d301b(0x1e1),'nonParticipants','userProfiles'],_0xe52855=['council','creative\x20lead','owner',_0x5d301b(0x1e0)];for(const _0x57da04 of _0x395fee){try{const _0x2a9e27=doc(db,_0x57da04,_0x6aa0e4['uid']),_0x347fea=await getDoc(_0x2a9e27);if(_0x347fea['exists']()){const _0x33faaf=_0x347fea[_0x5d301b(0x1cb)]();console['log'](_0x5d301b(0x1f5)+_0x57da04+'\x20by\x20UID:',_0x33faaf);let _0x59d242=(_0x33faaf['roleName']||_0x33faaf['role']||'')['toLowerCase'](),_0x5c4e38=_0x33faaf[_0x5d301b(0x1cf)]||_0x33faaf[_0x5d301b(0x1ec)]||'';if(_0x59d242&&_0xe52855[_0x5d301b(0x1f7)](_0x59d242)){console[_0x5d301b(0x1dc)]('Found\x20admin\x20role:\x20'+_0x59d242+_0x5d301b(0x1f3)+_0x57da04);const _0x371768=_0x5c4e38['split']('\x20')['map'](_0x5390dd=>_0x5390dd['charAt'](0x0)['toUpperCase']()+_0x5390dd[_0x5d301b(0x1f6)](0x1)[_0x5d301b(0x1da)]())[_0x5d301b(0x1f2)]('\x20');return{'isAdmin':!![],'role':_0x371768};}}}catch(_0x573bcf){console['error'](_0x5d301b(0x1f1)+_0x57da04+_0x5d301b(0x1ea),_0x573bcf);}}for(const _0x528006 of _0x395fee){try{const _0x5ece05=collection(db,_0x528006);let _0x2fccf6=query(_0x5ece05,where('email','==',_0x6aa0e4[_0x5d301b(0x1db)])),_0x4a331d=await getDocs(_0x2fccf6);_0x4a331d['empty']&&(_0x2fccf6=query(_0x5ece05,where('email','==',_0x6aa0e4['email']['toLowerCase']())),_0x4a331d=await getDocs(_0x2fccf6));if(!_0x4a331d['empty']){const _0x31e3b5=_0x4a331d['docs'][0x0]['data']();console['log']('Found\x20user\x20in\x20'+_0x528006+'\x20by\x20email:',_0x31e3b5);let _0x1f0106=(_0x31e3b5['roleName']||_0x31e3b5['role']||'')['toLowerCase'](),_0x14537e=_0x31e3b5['roleName']||_0x31e3b5[_0x5d301b(0x1ec)]||'';if(_0x1f0106&&_0xe52855['includes'](_0x1f0106)){console['log']('Found\x20admin\x20role:\x20'+_0x1f0106+'\x20in\x20'+_0x528006);const _0x5d58e4=_0x14537e[_0x5d301b(0x1e5)]('\x20')['map'](_0x45a4b0=>_0x45a4b0['charAt'](0x0)['toUpperCase']()+_0x45a4b0['slice'](0x1)['toLowerCase']())['join']('\x20');return{'isAdmin':!![],'role':_0x5d58e4};}}}catch(_0x446605){console[_0x5d301b(0x1f0)]('Error\x20checking\x20'+_0x528006+'\x20by\x20email:',_0x446605);}}return console['log']('No\x20admin\x20roles\x20found\x20for\x20user'),{'isAdmin':![],'role':null};}catch(_0xc13287){return console['error']('Error\x20in\x20checkAdminRoles:',_0xc13287),{'isAdmin':![],'role':null};}}async function updateAuthSection(_0x36b316){const _0x286c34=a12_0x504a,_0x20e937=_0x36b316&&isAdmin(_0x36b316['email']);updateAuthSectionImmediate(_0x36b316,_0x20e937);if(!_0x36b316){userCache['uid']=null,userCache[_0x286c34(0x1d3)]=null,userCache[_0x286c34(0x1e9)]=![],userCache['hasCheckedCollections']=![],userCache['role']=null;return;}const _0x4ca950=Date['now']();if(_0x36b316['uid']===userCache['uid']&&userCache['hasCheckedCollections']&&_0x4ca950-userCache[_0x286c34(0x1d0)]<0x493e0)return;try{userCache[_0x286c34(0x1d1)]=_0x36b316['uid'],userCache['lastChecked']=_0x4ca950;const _0x19536e=isAdmin(_0x36b316['email']);userCache['isAdmin']=_0x19536e;if(!_0x19536e){const {isAdmin:_0x269ff5,role:_0x361594}=await checkAdminRoles(_0x36b316);userCache[_0x286c34(0x1e9)]=_0x269ff5,userCache['role']=_0x361594,_0x269ff5&&(document['querySelectorAll']('.admin-only')['forEach'](_0x358b3a=>{const _0x56d4b3=_0x286c34;_0x358b3a[_0x56d4b3(0x1f4)]['display']='block';}),updateAuthSectionImmediate(_0x36b316,!![]));}const _0x3fde15=['players','playersD2','playersD3','playersDuos','playersCTF','nonParticipants',_0x286c34(0x1d8)],_0xe8286c=_0x3fde15['map'](_0x391084=>getDoc(doc(db,_0x391084,_0x36b316['uid']))['then'](_0x17ec11=>_0x17ec11[_0x286c34(0x1d9)]()?{'collection':_0x391084,'data':_0x17ec11['data']()}:null)[_0x286c34(0x1ca)](()=>null)),_0x587ccf=await Promise['all'](_0xe8286c),_0x7ea8e3=_0x587ccf[_0x286c34(0x1d4)](_0xad90ba=>_0xad90ba!==null);let _0x20ce51=null;for(const _0x1a5703 of _0x7ea8e3){if(_0x1a5703['data']['username']){_0x20ce51=_0x1a5703['data'][_0x286c34(0x1d3)];break;}}userCache['username']=_0x20ce51||(_0x36b316['email']?_0x36b316[_0x286c34(0x1db)]['split']('@')[0x0]:'User'),userCache['hasCheckedCollections']=!![],updateAuthSectionImmediate(_0x36b316,userCache['isAdmin']),setTimeout(()=>{const _0x2445ab=_0x286c34;checkPendingInvitationsForCurrentUser(_0x36b316[_0x2445ab(0x1d1)]);},0x1f4);}catch(_0x1d3e37){console[_0x286c34(0x1f0)](_0x286c34(0x1dd),_0x1d3e37);}}document['addEventListener']('DOMContentLoaded',()=>{const _0x5ef140=a12_0x504a,_0x55b606=getAuth();onAuthStateChanged(_0x55b606,async _0x5906da=>{const _0x1f0612=a12_0x504a;await updateAuthSection(_0x5906da),_0x5906da&&checkPendingInvitationsForCurrentUser(_0x5906da[_0x1f0612(0x1d1)]);}),document['addEventListener']('visibilitychange',()=>{const _0x7b8201=a12_0x504a;!document['hidden']&&_0x55b606[_0x7b8201(0x1d6)]&&checkPendingInvitationsForCurrentUser(_0x55b606[_0x7b8201(0x1d6)][_0x7b8201(0x1d1)]);}),document['addEventListener'](_0x5ef140(0x1e8),_0x30b212=>{const _0x412fd3=_0x5ef140;_0x30b212['target']['closest'](_0x412fd3(0x1ef))&&_0x55b606['currentUser']&&checkPendingInvitationsForCurrentUser(_0x55b606['currentUser']['uid']);});});function a12_0x504a(_0x288452,_0x181705){const _0x1350ba=a12_0x5af4();return a12_0x504a=function(_0x1ae32b,_0x19780a){_0x1ae32b=_0x1ae32b-0x1ca;let _0x5af45d=_0x1350ba[_0x1ae32b];return _0x5af45d;},a12_0x504a(_0x288452,_0x181705);}export{updateAuthSection};
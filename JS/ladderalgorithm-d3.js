(function(_0xf72f00,_0x48c818){const _0x290120=a29_0x3dcf,_0x50db70=_0xf72f00();while(!![]){try{const _0x531433=-parseInt(_0x290120(0x161))/0x1*(-parseInt(_0x290120(0x15f))/0x2)+parseInt(_0x290120(0x177))/0x3+parseInt(_0x290120(0x181))/0x4*(-parseInt(_0x290120(0x162))/0x5)+parseInt(_0x290120(0x165))/0x6+-parseInt(_0x290120(0x196))/0x7+parseInt(_0x290120(0x169))/0x8*(-parseInt(_0x290120(0x17c))/0x9)+-parseInt(_0x290120(0x168))/0xa*(-parseInt(_0x290120(0x191))/0xb);if(_0x531433===_0x48c818)break;else _0x50db70['push'](_0x50db70['shift']());}catch(_0x5e60c1){_0x50db70['push'](_0x50db70['shift']());}}}(a29_0x33a7,0x6bd3a));const a29_0x4f898f=(function(){let _0x195b6e=!![];return function(_0x3aadda,_0x12cf77){const _0xb9035e=_0x195b6e?function(){if(_0x12cf77){const _0x16330c=_0x12cf77['apply'](_0x3aadda,arguments);return _0x12cf77=null,_0x16330c;}}:function(){};return _0x195b6e=![],_0xb9035e;};}()),a29_0x396635=a29_0x4f898f(this,function(){const _0x1c7c5a=a29_0x3dcf;return a29_0x396635['toString']()[_0x1c7c5a(0x184)](_0x1c7c5a(0x187))['toString']()[_0x1c7c5a(0x171)](a29_0x396635)[_0x1c7c5a(0x184)](_0x1c7c5a(0x187));});a29_0x396635();const a29_0x567f1a=(function(){let _0x23ebb2=!![];return function(_0x201e04,_0x205608){const _0x2bb469=_0x23ebb2?function(){const _0x250df9=a29_0x3dcf;if(_0x205608){const _0x186794=_0x205608[_0x250df9(0x163)](_0x201e04,arguments);return _0x205608=null,_0x186794;}}:function(){};return _0x23ebb2=![],_0x2bb469;};}()),a29_0x533bac=a29_0x567f1a(this,function(){const _0x295abf=a29_0x3dcf,_0x384f52=function(){const _0xa043b5=a29_0x3dcf;let _0x1677f5;try{_0x1677f5=Function('return\x20(function()\x20'+_0xa043b5(0x160)+');')();}catch(_0x518042){_0x1677f5=window;}return _0x1677f5;},_0x3e7913=_0x384f52(),_0x35cde5=_0x3e7913[_0x295abf(0x173)]=_0x3e7913[_0x295abf(0x173)]||{},_0x221a59=[_0x295abf(0x18b),_0x295abf(0x164),_0x295abf(0x174),_0x295abf(0x18d),_0x295abf(0x17e),'table',_0x295abf(0x185)];for(let _0x18e06a=0x0;_0x18e06a<_0x221a59[_0x295abf(0x16f)];_0x18e06a++){const _0x42f1f9=a29_0x567f1a[_0x295abf(0x171)]['prototype'][_0x295abf(0x192)](a29_0x567f1a),_0xee1a90=_0x221a59[_0x18e06a],_0x56d33b=_0x35cde5[_0xee1a90]||_0x42f1f9;_0x42f1f9['__proto__']=a29_0x567f1a[_0x295abf(0x192)](a29_0x567f1a),_0x42f1f9[_0x295abf(0x16d)]=_0x56d33b[_0x295abf(0x16d)]['bind'](_0x56d33b),_0x35cde5[_0xee1a90]=_0x42f1f9;}});a29_0x533bac();function a29_0x33a7(){const _0x2ef77d=['9872467WwbrZJ','bind','win','Error\x20in\x20approveReportD3:','D3\x20Match\x20moved\x20to\x20approved\x20collection','4572057jMaLRl','D3\x20Report\x20not\x20found\x20with\x20ID:','username','MAX_SAFE_INTEGER','One\x20or\x20both\x20D3\x20players\x20not\x20found','16qsMhug','{}.constructor(\x22return\x20this\x22)(\x20)','99658YtyXUl','3630935igFKUR','apply','warn','3900738VsXoPz','exists','No\x20user\x20logged\x20in','10bRiAgr','8gqAKgz','position','round','uid','toString','approvedMatchesD3','length','Could\x20not\x20find\x20D3\x20player\x20documents','constructor','playersD3','console','info','D3\x20ELO\x20ratings\x20updated\x20successfully','eloRating','9903rTFGmg','data','Starting\x20approveReportD3\x20function\x20with:','winnerUsername','currentUser','4744701pckYKH','D3\x20Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked','exception','empty','D3\x20Report\x20data:','4uATfxD','update','docs','search','trace','You\x20must\x20be\x20logged\x20in\x20to\x20approve\x20D3\x20matches','(((.+)+)+)+$','all','loss','Current\x20username:','log','pendingMatchesD3','error','Current\x20user:','pow','D3\x20Match\x20successfully\x20approved\x20and\x20ELO\x20updated'];a29_0x33a7=function(){return _0x2ef77d;};return a29_0x33a7();}import{addDoc,updateDoc,serverTimestamp,collection,doc,getDoc,getDocs,query,where,setDoc,deleteDoc,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';import{recordEloChangeD3}from'./elo-history-d3.js';function a29_0x3dcf(_0x5ce7b7,_0x10e109){const _0x36e8eb=a29_0x33a7();return a29_0x3dcf=function(_0x533bac,_0x567f1a){_0x533bac=_0x533bac-0x15e;let _0x597803=_0x36e8eb[_0x533bac];return _0x597803;},a29_0x3dcf(_0x5ce7b7,_0x10e109);}export function calculateEloD3(_0x22bea7,_0x5b4ae5,_0x5cc958=0x20){const _0xb48666=a29_0x3dcf,_0x11458e=0x1/(0x1+Math['pow'](0xa,(_0x5b4ae5-_0x22bea7)/0x190)),_0x3211c2=0x1/(0x1+Math[_0xb48666(0x18f)](0xa,(_0x22bea7-_0x5b4ae5)/0x190)),_0x7b7eb7=_0x22bea7+_0x5cc958*(0x1-_0x11458e),_0x349be2=_0x5b4ae5+_0x5cc958*(0x0-_0x3211c2);return{'newWinnerRating':Math[_0xb48666(0x16b)](_0x7b7eb7),'newLoserRating':Math[_0xb48666(0x16b)](_0x349be2)};}export async function updateEloRatingsD3(_0x2a4503,_0x22261b,_0x173462){const _0x4604ff=a29_0x3dcf;try{const _0x19662e=writeBatch(db),_0x2926a4=doc(db,_0x4604ff(0x172),_0x2a4503),_0x3ed118=doc(db,'playersD3',_0x22261b),[_0x5f3817,_0x50fbf2]=await Promise['all']([getDoc(_0x2926a4),getDoc(_0x3ed118)]);if(!_0x5f3817['exists']()||!_0x50fbf2['exists']())throw new Error(_0x4604ff(0x15e));const _0x23930a=_0x5f3817[_0x4604ff(0x178)](),_0x709d43=_0x50fbf2[_0x4604ff(0x178)](),_0x100ed0=_0x23930a[_0x4604ff(0x16a)]||Number[_0x4604ff(0x199)],_0x33a454=_0x709d43[_0x4604ff(0x16a)]||Number[_0x4604ff(0x199)],{newWinnerRating:_0x59c0c2,newLoserRating:_0x239370}=calculateEloD3(_0x23930a['eloRating']||0x4b0,_0x709d43[_0x4604ff(0x176)]||0x4b0);let _0x225e00=_0x100ed0,_0x34ef5c=_0x33a454;if(_0x100ed0>_0x33a454){console[_0x4604ff(0x18b)](_0x4604ff(0x17d)),_0x225e00=_0x33a454,_0x34ef5c=_0x33a454+0x1;const _0x1d296f=query(collection(db,_0x4604ff(0x172)),where('position','>',_0x33a454),where(_0x4604ff(0x16a),'<',_0x100ed0)),_0x1b5089=await getDocs(_0x1d296f);for(const _0x5b84a6 of _0x1b5089[_0x4604ff(0x183)]){_0x5b84a6['id']!==_0x2a4503&&_0x5b84a6['id']!==_0x22261b&&_0x19662e['update'](doc(db,_0x4604ff(0x172),_0x5b84a6['id']),{'position':_0x5b84a6[_0x4604ff(0x178)]()[_0x4604ff(0x16a)]+0x1});}}else console[_0x4604ff(0x18b)]('D3\x20Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions');return _0x19662e[_0x4604ff(0x182)](_0x2926a4,{'eloRating':_0x59c0c2,'lastMatchDate':serverTimestamp(),'position':_0x225e00,'lastMatchId':_0x173462}),_0x19662e[_0x4604ff(0x182)](_0x3ed118,{'eloRating':_0x239370,'lastMatchDate':serverTimestamp(),'position':_0x34ef5c,'lastMatchId':_0x173462}),await _0x19662e['commit'](),console[_0x4604ff(0x18b)](_0x4604ff(0x175)),await Promise[_0x4604ff(0x188)]([recordEloChangeD3({'playerId':_0x2a4503,'previousElo':_0x23930a[_0x4604ff(0x176)]||0x4b0,'newElo':_0x59c0c2,'opponentId':_0x22261b,'matchResult':_0x4604ff(0x193),'previousPosition':_0x100ed0,'newPosition':_0x225e00,'isPromotion':_0x225e00<_0x100ed0,'matchId':_0x173462,'timestamp':serverTimestamp()}),recordEloChangeD3({'playerId':_0x22261b,'previousElo':_0x709d43[_0x4604ff(0x176)]||0x4b0,'newElo':_0x239370,'opponentId':_0x2a4503,'matchResult':_0x4604ff(0x189),'previousPosition':_0x33a454,'newPosition':_0x34ef5c,'isDemotion':_0x34ef5c>_0x33a454,'matchId':_0x173462,'timestamp':serverTimestamp()})]),!![];}catch(_0x13be28){console['error']('Error\x20in\x20updateEloRatingsD3:',_0x13be28);throw _0x13be28;}}export async function approveReportD3(_0x59a303,_0x524b68,_0x3c50ae,_0x339fca){const _0x5b142b=a29_0x3dcf;try{console['log'](_0x5b142b(0x179),{'reportId':_0x59a303,'winnerScore':_0x524b68,'winnerSuicides':_0x3c50ae,'winnerComment':_0x339fca});const _0x5030d5=auth[_0x5b142b(0x17b)];if(!_0x5030d5){console[_0x5b142b(0x18b)](_0x5b142b(0x167));throw new Error(_0x5b142b(0x186));}console['log'](_0x5b142b(0x18e),_0x5030d5['email']);const _0x3a2b91=await getDoc(doc(db,_0x5b142b(0x172),_0x5030d5[_0x5b142b(0x16c)])),_0x51ff69=_0x3a2b91[_0x5b142b(0x166)]()?_0x3a2b91[_0x5b142b(0x178)]()['username']:null;console[_0x5b142b(0x18b)](_0x5b142b(0x18a),_0x51ff69);const _0x3c86a=doc(db,_0x5b142b(0x18c),_0x59a303),_0xac263f=await getDoc(_0x3c86a);if(!_0xac263f[_0x5b142b(0x166)]()){console[_0x5b142b(0x18b)](_0x5b142b(0x197),_0x59a303);throw new Error('D3\x20match\x20report\x20not\x20found');}const _0x1a2738=_0xac263f[_0x5b142b(0x178)]();console['log'](_0x5b142b(0x180),_0x1a2738);if(_0x51ff69!==_0x1a2738[_0x5b142b(0x17a)])throw new Error('Only\x20the\x20winner\x20can\x20approve\x20D3\x20matches');const _0x422e79={..._0x1a2738,'winnerScore':_0x524b68,'winnerSuicides':_0x3c50ae,'winnerComment':_0x339fca,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':_0x51ff69,'createdAt':_0x1a2738['createdAt']||serverTimestamp(),'winnerUsername':_0x1a2738[_0x5b142b(0x17a)],'loserUsername':_0x1a2738['loserUsername']};await setDoc(doc(db,_0x5b142b(0x16e),_0x59a303),_0x422e79),await deleteDoc(_0x3c86a),console['log'](_0x5b142b(0x195));const [_0x26433e,_0x43643d]=await Promise['all']([getDocs(query(collection(db,_0x5b142b(0x172)),where('username','==',_0x1a2738[_0x5b142b(0x17a)]))),getDocs(query(collection(db,'playersD3'),where(_0x5b142b(0x198),'==',_0x1a2738['loserUsername'])))]);if(_0x26433e[_0x5b142b(0x17f)]||_0x43643d['empty'])throw new Error(_0x5b142b(0x170));const _0x2e704c=_0x26433e[_0x5b142b(0x183)][0x0]['id'],_0x3291dc=_0x43643d[_0x5b142b(0x183)][0x0]['id'];return await updateEloRatingsD3(_0x2e704c,_0x3291dc,_0x59a303),console[_0x5b142b(0x18b)](_0x5b142b(0x190)),!![];}catch(_0x403418){console[_0x5b142b(0x18d)](_0x5b142b(0x194),_0x403418);throw _0x403418;}}
const a56_0x4cf825=(function(){let _0x184dce=!![];return function(_0x59679e,_0x1266fb){const _0x5e9e82=_0x184dce?function(){if(_0x1266fb){const _0x406754=_0x1266fb['apply'](_0x59679e,arguments);return _0x1266fb=null,_0x406754;}}:function(){};return _0x184dce=![],_0x5e9e82;};}()),a56_0x2f5af3=a56_0x4cf825(this,function(){const _0x5a86d7=a56_0x3f39,_0x4814e1=function(){const _0x358ddd=a56_0x3f39;let _0xbf7b34;try{_0xbf7b34=Function('return\x20(function()\x20'+_0x358ddd(0x13d)+');')();}catch(_0x4c1708){_0xbf7b34=window;}return _0xbf7b34;},_0x574322=_0x4814e1(),_0x508a51=_0x574322['console']=_0x574322['console']||{},_0x1c21a8=['log','warn','info',_0x5a86d7(0x135),'exception',_0x5a86d7(0x13b),'trace'];for(let _0x57e7d6=0x0;_0x57e7d6<_0x1c21a8[_0x5a86d7(0x12a)];_0x57e7d6++){const _0x23e0e3=a56_0x4cf825['constructor']['prototype']['bind'](a56_0x4cf825),_0x39c4c0=_0x1c21a8[_0x57e7d6],_0x2fbc1f=_0x508a51[_0x39c4c0]||_0x23e0e3;_0x23e0e3['__proto__']=a56_0x4cf825['bind'](a56_0x4cf825),_0x23e0e3['toString']=_0x2fbc1f['toString']['bind'](_0x2fbc1f),_0x508a51[_0x39c4c0]=_0x23e0e3;}});a56_0x2f5af3();function a56_0x5c59(){const _0x17f776=['eloHistoryD','length','doc','includes','set','data','type','now','userProfiles','ladderPlayers','push','playersD','error','slice','docs','Error\x20fetching\x20batch\x20ELO\x20history:','nonParticipants','playersD3','table','docChanges','{}.constructor(\x22return\x20this\x22)(\x20)'];a56_0x5c59=function(){return _0x17f776;};return a56_0x5c59();}import{db}from'../firebase-config.js';import{collection,doc,getDoc,getDocs,query,limit,startAfter,where,onSnapshot}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const cache={'userProfiles':new Map(),'ladderPlayers':new Map(),'matchResults':new Map(),'eloHistory':new Map()},CACHE_EXPIRY={'userProfiles':0x5*0x3c*0x3e8,'ladderPlayers':0x2*0x3c*0x3e8,'matchResults':0x1*0x3c*0x3e8,'eloHistory':0x3*0x3c*0x3e8};export const userProfilesRef=collection(db,'userProfiles');export async function fetchPaginatedData(_0x40b6d7,_0x28df2a=0xa,_0x243d2c=null){const _0x4d9fa9=a56_0x3f39;let _0x2bdc49=query(_0x40b6d7,limit(_0x28df2a));_0x243d2c&&(_0x2bdc49=query(_0x2bdc49,startAfter(_0x243d2c)));const _0x5235de=await getDocs(_0x2bdc49),_0x4c02a3=_0x5235de['docs'][_0x5235de['docs']['length']-0x1];return{'data':_0x5235de[_0x4d9fa9(0x137)]['map'](_0x2a19f1=>({'id':_0x2a19f1['id'],..._0x2a19f1['data']()})),'lastVisible':_0x4c02a3,'hasMore':_0x5235de[_0x4d9fa9(0x137)]['length']===_0x28df2a};}export async function getUserProfile(_0x10351d){const _0x31ccde=a56_0x3f39,_0x122fa2=cache['userProfiles']['get'](_0x10351d);if(_0x122fa2&&Date['now']()-_0x122fa2['timestamp']<CACHE_EXPIRY['userProfiles'])return _0x122fa2[_0x31ccde(0x12e)];const _0x43210e=await getDoc(doc(userProfilesRef,_0x10351d));if(_0x43210e['exists']()){const _0x3d5bda=_0x43210e['data']();return cache[_0x31ccde(0x131)]['set'](_0x10351d,{'data':_0x3d5bda,'timestamp':Date[_0x31ccde(0x130)]()}),_0x3d5bda;}return null;}export async function getLadderData(_0x5926b5=0x1){const _0x140334=a56_0x3f39,_0x3cb050='division_'+_0x5926b5,_0x2ac1ca=cache['ladderPlayers']['get'](_0x3cb050);if(_0x2ac1ca&&Date['now']()-_0x2ac1ca['timestamp']<CACHE_EXPIRY[_0x140334(0x132)])return _0x2ac1ca['data'];const _0x13b8b4=_0x5926b5===0x1?'players':_0x140334(0x134)+_0x5926b5,_0x7b5b0a=collection(db,_0x13b8b4),_0x275a1e=await getDocs(query(_0x7b5b0a,limit(0x64))),_0x1e4dbd=_0x275a1e['docs']['map'](_0x380d64=>({'id':_0x380d64['id'],..._0x380d64['data']()}));return cache['ladderPlayers'][_0x140334(0x12d)](_0x3cb050,{'data':_0x1e4dbd,'timestamp':Date[_0x140334(0x130)]()}),_0x1e4dbd;}export async function getEloHistoryBatch(_0x299976,_0x32f965=0x1){const _0x5ad552=a56_0x3f39,_0x57b103=_0x32f965===0x1?'eloHistory':_0x5ad552(0x129)+_0x32f965,_0x5c55bd=collection(db,_0x57b103),_0x444dd7={},_0x10d2dd=[];_0x299976['forEach'](_0x87b227=>{const _0x22096e=_0x5ad552,_0x41edf9=_0x87b227+'_'+_0x32f965,_0x198447=cache['eloHistory']['get'](_0x41edf9);_0x198447&&Date['now']()-_0x198447['timestamp']<CACHE_EXPIRY['eloHistory']?_0x444dd7[_0x87b227]=_0x198447['data']:_0x10d2dd[_0x22096e(0x133)](_0x87b227);});const _0x338229=0xa;for(let _0x340b45=0x0;_0x340b45<_0x10d2dd[_0x5ad552(0x12a)];_0x340b45+=_0x338229){const _0x2024a7=_0x10d2dd[_0x5ad552(0x136)](_0x340b45,_0x340b45+_0x338229);if(_0x2024a7[_0x5ad552(0x12a)]>0x0)try{const _0x57e1c9=query(_0x5c55bd,where('playerId','in',_0x2024a7),limit(0x64)),_0x303d73=await getDocs(_0x57e1c9);_0x303d73['docs']['forEach'](_0x24db9e=>{const _0x3b3caf=_0x24db9e['data'](),_0x2ee694=_0x3b3caf['playerId'];if(!_0x444dd7[_0x2ee694])_0x444dd7[_0x2ee694]=[];_0x444dd7[_0x2ee694]['push'](_0x3b3caf);const _0x5eeb9f=_0x2ee694+'_'+_0x32f965;cache['eloHistory']['set'](_0x5eeb9f,{'data':_0x444dd7[_0x2ee694],'timestamp':Date['now']()});});}catch(_0x2586e4){console['error'](_0x5ad552(0x138),_0x2586e4);}}return _0x444dd7;}let usernameCache=new Map(),usernameCacheTimestamp=Date['now']();export function setupEfficientListener(_0xaf15d4,_0x2d5878=[],_0x10f769){const _0x495166=collection(db,_0xaf15d4),_0x395b3e=query(_0x495166,..._0x2d5878),_0x4fb86b=onSnapshot(_0x395b3e,_0x50cc4e=>{const _0x4ac29e=a56_0x3f39,_0x4bfdf8=_0x50cc4e[_0x4ac29e(0x13c)]()['map'](_0x30d779=>({'type':_0x30d779[_0x4ac29e(0x12f)],'id':_0x30d779['doc']['id'],'data':_0x30d779[_0x4ac29e(0x12b)]['data']()}));_0x4bfdf8['length']>0x0&&_0x10f769(_0x4bfdf8,_0x50cc4e[_0x4ac29e(0x137)]);});return _0x4fb86b;}function a56_0x3f39(_0x52eb48,_0x2a174b){const _0x2f5af3=a56_0x5c59();return a56_0x3f39=function(_0x4cf825,_0x4c0a1c){_0x4cf825=_0x4cf825-0x129;let _0x5c5934=_0x2f5af3[_0x4cf825];return _0x5c5934;},a56_0x3f39(_0x52eb48,_0x2a174b);}export async function bulkResolveUsernames(_0x3cf89b){const _0x378072=a56_0x3f39,_0x31dd85=new Map();if(!_0x3cf89b||_0x3cf89b[_0x378072(0x12a)]===0x0)return _0x31dd85;const _0x4774c1=['players','playersD2',_0x378072(0x13a),_0x378072(0x139)];for(const _0x73b128 of _0x4774c1){const _0x2fe13c=collection(db,_0x73b128),_0x45bfa8=await getDocs(_0x2fe13c);_0x45bfa8['forEach'](_0x1e151f=>{const _0x264845=_0x378072,_0x51c1b6=_0x1e151f['data']();_0x51c1b6['username']&&_0x3cf89b[_0x264845(0x12c)](_0x1e151f['id'])&&_0x31dd85['set'](_0x1e151f['id'],_0x51c1b6['username']);});}return _0x31dd85;}
const a16n=a16b;(function(a,b){const m=a16b,c=a();while(!![]){try{const d=-parseInt(m(0xd4))/0x1+parseInt(m(0xd5))/0x2+parseInt(m(0xe6))/0x3*(-parseInt(m(0xd6))/0x4)+-parseInt(m(0xec))/0x5+parseInt(m(0xdb))/0x6+-parseInt(m(0xe5))/0x7*(parseInt(m(0xe4))/0x8)+parseInt(m(0xe0))/0x9*(parseInt(m(0xe2))/0xa);if(d===b)break;else c['push'](c['shift']());}catch(e){c['push'](c['shift']());}}}(a16a,0x847ad));import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a16a(){const s=['qNjVBNPL','mJG4sKHUAKTY','zgvTB3rPB24','mZy0otCWuw5AzMD4','zgf0yq','nda4v1PSCwfw','otC4nJDmBNvTwMC','nKfAzxrlyG','u2LSDMvY','rxjYB3iGzMv0y2HPBMCGDxnLCM5HBwu6','vw5RBM93BIbqBgf5zxi','DgLTzxn0yw1W','vw5Yyw5Rzwq','ntaYnZqWmgDcC2ThAq','mtuZndi5qurtDur6','mtG1mtmWmhnxteLPtG','nJm2nta4twXLDKnJ','ruXpigHPC3rVCNKGCMvJB3jKzwqGzM9Yia','zxjYB3i','CgXHEwvY','BwfW','mZGZnty2mLbsteXWDW','B3bWB25LBNq','ChjVBw90Aw9U','r29Sza'];a16a=function(){return s;};return a16a();}import{db}from'./firebase-config.js';const ELO_THRESHOLDS=[{'name':a16n(0xde),'elo':0x708},{'name':a16n(0xe7),'elo':0x640},{'name':'Bronze','elo':0x578},{'name':a16n(0xeb),'elo':0x4b0}];async function getUsernameById(a){const o=a16n;try{if(!a)return o(0xe9);const b=await getDoc(doc(db,'players',a));return b['exists']()?b[o(0xe3)]()['username']:'Unknown\x20Player';}catch(c){return console[o(0xd8)](o(0xe8),c),o(0xe9);}}export async function recordEloChange({playerId:a,previousElo:b,newElo:c,opponentId:d,matchResult:e,previousPosition:f,newPosition:g,isPromotion:isPromotion=![],isDemotion:isDemotion=![],timestamp:h}){const p=a16n;try{const i=doc(collection(db,'eloHistory'));let j='match';if(isPromotion)j=p(0xdd);if(isDemotion)j=p(0xe1);let k=p(0xeb);if(c>=0x834)k='Emerald';else{if(c>=0x708)k='Gold';else{if(c>=0x640)k=p(0xe7);else{if(c>=0x578)k=p(0xdf);}}}return await setDoc(i,{'type':j,'player':a,'opponent':d,'previousElo':b,'newElo':c,'change':c-b,'matchResult':e,'previousPosition':f,'newPosition':g,'rankAchieved':k,'timestamp':h}),console['log'](p(0xd7)+a),!![];}catch(l){console[p(0xd8)]('Error\x20recording\x20ELO\x20history:',l);throw l;}}function a16b(a,b){const c=a16a();return a16b=function(d,e){d=d-0xd4;let f=c[d];if(a16b['rNDsGW']===undefined){var g=function(l){const m='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let n='',o='';for(let p=0x0,q,r,s=0x0;r=l['charAt'](s++);~r&&(q=p%0x4?q*0x40+r:r,p++%0x4)?n+=String['fromCharCode'](0xff&q>>(-0x2*p&0x6)):0x0){r=m['indexOf'](r);}for(let t=0x0,u=n['length'];t<u;t++){o+='%'+('00'+n['charCodeAt'](t)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(o);};a16b['TWhTPk']=g,a=arguments,a16b['rNDsGW']=!![];}const h=c[0x0],i=d+h,j=a[i];return!j?(f=a16b['TWhTPk'](f),a[i]=f):f=j,f;},a16b(a,b);}export async function getEloHistory(){const q=a16n;try{const a=collection(db,'eloHistory'),b=query(a,orderBy(q(0xea),'desc')),c=await getDocs(b),d=c['docs'][q(0xda)](async f=>{const r=q,g=f['data'](),[h,i]=await Promise['all']([getUsernameById(g[r(0xd9)]),getUsernameById(g[r(0xdc)])]);return{...g,'playerUsername':h,'opponentUsername':i,'change':g['newElo']-g['previousElo'],'timestamp':g['timestamp']};}),e=await Promise['all'](d);return{'entries':e};}catch(f){console['error']('Error\x20fetching\x20ELO\x20history:',f);throw f;}}export function resetPagination(){lastVisible=null;}
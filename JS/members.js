const a35_0x570079=a35_0x2e9f,a35_0x51518f=(function(){let _0xa4ddbf=!![];return function(_0x8aa2d,_0x2338c3){const _0x3d8129=_0xa4ddbf?function(){const _0x59c9e9=a35_0x2e9f;if(_0x2338c3){const _0x12eb1c=_0x2338c3[_0x59c9e9(0x144)](_0x8aa2d,arguments);return _0x2338c3=null,_0x12eb1c;}}:function(){};return _0xa4ddbf=![],_0x3d8129;};}()),a35_0x196f96=a35_0x51518f(this,function(){const _0x3dba26=a35_0x2e9f,_0x2ecb2e=function(){const _0x43a404=a35_0x2e9f;let _0x2f2d2f;try{_0x2f2d2f=Function(_0x43a404(0x146)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0xa4d3f3){_0x2f2d2f=window;}return _0x2f2d2f;},_0x1a2a9e=_0x2ecb2e(),_0x4f8858=_0x1a2a9e['console']=_0x1a2a9e[_0x3dba26(0x14c)]||{},_0x8d45eb=[_0x3dba26(0x14d),'warn','info',_0x3dba26(0x153),_0x3dba26(0x148),'table','trace'];for(let _0x36d977=0x0;_0x36d977<_0x8d45eb['length'];_0x36d977++){const _0x665a95=a35_0x51518f['constructor']['prototype']['bind'](a35_0x51518f),_0x2cec58=_0x8d45eb[_0x36d977],_0x2dfa34=_0x4f8858[_0x2cec58]||_0x665a95;_0x665a95[_0x3dba26(0x147)]=a35_0x51518f[_0x3dba26(0x13c)](a35_0x51518f),_0x665a95['toString']=_0x2dfa34['toString']['bind'](_0x2dfa34),_0x4f8858[_0x2cec58]=_0x665a95;}});a35_0x196f96();const functions=require('firebase-functions'),admin=require('firebase-admin');admin['initializeApp']();const db=admin['firestore']();function a35_0x3b5b(){const _0x281c4b=['all','batch','ref','FieldValue','aggregatedMembers','userId','bind','push','collection','nonParticipants','data','firestore','slice','country','apply','elo','return\x20(function()\x20','__proto__','exception','params','forEach','players','console','log','updateMembersList','Members\x20list\x20rebuilt\x20successfully','playersD2','username','sort','error','docId','get','ladders','serverTimestamp'];a35_0x3b5b=function(){return _0x281c4b;};return a35_0x3b5b();}exports[a35_0x570079(0x14e)]=functions['firestore']['document']('{collection}/{docId}')['onWrite'](async(_0x17faa4,_0x49f38d)=>{const _0x2a754c=a35_0x570079,_0x4ff1e3=_0x49f38d[_0x2a754c(0x149)][_0x2a754c(0x13e)],_0x1e14a0=_0x49f38d[_0x2a754c(0x149)][_0x2a754c(0x154)];if(![_0x2a754c(0x14b),'playersD2','playersD3','userProfiles','nonParticipants']['includes'](_0x4ff1e3))return null;try{await rebuildMembersList(),console['log']('Successfully\x20updated\x20aggregated\x20members\x20list');}catch(_0x43e4d9){console['error']('Error\x20updating\x20members\x20list:',_0x43e4d9);}});async function rebuildMembersList(){const _0x40c287=a35_0x570079,_0x32e137=db['batch'](),[_0x5108e3,_0xa1b072,_0x15929a,_0x1dd7b4,_0x595479]=await Promise[_0x40c287(0x136)]([db['collection']('userProfiles')['get'](),db['collection']('players')['get'](),db['collection'](_0x40c287(0x150))[_0x40c287(0x155)](),db['collection']('playersD3')[_0x40c287(0x155)](),db['collection'](_0x40c287(0x13f))['get']()]),_0x5aa2fb=new Map();_0x5108e3[_0x40c287(0x14a)](_0x7144c2=>{const _0x111e13=_0x40c287;_0x5aa2fb['set'](_0x7144c2['id'],_0x7144c2[_0x111e13(0x140)]());});const _0x248256=new Map(),_0x8f3a3f=(_0x405402,_0x52401b)=>{_0x405402['forEach'](_0x1f2fba=>{const _0x5b7f4d=_0x1f2fba['data'](),_0x562385=_0x1f2fba['id'];!_0x248256['has'](_0x562385)&&_0x248256['set'](_0x562385,{'userId':_0x562385,'username':_0x5b7f4d['username']||'Unknown','ladders':[],'isNonParticipant':![]});const _0x282137=_0x248256['get'](_0x562385);_0x282137['ladders']['push']({'ladder':_0x52401b,'elo':_0x5b7f4d['eloRating']||0x4b0,'active':_0x5b7f4d['active']!==![]});});};_0x8f3a3f(_0xa1b072,'D1'),_0x8f3a3f(_0x15929a,'D2'),_0x8f3a3f(_0x1dd7b4,'D3'),_0x595479['forEach'](_0x28ffa2=>{const _0x2d9cff=_0x40c287,_0x148a89=_0x28ffa2['data'](),_0x471417=_0x28ffa2['id'];!_0x248256['has'](_0x471417)&&_0x148a89[_0x2d9cff(0x151)]&&_0x248256['set'](_0x471417,{'userId':_0x471417,'username':_0x148a89['username'],'ladders':[],'isNonParticipant':!![]});});const _0x3a89a4=[];_0x248256['forEach']((_0x4b2fcf,_0x1e176a)=>{const _0x42acf9=_0x40c287,_0x3a5184=_0x5aa2fb['get'](_0x1e176a)||{};let _0x5e1b88=0x0,_0x11e3a5=null;if(_0x4b2fcf[_0x42acf9(0x156)]['length']>0x0){const _0x4defaa=_0x4b2fcf['ladders'][_0x42acf9(0x152)]((_0x276b04,_0x421a49)=>_0x421a49['elo']-_0x276b04[_0x42acf9(0x145)]);_0x5e1b88=_0x4defaa[0x0]['elo'],_0x11e3a5=_0x4defaa[0x0]['ladder'];}const _0x5ac3ce={'userId':_0x1e176a,'username':_0x4b2fcf['username'],'profileImageUrl':_0x3a5184['profileImageUrl']||null,'country':_0x3a5184[_0x42acf9(0x143)]||null,'motto':_0x3a5184['motto']||null,'favoriteMap':_0x3a5184['favoriteMap']||null,'favoriteWeapon':_0x3a5184['favoriteWeapon']||null,'isNonParticipant':_0x4b2fcf['isNonParticipant'],'ladders':_0x4b2fcf[_0x42acf9(0x156)],'primaryLadder':_0x11e3a5,'highestElo':_0x5e1b88,'rank':getPlayerRank(_0x5e1b88),'lastUpdated':admin[_0x42acf9(0x141)][_0x42acf9(0x139)][_0x42acf9(0x157)]()};_0x3a89a4[_0x42acf9(0x13d)](_0x5ac3ce);});const _0x1911ca=db['collection'](_0x40c287(0x13a)),_0x29b667=await _0x1911ca['get'](),_0x77cb23=[];_0x29b667['forEach'](_0x40169b=>{const _0x5609ff=_0x40c287;_0x77cb23[_0x5609ff(0x13d)](_0x40169b[_0x5609ff(0x138)]['delete']());}),await Promise['all'](_0x77cb23);const _0x38ada1=0x1f4,_0x33a0d4=[];for(let _0x32d1da=0x0;_0x32d1da<_0x3a89a4['length'];_0x32d1da+=_0x38ada1){const _0x1f0e09=db[_0x40c287(0x137)](),_0x20dac3=_0x3a89a4[_0x40c287(0x142)](_0x32d1da,_0x32d1da+_0x38ada1);_0x20dac3['forEach'](_0x421f0e=>{const _0x21f420=_0x40c287,_0x2e3129=_0x1911ca['doc'](_0x421f0e[_0x21f420(0x13b)]);_0x1f0e09['set'](_0x2e3129,_0x421f0e);}),_0x33a0d4['push'](_0x1f0e09['commit']());}await Promise[_0x40c287(0x136)](_0x33a0d4);}function a35_0x2e9f(_0x1de3d6,_0x391a9a){const _0x196f96=a35_0x3b5b();return a35_0x2e9f=function(_0x51518f,_0x546fb1){_0x51518f=_0x51518f-0x136;let _0x3b5bdd=_0x196f96[_0x51518f];return _0x3b5bdd;},a35_0x2e9f(_0x1de3d6,_0x391a9a);}function getPlayerRank(_0x526605){if(_0x526605>=0x7d0)return'emerald';if(_0x526605>=0x708)return'gold';if(_0x526605>=0x640)return'silver';if(_0x526605>=0x578)return'bronze';return'unranked';}exports['rebuildMembersListManual']=functions['https']['onRequest'](async(_0x43a96d,_0x33d042)=>{const _0x2db360=a35_0x570079;try{await rebuildMembersList(),_0x33d042['status'](0xc8)['send'](_0x2db360(0x14f));}catch(_0x303161){console[_0x2db360(0x153)]('Error\x20rebuilding\x20members\x20list:',_0x303161),_0x33d042['status'](0x1f4)['send']('Error\x20rebuilding\x20members\x20list');}});
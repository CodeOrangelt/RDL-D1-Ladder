const a15p=a15d;(function(a,b){const n=a15d,c=a();while(!![]){try{const d=parseInt(n(0x127))/0x1+-parseInt(n(0x112))/0x2*(-parseInt(n(0x118))/0x3)+-parseInt(n(0x123))/0x4+-parseInt(n(0x111))/0x5*(-parseInt(n(0x121))/0x6)+parseInt(n(0x103))/0x7*(parseInt(n(0x109))/0x8)+parseInt(n(0x115))/0x9*(-parseInt(n(0x10c))/0xa)+-parseInt(n(0x122))/0xb;if(d===b)break;else c['push'](c['shift']());}catch(e){c['push'](c['shift']());}}}(a15c,0x1a75d));const a15b=(function(){let a=!![];return function(b,c){const d=a?function(){if(c){const e=c['apply'](b,arguments);return c=null,e;}}:function(){};return a=![],d;};}()),a15a=a15b(this,function(){const o=a15d;let a;try{const d=Function(o(0x119)+o(0x10f)+');');a=d();}catch(f){a=window;}const b=a[o(0x124)]=a['console']||{},c=[o(0x113),o(0x11c),'info',o(0x10e),o(0x104),o(0x10a),o(0x114)];for(let g=0x0;g<c['length'];g++){const h=a15b[o(0x11a)]['prototype']['bind'](a15b),i=c[g],j=b[i]||h;h['__proto__']=a15b['bind'](a15b),h[o(0x128)]=j[o(0x128)]['bind'](j),b[i]=h;}});a15a();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc,where}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D3=[{'name':a15p(0x126),'elo':0x7d0},{'name':a15p(0x117),'elo':0x708},{'name':'Silver','elo':0x640},{'name':'Bronze','elo':0x578},{'name':a15p(0x116),'elo':0x4b0}];let lastVisibleD3=null;function a15c(){const u=['mJeZotqXwfjqBLvv','zxHJzxb0Aw9U','BMv3rwXV','Bg9ZzxjvC2vYBMfTzq','C2L6zq','ChjLDMLVDxnfBg8','mtz5zenxzNG','DgfIBgu','zgvZyW','odiWzLb3ENLW','D2LUBMvYvxnLCM5HBwu','zxjYB3i','E30Uy29UC3rYDwn0B3iOiNjLDhvYBIb0AgLZiIKOicK','zg9JCW','mtv0zNfduey','mKHAq0DvyW','Bg9N','DhjHy2u','odu1rg5bs2X5','vw5Yyw5Rzwq','r29Sza','mJCWodG4vhjry21X','CMv0DxjUicHMDw5JDgLVBIGPia','y29UC3rYDwn0B3i','CgXHEwvY','D2fYBG','vw5RBM93BIbqBgf5zxi','rxjYB3iGCMvJB3jKAw5NieqZievmtYbOAxn0B3j5oG','B3bWB25LBNq','Bwf0y2G','mJy4mJa2ruXtBurY','mJeYnZq1nvbgCKfnrW','mZK5ndi0rfrQyujt','y29UC29Szq','ywXS','rw1LCMfSza','mtiZota3vgz3ruTw','Dg9tDhjPBMC','DgLTzxn0yw1W','rdmGruXpigHPC3rVCNKGCMvJB3jKzwqGzM9Yia','zw1WDhK','zwXVsgLZDg9YEuqZ','zgf0yq','yxbWCM92zwrnyxrJAgvZrdm'];a15c=function(){return u;};return a15c();}async function getUsernameByIdD3(a){const q=a15p;try{if(!a)return q(0x11d);const b=await getDoc(doc(db,'playersD3',a));if(b['exists']())return b['data']()['username']||q(0x11d);const c=await getDocs(query(collection(db,q(0x102)),where('winnerId','==',a),limit(0x1)));if(!c[q(0x12b)])return c['docs'][0x0][q(0x101)]()[q(0x10d)]||'Unknown\x20Player';const d=await getDocs(query(collection(db,q(0x102)),where('loserId','==',a),limit(0x1)));if(!d[q(0x12b)])return d['docs'][0x0]['data']()[q(0x106)]||q(0x11d);return'Unknown\x20Player';}catch(e){return console['error']('Error\x20getting\x20D3\x20username:',e),q(0x11d);}}export async function recordEloChangeD3({playerId:a,previousElo:b,newElo:c,opponentId:d,matchResult:e,previousPosition:f,newPosition:g,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:h,timestamp:i}){const r=a15p;try{const j=doc(collection(db,'eloHistoryD3'));let k=r(0x120);if(isPromotion)k='promotion';if(isDemotion)k='demotion';let l=r(0x116);if(c>=0x7d0)l=r(0x126);else{if(c>=0x708)l='Gold';else{if(c>=0x640)l='Silver';else{if(c>=0x578)l='Bronze';}}}return await setDoc(j,{'type':k,'player':a,'opponent':d,'previousElo':b,'newElo':c,'change':c-b,'matchResult':e,'previousPosition':f,'newPosition':g,'rankAchieved':l,'matchId':h,'timestamp':i||serverTimestamp(),'gameMode':'D3'}),console['log'](r(0x12a)+a),!![];}catch(m){console[r(0x10e)](r(0x11e),m);throw m;}}export async function getEloHistoryD3(a=0x14){const s=a15p;try{const b=collection(db,s(0x12c));let c;lastVisibleD3?c=query(b,orderBy(s(0x129),s(0x10b)),startAfter(lastVisibleD3),limit(a)):c=query(b,orderBy(s(0x129),'desc'),limit(a));const d=await getDocs(c);if(d['empty'])return{'entries':[],'hasMore':![]};lastVisibleD3=d[s(0x110)][d['docs']['length']-0x1];const e=d[s(0x110)]['map'](async g=>{const t=s,h=g['data'](),[i,j]=await Promise['all']([getUsernameByIdD3(h[t(0x11b)]),getUsernameByIdD3(h[t(0x11f)])]);return{...h,'playerUsername':i,'opponentUsername':j,'change':h[t(0x105)]-h[t(0x108)],'timestamp':h[t(0x129)]};}),f=await Promise[s(0x125)](e);return{'entries':f,'hasMore':d[s(0x107)]===a};}catch(g){console[s(0x10e)]('Error\x20fetching\x20D3\x20ELO\x20history:',g);throw g;}}function a15d(a,b){const c=a15c();return a15d=function(d,e){d=d-0x101;let f=c[d];if(a15d['UqXUXV']===undefined){var g=function(l){const m='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let n='',o='';for(let p=0x0,q,r,s=0x0;r=l['charAt'](s++);~r&&(q=p%0x4?q*0x40+r:r,p++%0x4)?n+=String['fromCharCode'](0xff&q>>(-0x2*p&0x6)):0x0){r=m['indexOf'](r);}for(let t=0x0,u=n['length'];t<u;t++){o+='%'+('00'+n['charCodeAt'](t)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(o);};a15d['ikdfgk']=g,a=arguments,a15d['UqXUXV']=!![];}const h=c[0x0],i=d+h,j=a[i];return!j?(f=a15d['ikdfgk'](f),a[i]=f):f=j,f;},a15d(a,b);}export function resetPaginationD3(){lastVisibleD3=null;}
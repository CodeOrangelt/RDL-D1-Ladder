const a12_0x10a0a8=(function(){let _0x518515=!![];return function(_0x1ee11f,_0x480c63){const _0x1c1a94=_0x518515?function(){const _0x3c8509=a12_0x2f46;if(_0x480c63){const _0x3d958e=_0x480c63[_0x3c8509(0x1e3)](_0x1ee11f,arguments);return _0x480c63=null,_0x3d958e;}}:function(){};return _0x518515=![],_0x1c1a94;};}()),a12_0x52f96f=a12_0x10a0a8(this,function(){const _0x4cc240=a12_0x2f46;let _0x4611cd;try{const _0x312899=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x4611cd=_0x312899();}catch(_0x5ee488){_0x4611cd=window;}const _0x5f3cb7=_0x4611cd[_0x4cc240(0x1e0)]=_0x4611cd[_0x4cc240(0x1e0)]||{},_0x420303=[_0x4cc240(0x1e6),'warn','info','error',_0x4cc240(0x1e1),'table','trace'];for(let _0x22521b=0x0;_0x22521b<_0x420303['length'];_0x22521b++){const _0x2c574e=a12_0x10a0a8['constructor']['prototype']['bind'](a12_0x10a0a8),_0x914885=_0x420303[_0x22521b],_0x5f7ee4=_0x5f3cb7[_0x914885]||_0x2c574e;_0x2c574e['__proto__']=a12_0x10a0a8['bind'](a12_0x10a0a8),_0x2c574e['toString']=_0x5f7ee4['toString']['bind'](_0x5f7ee4),_0x5f3cb7[_0x914885]=_0x2c574e;}});a12_0x52f96f();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D2=[{'name':'Gold','elo':0x708},{'name':'Silver','elo':0x640},{'name':'Bronze','elo':0x578},{'name':'Unranked','elo':0x4b0}];let lastVisibleD2=null;function a12_0x2f46(_0x240a33,_0x3550b4){const _0x52f96f=a12_0x2112();return a12_0x2f46=function(_0x10a0a8,_0xacb2d4){_0x10a0a8=_0x10a0a8-0x1d7;let _0x21124b=_0x52f96f[_0x10a0a8];return _0x21124b;},a12_0x2f46(_0x240a33,_0x3550b4);}async function getUsernameByIdD2(_0x47a6f0){const _0x5b047c=a12_0x2f46;try{if(!_0x47a6f0)return'Unknown\x20Player';const _0x32baec=await getDoc(doc(db,'playersD2',_0x47a6f0));if(_0x32baec[_0x5b047c(0x1d8)]())return _0x32baec['data']()[_0x5b047c(0x1db)]||'Unknown\x20Player';const _0x89a9f3=await getDocs(query(collection(db,'approvedMatchesD2'),where('winnerId','==',_0x47a6f0),limit(0x1)));if(!_0x89a9f3['empty'])return _0x89a9f3['docs'][0x0]['data']()['winnerUsername']||'Unknown\x20Player';const _0x2abd9f=await getDocs(query(collection(db,'approvedMatchesD2'),where('loserId','==',_0x47a6f0),limit(0x1)));if(!_0x2abd9f['empty'])return _0x2abd9f['docs'][0x0][_0x5b047c(0x1dd)]()['loserUsername']||'Unknown\x20Player';return _0x5b047c(0x1dc);}catch(_0x1d4a6f){return console['error'](_0x5b047c(0x1e8),_0x1d4a6f),_0x5b047c(0x1dc);}}export async function recordEloChangeD2({playerId:_0x554fe7,previousElo:_0x59de8e,newElo:_0x2f5e32,opponentId:_0xb2f1be,matchResult:_0x538607,previousPosition:_0x1de3aa,newPosition:_0x475b6e,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x35e487,timestamp:_0x32d14a}){const _0x531aea=a12_0x2f46;try{const _0x131667=doc(collection(db,_0x531aea(0x1e5)));let _0x33b4ac=_0x531aea(0x1d7);if(isPromotion)_0x33b4ac='promotion';if(isDemotion)_0x33b4ac='demotion';let _0x2ef3ad='Unranked';if(_0x2f5e32>=0x834)_0x2ef3ad='Emerald';else{if(_0x2f5e32>=0x708)_0x2ef3ad='Gold';else{if(_0x2f5e32>=0x640)_0x2ef3ad=_0x531aea(0x1e9);else{if(_0x2f5e32>=0x578)_0x2ef3ad=_0x531aea(0x1da);}}}return await setDoc(_0x131667,{'type':_0x33b4ac,'player':_0x554fe7,'opponent':_0xb2f1be,'previousElo':_0x59de8e,'newElo':_0x2f5e32,'change':_0x2f5e32-_0x59de8e,'matchResult':_0x538607,'previousPosition':_0x1de3aa,'newPosition':_0x475b6e,'rankAchieved':_0x2ef3ad,'matchId':_0x35e487,'timestamp':_0x32d14a}),console['log']('D2\x20ELO\x20history\x20recorded\x20for\x20'+_0x554fe7),!![];}catch(_0x425a6f){console[_0x531aea(0x1e4)](_0x531aea(0x1e2),_0x425a6f);throw _0x425a6f;}}export async function getEloHistoryD2(_0x589fe7=0x14){const _0x42a9ae=a12_0x2f46;try{const _0x5da379=collection(db,'eloHistoryD2');let _0x22c5ba;lastVisibleD2?_0x22c5ba=query(_0x5da379,orderBy(_0x42a9ae(0x1de),'desc'),startAfter(lastVisibleD2),limit(_0x589fe7)):_0x22c5ba=query(_0x5da379,orderBy('timestamp','desc'),limit(_0x589fe7));const _0x26ef06=await getDocs(_0x22c5ba);if(_0x26ef06[_0x42a9ae(0x1d9)])return{'entries':[],'hasMore':![]};lastVisibleD2=_0x26ef06['docs'][_0x26ef06[_0x42a9ae(0x1e7)]['length']-0x1];const _0x3ed971=_0x26ef06['docs']['map'](async _0x2c4d04=>{const _0x33b687=_0x2c4d04['data'](),[_0x3e183e,_0xae915c]=await Promise['all']([getUsernameByIdD2(_0x33b687['player']),getUsernameByIdD2(_0x33b687['opponent'])]);return{..._0x33b687,'playerUsername':_0x3e183e,'opponentUsername':_0xae915c,'change':_0x33b687['newElo']-_0x33b687['previousElo'],'timestamp':_0x33b687['timestamp']};}),_0x282c94=await Promise['all'](_0x3ed971);return{'entries':_0x282c94,'hasMore':_0x26ef06['size']===_0x589fe7};}catch(_0x26f232){console['error'](_0x42a9ae(0x1df),_0x26f232);throw _0x26f232;}}function a12_0x2112(){const _0x5c038f=['match','exists','empty','Bronze','username','Unknown\x20Player','data','timestamp','Error\x20fetching\x20D2\x20ELO\x20history:','console','exception','Error\x20recording\x20D2\x20ELO\x20history:','apply','error','eloHistoryD2','log','docs','Error\x20getting\x20username:','Silver'];a12_0x2112=function(){return _0x5c038f;};return a12_0x2112();}export function resetPaginationD2(){lastVisibleD2=null;}
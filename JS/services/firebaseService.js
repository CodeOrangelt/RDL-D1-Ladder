const a56_0x119512=a56_0x104b,a56_0x2128f0=(function(){let _0x1648b4=!![];return function(_0x362202,_0x33e941){const _0x38e0c2=_0x1648b4?function(){if(_0x33e941){const _0x304afe=_0x33e941['apply'](_0x362202,arguments);return _0x33e941=null,_0x304afe;}}:function(){};return _0x1648b4=![],_0x38e0c2;};}()),a56_0x180434=a56_0x2128f0(this,function(){const _0x15ed57=a56_0x104b;let _0x50293b;try{const _0x1e3c1e=Function('return\x20(function()\x20'+_0x15ed57(0x113)+');');_0x50293b=_0x1e3c1e();}catch(_0x3c746d){_0x50293b=window;}const _0x4daaae=_0x50293b['console']=_0x50293b['console']||{},_0x13b449=['log','warn','info',_0x15ed57(0x10a),'exception',_0x15ed57(0x117),'trace'];for(let _0x194645=0x0;_0x194645<_0x13b449['length'];_0x194645++){const _0x254c13=a56_0x2128f0['constructor']['prototype']['bind'](a56_0x2128f0),_0x5268b0=_0x13b449[_0x194645],_0x2e545e=_0x4daaae[_0x5268b0]||_0x254c13;_0x254c13['__proto__']=a56_0x2128f0[_0x15ed57(0x10d)](a56_0x2128f0),_0x254c13['toString']=_0x2e545e['toString']['bind'](_0x2e545e),_0x4daaae[_0x5268b0]=_0x254c13;}});function a56_0x104b(_0x51e5c1,_0x1abe8d){const _0x180434=a56_0x12ae();return a56_0x104b=function(_0x2128f0,_0x4cf59b){_0x2128f0=_0x2128f0-0x107;let _0x12ae34=_0x180434[_0x2128f0];return _0x12ae34;},a56_0x104b(_0x51e5c1,_0x1abe8d);}a56_0x180434();import{db}from'../firebase-config.js';import{collection,doc,getDoc,getDocs,query,limit,startAfter,where,onSnapshot}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const cache={'userProfiles':new Map(),'ladderPlayers':new Map(),'matchResults':new Map(),'eloHistory':new Map()},CACHE_EXPIRY={'userProfiles':0x5*0x3c*0x3e8,'ladderPlayers':0x2*0x3c*0x3e8,'matchResults':0x1*0x3c*0x3e8,'eloHistory':0x3*0x3c*0x3e8};function a56_0x12ae(){const _0x5aabd0=['forEach','doc','map','error','includes','timestamp','bind','length','nonParticipants','exists','eloHistory','data','{}.constructor(\x22return\x20this\x22)(\x20)','ladderPlayers','push','now','table','userProfiles','docs','username'];a56_0x12ae=function(){return _0x5aabd0;};return a56_0x12ae();}export const userProfilesRef=collection(db,'userProfiles');export async function fetchPaginatedData(_0x544429,_0x53ded5=0xa,_0x312055=null){const _0x5d66ec=a56_0x104b;let _0xe2d1d6=query(_0x544429,limit(_0x53ded5));_0x312055&&(_0xe2d1d6=query(_0xe2d1d6,startAfter(_0x312055)));const _0x27f160=await getDocs(_0xe2d1d6),_0x947f9f=_0x27f160['docs'][_0x27f160['docs'][_0x5d66ec(0x10e)]-0x1];return{'data':_0x27f160['docs']['map'](_0x31ea22=>({'id':_0x31ea22['id'],..._0x31ea22[_0x5d66ec(0x112)]()})),'lastVisible':_0x947f9f,'hasMore':_0x27f160['docs']['length']===_0x53ded5};}export async function getUserProfile(_0x1a1ed2){const _0x46c206=a56_0x104b,_0x60c50=cache['userProfiles']['get'](_0x1a1ed2);if(_0x60c50&&Date['now']()-_0x60c50[_0x46c206(0x10c)]<CACHE_EXPIRY[_0x46c206(0x118)])return _0x60c50['data'];const _0x26c809=await getDoc(doc(userProfilesRef,_0x1a1ed2));if(_0x26c809[_0x46c206(0x110)]()){const _0x34a8d3=_0x26c809[_0x46c206(0x112)]();return cache['userProfiles']['set'](_0x1a1ed2,{'data':_0x34a8d3,'timestamp':Date['now']()}),_0x34a8d3;}return null;}export async function getLadderData(_0x3e3d94=0x1){const _0x33fdaf=a56_0x104b,_0x182dec='division_'+_0x3e3d94,_0x1a8a65=cache[_0x33fdaf(0x114)]['get'](_0x182dec);if(_0x1a8a65&&Date['now']()-_0x1a8a65['timestamp']<CACHE_EXPIRY[_0x33fdaf(0x114)])return _0x1a8a65['data'];const _0x423097=_0x3e3d94===0x1?'players':'playersD'+_0x3e3d94,_0x11d6d6=collection(db,_0x423097),_0x227690=await getDocs(query(_0x11d6d6,limit(0x64))),_0x37043e=_0x227690['docs'][_0x33fdaf(0x109)](_0x1c5baf=>({'id':_0x1c5baf['id'],..._0x1c5baf['data']()}));return cache[_0x33fdaf(0x114)]['set'](_0x182dec,{'data':_0x37043e,'timestamp':Date['now']()}),_0x37043e;}export async function getEloHistoryBatch(_0x209843,_0x10f7bd=0x1){const _0x21bab2=a56_0x104b,_0x2237e8=_0x10f7bd===0x1?_0x21bab2(0x111):'eloHistoryD'+_0x10f7bd,_0x2725ae=collection(db,_0x2237e8),_0x1a1711={},_0x1a6879=[];_0x209843[_0x21bab2(0x107)](_0x36d510=>{const _0x121459=_0x21bab2,_0x4e4712=_0x36d510+'_'+_0x10f7bd,_0x5814d5=cache['eloHistory']['get'](_0x4e4712);_0x5814d5&&Date[_0x121459(0x116)]()-_0x5814d5['timestamp']<CACHE_EXPIRY[_0x121459(0x111)]?_0x1a1711[_0x36d510]=_0x5814d5['data']:_0x1a6879[_0x121459(0x115)](_0x36d510);});const _0x475e93=0xa;for(let _0x4869e3=0x0;_0x4869e3<_0x1a6879['length'];_0x4869e3+=_0x475e93){const _0x2e5fd4=_0x1a6879['slice'](_0x4869e3,_0x4869e3+_0x475e93);if(_0x2e5fd4['length']>0x0)try{const _0x121266=query(_0x2725ae,where('playerId','in',_0x2e5fd4),limit(0x64)),_0x435a13=await getDocs(_0x121266);_0x435a13[_0x21bab2(0x119)]['forEach'](_0x99df48=>{const _0x54231f=_0x21bab2,_0x122809=_0x99df48['data'](),_0x3ea116=_0x122809['playerId'];if(!_0x1a1711[_0x3ea116])_0x1a1711[_0x3ea116]=[];_0x1a1711[_0x3ea116][_0x54231f(0x115)](_0x122809);const _0x4be7ab=_0x3ea116+'_'+_0x10f7bd;cache['eloHistory']['set'](_0x4be7ab,{'data':_0x1a1711[_0x3ea116],'timestamp':Date['now']()});});}catch(_0x3e78f7){console['error']('Error\x20fetching\x20batch\x20ELO\x20history:',_0x3e78f7);}}return _0x1a1711;}let usernameCache=new Map(),usernameCacheTimestamp=Date[a56_0x119512(0x116)]();export function setupEfficientListener(_0x4743e8,_0x3563f9=[],_0x54b0ca){const _0x421143=collection(db,_0x4743e8),_0x5387de=query(_0x421143,..._0x3563f9),_0x55547a=onSnapshot(_0x5387de,_0x73f830=>{const _0xd694d6=a56_0x104b,_0x3bc0ea=_0x73f830['docChanges']()[_0xd694d6(0x109)](_0x36d040=>({'type':_0x36d040['type'],'id':_0x36d040[_0xd694d6(0x108)]['id'],'data':_0x36d040['doc'][_0xd694d6(0x112)]()}));_0x3bc0ea['length']>0x0&&_0x54b0ca(_0x3bc0ea,_0x73f830[_0xd694d6(0x119)]);});return _0x55547a;}export async function bulkResolveUsernames(_0x1effc9){const _0x16f0dc=a56_0x119512,_0x3a2bbf=new Map();if(!_0x1effc9||_0x1effc9[_0x16f0dc(0x10e)]===0x0)return _0x3a2bbf;const _0x2e4d4c=['players','playersD2','playersD3',_0x16f0dc(0x10f)];for(const _0x31d98b of _0x2e4d4c){const _0x43ab10=collection(db,_0x31d98b),_0x560860=await getDocs(_0x43ab10);_0x560860['forEach'](_0x59d6b9=>{const _0x44c065=_0x16f0dc,_0x3f37b5=_0x59d6b9['data']();_0x3f37b5[_0x44c065(0x11a)]&&_0x1effc9[_0x44c065(0x10b)](_0x59d6b9['id'])&&_0x3a2bbf['set'](_0x59d6b9['id'],_0x3f37b5[_0x44c065(0x11a)]);});}return _0x3a2bbf;}
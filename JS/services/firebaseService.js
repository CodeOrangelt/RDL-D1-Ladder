const a50_0x26fb34=(function(){let _0x220234=!![];return function(_0x373cd6,_0x53502e){const _0x42fa72=_0x220234?function(){if(_0x53502e){const _0x29a4ea=_0x53502e['apply'](_0x373cd6,arguments);return _0x53502e=null,_0x29a4ea;}}:function(){};return _0x220234=![],_0x42fa72;};}()),a50_0x495077=a50_0x26fb34(this,function(){const _0x57d6be=a50_0x1723,_0x176099=function(){let _0x5b65af;try{_0x5b65af=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x286958){_0x5b65af=window;}return _0x5b65af;},_0x29d1ca=_0x176099(),_0x3410e0=_0x29d1ca['console']=_0x29d1ca[_0x57d6be(0xfa)]||{},_0x53a33b=['log','warn','info','error',_0x57d6be(0x101),_0x57d6be(0xfc),'trace'];for(let _0x567dad=0x0;_0x567dad<_0x53a33b[_0x57d6be(0x109)];_0x567dad++){const _0x20eeb3=a50_0x26fb34['constructor'][_0x57d6be(0x108)]['bind'](a50_0x26fb34),_0x4138a3=_0x53a33b[_0x567dad],_0x2ccd48=_0x3410e0[_0x4138a3]||_0x20eeb3;_0x20eeb3['__proto__']=a50_0x26fb34[_0x57d6be(0x102)](a50_0x26fb34),_0x20eeb3['toString']=_0x2ccd48['toString']['bind'](_0x2ccd48),_0x3410e0[_0x4138a3]=_0x20eeb3;}});a50_0x495077();import{db}from'../firebase-config.js';import{collection,doc,getDoc,getDocs,query,limit,startAfter,where,onSnapshot}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a50_0x1723(_0x59a3d2,_0x38c006){const _0x495077=a50_0xe62a();return a50_0x1723=function(_0x26fb34,_0x44dd9c){_0x26fb34=_0x26fb34-0xf9;let _0xe62a68=_0x495077[_0x26fb34];return _0xe62a68;},a50_0x1723(_0x59a3d2,_0x38c006);}const cache={'userProfiles':new Map(),'ladderPlayers':new Map(),'matchResults':new Map(),'eloHistory':new Map()},CACHE_EXPIRY={'userProfiles':0x5*0x3c*0x3e8,'ladderPlayers':0x2*0x3c*0x3e8,'matchResults':0x1*0x3c*0x3e8,'eloHistory':0x3*0x3c*0x3e8};function a50_0xe62a(){const _0x57d126=['doc','console','playersD2','table','set','data','eloHistory','nonParticipants','exception','bind','forEach','playerId','username','error','push','prototype','length','userProfiles','docs'];a50_0xe62a=function(){return _0x57d126;};return a50_0xe62a();}export const userProfilesRef=collection(db,'userProfiles');export async function fetchPaginatedData(_0x3ed293,_0x3ce4fa=0xa,_0x377c0a=null){let _0x46b7e9=query(_0x3ed293,limit(_0x3ce4fa));_0x377c0a&&(_0x46b7e9=query(_0x46b7e9,startAfter(_0x377c0a)));const _0x4f828b=await getDocs(_0x46b7e9),_0x1f153e=_0x4f828b['docs'][_0x4f828b['docs']['length']-0x1];return{'data':_0x4f828b['docs']['map'](_0xd6bb93=>({'id':_0xd6bb93['id'],..._0xd6bb93['data']()})),'lastVisible':_0x1f153e,'hasMore':_0x4f828b['docs']['length']===_0x3ce4fa};}export async function getUserProfile(_0x43ea0b){const _0x4b9ff9=a50_0x1723,_0x212e57=cache['userProfiles']['get'](_0x43ea0b);if(_0x212e57&&Date['now']()-_0x212e57['timestamp']<CACHE_EXPIRY[_0x4b9ff9(0x10a)])return _0x212e57['data'];const _0x456519=await getDoc(doc(userProfilesRef,_0x43ea0b));if(_0x456519['exists']()){const _0x19edcb=_0x456519['data']();return cache[_0x4b9ff9(0x10a)]['set'](_0x43ea0b,{'data':_0x19edcb,'timestamp':Date['now']()}),_0x19edcb;}return null;}export async function getLadderData(_0x54472a=0x1){const _0x24deda=a50_0x1723,_0x5df351='division_'+_0x54472a,_0x4e188c=cache['ladderPlayers']['get'](_0x5df351);if(_0x4e188c&&Date['now']()-_0x4e188c['timestamp']<CACHE_EXPIRY['ladderPlayers'])return _0x4e188c[_0x24deda(0xfe)];const _0x416e27=_0x54472a===0x1?'players':'playersD'+_0x54472a,_0xa1bc22=collection(db,_0x416e27),_0x1177a7=await getDocs(query(_0xa1bc22,limit(0x64))),_0x41ce56=_0x1177a7['docs']['map'](_0x4e9ed0=>({'id':_0x4e9ed0['id'],..._0x4e9ed0[_0x24deda(0xfe)]()}));return cache['ladderPlayers'][_0x24deda(0xfd)](_0x5df351,{'data':_0x41ce56,'timestamp':Date['now']()}),_0x41ce56;}export async function getEloHistoryBatch(_0xc9c26c,_0x413637=0x1){const _0x572e5a=a50_0x1723,_0x1bd71a=_0x413637===0x1?_0x572e5a(0xff):'eloHistoryD'+_0x413637,_0x42178c=collection(db,_0x1bd71a),_0x4fc49a={},_0x80087a=[];_0xc9c26c[_0x572e5a(0x103)](_0x1d0c2f=>{const _0x39ebb0=_0x572e5a,_0x1d0908=_0x1d0c2f+'_'+_0x413637,_0x27a3d2=cache[_0x39ebb0(0xff)]['get'](_0x1d0908);_0x27a3d2&&Date['now']()-_0x27a3d2['timestamp']<CACHE_EXPIRY['eloHistory']?_0x4fc49a[_0x1d0c2f]=_0x27a3d2['data']:_0x80087a[_0x39ebb0(0x107)](_0x1d0c2f);});const _0x19f800=0xa;for(let _0x4b5dbc=0x0;_0x4b5dbc<_0x80087a['length'];_0x4b5dbc+=_0x19f800){const _0x3b7b93=_0x80087a['slice'](_0x4b5dbc,_0x4b5dbc+_0x19f800);if(_0x3b7b93[_0x572e5a(0x109)]>0x0)try{const _0x64e6bf=query(_0x42178c,where(_0x572e5a(0x104),'in',_0x3b7b93),limit(0x64)),_0x5a6f97=await getDocs(_0x64e6bf);_0x5a6f97[_0x572e5a(0x10b)]['forEach'](_0x51f5d5=>{const _0x7f15bf=_0x572e5a,_0x43ce0e=_0x51f5d5[_0x7f15bf(0xfe)](),_0x4166a6=_0x43ce0e['playerId'];if(!_0x4fc49a[_0x4166a6])_0x4fc49a[_0x4166a6]=[];_0x4fc49a[_0x4166a6][_0x7f15bf(0x107)](_0x43ce0e);const _0x230661=_0x4166a6+'_'+_0x413637;cache['eloHistory']['set'](_0x230661,{'data':_0x4fc49a[_0x4166a6],'timestamp':Date['now']()});});}catch(_0x792e68){console[_0x572e5a(0x106)]('Error\x20fetching\x20batch\x20ELO\x20history:',_0x792e68);}}return _0x4fc49a;}let usernameCache=new Map(),usernameCacheTimestamp=Date['now']();export function setupEfficientListener(_0x58c5a0,_0x13f0c1=[],_0x372f74){const _0x32fcbe=collection(db,_0x58c5a0),_0x59a436=query(_0x32fcbe,..._0x13f0c1),_0x15bb04=onSnapshot(_0x59a436,_0x4e6837=>{const _0x3555a2=a50_0x1723,_0x50520a=_0x4e6837['docChanges']()['map'](_0x5dc0d8=>({'type':_0x5dc0d8['type'],'id':_0x5dc0d8[_0x3555a2(0xf9)]['id'],'data':_0x5dc0d8['doc']['data']()}));_0x50520a['length']>0x0&&_0x372f74(_0x50520a,_0x4e6837['docs']);});return _0x15bb04;}export async function bulkResolveUsernames(_0x4f4ebb){const _0x4cd071=a50_0x1723,_0x522e35=new Map();if(!_0x4f4ebb||_0x4f4ebb[_0x4cd071(0x109)]===0x0)return _0x522e35;const _0x56f73e=['players',_0x4cd071(0xfb),'playersD3',_0x4cd071(0x100)];for(const _0x91ce8c of _0x56f73e){const _0x3c70e5=collection(db,_0x91ce8c),_0x61d2bb=await getDocs(_0x3c70e5);_0x61d2bb['forEach'](_0x41dee9=>{const _0xc573fd=_0x4cd071,_0x5bf730=_0x41dee9['data']();_0x5bf730['username']&&_0x4f4ebb['includes'](_0x41dee9['id'])&&_0x522e35['set'](_0x41dee9['id'],_0x5bf730[_0xc573fd(0x105)]);});}return _0x522e35;}
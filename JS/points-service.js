const a39_0x448ab9=a39_0x12b8,a39_0x1d9ad7=(function(){let _0x4d8597=!![];return function(_0x42f65f,_0x579f18){const _0x1eca1c=_0x4d8597?function(){const _0x235a88=a39_0x12b8;if(_0x579f18){const _0x2f8f63=_0x579f18[_0x235a88(0x1a0)](_0x42f65f,arguments);return _0x579f18=null,_0x2f8f63;}}:function(){};return _0x4d8597=![],_0x1eca1c;};}()),a39_0x864458=a39_0x1d9ad7(this,function(){const _0x333c36=a39_0x12b8;let _0x1bce8e;try{const _0x26c6e8=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x1bce8e=_0x26c6e8();}catch(_0x5d1d7b){_0x1bce8e=window;}const _0x440f19=_0x1bce8e[_0x333c36(0x1a3)]=_0x1bce8e['console']||{},_0x27b238=['log','warn','info',_0x333c36(0x19d),'exception','table','trace'];for(let _0x342ee2=0x0;_0x342ee2<_0x27b238[_0x333c36(0x1a2)];_0x342ee2++){const _0x252462=a39_0x1d9ad7['constructor']['prototype'][_0x333c36(0x1a6)](a39_0x1d9ad7),_0x1f7b88=_0x27b238[_0x342ee2],_0x3bce88=_0x440f19[_0x1f7b88]||_0x252462;_0x252462[_0x333c36(0x1a5)]=a39_0x1d9ad7[_0x333c36(0x1a6)](a39_0x1d9ad7),_0x252462['toString']=_0x3bce88[_0x333c36(0x1a4)]['bind'](_0x3bce88),_0x440f19[_0x1f7b88]=_0x252462;}});function a39_0x301c(){const _0x2e0a91=['add','Standard','error','points','log','apply','\x20match','length','console','toString','__proto__','bind','all','\x20points\x20to\x20user\x20','\x20match\x20(Winner)','Awarded\x20','modifyUserPoints','exists'];a39_0x301c=function(){return _0x2e0a91;};return a39_0x301c();}a39_0x864458();import{db}from'./firebase-config.js';function a39_0x12b8(_0x5f132a,_0x5e0ca8){const _0x864458=a39_0x301c();return a39_0x12b8=function(_0x1d9ad7,_0x28092a){_0x1d9ad7=_0x1d9ad7-0x19b;let _0x301ce6=_0x864458[_0x1d9ad7];return _0x301ce6;},a39_0x12b8(_0x5f132a,_0x5e0ca8);}import{doc,getDoc,updateDoc,addDoc,collection,serverTimestamp}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const POINTS_CHART={'':0xa,'Standard':0xa,'Fusion\x20Match':0x19,'â‰¥6\x20Missiles':0xa,'Weapon\x20Imbalance':0x1e,'Blind\x20Match':0x4b,'Rematch':0x14,'Disorientation':0x32,'Ratting':0x23,'Altered\x20Powerups':0x23,'Mega\x20Match':0x28,'Dogfight':0x32,'Gauss\x20and\x20Mercs':0x19,'Misc':0x1e};let adminModifyUserPoints=null;try{const adminModule=await import('./adminbackend.js');adminModule[a39_0x448ab9(0x1ab)]&&(adminModifyUserPoints=adminModule['modifyUserPoints'],console['log']('Admin\x20points\x20service\x20connected'));}catch(a39_0x49d74c){console['log']('Admin\x20backend\x20not\x20available,\x20using\x20fallback\x20points\x20service');}export async function awardMatchPoints(_0xa5b66c,_0x5cc263,_0x12dbca){const _0x906f94=a39_0x448ab9;try{const _0x159bf2=POINTS_CHART[_0x12dbca]||0xa;return adminModifyUserPoints?await Promise['all']([adminModifyUserPoints(_0xa5b66c,_0x906f94(0x19b),_0x159bf2,'Match\x20points:\x20'+(_0x12dbca||_0x906f94(0x19c))+_0x906f94(0x1a9)),adminModifyUserPoints(_0x5cc263,'add',_0x159bf2,'Match\x20points:\x20'+(_0x12dbca||'Standard')+'\x20match\x20(Participant)')]):await Promise[_0x906f94(0x1a7)]([addPointsFallback(_0xa5b66c,_0x159bf2,'Match\x20points:\x20'+(_0x12dbca||'Standard')+_0x906f94(0x1a9)),addPointsFallback(_0x5cc263,_0x159bf2,'Match\x20points:\x20'+(_0x12dbca||'Standard')+'\x20match\x20(Participant)')]),console[_0x906f94(0x19f)](_0x906f94(0x1aa)+_0x159bf2+'\x20points\x20to\x20both\x20players\x20for\x20'+(_0x12dbca||'Standard')+_0x906f94(0x1a1)),!![];}catch(_0x3bf5d4){return console['error']('Error\x20awarding\x20match\x20points:',_0x3bf5d4),![];}}async function addPointsFallback(_0x3cdd4,_0x40f64a,_0x351855=''){const _0x55c1ea=a39_0x448ab9;try{const _0x1e764d=doc(db,'userProfiles',_0x3cdd4),_0x4d8783=await getDoc(_0x1e764d);if(!_0x4d8783[_0x55c1ea(0x1ac)]()){console['log']('User\x20profile\x20not\x20found\x20for\x20'+_0x3cdd4+',\x20skipping\x20points\x20award');return;}const _0xf6c654=_0x4d8783['data'](),_0x5ea071=_0xf6c654[_0x55c1ea(0x19e)]||0x0,_0x1ffe1e=_0x5ea071+_0x40f64a;await updateDoc(_0x1e764d,{'points':_0x1ffe1e,'lastPointsModified':serverTimestamp()}),await addDoc(collection(db,'pointsHistory'),{'userId':_0x3cdd4,'userEmail':_0xf6c654['email']||'unknown','displayName':_0xf6c654['displayName']||_0xf6c654['username']||'Unknown\x20User','action':'add','amount':_0x40f64a,'previousPoints':_0x5ea071,'newPoints':_0x1ffe1e,'reason':_0x351855,'adminEmail':'system-match-award','timestamp':serverTimestamp()}),console['log']('Added\x20'+_0x40f64a+_0x55c1ea(0x1a8)+_0x3cdd4+'.\x20New\x20total:\x20'+_0x1ffe1e);}catch(_0x54c112){console['error']('Error\x20adding\x20points\x20to\x20user:',_0x54c112);throw _0x54c112;}}
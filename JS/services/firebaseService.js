function a53_0x1e65(_0x59ad6c,_0x43101e){const _0x5e39d0=a53_0x4e76();return a53_0x1e65=function(_0x169100,_0x1f142a){_0x169100=_0x169100-0x12c;let _0x11d8d2=_0x5e39d0[_0x169100];return _0x11d8d2;},a53_0x1e65(_0x59ad6c,_0x43101e);}const a53_0x14504a=a53_0x1e65;(function(_0x53bd80,_0x6ec05d){const _0x131e50=a53_0x1e65,_0x4174e5=_0x53bd80();while(!![]){try{const _0x36970b=parseInt(_0x131e50(0x159))/0x1*(-parseInt(_0x131e50(0x14e))/0x2)+-parseInt(_0x131e50(0x156))/0x3+-parseInt(_0x131e50(0x13c))/0x4*(-parseInt(_0x131e50(0x15a))/0x5)+parseInt(_0x131e50(0x12e))/0x6+-parseInt(_0x131e50(0x14a))/0x7+parseInt(_0x131e50(0x131))/0x8+parseInt(_0x131e50(0x151))/0x9;if(_0x36970b===_0x6ec05d)break;else _0x4174e5['push'](_0x4174e5['shift']());}catch(_0x596c9d){_0x4174e5['push'](_0x4174e5['shift']());}}}(a53_0x4e76,0x9af75));const a53_0x2a3a48=(function(){let _0x791df4=!![];return function(_0x503bd3,_0x3a9300){const _0x47d8be=_0x791df4?function(){const _0x1bfb64=a53_0x1e65;if(_0x3a9300){const _0x17c345=_0x3a9300[_0x1bfb64(0x146)](_0x503bd3,arguments);return _0x3a9300=null,_0x17c345;}}:function(){};return _0x791df4=![],_0x47d8be;};}()),a53_0x382d2f=a53_0x2a3a48(this,function(){const _0x2eadb4=a53_0x1e65;return a53_0x382d2f[_0x2eadb4(0x15d)]()['search']('(((.+)+)+)+$')[_0x2eadb4(0x15d)]()['constructor'](a53_0x382d2f)[_0x2eadb4(0x14f)](_0x2eadb4(0x130));});a53_0x382d2f();const a53_0x1f142a=(function(){let _0x3ad65e=!![];return function(_0x501496,_0x263f14){const _0x463aaf=_0x3ad65e?function(){const _0x4e1e63=a53_0x1e65;if(_0x263f14){const _0x5f58bc=_0x263f14[_0x4e1e63(0x146)](_0x501496,arguments);return _0x263f14=null,_0x5f58bc;}}:function(){};return _0x3ad65e=![],_0x463aaf;};}()),a53_0x169100=a53_0x1f142a(this,function(){const _0x161158=a53_0x1e65;let _0x3c5e19;try{const _0x55a7e2=Function(_0x161158(0x132)+_0x161158(0x139)+');');_0x3c5e19=_0x55a7e2();}catch(_0x26909f){_0x3c5e19=window;}const _0x3a1025=_0x3c5e19[_0x161158(0x13e)]=_0x3c5e19[_0x161158(0x13e)]||{},_0x181b23=['log',_0x161158(0x13b),_0x161158(0x13f),_0x161158(0x135),_0x161158(0x14c),_0x161158(0x136),'trace'];for(let _0x59dfae=0x0;_0x59dfae<_0x181b23[_0x161158(0x150)];_0x59dfae++){const _0x3fb6c4=a53_0x1f142a[_0x161158(0x158)][_0x161158(0x13d)][_0x161158(0x144)](a53_0x1f142a),_0x5e236e=_0x181b23[_0x59dfae],_0x1f0c18=_0x3a1025[_0x5e236e]||_0x3fb6c4;_0x3fb6c4[_0x161158(0x12d)]=a53_0x1f142a['bind'](a53_0x1f142a),_0x3fb6c4['toString']=_0x1f0c18[_0x161158(0x15d)][_0x161158(0x144)](_0x1f0c18),_0x3a1025[_0x5e236e]=_0x3fb6c4;}});a53_0x169100();import{db}from'../firebase-config.js';import{collection,doc,getDoc,getDocs,query,limit,startAfter,where,onSnapshot}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const cache={'userProfiles':new Map(),'ladderPlayers':new Map(),'matchResults':new Map(),'eloHistory':new Map()},CACHE_EXPIRY={'userProfiles':0x5*0x3c*0x3e8,'ladderPlayers':0x2*0x3c*0x3e8,'matchResults':0x1*0x3c*0x3e8,'eloHistory':0x3*0x3c*0x3e8};function a53_0x4e76(){const _0x142756=['error','table','type','doc','{}.constructor(\x22return\x20this\x22)(\x20)','Error\x20fetching\x20batch\x20ELO\x20history:','warn','4ZUhjsJ','prototype','console','info','division_','data','playersD3','slice','bind','exists','apply','username','eloHistory','nonParticipants','7604891WZNLAS','now','exception','forEach','82158anNlLE','search','length','7503075LxGdEB','players','set','docs','push','1583892TmecMH','playersD','constructor','22YwEase','2635585ExaMuv','map','eloHistoryD','toString','ladderPlayers','timestamp','__proto__','5072100HwsPkx','get','(((.+)+)+)+$','7573712roIgfZ','return\x20(function()\x20','includes','playersD2'];a53_0x4e76=function(){return _0x142756;};return a53_0x4e76();}export const userProfilesRef=collection(db,'userProfiles');export async function fetchPaginatedData(_0x133f21,_0x217b35=0xa,_0x542560=null){const _0x21709a=a53_0x1e65;let _0x254d72=query(_0x133f21,limit(_0x217b35));_0x542560&&(_0x254d72=query(_0x254d72,startAfter(_0x542560)));const _0x4e53f8=await getDocs(_0x254d72),_0xd89e29=_0x4e53f8['docs'][_0x4e53f8[_0x21709a(0x154)][_0x21709a(0x150)]-0x1];return{'data':_0x4e53f8[_0x21709a(0x154)][_0x21709a(0x15b)](_0x84a8c7=>({'id':_0x84a8c7['id'],..._0x84a8c7[_0x21709a(0x141)]()})),'lastVisible':_0xd89e29,'hasMore':_0x4e53f8[_0x21709a(0x154)]['length']===_0x217b35};}export async function getUserProfile(_0xfd7875){const _0x1eda16=a53_0x1e65,_0x138b88=cache['userProfiles'][_0x1eda16(0x12f)](_0xfd7875);if(_0x138b88&&Date[_0x1eda16(0x14b)]()-_0x138b88[_0x1eda16(0x12c)]<CACHE_EXPIRY['userProfiles'])return _0x138b88[_0x1eda16(0x141)];const _0x3e77df=await getDoc(doc(userProfilesRef,_0xfd7875));if(_0x3e77df[_0x1eda16(0x145)]()){const _0x35f2d9=_0x3e77df[_0x1eda16(0x141)]();return cache['userProfiles'][_0x1eda16(0x153)](_0xfd7875,{'data':_0x35f2d9,'timestamp':Date[_0x1eda16(0x14b)]()}),_0x35f2d9;}return null;}export async function getLadderData(_0x27facd=0x1){const _0x47de23=a53_0x1e65,_0x499426=_0x47de23(0x140)+_0x27facd,_0x55a854=cache[_0x47de23(0x15e)]['get'](_0x499426);if(_0x55a854&&Date[_0x47de23(0x14b)]()-_0x55a854[_0x47de23(0x12c)]<CACHE_EXPIRY[_0x47de23(0x15e)])return _0x55a854[_0x47de23(0x141)];const _0x8c1eac=_0x27facd===0x1?_0x47de23(0x152):_0x47de23(0x157)+_0x27facd,_0x428c03=collection(db,_0x8c1eac),_0x57a64e=await getDocs(query(_0x428c03,limit(0x64))),_0x1cd976=_0x57a64e[_0x47de23(0x154)][_0x47de23(0x15b)](_0x40b7d7=>({'id':_0x40b7d7['id'],..._0x40b7d7['data']()}));return cache['ladderPlayers'][_0x47de23(0x153)](_0x499426,{'data':_0x1cd976,'timestamp':Date[_0x47de23(0x14b)]()}),_0x1cd976;}export async function getEloHistoryBatch(_0x2ee4a3,_0x450557=0x1){const _0x4a5a9c=a53_0x1e65,_0x1475f9=_0x450557===0x1?_0x4a5a9c(0x148):_0x4a5a9c(0x15c)+_0x450557,_0x38f570=collection(db,_0x1475f9),_0x5c4bfe={},_0x38fe64=[];_0x2ee4a3[_0x4a5a9c(0x14d)](_0x35f3b9=>{const _0x549457=_0x4a5a9c,_0x30b50e=_0x35f3b9+'_'+_0x450557,_0x5b4243=cache[_0x549457(0x148)][_0x549457(0x12f)](_0x30b50e);_0x5b4243&&Date['now']()-_0x5b4243[_0x549457(0x12c)]<CACHE_EXPIRY[_0x549457(0x148)]?_0x5c4bfe[_0x35f3b9]=_0x5b4243['data']:_0x38fe64[_0x549457(0x155)](_0x35f3b9);});const _0x5dc2e7=0xa;for(let _0x42b5c2=0x0;_0x42b5c2<_0x38fe64[_0x4a5a9c(0x150)];_0x42b5c2+=_0x5dc2e7){const _0x56f188=_0x38fe64[_0x4a5a9c(0x143)](_0x42b5c2,_0x42b5c2+_0x5dc2e7);if(_0x56f188[_0x4a5a9c(0x150)]>0x0)try{const _0x28ddfa=query(_0x38f570,where('playerId','in',_0x56f188),limit(0x64)),_0x3f8642=await getDocs(_0x28ddfa);_0x3f8642[_0x4a5a9c(0x154)][_0x4a5a9c(0x14d)](_0x2bf275=>{const _0x479959=_0x4a5a9c,_0x354325=_0x2bf275[_0x479959(0x141)](),_0x1004b7=_0x354325['playerId'];if(!_0x5c4bfe[_0x1004b7])_0x5c4bfe[_0x1004b7]=[];_0x5c4bfe[_0x1004b7]['push'](_0x354325);const _0x5887ee=_0x1004b7+'_'+_0x450557;cache[_0x479959(0x148)][_0x479959(0x153)](_0x5887ee,{'data':_0x5c4bfe[_0x1004b7],'timestamp':Date['now']()});});}catch(_0x3bd8d8){console[_0x4a5a9c(0x135)](_0x4a5a9c(0x13a),_0x3bd8d8);}}return _0x5c4bfe;}let usernameCache=new Map(),usernameCacheTimestamp=Date[a53_0x14504a(0x14b)]();export function setupEfficientListener(_0x1b3f69,_0x2372d8=[],_0x352962){const _0x23ad97=collection(db,_0x1b3f69),_0x1581a1=query(_0x23ad97,..._0x2372d8),_0x567b6b=onSnapshot(_0x1581a1,_0x60b7a7=>{const _0x2a178c=a53_0x1e65,_0x4881ed=_0x60b7a7['docChanges']()[_0x2a178c(0x15b)](_0x30a5f4=>({'type':_0x30a5f4[_0x2a178c(0x137)],'id':_0x30a5f4['doc']['id'],'data':_0x30a5f4[_0x2a178c(0x138)][_0x2a178c(0x141)]()}));_0x4881ed[_0x2a178c(0x150)]>0x0&&_0x352962(_0x4881ed,_0x60b7a7[_0x2a178c(0x154)]);});return _0x567b6b;}export async function bulkResolveUsernames(_0x36603f){const _0x3c569c=a53_0x14504a,_0x1bc423=new Map();if(!_0x36603f||_0x36603f['length']===0x0)return _0x1bc423;const _0x483d97=['players',_0x3c569c(0x134),_0x3c569c(0x142),_0x3c569c(0x149)];for(const _0xff2a9c of _0x483d97){const _0x459901=collection(db,_0xff2a9c),_0x59bc08=await getDocs(_0x459901);_0x59bc08[_0x3c569c(0x14d)](_0x27d24b=>{const _0x2367ba=_0x3c569c,_0x57941a=_0x27d24b['data']();_0x57941a['username']&&_0x36603f[_0x2367ba(0x133)](_0x27d24b['id'])&&_0x1bc423[_0x2367ba(0x153)](_0x27d24b['id'],_0x57941a[_0x2367ba(0x147)]);});}return _0x1bc423;}
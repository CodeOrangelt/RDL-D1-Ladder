const a7_0x23b53=a7_0x52d6,a7_0x449593=(function(){let _0x70e97c=!![];return function(_0x3d2eea,_0x2ec499){const _0x587964=_0x70e97c?function(){if(_0x2ec499){const _0x2118b2=_0x2ec499['apply'](_0x3d2eea,arguments);return _0x2ec499=null,_0x2118b2;}}:function(){};return _0x70e97c=![],_0x587964;};}()),a7_0x13df06=a7_0x449593(this,function(){const _0x35d07a=a7_0x52d6,_0x422f41=function(){const _0x5cd3e9=a7_0x52d6;let _0x5dd71c;try{_0x5dd71c=Function(_0x5cd3e9(0x197)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x1a3986){_0x5dd71c=window;}return _0x5dd71c;},_0x3b53f4=_0x422f41(),_0x5d7daa=_0x3b53f4[_0x35d07a(0x19e)]=_0x3b53f4[_0x35d07a(0x19e)]||{},_0x307d6b=['log',_0x35d07a(0x198),'info',_0x35d07a(0x190),'exception','table','trace'];for(let _0x4e7847=0x0;_0x4e7847<_0x307d6b['length'];_0x4e7847++){const _0x4a2d8a=a7_0x449593['constructor'][_0x35d07a(0x187)]['bind'](a7_0x449593),_0x1162a3=_0x307d6b[_0x4e7847],_0xe95df9=_0x5d7daa[_0x1162a3]||_0x4a2d8a;_0x4a2d8a['__proto__']=a7_0x449593[_0x35d07a(0x183)](a7_0x449593),_0x4a2d8a['toString']=_0xe95df9['toString']['bind'](_0xe95df9),_0x5d7daa[_0x1162a3]=_0x4a2d8a;}});function a7_0x52d6(_0x244835,_0x3e93b8){const _0x13df06=a7_0xca84();return a7_0x52d6=function(_0x449593,_0x4d3ae4){_0x449593=_0x449593-0x171;let _0xca8444=_0x13df06[_0x449593];return _0xca8444;},a7_0x52d6(_0x244835,_0x3e93b8);}a7_0x13df06();import{collection,getDocs,query,orderBy}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a7_0xca84(){const _0x2f8c57=['log','match-result','click','username','block','innerHTML','expectedScoreLoser','set','winnerChange','classList','loser-new-elo','New\x20ELO:\x20','players','get','%\x20chance\x20to\x20win)\x0a\x20\x20','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','pow','winner-name','bind','toFixed','loadPlayers','calculation-details','prototype','\x0a\x0aFormula\x20Used:\x0a\x20\x20New\x20Rating\x20=\x20Old\x20Rating\x20+\x20K-factor\x20Ã—\x20(Actual\x20Score\x20-\x20Expected\x20Score)\x0a\x20\x20K-factor\x20=\x2032\x0a\x20\x20Actual\x20Score:\x20Winner\x20=\x201,\x20Loser\x20=\x200\x0a\x20\x20\x0a','sort','target','.ladder-btn','currentLadder','updateDropdowns','<option\x20value=\x22\x22>Select\x20a\x20player...</option>','eloRating','error','elo','values','getElementById','\x0a\x20\x20\x0aExpected\x20Scores:\x0a\x20\x20','getELOColor','setupEventListeners','return\x20(function()\x20','warn','value','%\x20chance\x20to\x20win)\x0a\x0aELO\x20Changes:\x0a\x20\x20','display','DOMContentLoaded','addEventListener','console','textContent','active','change','#808080','newWinnerRating','init','gold'];a7_0xca84=function(){return _0x2f8c57;};return a7_0xca84();}import{db}from'./firebase-config.js';class ELOCalculator{constructor(){const _0x501bdf=a7_0x52d6;this['currentLadder']='D1',this[_0x501bdf(0x17d)]=new Map(),this['init']();}[a7_0x23b53(0x1a4)](){const _0x523699=a7_0x23b53;this[_0x523699(0x196)](),this['loadPlayers']();}['setupEventListeners'](){const _0x104abc=a7_0x23b53;document['querySelectorAll'](_0x104abc(0x18b))['forEach'](_0x379df7=>{const _0x1b66e8=_0x104abc;_0x379df7[_0x1b66e8(0x19d)]('click',_0x480351=>{const _0x598bf8=_0x1b66e8;document['querySelectorAll'](_0x598bf8(0x18b))['forEach'](_0x271182=>_0x271182[_0x598bf8(0x17a)]['remove']('active')),_0x480351['target']['classList']['add'](_0x598bf8(0x1a0)),this[_0x598bf8(0x18c)]=_0x480351[_0x598bf8(0x18a)]['dataset']['ladder'],this[_0x598bf8(0x185)]();});}),document['getElementById']('refresh-players')['addEventListener'](_0x104abc(0x173),()=>{const _0x329b8b=_0x104abc;this[_0x329b8b(0x185)]();}),document['getElementById']('winner-select')['addEventListener']('change',()=>this['calculateMatch']()),document['getElementById']('loser-select')['addEventListener'](_0x104abc(0x1a1),()=>this['calculateMatch']());}async['loadPlayers'](){const _0x10099d=a7_0x23b53;try{this[_0x10099d(0x18d)]('<option\x20value=\x22\x22>Loading\x20players...</option>');const _0x26fef8=this['currentLadder']==='D1'?'players':this[_0x10099d(0x18c)]==='D2'?'playersD2':'playersD3',_0x2c889b=collection(db,_0x26fef8),_0x1aea70=query(_0x2c889b,orderBy('eloRating','desc')),_0xf94911=await getDocs(_0x1aea70);this['players']['clear'](),_0xf94911['forEach'](_0x518cf0=>{const _0x5e4079=_0x10099d,_0x3cda8c=_0x518cf0['data']();_0x3cda8c['username']&&this['players'][_0x5e4079(0x178)](_0x3cda8c['username'],{'id':_0x518cf0['id'],'username':_0x3cda8c['username'],'elo':parseInt(_0x3cda8c[_0x5e4079(0x18f)])||0x4b0,'position':_0x3cda8c['position']||0x3e7});}),this['updateDropdowns'](),console[_0x10099d(0x171)]('Loaded\x20'+this['players']['size']+'\x20players\x20from\x20'+this['currentLadder']+'\x20ladder');}catch(_0x59af40){console['error']('Error\x20loading\x20players:',_0x59af40),this['updateDropdowns']('<option\x20value=\x22\x22>Error\x20loading\x20players</option>');}}['updateDropdowns'](_0x399ca9=null){const _0x50339c=a7_0x23b53,_0x515d68=document['getElementById']('winner-select'),_0x35fa94=document['getElementById']('loser-select');if(_0x399ca9){_0x515d68['innerHTML']=_0x399ca9,_0x35fa94[_0x50339c(0x176)]=_0x399ca9;return;}let _0x49d6ea=_0x50339c(0x18e);const _0x5de6e6=Array['from'](this[_0x50339c(0x17d)][_0x50339c(0x192)]())[_0x50339c(0x189)]((_0x57756d,_0x4f4369)=>_0x4f4369[_0x50339c(0x191)]-_0x57756d[_0x50339c(0x191)]);_0x5de6e6['forEach'](_0xc4cbb1=>{const _0x211dfa=_0x50339c,_0xd4eac=this['getELORankClass'](_0xc4cbb1['elo']);_0x49d6ea+='<option\x20value=\x22'+_0xc4cbb1['username']+'\x22\x20data-elo=\x22'+_0xc4cbb1['elo']+'\x22\x20class=\x22'+_0xd4eac+_0x211dfa(0x180)+_0xc4cbb1['username']+'\x20('+_0xc4cbb1[_0x211dfa(0x191)]+'\x20ELO)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</option>';}),_0x515d68[_0x50339c(0x176)]=_0x49d6ea,_0x35fa94['innerHTML']=_0x49d6ea;}['calculateMatch'](){const _0x1fb745=a7_0x23b53,_0x359f3b=document['getElementById']('winner-select'),_0x58f3b6=document['getElementById']('loser-select'),_0xca441f=_0x359f3b[_0x1fb745(0x199)],_0x2fd86f=_0x58f3b6[_0x1fb745(0x199)];if(!_0xca441f||!_0x2fd86f){document['getElementById']('match-result')['style']['display']='none',document['getElementById']('calculation-details')['style']['display']='none';return;}if(_0xca441f===_0x2fd86f){alert('Please\x20select\x20different\x20players\x20for\x20winner\x20and\x20loser');return;}const _0x2d69e6=this['players'][_0x1fb745(0x17e)](_0xca441f),_0x1a8b80=this['players']['get'](_0x2fd86f);if(!_0x2d69e6||!_0x1a8b80){console['error']('Player\x20not\x20found');return;}const _0x3650a5=this['calculateELO'](_0x2d69e6['elo'],_0x1a8b80['elo']);this['displayMatchResult'](_0x2d69e6,_0x1a8b80,_0x3650a5),this['displayCalculationDetails'](_0x2d69e6,_0x1a8b80,_0x3650a5);}['calculateELO'](_0x23322e,_0x1b2c2d,_0x59d6d8=0x20){const _0x565116=a7_0x23b53,_0x17c9ca=0x1/(0x1+Math[_0x565116(0x181)](0xa,(_0x1b2c2d-_0x23322e)/0x190)),_0x1fe271=0x1/(0x1+Math[_0x565116(0x181)](0xa,(_0x23322e-_0x1b2c2d)/0x190)),_0x2a7fc9=_0x23322e+_0x59d6d8*(0x1-_0x17c9ca),_0x47d082=_0x1b2c2d+_0x59d6d8*(0x0-_0x1fe271);return{'winnerChange':Math['round'](_0x2a7fc9-_0x23322e),'loserChange':Math['round'](_0x47d082-_0x1b2c2d),'newWinnerRating':Math['round'](_0x2a7fc9),'newLoserRating':Math['round'](_0x47d082),'expectedScoreWinner':_0x17c9ca,'expectedScoreLoser':_0x1fe271};}['displayMatchResult'](_0x3fa3cc,_0x51d954,_0x5bdb){const _0x1565a7=a7_0x23b53;document['getElementById'](_0x1565a7(0x182))['textContent']=_0x3fa3cc[_0x1565a7(0x174)],document['getElementById']('winner-current-elo')['textContent']='Current\x20ELO:\x20'+_0x3fa3cc[_0x1565a7(0x191)],document['getElementById']('winner-elo-change')[_0x1565a7(0x19f)]='+'+_0x5bdb[_0x1565a7(0x179)],document[_0x1565a7(0x193)]('winner-new-elo')['textContent']='New\x20ELO:\x20'+_0x5bdb['newWinnerRating'],document['getElementById']('loser-name')['textContent']=_0x51d954['username'],document['getElementById']('loser-current-elo')[_0x1565a7(0x19f)]='Current\x20ELO:\x20'+_0x51d954['elo'],document['getElementById']('loser-elo-change')[_0x1565a7(0x19f)]=''+_0x5bdb['loserChange'],document[_0x1565a7(0x193)](_0x1565a7(0x17b))['textContent']=_0x1565a7(0x17c)+_0x5bdb['newLoserRating'];const _0x52b139=this['getELOColor'](_0x3fa3cc[_0x1565a7(0x191)]),_0xb54040=this['getELOColor'](_0x51d954[_0x1565a7(0x191)]);document['getElementById'](_0x1565a7(0x182))['style']['color']=_0x52b139,document['getElementById']('loser-name')['style']['color']=_0xb54040,document[_0x1565a7(0x193)](_0x1565a7(0x172))['style'][_0x1565a7(0x19b)]='grid';}['displayCalculationDetails'](_0x4090eb,_0x5f047b,_0x459cc4){const _0x3957ac=a7_0x23b53,_0x47fbd0='\x0a\x0aInitial\x20Ratings:\x0a\x20\x20'+_0x4090eb[_0x3957ac(0x174)]+':\x20'+_0x4090eb['elo']+'\x0a\x20\x20'+_0x5f047b[_0x3957ac(0x174)]+':\x20'+_0x5f047b['elo']+_0x3957ac(0x194)+_0x4090eb['username']+':\x20'+_0x459cc4['expectedScoreWinner']['toFixed'](0x3)+'\x20('+(_0x459cc4['expectedScoreWinner']*0x64)[_0x3957ac(0x184)](0x1)+_0x3957ac(0x17f)+_0x5f047b['username']+':\x20'+_0x459cc4['expectedScoreLoser'][_0x3957ac(0x184)](0x3)+'\x20('+(_0x459cc4[_0x3957ac(0x177)]*0x64)['toFixed'](0x1)+_0x3957ac(0x19a)+_0x4090eb['username']+':\x20'+_0x4090eb[_0x3957ac(0x191)]+'\x20+\x20'+_0x459cc4['winnerChange']+'\x20=\x20'+_0x459cc4[_0x3957ac(0x1a3)]+'\x0a\x20\x20'+_0x5f047b['username']+':\x20'+_0x5f047b['elo']+'\x20+\x20'+_0x459cc4['loserChange']+'\x20=\x20'+_0x459cc4['newLoserRating']+_0x3957ac(0x188)+(_0x459cc4[_0x3957ac(0x179)]>0x14?'\x20High\x20ELO\x20gain':'')+'\x0a'+(_0x459cc4[_0x3957ac(0x179)]<0x5?'Low\x20ELO\x20gain.':'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20';document['getElementById']('calculation-text')['textContent']=_0x47fbd0,document[_0x3957ac(0x193)](_0x3957ac(0x186))['style']['display']=_0x3957ac(0x175);}[a7_0x23b53(0x195)](_0x4b991b){const _0x4b432e=a7_0x23b53;if(_0x4b991b>=0x7d0)return'#50C878';else{if(_0x4b991b>=0x708)return'#FFD700';else{if(_0x4b991b>=0x640)return'#C0C0C0';else{if(_0x4b991b>=0x578)return'#CD7F32';else return _0x4b432e(0x1a2);}}}}['getELORankClass'](_0x42d028){const _0x36c030=a7_0x23b53;if(_0x42d028>=0x7d0)return'emerald';else{if(_0x42d028>=0x708)return _0x36c030(0x1a5);else{if(_0x42d028>=0x640)return'silver';else{if(_0x42d028>=0x578)return'bronze';else return'unranked';}}}}}document[a7_0x23b53(0x19d)](a7_0x23b53(0x19c),()=>{document['getElementById']('sandbox')&&new ELOCalculator();});
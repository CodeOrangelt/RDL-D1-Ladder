const a15_0x4dc7f2=a15_0x32e2,a15_0x599304=(function(){let _0xa519bd=!![];return function(_0x3167b2,_0x303007){const _0x32cf7f=_0xa519bd?function(){if(_0x303007){const _0x1e3e94=_0x303007['apply'](_0x3167b2,arguments);return _0x303007=null,_0x1e3e94;}}:function(){};return _0xa519bd=![],_0x32cf7f;};}()),a15_0x5915b1=a15_0x599304(this,function(){const _0x5d8219=a15_0x32e2,_0x4f97a9=function(){let _0x50c5b2;try{_0x50c5b2=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x489399){_0x50c5b2=window;}return _0x50c5b2;},_0x105178=_0x4f97a9(),_0x193967=_0x105178[_0x5d8219(0x1f0)]=_0x105178['console']||{},_0x21248d=['log','warn','info','error','exception',_0x5d8219(0x1f1),_0x5d8219(0x1f6)];for(let _0x1286d1=0x0;_0x1286d1<_0x21248d['length'];_0x1286d1++){const _0x53389a=a15_0x599304['constructor'][_0x5d8219(0x1e6)][_0x5d8219(0x1f2)](a15_0x599304),_0x8299bd=_0x21248d[_0x1286d1],_0x2442d2=_0x193967[_0x8299bd]||_0x53389a;_0x53389a[_0x5d8219(0x1ed)]=a15_0x599304['bind'](a15_0x599304),_0x53389a['toString']=_0x2442d2['toString']['bind'](_0x2442d2),_0x193967[_0x8299bd]=_0x53389a;}});a15_0x5915b1();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc,where}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D3=[{'name':a15_0x4dc7f2(0x1e8),'elo':0x7d0},{'name':a15_0x4dc7f2(0x1ef),'elo':0x708},{'name':'Silver','elo':0x640},{'name':'Bronze','elo':0x578},{'name':'Unranked','elo':0x4b0}];let lastVisibleD3=null;async function getUsernameByIdD3(_0x492a84){const _0x2ab5f8=a15_0x4dc7f2;try{if(!_0x492a84)return'Unknown\x20Player';const _0x35157c=await getDoc(doc(db,'playersD3',_0x492a84));if(_0x35157c['exists']())return _0x35157c[_0x2ab5f8(0x1e7)]()['username']||'Unknown\x20Player';const _0x1c6ca4=await getDocs(query(collection(db,'approvedMatchesD3'),where('winnerId','==',_0x492a84),limit(0x1)));if(!_0x1c6ca4['empty'])return _0x1c6ca4[_0x2ab5f8(0x1f4)][0x0]['data']()['winnerUsername']||_0x2ab5f8(0x1f3);const _0x5b3bbe=await getDocs(query(collection(db,'approvedMatchesD3'),where(_0x2ab5f8(0x1e9),'==',_0x492a84),limit(0x1)));if(!_0x5b3bbe['empty'])return _0x5b3bbe['docs'][0x0]['data']()['loserUsername']||_0x2ab5f8(0x1f3);return'Unknown\x20Player';}catch(_0x2ff206){return console['error']('Error\x20getting\x20D3\x20username:',_0x2ff206),_0x2ab5f8(0x1f3);}}export async function recordEloChangeD3({playerId:_0x486ae3,previousElo:_0x4db9ff,newElo:_0x14bd74,opponentId:_0x3b407f,matchResult:_0x1dae20,previousPosition:_0x53a81b,newPosition:_0x4225ab,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x369fa1,timestamp:_0x3673cd}){const _0x36b186=a15_0x4dc7f2;try{const _0x538e02=doc(collection(db,_0x36b186(0x1ec)));let _0x3c8d78='match';if(isPromotion)_0x3c8d78='promotion';if(isDemotion)_0x3c8d78=_0x36b186(0x1ee);let _0x2acc7e='Unranked';if(_0x14bd74>=0x7d0)_0x2acc7e='Emerald';else{if(_0x14bd74>=0x708)_0x2acc7e='Gold';else{if(_0x14bd74>=0x640)_0x2acc7e='Silver';else{if(_0x14bd74>=0x578)_0x2acc7e='Bronze';}}}return await setDoc(_0x538e02,{'type':_0x3c8d78,'player':_0x486ae3,'opponent':_0x3b407f,'previousElo':_0x4db9ff,'newElo':_0x14bd74,'change':_0x14bd74-_0x4db9ff,'matchResult':_0x1dae20,'previousPosition':_0x53a81b,'newPosition':_0x4225ab,'rankAchieved':_0x2acc7e,'matchId':_0x369fa1,'timestamp':_0x3673cd||serverTimestamp(),'gameMode':'D3'}),console['log'](_0x36b186(0x1f5)+_0x486ae3),!![];}catch(_0x21f1e3){console['error'](_0x36b186(0x1f7),_0x21f1e3);throw _0x21f1e3;}}function a15_0x32e2(_0x3bc443,_0x3aae3d){const _0x5915b1=a15_0x1d3c();return a15_0x32e2=function(_0x599304,_0x5a52c8){_0x599304=_0x599304-0x1e5;let _0x1d3ca1=_0x5915b1[_0x599304];return _0x1d3ca1;},a15_0x32e2(_0x3bc443,_0x3aae3d);}export async function getEloHistoryD3(_0x48387b=0x14){const _0x11bc0a=a15_0x4dc7f2;try{const _0x1aabc6=collection(db,'eloHistoryD3');let _0x5fe44d;lastVisibleD3?_0x5fe44d=query(_0x1aabc6,orderBy('timestamp','desc'),startAfter(lastVisibleD3),limit(_0x48387b)):_0x5fe44d=query(_0x1aabc6,orderBy(_0x11bc0a(0x1e5),'desc'),limit(_0x48387b));const _0x5af0f8=await getDocs(_0x5fe44d);if(_0x5af0f8[_0x11bc0a(0x1eb)])return{'entries':[],'hasMore':![]};lastVisibleD3=_0x5af0f8['docs'][_0x5af0f8['docs']['length']-0x1];const _0xfc58a7=_0x5af0f8['docs']['map'](async _0x589168=>{const _0x338979=_0x589168['data'](),[_0x1dbd3b,_0x435f78]=await Promise['all']([getUsernameByIdD3(_0x338979['player']),getUsernameByIdD3(_0x338979['opponent'])]);return{..._0x338979,'playerUsername':_0x1dbd3b,'opponentUsername':_0x435f78,'change':_0x338979['newElo']-_0x338979['previousElo'],'timestamp':_0x338979['timestamp']};}),_0x53aa09=await Promise['all'](_0xfc58a7);return{'entries':_0x53aa09,'hasMore':_0x5af0f8['size']===_0x48387b};}catch(_0x18c4d1){console[_0x11bc0a(0x1ea)]('Error\x20fetching\x20D3\x20ELO\x20history:',_0x18c4d1);throw _0x18c4d1;}}function a15_0x1d3c(){const _0x1c7729=['timestamp','prototype','data','Emerald','loserId','error','empty','eloHistoryD3','__proto__','demotion','Gold','console','table','bind','Unknown\x20Player','docs','D3\x20ELO\x20history\x20recorded\x20for\x20','trace','Error\x20recording\x20D3\x20ELO\x20history:'];a15_0x1d3c=function(){return _0x1c7729;};return a15_0x1d3c();}export function resetPaginationD3(){lastVisibleD3=null;}
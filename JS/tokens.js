const a52_0xb43007=(function(){let _0x13680c=!![];return function(_0x266a4f,_0x4fd48a){const _0x54015b=_0x13680c?function(){if(_0x4fd48a){const _0xabd8b9=_0x4fd48a['apply'](_0x266a4f,arguments);return _0x4fd48a=null,_0xabd8b9;}}:function(){};return _0x13680c=![],_0x54015b;};}()),a52_0x10bc23=a52_0xb43007(this,function(){const _0x470ed3=a52_0x46cd;let _0x307622;try{const _0x355dc8=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x307622=_0x355dc8();}catch(_0x2886a9){_0x307622=window;}const _0x3e7e9e=_0x307622[_0x470ed3(0xc3)]=_0x307622['console']||{},_0x222653=[_0x470ed3(0xb2),'warn',_0x470ed3(0xc0),'error',_0x470ed3(0xbb),'table','trace'];for(let _0x12193f=0x0;_0x12193f<_0x222653[_0x470ed3(0xbe)];_0x12193f++){const _0xff35c1=a52_0xb43007['constructor'][_0x470ed3(0xb5)]['bind'](a52_0xb43007),_0x4268a5=_0x222653[_0x12193f],_0x5a1f05=_0x3e7e9e[_0x4268a5]||_0xff35c1;_0xff35c1['__proto__']=a52_0xb43007['bind'](a52_0xb43007),_0xff35c1['toString']=_0x5a1f05['toString']['bind'](_0x5a1f05),_0x3e7e9e[_0x4268a5]=_0xff35c1;}});a52_0x10bc23();import{doc,getDoc,getDocs,collection}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const tokenCache=new Map(),CACHE_DURATION=0x5*0x3c*0x3e8;export async function getUserTokens(_0xf79d2c){const _0x493cab=a52_0x46cd,_0x1c90fd='tokens_'+_0xf79d2c,_0x34e345=tokenCache['get'](_0x1c90fd);if(_0x34e345&&Date[_0x493cab(0xb3)]()-_0x34e345['timestamp']<CACHE_DURATION)return _0x34e345[_0x493cab(0xb7)];try{const _0x922a6a=doc(db,'userTokens',_0xf79d2c),_0x16891d=await getDoc(_0x922a6a);let _0x516c3e=[];return _0x16891d['exists']()&&(_0x516c3e=_0x16891d['data']()[_0x493cab(0xb7)]||[]),tokenCache['set'](_0x1c90fd,{'tokens':_0x516c3e,'timestamp':Date['now']()}),_0x516c3e;}catch(_0x273d4b){return console['error'](_0x493cab(0xb6),_0x273d4b),[];}}export async function getBulkUserTokens(_0x35a4dc){const _0x5755c5=a52_0x46cd,_0x50c27c=new Map(),_0x499dc5=[];_0x35a4dc[_0x5755c5(0xbc)](_0x952274=>{const _0x12290c=_0x5755c5,_0x29f321='tokens_'+_0x952274,_0x3ca5c1=tokenCache['get'](_0x29f321);_0x3ca5c1&&Date['now']()-_0x3ca5c1['timestamp']<CACHE_DURATION?_0x50c27c[_0x12290c(0xba)](_0x952274,_0x3ca5c1['tokens']):_0x499dc5['push'](_0x952274);});if(_0x499dc5['length']>0x0)try{const _0x1a0304=_0x499dc5['map'](async _0x20155a=>{const _0x2e84e6=_0x5755c5,_0x3f8494=doc(db,'userTokens',_0x20155a),_0x2ab9b0=await getDoc(_0x3f8494);let _0x219919=[];_0x2ab9b0['exists']()&&(_0x219919=_0x2ab9b0['data']()[_0x2e84e6(0xb7)]||[]);const _0x50946b='tokens_'+_0x20155a;return tokenCache['set'](_0x50946b,{'tokens':_0x219919,'timestamp':Date[_0x2e84e6(0xb3)]()}),[_0x20155a,_0x219919];}),_0x3ba1d3=await Promise['all'](_0x1a0304);_0x3ba1d3['forEach'](([_0x5b173f,_0x6b3a38])=>{const _0x4ad9c4=_0x5755c5;_0x50c27c[_0x4ad9c4(0xba)](_0x5b173f,_0x6b3a38);});}catch(_0x304916){console[_0x5755c5(0xbf)](_0x5755c5(0xc2),_0x304916);}return _0x50c27c;}export async function getTokensByUsernames(_0x167967){const _0x24139c=a52_0x46cd,_0x23c166=new Map();try{const _0x588711=collection(db,'userProfiles'),_0x476c1a=await getDocs(_0x588711),_0x337bbb=new Map();_0x476c1a['forEach'](_0x244ed5=>{const _0x17d177=a52_0x46cd,_0x25b06b=_0x244ed5['data']();_0x25b06b['username']&&_0x167967['includes'](_0x25b06b[_0x17d177(0xc4)])&&_0x337bbb['set'](_0x25b06b['username'],_0x244ed5['id']);});const _0x2a5994=Array['from'](_0x337bbb['values']());if(_0x2a5994['length']>0x0){const _0x159b40=await getBulkUserTokens(_0x2a5994);_0x337bbb[_0x24139c(0xbc)]((_0x1f460e,_0x1bb7cf)=>{const _0x4b113b=_0x24139c,_0x1e1e3d=_0x159b40[_0x4b113b(0xbd)](_0x1f460e)||[];_0x23c166['set'](_0x1bb7cf,_0x1e1e3d);});}}catch(_0x27b39b){console['error'](_0x24139c(0xc1),_0x27b39b);}return _0x23c166;}function a52_0x29e5(){const _0x4d1d5a=['log','now','seconds','prototype','Error\x20fetching\x20user\x20tokens:','tokens','delete','purchasedAt','set','exception','forEach','get','length','error','info','Error\x20fetching\x20tokens\x20by\x20usernames:','Error\x20fetching\x20bulk\x20user\x20tokens:','console','username','clear','getTime'];a52_0x29e5=function(){return _0x4d1d5a;};return a52_0x29e5();}function a52_0x46cd(_0x160937,_0x369968){const _0x10bc23=a52_0x29e5();return a52_0x46cd=function(_0xb43007,_0x2cc12e){_0xb43007=_0xb43007-0xb2;let _0x29e5a7=_0x10bc23[_0xb43007];return _0x29e5a7;},a52_0x46cd(_0x160937,_0x369968);}export function clearTokenCache(_0x134954=null){const _0x5a711b=a52_0x46cd;if(_0x134954){const _0x28a72f='tokens_'+_0x134954;tokenCache[_0x5a711b(0xb8)](_0x28a72f),console['log']('ðŸ—‘ï¸\x20Cleared\x20token\x20cache\x20for\x20user:\x20'+_0x134954);}else tokenCache[_0x5a711b(0xc5)](),console['log']('ðŸ—‘ï¸\x20Cleared\x20all\x20token\x20cache');}export async function forceRefreshUserTokens(_0x218469){return clearTokenCache(_0x218469),await getUserTokens(_0x218469);}export function getPrimaryDisplayToken(_0x3342af){const _0x4f21cb=a52_0x46cd;if(!_0x3342af||_0x3342af[_0x4f21cb(0xbe)]===0x0)return null;const _0x1b5958=_0x3342af['find'](_0x202784=>_0x202784['equipped']===!![]);if(_0x1b5958)return _0x1b5958;const _0x380ee1=[..._0x3342af]['sort']((_0x2153ec,_0x3883e2)=>{const _0x1c53ea=_0x4f21cb;let _0x479e4d,_0x11cf0e;if(_0x2153ec['purchasedAt']){if(_0x2153ec['purchasedAt'][_0x1c53ea(0xb4)])_0x479e4d=_0x2153ec['purchasedAt']['seconds'];else{if(_0x2153ec['purchasedAt']instanceof Date)_0x479e4d=_0x2153ec['purchasedAt']['getTime']()/0x3e8;else typeof _0x2153ec[_0x1c53ea(0xb9)]==='string'?_0x479e4d=new Date(_0x2153ec['purchasedAt'])[_0x1c53ea(0xc6)]()/0x3e8:_0x479e4d=0x0;}}else _0x479e4d=0x0;if(_0x3883e2['purchasedAt']){if(_0x3883e2[_0x1c53ea(0xb9)]['seconds'])_0x11cf0e=_0x3883e2['purchasedAt']['seconds'];else{if(_0x3883e2['purchasedAt']instanceof Date)_0x11cf0e=_0x3883e2['purchasedAt'][_0x1c53ea(0xc6)]()/0x3e8;else typeof _0x3883e2['purchasedAt']==='string'?_0x11cf0e=new Date(_0x3883e2['purchasedAt'])['getTime']()/0x3e8:_0x11cf0e=0x0;}}else _0x11cf0e=0x0;return _0x11cf0e-_0x479e4d;});return _0x380ee1[0x0];}
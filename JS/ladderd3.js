const a33t=a33b;(function(a,b){const s=a33b,c=a();while(!![]){try{const d=parseInt(s(0xd7))/0x1*(-parseInt(s(0x115))/0x2)+-parseInt(s(0xfd))/0x3*(parseInt(s(0x101))/0x4)+-parseInt(s(0x116))/0x5+-parseInt(s(0x10d))/0x6*(parseInt(s(0xea))/0x7)+-parseInt(s(0xe9))/0x8*(-parseInt(s(0x119))/0x9)+parseInt(s(0xd9))/0xa+-parseInt(s(0xe5))/0xb*(-parseInt(s(0x10b))/0xc);if(d===b)break;else c['push'](c['shift']());}catch(e){c['push'](c['shift']());}}}(a33a,0x1da8e));import{collection,getDocs,deleteDoc,doc,getDoc,query,where,updateDoc,Timestamp,onSnapshot,orderBy,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import{getRankStyle}from'./ranks.js';import a33c from'./firebase-idle-wrapper.js';const styleEl=document['createElement'](a33t(0x126));function a33a(){const O=['CgXHEwvYswq','pgLTzYbZCMm9iI4Ul2LTywDLCY9MBgfNCY8','rxjYB3iGDxbKyxrPBMCGrdmGruXpihrYzw5KigLUzgLJyxrVCNm6','Aw5SAw5L','Dgq6BNrOlwnOAwXKkdmP','z3jHEq','pc90zd4kicaGicaGica8Dgq+','zw1WDhK','jMXHzgrLCJ1KmYiGcIaGicaGicaGicaGicaGicaGicbZDhLSzt0Iy29SB3i6ia','BwfW','C2vJB25KCW','C3rYAw5N','CxvLCNLtzwXLy3rVCKfSBa','z2fTzu1Vzgu','DMLZAwjSzq','q291BgqGBM90igzPBMqGD2LUBMvYig9YigXVC2vYigLUieqZihbSyxLLCNmGBgLZDa','mteZmdm4qxrlqKvp','Dgv4DenVBNrLBNq','mty3nZi3mernr0j1wq','ChjLDMLVDxnfBg8','CxvLCNLtzwXLy3rVCG','CgLSB3q','CgXHEwvY','Cg9ZAxrPB24','tufyx1nbrKvFsu5uruDfuG','cIaGica8Dhi+cIaGicaGicaGphrKpG','cIaGicaGicaGicaGicaGica8l3rKpGOGicaGicaGicaGica8l3rYpGOGicaGicaGia','y2HHBMDL','B3bHy2L0Eq','i2XHzgrLCI1KmYb0AgvHzcb0CG','mJq2nZa0n2zVqKHnEa','C2v0','ywjZ','y291BNrYEq','ohP4yxPzCW','odG5zhHABwvZ','Aw5Uzxjive1m','zwXVuMf0Aw5N','CgXHEwvYC0qZ','oYbWB3nPDgLVBJOGCMvSyxrPDMu7iJ4kicaGicaGicaGicaGpgrPDIbJBgfZCZ0IzwXVlwnVBNrHAw5LCIiGC3r5Bgu9iMrPC3bSyxK6igzSzxG7igfSAwDUlwL0zw1ZoIbJzw50zxi7iJ4kicaGicaGicaGicaGicaGidXZCgfUignSyxnZpsjLBg8TDMfSDwuIpG','D2LUBMvYvxnLCM5HBwu','D2LUBMvYu2nVCMu','AM9PBG','C29YDa','lNbUzYiGcIaGicaGicaGicaGicaGicaGicaGicaGigfSDd0I','Bg9N','cIaGicaGicaGphrOpLjHBMS8l3rOpGOGicaGicaGidX0Ad5vC2vYBMfTztWVDgG+cIaGicaGicaGphrOpKvmtZWVDgG+cIaGicaGicaGphrOpK1HDgnOzxm8l3rOpGOGicaGicaGidX0Ad5xAw5Zpc90Ad4kicaGicaGica8DgG+tg9ZC2vZpc90Ad4kicaGicaGica8DgG+sY9epc90Ad4kicaGicaGica8DgG+v2LUifjHDgu8l3rOpGOGicaG','phrYpJX0zcbJB2XZCgfUpsi4iIbJBgfZCZ0IBg9HzgLUzY1JzwXSiJ5mB2fKAw5NieqZigXHzgrLCIbKyxrHlI4Upc90zd48l3rYpG','yxbWCM92zwrnyxrJAgvZrdm','rdm6iezVDw5KigvUDhjPzxmGzM9Yia','DgLTzxn0yw1W','zgf0yq','zxjYB3i','iZuWqZG3oa','ndmYowPtDLf2va','zMLYC3rqBgfJzurHDgu','zM9UDfDLAwDODa','Dg90ywXlAwXSCW','mZCYvfLsB1nO','Dg9gAxHLza','y2f0y2G','cIaGicaGicaGicaGicaGica8l2e+cIaGicaGicaGicaGicaGica','iIakicaGicaGicaGicaGicaGicaGicaGicaGy2XHC3m9iNbSyxLLCI1MBgfNiIakicaGicaGicaGicaGicaGicaGicaGicaGB25LCNjVCJ0IDgHPCY5ZDhLSzs5KAxnWBgf5psDUB25LjYi+','igzHBgXIywnRigvUDhjPzxm','y29SB3i','z2v0','DxnLCLbYB2zPBgvZ','i2XHzgrLCI1KmYb0yM9KEq','mJrQD3fuzLK','mc44nwvT','mtaXmdrmy0DxCxG','rdm6igvSB0HPC3rVCNLemYbPCYbLBxb0EsWGDhj5Aw5NigzHBgXIywnRlI4U','rdm6iezVDw5Kia','zM9YrwfJAa','C2L6zq','D2LUuMf0zq','Dg90ywXnyxrJAgvZ','zgvZyW','ngj6rKnLwG','ndKWnde1zMTdug91','rdmGtgfKzgvYihrHyMXLigjVzhKGBM90igzVDw5K','ChvZAa','mtu5nJG3ow9Mu1HZCG','Dg90ywXezwf0Ahm','zwXVsgLZDg9YEq','CgXHEwvYvxnLCM5HBwu','Bg9Zzxjty29Yzq','i0y0ndmZnG','rdm6ieXVB2TPBMCGzM9YievmtYbJAgfUz2vZigzVCIb1C2vYCZO','jtWVDgq+cIaGica8l3rYpG','zgLZCgXHEq','D2LUCW','AgfZ','cIaGlNn0CMvHAY1PBMrPy2f0B3iGEWOGicaGzM9UDc1ZAxPLoIaWlJLLBtSkicaGignVBg9YoIaJrKy0ntaWoWOGicaGBwfYz2LUlwXLzNq6idvWEdSkicaGigzVBNqTD2vPz2H0oIbIB2XKoWOGih0k','rdm6ia','C3r5Bgu','zMLSDgvY','Aw5JBhvKzxm','DxnLCM5HBwu'];a33a=function(){return O;};return a33a();}styleEl['textContent']=a33t(0x124),document['head']['appendChild'](styleEl);const playerCacheD3={'data':null,'timestamp':0x0},CACHE_DURATION=0x7530;async function displayLadderD3(a=![]){const u=a33t,b=document[u(0xdb)]('#ladder-d3\x20tbody');if(!b){console['error'](u(0x117));return;}b['innerHTML']=u(0xf6);try{const c=Date['now']();if(!a&&playerCacheD3['data']&&c-playerCacheD3[u(0xf9)]<CACHE_DURATION){updateLadderDisplayD3(playerCacheD3[u(0xfa)]);return;}const d=collection(db,u(0xed)),e=await getDocs(d),f=[];e[u(0x110)](l=>{const v=u,m=l[v(0xfa)]();m[v(0x129)]&&f[v(0x118)]({...m,'id':l['id'],'elo':m[v(0xec)]||0x0,'position':m['position']||Number[v(0xdf)]});});const g=collection(db,u(0x109)),h=await getDocs(g),i=new Map();h['forEach'](l=>{const w=u,m=l['data']();m['username']&&i['set'](m[w(0x129)]['toLowerCase'](),m);});for(const l of f){const m=l['username']['toLowerCase']();if(i[u(0x123)](m)){const n=i['get'](m);n['country']&&(l[u(0xe8)]=n[u(0xe8)]['toLowerCase']());}}const j=f[u(0xd0)](o=>o['username']),k=await fetchBatchMatchStatsD3(j);f['sort']((o,p)=>{const x=u,q=k[x(0x108)](o[x(0x129)])?.[x(0x113)]||0x0,r=k[x(0x108)](p[x(0x129)])?.['totalMatches']||0x0;if(q===0x0!==(r===0x0))return q===0x0?0x1:-0x1;return(o[x(0xde)]||0x3e7)-(p[x(0xde)]||0x3e7);}),f[u(0x110)]((o,p)=>{o['position']=p+0x1;}),playerCacheD3[u(0xfa)]=f,playerCacheD3[u(0xf9)]=c,updateLadderDisplayD3(f);}catch(o){console[u(0xfb)]('Error\x20loading\x20D3\x20ladder:',o),b[u(0xeb)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20colspan=\x228\x22\x20style=\x22text-align:\x20center;\x20color:\x20red;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Error\x20loading\x20D3\x20ladder\x20data:\x20'+o['message']+u(0xe1);}}function calculateStreakDays(a){const y=a33t;if(!a)return 0x0;const b=a['toDate'](),c=new Date(),d=Math[y(0xe7)](c-b);return Math['ceil'](d/(0x3e8*0x3c*0x3c*0x18));}function a33b(a,b){const c=a33a();return a33b=function(d,e){d=d-0xc7;let f=c[d];if(a33b['HRJCCv']===undefined){var g=function(l){const m='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let n='',o='';for(let p=0x0,q,r,s=0x0;r=l['charAt'](s++);~r&&(q=p%0x4?q*0x40+r:r,p++%0x4)?n+=String['fromCharCode'](0xff&q>>(-0x2*p&0x6)):0x0){r=m['indexOf'](r);}for(let t=0x0,u=n['length'];t<u;t++){o+='%'+('00'+n['charCodeAt'](t)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(o);};a33b['hKSSgC']=g,a=arguments,a33b['HRJCCv']=!![];}const h=c[0x0],i=d+h,j=a[i];return!j?(f=a33b['hKSSgC'](f),a[i]=f):f=j,f;},a33b(a,b);}async function updatePlayerPositions(a,b){const z=a33t;try{const c=collection(db,z(0xed)),d=await getDocs(c),e=[];d[z(0x110)](h=>{const A=z;e[A(0x118)]({'id':h['id'],...h['data']()});});const f=e['find'](h=>h['username']===a),g=e['find'](h=>h['username']===b);if(!f||!g){console['error'](z(0xd6));return;}if(f[z(0xde)]>g[z(0xde)]){const h=g['position'];for(const i of e){i[z(0xde)]>=g[z(0xde)]&&i[z(0xde)]<f['position']&&i[z(0x129)]!==a&&await updateDoc(doc(db,z(0xed),i['id']),{'position':i['position']+0x1});}await updateDoc(doc(db,z(0xed),f['id']),{'position':h});if(h===0x1){const j=doc(db,z(0xed),f['id']),k=await getDoc(j);!k['data']()[z(0xfe)]&&await updateDoc(j,{'firstPlaceDate':Timestamp['now']()});}if(g[z(0xde)]===0x1){const l=doc(db,z(0xed),g['id']);await updateDoc(l,{'firstPlaceDate':null});}}}catch(m){console[z(0xfb)]('Error\x20updating\x20D3\x20player\x20positions:',m);}}async function updateLadderDisplayD3(a){const B=a33t;a[B(0xf2)]((g,h)=>g[B(0xde)]-h[B(0xde)]);const b=document['querySelector'](B(0x10a));if(!b)return;b[B(0xeb)]='';const c=a['map'](g=>g['username']),d=await fetchBatchMatchStatsD3(c),e=document['querySelector'](B(0xe4));e[B(0xeb)]=B(0xf5);const f=a['map'](g=>{const h=d['get'](g['username'])||{'totalMatches':0x0,'wins':0x0,'losses':0x0,'kda':0x0,'winRate':0x0,'totalKills':0x0,'totalDeaths':0x0};return createPlayerRowD3(g,h);})[B(0xf1)]('');b[B(0xeb)]=f,getPlayersLastEloChangesD3(c)['then'](g=>{const C=B,h=new Map();b[C(0xd3)]('tr')[C(0x110)]((i,j)=>{const D=C;j<c['length']&&h[D(0xe6)](c[j],i);}),g[C(0x110)]((i,j)=>{const E=C,k=h[E(0x108)](j);if(k&&i!==0x0){const l=k[E(0xdb)](E(0xcb));if(l){const m=i>0x0?'+'+i:''+i,n=l['querySelector']('.trend-indicator');n&&(n[E(0xd8)]=m,n['style'][E(0x107)]=i>0x0?'#4CAF50':E(0x11e),n['style'][E(0xff)]='bold',n['style']['fontSize']=E(0x10c),n[E(0x126)][E(0x121)]=E(0xca),n[E(0x126)]['visibility']=E(0xd5),n['style'][E(0xe3)]='1');}}});})[B(0x103)](g=>console[B(0xfb)](B(0xc9),g));}async function fetchBatchMatchStatsD3(a){const F=a33t,b=new Map();try{const c=collection(db,F(0xf7)),d=await getDocs(c);d['forEach'](e=>{const G=F,f=e['data']();if(a[G(0x128)](f['winnerUsername'])){const g=f[G(0xef)];!b['has'](g)&&b[G(0xe6)](g,{'totalMatches':0x0,'wins':0x0,'losses':0x0,'totalKills':0x0,'totalDeaths':0x0,'kda':0x0,'winRate':0x0});const h=b['get'](g);h[G(0x122)]++,h[G(0x113)]++,h['totalKills']+=parseInt(f['winnerScore'])||0x0,h['totalDeaths']+=parseInt(f['loserScore'])||0x0;}if(a['includes'](f['loserUsername'])){const i=f['loserUsername'];!b['has'](i)&&b['set'](i,{'totalMatches':0x0,'wins':0x0,'losses':0x0,'totalKills':0x0,'totalDeaths':0x0,'kda':0x0,'winRate':0x0});const j=b['get'](i);j['losses']++,j[G(0x113)]++,j[G(0x100)]+=parseInt(f[G(0x11d)])||0x0,j[G(0x11a)]+=parseInt(f[G(0xf0)])||0x0;}}),b[F(0x110)](e=>{const H=F;e['kda']=e['totalDeaths']>0x0?(e['totalKills']/e['totalDeaths'])[H(0x102)](0x2):e['totalKills'],e[H(0x112)]=e[H(0x113)]>0x0?(e[H(0x122)]/e['totalMatches']*0x64)[H(0x102)](0x1):0x0;});}catch(e){console[F(0xfb)]('Error\x20fetching\x20batch\x20match\x20stats\x20for\x20D3:',e);}return b;}function createPlayerRowD3(a,b){const I=a33t,c=parseFloat(a['elo'])||0x0;let d=I(0xcc);if(c>=0x7d0)d=I(0xfc);else{if(c>=0x708)d='#FFD700';else{if(c>=0x640)d='#C0C0C0';else c>=0x578&&(d='#CD7F32');}}let e='';return a[I(0xe8)]&&(e=I(0xc8)+a[I(0xe8)]['toLowerCase']()+I(0xf3)+a['country']+I(0x105)),I(0xe0)+a['position']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td\x20style=\x22position:\x20relative;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20position:\x20relative;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username='+encodeURIComponent(a[I(0x129)])+I(0xcf)+d+';\x20text-decoration:\x20none;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+a['username']+I(0x104)+e+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td\x20style=\x22color:\x20'+d+I(0xee)+c+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22trend-indicator\x22\x20style=\x22margin-left:\x205px;\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+b['totalMatches']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+b[I(0x122)]+I(0xcd)+b['losses']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+b['kda']+I(0xcd)+b[I(0x112)]+I(0x120);}async function getPlayersLastEloChangesD3(a){const J=a33t,b=new Map();a['forEach'](c=>b[J(0xe6)](c,0x0));try{console[J(0xf4)](J(0x11f),a);const c=new Map(),d=await getDocs(collection(db,'playersD3'));d[J(0x110)](j=>{const K=J,k=j[K(0xfa)]();k['username']&&c['set'](j['id'],k['username']);}),console['log']('D3:\x20Player\x20ID\x20mappings:',Array['from'](c['entries']()));const e=collection(db,'eloHistoryD3'),f=query(e,orderBy(J(0xf9),J(0x114)),limit(0x64)),g=await getDocs(f);g[J(0xce)]?console[J(0xf4)](J(0x10e)):console[J(0xf4)]('D3:\x20Found\x20'+g[J(0x111)]+'\x20entries\x20in\x20eloHistoryD3');const h=new Map();g['forEach'](j=>{const L=J,k=j['data']();let l=null;if(k['username'])l=k['username'];else{if(k[L(0x11c)])l=k[L(0x11c)];else{if(k[L(0xdd)]&&typeof k['player']===L(0xd2))l=k[L(0xdd)];else{if(k['player']&&c['has'](k[L(0xdd)]))l=c['get'](k['player']);else k['playerId']&&c[L(0x123)](k[L(0xc7)])&&(l=c[L(0x108)](k[L(0xc7)]));}}}(k[L(0x129)]==='pilot'||k[L(0x11c)]==='pilot'||k['player']&&c['get'](k['player'])===L(0xdc))&&console['log']('D3:\x20Found\x20pilot\x20entry:',k),l&&a[L(0x128)](l)&&(!h['has'](l)&&h[L(0xe6)](l,[]),h['get'](l)['push']({...k,'timestamp':k[L(0xf9)]?.[L(0xd1)]||0x0}));}),console['log'](J(0xf8)+h[J(0x111)]+'\x20players'),h['forEach']((j,k)=>{const M=J;if(j['length']>0x0){j['sort']((m,n)=>n[M(0xf9)]-m[M(0xf9)]);const l=j['find'](m=>m[M(0xe2)]!==undefined||m['newElo']!==undefined&&m['previousElo']!==undefined);if(l){let m;if(l[M(0xe2)]!==undefined)m=l['change'];else l['newElo']!==undefined&&l[M(0xda)]!==undefined&&(m=l['newElo']-l['previousElo']);m!==undefined&&(b['set'](k,m),console[M(0xf4)](M(0x125)+k+'\x20ELO\x20change:\x20'+m));}}});if(h[J(0x111)]===0x0){console[J(0xf4)]('D3:\x20No\x20entries\x20found\x20in\x20eloHistoryD3,\x20trying\x20fallback...');const j=collection(db,J(0x11b)),k=query(j,where(J(0xd4),'==','D3'),orderBy('timestamp','desc'),limit(0x32));try{const l=await getDocs(k);console['log'](J(0x10f)+l[J(0x111)]+J(0x106)),l['forEach'](m=>{const N=J,n=m['data']();let o=n['username']||n['playerUsername'];!o&&n[N(0xdd)]&&c['has'](n[N(0xdd)])&&(o=c['get'](n['player']));if(o&&a[N(0x128)](o)){const p=n[N(0xe2)]||(n['newElo']!==undefined&&n[N(0xda)]!==undefined?n['newElo']-n[N(0xda)]:0x0);p!==0x0&&(b['set'](o,p),console[N(0xf4)]('D3:\x20'+o+'\x20fallback\x20ELO\x20change:\x20'+p));}});}catch(m){console[J(0xf4)]('D3:\x20Fallback\x20query\x20failed:',m);}}const i=Array['from'](b['entries']())[J(0x127)](([n,o])=>o!==0x0);console[J(0xf4)]('D3:\x20Final\x20ELO\x20changes:',i);}catch(n){console['error']('D3:\x20Error\x20fetching\x20ELO\x20history:',n);}return b;}export{displayLadderD3,updatePlayerPositions};
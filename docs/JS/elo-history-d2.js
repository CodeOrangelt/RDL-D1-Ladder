function a0_0x4665(_0x2d75bf,_0x223763){const _0x24f750=a0_0x4ba7();return a0_0x4665=function(_0xc8552c,_0x128d1b){_0xc8552c=_0xc8552c-0x1db;let _0x42fc84=_0x24f750[_0xc8552c];return _0x42fc84;},a0_0x4665(_0x2d75bf,_0x223763);}(function(_0xeb8162,_0x390c9c){const _0x4027b8=a0_0x4665,_0x271b58=_0xeb8162();while(!![]){try{const _0x1708aa=parseInt(_0x4027b8(0x1f3))/0x1+parseInt(_0x4027b8(0x1f0))/0x2+parseInt(_0x4027b8(0x1ef))/0x3*(parseInt(_0x4027b8(0x1eb))/0x4)+parseInt(_0x4027b8(0x1e5))/0x5+parseInt(_0x4027b8(0x1e8))/0x6*(-parseInt(_0x4027b8(0x1ea))/0x7)+parseInt(_0x4027b8(0x1e7))/0x8+-parseInt(_0x4027b8(0x1f1))/0x9;if(_0x1708aa===_0x390c9c)break;else _0x271b58['push'](_0x271b58['shift']());}catch(_0x24c878){_0x271b58['push'](_0x271b58['shift']());}}}(a0_0x4ba7,0x6e575));const a0_0x128d1b=(function(){let _0x506bae=!![];return function(_0x2f5e3a,_0x2af6c5){const _0x4d57c6=_0x506bae?function(){if(_0x2af6c5){const _0x3ab1b9=_0x2af6c5['apply'](_0x2f5e3a,arguments);return _0x2af6c5=null,_0x3ab1b9;}}:function(){};return _0x506bae=![],_0x4d57c6;};}()),a0_0xc8552c=a0_0x128d1b(this,function(){const _0x5199b7=a0_0x4665,_0x475029=function(){let _0x42a1fa;try{_0x42a1fa=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x24fcf8){_0x42a1fa=window;}return _0x42a1fa;},_0x5426a2=_0x475029(),_0x7e6dd0=_0x5426a2['console']=_0x5426a2['console']||{},_0x37eae5=['log','warn',_0x5199b7(0x1f6),'error','exception','table','trace'];for(let _0x1002f3=0x0;_0x1002f3<_0x37eae5['length'];_0x1002f3++){const _0x336a66=a0_0x128d1b['constructor']['prototype'][_0x5199b7(0x1df)](a0_0x128d1b),_0x11d5a3=_0x37eae5[_0x1002f3],_0x55a071=_0x7e6dd0[_0x11d5a3]||_0x336a66;_0x336a66[_0x5199b7(0x1dc)]=a0_0x128d1b['bind'](a0_0x128d1b),_0x336a66[_0x5199b7(0x1e0)]=_0x55a071['toString']['bind'](_0x55a071),_0x7e6dd0[_0x11d5a3]=_0x336a66;}});function a0_0x4ba7(){const _0x110273=['timestamp','bind','toString','playersD2','opponent','Silver','docs','3658900STTErc','Unknown\x20Player','3861264FisoIa','12eiIann','empty','2273229zsXRKY','153728pRDigI','error','desc','eloHistoryD2','3HUNFvJ','253036dbxXYD','4270932AUjMsu','data','196611IsTnzm','size','previousElo','info','loserId','__proto__','match'];a0_0x4ba7=function(){return _0x110273;};return a0_0x4ba7();}a0_0xc8552c();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D2=[{'name':'Gold','elo':0x708},{'name':'Silver','elo':0x640},{'name':'Bronze','elo':0x578},{'name':'Unranked','elo':0x4b0}];let lastVisibleD2=null;async function getUsernameByIdD2(_0x220204){const _0x5def34=a0_0x4665;try{if(!_0x220204)return'Unknown\x20Player';const _0x4bc7ab=await getDoc(doc(db,_0x5def34(0x1e1),_0x220204));if(_0x4bc7ab['exists']())return _0x4bc7ab['data']()['username']||'Unknown\x20Player';const _0x5516bc=await getDocs(query(collection(db,'approvedMatchesD2'),where('winnerId','==',_0x220204),limit(0x1)));if(!_0x5516bc[_0x5def34(0x1e9)])return _0x5516bc[_0x5def34(0x1e4)][0x0]['data']()['winnerUsername']||'Unknown\x20Player';const _0x1934a6=await getDocs(query(collection(db,'approvedMatchesD2'),where(_0x5def34(0x1db),'==',_0x220204),limit(0x1)));if(!_0x1934a6['empty'])return _0x1934a6['docs'][0x0]['data']()['loserUsername']||'Unknown\x20Player';return _0x5def34(0x1e6);}catch(_0x469459){return console['error']('Error\x20getting\x20username:',_0x469459),_0x5def34(0x1e6);}}export async function recordEloChangeD2({playerId:_0x456d9f,previousElo:_0x38bcb5,newElo:_0x4be22f,opponentId:_0x21327d,matchResult:_0x90a2f3,previousPosition:_0x4ba11d,newPosition:_0x5b67cf,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x16e0a0,timestamp:_0x65fcc0}){const _0x3d837f=a0_0x4665;try{const _0x2bc9a7=doc(collection(db,'eloHistoryD2'));let _0x15ae11=_0x3d837f(0x1dd);if(isPromotion)_0x15ae11='promotion';if(isDemotion)_0x15ae11='demotion';let _0x1cb674='Unranked';if(_0x4be22f>=0x834)_0x1cb674='Emerald';else{if(_0x4be22f>=0x708)_0x1cb674='Gold';else{if(_0x4be22f>=0x640)_0x1cb674=_0x3d837f(0x1e3);else{if(_0x4be22f>=0x578)_0x1cb674='Bronze';}}}return await setDoc(_0x2bc9a7,{'type':_0x15ae11,'player':_0x456d9f,'opponent':_0x21327d,'previousElo':_0x38bcb5,'newElo':_0x4be22f,'change':_0x4be22f-_0x38bcb5,'matchResult':_0x90a2f3,'previousPosition':_0x4ba11d,'newPosition':_0x5b67cf,'rankAchieved':_0x1cb674,'matchId':_0x16e0a0,'timestamp':_0x65fcc0}),console['log']('D2\x20ELO\x20history\x20recorded\x20for\x20'+_0x456d9f),!![];}catch(_0x274ef9){console['error']('Error\x20recording\x20D2\x20ELO\x20history:',_0x274ef9);throw _0x274ef9;}}export async function getEloHistoryD2(_0x456a03=0x14){const _0x55a32e=a0_0x4665;try{const _0x23cef9=collection(db,_0x55a32e(0x1ee));let _0x2588f6;lastVisibleD2?_0x2588f6=query(_0x23cef9,orderBy(_0x55a32e(0x1de),'desc'),startAfter(lastVisibleD2),limit(_0x456a03)):_0x2588f6=query(_0x23cef9,orderBy('timestamp',_0x55a32e(0x1ed)),limit(_0x456a03));const _0x27adc1=await getDocs(_0x2588f6);if(_0x27adc1['empty'])return{'entries':[],'hasMore':![]};lastVisibleD2=_0x27adc1['docs'][_0x27adc1['docs']['length']-0x1];const _0x3b2b69=_0x27adc1['docs']['map'](async _0x1ea464=>{const _0x319674=_0x55a32e,_0x1e286f=_0x1ea464[_0x319674(0x1f2)](),[_0x6eae23,_0xee1e20]=await Promise['all']([getUsernameByIdD2(_0x1e286f['player']),getUsernameByIdD2(_0x1e286f[_0x319674(0x1e2)])]);return{..._0x1e286f,'playerUsername':_0x6eae23,'opponentUsername':_0xee1e20,'change':_0x1e286f['newElo']-_0x1e286f[_0x319674(0x1f5)],'timestamp':_0x1e286f['timestamp']};}),_0x30dc37=await Promise['all'](_0x3b2b69);return{'entries':_0x30dc37,'hasMore':_0x27adc1[_0x55a32e(0x1f4)]===_0x456a03};}catch(_0x5112d6){console[_0x55a32e(0x1ec)]('Error\x20fetching\x20D2\x20ELO\x20history:',_0x5112d6);throw _0x5112d6;}}export function resetPaginationD2(){lastVisibleD2=null;}
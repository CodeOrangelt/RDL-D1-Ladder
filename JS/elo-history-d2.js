function a14_0x5829(){const _0x3ad927=['demotion','data','Unknown\x20Player','constructor','docs','Unranked','Bronze','error','bind','log','Error\x20fetching\x20D2\x20ELO\x20history:','console','toString','info','exception','eloHistoryD2','Gold','winnerUsername','Silver','empty','desc'];a14_0x5829=function(){return _0x3ad927;};return a14_0x5829();}const a14_0x231707=a14_0x57d2,a14_0x5cd549=(function(){let _0x5e189c=!![];return function(_0x258a03,_0x2ba907){const _0x57fbde=_0x5e189c?function(){if(_0x2ba907){const _0x4bd73f=_0x2ba907['apply'](_0x258a03,arguments);return _0x2ba907=null,_0x4bd73f;}}:function(){};return _0x5e189c=![],_0x57fbde;};}()),a14_0x8e9545=a14_0x5cd549(this,function(){const _0x2731e6=a14_0x57d2,_0x12895a=function(){let _0xff2aa6;try{_0xff2aa6=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x2d97f9){_0xff2aa6=window;}return _0xff2aa6;},_0x119c43=_0x12895a(),_0x320186=_0x119c43['console']=_0x119c43[_0x2731e6(0x10e)]||{},_0x4ef950=['log','warn',_0x2731e6(0x110),'error',_0x2731e6(0x111),'table','trace'];for(let _0x8b7444=0x0;_0x8b7444<_0x4ef950['length'];_0x8b7444++){const _0x32f26f=a14_0x5cd549[_0x2731e6(0x106)]['prototype'][_0x2731e6(0x10b)](a14_0x5cd549),_0x21b9e3=_0x4ef950[_0x8b7444],_0x1e1339=_0x320186[_0x21b9e3]||_0x32f26f;_0x32f26f['__proto__']=a14_0x5cd549['bind'](a14_0x5cd549),_0x32f26f['toString']=_0x1e1339[_0x2731e6(0x10f)]['bind'](_0x1e1339),_0x320186[_0x21b9e3]=_0x32f26f;}});a14_0x8e9545();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';function a14_0x57d2(_0x584649,_0x44727d){const _0x8e9545=a14_0x5829();return a14_0x57d2=function(_0x5cd549,_0x33d34d){_0x5cd549=_0x5cd549-0x103;let _0x5829b5=_0x8e9545[_0x5cd549];return _0x5829b5;},a14_0x57d2(_0x584649,_0x44727d);}const ELO_THRESHOLDS_D2=[{'name':a14_0x231707(0x113),'elo':0x708},{'name':'Silver','elo':0x640},{'name':'Bronze','elo':0x578},{'name':a14_0x231707(0x108),'elo':0x4b0}];let lastVisibleD2=null;async function getUsernameByIdD2(_0x27bfe6){const _0x4c8b86=a14_0x231707;try{if(!_0x27bfe6)return'Unknown\x20Player';const _0x59445c=await getDoc(doc(db,'playersD2',_0x27bfe6));if(_0x59445c['exists']())return _0x59445c['data']()['username']||'Unknown\x20Player';const _0x15721a=await getDocs(query(collection(db,'approvedMatchesD2'),where('winnerId','==',_0x27bfe6),limit(0x1)));if(!_0x15721a['empty'])return _0x15721a['docs'][0x0]['data']()[_0x4c8b86(0x114)]||'Unknown\x20Player';const _0x196c83=await getDocs(query(collection(db,'approvedMatchesD2'),where('loserId','==',_0x27bfe6),limit(0x1)));if(!_0x196c83[_0x4c8b86(0x116)])return _0x196c83[_0x4c8b86(0x107)][0x0]['data']()['loserUsername']||'Unknown\x20Player';return _0x4c8b86(0x105);}catch(_0x55993a){return console['error']('Error\x20getting\x20username:',_0x55993a),'Unknown\x20Player';}}export async function recordEloChangeD2({playerId:_0x2de1b8,previousElo:_0x571471,newElo:_0x598816,opponentId:_0x45c0fa,matchResult:_0x20b70b,previousPosition:_0x16d291,newPosition:_0x241bbf,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x4b3b3,timestamp:_0x391200}){const _0x1bc997=a14_0x231707;try{const _0x2d8039=doc(collection(db,_0x1bc997(0x112)));let _0x1bb837='match';if(isPromotion)_0x1bb837='promotion';if(isDemotion)_0x1bb837=_0x1bc997(0x103);let _0x15b585='Unranked';if(_0x598816>=0x834)_0x15b585='Emerald';else{if(_0x598816>=0x708)_0x15b585='Gold';else{if(_0x598816>=0x640)_0x15b585=_0x1bc997(0x115);else{if(_0x598816>=0x578)_0x15b585=_0x1bc997(0x109);}}}return await setDoc(_0x2d8039,{'type':_0x1bb837,'player':_0x2de1b8,'opponent':_0x45c0fa,'previousElo':_0x571471,'newElo':_0x598816,'change':_0x598816-_0x571471,'matchResult':_0x20b70b,'previousPosition':_0x16d291,'newPosition':_0x241bbf,'rankAchieved':_0x15b585,'matchId':_0x4b3b3,'timestamp':_0x391200}),console[_0x1bc997(0x10c)]('D2\x20ELO\x20history\x20recorded\x20for\x20'+_0x2de1b8),!![];}catch(_0x2c5c86){console[_0x1bc997(0x10a)]('Error\x20recording\x20D2\x20ELO\x20history:',_0x2c5c86);throw _0x2c5c86;}}export async function getEloHistoryD2(_0x607163=0x14){const _0x44078a=a14_0x231707;try{const _0x3524b8=collection(db,'eloHistoryD2');let _0x520836;lastVisibleD2?_0x520836=query(_0x3524b8,orderBy('timestamp',_0x44078a(0x117)),startAfter(lastVisibleD2),limit(_0x607163)):_0x520836=query(_0x3524b8,orderBy('timestamp',_0x44078a(0x117)),limit(_0x607163));const _0x1c5fb6=await getDocs(_0x520836);if(_0x1c5fb6['empty'])return{'entries':[],'hasMore':![]};lastVisibleD2=_0x1c5fb6[_0x44078a(0x107)][_0x1c5fb6['docs']['length']-0x1];const _0x5df20a=_0x1c5fb6['docs']['map'](async _0x488f00=>{const _0x29b450=_0x44078a,_0x5ceb83=_0x488f00[_0x29b450(0x104)](),[_0x5c775c,_0x28b89f]=await Promise['all']([getUsernameByIdD2(_0x5ceb83['player']),getUsernameByIdD2(_0x5ceb83['opponent'])]);return{..._0x5ceb83,'playerUsername':_0x5c775c,'opponentUsername':_0x28b89f,'change':_0x5ceb83['newElo']-_0x5ceb83['previousElo'],'timestamp':_0x5ceb83['timestamp']};}),_0x472e20=await Promise['all'](_0x5df20a);return{'entries':_0x472e20,'hasMore':_0x1c5fb6['size']===_0x607163};}catch(_0x133144){console['error'](_0x44078a(0x10d),_0x133144);throw _0x133144;}}export function resetPaginationD2(){lastVisibleD2=null;}
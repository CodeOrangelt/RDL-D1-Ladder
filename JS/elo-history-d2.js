const a14_0x5675b3=a14_0x2009,a14_0x58d9b4=(function(){let _0x35fab4=!![];return function(_0x152fa8,_0x5496e9){const _0x185f0a=_0x35fab4?function(){if(_0x5496e9){const _0x38749c=_0x5496e9['apply'](_0x152fa8,arguments);return _0x5496e9=null,_0x38749c;}}:function(){};return _0x35fab4=![],_0x185f0a;};}()),a14_0x516828=a14_0x58d9b4(this,function(){const _0x5849ef=a14_0x2009,_0x368a25=function(){let _0x1536ab;try{_0x1536ab=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x2a09d0){_0x1536ab=window;}return _0x1536ab;},_0x3b745b=_0x368a25(),_0x2a214d=_0x3b745b['console']=_0x3b745b[_0x5849ef(0x119)]||{},_0x28edb2=['log','warn','info','error','exception','table','trace'];for(let _0x1d9d26=0x0;_0x1d9d26<_0x28edb2['length'];_0x1d9d26++){const _0x3607bf=a14_0x58d9b4[_0x5849ef(0x118)]['prototype'][_0x5849ef(0x112)](a14_0x58d9b4),_0x14324c=_0x28edb2[_0x1d9d26],_0x27e3a5=_0x2a214d[_0x14324c]||_0x3607bf;_0x3607bf['__proto__']=a14_0x58d9b4[_0x5849ef(0x112)](a14_0x58d9b4),_0x3607bf[_0x5849ef(0x117)]=_0x27e3a5['toString']['bind'](_0x27e3a5),_0x2a214d[_0x14324c]=_0x3607bf;}});a14_0x516828();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';function a14_0x271a(){const _0x419fd3=['Unknown\x20Player','bind','match','previousElo','desc','D2\x20ELO\x20history\x20recorded\x20for\x20','toString','constructor','console','playersD2','Bronze','Silver','opponent','timestamp','map','all','docs'];a14_0x271a=function(){return _0x419fd3;};return a14_0x271a();}const ELO_THRESHOLDS_D2=[{'name':'Gold','elo':0x708},{'name':a14_0x5675b3(0x11c),'elo':0x640},{'name':'Bronze','elo':0x578},{'name':'Unranked','elo':0x4b0}];let lastVisibleD2=null;async function getUsernameByIdD2(_0x1a1688){const _0x581155=a14_0x5675b3;try{if(!_0x1a1688)return'Unknown\x20Player';const _0x29fe8e=await getDoc(doc(db,_0x581155(0x11a),_0x1a1688));if(_0x29fe8e['exists']())return _0x29fe8e['data']()['username']||'Unknown\x20Player';const _0x508549=await getDocs(query(collection(db,'approvedMatchesD2'),where('winnerId','==',_0x1a1688),limit(0x1)));if(!_0x508549['empty'])return _0x508549['docs'][0x0]['data']()['winnerUsername']||'Unknown\x20Player';const _0x10e457=await getDocs(query(collection(db,'approvedMatchesD2'),where('loserId','==',_0x1a1688),limit(0x1)));if(!_0x10e457['empty'])return _0x10e457['docs'][0x0]['data']()['loserUsername']||_0x581155(0x111);return'Unknown\x20Player';}catch(_0xe8f8fe){return console['error']('Error\x20getting\x20username:',_0xe8f8fe),'Unknown\x20Player';}}export async function recordEloChangeD2({playerId:_0x4cadf5,previousElo:_0x512a43,newElo:_0x131560,opponentId:_0xa9b06e,matchResult:_0x59b7a0,previousPosition:_0x70983a,newPosition:_0x5c0483,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x692230,timestamp:_0x1167ee}){const _0xdd5558=a14_0x5675b3;try{const _0x5be99d=doc(collection(db,'eloHistoryD2'));let _0x315b86=_0xdd5558(0x113);if(isPromotion)_0x315b86='promotion';if(isDemotion)_0x315b86='demotion';let _0x1e7153='Unranked';if(_0x131560>=0x834)_0x1e7153='Emerald';else{if(_0x131560>=0x708)_0x1e7153='Gold';else{if(_0x131560>=0x640)_0x1e7153='Silver';else{if(_0x131560>=0x578)_0x1e7153=_0xdd5558(0x11b);}}}return await setDoc(_0x5be99d,{'type':_0x315b86,'player':_0x4cadf5,'opponent':_0xa9b06e,'previousElo':_0x512a43,'newElo':_0x131560,'change':_0x131560-_0x512a43,'matchResult':_0x59b7a0,'previousPosition':_0x70983a,'newPosition':_0x5c0483,'rankAchieved':_0x1e7153,'matchId':_0x692230,'timestamp':_0x1167ee}),console['log'](_0xdd5558(0x116)+_0x4cadf5),!![];}catch(_0x3650cc){console['error']('Error\x20recording\x20D2\x20ELO\x20history:',_0x3650cc);throw _0x3650cc;}}export async function getEloHistoryD2(_0x20b5e2=0x14){const _0xf22c0d=a14_0x5675b3;try{const _0x4ef1ef=collection(db,'eloHistoryD2');let _0x31fbc9;lastVisibleD2?_0x31fbc9=query(_0x4ef1ef,orderBy('timestamp',_0xf22c0d(0x115)),startAfter(lastVisibleD2),limit(_0x20b5e2)):_0x31fbc9=query(_0x4ef1ef,orderBy(_0xf22c0d(0x11e),'desc'),limit(_0x20b5e2));const _0x18c8bc=await getDocs(_0x31fbc9);if(_0x18c8bc['empty'])return{'entries':[],'hasMore':![]};lastVisibleD2=_0x18c8bc[_0xf22c0d(0x121)][_0x18c8bc[_0xf22c0d(0x121)]['length']-0x1];const _0x40da1=_0x18c8bc['docs'][_0xf22c0d(0x11f)](async _0x3abade=>{const _0xe05565=_0xf22c0d,_0x56a891=_0x3abade['data'](),[_0x31a498,_0xd93803]=await Promise['all']([getUsernameByIdD2(_0x56a891['player']),getUsernameByIdD2(_0x56a891[_0xe05565(0x11d)])]);return{..._0x56a891,'playerUsername':_0x31a498,'opponentUsername':_0xd93803,'change':_0x56a891['newElo']-_0x56a891[_0xe05565(0x114)],'timestamp':_0x56a891['timestamp']};}),_0x3d129a=await Promise[_0xf22c0d(0x120)](_0x40da1);return{'entries':_0x3d129a,'hasMore':_0x18c8bc['size']===_0x20b5e2};}catch(_0x73c18a){console['error']('Error\x20fetching\x20D2\x20ELO\x20history:',_0x73c18a);throw _0x73c18a;}}function a14_0x2009(_0xa37e3f,_0x3ccb0e){const _0x516828=a14_0x271a();return a14_0x2009=function(_0x58d9b4,_0x3bb6ce){_0x58d9b4=_0x58d9b4-0x111;let _0x271ac6=_0x516828[_0x58d9b4];return _0x271ac6;},a14_0x2009(_0xa37e3f,_0x3ccb0e);}export function resetPaginationD2(){lastVisibleD2=null;}
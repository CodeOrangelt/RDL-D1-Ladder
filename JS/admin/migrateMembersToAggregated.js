import{initializeApp}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';import{getFirestore,collection,getDocs,writeBatch,doc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a1_0x3a78(){const _0x5000e2=['userProfiles','length','set','forEach','prototype','commit','isNonParticipant','\x20non-participants','üíæ\x20Writing\x20aggregated\x20data...','has','log','‚öôÔ∏è\x20Processed\x20','size','üí°\x20Refresh\x20your\x20members\x20page\x20to\x20see\x20the\x20results!','return\x20(function()\x20','unranked','üéâ\x20Successfully\x20migrated\x20','trace','elo','push','error','üì¶\x20Prepared\x20batch\x20','playersD2','\x20unique\x20members','country','sort','apply','console'];a1_0x3a78=function(){return _0x5000e2;};return a1_0x3a78();}import{firebaseConfig}from'../firebase-config.js';const app=initializeApp(firebaseConfig),db=getFirestore(app);function a1_0x2356(_0x809f67,_0x13da20){const _0x1450a1=a1_0x3a78();return a1_0x2356=function(_0xbfc79b,_0x5990e1){_0xbfc79b=_0xbfc79b-0x17b;let _0x3a78f6=_0x1450a1[_0xbfc79b];return _0x3a78f6;},a1_0x2356(_0x809f67,_0x13da20);}async function migrateToAggregatedMembers(){const _0x11f2d=a1_0x2356,_0x43b540=(function(){let _0x55be02=!![];return function(_0x5c439e,_0x2b6b2e){const _0x542ce0=_0x55be02?function(){const _0x385e30=a1_0x2356;if(_0x2b6b2e){const _0x143f07=_0x2b6b2e[_0x385e30(0x195)](_0x5c439e,arguments);return _0x2b6b2e=null,_0x143f07;}}:function(){};return _0x55be02=![],_0x542ce0;};}()),_0x4088be=_0x43b540(this,function(){const _0xc1ed5=a1_0x2356,_0x5a5250=function(){const _0x269c40=a1_0x2356;let _0x3b0fa3;try{_0x3b0fa3=Function(_0x269c40(0x189)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x398bce){_0x3b0fa3=window;}return _0x3b0fa3;},_0x22f36a=_0x5a5250(),_0x4793b3=_0x22f36a[_0xc1ed5(0x196)]=_0x22f36a['console']||{},_0x4311a9=['log','warn','info','error','exception','table',_0xc1ed5(0x18c)];for(let _0x36e906=0x0;_0x36e906<_0x4311a9[_0xc1ed5(0x17c)];_0x36e906++){const _0x8e158e=_0x43b540['constructor'][_0xc1ed5(0x17f)]['bind'](_0x43b540),_0x4fddda=_0x4311a9[_0x36e906],_0x55e703=_0x4793b3[_0x4fddda]||_0x8e158e;_0x8e158e['__proto__']=_0x43b540['bind'](_0x43b540),_0x8e158e['toString']=_0x55e703['toString']['bind'](_0x55e703),_0x4793b3[_0x4fddda]=_0x8e158e;}});_0x4088be(),console['log']('üîÑ\x20Starting\x20migration\x20to\x20aggregated\x20members...');try{console[_0x11f2d(0x185)]('üì•\x20Fetching\x20all\x20collections...');const [_0x187415,_0x1f3db1,_0x3c8e63,_0xe8f05,_0x29df10]=await Promise['all']([getDocs(collection(db,_0x11f2d(0x17b))),getDocs(collection(db,'players')),getDocs(collection(db,_0x11f2d(0x191))),getDocs(collection(db,'playersD3')),getDocs(collection(db,'nonParticipants'))]);console['log']('‚úÖ\x20Data\x20fetched:\x20'+_0x187415[_0x11f2d(0x187)]+'\x20profiles,\x20'+_0x1f3db1['size']+'\x20D1,\x20'+_0x3c8e63['size']+'\x20D2,\x20'+_0xe8f05[_0x11f2d(0x187)]+'\x20D3,\x20'+_0x29df10['size']+_0x11f2d(0x182));const _0x35a76f=new Map();_0x187415['forEach'](_0x184f15=>{_0x35a76f['set'](_0x184f15['id'],_0x184f15['data']());});const _0x4e18cf=new Map(),_0x4a17e3=(_0x3f56a2,_0x5b1f5f)=>{const _0x12fecb=_0x11f2d;_0x3f56a2[_0x12fecb(0x17e)](_0x21ed26=>{const _0x4f6551=_0x21ed26['data'](),_0x486517=_0x21ed26['id'];!_0x4e18cf['has'](_0x486517)&&_0x4e18cf['set'](_0x486517,{'userId':_0x486517,'username':_0x4f6551['username']||_0x4f6551['name']||'Unknown','ladders':[],'isNonParticipant':![]});const _0x42b6cd=_0x4e18cf['get'](_0x486517);_0x42b6cd['ladders']['push']({'ladder':_0x5b1f5f,'elo':_0x4f6551['eloRating']||_0x4f6551['elo']||0x4b0,'active':_0x4f6551['active']!==![]});});};_0x4a17e3(_0x1f3db1,'D1'),_0x4a17e3(_0x3c8e63,'D2'),_0x4a17e3(_0xe8f05,'D3'),_0x29df10['forEach'](_0x240c0e=>{const _0x331093=_0x11f2d,_0x41d577=_0x240c0e['data'](),_0x43a99a=_0x240c0e['id'];!_0x4e18cf[_0x331093(0x184)](_0x43a99a)&&(_0x41d577['username']||_0x41d577['name'])&&_0x4e18cf[_0x331093(0x17d)](_0x43a99a,{'userId':_0x43a99a,'username':_0x41d577['username']||_0x41d577['name'],'ladders':[],'isNonParticipant':!![]});}),console['log'](_0x11f2d(0x186)+_0x4e18cf['size']+_0x11f2d(0x192)),console['log'](_0x11f2d(0x183));const _0x44d55b=[];let _0x4f2a8a=writeBatch(db),_0x144bf6=0x0,_0x425200=0x0;_0x4e18cf['forEach']((_0x135a3c,_0x16411f)=>{const _0x376552=_0x11f2d,_0x2be0b1=_0x35a76f['get'](_0x16411f)||{};let _0x543ae4=0x0,_0x3fac50=null;if(_0x135a3c['ladders']['length']>0x0){const _0x21a70f=_0x135a3c['ladders'][_0x376552(0x194)]((_0xdc24df,_0x27643c)=>_0x27643c['elo']-_0xdc24df[_0x376552(0x18d)]);_0x543ae4=_0x21a70f[0x0]['elo'],_0x3fac50=_0x21a70f[0x0]['ladder'];}const _0x47ac73={'userId':_0x16411f,'username':_0x135a3c['username'],'profileImageUrl':_0x2be0b1['profileImageUrl']||null,'country':_0x2be0b1[_0x376552(0x193)]||null,'motto':_0x2be0b1['motto']||null,'favoriteMap':_0x2be0b1['favoriteMap']||null,'favoriteWeapon':_0x2be0b1['favoriteWeapon']||null,'isNonParticipant':_0x135a3c[_0x376552(0x181)],'ladders':_0x135a3c['ladders'],'primaryLadder':_0x3fac50,'highestElo':_0x543ae4,'rank':getPlayerRank(_0x543ae4),'lastUpdated':new Date(),'migrationTimestamp':new Date()['toISOString']()},_0x54f6bd=doc(collection(db,'aggregatedMembers'),_0x16411f);_0x4f2a8a['set'](_0x54f6bd,_0x47ac73),_0x144bf6++,_0x425200++,_0x144bf6>=0x1c2&&(_0x44d55b['push'](_0x4f2a8a[_0x376552(0x180)]()),_0x4f2a8a=writeBatch(db),_0x144bf6=0x0,console[_0x376552(0x185)](_0x376552(0x190)+_0x44d55b['length']+'\x20('+_0x425200+'\x20members\x20processed)'));}),_0x144bf6>0x0&&_0x44d55b[_0x11f2d(0x18e)](_0x4f2a8a[_0x11f2d(0x180)]()),console[_0x11f2d(0x185)]('üöÄ\x20Executing\x20'+_0x44d55b[_0x11f2d(0x17c)]+'\x20batches...'),await Promise['all'](_0x44d55b),console[_0x11f2d(0x185)](_0x11f2d(0x18b)+_0x4e18cf['size']+'\x20members\x20to\x20aggregated\x20collection!'),console['log'](_0x11f2d(0x188));}catch(_0x222078){console['error']('‚ùå\x20Migration\x20failed:',_0x222078),_0x222078['code']==='permission-denied'&&console[_0x11f2d(0x18f)]('üîí\x20Permission\x20denied.\x20Make\x20sure\x20you\x27re\x20signed\x20in\x20as\x20an\x20admin\x20and\x20security\x20rules\x20allow\x20access\x20to\x20aggregatedMembers\x20collection.');}}function getPlayerRank(_0x453328){const _0x2154bb=a1_0x2356;if(_0x453328>=0x7d0)return'emerald';if(_0x453328>=0x708)return'gold';if(_0x453328>=0x640)return'silver';if(_0x453328>=0x578)return'bronze';return _0x2154bb(0x18a);}migrateToAggregatedMembers();
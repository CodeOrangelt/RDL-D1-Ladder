(function(a,b){const t=a32b,c=a();while(!![]){try{const d=-parseInt(t(0x106))/0x1+parseInt(t(0xe0))/0x2+-parseInt(t(0xce))/0x3+-parseInt(t(0xba))/0x4*(parseInt(t(0x105))/0x5)+-parseInt(t(0xc3))/0x6+-parseInt(t(0xdf))/0x7+parseInt(t(0xbc))/0x8*(parseInt(t(0xff))/0x9);if(d===b)break;else c['push'](c['shift']());}catch(e){c['push'](c['shift']());}}}(a32a,0x8bf9b));import{collection,getDocs,deleteDoc,doc,getDoc,query,where,updateDoc,Timestamp,onSnapshot,orderBy,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import{getRankStyle}from'./ranks.js';import a32c from'./firebase-idle-wrapper.js';const playerCacheD2={'data':null,'timestamp':0x0},CACHE_DURATION=0x7530;function a32b(a,b){const c=a32a();return a32b=function(d,e){d=d-0xb8;let f=c[d];if(a32b['QGOLWv']===undefined){var g=function(l){const m='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let n='',o='';for(let p=0x0,q,r,s=0x0;r=l['charAt'](s++);~r&&(q=p%0x4?q*0x40+r:r,p++%0x4)?n+=String['fromCharCode'](0xff&q>>(-0x2*p&0x6)):0x0){r=m['indexOf'](r);}for(let t=0x0,u=n['length'];t<u;t++){o+='%'+('00'+n['charCodeAt'](t)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(o);};a32b['VpMHye']=g,a=arguments,a32b['QGOLWv']=!![];}const h=c[0x0],i=d+h,j=a[i];return!j?(f=a32b['VpMHye'](f),a[i]=f):f=j,f;},a32b(a,b);}async function displayLadderD2(a=![]){const u=a32b,b=document['querySelector'](u(0xc7));if(!b){console['error']('D2\x20Ladder\x20table\x20body\x20not\x20found');return;}b[u(0x100)]=u(0x109);try{const c=Date['now']();if(!a&&playerCacheD2['data']&&c-playerCacheD2['timestamp']<CACHE_DURATION){updateLadderDisplayD2(playerCacheD2[u(0xdc)]);return;}const d=collection(db,u(0xf1)),e=query(d,orderBy('position','asc')),f=await a32c[u(0xcc)](d),g=[];f[u(0x103)](m=>{const v=u,n=m['data']();n[v(0xf3)]&&g[v(0xc6)]({...n,'id':m['id'],'elo':n[v(0xda)]||0x0,'position':n[v(0xde)]||Number['MAX_SAFE_INTEGER']});});const h=collection(db,u(0x10b)),i=await getDocs(h),j=new Map();i[u(0x103)](m=>{const w=u,n=m['data']();n['username']&&j['set'](n[w(0xf3)][w(0xfd)](),n);});for(const m of g){const n=m['username']['toLowerCase']();if(j['has'](n)){const o=j[u(0xf7)](n);o['country']&&(m['country']=o[u(0xf9)]['toLowerCase']());}}const k=g[u(0xbd)](q=>q['username']),l=await fetchBatchMatchStatsD2(k);g['sort']((p,q)=>{const x=u,r=l[x(0xf7)](p['username'])?.[x(0x101)]||0x0,s=l[x(0xf7)](q['username'])?.[x(0x101)]||0x0;if(r===0x0!==(s===0x0))return r===0x0?0x1:-0x1;return(p[x(0xde)]||0x3e7)-(q['position']||0x3e7);}),g['forEach']((p,q)=>{const y=u;p[y(0xde)]=q+0x1;}),playerCacheD2['data']=g,playerCacheD2['timestamp']=c,updateLadderDisplayD2(g);}catch(p){console[u(0xeb)](u(0x108),p),b['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20colspan=\x228\x22\x20style=\x22text-align:\x20center;\x20color:\x20red;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Error\x20loading\x20D2\x20ladder\x20data:\x20'+p['message']+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';}}function getNextAvailablePositionD2(a){const z=a32b;if(a[z(0xe3)]===0x0)return 0x1;let b=0x0;return a['forEach'](c=>{const A=z;c[A(0xde)]&&typeof c[A(0xde)]==='number'&&c[A(0xde)]>b&&(b=c[A(0xde)]);}),b+0x1;}async function updatePlayerPositions(a,b){const B=a32b;try{const c=collection(db,'playersD2'),d=await getDocs(c),e=[];d[B(0x103)](h=>{e['push']({'id':h['id'],...h['data']()});});const f=e['find'](h=>h['username']===a),g=e[B(0xc5)](h=>h['username']===b);if(!f||!g){console[B(0xeb)](B(0xd3));return;}if(f['position']>g[B(0xde)]){const h=g[B(0xde)];for(const i of e){i['position']>=g[B(0xde)]&&i['position']<f[B(0xde)]&&i[B(0xf3)]!==a&&await updateDoc(doc(db,B(0xf1),i['id']),{'position':i['position']+0x1});}await updateDoc(doc(db,B(0xf1),f['id']),{'position':h});if(h===0x1){const j=doc(db,B(0xf1),f['id']),k=await getDoc(j);!k[B(0xdc)]()[B(0xcd)]&&await updateDoc(j,{'firstPlaceDate':Timestamp['now']()});}if(g['position']===0x1){const l=doc(db,B(0xf1),g['id']);await updateDoc(l,{'firstPlaceDate':null});}playerCacheD2[B(0xf4)]=0x0;}}catch(m){console[B(0xeb)](B(0xfe),m);}}function calculateStreakDays(a){const C=a32b;if(!a)return 0x0;const b=a[C(0xdd)](),c=new Date(),d=Math[C(0xe2)](c-b);return Math[C(0x102)](d/(0x3e8*0x3c*0x3c*0x18));}function getPlayerRankNameD2(a){const D=a32b;if(a>=0x834)return'Emerald';if(a>=0x708)return'Gold';if(a>=0x640)return D(0x10a);if(a>=0x578)return D(0xe8);return D(0xe1);}async function updateLadderDisplayD2(a){const E=a32b;a['sort']((g,h)=>g['position']-h['position']);const b=document[E(0xd4)]('#ladder-d2\x20tbody');if(!b)return;b[E(0x100)]='';const c=a[E(0xbd)](g=>g[E(0xf3)]),d=await fetchBatchMatchStatsD2(c),e=document[E(0xd4)]('#ladder-d2\x20thead\x20tr');e&&(e['innerHTML']=E(0xc4));const f=a['map'](g=>{const F=E,h=d['get'](g[F(0xf3)])||{'totalMatches':0x0,'wins':0x0,'losses':0x0,'kda':0x0,'winRate':0x0,'totalKills':0x0,'totalDeaths':0x0};return createPlayerRowD2(g,h);})[E(0x104)]('');b['innerHTML']=f,getPlayersLastEloChangesD2(c)['then'](g=>{const H=E,h=new Map();b['querySelectorAll']('tr')['forEach']((i,j)=>{const G=a32b;j<c['length']&&h[G(0x10f)](c[j],i);}),g[H(0x103)]((i,j)=>{const I=H,k=h['get'](j);if(k&&i!==0x0){const l=k['querySelector']('td:nth-child(3)');if(l){const m=i>0x0?'+'+i:''+i,n=l['querySelector']('.trend-indicator');n&&(n['textContent']=m,n[I(0xc0)]['color']=i>0x0?I(0xe7):'#F44336',n['style']['fontWeight']=I(0xbb),n[I(0xc0)]['fontSize']=I(0xec),n['style'][I(0xfc)]=I(0xd6),n[I(0xc0)]['visibility']='visible',n['style']['opacity']='1');}}});})[E(0xb8)](g=>console['error'](E(0xcf),g));}function createPlayerRowD2(a,b){const J=a32b,c=parseFloat(a[J(0x10e)])||0x0;let d='gray';if(c>=0x7d0)d=J(0xf0);else{if(c>=0x708)d=J(0xe5);else{if(c>=0x640)d=J(0xef);else c>=0x578&&(d=J(0xbe));}}let e='';return a['country']&&(e='<img\x20src=\x22../images/flags/'+a['country']['toLowerCase']()+J(0xd9)+a['country']+J(0xcb)),J(0x107)+a['position']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td\x20style=\x22position:\x20relative;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20position:\x20relative;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username='+encodeURIComponent(a[J(0xf3)])+J(0xd8)+d+J(0xf2)+a[J(0xf3)]+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+e+J(0xed)+d+J(0xea)+c+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22trend-indicator\x22\x20style=\x22margin-left:\x205px;\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+b['totalMatches']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+b['wins']+J(0xd5)+b['losses']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+b[J(0xe4)]+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+b[J(0xc2)]+'%</td>\x0a\x20\x20\x20\x20</tr>';}function a32a(){const S=['Bg9Zzxjty29Yzq','zgvZyW','C2L6zq','iIakicaGicaGicaGicaGicaGicaGicaGicaGy2XHC3m9iNbSyxLLCI1MBgfNiIakicaGicaGicaGicaGicaGicaGicaGicaGC3r5Bgu9iM1HCMDPBI1Szwz0oIa1ChG7ihzLCNrPy2fSlwfSAwDUoIbTAwrKBgu7iGOGicaGicaGicaGicaGicaGicaGicaGicbVBMvYCM9Ypsj0AgLZlNn0EwXLlMrPC3bSyxK9j25VBMuNiJ4','z2v0rg9JDw1LBNrZ','zMLYC3rqBgfJzurHDgu','mJiWotq3ouzpwxzjra','rxjYB3iGDxbKyxrPBMCGrdiGruXpihrYzw5KigLUzgLJyxrVCNm6','C2vJB25KCW','Bg9N','Bwf0y2Hjza','q291BgqGBM90igzPBMqGD2LUBMvYig9YigXVC2vYigLUieqYihbSyxLLCNmGBgLZDa','CxvLCNLtzwXLy3rVCG','pc90zd4kicaGicaGica8Dgq+','Aw5SAw5L','D2LUBMvYvxnLCM5HBwu','jMXHzgrLCJ1KmIiGcIaGicaGicaGicaGicaGicaGicbZDhLSzt0Iy29SB3i6ia','lNbUzYiGcIaGicaGicaGicaGicaGicaGicaGicaGigfSDd0I','zwXVuMf0Aw5N','BMv3rwXV','zgf0yq','Dg9eyxrL','Cg9ZAxrPB24','mZG4mJm5nMTtDwPbuW','mta1ode1nMPMALrTzG','vw5Yyw5Rzwq','ywjZ','BgvUz3rO','A2rH','i0zgrdCWma','ChjLDMLVDxnfBg8','iZrdquy1ma','qNjVBNPL','AgfZ','oYbWB3nPDgLVBJOGCMvSyxrPDMu7iJ4kicaGicaGicaGicaGpgrPDIbJBgfZCZ0IzwXVlwnVBNrHAw5LCIiGC3r5Bgu9iMrPC3bSyxK6igzSzxG7igfSAwDUlwL0zw1ZoIbJzw50zxi7iJ4kicaGicaGicaGicaGicaGidXZCgfUignSyxnZpsjLBg8TDMfSDwuIpG','zxjYB3i','mc44nwvT','cIaGicaGicaGicaGidWVzgL2pGOGicaGicaGidWVDgq+cIaGicaGicaGphrKihn0EwXLpsjJB2XVCJOG','yxbWCM92zwrnyxrJAgvZrdi','i0mWqZbdma','iZuWqZG3oa','CgXHEwvYC0qY','oYb0zxH0lwrLy29YyxrPB246ig5VBMu7iJ4kicaGicaGicaGicaGicaGicaGica','DxnLCM5HBwu','DgLTzxn0yw1W','rdi6ievYCM9YigzLDgnOAw5NievmtYbOAxn0B3j5oG','y2HHBMDL','z2v0','CgXHEwvY','y291BNrYEq','CgXHEwvYvxnLCM5HBwu','Aw5JBhvKzxm','zgLZCgXHEq','Dg9mB3DLCKnHC2u','rxjYB3iGDxbKyxrPBMCGrdiGCgXHEwvYihbVC2L0Aw9UCZO','otC2nZDewLfrqLm','Aw5Uzxjive1m','Dg90ywXnyxrJAgvZ','y2vPBa','zM9YrwfJAa','AM9PBG','nuDqufDXqG','nZC1nZyXuejVu0He','cIaGica8Dhi+cIaGicaGicaGphrKpG','rxjYB3iGBg9HzgLUzYbemIbSywrKzxi6','phrYpJX0zcbJB2XZCgfUpsi4iIbJBgfZCZ0IBg9HzgLUzY1JzwXSiJ5mB2fKAw5NieqYigXHzgrLCIbKyxrHlI4Upc90zd48l3rYpG','u2LSDMvY','DxnLCLbYB2zPBgvZ','Dg9gAxHLza','Dg90ywXlAwXSCW','zwXV','C2v0','y2f0y2G','Dg90ywXezwf0Ahm','mJq3mdaXnKTmANPnwq','yM9Sza','mJiWmhPXrfzHuW','BwfW','i0nen0yZmG','D2LUCW','C3r5Bgu','zwXVsgLZDg9YEuqY','D2LUuMf0zq','mtuZntu2oenor2r6rG','cIaGicaGicaGicaGidX0Ad5syw5Rpc90Ad4kicaGicaGicaGicaGphrOpLvZzxjUyw1Lpc90Ad4kicaGicaGicaGicaGphrOpKvmtZWVDgG+cIaGicaGicaGicaGidX0Ad5nyxrJAgvZpc90Ad4kicaGicaGicaGicaGphrOpLDPBNm8l3rOpGOGicaGicaGicaGica8DgG+tg9ZC2vZpc90Ad4kicaGicaGicaGicaGphrOpKSVrdWVDgG+cIaGicaGicaGicaGidX0Ad5xAw4GuMf0ztWVDgG+cIaGicaGicaG','zMLUza','ChvZAa','i2XHzgrLCI1KmIb0yM9KEq'];a32a=function(){return S;};return a32a();}async function getPlayersLastEloChangesD2(a){const K=a32b,b=new Map();a[K(0x103)](c=>b['set'](c,0x0));try{const c=collection(db,K(0xc1)),d=query(c,orderBy(K(0xf4),'desc'),limit(0x64)),e=await getDocs(d),f=new Map(),g=await getDocs(collection(db,'playersD2'));g['forEach'](i=>{const L=K,j=i[L(0xdc)]();j[L(0xf3)]&&f[L(0x10f)](i['id'],j[L(0xf3)]);});const h=new Map();e[K(0x103)](i=>{const M=K,j=i[M(0xdc)]();let k=j['username']||j['playerUsername'];!k&&j[M(0xf8)]&&f[M(0xe9)](j[M(0xf8)])&&(k=f['get'](j['player']));if(!k&&j[M(0xd2)]){}k&&a['includes'](k)&&(!h[M(0xe9)](k)&&h[M(0x10f)](k,[]),h['get'](k)['push']({...j,'timestamp':j[M(0xf4)]?.[M(0xd0)]||0x0,'username':k}));}),h[K(0x103)]((i,j)=>{const N=K;if(i['length']>0x0){i['sort']((l,m)=>m['timestamp']-l[N(0xf4)]);const k=i[N(0xc5)](l=>l['change']!==undefined||l[N(0xdb)]!==undefined&&l['previousElo']!==undefined);if(k){let l;if(k[N(0xf6)]!==undefined)l=k['change'];else k[N(0xdb)]!==undefined&&k['previousElo']!==undefined&&(l=k['newElo']-k['previousElo']);l!==undefined&&b[N(0x10f)](j,l);}}});if(h['size']===0x0){const i=collection(db,'eloHistory'),j=query(i,where('gameMode','==','D2'),orderBy('timestamp',K(0xc9)),limit(0x32));try{const k=await getDocs(j);console[K(0xd1)]('D2:\x20Found',k[K(0xca)],'fallback\x20entries'),k[K(0x103)](l=>{const O=K,m=l['data'](),n=m['username']||m[O(0xfa)];if(n&&a['includes'](n)){const o=m['change']||(m[O(0xdb)]!==undefined&&m[O(0xe6)]!==undefined?m[O(0xdb)]-m[O(0xe6)]:0x0);o!==0x0&&(b['set'](n,o),console[O(0xd1)]('D2:\x20'+n+'\x20fallback\x20ELO\x20change:\x20'+o));}});}catch(l){}}}catch(m){console['error'](K(0xf5),m);}return b;}async function fetchBatchMatchStatsD2(a){const P=a32b,b=new Map();try{a[P(0x103)](e=>{b['set'](e,{'totalMatches':0x0,'wins':0x0,'losses':0x0,'totalKills':0x0,'totalDeaths':0x0,'kda':0x0,'winRate':0x0});});const c=collection(db,P(0xee)),d=await getDocs(c);d[P(0x103)](e=>{const Q=P,f=e['data'](),g=f[Q(0xd7)],h=f['loserUsername'];if(a['includes'](g)){const i=b['get'](g);i[Q(0xbf)]++,i[Q(0x101)]++,i[Q(0x10d)]+=parseInt(f['winnerScore'])||0x0,i[Q(0xb9)]+=parseInt(f[Q(0xc8)])||0x0;}if(a[Q(0xfb)](h)){const j=b['get'](h);j['losses']++,j['totalMatches']++,j['totalKills']+=parseInt(f[Q(0xc8)])||0x0,j[Q(0xb9)]+=parseInt(f['winnerScore'])||0x0;}}),a[P(0x103)](e=>{const R=P,f=b['get'](e);f['kda']=f[R(0xb9)]>0x0?(f['totalKills']/f[R(0xb9)])['toFixed'](0x2):f[R(0x10d)][R(0x10c)](0x2),f[R(0xc2)]=f[R(0x101)]>0x0?(f['wins']/f['totalMatches']*0x64)[R(0x10c)](0x1):0x0;});}catch(e){console['error']('Error\x20fetching\x20batch\x20D2\x20match\x20stats:',e);}return b;}export{displayLadderD2,updatePlayerPositions};
(function(_0x36a1c8,_0x51519e){const _0x532f5f=a29_0x1b51,_0x439e40=_0x36a1c8();while(!![]){try{const _0x57b84=-parseInt(_0x532f5f(0x15f))/0x1*(parseInt(_0x532f5f(0x162))/0x2)+-parseInt(_0x532f5f(0x160))/0x3+parseInt(_0x532f5f(0x15a))/0x4*(-parseInt(_0x532f5f(0x17b))/0x5)+parseInt(_0x532f5f(0x177))/0x6*(parseInt(_0x532f5f(0x17a))/0x7)+-parseInt(_0x532f5f(0x152))/0x8*(-parseInt(_0x532f5f(0x14f))/0x9)+-parseInt(_0x532f5f(0x180))/0xa+-parseInt(_0x532f5f(0x188))/0xb*(-parseInt(_0x532f5f(0x15c))/0xc);if(_0x57b84===_0x51519e)break;else _0x439e40['push'](_0x439e40['shift']());}catch(_0x378fe4){_0x439e40['push'](_0x439e40['shift']());}}}(a29_0x409b,0xdb3b6));function a29_0x1b51(_0xd6b700,_0x2c835d){const _0x37f907=a29_0x409b();return a29_0x1b51=function(_0x4b02dc,_0x2e63f3){_0x4b02dc=_0x4b02dc-0x14c;let _0x262f12=_0x37f907[_0x4b02dc];return _0x262f12;},a29_0x1b51(_0xd6b700,_0x2c835d);}const a29_0x41a6f9=(function(){let _0x44de99=!![];return function(_0x2b6a18,_0x5d72f9){const _0x51081d=_0x44de99?function(){if(_0x5d72f9){const _0xf61ab0=_0x5d72f9['apply'](_0x2b6a18,arguments);return _0x5d72f9=null,_0xf61ab0;}}:function(){};return _0x44de99=![],_0x51081d;};}()),a29_0x2f533a=a29_0x41a6f9(this,function(){const _0x5ff3b7=a29_0x1b51;return a29_0x2f533a['toString']()[_0x5ff3b7(0x163)](_0x5ff3b7(0x157))[_0x5ff3b7(0x16c)]()[_0x5ff3b7(0x166)](a29_0x2f533a)['search'](_0x5ff3b7(0x157));});a29_0x2f533a();const a29_0x2e63f3=(function(){let _0x5722e1=!![];return function(_0xf1264c,_0x4434df){const _0x288fea=_0x5722e1?function(){const _0x4d1d63=a29_0x1b51;if(_0x4434df){const _0x25c11c=_0x4434df[_0x4d1d63(0x186)](_0xf1264c,arguments);return _0x4434df=null,_0x25c11c;}}:function(){};return _0x5722e1=![],_0x288fea;};}()),a29_0x4b02dc=a29_0x2e63f3(this,function(){const _0x1cd06d=a29_0x1b51;let _0x132b19;try{const _0x1ecef7=Function(_0x1cd06d(0x174)+_0x1cd06d(0x18a)+');');_0x132b19=_0x1ecef7();}catch(_0x4ec74b){_0x132b19=window;}const _0xf3b015=_0x132b19[_0x1cd06d(0x156)]=_0x132b19[_0x1cd06d(0x156)]||{},_0x48556c=[_0x1cd06d(0x14e),'warn',_0x1cd06d(0x15d),_0x1cd06d(0x17e),_0x1cd06d(0x187),_0x1cd06d(0x159),_0x1cd06d(0x181)];for(let _0x490ec0=0x0;_0x490ec0<_0x48556c['length'];_0x490ec0++){const _0x5cfcf7=a29_0x2e63f3[_0x1cd06d(0x166)][_0x1cd06d(0x14d)][_0x1cd06d(0x155)](a29_0x2e63f3),_0x1a00e8=_0x48556c[_0x490ec0],_0x1d2e45=_0xf3b015[_0x1a00e8]||_0x5cfcf7;_0x5cfcf7['__proto__']=a29_0x2e63f3['bind'](a29_0x2e63f3),_0x5cfcf7['toString']=_0x1d2e45['toString'][_0x1cd06d(0x155)](_0x1d2e45),_0xf3b015[_0x1a00e8]=_0x5cfcf7;}});a29_0x4b02dc();import{addDoc,updateDoc,serverTimestamp,collection,doc,getDoc,getDocs,query,where,setDoc,deleteDoc,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';import{recordEloChangeD3}from'./elo-history-d3.js';export function calculateEloD3(_0x13defe,_0x2dd225,_0x5963d1=0x20){const _0x446e2f=a29_0x1b51,_0x347284=0x1/(0x1+Math[_0x446e2f(0x185)](0xa,(_0x2dd225-_0x13defe)/0x190)),_0x916859=0x1/(0x1+Math[_0x446e2f(0x185)](0xa,(_0x13defe-_0x2dd225)/0x190)),_0x177eba=_0x13defe+_0x5963d1*(0x1-_0x347284),_0xed1ad0=_0x2dd225+_0x5963d1*(0x0-_0x916859);return{'newWinnerRating':Math[_0x446e2f(0x150)](_0x177eba),'newLoserRating':Math['round'](_0xed1ad0)};}export async function updateEloRatingsD3(_0xb22122,_0x17b25f,_0x3c17da){const _0x5224ab=a29_0x1b51;try{const _0xd3e892=writeBatch(db),_0x25aead=doc(db,_0x5224ab(0x172),_0xb22122),_0x1bc0a8=doc(db,_0x5224ab(0x172),_0x17b25f),[_0x3b2974,_0x74035e]=await Promise[_0x5224ab(0x184)]([getDoc(_0x25aead),getDoc(_0x1bc0a8)]);if(!_0x3b2974[_0x5224ab(0x17c)]()||!_0x74035e['exists']())throw new Error(_0x5224ab(0x16e));const _0x266cdb=_0x3b2974[_0x5224ab(0x17d)](),_0x459c01=_0x74035e[_0x5224ab(0x17d)](),_0x5cf9f7=_0x266cdb[_0x5224ab(0x158)]||Number[_0x5224ab(0x14c)],_0x3514ad=_0x459c01[_0x5224ab(0x158)]||Number[_0x5224ab(0x14c)],{newWinnerRating:_0x262b96,newLoserRating:_0x53bae8}=calculateEloD3(_0x266cdb['eloRating']||0x4b0,_0x459c01[_0x5224ab(0x16f)]||0x4b0);let _0x530e66=_0x5cf9f7,_0x231d3=_0x3514ad;if(_0x5cf9f7>_0x3514ad){console[_0x5224ab(0x14e)]('D3\x20Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked'),_0x530e66=_0x3514ad,_0x231d3=_0x3514ad+0x1;const _0x4c756e=query(collection(db,'playersD3'),where('position','>',_0x3514ad),where(_0x5224ab(0x158),'<',_0x5cf9f7)),_0xa27c09=await getDocs(_0x4c756e);for(const _0x1d0670 of _0xa27c09[_0x5224ab(0x16a)]){_0x1d0670['id']!==_0xb22122&&_0x1d0670['id']!==_0x17b25f&&_0xd3e892[_0x5224ab(0x165)](doc(db,_0x5224ab(0x172),_0x1d0670['id']),{'position':_0x1d0670['data']()['position']+0x1});}}else console[_0x5224ab(0x14e)](_0x5224ab(0x189));return _0xd3e892[_0x5224ab(0x165)](_0x25aead,{'eloRating':_0x262b96,'lastMatchDate':serverTimestamp(),'position':_0x530e66,'lastMatchId':_0x3c17da}),_0xd3e892['update'](_0x1bc0a8,{'eloRating':_0x53bae8,'lastMatchDate':serverTimestamp(),'position':_0x231d3,'lastMatchId':_0x3c17da}),await _0xd3e892[_0x5224ab(0x15b)](),console[_0x5224ab(0x14e)](_0x5224ab(0x170)),await Promise[_0x5224ab(0x184)]([recordEloChangeD3({'playerId':_0xb22122,'previousElo':_0x266cdb[_0x5224ab(0x16f)]||0x4b0,'newElo':_0x262b96,'opponentId':_0x17b25f,'matchResult':'win','previousPosition':_0x5cf9f7,'newPosition':_0x530e66,'isPromotion':_0x530e66<_0x5cf9f7,'matchId':_0x3c17da,'timestamp':serverTimestamp()}),recordEloChangeD3({'playerId':_0x17b25f,'previousElo':_0x459c01['eloRating']||0x4b0,'newElo':_0x53bae8,'opponentId':_0xb22122,'matchResult':_0x5224ab(0x17f),'previousPosition':_0x3514ad,'newPosition':_0x231d3,'isDemotion':_0x231d3>_0x3514ad,'matchId':_0x3c17da,'timestamp':serverTimestamp()})]),!![];}catch(_0x2149b5){console[_0x5224ab(0x17e)](_0x5224ab(0x171),_0x2149b5);throw _0x2149b5;}}export async function approveReportD3(_0x504e1f,_0x220514,_0x341079,_0x47aebe){const _0xf7d82d=a29_0x1b51;try{console[_0xf7d82d(0x14e)](_0xf7d82d(0x153),{'reportId':_0x504e1f,'winnerScore':_0x220514,'winnerSuicides':_0x341079,'winnerComment':_0x47aebe});const _0x3d04d6=auth[_0xf7d82d(0x161)];if(!_0x3d04d6){console[_0xf7d82d(0x14e)](_0xf7d82d(0x183));throw new Error(_0xf7d82d(0x182));}console[_0xf7d82d(0x14e)](_0xf7d82d(0x178),_0x3d04d6[_0xf7d82d(0x16d)]);const _0x5557b5=await getDoc(doc(db,_0xf7d82d(0x172),_0x3d04d6[_0xf7d82d(0x169)])),_0x26a313=_0x5557b5[_0xf7d82d(0x17c)]()?_0x5557b5['data']()[_0xf7d82d(0x176)]:null;console[_0xf7d82d(0x14e)]('Current\x20username:',_0x26a313);const _0x2ee46c=doc(db,'pendingMatchesD3',_0x504e1f),_0x1fc15d=await getDoc(_0x2ee46c);if(!_0x1fc15d[_0xf7d82d(0x17c)]()){console[_0xf7d82d(0x14e)](_0xf7d82d(0x154),_0x504e1f);throw new Error('D3\x20match\x20report\x20not\x20found');}const _0x4bf3e6=_0x1fc15d['data']();console[_0xf7d82d(0x14e)](_0xf7d82d(0x164),_0x4bf3e6);if(_0x26a313!==_0x4bf3e6[_0xf7d82d(0x15e)])throw new Error(_0xf7d82d(0x167));const _0x25b9b0={..._0x4bf3e6,'winnerScore':_0x220514,'winnerSuicides':_0x341079,'winnerComment':_0x47aebe,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':_0x26a313,'createdAt':_0x4bf3e6[_0xf7d82d(0x16b)]||serverTimestamp(),'winnerUsername':_0x4bf3e6['winnerUsername'],'loserUsername':_0x4bf3e6[_0xf7d82d(0x175)]};await setDoc(doc(db,_0xf7d82d(0x173),_0x504e1f),_0x25b9b0),await deleteDoc(_0x2ee46c),console[_0xf7d82d(0x14e)]('D3\x20Match\x20moved\x20to\x20approved\x20collection');const [_0x15b870,_0x12bfce]=await Promise['all']([getDocs(query(collection(db,_0xf7d82d(0x172)),where('username','==',_0x4bf3e6[_0xf7d82d(0x15e)]))),getDocs(query(collection(db,'playersD3'),where(_0xf7d82d(0x176),'==',_0x4bf3e6[_0xf7d82d(0x175)])))]);if(_0x15b870['empty']||_0x12bfce[_0xf7d82d(0x179)])throw new Error('Could\x20not\x20find\x20D3\x20player\x20documents');const _0x3319de=_0x15b870['docs'][0x0]['id'],_0x198f01=_0x12bfce[_0xf7d82d(0x16a)][0x0]['id'];return await updateEloRatingsD3(_0x3319de,_0x198f01,_0x504e1f),console[_0xf7d82d(0x14e)](_0xf7d82d(0x168)),!![];}catch(_0x498e76){console[_0xf7d82d(0x17e)](_0xf7d82d(0x151),_0x498e76);throw _0x498e76;}}function a29_0x409b(){const _0x3c6e2c=['update','constructor','Only\x20the\x20winner\x20can\x20approve\x20D3\x20matches','D3\x20Match\x20successfully\x20approved\x20and\x20ELO\x20updated','uid','docs','createdAt','toString','email','One\x20or\x20both\x20D3\x20players\x20not\x20found','eloRating','D3\x20ELO\x20ratings\x20updated\x20successfully','Error\x20in\x20updateEloRatingsD3:','playersD3','approvedMatchesD3','return\x20(function()\x20','loserUsername','username','200454buAzdp','Current\x20user:','empty','322mgLlop','15RsbaPe','exists','data','error','loss','14644570bBTsOF','trace','You\x20must\x20be\x20logged\x20in\x20to\x20approve\x20D3\x20matches','No\x20user\x20logged\x20in','all','pow','apply','exception','3628603EcxnrC','D3\x20Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions','{}.constructor(\x22return\x20this\x22)(\x20)','MAX_SAFE_INTEGER','prototype','log','5764194AtKfpt','round','Error\x20in\x20approveReportD3:','16LSqaoH','Starting\x20approveReportD3\x20function\x20with:','D3\x20Report\x20not\x20found\x20with\x20ID:','bind','console','(((.+)+)+)+$','position','table','1274764LidaBh','commit','60kKziiY','info','winnerUsername','18959NOQuoo','3388944RkSqvF','currentUser','2ALQjqh','search','D3\x20Report\x20data:'];a29_0x409b=function(){return _0x3c6e2c;};return a29_0x409b();}
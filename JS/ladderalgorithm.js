const a32_0xf9c93d=(function(){let _0x2f39c4=!![];return function(_0xb569b,_0x142652){const _0x2a71b1=_0x2f39c4?function(){const _0x569380=a32_0x5137;if(_0x142652){const _0x3c191c=_0x142652[_0x569380(0x107)](_0xb569b,arguments);return _0x142652=null,_0x3c191c;}}:function(){};return _0x2f39c4=![],_0x2a71b1;};}()),a32_0x1cf2f2=a32_0xf9c93d(this,function(){const _0x5d43d0=a32_0x5137,_0x450688=function(){const _0x185c9d=a32_0x5137;let _0x4c70fb;try{_0x4c70fb=Function(_0x185c9d(0x106)+_0x185c9d(0xf9)+');')();}catch(_0x13aa3a){_0x4c70fb=window;}return _0x4c70fb;},_0xa72a01=_0x450688(),_0x7390f9=_0xa72a01[_0x5d43d0(0xe8)]=_0xa72a01[_0x5d43d0(0xe8)]||{},_0x28f282=[_0x5d43d0(0x11b),_0x5d43d0(0xf1),_0x5d43d0(0x10b),_0x5d43d0(0x12f),_0x5d43d0(0x131),_0x5d43d0(0x10d),_0x5d43d0(0xf5)];for(let _0x168c21=0x0;_0x168c21<_0x28f282[_0x5d43d0(0x111)];_0x168c21++){const _0x1feff8=a32_0xf9c93d[_0x5d43d0(0x139)][_0x5d43d0(0x100)][_0x5d43d0(0x123)](a32_0xf9c93d),_0x4473fa=_0x28f282[_0x168c21],_0x14a14e=_0x7390f9[_0x4473fa]||_0x1feff8;_0x1feff8[_0x5d43d0(0x126)]=a32_0xf9c93d[_0x5d43d0(0x123)](a32_0xf9c93d),_0x1feff8[_0x5d43d0(0x120)]=_0x14a14e[_0x5d43d0(0x120)][_0x5d43d0(0x123)](_0x14a14e),_0x7390f9[_0x4473fa]=_0x1feff8;}});a32_0x1cf2f2();import{collection,doc,getDoc,getDocs,updateDoc,setDoc,deleteDoc,writeBatch,query,where,serverTimestamp,addDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';function a32_0x5137(_0x1ffca0,_0x5835cd){_0x1ffca0=_0x1ffca0-0xe1;const _0x1cf2f2=a32_0x4746();let _0xf9c93d=_0x1cf2f2[_0x1ffca0];return _0xf9c93d;}import{recordEloChange}from'./elo-history.js';import{promotionManager,checkAndRecordPromotion}from'./promotions.js';import{isAdmin}from'./admin-check.js';import{RANKS,getRankStyle}from'./ranks.js';import{checkAndAwardTopRankRibbon}from'./ribbons.js';export function calculateElo(_0x29c4fa,_0x1045dc,_0x28ce42=0x20){const _0xf92b00=a32_0x5137,_0x1ef5a4=0x1/(0x1+Math[_0xf92b00(0xeb)](0xa,(_0x1045dc-_0x29c4fa)/0x190)),_0x29f9e1=0x1/(0x1+Math[_0xf92b00(0xeb)](0xa,(_0x29c4fa-_0x1045dc)/0x190)),_0x4e1980=_0x29c4fa+_0x28ce42*(0x1-_0x1ef5a4),_0x4d761c=_0x1045dc+_0x28ce42*(0x0-_0x29f9e1);return{'newWinnerRating':Math[_0xf92b00(0x132)](_0x4e1980),'newLoserRating':Math[_0xf92b00(0x132)](_0x4d761c)};}export function assignDefaultEloRating(_0xf9dbe2,_0x4c6f57){const _0x1d8386=a32_0x5137,_0x1b3fe1=0xc8;!_0x4c6f57[_0x1d8386(0x135)]&&db[_0x1d8386(0x109)](_0x1d8386(0x130))[_0x1d8386(0xe9)](_0xf9dbe2)[_0x1d8386(0xef)]({'eloRating':_0x1b3fe1})[_0x1d8386(0x13b)](()=>{const _0x23ca80=_0x1d8386;console[_0x23ca80(0x11b)](_0x23ca80(0x121)+_0x4c6f57[_0x23ca80(0x127)]);})[_0x1d8386(0xf3)](_0x1756cb=>{const _0xc44d4e=_0x1d8386;console[_0xc44d4e(0x12f)](_0xc44d4e(0x113),_0x1756cb);});}export async function updateEloRatings(_0x44cafd,_0x457eed,_0x57b24b,_0x228f20=0x0,_0x2f8ec5=0x0,_0x2dfc62=0x0,_0x3c9d0c=0x0){const _0x539368=a32_0x5137;try{const _0x509362=writeBatch(db),_0x564e74=doc(db,_0x539368(0x130),_0x44cafd),_0x4ca753=doc(db,_0x539368(0x130),_0x457eed),[_0x422889,_0xe89e7b]=await Promise[_0x539368(0xfb)]([getDoc(_0x564e74),getDoc(_0x4ca753)]);if(!_0x422889[_0x539368(0x124)]()||!_0xe89e7b[_0x539368(0x124)]())throw new Error(_0x539368(0x11a));const _0xdad8ee=_0x422889[_0x539368(0xea)](),_0x44502c=_0xe89e7b[_0x539368(0xea)](),_0x3c3669=_0xdad8ee[_0x539368(0xf7)]||Number[_0x539368(0xfd)],_0x1ed5a4=_0x44502c[_0x539368(0xf7)]||Number[_0x539368(0xfd)],{newWinnerRating:_0x2a0836,newLoserRating:_0x1f84fb}=calculateElo(_0xdad8ee[_0x539368(0x135)]||0xc8,_0x44502c[_0x539368(0x135)]||0xc8);let _0x4b3ef6=_0x3c3669,_0x3f6930=_0x1ed5a4;if(_0x3c3669>_0x1ed5a4){console[_0x539368(0x11b)](_0x539368(0x13e)),_0x4b3ef6=_0x1ed5a4,_0x3f6930=_0x1ed5a4+0x1;const _0x541c7d=query(collection(db,_0x539368(0x130)),where(_0x539368(0xf7),'>',_0x1ed5a4),where(_0x539368(0xf7),'<',_0x3c3669)),_0x32f08a=await getDocs(_0x541c7d);for(const _0x5272e9 of _0x32f08a[_0x539368(0x136)]){_0x5272e9['id']!==_0x44cafd&&_0x5272e9['id']!==_0x457eed&&_0x509362[_0x539368(0xef)](doc(db,_0x539368(0x130),_0x5272e9['id']),{'position':_0x5272e9[_0x539368(0xea)]()[_0x539368(0xf7)]+0x1});}}else console[_0x539368(0x11b)](_0x539368(0x12a));const _0x456740={'eloRating':_0x2a0836,'lastMatchDate':serverTimestamp(),'position':_0x4b3ef6,'lastMatchId':_0x57b24b},_0x130248={'eloRating':_0x1f84fb,'lastMatchDate':serverTimestamp(),'position':_0x3f6930,'lastMatchId':_0x57b24b};_0x509362[_0x539368(0xef)](_0x564e74,_0x456740),_0x509362[_0x539368(0xef)](_0x4ca753,_0x130248),await _0x509362[_0x539368(0xe5)](),console[_0x539368(0x11b)](_0x539368(0x122));const _0x4d0d80=serverTimestamp();return await Promise[_0x539368(0xfb)]([recordEloChange({'playerId':_0x44cafd,'previousElo':_0xdad8ee[_0x539368(0x135)]||0xc8,'newElo':_0x2a0836,'opponentId':_0x457eed,'matchResult':_0x539368(0xfa),'previousPosition':_0x3c3669,'newPosition':_0x4b3ef6,'isPromotion':_0x4b3ef6<_0x3c3669,'matchId':_0x57b24b,'timestamp':_0x4d0d80,'matchCount':_0x228f20,'winRate':_0x2dfc62}),recordEloChange({'playerId':_0x457eed,'previousElo':_0x44502c[_0x539368(0x135)]||0xc8,'newElo':_0x1f84fb,'opponentId':_0x44cafd,'matchResult':_0x539368(0xfe),'previousPosition':_0x1ed5a4,'newPosition':_0x3f6930,'isDemotion':_0x3f6930>_0x1ed5a4,'matchId':_0x57b24b,'timestamp':_0x4d0d80,'matchCount':_0x2f8ec5,'winRate':_0x3c9d0c})]),await promotionManager[_0x539368(0x12e)](_0x44cafd,_0x2a0836,_0xdad8ee[_0x539368(0x135)],{'source':_0x539368(0xe2),'matchId':_0x57b24b}),await promotionManager[_0x539368(0x12e)](_0x457eed,_0x1f84fb,_0x44502c[_0x539368(0x135)],{'source':_0x539368(0xe2),'matchId':_0x57b24b}),console[_0x539368(0x11b)](_0x539368(0x108)),!![];}catch(_0x45aa57){console[_0x539368(0x12f)](_0x539368(0x104),_0x45aa57);throw _0x45aa57;}}function a32_0x4746(){const _0x3e0720=['toISOString','match','\x20match','pointsHistory','commit','color','email','console','doc','data','pow','loserScore','approvedMatches','toFixed','update','name','warn','pendingMatches','catch','displayName','trace','Awarded\x20','position','Points\x20award\x20failed,\x20but\x20match\x20approval\x20continues:','{}.constructor(\x22return\x20this\x22)(\x20)','win','all','loserUsername','MAX_SAFE_INTEGER','loss','Error\x20approving\x20report:','prototype','points','Match\x20successfully\x20approved\x20and\x20ELO\x20updated','winnerUsername','Error\x20in\x20updateEloRatings:','winRate','return\x20(function()\x20','apply','ELO\x20ratings\x20and\x20positions\x20updated\x20successfully','collection','add','info','empty','table','wins','\x20match\x20(Winner)','currentUser','length','system-match-award','Error\x20assigning\x20default\x20ELO\x20rating:','userProfiles','Unknown\x20User','totalMatches','totalKills','subgameType','lastUpdated','One\x20or\x20both\x20players\x20not\x20found','log','Could\x20not\x20find\x20player\x20documents','Report\x20not\x20found','losses','Top\x20Rank\x20ribbon\x20check\x20failed,\x20but\x20match\x20approval\x20continues:','toString','Assigned\x20default\x20ELO\x20rating\x20to\x20player\x20','ELO\x20ratings\x20updated\x20successfully','bind','exists','totalDeaths','__proto__','username','playerStats','Match\x20moved\x20to\x20approved\x20collection\x20with\x20ELO\x20data','Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions','Standard','Match\x20points:\x20','\x20match\x20(Participant)','checkAndRecordPromotion','error','players','exception','round','winnerScore','unknown','eloRating','docs','uid','createdAt','constructor','Checked\x20Top\x20Rank\x20ribbon\x20for\x20winner:\x20','then','Could\x20not\x20award\x20points\x20-\x20one\x20or\x20both\x20user\x20profiles\x20not\x20found','\x20points\x20to\x20both\x20players\x20for\x20','Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked'];a32_0x4746=function(){return _0x3e0720;};return a32_0x4746();}const POINTS_CHART={'':0xa,'Standard':0xa,'Fusion\x20Match':0x19,'â‰¥6\x20Missiles':0xa,'Weapon\x20Imbalance':0x1e,'Blind\x20Match':0x4b,'Rematch':0x14,'Disorientation':0x32,'Ratting':0x23,'Altered\x20Powerups':0x23,'Mega\x20Match':0x28,'Dogfight':0x32,'Gauss\x20and\x20Mercs':0x19,'Misc':0x1e};export async function approveReport(_0x11585d,_0x5dd1dc,_0x3922f2,_0x507464,_0x12c229){const _0xc2d5b2=a32_0x5137;try{const _0x58655d=doc(db,_0xc2d5b2(0xf2),_0x11585d),_0x35a7da=await getDoc(_0x58655d);if(!_0x35a7da[_0xc2d5b2(0x124)]())throw new Error(_0xc2d5b2(0x11d));const _0x55ad6d=_0x35a7da[_0xc2d5b2(0xea)](),[_0x256781,_0x3f11a3]=await Promise[_0xc2d5b2(0xfb)]([getDocs(query(collection(db,_0xc2d5b2(0x130)),where(_0xc2d5b2(0x127),'==',_0x55ad6d[_0xc2d5b2(0x103)]))),getDocs(query(collection(db,_0xc2d5b2(0x130)),where(_0xc2d5b2(0x127),'==',_0x55ad6d[_0xc2d5b2(0xfc)])))]);if(_0x256781[_0xc2d5b2(0x10c)]||_0x3f11a3[_0xc2d5b2(0x10c)])throw new Error(_0xc2d5b2(0x11c));const _0x5547da=_0x256781[_0xc2d5b2(0x136)][0x0]['id'],_0x3d697d=_0x3f11a3[_0xc2d5b2(0x136)][0x0]['id'],_0x52f7b4=_0x256781[_0xc2d5b2(0x136)][0x0][_0xc2d5b2(0xea)](),_0x375751=_0x3f11a3[_0xc2d5b2(0x136)][0x0][_0xc2d5b2(0xea)](),_0x2e4cd8=_0x52f7b4[_0xc2d5b2(0x135)]||0xc8,_0x156382=_0x375751[_0xc2d5b2(0x135)]||0xc8,_0x51d79f=(_0x52f7b4[_0xc2d5b2(0x10e)]||0x0)+(_0x52f7b4[_0xc2d5b2(0x11e)]||0x0),_0x5a4e92=(_0x375751[_0xc2d5b2(0x10e)]||0x0)+(_0x375751[_0xc2d5b2(0x11e)]||0x0),_0x495845=_0x51d79f>0x0?(_0x52f7b4[_0xc2d5b2(0x10e)]||0x0)/_0x51d79f*0x64:0x0,_0x4489d8=_0x5a4e92>0x0?(_0x375751[_0xc2d5b2(0x10e)]||0x0)/_0x5a4e92*0x64:0x0;await updateEloRatings(_0x5547da,_0x3d697d,_0x11585d,_0x51d79f,_0x5a4e92,_0x495845,_0x4489d8);const [_0x567141,_0x2b18e0]=await Promise[_0xc2d5b2(0xfb)]([getDoc(doc(db,_0xc2d5b2(0x130),_0x5547da)),getDoc(doc(db,_0xc2d5b2(0x130),_0x3d697d))]),_0x4e4be6=_0x567141[_0xc2d5b2(0xea)]()[_0xc2d5b2(0x135)],_0x421f78=_0x2b18e0[_0xc2d5b2(0xea)]()[_0xc2d5b2(0x135)],_0x367ea4={..._0x55ad6d,'winnerScore':_0x5dd1dc,'winnerSuicides':_0x3922f2,'winnerComment':_0x507464,'winnerDemoLink':_0x12c229,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':auth[_0xc2d5b2(0x110)][_0xc2d5b2(0x137)],'createdAt':_0x55ad6d[_0xc2d5b2(0x138)]||serverTimestamp(),'winnerId':_0x5547da,'loserId':_0x3d697d,'winnerOldElo':_0x2e4cd8,'loserOldElo':_0x156382,'losersOldElo':_0x156382,'winnerNewElo':_0x4e4be6,'loserNewElo':_0x421f78,'winnerEloChange':_0x4e4be6-_0x2e4cd8,'loserEloChange':_0x421f78-_0x156382,'winnerMatchCount':_0x51d79f,'loserMatchCount':_0x5a4e92,'winnerWinRate':_0x495845,'loserWinRate':_0x4489d8};await setDoc(doc(db,_0xc2d5b2(0xed),_0x11585d),_0x367ea4),await deleteDoc(_0x58655d),console[_0xc2d5b2(0x11b)](_0xc2d5b2(0x129));try{await checkAndAwardTopRankRibbon(_0x55ad6d[_0xc2d5b2(0x103)],'D1'),console[_0xc2d5b2(0x11b)](_0xc2d5b2(0x13a)+_0x55ad6d[_0xc2d5b2(0x103)]);}catch(_0x4dfc03){console[_0xc2d5b2(0xf1)](_0xc2d5b2(0x11f),_0x4dfc03);}try{const _0x77a0df=_0x55ad6d[_0xc2d5b2(0x118)]||_0xc2d5b2(0x12b),_0x48a8ef=POINTS_CHART[_0x77a0df]||0xa,_0x3707cb=doc(db,_0xc2d5b2(0x114),_0x5547da),_0x31755f=doc(db,_0xc2d5b2(0x114),_0x3d697d),[_0x284313,_0x1693b8]=await Promise[_0xc2d5b2(0xfb)]([getDoc(_0x3707cb),getDoc(_0x31755f)]);if(_0x284313[_0xc2d5b2(0x124)]()&&_0x1693b8[_0xc2d5b2(0x124)]()){const _0x4ffb58=_0x284313[_0xc2d5b2(0xea)](),_0x263af0=_0x1693b8[_0xc2d5b2(0xea)](),_0x4003ad=_0x4ffb58[_0xc2d5b2(0x101)]||0x0,_0x51d8e4=_0x263af0[_0xc2d5b2(0x101)]||0x0,_0x5ca9cf=_0x4003ad+_0x48a8ef,_0x1139ef=_0x51d8e4+_0x48a8ef;await Promise[_0xc2d5b2(0xfb)]([updateDoc(_0x3707cb,{'points':_0x5ca9cf,'lastPointsModified':serverTimestamp()}),updateDoc(_0x31755f,{'points':_0x1139ef,'lastPointsModified':serverTimestamp()})]),await Promise[_0xc2d5b2(0xfb)]([addDoc(collection(db,_0xc2d5b2(0xe4)),{'userId':_0x5547da,'userEmail':_0x4ffb58[_0xc2d5b2(0xe7)]||_0xc2d5b2(0x134),'displayName':_0x4ffb58[_0xc2d5b2(0xf4)]||_0x4ffb58[_0xc2d5b2(0x127)]||_0xc2d5b2(0x115),'action':_0xc2d5b2(0x10a),'amount':_0x48a8ef,'previousPoints':_0x4003ad,'newPoints':_0x5ca9cf,'reason':_0xc2d5b2(0x12c)+_0x77a0df+_0xc2d5b2(0x10f),'adminEmail':_0xc2d5b2(0x112),'timestamp':serverTimestamp()}),addDoc(collection(db,_0xc2d5b2(0xe4)),{'userId':_0x3d697d,'userEmail':_0x263af0[_0xc2d5b2(0xe7)]||_0xc2d5b2(0x134),'displayName':_0x263af0[_0xc2d5b2(0xf4)]||_0x263af0[_0xc2d5b2(0x127)]||_0xc2d5b2(0x115),'action':_0xc2d5b2(0x10a),'amount':_0x48a8ef,'previousPoints':_0x51d8e4,'newPoints':_0x1139ef,'reason':_0xc2d5b2(0x12c)+_0x77a0df+_0xc2d5b2(0x12d),'adminEmail':_0xc2d5b2(0x112),'timestamp':serverTimestamp()})]),console[_0xc2d5b2(0x11b)](_0xc2d5b2(0xf6)+_0x48a8ef+_0xc2d5b2(0x13d)+_0x77a0df+_0xc2d5b2(0xe3));}else console[_0xc2d5b2(0xf1)](_0xc2d5b2(0x13c));}catch(_0x205b7e){console[_0xc2d5b2(0xf1)](_0xc2d5b2(0xf8),_0x205b7e);}return console[_0xc2d5b2(0x11b)](_0xc2d5b2(0x102)),!![];}catch(_0x1136a2){console[_0xc2d5b2(0x12f)](_0xc2d5b2(0xff),_0x1136a2);throw _0x1136a2;}}async function updatePlayerElo(_0x3d4df7,_0x1cff38,_0x56eb8c){const _0xdc2aaf=a32_0x5137,_0xf4d77a=doc(db,_0xdc2aaf(0x130),_0x3d4df7),_0x24c688=await getDoc(_0xf4d77a),_0x25b999=_0x24c688[_0xdc2aaf(0xea)](),_0x499c33=doc(db,_0xdc2aaf(0x128),_0x3d4df7),_0x48f95f=await getDoc(_0x499c33),_0x3c2a8c=_0x48f95f[_0xdc2aaf(0xea)]()||{'totalMatches':0x0,'winRate':0x0},_0x51baad=getRankStyle(_0x56eb8c,_0x3c2a8c[_0xdc2aaf(0x116)],_0x3c2a8c[_0xdc2aaf(0x105)]);await updateDoc(_0xf4d77a,{'eloRating':_0x56eb8c,'rank':_0x51baad[_0xdc2aaf(0xf0)],'rankColor':_0x51baad[_0xdc2aaf(0xe6)]}),await checkAndRecordPromotion(_0x3d4df7,_0x56eb8c,_0x1cff38,{'matchCount':_0x3c2a8c[_0xdc2aaf(0x116)],'winRate':_0x3c2a8c[_0xdc2aaf(0x105)]});}async function updatePlayerStats(_0x5ac22e,_0xea6da2,_0x7046b3){const _0x34af5d=a32_0x5137,_0x38754b=doc(db,_0x34af5d(0x128),_0x5ac22e),_0x208e50=await getDoc(_0x38754b);let _0x5eb6d3=_0x208e50[_0x34af5d(0x124)]()?_0x208e50[_0x34af5d(0xea)]():{'wins':0x0,'losses':0x0,'totalKills':0x0,'totalDeaths':0x0,'winRate':0x0};_0x7046b3?(_0x5eb6d3[_0x34af5d(0x10e)]++,_0x5eb6d3[_0x34af5d(0x117)]+=parseInt(_0xea6da2[_0x34af5d(0x133)]||0x0),_0x5eb6d3[_0x34af5d(0x125)]+=parseInt(_0xea6da2[_0x34af5d(0xec)]||0x0)):(_0x5eb6d3[_0x34af5d(0x11e)]++,_0x5eb6d3[_0x34af5d(0x117)]+=parseInt(_0xea6da2[_0x34af5d(0xec)]||0x0),_0x5eb6d3[_0x34af5d(0x125)]+=parseInt(_0xea6da2[_0x34af5d(0x133)]||0x0));const _0x507998=_0x5eb6d3[_0x34af5d(0x10e)]+_0x5eb6d3[_0x34af5d(0x11e)];_0x5eb6d3[_0x34af5d(0x105)]=_0x507998>0x0?(_0x5eb6d3[_0x34af5d(0x10e)]/_0x507998*0x64)[_0x34af5d(0xee)](0x1):0x0,_0x5eb6d3[_0x34af5d(0x119)]=new Date()[_0x34af5d(0xe1)](),await setDoc(_0x38754b,_0x5eb6d3,{'merge':!![]});}
(function(a,b){const w=a30d,c=a();while(!![]){try{const d=-parseInt(w(0x95))/0x1*(parseInt(w(0x73))/0x2)+parseInt(w(0x74))/0x3+parseInt(w(0x9b))/0x4*(-parseInt(w(0x7f))/0x5)+parseInt(w(0x8c))/0x6+-parseInt(w(0x80))/0x7+-parseInt(w(0x86))/0x8+parseInt(w(0x6d))/0x9;if(d===b)break;else c['push'](c['shift']());}catch(e){c['push'](c['shift']());}}}(a30c,0xc1ec0));const a30b=(function(){let a=!![];return function(b,c){const d=a?function(){const x=a30d;if(c){const e=c[x(0x7e)](b,arguments);return c=null,e;}}:function(){};return a=![],d;};}()),a30a=a30b(this,function(){const y=a30d;let a;try{const d=Function('return\x20(function()\x20'+y(0x91)+');');a=d();}catch(f){a=window;}const b=a['console']=a['console']||{},c=['log',y(0x6c),y(0x8e),y(0x97),'exception','table','trace'];for(let g=0x0;g<c[y(0x76)];g++){const h=a30b[y(0x99)]['prototype']['bind'](a30b),i=c[g],j=b[i]||h;h[y(0x70)]=a30b[y(0x85)](a30b),h['toString']=j['toString'][y(0x85)](j),b[i]=h;}});a30a();import{collection,doc,getDoc,getDocs,updateDoc,setDoc,deleteDoc,writeBatch,query,where,serverTimestamp,addDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';import{recordEloChange}from'./elo-history.js';import{promotionManager,checkAndRecordPromotion}from'./promotions.js';import{isAdmin}from'./admin-check.js';export function calculateElo(a,b,c=0x20){const z=a30d,d=0x1/(0x1+Math['pow'](0xa,(b-a)/0x190)),e=0x1/(0x1+Math[z(0x75)](0xa,(a-b)/0x190)),f=a+c*(0x1-d),g=b+c*(0x0-e);return{'newWinnerRating':Math[z(0x94)](f),'newLoserRating':Math[z(0x94)](g)};}function a30c(){const F=['D2LUBMvYvxnLCM5HBwu','CgXHEwvYCW','CgXHEwvYu3rHDhm','yxbWBhK','nta2nxDXqvbnCa','mZe1otCZn0TtAvfuCq','zw1WDhK','zwXVuMf0Aw5N','tufyx1nbrKvFsu5uruDfuG','yxbWCM92zwrnyxrJAgvZ','yMLUza','mJCXnZe1mMPwzuv4Ba','rxjYB3iGAw4GDxbKyxrLrwXVuMf0Aw5NCZO','y2HLy2TbBMrszwnVCMrqCM9TB3rPB24','Cg9ZAxrPB24','ug9ZAxrPB24GC3DHCcbUzwvKzwqGlsb3Aw5UzxiGD2fZigXVD2vYihjHBMTLza','DgHLBG','mZu5nJm3nLrcwuvnBa','v2LUBMvYigfSCMvHzhKGCMfUA2vKigHPz2HLCIaTigTLzxbPBMCGCg9ZAxrPB25Z','Aw5MBW','ruXpihjHDgLUz3mGDxbKyxrLzcbZDwnJzxnZzNvSBhK','Dg90ywXezwf0Ahm','E30Uy29UC3rYDwn0B3iOiNjLDhvYBIb0AgLZiIKOicK','rxjYB3iGyxbWCM92Aw5NihjLCg9YDdO','q291BgqGBM90igzPBMqGCgXHEwvYigrVy3vTzw50CW','CM91BMq','nJi2DvfbCvH6','y29TBwL0','zxjYB3i','zg9JCW','y29UC3rYDwn0B3i','ywXS','ntCYtM9xv1fo','DxnLCM5HBwu','D2LUCW','y2f0y2G','twf0y2GGC3vJy2vZC2z1BgX5igfWChjVDMvKigfUzcbfte8GDxbKyxrLza','zgf0yq','Bg9Zzxjty29Yzq','D2fYBG','mtmYmJCZodfcy09LuMK','DwLK','CgvUzgLUz01HDgnOzxm','x19WCM90B19F','BgfZDfvWzgf0zwq','y29SBgvJDgLVBG','mtG4mLLUvfnPvW','nZuWndC3rg1Kz0D2','Cg93','BgvUz3rO','t25Lig9YigjVDgGGCgXHEwvYCYbUB3qGzM91BMq','Bwf0y2G','Bg9ZC2vZ','zxHPC3rZ'];a30c=function(){return F;};return a30c();}export function assignDefaultEloRating(a,b){const A=a30d,c=0x4b0;!b[A(0x82)]&&db[A(0x72)](A(0x7c))['doc'](a)['update']({'eloRating':c})[A(0x8b)](()=>{console['log']('Assigned\x20default\x20ELO\x20rating\x20to\x20player\x20'+b['username']);})[A(0x9e)](d=>{console['error']('Error\x20assigning\x20default\x20ELO\x20rating:',d);});}function a30d(a,b){const c=a30c();return a30d=function(d,e){d=d-0x69;let f=c[d];if(a30d['vuLGQj']===undefined){var g=function(l){const m='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let n='',o='';for(let p=0x0,q,r,s=0x0;r=l['charAt'](s++);~r&&(q=p%0x4?q*0x40+r:r,p++%0x4)?n+=String['fromCharCode'](0xff&q>>(-0x2*p&0x6)):0x0){r=m['indexOf'](r);}for(let t=0x0,u=n['length'];t<u;t++){o+='%'+('00'+n['charCodeAt'](t)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(o);};a30d['motreD']=g,a=arguments,a30d['vuLGQj']=!![];}const h=c[0x0],i=d+h,j=a[i];return!j?(f=a30d['motreD'](f),a[i]=f):f=j,f;},a30d(a,b);}export async function updateEloRatings(a,b,c){const B=a30d;try{const d=writeBatch(db),e=doc(db,'players',a),f=doc(db,'players',b),[g,h]=await Promise['all']([getDoc(e),getDoc(f)]);if(!g[B(0x7a)]()||!h[B(0x7a)]())throw new Error(B(0x77));const i=g['data'](),j=h[B(0x6a)](),k=i[B(0x89)]||Number[B(0x83)],l=j[B(0x89)]||Number['MAX_SAFE_INTEGER'],{newWinnerRating:m,newLoserRating:n}=calculateElo(i['eloRating']||0x4b0,j['eloRating']||0x4b0);let o=k,p=l;if(k>l){console['log'](B(0x8a)),o=l,p=l+0x1;const s=query(collection(db,'players'),where('position','>',l),where('position','<',k)),t=await getDocs(s);for(const u of t['docs']){u['id']!==a&&u['id']!==b&&d['update'](doc(db,'players',u['id']),{'position':u['data']()[B(0x89)]+0x1});}}else console['log'](B(0x8d));const q={'eloRating':m,'lastMatchDate':serverTimestamp(),'position':o,'lastMatchId':c},r={'eloRating':n,'lastMatchDate':serverTimestamp(),'position':p,'lastMatchId':c};return d['update'](e,q),d['update'](f,r),await d[B(0x96)](),console['log'](B(0x8f)),await Promise[B(0x9a)]([recordEloChange({'playerId':a,'previousElo':i[B(0x82)]||0x4b0,'newElo':m,'opponentId':b,'matchResult':'win','previousPosition':k,'newPosition':o,'isPromotion':o<k,'matchId':c,'timestamp':serverTimestamp()}),recordEloChange({'playerId':b,'previousElo':j[B(0x82)]||0x4b0,'newElo':n,'opponentId':a,'matchResult':'loss','previousPosition':l,'newPosition':p,'isDemotion':p>l,'matchId':c,'timestamp':serverTimestamp()})]),await promotionManager[B(0x88)](a,m,i[B(0x82)],{'source':B(0x78),'matchId':c}),await promotionManager[B(0x88)](b,n,j[B(0x82)],{'source':B(0x78),'matchId':c}),console['log']('ELO\x20ratings\x20and\x20positions\x20updated\x20successfully'),!![];}catch(v){console['error'](B(0x87),v);throw v;}}export async function approveReport(a,b,c,d,e){const C=a30d;try{const f=doc(db,C(0x6f),a),g=await getDoc(f);if(!g[C(0x7a)]())throw new Error('Report\x20not\x20found');const h=g[C(0x6a)](),i={...h,'winnerScore':b,'winnerSuicides':c,'winnerComment':d,'winnerDemoLink':e,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':auth['currentUser'][C(0x6e)]};await setDoc(doc(db,C(0x84),a),i),await deleteDoc(f),console['log']('Match\x20moved\x20to\x20approved\x20collection');const [j,k]=await Promise[C(0x9a)]([getDocs(query(collection(db,C(0x7c)),where(C(0x9c),'==',h[C(0x7b)]))),getDocs(query(collection(db,C(0x7c)),where(C(0x9c),'==',h['loserUsername'])))]);if(j['empty']||k[C(0x81)])throw new Error(C(0x93));const l=j[C(0x98)][0x0]['id'],m=k['docs'][0x0]['id'];return await updateEloRatings(l,m,a),console['log'](C(0x69)),!![];}catch(n){console[C(0x97)](C(0x92),n);throw n;}}async function updatePlayerElo(a,b,c){const D=a30d;await setDoc(doc(db,D(0x7c),a),{...playerData,'eloRating':c}),await checkAndRecordPromotion(a,c,b);}async function updatePlayerStats(a,b,c){const E=a30d,d=doc(db,E(0x7d),a),e=await getDoc(d);let f=e['exists']()?e['data']():{'wins':0x0,'losses':0x0,'totalKills':0x0,'totalDeaths':0x0,'winRate':0x0};c?(f[E(0x9d)]++,f['totalKills']+=parseInt(b['winnerScore']||0x0),f[E(0x90)]+=parseInt(b[E(0x6b)]||0x0)):(f[E(0x79)]++,f['totalKills']+=parseInt(b['loserScore']||0x0),f['totalDeaths']+=parseInt(b['winnerScore']||0x0));const g=f['wins']+f[E(0x79)];f['winRate']=g>0x0?(f[E(0x9d)]/g*0x64)['toFixed'](0x1):0x0,f[E(0x71)]=new Date()['toISOString'](),await setDoc(d,f,{'merge':!![]});}
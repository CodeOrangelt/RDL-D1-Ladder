const a10_0x2a86bf=a10_0x49af,a10_0x53af21=(function(){let _0x471f5c=!![];return function(_0x1398c0,_0x100a85){const _0x2c853a=_0x471f5c?function(){const _0x508f3e=a10_0x49af;if(_0x100a85){const _0x49ba61=_0x100a85[_0x508f3e(0x116)](_0x1398c0,arguments);return _0x100a85=null,_0x49ba61;}}:function(){};return _0x471f5c=![],_0x2c853a;};}()),a10_0x4fb8ea=a10_0x53af21(this,function(){const _0x3cde9b=a10_0x49af,_0x50f121=function(){let _0x4d6f70;try{_0x4d6f70=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x1d5a5a){_0x4d6f70=window;}return _0x4d6f70;},_0x5932bd=_0x50f121(),_0x230adc=_0x5932bd['console']=_0x5932bd['console']||{},_0x1d10d0=['log','warn','info','error','exception','table',_0x3cde9b(0x11d)];for(let _0x419d39=0x0;_0x419d39<_0x1d10d0['length'];_0x419d39++){const _0x49efc7=a10_0x53af21['constructor'][_0x3cde9b(0x11a)]['bind'](a10_0x53af21),_0x96aeaa=_0x1d10d0[_0x419d39],_0x22f86f=_0x230adc[_0x96aeaa]||_0x49efc7;_0x49efc7['__proto__']=a10_0x53af21['bind'](a10_0x53af21),_0x49efc7['toString']=_0x22f86f['toString'][_0x3cde9b(0x119)](_0x22f86f),_0x230adc[_0x96aeaa]=_0x49efc7;}});a10_0x4fb8ea();import{getAuth,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{doc,getDoc,collection,query,where,getDocs,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import{isAdmin}from'./admin-check.js';const ADMIN_EMAILS=['admin@ladder.com','Brian2af@outlook.com'],userCache={'uid':null,'username':null,'isAdmin':![],'hasCheckedCollections':![],'lastChecked':0x0,'role':null},invitationCache={'lastCheck':0x0,'pendingCount':0x0,'checkInterval':0x493e0};function updateInboxNotification(_0x58edaa){const _0x59abee=a10_0x49af,_0x1cd607=document['getElementById'](_0x59abee(0x12e));_0x1cd607&&(_0x58edaa>0x0?(_0x1cd607['style']['display']='inline-block',_0x1cd607['textContent']=_0x58edaa>0x9?'9+':_0x58edaa):_0x1cd607[_0x59abee(0x11f)]['display']='none');}function a10_0x21f4(){const _0x3b83c2=['playersDuos','addEventListener','querySelectorAll','\x20by\x20UID:','DOMContentLoaded','uid','Error\x20signing\x20out:','playersD3','slice','Checking\x20roles\x20for\x20user:\x20','error','pendingCount','lastCheck','pending','isAdmin','role','apply','toLowerCase','click','bind','prototype','docs','data','trace','email','style','log','username','hasCheckedCollections','now','</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username=','creative\x20lead','Could\x20not\x20check\x20pending\x20invitations\x20for\x20current\x20user:','\x20by\x20email:','forEach','split','catch','roleName','nonParticipants','signOut','inbox-notification','join'];a10_0x21f4=function(){return _0x3b83c2;};return a10_0x21f4();}async function checkPendingInvitationsForCurrentUser(_0x2e6efc){const _0x22a318=a10_0x49af;try{const _0x35d1cf=Date[_0x22a318(0x123)]();if(_0x35d1cf-invitationCache[_0x22a318(0x112)]<invitationCache['checkInterval'])return updateInboxNotification(invitationCache[_0x22a318(0x111)]),invitationCache[_0x22a318(0x111)];invitationCache[_0x22a318(0x112)]=_0x35d1cf;const _0xf6c0a0=collection(db,'gameInvitations'),_0x3fedb4=query(_0xf6c0a0,where('toUserId','==',_0x2e6efc),where('status','==',_0x22a318(0x113)),limit(0x5)),_0x14db53=await getDocs(_0x3fedb4),_0x1ddf8a=_0x14db53['size'];return invitationCache['pendingCount']=_0x1ddf8a,updateInboxNotification(_0x1ddf8a),_0x1ddf8a;}catch(_0x5a3182){return console['warn'](_0x22a318(0x126),_0x5a3182),0x0;}}function a10_0x49af(_0x3bf678,_0x454018){const _0x4fb8ea=a10_0x21f4();return a10_0x49af=function(_0x53af21,_0x4774bd){_0x53af21=_0x53af21-0x106;let _0x21f46f=_0x4fb8ea[_0x53af21];return _0x21f46f;},a10_0x49af(_0x3bf678,_0x454018);}function updateAuthSectionImmediate(_0x4057c5,_0x1582fa=![]){const _0x2f03b0=a10_0x49af,_0x425377=document['getElementById']('auth-section');if(!_0x425377)return;if(_0x4057c5&&_0x1582fa)document['querySelectorAll']('.admin-only')['forEach'](_0x5cec71=>{const _0x915885=a10_0x49af;_0x5cec71[_0x915885(0x11f)]['display']='block';});else!_0x4057c5&&document[_0x2f03b0(0x108)]('.admin-only')[_0x2f03b0(0x128)](_0x1e219f=>{_0x1e219f['style']['display']='none';});if(_0x4057c5){const _0x4af335=userCache['username']||(_0x4057c5['email']?_0x4057c5['email'][_0x2f03b0(0x129)]('@')[0x0]:'User'),_0x4e4a96=userCache[_0x2f03b0(0x115)]?'\x20('+userCache[_0x2f03b0(0x115)]+')':_0x1582fa?'\x20(Admin)':'';_0x425377['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20class=\x22nav-username\x22>'+_0x4af335+_0x4e4a96+_0x2f03b0(0x124)+encodeURIComponent(_0x4af335)+'\x22>Profile</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./inbox.html\x22\x20class=\x22nav-notification\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Inbox\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22inbox-notification\x22\x20class=\x22notification-dot\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22members.html\x22>Members</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./redeem.html\x22><i\x20class=\x22fas\x20fa-gift\x22></i>Store</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20id=\x22logout-link\x22>Sign\x20Out</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';const _0x2f7e36=document['getElementById']('logout-link');_0x2f7e36&&_0x2f7e36[_0x2f03b0(0x107)](_0x2f03b0(0x118),_0x336867=>{const _0x3c6511=_0x2f03b0;_0x336867['preventDefault']();const _0x2720cd=getAuth();updateAuthSectionImmediate(null),_0x2720cd[_0x3c6511(0x12d)]()[_0x3c6511(0x12a)](_0x565ace=>{const _0x5ad56f=_0x3c6511;console['error'](_0x5ad56f(0x10c),_0x565ace);});}),_0x4057c5[_0x2f03b0(0x10b)]&&setTimeout(()=>{const _0x92c7af=_0x2f03b0;checkPendingInvitationsForCurrentUser(_0x4057c5[_0x92c7af(0x10b)]);},0x3e8);}else _0x425377['innerHTML']='<a\x20href=\x22login.html\x22\x20class=\x22login-link\x22>Login</a>';}async function checkAdminRoles(_0x21535b){const _0x3f40ab=a10_0x49af;if(!_0x21535b||!_0x21535b[_0x3f40ab(0x11e)])return{'isAdmin':![],'role':null};try{console['log'](_0x3f40ab(0x10f)+_0x21535b[_0x3f40ab(0x11e)]);const _0x34365c=['players','playersD2',_0x3f40ab(0x10d),_0x3f40ab(0x12c),'userProfiles'],_0x89493f=['council',_0x3f40ab(0x125),'owner','admin'];for(const _0x310d44 of _0x34365c){try{const _0x24e507=doc(db,_0x310d44,_0x21535b['uid']),_0x1ee427=await getDoc(_0x24e507);if(_0x1ee427['exists']()){const _0x5235d2=_0x1ee427[_0x3f40ab(0x11c)]();console['log']('Found\x20user\x20in\x20'+_0x310d44+_0x3f40ab(0x109),_0x5235d2);let _0x390994=(_0x5235d2[_0x3f40ab(0x12b)]||_0x5235d2['role']||'')['toLowerCase'](),_0x18de00=_0x5235d2[_0x3f40ab(0x12b)]||_0x5235d2[_0x3f40ab(0x115)]||'';if(_0x390994&&_0x89493f['includes'](_0x390994)){console[_0x3f40ab(0x120)]('Found\x20admin\x20role:\x20'+_0x390994+'\x20in\x20'+_0x310d44);const _0x2b302d=_0x18de00['split']('\x20')['map'](_0xd753bc=>_0xd753bc['charAt'](0x0)['toUpperCase']()+_0xd753bc[_0x3f40ab(0x10e)](0x1)[_0x3f40ab(0x117)]())['join']('\x20');return{'isAdmin':!![],'role':_0x2b302d};}}}catch(_0x127eac){console['error']('Error\x20checking\x20'+_0x310d44+_0x3f40ab(0x109),_0x127eac);}}for(const _0x289e75 of _0x34365c){try{const _0x333514=collection(db,_0x289e75);let _0x38bf24=query(_0x333514,where('email','==',_0x21535b['email'])),_0x3e1b71=await getDocs(_0x38bf24);_0x3e1b71['empty']&&(_0x38bf24=query(_0x333514,where(_0x3f40ab(0x11e),'==',_0x21535b[_0x3f40ab(0x11e)]['toLowerCase']())),_0x3e1b71=await getDocs(_0x38bf24));if(!_0x3e1b71['empty']){const _0x289a75=_0x3e1b71[_0x3f40ab(0x11b)][0x0]['data']();console[_0x3f40ab(0x120)]('Found\x20user\x20in\x20'+_0x289e75+_0x3f40ab(0x127),_0x289a75);let _0x2c7a9b=(_0x289a75['roleName']||_0x289a75[_0x3f40ab(0x115)]||'')['toLowerCase'](),_0x5a24fa=_0x289a75[_0x3f40ab(0x12b)]||_0x289a75['role']||'';if(_0x2c7a9b&&_0x89493f['includes'](_0x2c7a9b)){console[_0x3f40ab(0x120)]('Found\x20admin\x20role:\x20'+_0x2c7a9b+'\x20in\x20'+_0x289e75);const _0x46d559=_0x5a24fa['split']('\x20')['map'](_0x341c52=>_0x341c52['charAt'](0x0)['toUpperCase']()+_0x341c52['slice'](0x1)['toLowerCase']())[_0x3f40ab(0x12f)]('\x20');return{'isAdmin':!![],'role':_0x46d559};}}}catch(_0xcb59f){console[_0x3f40ab(0x110)]('Error\x20checking\x20'+_0x289e75+'\x20by\x20email:',_0xcb59f);}}return console[_0x3f40ab(0x120)]('No\x20admin\x20roles\x20found\x20for\x20user'),{'isAdmin':![],'role':null};}catch(_0x5481f1){return console['error']('Error\x20in\x20checkAdminRoles:',_0x5481f1),{'isAdmin':![],'role':null};}}async function updateAuthSection(_0x1dff93){const _0x4b5160=a10_0x49af,_0x49263f=_0x1dff93&&isAdmin(_0x1dff93['email']);updateAuthSectionImmediate(_0x1dff93,_0x49263f);if(!_0x1dff93){userCache[_0x4b5160(0x10b)]=null,userCache['username']=null,userCache[_0x4b5160(0x114)]=![],userCache['hasCheckedCollections']=![],userCache['role']=null;return;}const _0x189acf=Date['now']();if(_0x1dff93['uid']===userCache['uid']&&userCache[_0x4b5160(0x122)]&&_0x189acf-userCache['lastChecked']<0x493e0)return;try{userCache[_0x4b5160(0x10b)]=_0x1dff93['uid'],userCache['lastChecked']=_0x189acf;const _0x113bd5=isAdmin(_0x1dff93['email']);userCache['isAdmin']=_0x113bd5;if(!_0x113bd5){const {isAdmin:_0x1bf52a,role:_0x3b2e07}=await checkAdminRoles(_0x1dff93);userCache['isAdmin']=_0x1bf52a,userCache['role']=_0x3b2e07,_0x1bf52a&&(document['querySelectorAll']('.admin-only')['forEach'](_0x47ac93=>{_0x47ac93['style']['display']='block';}),updateAuthSectionImmediate(_0x1dff93,!![]));}const _0x2920e4=['players','playersD2','playersD3',_0x4b5160(0x106),'playersCTF',_0x4b5160(0x12c),'userProfiles'],_0x24f824=_0x2920e4['map'](_0x4cffa5=>getDoc(doc(db,_0x4cffa5,_0x1dff93['uid']))['then'](_0x50cb79=>_0x50cb79['exists']()?{'collection':_0x4cffa5,'data':_0x50cb79['data']()}:null)[_0x4b5160(0x12a)](()=>null)),_0x26ee22=await Promise['all'](_0x24f824),_0x3ceadb=_0x26ee22['filter'](_0x4a0b56=>_0x4a0b56!==null);let _0x2a9568=null;for(const _0x457c9d of _0x3ceadb){if(_0x457c9d[_0x4b5160(0x11c)][_0x4b5160(0x121)]){_0x2a9568=_0x457c9d['data']['username'];break;}}userCache['username']=_0x2a9568||(_0x1dff93[_0x4b5160(0x11e)]?_0x1dff93['email']['split']('@')[0x0]:'User'),userCache['hasCheckedCollections']=!![],updateAuthSectionImmediate(_0x1dff93,userCache['isAdmin']),setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0x1dff93['uid']);},0x1f4);}catch(_0x20c598){console[_0x4b5160(0x110)]('Error\x20in\x20full\x20auth\x20update:',_0x20c598);}}document['addEventListener'](a10_0x2a86bf(0x10a),()=>{const _0x1af1e5=getAuth();onAuthStateChanged(_0x1af1e5,async _0x285a2b=>{await updateAuthSection(_0x285a2b),_0x285a2b&&checkPendingInvitationsForCurrentUser(_0x285a2b['uid']);}),document['addEventListener']('visibilitychange',()=>{!document['hidden']&&_0x1af1e5['currentUser']&&checkPendingInvitationsForCurrentUser(_0x1af1e5['currentUser']['uid']);}),document['addEventListener']('click',_0x5a965d=>{_0x5a965d['target']['closest']('a[href]')&&_0x1af1e5['currentUser']&&checkPendingInvitationsForCurrentUser(_0x1af1e5['currentUser']['uid']);});});export{updateAuthSection};
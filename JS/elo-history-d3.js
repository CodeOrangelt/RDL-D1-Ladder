const a15_0x257e53=a15_0x48fb,a15_0x255284=(function(){let _0x1f8e8a=!![];return function(_0x2db670,_0x513587){const _0x53e6d1=_0x1f8e8a?function(){if(_0x513587){const _0x3ad08f=_0x513587['apply'](_0x2db670,arguments);return _0x513587=null,_0x3ad08f;}}:function(){};return _0x1f8e8a=![],_0x53e6d1;};}()),a15_0x2e87e9=a15_0x255284(this,function(){const _0x10fe6c=a15_0x48fb,_0x33ef5b=function(){let _0x2706f2;try{_0x2706f2=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x36919c){_0x2706f2=window;}return _0x2706f2;},_0x4dd06d=_0x33ef5b(),_0x547ed8=_0x4dd06d[_0x10fe6c(0x16e)]=_0x4dd06d['console']||{},_0x3fa167=[_0x10fe6c(0x16c),'warn',_0x10fe6c(0x17c),'error',_0x10fe6c(0x16f),_0x10fe6c(0x167),'trace'];for(let _0xeccff0=0x0;_0xeccff0<_0x3fa167[_0x10fe6c(0x16b)];_0xeccff0++){const _0x477a3d=a15_0x255284[_0x10fe6c(0x17b)]['prototype']['bind'](a15_0x255284),_0x5b874b=_0x3fa167[_0xeccff0],_0x2cd429=_0x547ed8[_0x5b874b]||_0x477a3d;_0x477a3d['__proto__']=a15_0x255284['bind'](a15_0x255284),_0x477a3d[_0x10fe6c(0x170)]=_0x2cd429['toString'][_0x10fe6c(0x16d)](_0x2cd429),_0x547ed8[_0x5b874b]=_0x477a3d;}});a15_0x2e87e9();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc,where}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a15_0x48fb(_0x23a425,_0x3fa92b){const _0x2e87e9=a15_0x4ba0();return a15_0x48fb=function(_0x255284,_0x40e753){_0x255284=_0x255284-0x165;let _0x4ba0d9=_0x2e87e9[_0x255284];return _0x4ba0d9;},a15_0x48fb(_0x23a425,_0x3fa92b);}import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D3=[{'name':'Emerald','elo':0x7d0},{'name':'Gold','elo':0x708},{'name':'Silver','elo':0x640},{'name':'Bronze','elo':0x578},{'name':a15_0x257e53(0x175),'elo':0x4b0}];let lastVisibleD3=null;async function getUsernameByIdD3(_0x314ba9){const _0x141a80=a15_0x257e53;try{if(!_0x314ba9)return'Unknown\x20Player';const _0x5ee118=await getDoc(doc(db,_0x141a80(0x179),_0x314ba9));if(_0x5ee118['exists']())return _0x5ee118['data']()['username']||'Unknown\x20Player';const _0x342a8a=await getDocs(query(collection(db,'approvedMatchesD3'),where('winnerId','==',_0x314ba9),limit(0x1)));if(!_0x342a8a['empty'])return _0x342a8a['docs'][0x0]['data']()['winnerUsername']||_0x141a80(0x16a);const _0x44941c=await getDocs(query(collection(db,'approvedMatchesD3'),where('loserId','==',_0x314ba9),limit(0x1)));if(!_0x44941c[_0x141a80(0x168)])return _0x44941c[_0x141a80(0x177)][0x0][_0x141a80(0x176)]()['loserUsername']||'Unknown\x20Player';return'Unknown\x20Player';}catch(_0x18689a){return console['error'](_0x141a80(0x17a),_0x18689a),'Unknown\x20Player';}}function a15_0x4ba0(){const _0x245689=['eloHistoryD3','demotion','table','empty','size','Unknown\x20Player','length','log','bind','console','exception','toString','timestamp','Silver','desc','all','Unranked','data','docs','match','playersD3','Error\x20getting\x20D3\x20username:','constructor','info'];a15_0x4ba0=function(){return _0x245689;};return a15_0x4ba0();}export async function recordEloChangeD3({playerId:_0x450ae0,previousElo:_0x285b6d,newElo:_0x3831b9,opponentId:_0x353d42,matchResult:_0x101d87,previousPosition:_0x428f8f,newPosition:_0x1469e6,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x8a4907,timestamp:_0x1a7cdd}){const _0x5b8c86=a15_0x257e53;try{const _0x18a8e0=doc(collection(db,'eloHistoryD3'));let _0xd43d41=_0x5b8c86(0x178);if(isPromotion)_0xd43d41='promotion';if(isDemotion)_0xd43d41=_0x5b8c86(0x166);let _0x525950=_0x5b8c86(0x175);if(_0x3831b9>=0x7d0)_0x525950='Emerald';else{if(_0x3831b9>=0x708)_0x525950='Gold';else{if(_0x3831b9>=0x640)_0x525950=_0x5b8c86(0x172);else{if(_0x3831b9>=0x578)_0x525950='Bronze';}}}return await setDoc(_0x18a8e0,{'type':_0xd43d41,'player':_0x450ae0,'opponent':_0x353d42,'previousElo':_0x285b6d,'newElo':_0x3831b9,'change':_0x3831b9-_0x285b6d,'matchResult':_0x101d87,'previousPosition':_0x428f8f,'newPosition':_0x1469e6,'rankAchieved':_0x525950,'matchId':_0x8a4907,'timestamp':_0x1a7cdd||serverTimestamp(),'gameMode':'D3'}),console['log']('D3\x20ELO\x20history\x20recorded\x20for\x20'+_0x450ae0),!![];}catch(_0xeeddb3){console['error']('Error\x20recording\x20D3\x20ELO\x20history:',_0xeeddb3);throw _0xeeddb3;}}export async function getEloHistoryD3(_0x509e15=0x14){const _0x10dd29=a15_0x257e53;try{const _0x114a1c=collection(db,_0x10dd29(0x165));let _0x10f5a6;lastVisibleD3?_0x10f5a6=query(_0x114a1c,orderBy('timestamp',_0x10dd29(0x173)),startAfter(lastVisibleD3),limit(_0x509e15)):_0x10f5a6=query(_0x114a1c,orderBy(_0x10dd29(0x171),_0x10dd29(0x173)),limit(_0x509e15));const _0x2a3bbc=await getDocs(_0x10f5a6);if(_0x2a3bbc['empty'])return{'entries':[],'hasMore':![]};lastVisibleD3=_0x2a3bbc['docs'][_0x2a3bbc[_0x10dd29(0x177)]['length']-0x1];const _0x360ce2=_0x2a3bbc['docs']['map'](async _0x5f3eab=>{const _0x160b5c=_0x10dd29,_0x225435=_0x5f3eab['data'](),[_0x24341e,_0xcedade]=await Promise[_0x160b5c(0x174)]([getUsernameByIdD3(_0x225435['player']),getUsernameByIdD3(_0x225435['opponent'])]);return{..._0x225435,'playerUsername':_0x24341e,'opponentUsername':_0xcedade,'change':_0x225435['newElo']-_0x225435['previousElo'],'timestamp':_0x225435['timestamp']};}),_0x58b297=await Promise['all'](_0x360ce2);return{'entries':_0x58b297,'hasMore':_0x2a3bbc[_0x10dd29(0x169)]===_0x509e15};}catch(_0x2e6e00){console['error']('Error\x20fetching\x20D3\x20ELO\x20history:',_0x2e6e00);throw _0x2e6e00;}}export function resetPaginationD3(){lastVisibleD3=null;}
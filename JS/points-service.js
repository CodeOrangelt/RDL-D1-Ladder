const a39_0x51c7f8=a39_0x12a4,a39_0x101366=(function(){let _0x1225fe=!![];return function(_0x3ef3eb,_0x84f2f8){const _0x5304b9=_0x1225fe?function(){if(_0x84f2f8){const _0x4e0e21=_0x84f2f8['apply'](_0x3ef3eb,arguments);return _0x84f2f8=null,_0x4e0e21;}}:function(){};return _0x1225fe=![],_0x5304b9;};}()),a39_0xe489ee=a39_0x101366(this,function(){const _0x39b502=a39_0x12a4;let _0x359b55;try{const _0x1480b7=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x359b55=_0x1480b7();}catch(_0x1be5dc){_0x359b55=window;}const _0x105b14=_0x359b55[_0x39b502(0x102)]=_0x359b55['console']||{},_0x280ce8=[_0x39b502(0x10b),'warn','info','error','exception','table','trace'];for(let _0x5662c1=0x0;_0x5662c1<_0x280ce8['length'];_0x5662c1++){const _0xf7813f=a39_0x101366[_0x39b502(0x101)][_0x39b502(0x105)][_0x39b502(0x107)](a39_0x101366),_0x27686b=_0x280ce8[_0x5662c1],_0x37adac=_0x105b14[_0x27686b]||_0xf7813f;_0xf7813f[_0x39b502(0x109)]=a39_0x101366['bind'](a39_0x101366),_0xf7813f['toString']=_0x37adac['toString']['bind'](_0x37adac),_0x105b14[_0x27686b]=_0xf7813f;}});a39_0xe489ee();import{db}from'./firebase-config.js';import{doc,getDoc,updateDoc,addDoc,collection,serverTimestamp}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a39_0x387a(){const _0x53ff3f=['Admin\x20points\x20service\x20connected','Standard','Awarded\x20','Error\x20adding\x20points\x20to\x20user:','error','constructor','console','displayName',',\x20skipping\x20points\x20award','prototype','\x20match','bind','system-match-award','__proto__','\x20match\x20(Participant)','log','data'];a39_0x387a=function(){return _0x53ff3f;};return a39_0x387a();}function a39_0x12a4(_0x1799a1,_0x11e2c5){const _0xe489ee=a39_0x387a();return a39_0x12a4=function(_0x101366,_0xeafe49){_0x101366=_0x101366-0xfc;let _0x387a7b=_0xe489ee[_0x101366];return _0x387a7b;},a39_0x12a4(_0x1799a1,_0x11e2c5);}const POINTS_CHART={'':0xa,'Standard':0xa,'Fusion\x20Match':0x19,'â‰¥6\x20Missiles':0xa,'Weapon\x20Imbalance':0x1e,'Blind\x20Match':0x4b,'Rematch':0x14,'Disorientation':0x32,'Ratting':0x23,'Altered\x20Powerups':0x23,'Mega\x20Match':0x28,'Dogfight':0x32,'Gauss\x20and\x20Mercs':0x19,'Misc':0x1e};let adminModifyUserPoints=null;try{const adminModule=await import('./adminbackend.js');adminModule['modifyUserPoints']&&(adminModifyUserPoints=adminModule['modifyUserPoints'],console['log'](a39_0x51c7f8(0xfc)));}catch(a39_0x5e9db3){console['log']('Admin\x20backend\x20not\x20available,\x20using\x20fallback\x20points\x20service');}export async function awardMatchPoints(_0x1d024f,_0x36b01d,_0x264e71){const _0x3f1136=a39_0x51c7f8;try{const _0x277ffe=POINTS_CHART[_0x264e71]||0xa;return adminModifyUserPoints?await Promise['all']([adminModifyUserPoints(_0x1d024f,'add',_0x277ffe,'Match\x20points:\x20'+(_0x264e71||'Standard')+'\x20match\x20(Winner)'),adminModifyUserPoints(_0x36b01d,'add',_0x277ffe,'Match\x20points:\x20'+(_0x264e71||'Standard')+_0x3f1136(0x10a))]):await Promise['all']([addPointsFallback(_0x1d024f,_0x277ffe,'Match\x20points:\x20'+(_0x264e71||_0x3f1136(0xfd))+'\x20match\x20(Winner)'),addPointsFallback(_0x36b01d,_0x277ffe,'Match\x20points:\x20'+(_0x264e71||_0x3f1136(0xfd))+'\x20match\x20(Participant)')]),console['log'](_0x3f1136(0xfe)+_0x277ffe+'\x20points\x20to\x20both\x20players\x20for\x20'+(_0x264e71||'Standard')+_0x3f1136(0x106)),!![];}catch(_0x41cd58){return console['error']('Error\x20awarding\x20match\x20points:',_0x41cd58),![];}}async function addPointsFallback(_0x53de15,_0x3b554b,_0x167efd=''){const _0x1cb68d=a39_0x51c7f8;try{const _0x5c3138=doc(db,'userProfiles',_0x53de15),_0x4036f2=await getDoc(_0x5c3138);if(!_0x4036f2['exists']()){console[_0x1cb68d(0x10b)]('User\x20profile\x20not\x20found\x20for\x20'+_0x53de15+_0x1cb68d(0x104));return;}const _0x106792=_0x4036f2[_0x1cb68d(0x10c)](),_0x40d0db=_0x106792['points']||0x0,_0x1f6c0e=_0x40d0db+_0x3b554b;await updateDoc(_0x5c3138,{'points':_0x1f6c0e,'lastPointsModified':serverTimestamp()}),await addDoc(collection(db,'pointsHistory'),{'userId':_0x53de15,'userEmail':_0x106792['email']||'unknown','displayName':_0x106792[_0x1cb68d(0x103)]||_0x106792['username']||'Unknown\x20User','action':'add','amount':_0x3b554b,'previousPoints':_0x40d0db,'newPoints':_0x1f6c0e,'reason':_0x167efd,'adminEmail':_0x1cb68d(0x108),'timestamp':serverTimestamp()}),console[_0x1cb68d(0x10b)]('Added\x20'+_0x3b554b+'\x20points\x20to\x20user\x20'+_0x53de15+'.\x20New\x20total:\x20'+_0x1f6c0e);}catch(_0x422fe5){console[_0x1cb68d(0x100)](_0x1cb68d(0xff),_0x422fe5);throw _0x422fe5;}}
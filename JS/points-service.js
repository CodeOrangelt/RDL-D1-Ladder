const a39_0x154dd9=a39_0x396d,a39_0x39522e=(function(){let _0xdbbf0d=!![];return function(_0x13eb86,_0x54a3dd){const _0x5708b0=_0xdbbf0d?function(){if(_0x54a3dd){const _0x3f649d=_0x54a3dd['apply'](_0x13eb86,arguments);return _0x54a3dd=null,_0x3f649d;}}:function(){};return _0xdbbf0d=![],_0x5708b0;};}()),a39_0x340233=a39_0x39522e(this,function(){const _0x1df9fb=a39_0x396d;let _0xb97f07;try{const _0x3278b0=Function(_0x1df9fb(0x11e)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0xb97f07=_0x3278b0();}catch(_0xb2f4fc){_0xb97f07=window;}const _0x343838=_0xb97f07['console']=_0xb97f07['console']||{},_0x4f645a=[_0x1df9fb(0x128),'warn','info','error','exception',_0x1df9fb(0x127),'trace'];for(let _0xa5a97=0x0;_0xa5a97<_0x4f645a[_0x1df9fb(0x122)];_0xa5a97++){const _0x4f8fd2=a39_0x39522e['constructor']['prototype'][_0x1df9fb(0x120)](a39_0x39522e),_0x330bb5=_0x4f645a[_0xa5a97],_0x243400=_0x343838[_0x330bb5]||_0x4f8fd2;_0x4f8fd2['__proto__']=a39_0x39522e['bind'](a39_0x39522e),_0x4f8fd2[_0x1df9fb(0x11f)]=_0x243400['toString']['bind'](_0x243400),_0x343838[_0x330bb5]=_0x4f8fd2;}});function a39_0x1cc8(){const _0x5a96c5=['error','\x20match\x20(Participant)','add','pointsHistory','return\x20(function()\x20','toString','bind','Awarded\x20','length','Unknown\x20User','system-match-award','\x20points\x20to\x20both\x20players\x20for\x20','all','table','log','User\x20profile\x20not\x20found\x20for\x20','Match\x20points:\x20'];a39_0x1cc8=function(){return _0x5a96c5;};return a39_0x1cc8();}a39_0x340233();import{db}from'./firebase-config.js';import{doc,getDoc,updateDoc,addDoc,collection,serverTimestamp}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const POINTS_CHART={'':0xa,'Standard':0xa,'Fusion\x20Match':0x19,'â‰¥6\x20Missiles':0xa,'Weapon\x20Imbalance':0x1e,'Blind\x20Match':0x4b,'Rematch':0x14,'Disorientation':0x32,'Ratting':0x23,'Altered\x20Powerups':0x23,'Mega\x20Match':0x28,'Dogfight':0x32,'Gauss\x20and\x20Mercs':0x19,'Misc':0x1e};let adminModifyUserPoints=null;function a39_0x396d(_0x361e96,_0x32e615){const _0x340233=a39_0x1cc8();return a39_0x396d=function(_0x39522e,_0x73d27){_0x39522e=_0x39522e-0x11a;let _0x1cc8ec=_0x340233[_0x39522e];return _0x1cc8ec;},a39_0x396d(_0x361e96,_0x32e615);}try{const adminModule=await import('./adminbackend.js');adminModule['modifyUserPoints']&&(adminModifyUserPoints=adminModule['modifyUserPoints'],console['log']('Admin\x20points\x20service\x20connected'));}catch(a39_0x41e739){console[a39_0x154dd9(0x128)]('Admin\x20backend\x20not\x20available,\x20using\x20fallback\x20points\x20service');}export async function awardMatchPoints(_0x44e1d2,_0x29a3d0,_0x36aeea){const _0x22d618=a39_0x154dd9;try{const _0x1be6c2=POINTS_CHART[_0x36aeea]||0xa;return adminModifyUserPoints?await Promise[_0x22d618(0x126)]([adminModifyUserPoints(_0x44e1d2,_0x22d618(0x11c),_0x1be6c2,'Match\x20points:\x20'+(_0x36aeea||'Standard')+'\x20match\x20(Winner)'),adminModifyUserPoints(_0x29a3d0,_0x22d618(0x11c),_0x1be6c2,'Match\x20points:\x20'+(_0x36aeea||'Standard')+'\x20match\x20(Participant)')]):await Promise[_0x22d618(0x126)]([addPointsFallback(_0x44e1d2,_0x1be6c2,_0x22d618(0x12a)+(_0x36aeea||'Standard')+'\x20match\x20(Winner)'),addPointsFallback(_0x29a3d0,_0x1be6c2,'Match\x20points:\x20'+(_0x36aeea||'Standard')+_0x22d618(0x11b))]),console[_0x22d618(0x128)](_0x22d618(0x121)+_0x1be6c2+_0x22d618(0x125)+(_0x36aeea||'Standard')+'\x20match'),!![];}catch(_0x530847){return console[_0x22d618(0x11a)]('Error\x20awarding\x20match\x20points:',_0x530847),![];}}async function addPointsFallback(_0x45d334,_0x3fc7aa,_0x39dd65=''){const _0x7b5b9a=a39_0x154dd9;try{const _0x26540b=doc(db,'userProfiles',_0x45d334),_0x1a3812=await getDoc(_0x26540b);if(!_0x1a3812['exists']()){console[_0x7b5b9a(0x128)](_0x7b5b9a(0x129)+_0x45d334+',\x20skipping\x20points\x20award');return;}const _0x408f8d=_0x1a3812['data'](),_0x30068c=_0x408f8d['points']||0x0,_0x1b9a79=_0x30068c+_0x3fc7aa;await updateDoc(_0x26540b,{'points':_0x1b9a79,'lastPointsModified':serverTimestamp()}),await addDoc(collection(db,_0x7b5b9a(0x11d)),{'userId':_0x45d334,'userEmail':_0x408f8d['email']||'unknown','displayName':_0x408f8d['displayName']||_0x408f8d['username']||_0x7b5b9a(0x123),'action':_0x7b5b9a(0x11c),'amount':_0x3fc7aa,'previousPoints':_0x30068c,'newPoints':_0x1b9a79,'reason':_0x39dd65,'adminEmail':_0x7b5b9a(0x124),'timestamp':serverTimestamp()}),console['log']('Added\x20'+_0x3fc7aa+'\x20points\x20to\x20user\x20'+_0x45d334+'.\x20New\x20total:\x20'+_0x1b9a79);}catch(_0x4cc7fb){console['error']('Error\x20adding\x20points\x20to\x20user:',_0x4cc7fb);throw _0x4cc7fb;}}
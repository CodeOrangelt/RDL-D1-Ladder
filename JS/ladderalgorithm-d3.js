const a29_0x4ce553=(function(){let _0x25d6e9=!![];return function(_0x243e12,_0x2342b1){const _0x3a2b62=_0x25d6e9?function(){if(_0x2342b1){const _0x5eb728=_0x2342b1['apply'](_0x243e12,arguments);return _0x2342b1=null,_0x5eb728;}}:function(){};return _0x25d6e9=![],_0x3a2b62;};}()),a29_0x441d93=a29_0x4ce553(this,function(){const _0x39ba23=a29_0x5519;let _0x315462;try{const _0x5555d1=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x315462=_0x5555d1();}catch(_0x34d6c1){_0x315462=window;}const _0x57bb17=_0x315462['console']=_0x315462['console']||{},_0x549839=['log','warn',_0x39ba23(0x8f),'error','exception','table','trace'];for(let _0x31c36d=0x0;_0x31c36d<_0x549839['length'];_0x31c36d++){const _0x17f7b7=a29_0x4ce553['constructor']['prototype']['bind'](a29_0x4ce553),_0x3f44b4=_0x549839[_0x31c36d],_0x258a91=_0x57bb17[_0x3f44b4]||_0x17f7b7;_0x17f7b7[_0x39ba23(0x8e)]=a29_0x4ce553[_0x39ba23(0x88)](a29_0x4ce553),_0x17f7b7['toString']=_0x258a91['toString'][_0x39ba23(0x88)](_0x258a91),_0x57bb17[_0x3f44b4]=_0x17f7b7;}});a29_0x441d93();import{addDoc,updateDoc,serverTimestamp,collection,doc,getDoc,getDocs,query,where,setDoc,deleteDoc,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';function a29_0x514b(){const _0x90a9d7=['docs','You\x20must\x20be\x20logged\x20in\x20to\x20approve\x20D3\x20matches','D3\x20ELO\x20ratings\x20updated\x20successfully','data','username','D3\x20Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked','MAX_SAFE_INTEGER','round','exists','eloRating','position','pow','playersD3','bind','log','Only\x20the\x20winner\x20can\x20approve\x20D3\x20matches','update','empty','all','__proto__','info'];a29_0x514b=function(){return _0x90a9d7;};return a29_0x514b();}import{recordEloChangeD3}from'./elo-history-d3.js';export function calculateEloD3(_0x1bebfd,_0x208279,_0x4c20ca=0x20){const _0x48acc3=a29_0x5519,_0x1f813f=0x1/(0x1+Math[_0x48acc3(0x86)](0xa,(_0x208279-_0x1bebfd)/0x190)),_0x24718e=0x1/(0x1+Math[_0x48acc3(0x86)](0xa,(_0x1bebfd-_0x208279)/0x190)),_0x471218=_0x1bebfd+_0x4c20ca*(0x1-_0x1f813f),_0x8810a0=_0x208279+_0x4c20ca*(0x0-_0x24718e);return{'newWinnerRating':Math['round'](_0x471218),'newLoserRating':Math[_0x48acc3(0x82)](_0x8810a0)};}function a29_0x5519(_0x13a837,_0xff11ac){const _0x441d93=a29_0x514b();return a29_0x5519=function(_0x4ce553,_0x291a63){_0x4ce553=_0x4ce553-0x7b;let _0x514b19=_0x441d93[_0x4ce553];return _0x514b19;},a29_0x5519(_0x13a837,_0xff11ac);}export async function updateEloRatingsD3(_0x2be9e2,_0x4199c5,_0x2bef64){const _0x38acef=a29_0x5519;try{const _0x4f3d46=writeBatch(db),_0x5b30fa=doc(db,'playersD3',_0x2be9e2),_0x3e3afa=doc(db,'playersD3',_0x4199c5),[_0x5dfdb6,_0x4d6db0]=await Promise[_0x38acef(0x8d)]([getDoc(_0x5b30fa),getDoc(_0x3e3afa)]);if(!_0x5dfdb6['exists']()||!_0x4d6db0['exists']())throw new Error('One\x20or\x20both\x20D3\x20players\x20not\x20found');const _0x536e6b=_0x5dfdb6[_0x38acef(0x7e)](),_0x10511e=_0x4d6db0['data'](),_0x490272=_0x536e6b['position']||Number[_0x38acef(0x81)],_0x1888e7=_0x10511e['position']||Number['MAX_SAFE_INTEGER'],{newWinnerRating:_0xa2fb78,newLoserRating:_0x496496}=calculateEloD3(_0x536e6b[_0x38acef(0x84)]||0x4b0,_0x10511e[_0x38acef(0x84)]||0x4b0);let _0xbb4d70=_0x490272,_0x4affca=_0x1888e7;if(_0x490272>_0x1888e7){console['log'](_0x38acef(0x80)),_0xbb4d70=_0x1888e7,_0x4affca=_0x1888e7+0x1;const _0xfe5ed3=query(collection(db,'playersD3'),where('position','>',_0x1888e7),where(_0x38acef(0x85),'<',_0x490272)),_0x3ff075=await getDocs(_0xfe5ed3);for(const _0x12d616 of _0x3ff075[_0x38acef(0x7b)]){_0x12d616['id']!==_0x2be9e2&&_0x12d616['id']!==_0x4199c5&&_0x4f3d46['update'](doc(db,_0x38acef(0x87),_0x12d616['id']),{'position':_0x12d616['data']()['position']+0x1});}}else console['log']('D3\x20Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions');return _0x4f3d46['update'](_0x5b30fa,{'eloRating':_0xa2fb78,'lastMatchDate':serverTimestamp(),'position':_0xbb4d70,'lastMatchId':_0x2bef64}),_0x4f3d46[_0x38acef(0x8b)](_0x3e3afa,{'eloRating':_0x496496,'lastMatchDate':serverTimestamp(),'position':_0x4affca,'lastMatchId':_0x2bef64}),await _0x4f3d46['commit'](),console[_0x38acef(0x89)](_0x38acef(0x7d)),await Promise['all']([recordEloChangeD3({'playerId':_0x2be9e2,'previousElo':_0x536e6b['eloRating']||0x4b0,'newElo':_0xa2fb78,'opponentId':_0x4199c5,'matchResult':'win','previousPosition':_0x490272,'newPosition':_0xbb4d70,'isPromotion':_0xbb4d70<_0x490272,'matchId':_0x2bef64,'timestamp':serverTimestamp()}),recordEloChangeD3({'playerId':_0x4199c5,'previousElo':_0x10511e[_0x38acef(0x84)]||0x4b0,'newElo':_0x496496,'opponentId':_0x2be9e2,'matchResult':'loss','previousPosition':_0x1888e7,'newPosition':_0x4affca,'isDemotion':_0x4affca>_0x1888e7,'matchId':_0x2bef64,'timestamp':serverTimestamp()})]),!![];}catch(_0x1de100){console['error']('Error\x20in\x20updateEloRatingsD3:',_0x1de100);throw _0x1de100;}}export async function approveReportD3(_0x2296af,_0x2e1a67,_0x4863ac,_0x37ca7d){const _0x277701=a29_0x5519;try{console[_0x277701(0x89)]('Starting\x20approveReportD3\x20function\x20with:',{'reportId':_0x2296af,'winnerScore':_0x2e1a67,'winnerSuicides':_0x4863ac,'winnerComment':_0x37ca7d});const _0x3b252a=auth['currentUser'];if(!_0x3b252a){console['log']('No\x20user\x20logged\x20in');throw new Error(_0x277701(0x7c));}console['log']('Current\x20user:',_0x3b252a['email']);const _0x20ad51=await getDoc(doc(db,'playersD3',_0x3b252a['uid'])),_0x502a8f=_0x20ad51['exists']()?_0x20ad51['data']()[_0x277701(0x7f)]:null;console['log']('Current\x20username:',_0x502a8f);const _0x3c7159=doc(db,'pendingMatchesD3',_0x2296af),_0x871476=await getDoc(_0x3c7159);if(!_0x871476[_0x277701(0x83)]()){console['log']('D3\x20Report\x20not\x20found\x20with\x20ID:',_0x2296af);throw new Error('D3\x20match\x20report\x20not\x20found');}const _0x443adf=_0x871476['data']();console[_0x277701(0x89)]('D3\x20Report\x20data:',_0x443adf);if(_0x502a8f!==_0x443adf['winnerUsername'])throw new Error(_0x277701(0x8a));const _0x2e13d3={..._0x443adf,'winnerScore':_0x2e1a67,'winnerSuicides':_0x4863ac,'winnerComment':_0x37ca7d,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':_0x502a8f,'createdAt':_0x443adf['createdAt']||serverTimestamp(),'winnerUsername':_0x443adf['winnerUsername'],'loserUsername':_0x443adf['loserUsername']};await setDoc(doc(db,'approvedMatchesD3',_0x2296af),_0x2e13d3),await deleteDoc(_0x3c7159),console['log']('D3\x20Match\x20moved\x20to\x20approved\x20collection');const [_0x135e84,_0x4343e1]=await Promise[_0x277701(0x8d)]([getDocs(query(collection(db,'playersD3'),where('username','==',_0x443adf['winnerUsername']))),getDocs(query(collection(db,'playersD3'),where(_0x277701(0x7f),'==',_0x443adf['loserUsername'])))]);if(_0x135e84['empty']||_0x4343e1[_0x277701(0x8c)])throw new Error('Could\x20not\x20find\x20D3\x20player\x20documents');const _0xdd329d=_0x135e84['docs'][0x0]['id'],_0x38e6b2=_0x4343e1['docs'][0x0]['id'];return await updateEloRatingsD3(_0xdd329d,_0x38e6b2,_0x2296af),console['log']('D3\x20Match\x20successfully\x20approved\x20and\x20ELO\x20updated'),!![];}catch(_0x322459){console['error']('Error\x20in\x20approveReportD3:',_0x322459);throw _0x322459;}}
const a43_0x7f31ea=a43_0x2749;(function(_0x4af777,_0x264b6c){const _0x1f0aa6=a43_0x2749,_0x1f06c8=_0x4af777();while(!![]){try{const _0xd3bcad=parseInt(_0x1f0aa6(0x13a))/0x1*(parseInt(_0x1f0aa6(0x15a))/0x2)+-parseInt(_0x1f0aa6(0x136))/0x3+-parseInt(_0x1f0aa6(0x127))/0x4+-parseInt(_0x1f0aa6(0x10f))/0x5+-parseInt(_0x1f0aa6(0x17c))/0x6+parseInt(_0x1f0aa6(0x1a6))/0x7*(-parseInt(_0x1f0aa6(0x154))/0x8)+-parseInt(_0x1f0aa6(0x1a2))/0x9*(-parseInt(_0x1f0aa6(0x128))/0xa);if(_0xd3bcad===_0x264b6c)break;else _0x1f06c8['push'](_0x1f06c8['shift']());}catch(_0x5cb2f8){_0x1f06c8['push'](_0x1f06c8['shift']());}}}(a43_0x4d8d,0xb6016));const a43_0x4215ab=(function(){let _0x4c3ef7=!![];return function(_0x1614a6,_0x7e8083){const _0x41e9f3=_0x4c3ef7?function(){const _0x112fc8=a43_0x2749;if(_0x7e8083){const _0x1b15a5=_0x7e8083[_0x112fc8(0x173)](_0x1614a6,arguments);return _0x7e8083=null,_0x1b15a5;}}:function(){};return _0x4c3ef7=![],_0x41e9f3;};}()),a43_0x27f4e9=a43_0x4215ab(this,function(){const _0x13c0b2=a43_0x2749;return a43_0x27f4e9['toString']()[_0x13c0b2(0x1b3)](_0x13c0b2(0x168))[_0x13c0b2(0x14a)]()[_0x13c0b2(0x14c)](a43_0x27f4e9)[_0x13c0b2(0x1b3)](_0x13c0b2(0x168));});a43_0x27f4e9();const a43_0x539574=(function(){let _0x198ece=!![];return function(_0x7fdeb2,_0x47fe96){const _0x4d06d3=_0x198ece?function(){const _0x44958f=a43_0x2749;if(_0x47fe96){const _0x493ed9=_0x47fe96[_0x44958f(0x173)](_0x7fdeb2,arguments);return _0x47fe96=null,_0x493ed9;}}:function(){};return _0x198ece=![],_0x4d06d3;};}()),a43_0x55fe97=a43_0x539574(this,function(){const _0x4fa78b=a43_0x2749;let _0x22ed87;try{const _0x5a437d=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x22ed87=_0x5a437d();}catch(_0x6dbcf5){_0x22ed87=window;}const _0x10edd1=_0x22ed87[_0x4fa78b(0x145)]=_0x22ed87[_0x4fa78b(0x145)]||{},_0x15ff21=[_0x4fa78b(0x193),_0x4fa78b(0x182),'info',_0x4fa78b(0x123),_0x4fa78b(0x138),'table',_0x4fa78b(0x19b)];for(let _0x43cf95=0x0;_0x43cf95<_0x15ff21[_0x4fa78b(0x181)];_0x43cf95++){const _0x19213c=a43_0x539574[_0x4fa78b(0x14c)][_0x4fa78b(0x1c0)][_0x4fa78b(0x11c)](a43_0x539574),_0x524898=_0x15ff21[_0x43cf95],_0x359555=_0x10edd1[_0x524898]||_0x19213c;_0x19213c[_0x4fa78b(0x18f)]=a43_0x539574['bind'](a43_0x539574),_0x19213c[_0x4fa78b(0x14a)]=_0x359555['toString'][_0x4fa78b(0x11c)](_0x359555),_0x10edd1[_0x524898]=_0x19213c;}});a43_0x55fe97();import{collection,doc,query,where,orderBy,limit,getDocs,addDoc,getDoc,serverTimestamp,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a43_0x4d8d(){const _0x4b34d9=['isNewRankChange','\x20hours',',\x20treating\x20as\x20new','\x20to\x20','username','error','getElementById','sort','rankAchieved','2423564vWyWgs','500890QKpcsJ','Error\x20sending\x20Discord\x20notification:','fetchRecentPromotions','none','addEventListener','style','appendChild','getRankName','DOMContentLoaded','#C0C0C0','newRank','add','players','\x20(source:\x20','3244251LWEyAj','docs','exception','Unranked','1143319IUGPtW','\x20was\x20demoted\x20to','data','firstChild','lastFetchTime','Fallback\x20write\x20failed:','DISPLAY_HOURS','eloHistory','data-id','\x20<span\x20class=\x22rank-text\x22>','Emerald','console','new-rank-change','Failed\x20to\x20resolve\x20user\x20ID:\x20','parse','promotionHistory','toString','ignore-btn','constructor','div','commit','RANKS','adminUser','toDateString','Silver','checkAndRecordPromotion','10592nDrvOu','name','display','Processing\x20potential\x20rank\x20change:\x20','getItem','dismissing','2unUbCN','Error\x20processing\x20rank\x20change:','processRankChanges','includes','parentNode','isAutomatic','userId','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rank-change-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2\x20class=\x22rank-change-title\x22>','promotions_checked_','string','button','pollingInterval','&times;','userDismissed','(((.+)+)+)+$','innerHTML','showRankChangeBanner','then','resolveUserId','seconds','visible','</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22rank-change-button\x22\x20id=\x22rank-change-ok-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Got\x20it!\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','sendPromotionNotification','shouldShowPromotion','player','apply','A\x20player','Don\x27t\x20show\x20again','setAttribute','You\x27ve\x20been\x20promoted\x20to','true','textContent','body','Unknown\x20Player','4991454yhMZGg','rankChangeModal','resolvedName','#FFD700','Error\x20saving\x20promotion\x20preference:','length','warn','Could\x20not\x20resolve\x20username\x20for\x20userId:','type','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22rank-name\x22>','forEach','target','visibilityState','Error\x20resolving\x20username:','stringify','remove','winnerUsername','rank-change-modal\x20','initialize','__proto__','ladder','className','classList','log','\x20→\x20','data-rank','click','now','\x20was\x20auto-dismissed\x20within\x20last\x204\x20hours','Promotion\x20banner\x20container\x20not\x20found','desc','trace','empty','Congratulations!','showRankChangeLightbox','loserId','Discord\x20notification\x20sent\x20successfully\x20with\x20ID:\x20','banner-actions','783FdnWUc','currentUser','winnerId','admin','5628OnXOPz','demotion','threshold','\x27s\x20','Error\x20writing\x20promotion\x20records:','test','source','Promotion\x20','setItem','toMillis','displayName','</span>','approvedMatches','search','Resolved\x20','promotion','Rank\x20Update','block','previousRank','Invalid\x20storage\x20format\x20for\x20','removeChild','slice','usernameCache','offsetWidth','loserUsername','createElement','prototype','children','timestamp','You\x27ve\x20been\x20demoted\x20to','Error\x20resolving\x20user\x20ID:','Gold','exists','setupBannerContainer','</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>','promotion-banner','fetchInterval','playerUsername','push','Bronze','5859275WrtTId','split','\x20for\x20','#50C878','\x20(loser)','promotion_','date','rank-change-ok-btn','beforeunload','set','ignored','title','visibilitychange','bind','bannerContainer'];a43_0x4d8d=function(){return _0x4b34d9;};return a43_0x4d8d();}import{auth,db}from'./firebase-config.js';class PromotionManager{constructor(){const _0x6b7e7b=a43_0x2749;this[_0x6b7e7b(0x140)]=0x18,this[_0x6b7e7b(0x14f)]=[{'threshold':0x578,'name':_0x6b7e7b(0x10e),'color':'#CD7F32'},{'threshold':0x640,'name':_0x6b7e7b(0x152),'color':_0x6b7e7b(0x131)},{'threshold':0x708,'name':_0x6b7e7b(0x106),'color':_0x6b7e7b(0x17f)},{'threshold':0x834,'name':_0x6b7e7b(0x144),'color':_0x6b7e7b(0x112)}],this[_0x6b7e7b(0x11d)]=null,this[_0x6b7e7b(0x13e)]=0x0,this[_0x6b7e7b(0x10b)]=0xea60,this['pollingInterval']=null,this[_0x6b7e7b(0x1bc)]={};}[a43_0x7f31ea(0x18e)](){const _0x12262c=a43_0x7f31ea;this[_0x12262c(0x11d)]=document['getElementById']('promotion-banner-container');if(!this[_0x12262c(0x11d)]){console[_0x12262c(0x123)](_0x12262c(0x199));return;}this['setupBannerContainer']();const _0xe4d219=_0x12262c(0x162)+new Date()[_0x12262c(0x151)](),_0x56d658=sessionStorage[_0x12262c(0x158)](_0xe4d219);!_0x56d658&&(this['fetchRecentPromotions'](),sessionStorage['setItem'](_0xe4d219,_0x12262c(0x178))),document[_0x12262c(0x12c)](_0x12262c(0x11b),()=>{const _0x364e14=_0x12262c;document[_0x364e14(0x188)]===_0x364e14(0x16e)&&!sessionStorage['getItem'](_0xe4d219)&&(this[_0x364e14(0x12a)](),sessionStorage['setItem'](_0xe4d219,_0x364e14(0x178)));}),window[_0x12262c(0x12c)](_0x12262c(0x117),()=>{const _0x4b10a8=_0x12262c;this[_0x4b10a8(0x165)]&&clearInterval(this[_0x4b10a8(0x165)]);});}[a43_0x7f31ea(0x108)](){const _0x2e71c3=a43_0x7f31ea;this[_0x2e71c3(0x11d)][_0x2e71c3(0x169)]='',this['bannerContainer'][_0x2e71c3(0x12d)]['display']='none';}async[a43_0x7f31ea(0x12a)](){const _0x153725=a43_0x7f31ea;try{const _0x29647f=Date['now']();if(_0x29647f-this[_0x153725(0x13e)]<this[_0x153725(0x10b)])return;this['lastFetchTime']=_0x29647f;const _0x3962bf=collection(db,_0x153725(0x141)),_0x393a20=query(_0x3962bf,where('type','in',[_0x153725(0x1b5),_0x153725(0x1a7)]),orderBy('timestamp',_0x153725(0x19a)),limit(0x14)),_0x3f915c=await getDocs(_0x393a20),_0x1b4498=[];_0x3f915c[_0x153725(0x186)](_0x121b47=>{const _0x4d1df8=_0x153725,_0x482a27={'id':_0x121b47['id'],..._0x121b47[_0x4d1df8(0x13c)]()};this[_0x4d1df8(0x171)](_0x121b47['id'])&&this[_0x4d1df8(0x11e)](_0x482a27)&&_0x1b4498[_0x4d1df8(0x10d)](_0x482a27);}),_0x1b4498[_0x153725(0x181)]>0x0&&await this[_0x153725(0x15c)](_0x1b4498);}catch(_0x16122f){console['error']('Error\x20fetching\x20promotions:',_0x16122f);}}async[a43_0x7f31ea(0x15c)](_0x2767cc){const _0x63509d=a43_0x7f31ea;if(_0x2767cc['length']===0x0)return;_0x2767cc[_0x63509d(0x125)]((_0x1fa44c,_0x243b9a)=>{const _0x55694a=_0x63509d,_0x4f633f=_0x1fa44c[_0x55694a(0x103)]?.[_0x55694a(0x1af)]?.()||_0x1fa44c['timestamp']?.[_0x55694a(0x16d)]*0x3e8||0x0,_0x5c36ab=_0x243b9a[_0x55694a(0x103)]?.[_0x55694a(0x1af)]?.()||_0x243b9a[_0x55694a(0x103)]?.[_0x55694a(0x16d)]*0x3e8||0x0;return _0x5c36ab-_0x4f633f;});const _0x176c44=this[_0x63509d(0x11d)]['children'][_0x63509d(0x181)],_0x49cd00=0x3-_0x176c44;if(_0x49cd00<=0x0)return;const _0xb09bf2=_0x2767cc[_0x63509d(0x1bb)](0x0,_0x49cd00);for(let _0x329a7a=0x0;_0x329a7a<_0xb09bf2[_0x63509d(0x181)];_0x329a7a++){const _0x5b00df=_0xb09bf2[_0x329a7a],_0x27217c=auth['currentUser'];try{setTimeout(()=>{const _0x388751=_0x63509d;this[_0x388751(0x16a)](_0x5b00df);},_0x329a7a*0x3e8),_0x27217c&&_0x5b00df[_0x63509d(0x172)]===_0x27217c[_0x63509d(0x1b0)]&&this['showRankChangeLightbox'](_0x5b00df['type'],_0x5b00df[_0x63509d(0x126)]);}catch(_0x53028d){console[_0x63509d(0x123)](_0x63509d(0x15b),_0x53028d);}}}[a43_0x7f31ea(0x171)](_0x2fc97a){const _0x17f725=a43_0x7f31ea;try{const _0x583007=_0x17f725(0x114)+_0x2fc97a,_0x1a8eef=localStorage[_0x17f725(0x158)](_0x583007);if(_0x1a8eef){let _0x2dacfc;try{_0x2dacfc=JSON[_0x17f725(0x148)](_0x1a8eef);}catch(_0x19774e){return console[_0x17f725(0x182)](_0x17f725(0x1b9)+_0x583007+_0x17f725(0x120)),!![];}if(_0x2dacfc[_0x17f725(0x119)]===!![])return console[_0x17f725(0x193)](_0x17f725(0x1ad)+_0x2fc97a+'\x20is\x20permanently\x20ignored'),![];const _0x149dec=Date[_0x17f725(0x197)]();if(_0x2dacfc[_0x17f725(0x167)]&&_0x149dec-_0x2dacfc[_0x17f725(0x103)]<this[_0x17f725(0x140)]*0x3c*0x3c*0x3e8)return console['log']('Promotion\x20'+_0x2fc97a+'\x20was\x20dismissed\x20by\x20user\x20within\x20last\x20'+this['DISPLAY_HOURS']+_0x17f725(0x11f)),![];if(_0x2dacfc['systemDismissed']&&_0x149dec-_0x2dacfc[_0x17f725(0x103)]<0x4*0x3c*0x3c*0x3e8)return console[_0x17f725(0x193)](_0x17f725(0x1ad)+_0x2fc97a+_0x17f725(0x198)),![];}return!![];}catch(_0x6be4c7){return console[_0x17f725(0x123)]('Error\x20checking\x20promotion\x20visibility:',_0x6be4c7),![];}}['ignorePromotion'](_0x2d5c4c){const _0x31e049=a43_0x7f31ea;try{const _0x4ecbe0=_0x31e049(0x114)+_0x2d5c4c;localStorage[_0x31e049(0x1ae)](_0x4ecbe0,JSON[_0x31e049(0x18a)]({'timestamp':Date[_0x31e049(0x197)](),'ignored':!![]}));}catch(_0x2b47cd){console[_0x31e049(0x123)](_0x31e049(0x180),_0x2b47cd);}}[a43_0x7f31ea(0x16a)](_0x5d9f8b){const _0x4f84f7=a43_0x7f31ea;this[_0x4f84f7(0x16c)](_0x5d9f8b)[_0x4f84f7(0x16b)](_0x59e23e=>{const _0x46e287=_0x4f84f7,_0x7252f=_0x46e287(0x114)+_0x5d9f8b['id'],_0x52ee87=localStorage[_0x46e287(0x158)](_0x7252f);if(_0x52ee87)try{const _0x434b35=JSON['parse'](_0x52ee87);if(_0x434b35[_0x46e287(0x119)]===!![]){console[_0x46e287(0x193)]('Skipping\x20ignored\x20promotion:\x20'+_0x5d9f8b['id']);return;}}catch(_0x5949d4){}localStorage[_0x46e287(0x1ae)](_0x7252f,JSON[_0x46e287(0x18a)]({'timestamp':Date[_0x46e287(0x197)](),'ignored':![],'userDismissed':![],'systemDismissed':![],'seenAt':Date[_0x46e287(0x197)]()})),this[_0x46e287(0x11d)]['style']['display']=_0x46e287(0x1b7);while(this['bannerContainer'][_0x46e287(0x102)][_0x46e287(0x181)]>=0x3){this[_0x46e287(0x11d)][_0x46e287(0x1ba)](this[_0x46e287(0x11d)][_0x46e287(0x13d)]);}const _0x1b14b4=document[_0x46e287(0x1bf)]('div');_0x1b14b4['className']=_0x46e287(0x10a),_0x1b14b4['setAttribute'](_0x46e287(0x195),_0x59e23e[_0x46e287(0x126)]),_0x1b14b4[_0x46e287(0x176)](_0x46e287(0x142),_0x59e23e['id']);const _0x5d36af=document[_0x46e287(0x1bf)](_0x46e287(0x14d));_0x5d36af[_0x46e287(0x191)]='promotion-details';const _0xcb156f=_0x59e23e[_0x46e287(0x17e)]||_0x59e23e[_0x46e287(0x172)]||_0x59e23e[_0x46e287(0x122)]||_0x59e23e[_0x46e287(0x10c)]||_0x59e23e[_0x46e287(0x1b0)]||_0x46e287(0x174),_0x500bbe=_0x59e23e[_0x46e287(0x184)]==='promotion'?_0xcb156f+'\x20was\x20promoted\x20to':_0xcb156f+_0x46e287(0x13b);_0x5d36af[_0x46e287(0x169)]=_0x500bbe+_0x46e287(0x143)+_0x59e23e['rankAchieved']+_0x46e287(0x1b1);const _0x50b7b0=document['createElement'](_0x46e287(0x14d));_0x50b7b0[_0x46e287(0x191)]=_0x46e287(0x1a1);const _0x182b25=document[_0x46e287(0x1bf)](_0x46e287(0x164));_0x182b25['className']='dismiss-btn',_0x182b25[_0x46e287(0x169)]=_0x46e287(0x166),_0x182b25[_0x46e287(0x11a)]='Dismiss';const _0x4caa50=document[_0x46e287(0x1bf)](_0x46e287(0x164));_0x4caa50[_0x46e287(0x191)]=_0x46e287(0x14b),_0x4caa50[_0x46e287(0x179)]=_0x46e287(0x175),_0x4caa50[_0x46e287(0x11a)]='Never\x20show\x20this\x20promotion\x20again',_0x50b7b0[_0x46e287(0x12e)](_0x4caa50),_0x50b7b0[_0x46e287(0x12e)](_0x182b25),_0x1b14b4[_0x46e287(0x12e)](_0x5d36af),_0x1b14b4[_0x46e287(0x12e)](_0x50b7b0),this[_0x46e287(0x11d)][_0x46e287(0x12e)](_0x1b14b4),void _0x1b14b4[_0x46e287(0x1bd)],setTimeout(()=>{const _0x646b5=_0x46e287;_0x1b14b4[_0x646b5(0x192)][_0x646b5(0x133)](_0x646b5(0x146));},0x32),_0x182b25[_0x46e287(0x12c)]('click',()=>{const _0x367c58=_0x46e287;localStorage['setItem'](_0x7252f,JSON['stringify']({'timestamp':Date[_0x367c58(0x197)](),'ignored':![],'userDismissed':!![],'systemDismissed':![]})),_0x1b14b4['classList'][_0x367c58(0x18b)](_0x367c58(0x146)),_0x1b14b4[_0x367c58(0x192)]['add'](_0x367c58(0x159)),setTimeout(()=>{const _0x24193d=_0x367c58;_0x1b14b4['parentNode']&&(_0x1b14b4[_0x24193d(0x18b)](),this[_0x24193d(0x11d)][_0x24193d(0x102)]['length']===0x0&&(this[_0x24193d(0x11d)]['style'][_0x24193d(0x156)]=_0x24193d(0x12b)));},0x1f4);}),_0x4caa50[_0x46e287(0x12c)](_0x46e287(0x196),()=>{const _0xf6fe2=_0x46e287;localStorage[_0xf6fe2(0x1ae)](_0x7252f,JSON[_0xf6fe2(0x18a)]({'timestamp':Date[_0xf6fe2(0x197)](),'ignored':!![],'userDismissed':!![],'systemDismissed':![]})),_0x1b14b4[_0xf6fe2(0x192)]['remove'](_0xf6fe2(0x146)),_0x1b14b4[_0xf6fe2(0x192)]['add'](_0xf6fe2(0x159)),setTimeout(()=>{const _0x4c10b6=_0xf6fe2;_0x1b14b4['parentNode']&&(_0x1b14b4[_0x4c10b6(0x18b)](),this[_0x4c10b6(0x11d)]['children'][_0x4c10b6(0x181)]===0x0&&(this[_0x4c10b6(0x11d)]['style']['display']=_0x4c10b6(0x12b)));},0x1f4);}),setTimeout(()=>{const _0x881cf8=_0x46e287;_0x1b14b4['parentNode']&&(_0x1b14b4[_0x881cf8(0x192)][_0x881cf8(0x18b)](_0x881cf8(0x146)),_0x1b14b4[_0x881cf8(0x192)][_0x881cf8(0x133)](_0x881cf8(0x159)),localStorage[_0x881cf8(0x1ae)](_0x7252f,JSON[_0x881cf8(0x18a)]({'timestamp':Date[_0x881cf8(0x197)](),'ignored':![],'userDismissed':![],'systemDismissed':!![]})),setTimeout(()=>{const _0x42a1f0=_0x881cf8;_0x1b14b4[_0x42a1f0(0x15e)]&&(_0x1b14b4['remove'](),this[_0x42a1f0(0x11d)][_0x42a1f0(0x102)]['length']===0x0&&(this[_0x42a1f0(0x11d)][_0x42a1f0(0x12d)][_0x42a1f0(0x156)]='none'));},0x1f4));},0x3a98);});}async[a43_0x7f31ea(0x16c)](_0x3ab6f5){const _0x1ce73a=a43_0x7f31ea,_0x18bb94={..._0x3ab6f5},_0x5254f7=[_0x3ab6f5['player'],_0x3ab6f5[_0x1ce73a(0x122)],_0x3ab6f5['playerUsername'],_0x3ab6f5['displayName']],_0x2b541f=_0x5254f7['some'](_0x3c5dd5=>_0x3c5dd5&&typeof _0x3c5dd5===_0x1ce73a(0x163)&&!_0x3c5dd5[_0x1ce73a(0x15d)]('ID:')&&!/^[a-zA-Z0-9]{20,}$/[_0x1ce73a(0x1ab)](_0x3c5dd5));if(_0x2b541f)return _0x18bb94;let _0x2bb331=null;if(_0x3ab6f5['userId'])_0x2bb331=_0x3ab6f5[_0x1ce73a(0x160)];else _0x3ab6f5[_0x1ce73a(0x172)]&&/^[A-Za-z0-9]{20,}$/[_0x1ce73a(0x1ab)](_0x3ab6f5[_0x1ce73a(0x172)])&&(_0x2bb331=_0x3ab6f5['player']);if(!_0x2bb331)return _0x18bb94;try{const _0x13073f=await getDoc(doc(db,_0x1ce73a(0x134),_0x2bb331));if(_0x13073f['exists']()){const _0x53501b=_0x13073f[_0x1ce73a(0x13c)]();if(_0x53501b[_0x1ce73a(0x122)])return _0x18bb94['resolvedName']=_0x53501b[_0x1ce73a(0x122)],_0x18bb94;}const _0x49f7b1=await getDocs(query(collection(db,_0x1ce73a(0x1b2)),where(_0x1ce73a(0x1a4),'==',_0x2bb331),orderBy('date',_0x1ce73a(0x19a)),limit(0x1)));if(!_0x49f7b1['empty']){const _0x4874ca=_0x49f7b1['docs'][0x0][_0x1ce73a(0x13c)]();if(_0x4874ca[_0x1ce73a(0x18c)])return _0x18bb94[_0x1ce73a(0x17e)]=_0x4874ca[_0x1ce73a(0x18c)],_0x18bb94;}const _0x2e0a6e=await getDocs(query(collection(db,_0x1ce73a(0x1b2)),where(_0x1ce73a(0x19f),'==',_0x2bb331),orderBy(_0x1ce73a(0x115),_0x1ce73a(0x19a)),limit(0x1)));if(!_0x2e0a6e['empty']){const _0x27228f=_0x2e0a6e[_0x1ce73a(0x137)][0x0][_0x1ce73a(0x13c)]();if(_0x27228f[_0x1ce73a(0x1be)])return _0x18bb94[_0x1ce73a(0x17e)]=_0x27228f[_0x1ce73a(0x1be)],console[_0x1ce73a(0x193)](_0x1ce73a(0x1b4)+_0x2bb331+_0x1ce73a(0x121)+_0x27228f['loserUsername']+_0x1ce73a(0x113)),_0x18bb94;}}catch(_0x10b01d){console[_0x1ce73a(0x123)](_0x1ce73a(0x105),_0x10b01d);}return console[_0x1ce73a(0x182)](_0x1ce73a(0x147)+_0x2bb331),_0x18bb94;}[a43_0x7f31ea(0x19e)](_0x128d45,_0x5e4bbf){const _0x5b090c=a43_0x7f31ea;let _0x1f3582=document[_0x5b090c(0x124)](_0x5b090c(0x17d));!_0x1f3582&&(_0x1f3582=document[_0x5b090c(0x1bf)](_0x5b090c(0x14d)),_0x1f3582['id']=_0x5b090c(0x17d),_0x1f3582[_0x5b090c(0x191)]=_0x5b090c(0x18d)+_0x128d45,document[_0x5b090c(0x17a)]['appendChild'](_0x1f3582));const _0xdf4a42=_0x128d45===_0x5b090c(0x1b5)?_0x5b090c(0x19d):_0x5b090c(0x1b6),_0x1e62ee=_0x128d45===_0x5b090c(0x1b5)?_0x5b090c(0x177):_0x5b090c(0x104);_0x1f3582[_0x5b090c(0x169)]=_0x5b090c(0x161)+_0xdf4a42+_0x5b090c(0x109)+_0x1e62ee+_0x5b090c(0x185)+_0x5e4bbf+_0x5b090c(0x16f),_0x1f3582[_0x5b090c(0x12d)]['display']='flex',document['getElementById'](_0x5b090c(0x116))['addEventListener'](_0x5b090c(0x196),()=>{const _0x43b52c=_0x5b090c;_0x1f3582[_0x43b52c(0x12d)][_0x43b52c(0x156)]=_0x43b52c(0x12b);}),_0x1f3582[_0x5b090c(0x12c)](_0x5b090c(0x196),_0x511638=>{const _0x511886=_0x5b090c;_0x511638[_0x511886(0x187)]===_0x1f3582&&(_0x1f3582[_0x511886(0x12d)]['display']=_0x511886(0x12b));});}async[a43_0x7f31ea(0x153)](_0x4883ad,_0x2a34a7,_0x50893b,_0x2b678e={}){const _0x349d4a=a43_0x7f31ea;try{if(_0x2a34a7===_0x50893b||!_0x4883ad)return null;const _0x3a8e3d=_0x2b678e[_0x349d4a(0x1ac)]||'automatic',_0x9bd14b=_0x2b678e['matchId']||null,_0x45dfe7=_0x2b678e[_0x349d4a(0x150)]||null;console[_0x349d4a(0x193)](_0x349d4a(0x157)+_0x50893b+_0x349d4a(0x194)+_0x2a34a7+_0x349d4a(0x135)+_0x3a8e3d+')');let _0x4e4be4=null,_0x3fbbbe=null;try{const _0xd725d5=await getDoc(doc(db,_0x349d4a(0x134),_0x4883ad));if(_0xd725d5[_0x349d4a(0x107)]()){const _0x7fe4db=_0xd725d5[_0x349d4a(0x13c)]();_0x4e4be4=_0x7fe4db[_0x349d4a(0x122)]||_0x7fe4db[_0x349d4a(0x1b0)]||null,_0x3fbbbe=_0x7fe4db[_0x349d4a(0x1b0)]||_0x7fe4db[_0x349d4a(0x122)]||null;}!_0x4e4be4&&_0x2b678e['username']&&(_0x4e4be4=_0x2b678e['username'],_0x3fbbbe=_0x2b678e[_0x349d4a(0x122)]);!_0x4e4be4&&auth[_0x349d4a(0x1a3)]&&(_0x4e4be4=auth[_0x349d4a(0x1a3)][_0x349d4a(0x1b0)]||auth[_0x349d4a(0x1a3)]['email'][_0x349d4a(0x110)]('@')[0x0],_0x3fbbbe=auth[_0x349d4a(0x1a3)][_0x349d4a(0x1b0)]||null);if(!_0x4e4be4){const _0x40e571=query(collection(db,'approvedMatches'),where('winnerId','==',_0x4883ad),limit(0x1)),_0x407626=await getDocs(_0x40e571);if(!_0x407626['empty'])_0x4e4be4=_0x407626[_0x349d4a(0x137)][0x0][_0x349d4a(0x13c)]()[_0x349d4a(0x18c)]||_0x349d4a(0x17b),_0x3fbbbe=_0x4e4be4;else{const _0x28a30b=query(collection(db,'approvedMatches'),where('loserId','==',_0x4883ad),limit(0x1)),_0x41dcb9=await getDocs(_0x28a30b);!_0x41dcb9[_0x349d4a(0x19c)]&&(_0x4e4be4=_0x41dcb9[0x0][_0x349d4a(0x13c)]()[_0x349d4a(0x1be)]||_0x349d4a(0x17b),_0x3fbbbe=_0x4e4be4);}}}catch(_0x50594b){console[_0x349d4a(0x123)](_0x349d4a(0x189),_0x50594b);}!_0x4e4be4&&(console['warn'](_0x349d4a(0x183),_0x4883ad),_0x4e4be4=_0x349d4a(0x174),_0x3fbbbe=_0x349d4a(0x17b));const _0x5ac14d=this[_0x349d4a(0x12f)](_0x50893b),_0x2f8298=this[_0x349d4a(0x12f)](_0x2a34a7);if(_0x5ac14d!==_0x2f8298){const _0x44c2c9=_0x2a34a7>_0x50893b,_0x65cf02=_0x44c2c9?'promotion':_0x349d4a(0x1a7),_0x1b7998=_0x2f8298;console['log']('Recording\x20'+_0x65cf02+_0x349d4a(0x111)+_0x4e4be4+':\x20'+_0x50893b+'\x20('+_0x5ac14d+')\x20→\x20'+_0x2a34a7+'\x20('+_0x2f8298+')');try{const _0xfff018={'player':_0x4e4be4,'playerUsername':_0x4e4be4,'username':_0x4e4be4,'displayName':_0x3fbbbe,'userId':_0x4883ad,'type':_0x65cf02,'rankAchieved':_0x1b7998,'timestamp':serverTimestamp(),'previousElo':_0x50893b,'newElo':_0x2a34a7,'change':_0x2a34a7-_0x50893b,'previousRank':_0x5ac14d,'newRank':_0x2f8298,'source':_0x3a8e3d};if(_0x3a8e3d==='match'&&_0x9bd14b)_0xfff018['matchId']=_0x9bd14b;else _0x3a8e3d===_0x349d4a(0x1a5)&&_0x45dfe7?(_0xfff018['modifiedBy']=_0x45dfe7,_0xfff018['isAutomatic']=![]):_0xfff018[_0x349d4a(0x15f)]=!![];const _0x4bb0ac=writeBatch(db),_0x14a40f=doc(collection(db,_0x349d4a(0x141))),_0x42be21=doc(collection(db,_0x349d4a(0x149)));return _0x4bb0ac[_0x349d4a(0x118)](_0x14a40f,_0xfff018),_0x4bb0ac[_0x349d4a(0x118)](_0x42be21,_0xfff018),await _0x4bb0ac[_0x349d4a(0x14e)](),await this[_0x349d4a(0x170)](_0x4883ad,_0x4e4be4,_0x50893b,_0x2a34a7,_0x5ac14d,_0x2f8298,_0x65cf02,{'displayName':_0x3fbbbe,'source':_0x3a8e3d,'matchId':_0x9bd14b,'ladder':_0x2b678e['ladder']||'D1'}),console[_0x349d4a(0x193)]('Successfully\x20recorded\x20'+_0x65cf02+_0x349d4a(0x111)+_0x4e4be4+_0x349d4a(0x121)+_0x1b7998),_0x1b7998;}catch(_0x5ce36e){console[_0x349d4a(0x123)](_0x349d4a(0x1aa),_0x5ce36e);try{return await addDoc(collection(db,_0x349d4a(0x141)),{'player':_0x4e4be4,'playerUsername':_0x4e4be4,'username':_0x4e4be4,'displayName':_0x3fbbbe,'userId':_0x4883ad,'type':_0x65cf02,'rankAchieved':_0x1b7998,'timestamp':serverTimestamp(),'previousElo':_0x50893b,'newElo':_0x2a34a7,'change':_0x2a34a7-_0x50893b,'previousRank':_0x5ac14d,'source':_0x3a8e3d,'isAutomatic':_0x3a8e3d!=='admin'}),await this[_0x349d4a(0x170)](_0x4883ad,_0x4e4be4,_0x50893b,_0x2a34a7,_0x5ac14d,_0x2f8298,_0x65cf02,{'displayName':_0x3fbbbe,'source':_0x3a8e3d,'matchId':_0x9bd14b,'ladder':_0x2b678e[_0x349d4a(0x190)]||'D1'}),_0x1b7998;}catch(_0x5af074){return console['error'](_0x349d4a(0x13f),_0x5af074),null;}}}return null;}catch(_0x1bc1c5){return console[_0x349d4a(0x123)]('Error\x20in\x20promotion/demotion\x20recording:',_0x1bc1c5),null;}}[a43_0x7f31ea(0x12f)](_0x15553f){const _0x503d85=a43_0x7f31ea;for(let _0x184257=this[_0x503d85(0x14f)][_0x503d85(0x181)]-0x1;_0x184257>=0x0;_0x184257--){if(_0x15553f>=this['RANKS'][_0x184257][_0x503d85(0x1a8)])return this[_0x503d85(0x14f)][_0x184257][_0x503d85(0x155)];}return _0x503d85(0x139);}['cleanup'](){const _0x569ca8=a43_0x7f31ea;this[_0x569ca8(0x165)]&&clearInterval(this['pollingInterval']);}[a43_0x7f31ea(0x11e)](_0x62d162){const _0x23d7a5=a43_0x7f31ea;if(_0x62d162[_0x23d7a5(0x103)]){const _0x45f8d2=_0x62d162[_0x23d7a5(0x103)][_0x23d7a5(0x16d)]*0x3e8,_0x4bf180=Date[_0x23d7a5(0x197)](),_0x179cac=(_0x4bf180-_0x45f8d2)/(0x3e8*0x3c*0x3c);if(_0x179cac>0x18)return![];}if(_0x62d162[_0x23d7a5(0x1b8)]&&_0x62d162[_0x23d7a5(0x132)]&&_0x62d162[_0x23d7a5(0x1b8)]!==_0x62d162[_0x23d7a5(0x132)])return!![];return![];}async['sendPromotionNotification'](_0x238365,_0x234aa7,_0x2db67c,_0x16a0a2,_0x468b05,_0x2e57cd,_0x37c052,_0x39ca0f={}){const _0x354288=a43_0x7f31ea;try{console[_0x354288(0x193)]('STARTING\x20notification\x20for\x20'+_0x234aa7+_0x354288(0x1a9)+_0x37c052);const _0xd05bb2={'userId':_0x238365,'username':_0x234aa7,'displayName':_0x39ca0f['displayName']||_0x234aa7,'oldElo':parseInt(_0x2db67c),'newElo':parseInt(_0x16a0a2),'eloDifference':parseInt(_0x16a0a2)-parseInt(_0x2db67c),'oldRank':_0x468b05,'newRank':_0x2e57cd,'type':_0x37c052,'timestamp':serverTimestamp(),'processed':![],'source':_0x39ca0f[_0x354288(0x1ac)]||'automatic','matchId':_0x39ca0f['matchId']||null,'ladder':_0x39ca0f[_0x354288(0x190)]||'D1','adminUser':_0x39ca0f['adminUser']||null};console[_0x354288(0x193)]('Creating\x20Discord\x20notification:',_0xd05bb2);const _0x3d267a=await addDoc(collection(db,'promotionNotifications'),_0xd05bb2);return console['log'](_0x354288(0x1a0)+_0x3d267a['id']),!![];}catch(_0x14dfc3){return console[_0x354288(0x123)](_0x354288(0x129),_0x14dfc3),![];}}}export const promotionManager=new PromotionManager();document[a43_0x7f31ea(0x12c)](a43_0x7f31ea(0x130),()=>{promotionManager['initialize']();});export const initializePromotionTracker=()=>promotionManager[a43_0x7f31ea(0x18e)]();function a43_0x2749(_0x44cc3e,_0x14fdf8){const _0x2ad292=a43_0x4d8d();return a43_0x2749=function(_0x55fe97,_0x539574){_0x55fe97=_0x55fe97-0x102;let _0x299e20=_0x2ad292[_0x55fe97];return _0x299e20;},a43_0x2749(_0x44cc3e,_0x14fdf8);}export const checkAndRecordPromotion=(_0x4d3261,_0x35749f,_0x25ba5d,_0x2f9eb5)=>promotionManager[a43_0x7f31ea(0x153)](_0x4d3261,_0x35749f,_0x25ba5d,_0x2f9eb5);export const getRankName=_0x45825d=>promotionManager[a43_0x7f31ea(0x12f)](_0x45825d);
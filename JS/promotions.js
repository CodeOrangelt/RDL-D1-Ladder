const a44_0x85cb66=a44_0x7352,a44_0x5f58c8=(function(){let _0x11e98c=!![];return function(_0x1b9fbe,_0x118739){const _0x4054a2=_0x11e98c?function(){if(_0x118739){const _0x3f2847=_0x118739['apply'](_0x1b9fbe,arguments);return _0x118739=null,_0x3f2847;}}:function(){};return _0x11e98c=![],_0x4054a2;};}()),a44_0x3dc67b=a44_0x5f58c8(this,function(){const _0x3360c7=a44_0x7352;let _0xd440;try{const _0x3e628d=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0xd440=_0x3e628d();}catch(_0x3e90c5){_0xd440=window;}const _0x3ec404=_0xd440[_0x3360c7(0x113)]=_0xd440['console']||{},_0x13cc8a=['log',_0x3360c7(0x12e),'info','error','exception',_0x3360c7(0x12f),'trace'];for(let _0x459e3e=0x0;_0x459e3e<_0x13cc8a['length'];_0x459e3e++){const _0x4702fd=a44_0x5f58c8['constructor']['prototype'][_0x3360c7(0x100)](a44_0x5f58c8),_0x3ea44a=_0x13cc8a[_0x459e3e],_0x19e428=_0x3ec404[_0x3ea44a]||_0x4702fd;_0x4702fd['__proto__']=a44_0x5f58c8['bind'](a44_0x5f58c8),_0x4702fd['toString']=_0x19e428['toString']['bind'](_0x19e428),_0x3ec404[_0x3ea44a]=_0x4702fd;}});a44_0x3dc67b();import{collection,doc,query,where,orderBy,limit,getDocs,addDoc,getDoc,serverTimestamp,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{auth,db}from'./firebase-config.js';function a44_0xb81b(){const _0x1b4bc8=['timestamp','new-rank-change','then','promotion','setItem','\x20for\x20','processRankChanges','showRankChangeLightbox','previousRank','resolveUserId','fetchRecentPromotions','appendChild','toMillis','children','Dismiss','cleanup','pollingInterval','none','showRankChangeBanner','some','player','offsetWidth','fetchInterval','bind','\x20to\x20','length','Emerald','ignored','promotions_checked_','parse','lastFetchTime','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22rank-name\x22>','getRankName','You\x27ve\x20been\x20promoted\x20to','Promotion\x20banner\x20container\x20not\x20found','date','data','title','removeChild','true','click','approvedMatches','console','remove','classList','eloHistory','display','log','admin','createElement','innerHTML','getItem','Processing\x20potential\x20rank\x20change:\x20','promotion-banner-container','ladder','sendPromotionNotification','Fallback\x20write\x20failed:','button','automatic','className','Bronze','matchId','now','isAutomatic','bannerContainer','type','Promotion\x20','body','style','warn','table','currentUser','visible','playerUsername','DISPLAY_HOURS','getElementById','desc','name','error','rank-change-modal\x20','loserUsername','parentNode','resolvedName','displayName','RANKS','#CD7F32','add','userId','firstChild','username','addEventListener','email','promotion-details'];a44_0xb81b=function(){return _0x1b4bc8;};return a44_0xb81b();}class PromotionManager{constructor(){const _0x220772=a44_0x7352;this['DISPLAY_HOURS']=0x18,this[_0x220772(0x13d)]=[{'threshold':0x578,'name':_0x220772(0x125),'color':_0x220772(0x13e)},{'threshold':0x640,'name':'Silver','color':'#C0C0C0'},{'threshold':0x708,'name':'Gold','color':'#FFD700'},{'threshold':0x834,'name':_0x220772(0x103),'color':'#50C878'}],this['bannerContainer']=null,this['lastFetchTime']=0x0,this[_0x220772(0xff)]=0xea60,this['pollingInterval']=null,this['usernameCache']={};}['initialize'](){const _0x3dab52=a44_0x7352;this['bannerContainer']=document['getElementById'](_0x3dab52(0x11e));if(!this['bannerContainer']){console['error'](_0x3dab52(0x10b));return;}this['setupBannerContainer']();const _0xd3d710=_0x3dab52(0x105)+new Date()['toDateString'](),_0x2b3f3d=sessionStorage[_0x3dab52(0x11c)](_0xd3d710);!_0x2b3f3d&&(this[_0x3dab52(0xf3)](),sessionStorage['setItem'](_0xd3d710,'true')),document[_0x3dab52(0x143)]('visibilitychange',()=>{const _0x357bc6=_0x3dab52;document['visibilityState']===_0x357bc6(0x131)&&!sessionStorage['getItem'](_0xd3d710)&&(this['fetchRecentPromotions'](),sessionStorage[_0x357bc6(0xed)](_0xd3d710,_0x357bc6(0x110)));}),window[_0x3dab52(0x143)]('beforeunload',()=>{const _0xf819c2=_0x3dab52;this[_0xf819c2(0xf9)]&&clearInterval(this['pollingInterval']);});}['setupBannerContainer'](){const _0x36d2a0=a44_0x7352;this['bannerContainer']['innerHTML']='',this['bannerContainer']['style'][_0x36d2a0(0x117)]='none';}async['fetchRecentPromotions'](){const _0x31c27e=a44_0x7352;try{const _0x312438=Date[_0x31c27e(0x127)]();if(_0x312438-this[_0x31c27e(0x107)]<this['fetchInterval'])return;this['lastFetchTime']=_0x312438;const _0x135f39=collection(db,_0x31c27e(0x116)),_0x190103=query(_0x135f39,where(_0x31c27e(0x12a),'in',['promotion','demotion']),orderBy(_0x31c27e(0xe9),_0x31c27e(0x135)),limit(0x14)),_0x45dac5=await getDocs(_0x190103),_0x4506b9=[];_0x45dac5['forEach'](_0x3d98d6=>{const _0x183be8=_0x31c27e,_0x10af0b={'id':_0x3d98d6['id'],..._0x3d98d6[_0x183be8(0x10d)]()};this['shouldShowPromotion'](_0x3d98d6['id'])&&this['isNewRankChange'](_0x10af0b)&&_0x4506b9['push'](_0x10af0b);}),_0x4506b9['length']>0x0&&await this[_0x31c27e(0xef)](_0x4506b9);}catch(_0x25c9fe){console['error']('Error\x20fetching\x20promotions:',_0x25c9fe);}}async['processRankChanges'](_0x141164){const _0x4864fc=a44_0x7352;if(_0x141164['length']===0x0)return;_0x141164['sort']((_0x22c339,_0xa59dad)=>{const _0x54f2f8=a44_0x7352,_0x285e04=_0x22c339['timestamp']?.['toMillis']?.()||_0x22c339['timestamp']?.['seconds']*0x3e8||0x0,_0x1cefb2=_0xa59dad['timestamp']?.[_0x54f2f8(0xf5)]?.()||_0xa59dad['timestamp']?.['seconds']*0x3e8||0x0;return _0x1cefb2-_0x285e04;});const _0x3e0ce2=this[_0x4864fc(0x129)]['children']['length'],_0x36c26f=0x3-_0x3e0ce2;if(_0x36c26f<=0x0)return;const _0x456711=_0x141164['slice'](0x0,_0x36c26f);for(let _0x51f8b2=0x0;_0x51f8b2<_0x456711['length'];_0x51f8b2++){const _0xe5e7dd=_0x456711[_0x51f8b2],_0x253eaa=auth['currentUser'];try{setTimeout(()=>{this['showRankChangeBanner'](_0xe5e7dd);},_0x51f8b2*0x3e8),_0x253eaa&&_0xe5e7dd['player']===_0x253eaa['displayName']&&this[_0x4864fc(0xf0)](_0xe5e7dd['type'],_0xe5e7dd['rankAchieved']);}catch(_0x2e9149){console['error']('Error\x20processing\x20rank\x20change:',_0x2e9149);}}}['shouldShowPromotion'](_0x23da2e){const _0x2bf2c9=a44_0x7352;try{const _0x1bf6da='promotion_'+_0x23da2e,_0x266fa4=localStorage['getItem'](_0x1bf6da);if(_0x266fa4){let _0x5b37c7;try{_0x5b37c7=JSON['parse'](_0x266fa4);}catch(_0x325442){return console[_0x2bf2c9(0x12e)]('Invalid\x20storage\x20format\x20for\x20'+_0x1bf6da+',\x20treating\x20as\x20new'),!![];}if(_0x5b37c7['ignored']===!![])return console[_0x2bf2c9(0x118)]('Promotion\x20'+_0x23da2e+'\x20is\x20permanently\x20ignored'),![];const _0x1dd73a=Date['now']();if(_0x5b37c7['userDismissed']&&_0x1dd73a-_0x5b37c7['timestamp']<this[_0x2bf2c9(0x133)]*0x3c*0x3c*0x3e8)return console['log'](_0x2bf2c9(0x12b)+_0x23da2e+'\x20was\x20dismissed\x20by\x20user\x20within\x20last\x20'+this['DISPLAY_HOURS']+'\x20hours'),![];if(_0x5b37c7['systemDismissed']&&_0x1dd73a-_0x5b37c7[_0x2bf2c9(0xe9)]<0x4*0x3c*0x3c*0x3e8)return console['log']('Promotion\x20'+_0x23da2e+'\x20was\x20auto-dismissed\x20within\x20last\x204\x20hours'),![];}return!![];}catch(_0x1f349c){return console['error']('Error\x20checking\x20promotion\x20visibility:',_0x1f349c),![];}}['ignorePromotion'](_0x26edbb){const _0x884370=a44_0x7352;try{const _0x546540='promotion_'+_0x26edbb;localStorage['setItem'](_0x546540,JSON['stringify']({'timestamp':Date[_0x884370(0x127)](),'ignored':!![]}));}catch(_0x3cabec){console['error']('Error\x20saving\x20promotion\x20preference:',_0x3cabec);}}[a44_0x85cb66(0xfb)](_0x18be38){const _0xce2571=a44_0x85cb66;this[_0xce2571(0xf2)](_0x18be38)[_0xce2571(0xeb)](_0x1eef7c=>{const _0x31aee5=_0xce2571,_0x397c8c='promotion_'+_0x18be38['id'],_0x5ae5ce=localStorage['getItem'](_0x397c8c);if(_0x5ae5ce)try{const _0x19942f=JSON[_0x31aee5(0x106)](_0x5ae5ce);if(_0x19942f[_0x31aee5(0x104)]===!![]){console['log']('Skipping\x20ignored\x20promotion:\x20'+_0x18be38['id']);return;}}catch(_0x4d4fc2){}localStorage[_0x31aee5(0xed)](_0x397c8c,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':![],'seenAt':Date['now']()})),this[_0x31aee5(0x129)]['style'][_0x31aee5(0x117)]='block';while(this['bannerContainer']['children'][_0x31aee5(0x102)]>=0x3){this['bannerContainer'][_0x31aee5(0x10f)](this['bannerContainer'][_0x31aee5(0x141)]);}const _0x1be11c=document['createElement']('div');_0x1be11c['className']='promotion-banner',_0x1be11c['setAttribute']('data-rank',_0x1eef7c['rankAchieved']),_0x1be11c['setAttribute']('data-id',_0x1eef7c['id']);const _0x124cda=document[_0x31aee5(0x11a)]('div');_0x124cda['className']=_0x31aee5(0x145);const _0x228c67=_0x1eef7c[_0x31aee5(0x13b)]||_0x1eef7c[_0x31aee5(0xfd)]||_0x1eef7c[_0x31aee5(0x142)]||_0x1eef7c[_0x31aee5(0x132)]||_0x1eef7c['displayName']||'A\x20player',_0x3fb611=_0x1eef7c['type']===_0x31aee5(0xec)?_0x228c67+'\x20was\x20promoted\x20to':_0x228c67+'\x20was\x20demoted\x20to';_0x124cda['innerHTML']=_0x3fb611+'\x20<span\x20class=\x22rank-text\x22>'+_0x1eef7c['rankAchieved']+'</span>';const _0x1ecff7=document['createElement']('div');_0x1ecff7['className']='banner-actions';const _0x14974e=document['createElement'](_0x31aee5(0x122));_0x14974e[_0x31aee5(0x124)]='dismiss-btn',_0x14974e['innerHTML']='&times;',_0x14974e[_0x31aee5(0x10e)]=_0x31aee5(0xf7);const _0x598df1=document['createElement'](_0x31aee5(0x122));_0x598df1['className']='ignore-btn',_0x598df1['textContent']='Don\x27t\x20show\x20again',_0x598df1['title']='Never\x20show\x20this\x20promotion\x20again',_0x1ecff7[_0x31aee5(0xf4)](_0x598df1),_0x1ecff7['appendChild'](_0x14974e),_0x1be11c['appendChild'](_0x124cda),_0x1be11c[_0x31aee5(0xf4)](_0x1ecff7),this['bannerContainer'][_0x31aee5(0xf4)](_0x1be11c),void _0x1be11c[_0x31aee5(0xfe)],setTimeout(()=>{_0x1be11c['classList']['add']('new-rank-change');},0x32),_0x14974e[_0x31aee5(0x143)]('click',()=>{const _0x15c6c0=_0x31aee5;localStorage['setItem'](_0x397c8c,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':!![],'systemDismissed':![]})),_0x1be11c[_0x15c6c0(0x115)][_0x15c6c0(0x114)]('new-rank-change'),_0x1be11c['classList'][_0x15c6c0(0x13f)]('dismissing'),setTimeout(()=>{const _0x3f3ed9=_0x15c6c0;_0x1be11c[_0x3f3ed9(0x13a)]&&(_0x1be11c['remove'](),this['bannerContainer']['children'][_0x3f3ed9(0x102)]===0x0&&(this['bannerContainer']['style']['display']='none'));},0x1f4);}),_0x598df1['addEventListener'](_0x31aee5(0x111),()=>{const _0x41990d=_0x31aee5;localStorage['setItem'](_0x397c8c,JSON['stringify']({'timestamp':Date['now'](),'ignored':!![],'userDismissed':!![],'systemDismissed':![]})),_0x1be11c['classList'][_0x41990d(0x114)](_0x41990d(0xea)),_0x1be11c['classList']['add']('dismissing'),setTimeout(()=>{const _0x220d48=_0x41990d;_0x1be11c[_0x220d48(0x13a)]&&(_0x1be11c[_0x220d48(0x114)](),this['bannerContainer'][_0x220d48(0xf6)]['length']===0x0&&(this['bannerContainer']['style']['display']=_0x220d48(0xfa)));},0x1f4);}),setTimeout(()=>{const _0x5b4ca2=_0x31aee5;_0x1be11c['parentNode']&&(_0x1be11c[_0x5b4ca2(0x115)][_0x5b4ca2(0x114)]('new-rank-change'),_0x1be11c[_0x5b4ca2(0x115)]['add']('dismissing'),localStorage[_0x5b4ca2(0xed)](_0x397c8c,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':!![]})),setTimeout(()=>{const _0x22e4e7=_0x5b4ca2;_0x1be11c['parentNode']&&(_0x1be11c['remove'](),this[_0x22e4e7(0x129)]['children'][_0x22e4e7(0x102)]===0x0&&(this['bannerContainer'][_0x22e4e7(0x12d)]['display']='none'));},0x1f4));},0x3a98);});}async['resolveUserId'](_0x2e364f){const _0xcc0bf2=a44_0x85cb66,_0x3d4868={..._0x2e364f},_0x4d7033=[_0x2e364f[_0xcc0bf2(0xfd)],_0x2e364f['username'],_0x2e364f['playerUsername'],_0x2e364f['displayName']],_0x12bdd9=_0x4d7033[_0xcc0bf2(0xfc)](_0x1c57d8=>_0x1c57d8&&typeof _0x1c57d8==='string'&&!_0x1c57d8['includes']('ID:')&&!/^[a-zA-Z0-9]{20,}$/['test'](_0x1c57d8));if(_0x12bdd9)return _0x3d4868;let _0x22da57=null;if(_0x2e364f['userId'])_0x22da57=_0x2e364f[_0xcc0bf2(0x140)];else _0x2e364f['player']&&/^[A-Za-z0-9]{20,}$/['test'](_0x2e364f['player'])&&(_0x22da57=_0x2e364f[_0xcc0bf2(0xfd)]);if(!_0x22da57)return _0x3d4868;try{const _0x29d83e=await getDoc(doc(db,'players',_0x22da57));if(_0x29d83e['exists']()){const _0x327abe=_0x29d83e['data']();if(_0x327abe[_0xcc0bf2(0x142)])return _0x3d4868['resolvedName']=_0x327abe['username'],_0x3d4868;}const _0x202631=await getDocs(query(collection(db,_0xcc0bf2(0x112)),where('winnerId','==',_0x22da57),orderBy('date','desc'),limit(0x1)));if(!_0x202631['empty']){const _0x2b6ee7=_0x202631['docs'][0x0]['data']();if(_0x2b6ee7['winnerUsername'])return _0x3d4868[_0xcc0bf2(0x13b)]=_0x2b6ee7['winnerUsername'],_0x3d4868;}const _0x4b8cd3=await getDocs(query(collection(db,'approvedMatches'),where('loserId','==',_0x22da57),orderBy(_0xcc0bf2(0x10c),_0xcc0bf2(0x135)),limit(0x1)));if(!_0x4b8cd3['empty']){const _0x3a9a33=_0x4b8cd3['docs'][0x0][_0xcc0bf2(0x10d)]();if(_0x3a9a33[_0xcc0bf2(0x139)])return _0x3d4868['resolvedName']=_0x3a9a33['loserUsername'],console['log']('Resolved\x20'+_0x22da57+'\x20to\x20'+_0x3a9a33['loserUsername']+'\x20(loser)'),_0x3d4868;}}catch(_0x2bb2c9){console['error']('Error\x20resolving\x20user\x20ID:',_0x2bb2c9);}return console[_0xcc0bf2(0x12e)]('Failed\x20to\x20resolve\x20user\x20ID:\x20'+_0x22da57),_0x3d4868;}['showRankChangeLightbox'](_0x24d9fa,_0xf5ca5d){const _0x42007c=a44_0x85cb66;let _0x31dbfd=document[_0x42007c(0x134)]('rankChangeModal');!_0x31dbfd&&(_0x31dbfd=document['createElement']('div'),_0x31dbfd['id']='rankChangeModal',_0x31dbfd['className']=_0x42007c(0x138)+_0x24d9fa,document[_0x42007c(0x12c)][_0x42007c(0xf4)](_0x31dbfd));const _0x539da2=_0x24d9fa===_0x42007c(0xec)?'Congratulations!':'Rank\x20Update',_0x3edeaf=_0x24d9fa===_0x42007c(0xec)?_0x42007c(0x10a):'You\x27ve\x20been\x20demoted\x20to';_0x31dbfd[_0x42007c(0x11b)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rank-change-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2\x20class=\x22rank-change-title\x22>'+_0x539da2+'</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>'+_0x3edeaf+_0x42007c(0x108)+_0xf5ca5d+'</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22rank-change-button\x22\x20id=\x22rank-change-ok-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Got\x20it!\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x31dbfd[_0x42007c(0x12d)]['display']='flex',document['getElementById']('rank-change-ok-btn')['addEventListener'](_0x42007c(0x111),()=>{const _0xa61cea=_0x42007c;_0x31dbfd[_0xa61cea(0x12d)]['display']='none';}),_0x31dbfd['addEventListener']('click',_0x45bbc4=>{const _0xeb7690=_0x42007c;_0x45bbc4['target']===_0x31dbfd&&(_0x31dbfd['style']['display']=_0xeb7690(0xfa));});}async['checkAndRecordPromotion'](_0x4d29f2,_0xe464af,_0x173f04,_0x7bf7e3={}){const _0x5f39f7=a44_0x85cb66;try{if(_0xe464af===_0x173f04||!_0x4d29f2)return null;const _0x36b206=_0x7bf7e3['source']||_0x5f39f7(0x123),_0x345fd0=_0x7bf7e3['matchId']||null,_0x18571b=_0x7bf7e3['adminUser']||null;console['log'](_0x5f39f7(0x11d)+_0x173f04+'\x20→\x20'+_0xe464af+'\x20(source:\x20'+_0x36b206+')');let _0x326b51=null,_0x3f1b5d=null;try{const _0x45bb9f=await getDoc(doc(db,'players',_0x4d29f2));if(_0x45bb9f['exists']()){const _0x147305=_0x45bb9f['data']();_0x326b51=_0x147305['username']||_0x147305['displayName']||null,_0x3f1b5d=_0x147305['displayName']||_0x147305['username']||null;}!_0x326b51&&_0x7bf7e3['username']&&(_0x326b51=_0x7bf7e3['username'],_0x3f1b5d=_0x7bf7e3['username']);!_0x326b51&&auth[_0x5f39f7(0x130)]&&(_0x326b51=auth[_0x5f39f7(0x130)][_0x5f39f7(0x13c)]||auth['currentUser'][_0x5f39f7(0x144)]['split']('@')[0x0],_0x3f1b5d=auth['currentUser']['displayName']||null);if(!_0x326b51){const _0x2529ed=query(collection(db,'approvedMatches'),where('winnerId','==',_0x4d29f2),limit(0x1)),_0x404029=await getDocs(_0x2529ed);if(!_0x404029['empty'])_0x326b51=_0x404029['docs'][0x0]['data']()['winnerUsername']||'Unknown\x20Player',_0x3f1b5d=_0x326b51;else{const _0x31a4a0=query(collection(db,_0x5f39f7(0x112)),where('loserId','==',_0x4d29f2),limit(0x1)),_0x4d3f05=await getDocs(_0x31a4a0);!_0x4d3f05['empty']&&(_0x326b51=_0x4d3f05[0x0][_0x5f39f7(0x10d)]()[_0x5f39f7(0x139)]||'Unknown\x20Player',_0x3f1b5d=_0x326b51);}}}catch(_0x1f381b){console['error']('Error\x20resolving\x20username:',_0x1f381b);}!_0x326b51&&(console['warn']('Could\x20not\x20resolve\x20username\x20for\x20userId:',_0x4d29f2),_0x326b51='A\x20player',_0x3f1b5d='Unknown\x20Player');const _0x5e631d=this['getRankName'](_0x173f04),_0xb4f3b6=this['getRankName'](_0xe464af);if(_0x5e631d!==_0xb4f3b6){const _0xb4546=_0xe464af>_0x173f04,_0x3b42f8=_0xb4546?_0x5f39f7(0xec):'demotion',_0x2f1aa2=_0xb4f3b6;console['log']('Recording\x20'+_0x3b42f8+_0x5f39f7(0xee)+_0x326b51+':\x20'+_0x173f04+'\x20('+_0x5e631d+')\x20→\x20'+_0xe464af+'\x20('+_0xb4f3b6+')');try{const _0x48eb6c={'player':_0x326b51,'playerUsername':_0x326b51,'username':_0x326b51,'displayName':_0x3f1b5d,'userId':_0x4d29f2,'type':_0x3b42f8,'rankAchieved':_0x2f1aa2,'timestamp':serverTimestamp(),'previousElo':_0x173f04,'newElo':_0xe464af,'change':_0xe464af-_0x173f04,'previousRank':_0x5e631d,'newRank':_0xb4f3b6,'source':_0x36b206};if(_0x36b206==='match'&&_0x345fd0)_0x48eb6c[_0x5f39f7(0x126)]=_0x345fd0;else _0x36b206===_0x5f39f7(0x119)&&_0x18571b?(_0x48eb6c['modifiedBy']=_0x18571b,_0x48eb6c['isAutomatic']=![]):_0x48eb6c[_0x5f39f7(0x128)]=!![];const _0x22d414=writeBatch(db),_0x30efde=doc(collection(db,'eloHistory')),_0x1d3e58=doc(collection(db,'promotionHistory'));return _0x22d414['set'](_0x30efde,_0x48eb6c),_0x22d414['set'](_0x1d3e58,_0x48eb6c),await _0x22d414['commit'](),await this['sendPromotionNotification'](_0x4d29f2,_0x326b51,_0x173f04,_0xe464af,_0x5e631d,_0xb4f3b6,_0x3b42f8,{'displayName':_0x3f1b5d,'source':_0x36b206,'matchId':_0x345fd0,'ladder':_0x7bf7e3[_0x5f39f7(0x11f)]||'D1'}),console['log']('Successfully\x20recorded\x20'+_0x3b42f8+'\x20for\x20'+_0x326b51+_0x5f39f7(0x101)+_0x2f1aa2),_0x2f1aa2;}catch(_0x15979a){console['error']('Error\x20writing\x20promotion\x20records:',_0x15979a);try{return await addDoc(collection(db,'eloHistory'),{'player':_0x326b51,'playerUsername':_0x326b51,'username':_0x326b51,'displayName':_0x3f1b5d,'userId':_0x4d29f2,'type':_0x3b42f8,'rankAchieved':_0x2f1aa2,'timestamp':serverTimestamp(),'previousElo':_0x173f04,'newElo':_0xe464af,'change':_0xe464af-_0x173f04,'previousRank':_0x5e631d,'source':_0x36b206,'isAutomatic':_0x36b206!=='admin'}),await this['sendPromotionNotification'](_0x4d29f2,_0x326b51,_0x173f04,_0xe464af,_0x5e631d,_0xb4f3b6,_0x3b42f8,{'displayName':_0x3f1b5d,'source':_0x36b206,'matchId':_0x345fd0,'ladder':_0x7bf7e3['ladder']||'D1'}),_0x2f1aa2;}catch(_0x42f267){return console['error'](_0x5f39f7(0x121),_0x42f267),null;}}}return null;}catch(_0x49cf76){return console[_0x5f39f7(0x137)]('Error\x20in\x20promotion/demotion\x20recording:',_0x49cf76),null;}}[a44_0x85cb66(0x109)](_0x49b32a){const _0x20e34=a44_0x85cb66;for(let _0x5cadca=this['RANKS']['length']-0x1;_0x5cadca>=0x0;_0x5cadca--){if(_0x49b32a>=this['RANKS'][_0x5cadca]['threshold'])return this['RANKS'][_0x5cadca][_0x20e34(0x136)];}return'Unranked';}[a44_0x85cb66(0xf8)](){const _0x439d8b=a44_0x85cb66;this['pollingInterval']&&clearInterval(this[_0x439d8b(0xf9)]);}['isNewRankChange'](_0x21debf){const _0x491367=a44_0x85cb66;if(_0x21debf['timestamp']){const _0x40a73e=_0x21debf['timestamp']['seconds']*0x3e8,_0x17ff31=Date['now'](),_0x21ce8c=(_0x17ff31-_0x40a73e)/(0x3e8*0x3c*0x3c);if(_0x21ce8c>0x18)return![];}if(_0x21debf[_0x491367(0xf1)]&&_0x21debf['newRank']&&_0x21debf[_0x491367(0xf1)]!==_0x21debf['newRank'])return!![];return![];}async[a44_0x85cb66(0x120)](_0x24ffb3,_0xb3f5a,_0x5e5535,_0x21a66d,_0x3c9890,_0x1d3e6f,_0x1a9f4f,_0x1dfe25={}){const _0x249693=a44_0x85cb66;try{console[_0x249693(0x118)]('STARTING\x20notification\x20for\x20'+_0xb3f5a+'\x27s\x20'+_0x1a9f4f);const _0x10e89a={'userId':_0x24ffb3,'username':_0xb3f5a,'displayName':_0x1dfe25[_0x249693(0x13c)]||_0xb3f5a,'oldElo':parseInt(_0x5e5535),'newElo':parseInt(_0x21a66d),'eloDifference':parseInt(_0x21a66d)-parseInt(_0x5e5535),'oldRank':_0x3c9890,'newRank':_0x1d3e6f,'type':_0x1a9f4f,'timestamp':serverTimestamp(),'processed':![],'source':_0x1dfe25['source']||'automatic','matchId':_0x1dfe25[_0x249693(0x126)]||null,'ladder':_0x1dfe25['ladder']||'D1','adminUser':_0x1dfe25['adminUser']||null};console['log']('Creating\x20Discord\x20notification:',_0x10e89a);const _0x1b3eeb=await addDoc(collection(db,'promotionNotifications'),_0x10e89a);return console['log']('Discord\x20notification\x20sent\x20successfully\x20with\x20ID:\x20'+_0x1b3eeb['id']),!![];}catch(_0x49d5f9){return console['error']('Error\x20sending\x20Discord\x20notification:',_0x49d5f9),![];}}}export const promotionManager=new PromotionManager();document[a44_0x85cb66(0x143)]('DOMContentLoaded',()=>{promotionManager['initialize']();});export const initializePromotionTracker=()=>promotionManager['initialize']();export const checkAndRecordPromotion=(_0x320088,_0x8e08ec,_0x3df077,_0x1d30c9)=>promotionManager['checkAndRecordPromotion'](_0x320088,_0x8e08ec,_0x3df077,_0x1d30c9);function a44_0x7352(_0x24bdc6,_0x6b8dd4){const _0x3dc67b=a44_0xb81b();return a44_0x7352=function(_0x5f58c8,_0x4d3cc8){_0x5f58c8=_0x5f58c8-0xe9;let _0xb81b19=_0x3dc67b[_0x5f58c8];return _0xb81b19;},a44_0x7352(_0x24bdc6,_0x6b8dd4);}export const getRankName=_0x21c495=>promotionManager['getRankName'](_0x21c495);
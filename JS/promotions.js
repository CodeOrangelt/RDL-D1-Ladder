const a42_0x436146=a42_0xfa0e,a42_0x152e27=(function(){let _0x5585a3=!![];return function(_0x2fb881,_0x393834){const _0x20f353=_0x5585a3?function(){if(_0x393834){const _0x1ad205=_0x393834['apply'](_0x2fb881,arguments);return _0x393834=null,_0x1ad205;}}:function(){};return _0x5585a3=![],_0x20f353;};}()),a42_0x30067d=a42_0x152e27(this,function(){const _0x5b84e4=a42_0xfa0e;let _0x2be853;try{const _0x5650bc=Function(_0x5b84e4(0x111)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x2be853=_0x5650bc();}catch(_0x1ae03b){_0x2be853=window;}const _0x17151b=_0x2be853[_0x5b84e4(0x135)]=_0x2be853['console']||{},_0xf00d5c=[_0x5b84e4(0xf2),'warn','info','error',_0x5b84e4(0x121),'table','trace'];for(let _0x19a9e8=0x0;_0x19a9e8<_0xf00d5c['length'];_0x19a9e8++){const _0x4c092a=a42_0x152e27['constructor']['prototype'][_0x5b84e4(0x11c)](a42_0x152e27),_0x5c368a=_0xf00d5c[_0x19a9e8],_0x416014=_0x17151b[_0x5c368a]||_0x4c092a;_0x4c092a['__proto__']=a42_0x152e27[_0x5b84e4(0x11c)](a42_0x152e27),_0x4c092a['toString']=_0x416014['toString'][_0x5b84e4(0x11c)](_0x416014),_0x17151b[_0x5c368a]=_0x4c092a;}});a42_0x30067d();import{collection,doc,query,where,orderBy,limit,getDocs,addDoc,getDoc,serverTimestamp,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{auth,db}from'./firebase-config.js';function a42_0x344b(){const _0x5695cf=['checkAndRecordPromotion','Dismiss','players','rankAchieved','title','Discord\x20notification\x20sent\x20successfully\x20with\x20ID:\x20','Error\x20saving\x20promotion\x20preference:','matchId','appendChild','toMillis','error','Rank\x20Update','Unranked','seconds','Bronze','log','newRank','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rank-change-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2\x20class=\x22rank-change-title\x22>','\x20to\x20','true','empty','isAutomatic','bannerContainer','createElement','automatic','classList','player','pollingInterval','rankChangeModal','add','DISPLAY_HOURS','timestamp','demotion','\x20<span\x20class=\x22rank-text\x22>','data','stringify','eloHistory','style','displayName','#FFD700','includes','Promotion\x20','warn','fetchInterval','date','Gold','return\x20(function()\x20','test','RANKS','slice','Error\x20resolving\x20username:','Skipping\x20ignored\x20promotion:\x20','\x20for\x20','ladder','getRankName','display','set','bind','promotions_checked_','length',')\x20→\x20','promotion_','exception','children',',\x20treating\x20as\x20new','parse','fetchRecentPromotions','promotion-details','none','username','now','ignore-btn','setupBannerContainer','\x20(loser)','parentNode','currentUser','Error\x20writing\x20promotion\x20records:','winnerUsername','Error\x20sending\x20Discord\x20notification:','source','resolveUserId','push','console','previousRank','\x20is\x20permanently\x20ignored','admin','promotionNotifications','target','#C0C0C0','addEventListener','desc','sendPromotionNotification','remove','dismissing','initialize','resolvedName','lastFetchTime','setItem','Don\x27t\x20show\x20again','\x20was\x20dismissed\x20by\x20user\x20within\x20last\x20','playerUsername'];a42_0x344b=function(){return _0x5695cf;};return a42_0x344b();}class PromotionManager{constructor(){const _0x1a30f8=a42_0xfa0e;this[_0x1a30f8(0x101)]=0x18,this['RANKS']=[{'threshold':0x578,'name':_0x1a30f8(0xf1),'color':'#CD7F32'},{'threshold':0x640,'name':'Silver','color':_0x1a30f8(0x13b)},{'threshold':0x708,'name':_0x1a30f8(0x110),'color':_0x1a30f8(0x10a)},{'threshold':0x834,'name':'Emerald','color':'#50C878'}],this[_0x1a30f8(0xf9)]=null,this['lastFetchTime']=0x0,this['fetchInterval']=0xea60,this['pollingInterval']=null,this['usernameCache']={};}['initialize'](){const _0x49a8dd=a42_0xfa0e;this['bannerContainer']=document['getElementById']('promotion-banner-container');if(!this['bannerContainer']){console[_0x49a8dd(0xed)]('Promotion\x20banner\x20container\x20not\x20found');return;}this['setupBannerContainer']();const _0x40701c=_0x49a8dd(0x11d)+new Date()['toDateString'](),_0x4b418c=sessionStorage['getItem'](_0x40701c);!_0x4b418c&&(this[_0x49a8dd(0x125)](),sessionStorage['setItem'](_0x40701c,'true')),document['addEventListener']('visibilitychange',()=>{const _0x406ac7=_0x49a8dd;document['visibilityState']==='visible'&&!sessionStorage['getItem'](_0x40701c)&&(this['fetchRecentPromotions'](),sessionStorage[_0x406ac7(0x144)](_0x40701c,_0x406ac7(0xf6)));}),window['addEventListener']('beforeunload',()=>{const _0x5109a3=_0x49a8dd;this[_0x5109a3(0xfe)]&&clearInterval(this[_0x5109a3(0xfe)]);});}[a42_0x436146(0x12b)](){const _0x3da4fb=a42_0x436146;this[_0x3da4fb(0xf9)]['innerHTML']='',this['bannerContainer']['style']['display']=_0x3da4fb(0x127);}async['fetchRecentPromotions'](){const _0x14a63e=a42_0x436146;try{const _0x1fc639=Date['now']();if(_0x1fc639-this['lastFetchTime']<this[_0x14a63e(0x10e)])return;this[_0x14a63e(0x143)]=_0x1fc639;const _0x81466=collection(db,_0x14a63e(0x107)),_0xa91b02=query(_0x81466,where('type','in',['promotion',_0x14a63e(0x103)]),orderBy(_0x14a63e(0x102),_0x14a63e(0x13d)),limit(0x14)),_0x33259e=await getDocs(_0xa91b02),_0x167df0=[];_0x33259e['forEach'](_0x383348=>{const _0x4c235d=_0x14a63e,_0xfd838c={'id':_0x383348['id'],..._0x383348['data']()};this['shouldShowPromotion'](_0x383348['id'])&&this['isNewRankChange'](_0xfd838c)&&_0x167df0[_0x4c235d(0x134)](_0xfd838c);}),_0x167df0['length']>0x0&&await this['processRankChanges'](_0x167df0);}catch(_0x5b3a99){console['error']('Error\x20fetching\x20promotions:',_0x5b3a99);}}async['processRankChanges'](_0x20dfb7){const _0x227656=a42_0x436146;if(_0x20dfb7[_0x227656(0x11e)]===0x0)return;_0x20dfb7['sort']((_0x19c897,_0x523dd8)=>{const _0x348ebb=_0x227656,_0x264abf=_0x19c897['timestamp']?.['toMillis']?.()||_0x19c897['timestamp']?.[_0x348ebb(0xf0)]*0x3e8||0x0,_0x215b76=_0x523dd8[_0x348ebb(0x102)]?.[_0x348ebb(0xec)]?.()||_0x523dd8['timestamp']?.['seconds']*0x3e8||0x0;return _0x215b76-_0x264abf;});const _0x366e34=this[_0x227656(0xf9)]['children']['length'],_0x1f9e77=0x3-_0x366e34;if(_0x1f9e77<=0x0)return;const _0x5a3686=_0x20dfb7[_0x227656(0x114)](0x0,_0x1f9e77);for(let _0x2e3348=0x0;_0x2e3348<_0x5a3686[_0x227656(0x11e)];_0x2e3348++){const _0x4b92a8=_0x5a3686[_0x2e3348],_0x3d6ca9=auth['currentUser'];try{setTimeout(()=>{this['showRankChangeBanner'](_0x4b92a8);},_0x2e3348*0x3e8),_0x3d6ca9&&_0x4b92a8[_0x227656(0xfd)]===_0x3d6ca9['displayName']&&this['showRankChangeLightbox'](_0x4b92a8['type'],_0x4b92a8['rankAchieved']);}catch(_0x24d508){console[_0x227656(0xed)]('Error\x20processing\x20rank\x20change:',_0x24d508);}}}['shouldShowPromotion'](_0x370d99){const _0x4a9866=a42_0x436146;try{const _0x4881e0=_0x4a9866(0x120)+_0x370d99,_0x3dcfa1=localStorage['getItem'](_0x4881e0);if(_0x3dcfa1){let _0x58278b;try{_0x58278b=JSON[_0x4a9866(0x124)](_0x3dcfa1);}catch(_0x47b9da){return console['warn']('Invalid\x20storage\x20format\x20for\x20'+_0x4881e0+_0x4a9866(0x123)),!![];}if(_0x58278b['ignored']===!![])return console['log'](_0x4a9866(0x10c)+_0x370d99+_0x4a9866(0x137)),![];const _0x513d47=Date['now']();if(_0x58278b['userDismissed']&&_0x513d47-_0x58278b['timestamp']<this['DISPLAY_HOURS']*0x3c*0x3c*0x3e8)return console['log']('Promotion\x20'+_0x370d99+_0x4a9866(0x146)+this['DISPLAY_HOURS']+'\x20hours'),![];if(_0x58278b['systemDismissed']&&_0x513d47-_0x58278b[_0x4a9866(0x102)]<0x4*0x3c*0x3c*0x3e8)return console['log'](_0x4a9866(0x10c)+_0x370d99+'\x20was\x20auto-dismissed\x20within\x20last\x204\x20hours'),![];}return!![];}catch(_0x58c20c){return console['error']('Error\x20checking\x20promotion\x20visibility:',_0x58c20c),![];}}['ignorePromotion'](_0x5a16a7){const _0x1f9058=a42_0x436146;try{const _0x3daa64='promotion_'+_0x5a16a7;localStorage['setItem'](_0x3daa64,JSON[_0x1f9058(0x106)]({'timestamp':Date[_0x1f9058(0x129)](),'ignored':!![]}));}catch(_0x5a9e8e){console['error'](_0x1f9058(0xe9),_0x5a9e8e);}}['showRankChangeBanner'](_0x2b677a){const _0x46d010=a42_0x436146;this[_0x46d010(0x133)](_0x2b677a)['then'](_0x544ba7=>{const _0x2c63d1=_0x46d010,_0x512bb1='promotion_'+_0x2b677a['id'],_0x5ab38f=localStorage['getItem'](_0x512bb1);if(_0x5ab38f)try{const _0x2fe363=JSON['parse'](_0x5ab38f);if(_0x2fe363['ignored']===!![]){console['log'](_0x2c63d1(0x116)+_0x2b677a['id']);return;}}catch(_0x58d3e4){}localStorage['setItem'](_0x512bb1,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':![],'seenAt':Date['now']()})),this['bannerContainer']['style']['display']='block';while(this['bannerContainer']['children']['length']>=0x3){this['bannerContainer']['removeChild'](this[_0x2c63d1(0xf9)]['firstChild']);}const _0x3cba06=document[_0x2c63d1(0xfa)]('div');_0x3cba06['className']='promotion-banner',_0x3cba06['setAttribute']('data-rank',_0x544ba7[_0x2c63d1(0xe6)]),_0x3cba06['setAttribute']('data-id',_0x544ba7['id']);const _0x4ec7bc=document['createElement']('div');_0x4ec7bc['className']=_0x2c63d1(0x126);const _0x467983=_0x544ba7['resolvedName']||_0x544ba7[_0x2c63d1(0xfd)]||_0x544ba7[_0x2c63d1(0x128)]||_0x544ba7[_0x2c63d1(0x147)]||_0x544ba7[_0x2c63d1(0x109)]||'A\x20player',_0x5d37c6=_0x544ba7['type']==='promotion'?_0x467983+'\x20was\x20promoted\x20to':_0x467983+'\x20was\x20demoted\x20to';_0x4ec7bc['innerHTML']=_0x5d37c6+_0x2c63d1(0x104)+_0x544ba7['rankAchieved']+'</span>';const _0x41d64f=document['createElement']('div');_0x41d64f['className']='banner-actions';const _0x4109bc=document[_0x2c63d1(0xfa)]('button');_0x4109bc['className']='dismiss-btn',_0x4109bc['innerHTML']='&times;',_0x4109bc[_0x2c63d1(0xe7)]=_0x2c63d1(0xe4);const _0x360789=document['createElement']('button');_0x360789['className']=_0x2c63d1(0x12a),_0x360789['textContent']=_0x2c63d1(0x145),_0x360789['title']='Never\x20show\x20this\x20promotion\x20again',_0x41d64f['appendChild'](_0x360789),_0x41d64f['appendChild'](_0x4109bc),_0x3cba06[_0x2c63d1(0xeb)](_0x4ec7bc),_0x3cba06[_0x2c63d1(0xeb)](_0x41d64f),this[_0x2c63d1(0xf9)][_0x2c63d1(0xeb)](_0x3cba06),void _0x3cba06['offsetWidth'],setTimeout(()=>{const _0x147872=_0x2c63d1;_0x3cba06[_0x147872(0xfc)]['add']('new-rank-change');},0x32),_0x4109bc['addEventListener']('click',()=>{const _0x12db3e=_0x2c63d1;localStorage['setItem'](_0x512bb1,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':!![],'systemDismissed':![]})),_0x3cba06[_0x12db3e(0xfc)]['remove']('new-rank-change'),_0x3cba06['classList']['add']('dismissing'),setTimeout(()=>{const _0x4b0e55=_0x12db3e;_0x3cba06[_0x4b0e55(0x12d)]&&(_0x3cba06['remove'](),this['bannerContainer']['children']['length']===0x0&&(this[_0x4b0e55(0xf9)]['style']['display']='none'));},0x1f4);}),_0x360789[_0x2c63d1(0x13c)]('click',()=>{const _0x5ca3df=_0x2c63d1;localStorage['setItem'](_0x512bb1,JSON[_0x5ca3df(0x106)]({'timestamp':Date[_0x5ca3df(0x129)](),'ignored':!![],'userDismissed':!![],'systemDismissed':![]})),_0x3cba06['classList'][_0x5ca3df(0x13f)]('new-rank-change'),_0x3cba06['classList'][_0x5ca3df(0x100)](_0x5ca3df(0x140)),setTimeout(()=>{const _0x1842d9=_0x5ca3df;_0x3cba06[_0x1842d9(0x12d)]&&(_0x3cba06['remove'](),this['bannerContainer']['children']['length']===0x0&&(this[_0x1842d9(0xf9)]['style']['display']='none'));},0x1f4);}),setTimeout(()=>{const _0x4dd9ed=_0x2c63d1;_0x3cba06[_0x4dd9ed(0x12d)]&&(_0x3cba06[_0x4dd9ed(0xfc)][_0x4dd9ed(0x13f)]('new-rank-change'),_0x3cba06['classList']['add'](_0x4dd9ed(0x140)),localStorage[_0x4dd9ed(0x144)](_0x512bb1,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':!![]})),setTimeout(()=>{const _0x198429=_0x4dd9ed;_0x3cba06[_0x198429(0x12d)]&&(_0x3cba06['remove'](),this[_0x198429(0xf9)][_0x198429(0x122)]['length']===0x0&&(this['bannerContainer']['style']['display']=_0x198429(0x127)));},0x1f4));},0x3a98);});}async['resolveUserId'](_0x297019){const _0x2fef27=a42_0x436146,_0x3691ab={..._0x297019},_0x457854=[_0x297019['player'],_0x297019['username'],_0x297019['playerUsername'],_0x297019['displayName']],_0x439b6e=_0x457854['some'](_0x10bc25=>_0x10bc25&&typeof _0x10bc25==='string'&&!_0x10bc25[_0x2fef27(0x10b)]('ID:')&&!/^[a-zA-Z0-9]{20,}$/[_0x2fef27(0x112)](_0x10bc25));if(_0x439b6e)return _0x3691ab;let _0x3da492=null;if(_0x297019['userId'])_0x3da492=_0x297019['userId'];else _0x297019[_0x2fef27(0xfd)]&&/^[A-Za-z0-9]{20,}$/['test'](_0x297019['player'])&&(_0x3da492=_0x297019['player']);if(!_0x3da492)return _0x3691ab;try{const _0x5419e3=await getDoc(doc(db,'players',_0x3da492));if(_0x5419e3['exists']()){const _0x1754c2=_0x5419e3['data']();if(_0x1754c2['username'])return _0x3691ab[_0x2fef27(0x142)]=_0x1754c2['username'],_0x3691ab;}const _0xd55e47=await getDocs(query(collection(db,'approvedMatches'),where('winnerId','==',_0x3da492),orderBy(_0x2fef27(0x10f),'desc'),limit(0x1)));if(!_0xd55e47['empty']){const _0x3495d3=_0xd55e47['docs'][0x0]['data']();if(_0x3495d3[_0x2fef27(0x130)])return _0x3691ab[_0x2fef27(0x142)]=_0x3495d3['winnerUsername'],_0x3691ab;}const _0x5de205=await getDocs(query(collection(db,'approvedMatches'),where('loserId','==',_0x3da492),orderBy('date','desc'),limit(0x1)));if(!_0x5de205[_0x2fef27(0xf7)]){const _0x5be4c3=_0x5de205['docs'][0x0]['data']();if(_0x5be4c3['loserUsername'])return _0x3691ab['resolvedName']=_0x5be4c3['loserUsername'],console[_0x2fef27(0xf2)]('Resolved\x20'+_0x3da492+_0x2fef27(0xf5)+_0x5be4c3['loserUsername']+_0x2fef27(0x12c)),_0x3691ab;}}catch(_0x283a17){console['error']('Error\x20resolving\x20user\x20ID:',_0x283a17);}return console[_0x2fef27(0x10d)]('Failed\x20to\x20resolve\x20user\x20ID:\x20'+_0x3da492),_0x3691ab;}['showRankChangeLightbox'](_0x4cdf45,_0x3700a9){const _0x13ac11=a42_0x436146;let _0x45d50b=document['getElementById'](_0x13ac11(0xff));!_0x45d50b&&(_0x45d50b=document[_0x13ac11(0xfa)]('div'),_0x45d50b['id']='rankChangeModal',_0x45d50b['className']='rank-change-modal\x20'+_0x4cdf45,document['body']['appendChild'](_0x45d50b));const _0x35aeae=_0x4cdf45==='promotion'?'Congratulations!':_0x13ac11(0xee),_0x2e34b8=_0x4cdf45==='promotion'?'You\x27ve\x20been\x20promoted\x20to':'You\x27ve\x20been\x20demoted\x20to';_0x45d50b['innerHTML']=_0x13ac11(0xf4)+_0x35aeae+'</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>'+_0x2e34b8+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22rank-name\x22>'+_0x3700a9+'</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22rank-change-button\x22\x20id=\x22rank-change-ok-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Got\x20it!\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x45d50b['style'][_0x13ac11(0x11a)]='flex',document['getElementById']('rank-change-ok-btn')[_0x13ac11(0x13c)]('click',()=>{const _0x1444e9=_0x13ac11;_0x45d50b['style']['display']=_0x1444e9(0x127);}),_0x45d50b['addEventListener']('click',_0x3b8d8f=>{const _0x383816=_0x13ac11;_0x3b8d8f[_0x383816(0x13a)]===_0x45d50b&&(_0x45d50b[_0x383816(0x108)]['display']='none');});}async[a42_0x436146(0xe3)](_0x273e49,_0x3a61e4,_0x4a6892,_0xcd083b={}){const _0x10841f=a42_0x436146;try{if(_0x3a61e4===_0x4a6892||!_0x273e49)return null;const _0x165ab3=_0xcd083b[_0x10841f(0x132)]||_0x10841f(0xfb),_0x372ecf=_0xcd083b['matchId']||null,_0x8a1f8e=_0xcd083b['adminUser']||null;console[_0x10841f(0xf2)]('Processing\x20potential\x20rank\x20change:\x20'+_0x4a6892+'\x20→\x20'+_0x3a61e4+'\x20(source:\x20'+_0x165ab3+')');let _0x27ca46=null,_0x28b7a1=null;try{const _0x170356=await getDoc(doc(db,_0x10841f(0xe5),_0x273e49));if(_0x170356['exists']()){const _0x415924=_0x170356['data']();_0x27ca46=_0x415924['username']||_0x415924['displayName']||null,_0x28b7a1=_0x415924['displayName']||_0x415924['username']||null;}!_0x27ca46&&_0xcd083b['username']&&(_0x27ca46=_0xcd083b['username'],_0x28b7a1=_0xcd083b[_0x10841f(0x128)]);!_0x27ca46&&auth[_0x10841f(0x12e)]&&(_0x27ca46=auth[_0x10841f(0x12e)]['displayName']||auth['currentUser']['email']['split']('@')[0x0],_0x28b7a1=auth[_0x10841f(0x12e)]['displayName']||null);if(!_0x27ca46){const _0x2bbc9a=query(collection(db,'approvedMatches'),where('winnerId','==',_0x273e49),limit(0x1)),_0x456959=await getDocs(_0x2bbc9a);if(!_0x456959[_0x10841f(0xf7)])_0x27ca46=_0x456959['docs'][0x0][_0x10841f(0x105)]()[_0x10841f(0x130)]||'Unknown\x20Player',_0x28b7a1=_0x27ca46;else{const _0x2048c4=query(collection(db,'approvedMatches'),where('loserId','==',_0x273e49),limit(0x1)),_0x2598e9=await getDocs(_0x2048c4);!_0x2598e9[_0x10841f(0xf7)]&&(_0x27ca46=_0x2598e9[0x0][_0x10841f(0x105)]()['loserUsername']||'Unknown\x20Player',_0x28b7a1=_0x27ca46);}}}catch(_0x29599e){console['error'](_0x10841f(0x115),_0x29599e);}!_0x27ca46&&(console['warn']('Could\x20not\x20resolve\x20username\x20for\x20userId:',_0x273e49),_0x27ca46='A\x20player',_0x28b7a1='Unknown\x20Player');const _0x5cdfd3=this['getRankName'](_0x4a6892),_0x277cc2=this[_0x10841f(0x119)](_0x3a61e4);if(_0x5cdfd3!==_0x277cc2){const _0x26586a=_0x3a61e4>_0x4a6892,_0x37cd33=_0x26586a?'promotion':'demotion',_0xa66c43=_0x277cc2;console['log']('Recording\x20'+_0x37cd33+_0x10841f(0x117)+_0x27ca46+':\x20'+_0x4a6892+'\x20('+_0x5cdfd3+_0x10841f(0x11f)+_0x3a61e4+'\x20('+_0x277cc2+')');try{const _0x38db98={'player':_0x27ca46,'playerUsername':_0x27ca46,'username':_0x27ca46,'displayName':_0x28b7a1,'userId':_0x273e49,'type':_0x37cd33,'rankAchieved':_0xa66c43,'timestamp':serverTimestamp(),'previousElo':_0x4a6892,'newElo':_0x3a61e4,'change':_0x3a61e4-_0x4a6892,'previousRank':_0x5cdfd3,'newRank':_0x277cc2,'source':_0x165ab3};if(_0x165ab3==='match'&&_0x372ecf)_0x38db98[_0x10841f(0xea)]=_0x372ecf;else _0x165ab3==='admin'&&_0x8a1f8e?(_0x38db98['modifiedBy']=_0x8a1f8e,_0x38db98[_0x10841f(0xf8)]=![]):_0x38db98[_0x10841f(0xf8)]=!![];const _0x7518c0=writeBatch(db),_0x55b011=doc(collection(db,'eloHistory')),_0x3c14ae=doc(collection(db,'promotionHistory'));return _0x7518c0[_0x10841f(0x11b)](_0x55b011,_0x38db98),_0x7518c0[_0x10841f(0x11b)](_0x3c14ae,_0x38db98),await _0x7518c0['commit'](),await this['sendPromotionNotification'](_0x273e49,_0x27ca46,_0x4a6892,_0x3a61e4,_0x5cdfd3,_0x277cc2,_0x37cd33,{'displayName':_0x28b7a1,'source':_0x165ab3,'matchId':_0x372ecf,'ladder':_0xcd083b[_0x10841f(0x118)]||'D1'}),console[_0x10841f(0xf2)]('Successfully\x20recorded\x20'+_0x37cd33+'\x20for\x20'+_0x27ca46+'\x20to\x20'+_0xa66c43),_0xa66c43;}catch(_0x2e7810){console['error'](_0x10841f(0x12f),_0x2e7810);try{return await addDoc(collection(db,_0x10841f(0x107)),{'player':_0x27ca46,'playerUsername':_0x27ca46,'username':_0x27ca46,'displayName':_0x28b7a1,'userId':_0x273e49,'type':_0x37cd33,'rankAchieved':_0xa66c43,'timestamp':serverTimestamp(),'previousElo':_0x4a6892,'newElo':_0x3a61e4,'change':_0x3a61e4-_0x4a6892,'previousRank':_0x5cdfd3,'source':_0x165ab3,'isAutomatic':_0x165ab3!==_0x10841f(0x138)}),await this['sendPromotionNotification'](_0x273e49,_0x27ca46,_0x4a6892,_0x3a61e4,_0x5cdfd3,_0x277cc2,_0x37cd33,{'displayName':_0x28b7a1,'source':_0x165ab3,'matchId':_0x372ecf,'ladder':_0xcd083b['ladder']||'D1'}),_0xa66c43;}catch(_0x1541a1){return console['error']('Fallback\x20write\x20failed:',_0x1541a1),null;}}}return null;}catch(_0x64b50e){return console['error']('Error\x20in\x20promotion/demotion\x20recording:',_0x64b50e),null;}}[a42_0x436146(0x119)](_0x5d1c66){const _0x3ad650=a42_0x436146;for(let _0x285e6d=this['RANKS'][_0x3ad650(0x11e)]-0x1;_0x285e6d>=0x0;_0x285e6d--){if(_0x5d1c66>=this['RANKS'][_0x285e6d]['threshold'])return this[_0x3ad650(0x113)][_0x285e6d]['name'];}return _0x3ad650(0xef);}['cleanup'](){this['pollingInterval']&&clearInterval(this['pollingInterval']);}['isNewRankChange'](_0x26e87c){const _0x481dfe=a42_0x436146;if(_0x26e87c['timestamp']){const _0x4ebf3a=_0x26e87c[_0x481dfe(0x102)]['seconds']*0x3e8,_0x76c8c5=Date[_0x481dfe(0x129)](),_0x9b913f=(_0x76c8c5-_0x4ebf3a)/(0x3e8*0x3c*0x3c);if(_0x9b913f>0x18)return![];}if(_0x26e87c[_0x481dfe(0x136)]&&_0x26e87c['newRank']&&_0x26e87c['previousRank']!==_0x26e87c[_0x481dfe(0xf3)])return!![];return![];}async[a42_0x436146(0x13e)](_0x1db54b,_0x302cae,_0x2b3174,_0x3b3931,_0x35f1e7,_0x5a4005,_0x1b10da,_0x5db835={}){const _0x460924=a42_0x436146;try{console[_0x460924(0xf2)]('STARTING\x20notification\x20for\x20'+_0x302cae+'\x27s\x20'+_0x1b10da);const _0x1c8941={'userId':_0x1db54b,'username':_0x302cae,'displayName':_0x5db835[_0x460924(0x109)]||_0x302cae,'oldElo':parseInt(_0x2b3174),'newElo':parseInt(_0x3b3931),'eloDifference':parseInt(_0x3b3931)-parseInt(_0x2b3174),'oldRank':_0x35f1e7,'newRank':_0x5a4005,'type':_0x1b10da,'timestamp':serverTimestamp(),'processed':![],'source':_0x5db835[_0x460924(0x132)]||_0x460924(0xfb),'matchId':_0x5db835['matchId']||null,'ladder':_0x5db835['ladder']||'D1','adminUser':_0x5db835['adminUser']||null};console[_0x460924(0xf2)]('Creating\x20Discord\x20notification:',_0x1c8941);const _0x64ff88=await addDoc(collection(db,_0x460924(0x139)),_0x1c8941);return console['log'](_0x460924(0xe8)+_0x64ff88['id']),!![];}catch(_0x221dd7){return console['error'](_0x460924(0x131),_0x221dd7),![];}}}export const promotionManager=new PromotionManager();function a42_0xfa0e(_0x25f972,_0x521c79){const _0x30067d=a42_0x344b();return a42_0xfa0e=function(_0x152e27,_0x128eab){_0x152e27=_0x152e27-0xe3;let _0x344b4c=_0x30067d[_0x152e27];return _0x344b4c;},a42_0xfa0e(_0x25f972,_0x521c79);}document['addEventListener']('DOMContentLoaded',()=>{promotionManager['initialize']();});export const initializePromotionTracker=()=>promotionManager[a42_0x436146(0x141)]();export const checkAndRecordPromotion=(_0xce20f3,_0x631dbc,_0x368f47,_0x3583aa)=>promotionManager[a42_0x436146(0xe3)](_0xce20f3,_0x631dbc,_0x368f47,_0x3583aa);export const getRankName=_0x3d1f67=>promotionManager[a42_0x436146(0x119)](_0x3d1f67);
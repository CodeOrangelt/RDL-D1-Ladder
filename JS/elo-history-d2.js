const a12_0x1dedb6=a12_0x5826,a12_0x5a8d56=(function(){let _0x2b70eb=!![];return function(_0x404889,_0x548ceb){const _0x453be8=_0x2b70eb?function(){const _0x2ba59a=a12_0x5826;if(_0x548ceb){const _0x1f9133=_0x548ceb[_0x2ba59a(0x155)](_0x404889,arguments);return _0x548ceb=null,_0x1f9133;}}:function(){};return _0x2b70eb=![],_0x453be8;};}()),a12_0x89d63e=a12_0x5a8d56(this,function(){const _0x146fce=a12_0x5826,_0x2a039a=function(){const _0x53834a=a12_0x5826;let _0xc5bf51;try{_0xc5bf51=Function('return\x20(function()\x20'+_0x53834a(0x14b)+');')();}catch(_0x5320ef){_0xc5bf51=window;}return _0xc5bf51;},_0x574375=_0x2a039a(),_0x1b415b=_0x574375['console']=_0x574375[_0x146fce(0x147)]||{},_0x302361=[_0x146fce(0x152),'warn','info','error','exception','table','trace'];for(let _0x47e98c=0x0;_0x47e98c<_0x302361['length'];_0x47e98c++){const _0x114fca=a12_0x5a8d56[_0x146fce(0x14f)]['prototype'][_0x146fce(0x149)](a12_0x5a8d56),_0x98414c=_0x302361[_0x47e98c],_0x4281b7=_0x1b415b[_0x98414c]||_0x114fca;_0x114fca['__proto__']=a12_0x5a8d56['bind'](a12_0x5a8d56),_0x114fca['toString']=_0x4281b7[_0x146fce(0x154)]['bind'](_0x4281b7),_0x1b415b[_0x98414c]=_0x114fca;}});a12_0x89d63e();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D2=[{'name':'Gold','elo':0x708},{'name':a12_0x1dedb6(0x142),'elo':0x640},{'name':'Bronze','elo':0x578},{'name':'Unranked','elo':0x4b0}];let lastVisibleD2=null;async function getUsernameByIdD2(_0x1b763f){const _0x46ec9b=a12_0x1dedb6;try{if(!_0x1b763f)return'Unknown\x20Player';const _0x306dc6=await getDoc(doc(db,'playersD2',_0x1b763f));if(_0x306dc6['exists']())return _0x306dc6[_0x46ec9b(0x14c)]()['username']||'Unknown\x20Player';const _0x503a41=await getDocs(query(collection(db,'approvedMatchesD2'),where('winnerId','==',_0x1b763f),limit(0x1)));if(!_0x503a41['empty'])return _0x503a41['docs'][0x0][_0x46ec9b(0x14c)]()[_0x46ec9b(0x153)]||'Unknown\x20Player';const _0x57c907=await getDocs(query(collection(db,_0x46ec9b(0x14e)),where('loserId','==',_0x1b763f),limit(0x1)));if(!_0x57c907['empty'])return _0x57c907['docs'][0x0][_0x46ec9b(0x14c)]()['loserUsername']||'Unknown\x20Player';return'Unknown\x20Player';}catch(_0x174e2a){return console['error']('Error\x20getting\x20username:',_0x174e2a),_0x46ec9b(0x148);}}export async function recordEloChangeD2({playerId:_0x319e15,previousElo:_0x1f2641,newElo:_0x6a268f,opponentId:_0x4dc497,matchResult:_0x2281fa,previousPosition:_0x35be47,newPosition:_0xb2b436,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x3cacad,timestamp:_0xaced02}){const _0x5d2ef0=a12_0x1dedb6;try{const _0x43b4b6=doc(collection(db,'eloHistoryD2'));let _0x28f4ba=_0x5d2ef0(0x145);if(isPromotion)_0x28f4ba='promotion';if(isDemotion)_0x28f4ba=_0x5d2ef0(0x150);let _0x11a88f='Unranked';if(_0x6a268f>=0x834)_0x11a88f=_0x5d2ef0(0x151);else{if(_0x6a268f>=0x708)_0x11a88f='Gold';else{if(_0x6a268f>=0x640)_0x11a88f=_0x5d2ef0(0x142);else{if(_0x6a268f>=0x578)_0x11a88f='Bronze';}}}return await setDoc(_0x43b4b6,{'type':_0x28f4ba,'player':_0x319e15,'opponent':_0x4dc497,'previousElo':_0x1f2641,'newElo':_0x6a268f,'change':_0x6a268f-_0x1f2641,'matchResult':_0x2281fa,'previousPosition':_0x35be47,'newPosition':_0xb2b436,'rankAchieved':_0x11a88f,'matchId':_0x3cacad,'timestamp':_0xaced02}),console[_0x5d2ef0(0x152)]('D2\x20ELO\x20history\x20recorded\x20for\x20'+_0x319e15),!![];}catch(_0x3904b8){console['error']('Error\x20recording\x20D2\x20ELO\x20history:',_0x3904b8);throw _0x3904b8;}}export async function getEloHistoryD2(_0x229b6f=0x14){const _0x22e14f=a12_0x1dedb6;try{const _0x282398=collection(db,_0x22e14f(0x141));let _0x26a51e;lastVisibleD2?_0x26a51e=query(_0x282398,orderBy('timestamp','desc'),startAfter(lastVisibleD2),limit(_0x229b6f)):_0x26a51e=query(_0x282398,orderBy('timestamp','desc'),limit(_0x229b6f));const _0x184802=await getDocs(_0x26a51e);if(_0x184802['empty'])return{'entries':[],'hasMore':![]};lastVisibleD2=_0x184802[_0x22e14f(0x144)][_0x184802['docs'][_0x22e14f(0x14a)]-0x1];const _0x5bee62=_0x184802[_0x22e14f(0x144)]['map'](async _0x39ab96=>{const _0x554131=_0x22e14f,_0x56158f=_0x39ab96[_0x554131(0x14c)](),[_0x1cfab0,_0x144c10]=await Promise['all']([getUsernameByIdD2(_0x56158f['player']),getUsernameByIdD2(_0x56158f[_0x554131(0x14d)])]);return{..._0x56158f,'playerUsername':_0x1cfab0,'opponentUsername':_0x144c10,'change':_0x56158f['newElo']-_0x56158f[_0x554131(0x143)],'timestamp':_0x56158f['timestamp']};}),_0x34f078=await Promise[_0x22e14f(0x146)](_0x5bee62);return{'entries':_0x34f078,'hasMore':_0x184802['size']===_0x229b6f};}catch(_0x5804da){console['error']('Error\x20fetching\x20D2\x20ELO\x20history:',_0x5804da);throw _0x5804da;}}function a12_0x344f(){const _0x864e60=['eloHistoryD2','Silver','previousElo','docs','match','all','console','Unknown\x20Player','bind','length','{}.constructor(\x22return\x20this\x22)(\x20)','data','opponent','approvedMatchesD2','constructor','demotion','Emerald','log','winnerUsername','toString','apply'];a12_0x344f=function(){return _0x864e60;};return a12_0x344f();}function a12_0x5826(_0x33f3db,_0x35b6cc){const _0x89d63e=a12_0x344f();return a12_0x5826=function(_0x5a8d56,_0x57b7a8){_0x5a8d56=_0x5a8d56-0x141;let _0x344fe7=_0x89d63e[_0x5a8d56];return _0x344fe7;},a12_0x5826(_0x33f3db,_0x35b6cc);}export function resetPaginationD2(){lastVisibleD2=null;}
const a53_0x4de283=a53_0x588e;(function(_0xb6f2e5,_0x4017a6){const _0x202a64=a53_0x588e,_0x543d85=_0xb6f2e5();while(!![]){try{const _0x352493=parseInt(_0x202a64(0x98))/0x1+parseInt(_0x202a64(0xa4))/0x2+parseInt(_0x202a64(0x9e))/0x3+-parseInt(_0x202a64(0x96))/0x4+-parseInt(_0x202a64(0xa6))/0x5*(parseInt(_0x202a64(0x90))/0x6)+parseInt(_0x202a64(0xaf))/0x7*(parseInt(_0x202a64(0xa0))/0x8)+parseInt(_0x202a64(0xbb))/0x9;if(_0x352493===_0x4017a6)break;else _0x543d85['push'](_0x543d85['shift']());}catch(_0xa3b340){_0x543d85['push'](_0x543d85['shift']());}}}(a53_0x3c07,0x7a97d));const a53_0x51bbdc=(function(){let _0x1bd4dd=!![];return function(_0x29e98e,_0x3b79f7){const _0x48a710=_0x1bd4dd?function(){const _0x34c944=a53_0x588e;if(_0x3b79f7){const _0x36dd49=_0x3b79f7[_0x34c944(0x9d)](_0x29e98e,arguments);return _0x3b79f7=null,_0x36dd49;}}:function(){};return _0x1bd4dd=![],_0x48a710;};}()),a53_0x28e25e=a53_0x51bbdc(this,function(){const _0x54b6ad=a53_0x588e;return a53_0x28e25e[_0x54b6ad(0xc2)]()['search'](_0x54b6ad(0x9b))['toString']()[_0x54b6ad(0xb7)](a53_0x28e25e)[_0x54b6ad(0xc0)](_0x54b6ad(0x9b));});a53_0x28e25e();const a53_0xcc4beb=(function(){let _0x13926f=!![];return function(_0x402e33,_0x370420){const _0x338d5f=_0x13926f?function(){const _0x57bdda=a53_0x588e;if(_0x370420){const _0x4f077f=_0x370420[_0x57bdda(0x9d)](_0x402e33,arguments);return _0x370420=null,_0x4f077f;}}:function(){};return _0x13926f=![],_0x338d5f;};}()),a53_0x14f081=a53_0xcc4beb(this,function(){const _0x5ed7b5=a53_0x588e,_0x4ee619=function(){const _0x23af7b=a53_0x588e;let _0x36d542;try{_0x36d542=Function(_0x23af7b(0x9a)+_0x23af7b(0xbd)+');')();}catch(_0x47ea56){_0x36d542=window;}return _0x36d542;},_0xe4681e=_0x4ee619(),_0xb40ac3=_0xe4681e[_0x5ed7b5(0xa5)]=_0xe4681e[_0x5ed7b5(0xa5)]||{},_0x329e73=[_0x5ed7b5(0xbe),'warn',_0x5ed7b5(0x97),_0x5ed7b5(0x9c),_0x5ed7b5(0x8f),_0x5ed7b5(0xa7),_0x5ed7b5(0xc1)];for(let _0x2677ec=0x0;_0x2677ec<_0x329e73[_0x5ed7b5(0xa1)];_0x2677ec++){const _0x103b6c=a53_0xcc4beb['constructor'][_0x5ed7b5(0xba)][_0x5ed7b5(0x94)](a53_0xcc4beb),_0x577086=_0x329e73[_0x2677ec],_0x48f663=_0xb40ac3[_0x577086]||_0x103b6c;_0x103b6c['__proto__']=a53_0xcc4beb[_0x5ed7b5(0x94)](a53_0xcc4beb),_0x103b6c[_0x5ed7b5(0xc2)]=_0x48f663[_0x5ed7b5(0xc2)][_0x5ed7b5(0x94)](_0x48f663),_0xb40ac3[_0x577086]=_0x103b6c;}});a53_0x14f081();import{db}from'../firebase-config.js';import{collection,doc,getDoc,getDocs,query,limit,startAfter,where,onSnapshot}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const cache={'userProfiles':new Map(),'ladderPlayers':new Map(),'matchResults':new Map(),'eloHistory':new Map()},CACHE_EXPIRY={'userProfiles':0x5*0x3c*0x3e8,'ladderPlayers':0x2*0x3c*0x3e8,'matchResults':0x1*0x3c*0x3e8,'eloHistory':0x3*0x3c*0x3e8};export const userProfilesRef=collection(db,a53_0x4de283(0xb2));export async function fetchPaginatedData(_0x1a778f,_0x2f22ea=0xa,_0x5c02d5=null){const _0x165c22=a53_0x4de283;let _0x54d161=query(_0x1a778f,limit(_0x2f22ea));_0x5c02d5&&(_0x54d161=query(_0x54d161,startAfter(_0x5c02d5)));const _0xe19869=await getDocs(_0x54d161),_0x330728=_0xe19869[_0x165c22(0xb9)][_0xe19869['docs']['length']-0x1];return{'data':_0xe19869[_0x165c22(0xb9)][_0x165c22(0xb5)](_0x39717c=>({'id':_0x39717c['id'],..._0x39717c['data']()})),'lastVisible':_0x330728,'hasMore':_0xe19869[_0x165c22(0xb9)][_0x165c22(0xa1)]===_0x2f22ea};}export async function getUserProfile(_0x3d83ec){const _0x5a472c=a53_0x4de283,_0x4d50c8=cache[_0x5a472c(0xb2)]['get'](_0x3d83ec);if(_0x4d50c8&&Date['now']()-_0x4d50c8[_0x5a472c(0xa2)]<CACHE_EXPIRY[_0x5a472c(0xb2)])return _0x4d50c8[_0x5a472c(0x99)];const _0x180985=await getDoc(doc(userProfilesRef,_0x3d83ec));if(_0x180985[_0x5a472c(0xad)]()){const _0x19f4e5=_0x180985['data']();return cache[_0x5a472c(0xb2)][_0x5a472c(0x93)](_0x3d83ec,{'data':_0x19f4e5,'timestamp':Date[_0x5a472c(0x91)]()}),_0x19f4e5;}return null;}export async function getLadderData(_0x4f3cf9=0x1){const _0x1696f=a53_0x4de283,_0x2e4722=_0x1696f(0xb3)+_0x4f3cf9,_0x4080bc=cache[_0x1696f(0xae)][_0x1696f(0xac)](_0x2e4722);if(_0x4080bc&&Date[_0x1696f(0x91)]()-_0x4080bc[_0x1696f(0xa2)]<CACHE_EXPIRY[_0x1696f(0xae)])return _0x4080bc[_0x1696f(0x99)];const _0x398898=_0x4f3cf9===0x1?_0x1696f(0xa8):_0x1696f(0xa9)+_0x4f3cf9,_0x260549=collection(db,_0x398898),_0x268a7f=await getDocs(query(_0x260549,limit(0x64))),_0x333628=_0x268a7f[_0x1696f(0xb9)][_0x1696f(0xb5)](_0x2c4227=>({'id':_0x2c4227['id'],..._0x2c4227['data']()}));return cache[_0x1696f(0xae)][_0x1696f(0x93)](_0x2e4722,{'data':_0x333628,'timestamp':Date[_0x1696f(0x91)]()}),_0x333628;}export async function getEloHistoryBatch(_0x423f0d,_0x3ef204=0x1){const _0x2f5aab=a53_0x4de283,_0x523655=_0x3ef204===0x1?'eloHistory':'eloHistoryD'+_0x3ef204,_0x2e4891=collection(db,_0x523655),_0x41153a={},_0x3d1260=[];_0x423f0d[_0x2f5aab(0xb1)](_0x6a4ba1=>{const _0x5d10af=_0x2f5aab,_0x1e1dc0=_0x6a4ba1+'_'+_0x3ef204,_0x52a494=cache[_0x5d10af(0xbf)][_0x5d10af(0xac)](_0x1e1dc0);_0x52a494&&Date[_0x5d10af(0x91)]()-_0x52a494[_0x5d10af(0xa2)]<CACHE_EXPIRY['eloHistory']?_0x41153a[_0x6a4ba1]=_0x52a494[_0x5d10af(0x99)]:_0x3d1260['push'](_0x6a4ba1);});const _0x30c637=0xa;for(let _0x440292=0x0;_0x440292<_0x3d1260[_0x2f5aab(0xa1)];_0x440292+=_0x30c637){const _0x3b733b=_0x3d1260[_0x2f5aab(0xb6)](_0x440292,_0x440292+_0x30c637);if(_0x3b733b[_0x2f5aab(0xa1)]>0x0)try{const _0x42c7f1=query(_0x2e4891,where(_0x2f5aab(0xaa),'in',_0x3b733b),limit(0x64)),_0x2473e2=await getDocs(_0x42c7f1);_0x2473e2[_0x2f5aab(0xb9)]['forEach'](_0x782487=>{const _0x58d416=_0x2f5aab,_0x3b0c28=_0x782487[_0x58d416(0x99)](),_0x420858=_0x3b0c28['playerId'];if(!_0x41153a[_0x420858])_0x41153a[_0x420858]=[];_0x41153a[_0x420858][_0x58d416(0x92)](_0x3b0c28);const _0x112da8=_0x420858+'_'+_0x3ef204;cache[_0x58d416(0xbf)][_0x58d416(0x93)](_0x112da8,{'data':_0x41153a[_0x420858],'timestamp':Date[_0x58d416(0x91)]()});});}catch(_0x55d667){console[_0x2f5aab(0x9c)](_0x2f5aab(0xb4),_0x55d667);}}return _0x41153a;}function a53_0x588e(_0xb7c6c8,_0x13240d){const _0x5e0924=a53_0x3c07();return a53_0x588e=function(_0x14f081,_0xcc4beb){_0x14f081=_0x14f081-0x8f;let _0x479ba7=_0x5e0924[_0x14f081];return _0x479ba7;},a53_0x588e(_0xb7c6c8,_0x13240d);}function a53_0x3c07(){const _0x5acd74=['return\x20(function()\x20','(((.+)+)+)+$','error','apply','1446654hwhenA','doc','920KLEjqx','length','timestamp','playersD3','640900ZSacmx','console','15EirffT','table','players','playersD','playerId','username','get','exists','ladderPlayers','1561bQvern','nonParticipants','forEach','userProfiles','division_','Error\x20fetching\x20batch\x20ELO\x20history:','map','slice','constructor','playersD2','docs','prototype','1813671nmmfDG','includes','{}.constructor(\x22return\x20this\x22)(\x20)','log','eloHistory','search','trace','toString','exception','1086906MxWwmJ','now','push','set','bind','docChanges','1139896HAMqCQ','info','300736OLoAWJ','data'];a53_0x3c07=function(){return _0x5acd74;};return a53_0x3c07();}let usernameCache=new Map(),usernameCacheTimestamp=Date[a53_0x4de283(0x91)]();export function setupEfficientListener(_0x5d0a48,_0xf6dddc=[],_0x1ee3bf){const _0x48dc48=collection(db,_0x5d0a48),_0xa64178=query(_0x48dc48,..._0xf6dddc),_0x45db0d=onSnapshot(_0xa64178,_0x2a6532=>{const _0x55a8f9=a53_0x588e,_0x5a7838=_0x2a6532[_0x55a8f9(0x95)]()['map'](_0x50ad3b=>({'type':_0x50ad3b['type'],'id':_0x50ad3b[_0x55a8f9(0x9f)]['id'],'data':_0x50ad3b[_0x55a8f9(0x9f)][_0x55a8f9(0x99)]()}));_0x5a7838[_0x55a8f9(0xa1)]>0x0&&_0x1ee3bf(_0x5a7838,_0x2a6532['docs']);});return _0x45db0d;}export async function bulkResolveUsernames(_0x20b7ef){const _0x14e4f1=a53_0x4de283,_0x13ab50=new Map();if(!_0x20b7ef||_0x20b7ef[_0x14e4f1(0xa1)]===0x0)return _0x13ab50;const _0x1605d=[_0x14e4f1(0xa8),_0x14e4f1(0xb8),_0x14e4f1(0xa3),_0x14e4f1(0xb0)];for(const _0x4ccb9b of _0x1605d){const _0x15ef2f=collection(db,_0x4ccb9b),_0x2e2a90=await getDocs(_0x15ef2f);_0x2e2a90[_0x14e4f1(0xb1)](_0x1721ae=>{const _0x32ef65=_0x14e4f1,_0x4e4868=_0x1721ae[_0x32ef65(0x99)]();_0x4e4868['username']&&_0x20b7ef[_0x32ef65(0xbc)](_0x1721ae['id'])&&_0x13ab50[_0x32ef65(0x93)](_0x1721ae['id'],_0x4e4868[_0x32ef65(0xab)]);});}return _0x13ab50;}
const a13_0x5c4b4f=a13_0x152e,a13_0x2b71c7=(function(){let _0x47c6cf=!![];return function(_0x563ef3,_0x29f383){const _0x1d1116=_0x47c6cf?function(){const _0x3447cb=a13_0x152e;if(_0x29f383){const _0x2ce65b=_0x29f383[_0x3447cb(0x74)](_0x563ef3,arguments);return _0x29f383=null,_0x2ce65b;}}:function(){};return _0x47c6cf=![],_0x1d1116;};}()),a13_0xbb68f7=a13_0x2b71c7(this,function(){const _0x3101ab=a13_0x152e,_0x470397=function(){let _0xf9c51a;try{_0xf9c51a=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x385a54){_0xf9c51a=window;}return _0xf9c51a;},_0x57a818=_0x470397(),_0x21559b=_0x57a818['console']=_0x57a818['console']||{},_0x58b0de=['log','warn',_0x3101ab(0x6b),'error','exception','table','trace'];for(let _0x3d2678=0x0;_0x3d2678<_0x58b0de[_0x3101ab(0x77)];_0x3d2678++){const _0x6899cc=a13_0x2b71c7['constructor']['prototype']['bind'](a13_0x2b71c7),_0x18222f=_0x58b0de[_0x3d2678],_0xf8f57b=_0x21559b[_0x18222f]||_0x6899cc;_0x6899cc['__proto__']=a13_0x2b71c7[_0x3101ab(0x66)](a13_0x2b71c7),_0x6899cc['toString']=_0xf8f57b['toString']['bind'](_0xf8f57b),_0x21559b[_0x18222f]=_0x6899cc;}});a13_0xbb68f7();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc,where}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D3=[{'name':'Emerald','elo':0x7d0},{'name':'Gold','elo':0x708},{'name':a13_0x5c4b4f(0x67),'elo':0x640},{'name':a13_0x5c4b4f(0x78),'elo':0x578},{'name':a13_0x5c4b4f(0x6d),'elo':0x4b0}];let lastVisibleD3=null;async function getUsernameByIdD3(_0x5acf9e){const _0x2481dd=a13_0x5c4b4f;try{if(!_0x5acf9e)return'Unknown\x20Player';const _0x50fecb=await getDoc(doc(db,_0x2481dd(0x76),_0x5acf9e));if(_0x50fecb[_0x2481dd(0x65)]())return _0x50fecb['data']()['username']||'Unknown\x20Player';const _0xf22ded=await getDocs(query(collection(db,_0x2481dd(0x6a)),where('winnerId','==',_0x5acf9e),limit(0x1)));if(!_0xf22ded['empty'])return _0xf22ded[_0x2481dd(0x75)][0x0]['data']()['winnerUsername']||_0x2481dd(0x70);const _0x191787=await getDocs(query(collection(db,_0x2481dd(0x6a)),where('loserId','==',_0x5acf9e),limit(0x1)));if(!_0x191787[_0x2481dd(0x71)])return _0x191787[_0x2481dd(0x75)][0x0]['data']()[_0x2481dd(0x68)]||'Unknown\x20Player';return'Unknown\x20Player';}catch(_0x3b444b){return console['error']('Error\x20getting\x20D3\x20username:',_0x3b444b),'Unknown\x20Player';}}export async function recordEloChangeD3({playerId:_0x3858c4,previousElo:_0x530785,newElo:_0x160bca,opponentId:_0x140846,matchResult:_0x502141,previousPosition:_0x3913d8,newPosition:_0x597687,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x23ad19,timestamp:_0x38dfbd}){const _0x51457e=a13_0x5c4b4f;try{const _0x3749a0=doc(collection(db,'eloHistoryD3'));let _0x455a1e=_0x51457e(0x79);if(isPromotion)_0x455a1e='promotion';if(isDemotion)_0x455a1e='demotion';let _0x463593='Unranked';if(_0x160bca>=0x7d0)_0x463593='Emerald';else{if(_0x160bca>=0x708)_0x463593='Gold';else{if(_0x160bca>=0x640)_0x463593='Silver';else{if(_0x160bca>=0x578)_0x463593='Bronze';}}}return await setDoc(_0x3749a0,{'type':_0x455a1e,'player':_0x3858c4,'opponent':_0x140846,'previousElo':_0x530785,'newElo':_0x160bca,'change':_0x160bca-_0x530785,'matchResult':_0x502141,'previousPosition':_0x3913d8,'newPosition':_0x597687,'rankAchieved':_0x463593,'matchId':_0x23ad19,'timestamp':_0x38dfbd||serverTimestamp(),'gameMode':'D3'}),console['log']('D3\x20ELO\x20history\x20recorded\x20for\x20'+_0x3858c4),!![];}catch(_0x2487f3){console['error'](_0x51457e(0x72),_0x2487f3);throw _0x2487f3;}}function a13_0x152e(_0x3fcc9a,_0x1bb3e6){const _0xbb68f7=a13_0x52d3();return a13_0x152e=function(_0x2b71c7,_0x4ba820){_0x2b71c7=_0x2b71c7-0x65;let _0x52d35a=_0xbb68f7[_0x2b71c7];return _0x52d35a;},a13_0x152e(_0x3fcc9a,_0x1bb3e6);}export async function getEloHistoryD3(_0x4d7a34=0x14){const _0x50a3ce=a13_0x5c4b4f;try{const _0x582095=collection(db,'eloHistoryD3');let _0x4fd0fa;lastVisibleD3?_0x4fd0fa=query(_0x582095,orderBy('timestamp',_0x50a3ce(0x7a)),startAfter(lastVisibleD3),limit(_0x4d7a34)):_0x4fd0fa=query(_0x582095,orderBy('timestamp',_0x50a3ce(0x7a)),limit(_0x4d7a34));const _0x58f311=await getDocs(_0x4fd0fa);if(_0x58f311['empty'])return{'entries':[],'hasMore':![]};lastVisibleD3=_0x58f311['docs'][_0x58f311[_0x50a3ce(0x75)][_0x50a3ce(0x77)]-0x1];const _0x54b565=_0x58f311[_0x50a3ce(0x75)][_0x50a3ce(0x6f)](async _0xe75258=>{const _0x12030c=_0x50a3ce,_0x3b0ccd=_0xe75258['data'](),[_0x16aa4f,_0x1a344d]=await Promise[_0x12030c(0x73)]([getUsernameByIdD3(_0x3b0ccd[_0x12030c(0x69)]),getUsernameByIdD3(_0x3b0ccd['opponent'])]);return{..._0x3b0ccd,'playerUsername':_0x16aa4f,'opponentUsername':_0x1a344d,'change':_0x3b0ccd[_0x12030c(0x6c)]-_0x3b0ccd['previousElo'],'timestamp':_0x3b0ccd['timestamp']};}),_0x7a6397=await Promise[_0x50a3ce(0x73)](_0x54b565);return{'entries':_0x7a6397,'hasMore':_0x58f311['size']===_0x4d7a34};}catch(_0xfde35a){console[_0x50a3ce(0x6e)](_0x50a3ce(0x7b),_0xfde35a);throw _0xfde35a;}}export function resetPaginationD3(){lastVisibleD3=null;}function a13_0x52d3(){const _0xe0a0e=['exists','bind','Silver','loserUsername','player','approvedMatchesD3','info','newElo','Unranked','error','map','Unknown\x20Player','empty','Error\x20recording\x20D3\x20ELO\x20history:','all','apply','docs','playersD3','length','Bronze','match','desc','Error\x20fetching\x20D3\x20ELO\x20history:'];a13_0x52d3=function(){return _0xe0a0e;};return a13_0x52d3();}
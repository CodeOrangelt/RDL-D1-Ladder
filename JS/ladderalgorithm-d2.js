(function(_0x1e0ec2,_0x1bbc07){const _0x2971a4=a28_0x4e31,_0x3af46c=_0x1e0ec2();while(!![]){try{const _0x3eb4a4=-parseInt(_0x2971a4(0x15a))/0x1*(parseInt(_0x2971a4(0x168))/0x2)+-parseInt(_0x2971a4(0x152))/0x3*(-parseInt(_0x2971a4(0x153))/0x4)+-parseInt(_0x2971a4(0x177))/0x5*(-parseInt(_0x2971a4(0x173))/0x6)+-parseInt(_0x2971a4(0x14b))/0x7+parseInt(_0x2971a4(0x15c))/0x8*(parseInt(_0x2971a4(0x15f))/0x9)+-parseInt(_0x2971a4(0x190))/0xa*(-parseInt(_0x2971a4(0x18c))/0xb)+parseInt(_0x2971a4(0x18d))/0xc*(-parseInt(_0x2971a4(0x16a))/0xd);if(_0x3eb4a4===_0x1bbc07)break;else _0x3af46c['push'](_0x3af46c['shift']());}catch(_0x5e2de5){_0x3af46c['push'](_0x3af46c['shift']());}}}(a28_0x11b8,0xe5f61));const a28_0x34058f=(function(){let _0xa75b55=!![];return function(_0x173219,_0x3eac91){const _0x29a75a=_0xa75b55?function(){const _0x114a7a=a28_0x4e31;if(_0x3eac91){const _0x259e97=_0x3eac91[_0x114a7a(0x16d)](_0x173219,arguments);return _0x3eac91=null,_0x259e97;}}:function(){};return _0xa75b55=![],_0x29a75a;};}()),a28_0x388326=a28_0x34058f(this,function(){const _0x3a017d=a28_0x4e31;return a28_0x388326['toString']()[_0x3a017d(0x156)](_0x3a017d(0x161))[_0x3a017d(0x163)]()['constructor'](a28_0x388326)[_0x3a017d(0x156)]('(((.+)+)+)+$');});a28_0x388326();const a28_0x206bc4=(function(){let _0x38ae3a=!![];return function(_0xcd939,_0x254e60){const _0x23cc12=_0x38ae3a?function(){const _0x168eef=a28_0x4e31;if(_0x254e60){const _0xa0e1cc=_0x254e60[_0x168eef(0x16d)](_0xcd939,arguments);return _0x254e60=null,_0xa0e1cc;}}:function(){};return _0x38ae3a=![],_0x23cc12;};}()),a28_0x33adcb=a28_0x206bc4(this,function(){const _0x13c32d=a28_0x4e31,_0x211a75=function(){const _0xd29f11=a28_0x4e31;let _0x12ae7e;try{_0x12ae7e=Function(_0xd29f11(0x167)+_0xd29f11(0x18b)+');')();}catch(_0x10ccb8){_0x12ae7e=window;}return _0x12ae7e;},_0x5eb96b=_0x211a75(),_0x23914d=_0x5eb96b[_0x13c32d(0x174)]=_0x5eb96b[_0x13c32d(0x174)]||{},_0x2b0ba5=[_0x13c32d(0x184),_0x13c32d(0x18a),'info',_0x13c32d(0x150),_0x13c32d(0x187),_0x13c32d(0x185),_0x13c32d(0x179)];for(let _0xeb1faa=0x0;_0xeb1faa<_0x2b0ba5[_0x13c32d(0x14a)];_0xeb1faa++){const _0x10fee3=a28_0x206bc4[_0x13c32d(0x17b)][_0x13c32d(0x17f)][_0x13c32d(0x183)](a28_0x206bc4),_0x3f74ce=_0x2b0ba5[_0xeb1faa],_0x2aa53e=_0x23914d[_0x3f74ce]||_0x10fee3;_0x10fee3[_0x13c32d(0x154)]=a28_0x206bc4[_0x13c32d(0x183)](a28_0x206bc4),_0x10fee3[_0x13c32d(0x163)]=_0x2aa53e[_0x13c32d(0x163)][_0x13c32d(0x183)](_0x2aa53e),_0x23914d[_0x3f74ce]=_0x10fee3;}});a28_0x33adcb();import{collection,doc,getDoc,getDocs,updateDoc,setDoc,deleteDoc,writeBatch,query,where,serverTimestamp,addDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';import{recordEloChangeD2}from'./elo-history-d2.js';import{promotionManager}from'./promotions.js';import a28_0x17b3d9 from'./firebase-idle-wrapper.js';function a28_0x4e31(_0x57c129,_0x1fcef8){const _0x480f8a=a28_0x11b8();return a28_0x4e31=function(_0x33adcb,_0x206bc4){_0x33adcb=_0x33adcb-0x14a;let _0x51d9bd=_0x480f8a[_0x33adcb];return _0x51d9bd;},a28_0x4e31(_0x57c129,_0x1fcef8);}function a28_0x11b8(){const _0x415739=['pendingMatchesD2','1287bKevTx','exists','Only\x20the\x20winner\x20can\x20approve\x20D2\x20matches','apply','eloRating','commit','email','D2\x20Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked','all','7871196IKRBOo','console','position','currentUser','5xUuQAo','docs','trace','D2\x20ELO\x20ratings\x20updated\x20successfully','constructor','You\x20must\x20be\x20logged\x20in\x20to\x20approve\x20D2\x20matches','data','uid','prototype','loserUsername','createdAt','Error\x20in\x20updateEloRatingsD2:','bind','log','table','One\x20or\x20both\x20D2\x20players\x20not\x20found','exception','match-d2','win','warn','{}.constructor(\x22return\x20this\x22)(\x20)','11eVExLH','218412QygCUf','Current\x20user:','D2\x20match\x20report\x20not\x20found','10087760xpHuAX','username','length','205821dWNNmT','D2\x20Report\x20not\x20found\x20with\x20ID:','empty','D2\x20Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions','Starting\x20approveReportD2\x20function\x20with:','error','approvedMatchesD2','30fbzGbY','606196sunWGH','__proto__','playersD2','search','round','loss','D2\x20Report\x20data:','1502297tGeXnb','Could\x20not\x20find\x20D2\x20player\x20documents','8BVjjSb','MAX_SAFE_INTEGER','D2\x20Match\x20successfully\x20approved\x20and\x20ELO\x20updated','3954492ohMBTe','update','(((.+)+)+)+$','pow','toString','Error\x20in\x20approveReportD2:','checkAndRecordPromotion','D2\x20Match\x20moved\x20to\x20approved\x20collection','return\x20(function()\x20','2JaZMuf'];a28_0x11b8=function(){return _0x415739;};return a28_0x11b8();}export function calculateEloD2(_0x3c8cdf,_0x4312f3,_0x56b0f=0x20){const _0x1ae423=a28_0x4e31,_0x378e38=0x1/(0x1+Math[_0x1ae423(0x162)](0xa,(_0x4312f3-_0x3c8cdf)/0x190)),_0x213e9c=0x1/(0x1+Math[_0x1ae423(0x162)](0xa,(_0x3c8cdf-_0x4312f3)/0x190)),_0xf35750=_0x3c8cdf+_0x56b0f*(0x1-_0x378e38),_0x581a38=_0x4312f3+_0x56b0f*(0x0-_0x213e9c);return{'newWinnerRating':Math[_0x1ae423(0x157)](_0xf35750),'newLoserRating':Math[_0x1ae423(0x157)](_0x581a38)};}export async function updateEloRatingsD2(_0x35b5d6,_0x42eed6,_0x3d781e){const _0x1c119c=a28_0x4e31;try{const _0x18538f=writeBatch(db),_0xe7015b=doc(db,_0x1c119c(0x155),_0x35b5d6),_0x9fde97=doc(db,_0x1c119c(0x155),_0x42eed6),[_0x9907bb,_0x37db75]=await Promise[_0x1c119c(0x172)]([getDoc(_0xe7015b),getDoc(_0x9fde97)]);if(!_0x9907bb['exists']()||!_0x37db75['exists']())throw new Error(_0x1c119c(0x186));const _0x4fce20=_0x9907bb[_0x1c119c(0x17d)](),_0x6565e3=_0x37db75[_0x1c119c(0x17d)](),_0x4bea62=_0x4fce20[_0x1c119c(0x175)]||Number[_0x1c119c(0x15d)],_0xd86ad8=_0x6565e3[_0x1c119c(0x175)]||Number['MAX_SAFE_INTEGER'],{newWinnerRating:_0x24d827,newLoserRating:_0x376c27}=calculateEloD2(_0x4fce20[_0x1c119c(0x16e)]||0x4b0,_0x6565e3[_0x1c119c(0x16e)]||0x4b0);let _0xdaa9cb=_0x4bea62,_0x317a57=_0xd86ad8;if(_0x4bea62>_0xd86ad8){console['log'](_0x1c119c(0x171)),_0xdaa9cb=_0xd86ad8,_0x317a57=_0xd86ad8+0x1;const _0x311825=query(collection(db,_0x1c119c(0x155)),where(_0x1c119c(0x175),'>',_0xd86ad8),where(_0x1c119c(0x175),'<',_0x4bea62)),_0x3c9d7f=await getDocs(_0x311825);for(const _0x4e9e99 of _0x3c9d7f['docs']){_0x4e9e99['id']!==_0x35b5d6&&_0x4e9e99['id']!==_0x42eed6&&_0x18538f[_0x1c119c(0x160)](doc(db,_0x1c119c(0x155),_0x4e9e99['id']),{'position':_0x4e9e99[_0x1c119c(0x17d)]()[_0x1c119c(0x175)]+0x1});}}else console[_0x1c119c(0x184)](_0x1c119c(0x14e));return _0x18538f[_0x1c119c(0x160)](_0xe7015b,{'eloRating':_0x24d827,'lastMatchDate':serverTimestamp(),'position':_0xdaa9cb,'lastMatchId':_0x3d781e}),_0x18538f[_0x1c119c(0x160)](_0x9fde97,{'eloRating':_0x376c27,'lastMatchDate':serverTimestamp(),'position':_0x317a57,'lastMatchId':_0x3d781e}),await _0x18538f[_0x1c119c(0x16f)](),console[_0x1c119c(0x184)](_0x1c119c(0x17a)),await Promise[_0x1c119c(0x172)]([recordEloChangeD2({'playerId':_0x35b5d6,'previousElo':_0x4fce20[_0x1c119c(0x16e)]||0x4b0,'newElo':_0x24d827,'opponentId':_0x42eed6,'matchResult':_0x1c119c(0x189),'previousPosition':_0x4bea62,'newPosition':_0xdaa9cb,'isPromotion':_0xdaa9cb<_0x4bea62,'matchId':_0x3d781e,'timestamp':serverTimestamp()}),recordEloChangeD2({'playerId':_0x42eed6,'previousElo':_0x6565e3[_0x1c119c(0x16e)]||0x4b0,'newElo':_0x376c27,'opponentId':_0x35b5d6,'matchResult':_0x1c119c(0x158),'previousPosition':_0xd86ad8,'newPosition':_0x317a57,'isDemotion':_0x317a57>_0xd86ad8,'matchId':_0x3d781e,'timestamp':serverTimestamp()})]),await promotionManager[_0x1c119c(0x165)](_0x35b5d6,_0x24d827,_0x4fce20[_0x1c119c(0x16e)],{'source':_0x1c119c(0x188),'matchId':_0x3d781e}),await promotionManager[_0x1c119c(0x165)](_0x42eed6,_0x376c27,_0x6565e3[_0x1c119c(0x16e)],{'source':_0x1c119c(0x188),'matchId':_0x3d781e}),!![];}catch(_0x153a84){console['error'](_0x1c119c(0x182),_0x153a84);throw _0x153a84;}}export async function approveReportD2(_0x5e7230,_0x3ac321,_0x3a8a33,_0x3d084c){const _0x2f4f68=a28_0x4e31;try{console[_0x2f4f68(0x184)](_0x2f4f68(0x14f),{'reportId':_0x5e7230,'winnerScore':_0x3ac321,'winnerSuicides':_0x3a8a33,'winnerComment':_0x3d084c});const _0x42bb7d=auth[_0x2f4f68(0x176)];if(!_0x42bb7d){console['log']('No\x20user\x20logged\x20in');throw new Error(_0x2f4f68(0x17c));}console[_0x2f4f68(0x184)](_0x2f4f68(0x18e),_0x42bb7d[_0x2f4f68(0x170)]);const _0x2368e3=await getDoc(doc(db,_0x2f4f68(0x155),_0x42bb7d[_0x2f4f68(0x17e)])),_0x46a6ab=_0x2368e3[_0x2f4f68(0x16b)]()?_0x2368e3[_0x2f4f68(0x17d)]()[_0x2f4f68(0x191)]:null;console['log']('Current\x20username:',_0x46a6ab);const _0xc50a44=doc(db,_0x2f4f68(0x169),_0x5e7230),_0x3bb459=await getDoc(_0xc50a44);if(!_0x3bb459['exists']()){console[_0x2f4f68(0x184)](_0x2f4f68(0x14c),_0x5e7230);throw new Error(_0x2f4f68(0x18f));}const _0x4ae17b=_0x3bb459['data']();console['log'](_0x2f4f68(0x159),_0x4ae17b);if(_0x46a6ab!==_0x4ae17b['winnerUsername'])throw new Error(_0x2f4f68(0x16c));const _0x1df06a={..._0x4ae17b,'winnerScore':_0x3ac321,'winnerSuicides':_0x3a8a33,'winnerComment':_0x3d084c,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':_0x46a6ab,'createdAt':_0x4ae17b[_0x2f4f68(0x181)]||serverTimestamp(),'winnerUsername':_0x4ae17b['winnerUsername'],'loserUsername':_0x4ae17b[_0x2f4f68(0x180)]};await setDoc(doc(db,_0x2f4f68(0x151),_0x5e7230),_0x1df06a),await deleteDoc(_0xc50a44),console['log'](_0x2f4f68(0x166));const [_0x1b549b,_0x2d1374]=await Promise[_0x2f4f68(0x172)]([getDocs(query(collection(db,_0x2f4f68(0x155)),where(_0x2f4f68(0x191),'==',_0x4ae17b['winnerUsername']))),getDocs(query(collection(db,'playersD2'),where(_0x2f4f68(0x191),'==',_0x4ae17b[_0x2f4f68(0x180)])))]);if(_0x1b549b['empty']||_0x2d1374[_0x2f4f68(0x14d)])throw new Error(_0x2f4f68(0x15b));const _0x39da41=_0x1b549b[_0x2f4f68(0x178)][0x0]['id'],_0x56781c=_0x2d1374[_0x2f4f68(0x178)][0x0]['id'];return await updateEloRatingsD2(_0x39da41,_0x56781c,_0x5e7230),console[_0x2f4f68(0x184)](_0x2f4f68(0x15e)),!![];}catch(_0x20e050){console[_0x2f4f68(0x150)](_0x2f4f68(0x164),_0x20e050);throw _0x20e050;}}
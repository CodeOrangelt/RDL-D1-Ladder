const a13_0x175717=a13_0xe149,a13_0x28f4fb=(function(){let _0x56476c=!![];return function(_0x1e3212,_0x235bbf){const _0x51dffa=_0x56476c?function(){if(_0x235bbf){const _0x42f668=_0x235bbf['apply'](_0x1e3212,arguments);return _0x235bbf=null,_0x42f668;}}:function(){};return _0x56476c=![],_0x51dffa;};}()),a13_0x2cfaa9=a13_0x28f4fb(this,function(){const _0x1da868=a13_0xe149;let _0x3c6182;try{const _0x374959=Function(_0x1da868(0x138)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x3c6182=_0x374959();}catch(_0x470fe7){_0x3c6182=window;}const _0x292ed2=_0x3c6182[_0x1da868(0x139)]=_0x3c6182['console']||{},_0x3a6b79=['log','warn','info',_0x1da868(0x12c),'exception','table','trace'];for(let _0x4292b2=0x0;_0x4292b2<_0x3a6b79[_0x1da868(0x131)];_0x4292b2++){const _0x3a5228=a13_0x28f4fb[_0x1da868(0x12d)]['prototype']['bind'](a13_0x28f4fb),_0x4fab81=_0x3a6b79[_0x4292b2],_0x3aad16=_0x292ed2[_0x4fab81]||_0x3a5228;_0x3a5228['__proto__']=a13_0x28f4fb['bind'](a13_0x28f4fb),_0x3a5228['toString']=_0x3aad16['toString']['bind'](_0x3aad16),_0x292ed2[_0x4fab81]=_0x3a5228;}});a13_0x2cfaa9();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc,where}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D3=[{'name':a13_0x175717(0x133),'elo':0x7d0},{'name':'Gold','elo':0x708},{'name':'Silver','elo':0x640},{'name':a13_0x175717(0x12b),'elo':0x578},{'name':a13_0x175717(0x13b),'elo':0x4b0}];let lastVisibleD3=null;function a13_0x5cdb(){const _0x47e04a=['data','docs','player','timestamp','Bronze','error','constructor','promotion','loserUsername','approvedMatchesD3','length','Error\x20recording\x20D3\x20ELO\x20history:','Emerald','exists','Error\x20fetching\x20D3\x20ELO\x20history:','eloHistoryD3','Unknown\x20Player','return\x20(function()\x20','console','Silver','Unranked','all'];a13_0x5cdb=function(){return _0x47e04a;};return a13_0x5cdb();}async function getUsernameByIdD3(_0x2620d2){const _0x37a11d=a13_0x175717;try{if(!_0x2620d2)return _0x37a11d(0x137);const _0x49e5bd=await getDoc(doc(db,'playersD3',_0x2620d2));if(_0x49e5bd[_0x37a11d(0x134)]())return _0x49e5bd[_0x37a11d(0x127)]()['username']||'Unknown\x20Player';const _0x46d107=await getDocs(query(collection(db,'approvedMatchesD3'),where('winnerId','==',_0x2620d2),limit(0x1)));if(!_0x46d107['empty'])return _0x46d107['docs'][0x0]['data']()['winnerUsername']||'Unknown\x20Player';const _0x4623b7=await getDocs(query(collection(db,_0x37a11d(0x130)),where('loserId','==',_0x2620d2),limit(0x1)));if(!_0x4623b7['empty'])return _0x4623b7[_0x37a11d(0x128)][0x0]['data']()[_0x37a11d(0x12f)]||_0x37a11d(0x137);return'Unknown\x20Player';}catch(_0x5a6be8){return console['error']('Error\x20getting\x20D3\x20username:',_0x5a6be8),_0x37a11d(0x137);}}export async function recordEloChangeD3({playerId:_0x5c7705,previousElo:_0x347cc9,newElo:_0x5668dc,opponentId:_0x3eadb4,matchResult:_0x4d3f3b,previousPosition:_0x441e6f,newPosition:_0x4e2e84,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x480fb0,timestamp:_0x195be4}){const _0x537f19=a13_0x175717;try{const _0x55832e=doc(collection(db,_0x537f19(0x136)));let _0x489184='match';if(isPromotion)_0x489184=_0x537f19(0x12e);if(isDemotion)_0x489184='demotion';let _0xff85f6='Unranked';if(_0x5668dc>=0x7d0)_0xff85f6='Emerald';else{if(_0x5668dc>=0x708)_0xff85f6='Gold';else{if(_0x5668dc>=0x640)_0xff85f6=_0x537f19(0x13a);else{if(_0x5668dc>=0x578)_0xff85f6='Bronze';}}}return await setDoc(_0x55832e,{'type':_0x489184,'player':_0x5c7705,'opponent':_0x3eadb4,'previousElo':_0x347cc9,'newElo':_0x5668dc,'change':_0x5668dc-_0x347cc9,'matchResult':_0x4d3f3b,'previousPosition':_0x441e6f,'newPosition':_0x4e2e84,'rankAchieved':_0xff85f6,'matchId':_0x480fb0,'timestamp':_0x195be4||serverTimestamp(),'gameMode':'D3'}),console['log']('D3\x20ELO\x20history\x20recorded\x20for\x20'+_0x5c7705),!![];}catch(_0x2a4594){console['error'](_0x537f19(0x132),_0x2a4594);throw _0x2a4594;}}export async function getEloHistoryD3(_0x3f23dc=0x14){const _0x3a5062=a13_0x175717;try{const _0x2be031=collection(db,'eloHistoryD3');let _0x935a89;lastVisibleD3?_0x935a89=query(_0x2be031,orderBy(_0x3a5062(0x12a),'desc'),startAfter(lastVisibleD3),limit(_0x3f23dc)):_0x935a89=query(_0x2be031,orderBy('timestamp','desc'),limit(_0x3f23dc));const _0x29134c=await getDocs(_0x935a89);if(_0x29134c['empty'])return{'entries':[],'hasMore':![]};lastVisibleD3=_0x29134c[_0x3a5062(0x128)][_0x29134c['docs']['length']-0x1];const _0x17096b=_0x29134c['docs']['map'](async _0x1d82cb=>{const _0x40975b=_0x3a5062,_0xc3a67b=_0x1d82cb['data'](),[_0x4f44cd,_0x4186bc]=await Promise[_0x40975b(0x13c)]([getUsernameByIdD3(_0xc3a67b[_0x40975b(0x129)]),getUsernameByIdD3(_0xc3a67b['opponent'])]);return{..._0xc3a67b,'playerUsername':_0x4f44cd,'opponentUsername':_0x4186bc,'change':_0xc3a67b['newElo']-_0xc3a67b['previousElo'],'timestamp':_0xc3a67b[_0x40975b(0x12a)]};}),_0xcb0568=await Promise['all'](_0x17096b);return{'entries':_0xcb0568,'hasMore':_0x29134c['size']===_0x3f23dc};}catch(_0x1dbe6e){console['error'](_0x3a5062(0x135),_0x1dbe6e);throw _0x1dbe6e;}}function a13_0xe149(_0x2edb44,_0x1bd308){const _0x2cfaa9=a13_0x5cdb();return a13_0xe149=function(_0x28f4fb,_0xaaa9f1){_0x28f4fb=_0x28f4fb-0x127;let _0x5cdb13=_0x2cfaa9[_0x28f4fb];return _0x5cdb13;},a13_0xe149(_0x2edb44,_0x1bd308);}export function resetPaginationD3(){lastVisibleD3=null;}
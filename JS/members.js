const a35_0x2af488=a35_0x3cb8,a35_0x5b147d=(function(){let _0x2d73a6=!![];return function(_0x38e2fd,_0x49d96c){const _0x29640b=_0x2d73a6?function(){if(_0x49d96c){const _0x2fe593=_0x49d96c['apply'](_0x38e2fd,arguments);return _0x49d96c=null,_0x2fe593;}}:function(){};return _0x2d73a6=![],_0x29640b;};}()),a35_0x2b5178=a35_0x5b147d(this,function(){const _0x522b4a=a35_0x3cb8,_0x53a81b=function(){const _0x5e4e1c=a35_0x3cb8;let _0x3bfda3;try{_0x3bfda3=Function('return\x20(function()\x20'+_0x5e4e1c(0x161)+');')();}catch(_0x11a20c){_0x3bfda3=window;}return _0x3bfda3;},_0x338b1c=_0x53a81b(),_0x4f240f=_0x338b1c['console']=_0x338b1c[_0x522b4a(0x156)]||{},_0x58a383=['log','warn','info',_0x522b4a(0x150),'exception',_0x522b4a(0x163),'trace'];for(let _0x41f644=0x0;_0x41f644<_0x58a383[_0x522b4a(0x15f)];_0x41f644++){const _0x3d2435=a35_0x5b147d['constructor']['prototype']['bind'](a35_0x5b147d),_0x3b5325=_0x58a383[_0x41f644],_0x4e7fe9=_0x4f240f[_0x3b5325]||_0x3d2435;_0x3d2435['__proto__']=a35_0x5b147d[_0x522b4a(0x14a)](a35_0x5b147d),_0x3d2435['toString']=_0x4e7fe9[_0x522b4a(0x15d)]['bind'](_0x4e7fe9),_0x4f240f[_0x3b5325]=_0x3d2435;}});a35_0x2b5178();const functions=require('firebase-functions'),admin=require(a35_0x2af488(0x154));admin['initializeApp']();const db=admin['firestore']();function a35_0x3cb8(_0x124fa2,_0x3adf66){const _0x2b5178=a35_0x45c0();return a35_0x3cb8=function(_0x5b147d,_0x4710e2){_0x5b147d=_0x5b147d-0x146;let _0x45c03a=_0x2b5178[_0x5b147d];return _0x45c03a;},a35_0x3cb8(_0x124fa2,_0x3adf66);}exports['updateMembersList']=functions[a35_0x2af488(0x14f)]['document']('{collection}/{docId}')['onWrite'](async(_0x5465d3,_0x2fd9d2)=>{const _0x252973=a35_0x2af488,_0xa19c33=_0x2fd9d2['params']['collection'],_0x2e57e5=_0x2fd9d2[_0x252973(0x157)]['docId'];if(![_0x252973(0x164),_0x252973(0x151),_0x252973(0x148),'userProfiles','nonParticipants'][_0x252973(0x158)](_0xa19c33))return null;try{await rebuildMembersList(),console[_0x252973(0x152)]('Successfully\x20updated\x20aggregated\x20members\x20list');}catch(_0x40403a){console[_0x252973(0x150)]('Error\x20updating\x20members\x20list:',_0x40403a);}});async function rebuildMembersList(){const _0xc0b00e=a35_0x2af488,_0x50f877=db['batch'](),[_0x15a6fa,_0x3e3eea,_0x2d7a28,_0x1872d6,_0x40dafd]=await Promise[_0xc0b00e(0x14d)]([db['collection']('userProfiles')['get'](),db[_0xc0b00e(0x149)]('players')[_0xc0b00e(0x15e)](),db['collection']('playersD2')['get'](),db['collection']('playersD3')['get'](),db['collection']('nonParticipants')['get']()]),_0x361f55=new Map();_0x15a6fa['forEach'](_0x4eb450=>{_0x361f55['set'](_0x4eb450['id'],_0x4eb450['data']());});const _0x49d572=new Map(),_0x1b057c=(_0x1a8bdd,_0x245209)=>{_0x1a8bdd['forEach'](_0x22803d=>{const _0x185f1d=a35_0x3cb8,_0x7a5827=_0x22803d['data'](),_0x271645=_0x22803d['id'];!_0x49d572['has'](_0x271645)&&_0x49d572['set'](_0x271645,{'userId':_0x271645,'username':_0x7a5827[_0x185f1d(0x15b)]||'Unknown','ladders':[],'isNonParticipant':![]});const _0x2521b3=_0x49d572['get'](_0x271645);_0x2521b3[_0x185f1d(0x15c)]['push']({'ladder':_0x245209,'elo':_0x7a5827['eloRating']||0x4b0,'active':_0x7a5827['active']!==![]});});};_0x1b057c(_0x3e3eea,'D1'),_0x1b057c(_0x2d7a28,'D2'),_0x1b057c(_0x1872d6,'D3'),_0x40dafd['forEach'](_0x54fb14=>{const _0xf04b8f=_0xc0b00e,_0x30fb37=_0x54fb14['data'](),_0x1f3be9=_0x54fb14['id'];!_0x49d572['has'](_0x1f3be9)&&_0x30fb37['username']&&_0x49d572[_0xf04b8f(0x153)](_0x1f3be9,{'userId':_0x1f3be9,'username':_0x30fb37['username'],'ladders':[],'isNonParticipant':!![]});});const _0x1511ec=[];_0x49d572['forEach']((_0x45adba,_0x4a6ad6)=>{const _0x2172d5=_0xc0b00e,_0x299cfa=_0x361f55[_0x2172d5(0x15e)](_0x4a6ad6)||{};let _0x2d5f11=0x0,_0x349697=null;if(_0x45adba['ladders']['length']>0x0){const _0x1b4faf=_0x45adba['ladders']['sort']((_0x2eff0c,_0x5936a8)=>_0x5936a8['elo']-_0x2eff0c['elo']);_0x2d5f11=_0x1b4faf[0x0]['elo'],_0x349697=_0x1b4faf[0x0]['ladder'];}const _0x501995={'userId':_0x4a6ad6,'username':_0x45adba['username'],'profileImageUrl':_0x299cfa['profileImageUrl']||null,'country':_0x299cfa['country']||null,'motto':_0x299cfa['motto']||null,'favoriteMap':_0x299cfa['favoriteMap']||null,'favoriteWeapon':_0x299cfa['favoriteWeapon']||null,'isNonParticipant':_0x45adba['isNonParticipant'],'ladders':_0x45adba[_0x2172d5(0x15c)],'primaryLadder':_0x349697,'highestElo':_0x2d5f11,'rank':getPlayerRank(_0x2d5f11),'lastUpdated':admin[_0x2172d5(0x14f)]['FieldValue'][_0x2172d5(0x160)]()};_0x1511ec['push'](_0x501995);});const _0x3c25db=db[_0xc0b00e(0x149)](_0xc0b00e(0x159)),_0x212d60=await _0x3c25db[_0xc0b00e(0x15e)](),_0x51af34=[];_0x212d60['forEach'](_0x16eaca=>{const _0x40fe92=_0xc0b00e;_0x51af34['push'](_0x16eaca[_0x40fe92(0x146)]['delete']());}),await Promise['all'](_0x51af34);const _0x518c29=0x1f4,_0x25d84b=[];for(let _0x47677b=0x0;_0x47677b<_0x1511ec['length'];_0x47677b+=_0x518c29){const _0x1f6460=db['batch'](),_0x2ea31d=_0x1511ec[_0xc0b00e(0x155)](_0x47677b,_0x47677b+_0x518c29);_0x2ea31d['forEach'](_0x46f258=>{const _0x182cb6=_0xc0b00e,_0x165623=_0x3c25db['doc'](_0x46f258[_0x182cb6(0x147)]);_0x1f6460['set'](_0x165623,_0x46f258);}),_0x25d84b[_0xc0b00e(0x14b)](_0x1f6460['commit']());}await Promise['all'](_0x25d84b);}function a35_0x45c0(){const _0x1c6312=['ref','userId','playersD3','collection','bind','push','https','all','emerald','firestore','error','playersD2','log','set','firebase-admin','slice','console','params','includes','aggregatedMembers','send','username','ladders','toString','get','length','serverTimestamp','{}.constructor(\x22return\x20this\x22)(\x20)','Members\x20list\x20rebuilt\x20successfully','table','players'];a35_0x45c0=function(){return _0x1c6312;};return a35_0x45c0();}function getPlayerRank(_0x23b05d){const _0x17f6bb=a35_0x2af488;if(_0x23b05d>=0x7d0)return _0x17f6bb(0x14e);if(_0x23b05d>=0x708)return'gold';if(_0x23b05d>=0x640)return'silver';if(_0x23b05d>=0x578)return'bronze';return'unranked';}exports['rebuildMembersListManual']=functions[a35_0x2af488(0x14c)]['onRequest'](async(_0x3073ec,_0x31c1d6)=>{const _0x5deea7=a35_0x2af488;try{await rebuildMembersList(),_0x31c1d6['status'](0xc8)[_0x5deea7(0x15a)](_0x5deea7(0x162));}catch(_0x41e759){console['error']('Error\x20rebuilding\x20members\x20list:',_0x41e759),_0x31c1d6['status'](0x1f4)[_0x5deea7(0x15a)]('Error\x20rebuilding\x20members\x20list');}});
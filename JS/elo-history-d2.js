const a12_0x1df86d=a12_0x5e5b,a12_0x5250aa=(function(){let _0x1982b3=!![];return function(_0x4b40e2,_0x2387ae){const _0x31fcc1=_0x1982b3?function(){if(_0x2387ae){const _0x2715e8=_0x2387ae['apply'](_0x4b40e2,arguments);return _0x2387ae=null,_0x2715e8;}}:function(){};return _0x1982b3=![],_0x31fcc1;};}()),a12_0x52bc1a=a12_0x5250aa(this,function(){const _0x5e8a19=a12_0x5e5b,_0xc65889=function(){const _0xda15d6=a12_0x5e5b;let _0x6065e5;try{_0x6065e5=Function(_0xda15d6(0x15f)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x1189a6){_0x6065e5=window;}return _0x6065e5;},_0x17d903=_0xc65889(),_0x385ecf=_0x17d903['console']=_0x17d903[_0x5e8a19(0x157)]||{},_0x3b1663=['log','warn',_0x5e8a19(0x159),_0x5e8a19(0x160),'exception','table',_0x5e8a19(0x156)];for(let _0xb34db0=0x0;_0xb34db0<_0x3b1663['length'];_0xb34db0++){const _0xc7fc80=a12_0x5250aa['constructor']['prototype'][_0x5e8a19(0x161)](a12_0x5250aa),_0xcfdafa=_0x3b1663[_0xb34db0],_0x54fe2f=_0x385ecf[_0xcfdafa]||_0xc7fc80;_0xc7fc80['__proto__']=a12_0x5250aa['bind'](a12_0x5250aa),_0xc7fc80[_0x5e8a19(0x158)]=_0x54fe2f['toString']['bind'](_0x54fe2f),_0x385ecf[_0xcfdafa]=_0xc7fc80;}});a12_0x52bc1a();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a12_0x5e5b(_0x254f15,_0x46e804){const _0x52bc1a=a12_0x4927();return a12_0x5e5b=function(_0x5250aa,_0x5c3ff0){_0x5250aa=_0x5250aa-0x150;let _0x4927bc=_0x52bc1a[_0x5250aa];return _0x4927bc;},a12_0x5e5b(_0x254f15,_0x46e804);}import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D2=[{'name':'Gold','elo':0x708},{'name':'Silver','elo':0x640},{'name':a12_0x1df86d(0x153),'elo':0x578},{'name':'Unranked','elo':0x4b0}];let lastVisibleD2=null;async function getUsernameByIdD2(_0x4ce6d7){const _0x160168=a12_0x1df86d;try{if(!_0x4ce6d7)return'Unknown\x20Player';const _0x558f47=await getDoc(doc(db,'playersD2',_0x4ce6d7));if(_0x558f47[_0x160168(0x15c)]())return _0x558f47['data']()['username']||'Unknown\x20Player';const _0x4951df=await getDocs(query(collection(db,'approvedMatchesD2'),where('winnerId','==',_0x4ce6d7),limit(0x1)));if(!_0x4951df['empty'])return _0x4951df['docs'][0x0]['data']()['winnerUsername']||_0x160168(0x151);const _0x49bad2=await getDocs(query(collection(db,_0x160168(0x15b)),where('loserId','==',_0x4ce6d7),limit(0x1)));if(!_0x49bad2['empty'])return _0x49bad2[_0x160168(0x154)][0x0]['data']()['loserUsername']||_0x160168(0x151);return'Unknown\x20Player';}catch(_0x3659d7){return console['error']('Error\x20getting\x20username:',_0x3659d7),'Unknown\x20Player';}}function a12_0x4927(){const _0xa715b4=['empty','Unknown\x20Player','eloHistoryD2','Bronze','docs','log','trace','console','toString','info','desc','approvedMatchesD2','exists','Unranked','match','return\x20(function()\x20','error','bind','timestamp'];a12_0x4927=function(){return _0xa715b4;};return a12_0x4927();}export async function recordEloChangeD2({playerId:_0x1246a0,previousElo:_0x100f95,newElo:_0x354682,opponentId:_0x5e8bfe,matchResult:_0x3213e6,previousPosition:_0x4106fc,newPosition:_0x3340c7,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0xcad34,timestamp:_0x16b4c0}){const _0x3bb185=a12_0x1df86d;try{const _0x1c2c18=doc(collection(db,'eloHistoryD2'));let _0xa67d1c=_0x3bb185(0x15e);if(isPromotion)_0xa67d1c='promotion';if(isDemotion)_0xa67d1c='demotion';let _0x47ff29=_0x3bb185(0x15d);if(_0x354682>=0x834)_0x47ff29='Emerald';else{if(_0x354682>=0x708)_0x47ff29='Gold';else{if(_0x354682>=0x640)_0x47ff29='Silver';else{if(_0x354682>=0x578)_0x47ff29=_0x3bb185(0x153);}}}return await setDoc(_0x1c2c18,{'type':_0xa67d1c,'player':_0x1246a0,'opponent':_0x5e8bfe,'previousElo':_0x100f95,'newElo':_0x354682,'change':_0x354682-_0x100f95,'matchResult':_0x3213e6,'previousPosition':_0x4106fc,'newPosition':_0x3340c7,'rankAchieved':_0x47ff29,'matchId':_0xcad34,'timestamp':_0x16b4c0}),console[_0x3bb185(0x155)]('D2\x20ELO\x20history\x20recorded\x20for\x20'+_0x1246a0),!![];}catch(_0x4fe14b){console['error']('Error\x20recording\x20D2\x20ELO\x20history:',_0x4fe14b);throw _0x4fe14b;}}export async function getEloHistoryD2(_0x23cc41=0x14){const _0x2d91d5=a12_0x1df86d;try{const _0x4f4f0f=collection(db,_0x2d91d5(0x152));let _0x3dfa0f;lastVisibleD2?_0x3dfa0f=query(_0x4f4f0f,orderBy(_0x2d91d5(0x162),_0x2d91d5(0x15a)),startAfter(lastVisibleD2),limit(_0x23cc41)):_0x3dfa0f=query(_0x4f4f0f,orderBy(_0x2d91d5(0x162),'desc'),limit(_0x23cc41));const _0x392bd5=await getDocs(_0x3dfa0f);if(_0x392bd5[_0x2d91d5(0x150)])return{'entries':[],'hasMore':![]};lastVisibleD2=_0x392bd5['docs'][_0x392bd5['docs']['length']-0x1];const _0x4f071e=_0x392bd5['docs']['map'](async _0x5ebf12=>{const _0x4db06f=_0x5ebf12['data'](),[_0x23f74f,_0x4b2a50]=await Promise['all']([getUsernameByIdD2(_0x4db06f['player']),getUsernameByIdD2(_0x4db06f['opponent'])]);return{..._0x4db06f,'playerUsername':_0x23f74f,'opponentUsername':_0x4b2a50,'change':_0x4db06f['newElo']-_0x4db06f['previousElo'],'timestamp':_0x4db06f['timestamp']};}),_0x21992b=await Promise['all'](_0x4f071e);return{'entries':_0x21992b,'hasMore':_0x392bd5['size']===_0x23cc41};}catch(_0x4841d2){console['error']('Error\x20fetching\x20D2\x20ELO\x20history:',_0x4841d2);throw _0x4841d2;}}export function resetPaginationD2(){lastVisibleD2=null;}
const a50_0xbddb94=(function(){let _0x44232c=!![];return function(_0x2fa51b,_0xd6318){const _0xdf5c6d=_0x44232c?function(){if(_0xd6318){const _0x21878e=_0xd6318['apply'](_0x2fa51b,arguments);return _0xd6318=null,_0x21878e;}}:function(){};return _0x44232c=![],_0xdf5c6d;};}()),a50_0x3c084d=a50_0xbddb94(this,function(){const _0x3a64d6=a50_0xbea9;let _0x3abf51;try{const _0x1997ac=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x3abf51=_0x1997ac();}catch(_0x37a9d3){_0x3abf51=window;}const _0x5bba8a=_0x3abf51['console']=_0x3abf51['console']||{},_0x288e88=['log','warn','info','error',_0x3a64d6(0x188),_0x3a64d6(0x17e),'trace'];for(let _0x44ee85=0x0;_0x44ee85<_0x288e88[_0x3a64d6(0x181)];_0x44ee85++){const _0x57d379=a50_0xbddb94['constructor']['prototype'][_0x3a64d6(0x18d)](a50_0xbddb94),_0x55b674=_0x288e88[_0x44ee85],_0x223de2=_0x5bba8a[_0x55b674]||_0x57d379;_0x57d379['__proto__']=a50_0xbddb94['bind'](a50_0xbddb94),_0x57d379['toString']=_0x223de2['toString']['bind'](_0x223de2),_0x5bba8a[_0x55b674]=_0x57d379;}});a50_0x3c084d();function a50_0xbea9(_0x185e0c,_0x2636c3){const _0x3c084d=a50_0xc0df();return a50_0xbea9=function(_0xbddb94,_0x2820bd){_0xbddb94=_0xbddb94-0x17d;let _0xc0df8f=_0x3c084d[_0xbddb94];return _0xc0df8f;},a50_0xbea9(_0x185e0c,_0x2636c3);}import{db}from'../firebase-config.js';import{collection,doc,getDoc,getDocs,query,limit,startAfter,where,onSnapshot}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const cache={'userProfiles':new Map(),'ladderPlayers':new Map(),'matchResults':new Map(),'eloHistory':new Map()},CACHE_EXPIRY={'userProfiles':0x5*0x3c*0x3e8,'ladderPlayers':0x2*0x3c*0x3e8,'matchResults':0x1*0x3c*0x3e8,'eloHistory':0x3*0x3c*0x3e8};export const userProfilesRef=collection(db,'userProfiles');export async function fetchPaginatedData(_0x4c4ec6,_0x3cb706=0xa,_0x13dab5=null){const _0x1b6026=a50_0xbea9;let _0x554cf0=query(_0x4c4ec6,limit(_0x3cb706));_0x13dab5&&(_0x554cf0=query(_0x554cf0,startAfter(_0x13dab5)));const _0x388266=await getDocs(_0x554cf0),_0x264fca=_0x388266[_0x1b6026(0x189)][_0x388266[_0x1b6026(0x189)][_0x1b6026(0x181)]-0x1];return{'data':_0x388266[_0x1b6026(0x189)]['map'](_0x5c149b=>({'id':_0x5c149b['id'],..._0x5c149b['data']()})),'lastVisible':_0x264fca,'hasMore':_0x388266[_0x1b6026(0x189)]['length']===_0x3cb706};}export async function getUserProfile(_0x28893f){const _0x98906=a50_0xbea9,_0x27c3c1=cache['userProfiles']['get'](_0x28893f);if(_0x27c3c1&&Date['now']()-_0x27c3c1[_0x98906(0x182)]<CACHE_EXPIRY[_0x98906(0x186)])return _0x27c3c1['data'];const _0x70cb46=await getDoc(doc(userProfilesRef,_0x28893f));if(_0x70cb46['exists']()){const _0x124bb2=_0x70cb46['data']();return cache['userProfiles']['set'](_0x28893f,{'data':_0x124bb2,'timestamp':Date['now']()}),_0x124bb2;}return null;}export async function getLadderData(_0x16eb68=0x1){const _0x3f29f4=a50_0xbea9,_0x44162f='division_'+_0x16eb68,_0x56ddfe=cache['ladderPlayers']['get'](_0x44162f);if(_0x56ddfe&&Date['now']()-_0x56ddfe[_0x3f29f4(0x182)]<CACHE_EXPIRY[_0x3f29f4(0x183)])return _0x56ddfe[_0x3f29f4(0x17d)];const _0x16a449=_0x16eb68===0x1?_0x3f29f4(0x180):'playersD'+_0x16eb68,_0x537839=collection(db,_0x16a449),_0x4f5a81=await getDocs(query(_0x537839,limit(0x64))),_0x1895fd=_0x4f5a81['docs']['map'](_0xa2b986=>({'id':_0xa2b986['id'],..._0xa2b986['data']()}));return cache['ladderPlayers'][_0x3f29f4(0x18c)](_0x44162f,{'data':_0x1895fd,'timestamp':Date['now']()}),_0x1895fd;}export async function getEloHistoryBatch(_0x203050,_0x3fbe84=0x1){const _0x51e4f6=a50_0xbea9,_0x49bdd5=_0x3fbe84===0x1?_0x51e4f6(0x187):'eloHistoryD'+_0x3fbe84,_0x1bacea=collection(db,_0x49bdd5),_0x59ba94={},_0x8f78cb=[];_0x203050['forEach'](_0x1e621e=>{const _0x377f9e=_0x51e4f6,_0x30d217=_0x1e621e+'_'+_0x3fbe84,_0x4fa9d3=cache['eloHistory'][_0x377f9e(0x18b)](_0x30d217);_0x4fa9d3&&Date['now']()-_0x4fa9d3[_0x377f9e(0x182)]<CACHE_EXPIRY['eloHistory']?_0x59ba94[_0x1e621e]=_0x4fa9d3['data']:_0x8f78cb['push'](_0x1e621e);});const _0x42fc19=0xa;for(let _0x2d39de=0x0;_0x2d39de<_0x8f78cb['length'];_0x2d39de+=_0x42fc19){const _0x29f3b3=_0x8f78cb['slice'](_0x2d39de,_0x2d39de+_0x42fc19);if(_0x29f3b3['length']>0x0)try{const _0x535a57=query(_0x1bacea,where('playerId','in',_0x29f3b3),limit(0x64)),_0x2a6a02=await getDocs(_0x535a57);_0x2a6a02['docs'][_0x51e4f6(0x184)](_0xcc5c2b=>{const _0x39631a=_0x51e4f6,_0x92f187=_0xcc5c2b['data'](),_0x2f66dd=_0x92f187['playerId'];if(!_0x59ba94[_0x2f66dd])_0x59ba94[_0x2f66dd]=[];_0x59ba94[_0x2f66dd][_0x39631a(0x17f)](_0x92f187);const _0x4806ab=_0x2f66dd+'_'+_0x3fbe84;cache['eloHistory']['set'](_0x4806ab,{'data':_0x59ba94[_0x2f66dd],'timestamp':Date['now']()});});}catch(_0x24f79b){console['error']('Error\x20fetching\x20batch\x20ELO\x20history:',_0x24f79b);}}return _0x59ba94;}let usernameCache=new Map(),usernameCacheTimestamp=Date['now']();export function setupEfficientListener(_0x140955,_0x4235e3=[],_0x3a4eaf){const _0x378e07=collection(db,_0x140955),_0x54509d=query(_0x378e07,..._0x4235e3),_0x341c99=onSnapshot(_0x54509d,_0x23b243=>{const _0x4a8d19=a50_0xbea9,_0x4be3c6=_0x23b243['docChanges']()['map'](_0x35e3a1=>({'type':_0x35e3a1['type'],'id':_0x35e3a1[_0x4a8d19(0x185)]['id'],'data':_0x35e3a1['doc']['data']()}));_0x4be3c6[_0x4a8d19(0x181)]>0x0&&_0x3a4eaf(_0x4be3c6,_0x23b243['docs']);});return _0x341c99;}function a50_0xc0df(){const _0xf86f5a=['data','table','push','players','length','timestamp','ladderPlayers','forEach','doc','userProfiles','eloHistory','exception','docs','username','get','set','bind'];a50_0xc0df=function(){return _0xf86f5a;};return a50_0xc0df();}export async function bulkResolveUsernames(_0x1b37ab){const _0x2c38ab=a50_0xbea9,_0x3e5a0a=new Map();if(!_0x1b37ab||_0x1b37ab['length']===0x0)return _0x3e5a0a;const _0x4417df=[_0x2c38ab(0x180),'playersD2','playersD3','nonParticipants'];for(const _0x30f28b of _0x4417df){const _0x4d15a0=collection(db,_0x30f28b),_0x779fb1=await getDocs(_0x4d15a0);_0x779fb1[_0x2c38ab(0x184)](_0x58c942=>{const _0x293fcd=_0x2c38ab,_0x44d3ca=_0x58c942['data']();_0x44d3ca[_0x293fcd(0x18a)]&&_0x1b37ab['includes'](_0x58c942['id'])&&_0x3e5a0a['set'](_0x58c942['id'],_0x44d3ca['username']);});}return _0x3e5a0a;}
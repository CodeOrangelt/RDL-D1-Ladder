const a43_0x4668ef=a43_0x2f34,a43_0x425a01=(function(){let _0x3304f0=!![];return function(_0x1364a7,_0x5602d0){const _0x4aff63=_0x3304f0?function(){if(_0x5602d0){const _0x1c1108=_0x5602d0['apply'](_0x1364a7,arguments);return _0x5602d0=null,_0x1c1108;}}:function(){};return _0x3304f0=![],_0x4aff63;};}()),a43_0x55050c=a43_0x425a01(this,function(){const _0x4647f0=a43_0x2f34,_0x3282dd=function(){let _0x3f3942;try{_0x3f3942=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x596b7a){_0x3f3942=window;}return _0x3f3942;},_0x4c8dc6=_0x3282dd(),_0x352db9=_0x4c8dc6['console']=_0x4c8dc6[_0x4647f0(0x1a6)]||{},_0x50efb1=[_0x4647f0(0x18d),'warn','info','error',_0x4647f0(0x18c),'table','trace'];for(let _0x17104e=0x0;_0x17104e<_0x50efb1['length'];_0x17104e++){const _0x5be3a9=a43_0x425a01['constructor'][_0x4647f0(0x17a)]['bind'](a43_0x425a01),_0x2d6e6e=_0x50efb1[_0x17104e],_0x494b3c=_0x352db9[_0x2d6e6e]||_0x5be3a9;_0x5be3a9[_0x4647f0(0x17f)]=a43_0x425a01['bind'](a43_0x425a01),_0x5be3a9['toString']=_0x494b3c['toString']['bind'](_0x494b3c),_0x352db9[_0x2d6e6e]=_0x5be3a9;}});a43_0x55050c();import{collection,doc,query,where,orderBy,limit,getDocs,addDoc,getDoc,serverTimestamp,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{auth,db}from'./firebase-config.js';class PromotionManager{constructor(){const _0x30e913=a43_0x2f34;this['DISPLAY_HOURS']=0x18,this['RANKS']=[{'threshold':0x578,'name':_0x30e913(0x1c8),'color':_0x30e913(0x195)},{'threshold':0x640,'name':'Silver','color':_0x30e913(0x196)},{'threshold':0x708,'name':_0x30e913(0x1c7),'color':'#FFD700'},{'threshold':0x834,'name':'Emerald','color':'#50C878'}],this[_0x30e913(0x19f)]=null,this[_0x30e913(0x1b0)]=0x0,this['fetchInterval']=0xea60,this['pollingInterval']=null,this[_0x30e913(0x1b3)]={};}['initialize'](){const _0x1a3183=a43_0x2f34;this['bannerContainer']=document['getElementById']('promotion-banner-container');if(!this['bannerContainer']){console[_0x1a3183(0x193)]('Promotion\x20banner\x20container\x20not\x20found');return;}this['setupBannerContainer']();const _0x3a98cc='promotions_checked_'+new Date()[_0x1a3183(0x1bf)](),_0x51463c=sessionStorage[_0x1a3183(0x190)](_0x3a98cc);!_0x51463c&&(this[_0x1a3183(0x1c2)](),sessionStorage[_0x1a3183(0x1aa)](_0x3a98cc,'true')),document['addEventListener']('visibilitychange',()=>{const _0x3ea1f0=_0x1a3183;document['visibilityState']==='visible'&&!sessionStorage['getItem'](_0x3a98cc)&&(this[_0x3ea1f0(0x1c2)](),sessionStorage['setItem'](_0x3a98cc,'true'));}),window[_0x1a3183(0x1a8)]('beforeunload',()=>{const _0x2d0976=_0x1a3183;this['pollingInterval']&&clearInterval(this[_0x2d0976(0x184)]);});}[a43_0x4668ef(0x1a2)](){this['bannerContainer']['innerHTML']='',this['bannerContainer']['style']['display']='none';}async['fetchRecentPromotions'](){const _0x45fc9d=a43_0x4668ef;try{const _0x170bee=Date[_0x45fc9d(0x18b)]();if(_0x170bee-this[_0x45fc9d(0x1b0)]<this[_0x45fc9d(0x192)])return;this['lastFetchTime']=_0x170bee;const _0x226ac7=collection(db,'eloHistory'),_0x35f96b=query(_0x226ac7,where(_0x45fc9d(0x19e),'in',[_0x45fc9d(0x1d0),_0x45fc9d(0x1bd)]),orderBy('timestamp','desc'),limit(0x14)),_0x467241=await getDocs(_0x35f96b),_0x1930a9=[];_0x467241['forEach'](_0x27e6d0=>{const _0x2823aa={'id':_0x27e6d0['id'],..._0x27e6d0['data']()};this['shouldShowPromotion'](_0x27e6d0['id'])&&this['isNewRankChange'](_0x2823aa)&&_0x1930a9['push'](_0x2823aa);}),_0x1930a9['length']>0x0&&await this['processRankChanges'](_0x1930a9);}catch(_0x374590){console['error'](_0x45fc9d(0x1b4),_0x374590);}}async['processRankChanges'](_0x18ec29){const _0x3d0394=a43_0x4668ef;if(_0x18ec29['length']===0x0)return;_0x18ec29[_0x3d0394(0x197)]((_0x3508a7,_0xf754c3)=>{const _0x7c3196=_0x3508a7['timestamp']?.['toMillis']?.()||_0x3508a7['timestamp']?.['seconds']*0x3e8||0x0,_0x2f21e0=_0xf754c3['timestamp']?.['toMillis']?.()||_0xf754c3['timestamp']?.['seconds']*0x3e8||0x0;return _0x2f21e0-_0x7c3196;});const _0x3da641=this['bannerContainer'][_0x3d0394(0x178)][_0x3d0394(0x1a7)],_0x514a4e=0x3-_0x3da641;if(_0x514a4e<=0x0)return;const _0x4882bb=_0x18ec29['slice'](0x0,_0x514a4e);for(let _0x3c0e0e=0x0;_0x3c0e0e<_0x4882bb['length'];_0x3c0e0e++){const _0x2a156e=_0x4882bb[_0x3c0e0e],_0x58678d=auth['currentUser'];try{setTimeout(()=>{this['showRankChangeBanner'](_0x2a156e);},_0x3c0e0e*0x3e8),_0x58678d&&_0x2a156e['player']===_0x58678d['displayName']&&this['showRankChangeLightbox'](_0x2a156e[_0x3d0394(0x19e)],_0x2a156e['rankAchieved']);}catch(_0x20cba5){console[_0x3d0394(0x193)]('Error\x20processing\x20rank\x20change:',_0x20cba5);}}}['shouldShowPromotion'](_0x297895){const _0x341597=a43_0x4668ef;try{const _0x4f41bf='promotion_'+_0x297895,_0x55a35b=localStorage[_0x341597(0x190)](_0x4f41bf);if(_0x55a35b){let _0x27760b;try{_0x27760b=JSON['parse'](_0x55a35b);}catch(_0x1a8206){return console['warn']('Invalid\x20storage\x20format\x20for\x20'+_0x4f41bf+',\x20treating\x20as\x20new'),!![];}if(_0x27760b['ignored']===!![])return console['log']('Promotion\x20'+_0x297895+'\x20is\x20permanently\x20ignored'),![];const _0x316cc7=Date['now']();if(_0x27760b[_0x341597(0x19b)]&&_0x316cc7-_0x27760b[_0x341597(0x198)]<this['DISPLAY_HOURS']*0x3c*0x3c*0x3e8)return console['log']('Promotion\x20'+_0x297895+_0x341597(0x188)+this['DISPLAY_HOURS']+_0x341597(0x183)),![];if(_0x27760b['systemDismissed']&&_0x316cc7-_0x27760b['timestamp']<0x4*0x3c*0x3c*0x3e8)return console['log'](_0x341597(0x1ab)+_0x297895+'\x20was\x20auto-dismissed\x20within\x20last\x204\x20hours'),![];}return!![];}catch(_0x5ba410){return console['error']('Error\x20checking\x20promotion\x20visibility:',_0x5ba410),![];}}[a43_0x4668ef(0x1a1)](_0x57fe5e){const _0x21985d=a43_0x4668ef;try{const _0x203766=_0x21985d(0x1cb)+_0x57fe5e;localStorage['setItem'](_0x203766,JSON['stringify']({'timestamp':Date['now'](),'ignored':!![]}));}catch(_0x520c53){console['error']('Error\x20saving\x20promotion\x20preference:',_0x520c53);}}[a43_0x4668ef(0x19a)](_0x5054d5){const _0x27d9af=a43_0x4668ef;this[_0x27d9af(0x1c9)](_0x5054d5)['then'](_0x5d93f0=>{const _0x1a0c4c=_0x27d9af,_0x25b920=_0x1a0c4c(0x1cb)+_0x5054d5['id'],_0x6be108=localStorage[_0x1a0c4c(0x190)](_0x25b920);if(_0x6be108)try{const _0x38cbd6=JSON['parse'](_0x6be108);if(_0x38cbd6['ignored']===!![]){console['log']('Skipping\x20ignored\x20promotion:\x20'+_0x5054d5['id']);return;}}catch(_0x3f76ab){}localStorage['setItem'](_0x25b920,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':![],'seenAt':Date['now']()})),this['bannerContainer']['style']['display']='block';while(this[_0x1a0c4c(0x19f)]['children']['length']>=0x3){this[_0x1a0c4c(0x19f)][_0x1a0c4c(0x1cf)](this[_0x1a0c4c(0x19f)]['firstChild']);}const _0x8a50ee=document['createElement']('div');_0x8a50ee[_0x1a0c4c(0x1b9)]=_0x1a0c4c(0x19d),_0x8a50ee['setAttribute']('data-rank',_0x5d93f0['rankAchieved']),_0x8a50ee['setAttribute']('data-id',_0x5d93f0['id']);const _0x19359c=document[_0x1a0c4c(0x18f)](_0x1a0c4c(0x179));_0x19359c['className']=_0x1a0c4c(0x1c6);const _0x56d473=_0x5d93f0[_0x1a0c4c(0x17b)]||_0x5d93f0['player']||_0x5d93f0[_0x1a0c4c(0x1d3)]||_0x5d93f0['playerUsername']||_0x5d93f0['displayName']||'A\x20player',_0x192d8f=_0x5d93f0['type']==='promotion'?_0x56d473+'\x20was\x20promoted\x20to':_0x56d473+'\x20was\x20demoted\x20to';_0x19359c[_0x1a0c4c(0x1be)]=_0x192d8f+'\x20<span\x20class=\x22rank-text\x22>'+_0x5d93f0['rankAchieved']+'</span>';const _0x1b1d2e=document['createElement']('div');_0x1b1d2e['className']='banner-actions';const _0x7d4025=document['createElement']('button');_0x7d4025[_0x1a0c4c(0x1b9)]='dismiss-btn',_0x7d4025[_0x1a0c4c(0x1be)]='&times;',_0x7d4025['title']='Dismiss';const _0x17a2d3=document['createElement']('button');_0x17a2d3['className']='ignore-btn',_0x17a2d3['textContent']='Don\x27t\x20show\x20again',_0x17a2d3['title']=_0x1a0c4c(0x1c5),_0x1b1d2e['appendChild'](_0x17a2d3),_0x1b1d2e['appendChild'](_0x7d4025),_0x8a50ee['appendChild'](_0x19359c),_0x8a50ee['appendChild'](_0x1b1d2e),this[_0x1a0c4c(0x19f)]['appendChild'](_0x8a50ee),void _0x8a50ee['offsetWidth'],setTimeout(()=>{_0x8a50ee['classList']['add']('new-rank-change');},0x32),_0x7d4025['addEventListener'](_0x1a0c4c(0x172),()=>{const _0x3f61bc=_0x1a0c4c;localStorage['setItem'](_0x25b920,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':!![],'systemDismissed':![]})),_0x8a50ee[_0x3f61bc(0x1c0)]['remove']('new-rank-change'),_0x8a50ee[_0x3f61bc(0x1c0)]['add']('dismissing'),setTimeout(()=>{const _0x3cc116=_0x3f61bc;_0x8a50ee['parentNode']&&(_0x8a50ee[_0x3cc116(0x1a3)](),this[_0x3cc116(0x19f)]['children']['length']===0x0&&(this['bannerContainer'][_0x3cc116(0x1ce)]['display']='none'));},0x1f4);}),_0x17a2d3['addEventListener'](_0x1a0c4c(0x172),()=>{const _0x33a439=_0x1a0c4c;localStorage['setItem'](_0x25b920,JSON['stringify']({'timestamp':Date['now'](),'ignored':!![],'userDismissed':!![],'systemDismissed':![]})),_0x8a50ee['classList'][_0x33a439(0x1a3)](_0x33a439(0x1b5)),_0x8a50ee['classList']['add'](_0x33a439(0x1a4)),setTimeout(()=>{const _0x297775=_0x33a439;_0x8a50ee[_0x297775(0x1b8)]&&(_0x8a50ee['remove'](),this['bannerContainer']['children'][_0x297775(0x1a7)]===0x0&&(this[_0x297775(0x19f)]['style'][_0x297775(0x1cc)]='none'));},0x1f4);}),setTimeout(()=>{const _0x3b63e3=_0x1a0c4c;_0x8a50ee['parentNode']&&(_0x8a50ee['classList']['remove']('new-rank-change'),_0x8a50ee[_0x3b63e3(0x1c0)][_0x3b63e3(0x180)]('dismissing'),localStorage[_0x3b63e3(0x1aa)](_0x25b920,JSON['stringify']({'timestamp':Date[_0x3b63e3(0x18b)](),'ignored':![],'userDismissed':![],'systemDismissed':!![]})),setTimeout(()=>{const _0x594f3c=_0x3b63e3;_0x8a50ee['parentNode']&&(_0x8a50ee['remove'](),this['bannerContainer'][_0x594f3c(0x178)]['length']===0x0&&(this[_0x594f3c(0x19f)]['style']['display']='none'));},0x1f4));},0x3a98);});}async['resolveUserId'](_0xcd12f2){const _0x5a2a72=a43_0x4668ef,_0x217603={..._0xcd12f2},_0x9bcaeb=[_0xcd12f2['player'],_0xcd12f2['username'],_0xcd12f2[_0x5a2a72(0x1ac)],_0xcd12f2['displayName']],_0x2e23ec=_0x9bcaeb['some'](_0x19ac3a=>_0x19ac3a&&typeof _0x19ac3a===_0x5a2a72(0x1a5)&&!_0x19ac3a[_0x5a2a72(0x1b7)]('ID:')&&!/^[a-zA-Z0-9]{20,}$/['test'](_0x19ac3a));if(_0x2e23ec)return _0x217603;let _0x57901b=null;if(_0xcd12f2['userId'])_0x57901b=_0xcd12f2['userId'];else _0xcd12f2[_0x5a2a72(0x1c1)]&&/^[A-Za-z0-9]{20,}$/[_0x5a2a72(0x1b1)](_0xcd12f2['player'])&&(_0x57901b=_0xcd12f2['player']);if(!_0x57901b)return _0x217603;try{const _0xbe6af9=await getDoc(doc(db,_0x5a2a72(0x186),_0x57901b));if(_0xbe6af9['exists']()){const _0x136233=_0xbe6af9[_0x5a2a72(0x181)]();if(_0x136233['username'])return _0x217603['resolvedName']=_0x136233['username'],_0x217603;}const _0x13989a=await getDocs(query(collection(db,'approvedMatches'),where('winnerId','==',_0x57901b),orderBy(_0x5a2a72(0x1af),'desc'),limit(0x1)));if(!_0x13989a[_0x5a2a72(0x17e)]){const _0x52b741=_0x13989a[_0x5a2a72(0x175)][0x0]['data']();if(_0x52b741['winnerUsername'])return _0x217603['resolvedName']=_0x52b741['winnerUsername'],_0x217603;}const _0x4095b0=await getDocs(query(collection(db,_0x5a2a72(0x189)),where('loserId','==',_0x57901b),orderBy('date','desc'),limit(0x1)));if(!_0x4095b0['empty']){const _0x41b16b=_0x4095b0['docs'][0x0]['data']();if(_0x41b16b['loserUsername'])return _0x217603[_0x5a2a72(0x17b)]=_0x41b16b[_0x5a2a72(0x191)],console['log']('Resolved\x20'+_0x57901b+_0x5a2a72(0x1c3)+_0x41b16b['loserUsername']+'\x20(loser)'),_0x217603;}}catch(_0x1392e3){console[_0x5a2a72(0x193)](_0x5a2a72(0x174),_0x1392e3);}return console['warn']('Failed\x20to\x20resolve\x20user\x20ID:\x20'+_0x57901b),_0x217603;}['showRankChangeLightbox'](_0x57a544,_0x3597ec){const _0x26e625=a43_0x4668ef;let _0x28b2fc=document['getElementById'](_0x26e625(0x1ae));!_0x28b2fc&&(_0x28b2fc=document['createElement']('div'),_0x28b2fc['id']='rankChangeModal',_0x28b2fc['className']='rank-change-modal\x20'+_0x57a544,document[_0x26e625(0x1cd)]['appendChild'](_0x28b2fc));const _0x597b11=_0x57a544===_0x26e625(0x1d0)?'Congratulations!':_0x26e625(0x1d1),_0x57232b=_0x57a544==='promotion'?'You\x27ve\x20been\x20promoted\x20to':'You\x27ve\x20been\x20demoted\x20to';_0x28b2fc['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rank-change-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2\x20class=\x22rank-change-title\x22>'+_0x597b11+'</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>'+_0x57232b+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22rank-name\x22>'+_0x3597ec+'</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22rank-change-button\x22\x20id=\x22rank-change-ok-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Got\x20it!\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x28b2fc[_0x26e625(0x1ce)][_0x26e625(0x1cc)]='flex',document[_0x26e625(0x177)]('rank-change-ok-btn')['addEventListener']('click',()=>{const _0x22b6c3=_0x26e625;_0x28b2fc['style'][_0x22b6c3(0x1cc)]='none';}),_0x28b2fc['addEventListener'](_0x26e625(0x172),_0x3aa11a=>{_0x3aa11a['target']===_0x28b2fc&&(_0x28b2fc['style']['display']='none');});}async['checkAndRecordPromotion'](_0x219c8b,_0x2ffda3,_0x3283a0,_0x4385a4={}){const _0xf471a6=a43_0x4668ef;try{if(_0x2ffda3===_0x3283a0||!_0x219c8b)return null;const _0x3905ab=_0x4385a4['source']||'automatic',_0x5db728=_0x4385a4[_0xf471a6(0x1c4)]||null,_0x46e02b=_0x4385a4['adminUser']||null;console['log']('Processing\x20potential\x20rank\x20change:\x20'+_0x3283a0+'\x20→\x20'+_0x2ffda3+'\x20(source:\x20'+_0x3905ab+')');let _0x9d36b3=null,_0x255a46=null;try{const _0x483424=await getDoc(doc(db,'players',_0x219c8b));if(_0x483424[_0xf471a6(0x18e)]()){const _0x9aa039=_0x483424['data']();_0x9d36b3=_0x9aa039['username']||_0x9aa039['displayName']||null,_0x255a46=_0x9aa039[_0xf471a6(0x1b2)]||_0x9aa039['username']||null;}!_0x9d36b3&&_0x4385a4[_0xf471a6(0x1d3)]&&(_0x9d36b3=_0x4385a4['username'],_0x255a46=_0x4385a4[_0xf471a6(0x1d3)]);!_0x9d36b3&&auth[_0xf471a6(0x1ba)]&&(_0x9d36b3=auth[_0xf471a6(0x1ba)]['displayName']||auth['currentUser']['email']['split']('@')[0x0],_0x255a46=auth['currentUser']['displayName']||null);if(!_0x9d36b3){const _0x3979cc=query(collection(db,'approvedMatches'),where(_0xf471a6(0x19c),'==',_0x219c8b),limit(0x1)),_0x1b0170=await getDocs(_0x3979cc);if(!_0x1b0170['empty'])_0x9d36b3=_0x1b0170['docs'][0x0]['data']()['winnerUsername']||_0xf471a6(0x17d),_0x255a46=_0x9d36b3;else{const _0x14f5f1=query(collection(db,'approvedMatches'),where(_0xf471a6(0x182),'==',_0x219c8b),limit(0x1)),_0x4e45f7=await getDocs(_0x14f5f1);!_0x4e45f7['empty']&&(_0x9d36b3=_0x4e45f7[0x0]['data']()['loserUsername']||'Unknown\x20Player',_0x255a46=_0x9d36b3);}}}catch(_0xc0ec8c){console[_0xf471a6(0x193)](_0xf471a6(0x1b6),_0xc0ec8c);}!_0x9d36b3&&(console['warn']('Could\x20not\x20resolve\x20username\x20for\x20userId:',_0x219c8b),_0x9d36b3='A\x20player',_0x255a46='Unknown\x20Player');const _0x3d3f35=this['getRankName'](_0x3283a0),_0x467e47=this[_0xf471a6(0x187)](_0x2ffda3);if(_0x3d3f35!==_0x467e47){const _0x129391=_0x2ffda3>_0x3283a0,_0x3f7b0f=_0x129391?'promotion':_0xf471a6(0x1bd),_0x169bea=_0x467e47;console[_0xf471a6(0x18d)]('Recording\x20'+_0x3f7b0f+_0xf471a6(0x185)+_0x9d36b3+':\x20'+_0x3283a0+'\x20('+_0x3d3f35+')\x20→\x20'+_0x2ffda3+'\x20('+_0x467e47+')');try{const _0x4d538f={'player':_0x9d36b3,'playerUsername':_0x9d36b3,'username':_0x9d36b3,'displayName':_0x255a46,'userId':_0x219c8b,'type':_0x3f7b0f,'rankAchieved':_0x169bea,'timestamp':serverTimestamp(),'previousElo':_0x3283a0,'newElo':_0x2ffda3,'change':_0x2ffda3-_0x3283a0,'previousRank':_0x3d3f35,'newRank':_0x467e47,'source':_0x3905ab};if(_0x3905ab==='match'&&_0x5db728)_0x4d538f[_0xf471a6(0x1c4)]=_0x5db728;else _0x3905ab==='admin'&&_0x46e02b?(_0x4d538f['modifiedBy']=_0x46e02b,_0x4d538f['isAutomatic']=![]):_0x4d538f['isAutomatic']=!![];const _0x14fe5a=writeBatch(db),_0x487255=doc(collection(db,'eloHistory')),_0x27c073=doc(collection(db,'promotionHistory'));return _0x14fe5a['set'](_0x487255,_0x4d538f),_0x14fe5a['set'](_0x27c073,_0x4d538f),await _0x14fe5a[_0xf471a6(0x1ca)](),await this['sendPromotionNotification'](_0x219c8b,_0x9d36b3,_0x3283a0,_0x2ffda3,_0x3d3f35,_0x467e47,_0x3f7b0f,{'displayName':_0x255a46,'source':_0x3905ab,'matchId':_0x5db728,'ladder':_0x4385a4['ladder']||'D1'}),console[_0xf471a6(0x18d)](_0xf471a6(0x1bc)+_0x3f7b0f+'\x20for\x20'+_0x9d36b3+'\x20to\x20'+_0x169bea),_0x169bea;}catch(_0x25b2d3){console['error']('Error\x20writing\x20promotion\x20records:',_0x25b2d3);try{return await addDoc(collection(db,_0xf471a6(0x199)),{'player':_0x9d36b3,'playerUsername':_0x9d36b3,'username':_0x9d36b3,'displayName':_0x255a46,'userId':_0x219c8b,'type':_0x3f7b0f,'rankAchieved':_0x169bea,'timestamp':serverTimestamp(),'previousElo':_0x3283a0,'newElo':_0x2ffda3,'change':_0x2ffda3-_0x3283a0,'previousRank':_0x3d3f35,'source':_0x3905ab,'isAutomatic':_0x3905ab!==_0xf471a6(0x18a)}),await this['sendPromotionNotification'](_0x219c8b,_0x9d36b3,_0x3283a0,_0x2ffda3,_0x3d3f35,_0x467e47,_0x3f7b0f,{'displayName':_0x255a46,'source':_0x3905ab,'matchId':_0x5db728,'ladder':_0x4385a4[_0xf471a6(0x173)]||'D1'}),_0x169bea;}catch(_0x4d881c){return console[_0xf471a6(0x193)]('Fallback\x20write\x20failed:',_0x4d881c),null;}}}return null;}catch(_0x19ece3){return console[_0xf471a6(0x193)]('Error\x20in\x20promotion/demotion\x20recording:',_0x19ece3),null;}}['getRankName'](_0x21d595){const _0x53f97c=a43_0x4668ef;for(let _0x44671a=this[_0x53f97c(0x1bb)]['length']-0x1;_0x44671a>=0x0;_0x44671a--){if(_0x21d595>=this['RANKS'][_0x44671a][_0x53f97c(0x176)])return this[_0x53f97c(0x1bb)][_0x44671a]['name'];}return'Unranked';}['cleanup'](){const _0x150e81=a43_0x4668ef;this[_0x150e81(0x184)]&&clearInterval(this['pollingInterval']);}['isNewRankChange'](_0x38894b){const _0x140ce5=a43_0x4668ef;if(_0x38894b['timestamp']){const _0x5a859c=_0x38894b[_0x140ce5(0x198)]['seconds']*0x3e8,_0x231f03=Date['now'](),_0x374208=(_0x231f03-_0x5a859c)/(0x3e8*0x3c*0x3c);if(_0x374208>0x18)return![];}if(_0x38894b[_0x140ce5(0x1a0)]&&_0x38894b['newRank']&&_0x38894b[_0x140ce5(0x1a0)]!==_0x38894b[_0x140ce5(0x1d2)])return!![];return![];}async['sendPromotionNotification'](_0x1bd0c8,_0x12b890,_0xfa6f7,_0x1f1fae,_0x5e44b2,_0x472cfb,_0xca329a,_0x526a1e={}){const _0x2cbe79=a43_0x4668ef;try{console['log']('STARTING\x20notification\x20for\x20'+_0x12b890+'\x27s\x20'+_0xca329a);const _0x100da5={'userId':_0x1bd0c8,'username':_0x12b890,'displayName':_0x526a1e['displayName']||_0x12b890,'oldElo':parseInt(_0xfa6f7),'newElo':parseInt(_0x1f1fae),'eloDifference':parseInt(_0x1f1fae)-parseInt(_0xfa6f7),'oldRank':_0x5e44b2,'newRank':_0x472cfb,'type':_0xca329a,'timestamp':serverTimestamp(),'processed':![],'source':_0x526a1e['source']||'automatic','matchId':_0x526a1e['matchId']||null,'ladder':_0x526a1e['ladder']||'D1','adminUser':_0x526a1e['adminUser']||null};console['log'](_0x2cbe79(0x17c),_0x100da5);const _0x2511e1=await addDoc(collection(db,'promotionNotifications'),_0x100da5);return console[_0x2cbe79(0x18d)]('Discord\x20notification\x20sent\x20successfully\x20with\x20ID:\x20'+_0x2511e1['id']),!![];}catch(_0x55d9a5){return console['error'](_0x2cbe79(0x1a9),_0x55d9a5),![];}}}export const promotionManager=new PromotionManager();document['addEventListener']('DOMContentLoaded',()=>{promotionManager['initialize']();});export const initializePromotionTracker=()=>promotionManager[a43_0x4668ef(0x194)]();export const checkAndRecordPromotion=(_0x14ebd7,_0x6502e2,_0x260e14,_0x592d31)=>promotionManager[a43_0x4668ef(0x1ad)](_0x14ebd7,_0x6502e2,_0x260e14,_0x592d31);function a43_0x2f34(_0x5228a3,_0x5dc324){const _0x55050c=a43_0x375d();return a43_0x2f34=function(_0x425a01,_0x35d664){_0x425a01=_0x425a01-0x172;let _0x375dc3=_0x55050c[_0x425a01];return _0x375dc3;},a43_0x2f34(_0x5228a3,_0x5dc324);}function a43_0x375d(){const _0x456800=['click','ladder','Error\x20resolving\x20user\x20ID:','docs','threshold','getElementById','children','div','prototype','resolvedName','Creating\x20Discord\x20notification:','Unknown\x20Player','empty','__proto__','add','data','loserId','\x20hours','pollingInterval','\x20for\x20','players','getRankName','\x20was\x20dismissed\x20by\x20user\x20within\x20last\x20','approvedMatches','admin','now','exception','log','exists','createElement','getItem','loserUsername','fetchInterval','error','initialize','#CD7F32','#C0C0C0','sort','timestamp','eloHistory','showRankChangeBanner','userDismissed','winnerId','promotion-banner','type','bannerContainer','previousRank','ignorePromotion','setupBannerContainer','remove','dismissing','string','console','length','addEventListener','Error\x20sending\x20Discord\x20notification:','setItem','Promotion\x20','playerUsername','checkAndRecordPromotion','rankChangeModal','date','lastFetchTime','test','displayName','usernameCache','Error\x20fetching\x20promotions:','new-rank-change','Error\x20resolving\x20username:','includes','parentNode','className','currentUser','RANKS','Successfully\x20recorded\x20','demotion','innerHTML','toDateString','classList','player','fetchRecentPromotions','\x20to\x20','matchId','Never\x20show\x20this\x20promotion\x20again','promotion-details','Gold','Bronze','resolveUserId','commit','promotion_','display','body','style','removeChild','promotion','Rank\x20Update','newRank','username'];a43_0x375d=function(){return _0x456800;};return a43_0x375d();}export const getRankName=_0x32a109=>promotionManager[a43_0x4668ef(0x187)](_0x32a109);
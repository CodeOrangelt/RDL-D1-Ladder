const a42_0xc6da5b=a42_0x2436,a42_0x3a2434=(function(){let _0x57ccb3=!![];return function(_0x61fbae,_0x46ddcd){const _0x3d1652=_0x57ccb3?function(){if(_0x46ddcd){const _0xf56883=_0x46ddcd['apply'](_0x61fbae,arguments);return _0x46ddcd=null,_0xf56883;}}:function(){};return _0x57ccb3=![],_0x3d1652;};}()),a42_0x19168d=a42_0x3a2434(this,function(){const _0x4498c0=a42_0x2436;let _0x20087f;try{const _0x2b601b=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x20087f=_0x2b601b();}catch(_0x3ca0d3){_0x20087f=window;}const _0x1038b3=_0x20087f['console']=_0x20087f[_0x4498c0(0x1fd)]||{},_0x4e1118=[_0x4498c0(0x1fe),'warn','info','error','exception',_0x4498c0(0x205),_0x4498c0(0x201)];for(let _0x1764ad=0x0;_0x1764ad<_0x4e1118[_0x4498c0(0x1ee)];_0x1764ad++){const _0x1141b3=a42_0x3a2434['constructor']['prototype']['bind'](a42_0x3a2434),_0x488435=_0x4e1118[_0x1764ad],_0x2eaf97=_0x1038b3[_0x488435]||_0x1141b3;_0x1141b3['__proto__']=a42_0x3a2434['bind'](a42_0x3a2434),_0x1141b3[_0x4498c0(0x1e6)]=_0x2eaf97[_0x4498c0(0x1e6)][_0x4498c0(0x20c)](_0x2eaf97),_0x1038b3[_0x488435]=_0x1141b3;}});a42_0x19168d();function a42_0x444c(){const _0x27a9c5=['shouldShowPromotion','slice','Fallback\x20write\x20failed:','promotion','\x20was\x20promoted\x20to','desc','data','getElementById','Recording\x20','error','Don\x27t\x20show\x20again','winnerId','promotion-banner','ignore-btn','Processing\x20potential\x20rank\x20change:\x20','source','Error\x20writing\x20promotion\x20records:','fetchInterval','resolveUserId','empty','loserUsername','promotion_','isNewRankChange','approvedMatches','Error\x20saving\x20promotion\x20preference:','userDismissed','getRankName','addEventListener','toString','lastFetchTime','button','stringify','isAutomatic','pollingInterval','innerHTML','currentUser','length','Promotion\x20','initialize','DISPLAY_HOURS','userId','promotionHistory','modifiedBy','rank-change-modal\x20','new-rank-change','\x20was\x20auto-dismissed\x20within\x20last\x204\x20hours','target','now','Unranked','createElement','\x20to\x20','console','log','beforeunload','fetchRecentPromotions','trace','promotion-details','winnerUsername','parentNode','table','\x20(loser)','none','ladder','admin','children','bannerContainer','bind','sendPromotionNotification','Error\x20in\x20promotion/demotion\x20recording:','warn','displayName','dismiss-btn','automatic','Error\x20processing\x20rank\x20change:','STARTING\x20notification\x20for\x20','username','eloHistory','</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22rank-change-button\x22\x20id=\x22rank-change-ok-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Got\x20it!\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','adminUser','players','Resolved\x20','display','timestamp','setItem','sort','RANKS','classList','forEach','className','\x20was\x20dismissed\x20by\x20user\x20within\x20last\x20','style','ignored','remove','data-id','Never\x20show\x20this\x20promotion\x20again','\x20→\x20','\x20for\x20'];a42_0x444c=function(){return _0x27a9c5;};return a42_0x444c();}import{collection,doc,query,where,orderBy,limit,getDocs,addDoc,getDoc,serverTimestamp,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a42_0x2436(_0x2a731a,_0x38ddab){const _0x19168d=a42_0x444c();return a42_0x2436=function(_0x3a2434,_0x792abb){_0x3a2434=_0x3a2434-0x1ca;let _0x444c09=_0x19168d[_0x3a2434];return _0x444c09;},a42_0x2436(_0x2a731a,_0x38ddab);}import{auth,db}from'./firebase-config.js';class PromotionManager{constructor(){const _0x625560=a42_0x2436;this['DISPLAY_HOURS']=0x18,this[_0x625560(0x21f)]=[{'threshold':0x578,'name':'Bronze','color':'#CD7F32'},{'threshold':0x640,'name':'Silver','color':'#C0C0C0'},{'threshold':0x708,'name':'Gold','color':'#FFD700'},{'threshold':0x834,'name':'Emerald','color':'#50C878'}],this['bannerContainer']=null,this[_0x625560(0x1e7)]=0x0,this['fetchInterval']=0xea60,this['pollingInterval']=null,this['usernameCache']={};}['initialize'](){const _0x134fa6=a42_0x2436;this['bannerContainer']=document[_0x134fa6(0x1d1)]('promotion-banner-container');if(!this['bannerContainer']){console['error']('Promotion\x20banner\x20container\x20not\x20found');return;}this['setupBannerContainer']();const _0x49c968='promotions_checked_'+new Date()['toDateString'](),_0x55da0a=sessionStorage['getItem'](_0x49c968);!_0x55da0a&&(this['fetchRecentPromotions'](),sessionStorage['setItem'](_0x49c968,'true')),document[_0x134fa6(0x1e5)]('visibilitychange',()=>{const _0x436560=_0x134fa6;document['visibilityState']==='visible'&&!sessionStorage['getItem'](_0x49c968)&&(this[_0x436560(0x200)](),sessionStorage['setItem'](_0x49c968,'true'));}),window[_0x134fa6(0x1e5)](_0x134fa6(0x1ff),()=>{this['pollingInterval']&&clearInterval(this['pollingInterval']);});}['setupBannerContainer'](){const _0x23f21b=a42_0x2436;this['bannerContainer'][_0x23f21b(0x1ec)]='',this['bannerContainer'][_0x23f21b(0x224)]['display']='none';}async[a42_0xc6da5b(0x200)](){const _0x574394=a42_0xc6da5b;try{const _0x2f08c0=Date['now']();if(_0x2f08c0-this['lastFetchTime']<this[_0x574394(0x1db)])return;this['lastFetchTime']=_0x2f08c0;const _0x313213=collection(db,'eloHistory'),_0x44079a=query(_0x313213,where('type','in',[_0x574394(0x1cd),'demotion']),orderBy('timestamp','desc'),limit(0x14)),_0x314a9c=await getDocs(_0x44079a),_0x534838=[];_0x314a9c[_0x574394(0x221)](_0x2f7be2=>{const _0x668c0f=_0x574394,_0x1f8eb9={'id':_0x2f7be2['id'],..._0x2f7be2['data']()};this[_0x668c0f(0x1ca)](_0x2f7be2['id'])&&this[_0x668c0f(0x1e0)](_0x1f8eb9)&&_0x534838['push'](_0x1f8eb9);}),_0x534838['length']>0x0&&await this['processRankChanges'](_0x534838);}catch(_0x1aa753){console['error']('Error\x20fetching\x20promotions:',_0x1aa753);}}async['processRankChanges'](_0x496da1){const _0x5f39f2=a42_0xc6da5b;if(_0x496da1[_0x5f39f2(0x1ee)]===0x0)return;_0x496da1[_0x5f39f2(0x21e)]((_0x4c2c84,_0x3d3c73)=>{const _0x520718=_0x5f39f2,_0x35996c=_0x4c2c84['timestamp']?.['toMillis']?.()||_0x4c2c84[_0x520718(0x21c)]?.['seconds']*0x3e8||0x0,_0x318e58=_0x3d3c73['timestamp']?.['toMillis']?.()||_0x3d3c73[_0x520718(0x21c)]?.['seconds']*0x3e8||0x0;return _0x318e58-_0x35996c;});const _0x4ed45d=this['bannerContainer'][_0x5f39f2(0x20a)]['length'],_0x2eedbd=0x3-_0x4ed45d;if(_0x2eedbd<=0x0)return;const _0x3a1314=_0x496da1[_0x5f39f2(0x1cb)](0x0,_0x2eedbd);for(let _0x598ed4=0x0;_0x598ed4<_0x3a1314[_0x5f39f2(0x1ee)];_0x598ed4++){const _0x58cff2=_0x3a1314[_0x598ed4],_0x24442c=auth['currentUser'];try{setTimeout(()=>{this['showRankChangeBanner'](_0x58cff2);},_0x598ed4*0x3e8),_0x24442c&&_0x58cff2['player']===_0x24442c['displayName']&&this['showRankChangeLightbox'](_0x58cff2['type'],_0x58cff2['rankAchieved']);}catch(_0x3fc892){console['error'](_0x5f39f2(0x213),_0x3fc892);}}}[a42_0xc6da5b(0x1ca)](_0x1eef7f){const _0x2dfab8=a42_0xc6da5b;try{const _0x11c0e4=_0x2dfab8(0x1df)+_0x1eef7f,_0x1e62fb=localStorage['getItem'](_0x11c0e4);if(_0x1e62fb){let _0x541a90;try{_0x541a90=JSON['parse'](_0x1e62fb);}catch(_0x3952ae){return console['warn']('Invalid\x20storage\x20format\x20for\x20'+_0x11c0e4+',\x20treating\x20as\x20new'),!![];}if(_0x541a90['ignored']===!![])return console['log'](_0x2dfab8(0x1ef)+_0x1eef7f+'\x20is\x20permanently\x20ignored'),![];const _0x19c108=Date[_0x2dfab8(0x1f9)]();if(_0x541a90[_0x2dfab8(0x1e3)]&&_0x19c108-_0x541a90['timestamp']<this[_0x2dfab8(0x1f1)]*0x3c*0x3c*0x3e8)return console['log']('Promotion\x20'+_0x1eef7f+_0x2dfab8(0x223)+this['DISPLAY_HOURS']+'\x20hours'),![];if(_0x541a90['systemDismissed']&&_0x19c108-_0x541a90[_0x2dfab8(0x21c)]<0x4*0x3c*0x3c*0x3e8)return console['log'](_0x2dfab8(0x1ef)+_0x1eef7f+_0x2dfab8(0x1f7)),![];}return!![];}catch(_0x487df4){return console['error']('Error\x20checking\x20promotion\x20visibility:',_0x487df4),![];}}['ignorePromotion'](_0x42d8f7){const _0x3e3256=a42_0xc6da5b;try{const _0x13d1a3='promotion_'+_0x42d8f7;localStorage['setItem'](_0x13d1a3,JSON['stringify']({'timestamp':Date['now'](),'ignored':!![]}));}catch(_0x3532e5){console['error'](_0x3e3256(0x1e2),_0x3532e5);}}['showRankChangeBanner'](_0x922391){const _0x1c7eb8=a42_0xc6da5b;this[_0x1c7eb8(0x1dc)](_0x922391)['then'](_0xcf0f6d=>{const _0x5ceb64=_0x1c7eb8,_0x3c085d='promotion_'+_0x922391['id'],_0xc8344a=localStorage['getItem'](_0x3c085d);if(_0xc8344a)try{const _0x6ba623=JSON['parse'](_0xc8344a);if(_0x6ba623[_0x5ceb64(0x225)]===!![]){console['log']('Skipping\x20ignored\x20promotion:\x20'+_0x922391['id']);return;}}catch(_0x2f8c6b){}localStorage['setItem'](_0x3c085d,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':![],'seenAt':Date['now']()})),this['bannerContainer']['style']['display']='block';while(this['bannerContainer']['children']['length']>=0x3){this[_0x5ceb64(0x20b)]['removeChild'](this['bannerContainer']['firstChild']);}const _0x5354a7=document[_0x5ceb64(0x1fb)]('div');_0x5354a7[_0x5ceb64(0x222)]=_0x5ceb64(0x1d6),_0x5354a7['setAttribute']('data-rank',_0xcf0f6d['rankAchieved']),_0x5354a7['setAttribute'](_0x5ceb64(0x227),_0xcf0f6d['id']);const _0x4e6396=document[_0x5ceb64(0x1fb)]('div');_0x4e6396['className']=_0x5ceb64(0x202);const _0x729b89=_0xcf0f6d['resolvedName']||_0xcf0f6d['player']||_0xcf0f6d[_0x5ceb64(0x215)]||_0xcf0f6d['playerUsername']||_0xcf0f6d['displayName']||'A\x20player',_0x1726bf=_0xcf0f6d['type']===_0x5ceb64(0x1cd)?_0x729b89+_0x5ceb64(0x1ce):_0x729b89+'\x20was\x20demoted\x20to';_0x4e6396['innerHTML']=_0x1726bf+'\x20<span\x20class=\x22rank-text\x22>'+_0xcf0f6d['rankAchieved']+'</span>';const _0x7342a1=document['createElement']('div');_0x7342a1[_0x5ceb64(0x222)]='banner-actions';const _0x1caf91=document[_0x5ceb64(0x1fb)](_0x5ceb64(0x1e8));_0x1caf91['className']=_0x5ceb64(0x211),_0x1caf91['innerHTML']='&times;',_0x1caf91['title']='Dismiss';const _0x307d2b=document[_0x5ceb64(0x1fb)]('button');_0x307d2b['className']=_0x5ceb64(0x1d7),_0x307d2b['textContent']=_0x5ceb64(0x1d4),_0x307d2b['title']=_0x5ceb64(0x228),_0x7342a1['appendChild'](_0x307d2b),_0x7342a1['appendChild'](_0x1caf91),_0x5354a7['appendChild'](_0x4e6396),_0x5354a7['appendChild'](_0x7342a1),this['bannerContainer']['appendChild'](_0x5354a7),void _0x5354a7['offsetWidth'],setTimeout(()=>{const _0x1e5821=_0x5ceb64;_0x5354a7[_0x1e5821(0x220)]['add']('new-rank-change');},0x32),_0x1caf91['addEventListener']('click',()=>{const _0x4192ac=_0x5ceb64;localStorage['setItem'](_0x3c085d,JSON[_0x4192ac(0x1e9)]({'timestamp':Date[_0x4192ac(0x1f9)](),'ignored':![],'userDismissed':!![],'systemDismissed':![]})),_0x5354a7['classList']['remove']('new-rank-change'),_0x5354a7[_0x4192ac(0x220)]['add']('dismissing'),setTimeout(()=>{const _0x23a817=_0x4192ac;_0x5354a7[_0x23a817(0x204)]&&(_0x5354a7['remove'](),this[_0x23a817(0x20b)]['children']['length']===0x0&&(this['bannerContainer']['style']['display']='none'));},0x1f4);}),_0x307d2b['addEventListener']('click',()=>{const _0x292d84=_0x5ceb64;localStorage['setItem'](_0x3c085d,JSON['stringify']({'timestamp':Date['now'](),'ignored':!![],'userDismissed':!![],'systemDismissed':![]})),_0x5354a7['classList']['remove'](_0x292d84(0x1f6)),_0x5354a7['classList']['add']('dismissing'),setTimeout(()=>{const _0x4dc48d=_0x292d84;_0x5354a7[_0x4dc48d(0x204)]&&(_0x5354a7['remove'](),this['bannerContainer']['children']['length']===0x0&&(this['bannerContainer']['style'][_0x4dc48d(0x21b)]=_0x4dc48d(0x207)));},0x1f4);}),setTimeout(()=>{const _0x1dde31=_0x5ceb64;_0x5354a7['parentNode']&&(_0x5354a7[_0x1dde31(0x220)]['remove']('new-rank-change'),_0x5354a7['classList']['add']('dismissing'),localStorage[_0x1dde31(0x21d)](_0x3c085d,JSON[_0x1dde31(0x1e9)]({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':!![]})),setTimeout(()=>{const _0x2eb67b=_0x1dde31;_0x5354a7['parentNode']&&(_0x5354a7[_0x2eb67b(0x226)](),this[_0x2eb67b(0x20b)]['children']['length']===0x0&&(this['bannerContainer']['style']['display']='none'));},0x1f4));},0x3a98);});}async[a42_0xc6da5b(0x1dc)](_0x6210bb){const _0x2de2f8=a42_0xc6da5b,_0x5b2f8e={..._0x6210bb},_0x4ec0b2=[_0x6210bb['player'],_0x6210bb['username'],_0x6210bb['playerUsername'],_0x6210bb['displayName']],_0x218196=_0x4ec0b2['some'](_0x23fa61=>_0x23fa61&&typeof _0x23fa61==='string'&&!_0x23fa61['includes']('ID:')&&!/^[a-zA-Z0-9]{20,}$/['test'](_0x23fa61));if(_0x218196)return _0x5b2f8e;let _0x2b9f65=null;if(_0x6210bb[_0x2de2f8(0x1f2)])_0x2b9f65=_0x6210bb[_0x2de2f8(0x1f2)];else _0x6210bb['player']&&/^[A-Za-z0-9]{20,}$/['test'](_0x6210bb['player'])&&(_0x2b9f65=_0x6210bb['player']);if(!_0x2b9f65)return _0x5b2f8e;try{const _0x672168=await getDoc(doc(db,'players',_0x2b9f65));if(_0x672168['exists']()){const _0x182d0b=_0x672168[_0x2de2f8(0x1d0)]();if(_0x182d0b['username'])return _0x5b2f8e['resolvedName']=_0x182d0b['username'],_0x5b2f8e;}const _0x156d91=await getDocs(query(collection(db,'approvedMatches'),where(_0x2de2f8(0x1d5),'==',_0x2b9f65),orderBy('date','desc'),limit(0x1)));if(!_0x156d91[_0x2de2f8(0x1dd)]){const _0x9f072=_0x156d91['docs'][0x0]['data']();if(_0x9f072['winnerUsername'])return _0x5b2f8e['resolvedName']=_0x9f072['winnerUsername'],_0x5b2f8e;}const _0x12c2d6=await getDocs(query(collection(db,'approvedMatches'),where('loserId','==',_0x2b9f65),orderBy('date',_0x2de2f8(0x1cf)),limit(0x1)));if(!_0x12c2d6[_0x2de2f8(0x1dd)]){const _0x304d8d=_0x12c2d6['docs'][0x0][_0x2de2f8(0x1d0)]();if(_0x304d8d['loserUsername'])return _0x5b2f8e['resolvedName']=_0x304d8d[_0x2de2f8(0x1de)],console['log'](_0x2de2f8(0x21a)+_0x2b9f65+_0x2de2f8(0x1fc)+_0x304d8d['loserUsername']+_0x2de2f8(0x206)),_0x5b2f8e;}}catch(_0x520224){console['error']('Error\x20resolving\x20user\x20ID:',_0x520224);}return console[_0x2de2f8(0x20f)]('Failed\x20to\x20resolve\x20user\x20ID:\x20'+_0x2b9f65),_0x5b2f8e;}['showRankChangeLightbox'](_0x5d4dc8,_0x22535a){const _0xbfc466=a42_0xc6da5b;let _0x481edd=document['getElementById']('rankChangeModal');!_0x481edd&&(_0x481edd=document[_0xbfc466(0x1fb)]('div'),_0x481edd['id']='rankChangeModal',_0x481edd[_0xbfc466(0x222)]=_0xbfc466(0x1f5)+_0x5d4dc8,document['body']['appendChild'](_0x481edd));const _0x4b70bc=_0x5d4dc8==='promotion'?'Congratulations!':'Rank\x20Update',_0x58bf66=_0x5d4dc8==='promotion'?'You\x27ve\x20been\x20promoted\x20to':'You\x27ve\x20been\x20demoted\x20to';_0x481edd['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rank-change-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2\x20class=\x22rank-change-title\x22>'+_0x4b70bc+'</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>'+_0x58bf66+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22rank-name\x22>'+_0x22535a+_0xbfc466(0x217),_0x481edd[_0xbfc466(0x224)]['display']='flex',document['getElementById']('rank-change-ok-btn')['addEventListener']('click',()=>{const _0x47bbfb=_0xbfc466;_0x481edd['style']['display']=_0x47bbfb(0x207);}),_0x481edd['addEventListener']('click',_0x4c6952=>{const _0x1d025d=_0xbfc466;_0x4c6952[_0x1d025d(0x1f8)]===_0x481edd&&(_0x481edd['style']['display']=_0x1d025d(0x207));});}async['checkAndRecordPromotion'](_0x55f649,_0x1ad2a2,_0xa38fd8,_0x2cfb37={}){const _0x288ac9=a42_0xc6da5b;try{if(_0x1ad2a2===_0xa38fd8||!_0x55f649)return null;const _0xf95ba9=_0x2cfb37['source']||_0x288ac9(0x212),_0x47ff22=_0x2cfb37['matchId']||null,_0x227a67=_0x2cfb37[_0x288ac9(0x218)]||null;console['log'](_0x288ac9(0x1d8)+_0xa38fd8+_0x288ac9(0x229)+_0x1ad2a2+'\x20(source:\x20'+_0xf95ba9+')');let _0x1b897e=null,_0x3b93c2=null;try{const _0x19418e=await getDoc(doc(db,_0x288ac9(0x219),_0x55f649));if(_0x19418e['exists']()){const _0xa7ec16=_0x19418e['data']();_0x1b897e=_0xa7ec16['username']||_0xa7ec16[_0x288ac9(0x210)]||null,_0x3b93c2=_0xa7ec16[_0x288ac9(0x210)]||_0xa7ec16['username']||null;}!_0x1b897e&&_0x2cfb37[_0x288ac9(0x215)]&&(_0x1b897e=_0x2cfb37[_0x288ac9(0x215)],_0x3b93c2=_0x2cfb37['username']);!_0x1b897e&&auth[_0x288ac9(0x1ed)]&&(_0x1b897e=auth['currentUser']['displayName']||auth['currentUser']['email']['split']('@')[0x0],_0x3b93c2=auth['currentUser']['displayName']||null);if(!_0x1b897e){const _0x4d195f=query(collection(db,_0x288ac9(0x1e1)),where('winnerId','==',_0x55f649),limit(0x1)),_0x11ca0c=await getDocs(_0x4d195f);if(!_0x11ca0c[_0x288ac9(0x1dd)])_0x1b897e=_0x11ca0c['docs'][0x0]['data']()[_0x288ac9(0x203)]||'Unknown\x20Player',_0x3b93c2=_0x1b897e;else{const _0x25b0da=query(collection(db,_0x288ac9(0x1e1)),where('loserId','==',_0x55f649),limit(0x1)),_0x1dd28e=await getDocs(_0x25b0da);!_0x1dd28e[_0x288ac9(0x1dd)]&&(_0x1b897e=_0x1dd28e[0x0]['data']()['loserUsername']||'Unknown\x20Player',_0x3b93c2=_0x1b897e);}}}catch(_0x5905a0){console['error']('Error\x20resolving\x20username:',_0x5905a0);}!_0x1b897e&&(console['warn']('Could\x20not\x20resolve\x20username\x20for\x20userId:',_0x55f649),_0x1b897e='A\x20player',_0x3b93c2='Unknown\x20Player');const _0x19d79a=this[_0x288ac9(0x1e4)](_0xa38fd8),_0x157fe4=this['getRankName'](_0x1ad2a2);if(_0x19d79a!==_0x157fe4){const _0x10c3d7=_0x1ad2a2>_0xa38fd8,_0x496d61=_0x10c3d7?'promotion':'demotion',_0x24b798=_0x157fe4;console['log'](_0x288ac9(0x1d2)+_0x496d61+'\x20for\x20'+_0x1b897e+':\x20'+_0xa38fd8+'\x20('+_0x19d79a+')\x20→\x20'+_0x1ad2a2+'\x20('+_0x157fe4+')');try{const _0x2026ca={'player':_0x1b897e,'playerUsername':_0x1b897e,'username':_0x1b897e,'displayName':_0x3b93c2,'userId':_0x55f649,'type':_0x496d61,'rankAchieved':_0x24b798,'timestamp':serverTimestamp(),'previousElo':_0xa38fd8,'newElo':_0x1ad2a2,'change':_0x1ad2a2-_0xa38fd8,'previousRank':_0x19d79a,'newRank':_0x157fe4,'source':_0xf95ba9};if(_0xf95ba9==='match'&&_0x47ff22)_0x2026ca['matchId']=_0x47ff22;else _0xf95ba9===_0x288ac9(0x209)&&_0x227a67?(_0x2026ca[_0x288ac9(0x1f4)]=_0x227a67,_0x2026ca['isAutomatic']=![]):_0x2026ca[_0x288ac9(0x1ea)]=!![];const _0x39ee45=writeBatch(db),_0x2630ce=doc(collection(db,_0x288ac9(0x216))),_0x4793cb=doc(collection(db,_0x288ac9(0x1f3)));return _0x39ee45['set'](_0x2630ce,_0x2026ca),_0x39ee45['set'](_0x4793cb,_0x2026ca),await _0x39ee45['commit'](),await this[_0x288ac9(0x20d)](_0x55f649,_0x1b897e,_0xa38fd8,_0x1ad2a2,_0x19d79a,_0x157fe4,_0x496d61,{'displayName':_0x3b93c2,'source':_0xf95ba9,'matchId':_0x47ff22,'ladder':_0x2cfb37['ladder']||'D1'}),console['log']('Successfully\x20recorded\x20'+_0x496d61+_0x288ac9(0x22a)+_0x1b897e+'\x20to\x20'+_0x24b798),_0x24b798;}catch(_0x4e8d1f){console[_0x288ac9(0x1d3)](_0x288ac9(0x1da),_0x4e8d1f);try{return await addDoc(collection(db,_0x288ac9(0x216)),{'player':_0x1b897e,'playerUsername':_0x1b897e,'username':_0x1b897e,'displayName':_0x3b93c2,'userId':_0x55f649,'type':_0x496d61,'rankAchieved':_0x24b798,'timestamp':serverTimestamp(),'previousElo':_0xa38fd8,'newElo':_0x1ad2a2,'change':_0x1ad2a2-_0xa38fd8,'previousRank':_0x19d79a,'source':_0xf95ba9,'isAutomatic':_0xf95ba9!=='admin'}),await this['sendPromotionNotification'](_0x55f649,_0x1b897e,_0xa38fd8,_0x1ad2a2,_0x19d79a,_0x157fe4,_0x496d61,{'displayName':_0x3b93c2,'source':_0xf95ba9,'matchId':_0x47ff22,'ladder':_0x2cfb37['ladder']||'D1'}),_0x24b798;}catch(_0x497ce7){return console['error'](_0x288ac9(0x1cc),_0x497ce7),null;}}}return null;}catch(_0x475b0f){return console['error'](_0x288ac9(0x20e),_0x475b0f),null;}}['getRankName'](_0x1d8892){const _0xf36d28=a42_0xc6da5b;for(let _0x1db932=this[_0xf36d28(0x21f)]['length']-0x1;_0x1db932>=0x0;_0x1db932--){if(_0x1d8892>=this['RANKS'][_0x1db932]['threshold'])return this['RANKS'][_0x1db932]['name'];}return _0xf36d28(0x1fa);}['cleanup'](){const _0x4ed632=a42_0xc6da5b;this['pollingInterval']&&clearInterval(this[_0x4ed632(0x1eb)]);}[a42_0xc6da5b(0x1e0)](_0x40f8d4){const _0xfb7010=a42_0xc6da5b;if(_0x40f8d4['timestamp']){const _0x5c446b=_0x40f8d4[_0xfb7010(0x21c)]['seconds']*0x3e8,_0x5d48f4=Date['now'](),_0x4f4933=(_0x5d48f4-_0x5c446b)/(0x3e8*0x3c*0x3c);if(_0x4f4933>0x18)return![];}if(_0x40f8d4['previousRank']&&_0x40f8d4['newRank']&&_0x40f8d4['previousRank']!==_0x40f8d4['newRank'])return!![];return![];}async['sendPromotionNotification'](_0x21fb57,_0x3c9f65,_0x591a7,_0x37f18b,_0x2bf49d,_0x414271,_0x56f49c,_0x5c3bfb={}){const _0x13cca6=a42_0xc6da5b;try{console[_0x13cca6(0x1fe)](_0x13cca6(0x214)+_0x3c9f65+'\x27s\x20'+_0x56f49c);const _0x3bc42a={'userId':_0x21fb57,'username':_0x3c9f65,'displayName':_0x5c3bfb[_0x13cca6(0x210)]||_0x3c9f65,'oldElo':parseInt(_0x591a7),'newElo':parseInt(_0x37f18b),'eloDifference':parseInt(_0x37f18b)-parseInt(_0x591a7),'oldRank':_0x2bf49d,'newRank':_0x414271,'type':_0x56f49c,'timestamp':serverTimestamp(),'processed':![],'source':_0x5c3bfb[_0x13cca6(0x1d9)]||'automatic','matchId':_0x5c3bfb['matchId']||null,'ladder':_0x5c3bfb[_0x13cca6(0x208)]||'D1','adminUser':_0x5c3bfb['adminUser']||null};console['log']('Creating\x20Discord\x20notification:',_0x3bc42a);const _0x31b18e=await addDoc(collection(db,'promotionNotifications'),_0x3bc42a);return console['log']('Discord\x20notification\x20sent\x20successfully\x20with\x20ID:\x20'+_0x31b18e['id']),!![];}catch(_0x23ae60){return console['error']('Error\x20sending\x20Discord\x20notification:',_0x23ae60),![];}}}export const promotionManager=new PromotionManager();document[a42_0xc6da5b(0x1e5)]('DOMContentLoaded',()=>{const _0x4e1075=a42_0xc6da5b;promotionManager[_0x4e1075(0x1f0)]();});export const initializePromotionTracker=()=>promotionManager['initialize']();export const checkAndRecordPromotion=(_0x223da4,_0x4ea58e,_0x1327a5,_0x25b490)=>promotionManager['checkAndRecordPromotion'](_0x223da4,_0x4ea58e,_0x1327a5,_0x25b490);export const getRankName=_0x51af5f=>promotionManager[a42_0xc6da5b(0x1e4)](_0x51af5f);
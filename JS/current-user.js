const a12_0x2fcd10=(function(){let _0x57b422=!![];return function(_0x2e7557,_0x2b7e36){const _0x26d4ec=_0x57b422?function(){if(_0x2b7e36){const _0x441c8d=_0x2b7e36['apply'](_0x2e7557,arguments);return _0x2b7e36=null,_0x441c8d;}}:function(){};return _0x57b422=![],_0x26d4ec;};}()),a12_0x1ea4a9=a12_0x2fcd10(this,function(){const _0x259d87=a12_0x32c6;let _0xbd0ebe;try{const _0x13bd66=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0xbd0ebe=_0x13bd66();}catch(_0x1a96a7){_0xbd0ebe=window;}const _0x2686ad=_0xbd0ebe['console']=_0xbd0ebe['console']||{},_0x181a2e=['log','warn',_0x259d87(0x1b2),_0x259d87(0x1a2),'exception',_0x259d87(0x1a7),'trace'];for(let _0x1f9a32=0x0;_0x1f9a32<_0x181a2e['length'];_0x1f9a32++){const _0x5f0ebf=a12_0x2fcd10['constructor']['prototype'][_0x259d87(0x1ba)](a12_0x2fcd10),_0x2056db=_0x181a2e[_0x1f9a32],_0x7f892b=_0x2686ad[_0x2056db]||_0x5f0ebf;_0x5f0ebf['__proto__']=a12_0x2fcd10['bind'](a12_0x2fcd10),_0x5f0ebf['toString']=_0x7f892b['toString']['bind'](_0x7f892b),_0x2686ad[_0x2056db]=_0x5f0ebf;}});a12_0x1ea4a9();import{getAuth,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{doc,getDoc,collection,query,where,getDocs,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';function a12_0x32c6(_0x1b5f75,_0x58e916){const _0x1ea4a9=a12_0x3fc5();return a12_0x32c6=function(_0x2fcd10,_0x2a584b){_0x2fcd10=_0x2fcd10-0x190;let _0x3fc5c2=_0x1ea4a9[_0x2fcd10];return _0x3fc5c2;},a12_0x32c6(_0x1b5f75,_0x58e916);}import{isAdmin}from'./admin-check.js';const ADMIN_EMAILS=['admin@ladder.com','Brian2af@outlook.com'],userCache={'uid':null,'username':null,'isAdmin':![],'hasCheckedCollections':![],'lastChecked':0x0,'role':null},invitationCache={'lastCheck':0x0,'pendingCount':0x0,'checkInterval':0x493e0};function updateInboxNotification(_0x406649){const _0x4dc867=a12_0x32c6,_0x4d0305=document['getElementById']('inbox-notification');_0x4d0305&&(_0x406649>0x0?(_0x4d0305['style'][_0x4dc867(0x19c)]='inline-block',_0x4d0305[_0x4dc867(0x1b3)]=_0x406649>0x9?'9+':_0x406649):_0x4d0305[_0x4dc867(0x199)]['display']='none');}async function checkPendingInvitationsForCurrentUser(_0x1151c9){const _0xfa1912=a12_0x32c6;try{const _0xdaabc2=Date[_0xfa1912(0x1bb)]();if(_0xdaabc2-invitationCache['lastCheck']<invitationCache['checkInterval'])return updateInboxNotification(invitationCache[_0xfa1912(0x1b5)]),invitationCache['pendingCount'];invitationCache[_0xfa1912(0x19d)]=_0xdaabc2;const _0x361d1e=collection(db,'gameInvitations'),_0x1cd0fc=query(_0x361d1e,where('toUserId','==',_0x1151c9),where('status','==',_0xfa1912(0x1b6)),limit(0x5)),_0x357c9f=await getDocs(_0x1cd0fc),_0xf79d5f=_0x357c9f[_0xfa1912(0x1a8)];return invitationCache['pendingCount']=_0xf79d5f,updateInboxNotification(_0xf79d5f),_0xf79d5f;}catch(_0x3038f0){return console['warn']('Could\x20not\x20check\x20pending\x20invitations\x20for\x20current\x20user:',_0x3038f0),0x0;}}function updateAuthSectionImmediate(_0xe2555a,_0x3c9a78=![]){const _0x4e48ee=a12_0x32c6,_0x1d6f47=document[_0x4e48ee(0x192)]('auth-section');if(!_0x1d6f47)return;if(_0xe2555a&&_0x3c9a78)document[_0x4e48ee(0x1ae)](_0x4e48ee(0x1af))['forEach'](_0xa3a1a2=>{const _0x5392e5=_0x4e48ee;_0xa3a1a2[_0x5392e5(0x199)]['display']=_0x5392e5(0x193);});else!_0xe2555a&&document['querySelectorAll']('.admin-only')['forEach'](_0xbb50d6=>{const _0x479cec=_0x4e48ee;_0xbb50d6['style'][_0x479cec(0x19c)]='none';});if(_0xe2555a){const _0x51c8fb=userCache['username']||(_0xe2555a[_0x4e48ee(0x1b4)]?_0xe2555a[_0x4e48ee(0x1b4)]['split']('@')[0x0]:_0x4e48ee(0x19b)),_0x5c7025=userCache[_0x4e48ee(0x1b7)]?'\x20('+userCache['role']+')':_0x3c9a78?'\x20(Admin)':'';_0x1d6f47['innerHTML']=_0x4e48ee(0x19a)+_0x51c8fb+_0x5c7025+'</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username='+encodeURIComponent(_0x51c8fb)+'\x22>Profile</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./inbox.html\x22\x20class=\x22nav-notification\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Inbox\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22inbox-notification\x22\x20class=\x22notification-dot\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22members.html\x22>Members</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./redeem.html\x22><i\x20class=\x22fas\x20fa-gift\x22></i>\x20Redeem</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20id=\x22logout-link\x22>Sign\x20Out</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';const _0x27cb61=document[_0x4e48ee(0x192)]('logout-link');_0x27cb61&&_0x27cb61['addEventListener']('click',_0x6743dd=>{const _0x317fa9=_0x4e48ee;_0x6743dd[_0x317fa9(0x1b1)]();const _0x3777a0=getAuth();updateAuthSectionImmediate(null),_0x3777a0['signOut']()[_0x317fa9(0x1a4)](_0x13505c=>{console['error']('Error\x20signing\x20out:',_0x13505c);});}),_0xe2555a['uid']&&setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0xe2555a['uid']);},0x3e8);}else _0x1d6f47['innerHTML']=_0x4e48ee(0x1ac);}async function checkAdminRoles(_0x4bd514){const _0x104000=a12_0x32c6;if(!_0x4bd514||!_0x4bd514['email'])return{'isAdmin':![],'role':null};try{console['log']('Checking\x20roles\x20for\x20user:\x20'+_0x4bd514['email']);const _0x3778c5=['players','playersD2','playersD3','nonParticipants','userProfiles'],_0x5ee7ac=['council','creative\x20lead',_0x104000(0x197),_0x104000(0x1ad)];for(const _0xc406f4 of _0x3778c5){try{const _0x297e49=doc(db,_0xc406f4,_0x4bd514['uid']),_0x30e9cb=await getDoc(_0x297e49);if(_0x30e9cb['exists']()){const _0x188637=_0x30e9cb['data']();console['log']('Found\x20user\x20in\x20'+_0xc406f4+'\x20by\x20UID:',_0x188637);let _0x5ce046=(_0x188637['roleName']||_0x188637[_0x104000(0x1b7)]||'')['toLowerCase'](),_0xe13144=_0x188637[_0x104000(0x195)]||_0x188637[_0x104000(0x1b7)]||'';if(_0x5ce046&&_0x5ee7ac['includes'](_0x5ce046)){console['log']('Found\x20admin\x20role:\x20'+_0x5ce046+'\x20in\x20'+_0xc406f4);const _0x51c2ea=_0xe13144['split']('\x20')['map'](_0x3deaad=>_0x3deaad['charAt'](0x0)[_0x104000(0x194)]()+_0x3deaad['slice'](0x1)['toLowerCase']())['join']('\x20');return{'isAdmin':!![],'role':_0x51c2ea};}}}catch(_0x2934ab){console[_0x104000(0x1a2)]('Error\x20checking\x20'+_0xc406f4+'\x20by\x20UID:',_0x2934ab);}}for(const _0x17ee73 of _0x3778c5){try{const _0x21da0e=collection(db,_0x17ee73);let _0xfe7d3=query(_0x21da0e,where('email','==',_0x4bd514['email'])),_0x19f6a0=await getDocs(_0xfe7d3);_0x19f6a0['empty']&&(_0xfe7d3=query(_0x21da0e,where('email','==',_0x4bd514['email']['toLowerCase']())),_0x19f6a0=await getDocs(_0xfe7d3));if(!_0x19f6a0['empty']){const _0x34884f=_0x19f6a0['docs'][0x0]['data']();console['log']('Found\x20user\x20in\x20'+_0x17ee73+_0x104000(0x1a1),_0x34884f);let _0x4c0303=(_0x34884f[_0x104000(0x195)]||_0x34884f['role']||'')['toLowerCase'](),_0x153f36=_0x34884f['roleName']||_0x34884f['role']||'';if(_0x4c0303&&_0x5ee7ac['includes'](_0x4c0303)){console['log'](_0x104000(0x196)+_0x4c0303+'\x20in\x20'+_0x17ee73);const _0x2c5689=_0x153f36[_0x104000(0x1b0)]('\x20')['map'](_0x55fa04=>_0x55fa04['charAt'](0x0)['toUpperCase']()+_0x55fa04['slice'](0x1)['toLowerCase']())['join']('\x20');return{'isAdmin':!![],'role':_0x2c5689};}}}catch(_0xe91bca){console['error']('Error\x20checking\x20'+_0x17ee73+'\x20by\x20email:',_0xe91bca);}}return console[_0x104000(0x1a0)]('No\x20admin\x20roles\x20found\x20for\x20user'),{'isAdmin':![],'role':null};}catch(_0x2bdb60){return console[_0x104000(0x1a2)]('Error\x20in\x20checkAdminRoles:',_0x2bdb60),{'isAdmin':![],'role':null};}}async function updateAuthSection(_0x210d2a){const _0xe690fe=a12_0x32c6,_0x29f449=_0x210d2a&&isAdmin(_0x210d2a['email']);updateAuthSectionImmediate(_0x210d2a,_0x29f449);if(!_0x210d2a){userCache['uid']=null,userCache['username']=null,userCache[_0xe690fe(0x1b9)]=![],userCache['hasCheckedCollections']=![],userCache[_0xe690fe(0x1b7)]=null;return;}const _0x1341b1=Date[_0xe690fe(0x1bb)]();if(_0x210d2a['uid']===userCache['uid']&&userCache['hasCheckedCollections']&&_0x1341b1-userCache[_0xe690fe(0x198)]<0x493e0)return;try{userCache[_0xe690fe(0x191)]=_0x210d2a['uid'],userCache['lastChecked']=_0x1341b1;const _0x48f507=isAdmin(_0x210d2a['email']);userCache['isAdmin']=_0x48f507;if(!_0x48f507){const {isAdmin:_0x5a8c20,role:_0x53562a}=await checkAdminRoles(_0x210d2a);userCache['isAdmin']=_0x5a8c20,userCache['role']=_0x53562a,_0x5a8c20&&(document['querySelectorAll']('.admin-only')['forEach'](_0x4e6b90=>{const _0x2d92da=_0xe690fe;_0x4e6b90['style']['display']=_0x2d92da(0x193);}),updateAuthSectionImmediate(_0x210d2a,!![]));}const _0x516fd3=['players','playersD2','playersD3','playersDuos',_0xe690fe(0x1a5),_0xe690fe(0x19f),_0xe690fe(0x190)],_0x2cb60e=_0x516fd3['map'](_0x2014e6=>getDoc(doc(db,_0x2014e6,_0x210d2a['uid']))['then'](_0x3ba88c=>_0x3ba88c[_0xe690fe(0x1a9)]()?{'collection':_0x2014e6,'data':_0x3ba88c['data']()}:null)[_0xe690fe(0x1a4)](()=>null)),_0x524b73=await Promise['all'](_0x2cb60e),_0x55dd4e=_0x524b73[_0xe690fe(0x1b8)](_0x3da5f1=>_0x3da5f1!==null);let _0x240380=null;for(const _0x1484b9 of _0x55dd4e){if(_0x1484b9['data'][_0xe690fe(0x1aa)]){_0x240380=_0x1484b9['data'][_0xe690fe(0x1aa)];break;}}userCache['username']=_0x240380||(_0x210d2a[_0xe690fe(0x1b4)]?_0x210d2a['email']['split']('@')[0x0]:'User'),userCache['hasCheckedCollections']=!![],updateAuthSectionImmediate(_0x210d2a,userCache[_0xe690fe(0x1b9)]),setTimeout(()=>{const _0xfd457c=_0xe690fe;checkPendingInvitationsForCurrentUser(_0x210d2a[_0xfd457c(0x191)]);},0x1f4);}catch(_0x330a01){console['error']('Error\x20in\x20full\x20auth\x20update:',_0x330a01);}}function a12_0x3fc5(){const _0x5d60c7=['userProfiles','uid','getElementById','block','toUpperCase','roleName','Found\x20admin\x20role:\x20','owner','lastChecked','style','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20class=\x22nav-username\x22>','User','display','lastCheck','addEventListener','nonParticipants','log','\x20by\x20email:','error','closest','catch','playersCTF','visibilitychange','table','size','exists','username','currentUser','<a\x20href=\x22login.html\x22\x20class=\x22login-link\x22>Login</a>','admin','querySelectorAll','.admin-only','split','preventDefault','info','textContent','email','pendingCount','pending','role','filter','isAdmin','bind','now'];a12_0x3fc5=function(){return _0x5d60c7;};return a12_0x3fc5();}document['addEventListener']('DOMContentLoaded',()=>{const _0x4d3200=a12_0x32c6,_0x1be949=getAuth();onAuthStateChanged(_0x1be949,async _0x3c0fe8=>{const _0x4a32a3=a12_0x32c6;await updateAuthSection(_0x3c0fe8),_0x3c0fe8&&checkPendingInvitationsForCurrentUser(_0x3c0fe8[_0x4a32a3(0x191)]);}),document['addEventListener'](_0x4d3200(0x1a6),()=>{const _0x1e292a=_0x4d3200;!document['hidden']&&_0x1be949[_0x1e292a(0x1ab)]&&checkPendingInvitationsForCurrentUser(_0x1be949[_0x1e292a(0x1ab)]['uid']);}),document[_0x4d3200(0x19e)]('click',_0x228d6d=>{const _0xfa7542=_0x4d3200;_0x228d6d['target'][_0xfa7542(0x1a3)]('a[href]')&&_0x1be949['currentUser']&&checkPendingInvitationsForCurrentUser(_0x1be949['currentUser']['uid']);});});export{updateAuthSection};
function a12_0x2b09(_0x2d19d2,_0x2e9432){const _0x3f5fb0=a12_0x145a();return a12_0x2b09=function(_0x55c42a,_0x5974c6){_0x55c42a=_0x55c42a-0x130;let _0x145acb=_0x3f5fb0[_0x55c42a];return _0x145acb;},a12_0x2b09(_0x2d19d2,_0x2e9432);}const a12_0x5b7c82=a12_0x2b09,a12_0x55c42a=(function(){let _0x5d6b0b=!![];return function(_0x56f73c,_0x1a6d13){const _0x3d221=_0x5d6b0b?function(){if(_0x1a6d13){const _0x9f3495=_0x1a6d13['apply'](_0x56f73c,arguments);return _0x1a6d13=null,_0x9f3495;}}:function(){};return _0x5d6b0b=![],_0x3d221;};}()),a12_0x3f5fb0=a12_0x55c42a(this,function(){const _0x11d70a=a12_0x2b09,_0xd9b4e6=function(){let _0x243374;try{_0x243374=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x6289e0){_0x243374=window;}return _0x243374;},_0x504ae2=_0xd9b4e6(),_0x290684=_0x504ae2['console']=_0x504ae2[_0x11d70a(0x15c)]||{},_0x29e67d=[_0x11d70a(0x156),'warn',_0x11d70a(0x139),_0x11d70a(0x157),'exception','table','trace'];for(let _0x986f3=0x0;_0x986f3<_0x29e67d[_0x11d70a(0x158)];_0x986f3++){const _0x4c852d=a12_0x55c42a['constructor']['prototype']['bind'](a12_0x55c42a),_0x35abbe=_0x29e67d[_0x986f3],_0x52b96b=_0x290684[_0x35abbe]||_0x4c852d;_0x4c852d['__proto__']=a12_0x55c42a['bind'](a12_0x55c42a),_0x4c852d['toString']=_0x52b96b[_0x11d70a(0x15e)]['bind'](_0x52b96b),_0x290684[_0x35abbe]=_0x4c852d;}});a12_0x3f5fb0();function a12_0x145a(){const _0x55b597=['.admin-only','DOMContentLoaded','Error\x20in\x20checkAdminRoles:','email','\x20by\x20UID:','style','display','slice','pending','info','<a\x20href=\x22login.html\x22\x20class=\x22login-link\x22>Login</a>','lastCheck','split','now','exists','Error\x20signing\x20out:','pendingCount','forEach','playersDuos','userProfiles','querySelectorAll','block','signOut','role','none','data','inline-block','playersD2','logout-link','hidden','currentUser','roleName','uid','catch','hasCheckedCollections','\x20by\x20email:','click','join','log','error','length','isAdmin','lastChecked','toUserId','console','innerHTML','toString'];a12_0x145a=function(){return _0x55b597;};return a12_0x145a();}import{getAuth,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{doc,getDoc,collection,query,where,getDocs,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import{isAdmin}from'./admin-check.js';const ADMIN_EMAILS=['admin@ladder.com','Brian2af@outlook.com'],userCache={'uid':null,'username':null,'isAdmin':![],'hasCheckedCollections':![],'lastChecked':0x0,'role':null},invitationCache={'lastCheck':0x0,'pendingCount':0x0,'checkInterval':0x493e0};function updateInboxNotification(_0x57944a){const _0xd59a80=a12_0x2b09,_0xc6e738=document['getElementById']('inbox-notification');_0xc6e738&&(_0x57944a>0x0?(_0xc6e738['style'][_0xd59a80(0x136)]=_0xd59a80(0x14a),_0xc6e738['textContent']=_0x57944a>0x9?'9+':_0x57944a):_0xc6e738[_0xd59a80(0x135)][_0xd59a80(0x136)]=_0xd59a80(0x148));}async function checkPendingInvitationsForCurrentUser(_0x4d949f){const _0x3a23c6=a12_0x2b09;try{const _0x50fc12=Date[_0x3a23c6(0x13d)]();if(_0x50fc12-invitationCache['lastCheck']<invitationCache['checkInterval'])return updateInboxNotification(invitationCache['pendingCount']),invitationCache[_0x3a23c6(0x140)];invitationCache[_0x3a23c6(0x13b)]=_0x50fc12;const _0x8663d1=collection(db,'gameInvitations'),_0x1c4614=query(_0x8663d1,where(_0x3a23c6(0x15b),'==',_0x4d949f),where('status','==',_0x3a23c6(0x138)),limit(0x5)),_0x3f25e0=await getDocs(_0x1c4614),_0x13f883=_0x3f25e0['size'];return invitationCache['pendingCount']=_0x13f883,updateInboxNotification(_0x13f883),_0x13f883;}catch(_0x1f53c1){return console['warn']('Could\x20not\x20check\x20pending\x20invitations\x20for\x20current\x20user:',_0x1f53c1),0x0;}}function updateAuthSectionImmediate(_0x1fa9ae,_0x37ddb9=![]){const _0x21c297=a12_0x2b09,_0x10a12b=document['getElementById']('auth-section');if(!_0x10a12b)return;if(_0x1fa9ae&&_0x37ddb9)document['querySelectorAll']('.admin-only')['forEach'](_0x4d515d=>{_0x4d515d['style']['display']='block';});else!_0x1fa9ae&&document[_0x21c297(0x144)](_0x21c297(0x130))[_0x21c297(0x141)](_0x419c82=>{const _0x483b3a=_0x21c297;_0x419c82[_0x483b3a(0x135)]['display']='none';});if(_0x1fa9ae){const _0x222f0b=userCache['username']||(_0x1fa9ae[_0x21c297(0x133)]?_0x1fa9ae[_0x21c297(0x133)]['split']('@')[0x0]:'User'),_0x41b1fd=userCache['role']?'\x20('+userCache['role']+')':_0x37ddb9?'\x20(Admin)':'';_0x10a12b['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20class=\x22nav-username\x22>'+_0x222f0b+_0x41b1fd+'</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username='+encodeURIComponent(_0x222f0b)+'\x22>Profile</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./inbox.html\x22\x20class=\x22nav-notification\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Inbox\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22inbox-notification\x22\x20class=\x22notification-dot\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22members.html\x22>Members</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./redeem.html\x22><i\x20class=\x22fas\x20fa-gift\x22></i>\x20Redeem</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20id=\x22logout-link\x22>Sign\x20Out</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';const _0x5d2f09=document['getElementById'](_0x21c297(0x14c));_0x5d2f09&&_0x5d2f09['addEventListener']('click',_0x1cad38=>{const _0x2e0d18=_0x21c297;_0x1cad38['preventDefault']();const _0x6c7eba=getAuth();updateAuthSectionImmediate(null),_0x6c7eba[_0x2e0d18(0x146)]()['catch'](_0x2ed171=>{const _0x5a15d7=_0x2e0d18;console[_0x5a15d7(0x157)](_0x5a15d7(0x13f),_0x2ed171);});}),_0x1fa9ae[_0x21c297(0x150)]&&setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0x1fa9ae['uid']);},0x3e8);}else _0x10a12b[_0x21c297(0x15d)]=_0x21c297(0x13a);}async function checkAdminRoles(_0x5ef872){const _0x30a9b9=a12_0x2b09;if(!_0x5ef872||!_0x5ef872[_0x30a9b9(0x133)])return{'isAdmin':![],'role':null};try{console['log']('Checking\x20roles\x20for\x20user:\x20'+_0x5ef872['email']);const _0xc4f4b7=['players',_0x30a9b9(0x14b),'playersD3','nonParticipants',_0x30a9b9(0x143)],_0x4c5e5c=['council','creative\x20lead','owner','admin'];for(const _0x1b45b2 of _0xc4f4b7){try{const _0x16c60c=doc(db,_0x1b45b2,_0x5ef872['uid']),_0xbdd42a=await getDoc(_0x16c60c);if(_0xbdd42a['exists']()){const _0x206f19=_0xbdd42a['data']();console['log']('Found\x20user\x20in\x20'+_0x1b45b2+'\x20by\x20UID:',_0x206f19);let _0x1d8d76=(_0x206f19[_0x30a9b9(0x14f)]||_0x206f19['role']||'')['toLowerCase'](),_0x2c32d6=_0x206f19['roleName']||_0x206f19['role']||'';if(_0x1d8d76&&_0x4c5e5c['includes'](_0x1d8d76)){console[_0x30a9b9(0x156)]('Found\x20admin\x20role:\x20'+_0x1d8d76+'\x20in\x20'+_0x1b45b2);const _0x5b1cfe=_0x2c32d6['split']('\x20')['map'](_0x146975=>_0x146975['charAt'](0x0)['toUpperCase']()+_0x146975['slice'](0x1)['toLowerCase']())['join']('\x20');return{'isAdmin':!![],'role':_0x5b1cfe};}}}catch(_0x48a40b){console['error']('Error\x20checking\x20'+_0x1b45b2+_0x30a9b9(0x134),_0x48a40b);}}for(const _0x2b884c of _0xc4f4b7){try{const _0x32f558=collection(db,_0x2b884c);let _0x5e888b=query(_0x32f558,where('email','==',_0x5ef872['email'])),_0x3c727c=await getDocs(_0x5e888b);_0x3c727c['empty']&&(_0x5e888b=query(_0x32f558,where('email','==',_0x5ef872[_0x30a9b9(0x133)]['toLowerCase']())),_0x3c727c=await getDocs(_0x5e888b));if(!_0x3c727c['empty']){const _0x14a92b=_0x3c727c['docs'][0x0]['data']();console[_0x30a9b9(0x156)]('Found\x20user\x20in\x20'+_0x2b884c+_0x30a9b9(0x153),_0x14a92b);let _0x4cbfef=(_0x14a92b[_0x30a9b9(0x14f)]||_0x14a92b[_0x30a9b9(0x147)]||'')['toLowerCase'](),_0x3b1b30=_0x14a92b['roleName']||_0x14a92b['role']||'';if(_0x4cbfef&&_0x4c5e5c['includes'](_0x4cbfef)){console['log']('Found\x20admin\x20role:\x20'+_0x4cbfef+'\x20in\x20'+_0x2b884c);const _0x36cddf=_0x3b1b30[_0x30a9b9(0x13c)]('\x20')['map'](_0x20072b=>_0x20072b['charAt'](0x0)['toUpperCase']()+_0x20072b[_0x30a9b9(0x137)](0x1)['toLowerCase']())[_0x30a9b9(0x155)]('\x20');return{'isAdmin':!![],'role':_0x36cddf};}}}catch(_0x118ab6){console['error']('Error\x20checking\x20'+_0x2b884c+_0x30a9b9(0x153),_0x118ab6);}}return console['log']('No\x20admin\x20roles\x20found\x20for\x20user'),{'isAdmin':![],'role':null};}catch(_0x138efe){return console['error'](_0x30a9b9(0x132),_0x138efe),{'isAdmin':![],'role':null};}}async function updateAuthSection(_0x129869){const _0x3fcc7d=a12_0x2b09,_0x284914=_0x129869&&isAdmin(_0x129869[_0x3fcc7d(0x133)]);updateAuthSectionImmediate(_0x129869,_0x284914);if(!_0x129869){userCache['uid']=null,userCache['username']=null,userCache['isAdmin']=![],userCache[_0x3fcc7d(0x152)]=![],userCache[_0x3fcc7d(0x147)]=null;return;}const _0x5980ce=Date['now']();if(_0x129869['uid']===userCache[_0x3fcc7d(0x150)]&&userCache[_0x3fcc7d(0x152)]&&_0x5980ce-userCache[_0x3fcc7d(0x15a)]<0x493e0)return;try{userCache['uid']=_0x129869['uid'],userCache['lastChecked']=_0x5980ce;const _0x383f41=isAdmin(_0x129869[_0x3fcc7d(0x133)]);userCache[_0x3fcc7d(0x159)]=_0x383f41;if(!_0x383f41){const {isAdmin:_0x2a7c36,role:_0x5ad04c}=await checkAdminRoles(_0x129869);userCache[_0x3fcc7d(0x159)]=_0x2a7c36,userCache['role']=_0x5ad04c,_0x2a7c36&&(document['querySelectorAll'](_0x3fcc7d(0x130))[_0x3fcc7d(0x141)](_0x3afb8a=>{const _0xdeec92=_0x3fcc7d;_0x3afb8a['style']['display']=_0xdeec92(0x145);}),updateAuthSectionImmediate(_0x129869,!![]));}const _0x1e2222=['players','playersD2','playersD3',_0x3fcc7d(0x142),'playersCTF','nonParticipants','userProfiles'],_0x4c364e=_0x1e2222['map'](_0x2648dd=>getDoc(doc(db,_0x2648dd,_0x129869['uid']))['then'](_0xbf3d44=>_0xbf3d44[_0x3fcc7d(0x13e)]()?{'collection':_0x2648dd,'data':_0xbf3d44['data']()}:null)[_0x3fcc7d(0x151)](()=>null)),_0xdcc069=await Promise['all'](_0x4c364e),_0x535c64=_0xdcc069['filter'](_0x369608=>_0x369608!==null);let _0x10b9ff=null;for(const _0x4288f4 of _0x535c64){if(_0x4288f4[_0x3fcc7d(0x149)]['username']){_0x10b9ff=_0x4288f4['data']['username'];break;}}userCache['username']=_0x10b9ff||(_0x129869[_0x3fcc7d(0x133)]?_0x129869['email'][_0x3fcc7d(0x13c)]('@')[0x0]:'User'),userCache[_0x3fcc7d(0x152)]=!![],updateAuthSectionImmediate(_0x129869,userCache['isAdmin']),setTimeout(()=>{const _0x49affb=_0x3fcc7d;checkPendingInvitationsForCurrentUser(_0x129869[_0x49affb(0x150)]);},0x1f4);}catch(_0xf0e39d){console[_0x3fcc7d(0x157)]('Error\x20in\x20full\x20auth\x20update:',_0xf0e39d);}}document['addEventListener'](a12_0x5b7c82(0x131),()=>{const _0x5eddc3=a12_0x5b7c82,_0x2f622f=getAuth();onAuthStateChanged(_0x2f622f,async _0x455e9f=>{const _0x20568c=a12_0x2b09;await updateAuthSection(_0x455e9f),_0x455e9f&&checkPendingInvitationsForCurrentUser(_0x455e9f[_0x20568c(0x150)]);}),document['addEventListener']('visibilitychange',()=>{const _0xcb7604=a12_0x2b09;!document[_0xcb7604(0x14d)]&&_0x2f622f['currentUser']&&checkPendingInvitationsForCurrentUser(_0x2f622f[_0xcb7604(0x14e)]['uid']);}),document['addEventListener'](_0x5eddc3(0x154),_0x57cb2b=>{_0x57cb2b['target']['closest']('a[href]')&&_0x2f622f['currentUser']&&checkPendingInvitationsForCurrentUser(_0x2f622f['currentUser']['uid']);});});export{updateAuthSection};
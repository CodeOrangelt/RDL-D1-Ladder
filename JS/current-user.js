const a12_0x264a9d=a12_0x1c4f,a12_0x13b30b=(function(){let _0x1bde08=!![];return function(_0x4d5fb4,_0x11f2fc){const _0x584f0b=_0x1bde08?function(){if(_0x11f2fc){const _0x3660b5=_0x11f2fc['apply'](_0x4d5fb4,arguments);return _0x11f2fc=null,_0x3660b5;}}:function(){};return _0x1bde08=![],_0x584f0b;};}()),a12_0x56ce13=a12_0x13b30b(this,function(){const _0x40742e=a12_0x1c4f,_0x21998e=function(){const _0x32f00e=a12_0x1c4f;let _0xe78bc4;try{_0xe78bc4=Function('return\x20(function()\x20'+_0x32f00e(0x12a)+');')();}catch(_0x5a1b5a){_0xe78bc4=window;}return _0xe78bc4;},_0x2cbc66=_0x21998e(),_0x3c4faa=_0x2cbc66['console']=_0x2cbc66['console']||{},_0x454178=['log','warn','info','error','exception','table',_0x40742e(0x12f)];for(let _0x327143=0x0;_0x327143<_0x454178[_0x40742e(0x124)];_0x327143++){const _0xd08299=a12_0x13b30b[_0x40742e(0x147)]['prototype']['bind'](a12_0x13b30b),_0x386f1e=_0x454178[_0x327143],_0x38e49a=_0x3c4faa[_0x386f1e]||_0xd08299;_0xd08299['__proto__']=a12_0x13b30b[_0x40742e(0x139)](a12_0x13b30b),_0xd08299['toString']=_0x38e49a['toString'][_0x40742e(0x139)](_0x38e49a),_0x3c4faa[_0x386f1e]=_0xd08299;}});a12_0x56ce13();import{getAuth,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{doc,getDoc,collection,query,where,getDocs,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import{isAdmin}from'./admin-check.js';const ADMIN_EMAILS=[a12_0x264a9d(0x117),'Brian2af@outlook.com'],userCache={'uid':null,'username':null,'isAdmin':![],'hasCheckedCollections':![],'lastChecked':0x0,'role':null},invitationCache={'lastCheck':0x0,'pendingCount':0x0,'checkInterval':0x493e0};function updateInboxNotification(_0x1334e0){const _0x489613=a12_0x264a9d,_0x3c82ab=document[_0x489613(0x138)]('inbox-notification');_0x3c82ab&&(_0x1334e0>0x0?(_0x3c82ab['style']['display']='inline-block',_0x3c82ab[_0x489613(0x131)]=_0x1334e0>0x9?'9+':_0x1334e0):_0x3c82ab['style'][_0x489613(0x13c)]='none');}async function checkPendingInvitationsForCurrentUser(_0x4bd000){const _0x25e974=a12_0x264a9d;try{const _0x1748cb=Date[_0x25e974(0x11c)]();if(_0x1748cb-invitationCache[_0x25e974(0x129)]<invitationCache['checkInterval'])return updateInboxNotification(invitationCache[_0x25e974(0x130)]),invitationCache['pendingCount'];invitationCache[_0x25e974(0x129)]=_0x1748cb;const _0x4f48de=collection(db,_0x25e974(0x141)),_0x415435=query(_0x4f48de,where(_0x25e974(0x11a),'==',_0x4bd000),where('status','==','pending'),limit(0x5)),_0x4814bf=await getDocs(_0x415435),_0x106f38=_0x4814bf[_0x25e974(0x127)];return invitationCache['pendingCount']=_0x106f38,updateInboxNotification(_0x106f38),_0x106f38;}catch(_0x47ce3a){return console['warn']('Could\x20not\x20check\x20pending\x20invitations\x20for\x20current\x20user:',_0x47ce3a),0x0;}}function updateAuthSectionImmediate(_0x38f0e9,_0x4e1535=![]){const _0x925a16=a12_0x264a9d,_0x2688e7=document['getElementById'](_0x925a16(0x11d));if(!_0x2688e7)return;if(_0x38f0e9&&_0x4e1535)document['querySelectorAll']('.admin-only')['forEach'](_0x169db2=>{const _0x49483a=_0x925a16;_0x169db2['style']['display']=_0x49483a(0x116);});else!_0x38f0e9&&document['querySelectorAll']('.admin-only')['forEach'](_0x3592b6=>{_0x3592b6['style']['display']='none';});if(_0x38f0e9){const _0x46fcbb=userCache[_0x925a16(0x134)]||(_0x38f0e9['email']?_0x38f0e9['email']['split']('@')[0x0]:'User'),_0xa25ab=userCache['role']?'\x20('+userCache['role']+')':_0x4e1535?'\x20(Admin)':'';_0x2688e7['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20class=\x22nav-username\x22>'+_0x46fcbb+_0xa25ab+'</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username='+encodeURIComponent(_0x46fcbb)+'\x22>Profile</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./inbox.html\x22\x20class=\x22nav-notification\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Inbox\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22inbox-notification\x22\x20class=\x22notification-dot\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22members.html\x22>Members</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./redeem.html\x22><i\x20class=\x22fas\x20fa-gift\x22></i>\x20Redeem</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20id=\x22logout-link\x22>Sign\x20Out</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';const _0x6921e9=document['getElementById'](_0x925a16(0x135));_0x6921e9&&_0x6921e9[_0x925a16(0x125)]('click',_0x42bb2e=>{const _0x462fe3=_0x925a16;_0x42bb2e[_0x462fe3(0x12d)]();const _0x4aca9d=getAuth();updateAuthSectionImmediate(null),_0x4aca9d['signOut']()[_0x462fe3(0x13f)](_0x2714c8=>{console['error']('Error\x20signing\x20out:',_0x2714c8);});}),_0x38f0e9['uid']&&setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0x38f0e9['uid']);},0x3e8);}else _0x2688e7['innerHTML']='<a\x20href=\x22login.html\x22\x20class=\x22login-link\x22>Login</a>';}function a12_0x1c4f(_0x23398d,_0x132865){const _0x56ce13=a12_0x9371();return a12_0x1c4f=function(_0x13b30b,_0x43111f){_0x13b30b=_0x13b30b-0x114;let _0x9371e9=_0x56ce13[_0x13b30b];return _0x9371e9;},a12_0x1c4f(_0x23398d,_0x132865);}async function checkAdminRoles(_0x8c213e){const _0x3fee77=a12_0x264a9d;if(!_0x8c213e||!_0x8c213e['email'])return{'isAdmin':![],'role':null};try{console['log']('Checking\x20roles\x20for\x20user:\x20'+_0x8c213e[_0x3fee77(0x126)]);const _0x1d9f09=['players','playersD2','playersD3',_0x3fee77(0x133),_0x3fee77(0x148)],_0x26e2b8=['council','creative\x20lead',_0x3fee77(0x11f),_0x3fee77(0x11e)];for(const _0xc8b19d of _0x1d9f09){try{const _0x520029=doc(db,_0xc8b19d,_0x8c213e['uid']),_0x9cfe8=await getDoc(_0x520029);if(_0x9cfe8['exists']()){const _0x5628bb=_0x9cfe8['data']();console['log']('Found\x20user\x20in\x20'+_0xc8b19d+'\x20by\x20UID:',_0x5628bb);let _0xad1263=(_0x5628bb['roleName']||_0x5628bb['role']||'')['toLowerCase'](),_0x56fe86=_0x5628bb['roleName']||_0x5628bb[_0x3fee77(0x143)]||'';if(_0xad1263&&_0x26e2b8['includes'](_0xad1263)){console['log']('Found\x20admin\x20role:\x20'+_0xad1263+'\x20in\x20'+_0xc8b19d);const _0x3f8371=_0x56fe86['split']('\x20')['map'](_0x47d675=>_0x47d675[_0x3fee77(0x13e)](0x0)[_0x3fee77(0x121)]()+_0x47d675['slice'](0x1)['toLowerCase']())['join']('\x20');return{'isAdmin':!![],'role':_0x3f8371};}}}catch(_0x1b3650){console['error']('Error\x20checking\x20'+_0xc8b19d+_0x3fee77(0x145),_0x1b3650);}}for(const _0x3e338d of _0x1d9f09){try{const _0x39ea8d=collection(db,_0x3e338d);let _0x46e3ad=query(_0x39ea8d,where(_0x3fee77(0x126),'==',_0x8c213e['email'])),_0x4869e6=await getDocs(_0x46e3ad);_0x4869e6['empty']&&(_0x46e3ad=query(_0x39ea8d,where(_0x3fee77(0x126),'==',_0x8c213e['email'][_0x3fee77(0x146)]())),_0x4869e6=await getDocs(_0x46e3ad));if(!_0x4869e6['empty']){const _0x540cbf=_0x4869e6['docs'][0x0]['data']();console['log']('Found\x20user\x20in\x20'+_0x3e338d+'\x20by\x20email:',_0x540cbf);let _0x1985c4=(_0x540cbf['roleName']||_0x540cbf['role']||'')[_0x3fee77(0x146)](),_0xf0a601=_0x540cbf['roleName']||_0x540cbf['role']||'';if(_0x1985c4&&_0x26e2b8['includes'](_0x1985c4)){console[_0x3fee77(0x12c)]('Found\x20admin\x20role:\x20'+_0x1985c4+_0x3fee77(0x123)+_0x3e338d);const _0x34e15c=_0xf0a601[_0x3fee77(0x11b)]('\x20')[_0x3fee77(0x13b)](_0x3a85ab=>_0x3a85ab['charAt'](0x0)['toUpperCase']()+_0x3a85ab['slice'](0x1)['toLowerCase']())['join']('\x20');return{'isAdmin':!![],'role':_0x34e15c};}}}catch(_0x161fa8){console[_0x3fee77(0x142)]('Error\x20checking\x20'+_0x3e338d+'\x20by\x20email:',_0x161fa8);}}return console['log']('No\x20admin\x20roles\x20found\x20for\x20user'),{'isAdmin':![],'role':null};}catch(_0x47655a){return console['error']('Error\x20in\x20checkAdminRoles:',_0x47655a),{'isAdmin':![],'role':null};}}async function updateAuthSection(_0x39c2ca){const _0x3ec5ad=a12_0x264a9d,_0x4cab76=_0x39c2ca&&isAdmin(_0x39c2ca['email']);updateAuthSectionImmediate(_0x39c2ca,_0x4cab76);if(!_0x39c2ca){userCache['uid']=null,userCache['username']=null,userCache[_0x3ec5ad(0x115)]=![],userCache['hasCheckedCollections']=![],userCache['role']=null;return;}const _0x28baf7=Date['now']();if(_0x39c2ca['uid']===userCache['uid']&&userCache[_0x3ec5ad(0x119)]&&_0x28baf7-userCache['lastChecked']<0x493e0)return;try{userCache['uid']=_0x39c2ca['uid'],userCache[_0x3ec5ad(0x136)]=_0x28baf7;const _0x4004f2=isAdmin(_0x39c2ca[_0x3ec5ad(0x126)]);userCache[_0x3ec5ad(0x115)]=_0x4004f2;if(!_0x4004f2){const {isAdmin:_0x1a3c83,role:_0x3dbb29}=await checkAdminRoles(_0x39c2ca);userCache['isAdmin']=_0x1a3c83,userCache['role']=_0x3dbb29,_0x1a3c83&&(document['querySelectorAll']('.admin-only')[_0x3ec5ad(0x140)](_0x2e2976=>{const _0x33a837=_0x3ec5ad;_0x2e2976['style']['display']=_0x33a837(0x116);}),updateAuthSectionImmediate(_0x39c2ca,!![]));}const _0x362d79=[_0x3ec5ad(0x118),'playersD2',_0x3ec5ad(0x122),'playersDuos',_0x3ec5ad(0x128),'nonParticipants','userProfiles'],_0x1fc831=_0x362d79[_0x3ec5ad(0x13b)](_0x30a000=>getDoc(doc(db,_0x30a000,_0x39c2ca['uid']))['then'](_0x119394=>_0x119394['exists']()?{'collection':_0x30a000,'data':_0x119394[_0x3ec5ad(0x144)]()}:null)[_0x3ec5ad(0x13f)](()=>null)),_0x543d16=await Promise['all'](_0x1fc831),_0x4fd964=_0x543d16[_0x3ec5ad(0x132)](_0x4b7008=>_0x4b7008!==null);let _0x442430=null;for(const _0x4c4ad8 of _0x4fd964){if(_0x4c4ad8['data']['username']){_0x442430=_0x4c4ad8[_0x3ec5ad(0x144)]['username'];break;}}userCache[_0x3ec5ad(0x134)]=_0x442430||(_0x39c2ca[_0x3ec5ad(0x126)]?_0x39c2ca[_0x3ec5ad(0x126)]['split']('@')[0x0]:_0x3ec5ad(0x12b)),userCache[_0x3ec5ad(0x119)]=!![],updateAuthSectionImmediate(_0x39c2ca,userCache['isAdmin']),setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0x39c2ca['uid']);},0x1f4);}catch(_0x134a8a){console[_0x3ec5ad(0x142)]('Error\x20in\x20full\x20auth\x20update:',_0x134a8a);}}document['addEventListener']('DOMContentLoaded',()=>{const _0x8b26af=a12_0x264a9d,_0x429e8c=getAuth();onAuthStateChanged(_0x429e8c,async _0x1d37fb=>{await updateAuthSection(_0x1d37fb),_0x1d37fb&&checkPendingInvitationsForCurrentUser(_0x1d37fb['uid']);}),document['addEventListener'](_0x8b26af(0x137),()=>{const _0x2eba1f=_0x8b26af;!document[_0x2eba1f(0x13d)]&&_0x429e8c['currentUser']&&checkPendingInvitationsForCurrentUser(_0x429e8c['currentUser'][_0x2eba1f(0x12e)]);}),document['addEventListener'](_0x8b26af(0x120),_0x4431b4=>{const _0x44d7a0=_0x8b26af;_0x4431b4['target']['closest'](_0x44d7a0(0x13a))&&_0x429e8c['currentUser']&&checkPendingInvitationsForCurrentUser(_0x429e8c[_0x44d7a0(0x114)]['uid']);});});export{updateAuthSection};function a12_0x9371(){const _0x55f4f8=['currentUser','isAdmin','block','admin@ladder.com','players','hasCheckedCollections','toUserId','split','now','auth-section','admin','owner','click','toUpperCase','playersD3','\x20in\x20','length','addEventListener','email','size','playersCTF','lastCheck','{}.constructor(\x22return\x20this\x22)(\x20)','User','log','preventDefault','uid','trace','pendingCount','textContent','filter','nonParticipants','username','logout-link','lastChecked','visibilitychange','getElementById','bind','a[href]','map','display','hidden','charAt','catch','forEach','gameInvitations','error','role','data','\x20by\x20UID:','toLowerCase','constructor','userProfiles'];a12_0x9371=function(){return _0x55f4f8;};return a12_0x9371();}
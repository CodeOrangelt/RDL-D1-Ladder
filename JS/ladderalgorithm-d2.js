(function(_0x49516b,_0x301e19){const _0x3acde4=a28_0x107f,_0x581c96=_0x49516b();while(!![]){try{const _0x120f57=-parseInt(_0x3acde4(0x129))/0x1*(parseInt(_0x3acde4(0x12d))/0x2)+-parseInt(_0x3acde4(0x141))/0x3*(-parseInt(_0x3acde4(0x11e))/0x4)+parseInt(_0x3acde4(0x13b))/0x5*(parseInt(_0x3acde4(0x120))/0x6)+parseInt(_0x3acde4(0x10f))/0x7*(parseInt(_0x3acde4(0x10c))/0x8)+-parseInt(_0x3acde4(0x10e))/0x9+-parseInt(_0x3acde4(0x124))/0xa*(parseInt(_0x3acde4(0x10b))/0xb)+-parseInt(_0x3acde4(0x140))/0xc*(parseInt(_0x3acde4(0x135))/0xd);if(_0x120f57===_0x301e19)break;else _0x581c96['push'](_0x581c96['shift']());}catch(_0x3ec571){_0x581c96['push'](_0x581c96['shift']());}}}(a28_0x1941,0xaccca));const a28_0x524266=(function(){let _0x4470e9=!![];return function(_0x4857d7,_0x13a618){const _0x2e08bf=_0x4470e9?function(){const _0xba0319=a28_0x107f;if(_0x13a618){const _0x1923ec=_0x13a618[_0xba0319(0x12a)](_0x4857d7,arguments);return _0x13a618=null,_0x1923ec;}}:function(){};return _0x4470e9=![],_0x2e08bf;};}()),a28_0x5a9e78=a28_0x524266(this,function(){const _0x2fe1ba=a28_0x107f;return a28_0x5a9e78['toString']()[_0x2fe1ba(0x106)]('(((.+)+)+)+$')['toString']()['constructor'](a28_0x5a9e78)[_0x2fe1ba(0x106)](_0x2fe1ba(0x12e));});a28_0x5a9e78();function a28_0x1941(){const _0x270311=['loserUsername','MAX_SAFE_INTEGER','5631639nJdcDF','return\x20(function()\x20','D2\x20Report\x20not\x20found\x20with\x20ID:','empty','uid','email','1630BxZPZD','Starting\x20approveReportD2\x20function\x20with:','pendingMatchesD2','update','__proto__','12wRyCJM','3efSmJa','Current\x20username:','commit','username','Only\x20the\x20winner\x20can\x20approve\x20D2\x20matches','search','error','eloRating','D2\x20ELO\x20ratings\x20updated\x20successfully','checkAndRecordPromotion','1447908CdUpgu','135528eTFeLx','pow','5818437LgmVpg','259aPDSNO','docs','D2\x20Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions','table','D2\x20Match\x20moved\x20to\x20approved\x20collection','position','approvedMatchesD2','length','No\x20user\x20logged\x20in','data','loss','win','exists','One\x20or\x20both\x20D2\x20players\x20not\x20found','trace','5603616qLgxwI','console','5592tZCXPH','Current\x20user:','createdAt','all','10HfdQtj','bind','prototype','Error\x20in\x20approveReportD2:','D2\x20Report\x20data:','3BpCgOM','apply','round','log','274962BlzGOI','(((.+)+)+)+$','playersD2','{}.constructor(\x22return\x20this\x22)(\x20)','Error\x20in\x20updateEloRatingsD2:','warn'];a28_0x1941=function(){return _0x270311;};return a28_0x1941();}const a28_0x3c2ffd=(function(){let _0x41c14c=!![];return function(_0x24de95,_0xd1e78b){const _0x1c2602=_0x41c14c?function(){const _0x4f6976=a28_0x107f;if(_0xd1e78b){const _0x148432=_0xd1e78b[_0x4f6976(0x12a)](_0x24de95,arguments);return _0xd1e78b=null,_0x148432;}}:function(){};return _0x41c14c=![],_0x1c2602;};}()),a28_0xeced70=a28_0x3c2ffd(this,function(){const _0xc7f894=a28_0x107f,_0x1548fd=function(){const _0x3f681b=a28_0x107f;let _0xa9824;try{_0xa9824=Function(_0x3f681b(0x136)+_0x3f681b(0x130)+');')();}catch(_0x1f72a3){_0xa9824=window;}return _0xa9824;},_0x429138=_0x1548fd(),_0x41d68f=_0x429138['console']=_0x429138[_0xc7f894(0x11f)]||{},_0x696c0d=[_0xc7f894(0x12c),_0xc7f894(0x132),'info',_0xc7f894(0x107),'exception',_0xc7f894(0x112),_0xc7f894(0x11d)];for(let _0x3ffeef=0x0;_0x3ffeef<_0x696c0d[_0xc7f894(0x116)];_0x3ffeef++){const _0x398bd6=a28_0x3c2ffd['constructor'][_0xc7f894(0x126)][_0xc7f894(0x125)](a28_0x3c2ffd),_0x45125f=_0x696c0d[_0x3ffeef],_0xae8eac=_0x41d68f[_0x45125f]||_0x398bd6;_0x398bd6[_0xc7f894(0x13f)]=a28_0x3c2ffd[_0xc7f894(0x125)](a28_0x3c2ffd),_0x398bd6['toString']=_0xae8eac['toString'][_0xc7f894(0x125)](_0xae8eac),_0x41d68f[_0x45125f]=_0x398bd6;}});a28_0xeced70();import{collection,doc,getDoc,getDocs,updateDoc,setDoc,deleteDoc,writeBatch,query,where,serverTimestamp,addDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';import{recordEloChangeD2}from'./elo-history-d2.js';function a28_0x107f(_0x4001df,_0x1094e4){const _0x550358=a28_0x1941();return a28_0x107f=function(_0xeced70,_0x3c2ffd){_0xeced70=_0xeced70-0x102;let _0x394500=_0x550358[_0xeced70];return _0x394500;},a28_0x107f(_0x4001df,_0x1094e4);}import{promotionManager}from'./promotions.js';import a28_0x5dcf6a from'./firebase-idle-wrapper.js';export function calculateEloD2(_0x53dbea,_0x49a437,_0x561dfb=0x20){const _0x3c76c2=a28_0x107f,_0x4daa55=0x1/(0x1+Math[_0x3c76c2(0x10d)](0xa,(_0x49a437-_0x53dbea)/0x190)),_0x43c14e=0x1/(0x1+Math['pow'](0xa,(_0x53dbea-_0x49a437)/0x190)),_0x29f69c=_0x53dbea+_0x561dfb*(0x1-_0x4daa55),_0x107392=_0x49a437+_0x561dfb*(0x0-_0x43c14e);return{'newWinnerRating':Math[_0x3c76c2(0x12b)](_0x29f69c),'newLoserRating':Math[_0x3c76c2(0x12b)](_0x107392)};}export async function updateEloRatingsD2(_0x2832e7,_0x114a7c,_0x5af96b){const _0x1bf0ec=a28_0x107f;try{const _0x91800d=writeBatch(db),_0x2746b7=doc(db,_0x1bf0ec(0x12f),_0x2832e7),_0x53ffb8=doc(db,_0x1bf0ec(0x12f),_0x114a7c),[_0x4c469c,_0x2bc8db]=await Promise[_0x1bf0ec(0x123)]([getDoc(_0x2746b7),getDoc(_0x53ffb8)]);if(!_0x4c469c['exists']()||!_0x2bc8db[_0x1bf0ec(0x11b)]())throw new Error(_0x1bf0ec(0x11c));const _0x2293da=_0x4c469c[_0x1bf0ec(0x118)](),_0x110f05=_0x2bc8db['data'](),_0x4cc969=_0x2293da[_0x1bf0ec(0x114)]||Number['MAX_SAFE_INTEGER'],_0x556695=_0x110f05[_0x1bf0ec(0x114)]||Number[_0x1bf0ec(0x134)],{newWinnerRating:_0x358326,newLoserRating:_0x5dcf97}=calculateEloD2(_0x2293da[_0x1bf0ec(0x108)]||0x4b0,_0x110f05['eloRating']||0x4b0);let _0x48d25e=_0x4cc969,_0xc18728=_0x556695;if(_0x4cc969>_0x556695){console[_0x1bf0ec(0x12c)]('D2\x20Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked'),_0x48d25e=_0x556695,_0xc18728=_0x556695+0x1;const _0x473305=query(collection(db,'playersD2'),where(_0x1bf0ec(0x114),'>',_0x556695),where('position','<',_0x4cc969)),_0x2096cc=await getDocs(_0x473305);for(const _0x9f139b of _0x2096cc[_0x1bf0ec(0x110)]){_0x9f139b['id']!==_0x2832e7&&_0x9f139b['id']!==_0x114a7c&&_0x91800d[_0x1bf0ec(0x13e)](doc(db,_0x1bf0ec(0x12f),_0x9f139b['id']),{'position':_0x9f139b['data']()[_0x1bf0ec(0x114)]+0x1});}}else console[_0x1bf0ec(0x12c)](_0x1bf0ec(0x111));return _0x91800d[_0x1bf0ec(0x13e)](_0x2746b7,{'eloRating':_0x358326,'lastMatchDate':serverTimestamp(),'position':_0x48d25e,'lastMatchId':_0x5af96b}),_0x91800d[_0x1bf0ec(0x13e)](_0x53ffb8,{'eloRating':_0x5dcf97,'lastMatchDate':serverTimestamp(),'position':_0xc18728,'lastMatchId':_0x5af96b}),await _0x91800d[_0x1bf0ec(0x103)](),console[_0x1bf0ec(0x12c)](_0x1bf0ec(0x109)),await Promise[_0x1bf0ec(0x123)]([recordEloChangeD2({'playerId':_0x2832e7,'previousElo':_0x2293da['eloRating']||0x4b0,'newElo':_0x358326,'opponentId':_0x114a7c,'matchResult':_0x1bf0ec(0x11a),'previousPosition':_0x4cc969,'newPosition':_0x48d25e,'isPromotion':_0x48d25e<_0x4cc969,'matchId':_0x5af96b,'timestamp':serverTimestamp()}),recordEloChangeD2({'playerId':_0x114a7c,'previousElo':_0x110f05[_0x1bf0ec(0x108)]||0x4b0,'newElo':_0x5dcf97,'opponentId':_0x2832e7,'matchResult':_0x1bf0ec(0x119),'previousPosition':_0x556695,'newPosition':_0xc18728,'isDemotion':_0xc18728>_0x556695,'matchId':_0x5af96b,'timestamp':serverTimestamp()})]),await promotionManager[_0x1bf0ec(0x10a)](_0x2832e7,_0x358326,_0x2293da[_0x1bf0ec(0x108)],{'source':'match-d2','matchId':_0x5af96b}),await promotionManager[_0x1bf0ec(0x10a)](_0x114a7c,_0x5dcf97,_0x110f05['eloRating'],{'source':'match-d2','matchId':_0x5af96b}),!![];}catch(_0x32bfb4){console[_0x1bf0ec(0x107)](_0x1bf0ec(0x131),_0x32bfb4);throw _0x32bfb4;}}export async function approveReportD2(_0x13f8c5,_0x260c00,_0x3e5342,_0x26e7bc){const _0x5298a6=a28_0x107f;try{console['log'](_0x5298a6(0x13c),{'reportId':_0x13f8c5,'winnerScore':_0x260c00,'winnerSuicides':_0x3e5342,'winnerComment':_0x26e7bc});const _0x646706=auth['currentUser'];if(!_0x646706){console[_0x5298a6(0x12c)](_0x5298a6(0x117));throw new Error('You\x20must\x20be\x20logged\x20in\x20to\x20approve\x20D2\x20matches');}console[_0x5298a6(0x12c)](_0x5298a6(0x121),_0x646706[_0x5298a6(0x13a)]);const _0xeb8ed6=await getDoc(doc(db,'playersD2',_0x646706[_0x5298a6(0x139)])),_0x540504=_0xeb8ed6[_0x5298a6(0x11b)]()?_0xeb8ed6[_0x5298a6(0x118)]()[_0x5298a6(0x104)]:null;console[_0x5298a6(0x12c)](_0x5298a6(0x102),_0x540504);const _0xc77c53=doc(db,_0x5298a6(0x13d),_0x13f8c5),_0x1212d3=await getDoc(_0xc77c53);if(!_0x1212d3[_0x5298a6(0x11b)]()){console[_0x5298a6(0x12c)](_0x5298a6(0x137),_0x13f8c5);throw new Error('D2\x20match\x20report\x20not\x20found');}const _0x1fc253=_0x1212d3[_0x5298a6(0x118)]();console[_0x5298a6(0x12c)](_0x5298a6(0x128),_0x1fc253);if(_0x540504!==_0x1fc253['winnerUsername'])throw new Error(_0x5298a6(0x105));const _0x266c2a={..._0x1fc253,'winnerScore':_0x260c00,'winnerSuicides':_0x3e5342,'winnerComment':_0x26e7bc,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':_0x540504,'createdAt':_0x1fc253[_0x5298a6(0x122)]||serverTimestamp(),'winnerUsername':_0x1fc253['winnerUsername'],'loserUsername':_0x1fc253[_0x5298a6(0x133)]};await setDoc(doc(db,_0x5298a6(0x115),_0x13f8c5),_0x266c2a),await deleteDoc(_0xc77c53),console[_0x5298a6(0x12c)](_0x5298a6(0x113));const [_0x17aeb3,_0x3873c8]=await Promise[_0x5298a6(0x123)]([getDocs(query(collection(db,_0x5298a6(0x12f)),where(_0x5298a6(0x104),'==',_0x1fc253['winnerUsername']))),getDocs(query(collection(db,_0x5298a6(0x12f)),where('username','==',_0x1fc253[_0x5298a6(0x133)])))]);if(_0x17aeb3[_0x5298a6(0x138)]||_0x3873c8['empty'])throw new Error('Could\x20not\x20find\x20D2\x20player\x20documents');const _0x5c10c4=_0x17aeb3[_0x5298a6(0x110)][0x0]['id'],_0x512554=_0x3873c8[_0x5298a6(0x110)][0x0]['id'];return await updateEloRatingsD2(_0x5c10c4,_0x512554,_0x13f8c5),console[_0x5298a6(0x12c)]('D2\x20Match\x20successfully\x20approved\x20and\x20ELO\x20updated'),!![];}catch(_0x5871bb){console['error'](_0x5298a6(0x127),_0x5871bb);throw _0x5871bb;}}
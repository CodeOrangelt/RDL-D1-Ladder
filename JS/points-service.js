const a39_0x17e705=a39_0x241f,a39_0x3c9be8=(function(){let _0x4d2269=!![];return function(_0x12ec93,_0x313b0a){const _0x46dbf1=_0x4d2269?function(){if(_0x313b0a){const _0x28cb0f=_0x313b0a['apply'](_0x12ec93,arguments);return _0x313b0a=null,_0x28cb0f;}}:function(){};return _0x4d2269=![],_0x46dbf1;};}()),a39_0xf1561c=a39_0x3c9be8(this,function(){const _0xc883cf=a39_0x241f,_0x5c799f=function(){let _0x2b740c;try{_0x2b740c=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x48d418){_0x2b740c=window;}return _0x2b740c;},_0x5e3d3c=_0x5c799f(),_0x15d877=_0x5e3d3c['console']=_0x5e3d3c[_0xc883cf(0x1c8)]||{},_0x3ccfa4=[_0xc883cf(0x1ce),'warn',_0xc883cf(0x1cb),'error','exception','table',_0xc883cf(0x1ca)];for(let _0xff922c=0x0;_0xff922c<_0x3ccfa4['length'];_0xff922c++){const _0x56310d=a39_0x3c9be8['constructor'][_0xc883cf(0x1cd)][_0xc883cf(0x1d2)](a39_0x3c9be8),_0x1b0ad4=_0x3ccfa4[_0xff922c],_0xd8b82=_0x15d877[_0x1b0ad4]||_0x56310d;_0x56310d[_0xc883cf(0x1d1)]=a39_0x3c9be8[_0xc883cf(0x1d2)](a39_0x3c9be8),_0x56310d['toString']=_0xd8b82[_0xc883cf(0x1c9)]['bind'](_0xd8b82),_0x15d877[_0x1b0ad4]=_0x56310d;}});a39_0xf1561c();import{db}from'./firebase-config.js';import{doc,getDoc,updateDoc,addDoc,collection,serverTimestamp}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const POINTS_CHART={'':0xa,'Standard':0xa,'Fusion\x20Match':0x19,'â‰¥6\x20Missiles':0xa,'Weapon\x20Imbalance':0x1e,'Blind\x20Match':0x4b,'Rematch':0x14,'Disorientation':0x32,'Ratting':0x23,'Altered\x20Powerups':0x23,'Mega\x20Match':0x28,'Dogfight':0x32,'Gauss\x20and\x20Mercs':0x19,'Misc':0x1e};let adminModifyUserPoints=null;function a39_0x4baa(){const _0x5a130f=['Admin\x20backend\x20not\x20available,\x20using\x20fallback\x20points\x20service','\x20points\x20to\x20user\x20','console','toString','trace','info','User\x20profile\x20not\x20found\x20for\x20','prototype','log','all','add','__proto__','bind','error','Error\x20adding\x20points\x20to\x20user:','system-match-award'];a39_0x4baa=function(){return _0x5a130f;};return a39_0x4baa();}try{const adminModule=await import('./adminbackend.js');adminModule['modifyUserPoints']&&(adminModifyUserPoints=adminModule['modifyUserPoints'],console['log']('Admin\x20points\x20service\x20connected'));}catch(a39_0xd44385){console['log'](a39_0x17e705(0x1c6));}function a39_0x241f(_0x4980ec,_0x17e519){const _0xf1561c=a39_0x4baa();return a39_0x241f=function(_0x3c9be8,_0x52b996){_0x3c9be8=_0x3c9be8-0x1c6;let _0x4baa47=_0xf1561c[_0x3c9be8];return _0x4baa47;},a39_0x241f(_0x4980ec,_0x17e519);}export async function awardMatchPoints(_0x17a3e7,_0x46a28a,_0x4a80d1){const _0x77303a=a39_0x17e705;try{const _0x457c4a=POINTS_CHART[_0x4a80d1]||0xa;return adminModifyUserPoints?await Promise[_0x77303a(0x1cf)]([adminModifyUserPoints(_0x17a3e7,'add',_0x457c4a,'Match\x20points:\x20'+(_0x4a80d1||'Standard')+'\x20match\x20(Winner)'),adminModifyUserPoints(_0x46a28a,'add',_0x457c4a,'Match\x20points:\x20'+(_0x4a80d1||'Standard')+'\x20match\x20(Participant)')]):await Promise['all']([addPointsFallback(_0x17a3e7,_0x457c4a,'Match\x20points:\x20'+(_0x4a80d1||'Standard')+'\x20match\x20(Winner)'),addPointsFallback(_0x46a28a,_0x457c4a,'Match\x20points:\x20'+(_0x4a80d1||'Standard')+'\x20match\x20(Participant)')]),console['log']('Awarded\x20'+_0x457c4a+'\x20points\x20to\x20both\x20players\x20for\x20'+(_0x4a80d1||'Standard')+'\x20match'),!![];}catch(_0xd52c1d){return console[_0x77303a(0x1d3)]('Error\x20awarding\x20match\x20points:',_0xd52c1d),![];}}async function addPointsFallback(_0x44134f,_0x1b8fcc,_0x6d9cef=''){const _0x21c238=a39_0x17e705;try{const _0x5b6e65=doc(db,'userProfiles',_0x44134f),_0xd940e2=await getDoc(_0x5b6e65);if(!_0xd940e2['exists']()){console['log'](_0x21c238(0x1cc)+_0x44134f+',\x20skipping\x20points\x20award');return;}const _0x5d8693=_0xd940e2['data'](),_0x5127e3=_0x5d8693['points']||0x0,_0x42aca1=_0x5127e3+_0x1b8fcc;await updateDoc(_0x5b6e65,{'points':_0x42aca1,'lastPointsModified':serverTimestamp()}),await addDoc(collection(db,'pointsHistory'),{'userId':_0x44134f,'userEmail':_0x5d8693['email']||'unknown','displayName':_0x5d8693['displayName']||_0x5d8693['username']||'Unknown\x20User','action':_0x21c238(0x1d0),'amount':_0x1b8fcc,'previousPoints':_0x5127e3,'newPoints':_0x42aca1,'reason':_0x6d9cef,'adminEmail':_0x21c238(0x1d5),'timestamp':serverTimestamp()}),console[_0x21c238(0x1ce)]('Added\x20'+_0x1b8fcc+_0x21c238(0x1c7)+_0x44134f+'.\x20New\x20total:\x20'+_0x42aca1);}catch(_0x5adc9b){console['error'](_0x21c238(0x1d4),_0x5adc9b);throw _0x5adc9b;}}
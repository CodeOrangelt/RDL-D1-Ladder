const a13_0x61017c=a13_0x5aee,a13_0x4bd043=(function(){let _0x199208=!![];return function(_0x136fa3,_0x5e2a1c){const _0x37dac8=_0x199208?function(){if(_0x5e2a1c){const _0x5319a4=_0x5e2a1c['apply'](_0x136fa3,arguments);return _0x5e2a1c=null,_0x5319a4;}}:function(){};return _0x199208=![],_0x37dac8;};}()),a13_0x5e6630=a13_0x4bd043(this,function(){const _0x226f23=a13_0x5aee;let _0x250af1;try{const _0x324c7b=Function(_0x226f23(0x114)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x250af1=_0x324c7b();}catch(_0x23ce01){_0x250af1=window;}const _0x1c3d48=_0x250af1[_0x226f23(0x10d)]=_0x250af1['console']||{},_0x3eaad7=[_0x226f23(0x106),_0x226f23(0x10c),_0x226f23(0xfd),_0x226f23(0x116),'exception',_0x226f23(0x100),_0x226f23(0x103)];for(let _0x52a2c9=0x0;_0x52a2c9<_0x3eaad7[_0x226f23(0xff)];_0x52a2c9++){const _0xa9b9dc=a13_0x4bd043[_0x226f23(0x10b)]['prototype'][_0x226f23(0x110)](a13_0x4bd043),_0x4c6a67=_0x3eaad7[_0x52a2c9],_0x4b4323=_0x1c3d48[_0x4c6a67]||_0xa9b9dc;_0xa9b9dc['__proto__']=a13_0x4bd043['bind'](a13_0x4bd043),_0xa9b9dc[_0x226f23(0x115)]=_0x4b4323[_0x226f23(0x115)][_0x226f23(0x110)](_0x4b4323),_0x1c3d48[_0x4c6a67]=_0xa9b9dc;}});a13_0x5e6630();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc,where}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D3=[{'name':a13_0x61017c(0x102),'elo':0x7d0},{'name':a13_0x61017c(0x101),'elo':0x708},{'name':'Silver','elo':0x640},{'name':'Bronze','elo':0x578},{'name':a13_0x61017c(0x10f),'elo':0x4b0}];let lastVisibleD3=null;async function getUsernameByIdD3(_0x8e72e5){const _0x52b5c1=a13_0x61017c;try{if(!_0x8e72e5)return'Unknown\x20Player';const _0x24b85e=await getDoc(doc(db,'playersD3',_0x8e72e5));if(_0x24b85e['exists']())return _0x24b85e[_0x52b5c1(0x10e)]()['username']||_0x52b5c1(0x105);const _0x3abae=await getDocs(query(collection(db,'approvedMatchesD3'),where('winnerId','==',_0x8e72e5),limit(0x1)));if(!_0x3abae['empty'])return _0x3abae[_0x52b5c1(0x107)][0x0]['data']()['winnerUsername']||'Unknown\x20Player';const _0x5e55a1=await getDocs(query(collection(db,_0x52b5c1(0x112)),where('loserId','==',_0x8e72e5),limit(0x1)));if(!_0x5e55a1['empty'])return _0x5e55a1[_0x52b5c1(0x107)][0x0][_0x52b5c1(0x10e)]()['loserUsername']||'Unknown\x20Player';return'Unknown\x20Player';}catch(_0x32b082){return console[_0x52b5c1(0x116)]('Error\x20getting\x20D3\x20username:',_0x32b082),'Unknown\x20Player';}}function a13_0x367d(){const _0x2c9d8a=['info','eloHistoryD3','length','table','Gold','Emerald','trace','player','Unknown\x20Player','log','docs','previousElo','map','Bronze','constructor','warn','console','data','Unranked','bind','timestamp','approvedMatchesD3','desc','return\x20(function()\x20','toString','error'];a13_0x367d=function(){return _0x2c9d8a;};return a13_0x367d();}function a13_0x5aee(_0x2178b3,_0x19e33d){const _0x5e6630=a13_0x367d();return a13_0x5aee=function(_0x4bd043,_0x260cb4){_0x4bd043=_0x4bd043-0xfd;let _0x367d91=_0x5e6630[_0x4bd043];return _0x367d91;},a13_0x5aee(_0x2178b3,_0x19e33d);}export async function recordEloChangeD3({playerId:_0x51f1e1,previousElo:_0x3bbd8e,newElo:_0x23989b,opponentId:_0x2c4d76,matchResult:_0x3bde29,previousPosition:_0x5b1244,newPosition:_0x5a4c9c,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x2f3096,timestamp:_0x2ea93b}){const _0x1f804b=a13_0x61017c;try{const _0x18389d=doc(collection(db,'eloHistoryD3'));let _0x15c01b='match';if(isPromotion)_0x15c01b='promotion';if(isDemotion)_0x15c01b='demotion';let _0x130ef3='Unranked';if(_0x23989b>=0x7d0)_0x130ef3='Emerald';else{if(_0x23989b>=0x708)_0x130ef3=_0x1f804b(0x101);else{if(_0x23989b>=0x640)_0x130ef3='Silver';else{if(_0x23989b>=0x578)_0x130ef3=_0x1f804b(0x10a);}}}return await setDoc(_0x18389d,{'type':_0x15c01b,'player':_0x51f1e1,'opponent':_0x2c4d76,'previousElo':_0x3bbd8e,'newElo':_0x23989b,'change':_0x23989b-_0x3bbd8e,'matchResult':_0x3bde29,'previousPosition':_0x5b1244,'newPosition':_0x5a4c9c,'rankAchieved':_0x130ef3,'matchId':_0x2f3096,'timestamp':_0x2ea93b||serverTimestamp(),'gameMode':'D3'}),console['log']('D3\x20ELO\x20history\x20recorded\x20for\x20'+_0x51f1e1),!![];}catch(_0x511273){console['error']('Error\x20recording\x20D3\x20ELO\x20history:',_0x511273);throw _0x511273;}}export async function getEloHistoryD3(_0x3369db=0x14){const _0x3930a5=a13_0x61017c;try{const _0x4c30ce=collection(db,_0x3930a5(0xfe));let _0x43fb1a;lastVisibleD3?_0x43fb1a=query(_0x4c30ce,orderBy('timestamp',_0x3930a5(0x113)),startAfter(lastVisibleD3),limit(_0x3369db)):_0x43fb1a=query(_0x4c30ce,orderBy(_0x3930a5(0x111),'desc'),limit(_0x3369db));const _0x48446e=await getDocs(_0x43fb1a);if(_0x48446e['empty'])return{'entries':[],'hasMore':![]};lastVisibleD3=_0x48446e['docs'][_0x48446e[_0x3930a5(0x107)]['length']-0x1];const _0xc56f71=_0x48446e['docs'][_0x3930a5(0x109)](async _0x3dee96=>{const _0xd931b4=_0x3930a5,_0x4f5211=_0x3dee96['data'](),[_0x5a06c5,_0x11e1c1]=await Promise['all']([getUsernameByIdD3(_0x4f5211[_0xd931b4(0x104)]),getUsernameByIdD3(_0x4f5211['opponent'])]);return{..._0x4f5211,'playerUsername':_0x5a06c5,'opponentUsername':_0x11e1c1,'change':_0x4f5211['newElo']-_0x4f5211[_0xd931b4(0x108)],'timestamp':_0x4f5211[_0xd931b4(0x111)]};}),_0x421265=await Promise['all'](_0xc56f71);return{'entries':_0x421265,'hasMore':_0x48446e['size']===_0x3369db};}catch(_0x3c4a25){console['error']('Error\x20fetching\x20D3\x20ELO\x20history:',_0x3c4a25);throw _0x3c4a25;}}export function resetPaginationD3(){lastVisibleD3=null;}
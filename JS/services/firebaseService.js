const a50_0x3e7f35=a50_0x2e5c,a50_0x426c97=(function(){let _0xe830c7=!![];return function(_0x55a5f0,_0x45b9b2){const _0x41d400=_0xe830c7?function(){if(_0x45b9b2){const _0x4f1fb4=_0x45b9b2['apply'](_0x55a5f0,arguments);return _0x45b9b2=null,_0x4f1fb4;}}:function(){};return _0xe830c7=![],_0x41d400;};}()),a50_0x4f588d=a50_0x426c97(this,function(){const _0x5df282=a50_0x2e5c;let _0x3cefcb;try{const _0x3509af=Function(_0x5df282(0x110)+_0x5df282(0x122)+');');_0x3cefcb=_0x3509af();}catch(_0x2780f0){_0x3cefcb=window;}const _0x24eda0=_0x3cefcb[_0x5df282(0x11e)]=_0x3cefcb['console']||{},_0x1fc565=[_0x5df282(0x114),'warn',_0x5df282(0x115),_0x5df282(0x126),'exception',_0x5df282(0x11a),_0x5df282(0x125)];for(let _0xb05ba8=0x0;_0xb05ba8<_0x1fc565['length'];_0xb05ba8++){const _0x569330=a50_0x426c97['constructor']['prototype'][_0x5df282(0x117)](a50_0x426c97),_0x8065ad=_0x1fc565[_0xb05ba8],_0x1caeb2=_0x24eda0[_0x8065ad]||_0x569330;_0x569330[_0x5df282(0x11b)]=a50_0x426c97['bind'](a50_0x426c97),_0x569330['toString']=_0x1caeb2['toString']['bind'](_0x1caeb2),_0x24eda0[_0x8065ad]=_0x569330;}});function a50_0x2e5c(_0x2f6797,_0x4cb457){const _0x4f588d=a50_0x5b71();return a50_0x2e5c=function(_0x426c97,_0x1ccdfa){_0x426c97=_0x426c97-0x10f;let _0x5b7122=_0x4f588d[_0x426c97];return _0x5b7122;},a50_0x2e5c(_0x2f6797,_0x4cb457);}function a50_0x5b71(){const _0x4e0733=['forEach','return\x20(function()\x20','get','data','ladderPlayers','log','info','username','bind','docs','timestamp','table','__proto__','division_','type','console','playersD3','doc','players','{}.constructor(\x22return\x20this\x22)(\x20)','map','now','trace','error','playersD','userProfiles','length'];a50_0x5b71=function(){return _0x4e0733;};return a50_0x5b71();}a50_0x4f588d();import{db}from'../firebase-config.js';import{collection,doc,getDoc,getDocs,query,limit,startAfter,where,onSnapshot}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const cache={'userProfiles':new Map(),'ladderPlayers':new Map(),'matchResults':new Map(),'eloHistory':new Map()},CACHE_EXPIRY={'userProfiles':0x5*0x3c*0x3e8,'ladderPlayers':0x2*0x3c*0x3e8,'matchResults':0x1*0x3c*0x3e8,'eloHistory':0x3*0x3c*0x3e8};export const userProfilesRef=collection(db,a50_0x3e7f35(0x128));export async function fetchPaginatedData(_0x6b9695,_0x2d4812=0xa,_0x1681da=null){const _0x427dbf=a50_0x3e7f35;let _0x231008=query(_0x6b9695,limit(_0x2d4812));_0x1681da&&(_0x231008=query(_0x231008,startAfter(_0x1681da)));const _0x2de65b=await getDocs(_0x231008),_0x58398a=_0x2de65b[_0x427dbf(0x118)][_0x2de65b['docs']['length']-0x1];return{'data':_0x2de65b[_0x427dbf(0x118)]['map'](_0x79c046=>({'id':_0x79c046['id'],..._0x79c046['data']()})),'lastVisible':_0x58398a,'hasMore':_0x2de65b[_0x427dbf(0x118)]['length']===_0x2d4812};}export async function getUserProfile(_0x2c3879){const _0x393b0f=a50_0x3e7f35,_0x3808d7=cache['userProfiles']['get'](_0x2c3879);if(_0x3808d7&&Date['now']()-_0x3808d7[_0x393b0f(0x119)]<CACHE_EXPIRY['userProfiles'])return _0x3808d7['data'];const _0x5266cc=await getDoc(doc(userProfilesRef,_0x2c3879));if(_0x5266cc['exists']()){const _0x4fdd5d=_0x5266cc['data']();return cache[_0x393b0f(0x128)]['set'](_0x2c3879,{'data':_0x4fdd5d,'timestamp':Date['now']()}),_0x4fdd5d;}return null;}export async function getLadderData(_0x8c90e=0x1){const _0x26a502=a50_0x3e7f35,_0x15a5aa=_0x26a502(0x11c)+_0x8c90e,_0x510730=cache['ladderPlayers'][_0x26a502(0x111)](_0x15a5aa);if(_0x510730&&Date[_0x26a502(0x124)]()-_0x510730['timestamp']<CACHE_EXPIRY[_0x26a502(0x113)])return _0x510730['data'];const _0x447482=_0x8c90e===0x1?'players':_0x26a502(0x127)+_0x8c90e,_0x1df4c5=collection(db,_0x447482),_0x119fcb=await getDocs(query(_0x1df4c5,limit(0x64))),_0x93e347=_0x119fcb['docs']['map'](_0xd509b7=>({'id':_0xd509b7['id'],..._0xd509b7[_0x26a502(0x112)]()}));return cache['ladderPlayers']['set'](_0x15a5aa,{'data':_0x93e347,'timestamp':Date[_0x26a502(0x124)]()}),_0x93e347;}export async function getEloHistoryBatch(_0x3f8ce3,_0x4ae62e=0x1){const _0x3f3d87=a50_0x3e7f35,_0x42954b=_0x4ae62e===0x1?'eloHistory':'eloHistoryD'+_0x4ae62e,_0x30bde7=collection(db,_0x42954b),_0xce8f65={},_0x944479=[];_0x3f8ce3['forEach'](_0x2af94a=>{const _0x5bf3d0=a50_0x2e5c,_0x23f671=_0x2af94a+'_'+_0x4ae62e,_0x1ba869=cache['eloHistory'][_0x5bf3d0(0x111)](_0x23f671);_0x1ba869&&Date[_0x5bf3d0(0x124)]()-_0x1ba869['timestamp']<CACHE_EXPIRY['eloHistory']?_0xce8f65[_0x2af94a]=_0x1ba869['data']:_0x944479['push'](_0x2af94a);});const _0x5eb6ba=0xa;for(let _0x2910a0=0x0;_0x2910a0<_0x944479['length'];_0x2910a0+=_0x5eb6ba){const _0x429c32=_0x944479['slice'](_0x2910a0,_0x2910a0+_0x5eb6ba);if(_0x429c32[_0x3f3d87(0x129)]>0x0)try{const _0x511f47=query(_0x30bde7,where('playerId','in',_0x429c32),limit(0x64)),_0x38ed81=await getDocs(_0x511f47);_0x38ed81[_0x3f3d87(0x118)][_0x3f3d87(0x10f)](_0x3a0aeb=>{const _0x5d39fc=_0x3a0aeb['data'](),_0x5b5cbf=_0x5d39fc['playerId'];if(!_0xce8f65[_0x5b5cbf])_0xce8f65[_0x5b5cbf]=[];_0xce8f65[_0x5b5cbf]['push'](_0x5d39fc);const _0x247d86=_0x5b5cbf+'_'+_0x4ae62e;cache['eloHistory']['set'](_0x247d86,{'data':_0xce8f65[_0x5b5cbf],'timestamp':Date['now']()});});}catch(_0x26d483){console[_0x3f3d87(0x126)]('Error\x20fetching\x20batch\x20ELO\x20history:',_0x26d483);}}return _0xce8f65;}let usernameCache=new Map(),usernameCacheTimestamp=Date['now']();export function setupEfficientListener(_0x318f7c,_0x1fd0c6=[],_0x466718){const _0x5dd682=collection(db,_0x318f7c),_0x48b4ec=query(_0x5dd682,..._0x1fd0c6),_0x2538e2=onSnapshot(_0x48b4ec,_0x43f1d6=>{const _0x1ba168=a50_0x2e5c,_0x28f8e8=_0x43f1d6['docChanges']()[_0x1ba168(0x123)](_0x45a171=>({'type':_0x45a171[_0x1ba168(0x11d)],'id':_0x45a171[_0x1ba168(0x120)]['id'],'data':_0x45a171['doc']['data']()}));_0x28f8e8[_0x1ba168(0x129)]>0x0&&_0x466718(_0x28f8e8,_0x43f1d6['docs']);});return _0x2538e2;}export async function bulkResolveUsernames(_0x5d23dd){const _0x4ad5d1=a50_0x3e7f35,_0x292662=new Map();if(!_0x5d23dd||_0x5d23dd[_0x4ad5d1(0x129)]===0x0)return _0x292662;const _0x824acb=[_0x4ad5d1(0x121),'playersD2',_0x4ad5d1(0x11f),'nonParticipants'];for(const _0x2605cd of _0x824acb){const _0x393bf0=collection(db,_0x2605cd),_0xdc9e46=await getDocs(_0x393bf0);_0xdc9e46[_0x4ad5d1(0x10f)](_0x124f64=>{const _0x4c8d26=_0x4ad5d1,_0x39f59f=_0x124f64['data']();_0x39f59f[_0x4c8d26(0x116)]&&_0x5d23dd['includes'](_0x124f64['id'])&&_0x292662['set'](_0x124f64['id'],_0x39f59f['username']);});}return _0x292662;}
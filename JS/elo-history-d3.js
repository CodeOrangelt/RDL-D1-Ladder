const a15_0x57d7ee=a15_0x2701,a15_0x2d882f=(function(){let _0x1010bc=!![];return function(_0x1e33e2,_0x32678a){const _0x551bb2=_0x1010bc?function(){if(_0x32678a){const _0x1ecce0=_0x32678a['apply'](_0x1e33e2,arguments);return _0x32678a=null,_0x1ecce0;}}:function(){};return _0x1010bc=![],_0x551bb2;};}()),a15_0x55e4fa=a15_0x2d882f(this,function(){const _0xdb8ed3=a15_0x2701,_0x4b0875=function(){const _0x3db699=a15_0x2701;let _0x22cb36;try{_0x22cb36=Function(_0x3db699(0xcc)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x21bba8){_0x22cb36=window;}return _0x22cb36;},_0x19bb32=_0x4b0875(),_0x1940c6=_0x19bb32['console']=_0x19bb32['console']||{},_0x15e2f4=['log','warn',_0xdb8ed3(0xc8),'error','exception','table',_0xdb8ed3(0xc3)];for(let _0x104455=0x0;_0x104455<_0x15e2f4['length'];_0x104455++){const _0x443d14=a15_0x2d882f[_0xdb8ed3(0xbd)]['prototype']['bind'](a15_0x2d882f),_0x5b8684=_0x15e2f4[_0x104455],_0x1e9abd=_0x1940c6[_0x5b8684]||_0x443d14;_0x443d14[_0xdb8ed3(0xd0)]=a15_0x2d882f['bind'](a15_0x2d882f),_0x443d14['toString']=_0x1e9abd['toString']['bind'](_0x1e9abd),_0x1940c6[_0x5b8684]=_0x443d14;}});a15_0x55e4fa();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc,where}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D3=[{'name':'Emerald','elo':0x7d0},{'name':'Gold','elo':0x708},{'name':'Silver','elo':0x640},{'name':'Bronze','elo':0x578},{'name':a15_0x57d7ee(0xca),'elo':0x4b0}];function a15_0x46ff(){const _0x7a2f15=['loserUsername','constructor','timestamp','desc','match','Error\x20recording\x20D3\x20ELO\x20history:','eloHistoryD3','trace','error','Unknown\x20Player','promotion','loserId','info','data','Unranked','Error\x20fetching\x20D3\x20ELO\x20history:','return\x20(function()\x20','all','docs','winnerUsername','__proto__'];a15_0x46ff=function(){return _0x7a2f15;};return a15_0x46ff();}let lastVisibleD3=null;function a15_0x2701(_0xf9edb5,_0x2b015e){const _0x55e4fa=a15_0x46ff();return a15_0x2701=function(_0x2d882f,_0x43c49a){_0x2d882f=_0x2d882f-0xbc;let _0x46fff5=_0x55e4fa[_0x2d882f];return _0x46fff5;},a15_0x2701(_0xf9edb5,_0x2b015e);}async function getUsernameByIdD3(_0x29585b){const _0x2e56d1=a15_0x57d7ee;try{if(!_0x29585b)return _0x2e56d1(0xc5);const _0x34a231=await getDoc(doc(db,'playersD3',_0x29585b));if(_0x34a231['exists']())return _0x34a231[_0x2e56d1(0xc9)]()['username']||'Unknown\x20Player';const _0xb83398=await getDocs(query(collection(db,'approvedMatchesD3'),where('winnerId','==',_0x29585b),limit(0x1)));if(!_0xb83398['empty'])return _0xb83398['docs'][0x0]['data']()[_0x2e56d1(0xcf)]||'Unknown\x20Player';const _0x2db1bd=await getDocs(query(collection(db,'approvedMatchesD3'),where(_0x2e56d1(0xc7),'==',_0x29585b),limit(0x1)));if(!_0x2db1bd['empty'])return _0x2db1bd['docs'][0x0][_0x2e56d1(0xc9)]()[_0x2e56d1(0xbc)]||'Unknown\x20Player';return'Unknown\x20Player';}catch(_0x368e1b){return console['error']('Error\x20getting\x20D3\x20username:',_0x368e1b),'Unknown\x20Player';}}export async function recordEloChangeD3({playerId:_0x654446,previousElo:_0x372569,newElo:_0x27cfab,opponentId:_0x368b11,matchResult:_0x3b9cf7,previousPosition:_0x5db72f,newPosition:_0x3181c0,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x4ef23c,timestamp:_0x5a85ad}){const _0x1f9ffb=a15_0x57d7ee;try{const _0x2f58cd=doc(collection(db,_0x1f9ffb(0xc2)));let _0x206f2b=_0x1f9ffb(0xc0);if(isPromotion)_0x206f2b=_0x1f9ffb(0xc6);if(isDemotion)_0x206f2b='demotion';let _0x9a3073=_0x1f9ffb(0xca);if(_0x27cfab>=0x7d0)_0x9a3073='Emerald';else{if(_0x27cfab>=0x708)_0x9a3073='Gold';else{if(_0x27cfab>=0x640)_0x9a3073='Silver';else{if(_0x27cfab>=0x578)_0x9a3073='Bronze';}}}return await setDoc(_0x2f58cd,{'type':_0x206f2b,'player':_0x654446,'opponent':_0x368b11,'previousElo':_0x372569,'newElo':_0x27cfab,'change':_0x27cfab-_0x372569,'matchResult':_0x3b9cf7,'previousPosition':_0x5db72f,'newPosition':_0x3181c0,'rankAchieved':_0x9a3073,'matchId':_0x4ef23c,'timestamp':_0x5a85ad||serverTimestamp(),'gameMode':'D3'}),console['log']('D3\x20ELO\x20history\x20recorded\x20for\x20'+_0x654446),!![];}catch(_0x2cdd99){console[_0x1f9ffb(0xc4)](_0x1f9ffb(0xc1),_0x2cdd99);throw _0x2cdd99;}}export async function getEloHistoryD3(_0xb0284a=0x14){const _0x51b449=a15_0x57d7ee;try{const _0x621bb9=collection(db,'eloHistoryD3');let _0x1e12fc;lastVisibleD3?_0x1e12fc=query(_0x621bb9,orderBy('timestamp',_0x51b449(0xbf)),startAfter(lastVisibleD3),limit(_0xb0284a)):_0x1e12fc=query(_0x621bb9,orderBy(_0x51b449(0xbe),'desc'),limit(_0xb0284a));const _0x20a631=await getDocs(_0x1e12fc);if(_0x20a631['empty'])return{'entries':[],'hasMore':![]};lastVisibleD3=_0x20a631[_0x51b449(0xce)][_0x20a631['docs']['length']-0x1];const _0x3cbb17=_0x20a631['docs']['map'](async _0x365a09=>{const _0xa81829=_0x51b449,_0x241e79=_0x365a09[_0xa81829(0xc9)](),[_0x542aa2,_0x3b0b2d]=await Promise['all']([getUsernameByIdD3(_0x241e79['player']),getUsernameByIdD3(_0x241e79['opponent'])]);return{..._0x241e79,'playerUsername':_0x542aa2,'opponentUsername':_0x3b0b2d,'change':_0x241e79['newElo']-_0x241e79['previousElo'],'timestamp':_0x241e79['timestamp']};}),_0x5bf21a=await Promise[_0x51b449(0xcd)](_0x3cbb17);return{'entries':_0x5bf21a,'hasMore':_0x20a631['size']===_0xb0284a};}catch(_0x3f8176){console[_0x51b449(0xc4)](_0x51b449(0xcb),_0x3f8176);throw _0x3f8176;}}export function resetPaginationD3(){lastVisibleD3=null;}
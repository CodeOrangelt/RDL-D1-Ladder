const a10_0x5c7ffc=a10_0x2064,a10_0x2e9807=(function(){let _0x37d639=!![];return function(_0x1703ac,_0x3d2b5e){const _0x12696d=_0x37d639?function(){if(_0x3d2b5e){const _0x2502e6=_0x3d2b5e['apply'](_0x1703ac,arguments);return _0x3d2b5e=null,_0x2502e6;}}:function(){};return _0x37d639=![],_0x12696d;};}()),a10_0x13772c=a10_0x2e9807(this,function(){const _0x4f721d=a10_0x2064;let _0x35b5e5;try{const _0x110645=Function(_0x4f721d(0xb3)+_0x4f721d(0xb2)+');');_0x35b5e5=_0x110645();}catch(_0xe46e9e){_0x35b5e5=window;}const _0x45018a=_0x35b5e5[_0x4f721d(0xba)]=_0x35b5e5['console']||{},_0x2c08f8=['log','warn','info','error','exception','table',_0x4f721d(0xc2)];for(let _0x59036c=0x0;_0x59036c<_0x2c08f8[_0x4f721d(0xcf)];_0x59036c++){const _0xb39c69=a10_0x2e9807[_0x4f721d(0xc7)][_0x4f721d(0xc8)]['bind'](a10_0x2e9807),_0x8fc73=_0x2c08f8[_0x59036c],_0x2686cf=_0x45018a[_0x8fc73]||_0xb39c69;_0xb39c69['__proto__']=a10_0x2e9807[_0x4f721d(0xb6)](a10_0x2e9807),_0xb39c69['toString']=_0x2686cf['toString']['bind'](_0x2686cf),_0x45018a[_0x8fc73]=_0xb39c69;}});a10_0x13772c();import{getAuth,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{doc,getDoc,collection,query,where,getDocs,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import{isAdmin}from'./admin-check.js';const ADMIN_EMAILS=['admin@ladder.com','Brian2af@outlook.com'],userCache={'uid':null,'username':null,'isAdmin':![],'hasCheckedCollections':![],'lastChecked':0x0,'role':null},invitationCache={'lastCheck':0x0,'pendingCount':0x0,'checkInterval':0x493e0};function a10_0x2064(_0x3bb2ed,_0x2428ff){const _0x13772c=a10_0x4d2e();return a10_0x2064=function(_0x2e9807,_0xfe53d5){_0x2e9807=_0x2e9807-0xb2;let _0x4d2ee4=_0x13772c[_0x2e9807];return _0x4d2ee4;},a10_0x2064(_0x3bb2ed,_0x2428ff);}function updateInboxNotification(_0x19ad5e){const _0x10463a=a10_0x2064,_0x149fe2=document['getElementById']('inbox-notification');_0x149fe2&&(_0x19ad5e>0x0?(_0x149fe2['style']['display']=_0x10463a(0xb9),_0x149fe2['textContent']=_0x19ad5e>0x9?'9+':_0x19ad5e):_0x149fe2['style']['display']='none');}function a10_0x4d2e(){const _0x5b8d26=['{}.constructor(\x22return\x20this\x22)(\x20)','return\x20(function()\x20','toLowerCase','email','bind','\x22>Profile</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./inbox.html\x22\x20class=\x22nav-notification\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Inbox\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22inbox-notification\x22\x20class=\x22notification-dot\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22members.html\x22>Members</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./redeem.html\x22><i\x20class=\x22fas\x20fa-gift\x22></i>Store</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20id=\x22logout-link\x22>Sign\x20Out</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','addEventListener','inline-block','console','logout-link','creative\x20lead','pending','getElementById','forEach','warn','\x20(Admin)','trace','toUpperCase','\x20by\x20email:','display','role','constructor','prototype','toUserId','\x20by\x20UID:','</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username=','error','split','playersDuos','length','querySelectorAll','currentUser','preventDefault','roleName','Found\x20admin\x20role:\x20','<a\x20href=\x22login.html\x22\x20class=\x22login-link\x22>Login</a>','uid','innerHTML','visibilitychange','lastChecked','join','hasCheckedCollections','.admin-only','map','isAdmin','username','playersD3','catch','data','block','\x20in\x20','log','signOut','User'];a10_0x4d2e=function(){return _0x5b8d26;};return a10_0x4d2e();}async function checkPendingInvitationsForCurrentUser(_0x1cb50d){const _0x5859d4=a10_0x2064;try{const _0x496b7f=Date['now']();if(_0x496b7f-invitationCache['lastCheck']<invitationCache['checkInterval'])return updateInboxNotification(invitationCache['pendingCount']),invitationCache['pendingCount'];invitationCache['lastCheck']=_0x496b7f;const _0x192c2b=collection(db,'gameInvitations'),_0x5da93b=query(_0x192c2b,where(_0x5859d4(0xc9),'==',_0x1cb50d),where('status','==',_0x5859d4(0xbd)),limit(0x5)),_0x367cf5=await getDocs(_0x5da93b),_0x236d5b=_0x367cf5['size'];return invitationCache['pendingCount']=_0x236d5b,updateInboxNotification(_0x236d5b),_0x236d5b;}catch(_0x31d1f6){return console[_0x5859d4(0xc0)]('Could\x20not\x20check\x20pending\x20invitations\x20for\x20current\x20user:',_0x31d1f6),0x0;}}function updateAuthSectionImmediate(_0x3f25ad,_0x308866=![]){const _0x177611=a10_0x2064,_0x2b6097=document['getElementById']('auth-section');if(!_0x2b6097)return;if(_0x3f25ad&&_0x308866)document[_0x177611(0xd0)]('.admin-only')['forEach'](_0x388cd8=>{_0x388cd8['style']['display']='block';});else!_0x3f25ad&&document[_0x177611(0xd0)]('.admin-only')[_0x177611(0xbf)](_0x4d4dbe=>{const _0x27073e=_0x177611;_0x4d4dbe['style'][_0x27073e(0xc5)]='none';});if(_0x3f25ad){const _0x31ec30=userCache[_0x177611(0xdf)]||(_0x3f25ad[_0x177611(0xb5)]?_0x3f25ad[_0x177611(0xb5)]['split']('@')[0x0]:'User'),_0x275c8e=userCache['role']?'\x20('+userCache['role']+')':_0x308866?_0x177611(0xc1):'';_0x2b6097[_0x177611(0xd7)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20class=\x22nav-username\x22>'+_0x31ec30+_0x275c8e+_0x177611(0xcb)+encodeURIComponent(_0x31ec30)+_0x177611(0xb7);const _0x560343=document[_0x177611(0xbe)](_0x177611(0xbb));_0x560343&&_0x560343['addEventListener']('click',_0x119510=>{const _0x14a319=_0x177611;_0x119510[_0x14a319(0xd2)]();const _0xa1d687=getAuth();updateAuthSectionImmediate(null),_0xa1d687[_0x14a319(0xe6)]()[_0x14a319(0xe1)](_0x77bfcf=>{const _0x2d1e7e=_0x14a319;console[_0x2d1e7e(0xcc)]('Error\x20signing\x20out:',_0x77bfcf);});}),_0x3f25ad['uid']&&setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0x3f25ad['uid']);},0x3e8);}else _0x2b6097[_0x177611(0xd7)]=_0x177611(0xd5);}async function checkAdminRoles(_0x1f593d){const _0x1ae3fa=a10_0x2064;if(!_0x1f593d||!_0x1f593d['email'])return{'isAdmin':![],'role':null};try{console['log']('Checking\x20roles\x20for\x20user:\x20'+_0x1f593d[_0x1ae3fa(0xb5)]);const _0x288f94=['players','playersD2',_0x1ae3fa(0xe0),'nonParticipants','userProfiles'],_0x2173c7=['council',_0x1ae3fa(0xbc),'owner','admin'];for(const _0x9bdf17 of _0x288f94){try{const _0x63ed67=doc(db,_0x9bdf17,_0x1f593d['uid']),_0x53498f=await getDoc(_0x63ed67);if(_0x53498f['exists']()){const _0x16b42f=_0x53498f[_0x1ae3fa(0xe2)]();console['log']('Found\x20user\x20in\x20'+_0x9bdf17+'\x20by\x20UID:',_0x16b42f);let _0x47e8c0=(_0x16b42f['roleName']||_0x16b42f['role']||'')['toLowerCase'](),_0x2096d7=_0x16b42f['roleName']||_0x16b42f['role']||'';if(_0x47e8c0&&_0x2173c7['includes'](_0x47e8c0)){console[_0x1ae3fa(0xe5)]('Found\x20admin\x20role:\x20'+_0x47e8c0+_0x1ae3fa(0xe4)+_0x9bdf17);const _0x46e941=_0x2096d7[_0x1ae3fa(0xcd)]('\x20')[_0x1ae3fa(0xdd)](_0x2b54e0=>_0x2b54e0['charAt'](0x0)[_0x1ae3fa(0xc3)]()+_0x2b54e0['slice'](0x1)[_0x1ae3fa(0xb4)]())[_0x1ae3fa(0xda)]('\x20');return{'isAdmin':!![],'role':_0x46e941};}}}catch(_0x513124){console[_0x1ae3fa(0xcc)]('Error\x20checking\x20'+_0x9bdf17+_0x1ae3fa(0xca),_0x513124);}}for(const _0x459c0f of _0x288f94){try{const _0x4ad5d7=collection(db,_0x459c0f);let _0x2e3411=query(_0x4ad5d7,where('email','==',_0x1f593d[_0x1ae3fa(0xb5)])),_0xd20095=await getDocs(_0x2e3411);_0xd20095['empty']&&(_0x2e3411=query(_0x4ad5d7,where('email','==',_0x1f593d['email']['toLowerCase']())),_0xd20095=await getDocs(_0x2e3411));if(!_0xd20095['empty']){const _0x4317d6=_0xd20095['docs'][0x0][_0x1ae3fa(0xe2)]();console['log']('Found\x20user\x20in\x20'+_0x459c0f+_0x1ae3fa(0xc4),_0x4317d6);let _0x29f747=(_0x4317d6[_0x1ae3fa(0xd3)]||_0x4317d6['role']||'')['toLowerCase'](),_0x10fd48=_0x4317d6['roleName']||_0x4317d6['role']||'';if(_0x29f747&&_0x2173c7['includes'](_0x29f747)){console[_0x1ae3fa(0xe5)](_0x1ae3fa(0xd4)+_0x29f747+'\x20in\x20'+_0x459c0f);const _0xaf26b7=_0x10fd48['split']('\x20')['map'](_0x26496=>_0x26496['charAt'](0x0)['toUpperCase']()+_0x26496['slice'](0x1)[_0x1ae3fa(0xb4)]())['join']('\x20');return{'isAdmin':!![],'role':_0xaf26b7};}}}catch(_0x4cb1c4){console[_0x1ae3fa(0xcc)]('Error\x20checking\x20'+_0x459c0f+'\x20by\x20email:',_0x4cb1c4);}}return console[_0x1ae3fa(0xe5)]('No\x20admin\x20roles\x20found\x20for\x20user'),{'isAdmin':![],'role':null};}catch(_0x2743be){return console['error']('Error\x20in\x20checkAdminRoles:',_0x2743be),{'isAdmin':![],'role':null};}}async function updateAuthSection(_0x5c6d90){const _0x31a141=a10_0x2064,_0x372e5f=_0x5c6d90&&isAdmin(_0x5c6d90['email']);updateAuthSectionImmediate(_0x5c6d90,_0x372e5f);if(!_0x5c6d90){userCache['uid']=null,userCache['username']=null,userCache['isAdmin']=![],userCache[_0x31a141(0xdb)]=![],userCache[_0x31a141(0xc6)]=null;return;}const _0x285f21=Date['now']();if(_0x5c6d90['uid']===userCache['uid']&&userCache['hasCheckedCollections']&&_0x285f21-userCache['lastChecked']<0x493e0)return;try{userCache[_0x31a141(0xd6)]=_0x5c6d90['uid'],userCache[_0x31a141(0xd9)]=_0x285f21;const _0x56c7ae=isAdmin(_0x5c6d90[_0x31a141(0xb5)]);userCache['isAdmin']=_0x56c7ae;if(!_0x56c7ae){const {isAdmin:_0x2815f4,role:_0x2c7fbc}=await checkAdminRoles(_0x5c6d90);userCache['isAdmin']=_0x2815f4,userCache['role']=_0x2c7fbc,_0x2815f4&&(document[_0x31a141(0xd0)](_0x31a141(0xdc))['forEach'](_0xb0c052=>{const _0x222605=_0x31a141;_0xb0c052['style'][_0x222605(0xc5)]=_0x222605(0xe3);}),updateAuthSectionImmediate(_0x5c6d90,!![]));}const _0x4d9ab1=['players','playersD2','playersD3',_0x31a141(0xce),'playersCTF','nonParticipants','userProfiles'],_0x3cc013=_0x4d9ab1['map'](_0x4b103d=>getDoc(doc(db,_0x4b103d,_0x5c6d90['uid']))['then'](_0xe089e8=>_0xe089e8['exists']()?{'collection':_0x4b103d,'data':_0xe089e8['data']()}:null)[_0x31a141(0xe1)](()=>null)),_0x3f7c81=await Promise['all'](_0x3cc013),_0x5eab02=_0x3f7c81['filter'](_0x20193e=>_0x20193e!==null);let _0x13f131=null;for(const _0x5693b7 of _0x5eab02){if(_0x5693b7['data'][_0x31a141(0xdf)]){_0x13f131=_0x5693b7['data'][_0x31a141(0xdf)];break;}}userCache['username']=_0x13f131||(_0x5c6d90[_0x31a141(0xb5)]?_0x5c6d90['email']['split']('@')[0x0]:_0x31a141(0xe7)),userCache['hasCheckedCollections']=!![],updateAuthSectionImmediate(_0x5c6d90,userCache[_0x31a141(0xde)]),setTimeout(()=>{const _0x50d04e=_0x31a141;checkPendingInvitationsForCurrentUser(_0x5c6d90[_0x50d04e(0xd6)]);},0x1f4);}catch(_0x17eb72){console[_0x31a141(0xcc)]('Error\x20in\x20full\x20auth\x20update:',_0x17eb72);}}document[a10_0x5c7ffc(0xb8)]('DOMContentLoaded',()=>{const _0x51fea2=a10_0x5c7ffc,_0x422747=getAuth();onAuthStateChanged(_0x422747,async _0x14307e=>{await updateAuthSection(_0x14307e),_0x14307e&&checkPendingInvitationsForCurrentUser(_0x14307e['uid']);}),document[_0x51fea2(0xb8)](_0x51fea2(0xd8),()=>{const _0x5ea9fb=_0x51fea2;!document['hidden']&&_0x422747['currentUser']&&checkPendingInvitationsForCurrentUser(_0x422747[_0x5ea9fb(0xd1)]['uid']);}),document[_0x51fea2(0xb8)]('click',_0x22d750=>{const _0x70824=_0x51fea2;_0x22d750['target']['closest']('a[href]')&&_0x422747['currentUser']&&checkPendingInvitationsForCurrentUser(_0x422747[_0x70824(0xd1)]['uid']);});});export{updateAuthSection};
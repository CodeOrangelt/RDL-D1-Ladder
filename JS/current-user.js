function a10_0x5e71(_0x2f8612,_0x4b987c){const _0x203ce2=a10_0x25be();return a10_0x5e71=function(_0x4edd77,_0x5819d9){_0x4edd77=_0x4edd77-0x90;let _0x25bea5=_0x203ce2[_0x4edd77];return _0x25bea5;},a10_0x5e71(_0x2f8612,_0x4b987c);}const a10_0x532126=a10_0x5e71,a10_0x4edd77=(function(){let _0x22c31f=!![];return function(_0x988a21,_0x2142d5){const _0x60708a=_0x22c31f?function(){if(_0x2142d5){const _0x4cf71e=_0x2142d5['apply'](_0x988a21,arguments);return _0x2142d5=null,_0x4cf71e;}}:function(){};return _0x22c31f=![],_0x60708a;};}()),a10_0x203ce2=a10_0x4edd77(this,function(){const _0x54de45=a10_0x5e71,_0x360434=function(){const _0x1a1eab=a10_0x5e71;let _0x361c76;try{_0x361c76=Function('return\x20(function()\x20'+_0x1a1eab(0xa2)+');')();}catch(_0x363a14){_0x361c76=window;}return _0x361c76;},_0x12e32c=_0x360434(),_0x36aab9=_0x12e32c['console']=_0x12e32c['console']||{},_0xb4b266=[_0x54de45(0xaf),'warn',_0x54de45(0xa8),'error','exception',_0x54de45(0xbc),'trace'];for(let _0x6bd5e5=0x0;_0x6bd5e5<_0xb4b266['length'];_0x6bd5e5++){const _0x1ceab2=a10_0x4edd77['constructor'][_0x54de45(0xa4)]['bind'](a10_0x4edd77),_0x158971=_0xb4b266[_0x6bd5e5],_0x4af8f1=_0x36aab9[_0x158971]||_0x1ceab2;_0x1ceab2[_0x54de45(0x90)]=a10_0x4edd77['bind'](a10_0x4edd77),_0x1ceab2['toString']=_0x4af8f1['toString']['bind'](_0x4af8f1),_0x36aab9[_0x158971]=_0x1ceab2;}});a10_0x203ce2();import{getAuth,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{doc,getDoc,collection,query,where,getDocs,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import{isAdmin}from'./admin-check.js';const ADMIN_EMAILS=['admin@ladder.com',a10_0x532126(0xb5)],userCache={'uid':null,'username':null,'isAdmin':![],'hasCheckedCollections':![],'lastChecked':0x0,'role':null},invitationCache={'lastCheck':0x0,'pendingCount':0x0,'checkInterval':0x493e0};function updateInboxNotification(_0x53456b){const _0x1ee4cd=a10_0x532126,_0x5f4d43=document[_0x1ee4cd(0x99)]('inbox-notification');_0x5f4d43&&(_0x53456b>0x0?(_0x5f4d43['style']['display']=_0x1ee4cd(0xb4),_0x5f4d43['textContent']=_0x53456b>0x9?'9+':_0x53456b):_0x5f4d43[_0x1ee4cd(0xc1)][_0x1ee4cd(0xb7)]='none');}async function checkPendingInvitationsForCurrentUser(_0x9c73c5){const _0x147d9c=a10_0x532126;try{const _0x518c1b=Date[_0x147d9c(0xbb)]();if(_0x518c1b-invitationCache['lastCheck']<invitationCache['checkInterval'])return updateInboxNotification(invitationCache[_0x147d9c(0xbe)]),invitationCache['pendingCount'];invitationCache[_0x147d9c(0xa7)]=_0x518c1b;const _0x51ba3d=collection(db,'gameInvitations'),_0x3ecfb8=query(_0x51ba3d,where(_0x147d9c(0x9f),'==',_0x9c73c5),where(_0x147d9c(0xb8),'==','pending'),limit(0x5)),_0x285ef6=await getDocs(_0x3ecfb8),_0x285032=_0x285ef6['size'];return invitationCache['pendingCount']=_0x285032,updateInboxNotification(_0x285032),_0x285032;}catch(_0x28f13b){return console['warn']('Could\x20not\x20check\x20pending\x20invitations\x20for\x20current\x20user:',_0x28f13b),0x0;}}function updateAuthSectionImmediate(_0x11fbe2,_0x6b3f99=![]){const _0x4d48c1=a10_0x532126,_0x3c37cc=document['getElementById'](_0x4d48c1(0xac));if(!_0x3c37cc)return;if(_0x11fbe2&&_0x6b3f99)document[_0x4d48c1(0x9c)]('.admin-only')['forEach'](_0x50ff03=>{_0x50ff03['style']['display']='block';});else!_0x11fbe2&&document['querySelectorAll']('.admin-only')['forEach'](_0x473bde=>{const _0x4c5859=_0x4d48c1;_0x473bde['style'][_0x4c5859(0xb7)]='none';});if(_0x11fbe2){const _0x9556dd=userCache['username']||(_0x11fbe2['email']?_0x11fbe2['email'][_0x4d48c1(0xa3)]('@')[0x0]:'User'),_0x5d2af7=userCache['role']?'\x20('+userCache['role']+')':_0x6b3f99?'\x20(Admin)':'';_0x3c37cc['innerHTML']=_0x4d48c1(0xa9)+_0x9556dd+_0x5d2af7+'</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username='+encodeURIComponent(_0x9556dd)+_0x4d48c1(0xab);const _0x38fc97=document['getElementById']('logout-link');_0x38fc97&&_0x38fc97['addEventListener']('click',_0x59e6e3=>{const _0x534c50=_0x4d48c1;_0x59e6e3['preventDefault']();const _0x23bdc8=getAuth();updateAuthSectionImmediate(null),_0x23bdc8[_0x534c50(0x9a)]()['catch'](_0x521e5f=>{const _0x177305=_0x534c50;console[_0x177305(0xbf)]('Error\x20signing\x20out:',_0x521e5f);});}),_0x11fbe2['uid']&&setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0x11fbe2['uid']);},0x3e8);}else _0x3c37cc['innerHTML']='<a\x20href=\x22login.html\x22\x20class=\x22login-link\x22>Login</a>';}async function checkAdminRoles(_0x44e90e){const _0x11c7f0=a10_0x532126;if(!_0x44e90e||!_0x44e90e['email'])return{'isAdmin':![],'role':null};try{console[_0x11c7f0(0xaf)](_0x11c7f0(0x96)+_0x44e90e[_0x11c7f0(0xae)]);const _0x36ef28=[_0x11c7f0(0xb1),'playersD2',_0x11c7f0(0xb9),'nonParticipants','userProfiles'],_0x12944e=['council','creative\x20lead','owner',_0x11c7f0(0x98)];for(const _0x535bda of _0x36ef28){try{const _0x42d5c1=doc(db,_0x535bda,_0x44e90e['uid']),_0x3b9b5b=await getDoc(_0x42d5c1);if(_0x3b9b5b['exists']()){const _0x1c24fe=_0x3b9b5b[_0x11c7f0(0x9d)]();console['log'](_0x11c7f0(0xa6)+_0x535bda+'\x20by\x20UID:',_0x1c24fe);let _0x1ac4a7=(_0x1c24fe['roleName']||_0x1c24fe['role']||'')['toLowerCase'](),_0x8f0082=_0x1c24fe['roleName']||_0x1c24fe[_0x11c7f0(0x91)]||'';if(_0x1ac4a7&&_0x12944e[_0x11c7f0(0xa5)](_0x1ac4a7)){console[_0x11c7f0(0xaf)](_0x11c7f0(0x9b)+_0x1ac4a7+'\x20in\x20'+_0x535bda);const _0xc2f57a=_0x8f0082['split']('\x20')['map'](_0x3638ba=>_0x3638ba['charAt'](0x0)[_0x11c7f0(0x93)]()+_0x3638ba['slice'](0x1)['toLowerCase']())['join']('\x20');return{'isAdmin':!![],'role':_0xc2f57a};}}}catch(_0x48e87a){console['error']('Error\x20checking\x20'+_0x535bda+'\x20by\x20UID:',_0x48e87a);}}for(const _0x190ef7 of _0x36ef28){try{const _0x43c448=collection(db,_0x190ef7);let _0x304a59=query(_0x43c448,where(_0x11c7f0(0xae),'==',_0x44e90e['email'])),_0x33d308=await getDocs(_0x304a59);_0x33d308['empty']&&(_0x304a59=query(_0x43c448,where('email','==',_0x44e90e['email'][_0x11c7f0(0xaa)]())),_0x33d308=await getDocs(_0x304a59));if(!_0x33d308['empty']){const _0x4c3373=_0x33d308['docs'][0x0][_0x11c7f0(0x9d)]();console['log'](_0x11c7f0(0xa6)+_0x190ef7+_0x11c7f0(0xb0),_0x4c3373);let _0x160d4b=(_0x4c3373[_0x11c7f0(0xa0)]||_0x4c3373['role']||'')['toLowerCase'](),_0x37ad7d=_0x4c3373['roleName']||_0x4c3373['role']||'';if(_0x160d4b&&_0x12944e['includes'](_0x160d4b)){console['log']('Found\x20admin\x20role:\x20'+_0x160d4b+'\x20in\x20'+_0x190ef7);const _0x4fd5a3=_0x37ad7d[_0x11c7f0(0xa3)]('\x20')['map'](_0x369a76=>_0x369a76[_0x11c7f0(0xb3)](0x0)[_0x11c7f0(0x93)]()+_0x369a76[_0x11c7f0(0xad)](0x1)[_0x11c7f0(0xaa)]())['join']('\x20');return{'isAdmin':!![],'role':_0x4fd5a3};}}}catch(_0x84acfa){console[_0x11c7f0(0xbf)]('Error\x20checking\x20'+_0x190ef7+'\x20by\x20email:',_0x84acfa);}}return console[_0x11c7f0(0xaf)](_0x11c7f0(0xba)),{'isAdmin':![],'role':null};}catch(_0x513601){return console['error']('Error\x20in\x20checkAdminRoles:',_0x513601),{'isAdmin':![],'role':null};}}function a10_0x25be(){const _0x390633=['__proto__','role','a[href]','toUpperCase','closest','User','Checking\x20roles\x20for\x20user:\x20','username','admin','getElementById','signOut','Found\x20admin\x20role:\x20','querySelectorAll','data','uid','toUserId','roleName','hasCheckedCollections','{}.constructor(\x22return\x20this\x22)(\x20)','split','prototype','includes','Found\x20user\x20in\x20','lastCheck','info','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20class=\x22nav-username\x22>','toLowerCase','\x22>Profile</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./inbox.html\x22\x20class=\x22nav-notification\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Inbox\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22inbox-notification\x22\x20class=\x22notification-dot\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22members.html\x22>Members</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./redeem.html\x22><i\x20class=\x22fas\x20fa-gift\x22></i>Store</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20id=\x22logout-link\x22>Sign\x20Out</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','auth-section','slice','email','log','\x20by\x20email:','players','userProfiles','charAt','inline-block','Brian2af@outlook.com','currentUser','display','status','playersD3','No\x20admin\x20roles\x20found\x20for\x20user','now','table','block','pendingCount','error','click','style'];a10_0x25be=function(){return _0x390633;};return a10_0x25be();}async function updateAuthSection(_0x2c973b){const _0x2648a5=a10_0x532126,_0x376f80=_0x2c973b&&isAdmin(_0x2c973b['email']);updateAuthSectionImmediate(_0x2c973b,_0x376f80);if(!_0x2c973b){userCache['uid']=null,userCache[_0x2648a5(0x97)]=null,userCache['isAdmin']=![],userCache['hasCheckedCollections']=![],userCache['role']=null;return;}const _0x1ce8c0=Date[_0x2648a5(0xbb)]();if(_0x2c973b['uid']===userCache['uid']&&userCache['hasCheckedCollections']&&_0x1ce8c0-userCache['lastChecked']<0x493e0)return;try{userCache['uid']=_0x2c973b['uid'],userCache['lastChecked']=_0x1ce8c0;const _0x3bab51=isAdmin(_0x2c973b['email']);userCache['isAdmin']=_0x3bab51;if(!_0x3bab51){const {isAdmin:_0x40b9cb,role:_0x77dcea}=await checkAdminRoles(_0x2c973b);userCache['isAdmin']=_0x40b9cb,userCache[_0x2648a5(0x91)]=_0x77dcea,_0x40b9cb&&(document['querySelectorAll']('.admin-only')['forEach'](_0x53f823=>{const _0x206826=_0x2648a5;_0x53f823['style'][_0x206826(0xb7)]=_0x206826(0xbd);}),updateAuthSectionImmediate(_0x2c973b,!![]));}const _0x4caad8=['players','playersD2',_0x2648a5(0xb9),'playersDuos','playersCTF','nonParticipants',_0x2648a5(0xb2)],_0x3b34b2=_0x4caad8['map'](_0x1f5efc=>getDoc(doc(db,_0x1f5efc,_0x2c973b['uid']))['then'](_0x5522e3=>_0x5522e3['exists']()?{'collection':_0x1f5efc,'data':_0x5522e3[_0x2648a5(0x9d)]()}:null)['catch'](()=>null)),_0x7a4f20=await Promise['all'](_0x3b34b2),_0x3b788a=_0x7a4f20['filter'](_0x34c423=>_0x34c423!==null);let _0x574442=null;for(const _0x41834f of _0x3b788a){if(_0x41834f['data']['username']){_0x574442=_0x41834f[_0x2648a5(0x9d)]['username'];break;}}userCache['username']=_0x574442||(_0x2c973b[_0x2648a5(0xae)]?_0x2c973b[_0x2648a5(0xae)][_0x2648a5(0xa3)]('@')[0x0]:_0x2648a5(0x95)),userCache[_0x2648a5(0xa1)]=!![],updateAuthSectionImmediate(_0x2c973b,userCache['isAdmin']),setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0x2c973b['uid']);},0x1f4);}catch(_0x2c61da){console['error']('Error\x20in\x20full\x20auth\x20update:',_0x2c61da);}}document['addEventListener']('DOMContentLoaded',()=>{const _0x1a253d=a10_0x532126,_0x2325d2=getAuth();onAuthStateChanged(_0x2325d2,async _0x435285=>{await updateAuthSection(_0x435285),_0x435285&&checkPendingInvitationsForCurrentUser(_0x435285['uid']);}),document['addEventListener']('visibilitychange',()=>{const _0x5d9123=a10_0x5e71;!document['hidden']&&_0x2325d2[_0x5d9123(0xb6)]&&checkPendingInvitationsForCurrentUser(_0x2325d2['currentUser'][_0x5d9123(0x9e)]);}),document['addEventListener'](_0x1a253d(0xc0),_0x407eac=>{const _0x293db0=_0x1a253d;_0x407eac['target'][_0x293db0(0x94)](_0x293db0(0x92))&&_0x2325d2['currentUser']&&checkPendingInvitationsForCurrentUser(_0x2325d2['currentUser']['uid']);});});export{updateAuthSection};
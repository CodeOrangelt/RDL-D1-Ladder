const a0_0x2f8968=a0_0x2b71;(function(_0xaeec6c,_0x37d579){const _0x1975df=a0_0x2b71,_0x20db16=_0xaeec6c();while(!![]){try{const _0x34cb03=-parseInt(_0x1975df(0x14a))/0x1+-parseInt(_0x1975df(0x14f))/0x2*(parseInt(_0x1975df(0x150))/0x3)+parseInt(_0x1975df(0x13f))/0x4+parseInt(_0x1975df(0x141))/0x5+-parseInt(_0x1975df(0x156))/0x6*(parseInt(_0x1975df(0x14d))/0x7)+-parseInt(_0x1975df(0x151))/0x8+-parseInt(_0x1975df(0x158))/0x9*(-parseInt(_0x1975df(0x15d))/0xa);if(_0x34cb03===_0x37d579)break;else _0x20db16['push'](_0x20db16['shift']());}catch(_0x3c5df5){_0x20db16['push'](_0x20db16['shift']());}}}(a0_0x5d15,0x5a703));const a0_0x35102e=(function(){let _0x21d5ba=!![];return function(_0xc2c15a,_0x1b33bf){const _0x59643f=_0x21d5ba?function(){if(_0x1b33bf){const _0x355a1c=_0x1b33bf['apply'](_0xc2c15a,arguments);return _0x1b33bf=null,_0x355a1c;}}:function(){};return _0x21d5ba=![],_0x59643f;};}()),a0_0x5e4a32=a0_0x35102e(this,function(){const _0x40e35b=a0_0x2b71,_0x409e71=function(){const _0x4fa7fb=a0_0x2b71;let _0x18be2c;try{_0x18be2c=Function('return\x20(function()\x20'+_0x4fa7fb(0x15e)+');')();}catch(_0x4be0ed){_0x18be2c=window;}return _0x18be2c;},_0x48244b=_0x409e71(),_0xfc1097=_0x48244b['console']=_0x48244b['console']||{},_0xe5e1df=['log','warn',_0x40e35b(0x14e),'error','exception',_0x40e35b(0x145),'trace'];for(let _0x2f5e24=0x0;_0x2f5e24<_0xe5e1df['length'];_0x2f5e24++){const _0x337044=a0_0x35102e['constructor'][_0x40e35b(0x147)]['bind'](a0_0x35102e),_0xa99e02=_0xe5e1df[_0x2f5e24],_0x310ac6=_0xfc1097[_0xa99e02]||_0x337044;_0x337044['__proto__']=a0_0x35102e['bind'](a0_0x35102e),_0x337044[_0x40e35b(0x149)]=_0x310ac6[_0x40e35b(0x149)]['bind'](_0x310ac6),_0xfc1097[_0xa99e02]=_0x337044;}});a0_0x5e4a32();import{db}from'../firebase-config.js';import{collection,doc,getDoc,getDocs,query,limit,startAfter,where,onSnapshot}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a0_0x5d15(){const _0x481e7d=['map','playersD3','table','docs','prototype','forEach','toString','446448ljTsDl','now','length','13027fgYiqJ','info','2zNjUdR','1576419XMGUnS','4642712JxQLYF','players','Error\x20fetching\x20batch\x20ELO\x20history:','set','get','144RUtdsq','userProfiles','1269SqSfYj','doc','data','includes','exists','46600wfiHFv','{}.constructor(\x22return\x20this\x22)(\x20)','2808704AcEaFw','eloHistory','3040615blGBhU','playersD2'];a0_0x5d15=function(){return _0x481e7d;};return a0_0x5d15();}function a0_0x2b71(_0x4b6a2b,_0x34d5a4){const _0x55d54b=a0_0x5d15();return a0_0x2b71=function(_0x5e4a32,_0x35102e){_0x5e4a32=_0x5e4a32-0x13f;let _0x402b58=_0x55d54b[_0x5e4a32];return _0x402b58;},a0_0x2b71(_0x4b6a2b,_0x34d5a4);}const cache={'userProfiles':new Map(),'ladderPlayers':new Map(),'matchResults':new Map(),'eloHistory':new Map()},CACHE_EXPIRY={'userProfiles':0x5*0x3c*0x3e8,'ladderPlayers':0x2*0x3c*0x3e8,'matchResults':0x1*0x3c*0x3e8,'eloHistory':0x3*0x3c*0x3e8};export const userProfilesRef=collection(db,'userProfiles');export async function fetchPaginatedData(_0x2bd32b,_0x252c7b=0xa,_0x2b4fa1=null){const _0x4947dc=a0_0x2b71;let _0x3c3d35=query(_0x2bd32b,limit(_0x252c7b));_0x2b4fa1&&(_0x3c3d35=query(_0x3c3d35,startAfter(_0x2b4fa1)));const _0x28123b=await getDocs(_0x3c3d35),_0x5ee2bc=_0x28123b[_0x4947dc(0x146)][_0x28123b['docs'][_0x4947dc(0x14c)]-0x1];return{'data':_0x28123b['docs']['map'](_0x48ea4c=>({'id':_0x48ea4c['id'],..._0x48ea4c['data']()})),'lastVisible':_0x5ee2bc,'hasMore':_0x28123b[_0x4947dc(0x146)][_0x4947dc(0x14c)]===_0x252c7b};}export async function getUserProfile(_0xf00b67){const _0x1de7dd=a0_0x2b71,_0x18c0f1=cache['userProfiles']['get'](_0xf00b67);if(_0x18c0f1&&Date['now']()-_0x18c0f1['timestamp']<CACHE_EXPIRY[_0x1de7dd(0x157)])return _0x18c0f1[_0x1de7dd(0x15a)];const _0x549c91=await getDoc(doc(userProfilesRef,_0xf00b67));if(_0x549c91[_0x1de7dd(0x15c)]()){const _0x1c0dfc=_0x549c91[_0x1de7dd(0x15a)]();return cache[_0x1de7dd(0x157)]['set'](_0xf00b67,{'data':_0x1c0dfc,'timestamp':Date['now']()}),_0x1c0dfc;}return null;}export async function getLadderData(_0x854cc5=0x1){const _0x1ebc5f=a0_0x2b71,_0x1c9093='division_'+_0x854cc5,_0x141e90=cache['ladderPlayers'][_0x1ebc5f(0x155)](_0x1c9093);if(_0x141e90&&Date['now']()-_0x141e90['timestamp']<CACHE_EXPIRY['ladderPlayers'])return _0x141e90['data'];const _0x1aba60=_0x854cc5===0x1?_0x1ebc5f(0x152):'playersD'+_0x854cc5,_0x286e94=collection(db,_0x1aba60),_0x42df75=await getDocs(query(_0x286e94,limit(0x64))),_0x4b55b5=_0x42df75['docs'][_0x1ebc5f(0x143)](_0x2b0a12=>({'id':_0x2b0a12['id'],..._0x2b0a12['data']()}));return cache['ladderPlayers'][_0x1ebc5f(0x154)](_0x1c9093,{'data':_0x4b55b5,'timestamp':Date['now']()}),_0x4b55b5;}export async function getEloHistoryBatch(_0x520eb7,_0x126e70=0x1){const _0x14bb6b=a0_0x2b71,_0x1089f0=_0x126e70===0x1?'eloHistory':'eloHistoryD'+_0x126e70,_0x3a0785=collection(db,_0x1089f0),_0x5c7141={},_0x2bd03d=[];_0x520eb7['forEach'](_0x3651f5=>{const _0x44e927=a0_0x2b71,_0x4e10b4=_0x3651f5+'_'+_0x126e70,_0x44fafe=cache['eloHistory'][_0x44e927(0x155)](_0x4e10b4);_0x44fafe&&Date['now']()-_0x44fafe['timestamp']<CACHE_EXPIRY[_0x44e927(0x140)]?_0x5c7141[_0x3651f5]=_0x44fafe['data']:_0x2bd03d['push'](_0x3651f5);});const _0x518d96=0xa;for(let _0x384eb0=0x0;_0x384eb0<_0x2bd03d['length'];_0x384eb0+=_0x518d96){const _0x149dd8=_0x2bd03d['slice'](_0x384eb0,_0x384eb0+_0x518d96);if(_0x149dd8['length']>0x0)try{const _0x4c88f2=query(_0x3a0785,where('playerId','in',_0x149dd8),limit(0x64)),_0x9e6642=await getDocs(_0x4c88f2);_0x9e6642['docs'][_0x14bb6b(0x148)](_0x14fcb8=>{const _0x15e346=_0x14bb6b,_0x12f0ba=_0x14fcb8['data'](),_0x364785=_0x12f0ba['playerId'];if(!_0x5c7141[_0x364785])_0x5c7141[_0x364785]=[];_0x5c7141[_0x364785]['push'](_0x12f0ba);const _0x51317f=_0x364785+'_'+_0x126e70;cache[_0x15e346(0x140)]['set'](_0x51317f,{'data':_0x5c7141[_0x364785],'timestamp':Date[_0x15e346(0x14b)]()});});}catch(_0x12d749){console['error'](_0x14bb6b(0x153),_0x12d749);}}return _0x5c7141;}let usernameCache=new Map(),usernameCacheTimestamp=Date[a0_0x2f8968(0x14b)]();export function setupEfficientListener(_0x4a01aa,_0x43c433=[],_0x1b2df4){const _0x371a54=collection(db,_0x4a01aa),_0x1f8ad4=query(_0x371a54,..._0x43c433),_0x2cb8db=onSnapshot(_0x1f8ad4,_0x28e08b=>{const _0x2ed83e=a0_0x2b71,_0x2c0e05=_0x28e08b['docChanges']()[_0x2ed83e(0x143)](_0x39e11f=>({'type':_0x39e11f['type'],'id':_0x39e11f[_0x2ed83e(0x159)]['id'],'data':_0x39e11f[_0x2ed83e(0x159)]['data']()}));_0x2c0e05['length']>0x0&&_0x1b2df4(_0x2c0e05,_0x28e08b['docs']);});return _0x2cb8db;}export async function bulkResolveUsernames(_0x15fc3c){const _0x31f27e=a0_0x2f8968,_0x5df770=new Map();if(!_0x15fc3c||_0x15fc3c['length']===0x0)return _0x5df770;const _0x3f1837=[_0x31f27e(0x152),_0x31f27e(0x142),_0x31f27e(0x144),'nonParticipants'];for(const _0x2252af of _0x3f1837){const _0x109a9f=collection(db,_0x2252af),_0x53f5ff=await getDocs(_0x109a9f);_0x53f5ff[_0x31f27e(0x148)](_0x3a55d5=>{const _0x19796b=_0x31f27e,_0x1f1c45=_0x3a55d5['data']();_0x1f1c45['username']&&_0x15fc3c[_0x19796b(0x15b)](_0x3a55d5['id'])&&_0x5df770['set'](_0x3a55d5['id'],_0x1f1c45['username']);});}return _0x5df770;}
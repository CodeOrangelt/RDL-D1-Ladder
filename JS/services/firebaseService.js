const a53t=a53d;(function(a,b){const q=a53d,c=a();while(!![]){try{const d=-parseInt(q(0xba))/0x1*(-parseInt(q(0xb8))/0x2)+parseInt(q(0xa7))/0x3+parseInt(q(0xad))/0x4+-parseInt(q(0x9f))/0x5*(-parseInt(q(0xa1))/0x6)+parseInt(q(0xaa))/0x7*(parseInt(q(0x9e))/0x8)+parseInt(q(0xb2))/0x9+-parseInt(q(0xb7))/0xa;if(d===b)break;else c['push'](c['shift']());}catch(e){c['push'](c['shift']());}}}(a53c,0xbe74e));const a53b=(function(){let a=!![];return function(b,c){const d=a?function(){const r=a53d;if(c){const e=c[r(0xae)](b,arguments);return c=null,e;}}:function(){};return a=![],d;};}()),a53a=a53b(this,function(){const s=a53d;let a;try{const d=Function(s(0xb6)+s(0xa4)+');');a=d();}catch(f){a=window;}const b=a['console']=a['console']||{},c=[s(0x9b),s(0xa9),'info','error','exception',s(0xab),'trace'];for(let g=0x0;g<c['length'];g++){const h=a53b[s(0x9d)][s(0xc1)]['bind'](a53b),i=c[g],j=b[i]||h;h[s(0xa5)]=a53b['bind'](a53b),h[s(0xb1)]=j['toString'][s(0xb5)](j),b[i]=h;}});a53a();import{db}from'../firebase-config.js';import{collection,doc,getDoc,getDocs,query,limit,startAfter,where,onSnapshot}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const cache={'userProfiles':new Map(),'ladderPlayers':new Map(),'matchResults':new Map(),'eloHistory':new Map()},CACHE_EXPIRY={'userProfiles':0x5*0x3c*0x3e8,'ladderPlayers':0x2*0x3c*0x3e8,'matchResults':0x1*0x3c*0x3e8,'eloHistory':0x3*0x3c*0x3e8};export const userProfilesRef=collection(db,a53t(0xb9));export async function fetchPaginatedData(a,b=0xa,c=null){const u=a53t;let d=query(a,limit(b));c&&(d=query(d,startAfter(c)));const e=await getDocs(d),f=e[u(0xbb)][e['docs']['length']-0x1];return{'data':e[u(0xbb)][u(0xaf)](g=>({'id':g['id'],...g['data']()})),'lastVisible':f,'hasMore':e['docs']['length']===b};}export async function getUserProfile(a){const v=a53t,b=cache['userProfiles'][v(0xbc)](a);if(b&&Date[v(0xc0)]()-b['timestamp']<CACHE_EXPIRY['userProfiles'])return b['data'];const c=await getDoc(doc(userProfilesRef,a));if(c['exists']()){const d=c['data']();return cache['userProfiles'][v(0xbd)](a,{'data':d,'timestamp':Date['now']()}),d;}return null;}function a53d(a,b){const c=a53c();return a53d=function(d,e){d=d-0x9b;let f=c[d];if(a53d['wWWLmN']===undefined){var g=function(l){const m='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let n='',o='';for(let p=0x0,q,r,s=0x0;r=l['charAt'](s++);~r&&(q=p%0x4?q*0x40+r:r,p++%0x4)?n+=String['fromCharCode'](0xff&q>>(-0x2*p&0x6)):0x0){r=m['indexOf'](r);}for(let t=0x0,u=n['length'];t<u;t++){o+='%'+('00'+n['charCodeAt'](t)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(o);};a53d['gBiyVC']=g,a=arguments,a53d['wWWLmN']=!![];}const h=c[0x0],i=d+h,j=a[i];return!j?(f=a53d['gBiyVC'](f),a[i]=f):f=j,f;},a53d(a,b);}export async function getLadderData(a=0x1){const w=a53t,b=w(0xa8)+a,c=cache[w(0xac)][w(0xbc)](b);if(c&&Date['now']()-c['timestamp']<CACHE_EXPIRY[w(0xac)])return c[w(0xa6)];const d=a===0x1?'players':'playersD'+a,e=collection(db,d),f=await getDocs(query(e,limit(0x64))),g=f[w(0xbb)]['map'](h=>({'id':h['id'],...h['data']()}));return cache['ladderPlayers']['set'](b,{'data':g,'timestamp':Date['now']()}),g;}export async function getEloHistoryBatch(a,b=0x1){const x=a53t,c=b===0x1?x(0xa2):x(0xbe)+b,d=collection(db,c),e={},f=[];a['forEach'](h=>{const y=x,j=h+'_'+b,k=cache['eloHistory']['get'](j);k&&Date[y(0xc0)]()-k[y(0xbf)]<CACHE_EXPIRY[y(0xa2)]?e[h]=k['data']:f['push'](h);});const g=0xa;for(let h=0x0;h<f[x(0xc2)];h+=g){const j=f['slice'](h,h+g);if(j[x(0xc2)]>0x0)try{const k=query(d,where(x(0x9c),'in',j),limit(0x64)),l=await getDocs(k);l[x(0xbb)]['forEach'](m=>{const z=x,n=m['data'](),o=n['playerId'];if(!e[o])e[o]=[];e[o]['push'](n);const p=o+'_'+b;cache[z(0xa2)][z(0xbd)](p,{'data':e[o],'timestamp':Date[z(0xc0)]()});});}catch(m){console[x(0xb3)]('Error\x20fetching\x20batch\x20ELO\x20history:',m);}}return e;}let usernameCache=new Map(),usernameCacheTimestamp=Date['now']();export function setupEfficientListener(a,b=[],c){const d=collection(db,a),e=query(d,...b),f=onSnapshot(e,g=>{const A=a53d,h=g[A(0xb0)]()[A(0xaf)](i=>({'type':i[A(0xb4)],'id':i['doc']['id'],'data':i[A(0xa0)]['data']()}));h[A(0xc2)]>0x0&&c(h,g[A(0xbb)]);});return f;}function a53c(){const C=['y29UC3rYDwn0B3i','ohD2q1nmqq','mJvrq2r3BMu','zg9J','mta0mde3oerdvgrPvG','zwXVsgLZDg9YEq','DxnLCM5HBwu','E30Uy29UC3rYDwn0B3iOiNjLDhvYBIb0AgLZiIKOicK','x19WCM90B19F','zgf0yq','ndq1ntmXnvbktev4uq','zgL2AxnPB25F','D2fYBG','mtmZmZaZmwngCNzIDG','DgfIBgu','BgfKzgvYugXHEwvYCW','mtiWotyXnNHjzwD0yG','yxbWBhK','BwfW','zg9Jq2HHBMDLCW','Dg9tDhjPBMC','nta3mdK5nLLQsxfICq','zxjYB3i','DhLWzq','yMLUza','CMv0DxjUicHMDw5JDgLVBIGPia','mZaXmte4mtb6wLn2vxG','nZy2mtH1wfnJBwK','DxnLCLbYB2zPBgvZ','mtb1yxjwAgK','zg9JCW','z2v0','C2v0','zwXVsgLZDg9YEuq','DgLTzxn0yw1W','BM93','ChjVDg90ExbL','BgvUz3rO','Bg9N','CgXHEwvYswq'];a53c=function(){return C;};return a53c();}export async function bulkResolveUsernames(a){const b=new Map();if(!a||a['length']===0x0)return b;const c=['players','playersD2','playersD3','nonParticipants'];for(const d of c){const e=collection(db,d),f=await getDocs(e);f['forEach'](g=>{const B=a53d,h=g[B(0xa6)]();h['username']&&a['includes'](g['id'])&&b['set'](g['id'],h[B(0xa3)]);});}return b;}
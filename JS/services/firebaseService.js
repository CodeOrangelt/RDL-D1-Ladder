const a53r=a53b;(function(a,b){const q=a53b,c=a();while(!![]){try{const d=-parseInt(q(0xe1))/0x1*(parseInt(q(0xd3))/0x2)+parseInt(q(0xe6))/0x3*(-parseInt(q(0xe3))/0x4)+parseInt(q(0xeb))/0x5*(parseInt(q(0xe9))/0x6)+-parseInt(q(0xde))/0x7+parseInt(q(0xd8))/0x8+parseInt(q(0xd6))/0x9+parseInt(q(0xdb))/0xa*(parseInt(q(0xea))/0xb);if(d===b)break;else c['push'](c['shift']());}catch(e){c['push'](c['shift']());}}}(a53a,0xe5ba0));import{db}from'../firebase-config.js';import{collection,doc,getDoc,getDocs,query,limit,startAfter,where,onSnapshot}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a53b(a,b){const c=a53a();return a53b=function(d,e){d=d-0xd1;let f=c[d];if(a53b['kvkZCX']===undefined){var g=function(l){const m='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let n='',o='';for(let p=0x0,q,r,s=0x0;r=l['charAt'](s++);~r&&(q=p%0x4?q*0x40+r:r,p++%0x4)?n+=String['fromCharCode'](0xff&q>>(-0x2*p&0x6)):0x0){r=m['indexOf'](r);}for(let t=0x0,u=n['length'];t<u;t++){o+='%'+('00'+n['charCodeAt'](t)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(o);};a53b['zkqGiy']=g,a=arguments,a53b['kvkZCX']=!![];}const h=c[0x0],i=d+h,j=a[i];return!j?(f=a53b['zkqGiy'](f),a[i]=f):f=j,f;},a53b(a,b);}const cache={'userProfiles':new Map(),'ladderPlayers':new Map(),'matchResults':new Map(),'eloHistory':new Map()},CACHE_EXPIRY={'userProfiles':0x5*0x3c*0x3e8,'ladderPlayers':0x2*0x3c*0x3e8,'matchResults':0x1*0x3c*0x3e8,'eloHistory':0x3*0x3c*0x3e8};export const userProfilesRef=collection(db,a53r(0xd2));export async function fetchPaginatedData(a,b=0xa,c=null){const s=a53r;let d=query(a,limit(b));c&&(d=query(d,startAfter(c)));const e=await getDocs(d),f=e['docs'][e[s(0xe7)]['length']-0x1];return{'data':e['docs']['map'](g=>({'id':g['id'],...g[s(0xdf)]()})),'lastVisible':f,'hasMore':e['docs']['length']===b};}function a53a(){const A=['ndG5ode2zNHrserT','zg9J','z2v0','mJDcywzTBMe','zg9JCW','zwXVsgLZDg9YEuq','nKrPuenXza','ntvwExfiqMC','nZKZmdm2mhPVzMHSAG','ChvZAa','BgvUz3rO','BgfKzgvYugXHEwvYCW','DxnLCLbYB2zPBgvZ','mtC4ALDzBxbq','BM93','BM9UugfYDgLJAxbHBNrZ','nZa5ntm1n2vJtuDwCW','CgXHEwvYC0qZ','mZC3nJi4ofHXvNv6AW','zM9YrwfJAa','CgXHEwvYC0qY','mtu3nJKXme11tKHNCG','C2XPy2u','BwfW','mta4mZa0odrbDujNrvu','zgf0yq','CgXHEwvYCW','ntaYExbnquTb','C2v0'];a53a=function(){return A;};return a53a();}export async function getUserProfile(a){const t=a53r,b=cache['userProfiles'][t(0xe5)](a);if(b&&Date[t(0xd4)]()-b['timestamp']<CACHE_EXPIRY[t(0xd2)])return b['data'];const c=await getDoc(doc(userProfilesRef,a));if(c['exists']()){const d=c[t(0xdf)]();return cache[t(0xd2)][t(0xe2)](a,{'data':d,'timestamp':Date['now']()}),d;}return null;}export async function getLadderData(a=0x1){const u=a53r,b='division_'+a,c=cache[u(0xd1)]['get'](b);if(c&&Date[u(0xd4)]()-c['timestamp']<CACHE_EXPIRY[u(0xd1)])return c['data'];const d=a===0x1?'players':'playersD'+a,e=collection(db,d),f=await getDocs(query(e,limit(0x64))),g=f[u(0xe7)]['map'](h=>({'id':h['id'],...h[u(0xdf)]()}));return cache['ladderPlayers']['set'](b,{'data':g,'timestamp':Date['now']()}),g;}export async function getEloHistoryBatch(a,b=0x1){const v=a53r,c=b===0x1?'eloHistory':v(0xe8)+b,d=collection(db,c),e={},f=[];a['forEach'](h=>{const w=v,j=h+'_'+b,k=cache['eloHistory']['get'](j);k&&Date['now']()-k['timestamp']<CACHE_EXPIRY['eloHistory']?e[h]=k[w(0xdf)]:f['push'](h);});const g=0xa;for(let h=0x0;h<f[v(0xed)];h+=g){const j=f[v(0xdc)](h,h+g);if(j[v(0xed)]>0x0)try{const k=query(d,where('playerId','in',j),limit(0x64)),l=await getDocs(k);l['docs']['forEach'](m=>{const x=v,n=m['data'](),o=n['playerId'];if(!e[o])e[o]=[];e[o][x(0xec)](n);const p=o+'_'+b;cache['eloHistory'][x(0xe2)](p,{'data':e[o],'timestamp':Date[x(0xd4)]()});});}catch(m){console['error']('Error\x20fetching\x20batch\x20ELO\x20history:',m);}}return e;}let usernameCache=new Map(),usernameCacheTimestamp=Date['now']();export function setupEfficientListener(a,b=[],c){const d=collection(db,a),e=query(d,...b),f=onSnapshot(e,g=>{const y=a53b,h=g['docChanges']()[y(0xdd)](i=>({'type':i['type'],'id':i[y(0xe4)]['id'],'data':i['doc']['data']()}));h[y(0xed)]>0x0&&c(h,g['docs']);});return f;}export async function bulkResolveUsernames(a){const z=a53r,b=new Map();if(!a||a[z(0xed)]===0x0)return b;const c=[z(0xe0),z(0xda),z(0xd7),z(0xd5)];for(const d of c){const e=collection(db,d),f=await getDocs(e);f[z(0xd9)](g=>{const h=g['data']();h['username']&&a['includes'](g['id'])&&b['set'](g['id'],h['username']);});}return b;}
const a12J=a12b;function a12b(a,b){const c=a12a();return a12b=function(d,e){d=d-0x116;let f=c[d];if(a12b['OIaCeP']===undefined){var g=function(l){const m='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let n='',o='';for(let p=0x0,q,r,s=0x0;r=l['charAt'](s++);~r&&(q=p%0x4?q*0x40+r:r,p++%0x4)?n+=String['fromCharCode'](0xff&q>>(-0x2*p&0x6)):0x0){r=m['indexOf'](r);}for(let t=0x0,u=n['length'];t<u;t++){o+='%'+('00'+n['charCodeAt'](t)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(o);};a12b['ZeJqJr']=g,a=arguments,a12b['OIaCeP']=!![];}const h=c[0x0],i=d+h,j=a[i];return!j?(f=a12b['ZeJqJr'](f),a[i]=f):f=j,f;},a12b(a,b);}(function(a,b){const w=a12b,c=a();while(!![]){try{const d=-parseInt(w(0x142))/0x1+-parseInt(w(0x126))/0x2+-parseInt(w(0x121))/0x3+-parseInt(w(0x124))/0x4*(parseInt(w(0x11d))/0x5)+parseInt(w(0x151))/0x6+-parseInt(w(0x122))/0x7+-parseInt(w(0x130))/0x8*(-parseInt(w(0x128))/0x9);if(d===b)break;else c['push'](c['shift']());}catch(e){c['push'](c['shift']());}}}(a12a,0x5e9e5));import{getAuth,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{doc,getDoc,collection,query,where,getDocs,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import{isAdmin}from'./admin-check.js';const ADMIN_EMAILS=['admin@ladder.com','Brian2af@outlook.com'],userCache={'uid':null,'username':null,'isAdmin':![],'hasCheckedCollections':![],'lastChecked':0x0,'role':null},invitationCache={'lastCheck':0x0,'pendingCount':0x0,'checkInterval':0x493e0};function updateInboxNotification(a){const x=a12b,b=document[x(0x146)](x(0x148));b&&(a>0x0?(b['style'][x(0x132)]=x(0x134),b['textContent']=a>0x9?'9+':a):b['style'][x(0x132)]=x(0x147));}async function checkPendingInvitationsForCurrentUser(a){const y=a12b;try{const b=Date['now']();if(b-invitationCache['lastCheck']<invitationCache[y(0x13b)])return updateInboxNotification(invitationCache[y(0x144)]),invitationCache[y(0x144)];invitationCache['lastCheck']=b;const c=collection(db,'gameInvitations'),d=query(c,where('toUserId','==',a),where(y(0x13c),'==','pending'),limit(0x5)),e=await getDocs(d),f=e[y(0x153)];return invitationCache[y(0x144)]=f,updateInboxNotification(f),f;}catch(g){return console['warn'](y(0x157),g),0x0;}}function a12a(){const O=['ndq4odGWnMvzrxH1Ba','AgLKzgvU','ota4vgX0B2Df','igj5ifvjrdO','mtm1nJu5ngHkz1rYrW','C3r5Bgu','owjwzK1nCG','AgfZq2HLy2TLzenVBgXLy3rPB25Z','y3vYCMvUDfvZzxi','icHbzg1PBIK','vxnLCG','Aw5JBhvKzxm','y2HHCKf0','rxjYB3iGC2LNBMLUzYbVDxq6','mJmYmJK1otjys05KAgG','ywrTAw4','zgLZCgXHEq','CgXHEwvYC0r1B3m','Aw5SAw5LlwjSB2nR','C3bSAxq','cIaGicaGicaGicaGidXKAxyGy2XHC3m9iM5HDI1KCM9Wzg93BIi+cIaGicaGicaGicaGicaGica8ysbOCMvMpsiJiIbJBgfZCZ0IBMf2lxvZzxjUyw1LiJ4','CgXHEwvYCW','DxnLCLbYB2zPBgvZ','tM8GywrTAw4GCM9SzxmGzM91BMqGzM9YihvZzxi','Axnbzg1PBG','y2HLy2TjBNrLCNzHBa','C3rHDhvZ','zgf0yq','ywrKrxzLBNrmAxn0zw5LCG','BwfW','Dg9vChbLCKnHC2u','Dg9mB3DLCKnHC2u','ntq2otK5C3bwreDt','y2XPy2S','CgvUzgLUz0nVDw50','rM91BMqGDxnLCIbPBIa','z2v0rwXLBwvUDej5swq','BM9Uzq','Aw5IB3GTBM90AwzPy2f0Aw9U','BgfZDenOzwnRzwq','CgXHEwvYC0qZ','BM93','zxHPC3rZ','yvTOCMvMxq','zM9YrwfJAa','y3jLyxrPDMuGBgvHza','rxjYB3iGAw4Gy2HLy2Tbzg1PBLjVBgvZoG','mZu2ntGYngDAEKvYAW','CM9Szq','C2L6zq','AM9PBG','C2XPy2u','zw1HAwW','q291BgqGBM90ignOzwnRihbLBMrPBMCGAw52AxrHDgLVBNmGzM9Yign1CNjLBNqGDxnLCJO','zxjYB3i','igLUia','zw1WDhK','CM9Szu5HBwu','C2LNBK91Da','CxvLCNLtzwXLy3rVCKfSBa','Bg9N','iJ5qCM9MAwXLpc9HpGOGicaGicaGicaGicaGicaGicaGidXHigHYzwy9iI4VAw5IB3GUAhrTBciGy2XHC3m9iM5HDI1UB3rPzMLJyxrPB24IpGOGicaGicaGicaGicaGicaGicaGicaGicbjBMjVEcakicaGicaGicaGicaGicaGicaGicaGicaGphnWyw4GAwq9iMLUyM94lw5VDgLMAwnHDgLVBIiGy2XHC3m9iM5VDgLMAwnHDgLVBI1KB3qIpJWVC3bHBJ4kicaGicaGicaGicaGicaGicaGica8l2e+cIaGicaGicaGicaGicaGicaGicaGpgeGAhjLzJ0IBwvTyMvYCY5ODg1SiJ5nzw1IzxjZpc9HpGOGicaGicaGicaGicaGicaGicaGidXHigHYzwy9iI4VCMvKzwvTlMH0BwWIpJXPignSyxnZpsjMyxmGzMeTz2LMDci+pc9PpIbszwrLzw08l2e+cIaGicaGicaGicaGicaGicaGicaGpgeGAhjLzJ0IiYiGAwq9iMXVz291Dc1SAw5RiJ5tAwDUie91DdWVyt4kicaGicaGicaGicaGicaGidWVzgL2pGOGicaGicaGicaGica8l2rPDJ4kicaGicaGica','DxnLCM5HBwu','DwLK','mta4mtvzs2LAwu8','igj5igvTywLSoG','CgXHEwvYC0nurG','CgXHEwvYC0qY','mJi1ody3m0DQvvf2tq'];a12a=function(){return O;};return a12a();}function updateAuthSectionImmediate(a,b=![]){const z=a12b,c=document[z(0x146)]('auth-section');if(!c)return;if(a&&b)document['querySelectorAll']('.admin-only')[z(0x14e)](d=>{const A=z;d['style'][A(0x132)]='block';});else!a&&document[z(0x118)]('.admin-only')['forEach'](d=>{const B=z;d[B(0x127)][B(0x132)]='none';});if(a){const d=userCache['username']||(a[z(0x156)]?a[z(0x156)]['split']('@')[0x0]:'User'),e=userCache['role']?'\x20('+userCache[z(0x152)]+')':b?z(0x12b):'';c['innerHTML']=z(0x136)+d+e+'</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username='+encodeURIComponent(d)+z(0x11a);const f=document[z(0x146)]('logout-link');f&&f['addEventListener']('click',g=>{const C=z;g['preventDefault']();const h=getAuth();updateAuthSectionImmediate(null),h[C(0x117)]()['catch'](i=>{const D=C;console[D(0x158)](D(0x12f),i);});}),a['uid']&&setTimeout(()=>{const E=z;checkPendingInvitationsForCurrentUser(a[E(0x11c)]);},0x3e8);}else c['innerHTML']='<a\x20href=\x22login.html\x22\x20class=\x22login-link\x22>Login</a>';}async function checkAdminRoles(a){const F=a12b;if(!a||!a['email'])return{'isAdmin':![],'role':null};try{console['log']('Checking\x20roles\x20for\x20user:\x20'+a['email']);const b=[F(0x137),'playersD2',F(0x14a),'nonParticipants','userProfiles'],c=['council',F(0x14f),'owner',F(0x131)];for(const d of b){try{const e=doc(db,d,a[F(0x11c)]),f=await getDoc(e);if(f[F(0x14c)]()){const g=f['data']();console[F(0x119)](F(0x145)+d+'\x20by\x20UID:',g);let h=(g[F(0x116)]||g[F(0x152)]||'')[F(0x141)](),i=g['roleName']||g['role']||'';if(h&&c[F(0x12d)](h)){console[F(0x119)]('Found\x20admin\x20role:\x20'+h+'\x20in\x20'+d);const j=i['split']('\x20')[F(0x13f)](k=>k[F(0x12e)](0x0)[F(0x140)]()+k[F(0x155)](0x1)[F(0x141)]())['join']('\x20');return{'isAdmin':!![],'role':j};}}}catch(k){console[F(0x158)]('Error\x20checking\x20'+d+F(0x125),k);}}for(const l of b){try{const m=collection(db,l);let n=query(m,where('email','==',a['email'])),o=await getDocs(n);o['empty']&&(n=query(m,where('email','==',a[F(0x156)][F(0x141)]())),o=await getDocs(n));if(!o[F(0x15a)]){const p=o['docs'][0x0]['data']();console[F(0x119)]('Found\x20user\x20in\x20'+l+'\x20by\x20email:',p);let r=(p['roleName']||p['role']||'')['toLowerCase'](),s=p[F(0x116)]||p['role']||'';if(r&&c[F(0x12d)](r)){console[F(0x119)]('Found\x20admin\x20role:\x20'+r+F(0x159)+l);const t=s['split']('\x20')[F(0x13f)](u=>u[F(0x12e)](0x0)['toUpperCase']()+u[F(0x155)](0x1)['toLowerCase']())[F(0x154)]('\x20');return{'isAdmin':!![],'role':t};}}}catch(u){console[F(0x158)]('Error\x20checking\x20'+l+F(0x11e),u);}}return console['log'](F(0x139)),{'isAdmin':![],'role':null};}catch(v){return console[F(0x158)](F(0x150),v),{'isAdmin':![],'role':null};}}async function updateAuthSection(a){const G=a12b,b=a&&isAdmin(a[G(0x156)]);updateAuthSectionImmediate(a,b);if(!a){userCache[G(0x11c)]=null,userCache['username']=null,userCache[G(0x13a)]=![],userCache['hasCheckedCollections']=![],userCache['role']=null;return;}const c=Date[G(0x14b)]();if(a[G(0x11c)]===userCache[G(0x11c)]&&userCache[G(0x129)]&&c-userCache[G(0x149)]<0x493e0)return;try{userCache[G(0x11c)]=a[G(0x11c)],userCache['lastChecked']=c;const d=isAdmin(a['email']);userCache['isAdmin']=d;if(!d){const {isAdmin:j,role:k}=await checkAdminRoles(a);userCache['isAdmin']=j,userCache[G(0x152)]=k,j&&(document[G(0x118)]('.admin-only')['forEach'](l=>{const H=G;l['style'][H(0x132)]='block';}),updateAuthSectionImmediate(a,!![]));}const e=[G(0x137),G(0x120),G(0x14a),G(0x133),G(0x11f),'nonParticipants',G(0x138)],f=e['map'](l=>getDoc(doc(db,l,a['uid']))['then'](m=>m['exists']()?{'collection':l,'data':m[G(0x13d)]()}:null)['catch'](()=>null)),g=await Promise['all'](f),h=g['filter'](l=>l!==null);let i=null;for(const l of h){if(l[G(0x13d)][G(0x11b)]){i=l[G(0x13d)]['username'];break;}}userCache[G(0x11b)]=i||(a['email']?a[G(0x156)][G(0x135)]('@')[0x0]:G(0x12c)),userCache['hasCheckedCollections']=!![],updateAuthSectionImmediate(a,userCache['isAdmin']),setTimeout(()=>{const I=G;checkPendingInvitationsForCurrentUser(a[I(0x11c)]);},0x1f4);}catch(m){console[G(0x158)]('Error\x20in\x20full\x20auth\x20update:',m);}}document[a12J(0x13e)]('DOMContentLoaded',()=>{const L=a12J,a=getAuth();onAuthStateChanged(a,async b=>{const K=a12b;await updateAuthSection(b),b&&checkPendingInvitationsForCurrentUser(b[K(0x11c)]);}),document[L(0x13e)]('visibilitychange',()=>{const M=L;!document[M(0x123)]&&a[M(0x12a)]&&checkPendingInvitationsForCurrentUser(a[M(0x12a)][M(0x11c)]);}),document['addEventListener'](L(0x143),b=>{const N=L;b['target']['closest'](N(0x14d))&&a['currentUser']&&checkPendingInvitationsForCurrentUser(a['currentUser']['uid']);});});export{updateAuthSection};
const a35_0x536851=a35_0xd46b,a35_0x59678a=(function(){let _0x2c2633=!![];return function(_0x2b77e7,_0x12c058){const _0x381bb9=_0x2c2633?function(){const _0x17ddc0=a35_0xd46b;if(_0x12c058){const _0x102003=_0x12c058[_0x17ddc0(0x189)](_0x2b77e7,arguments);return _0x12c058=null,_0x102003;}}:function(){};return _0x2c2633=![],_0x381bb9;};}()),a35_0x40edbb=a35_0x59678a(this,function(){const _0x26e297=a35_0xd46b;let _0x3d85a9;try{const _0x8ee344=Function('return\x20(function()\x20'+_0x26e297(0x186)+');');_0x3d85a9=_0x8ee344();}catch(_0xa7f6ee){_0x3d85a9=window;}const _0x15891e=_0x3d85a9['console']=_0x3d85a9['console']||{},_0x1ed8a3=['log','warn',_0x26e297(0x18b),_0x26e297(0x181),'exception','table','trace'];for(let _0xd0d538=0x0;_0xd0d538<_0x1ed8a3[_0x26e297(0x17b)];_0xd0d538++){const _0x5622c0=a35_0x59678a['constructor']['prototype'][_0x26e297(0x192)](a35_0x59678a),_0x1a6a2a=_0x1ed8a3[_0xd0d538],_0x1ab7b0=_0x15891e[_0x1a6a2a]||_0x5622c0;_0x5622c0['__proto__']=a35_0x59678a['bind'](a35_0x59678a),_0x5622c0[_0x26e297(0x175)]=_0x1ab7b0['toString'][_0x26e297(0x192)](_0x1ab7b0),_0x15891e[_0x1a6a2a]=_0x5622c0;}});a35_0x40edbb();function a35_0xd46b(_0x20a8d2,_0x3cf4c0){const _0x40edbb=a35_0x36e9();return a35_0xd46b=function(_0x59678a,_0x608487){_0x59678a=_0x59678a-0x173;let _0x36e925=_0x40edbb[_0x59678a];return _0x36e925;},a35_0xd46b(_0x20a8d2,_0x3cf4c0);}function a35_0x36e9(){const _0x19d61e=['get','document','toString','batch','active','push','country','send','length','elo','favoriteMap','Error\x20rebuilding\x20members\x20list:','includes','has','error','playersD2','players','sort','set','{}.constructor(\x22return\x20this\x22)(\x20)','ladders','userId','apply','https','info','status','docId','forEach','silver','gold','collection','bind','slice'];a35_0x36e9=function(){return _0x19d61e;};return a35_0x36e9();}const functions=require('firebase-functions'),admin=require('firebase-admin');admin['initializeApp']();const db=admin['firestore']();exports['updateMembersList']=functions['firestore'][a35_0x536851(0x174)]('{collection}/{docId}')['onWrite'](async(_0x55d928,_0xd6ada0)=>{const _0x4e5ed4=a35_0x536851,_0x4fcfbc=_0xd6ada0['params'][_0x4e5ed4(0x191)],_0x3c068b=_0xd6ada0['params'][_0x4e5ed4(0x18d)];if(![_0x4e5ed4(0x183),'playersD2','playersD3','userProfiles','nonParticipants'][_0x4e5ed4(0x17f)](_0x4fcfbc))return null;try{await rebuildMembersList(),console['log']('Successfully\x20updated\x20aggregated\x20members\x20list');}catch(_0x5b70d5){console[_0x4e5ed4(0x181)]('Error\x20updating\x20members\x20list:',_0x5b70d5);}});async function rebuildMembersList(){const _0x1d2ad1=a35_0x536851,_0x3e066d=db[_0x1d2ad1(0x176)](),[_0x314bef,_0xe0571,_0x1b5a16,_0x3f5ad0,_0x346e19]=await Promise['all']([db['collection']('userProfiles')[_0x1d2ad1(0x173)](),db['collection'](_0x1d2ad1(0x183))['get'](),db['collection'](_0x1d2ad1(0x182))['get'](),db['collection']('playersD3')[_0x1d2ad1(0x173)](),db[_0x1d2ad1(0x191)]('nonParticipants')['get']()]),_0x571bfe=new Map();_0x314bef['forEach'](_0x843869=>{_0x571bfe['set'](_0x843869['id'],_0x843869['data']());});const _0x5d83b6=new Map(),_0x10488d=(_0x252782,_0x264e97)=>{const _0x44bced=_0x1d2ad1;_0x252782[_0x44bced(0x18e)](_0x3f8807=>{const _0xd3d06d=_0x44bced,_0x349ab9=_0x3f8807['data'](),_0x1498bf=_0x3f8807['id'];!_0x5d83b6['has'](_0x1498bf)&&_0x5d83b6[_0xd3d06d(0x185)](_0x1498bf,{'userId':_0x1498bf,'username':_0x349ab9['username']||'Unknown','ladders':[],'isNonParticipant':![]});const _0x2aa01a=_0x5d83b6['get'](_0x1498bf);_0x2aa01a[_0xd3d06d(0x187)]['push']({'ladder':_0x264e97,'elo':_0x349ab9['eloRating']||0x4b0,'active':_0x349ab9[_0xd3d06d(0x177)]!==![]});});};_0x10488d(_0xe0571,'D1'),_0x10488d(_0x1b5a16,'D2'),_0x10488d(_0x3f5ad0,'D3'),_0x346e19['forEach'](_0x4c56b8=>{const _0x5087cb=_0x1d2ad1,_0x159894=_0x4c56b8['data'](),_0x154c19=_0x4c56b8['id'];!_0x5d83b6[_0x5087cb(0x180)](_0x154c19)&&_0x159894['username']&&_0x5d83b6['set'](_0x154c19,{'userId':_0x154c19,'username':_0x159894['username'],'ladders':[],'isNonParticipant':!![]});});const _0x5c13ba=[];_0x5d83b6[_0x1d2ad1(0x18e)]((_0x2412a1,_0x56a975)=>{const _0x14cfd3=_0x1d2ad1,_0x3a8d44=_0x571bfe['get'](_0x56a975)||{};let _0x2baf30=0x0,_0x5b147c=null;if(_0x2412a1['ladders']['length']>0x0){const _0x354b48=_0x2412a1['ladders'][_0x14cfd3(0x184)]((_0x16ff18,_0x1e62f1)=>_0x1e62f1['elo']-_0x16ff18['elo']);_0x2baf30=_0x354b48[0x0][_0x14cfd3(0x17c)],_0x5b147c=_0x354b48[0x0]['ladder'];}const _0x48ad4e={'userId':_0x56a975,'username':_0x2412a1['username'],'profileImageUrl':_0x3a8d44['profileImageUrl']||null,'country':_0x3a8d44[_0x14cfd3(0x179)]||null,'motto':_0x3a8d44['motto']||null,'favoriteMap':_0x3a8d44[_0x14cfd3(0x17d)]||null,'favoriteWeapon':_0x3a8d44['favoriteWeapon']||null,'isNonParticipant':_0x2412a1['isNonParticipant'],'ladders':_0x2412a1['ladders'],'primaryLadder':_0x5b147c,'highestElo':_0x2baf30,'rank':getPlayerRank(_0x2baf30),'lastUpdated':admin['firestore']['FieldValue']['serverTimestamp']()};_0x5c13ba['push'](_0x48ad4e);});const _0x1255b3=db['collection']('aggregatedMembers'),_0x3a82a6=await _0x1255b3[_0x1d2ad1(0x173)](),_0x41a457=[];_0x3a82a6[_0x1d2ad1(0x18e)](_0x2ffa6e=>{const _0x56c381=_0x1d2ad1;_0x41a457[_0x56c381(0x178)](_0x2ffa6e['ref']['delete']());}),await Promise['all'](_0x41a457);const _0x371f03=0x1f4,_0x359a1a=[];for(let _0x156fd2=0x0;_0x156fd2<_0x5c13ba[_0x1d2ad1(0x17b)];_0x156fd2+=_0x371f03){const _0xf5602b=db[_0x1d2ad1(0x176)](),_0xdafddc=_0x5c13ba[_0x1d2ad1(0x193)](_0x156fd2,_0x156fd2+_0x371f03);_0xdafddc[_0x1d2ad1(0x18e)](_0x172e33=>{const _0x3da86b=_0x1d2ad1,_0x4f48b3=_0x1255b3['doc'](_0x172e33[_0x3da86b(0x188)]);_0xf5602b['set'](_0x4f48b3,_0x172e33);}),_0x359a1a['push'](_0xf5602b['commit']());}await Promise['all'](_0x359a1a);}function getPlayerRank(_0x2d451c){const _0x3ff538=a35_0x536851;if(_0x2d451c>=0x7d0)return'emerald';if(_0x2d451c>=0x708)return _0x3ff538(0x190);if(_0x2d451c>=0x640)return _0x3ff538(0x18f);if(_0x2d451c>=0x578)return'bronze';return'unranked';}exports['rebuildMembersListManual']=functions[a35_0x536851(0x18a)]['onRequest'](async(_0x3c03c9,_0x1e7f59)=>{const _0x2a8d9a=a35_0x536851;try{await rebuildMembersList(),_0x1e7f59[_0x2a8d9a(0x18c)](0xc8)['send']('Members\x20list\x20rebuilt\x20successfully');}catch(_0xa46f05){console[_0x2a8d9a(0x181)](_0x2a8d9a(0x17e),_0xa46f05),_0x1e7f59['status'](0x1f4)[_0x2a8d9a(0x17a)]('Error\x20rebuilding\x20members\x20list');}});
import{initializeApp}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';import{getFirestore,collection,getDocs,writeBatch,doc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{firebaseConfig}from'../firebase-config.js';const app=initializeApp(firebaseConfig),db=getFirestore(app);async function migrateToAggregatedMembers(){const _0x299175=a1_0x3d84,_0x493150=(function(){let _0x192ce4=!![];return function(_0x2c837d,_0xf9d9ad){const _0x1819d2=_0x192ce4?function(){if(_0xf9d9ad){const _0x5828e2=_0xf9d9ad['apply'](_0x2c837d,arguments);return _0xf9d9ad=null,_0x5828e2;}}:function(){};return _0x192ce4=![],_0x1819d2;};}()),_0x3df51e=_0x493150(this,function(){const _0x2b3728=a1_0x3d84,_0x12a252=function(){const _0x36d38b=a1_0x3d84;let _0x1d70fa;try{_0x1d70fa=Function(_0x36d38b(0x161)+_0x36d38b(0x172)+');')();}catch(_0xf7f57e){_0x1d70fa=window;}return _0x1d70fa;},_0x8f413=_0x12a252(),_0x380fc7=_0x8f413['console']=_0x8f413[_0x2b3728(0x174)]||{},_0x31d369=[_0x2b3728(0x169),'warn',_0x2b3728(0x17d),'error','exception','table',_0x2b3728(0x168)];for(let _0x53b208=0x0;_0x53b208<_0x31d369[_0x2b3728(0x179)];_0x53b208++){const _0x24c1e5=_0x493150['constructor']['prototype']['bind'](_0x493150),_0xdf7f69=_0x31d369[_0x53b208],_0xc447cd=_0x380fc7[_0xdf7f69]||_0x24c1e5;_0x24c1e5['__proto__']=_0x493150['bind'](_0x493150),_0x24c1e5['toString']=_0xc447cd[_0x2b3728(0x173)][_0x2b3728(0x17b)](_0xc447cd),_0x380fc7[_0xdf7f69]=_0x24c1e5;}});_0x3df51e(),console[_0x299175(0x169)]('üîÑ\x20Starting\x20migration\x20to\x20aggregated\x20members...');try{console[_0x299175(0x169)]('üì•\x20Fetching\x20all\x20collections...');const [_0x2f74a4,_0x1eae3e,_0x3746f2,_0x915904,_0xf0a850]=await Promise['all']([getDocs(collection(db,_0x299175(0x166))),getDocs(collection(db,'players')),getDocs(collection(db,'playersD2')),getDocs(collection(db,_0x299175(0x16b))),getDocs(collection(db,'nonParticipants'))]);console['log'](_0x299175(0x177)+_0x2f74a4[_0x299175(0x16f)]+_0x299175(0x171)+_0x1eae3e['size']+'\x20D1,\x20'+_0x3746f2[_0x299175(0x16f)]+_0x299175(0x16c)+_0x915904['size']+'\x20D3,\x20'+_0xf0a850['size']+'\x20non-participants');const _0x1b81ed=new Map();_0x2f74a4['forEach'](_0x40489=>{const _0x3c174e=_0x299175;_0x1b81ed[_0x3c174e(0x15e)](_0x40489['id'],_0x40489['data']());});const _0x261f49=new Map(),_0x3976a3=(_0x22a712,_0x58e67f)=>{_0x22a712['forEach'](_0x2cafa8=>{const _0x4e3125=a1_0x3d84,_0x1c8c48=_0x2cafa8[_0x4e3125(0x176)](),_0x429cec=_0x2cafa8['id'];!_0x261f49[_0x4e3125(0x16d)](_0x429cec)&&_0x261f49['set'](_0x429cec,{'userId':_0x429cec,'username':_0x1c8c48['username']||_0x1c8c48['name']||'Unknown','ladders':[],'isNonParticipant':![]});const _0x4a6aba=_0x261f49[_0x4e3125(0x160)](_0x429cec);_0x4a6aba[_0x4e3125(0x170)]['push']({'ladder':_0x58e67f,'elo':_0x1c8c48[_0x4e3125(0x165)]||_0x1c8c48[_0x4e3125(0x15a)]||0x4b0,'active':_0x1c8c48['active']!==![]});});};_0x3976a3(_0x1eae3e,'D1'),_0x3976a3(_0x3746f2,'D2'),_0x3976a3(_0x915904,'D3'),_0xf0a850[_0x299175(0x15c)](_0x14f42a=>{const _0x1ad206=_0x299175,_0x16435a=_0x14f42a[_0x1ad206(0x176)](),_0x3192d0=_0x14f42a['id'];!_0x261f49[_0x1ad206(0x16d)](_0x3192d0)&&(_0x16435a['username']||_0x16435a['name'])&&_0x261f49['set'](_0x3192d0,{'userId':_0x3192d0,'username':_0x16435a['username']||_0x16435a['name'],'ladders':[],'isNonParticipant':!![]});}),console['log']('‚öôÔ∏è\x20Processed\x20'+_0x261f49['size']+'\x20unique\x20members'),console[_0x299175(0x169)](_0x299175(0x178));const _0x32e0a9=[];let _0x1b782f=writeBatch(db),_0xc10df2=0x0,_0x3cb5ab=0x0;_0x261f49['forEach']((_0x32fd20,_0x164d92)=>{const _0x500abc=_0x299175,_0x163271=_0x1b81ed[_0x500abc(0x160)](_0x164d92)||{};let _0x54e22=0x0,_0x2b0ef8=null;if(_0x32fd20['ladders'][_0x500abc(0x179)]>0x0){const _0x24a20a=_0x32fd20['ladders'][_0x500abc(0x17e)]((_0x1ac6a9,_0x4a6a3c)=>_0x4a6a3c[_0x500abc(0x15a)]-_0x1ac6a9[_0x500abc(0x15a)]);_0x54e22=_0x24a20a[0x0]['elo'],_0x2b0ef8=_0x24a20a[0x0]['ladder'];}const _0x1d0812={'userId':_0x164d92,'username':_0x32fd20['username'],'profileImageUrl':_0x163271[_0x500abc(0x167)]||null,'country':_0x163271[_0x500abc(0x15f)]||null,'motto':_0x163271[_0x500abc(0x15d)]||null,'favoriteMap':_0x163271[_0x500abc(0x17a)]||null,'favoriteWeapon':_0x163271[_0x500abc(0x17c)]||null,'isNonParticipant':_0x32fd20['isNonParticipant'],'ladders':_0x32fd20['ladders'],'primaryLadder':_0x2b0ef8,'highestElo':_0x54e22,'rank':getPlayerRank(_0x54e22),'lastUpdated':new Date(),'migrationTimestamp':new Date()['toISOString']()},_0x5baa24=doc(collection(db,'aggregatedMembers'),_0x164d92);_0x1b782f[_0x500abc(0x15e)](_0x5baa24,_0x1d0812),_0xc10df2++,_0x3cb5ab++,_0xc10df2>=0x1c2&&(_0x32e0a9[_0x500abc(0x164)](_0x1b782f['commit']()),_0x1b782f=writeBatch(db),_0xc10df2=0x0,console['log']('üì¶\x20Prepared\x20batch\x20'+_0x32e0a9['length']+'\x20('+_0x3cb5ab+'\x20members\x20processed)'));}),_0xc10df2>0x0&&_0x32e0a9[_0x299175(0x164)](_0x1b782f['commit']()),console['log'](_0x299175(0x16e)+_0x32e0a9[_0x299175(0x179)]+'\x20batches...'),await Promise['all'](_0x32e0a9),console['log']('üéâ\x20Successfully\x20migrated\x20'+_0x261f49['size']+'\x20members\x20to\x20aggregated\x20collection!'),console['log'](_0x299175(0x163));}catch(_0x49fca4){console['error'](_0x299175(0x16a),_0x49fca4),_0x49fca4['code']==='permission-denied'&&console['error']('üîí\x20Permission\x20denied.\x20Make\x20sure\x20you\x27re\x20signed\x20in\x20as\x20an\x20admin\x20and\x20security\x20rules\x20allow\x20access\x20to\x20aggregatedMembers\x20collection.');}}function getPlayerRank(_0x3e5082){const _0x3a4464=a1_0x3d84;if(_0x3e5082>=0x7d0)return _0x3a4464(0x162);if(_0x3e5082>=0x708)return _0x3a4464(0x15b);if(_0x3e5082>=0x640)return _0x3a4464(0x175);if(_0x3e5082>=0x578)return'bronze';return'unranked';}function a1_0x3d84(_0x59ddec,_0x29a787){const _0x2367d1=a1_0x3ee7();return a1_0x3d84=function(_0x3919ba,_0x5d6b89){_0x3919ba=_0x3919ba-0x15a;let _0x3ee777=_0x2367d1[_0x3919ba];return _0x3ee777;},a1_0x3d84(_0x59ddec,_0x29a787);}migrateToAggregatedMembers();function a1_0x3ee7(){const _0x216f37=['elo','gold','forEach','motto','set','country','get','return\x20(function()\x20','emerald','üí°\x20Refresh\x20your\x20members\x20page\x20to\x20see\x20the\x20results!','push','eloRating','userProfiles','profileImageUrl','trace','log','‚ùå\x20Migration\x20failed:','playersD3','\x20D2,\x20','has','üöÄ\x20Executing\x20','size','ladders','\x20profiles,\x20','{}.constructor(\x22return\x20this\x22)(\x20)','toString','console','silver','data','‚úÖ\x20Data\x20fetched:\x20','üíæ\x20Writing\x20aggregated\x20data...','length','favoriteMap','bind','favoriteWeapon','info','sort'];a1_0x3ee7=function(){return _0x216f37;};return a1_0x3ee7();}
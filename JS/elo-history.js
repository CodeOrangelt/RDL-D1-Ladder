const a16n=a16b;(function(a,b){const m=a16b,c=a();while(!![]){try{const d=parseInt(m(0xe0))/0x1+-parseInt(m(0xd8))/0x2*(-parseInt(m(0xd7))/0x3)+-parseInt(m(0xd5))/0x4*(parseInt(m(0xdb))/0x5)+parseInt(m(0xd1))/0x6+parseInt(m(0xdd))/0x7*(parseInt(m(0xd0))/0x8)+parseInt(m(0xe2))/0x9+-parseInt(m(0xe3))/0xa;if(d===b)break;else c['push'](c['shift']());}catch(e){c['push'](c['shift']());}}}(a16a,0xc04a1));import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS=[{'name':'Gold','elo':0x708},{'name':'Silver','elo':0x640},{'name':'Bronze','elo':0x578},{'name':a16n(0xda),'elo':0x4b0}];function a16b(a,b){const c=a16a();return a16b=function(d,e){d=d-0xcf;let f=c[d];if(a16b['ajCXKg']===undefined){var g=function(l){const m='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let n='',o='';for(let p=0x0,q,r,s=0x0;r=l['charAt'](s++);~r&&(q=p%0x4?q*0x40+r:r,p++%0x4)?n+=String['fromCharCode'](0xff&q>>(-0x2*p&0x6)):0x0){r=m['indexOf'](r);}for(let t=0x0,u=n['length'];t<u;t++){o+='%'+('00'+n['charCodeAt'](t)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(o);};a16b['KzIuhn']=g,a=arguments,a16b['ajCXKg']=!![];}const h=c[0x0],i=d+h,j=a[i];return!j?(f=a16b['KzIuhn'](f),a[i]=f):f=j,f;},a16b(a,b);}async function getUsernameById(a){const o=a16n;try{if(!a)return'Unknown\x20Player';const b=await getDoc(doc(db,'players',a));return b['exists']()?b[o(0xdc)]()[o(0xe4)]:o(0xd6);}catch(c){return console['error']('Error\x20fetching\x20username:',c),o(0xd6);}}export async function recordEloChange({playerId:a,previousElo:b,newElo:c,opponentId:d,matchResult:e,previousPosition:f,newPosition:g,isPromotion:isPromotion=![],isDemotion:isDemotion=![],timestamp:h}){const p=a16n;try{const i=doc(collection(db,'eloHistory'));let j=p(0xe1);if(isPromotion)j=p(0xde);if(isDemotion)j=p(0xd3);let k=p(0xda);if(c>=0x834)k='Emerald';else{if(c>=0x708)k='Gold';else{if(c>=0x640)k='Silver';else{if(c>=0x578)k=p(0xdf);}}}return await setDoc(i,{'type':j,'player':a,'opponent':d,'previousElo':b,'newElo':c,'change':c-b,'matchResult':e,'previousPosition':f,'newPosition':g,'rankAchieved':k,'timestamp':h}),console[p(0xcf)]('ELO\x20history\x20recorded\x20for\x20'+a),!![];}catch(l){console[p(0xd4)](p(0xe7),l);throw l;}}function a16a(){const s=['vw5Yyw5Rzwq','nuXsELnmsq','zgf0yq','nZi0nty0neHqvgDuwG','ChjVBw90Aw9U','qNjVBNPL','mtG0nte2DLviEhLh','Bwf0y2G','ndi0mdq3nNfQqMf0qq','mJq3ntiYnJbUtfrnweu','DxnLCM5HBwu','DgLTzxn0yw1W','rxjYB3iGzMv0y2HPBMCGruXpigHPC3rVCNK6','rxjYB3iGCMvJB3jKAw5NievmtYbOAxn0B3j5oG','BwfW','ywXS','B3bWB25LBNq','Bg9N','oeHgEgDNDq','oduZmJe5oenUs2LrBG','CgXHEwvY','zgvTB3rPB24','zxjYB3i','nta3nJu1nNjRvxfnDa','vw5RBM93BIbqBgf5zxi','mJuWndqZEwLjtKfT','mZrKr2XzAKy','zgvZyW'];a16a=function(){return s;};return a16a();}export async function getEloHistory(){const q=a16n;try{const a=collection(db,'eloHistory'),b=query(a,orderBy('timestamp',q(0xd9))),c=await getDocs(b),d=c['docs'][q(0xe8)](async f=>{const r=q,g=f['data'](),[h,i]=await Promise[r(0xe9)]([getUsernameById(g[r(0xd2)]),getUsernameById(g[r(0xea)])]);return{...g,'playerUsername':h,'opponentUsername':i,'change':g['newElo']-g['previousElo'],'timestamp':g[r(0xe5)]};}),e=await Promise[q(0xe9)](d);return{'entries':e};}catch(f){console[q(0xd4)](q(0xe6),f);throw f;}}export function resetPagination(){lastVisible=null;}
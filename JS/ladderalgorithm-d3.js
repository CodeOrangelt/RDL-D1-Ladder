const a29_0x2d4d8f=(function(){let _0xe64153=!![];return function(_0xd2cf53,_0x1db775){const _0x3ab588=_0xe64153?function(){if(_0x1db775){const _0x35a1ba=_0x1db775['apply'](_0xd2cf53,arguments);return _0x1db775=null,_0x35a1ba;}}:function(){};return _0xe64153=![],_0x3ab588;};}()),a29_0x387ab7=a29_0x2d4d8f(this,function(){const _0x701710=a29_0x1f4a;let _0x5c75e3;try{const _0x104192=Function(_0x701710(0x1d0)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x5c75e3=_0x104192();}catch(_0x5c86c4){_0x5c75e3=window;}const _0xc2a436=_0x5c75e3[_0x701710(0x1c8)]=_0x5c75e3['console']||{},_0x75b999=[_0x701710(0x1c3),'warn',_0x701710(0x1bc),_0x701710(0x1d2),'exception','table',_0x701710(0x1bf)];for(let _0x4aea1a=0x0;_0x4aea1a<_0x75b999['length'];_0x4aea1a++){const _0x37ae23=a29_0x2d4d8f['constructor']['prototype']['bind'](a29_0x2d4d8f),_0x2b12b2=_0x75b999[_0x4aea1a],_0xe99cf4=_0xc2a436[_0x2b12b2]||_0x37ae23;_0x37ae23['__proto__']=a29_0x2d4d8f['bind'](a29_0x2d4d8f),_0x37ae23['toString']=_0xe99cf4['toString'][_0x701710(0x1cb)](_0xe99cf4),_0xc2a436[_0x2b12b2]=_0x37ae23;}});a29_0x387ab7();function a29_0x1387(){const _0x50804e=['loserUsername','playersD3','info','username','Only\x20the\x20winner\x20can\x20approve\x20D3\x20matches','trace','update','round','D3\x20Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions','log','D3\x20Report\x20not\x20found\x20with\x20ID:','eloRating','Could\x20not\x20find\x20D3\x20player\x20documents','pow','console','D3\x20ELO\x20ratings\x20updated\x20successfully','docs','bind','winnerUsername','data','commit','position','return\x20(function()\x20','createdAt','error'];a29_0x1387=function(){return _0x50804e;};return a29_0x1387();}import{addDoc,updateDoc,serverTimestamp,collection,doc,getDoc,getDocs,query,where,setDoc,deleteDoc,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';import{recordEloChangeD3}from'./elo-history-d3.js';function a29_0x1f4a(_0x25d4e4,_0x2fba94){const _0x387ab7=a29_0x1387();return a29_0x1f4a=function(_0x2d4d8f,_0x1ddc40){_0x2d4d8f=_0x2d4d8f-0x1ba;let _0x1387bb=_0x387ab7[_0x2d4d8f];return _0x1387bb;},a29_0x1f4a(_0x25d4e4,_0x2fba94);}export function calculateEloD3(_0x404b40,_0x1220d6,_0x89c3b5=0x20){const _0x5ada0e=a29_0x1f4a,_0x49e944=0x1/(0x1+Math['pow'](0xa,(_0x1220d6-_0x404b40)/0x190)),_0x32dc94=0x1/(0x1+Math[_0x5ada0e(0x1c7)](0xa,(_0x404b40-_0x1220d6)/0x190)),_0x26a997=_0x404b40+_0x89c3b5*(0x1-_0x49e944),_0x247698=_0x1220d6+_0x89c3b5*(0x0-_0x32dc94);return{'newWinnerRating':Math[_0x5ada0e(0x1c1)](_0x26a997),'newLoserRating':Math[_0x5ada0e(0x1c1)](_0x247698)};}export async function updateEloRatingsD3(_0x1045ab,_0xe50837,_0x4ff849){const _0xfbf635=a29_0x1f4a;try{const _0x1c1da9=writeBatch(db),_0x3bb673=doc(db,'playersD3',_0x1045ab),_0x467a15=doc(db,_0xfbf635(0x1bb),_0xe50837),[_0x5c7ad4,_0x4494c0]=await Promise['all']([getDoc(_0x3bb673),getDoc(_0x467a15)]);if(!_0x5c7ad4['exists']()||!_0x4494c0['exists']())throw new Error('One\x20or\x20both\x20D3\x20players\x20not\x20found');const _0xf152a=_0x5c7ad4['data'](),_0x49c96f=_0x4494c0['data'](),_0x40c77d=_0xf152a['position']||Number['MAX_SAFE_INTEGER'],_0x51fe4c=_0x49c96f[_0xfbf635(0x1cf)]||Number['MAX_SAFE_INTEGER'],{newWinnerRating:_0x9fbdfb,newLoserRating:_0x228a31}=calculateEloD3(_0xf152a[_0xfbf635(0x1c5)]||0x4b0,_0x49c96f['eloRating']||0x4b0);let _0x59c7a8=_0x40c77d,_0x543049=_0x51fe4c;if(_0x40c77d>_0x51fe4c){console['log']('D3\x20Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked'),_0x59c7a8=_0x51fe4c,_0x543049=_0x51fe4c+0x1;const _0x2f206d=query(collection(db,'playersD3'),where('position','>',_0x51fe4c),where(_0xfbf635(0x1cf),'<',_0x40c77d)),_0x341a93=await getDocs(_0x2f206d);for(const _0x3e48e3 of _0x341a93[_0xfbf635(0x1ca)]){_0x3e48e3['id']!==_0x1045ab&&_0x3e48e3['id']!==_0xe50837&&_0x1c1da9['update'](doc(db,'playersD3',_0x3e48e3['id']),{'position':_0x3e48e3[_0xfbf635(0x1cd)]()['position']+0x1});}}else console[_0xfbf635(0x1c3)](_0xfbf635(0x1c2));return _0x1c1da9['update'](_0x3bb673,{'eloRating':_0x9fbdfb,'lastMatchDate':serverTimestamp(),'position':_0x59c7a8,'lastMatchId':_0x4ff849}),_0x1c1da9[_0xfbf635(0x1c0)](_0x467a15,{'eloRating':_0x228a31,'lastMatchDate':serverTimestamp(),'position':_0x543049,'lastMatchId':_0x4ff849}),await _0x1c1da9[_0xfbf635(0x1ce)](),console[_0xfbf635(0x1c3)](_0xfbf635(0x1c9)),await Promise['all']([recordEloChangeD3({'playerId':_0x1045ab,'previousElo':_0xf152a['eloRating']||0x4b0,'newElo':_0x9fbdfb,'opponentId':_0xe50837,'matchResult':'win','previousPosition':_0x40c77d,'newPosition':_0x59c7a8,'isPromotion':_0x59c7a8<_0x40c77d,'matchId':_0x4ff849,'timestamp':serverTimestamp()}),recordEloChangeD3({'playerId':_0xe50837,'previousElo':_0x49c96f[_0xfbf635(0x1c5)]||0x4b0,'newElo':_0x228a31,'opponentId':_0x1045ab,'matchResult':'loss','previousPosition':_0x51fe4c,'newPosition':_0x543049,'isDemotion':_0x543049>_0x51fe4c,'matchId':_0x4ff849,'timestamp':serverTimestamp()})]),!![];}catch(_0x5523f9){console['error']('Error\x20in\x20updateEloRatingsD3:',_0x5523f9);throw _0x5523f9;}}export async function approveReportD3(_0x5015f1,_0x206c52,_0x28cd21,_0x2dae3d){const _0x5da297=a29_0x1f4a;try{console[_0x5da297(0x1c3)]('Starting\x20approveReportD3\x20function\x20with:',{'reportId':_0x5015f1,'winnerScore':_0x206c52,'winnerSuicides':_0x28cd21,'winnerComment':_0x2dae3d});const _0x1e5efd=auth['currentUser'];if(!_0x1e5efd){console['log']('No\x20user\x20logged\x20in');throw new Error('You\x20must\x20be\x20logged\x20in\x20to\x20approve\x20D3\x20matches');}console['log']('Current\x20user:',_0x1e5efd['email']);const _0x120e93=await getDoc(doc(db,_0x5da297(0x1bb),_0x1e5efd['uid'])),_0xb2eeef=_0x120e93['exists']()?_0x120e93[_0x5da297(0x1cd)]()['username']:null;console[_0x5da297(0x1c3)]('Current\x20username:',_0xb2eeef);const _0x50faff=doc(db,'pendingMatchesD3',_0x5015f1),_0x5268c1=await getDoc(_0x50faff);if(!_0x5268c1['exists']()){console[_0x5da297(0x1c3)](_0x5da297(0x1c4),_0x5015f1);throw new Error('D3\x20match\x20report\x20not\x20found');}const _0x5062f7=_0x5268c1['data']();console['log']('D3\x20Report\x20data:',_0x5062f7);if(_0xb2eeef!==_0x5062f7['winnerUsername'])throw new Error(_0x5da297(0x1be));const _0x865419={..._0x5062f7,'winnerScore':_0x206c52,'winnerSuicides':_0x28cd21,'winnerComment':_0x2dae3d,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':_0xb2eeef,'createdAt':_0x5062f7[_0x5da297(0x1d1)]||serverTimestamp(),'winnerUsername':_0x5062f7['winnerUsername'],'loserUsername':_0x5062f7['loserUsername']};await setDoc(doc(db,'approvedMatchesD3',_0x5015f1),_0x865419),await deleteDoc(_0x50faff),console['log']('D3\x20Match\x20moved\x20to\x20approved\x20collection');const [_0x297139,_0x23da40]=await Promise['all']([getDocs(query(collection(db,'playersD3'),where('username','==',_0x5062f7[_0x5da297(0x1cc)]))),getDocs(query(collection(db,_0x5da297(0x1bb)),where(_0x5da297(0x1bd),'==',_0x5062f7[_0x5da297(0x1ba)])))]);if(_0x297139['empty']||_0x23da40['empty'])throw new Error(_0x5da297(0x1c6));const _0x1f28b7=_0x297139['docs'][0x0]['id'],_0x5767ed=_0x23da40['docs'][0x0]['id'];return await updateEloRatingsD3(_0x1f28b7,_0x5767ed,_0x5015f1),console[_0x5da297(0x1c3)]('D3\x20Match\x20successfully\x20approved\x20and\x20ELO\x20updated'),!![];}catch(_0x379472){console['error']('Error\x20in\x20approveReportD3:',_0x379472);throw _0x379472;}}
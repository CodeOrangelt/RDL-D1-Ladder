const a10_0x2bb86e=a10_0x2354,a10_0x1b798f=(function(){let _0x1df8e7=!![];return function(_0x4331ac,_0x1fbad1){const _0x1bec45=_0x1df8e7?function(){if(_0x1fbad1){const _0xd4c433=_0x1fbad1['apply'](_0x4331ac,arguments);return _0x1fbad1=null,_0xd4c433;}}:function(){};return _0x1df8e7=![],_0x1bec45;};}()),a10_0x174761=a10_0x1b798f(this,function(){const _0x52d10c=a10_0x2354,_0x11a388=function(){let _0x338483;try{_0x338483=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x5e7d92){_0x338483=window;}return _0x338483;},_0x507db7=_0x11a388(),_0x4d610b=_0x507db7['console']=_0x507db7[_0x52d10c(0x1d5)]||{},_0x1a8949=[_0x52d10c(0x1bb),_0x52d10c(0x1b1),'info','error',_0x52d10c(0x1bf),_0x52d10c(0x1d7),'trace'];for(let _0xd2acff=0x0;_0xd2acff<_0x1a8949[_0x52d10c(0x1b3)];_0xd2acff++){const _0x15a69f=a10_0x1b798f[_0x52d10c(0x1d6)]['prototype'][_0x52d10c(0x1c5)](a10_0x1b798f),_0x2777c2=_0x1a8949[_0xd2acff],_0x243f83=_0x4d610b[_0x2777c2]||_0x15a69f;_0x15a69f[_0x52d10c(0x1d4)]=a10_0x1b798f[_0x52d10c(0x1c5)](a10_0x1b798f),_0x15a69f['toString']=_0x243f83['toString']['bind'](_0x243f83),_0x4d610b[_0x2777c2]=_0x15a69f;}});a10_0x174761();import{getAuth,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';function a10_0x2354(_0x25c99c,_0x70560c){const _0x174761=a10_0x2727();return a10_0x2354=function(_0x1b798f,_0x46a738){_0x1b798f=_0x1b798f-0x1af;let _0x272735=_0x174761[_0x1b798f];return _0x272735;},a10_0x2354(_0x25c99c,_0x70560c);}import{doc,getDoc,collection,query,where,getDocs,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import{isAdmin}from'./admin-check.js';const ADMIN_EMAILS=[a10_0x2bb86e(0x1bd),'Brian2af@outlook.com'],userCache={'uid':null,'username':null,'isAdmin':![],'hasCheckedCollections':![],'lastChecked':0x0,'role':null},invitationCache={'lastCheck':0x0,'pendingCount':0x0,'checkInterval':0x493e0};function updateInboxNotification(_0xa5d337){const _0x366198=a10_0x2bb86e,_0x4082e1=document['getElementById']('inbox-notification');_0x4082e1&&(_0xa5d337>0x0?(_0x4082e1['style']['display']='inline-block',_0x4082e1[_0x366198(0x1d9)]=_0xa5d337>0x9?'9+':_0xa5d337):_0x4082e1['style']['display']='none');}async function checkPendingInvitationsForCurrentUser(_0x19d561){const _0xbfcd82=a10_0x2bb86e;try{const _0x3f09bb=Date['now']();if(_0x3f09bb-invitationCache['lastCheck']<invitationCache['checkInterval'])return updateInboxNotification(invitationCache['pendingCount']),invitationCache[_0xbfcd82(0x1d1)];invitationCache['lastCheck']=_0x3f09bb;const _0x544043=collection(db,'gameInvitations'),_0x41e9f0=query(_0x544043,where('toUserId','==',_0x19d561),where('status','==','pending'),limit(0x5)),_0x1a9bea=await getDocs(_0x41e9f0),_0x56e86f=_0x1a9bea['size'];return invitationCache[_0xbfcd82(0x1d1)]=_0x56e86f,updateInboxNotification(_0x56e86f),_0x56e86f;}catch(_0x23afea){return console[_0xbfcd82(0x1b1)](_0xbfcd82(0x1d8),_0x23afea),0x0;}}function updateAuthSectionImmediate(_0xc466f8,_0x1e5b74=![]){const _0x3d89b2=a10_0x2bb86e,_0x43b8a5=document['getElementById']('auth-section');if(!_0x43b8a5)return;if(_0xc466f8&&_0x1e5b74)document['querySelectorAll'](_0x3d89b2(0x1d3))[_0x3d89b2(0x1b8)](_0x3a2fa4=>{_0x3a2fa4['style']['display']='block';});else!_0xc466f8&&document['querySelectorAll']('.admin-only')[_0x3d89b2(0x1b8)](_0x55d3cc=>{_0x55d3cc['style']['display']='none';});if(_0xc466f8){const _0x2ce2c4=userCache['username']||(_0xc466f8['email']?_0xc466f8['email']['split']('@')[0x0]:'User'),_0x71bcb8=userCache['role']?'\x20('+userCache['role']+')':_0x1e5b74?'\x20(Admin)':'';_0x43b8a5['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20class=\x22nav-username\x22>'+_0x2ce2c4+_0x71bcb8+'</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username='+encodeURIComponent(_0x2ce2c4)+'\x22>Profile</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./inbox.html\x22\x20class=\x22nav-notification\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Inbox\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22inbox-notification\x22\x20class=\x22notification-dot\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22members.html\x22>Members</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./redeem.html\x22><i\x20class=\x22fas\x20fa-gift\x22></i>Store</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20id=\x22logout-link\x22>Sign\x20Out</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';const _0x30a97a=document[_0x3d89b2(0x1ce)]('logout-link');_0x30a97a&&_0x30a97a['addEventListener']('click',_0x2add6b=>{const _0x5593fc=_0x3d89b2;_0x2add6b[_0x5593fc(0x1af)]();const _0x2dec88=getAuth();updateAuthSectionImmediate(null),_0x2dec88['signOut']()[_0x5593fc(0x1bc)](_0x37c430=>{console['error']('Error\x20signing\x20out:',_0x37c430);});}),_0xc466f8['uid']&&setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0xc466f8['uid']);},0x3e8);}else _0x43b8a5['innerHTML']='<a\x20href=\x22login.html\x22\x20class=\x22login-link\x22>Login</a>';}function a10_0x2727(){const _0x547734=['preventDefault','isAdmin','warn','lastChecked','length','nonParticipants','slice','playersD2','uid','forEach','style','block','log','catch','admin@ladder.com','admin','exception','hasCheckedCollections','role','error','Error\x20in\x20checkAdminRoles:','click','bind','council','currentUser','now','data','playersCTF','\x20in\x20','toLowerCase','display','getElementById','Error\x20checking\x20','filter','pendingCount','email','.admin-only','__proto__','console','constructor','table','Could\x20not\x20check\x20pending\x20invitations\x20for\x20current\x20user:','textContent','roleName','Error\x20in\x20full\x20auth\x20update:','split'];a10_0x2727=function(){return _0x547734;};return a10_0x2727();}async function checkAdminRoles(_0x53ea54){const _0x210be0=a10_0x2bb86e;if(!_0x53ea54||!_0x53ea54['email'])return{'isAdmin':![],'role':null};try{console[_0x210be0(0x1bb)]('Checking\x20roles\x20for\x20user:\x20'+_0x53ea54['email']);const _0x56a342=['players',_0x210be0(0x1b6),'playersD3',_0x210be0(0x1b4),'userProfiles'],_0xa56b34=[_0x210be0(0x1c6),'creative\x20lead','owner',_0x210be0(0x1be)];for(const _0x150123 of _0x56a342){try{const _0x3df553=doc(db,_0x150123,_0x53ea54['uid']),_0x2f1ff1=await getDoc(_0x3df553);if(_0x2f1ff1['exists']()){const _0x5e2c56=_0x2f1ff1['data']();console['log']('Found\x20user\x20in\x20'+_0x150123+'\x20by\x20UID:',_0x5e2c56);let _0x5bf7e8=(_0x5e2c56['roleName']||_0x5e2c56[_0x210be0(0x1c1)]||'')['toLowerCase'](),_0x271375=_0x5e2c56['roleName']||_0x5e2c56['role']||'';if(_0x5bf7e8&&_0xa56b34['includes'](_0x5bf7e8)){console[_0x210be0(0x1bb)]('Found\x20admin\x20role:\x20'+_0x5bf7e8+_0x210be0(0x1cb)+_0x150123);const _0x17edb2=_0x271375['split']('\x20')['map'](_0x26584b=>_0x26584b['charAt'](0x0)['toUpperCase']()+_0x26584b['slice'](0x1)['toLowerCase']())['join']('\x20');return{'isAdmin':!![],'role':_0x17edb2};}}}catch(_0x22d7ea){console[_0x210be0(0x1c2)](_0x210be0(0x1cf)+_0x150123+'\x20by\x20UID:',_0x22d7ea);}}for(const _0x52117c of _0x56a342){try{const _0x3395ec=collection(db,_0x52117c);let _0x19c7f=query(_0x3395ec,where('email','==',_0x53ea54[_0x210be0(0x1d2)])),_0x4f1096=await getDocs(_0x19c7f);_0x4f1096['empty']&&(_0x19c7f=query(_0x3395ec,where('email','==',_0x53ea54['email']['toLowerCase']())),_0x4f1096=await getDocs(_0x19c7f));if(!_0x4f1096['empty']){const _0x19ecfd=_0x4f1096['docs'][0x0]['data']();console['log']('Found\x20user\x20in\x20'+_0x52117c+'\x20by\x20email:',_0x19ecfd);let _0xf5e1b4=(_0x19ecfd['roleName']||_0x19ecfd['role']||'')[_0x210be0(0x1cc)](),_0x1abd1c=_0x19ecfd[_0x210be0(0x1da)]||_0x19ecfd['role']||'';if(_0xf5e1b4&&_0xa56b34['includes'](_0xf5e1b4)){console[_0x210be0(0x1bb)]('Found\x20admin\x20role:\x20'+_0xf5e1b4+'\x20in\x20'+_0x52117c);const _0x50fc4b=_0x1abd1c[_0x210be0(0x1dc)]('\x20')['map'](_0x486d63=>_0x486d63['charAt'](0x0)['toUpperCase']()+_0x486d63[_0x210be0(0x1b5)](0x1)['toLowerCase']())['join']('\x20');return{'isAdmin':!![],'role':_0x50fc4b};}}}catch(_0x28af9c){console[_0x210be0(0x1c2)](_0x210be0(0x1cf)+_0x52117c+'\x20by\x20email:',_0x28af9c);}}return console[_0x210be0(0x1bb)]('No\x20admin\x20roles\x20found\x20for\x20user'),{'isAdmin':![],'role':null};}catch(_0x202122){return console[_0x210be0(0x1c2)](_0x210be0(0x1c3),_0x202122),{'isAdmin':![],'role':null};}}async function updateAuthSection(_0x3573da){const _0x1113e3=a10_0x2bb86e,_0x370d1c=_0x3573da&&isAdmin(_0x3573da['email']);updateAuthSectionImmediate(_0x3573da,_0x370d1c);if(!_0x3573da){userCache['uid']=null,userCache['username']=null,userCache['isAdmin']=![],userCache['hasCheckedCollections']=![],userCache['role']=null;return;}const _0x4553ce=Date[_0x1113e3(0x1c8)]();if(_0x3573da[_0x1113e3(0x1b7)]===userCache['uid']&&userCache['hasCheckedCollections']&&_0x4553ce-userCache[_0x1113e3(0x1b2)]<0x493e0)return;try{userCache['uid']=_0x3573da['uid'],userCache['lastChecked']=_0x4553ce;const _0x14f347=isAdmin(_0x3573da[_0x1113e3(0x1d2)]);userCache['isAdmin']=_0x14f347;if(!_0x14f347){const {isAdmin:_0x8d53da,role:_0x241513}=await checkAdminRoles(_0x3573da);userCache['isAdmin']=_0x8d53da,userCache[_0x1113e3(0x1c1)]=_0x241513,_0x8d53da&&(document['querySelectorAll']('.admin-only')['forEach'](_0x3540c8=>{const _0x219998=_0x1113e3;_0x3540c8[_0x219998(0x1b9)][_0x219998(0x1cd)]=_0x219998(0x1ba);}),updateAuthSectionImmediate(_0x3573da,!![]));}const _0x3a4a5f=['players','playersD2','playersD3','playersDuos',_0x1113e3(0x1ca),'nonParticipants','userProfiles'],_0x343db0=_0x3a4a5f['map'](_0x43d656=>getDoc(doc(db,_0x43d656,_0x3573da[_0x1113e3(0x1b7)]))['then'](_0x40b84a=>_0x40b84a['exists']()?{'collection':_0x43d656,'data':_0x40b84a['data']()}:null)[_0x1113e3(0x1bc)](()=>null)),_0x387036=await Promise['all'](_0x343db0),_0x46a118=_0x387036[_0x1113e3(0x1d0)](_0x4ba817=>_0x4ba817!==null);let _0x3b2951=null;for(const _0x2accf0 of _0x46a118){if(_0x2accf0['data']['username']){_0x3b2951=_0x2accf0[_0x1113e3(0x1c9)]['username'];break;}}userCache['username']=_0x3b2951||(_0x3573da['email']?_0x3573da['email']['split']('@')[0x0]:'User'),userCache[_0x1113e3(0x1c0)]=!![],updateAuthSectionImmediate(_0x3573da,userCache[_0x1113e3(0x1b0)]),setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0x3573da['uid']);},0x1f4);}catch(_0x2838ff){console['error'](_0x1113e3(0x1db),_0x2838ff);}}document['addEventListener']('DOMContentLoaded',()=>{const _0x2f1a2e=a10_0x2bb86e,_0x376a71=getAuth();onAuthStateChanged(_0x376a71,async _0x580c80=>{await updateAuthSection(_0x580c80),_0x580c80&&checkPendingInvitationsForCurrentUser(_0x580c80['uid']);}),document['addEventListener']('visibilitychange',()=>{!document['hidden']&&_0x376a71['currentUser']&&checkPendingInvitationsForCurrentUser(_0x376a71['currentUser']['uid']);}),document['addEventListener'](_0x2f1a2e(0x1c4),_0x321916=>{const _0x490481=_0x2f1a2e;_0x321916['target']['closest']('a[href]')&&_0x376a71['currentUser']&&checkPendingInvitationsForCurrentUser(_0x376a71[_0x490481(0x1c7)][_0x490481(0x1b7)]);});});export{updateAuthSection};
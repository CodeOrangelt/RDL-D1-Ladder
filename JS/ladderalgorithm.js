function a30_0x2052(_0x27d36b,_0x4ce94e){const _0x4c27ff=a30_0x5e7d();return a30_0x2052=function(_0x2880a1,_0x535912){_0x2880a1=_0x2880a1-0x15a;let _0x11b9fc=_0x4c27ff[_0x2880a1];return _0x11b9fc;},a30_0x2052(_0x27d36b,_0x4ce94e);}(function(_0xf7e162,_0x9341c){const _0x11fa7c=a30_0x2052,_0x6fe450=_0xf7e162();while(!![]){try{const _0x5b5c0a=parseInt(_0x11fa7c(0x192))/0x1*(parseInt(_0x11fa7c(0x167))/0x2)+-parseInt(_0x11fa7c(0x199))/0x3+parseInt(_0x11fa7c(0x190))/0x4+parseInt(_0x11fa7c(0x197))/0x5*(-parseInt(_0x11fa7c(0x19e))/0x6)+parseInt(_0x11fa7c(0x164))/0x7*(-parseInt(_0x11fa7c(0x18d))/0x8)+parseInt(_0x11fa7c(0x15a))/0x9*(-parseInt(_0x11fa7c(0x18e))/0xa)+parseInt(_0x11fa7c(0x19b))/0xb;if(_0x5b5c0a===_0x9341c)break;else _0x6fe450['push'](_0x6fe450['shift']());}catch(_0x3772d3){_0x6fe450['push'](_0x6fe450['shift']());}}}(a30_0x5e7d,0x29840));const a30_0xcb88db=(function(){let _0x17c5d2=!![];return function(_0x593c1a,_0x1ffcca){const _0x230135=_0x17c5d2?function(){if(_0x1ffcca){const _0x1f75e7=_0x1ffcca['apply'](_0x593c1a,arguments);return _0x1ffcca=null,_0x1f75e7;}}:function(){};return _0x17c5d2=![],_0x230135;};}()),a30_0x265d69=a30_0xcb88db(this,function(){const _0x4fd34f=a30_0x2052;return a30_0x265d69['toString']()[_0x4fd34f(0x165)]('(((.+)+)+)+$')['toString']()[_0x4fd34f(0x171)](a30_0x265d69)[_0x4fd34f(0x165)](_0x4fd34f(0x183));});a30_0x265d69();const a30_0x535912=(function(){let _0x27b925=!![];return function(_0x11807d,_0x3f46ff){const _0x2c2554=_0x27b925?function(){const _0x2cd242=a30_0x2052;if(_0x3f46ff){const _0x4fec1a=_0x3f46ff[_0x2cd242(0x168)](_0x11807d,arguments);return _0x3f46ff=null,_0x4fec1a;}}:function(){};return _0x27b925=![],_0x2c2554;};}()),a30_0x2880a1=a30_0x535912(this,function(){const _0x7eb95a=a30_0x2052;let _0xe08f4;try{const _0x2320b2=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0xe08f4=_0x2320b2();}catch(_0x25ebb4){_0xe08f4=window;}const _0x2506a5=_0xe08f4[_0x7eb95a(0x185)]=_0xe08f4[_0x7eb95a(0x185)]||{},_0x201e82=[_0x7eb95a(0x19f),'warn',_0x7eb95a(0x16a),_0x7eb95a(0x1a0),'exception',_0x7eb95a(0x181),_0x7eb95a(0x160)];for(let _0x42267f=0x0;_0x42267f<_0x201e82[_0x7eb95a(0x195)];_0x42267f++){const _0x53b88b=a30_0x535912[_0x7eb95a(0x171)][_0x7eb95a(0x19d)][_0x7eb95a(0x174)](a30_0x535912),_0x5e6c6b=_0x201e82[_0x42267f],_0x1555e2=_0x2506a5[_0x5e6c6b]||_0x53b88b;_0x53b88b[_0x7eb95a(0x194)]=a30_0x535912[_0x7eb95a(0x174)](a30_0x535912),_0x53b88b[_0x7eb95a(0x180)]=_0x1555e2[_0x7eb95a(0x180)][_0x7eb95a(0x174)](_0x1555e2),_0x2506a5[_0x5e6c6b]=_0x53b88b;}});a30_0x2880a1();import{collection,doc,getDoc,getDocs,updateDoc,setDoc,deleteDoc,writeBatch,query,where,serverTimestamp,addDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';import{recordEloChange}from'./elo-history.js';import{promotionManager,checkAndRecordPromotion}from'./promotions.js';import{isAdmin}from'./admin-check.js';export function calculateElo(_0x4fae89,_0x58c4cd,_0x37b398=0x20){const _0x361dba=a30_0x2052,_0x173442=0x1/(0x1+Math[_0x361dba(0x170)](0xa,(_0x58c4cd-_0x4fae89)/0x190)),_0x8bceb8=0x1/(0x1+Math[_0x361dba(0x170)](0xa,(_0x4fae89-_0x58c4cd)/0x190)),_0xa7c9e5=_0x4fae89+_0x37b398*(0x1-_0x173442),_0x2014b5=_0x58c4cd+_0x37b398*(0x0-_0x8bceb8);return{'newWinnerRating':Math[_0x361dba(0x179)](_0xa7c9e5),'newLoserRating':Math[_0x361dba(0x179)](_0x2014b5)};}export function assignDefaultEloRating(_0x4da9f0,_0x5c1206){const _0x19e2eb=a30_0x2052,_0x4857d9=0x4b0;!_0x5c1206[_0x19e2eb(0x18b)]&&db[_0x19e2eb(0x15e)](_0x19e2eb(0x15c))[_0x19e2eb(0x177)](_0x4da9f0)[_0x19e2eb(0x169)]({'eloRating':_0x4857d9})[_0x19e2eb(0x186)](()=>{const _0x4fa548=_0x19e2eb;console[_0x4fa548(0x19f)]('Assigned\x20default\x20ELO\x20rating\x20to\x20player\x20'+_0x5c1206['username']);})[_0x19e2eb(0x18f)](_0xb6256b=>{console['error']('Error\x20assigning\x20default\x20ELO\x20rating:',_0xb6256b);});}export async function updateEloRatings(_0x4410d1,_0x10c150,_0x23b844){const _0x3fd461=a30_0x2052;try{const _0x536d28=writeBatch(db),_0x44c2ba=doc(db,_0x3fd461(0x15c),_0x4410d1),_0x8997e2=doc(db,'players',_0x10c150),[_0x586833,_0x56a29d]=await Promise[_0x3fd461(0x176)]([getDoc(_0x44c2ba),getDoc(_0x8997e2)]);if(!_0x586833['exists']()||!_0x56a29d['exists']())throw new Error(_0x3fd461(0x16f));const _0x1f75f7=_0x586833['data'](),_0x2838ad=_0x56a29d[_0x3fd461(0x173)](),_0x279ca8=_0x1f75f7[_0x3fd461(0x161)]||Number['MAX_SAFE_INTEGER'],_0x3633b2=_0x2838ad[_0x3fd461(0x161)]||Number[_0x3fd461(0x172)],{newWinnerRating:_0x2975f5,newLoserRating:_0x3f97d2}=calculateElo(_0x1f75f7[_0x3fd461(0x18b)]||0x4b0,_0x2838ad[_0x3fd461(0x18b)]||0x4b0);let _0x4ead94=_0x279ca8,_0x4468b6=_0x3633b2;if(_0x279ca8>_0x3633b2){console[_0x3fd461(0x19f)](_0x3fd461(0x15d)),_0x4ead94=_0x3633b2,_0x4468b6=_0x3633b2+0x1;const _0x135afd=query(collection(db,_0x3fd461(0x15c)),where(_0x3fd461(0x161),'>',_0x3633b2),where(_0x3fd461(0x161),'<',_0x279ca8)),_0x2926a8=await getDocs(_0x135afd);for(const _0x58f14e of _0x2926a8['docs']){_0x58f14e['id']!==_0x4410d1&&_0x58f14e['id']!==_0x10c150&&_0x536d28[_0x3fd461(0x169)](doc(db,_0x3fd461(0x15c),_0x58f14e['id']),{'position':_0x58f14e['data']()['position']+0x1});}}else console[_0x3fd461(0x19f)](_0x3fd461(0x196));const _0x2191d4={'eloRating':_0x2975f5,'lastMatchDate':serverTimestamp(),'position':_0x4ead94,'lastMatchId':_0x23b844},_0x16a69a={'eloRating':_0x3f97d2,'lastMatchDate':serverTimestamp(),'position':_0x4468b6,'lastMatchId':_0x23b844};return _0x536d28['update'](_0x44c2ba,_0x2191d4),_0x536d28[_0x3fd461(0x169)](_0x8997e2,_0x16a69a),await _0x536d28[_0x3fd461(0x15f)](),console[_0x3fd461(0x19f)](_0x3fd461(0x187)),await Promise['all']([recordEloChange({'playerId':_0x4410d1,'previousElo':_0x1f75f7['eloRating']||0x4b0,'newElo':_0x2975f5,'opponentId':_0x10c150,'matchResult':'win','previousPosition':_0x279ca8,'newPosition':_0x4ead94,'isPromotion':_0x4ead94<_0x279ca8,'matchId':_0x23b844,'timestamp':serverTimestamp()}),recordEloChange({'playerId':_0x10c150,'previousElo':_0x2838ad[_0x3fd461(0x18b)]||0x4b0,'newElo':_0x3f97d2,'opponentId':_0x4410d1,'matchResult':_0x3fd461(0x193),'previousPosition':_0x3633b2,'newPosition':_0x4468b6,'isDemotion':_0x4468b6>_0x3633b2,'matchId':_0x23b844,'timestamp':serverTimestamp()})]),await promotionManager[_0x3fd461(0x16c)](_0x4410d1,_0x2975f5,_0x1f75f7[_0x3fd461(0x18b)],{'source':_0x3fd461(0x162),'matchId':_0x23b844}),await promotionManager[_0x3fd461(0x16c)](_0x10c150,_0x3f97d2,_0x2838ad['eloRating'],{'source':_0x3fd461(0x162),'matchId':_0x23b844}),console['log'](_0x3fd461(0x16b)),!![];}catch(_0x2c48c2){console['error']('Error\x20in\x20updateEloRatings:',_0x2c48c2);throw _0x2c48c2;}}export async function approveReport(_0x39d747,_0x55c158,_0x5de9f3,_0x13c4a1,_0xc90c11){const _0x415277=a30_0x2052;try{const _0x18a243=doc(db,_0x415277(0x17e),_0x39d747),_0x28a811=await getDoc(_0x18a243);if(!_0x28a811['exists']())throw new Error(_0x415277(0x182));const _0x48d823=_0x28a811[_0x415277(0x173)](),_0x1493d3={..._0x48d823,'winnerScore':_0x55c158,'winnerSuicides':_0x5de9f3,'winnerComment':_0x13c4a1,'winnerDemoLink':_0xc90c11,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':auth[_0x415277(0x15b)]['uid']};await setDoc(doc(db,_0x415277(0x19a),_0x39d747),_0x1493d3),await deleteDoc(_0x18a243),console['log'](_0x415277(0x16d));const [_0x1f17ac,_0xad8442]=await Promise[_0x415277(0x176)]([getDocs(query(collection(db,'players'),where(_0x415277(0x17d),'==',_0x48d823[_0x415277(0x184)]))),getDocs(query(collection(db,_0x415277(0x15c)),where(_0x415277(0x17d),'==',_0x48d823[_0x415277(0x18c)])))]);if(_0x1f17ac[_0x415277(0x17a)]||_0xad8442[_0x415277(0x17a)])throw new Error(_0x415277(0x17b));const _0x39aa6a=_0x1f17ac[_0x415277(0x198)][0x0]['id'],_0x1fae15=_0xad8442[_0x415277(0x198)][0x0]['id'];return await updateEloRatings(_0x39aa6a,_0x1fae15,_0x39d747),console['log'](_0x415277(0x18a)),!![];}catch(_0x178d66){console[_0x415277(0x1a0)]('Error\x20approving\x20report:',_0x178d66);throw _0x178d66;}}async function updatePlayerElo(_0x279fa8,_0x3be68b,_0x490145){const _0x575857=a30_0x2052;await setDoc(doc(db,_0x575857(0x15c),_0x279fa8),{...playerData,'eloRating':_0x490145}),await checkAndRecordPromotion(_0x279fa8,_0x490145,_0x3be68b);}async function updatePlayerStats(_0x189b9b,_0x56c515,_0x12bb83){const _0x2c52d1=a30_0x2052,_0x24a108=doc(db,'playerStats',_0x189b9b),_0x507305=await getDoc(_0x24a108);let _0x279174=_0x507305[_0x2c52d1(0x163)]()?_0x507305[_0x2c52d1(0x173)]():{'wins':0x0,'losses':0x0,'totalKills':0x0,'totalDeaths':0x0,'winRate':0x0};_0x12bb83?(_0x279174['wins']++,_0x279174[_0x2c52d1(0x188)]+=parseInt(_0x56c515[_0x2c52d1(0x191)]||0x0),_0x279174['totalDeaths']+=parseInt(_0x56c515['loserScore']||0x0)):(_0x279174[_0x2c52d1(0x166)]++,_0x279174[_0x2c52d1(0x188)]+=parseInt(_0x56c515[_0x2c52d1(0x189)]||0x0),_0x279174[_0x2c52d1(0x19c)]+=parseInt(_0x56c515['winnerScore']||0x0));const _0x22179b=_0x279174['wins']+_0x279174[_0x2c52d1(0x166)];_0x279174[_0x2c52d1(0x178)]=_0x22179b>0x0?(_0x279174[_0x2c52d1(0x16e)]/_0x22179b*0x64)[_0x2c52d1(0x175)](0x1):0x0,_0x279174[_0x2c52d1(0x17c)]=new Date()[_0x2c52d1(0x17f)](),await setDoc(_0x24a108,_0x279174,{'merge':!![]});}function a30_0x5e7d(){const _0x2eae2a=['9cnoljr','currentUser','players','Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked','collection','commit','trace','position','match','exists','14273Fvpkla','search','losses','4EBSsZF','apply','update','info','ELO\x20ratings\x20and\x20positions\x20updated\x20successfully','checkAndRecordPromotion','Match\x20moved\x20to\x20approved\x20collection','wins','One\x20or\x20both\x20players\x20not\x20found','pow','constructor','MAX_SAFE_INTEGER','data','bind','toFixed','all','doc','winRate','round','empty','Could\x20not\x20find\x20player\x20documents','lastUpdated','username','pendingMatches','toISOString','toString','table','Report\x20not\x20found','(((.+)+)+)+$','winnerUsername','console','then','ELO\x20ratings\x20updated\x20successfully','totalKills','loserScore','Match\x20successfully\x20approved\x20and\x20ELO\x20updated','eloRating','loserUsername','472ZQRmSx','1971110vBEmcL','catch','238888VRVuQh','winnerScore','133278JoMRvu','loss','__proto__','length','Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions','189465aDJCgn','docs','840366rbmtyO','approvedMatches','8188928FGJvgr','totalDeaths','prototype','48PtmvoG','log','error'];a30_0x5e7d=function(){return _0x2eae2a;};return a30_0x5e7d();}
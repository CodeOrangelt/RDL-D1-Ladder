const a13_0x6b8d8b=(function(){let _0x483fa1=!![];return function(_0x5e02e2,_0xc7bddd){const _0x345ccb=_0x483fa1?function(){if(_0xc7bddd){const _0x2528ca=_0xc7bddd['apply'](_0x5e02e2,arguments);return _0xc7bddd=null,_0x2528ca;}}:function(){};return _0x483fa1=![],_0x345ccb;};}()),a13_0x3fc375=a13_0x6b8d8b(this,function(){const _0xb95ffc=a13_0x47c4;let _0x5c8669;try{const _0x5067b1=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x5c8669=_0x5067b1();}catch(_0xde28c0){_0x5c8669=window;}const _0x5e157d=_0x5c8669[_0xb95ffc(0x123)]=_0x5c8669[_0xb95ffc(0x123)]||{},_0x272546=['log','warn','info',_0xb95ffc(0x128),'exception',_0xb95ffc(0x12c),'trace'];for(let _0x46c984=0x0;_0x46c984<_0x272546['length'];_0x46c984++){const _0x5c8a53=a13_0x6b8d8b['constructor'][_0xb95ffc(0x131)]['bind'](a13_0x6b8d8b),_0x5330d3=_0x272546[_0x46c984],_0x156322=_0x5e157d[_0x5330d3]||_0x5c8a53;_0x5c8a53['__proto__']=a13_0x6b8d8b['bind'](a13_0x6b8d8b),_0x5c8a53['toString']=_0x156322['toString']['bind'](_0x156322),_0x5e157d[_0x5330d3]=_0x5c8a53;}});a13_0x3fc375();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc,where}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D3=[{'name':'Emerald','elo':0x7d0},{'name':'Gold','elo':0x708},{'name':'Silver','elo':0x640},{'name':'Bronze','elo':0x578},{'name':'Unranked','elo':0x4b0}];let lastVisibleD3=null;async function getUsernameByIdD3(_0x413dff){const _0x28cd68=a13_0x47c4;try{if(!_0x413dff)return _0x28cd68(0x12a);const _0xba9899=await getDoc(doc(db,'playersD3',_0x413dff));if(_0xba9899[_0x28cd68(0x136)]())return _0xba9899[_0x28cd68(0x12e)]()[_0x28cd68(0x12b)]||'Unknown\x20Player';const _0x1239fd=await getDocs(query(collection(db,'approvedMatchesD3'),where(_0x28cd68(0x133),'==',_0x413dff),limit(0x1)));if(!_0x1239fd[_0x28cd68(0x124)])return _0x1239fd[_0x28cd68(0x12f)][0x0]['data']()['winnerUsername']||_0x28cd68(0x12a);const _0x4bfebd=await getDocs(query(collection(db,'approvedMatchesD3'),where('loserId','==',_0x413dff),limit(0x1)));if(!_0x4bfebd['empty'])return _0x4bfebd[_0x28cd68(0x12f)][0x0]['data']()['loserUsername']||_0x28cd68(0x12a);return'Unknown\x20Player';}catch(_0x47f339){return console['error'](_0x28cd68(0x130),_0x47f339),_0x28cd68(0x12a);}}export async function recordEloChangeD3({playerId:_0x3a2d3d,previousElo:_0x329a1e,newElo:_0x601ed0,opponentId:_0x3ee0db,matchResult:_0x474f50,previousPosition:_0x2ff9b0,newPosition:_0x4d957e,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x3e31dc,timestamp:_0x4bf841}){const _0x14aba9=a13_0x47c4;try{const _0x19a6b6=doc(collection(db,_0x14aba9(0x126)));let _0x46a807='match';if(isPromotion)_0x46a807='promotion';if(isDemotion)_0x46a807='demotion';let _0xcf4f19='Unranked';if(_0x601ed0>=0x7d0)_0xcf4f19=_0x14aba9(0x129);else{if(_0x601ed0>=0x708)_0xcf4f19='Gold';else{if(_0x601ed0>=0x640)_0xcf4f19='Silver';else{if(_0x601ed0>=0x578)_0xcf4f19='Bronze';}}}return await setDoc(_0x19a6b6,{'type':_0x46a807,'player':_0x3a2d3d,'opponent':_0x3ee0db,'previousElo':_0x329a1e,'newElo':_0x601ed0,'change':_0x601ed0-_0x329a1e,'matchResult':_0x474f50,'previousPosition':_0x2ff9b0,'newPosition':_0x4d957e,'rankAchieved':_0xcf4f19,'matchId':_0x3e31dc,'timestamp':_0x4bf841||serverTimestamp(),'gameMode':'D3'}),console[_0x14aba9(0x132)](_0x14aba9(0x125)+_0x3a2d3d),!![];}catch(_0x3f167d){console['error']('Error\x20recording\x20D3\x20ELO\x20history:',_0x3f167d);throw _0x3f167d;}}export async function getEloHistoryD3(_0x25247b=0x14){const _0x15f906=a13_0x47c4;try{const _0x37d644=collection(db,'eloHistoryD3');let _0xa0f93a;lastVisibleD3?_0xa0f93a=query(_0x37d644,orderBy('timestamp',_0x15f906(0x135)),startAfter(lastVisibleD3),limit(_0x25247b)):_0xa0f93a=query(_0x37d644,orderBy('timestamp','desc'),limit(_0x25247b));const _0x1c2342=await getDocs(_0xa0f93a);if(_0x1c2342['empty'])return{'entries':[],'hasMore':![]};lastVisibleD3=_0x1c2342['docs'][_0x1c2342['docs']['length']-0x1];const _0x7f05c7=_0x1c2342['docs'][_0x15f906(0x134)](async _0x3a05da=>{const _0x50841e=_0x15f906,_0x202b4a=_0x3a05da[_0x50841e(0x12e)](),[_0x3da3a7,_0x3009e6]=await Promise[_0x50841e(0x12d)]([getUsernameByIdD3(_0x202b4a[_0x50841e(0x127)]),getUsernameByIdD3(_0x202b4a['opponent'])]);return{..._0x202b4a,'playerUsername':_0x3da3a7,'opponentUsername':_0x3009e6,'change':_0x202b4a['newElo']-_0x202b4a['previousElo'],'timestamp':_0x202b4a['timestamp']};}),_0x4d4317=await Promise['all'](_0x7f05c7);return{'entries':_0x4d4317,'hasMore':_0x1c2342['size']===_0x25247b};}catch(_0x4832a4){console['error']('Error\x20fetching\x20D3\x20ELO\x20history:',_0x4832a4);throw _0x4832a4;}}function a13_0x333d(){const _0x18fa35=['console','empty','D3\x20ELO\x20history\x20recorded\x20for\x20','eloHistoryD3','player','error','Emerald','Unknown\x20Player','username','table','all','data','docs','Error\x20getting\x20D3\x20username:','prototype','log','winnerId','map','desc','exists'];a13_0x333d=function(){return _0x18fa35;};return a13_0x333d();}function a13_0x47c4(_0x3b32ef,_0x23a016){const _0x3fc375=a13_0x333d();return a13_0x47c4=function(_0x6b8d8b,_0x7d2af8){_0x6b8d8b=_0x6b8d8b-0x123;let _0x333d60=_0x3fc375[_0x6b8d8b];return _0x333d60;},a13_0x47c4(_0x3b32ef,_0x23a016);}export function resetPaginationD3(){lastVisibleD3=null;}
const a14o=a14b;(function(a,b){const n=a14b,c=a();while(!![]){try{const d=parseInt(n(0x1bf))/0x1*(parseInt(n(0x1b6))/0x2)+parseInt(n(0x1c0))/0x3+parseInt(n(0x1cd))/0x4+-parseInt(n(0x1c1))/0x5*(-parseInt(n(0x1ba))/0x6)+parseInt(n(0x1d2))/0x7+-parseInt(n(0x1d7))/0x8+parseInt(n(0x1ce))/0x9*(-parseInt(n(0x1d8))/0xa);if(d===b)break;else c['push'](c['shift']());}catch(e){c['push'](c['shift']());}}}(a14a,0x3306e));import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a14a(){const t=['mJm5odyXm29UDLvYsq','CgXHEwvYC0qY','zxjYB3i','zwXVsgLZDg9YEuqY','ChjVBw90Aw9U','mtGWnJaXnKv1tu5xCq','mti3mfHpB0PNrq','ndaZodmWsNHzC3L5','yxbWCM92zwrnyxrJAgvZrdi','rxjYB3iGz2v0DgLUzYb1C2vYBMfTztO','B3bWB25LBNq','mty0mZi0neDPzhjesa','D2LUBMvYvxnLCM5HBwu','Bg9Zzxjjza','BgvUz3rO','vw5Yyw5Rzwq','mLvQBNHtzW','ndm1otiXBevzDLHw','nwjtB3LcCq','zg9JCW','zgf0yq','zw1WDhK','r29Sza','u2LSDMvY','Bg9ZzxjvC2vYBMfTzq','vw5RBM93BIbqBgf5zxi','zgvZyW','rdiGruXpigHPC3rVCNKGCMvJB3jKzwqGzM9Yia','C2L6zq','BwfW','ntm5mZG4sffAD1rf','nJeZntnLuLfHrhe','D2LUBMvYswq','DgLTzxn0yw1W','zxHPC3rZ'];a14a=function(){return t;};return a14a();}import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D2=[{'name':a14o(0x1c5),'elo':0x708},{'name':a14o(0x1c6),'elo':0x640},{'name':'Bronze','elo':0x578},{'name':a14o(0x1be),'elo':0x4b0}];let lastVisibleD2=null;async function getUsernameByIdD2(a){const p=a14o;try{if(!a)return'Unknown\x20Player';const b=await getDoc(doc(db,p(0x1d3),a));if(b[p(0x1d1)]())return b['data']()['username']||p(0x1c8);const c=await getDocs(query(collection(db,p(0x1b7)),where(p(0x1cf),'==',a),limit(0x1)));if(!c[p(0x1c4)])return c['docs'][0x0]['data']()[p(0x1bb)]||'Unknown\x20Player';const d=await getDocs(query(collection(db,p(0x1b7)),where(p(0x1bc),'==',a),limit(0x1)));if(!d['empty'])return d['docs'][0x0]['data']()[p(0x1c7)]||'Unknown\x20Player';return p(0x1c8);}catch(e){return console['error'](p(0x1b8),e),p(0x1c8);}}function a14b(a,b){const c=a14a();return a14b=function(d,e){d=d-0x1b6;let f=c[d];if(a14b['oASSEx']===undefined){var g=function(l){const m='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let n='',o='';for(let p=0x0,q,r,s=0x0;r=l['charAt'](s++);~r&&(q=p%0x4?q*0x40+r:r,p++%0x4)?n+=String['fromCharCode'](0xff&q>>(-0x2*p&0x6)):0x0){r=m['indexOf'](r);}for(let t=0x0,u=n['length'];t<u;t++){o+='%'+('00'+n['charCodeAt'](t)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(o);};a14b['JlHaxR']=g,a=arguments,a14b['oASSEx']=!![];}const h=c[0x0],i=d+h,j=a[i];return!j?(f=a14b['JlHaxR'](f),a[i]=f):f=j,f;},a14b(a,b);}export async function recordEloChangeD2({playerId:a,previousElo:b,newElo:c,opponentId:d,matchResult:e,previousPosition:f,newPosition:g,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:h,timestamp:i}){const q=a14o;try{const j=doc(collection(db,'eloHistoryD2'));let k='match';if(isPromotion)k=q(0x1d6);if(isDemotion)k='demotion';let l='Unranked';if(c>=0x834)l='Emerald';else{if(c>=0x708)l=q(0x1c5);else{if(c>=0x640)l=q(0x1c6);else{if(c>=0x578)l='Bronze';}}}return await setDoc(j,{'type':k,'player':a,'opponent':d,'previousElo':b,'newElo':c,'change':c-b,'matchResult':e,'previousPosition':f,'newPosition':g,'rankAchieved':l,'matchId':h,'timestamp':i}),console['log'](q(0x1ca)+a),!![];}catch(m){console[q(0x1d4)]('Error\x20recording\x20D2\x20ELO\x20history:',m);throw m;}}export async function getEloHistoryD2(a=0x14){const r=a14o;try{const b=collection(db,r(0x1d5));let c;lastVisibleD2?c=query(b,orderBy(r(0x1d0),r(0x1c9)),startAfter(lastVisibleD2),limit(a)):c=query(b,orderBy(r(0x1d0),'desc'),limit(a));const d=await getDocs(c);if(d['empty'])return{'entries':[],'hasMore':![]};lastVisibleD2=d['docs'][d[r(0x1c2)][r(0x1bd)]-0x1];const e=d[r(0x1c2)][r(0x1cc)](async g=>{const s=r,h=g[s(0x1c3)](),[i,j]=await Promise['all']([getUsernameByIdD2(h['player']),getUsernameByIdD2(h[s(0x1b9)])]);return{...h,'playerUsername':i,'opponentUsername':j,'change':h['newElo']-h['previousElo'],'timestamp':h['timestamp']};}),f=await Promise['all'](e);return{'entries':f,'hasMore':d[r(0x1cb)]===a};}catch(g){console['error']('Error\x20fetching\x20D2\x20ELO\x20history:',g);throw g;}}export function resetPaginationD2(){lastVisibleD2=null;}
const a15_0x1f1925=a15_0x580a,a15_0x3e4fab=(function(){let _0x43d222=!![];return function(_0x287768,_0x325006){const _0x10f7a0=_0x43d222?function(){if(_0x325006){const _0x5f2868=_0x325006['apply'](_0x287768,arguments);return _0x325006=null,_0x5f2868;}}:function(){};return _0x43d222=![],_0x10f7a0;};}()),a15_0x54bb17=a15_0x3e4fab(this,function(){const _0xe823dd=a15_0x580a,_0x290377=function(){const _0x255fe7=a15_0x580a;let _0x19ba1e;try{_0x19ba1e=Function('return\x20(function()\x20'+_0x255fe7(0xad)+');')();}catch(_0x420cfd){_0x19ba1e=window;}return _0x19ba1e;},_0x14a7e3=_0x290377(),_0x415643=_0x14a7e3[_0xe823dd(0xa1)]=_0x14a7e3['console']||{},_0x1bbe92=['log',_0xe823dd(0xb0),'info','error',_0xe823dd(0x9e),'table',_0xe823dd(0xa6)];for(let _0x3fb021=0x0;_0x3fb021<_0x1bbe92['length'];_0x3fb021++){const _0x4de0a4=a15_0x3e4fab[_0xe823dd(0xaa)]['prototype']['bind'](a15_0x3e4fab),_0x4d0e84=_0x1bbe92[_0x3fb021],_0x1f55ca=_0x415643[_0x4d0e84]||_0x4de0a4;_0x4de0a4['__proto__']=a15_0x3e4fab[_0xe823dd(0xa8)](a15_0x3e4fab),_0x4de0a4['toString']=_0x1f55ca[_0xe823dd(0xa2)]['bind'](_0x1f55ca),_0x415643[_0x4d0e84]=_0x4de0a4;}});a15_0x54bb17();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc,where}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D3=[{'name':a15_0x1f1925(0xaf),'elo':0x7d0},{'name':a15_0x1f1925(0xa9),'elo':0x708},{'name':'Silver','elo':0x640},{'name':a15_0x1f1925(0xab),'elo':0x578},{'name':'Unranked','elo':0x4b0}];function a15_0x11af(){const _0x4000c6=['player','approvedMatchesD3','exception','error','exists','console','toString','timestamp','winnerUsername','data','trace','Unknown\x20Player','bind','Gold','constructor','Bronze','all','{}.constructor(\x22return\x20this\x22)(\x20)','D3\x20ELO\x20history\x20recorded\x20for\x20','Emerald','warn'];a15_0x11af=function(){return _0x4000c6;};return a15_0x11af();}let lastVisibleD3=null;async function getUsernameByIdD3(_0x429d98){const _0x1b0884=a15_0x1f1925;try{if(!_0x429d98)return'Unknown\x20Player';const _0xd17fbe=await getDoc(doc(db,'playersD3',_0x429d98));if(_0xd17fbe[_0x1b0884(0xa0)]())return _0xd17fbe[_0x1b0884(0xa5)]()['username']||_0x1b0884(0xa7);const _0x5088ca=await getDocs(query(collection(db,_0x1b0884(0x9d)),where('winnerId','==',_0x429d98),limit(0x1)));if(!_0x5088ca['empty'])return _0x5088ca['docs'][0x0]['data']()[_0x1b0884(0xa4)]||'Unknown\x20Player';const _0x424787=await getDocs(query(collection(db,'approvedMatchesD3'),where('loserId','==',_0x429d98),limit(0x1)));if(!_0x424787['empty'])return _0x424787['docs'][0x0]['data']()['loserUsername']||'Unknown\x20Player';return _0x1b0884(0xa7);}catch(_0x45d34b){return console['error']('Error\x20getting\x20D3\x20username:',_0x45d34b),'Unknown\x20Player';}}export async function recordEloChangeD3({playerId:_0x243dca,previousElo:_0x281eb9,newElo:_0x2e51a3,opponentId:_0x5933ea,matchResult:_0x13fd4c,previousPosition:_0x2736bf,newPosition:_0x215b4e,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x18cdf8,timestamp:_0x3b6bd0}){const _0x1eb0ab=a15_0x1f1925;try{const _0x5a6553=doc(collection(db,'eloHistoryD3'));let _0x2048ed='match';if(isPromotion)_0x2048ed='promotion';if(isDemotion)_0x2048ed='demotion';let _0x1df669='Unranked';if(_0x2e51a3>=0x7d0)_0x1df669=_0x1eb0ab(0xaf);else{if(_0x2e51a3>=0x708)_0x1df669=_0x1eb0ab(0xa9);else{if(_0x2e51a3>=0x640)_0x1df669='Silver';else{if(_0x2e51a3>=0x578)_0x1df669='Bronze';}}}return await setDoc(_0x5a6553,{'type':_0x2048ed,'player':_0x243dca,'opponent':_0x5933ea,'previousElo':_0x281eb9,'newElo':_0x2e51a3,'change':_0x2e51a3-_0x281eb9,'matchResult':_0x13fd4c,'previousPosition':_0x2736bf,'newPosition':_0x215b4e,'rankAchieved':_0x1df669,'matchId':_0x18cdf8,'timestamp':_0x3b6bd0||serverTimestamp(),'gameMode':'D3'}),console['log'](_0x1eb0ab(0xae)+_0x243dca),!![];}catch(_0x55d407){console['error']('Error\x20recording\x20D3\x20ELO\x20history:',_0x55d407);throw _0x55d407;}}function a15_0x580a(_0x3efdff,_0x9e5b6e){const _0x54bb17=a15_0x11af();return a15_0x580a=function(_0x3e4fab,_0x4aeeda){_0x3e4fab=_0x3e4fab-0x9c;let _0x11af0c=_0x54bb17[_0x3e4fab];return _0x11af0c;},a15_0x580a(_0x3efdff,_0x9e5b6e);}export async function getEloHistoryD3(_0x5cde5f=0x14){const _0x3a27b2=a15_0x1f1925;try{const _0x3cf2db=collection(db,'eloHistoryD3');let _0x483944;lastVisibleD3?_0x483944=query(_0x3cf2db,orderBy('timestamp','desc'),startAfter(lastVisibleD3),limit(_0x5cde5f)):_0x483944=query(_0x3cf2db,orderBy(_0x3a27b2(0xa3),'desc'),limit(_0x5cde5f));const _0x5b4ac1=await getDocs(_0x483944);if(_0x5b4ac1['empty'])return{'entries':[],'hasMore':![]};lastVisibleD3=_0x5b4ac1['docs'][_0x5b4ac1['docs']['length']-0x1];const _0x38a3d7=_0x5b4ac1['docs']['map'](async _0x3286a5=>{const _0xbb1435=_0x3a27b2,_0xc7f989=_0x3286a5[_0xbb1435(0xa5)](),[_0x46c666,_0x380791]=await Promise[_0xbb1435(0xac)]([getUsernameByIdD3(_0xc7f989[_0xbb1435(0x9c)]),getUsernameByIdD3(_0xc7f989['opponent'])]);return{..._0xc7f989,'playerUsername':_0x46c666,'opponentUsername':_0x380791,'change':_0xc7f989['newElo']-_0xc7f989['previousElo'],'timestamp':_0xc7f989['timestamp']};}),_0x47cbe8=await Promise[_0x3a27b2(0xac)](_0x38a3d7);return{'entries':_0x47cbe8,'hasMore':_0x5b4ac1['size']===_0x5cde5f};}catch(_0x18540b){console[_0x3a27b2(0x9f)]('Error\x20fetching\x20D3\x20ELO\x20history:',_0x18540b);throw _0x18540b;}}export function resetPaginationD3(){lastVisibleD3=null;}
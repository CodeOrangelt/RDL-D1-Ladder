function a46_0x272e(_0x3dcccc,_0x39e711){const _0x20d915=a46_0x3b2c();return a46_0x272e=function(_0x57707f,_0x5b24af){_0x57707f=_0x57707f-0xc2;let _0x3b2c26=_0x20d915[_0x57707f];return _0x3b2c26;},a46_0x272e(_0x3dcccc,_0x39e711);}const a46_0x7471f5=a46_0x272e,a46_0x57707f=(function(){let _0x2dab85=!![];return function(_0xfdba54,_0x49817b){const _0xf3dd10=_0x2dab85?function(){if(_0x49817b){const _0x5f0097=_0x49817b['apply'](_0xfdba54,arguments);return _0x49817b=null,_0x5f0097;}}:function(){};return _0x2dab85=![],_0xf3dd10;};}()),a46_0x20d915=a46_0x57707f(this,function(){const _0x45584c=a46_0x272e,_0x3b2906=function(){let _0x56dd98;try{_0x56dd98=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x2abab8){_0x56dd98=window;}return _0x56dd98;},_0xecf2c5=_0x3b2906(),_0x15a453=_0xecf2c5['console']=_0xecf2c5['console']||{},_0x569394=[_0x45584c(0xd1),_0x45584c(0x13f),_0x45584c(0x144),'error','exception',_0x45584c(0x115),_0x45584c(0x11e)];for(let _0x48873e=0x0;_0x48873e<_0x569394[_0x45584c(0xe7)];_0x48873e++){const _0x2848a7=a46_0x57707f[_0x45584c(0xe6)][_0x45584c(0xd8)][_0x45584c(0xda)](a46_0x57707f),_0x49a19e=_0x569394[_0x48873e],_0x3e03f3=_0x15a453[_0x49a19e]||_0x2848a7;_0x2848a7[_0x45584c(0xcf)]=a46_0x57707f['bind'](a46_0x57707f),_0x2848a7['toString']=_0x3e03f3['toString']['bind'](_0x3e03f3),_0x15a453[_0x49a19e]=_0x2848a7;}});a46_0x20d915();import{getAuth,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{getFirestore,doc,getDoc,setDoc,updateDoc,collection,addDoc,serverTimestamp}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{clearTokenCache}from'./tokens.js';const auth=getAuth(),db=getFirestore(),THEMES={'default':{'price':0x0,'name':'Classic\x20RDL','description':'Rock\x20texture\x20with\x20a\x20sleek\x20nav\x20and\x20footer'},'purple':{'price':0x96,'name':'Purple','description':'Can\x27t\x20get\x20enough'},'cyberpunk':{'price':0x190,'name':'Yellow\x20Orange','description':a46_0x7471f5(0x134)},'emerald':{'price':0x3e8,'name':a46_0x7471f5(0xc5),'description':'Emerald\x20City!'},'gold':{'price':0x320,'name':'Gold','description':'Only\x20the\x20best\x20get\x20this\x20one'},'contrast':{'price':0x0,'name':'Black\x20&\x20White','description':a46_0x7471f5(0x11c)},'ocean':{'price':0x12c,'name':'Blue','description':'This\x20one\x20is\x20really\x20pretty'},'volcanic':{'price':0x1f4,'name':'Red','description':'For\x20the\x20angry\x20type.'}},TOKENS={'blob01':{'price':0x1f4,'name':'Blob\x20Token\x201','description':a46_0x7471f5(0x127),'image':'../images/tokens/blob01.gif','category':'blob'},'blob02':{'price':0x3e8,'name':a46_0x7471f5(0x13d),'description':'Another\x20enigmatic\x20blob\x20creature','image':'../images/tokens/blob02.gif','category':a46_0x7471f5(0xd6)},'blob03':{'price':0x7d0,'name':'Blob\x20Token\x203','description':'The\x20final\x20blob\x20in\x20the\x20collection','image':'../images/tokens/blob03.gif','category':'blob'},'cloak':{'price':0x1f4,'name':'Cloaking\x20Device','description':a46_0x7471f5(0xf2),'image':a46_0x7471f5(0x107),'category':a46_0x7471f5(0x10f)},'gauge18':{'price':0x320,'name':'R/Y/B\x20Keys','description':'Monitor\x20your\x20ship\x27s\x20energy\x20levels','image':'../images/tokens/gauge18.gif','category':'equipment'},'fusion':{'price':0x15e,'name':'Fusion\x20Cannon','description':'Devastating\x20fusion\x20weapon\x20technology','image':'../images/tokens/subgame/fusion.gif','category':a46_0x7471f5(0x10c)},'mmissile':{'price':0x320,'name':a46_0x7471f5(0xe4),'description':'Heavy\x20ordinance\x20for\x20tough\x20situations','image':a46_0x7471f5(0xf9),'category':'weapon'},'pbomb':{'price':0x15e,'name':'Proximity\x20Bomb','description':'Strategic\x20explosive\x20device','image':'../images/tokens/subgame/pbomb.gif','category':'weapon'},'pwr01':{'price':0x64,'name':'Energy','description':'Enhanced\x20energy\x20generation\x20unit','image':'../images/tokens/subgame/pwr01.gif','category':a46_0x7471f5(0x13b)},'pwr02':{'price':0x258,'name':a46_0x7471f5(0xd3),'description':'Advanced\x20energy\x20storage\x20system','image':'../images/tokens/subgame/pwr02.gif','category':'powerup'},'smissile':{'price':0x28a,'name':'Smart\x20Missile','description':'Intelligent\x20targeting\x20system','image':a46_0x7471f5(0x111),'category':'weapon'}};function a46_0x3b2c(){const _0x5aa5b9=['You\x20need\x20','Token\x20','tokenId','Emerald','\x20items,\x20Equipped:\x20','Token\x20unequip\x20failed:','\x22\x20alt=\x22','RedeemStore','‚úÖ\x20User\x20authenticated:','default','[data-token]','getCurrentTheme','not-allowed','__proto__','toLocaleString','log','\x20Points','Shield\x20Orb','innerHTML','userProfiles','blob','Purchase','prototype','adminStatusChanged','bind','\x20not\x20found','owned','theme_','inventory','closest','Theme\x20system\x20not\x20found','isAdmin','equippedToken','addEventListener','Mega\x20Missile','sign-in-free','constructor','length','tokens','classList','none','className','Purchase\x20failed.\x20Please\x20try\x20again.','points','appendChild','querySelector','refreshUI','textContent','Become\x20one\x20with\x20the\x20shadows','cannot-afford','remove','FREE','createElement','transactions','disabled','../images/tokens/subgame/mmissile.gif','Sold\x20','display','token_','sale','.theme-select-btn','opacity','sign-in','Current\x20Theme','confirm','</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22item-description\x22>','\x20more\x20points.','0.7','\x20for\x20','../images/tokens/cloak.gif','entries','!\x20Use\x20the\x20\x22Equip\x22\x20button\x20to\x20show\x20it\x20on\x20the\x20ladder.','equipped','var(--success-color,\x20#4CAF50)','weapon','function','dataset','special','forEach','../images/tokens/subgame/smissile.gif','DOMContentLoaded','currentUser','data','table','add','can-afford','map','block','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22item-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22item-icon\x20token-icon\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22item-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22item-icon\x20theme-icon-','You\x20can\x20see\x20better!','name','trace','üîß\x20Token\x20permissions\x20issue\x20detected,\x20but\x20purchase\x20was\x20successful','Only\x20admins\x20can\x20sell\x20tokens','exists','Token\x20purchase\x20failed:','includes','style','cursor','0.5','A\x20mysterious\x20purple\x20blob\x20token','Unknown','?\x20This\x20will\x20unequip\x20your\x20current\x20token.','apply-theme','Equip','store-item\x20token-item','code','visible','getElementById','email','Buy','message','token','This\x20theme\x20makes\x20me\x20happy','displayLadder','click','preventDefault','price','uid','error','powerup','isUserAdmin','Blob\x20Token\x202','Purchase\x20','warn','permission-denied','success','pointer','Sign\x20in\x20to\x20Purchase','info'];a46_0x3b2c=function(){return _0x5aa5b9;};return a46_0x3b2c();}let userData={'points':0x0,'inventory':[],'isAdmin':![]},storeContainer,pointsDisplay,authWarning;document[a46_0x7471f5(0xe3)](a46_0x7471f5(0x112),()=>{const _0x1f4190=a46_0x7471f5;console[_0x1f4190(0xd1)]('üè™\x20Redeem\x20store\x20initializing...'),storeContainer=document['getElementById']('store-content'),pointsDisplay=document[_0x1f4190(0x12f)]('user-points'),authWarning=document[_0x1f4190(0x12f)]('auth-warning'),initAuthListener(),buildStoreUI();});function initAuthListener(){onAuthStateChanged(auth,async _0x2aee2d=>{const _0x44e67a=a46_0x272e;if(_0x2aee2d){console[_0x44e67a(0xd1)](_0x44e67a(0xca),_0x2aee2d['displayName']||_0x2aee2d['email']);if(authWarning)authWarning[_0x44e67a(0x124)]['display']=_0x44e67a(0xea);if(storeContainer)storeContainer[_0x44e67a(0x124)][_0x44e67a(0xfb)]='block';await loadUserData(_0x2aee2d),updateThemeButtons(),updateTokenButtons();}else{console['log']('‚ùå\x20User\x20not\x20authenticated');if(authWarning)authWarning[_0x44e67a(0x124)][_0x44e67a(0xfb)]=_0x44e67a(0x119);if(storeContainer)storeContainer['style']['display']='none';userData={'points':0x0,'inventory':[],'isAdmin':![]},window[_0x44e67a(0x13c)]=![];}});}async function loadUserData(_0x38bdc5){const _0x57bff3=a46_0x7471f5;try{const _0x145ea=doc(db,'userProfiles',_0x38bdc5['uid']),_0x561c1a=await getDoc(_0x145ea);if(_0x561c1a['exists']()){const _0x102a0b=_0x561c1a['data']();userData={'points':_0x102a0b['points']||0x0,'inventory':_0x102a0b['inventory']||[],'isAdmin':_0x102a0b['isAdmin']||![],'equippedToken':_0x102a0b[_0x57bff3(0xe2)]||null},pointsDisplay&&(pointsDisplay[_0x57bff3(0xf1)]=userData['points']['toLocaleString']()),window['isUserAdmin']=userData['isAdmin'],userData[_0x57bff3(0xe1)]&&(console['log']('üëë\x20Admin\x20controls\x20enabled'),window['dispatchEvent'](new CustomEvent(_0x57bff3(0xd9),{'detail':{'isAdmin':!![]}}))),console['log']('User\x20data\x20loaded\x20-\x20Points:\x20'+userData[_0x57bff3(0xed)]+',\x20Inventory:\x20'+userData[_0x57bff3(0xde)][_0x57bff3(0xe7)]+_0x57bff3(0xc6)+(userData[_0x57bff3(0xe2)]||'none'));}else await setDoc(_0x145ea,{'points':0x0,'inventory':[],'equippedToken':null,'createdAt':serverTimestamp(),'username':_0x38bdc5['displayName']||_0x38bdc5[_0x57bff3(0x130)]?.['split']('@')[0x0]||'User'}),userData={'points':0x0,'inventory':[],'isAdmin':![],'equippedToken':null},pointsDisplay&&(pointsDisplay['textContent']='0'),window['isUserAdmin']=![],console['log']('New\x20user\x20profile\x20created');}catch(_0x4f091d){console[_0x57bff3(0x13a)]('Error\x20loading\x20user\x20data:',_0x4f091d);}}function userOwnsTheme(_0x22eb60){const _0x101aa6=a46_0x7471f5;if(THEMES[_0x22eb60]?.['price']===0x0)return!![];return userData['inventory'][_0x101aa6(0x123)]('theme_'+_0x22eb60);}function userOwnsToken(_0x3604e5){const _0x308690=a46_0x7471f5;return userData['inventory']['includes'](_0x308690(0xfc)+_0x3604e5);}function userHasTokenEquipped(_0x50c18){return userData['equippedToken']===_0x50c18;}function getEquippedToken(){return userData['equippedToken']||null;}async function purchaseTheme(_0xf42c57){const _0x237205=a46_0x7471f5,_0x4441b0=auth[_0x237205(0x113)];if(!_0x4441b0)return showMessage('Please\x20sign\x20in\x20to\x20purchase\x20themes','error'),![];const _0x58de2e=THEMES[_0xf42c57];if(!_0x58de2e)return console[_0x237205(0x13a)]('Theme\x20'+_0xf42c57+_0x237205(0xdb)),![];if(userData[_0x237205(0xed)]<_0x58de2e['price'])return showMessage('Not\x20enough\x20points.\x20You\x20need\x20'+(_0x58de2e['price']-userData['points'])+_0x237205(0x104),_0x237205(0x13a)),![];if(userOwnsTheme(_0xf42c57))return showMessage('You\x20already\x20own\x20the\x20'+_0x58de2e['name']+'\x20theme','info'),![];try{return await processPurchase(_0xf42c57,_0x58de2e,'theme');}catch(_0x31c87f){return console['error']('Theme\x20purchase\x20failed:',_0x31c87f),showMessage('Purchase\x20failed.\x20Please\x20try\x20again.','error'),![];}}async function purchaseToken(_0x5f11ab){const _0x197786=a46_0x7471f5,_0x11b4b1=auth['currentUser'];if(!_0x11b4b1)return showMessage('Please\x20sign\x20in\x20to\x20purchase\x20tokens','error'),![];const _0x57f50b=TOKENS[_0x5f11ab];if(!_0x57f50b)return console['error'](_0x197786(0xc3)+_0x5f11ab+'\x20not\x20found'),![];if(userData['points']<_0x57f50b['price'])return showMessage('Not\x20enough\x20points.\x20You\x20need\x20'+(_0x57f50b['price']-userData['points'])+_0x197786(0x104),'error'),![];if(userOwnsToken(_0x5f11ab))return showMessage('You\x20already\x20own\x20the\x20'+_0x57f50b[_0x197786(0x11d)]+'\x20token',_0x197786(0x144)),![];try{return await processPurchase(_0x5f11ab,_0x57f50b,'token');}catch(_0x334ebe){return console[_0x197786(0x13a)](_0x197786(0x122),_0x334ebe),showMessage(_0x197786(0xec),'error'),![];}}async function processPurchase(_0x980039,_0x453b94,_0x2cf588){const _0x582b9e=a46_0x7471f5,_0x516c26=auth['currentUser'];try{const _0x191824=doc(db,_0x582b9e(0xd5),_0x516c26[_0x582b9e(0x139)]),_0xeab4c=await getDoc(_0x191824);if(!_0xeab4c[_0x582b9e(0x121)]())return showMessage('User\x20profile\x20not\x20found',_0x582b9e(0x13a)),![];const _0x27db5c=_0xeab4c[_0x582b9e(0x114)](),_0x4718e0=_0x27db5c['points']||0x0,_0x25a117=_0x27db5c[_0x582b9e(0xde)]||[];if(_0x4718e0<_0x453b94['price'])return showMessage('Insufficient\x20points','error'),![];if(_0x25a117[_0x582b9e(0x123)](_0x2cf588+'_'+_0x980039))return showMessage('You\x20already\x20own\x20this\x20'+_0x2cf588,_0x582b9e(0x144)),![];const _0x107d63=_0x4718e0-_0x453b94[_0x582b9e(0x138)],_0x47e532=[..._0x25a117,_0x2cf588+'_'+_0x980039];await updateDoc(_0x191824,{'points':_0x107d63,'inventory':_0x47e532,'lastPurchase':serverTimestamp()});if(_0x2cf588===_0x582b9e(0x133))try{const _0x3c5ce4=doc(db,'userTokens',_0x516c26['uid']),_0x237323=await getDoc(_0x3c5ce4);let _0x508fc4=[];_0x237323['exists']()&&(_0x508fc4=_0x237323[_0x582b9e(0x114)]()['tokens']||[]);const _0x16e3ff=new Date();_0x508fc4['push']({'tokenId':_0x980039,'tokenName':_0x453b94['name'],'tokenImage':_0x453b94['image'],'category':_0x453b94['category'],'purchasedAt':_0x16e3ff,'price':_0x453b94['price'],'equipped':![]}),await setDoc(_0x3c5ce4,{'userId':_0x516c26[_0x582b9e(0x139)],'username':_0x27db5c['username']||_0x516c26['displayName']||_0x582b9e(0x128),'tokens':_0x508fc4,'lastUpdated':serverTimestamp()},{'merge':!![]}),typeof clearTokenCache==='function'&&clearTokenCache(_0x516c26['uid']),console['log']('‚úÖ\x20Token\x20'+_0x980039+'\x20saved\x20to\x20userTokens\x20collection\x20(not\x20equipped)');}catch(_0x302b13){console['warn']('Token\x20collection\x20update\x20had\x20an\x20issue,\x20but\x20purchase\x20completed:',_0x302b13),_0x302b13['code']===_0x582b9e(0x140)?console['log'](_0x582b9e(0x11f)):console[_0x582b9e(0x13a)]('Unexpected\x20token\x20error:',_0x302b13);}try{await addDoc(collection(db,'transactions'),{'userId':_0x516c26[_0x582b9e(0x139)],'userEmail':_0x516c26['email'],'itemId':_0x2cf588+'_'+_0x980039,'itemTitle':_0x453b94['name'],'price':_0x453b94['price'],'type':'purchase','category':_0x2cf588,'timestamp':serverTimestamp()});}catch(_0xa37868){console['warn']('Transaction\x20logging\x20failed,\x20but\x20purchase\x20was\x20successful:',_0xa37868);}return userData['points']=_0x107d63,userData[_0x582b9e(0xde)]=_0x47e532,pointsDisplay&&(pointsDisplay['textContent']=userData[_0x582b9e(0xed)][_0x582b9e(0xd0)]()),updateTokenButtons(),_0x2cf588==='theme'&&updateThemeButtons(),console['log']('‚úÖ\x20Purchased\x20'+_0x453b94[_0x582b9e(0x11d)]+_0x582b9e(0x106)+_0x453b94['price']+'\x20points'),showMessage('Successfully\x20purchased\x20'+_0x453b94[_0x582b9e(0x11d)]+_0x582b9e(0x109),'success'),!![];}catch(_0x411968){console['error']('Purchase\x20processing\x20error:',_0x411968);if(_0x411968[_0x582b9e(0x12d)]==='permission-denied')showMessage('Permission\x20denied.\x20Please\x20try\x20again\x20or\x20contact\x20support.',_0x582b9e(0x13a));else{if(_0x411968['code']==='unavailable')showMessage('Service\x20temporarily\x20unavailable.\x20Please\x20try\x20again.',_0x582b9e(0x13a));else _0x411968[_0x582b9e(0x12d)]==='unauthenticated'?showMessage('Please\x20sign\x20in\x20again\x20to\x20complete\x20purchase.',_0x582b9e(0x13a)):showMessage('Purchase\x20failed.\x20Please\x20try\x20again.','error');}return![];}}async function equipToken(_0x5e0856){const _0x53975e=a46_0x7471f5,_0x2509d5=auth['currentUser'];if(!_0x2509d5)return showMessage('Please\x20sign\x20in\x20to\x20equip\x20tokens','error'),![];const _0x437f78=TOKENS[_0x5e0856];if(!_0x437f78)return console['error']('Token\x20'+_0x5e0856+'\x20not\x20found'),![];if(!userOwnsToken(_0x5e0856))return showMessage('You\x20must\x20own\x20this\x20token\x20to\x20equip\x20it','error'),![];try{const _0x2a5c82=doc(db,'userProfiles',_0x2509d5['uid']);await updateDoc(_0x2a5c82,{'equippedToken':_0x5e0856,'lastTokenEquip':serverTimestamp()});try{const _0x6f2327=doc(db,'userTokens',_0x2509d5['uid']),_0x36bd80=await getDoc(_0x6f2327);if(_0x36bd80['exists']()){const _0x590524=_0x36bd80['data'](),_0x29333f=_0x590524[_0x53975e(0xe8)]||[],_0x48d4b6=_0x29333f['map'](_0x34a8a5=>({..._0x34a8a5,'equipped':_0x34a8a5[_0x53975e(0xc4)]===_0x5e0856}));await updateDoc(_0x6f2327,{'tokens':_0x48d4b6,'equippedToken':_0x5e0856,'lastUpdated':serverTimestamp()});}}catch(_0x4a8386){console['warn']('Token\x20collection\x20update\x20had\x20an\x20issue,\x20but\x20equip\x20was\x20successful:',_0x4a8386);}return userData['equippedToken']=_0x5e0856,typeof clearTokenCache==='function'&&(clearTokenCache(_0x2509d5['uid']),clearTokenCache()),setTimeout(()=>{const _0x9909d=_0x53975e;window['displayLadder']&&typeof window[_0x9909d(0x135)]===_0x9909d(0x10d)&&(console['log']('üîÑ\x20Refreshing\x20ladder\x20to\x20show\x20equipped\x20token'),window['displayLadder'](!![])),window['RedeemStore']&&typeof window['RedeemStore']['refreshUI']===_0x9909d(0x10d)&&window[_0x9909d(0xc9)]['refreshUI']();},0x1f4),console['log']('‚úÖ\x20Equipped\x20token:\x20'+_0x437f78[_0x53975e(0x11d)]),showMessage(_0x437f78[_0x53975e(0x11d)]+'\x20equipped!\x20Ladder\x20will\x20refresh\x20shortly.',_0x53975e(0x141)),!![];}catch(_0x230c8b){return console['error']('Token\x20equip\x20failed:',_0x230c8b),_0x230c8b['code']==='permission-denied'?showMessage('Permission\x20denied.\x20Token\x20may\x20still\x20be\x20equipped\x20-\x20check\x20the\x20ladder.','warning'):showMessage('Failed\x20to\x20equip\x20token:\x20'+_0x230c8b[_0x53975e(0x132)],'error'),![];}}async function unequipToken(){const _0x3c2f00=a46_0x7471f5,_0x36460b=auth['currentUser'];if(!_0x36460b)return showMessage('Please\x20sign\x20in\x20to\x20unequip\x20tokens','error'),![];if(!userData['equippedToken'])return showMessage('No\x20token\x20is\x20currently\x20equipped',_0x3c2f00(0x144)),![];try{const _0x3ef7fb=doc(db,'userProfiles',_0x36460b[_0x3c2f00(0x139)]);await updateDoc(_0x3ef7fb,{'equippedToken':null,'lastTokenEquip':serverTimestamp()});const _0x323756=doc(db,'userTokens',_0x36460b['uid']),_0x2b6489=await getDoc(_0x323756);if(_0x2b6489[_0x3c2f00(0x121)]()){const _0x1df676=_0x2b6489['data'](),_0x5697b0=_0x1df676[_0x3c2f00(0xe8)]||[],_0x1ee021=_0x5697b0[_0x3c2f00(0x118)](_0x81b658=>({..._0x81b658,'equipped':![]}));await updateDoc(_0x323756,{'tokens':_0x1ee021,'equippedToken':null,'lastUpdated':serverTimestamp()});}return userData['equippedToken']=null,typeof clearTokenCache===_0x3c2f00(0x10d)&&(clearTokenCache(_0x36460b['uid']),clearTokenCache()),setTimeout(()=>{const _0x1ffab5=_0x3c2f00;window['displayLadder']&&typeof window['displayLadder']==='function'&&(console['log']('üîÑ\x20Refreshing\x20ladder\x20to\x20remove\x20unequipped\x20token'),window[_0x1ffab5(0x135)](!![])),window['RedeemStore']&&typeof window['RedeemStore'][_0x1ffab5(0xf0)]===_0x1ffab5(0x10d)&&window['RedeemStore']['refreshUI']();},0x1f4),console['log']('‚úÖ\x20Token\x20unequipped'),showMessage('Token\x20unequipped!\x20Ladder\x20will\x20refresh\x20shortly.','success'),!![];}catch(_0x2f6972){return console[_0x3c2f00(0x13a)](_0x3c2f00(0xc7),_0x2f6972),showMessage('Failed\x20to\x20unequip\x20token:\x20'+_0x2f6972['message'],'error'),![];}}async function sellToken(_0xdb0fed){const _0x443652=a46_0x7471f5,_0x168977=auth['currentUser'];if(!_0x168977)return showMessage('Please\x20sign\x20in\x20to\x20sell\x20tokens','error'),![];if(!userData['isAdmin'])return showMessage(_0x443652(0x120),'error'),![];const _0x969d8e=TOKENS[_0xdb0fed];if(!_0x969d8e)return console['error'](_0x443652(0xc3)+_0xdb0fed+_0x443652(0xdb)),![];if(!userOwnsToken(_0xdb0fed))return showMessage('You\x20don\x27t\x20own\x20this\x20token',_0x443652(0x13a)),![];try{const _0x153e5b=doc(db,'userProfiles',_0x168977['uid']),_0x18d3f9=await getDoc(_0x153e5b),_0x16d37b=_0x18d3f9['data'](),_0x3e63a0=Math['floor'](_0x969d8e[_0x443652(0x138)]*0.5),_0x27dabe=(_0x16d37b[_0x443652(0xed)]||0x0)+_0x3e63a0,_0x22f8a8=(_0x16d37b[_0x443652(0xde)]||[])['filter'](_0x2cf60f=>_0x2cf60f!=='token_'+_0xdb0fed),_0x22c0dc=_0x16d37b['equippedToken']===_0xdb0fed?null:_0x16d37b['equippedToken'];await updateDoc(_0x153e5b,{'points':_0x27dabe,'inventory':_0x22f8a8,'equippedToken':_0x22c0dc,'lastSale':serverTimestamp()});const _0x117a08=doc(db,'userTokens',_0x168977['uid']),_0x11eab4=await getDoc(_0x117a08);if(_0x11eab4['exists']()){const _0xbcf14b=_0x11eab4[_0x443652(0x114)](),_0x5bcabc=_0xbcf14b['tokens']||[],_0x117ed4=_0x5bcabc['filter'](_0x3cf96c=>_0x3cf96c['tokenId']!==_0xdb0fed);await updateDoc(_0x117a08,{'tokens':_0x117ed4,'equippedToken':_0x22c0dc,'lastUpdated':serverTimestamp()});}return await addDoc(collection(db,_0x443652(0xf7)),{'userId':_0x168977['uid'],'userEmail':_0x168977['email'],'itemId':'token_'+_0xdb0fed,'itemTitle':_0x969d8e['name'],'refund':_0x3e63a0,'originalPrice':_0x969d8e['price'],'type':_0x443652(0xfd),'category':'token','timestamp':serverTimestamp()}),userData['points']=_0x27dabe,userData['inventory']=_0x22f8a8,userData[_0x443652(0xe2)]=_0x22c0dc,pointsDisplay&&(pointsDisplay[_0x443652(0xf1)]=userData['points']['toLocaleString']()),typeof clearTokenCache==='function'&&clearTokenCache(_0x168977[_0x443652(0x139)]),console['log']('‚úÖ\x20Sold\x20token\x20'+_0x969d8e['name']+'\x20for\x20'+_0x3e63a0+'\x20points'),showMessage(_0x443652(0xfa)+_0x969d8e['name']+'\x20for\x20'+_0x3e63a0+'\x20points\x20(50%\x20refund)',_0x443652(0x141)),!![];}catch(_0x433f8e){return console['error']('Token\x20sale\x20failed:',_0x433f8e),showMessage('Failed\x20to\x20sell\x20token:\x20'+_0x433f8e[_0x443652(0x132)],'error'),![];}}function applyTheme(_0x5fe5c){const _0x5369df=a46_0x7471f5;if(!userOwnsTheme(_0x5fe5c))return showMessage('You\x20must\x20purchase\x20this\x20theme\x20first',_0x5369df(0x13a)),![];return window['ThemeSystem']?(window['ThemeSystem']['switchTheme'](_0x5fe5c),showMessage((THEMES[_0x5fe5c]?.[_0x5369df(0x11d)]||_0x5fe5c)+'\x20theme\x20applied!','success'),!![]):(console['error'](_0x5369df(0xe0)),![]);}function buildStoreUI(){buildThemeItems(),buildTokenItems();}function buildThemeItems(){const _0x15b2f1=a46_0x7471f5,_0x5b7b3a=document['querySelector']('.themes-grid');if(!_0x5b7b3a){console['error']('Themes\x20container\x20not\x20found');return;}_0x5b7b3a['innerHTML']='',Object[_0x15b2f1(0x108)](THEMES)['forEach'](([_0x29bef6,_0x35cc4a])=>{const _0x5ab4f6=_0x15b2f1,_0x4ac2d6=document[_0x5ab4f6(0xf6)]('div');_0x4ac2d6[_0x5ab4f6(0xeb)]='store-item',_0x4ac2d6[_0x5ab4f6(0x10e)]['theme']=_0x29bef6,_0x4ac2d6[_0x5ab4f6(0x10e)]['itemId']=_0x5ab4f6(0xdd)+_0x29bef6,_0x4ac2d6['dataset'][_0x5ab4f6(0x138)]=_0x35cc4a['price'],_0x4ac2d6[_0x5ab4f6(0xd4)]=_0x5ab4f6(0x11b)+_0x29bef6+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-palette\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22item-price\x22>'+(_0x35cc4a[_0x5ab4f6(0x138)]===0x0?_0x5ab4f6(0xf5):_0x35cc4a['price']+_0x5ab4f6(0xd2))+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22item-title\x22>'+_0x35cc4a[_0x5ab4f6(0x11d)]+_0x5ab4f6(0x103)+_0x35cc4a['description']+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22theme-select-btn\x20purchase-btn\x22>Select\x20Theme</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x5b7b3a[_0x5ab4f6(0xee)](_0x4ac2d6);}),setupThemeButtons();}function buildTokenItems(){const _0x4a1ad7=document['querySelector']('.tokens-grid');if(!_0x4a1ad7){console['error']('Tokens\x20container\x20not\x20found');return;}_0x4a1ad7['innerHTML']='',Object['entries'](TOKENS)['forEach'](([_0xb4add2,_0x3fced2])=>{const _0x1444f7=a46_0x272e,_0x5260c6=document['createElement']('div');_0x5260c6['className']=_0x1444f7(0x12c),_0x5260c6['dataset']['token']=_0xb4add2,_0x5260c6['dataset']['itemId']='token_'+_0xb4add2,_0x5260c6['dataset']['price']=_0x3fced2[_0x1444f7(0x138)];const _0x367b62=userData['isAdmin']&&userOwnsToken(_0xb4add2)?'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22token-sell-btn\x20admin-btn\x22\x20style=\x22margin-top:\x200.5rem;\x20background:\x20#f44336;\x20font-size:\x200.8rem;\x20padding:\x200.3rem;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Sell\x20('+Math['floor'](_0x3fced2[_0x1444f7(0x138)]*0.5)+'\x20pts)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20':'';_0x5260c6[_0x1444f7(0xd4)]=_0x1444f7(0x11a)+_0x3fced2['image']+_0x1444f7(0xc8)+_0x3fced2[_0x1444f7(0x11d)]+'\x22\x20class=\x22token-preview\x22\x20onerror=\x22this.style.display=\x27none\x27;\x20this.nextElementSibling.style.display=\x27flex\x27;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22token-fallback\x22\x20style=\x22display:\x20none;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-coins\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22item-price\x22>'+_0x3fced2['price']+'\x20Points</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22token-select-btn\x20purchase-btn\x22>Purchase</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22token-equip-btn\x20equip-btn\x22\x20style=\x22margin-top:\x200.5rem;\x20display:\x20none;\x22>Equip</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x367b62+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x4a1ad7['appendChild'](_0x5260c6);}),setupTokenButtons();}function setupThemeButtons(){const _0x1e3be2=a46_0x7471f5,_0x10a404=document['querySelectorAll']('.theme-select-btn');_0x10a404[_0x1e3be2(0x110)](_0x5ebdd1=>{const _0x53361e=_0x1e3be2;_0x5ebdd1[_0x53361e(0xe3)](_0x53361e(0x136),async _0x2afe7c=>{const _0x475bc3=_0x53361e;_0x2afe7c['preventDefault']();const _0x36a50e=auth[_0x475bc3(0x113)];if(!_0x36a50e){showMessage('Please\x20sign\x20in\x20to\x20select\x20themes',_0x475bc3(0x13a));return;}const _0x1366ba=_0x5ebdd1['closest']('[data-theme]'),_0x23820f=_0x1366ba['dataset']['theme'],_0x34b244=THEMES[_0x23820f];if(!_0x34b244){console[_0x475bc3(0x13a)]('Theme\x20'+_0x23820f+'\x20not\x20found');return;}console['log']('Theme\x20clicked:\x20'+_0x34b244[_0x475bc3(0x11d)]+'\x20('+_0x23820f+')');if(_0x5ebdd1[_0x475bc3(0xf8)]){_0x34b244['price']>0x0&&showMessage(_0x475bc3(0xc2)+_0x34b244['price']+'\x20points\x20to\x20purchase\x20this\x20theme','error');return;}if(_0x5ebdd1[_0x475bc3(0xf1)]===_0x475bc3(0x101)){showMessage(_0x34b244['name']+'\x20is\x20already\x20your\x20current\x20theme','info');return;}if(_0x5ebdd1['textContent']==='Apply\x20Theme'){applyTheme(_0x23820f),updateThemeButtons();return;}if(_0x5ebdd1['textContent']['includes'](_0x475bc3(0x131))){const _0x1e09e8=window[_0x475bc3(0x102)](_0x475bc3(0x13e)+_0x34b244[_0x475bc3(0x11d)]+'\x20theme\x20for\x20'+_0x34b244[_0x475bc3(0x138)]+'\x20points?');if(!_0x1e09e8)return;const _0xecf4f=await purchaseTheme(_0x23820f);_0xecf4f&&(showMessage(_0x34b244['name']+'\x20theme\x20purchased!','success'),applyTheme(_0x23820f),updateThemeButtons());return;}userOwnsTheme(_0x23820f)?applyTheme(_0x23820f):showMessage('You\x20must\x20purchase\x20this\x20theme\x20first','error');});}),updateThemeButtons();}function setupTokenButtons(){const _0x54935e=a46_0x7471f5,_0x28a2c9=document['querySelectorAll']('.token-select-btn'),_0x2079a2=document['querySelectorAll']('.token-equip-btn'),_0xf6f4b=document['querySelectorAll']('.token-sell-btn');_0x28a2c9[_0x54935e(0x110)](_0xf079b2=>{const _0x4ccf5e=_0x54935e;_0xf079b2['addEventListener'](_0x4ccf5e(0x136),async _0x4621fe=>{const _0x6cfb47=_0x4ccf5e;_0x4621fe[_0x6cfb47(0x137)]();const _0x4fb6fe=auth['currentUser'];if(!_0x4fb6fe){showMessage('Please\x20sign\x20in\x20to\x20purchase\x20tokens','error');return;}const _0x1b4ffa=_0xf079b2['closest'](_0x6cfb47(0xcc)),_0x44515a=_0x1b4ffa[_0x6cfb47(0x10e)]['token'],_0xbdebd6=TOKENS[_0x44515a];if(!_0xbdebd6){console['error'](_0x6cfb47(0xc3)+_0x44515a+'\x20not\x20found');return;}console[_0x6cfb47(0xd1)]('Token\x20clicked:\x20'+_0xbdebd6['name']+'\x20('+_0x44515a+')');if(_0xf079b2['disabled']){showMessage('You\x20need\x20'+_0xbdebd6['price']+'\x20points\x20to\x20purchase\x20this\x20token','error');return;}if(_0xf079b2[_0x6cfb47(0xf1)]==='Owned'){showMessage('You\x20already\x20own\x20the\x20'+_0xbdebd6['name']+'\x20token',_0x6cfb47(0x144));return;}if(_0xf079b2[_0x6cfb47(0xf1)][_0x6cfb47(0x123)](_0x6cfb47(0xd7))||_0xf079b2['textContent'][_0x6cfb47(0x123)]('Buy')){const _0x7ade66=window['confirm']('Purchase\x20'+_0xbdebd6[_0x6cfb47(0x11d)]+'\x20token\x20for\x20'+_0xbdebd6[_0x6cfb47(0x138)]+'\x20points?');if(!_0x7ade66)return;const _0x2dcd0c=await purchaseToken(_0x44515a);_0x2dcd0c&&updateTokenButtons();return;}});}),_0x2079a2['forEach'](_0x525dba=>{_0x525dba['addEventListener']('click',async _0x3a0f33=>{const _0x55406f=a46_0x272e;_0x3a0f33['preventDefault']();const _0x462785=_0x525dba['closest']('[data-token]'),_0x564af2=_0x462785['dataset']['token'],_0x3ce9ff=TOKENS[_0x564af2];if(_0x525dba['textContent']==='Equipped'){const _0x46df40=window['confirm']('Unequip\x20'+_0x3ce9ff['name']+'?');if(!_0x46df40)return;const _0x1319bc=await unequipToken();_0x1319bc&&updateTokenButtons();}else{const _0x485dd4=window['confirm']('Equip\x20'+_0x3ce9ff[_0x55406f(0x11d)]+_0x55406f(0x129));if(!_0x485dd4)return;const _0x343af1=await equipToken(_0x564af2);_0x343af1&&updateTokenButtons();}});}),_0xf6f4b['forEach'](_0x37b3eb=>{_0x37b3eb['addEventListener']('click',async _0x49840e=>{const _0x3a20c0=a46_0x272e;_0x49840e['preventDefault']();const _0x11036b=_0x37b3eb[_0x3a20c0(0xdf)]('[data-token]'),_0x372dea=_0x11036b[_0x3a20c0(0x10e)]['token'],_0x5d3aec=TOKENS[_0x372dea],_0x5b9bd1=Math['floor'](_0x5d3aec['price']*0.5),_0x57e7b9=window['confirm']('Are\x20you\x20sure\x20you\x20want\x20to\x20sell\x20'+_0x5d3aec[_0x3a20c0(0x11d)]+'\x20for\x20'+_0x5b9bd1+'\x20points?\x20This\x20cannot\x20be\x20undone.');if(!_0x57e7b9)return;const _0x52bf4=await sellToken(_0x372dea);_0x52bf4&&updateTokenButtons();});}),updateTokenButtons();}function updateThemeButtons(){const _0x581d1d=a46_0x7471f5,_0x355ae1=window['ThemeSystem']?window['ThemeSystem'][_0x581d1d(0xcd)]():'default',_0x2db233=auth['currentUser'];document['querySelectorAll'](_0x581d1d(0xfe))['forEach'](_0x35a5c2=>{const _0x291855=_0x581d1d,_0xd5deea=_0x35a5c2[_0x291855(0xdf)]('[data-theme]'),_0x57b578=_0xd5deea['dataset']['theme'],_0x446028=THEMES[_0x57b578];if(!_0x446028)return;_0x35a5c2['disabled']=![],_0x35a5c2[_0x291855(0x124)]['opacity']='',_0x35a5c2['style']['cursor']=_0x291855(0x142),_0x35a5c2['classList']['remove']('current-theme',_0x291855(0x12a),_0x291855(0x117),'cannot-afford',_0x291855(0xe5),'sign-in-paid');if(!_0x2db233){_0x446028[_0x291855(0x138)]===0x0?(_0x35a5c2['textContent']='Sign\x20in\x20to\x20Apply',_0x35a5c2['classList'][_0x291855(0x116)]('sign-in-free')):(_0x35a5c2[_0x291855(0xf1)]='Sign\x20in\x20to\x20Purchase',_0x35a5c2[_0x291855(0xf8)]=!![],_0x35a5c2['style']['opacity']='0.7',_0x35a5c2['classList']['add']('sign-in-paid'));return;}if(_0x57b578===_0x355ae1){_0x35a5c2[_0x291855(0xf1)]=_0x291855(0x101),_0x35a5c2['classList'][_0x291855(0x116)]('current-theme'),_0x35a5c2['disabled']=!![],_0x35a5c2['style'][_0x291855(0x125)]='default';return;}if(userOwnsTheme(_0x57b578)){_0x35a5c2['textContent']='Apply\x20Theme',_0x35a5c2['classList'][_0x291855(0x116)](_0x291855(0x12a));return;}if(userData[_0x291855(0xed)]>=_0x446028['price']){_0x35a5c2['textContent']='Buy\x20for\x20'+_0x446028['price']+'\x20Points',_0x35a5c2['classList'][_0x291855(0x116)](_0x291855(0x117));return;}_0x35a5c2[_0x291855(0xf1)]='Need\x20'+_0x446028[_0x291855(0x138)]+_0x291855(0xd2),_0x35a5c2['classList']['add'](_0x291855(0xf3)),_0x35a5c2[_0x291855(0x124)]['opacity']=_0x291855(0x126),_0x35a5c2['disabled']=!![],_0x35a5c2['style']['cursor']=_0x291855(0xce);});}function updateTokenButtons(){const _0x46af63=a46_0x7471f5,_0x5b2add=auth[_0x46af63(0x113)];document['querySelectorAll']('.token-select-btn')['forEach'](_0x728e34=>{const _0x9329cf=_0x46af63,_0x29ba1f=_0x728e34['closest']('[data-token]'),_0x36dec6=_0x29ba1f['dataset']['token'],_0x1465b3=TOKENS[_0x36dec6],_0x535ea6=_0x29ba1f['querySelector']('.token-equip-btn'),_0x23ccc7=_0x29ba1f[_0x9329cf(0xef)]('.token-sell-btn');if(!_0x1465b3)return;_0x728e34['disabled']=![],_0x728e34['style'][_0x9329cf(0xff)]='',_0x728e34['style']['cursor']=_0x9329cf(0x142);_0x535ea6&&(_0x535ea6['style']['display']=_0x9329cf(0xea),_0x535ea6[_0x9329cf(0xf8)]=![],_0x535ea6['style']['opacity']='',_0x535ea6[_0x9329cf(0xe9)]['remove'](_0x9329cf(0x10a),'can-equip'));_0x23ccc7&&(_0x23ccc7['style']['display']=_0x9329cf(0xea));_0x728e34['classList']['remove'](_0x9329cf(0xdc),_0x9329cf(0x117),_0x9329cf(0xf3),'sign-in');if(!_0x5b2add){_0x728e34['textContent']=_0x9329cf(0x143),_0x728e34['disabled']=!![],_0x728e34['style'][_0x9329cf(0xff)]=_0x9329cf(0x105),_0x728e34['classList']['add'](_0x9329cf(0x100));return;}if(userOwnsToken(_0x36dec6)){_0x728e34['textContent']='Owned',_0x728e34['classList']['add']('owned'),_0x728e34['disabled']=!![],_0x728e34['style']['cursor']=_0x9329cf(0xcb),_0x728e34['style']['background']=_0x9329cf(0x10b);_0x535ea6&&(_0x535ea6[_0x9329cf(0x124)]['display']='block',userHasTokenEquipped(_0x36dec6)?(_0x535ea6['textContent']='Equipped',_0x535ea6[_0x9329cf(0xe9)]['add']('equipped'),_0x535ea6['style']['background']='var(--accent-color,\x20#2196F3)',_0x535ea6[_0x9329cf(0x124)]['cursor']='pointer'):(_0x535ea6[_0x9329cf(0xf1)]=_0x9329cf(0x12b),_0x535ea6['classList']['add']('can-equip'),_0x535ea6['style']['background']='var(--info-color,\x20#17a2b8)',_0x535ea6['style']['cursor']='pointer'));_0x23ccc7&&userData['isAdmin']&&(_0x23ccc7['style']['display']=_0x9329cf(0x119));return;}if(userData['points']>=_0x1465b3['price']){_0x728e34['textContent']='Buy\x20for\x20'+_0x1465b3[_0x9329cf(0x138)]+'\x20Points',_0x728e34['classList'][_0x9329cf(0x116)]('can-afford'),_0x728e34[_0x9329cf(0x124)]['background']='';return;}_0x728e34['textContent']='Need\x20'+_0x1465b3['price']+'\x20Points',_0x728e34['classList']['add'](_0x9329cf(0xf3)),_0x728e34['style']['opacity']='0.5',_0x728e34[_0x9329cf(0xf8)]=!![],_0x728e34[_0x9329cf(0x124)]['cursor']='not-allowed',_0x728e34[_0x9329cf(0x124)]['background']='var(--muted-color,\x20#757575)';});}function showMessage(_0x3d2079,_0x6e656d='info'){const _0x449a84=a46_0x7471f5,_0xab3d1b=document[_0x449a84(0x12f)]('store-message');_0xab3d1b&&_0xab3d1b['remove']();const _0x4d2949=document['createElement']('div');_0x4d2949['id']='store-message',_0x4d2949['className']='store-message\x20store-message-'+_0x6e656d,_0x4d2949[_0x449a84(0xf1)]=_0x3d2079,document['body']['appendChild'](_0x4d2949),requestAnimationFrame(()=>{_0x4d2949['classList']['add']('visible');}),setTimeout(()=>{const _0x37473d=_0x449a84;_0x4d2949[_0x37473d(0xe9)][_0x37473d(0xf4)](_0x37473d(0x12e)),setTimeout(()=>{_0x4d2949['parentNode']&&_0x4d2949['remove']();},0x12c);},0xfa0);}window['RedeemStore']={'refreshUI':()=>{updateThemeButtons(),updateTokenButtons();},'checkOwnership':userOwnsTheme,'checkTokenOwnership':userOwnsToken,'applyTheme':applyTheme,'purchaseTheme':purchaseTheme,'purchaseToken':purchaseToken},console[a46_0x7471f5(0xd1)]('üè™\x20Redeem\x20store\x20loaded');
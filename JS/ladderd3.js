const a33t=a33b;(function(a,b){const s=a33b,c=a();while(!![]){try{const d=-parseInt(s(0x1f3))/0x1*(parseInt(s(0x1c9))/0x2)+parseInt(s(0x1ee))/0x3+-parseInt(s(0x1ea))/0x4*(-parseInt(s(0x211))/0x5)+parseInt(s(0x1cf))/0x6*(-parseInt(s(0x1d2))/0x7)+parseInt(s(0x1ef))/0x8*(parseInt(s(0x1d5))/0x9)+parseInt(s(0x1ec))/0xa*(parseInt(s(0x1f5))/0xb)+parseInt(s(0x1fa))/0xc*(parseInt(s(0x1cd))/0xd);if(d===b)break;else c['push'](c['shift']());}catch(e){c['push'](c['shift']());}}}(a33a,0xa0971));import{collection,getDocs,deleteDoc,doc,getDoc,query,where,updateDoc,Timestamp,onSnapshot,orderBy,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import{getRankStyle}from'./ranks.js';function a33b(a,b){const c=a33a();return a33b=function(d,e){d=d-0x1b9;let f=c[d];if(a33b['lMMDiy']===undefined){var g=function(l){const m='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let n='',o='';for(let p=0x0,q,r,s=0x0;r=l['charAt'](s++);~r&&(q=p%0x4?q*0x40+r:r,p++%0x4)?n+=String['fromCharCode'](0xff&q>>(-0x2*p&0x6)):0x0){r=m['indexOf'](r);}for(let t=0x0,u=n['length'];t<u;t++){o+='%'+('00'+n['charCodeAt'](t)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(o);};a33b['wAZlhX']=g,a=arguments,a33b['lMMDiy']=!![];}const h=c[0x0],i=d+h,j=a[i];return!j?(f=a33b['wAZlhX'](f),a[i]=f):f=j,f;},a33b(a,b);}import a33c from'./firebase-idle-wrapper.js';const styleEl=document[a33t(0x20d)](a33t(0x1e5));styleEl['textContent']=a33t(0x1d6),document['head']['appendChild'](styleEl);const playerCacheD3={'data':null,'timestamp':0x0},CACHE_DURATION=0x7530;async function displayLadderD3(a=![]){const u=a33t,b=document['querySelector'](u(0x1e0));if(!b){console[u(0x1e2)]('D3\x20Ladder\x20table\x20body\x20not\x20found');return;}b[u(0x1b9)]='<tr><td\x20colspan=\x228\x22\x20class=\x22loading-cell\x22>Loading\x20D3\x20ladder\x20data...</td></tr>';try{const c=Date['now']();if(!a&&playerCacheD3['data']&&c-playerCacheD3['timestamp']<CACHE_DURATION){updateLadderDisplayD3(playerCacheD3[u(0x1d9)]);return;}const d=collection(db,'playersD3'),e=await getDocs(d),f=[];e[u(0x1da)](l=>{const v=u,m=l['data']();m[v(0x215)]&&f[v(0x217)]({...m,'id':l['id'],'elo':m[v(0x213)]||0x0,'position':m['position']||Number[v(0x20e)]});});const g=collection(db,u(0x1ba)),h=await getDocs(g),i=new Map();h[u(0x1da)](l=>{const m=l['data']();m['username']&&i['set'](m['username']['toLowerCase'](),m);});for(const l of f){const m=l[u(0x215)]['toLowerCase']();if(i['has'](m)){const n=i['get'](m);n['country']&&(l['country']=n[u(0x20c)][u(0x1e3)]());}}const j=f[u(0x1bb)](o=>o[u(0x215)]),k=await fetchBatchMatchStatsD3(j);f['sort']((o,p)=>{const w=u,q=k['get'](o[w(0x215)])?.['totalMatches']||0x0,r=k['get'](p[w(0x215)])?.[w(0x1e7)]||0x0;if(q===0x0!==(r===0x0))return q===0x0?0x1:-0x1;return(o[w(0x1dc)]||0x3e7)-(p[w(0x1dc)]||0x3e7);}),f[u(0x1da)]((o,p)=>{o['position']=p+0x1;}),playerCacheD3['data']=f,playerCacheD3['timestamp']=c,updateLadderDisplayD3(f);}catch(o){console[u(0x1e2)](u(0x1df),o),b['innerHTML']=u(0x201)+o[u(0x218)]+u(0x1c2);}}function calculateStreakDays(a){const x=a33t;if(!a)return 0x0;const b=a['toDate'](),c=new Date(),d=Math[x(0x1ff)](c-b);return Math['ceil'](d/(0x3e8*0x3c*0x3c*0x18));}async function updatePlayerPositions(a,b){const y=a33t;try{const c=collection(db,y(0x1c3)),d=await getDocs(c),e=[];d[y(0x1da)](h=>{const z=y;e[z(0x217)]({'id':h['id'],...h[z(0x1d9)]()});});const f=e[y(0x1ce)](h=>h['username']===a),g=e['find'](h=>h['username']===b);if(!f||!g){console['error']('Could\x20not\x20find\x20winner\x20or\x20loser\x20in\x20D3\x20players\x20list');return;}if(f[y(0x1dc)]>g['position']){const h=g['position'];for(const i of e){i[y(0x1dc)]>=g[y(0x1dc)]&&i[y(0x1dc)]<f['position']&&i['username']!==a&&await updateDoc(doc(db,y(0x1c3),i['id']),{'position':i['position']+0x1});}await updateDoc(doc(db,y(0x1c3),f['id']),{'position':h});if(h===0x1){const j=doc(db,y(0x1c3),f['id']),k=await getDoc(j);!k['data']()['firstPlaceDate']&&await updateDoc(j,{'firstPlaceDate':Timestamp[y(0x1dd)]()});}if(g[y(0x1dc)]===0x1){const l=doc(db,'playersD3',g['id']);await updateDoc(l,{'firstPlaceDate':null});}}}catch(m){console['error']('Error\x20updating\x20D3\x20player\x20positions:',m);}}async function updateLadderDisplayD3(a){const A=a33t;a[A(0x207)]((g,h)=>g['position']-h['position']);const b=document['querySelector'](A(0x1e0));if(!b)return;b[A(0x1b9)]='';const c=a['map'](g=>g[A(0x215)]),d=await fetchBatchMatchStatsD3(c),e=document[A(0x1f1)](A(0x1e8));e[A(0x1b9)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20<th>Rank</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<th>Username</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<th>ELO</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<th>Matches</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<th>Wins</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<th>Losses</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<th>K/D</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<th>Win\x20Rate</th>\x0a\x20\x20\x20\x20';const f=a['map'](g=>{const B=A,h=d[B(0x202)](g['username'])||{'totalMatches':0x0,'wins':0x0,'losses':0x0,'kda':0x0,'winRate':0x0,'totalKills':0x0,'totalDeaths':0x0};return createPlayerRowD3(g,h);})['join']('');b[A(0x1b9)]=f,getPlayersLastEloChangesD3(c)['then'](g=>{const h=new Map();b['querySelectorAll']('tr')['forEach']((i,j)=>{j<c['length']&&h['set'](c[j],i);}),g['forEach']((i,j)=>{const C=a33b,k=h[C(0x202)](j);if(k&&i!==0x0){const l=k[C(0x1f1)]('td:nth-child(3)');if(l){const m=i>0x0?'+'+i:''+i,n=l['querySelector'](C(0x20b));n&&(n[C(0x1d7)]=m,n[C(0x1e5)]['color']=i>0x0?'#4CAF50':C(0x1f9),n['style']['fontWeight']='bold',n['style']['fontSize']='0.85em',n['style'][C(0x1f8)]='inline',n[C(0x1e5)][C(0x212)]='visible',n[C(0x1e5)]['opacity']='1');}}});})[A(0x1c1)](g=>console[A(0x1e2)](A(0x1d0),g));}function a33a(){const L=['nKfYvgXUqG','rxjYB3iGDxbKyxrPBMCGrdmGruXpihrYzw5KigLUzgLJyxrVCNm6','cIaGicaGicaGicaGicaGica8l2e+cIaGicaGicaGicaGicaGica','nJyYotyYm09qAwzxuW','jMXHzgrLCJ1KmYiGcIaGicaGicaGicaGicaGicaGicbZDhLSzt0Iy29SB3i6ia','rdm6iezPBMfSievmtYbJAgfUz2vZoG','mZuXnZu5nNfZz2riwa','cIaGlNn0CMvHAY1PBMrPy2f0B3iGEWOGicaGzM9UDc1ZAxPLoIaWlJLLBtSkicaGignVBg9YoIaJrKy0ntaWoWOGicaGBwfYz2LUlwXLzNq6idvWEdSkicaGigzVBNqTD2vPz2H0oIbIB2XKoWOGih0k','Dgv4DenVBNrLBNq','y2HHBMDL','zgf0yq','zM9YrwfJAa','Dg9gAxHLza','Cg9ZAxrPB24','BM93','C2v0','rxjYB3iGBg9HzgLUzYbemYbSywrKzxi6','i2XHzgrLCI1KmYb0yM9KEq','D2LUBMvYvxnLCM5HBwu','zxjYB3i','Dg9mB3DLCKnHC2u','cIaGicaGicaGicaGidWVzgL2pGOGicaGicaGidWVDgq+cIaGicaGicaGphrKihn0EwXLpsjJB2XVCJOG','C3r5Bgu','pc90zd4kicaGicaGica8DgqGC3r5Bgu9iNbVC2L0Aw9UoIbYzwXHDgL2ztSIpGOGicaGicaGicaGica8zgL2ihn0EwXLpsjKAxnWBgf5oIbMBgv4oYbHBgLNBI1PDgvTCZOGy2vUDgvYoYbWB3nPDgLVBJOGCMvSyxrPDMu7iJ4kicaGicaGicaGicaGicaGidXHigHYzwy9iNbYB2zPBguUAhrTBd91C2vYBMfTzt0','Dg90ywXnyxrJAgvZ','i2XHzgrLCI1KmYb0AgvHzcb0CG','DgLTzxn0yw1W','mJG4whzvsfzY','lNbUzYiGcIaGicaGicaGicaGicaGicaGicaGicaGigfSDd0I','nJmYotG0mgfrEw13vG','jtWVDgq+cIaGica8l3rYpG','mtiXoduWmwLIqvPMyG','mJrXCxr6zMy','Bg9ZC2vZ','CxvLCNLtzwXLy3rVCG','Dg90ywXezwf0Ahm','ntK2n0n1EuvgBq','iZuWqZG3oa','mtfRrvbuDeS','zNjVBq','CgXHEwvYvxnLCM5HBwu','zgLZCgXHEq','i0y0ndmZnG','mZe5ntzjy2vIyK0','D2LUBMvYu2nVCMu','Aw5JBhvKzxm','igzHBgXIywnRievmtYbJAgfUz2u6ia','pc9ZCgfUpGOGicaGicaGicaGicaGicaGphnWyw4Gy2XHC3m9iNrYzw5KlwLUzgLJyxrVCIiGC3r5Bgu9iM1HCMDPBI1Szwz0oIa1ChG7iJ48l3nWyw4+cIaGicaGicaGicaGidWVzgL2pGOGicaGicaGidWVDgq+cIaGicaGicaGphrKpG','ywjZ','BMv3rwXV','cIaGicaGicaGicaGidX0CJ4kicaGicaGicaGicaGicaGidX0zcbJB2XZCgfUpsi4iIbZDhLSzt0IDgv4Dc1HBgLNBJOGy2vUDgvYoYbJB2XVCJOGCMvKoYi+cIaGicaGicaGicaGicaGicaGicaGrxjYB3iGBg9HzgLUzYbemYbSywrKzxiGzgf0ytOG','z2v0','Bg9Zzxjty29Yzq','AgfZ','Bg9N','zgvZyW','C29YDa','rdm6iezVDw5Kia','rdm6ievYCM9YigzLDgnOAw5NievmtYbOAxn0B3j5oG','igzHBgXIywnRigvUDhjPzxm','lNrYzw5KlwLUzgLJyxrVCG','y291BNrYEq','y3jLyxrLrwXLBwvUDa','tufyx1nbrKvFsu5uruDfuG','rdm6ifbSyxLLCIbjrcbTyxbWAw5NCZO','CgXHEwvY','mti2nZb3ANviB2O','DMLZAwjPBgL0Eq','zwXVuMf0Aw5N','zwXV','DxnLCM5HBwu','rdm6ia','ChvZAa','BwvZC2fNzq','z3jHEq','D2LUuMf0zq','ievmtYbJAgfUz2u6ia','Aw5Uzxjive1m','DxnLCLbYB2zPBgvZ','BwfW','cIaGica8Dhi+cIaGicaGicaGphrKpG','ChjLDMLVDxnfBg8','rdm6ie5VigvUDhjPzxmGzM91BMqGAw4GzwXVsgLZDg9YEuqZlcb0CNLPBMCGzMfSBgjHy2SUlI4','Bg9ZzxjvC2vYBMfTzq','i0mWqZbdma','y2f0y2G','cIaGicaGicaGicaGicaGica8l3rKpGOGicaGicaGicaGica8l3rYpGOGicaGicaGia','CgXHEwvYC0qZ','pc90zd4kicaGicaGica8Dgq+','C2L6zq','zw50CMLLCW','CgLSB3q','C3rYAw5N','ndaYyNPeCe5b','rdm6iezVDw5KihbPBg90igvUDhj5oG','CgXHEwvYswq','Dg90ywXlAwXSCW','mJaWmMTwB0LyrW','zMLUza'];a33a=function(){return L;};return a33a();}async function fetchBatchMatchStatsD3(a){const b=new Map();try{const c=collection(db,'approvedMatchesD3'),d=await getDocs(c);d['forEach'](e=>{const D=a33b,f=e[D(0x1d9)]();if(a['includes'](f[D(0x1e1)])){const g=f[D(0x1e1)];!b[D(0x204)](g)&&b[D(0x1de)](g,{'totalMatches':0x0,'wins':0x0,'losses':0x0,'totalKills':0x0,'totalDeaths':0x0,'kda':0x0,'winRate':0x0});const h=b['get'](g);h['wins']++,h[D(0x1e7)]++,h[D(0x1cc)]+=parseInt(f[D(0x1fb)])||0x0,h[D(0x1f2)]+=parseInt(f['loserScore'])||0x0;}if(a['includes'](f[D(0x1bf)])){const i=f['loserUsername'];!b['has'](i)&&b['set'](i,{'totalMatches':0x0,'wins':0x0,'losses':0x0,'totalKills':0x0,'totalDeaths':0x0,'kda':0x0,'winRate':0x0});const j=b[D(0x202)](i);j[D(0x1f0)]++,j[D(0x1e7)]++,j['totalKills']+=parseInt(f[D(0x203)])||0x0,j[D(0x1f2)]+=parseInt(f['winnerScore'])||0x0;}}),b['forEach'](e=>{const E=a33b;e['kda']=e['totalDeaths']>0x0?(e[E(0x1cc)]/e['totalDeaths'])['toFixed'](0x2):e['totalKills'],e[E(0x21a)]=e['totalMatches']>0x0?(e['wins']/e['totalMatches']*0x64)[E(0x1db)](0x1):0x0;});}catch(e){console['error']('Error\x20fetching\x20batch\x20match\x20stats\x20for\x20D3:',e);}return b;}function createPlayerRowD3(a,b){const F=a33t,c=parseFloat(a[F(0x214)])||0x0;let d=F(0x219);if(c>=0x7d0)d=F(0x1f4);else{if(c>=0x708)d='#FFD700';else{if(c>=0x640)d=F(0x1c0);else c>=0x578&&(d='#CD7F32');}}let e='';return a['country']&&(e='<img\x20src=\x22../images/flags/'+a[F(0x20c)][F(0x1e3)]()+F(0x1eb)+a[F(0x20c)]+'\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20class=\x22player-flag\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20onerror=\x22this.style.display=\x27none\x27\x22>'),F(0x1bc)+a['position']+F(0x1e6)+encodeURIComponent(a[F(0x215)])+F(0x1d3)+d+';\x20text-decoration:\x20none;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+a['username']+F(0x1d1)+e+F(0x1e4)+d+';\x20position:\x20relative;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22elo-container\x22\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22elo-value\x22>'+c+F(0x1fe)+b[F(0x1e7)]+F(0x1c4)+b['wins']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+b[F(0x1f0)]+F(0x1c4)+b['kda']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+b[F(0x21a)]+F(0x1ed);}async function getPlayersLastEloChangesD3(a){const G=a33t,b=new Map();a['forEach'](c=>b['set'](c,0x0));try{console['log']('D3:\x20Looking\x20for\x20ELO\x20changes\x20for\x20users:',a);const c=new Map(),d=await getDocs(collection(db,G(0x1c3)));d[G(0x1da)](j=>{const H=G,k=j[H(0x1d9)]();k[H(0x215)]&&c[H(0x1de)](j['id'],k[H(0x215)]);}),console['log'](G(0x20f),Array[G(0x1f6)](c['entries']()));const e=collection(db,'eloHistoryD3'),f=query(e,orderBy('timestamp',G(0x206)),limit(0x64)),g=await getDocs(f);g['empty']?console['log']('D3:\x20eloHistoryD3\x20is\x20empty,\x20trying\x20fallback...'):console['log'](G(0x208)+g[G(0x1c5)]+'\x20entries\x20in\x20eloHistoryD3');const h=new Map();g[G(0x1da)](j=>{const I=G,k=j['data']();let l=null;if(k[I(0x215)])l=k[I(0x215)];else{if(k['playerUsername'])l=k[I(0x1f7)];else{if(k[I(0x210)]&&typeof k['player']===I(0x1c8))l=k[I(0x210)];else{if(k[I(0x210)]&&c[I(0x204)](k['player']))l=c[I(0x202)](k[I(0x210)]);else k[I(0x1cb)]&&c['has'](k['playerId'])&&(l=c[I(0x202)](k['playerId']));}}}(k['username']==='pilot'||k[I(0x1f7)]===I(0x1c7)||k['player']&&c['get'](k[I(0x210)])===I(0x1c7))&&console[I(0x205)](I(0x1ca),k),l&&a[I(0x1fc)](l)&&(!h['has'](l)&&h[I(0x1de)](l,[]),h['get'](l)[I(0x217)]({...k,'timestamp':k[I(0x1e9)]?.['seconds']||0x0}));}),console['log']('D3:\x20Found\x20entries\x20for\x20'+h['size']+'\x20players'),h[G(0x1da)]((j,k)=>{const J=G;if(j['length']>0x0){j['sort']((m,n)=>n[J(0x1e9)]-m[J(0x1e9)]);const l=j['find'](m=>m[J(0x1d8)]!==undefined||m['newElo']!==undefined&&m['previousElo']!==undefined);if(l){let m;if(l['change']!==undefined)m=l[J(0x1d8)];else l['newElo']!==undefined&&l[J(0x1bd)]!==undefined&&(m=l['newElo']-l['previousElo']);m!==undefined&&(b['set'](k,m),console[J(0x205)](J(0x216)+k+J(0x21b)+m));}}});if(h[G(0x1c5)]===0x0){console['log'](G(0x1be));const j=collection(db,'eloHistory'),k=query(j,where('gameMode','==','D3'),orderBy('timestamp','desc'),limit(0x32));try{const l=await getDocs(k);console[G(0x205)](G(0x208)+l['size']+G(0x20a)),l['forEach'](m=>{const K=G,n=m['data']();let o=n[K(0x215)]||n[K(0x1f7)];!o&&n[K(0x210)]&&c['has'](n[K(0x210)])&&(o=c['get'](n['player']));if(o&&a['includes'](o)){const p=n[K(0x1d8)]||(n[K(0x200)]!==undefined&&n['previousElo']!==undefined?n['newElo']-n['previousElo']:0x0);p!==0x0&&(b['set'](o,p),console[K(0x205)](K(0x216)+o+K(0x1fd)+p));}});}catch(m){console[G(0x205)]('D3:\x20Fallback\x20query\x20failed:',m);}}const i=Array[G(0x1f6)](b[G(0x1c6)]())['filter'](([n,o])=>o!==0x0);console['log'](G(0x1d4),i);}catch(n){console[G(0x1e2)](G(0x209),n);}return b;}export{displayLadderD3,updatePlayerPositions};
(function(a,b){const t=a32b,c=a();while(!![]){try{const d=-parseInt(t(0xb6))/0x1*(-parseInt(t(0x9f))/0x2)+-parseInt(t(0xae))/0x3+-parseInt(t(0x71))/0x4+-parseInt(t(0xca))/0x5+-parseInt(t(0x7f))/0x6*(parseInt(t(0x88))/0x7)+parseInt(t(0x98))/0x8*(parseInt(t(0xbe))/0x9)+parseInt(t(0x8e))/0xa*(parseInt(t(0x8a))/0xb);if(d===b)break;else c['push'](c['shift']());}catch(e){c['push'](c['shift']());}}}(a32a,0x3f706));import{collection,getDocs,deleteDoc,doc,getDoc,query,where,updateDoc,Timestamp,onSnapshot,orderBy,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import{getRankStyle}from'./ranks.js';import a32c from'./firebase-idle-wrapper.js';const playerCacheD2={'data':null,'timestamp':0x0},CACHE_DURATION=0x7530;async function displayLadderD2(a=![]){const u=a32b,b=document[u(0xaa)]('#ladder-d2\x20tbody');if(!b){console['error'](u(0x8f));return;}b['innerHTML']='<tr><td\x20colspan=\x228\x22\x20class=\x22loading-cell\x22>Loading\x20D2\x20ladder\x20data...</td></tr>';try{const c=Date[u(0x82)]();if(!a&&playerCacheD2['data']&&c-playerCacheD2['timestamp']<CACHE_DURATION){updateLadderDisplayD2(playerCacheD2[u(0xa5)]);return;}const d=collection(db,u(0x6e)),e=query(d,orderBy('position',u(0xac))),f=await a32c[u(0xc6)](d),g=[];f['forEach'](m=>{const v=u,n=m[v(0xa5)]();n[v(0x86)]&&g['push']({...n,'id':m['id'],'elo':n['eloRating']||0x0,'position':n['position']||Number['MAX_SAFE_INTEGER']});});const h=collection(db,u(0x8b)),i=await getDocs(h),j=new Map();i[u(0xc2)](m=>{const w=u,n=m[w(0xa5)]();n[w(0x86)]&&j[w(0x7e)](n[w(0x86)]['toLowerCase'](),n);});for(const m of g){const n=m[u(0x86)]['toLowerCase']();if(j['has'](n)){const o=j[u(0x77)](n);o[u(0x9a)]&&(m['country']=o[u(0x9a)][u(0xb5)]());}}const k=g[u(0xc9)](q=>q[u(0x86)]),l=await fetchBatchMatchStatsD2(k);g['sort']((p,q)=>{const x=u,r=l[x(0x77)](p['username'])?.['totalMatches']||0x0,s=l[x(0x77)](q[x(0x86)])?.['totalMatches']||0x0;if(r===0x0!==(s===0x0))return r===0x0?0x1:-0x1;return(p[x(0xaf)]||0x3e7)-(q['position']||0x3e7);}),g['forEach']((p,q)=>{p['position']=q+0x1;}),playerCacheD2[u(0xa5)]=g,playerCacheD2['timestamp']=c,updateLadderDisplayD2(g);}catch(p){console[u(0x96)]('Error\x20loading\x20D2\x20ladder:',p),b[u(0xb7)]=u(0x7c)+p['message']+u(0x92);}}function getNextAvailablePositionD2(a){const y=a32b;if(a[y(0x94)]===0x0)return 0x1;let b=0x0;return a['forEach'](c=>{const z=y;c['position']&&typeof c[z(0xaf)]==='number'&&c[z(0xaf)]>b&&(b=c['position']);}),b+0x1;}function a32b(a,b){const c=a32a();return a32b=function(d,e){d=d-0x6d;let f=c[d];if(a32b['kORgrZ']===undefined){var g=function(l){const m='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let n='',o='';for(let p=0x0,q,r,s=0x0;r=l['charAt'](s++);~r&&(q=p%0x4?q*0x40+r:r,p++%0x4)?n+=String['fromCharCode'](0xff&q>>(-0x2*p&0x6)):0x0){r=m['indexOf'](r);}for(let t=0x0,u=n['length'];t<u;t++){o+='%'+('00'+n['charCodeAt'](t)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(o);};a32b['yNWaQP']=g,a=arguments,a32b['kORgrZ']=!![];}const h=c[0x0],i=d+h,j=a[i];return!j?(f=a32b['yNWaQP'](f),a[i]=f):f=j,f;},a32b(a,b);}async function updatePlayerPositions(a,b){const A=a32b;try{const c=collection(db,A(0x6e)),d=await getDocs(c),e=[];d[A(0xc2)](h=>{const B=A;e[B(0xa3)]({'id':h['id'],...h['data']()});});const f=e[A(0xa2)](h=>h[A(0x86)]===a),g=e['find'](h=>h['username']===b);if(!f||!g){console[A(0x96)]('Could\x20not\x20find\x20winner\x20or\x20loser\x20in\x20D2\x20players\x20list');return;}if(f[A(0xaf)]>g['position']){const h=g['position'];for(const i of e){i[A(0xaf)]>=g[A(0xaf)]&&i['position']<f['position']&&i[A(0x86)]!==a&&await updateDoc(doc(db,'playersD2',i['id']),{'position':i[A(0xaf)]+0x1});}await updateDoc(doc(db,A(0x6e),f['id']),{'position':h});if(h===0x1){const j=doc(db,A(0x6e),f['id']),k=await getDoc(j);!k[A(0xa5)]()[A(0xbc)]&&await updateDoc(j,{'firstPlaceDate':Timestamp[A(0x82)]()});}if(g[A(0xaf)]===0x1){const l=doc(db,A(0x6e),g['id']);await updateDoc(l,{'firstPlaceDate':null});}playerCacheD2[A(0x72)]=0x0;}}catch(m){console[A(0x96)](A(0xc1),m);}}function calculateStreakDays(a){const C=a32b;if(!a)return 0x0;const b=a[C(0x84)](),c=new Date(),d=Math['abs'](c-b);return Math['ceil'](d/(0x3e8*0x3c*0x3c*0x18));}function getPlayerRankNameD2(a){const D=a32b;if(a>=0x834)return'Emerald';if(a>=0x708)return'Gold';if(a>=0x640)return D(0xa6);if(a>=0x578)return D(0xb2);return'Unranked';}async function updateLadderDisplayD2(a){const E=a32b;a[E(0xa0)]((g,h)=>g['position']-h[E(0xaf)]);const b=document['querySelector'](E(0x89));if(!b)return;b[E(0xb7)]='';const c=a[E(0xc9)](g=>g['username']),d=await fetchBatchMatchStatsD2(c),e=document[E(0xaa)]('#ladder-d2\x20thead\x20tr');e&&(e['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Rank</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Username</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>ELO</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Matches</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Wins</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Losses</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>K/D</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Win\x20Rate</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20');const f=a[E(0xc9)](g=>{const F=E,h=d[F(0x77)](g['username'])||{'totalMatches':0x0,'wins':0x0,'losses':0x0,'kda':0x0,'winRate':0x0,'totalKills':0x0,'totalDeaths':0x0};return createPlayerRowD2(g,h);})[E(0xad)]('');b['innerHTML']=f,getPlayersLastEloChangesD2(c)[E(0x93)](g=>{const G=E,h=new Map();b[G(0x70)]('tr')[G(0xc2)]((i,j)=>{const H=G;j<c[H(0x94)]&&h[H(0x7e)](c[j],i);}),g[G(0xc2)]((i,j)=>{const I=G,k=h['get'](j);if(k&&i!==0x0){const l=k[I(0xaa)]('td:nth-child(3)');if(l){const m=i>0x0?'+'+i:''+i,n=l['querySelector']('.trend-indicator');n&&(n['textContent']=m,n[I(0xc5)][I(0x81)]=i>0x0?I(0xa8):I(0xb9),n[I(0xc5)][I(0xab)]=I(0x90),n[I(0xc5)][I(0xa1)]=I(0x9d),n['style'][I(0x75)]=I(0x83),n[I(0xc5)][I(0x95)]=I(0x8c),n['style']['opacity']='1');}}});})[E(0x80)](g=>console['error'](E(0xb8),g));}function createPlayerRowD2(a,b){const J=a32b,c=parseFloat(a['elo'])||0x0;let d=J(0x7a);if(c>=0x7d0)d='#50C878';else{if(c>=0x708)d='#FFD700';else{if(c>=0x640)d='#C0C0C0';else c>=0x578&&(d=J(0xba));}}let e='';return a['country']&&(e=J(0xb1)+a['country']['toLowerCase']()+'.png\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20alt=\x22'+a['country']+J(0x9b)),J(0xa9)+a['position']+J(0xbd)+encodeURIComponent(a[J(0x86)])+'&ladder=d2\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20style=\x22color:\x20'+d+';\x20text-decoration:\x20none;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+a['username']+J(0x6f)+e+J(0xcc)+d+';\x20position:\x20relative;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22elo-container\x22\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22elo-value\x22>'+c+J(0xcb)+b['totalMatches']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+b['wins']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+b[J(0x9e)]+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+b['kda']+J(0x76)+b['winRate']+J(0x7d);}async function getPlayersLastEloChangesD2(a){const K=a32b,b=new Map();a[K(0xc2)](c=>b[K(0x7e)](c,0x0));try{const c=collection(db,K(0x91)),d=query(c,orderBy('timestamp',K(0x74)),limit(0x64)),e=await getDocs(d),f=new Map(),g=await getDocs(collection(db,K(0x6e)));g[K(0xc2)](i=>{const L=K,j=i[L(0xa5)]();j[L(0x86)]&&f['set'](i['id'],j[L(0x86)]);});const h=new Map();e['forEach'](i=>{const M=K,j=i[M(0xa5)]();let k=j['username']||j[M(0xa4)];!k&&j['player']&&f['has'](j['player'])&&(k=f['get'](j[M(0x7b)]));if(!k&&j[M(0xcd)]){}k&&a[M(0x99)](k)&&(!h[M(0xbf)](k)&&h['set'](k,[]),h['get'](k)[M(0xa3)]({...j,'timestamp':j['timestamp']?.['seconds']||0x0,'username':k}));}),h['forEach']((i,j)=>{const N=K;if(i['length']>0x0){i[N(0xa0)]((l,m)=>m['timestamp']-l['timestamp']);const k=i['find'](l=>l['change']!==undefined||l[N(0xb3)]!==undefined&&l[N(0xb4)]!==undefined);if(k){let l;if(k[N(0x79)]!==undefined)l=k[N(0x79)];else k['newElo']!==undefined&&k[N(0xb4)]!==undefined&&(l=k['newElo']-k[N(0xb4)]);l!==undefined&&b[N(0x7e)](j,l);}}});if(h['size']===0x0){const i=collection(db,K(0x6d)),j=query(i,where('gameMode','==','D2'),orderBy(K(0x72),K(0x74)),limit(0x32));try{const k=await getDocs(j);console[K(0xc0)]('D2:\x20Found',k[K(0x97)],K(0x9c)),k['forEach'](l=>{const O=K,m=l['data'](),n=m[O(0x86)]||m[O(0xa4)];if(n&&a['includes'](n)){const o=m['change']||(m['newElo']!==undefined&&m[O(0xb4)]!==undefined?m['newElo']-m['previousElo']:0x0);o!==0x0&&(b[O(0x7e)](n,o),console[O(0xc0)]('D2:\x20'+n+O(0xc8)+o));}});}catch(l){}}}catch(m){console['error']('D2:\x20Error\x20fetching\x20ELO\x20history:',m);}return b;}async function fetchBatchMatchStatsD2(a){const P=a32b,b=new Map();try{a['forEach'](e=>{b['set'](e,{'totalMatches':0x0,'wins':0x0,'losses':0x0,'totalKills':0x0,'totalDeaths':0x0,'kda':0x0,'winRate':0x0});});const c=collection(db,'approvedMatchesD2'),d=await getDocs(c);d[P(0xc2)](e=>{const Q=P,f=e[Q(0xa5)](),g=f[Q(0x73)],h=f[Q(0xbb)];if(a[Q(0x99)](g)){const i=b[Q(0x77)](g);i['wins']++,i[Q(0x78)]++,i[Q(0xce)]+=parseInt(f['winnerScore'])||0x0,i[Q(0x8d)]+=parseInt(f[Q(0x87)])||0x0;}if(a['includes'](h)){const j=b['get'](h);j['losses']++,j[Q(0x78)]++,j['totalKills']+=parseInt(f['loserScore'])||0x0,j['totalDeaths']+=parseInt(f[Q(0xa7)])||0x0;}}),a['forEach'](e=>{const R=P,f=b['get'](e);f[R(0xc4)]=f['totalDeaths']>0x0?(f[R(0xce)]/f[R(0x8d)])['toFixed'](0x2):f['totalKills']['toFixed'](0x2),f[R(0x85)]=f[R(0x78)]>0x0?(f[R(0xb0)]/f['totalMatches']*0x64)[R(0xc3)](0x1):0x0;});}catch(e){console['error'](P(0xc7),e);}return b;}function a32a(){const S=['pc90zd4kicaGicaGica8DgqGC3r5Bgu9iNbVC2L0Aw9UoIbYzwXHDgL2ztSIpGOGicaGicaGicaGica8zgL2ihn0EwXLpsjKAxnWBgf5oIbMBgv4oYbHBgLNBI1PDgvTCZOGy2vUDgvYoYbWB3nPDgLVBJOGCMvSyxrPDMu7iJ4kicaGicaGicaGicaGicaGidXHigHYzwy9iNbYB2zPBguUAhrTBd91C2vYBMfTzt0','mtHvwwvZshC','AgfZ','Bg9N','rxjYB3iGDxbKyxrPBMCGrdiGCgXHEwvYihbVC2L0Aw9UCZO','zM9YrwfJAa','Dg9gAxHLza','A2rH','C3r5Bgu','z2v0rg9JDw1LBNrZ','rxjYB3iGzMv0y2HPBMCGyMf0y2GGrdiGBwf0y2GGC3rHDhm6','igzHBgXIywnRievmtYbJAgfUz2u6ia','BwfW','mJeYmtqWmhjYyur4Dq','pc9ZCgfUpGOGicaGicaGicaGicaGicaGphnWyw4Gy2XHC3m9iNrYzw5KlwLUzgLJyxrVCIiGC3r5Bgu9iM1HCMDPBI1Szwz0oIa1ChG7iJ48l3nWyw4+cIaGicaGicaGicaGidWVzgL2pGOGicaGicaGidWVDgq+cIaGicaGicaGphrKpG','cIaGicaGicaGicaGidWVzgL2pGOGicaGicaGidWVDgq+cIaGicaGicaGphrKihn0EwXLpsjJB2XVCJOG','Bwf0y2Hjza','Dg90ywXlAwXSCW','zwXVsgLZDg9YEq','CgXHEwvYC0qY','cIaGicaGicaGicaGicaGica8l2e+cIaGicaGicaGicaGicaGica','CxvLCNLtzwXLy3rVCKfSBa','ntG4ndyWrKDSz3rv','DgLTzxn0yw1W','D2LUBMvYvxnLCM5HBwu','zgvZyW','zgLZCgXHEq','pc90zd4kicaGicaGica8Dgq+','z2v0','Dg90ywXnyxrJAgvZ','y2HHBMDL','z3jHEq','CgXHEwvY','cIaGicaGicaGicaGidX0CJ4kicaGicaGicaGicaGicaGidX0zcbJB2XZCgfUpsi4iIbZDhLSzt0IDgv4Dc1HBgLNBJOGy2vUDgvYoYbJB2XVCJOGCMvKoYi+cIaGicaGicaGicaGicaGicaGicaGrxjYB3iGBg9HzgLUzYbemIbSywrKzxiGzgf0ytOG','jtWVDgq+cIaGica8l3rYpG','C2v0','mZa2ndyWmMrJDwnIva','y2f0y2G','y29SB3i','BM93','Aw5SAw5L','Dg9eyxrL','D2LUuMf0zq','DxnLCM5HBwu','Bg9Zzxjty29Yzq','n3nHu1vwqq','i2XHzgrLCI1KmIb0yM9KEq','mJeWnZzhrNLuqwW','DxnLCLbYB2zPBgvZ','DMLZAwjSzq','Dg90ywXezwf0Ahm','nJCZmePnzM9SCW','rdiGtgfKzgvYihrHyMXLigjVzhKGBM90igzVDw5K','yM9Sza','zwXVsgLZDg9YEuqY','cIaGicaGicaGicaGicaGica8l3rKpGOGicaGicaGicaGica8l3rYpGOGicaGicaGia','DgHLBG','BgvUz3rO','DMLZAwjPBgL0Eq','zxjYB3i','C2L6zq','ndu0mdqWrfLQB3zg','Aw5JBhvKzxm','y291BNrYEq','iIakicaGicaGicaGicaGicaGicaGicaGicaGy2XHC3m9iNbSyxLLCI1MBgfNiIakicaGicaGicaGicaGicaGicaGicaGicaGC3r5Bgu9iM1HCMDPBI1Szwz0oIa1ChG7ihzLCNrPy2fSlwfSAwDUoIbTAwrKBgu7iGOGicaGicaGicaGicaGicaGicaGicaGicbVBMvYCM9Ypsj0AgLZlNn0EwXLlMrPC3bSyxK9j25VBMuNiJ4','zMfSBgjHy2SGzw50CMLLCW','mc44nwvT','Bg9ZC2vZ','mZK3mtrQu2DkDLO','C29YDa','zM9UDfnPEMu','zMLUza','ChvZAa','CgXHEwvYvxnLCM5HBwu','zgf0yq','u2LSDMvY','D2LUBMvYu2nVCMu','iZrdquy1ma','cIaGica8Dhi+cIaGicaGicaGphrKpG','CxvLCNLtzwXLy3rVCG','zM9UDfDLAwDODa','yxnJ','AM9PBG','mtq5mZq3mMfhALDuuG','Cg9ZAxrPB24','D2LUCW','pgLTzYbZCMm9iI4Ul2LTywDLCY9MBgfNCY8','qNjVBNPL','BMv3rwXV','ChjLDMLVDxnfBg8','Dg9mB3DLCKnHC2u','mJjxBuvPr2S','Aw5Uzxjive1m','rxjYB3iGDxbKyxrPBMCGrdiGruXpihrYzw5KigLUzgLJyxrVCNm6','i0y0ndmZnG','i0nen0yZmG','Bg9ZzxjvC2vYBMfTzq','zMLYC3rqBgfJzurHDgu'];a32a=function(){return S;};return a32a();}export{displayLadderD2,updatePlayerPositions};
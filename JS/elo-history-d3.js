const a15_0x404de0=(function(){let _0x3c14f7=!![];return function(_0x3e7a87,_0x2de5f0){const _0x3e0427=_0x3c14f7?function(){if(_0x2de5f0){const _0x3c4a13=_0x2de5f0['apply'](_0x3e7a87,arguments);return _0x2de5f0=null,_0x3c4a13;}}:function(){};return _0x3c14f7=![],_0x3e0427;};}()),a15_0x4316ff=a15_0x404de0(this,function(){const _0x2d83ae=a15_0x5598;let _0x36e3e7;try{const _0x1a35ab=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x36e3e7=_0x1a35ab();}catch(_0x4b1447){_0x36e3e7=window;}const _0x58ec3=_0x36e3e7['console']=_0x36e3e7['console']||{},_0x3aeb32=['log',_0x2d83ae(0xa5),'info','error',_0x2d83ae(0xb2),'table','trace'];for(let _0x26f281=0x0;_0x26f281<_0x3aeb32['length'];_0x26f281++){const _0x3ffbf8=a15_0x404de0['constructor'][_0x2d83ae(0xae)][_0x2d83ae(0xaf)](a15_0x404de0),_0x1a2f1f=_0x3aeb32[_0x26f281],_0x41c6d0=_0x58ec3[_0x1a2f1f]||_0x3ffbf8;_0x3ffbf8['__proto__']=a15_0x404de0[_0x2d83ae(0xaf)](a15_0x404de0),_0x3ffbf8[_0x2d83ae(0xa6)]=_0x41c6d0[_0x2d83ae(0xa6)]['bind'](_0x41c6d0),_0x58ec3[_0x1a2f1f]=_0x3ffbf8;}});a15_0x4316ff();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc,where}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D3=[{'name':'Emerald','elo':0x7d0},{'name':'Gold','elo':0x708},{'name':'Silver','elo':0x640},{'name':'Bronze','elo':0x578},{'name':'Unranked','elo':0x4b0}];function a15_0x5598(_0x4bbe88,_0x4250c3){const _0x4316ff=a15_0x4036();return a15_0x5598=function(_0x404de0,_0xadfe1e){_0x404de0=_0x404de0-0xa2;let _0x403600=_0x4316ff[_0x404de0];return _0x403600;},a15_0x5598(_0x4bbe88,_0x4250c3);}let lastVisibleD3=null;async function getUsernameByIdD3(_0x37a388){const _0x2001b4=a15_0x5598;try{if(!_0x37a388)return _0x2001b4(0xa4);const _0x51faf5=await getDoc(doc(db,'playersD3',_0x37a388));if(_0x51faf5[_0x2001b4(0xaa)]())return _0x51faf5['data']()['username']||'Unknown\x20Player';const _0x51c878=await getDocs(query(collection(db,_0x2001b4(0xab)),where('winnerId','==',_0x37a388),limit(0x1)));if(!_0x51c878['empty'])return _0x51c878['docs'][0x0][_0x2001b4(0xac)]()[_0x2001b4(0xb1)]||'Unknown\x20Player';const _0xdb9e8f=await getDocs(query(collection(db,'approvedMatchesD3'),where('loserId','==',_0x37a388),limit(0x1)));if(!_0xdb9e8f['empty'])return _0xdb9e8f['docs'][0x0][_0x2001b4(0xac)]()['loserUsername']||'Unknown\x20Player';return'Unknown\x20Player';}catch(_0x1e09cf){return console['error']('Error\x20getting\x20D3\x20username:',_0x1e09cf),'Unknown\x20Player';}}export async function recordEloChangeD3({playerId:_0xcd1e5e,previousElo:_0x4ce96f,newElo:_0xfbecff,opponentId:_0x46d595,matchResult:_0x445d6c,previousPosition:_0x5139f4,newPosition:_0x36b5b0,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x1cc88b,timestamp:_0x326d36}){const _0x2121d9=a15_0x5598;try{const _0x4ae169=doc(collection(db,'eloHistoryD3'));let _0x285756='match';if(isPromotion)_0x285756='promotion';if(isDemotion)_0x285756='demotion';let _0x4f492f='Unranked';if(_0xfbecff>=0x7d0)_0x4f492f=_0x2121d9(0xa8);else{if(_0xfbecff>=0x708)_0x4f492f=_0x2121d9(0xad);else{if(_0xfbecff>=0x640)_0x4f492f='Silver';else{if(_0xfbecff>=0x578)_0x4f492f=_0x2121d9(0xb0);}}}return await setDoc(_0x4ae169,{'type':_0x285756,'player':_0xcd1e5e,'opponent':_0x46d595,'previousElo':_0x4ce96f,'newElo':_0xfbecff,'change':_0xfbecff-_0x4ce96f,'matchResult':_0x445d6c,'previousPosition':_0x5139f4,'newPosition':_0x36b5b0,'rankAchieved':_0x4f492f,'matchId':_0x1cc88b,'timestamp':_0x326d36||serverTimestamp(),'gameMode':'D3'}),console['log']('D3\x20ELO\x20history\x20recorded\x20for\x20'+_0xcd1e5e),!![];}catch(_0x2d1fe4){console['error']('Error\x20recording\x20D3\x20ELO\x20history:',_0x2d1fe4);throw _0x2d1fe4;}}function a15_0x4036(){const _0x4eb9c3=['timestamp','error','Unknown\x20Player','warn','toString','opponent','Emerald','player','exists','approvedMatchesD3','data','Gold','prototype','bind','Bronze','winnerUsername','exception'];a15_0x4036=function(){return _0x4eb9c3;};return a15_0x4036();}export async function getEloHistoryD3(_0x5839ff=0x14){const _0x24d422=a15_0x5598;try{const _0x5849dc=collection(db,'eloHistoryD3');let _0x255a12;lastVisibleD3?_0x255a12=query(_0x5849dc,orderBy('timestamp','desc'),startAfter(lastVisibleD3),limit(_0x5839ff)):_0x255a12=query(_0x5849dc,orderBy(_0x24d422(0xa2),'desc'),limit(_0x5839ff));const _0xae2c9f=await getDocs(_0x255a12);if(_0xae2c9f['empty'])return{'entries':[],'hasMore':![]};lastVisibleD3=_0xae2c9f['docs'][_0xae2c9f['docs']['length']-0x1];const _0x5d03da=_0xae2c9f['docs']['map'](async _0x2affd1=>{const _0x2a8cc6=_0x24d422,_0x3a2a46=_0x2affd1['data'](),[_0x38aded,_0x2e5277]=await Promise['all']([getUsernameByIdD3(_0x3a2a46[_0x2a8cc6(0xa9)]),getUsernameByIdD3(_0x3a2a46[_0x2a8cc6(0xa7)])]);return{..._0x3a2a46,'playerUsername':_0x38aded,'opponentUsername':_0x2e5277,'change':_0x3a2a46['newElo']-_0x3a2a46['previousElo'],'timestamp':_0x3a2a46['timestamp']};}),_0x1c3ce0=await Promise['all'](_0x5d03da);return{'entries':_0x1c3ce0,'hasMore':_0xae2c9f['size']===_0x5839ff};}catch(_0x1beff4){console[_0x24d422(0xa3)]('Error\x20fetching\x20D3\x20ELO\x20history:',_0x1beff4);throw _0x1beff4;}}export function resetPaginationD3(){lastVisibleD3=null;}
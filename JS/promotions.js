const a46_0x101268=a46_0x10e4,a46_0x1bd2f6=(function(){let _0x282358=!![];return function(_0x579274,_0x2372c3){const _0x10f7f2=_0x282358?function(){if(_0x2372c3){const _0x1d25b1=_0x2372c3['apply'](_0x579274,arguments);return _0x2372c3=null,_0x1d25b1;}}:function(){};return _0x282358=![],_0x10f7f2;};}()),a46_0x494a7d=a46_0x1bd2f6(this,function(){const _0x4229a5=a46_0x10e4;let _0x128d9d;try{const _0x183bbd=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x128d9d=_0x183bbd();}catch(_0x2fff60){_0x128d9d=window;}const _0x258354=_0x128d9d['console']=_0x128d9d['console']||{},_0x443692=['log','warn','info',_0x4229a5(0x149),'exception','table','trace'];for(let _0xf9ae70=0x0;_0xf9ae70<_0x443692['length'];_0xf9ae70++){const _0x1b8a1=a46_0x1bd2f6[_0x4229a5(0x145)]['prototype']['bind'](a46_0x1bd2f6),_0x362229=_0x443692[_0xf9ae70],_0x305a92=_0x258354[_0x362229]||_0x1b8a1;_0x1b8a1['__proto__']=a46_0x1bd2f6['bind'](a46_0x1bd2f6),_0x1b8a1['toString']=_0x305a92[_0x4229a5(0x141)][_0x4229a5(0x164)](_0x305a92),_0x258354[_0x362229]=_0x1b8a1;}});a46_0x494a7d();import{collection,doc,query,where,orderBy,limit,getDocs,addDoc,getDoc,serverTimestamp,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{auth,db}from'./firebase-config.js';class PromotionManager{constructor(){const _0xacbc96=a46_0x10e4;this[_0xacbc96(0x144)]=0x18,this[_0xacbc96(0x17b)]=[{'threshold':0x578,'name':'Bronze','color':'#CD7F32'},{'threshold':0x640,'name':'Silver','color':'#C0C0C0'},{'threshold':0x708,'name':'Gold','color':'#FFD700'},{'threshold':0x834,'name':'Emerald','color':'#50C878'}],this['bannerContainer']=null,this['lastFetchTime']=0x0,this[_0xacbc96(0x182)]=0xea60,this['pollingInterval']=null,this['usernameCache']={};}['initialize'](){const _0x278b0e=a46_0x10e4;this[_0x278b0e(0x132)]=document['getElementById']('promotion-banner-container');if(!this['bannerContainer']){console[_0x278b0e(0x149)](_0x278b0e(0x153));return;}this['setupBannerContainer']();const _0x5980a5='promotions_checked_'+new Date()['toDateString'](),_0x4c2dc2=sessionStorage[_0x278b0e(0x16a)](_0x5980a5);!_0x4c2dc2&&(this['fetchRecentPromotions'](),sessionStorage['setItem'](_0x5980a5,'true')),document['addEventListener'](_0x278b0e(0x17a),()=>{const _0x457d53=_0x278b0e;document['visibilityState']==='visible'&&!sessionStorage['getItem'](_0x5980a5)&&(this['fetchRecentPromotions'](),sessionStorage[_0x457d53(0x178)](_0x5980a5,'true'));}),window['addEventListener']('beforeunload',()=>{const _0x14aa1b=_0x278b0e;this[_0x14aa1b(0x170)]&&clearInterval(this['pollingInterval']);});}['setupBannerContainer'](){const _0x3a5faa=a46_0x10e4;this['bannerContainer']['innerHTML']='',this['bannerContainer'][_0x3a5faa(0x139)][_0x3a5faa(0x125)]=_0x3a5faa(0x156);}async['fetchRecentPromotions'](){const _0xff26e8=a46_0x10e4;try{const _0x46afc4=Date[_0xff26e8(0x15c)]();if(_0x46afc4-this['lastFetchTime']<this['fetchInterval'])return;this['lastFetchTime']=_0x46afc4;const _0x470f2c=collection(db,'eloHistory'),_0x1ab00c=query(_0x470f2c,where('type','in',['promotion',_0xff26e8(0x17d)]),orderBy('timestamp','desc'),limit(0x14)),_0x415ea5=await getDocs(_0x1ab00c),_0x314146=[];_0x415ea5['forEach'](_0x3d5532=>{const _0x1cbafd=_0xff26e8,_0x196aac={'id':_0x3d5532['id'],..._0x3d5532['data']()};this['shouldShowPromotion'](_0x3d5532['id'])&&this[_0x1cbafd(0x15b)](_0x196aac)&&_0x314146['push'](_0x196aac);}),_0x314146[_0xff26e8(0x179)]>0x0&&await this['processRankChanges'](_0x314146);}catch(_0xa9df96){console['error']('Error\x20fetching\x20promotions:',_0xa9df96);}}async['processRankChanges'](_0x177688){const _0x9ea3ea=a46_0x10e4;if(_0x177688[_0x9ea3ea(0x179)]===0x0)return;_0x177688[_0x9ea3ea(0x171)]((_0x2f0432,_0x7abd47)=>{const _0x174f0b=_0x9ea3ea,_0x3737ff=_0x2f0432['timestamp']?.['toMillis']?.()||_0x2f0432['timestamp']?.[_0x174f0b(0x154)]*0x3e8||0x0,_0x1a75f5=_0x7abd47[_0x174f0b(0x131)]?.['toMillis']?.()||_0x7abd47['timestamp']?.[_0x174f0b(0x154)]*0x3e8||0x0;return _0x1a75f5-_0x3737ff;});const _0x471775=this['bannerContainer'][_0x9ea3ea(0x173)]['length'],_0x280226=0x3-_0x471775;if(_0x280226<=0x0)return;const _0xa20cf3=_0x177688['slice'](0x0,_0x280226);for(let _0x31fc56=0x0;_0x31fc56<_0xa20cf3[_0x9ea3ea(0x179)];_0x31fc56++){const _0x1786b0=_0xa20cf3[_0x31fc56],_0xef45f0=auth['currentUser'];try{setTimeout(()=>{this['showRankChangeBanner'](_0x1786b0);},_0x31fc56*0x3e8),_0xef45f0&&_0x1786b0['player']===_0xef45f0['displayName']&&this[_0x9ea3ea(0x14f)](_0x1786b0['type'],_0x1786b0['rankAchieved']);}catch(_0x1fdd25){console['error']('Error\x20processing\x20rank\x20change:',_0x1fdd25);}}}[a46_0x101268(0x166)](_0x20e991){const _0x69e962=a46_0x101268;try{const _0x1977a2='promotion_'+_0x20e991,_0x5bcd5a=localStorage['getItem'](_0x1977a2);if(_0x5bcd5a){let _0x59a7fa;try{_0x59a7fa=JSON['parse'](_0x5bcd5a);}catch(_0x12bcf0){return console['warn']('Invalid\x20storage\x20format\x20for\x20'+_0x1977a2+',\x20treating\x20as\x20new'),!![];}if(_0x59a7fa['ignored']===!![])return console[_0x69e962(0x165)]('Promotion\x20'+_0x20e991+'\x20is\x20permanently\x20ignored'),![];const _0x49ab52=Date['now']();if(_0x59a7fa['userDismissed']&&_0x49ab52-_0x59a7fa[_0x69e962(0x131)]<this['DISPLAY_HOURS']*0x3c*0x3c*0x3e8)return console['log'](_0x69e962(0x12f)+_0x20e991+'\x20was\x20dismissed\x20by\x20user\x20within\x20last\x20'+this[_0x69e962(0x144)]+_0x69e962(0x175)),![];if(_0x59a7fa[_0x69e962(0x133)]&&_0x49ab52-_0x59a7fa['timestamp']<0x4*0x3c*0x3c*0x3e8)return console['log']('Promotion\x20'+_0x20e991+_0x69e962(0x13f)),![];}return!![];}catch(_0x4becf4){return console['error']('Error\x20checking\x20promotion\x20visibility:',_0x4becf4),![];}}['ignorePromotion'](_0x13fb80){const _0x282e82=a46_0x101268;try{const _0x575acf=_0x282e82(0x181)+_0x13fb80;localStorage['setItem'](_0x575acf,JSON['stringify']({'timestamp':Date['now'](),'ignored':!![]}));}catch(_0x112d0d){console['error'](_0x282e82(0x17c),_0x112d0d);}}[a46_0x101268(0x12b)](_0x5c4118){const _0x5ea0f0=a46_0x101268;this[_0x5ea0f0(0x12c)](_0x5c4118)['then'](_0x40f7c3=>{const _0xe718f=_0x5ea0f0,_0x37b1b3=_0xe718f(0x181)+_0x5c4118['id'],_0x55721f=localStorage['getItem'](_0x37b1b3);if(_0x55721f)try{const _0x5adf08=JSON['parse'](_0x55721f);if(_0x5adf08['ignored']===!![]){console['log'](_0xe718f(0x167)+_0x5c4118['id']);return;}}catch(_0x27b20e){}localStorage[_0xe718f(0x178)](_0x37b1b3,JSON['stringify']({'timestamp':Date[_0xe718f(0x15c)](),'ignored':![],'userDismissed':![],'systemDismissed':![],'seenAt':Date['now']()})),this['bannerContainer']['style']['display']=_0xe718f(0x172);while(this[_0xe718f(0x132)]['children']['length']>=0x3){this['bannerContainer'][_0xe718f(0x169)](this['bannerContainer']['firstChild']);}const _0x22c201=document['createElement']('div');_0x22c201['className']='promotion-banner',_0x22c201['setAttribute']('data-rank',_0x40f7c3[_0xe718f(0x15f)]),_0x22c201['setAttribute']('data-id',_0x40f7c3['id']);const _0x175e7c=document['createElement']('div');_0x175e7c['className']='promotion-details';const _0x452728=_0x40f7c3['resolvedName']||_0x40f7c3['player']||_0x40f7c3[_0xe718f(0x155)]||_0x40f7c3['playerUsername']||_0x40f7c3['displayName']||'A\x20player',_0x510121=_0x40f7c3['type']==='promotion'?_0x452728+'\x20was\x20promoted\x20to':_0x452728+'\x20was\x20demoted\x20to';_0x175e7c['innerHTML']=_0x510121+_0xe718f(0x16d)+_0x40f7c3['rankAchieved']+'</span>';const _0x5b868a=document[_0xe718f(0x12d)]('div');_0x5b868a['className']='banner-actions';const _0x507253=document['createElement'](_0xe718f(0x137));_0x507253['className']='dismiss-btn',_0x507253['innerHTML']='&times;',_0x507253[_0xe718f(0x151)]='Dismiss';const _0x582fb7=document['createElement']('button');_0x582fb7['className']=_0xe718f(0x143),_0x582fb7['textContent']='Don\x27t\x20show\x20again',_0x582fb7['title']='Never\x20show\x20this\x20promotion\x20again',_0x5b868a['appendChild'](_0x582fb7),_0x5b868a['appendChild'](_0x507253),_0x22c201['appendChild'](_0x175e7c),_0x22c201['appendChild'](_0x5b868a),this['bannerContainer']['appendChild'](_0x22c201),void _0x22c201['offsetWidth'],setTimeout(()=>{const _0x5b21fb=_0xe718f;_0x22c201[_0x5b21fb(0x146)]['add']('new-rank-change');},0x32),_0x507253[_0xe718f(0x161)]('click',()=>{const _0x269b46=_0xe718f;localStorage[_0x269b46(0x178)](_0x37b1b3,JSON[_0x269b46(0x152)]({'timestamp':Date[_0x269b46(0x15c)](),'ignored':![],'userDismissed':!![],'systemDismissed':![]})),_0x22c201['classList'][_0x269b46(0x130)]('new-rank-change'),_0x22c201['classList'][_0x269b46(0x174)](_0x269b46(0x15d)),setTimeout(()=>{const _0x1b7929=_0x269b46;_0x22c201[_0x1b7929(0x148)]&&(_0x22c201[_0x1b7929(0x130)](),this[_0x1b7929(0x132)][_0x1b7929(0x173)]['length']===0x0&&(this['bannerContainer'][_0x1b7929(0x139)]['display']=_0x1b7929(0x156)));},0x1f4);}),_0x582fb7['addEventListener'](_0xe718f(0x14a),()=>{const _0x2a7790=_0xe718f;localStorage['setItem'](_0x37b1b3,JSON['stringify']({'timestamp':Date[_0x2a7790(0x15c)](),'ignored':!![],'userDismissed':!![],'systemDismissed':![]})),_0x22c201['classList']['remove']('new-rank-change'),_0x22c201['classList']['add']('dismissing'),setTimeout(()=>{const _0x3ea233=_0x2a7790;_0x22c201['parentNode']&&(_0x22c201['remove'](),this[_0x3ea233(0x132)]['children'][_0x3ea233(0x179)]===0x0&&(this['bannerContainer'][_0x3ea233(0x139)]['display']='none'));},0x1f4);}),setTimeout(()=>{const _0x3b6ef8=_0xe718f;_0x22c201['parentNode']&&(_0x22c201[_0x3b6ef8(0x146)]['remove']('new-rank-change'),_0x22c201['classList']['add']('dismissing'),localStorage['setItem'](_0x37b1b3,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':!![]})),setTimeout(()=>{_0x22c201['parentNode']&&(_0x22c201['remove'](),this['bannerContainer']['children']['length']===0x0&&(this['bannerContainer']['style']['display']='none'));},0x1f4));},0x3a98);});}async[a46_0x101268(0x12c)](_0x3b7c98){const _0x44ac30=a46_0x101268,_0x5dd9cc={..._0x3b7c98},_0x323771=[_0x3b7c98[_0x44ac30(0x138)],_0x3b7c98['username'],_0x3b7c98[_0x44ac30(0x177)],_0x3b7c98['displayName']],_0x253aac=_0x323771['some'](_0x5a5262=>_0x5a5262&&typeof _0x5a5262==='string'&&!_0x5a5262['includes'](_0x44ac30(0x17f))&&!/^[a-zA-Z0-9]{20,}$/[_0x44ac30(0x134)](_0x5a5262));if(_0x253aac)return _0x5dd9cc;let _0x323f2f=null;if(_0x3b7c98[_0x44ac30(0x16c)])_0x323f2f=_0x3b7c98['userId'];else _0x3b7c98['player']&&/^[A-Za-z0-9]{20,}$/['test'](_0x3b7c98['player'])&&(_0x323f2f=_0x3b7c98['player']);if(!_0x323f2f)return _0x5dd9cc;try{const _0x161975=await getDoc(doc(db,'players',_0x323f2f));if(_0x161975['exists']()){const _0x59f0d3=_0x161975['data']();if(_0x59f0d3['username'])return _0x5dd9cc[_0x44ac30(0x14c)]=_0x59f0d3['username'],_0x5dd9cc;}const _0x3f9d26=await getDocs(query(collection(db,'approvedMatches'),where('winnerId','==',_0x323f2f),orderBy('date','desc'),limit(0x1)));if(!_0x3f9d26['empty']){const _0x1e4844=_0x3f9d26[_0x44ac30(0x16e)][0x0]['data']();if(_0x1e4844['winnerUsername'])return _0x5dd9cc['resolvedName']=_0x1e4844['winnerUsername'],_0x5dd9cc;}const _0x358a17=await getDocs(query(collection(db,'approvedMatches'),where('loserId','==',_0x323f2f),orderBy('date',_0x44ac30(0x16b)),limit(0x1)));if(!_0x358a17[_0x44ac30(0x123)]){const _0x298d05=_0x358a17['docs'][0x0]['data']();if(_0x298d05[_0x44ac30(0x12a)])return _0x5dd9cc['resolvedName']=_0x298d05[_0x44ac30(0x12a)],console[_0x44ac30(0x165)]('Resolved\x20'+_0x323f2f+_0x44ac30(0x140)+_0x298d05['loserUsername']+'\x20(loser)'),_0x5dd9cc;}}catch(_0x34ba77){console[_0x44ac30(0x149)](_0x44ac30(0x12e),_0x34ba77);}return console['warn'](_0x44ac30(0x163)+_0x323f2f),_0x5dd9cc;}[a46_0x101268(0x14f)](_0x3b7097,_0x2787da){const _0x5a804c=a46_0x101268;let _0x10d2f0=document['getElementById'](_0x5a804c(0x159));!_0x10d2f0&&(_0x10d2f0=document['createElement']('div'),_0x10d2f0['id']='rankChangeModal',_0x10d2f0['className']='rank-change-modal\x20'+_0x3b7097,document['body']['appendChild'](_0x10d2f0));const _0x399ca3=_0x3b7097==='promotion'?'Congratulations!':'Rank\x20Update',_0x4f72d8=_0x3b7097==='promotion'?'You\x27ve\x20been\x20promoted\x20to':'You\x27ve\x20been\x20demoted\x20to';_0x10d2f0[_0x5a804c(0x183)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rank-change-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2\x20class=\x22rank-change-title\x22>'+_0x399ca3+'</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>'+_0x4f72d8+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22rank-name\x22>'+_0x2787da+_0x5a804c(0x128),_0x10d2f0['style'][_0x5a804c(0x125)]='flex',document['getElementById']('rank-change-ok-btn')['addEventListener'](_0x5a804c(0x14a),()=>{const _0x2e456c=_0x5a804c;_0x10d2f0[_0x2e456c(0x139)][_0x2e456c(0x125)]=_0x2e456c(0x156);}),_0x10d2f0['addEventListener'](_0x5a804c(0x14a),_0x140a45=>{const _0x129893=_0x5a804c;_0x140a45['target']===_0x10d2f0&&(_0x10d2f0[_0x129893(0x139)][_0x129893(0x125)]='none');});}async['checkAndRecordPromotion'](_0x39fd4a,_0x17efb6,_0x150e75,_0x520e05={}){const _0x204442=a46_0x101268;try{if(_0x17efb6===_0x150e75||!_0x39fd4a)return null;const _0x43405f=_0x520e05[_0x204442(0x15e)]||'automatic',_0x27d72a=_0x520e05['matchId']||null,_0xadd44d=_0x520e05[_0x204442(0x126)]||null;console['log']('Processing\x20potential\x20rank\x20change:\x20'+_0x150e75+'\x20→\x20'+_0x17efb6+'\x20(source:\x20'+_0x43405f+')');let _0x163033=null,_0x348c52=null;try{const _0x448462=await getDoc(doc(db,'players',_0x39fd4a));if(_0x448462['exists']()){const _0x3cfae4=_0x448462[_0x204442(0x13b)]();_0x163033=_0x3cfae4['username']||_0x3cfae4['displayName']||null,_0x348c52=_0x3cfae4[_0x204442(0x15a)]||_0x3cfae4['username']||null;}!_0x163033&&_0x520e05[_0x204442(0x155)]&&(_0x163033=_0x520e05['username'],_0x348c52=_0x520e05[_0x204442(0x155)]);!_0x163033&&auth['currentUser']&&(_0x163033=auth[_0x204442(0x13e)]['displayName']||auth['currentUser']['email'][_0x204442(0x180)]('@')[0x0],_0x348c52=auth[_0x204442(0x13e)]['displayName']||null);if(!_0x163033){const _0x166439=query(collection(db,'approvedMatches'),where('winnerId','==',_0x39fd4a),limit(0x1)),_0x18b085=await getDocs(_0x166439);if(!_0x18b085['empty'])_0x163033=_0x18b085['docs'][0x0]['data']()[_0x204442(0x136)]||'Unknown\x20Player',_0x348c52=_0x163033;else{const _0x274fbc=query(collection(db,'approvedMatches'),where('loserId','==',_0x39fd4a),limit(0x1)),_0x2e7e42=await getDocs(_0x274fbc);!_0x2e7e42['empty']&&(_0x163033=_0x2e7e42[0x0][_0x204442(0x13b)]()[_0x204442(0x12a)]||'Unknown\x20Player',_0x348c52=_0x163033);}}}catch(_0x3a9470){console[_0x204442(0x149)]('Error\x20resolving\x20username:',_0x3a9470);}!_0x163033&&(console['warn']('Could\x20not\x20resolve\x20username\x20for\x20userId:',_0x39fd4a),_0x163033=_0x204442(0x13c),_0x348c52='Unknown\x20Player');const _0x46588a=this['getRankName'](_0x150e75),_0x5d160a=this['getRankName'](_0x17efb6);if(_0x46588a!==_0x5d160a){const _0x47b9e7=_0x17efb6>_0x150e75,_0x258af0=_0x47b9e7?'promotion':_0x204442(0x17d),_0x4d7e0a=_0x5d160a;console[_0x204442(0x165)](_0x204442(0x157)+_0x258af0+_0x204442(0x14d)+_0x163033+':\x20'+_0x150e75+'\x20('+_0x46588a+')\x20→\x20'+_0x17efb6+'\x20('+_0x5d160a+')');try{const _0x307267={'player':_0x163033,'playerUsername':_0x163033,'username':_0x163033,'displayName':_0x348c52,'userId':_0x39fd4a,'type':_0x258af0,'rankAchieved':_0x4d7e0a,'timestamp':serverTimestamp(),'previousElo':_0x150e75,'newElo':_0x17efb6,'change':_0x17efb6-_0x150e75,'previousRank':_0x46588a,'newRank':_0x5d160a,'source':_0x43405f};if(_0x43405f===_0x204442(0x13a)&&_0x27d72a)_0x307267['matchId']=_0x27d72a;else _0x43405f==='admin'&&_0xadd44d?(_0x307267['modifiedBy']=_0xadd44d,_0x307267['isAutomatic']=![]):_0x307267['isAutomatic']=!![];const _0x223421=writeBatch(db),_0xcbe6e0=doc(collection(db,'eloHistory')),_0x26a752=doc(collection(db,_0x204442(0x124)));return _0x223421[_0x204442(0x150)](_0xcbe6e0,_0x307267),_0x223421[_0x204442(0x150)](_0x26a752,_0x307267),await _0x223421[_0x204442(0x14e)](),await this['sendPromotionNotification'](_0x39fd4a,_0x163033,_0x150e75,_0x17efb6,_0x46588a,_0x5d160a,_0x258af0,{'displayName':_0x348c52,'source':_0x43405f,'matchId':_0x27d72a,'ladder':_0x520e05['ladder']||'D1'}),console['log']('Successfully\x20recorded\x20'+_0x258af0+_0x204442(0x14d)+_0x163033+'\x20to\x20'+_0x4d7e0a),_0x4d7e0a;}catch(_0x35ec2f){console[_0x204442(0x149)](_0x204442(0x158),_0x35ec2f);try{return await addDoc(collection(db,'eloHistory'),{'player':_0x163033,'playerUsername':_0x163033,'username':_0x163033,'displayName':_0x348c52,'userId':_0x39fd4a,'type':_0x258af0,'rankAchieved':_0x4d7e0a,'timestamp':serverTimestamp(),'previousElo':_0x150e75,'newElo':_0x17efb6,'change':_0x17efb6-_0x150e75,'previousRank':_0x46588a,'source':_0x43405f,'isAutomatic':_0x43405f!==_0x204442(0x160)}),await this[_0x204442(0x16f)](_0x39fd4a,_0x163033,_0x150e75,_0x17efb6,_0x46588a,_0x5d160a,_0x258af0,{'displayName':_0x348c52,'source':_0x43405f,'matchId':_0x27d72a,'ladder':_0x520e05['ladder']||'D1'}),_0x4d7e0a;}catch(_0x2055ab){return console[_0x204442(0x149)]('Fallback\x20write\x20failed:',_0x2055ab),null;}}}return null;}catch(_0x245605){return console['error'](_0x204442(0x127),_0x245605),null;}}[a46_0x101268(0x162)](_0x54bd25){const _0x3dbe0c=a46_0x101268;for(let _0x5b05fc=this[_0x3dbe0c(0x17b)]['length']-0x1;_0x5b05fc>=0x0;_0x5b05fc--){if(_0x54bd25>=this[_0x3dbe0c(0x17b)][_0x5b05fc][_0x3dbe0c(0x13d)])return this['RANKS'][_0x5b05fc][_0x3dbe0c(0x147)];}return _0x3dbe0c(0x129);}['cleanup'](){this['pollingInterval']&&clearInterval(this['pollingInterval']);}['isNewRankChange'](_0x501755){const _0x5f5483=a46_0x101268;if(_0x501755['timestamp']){const _0x7dd655=_0x501755['timestamp']['seconds']*0x3e8,_0x258f61=Date['now'](),_0x39ebcb=(_0x258f61-_0x7dd655)/(0x3e8*0x3c*0x3c);if(_0x39ebcb>0x18)return![];}if(_0x501755[_0x5f5483(0x142)]&&_0x501755['newRank']&&_0x501755['previousRank']!==_0x501755[_0x5f5483(0x168)])return!![];return![];}async[a46_0x101268(0x16f)](_0x5f06b8,_0x597860,_0x504dcb,_0x233d2f,_0x4ffcc8,_0x96302c,_0x37255d,_0x46c6fd={}){const _0x4fb01d=a46_0x101268;try{console[_0x4fb01d(0x165)]('STARTING\x20notification\x20for\x20'+_0x597860+'\x27s\x20'+_0x37255d);const _0x5a5fc6={'userId':_0x5f06b8,'username':_0x597860,'displayName':_0x46c6fd['displayName']||_0x597860,'oldElo':parseInt(_0x504dcb),'newElo':parseInt(_0x233d2f),'eloDifference':parseInt(_0x233d2f)-parseInt(_0x504dcb),'oldRank':_0x4ffcc8,'newRank':_0x96302c,'type':_0x37255d,'timestamp':serverTimestamp(),'processed':![],'source':_0x46c6fd['source']||'automatic','matchId':_0x46c6fd['matchId']||null,'ladder':_0x46c6fd[_0x4fb01d(0x135)]||'D1','adminUser':_0x46c6fd['adminUser']||null};console['log']('Creating\x20Discord\x20notification:',_0x5a5fc6);const _0xa867bc=await addDoc(collection(db,'promotionNotifications'),_0x5a5fc6);return console[_0x4fb01d(0x165)]('Discord\x20notification\x20sent\x20successfully\x20with\x20ID:\x20'+_0xa867bc['id']),!![];}catch(_0x149f83){return console['error']('Error\x20sending\x20Discord\x20notification:',_0x149f83),![];}}}function a46_0x10e4(_0x3997c4,_0x3a312e){const _0x494a7d=a46_0x143b();return a46_0x10e4=function(_0x1bd2f6,_0x2e8378){_0x1bd2f6=_0x1bd2f6-0x123;let _0x143bcc=_0x494a7d[_0x1bd2f6];return _0x143bcc;},a46_0x10e4(_0x3997c4,_0x3a312e);}export const promotionManager=new PromotionManager();document['addEventListener'](a46_0x101268(0x17e),()=>{promotionManager['initialize']();});function a46_0x143b(){const _0x563a19=['empty','promotionHistory','display','adminUser','Error\x20in\x20promotion/demotion\x20recording:','</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22rank-change-button\x22\x20id=\x22rank-change-ok-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Got\x20it!\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','Unranked','loserUsername','showRankChangeBanner','resolveUserId','createElement','Error\x20resolving\x20user\x20ID:','Promotion\x20','remove','timestamp','bannerContainer','systemDismissed','test','ladder','winnerUsername','button','player','style','match','data','A\x20player','threshold','currentUser','\x20was\x20auto-dismissed\x20within\x20last\x204\x20hours','\x20to\x20','toString','previousRank','ignore-btn','DISPLAY_HOURS','constructor','classList','name','parentNode','error','click','initialize','resolvedName','\x20for\x20','commit','showRankChangeLightbox','set','title','stringify','Promotion\x20banner\x20container\x20not\x20found','seconds','username','none','Recording\x20','Error\x20writing\x20promotion\x20records:','rankChangeModal','displayName','isNewRankChange','now','dismissing','source','rankAchieved','admin','addEventListener','getRankName','Failed\x20to\x20resolve\x20user\x20ID:\x20','bind','log','shouldShowPromotion','Skipping\x20ignored\x20promotion:\x20','newRank','removeChild','getItem','desc','userId','\x20<span\x20class=\x22rank-text\x22>','docs','sendPromotionNotification','pollingInterval','sort','block','children','add','\x20hours','checkAndRecordPromotion','playerUsername','setItem','length','visibilitychange','RANKS','Error\x20saving\x20promotion\x20preference:','demotion','DOMContentLoaded','ID:','split','promotion_','fetchInterval','innerHTML'];a46_0x143b=function(){return _0x563a19;};return a46_0x143b();}export const initializePromotionTracker=()=>promotionManager[a46_0x101268(0x14b)]();export const checkAndRecordPromotion=(_0x3d80f6,_0x2a3928,_0x586b28,_0x1e859c)=>promotionManager[a46_0x101268(0x176)](_0x3d80f6,_0x2a3928,_0x586b28,_0x1e859c);export const getRankName=_0x17a3cd=>promotionManager[a46_0x101268(0x162)](_0x17a3cd);
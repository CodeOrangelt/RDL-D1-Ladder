const a47_0x1940c9=a47_0x133b,a47_0x4fae35=(function(){let _0x612846=!![];return function(_0x5cec86,_0x2d505c){const _0x40a26f=_0x612846?function(){const _0x24b2d4=a47_0x133b;if(_0x2d505c){const _0x83c22f=_0x2d505c[_0x24b2d4(0x1a0)](_0x5cec86,arguments);return _0x2d505c=null,_0x83c22f;}}:function(){};return _0x612846=![],_0x40a26f;};}()),a47_0x38586b=a47_0x4fae35(this,function(){const _0x32dedf=a47_0x133b,_0x3b20c3=function(){let _0x4ca49f;try{_0x4ca49f=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x4f55ab){_0x4ca49f=window;}return _0x4ca49f;},_0x4b3598=_0x3b20c3(),_0x51595b=_0x4b3598['console']=_0x4b3598['console']||{},_0x52bcb9=[_0x32dedf(0x1a8),_0x32dedf(0x1d2),_0x32dedf(0x1c8),_0x32dedf(0x1ad),_0x32dedf(0x200),'table','trace'];for(let _0x193eb6=0x0;_0x193eb6<_0x52bcb9['length'];_0x193eb6++){const _0x55a876=a47_0x4fae35['constructor']['prototype'][_0x32dedf(0x208)](a47_0x4fae35),_0x1c9498=_0x52bcb9[_0x193eb6],_0x487919=_0x51595b[_0x1c9498]||_0x55a876;_0x55a876[_0x32dedf(0x1dd)]=a47_0x4fae35[_0x32dedf(0x208)](a47_0x4fae35),_0x55a876['toString']=_0x487919['toString'][_0x32dedf(0x208)](_0x487919),_0x51595b[_0x1c9498]=_0x55a876;}});a47_0x38586b();import{approveReport}from'./ladderalgorithm.js';import{approveReportD2}from'./ladderalgorithm-d2.js';import{approveReportD3}from'./ladderalgorithm-d3.js';import{checkPendingMatches,updatePendingMatchNotification,updateNotificationDot}from'./checkPendingMatches.js';import{collection,getDocs,query,where,orderBy,serverTimestamp,doc,setDoc,getDoc,addDoc,updateDoc,deleteDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{auth,db}from'./firebase-config.js';let currentUserEmail=null,confirmationNotification=null,outstandingReportData=null,currentGameMode='D1',outstandingMatches=[];document['addEventListener'](a47_0x1940c9(0x20b),async()=>{const _0x34aaca=a47_0x1940c9,_0x35aebf={'authWarning':document['getElementById'](_0x34aaca(0x191)),'reportForm':document[_0x34aaca(0x1f8)]('report-form'),'winnerUsername':document['getElementById']('winner-username'),'loserUsername':document['getElementById']('loser-username'),'loserScore':document[_0x34aaca(0x1f8)](_0x34aaca(0x1e8)),'suicides':document['getElementById']('suicides'),'mapPlayed':document['getElementById']('map-played'),'loserComment':document['getElementById']('loser-comment'),'reportError':document['getElementById']('report-error'),'reportLightbox':document[_0x34aaca(0x1f8)](_0x34aaca(0x1d4))};Object['entries'](_0x35aebf)['forEach'](([_0x2065cc,_0x40acb3])=>{const _0x284705=_0x34aaca;!_0x40acb3&&console[_0x284705(0x1d2)]('Element\x20\x27'+_0x2065cc+'\x27\x20not\x20found\x20in\x20the\x20DOM');});const _0x3fe3dc=document['getElementById']('d1-mode'),_0x45d51d=document[_0x34aaca(0x1f8)](_0x34aaca(0x1ef)),_0xd68606=document['getElementById']('d3-mode');_0x3fe3dc[_0x34aaca(0x1df)]('click',()=>{const _0x50d423=_0x34aaca;_0x1b18a1('D1'),_0x3fe3dc[_0x50d423(0x1e9)]['add']('active'),_0x45d51d[_0x50d423(0x1e9)][_0x50d423(0x198)](_0x50d423(0x1d9)),_0xd68606[_0x50d423(0x1e9)][_0x50d423(0x198)]('active');}),_0x45d51d['addEventListener']('click',()=>{const _0x475b7e=_0x34aaca;_0x1b18a1('D2'),_0x45d51d[_0x475b7e(0x1e9)]['add'](_0x475b7e(0x1d9)),_0x3fe3dc['classList'][_0x475b7e(0x198)]('active'),_0xd68606['classList']['remove']('active');}),_0xd68606['addEventListener']('click',()=>{const _0x12c7ae=_0x34aaca;_0x1b18a1('D3'),_0xd68606['classList']['add']('active'),_0x3fe3dc[_0x12c7ae(0x1e9)][_0x12c7ae(0x198)]('active'),_0x45d51d[_0x12c7ae(0x1e9)]['remove'](_0x12c7ae(0x1d9));});function _0x1b18a1(_0x1ab440){const _0x3afe24=_0x34aaca;currentGameMode=_0x1ab440,console['log'](_0x3afe24(0x213)+currentGameMode),auth['currentUser']&&checkUserInLadderAndLoadOpponents(auth['currentUser']['uid']);}setupAuthStateListener(_0x35aebf),setupReportForm(_0x35aebf),auth['currentUser']?(console['log']('User\x20already\x20logged\x20in,\x20checking\x20D1\x20ladder\x20status'),checkUserInLadderAndLoadOpponents(auth['currentUser'][_0x34aaca(0x209)])):console[_0x34aaca(0x1a8)](_0x34aaca(0x1cc));});function setupAuthStateListener(_0x270c0e){onAuthStateChanged(auth,async _0x5b9fb4=>{_0x5b9fb4?handleUserSignedIn(_0x5b9fb4,_0x270c0e):handleUserSignedOut(_0x270c0e);});}async function handleUserSignedIn(_0x1ec6cd,_0x478bb6){const _0x499264=a47_0x1940c9;if(!_0x478bb6){console['error']('Elements\x20object\x20is\x20null\x20or\x20undefined');return;}currentUserEmail=_0x1ec6cd['email']||null;const _0x150860=_0x1ec6cd['uid'];try{const _0x39221a=doc(db,_0x499264(0x19a),_0x150860);try{const _0x51750e=await getDoc(_0x39221a);console['log']('Non-participant\x20check:',{'exists':_0x51750e['exists'](),'data':_0x51750e[_0x499264(0x1d8)]()?_0x51750e['data']():null});if(_0x51750e['exists']()&&_0x51750e['data']()['isNonParticipant']===!![]){_0x478bb6['authWarning']&&(_0x478bb6['authWarning']['style'][_0x499264(0x18c)]='block',_0x478bb6['authWarning'][_0x499264(0x18b)]='Non-participants\x20cannot\x20report\x20games.');_0x478bb6['reportForm']&&(_0x478bb6['reportForm']['style']['display']='none');return;}}catch(_0x554e7c){console['warn']('Error\x20checking\x20non-participant\x20status:',_0x554e7c);}const _0x2a4f82=['players','playersD2',_0x499264(0x21c),_0x499264(0x21d),'playersCTF'];let _0x1a391f=![],_0x3ea31e='';for(const _0x343cac of _0x2a4f82){try{const _0x1507bb=doc(db,_0x343cac,_0x150860),_0x651f2=await getDoc(_0x1507bb);if(_0x651f2['exists']()){_0x1a391f=!![],_0x3ea31e=_0x651f2['data']()['username'],console[_0x499264(0x1a8)]('User\x20found\x20in\x20collection\x20'+_0x343cac+_0x499264(0x1c3)+_0x3ea31e);if(_0x343cac==='players'&&currentGameMode!=='D1'){currentGameMode='D1';const _0x264169=document['getElementById']('d1-mode'),_0x2eb4bc=document['getElementById'](_0x499264(0x1ef)),_0x489766=document['getElementById'](_0x499264(0x1de));_0x264169['classList'][_0x499264(0x1a2)]('active'),_0x2eb4bc['classList'][_0x499264(0x198)]('active'),_0x489766['classList'][_0x499264(0x198)](_0x499264(0x1d9));}else{if(_0x343cac===_0x499264(0x1ba)&&currentGameMode!=='D2'){currentGameMode='D2';const _0xc0424f=document['getElementById']('d1-mode'),_0x570572=document['getElementById']('d2-mode'),_0x27eaba=document[_0x499264(0x1f8)]('d3-mode');_0x570572['classList']['add']('active'),_0xc0424f['classList']['remove']('active'),_0x27eaba['classList']['remove']('active');}}break;}}catch(_0x5ceff4){console[_0x499264(0x1d2)]('Error\x20checking\x20'+_0x343cac+_0x499264(0x1e7),_0x5ceff4);}}if(!_0x1a391f){_0x478bb6['authWarning']&&(_0x478bb6['authWarning']['style']['display']='block');_0x478bb6[_0x499264(0x21b)]&&(_0x478bb6[_0x499264(0x21b)][_0x499264(0x1db)][_0x499264(0x18c)]='none');return;}const _0x7accaf=await checkUserInLadderAndLoadOpponents(_0x150860);if(!_0x7accaf){console['warn']('User\x20is\x20not\x20in\x20the\x20'+currentGameMode+_0x499264(0x21f));for(const _0x1b0733 of['players','playersD2','playersD3']){if(_0x1b0733===(currentGameMode==='D1'?'players':currentGameMode==='D2'?_0x499264(0x1ba):'playersD3'))continue;const _0x10a375=doc(db,_0x1b0733,_0x150860);try{const _0x186681=await getDoc(_0x10a375);if(_0x186681['exists']()){const _0x117d7e=_0x1b0733==='players'?'D1':_0x1b0733===_0x499264(0x1ba)?'D2':'D3';console['log'](_0x499264(0x20a)+_0x1b0733+_0x499264(0x186)+_0x117d7e+'\x20mode');const _0x1e95ae=document['getElementById']('d1-mode'),_0x2ed453=document[_0x499264(0x1f8)](_0x499264(0x1ef)),_0x30a974=document[_0x499264(0x1f8)]('d3-mode');if(_0x117d7e==='D1')_0x1e95ae['classList']['add']('active'),_0x2ed453['classList'][_0x499264(0x198)]('active'),_0x30a974['classList'][_0x499264(0x198)]('active');else _0x117d7e==='D2'?(_0x2ed453[_0x499264(0x1e9)][_0x499264(0x1a2)](_0x499264(0x1d9)),_0x1e95ae['classList'][_0x499264(0x198)](_0x499264(0x1d9)),_0x30a974['classList']['remove']('active')):(_0x30a974[_0x499264(0x1e9)]['add']('active'),_0x1e95ae['classList']['remove'](_0x499264(0x1d9)),_0x2ed453['classList']['remove']('active'));currentGameMode=_0x117d7e,await checkUserInLadderAndLoadOpponents(_0x150860);break;}}catch(_0x40722f){console[_0x499264(0x1d2)]('Error\x20checking\x20'+_0x1b0733+':',_0x40722f);}}}}catch(_0x49e753){console['error']('Error\x20during\x20sign-in\x20handling:',_0x49e753);}}function a47_0xa305(){const _0x10344d=['Error\x20checking\x20if\x20user\x20is\x20in\x20ladder:','winnerOldElo','currentUser','pendingMatchesD3','RejectedD2',',\x20switching\x20to\x20','type','approved','loserSuicides','function','textContent','display','<p>No\x20outstanding\x20matches\x20found\x20in\x20the\x20current\x20game\x20mode.</p>','red','color','loserEmail','auth-warning','Error\x20fetching\x20outstanding\x20matches:','querySelectorAll','call','report-error','\x20in\x20','Query\x20by\x20winnerId\x20results:\x20','remove','some','nonParticipants','\x20to\x20','message','email','view-outstanding-container','Match\x20reported\x20in\x20','apply','You\x20must\x20be\x20logged\x20in\x20to\x20reject\x20a\x20match','add','winner-score','Rejecting\x20match\x20','data','winnerUsername','loserScore','log','toDate','btn','cloneNode','No\x20winner\x20found\x20for\x20this\x20match','error','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22match-detail-item\x22>Score:\x20?\x20-\x20','Using\x20players\x20collection:\x20','view-outstanding-btn','suicides','Standard\x20Match','removeAttribute','none','Not\x20registered\x20in\x20this\x20ladder','show','players','docs','Error\x20loading\x20opponents\x20list:','playersD2','Report\x20form\x20reset','username','#6a1b9a','options','Winner\x20','loser-username','\x20with\x20ID:\x20','className','\x20with\x20username:\x20','winnerEmail','position','target','.edit-report-btn','info','value','lightbox-subgame','onAuthStateChanged','No\x20user\x20logged\x20in\x20yet,\x20waiting\x20for\x20auth\x20state\x20change','data-id','replaceChild','loserUsername','gameMode','Match\x20','warn','rescindReport','report-lightbox','pendingMatchesD2','reload','disabled','exists','active','then','style','Winner:\x20','__proto__','d3-mode','addEventListener','Winner','pendingMatches','Lightbox\x20element\x20not\x20found','size','Not\x20specified','Reject\x20Match','lightbox-loser-score','\x20collection:','loser-score','classList','button','cancel-edit-btn','losersOldElo','forEach','\x20for\x20game\x20mode:\x20','d2-mode','block','lightbox-loser','reset','\x22>View\x20Details</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x22>Edit\x20Report</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20danger-button\x20rescind-report-btn\x22\x20data-id=\x22','getAttribute','catch','winner-comment','getElementById','empty','selected','\x20matches\x20found','Update\x20Report','showMatchLightbox','Error\x20rejecting\x20match:','winner-username','exception','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20edit-report-btn\x22\x20data-id=\x22','readOnly','eloRating','preventDefault','white','Error\x20populating\x20winner\x20dropdown:','\x20ladder...','bind','uid','User\x20found\x20in\x20','DOMContentLoaded','borderRadius','lightbox-map','querySelector','button[type=\x22submit\x22]','Query\x20by\x20winnerUsername\x20results:\x20','loserId','click','Game\x20mode\x20set\x20to:\x20','reject-button','smooth','Error\x20processing\x20player\x20data:','Failed\x20to\x20rescind\x20report.\x20Please\x20try\x20again.','Unknown\x20date','backgroundColor','.lightbox-buttons','reportForm','playersD3','playersDuos','Checking\x20reports\x20for\x20user:\x20','\x20ladder.\x20Checking\x20other\x20ladders.','mapPlayed','parentNode','innerHTML'];a47_0xa305=function(){return _0x10344d;};return a47_0xa305();}function handleUserSignedOut(_0x7d8e4b){_0x7d8e4b['authWarning']['style']['display']='block',_0x7d8e4b['reportForm']['style']['display']='none',currentUserEmail=null;}async function updateUserDisplay(_0x36f467,_0xb0beab){const _0xc3a542=a47_0x1940c9,_0x46287=collection(db,'players'),_0x4612e9=query(_0x46287,where('email','==',_0x36f467)),_0x57e8ea=await getDocs(_0x4612e9);if(!_0x57e8ea['empty']){const _0x1b3835=_0x57e8ea[_0xc3a542(0x1b8)][0x0][_0xc3a542(0x1a5)]()['username'];_0xb0beab['loserUsername']['textContent']=_0x1b3835;}}async function populateWinnerDropdown(_0x2f0396){const _0x329750=a47_0x1940c9;try{const _0x35f5ef=collection(db,'players'),_0x107aaa=await getDocs(_0x35f5ef);_0x2f0396[_0x329750(0x222)]='<option\x20value=\x22\x22>Select\x20Winner</option>',!_0x107aaa['empty']&&_0x107aaa['forEach'](_0x5718c8=>{const _0x882a0b=_0x329750,_0xd8151c=_0x5718c8['data']();if(_0xd8151c['email']!==currentUserEmail){const _0x254d5e=document['createElement']('option');_0x254d5e[_0x882a0b(0x1c9)]=_0xd8151c[_0x882a0b(0x19d)],_0x254d5e['textContent']=_0xd8151c['username'],_0x2f0396['appendChild'](_0x254d5e);}});}catch(_0x1cbd31){console['error'](_0x329750(0x206),_0x1cbd31);throw _0x1cbd31;}}function setupReportForm(_0x2f2ea5){if(!_0x2f2ea5['reportForm'])return;_0x2f2ea5['reportForm']['addEventListener']('submit',async _0x545ccb=>{const _0xec6141=a47_0x133b;_0x545ccb[_0xec6141(0x204)]();try{await submitReport(_0x2f2ea5),_0x2f2ea5['reportForm']['reset'](),alert('Game\x20reported\x20successfully.');}catch(_0x546635){console[_0xec6141(0x1ad)]('Error\x20submitting\x20report:',_0x546635),_0x2f2ea5['reportError']['textContent']='Error\x20reporting\x20game.\x20Please\x20try\x20again.';}});}async function submitReport(_0x2d0e5e){const _0x451e67=a47_0x1940c9,_0x297141=currentGameMode==='D1'?_0x451e67(0x1e1):currentGameMode==='D2'?'pendingMatchesD2':_0x451e67(0x184),_0x35b8f0=collection(db,_0x297141),_0x65071b=doc(_0x35b8f0);try{const _0x5d8faa=auth['currentUser'];if(!_0x5d8faa)throw new Error('User\x20not\x20authenticated');const _0x527341=_0x5d8faa['uid'],_0x315fe0=currentGameMode==='D1'?'players':currentGameMode==='D2'?'playersD2':'playersD3',_0x1fdb51=await getDoc(doc(db,_0x315fe0,_0x527341));if(!_0x1fdb51['exists']())throw new Error('Your\x20player\x20profile\x20not\x20found');const _0x5ec4d7=document['getElementById']('subgame-type'),_0x4426f3=_0x2d0e5e['winnerUsername']['value'];if(!_0x4426f3)throw new Error('Please\x20select\x20an\x20opponent');const _0x240bea=query(collection(db,_0x315fe0),where('username','==',_0x4426f3)),_0x5ee25a=await getDocs(_0x240bea);if(_0x5ee25a['empty'])throw new Error('Selected\x20opponent\x20not\x20found');const _0x122d8e=_0x5ee25a['docs'][0x0]['data'](),_0x153311=_0x5ee25a['docs'][0x0]['id'],_0x486f76={'matchId':_0x65071b['id'],'loserUsername':_0x1fdb51[_0x451e67(0x1a5)]()['username'],'loserId':_0x527341,'winnerUsername':_0x122d8e['username'],'winnerId':_0x153311,'loserScore':_0x2d0e5e['loserScore']['value'],'loserSuicides':_0x2d0e5e[_0x451e67(0x1b1)]['value'],'mapPlayed':_0x2d0e5e['mapPlayed']['value'],'loserComment':_0x2d0e5e['loserComment']['value'],'subgameType':_0x5ec4d7?_0x5ec4d7['value']:'','gameMode':currentGameMode,'approved':![],'createdAt':serverTimestamp(),'winnerOldElo':_0x122d8e['eloRating']||null,'losersOldElo':_0x1fdb51['data']()['eloRating']||null};await setDoc(_0x65071b,_0x486f76),console[_0x451e67(0x1a8)](_0x451e67(0x19f)+_0x297141+_0x451e67(0x1c1)+_0x65071b['id']),_0x2d0e5e['reportError'][_0x451e67(0x18b)]='Game\x20reported\x20successfully!',_0x2d0e5e['reportError']['style']['color']='green',updatePendingMatchNotification();}catch(_0x33b80f){console['error']('Error\x20submitting\x20report:',_0x33b80f),_0x2d0e5e['reportError'][_0x451e67(0x18b)]='Error:\x20'+_0x33b80f['message'],_0x2d0e5e['reportError']['style'][_0x451e67(0x18f)]='red';throw _0x33b80f;}}async function checkForOutstandingReports(_0x5e48f3,_0xfcb335,_0x509f91=null){const _0x430c4b=a47_0x1940c9;console[_0x430c4b(0x1a8)](_0x430c4b(0x21e)+_0x5e48f3+_0x430c4b(0x196)+(_0x509f91||'default\x20collection'));const _0x3c4bb7=_0x509f91||(currentGameMode==='D1'?_0x430c4b(0x1e1):currentGameMode==='D2'?_0x430c4b(0x1d5):'pendingMatchesD3');console[_0x430c4b(0x1a8)]('Using\x20collection:\x20'+_0x3c4bb7);try{const _0x23a0cb=auth['currentUser'];if(!_0x23a0cb){console['log']('No\x20authenticated\x20user\x20found');return;}const _0x4b9500=_0x23a0cb['uid'],_0x572ffc=collection(db,_0x3c4bb7),_0x1b8bd9=query(_0x572ffc,where('winnerId','==',_0x4b9500),where(_0x430c4b(0x188),'==',![]));let _0x268f64=await getDocs(_0x1b8bd9);console['log'](_0x430c4b(0x197)+_0x268f64[_0x430c4b(0x1e3)]+_0x430c4b(0x1fb));if(_0x268f64['empty']&&_0x23a0cb['email']){console['log']('No\x20matches\x20found\x20by\x20winnerId,\x20trying\x20winnerEmail');const _0x17356e=query(_0x572ffc,where('winnerEmail','==',_0x23a0cb['email']),where('approved','==',![]));_0x268f64=await getDocs(_0x17356e),console['log']('Query\x20by\x20winnerEmail\x20results:\x20'+_0x268f64[_0x430c4b(0x1e3)]+'\x20matches\x20found');}if(_0x268f64['empty']){console['log']('No\x20matches\x20found\x20by\x20email\x20either,\x20trying\x20winnerUsername');const _0x159267=currentGameMode==='D1'?'players':'playersD2',_0x194af2=await getDoc(doc(db,_0x159267,_0x4b9500));if(_0x194af2['exists']()&&_0x194af2['data']()['username']){const _0x572915=_0x194af2[_0x430c4b(0x1a5)]()['username'],_0x421b19=query(_0x572ffc,where(_0x430c4b(0x1a6),'==',_0x572915),where(_0x430c4b(0x188),'==',![]));_0x268f64=await getDocs(_0x421b19),console[_0x430c4b(0x1a8)](_0x430c4b(0x210)+_0x268f64['size']+_0x430c4b(0x1fb));}}if(!_0x268f64['empty']){const _0x158a4f=_0x268f64['docs'][0x0]['data']();return console['log']('Found\x20pending\x20match:',_0x158a4f),_0x158a4f['id']=_0x268f64['docs'][0x0]['id'],autoFillReportForm(_0x158a4f),updateNotificationDot(!![]),!![];}else return console['log']('No\x20pending\x20matches\x20found\x20for\x20this\x20user'),updateNotificationDot(![]),![];}catch(_0xcbab07){console['error']('Error\x20checking\x20outstanding\x20reports:',_0xcbab07);}}function autoFillReportForm(_0x53f633){const _0xb85a47=a47_0x1940c9;console['log']('Report\x20Data\x20in\x20autoFillReportForm:',_0x53f633);if(_0x53f633){const _0x34a75f=parseInt(_0x53f633[_0xb85a47(0x1a7)]||'0'),_0x38d14e=_0x34a75f<0x12?0x14:_0x34a75f+0x2,_0x571cbf=_0x53f633['gameMode']||currentGameMode,_0x17df3f=_0x571cbf==='D1'?'players':_0x571cbf==='D2'?'playersD2':'playersD3';console['log'](_0xb85a47(0x1af)+_0x17df3f+_0xb85a47(0x1ee)+_0x571cbf);let _0x2dd6bd;_0x53f633['winnerId']?_0x2dd6bd=getDoc(doc(db,_0x17df3f,_0x53f633['winnerId']))[_0xb85a47(0x1da)](_0x5c187b=>_0x5c187b['exists']()?{'id':_0x5c187b['id'],'data':_0x5c187b[_0xb85a47(0x1a5)]()}:null):_0x2dd6bd=getDocs(query(collection(db,_0x17df3f),where('username','==',_0x53f633['winnerUsername'])))['then'](_0x1b2eef=>!_0x1b2eef['empty']?{'id':_0x1b2eef['docs'][0x0]['id'],'data':_0x1b2eef['docs'][0x0]['data']()}:null);let _0x1831ba;_0x53f633['loserId']?_0x1831ba=getDoc(doc(db,_0x17df3f,_0x53f633['loserId']))[_0xb85a47(0x1da)](_0x2ff202=>_0x2ff202[_0xb85a47(0x1d8)]()?{'id':_0x2ff202['id'],'data':_0x2ff202['data']()}:null):_0x1831ba=getDocs(query(collection(db,_0x17df3f),where('username','==',_0x53f633['loserUsername'])))['then'](_0x334457=>!_0x334457['empty']?{'id':_0x334457['docs'][0x0]['id'],'data':_0x334457[_0xb85a47(0x1b8)][0x0][_0xb85a47(0x1a5)]()}:null),Promise['all']([_0x2dd6bd,_0x1831ba])['then'](([_0x367227,_0x25a821])=>{const _0x4fff7d=_0xb85a47;if(!_0x367227){console['error'](_0x4fff7d(0x1ac)),alert('Error:\x20Winner\x20data\x20not\x20found.');return;}if(!_0x25a821){console['error']('No\x20loser\x20found\x20for\x20this\x20match'),alert('Error:\x20Loser\x20data\x20not\x20found.');return;}const _0x152f89=_0x53f633[_0x4fff7d(0x182)]!=null?_0x53f633['winnerOldElo']:_0x367227[_0x4fff7d(0x1a5)]['eloRating'],_0x17d838=_0x53f633[_0x4fff7d(0x1ec)]!=null?_0x53f633['losersOldElo']:_0x25a821['data'][_0x4fff7d(0x203)],_0x3cf4b1=_0x367227['data'][_0x4fff7d(0x1bc)],_0x50223d=_0x25a821['data']['username'];console['log'](_0x4fff7d(0x1dc)+_0x3cf4b1+'\x20(ELO:\x20'+_0x152f89+'),\x20Loser:\x20'+_0x50223d+'\x20(ELO:\x20'+_0x17d838+')');const _0x89e467=document['getElementById']('report-lightbox');if(!_0x89e467){console['error'](_0x4fff7d(0x1e2));return;}document['getElementById']('lightbox-winner')['textContent']=_0x3cf4b1,document['getElementById'](_0x4fff7d(0x1f1))[_0x4fff7d(0x18b)]=_0x50223d,document['getElementById'](_0x4fff7d(0x1e6))['textContent']=_0x53f633['loserScore']||'0',document['getElementById']('lightbox-suicides')['textContent']=_0x53f633['loserSuicides']||'0',document['getElementById']('lightbox-map')[_0x4fff7d(0x18b)]=_0x53f633[_0x4fff7d(0x220)]||_0x4fff7d(0x1e4),document['getElementById']('lightbox-comment')['textContent']=_0x53f633['loserComment']||'No\x20comment',document['getElementById']('lightbox-subgame')['textContent']=_0x53f633['subgameType']||_0x4fff7d(0x1b2);const _0x4c3568=document[_0x4fff7d(0x1f8)](_0x4fff7d(0x1a3));_0x4c3568&&(_0x4c3568['value']=_0x38d14e,_0x4c3568[_0x4fff7d(0x202)]=!![],_0x4c3568['style']['backgroundColor']='rgba(255,\x20255,\x20255,\x200.05)');showLightbox();const _0x2da5c1=document[_0x4fff7d(0x20e)](_0x4fff7d(0x21a));if(_0x2da5c1){console['log']('Found\x20buttons\x20container:',_0x2da5c1);const _0x5a671c=document['getElementById']('reject-button');_0x5a671c&&_0x5a671c['remove']();const _0x53a26c=document['createElement'](_0x4fff7d(0x1ea));_0x53a26c['id']='reject-button',_0x53a26c['className']='button\x20danger-button',_0x53a26c['textContent']=_0x4fff7d(0x1e5),_0x53a26c['style'][_0x4fff7d(0x219)]='#d32f2f',_0x53a26c[_0x4fff7d(0x1db)][_0x4fff7d(0x18f)]=_0x4fff7d(0x205),_0x53a26c['style']['marginRight']='10px',_0x53a26c[_0x4fff7d(0x1db)]['padding']='8px\x2016px',_0x53a26c['style']['border']=_0x4fff7d(0x1b4),_0x53a26c['style'][_0x4fff7d(0x20c)]='4px',_0x53a26c['style']['cursor']='pointer',_0x53a26c['style']['fontWeight']='bold',_0x2da5c1['prepend'](_0x53a26c),console[_0x4fff7d(0x1a8)]('Reject\x20button\x20added:',_0x53a26c);}const _0x3b87d9=document['getElementById']('approve-button'),_0x1a65a6=document['getElementById'](_0x4fff7d(0x214)),_0x483fa4=document['getElementById']('cancel-button');if(_0x3b87d9){const _0x227df2=_0x3b87d9[_0x4fff7d(0x1ab)](!![]);_0x3b87d9['parentNode']['replaceChild'](_0x227df2,_0x3b87d9),_0x227df2['addEventListener']('click',async function(){const _0x55f559=_0x4fff7d;try{const _0x1cb751=document['getElementById']('winner-score')['value'],_0xb2a3e1=document['getElementById']('winner-suicides')[_0x55f559(0x1c9)]||'0',_0x2f96df=document['getElementById'](_0x55f559(0x1f7))['value']||'';console['log']('Current\x20user\x20info:',{'uid':auth['currentUser']?.[_0x55f559(0x209)],'email':auth['currentUser']?.['email'],'isAdmin':auth['currentUser']?.['email']==='admin@ladder.com'||auth['currentUser']?.['email']==='brian2af@outlook.com'});const _0x218490=_0x53f633[_0x55f559(0x1d0)]||currentGameMode;if(_0x218490==='D3')await approveReportD3(_0x53f633['id'],_0x1cb751,_0xb2a3e1,_0x2f96df);else _0x218490==='D2'?await approveReportD2(_0x53f633['id'],_0x1cb751,_0xb2a3e1,_0x2f96df):await approveReport(_0x53f633['id'],_0x1cb751,_0xb2a3e1,_0x2f96df);document['getElementById']('report-lightbox')['style']['display']='none',alert('Match\x20approved\x20successfully'),updatePendingMatchNotification(),location['reload']();const _0x3e74c8=_0x218490==='D1'?'players':_0x55f559(0x1ba),_0x52b4fa=doc(db,_0x3e74c8,_0x367227['id']),_0x1105c0=doc(db,_0x3e74c8,_0x25a821['id']),[_0x5181a7,_0x178e92]=await Promise['all']([getDoc(_0x52b4fa),getDoc(_0x1105c0)]);if(_0x5181a7[_0x55f559(0x1d8)]()&&_0x178e92[_0x55f559(0x1d8)]()){const _0x29d6e1=_0x5181a7[_0x55f559(0x1a5)](),_0x453f94=_0x178e92[_0x55f559(0x1a5)]();_0x29d6e1['position']>_0x453f94[_0x55f559(0x1c5)]?(await updateDoc(_0x52b4fa,{'position':_0x453f94['position']}),console[_0x55f559(0x1a8)](_0x55f559(0x1bf)+_0x29d6e1[_0x55f559(0x1bc)]+'\x20moved\x20to\x20position\x20'+_0x453f94['position'])):console['log']('No\x20position\x20change\x20needed;\x20winner\x20is\x20already\x20above\x20the\x20loser.');}}catch(_0x27858a){console['error']('Error\x20approving\x20report:',_0x27858a),alert('Error\x20approving\x20match:\x20'+_0x27858a['message']);}});}if(_0x1a65a6){const _0x25104e=_0x1a65a6['cloneNode'](!![]);_0x1a65a6['parentNode'][_0x4fff7d(0x1ce)](_0x25104e,_0x1a65a6),_0x25104e[_0x4fff7d(0x1df)]('click',async function(){const _0x423098=_0x4fff7d;try{const _0x7b4ae=prompt('Please\x20provide\x20a\x20reason\x20for\x20rejecting\x20this\x20match\x20report:','');if(_0x7b4ae===null)return;await rejectReport(_0x53f633['id'],_0x7b4ae),hideLightbox(),alert('Match\x20report\x20rejected\x20successfully'),updatePendingMatchNotification(),location[_0x423098(0x1d6)]();}catch(_0x4c39e3){console[_0x423098(0x1ad)]('Error\x20rejecting\x20report:',_0x4c39e3),alert('Error\x20rejecting\x20match:\x20'+_0x4c39e3[_0x423098(0x19c)]);}});}if(_0x483fa4){const _0x5f34c2=_0x483fa4[_0x4fff7d(0x1ab)](!![]);_0x483fa4[_0x4fff7d(0x221)]['replaceChild'](_0x5f34c2,_0x483fa4),_0x5f34c2['addEventListener']('click',hideLightbox);}})[_0xb85a47(0x1f6)](_0x1c6717=>{const _0x503f94=_0xb85a47;console['error'](_0x503f94(0x216),_0x1c6717),alert('Error\x20fetching\x20player\x20data.\x20Please\x20try\x20again.');});}}function showLightbox(){const _0x4a930a=a47_0x1940c9;console['log']('Showing\x20lightbox');const _0x379a56=document[_0x4a930a(0x1f8)]('report-lightbox');if(!_0x379a56){console[_0x4a930a(0x1ad)]('Lightbox\x20element\x20not\x20found');return;}_0x379a56['classList'][_0x4a930a(0x1a2)](_0x4a930a(0x1b6));}function hideLightbox(){const _0xcffaa7=document['getElementById']('report-lightbox');_0xcffaa7['classList']['remove']('show');}function a47_0x133b(_0x49d148,_0x1db3b1){const _0x38586b=a47_0xa305();return a47_0x133b=function(_0x4fae35,_0x54e96d){_0x4fae35=_0x4fae35-0x181;let _0xa305dd=_0x38586b[_0x4fae35];return _0xa305dd;},a47_0x133b(_0x49d148,_0x1db3b1);}async function rejectReport(_0x4c58f4,_0x5926d9){const _0xca6d14=a47_0x1940c9;try{const _0x50bb3e=currentGameMode==='D1'?_0xca6d14(0x1e1):currentGameMode==='D2'?_0xca6d14(0x1d5):'pendingMatchesD3',_0x373b90=currentGameMode==='D1'?'RejectedD1':currentGameMode==='D2'?_0xca6d14(0x185):'RejectedD3';console['log'](_0xca6d14(0x1a4)+_0x4c58f4+'\x20from\x20'+_0x50bb3e+_0xca6d14(0x19b)+_0x373b90);const _0xc9c59b=auth['currentUser'];if(!_0xc9c59b)throw new Error(_0xca6d14(0x1a1));const _0x30805a=doc(db,_0x50bb3e,_0x4c58f4),_0x509c22=await getDoc(_0x30805a);if(!_0x509c22['exists']())throw new Error('Match\x20report\x20not\x20found');const _0x17011e=_0x509c22['data'](),_0x29d9d0=_0x17011e['winnerId']&&_0x17011e['winnerId']===_0xc9c59b['uid']||_0x17011e[_0xca6d14(0x1c4)]&&_0x17011e['winnerEmail']===_0xc9c59b['email']||_0x17011e[_0xca6d14(0x1a6)]&&_0x17011e['winnerUsername']===await getUsernameFromId(_0xc9c59b['uid']);if(!_0x29d9d0)throw new Error('Only\x20the\x20winner\x20of\x20the\x20match\x20can\x20reject\x20it');const _0x47b07c={..._0x17011e,'rejectedAt':serverTimestamp(),'rejectedBy':_0xc9c59b[_0xca6d14(0x209)],'rejectionReason':_0x5926d9||'No\x20reason\x20provided','originalDocumentId':_0x4c58f4},_0x44f9bf=doc(collection(db,_0x373b90));return await setDoc(_0x44f9bf,_0x47b07c),await deleteDoc(_0x30805a),console['log'](_0xca6d14(0x1d1)+_0x4c58f4+'\x20rejected\x20successfully'),updatePendingMatchNotification(),!![];}catch(_0x2b3d7e){console['error'](_0xca6d14(0x1fe),_0x2b3d7e);throw _0x2b3d7e;}}async function getUsernameFromId(_0x489a58){const _0x7e2573=a47_0x1940c9,_0x4907c5=await getDoc(doc(db,'players',_0x489a58));if(_0x4907c5['exists']())return _0x4907c5['data']()['username'];const _0x4055b0=await getDoc(doc(db,'playersD2',_0x489a58));if(_0x4055b0[_0x7e2573(0x1d8)]())return _0x4055b0[_0x7e2573(0x1a5)]()['username'];return null;}async function loadOpponentsList(_0x3e4cc4){const _0x39a87c=a47_0x1940c9;try{const _0xbed2f6=document[_0x39a87c(0x1f8)](_0x39a87c(0x195)),_0x203eaf=document['getElementById'](_0x39a87c(0x1c0)),_0x491d0e=document['getElementById']('winner-username');if(!_0xbed2f6||!_0x203eaf||!_0x491d0e){console['error']('Required\x20elements\x20not\x20found\x20for\x20loadOpponentsList');return;}const _0x22afec=currentGameMode==='D1'?'players':currentGameMode==='D2'?'playersD2':'playersD3';console['log']('Loading\x20opponents\x20from\x20collection:\x20'+_0x22afec);const _0x261eb1=await getDoc(doc(db,_0x22afec,_0x3e4cc4));if(!_0x261eb1['exists']()){_0xbed2f6[_0x39a87c(0x18b)]='You\x20are\x20not\x20registered\x20in\x20the\x20'+currentGameMode+'\x20ladder.',_0xbed2f6['style']['color']=_0x39a87c(0x18e),_0x203eaf['textContent']='Not\x20registered\x20in\x20this\x20ladder',_0x491d0e['disabled']=!![];return;}const _0x4e98be=_0x261eb1['data'](),_0x547fe7=_0x4e98be[_0x39a87c(0x1bc)];_0x203eaf[_0x39a87c(0x18b)]='You\x20('+_0x547fe7+')',_0xbed2f6['textContent']='',_0x491d0e[_0x39a87c(0x1d7)]=![];const _0x2e15a9=collection(db,_0x22afec),_0x4b584c=await getDocs(_0x2e15a9);if(_0x4b584c['empty']){console[_0x39a87c(0x1a8)]('No\x20opponents\x20available');return;}_0x491d0e[_0x39a87c(0x222)]='<option\x20value=\x22\x22>Select\x20Opponent</option>',_0x4b584c[_0x39a87c(0x1ed)](_0x577adf=>{const _0x5dfa8d=_0x39a87c,_0x3723b1=_0x577adf['data']();if(_0x577adf['id']!==_0x3e4cc4){const _0x72c2c0=document['createElement']('option');_0x72c2c0['value']=_0x3723b1['username'],_0x72c2c0[_0x5dfa8d(0x18b)]=_0x3723b1['username'],_0x72c2c0['dataset'][_0x5dfa8d(0x209)]=_0x577adf['id'],_0x491d0e['appendChild'](_0x72c2c0);}});}catch(_0x44f974){console['error'](_0x39a87c(0x1b9),_0x44f974),document['getElementById'](_0x39a87c(0x195))['textContent']='Error\x20loading\x20opponents.\x20Please\x20try\x20again\x20later.',document['getElementById'](_0x39a87c(0x195))['style'][_0x39a87c(0x18f)]='red';}}async function checkUserInLadderAndLoadOpponents(_0x470578){const _0x398194=a47_0x1940c9;try{const _0x48a2b1=document['getElementById']('report-error'),_0x12e896=document[_0x398194(0x1f8)]('loser-username'),_0x25a608=document['getElementById'](_0x398194(0x1ff)),_0x42fde2=document['getElementById']('report-form'),_0x30dde8=document['getElementById']('auth-warning');_0x48a2b1[_0x398194(0x18b)]='Checking\x20if\x20you\x20are\x20registered\x20in\x20'+currentGameMode+_0x398194(0x207),_0x48a2b1['style']['color']=_0x398194(0x205);const _0xa9983a=currentGameMode==='D1'?_0x398194(0x1b7):currentGameMode==='D2'?'playersD2':'playersD3';console['log']('Checking\x20if\x20user\x20exists\x20in\x20collection:\x20'+_0xa9983a);const _0x2f9343=await getDoc(doc(db,_0xa9983a,_0x470578));if(!_0x2f9343['exists']())return _0x48a2b1[_0x398194(0x18b)]='You\x20are\x20not\x20registered\x20in\x20the\x20'+currentGameMode+'\x20ladder.',_0x48a2b1[_0x398194(0x1db)]['color']='red',_0x12e896['textContent']=_0x398194(0x1b5),_0x25a608[_0x398194(0x1d7)]=!![],_0x25a608['innerHTML']='<option\x20value=\x22\x22>Select\x20Opponent</option>',_0x30dde8[_0x398194(0x1db)]['display']=_0x398194(0x1f0),_0x30dde8[_0x398194(0x18b)]='You\x20are\x20not\x20registered\x20in\x20the\x20'+currentGameMode+'\x20ladder.',![];_0x48a2b1['textContent']='',_0x30dde8['style'][_0x398194(0x18c)]='none';const _0x3f2139=_0x2f9343['data'](),_0x5934ec=_0x3f2139['username'];_0x12e896['textContent']='You\x20('+_0x5934ec+')',_0x25a608['disabled']=![],_0x42fde2['style']['display']='block',await loadOpponentsList(_0x470578);const _0x4b0fbf=currentGameMode==='D1'?'pendingMatches':currentGameMode==='D2'?'pendingMatchesD2':'pendingMatchesD3';return await checkForOutstandingReports(_0x3f2139[_0x398194(0x19d)],null,_0x4b0fbf),!![];}catch(_0x473938){return console[_0x398194(0x1ad)](_0x398194(0x181),_0x473938),document[_0x398194(0x1f8)](_0x398194(0x195))['textContent']='Error\x20checking\x20ladder\x20membership.\x20Please\x20try\x20again\x20later.',document['getElementById']('report-error')[_0x398194(0x1db)]['color']='red',![];}}export async function fetchOutstandingMatches(){const _0x4661a7=a47_0x1940c9,_0xa1e17b=auth[_0x4661a7(0x183)];if(!_0xa1e17b)return[];try{const _0x30465e=[],_0x39731e=currentGameMode==='D1'?_0x4661a7(0x1e1):currentGameMode==='D2'?'pendingMatchesD2':_0x4661a7(0x184),_0x40ed0a=collection(db,_0x39731e),_0x8ad802=[query(_0x40ed0a,where(_0x4661a7(0x211),'==',_0xa1e17b['uid']),where('approved','==',![])),query(_0x40ed0a,where('loserEmail','==',_0xa1e17b['email']),where(_0x4661a7(0x188),'==',![])),query(_0x40ed0a,where('winnerId','==',_0xa1e17b['uid']),where('approved','==',![])),query(_0x40ed0a,where('winnerEmail','==',_0xa1e17b['email']),where('approved','==',![]))],_0x3ec0c7=currentGameMode==='D1'?'players':currentGameMode==='D2'?'playersD2':_0x4661a7(0x21c),_0x55f6f4=await getDocs(query(collection(db,_0x3ec0c7),where('email','==',_0xa1e17b[_0x4661a7(0x19d)])));let _0x757e69=null;!_0x55f6f4[_0x4661a7(0x1f9)]&&(_0x757e69=_0x55f6f4['docs'][0x0]['data']()['username'],_0x757e69&&_0x8ad802['push'](query(_0x40ed0a,where(_0x4661a7(0x1cf),'==',_0x757e69),where('approved','==',![])),query(_0x40ed0a,where('winnerUsername','==',_0x757e69),where('approved','==',![]))));for(const _0x5e7e55 of _0x8ad802){const _0x5a8399=await getDocs(_0x5e7e55);!_0x5a8399['empty']&&_0x5a8399['forEach'](_0x5530d6=>{const _0x371dff=_0x4661a7;!_0x30465e[_0x371dff(0x199)](_0x27fe85=>_0x27fe85['id']===_0x5530d6['id'])&&_0x30465e['push']({'id':_0x5530d6['id'],..._0x5530d6[_0x371dff(0x1a5)]()});});}return _0x30465e['sort']((_0x269262,_0x2845f6)=>{const _0x5db0ee=_0x4661a7,_0x3eb8ee=_0x269262['createdAt']?.[_0x5db0ee(0x1a9)]()||new Date(0x0),_0x395254=_0x2845f6['createdAt']?.[_0x5db0ee(0x1a9)]()||new Date(0x0);return _0x395254-_0x3eb8ee;}),outstandingMatches=_0x30465e,_0x30465e;}catch(_0x1042fc){return console['error'](_0x4661a7(0x192),_0x1042fc),[];}}export function renderOutstandingMatches(){const _0x135080=a47_0x1940c9,_0x2ba3d1=document['getElementById']('outstanding-matches-list');if(outstandingMatches['length']===0x0){_0x2ba3d1[_0x135080(0x222)]=_0x135080(0x18d);return;}let _0x414dde='';const _0x4bfc58=auth[_0x135080(0x183)];if(!_0x4bfc58)return;outstandingMatches['forEach'](_0x465d2f=>{const _0x1737ec=_0x135080,_0xa48a0e=_0x465d2f['createdAt']?.['toDate']()?_0x465d2f['createdAt']['toDate']()['toLocaleDateString']():_0x1737ec(0x218),_0x49303d=_0x465d2f[_0x1737ec(0x190)]===_0x4bfc58['email']||_0x465d2f['loserId']===_0x4bfc58['uid'];_0x414dde+='\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22match-item\x22\x20data-id=\x22'+_0x465d2f['id']+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3>'+(_0x465d2f['winnerUsername']||_0x1737ec(0x1e0))+'\x20vs\x20'+(_0x465d2f['loserUsername']||'Loser')+'</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22match-details\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22match-detail-item\x22>Map:\x20'+(_0x465d2f['mapPlayed']||'Unknown')+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22match-detail-item\x22>Date:\x20'+_0xa48a0e+_0x1737ec(0x1ae)+(_0x465d2f['loserScore']||'0')+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22match-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20view-detail-btn\x22\x20data-id=\x22'+_0x465d2f['id']+_0x1737ec(0x1f3)+(_0x49303d?_0x1737ec(0x201)+_0x465d2f['id']+_0x1737ec(0x1f4)+_0x465d2f['id']+'\x22>Rescind\x20Report</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20':'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';}),_0x2ba3d1[_0x135080(0x222)]=_0x414dde,document['querySelectorAll']('.view-detail-btn')['forEach'](_0x575463=>{const _0x72ed9a=_0x135080;_0x575463[_0x72ed9a(0x1df)]('click',function(){const _0x328410=_0x72ed9a,_0x1be2a2=this['getAttribute']('data-id'),_0x444c6f=outstandingMatches['find'](_0x17d32d=>_0x17d32d['id']===_0x1be2a2);document['getElementById']('outstanding-modal')['classList'][_0x328410(0x198)]('show'),showMatchLightbox(_0x444c6f);});}),document[_0x135080(0x193)](_0x135080(0x1c7))[_0x135080(0x1ed)](_0x154303=>{const _0x12ea0f=_0x135080;_0x154303['addEventListener'](_0x12ea0f(0x212),function(){const _0x5687fa=_0x12ea0f,_0x4182e6=this[_0x5687fa(0x1f5)]('data-id'),_0x5cdc2c=outstandingMatches['find'](_0x34edbe=>_0x34edbe['id']===_0x4182e6);document['getElementById']('outstanding-modal')['classList']['remove']('show'),editReport(_0x5cdc2c);});}),document['querySelectorAll']('.rescind-report-btn')[_0x135080(0x1ed)](_0x3941c0=>{_0x3941c0['addEventListener']('click',function(){const _0x4316df=a47_0x133b,_0x4c1851=this[_0x4316df(0x1f5)](_0x4316df(0x1cd)),_0xfd1487=outstandingMatches['find'](_0x50127a=>_0x50127a['id']===_0x4c1851);confirm('Are\x20you\x20sure\x20you\x20want\x20to\x20rescind\x20this\x20match\x20report\x20against\x20'+(_0xfd1487['winnerUsername']||'opponent')+'?')&&rescindReport(_0xfd1487);});});}export async function rescindReport(_0x572e15){const _0x103af9=a47_0x1940c9;try{const _0xd127e2=currentGameMode==='D1'?_0x103af9(0x1e1):currentGameMode==='D2'?'pendingMatchesD2':_0x103af9(0x184),_0x5bba49=doc(db,_0xd127e2,_0x572e15['id']);await deleteDoc(_0x5bba49),alert('Report\x20has\x20been\x20successfully\x20rescinded.'),await fetchOutstandingMatches(),renderOutstandingMatches();}catch(_0x470d41){console['error']('Error\x20rescinding\x20report:',_0x470d41),alert(_0x103af9(0x217));}}export function editReport(_0x3beec0){const _0x3745fe=a47_0x1940c9,_0x222396=document[_0x3745fe(0x1f8)]('report-form'),_0x3c97d3=document['getElementById']('loser-score'),_0x4a2952=document[_0x3745fe(0x1f8)]('suicides'),_0x2c96b3=document['getElementById']('map-played'),_0x6f926c=document[_0x3745fe(0x1f8)]('loser-comment');_0x222396['style']['display']='block',document['getElementById']('auth-warning')['style']['display']='none';if(_0x3beec0[_0x3745fe(0x1a7)])_0x3c97d3['value']=_0x3beec0[_0x3745fe(0x1a7)];if(_0x3beec0['loserSuicides'])_0x4a2952['value']=_0x3beec0[_0x3745fe(0x189)];if(_0x3beec0['mapPlayed'])_0x2c96b3['value']=_0x3beec0['mapPlayed'];if(_0x3beec0['loserComment'])_0x6f926c['value']=_0x3beec0['loserComment'];const _0xb8f5f0=document['getElementById'](_0x3745fe(0x1ff));_0xb8f5f0&&_0x3beec0['winnerUsername']&&Array['from'](_0xb8f5f0[_0x3745fe(0x1be)])['forEach'](_0x5ccd84=>{const _0x29cc26=_0x3745fe;_0x5ccd84['text']===_0x3beec0['winnerUsername']&&(_0x5ccd84[_0x29cc26(0x1fa)]=!![]);});const _0x3b4e14=document['getElementById']('subgame-type');_0x3b4e14&&_0x3beec0['subgameType']&&(_0x3b4e14['value']=_0x3beec0['subgameType']);_0x222396['setAttribute']('data-edit-id',_0x3beec0['id']);const _0x41c5d1=_0x222396['querySelector'](_0x3745fe(0x20f));_0x41c5d1[_0x3745fe(0x18b)]=_0x3745fe(0x1fc);if(!document['getElementById']('cancel-edit-btn')){const _0x2fe9e5=document['createElement'](_0x3745fe(0x1ea));_0x2fe9e5['id']=_0x3745fe(0x1eb),_0x2fe9e5[_0x3745fe(0x1c2)]=_0x3745fe(0x1aa),_0x2fe9e5[_0x3745fe(0x1db)][_0x3745fe(0x219)]=_0x3745fe(0x1bd),_0x2fe9e5['style']['marginRight']='10px',_0x2fe9e5[_0x3745fe(0x18b)]='Cancel\x20Edit',_0x2fe9e5[_0x3745fe(0x187)]='button',_0x41c5d1['parentNode']['insertBefore'](_0x2fe9e5,_0x41c5d1),_0x2fe9e5['addEventListener']('click',function(_0x892d52){const _0x405223=_0x3745fe;_0x892d52['preventDefault'](),_0x222396[_0x405223(0x1f2)](),_0x222396[_0x405223(0x1b3)]('data-edit-id'),_0x41c5d1[_0x405223(0x18b)]='Report\x20Game',this['remove'](),initReportForm();});}_0x222396['scrollIntoView']({'behavior':_0x3745fe(0x215)});}function initReportForm(){const _0x4da26d=a47_0x1940c9;console[_0x4da26d(0x1a8)](_0x4da26d(0x1bb));}export function showMatchLightbox(_0x567fb5){const _0x42c019=a47_0x1940c9,_0x547469=document['getElementById'](_0x42c019(0x1d4));document['getElementById']('lightbox-game-mode')['textContent']=currentGameMode,document[_0x42c019(0x1f8)]('lightbox-winner')['textContent']=_0x567fb5['winnerUsername']||'Unknown',document['getElementById']('lightbox-loser')[_0x42c019(0x18b)]=_0x567fb5['loserUsername']||'Unknown',document['getElementById']('lightbox-loser-score')['textContent']=_0x567fb5[_0x42c019(0x1a7)]||'0',document['getElementById']('lightbox-suicides')[_0x42c019(0x18b)]=_0x567fb5[_0x42c019(0x189)]||'0',document[_0x42c019(0x1f8)](_0x42c019(0x20d))['textContent']=_0x567fb5['mapPlayed']||'Unknown',document['getElementById']('lightbox-comment')['textContent']=_0x567fb5['loserComment']||'No\x20comment',document[_0x42c019(0x1f8)](_0x42c019(0x1ca))['textContent']=_0x567fb5['subgameType']||'Standard\x20Match',_0x547469['classList']['add']('show');}export function setCurrentGameMode(_0x4f12d4){currentGameMode=_0x4f12d4;}export function initOutstandingMatches(){document['addEventListener']('DOMContentLoaded',()=>{const _0x4fd403=a47_0x133b,_0x53e70c=document['getElementById'](_0x4fd403(0x1b0)),_0x1802c0=document[_0x4fd403(0x1f8)](_0x4fd403(0x19e)),_0x39f418=document['getElementById']('outstanding-modal'),_0x23b15d=document[_0x4fd403(0x1f8)]('close-outstanding-btn'),_0x1da94d=document['getElementById']('cancel-button'),_0x3337bb=document['getElementById']('d1-mode'),_0x140619=document[_0x4fd403(0x1f8)]('d2-mode'),_0x1a5d2f=document[_0x4fd403(0x1f8)](_0x4fd403(0x1de));if(_0x3337bb)_0x3337bb[_0x4fd403(0x1df)]('click',()=>{setCurrentGameMode('D1');});if(_0x140619)_0x140619[_0x4fd403(0x1df)](_0x4fd403(0x212),()=>{setCurrentGameMode('D2');});if(_0x1a5d2f)_0x1a5d2f['addEventListener']('click',()=>{setCurrentGameMode('D3');});auth[_0x4fd403(0x1cb)](_0x9cdfae=>{const _0x1c8cfd=_0x4fd403;_0x9cdfae?_0x1802c0['style']['display']=_0x1c8cfd(0x1f0):_0x1802c0['style'][_0x1c8cfd(0x18c)]=_0x1c8cfd(0x1b4);});_0x53e70c&&_0x53e70c['addEventListener']('click',async()=>{const _0x2f1417=_0x4fd403;_0x39f418[_0x2f1417(0x1e9)][_0x2f1417(0x1a2)](_0x2f1417(0x1b6)),document[_0x2f1417(0x1f8)]('outstanding-matches-list')[_0x2f1417(0x222)]='<div\x20class=\x22loading\x22>Loading\x20your\x20matches...</div>',await fetchOutstandingMatches(),renderOutstandingMatches();});_0x23b15d&&_0x23b15d[_0x4fd403(0x1df)]('click',()=>{const _0x36e17c=_0x4fd403;_0x39f418['classList'][_0x36e17c(0x198)](_0x36e17c(0x1b6));});_0x1da94d&&_0x1da94d['addEventListener']('click',()=>{const _0x15c2b2=_0x4fd403;document[_0x15c2b2(0x1f8)]('report-lightbox')['classList']['remove']('show');});_0x39f418&&_0x39f418[_0x4fd403(0x1df)](_0x4fd403(0x212),_0x3aeb4a=>{const _0x12693b=_0x4fd403;_0x3aeb4a[_0x12693b(0x1c6)]===_0x39f418&&_0x39f418['classList'][_0x12693b(0x198)]('show');});const _0x37593d=document[_0x4fd403(0x1f8)]('report-lightbox');_0x37593d&&_0x37593d[_0x4fd403(0x1df)](_0x4fd403(0x212),_0xf2d77c=>{const _0x5b11e7=_0x4fd403;_0xf2d77c['target']===_0x37593d&&_0x37593d[_0x5b11e7(0x1e9)][_0x5b11e7(0x198)]('show');});const _0x2ddaf8=document[_0x4fd403(0x1f8)]('report-form');if(_0x2ddaf8){const _0x162e48=_0x2ddaf8['onsubmit'];_0x2ddaf8['onsubmit']=async function(_0x504788){const _0x472501=_0x4fd403;_0x504788['preventDefault']();const _0x317b2f=this[_0x472501(0x1f5)]('data-edit-id');if(_0x317b2f)try{const _0x5c8254=document['getElementById']('loser-score')['value'],_0x33309b=document['getElementById'](_0x472501(0x1b1))['value'],_0x3e6734=document[_0x472501(0x1f8)]('map-played')['value'],_0x4cdcf9=document['getElementById']('loser-comment')[_0x472501(0x1c9)],_0x1872ad=currentGameMode==='D1'?'pendingMatches':currentGameMode==='D2'?'pendingMatchesD2':'pendingMatchesD3',_0x57a589=doc(db,_0x1872ad,_0x317b2f);await updateDoc(_0x57a589,{'loserScore':Number(_0x5c8254),'loserSuicides':Number(_0x33309b),'mapPlayed':_0x3e6734,'loserComment':_0x4cdcf9,'subgameType':document[_0x472501(0x1f8)]('subgame-type')['value'],'updatedAt':new Date()}),alert('Report\x20has\x20been\x20successfully\x20updated.'),this['reset'](),this['removeAttribute']('data-edit-id');const _0x4604fd=this['querySelector']('button[type=\x22submit\x22]');_0x4604fd[_0x472501(0x18b)]='Report\x20Game';const _0x1efae8=document['getElementById'](_0x472501(0x1eb));if(_0x1efae8)_0x1efae8['remove']();}catch(_0x22b6c4){console['error']('Error\x20updating\x20report:',_0x22b6c4),document[_0x472501(0x1f8)](_0x472501(0x195))[_0x472501(0x18b)]='Failed\x20to\x20update\x20report.\x20Please\x20try\x20again.';}else typeof _0x162e48===_0x472501(0x18a)&&_0x162e48[_0x472501(0x194)](this,_0x504788);};}});}typeof window!=='undefined'&&(window[a47_0x1940c9(0x1fd)]=showMatchLightbox,window['editReport']=editReport,window[a47_0x1940c9(0x1d3)]=rescindReport,window['fetchOutstandingMatches']=fetchOutstandingMatches,window['renderOutstandingMatches']=renderOutstandingMatches);initOutstandingMatches();
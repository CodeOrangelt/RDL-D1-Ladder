function a15a(){const t=['ywXS','BwfW','mtyWmtqXsenhuMTe','zxHPC3rZ','CgXHEwvY','mtjtrufowuq','zw1WDhK','mty5otqYnefIt0TtsG','DgLTzxn0yw1W','CgXHEwvYC0qZ','rxjYB3iGzMv0y2HPBMCGrdmGruXpigHPC3rVCNK6','ChjVBw90Aw9U','rdmGruXpigHPC3rVCNKGCMvJB3jKzwqGzM9Yia','vw5RBM93BIbqBgf5zxi','mtvSu0rhuMq','yxbWCM92zwrnyxrJAgvZrdm','mtm0mda5nMHzuMf3wG','ChjLDMLVDxnfBg8','vw5Yyw5Rzwq','Bwf0y2G','u2LSDMvY','odeXodu1mvfTwxbKwG','r29Sza','rxjYB3iGCMvJB3jKAw5NieqZievmtYbOAxn0B3j5oG','zgvZyW','ntGWuhjSBxjn','zxjYB3i','zgf0yq','ndmYmte3B1HuAgTb','Bg9ZzxjvC2vYBMfTzq','mZe5nZqWAKnttKnj','zg9JCW','mtK3nZe2mKD2CvjOuG','rw1LCMfSza'];a15a=function(){return t;};return a15a();}const a15o=a15b;(function(a,b){const n=a15b,c=a();while(!![]){try{const d=-parseInt(n(0x1da))/0x1*(parseInt(n(0x1dd))/0x2)+parseInt(n(0x1d6))/0x3+parseInt(n(0x1e8))/0x4*(-parseInt(n(0x1e6))/0x5)+parseInt(n(0x1d4))/0x6+-parseInt(n(0x1cb))/0x7+parseInt(n(0x1df))/0x8+-parseInt(n(0x1d2))/0x9*(-parseInt(n(0x1cf))/0xa);if(d===b)break;else c['push'](c['shift']());}catch(e){c['push'](c['shift']());}}}(a15a,0x8e887));function a15b(a,b){const c=a15a();return a15b=function(d,e){d=d-0x1c7;let f=c[d];if(a15b['vihPxv']===undefined){var g=function(l){const m='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let n='',o='';for(let p=0x0,q,r,s=0x0;r=l['charAt'](s++);~r&&(q=p%0x4?q*0x40+r:r,p++%0x4)?n+=String['fromCharCode'](0xff&q>>(-0x2*p&0x6)):0x0){r=m['indexOf'](r);}for(let t=0x0,u=n['length'];t<u;t++){o+='%'+('00'+n['charCodeAt'](t)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(o);};a15b['gjbgtu']=g,a=arguments,a15b['vihPxv']=!![];}const h=c[0x0],i=d+h,j=a[i];return!j?(f=a15b['gjbgtu'](f),a[i]=f):f=j,f;},a15b(a,b);}import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc,where}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D3=[{'name':a15o(0x1d7),'elo':0x7d0},{'name':a15o(0x1cc),'elo':0x708},{'name':'Silver','elo':0x640},{'name':'Bronze','elo':0x578},{'name':a15o(0x1c8),'elo':0x4b0}];let lastVisibleD3=null;async function getUsernameByIdD3(a){const p=a15o;try{if(!a)return'Unknown\x20Player';const b=await getDoc(doc(db,p(0x1e1),a));if(b[p(0x1db)]())return b['data']()['username']||'Unknown\x20Player';const c=await getDocs(query(collection(db,'approvedMatchesD3'),where('winnerId','==',a),limit(0x1)));if(!c['empty'])return c['docs'][0x0]['data']()['winnerUsername']||p(0x1e5);const d=await getDocs(query(collection(db,p(0x1e7)),where('loserId','==',a),limit(0x1)));if(!d[p(0x1de)])return d[p(0x1d5)][0x0][p(0x1d1)]()[p(0x1d3)]||'Unknown\x20Player';return'Unknown\x20Player';}catch(e){return console[p(0x1d0)]('Error\x20getting\x20D3\x20username:',e),'Unknown\x20Player';}}export async function recordEloChangeD3({playerId:a,previousElo:b,newElo:c,opponentId:d,matchResult:e,previousPosition:f,newPosition:g,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:h,timestamp:i}){const q=a15o;try{const j=doc(collection(db,'eloHistoryD3'));let k=q(0x1c9);if(isPromotion)k=q(0x1e3);if(isDemotion)k='demotion';let l=q(0x1c8);if(c>=0x7d0)l=q(0x1d7);else{if(c>=0x708)l=q(0x1cc);else{if(c>=0x640)l=q(0x1ca);else{if(c>=0x578)l='Bronze';}}}return await setDoc(j,{'type':k,'player':a,'opponent':d,'previousElo':b,'newElo':c,'change':c-b,'matchResult':e,'previousPosition':f,'newPosition':g,'rankAchieved':l,'matchId':h,'timestamp':i||serverTimestamp(),'gameMode':'D3'}),console['log'](q(0x1e4)+a),!![];}catch(m){console[q(0x1d0)](q(0x1cd),m);throw m;}}export async function getEloHistoryD3(a=0x14){const r=a15o;try{const b=collection(db,'eloHistoryD3');let c;lastVisibleD3?c=query(b,orderBy('timestamp',r(0x1ce)),startAfter(lastVisibleD3),limit(a)):c=query(b,orderBy(r(0x1e0),'desc'),limit(a));const d=await getDocs(c);if(d[r(0x1de)])return{'entries':[],'hasMore':![]};lastVisibleD3=d['docs'][d[r(0x1d5)]['length']-0x1];const e=d['docs'][r(0x1d9)](async g=>{const s=r,h=g['data'](),[i,j]=await Promise[s(0x1d8)]([getUsernameByIdD3(h[s(0x1dc)]),getUsernameByIdD3(h['opponent'])]);return{...h,'playerUsername':i,'opponentUsername':j,'change':h['newElo']-h[s(0x1c7)],'timestamp':h[s(0x1e0)]};}),f=await Promise['all'](e);return{'entries':f,'hasMore':d['size']===a};}catch(g){console[r(0x1d0)](r(0x1e2),g);throw g;}}export function resetPaginationD3(){lastVisibleD3=null;}
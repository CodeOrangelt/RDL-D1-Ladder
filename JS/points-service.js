const a39_0x52359f=a39_0x1ecc,a39_0x21449e=(function(){let _0xf1bfb5=!![];return function(_0x4990e2,_0x2fbf8d){const _0x4ff2df=_0xf1bfb5?function(){if(_0x2fbf8d){const _0x32dea7=_0x2fbf8d['apply'](_0x4990e2,arguments);return _0x2fbf8d=null,_0x32dea7;}}:function(){};return _0xf1bfb5=![],_0x4ff2df;};}()),a39_0x1b5f81=a39_0x21449e(this,function(){const _0x636b14=a39_0x1ecc,_0x462a9d=function(){let _0x145572;try{_0x145572=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x1c870f){_0x145572=window;}return _0x145572;},_0x520189=_0x462a9d(),_0xba3e2e=_0x520189['console']=_0x520189['console']||{},_0xd93c7=['log','warn','info','error','exception','table','trace'];for(let _0x989255=0x0;_0x989255<_0xd93c7[_0x636b14(0x1cb)];_0x989255++){const _0x1b17cf=a39_0x21449e['constructor']['prototype']['bind'](a39_0x21449e),_0x26d059=_0xd93c7[_0x989255],_0xa79e97=_0xba3e2e[_0x26d059]||_0x1b17cf;_0x1b17cf['__proto__']=a39_0x21449e[_0x636b14(0x1ca)](a39_0x21449e),_0x1b17cf['toString']=_0xa79e97['toString']['bind'](_0xa79e97),_0xba3e2e[_0x26d059]=_0x1b17cf;}});a39_0x1b5f81();import{db}from'./firebase-config.js';import{doc,getDoc,updateDoc,addDoc,collection,serverTimestamp}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const POINTS_CHART={'':0xa,'Standard':0xa,'Fusion\x20Match':0x19,'â‰¥6\x20Missiles':0xa,'Weapon\x20Imbalance':0x1e,'Blind\x20Match':0x4b,'Rematch':0x14,'Disorientation':0x32,'Ratting':0x23,'Altered\x20Powerups':0x23,'Mega\x20Match':0x28,'Dogfight':0x32,'Gauss\x20and\x20Mercs':0x19,'Misc':0x1e};let adminModifyUserPoints=null;try{const adminModule=await import('./adminbackend.js');adminModule['modifyUserPoints']&&(adminModifyUserPoints=adminModule['modifyUserPoints'],console[a39_0x52359f(0x1cd)]('Admin\x20points\x20service\x20connected'));}catch(a39_0x1beacf){console[a39_0x52359f(0x1cd)]('Admin\x20backend\x20not\x20available,\x20using\x20fallback\x20points\x20service');}function a39_0x1ecc(_0x5ea109,_0x372802){const _0x1b5f81=a39_0x3064();return a39_0x1ecc=function(_0x21449e,_0x4cf497){_0x21449e=_0x21449e-0x1c9;let _0x30641e=_0x1b5f81[_0x21449e];return _0x30641e;},a39_0x1ecc(_0x5ea109,_0x372802);}export async function awardMatchPoints(_0x64d3d9,_0x192852,_0xab95e9){const _0x5f04ad=a39_0x52359f;try{const _0x6693ed=POINTS_CHART[_0xab95e9]||0xa;return adminModifyUserPoints?await Promise['all']([adminModifyUserPoints(_0x64d3d9,'add',_0x6693ed,_0x5f04ad(0x1d2)+(_0xab95e9||'Standard')+'\x20match\x20(Winner)'),adminModifyUserPoints(_0x192852,'add',_0x6693ed,_0x5f04ad(0x1d2)+(_0xab95e9||'Standard')+'\x20match\x20(Participant)')]):await Promise[_0x5f04ad(0x1c9)]([addPointsFallback(_0x64d3d9,_0x6693ed,'Match\x20points:\x20'+(_0xab95e9||'Standard')+'\x20match\x20(Winner)'),addPointsFallback(_0x192852,_0x6693ed,_0x5f04ad(0x1d2)+(_0xab95e9||'Standard')+'\x20match\x20(Participant)')]),console['log']('Awarded\x20'+_0x6693ed+_0x5f04ad(0x1d1)+(_0xab95e9||'Standard')+'\x20match'),!![];}catch(_0x584d15){return console[_0x5f04ad(0x1cc)]('Error\x20awarding\x20match\x20points:',_0x584d15),![];}}async function addPointsFallback(_0x16b83f,_0x448d9f,_0x10f038=''){const _0x5d5cdc=a39_0x52359f;try{const _0x22414b=doc(db,'userProfiles',_0x16b83f),_0x16a5aa=await getDoc(_0x22414b);if(!_0x16a5aa['exists']()){console[_0x5d5cdc(0x1cd)]('User\x20profile\x20not\x20found\x20for\x20'+_0x16b83f+_0x5d5cdc(0x1d0));return;}const _0x185827=_0x16a5aa['data'](),_0x2fd562=_0x185827['points']||0x0,_0x5508d2=_0x2fd562+_0x448d9f;await updateDoc(_0x22414b,{'points':_0x5508d2,'lastPointsModified':serverTimestamp()}),await addDoc(collection(db,_0x5d5cdc(0x1ce)),{'userId':_0x16b83f,'userEmail':_0x185827['email']||'unknown','displayName':_0x185827['displayName']||_0x185827[_0x5d5cdc(0x1cf)]||_0x5d5cdc(0x1d3),'action':'add','amount':_0x448d9f,'previousPoints':_0x2fd562,'newPoints':_0x5508d2,'reason':_0x10f038,'adminEmail':'system-match-award','timestamp':serverTimestamp()}),console['log']('Added\x20'+_0x448d9f+'\x20points\x20to\x20user\x20'+_0x16b83f+'.\x20New\x20total:\x20'+_0x5508d2);}catch(_0x5c51f8){console['error']('Error\x20adding\x20points\x20to\x20user:',_0x5c51f8);throw _0x5c51f8;}}function a39_0x3064(){const _0x2e3506=['all','bind','length','error','log','pointsHistory','username',',\x20skipping\x20points\x20award','\x20points\x20to\x20both\x20players\x20for\x20','Match\x20points:\x20','Unknown\x20User'];a39_0x3064=function(){return _0x2e3506;};return a39_0x3064();}
(function(a,b){const t=a32b,c=a();while(!![]){try{const d=-parseInt(t(0x1c6))/0x1*(parseInt(t(0x1ab))/0x2)+-parseInt(t(0x1b5))/0x3+-parseInt(t(0x1eb))/0x4*(-parseInt(t(0x1ac))/0x5)+parseInt(t(0x1e0))/0x6+-parseInt(t(0x1d1))/0x7*(-parseInt(t(0x1bb))/0x8)+-parseInt(t(0x19f))/0x9*(-parseInt(t(0x1e1))/0xa)+-parseInt(t(0x19c))/0xb*(parseInt(t(0x1ca))/0xc);if(d===b)break;else c['push'](c['shift']());}catch(e){c['push'](c['shift']());}}}(a32a,0x1c89b));import{collection,getDocs,deleteDoc,doc,getDoc,query,where,updateDoc,Timestamp,onSnapshot,orderBy,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import{getRankStyle}from'./ranks.js';import a32c from'./firebase-idle-wrapper.js';function a32b(a,b){const c=a32a();return a32b=function(d,e){d=d-0x195;let f=c[d];if(a32b['FsBOhx']===undefined){var g=function(l){const m='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let n='',o='';for(let p=0x0,q,r,s=0x0;r=l['charAt'](s++);~r&&(q=p%0x4?q*0x40+r:r,p++%0x4)?n+=String['fromCharCode'](0xff&q>>(-0x2*p&0x6)):0x0){r=m['indexOf'](r);}for(let t=0x0,u=n['length'];t<u;t++){o+='%'+('00'+n['charCodeAt'](t)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(o);};a32b['JKHlxd']=g,a=arguments,a32b['FsBOhx']=!![];}const h=c[0x0],i=d+h,j=a[i];return!j?(f=a32b['JKHlxd'](f),a[i]=f):f=j,f;},a32b(a,b);}function a32a(){const S=['Dg9mB3DLCKnHC2u','BwvZC2fNzq','mte5mZvgq0HbtLG','ChvZAa','rxjYB3iGDxbKyxrPBMCGrdiGCgXHEwvYihbVC2L0Aw9UCZO','CgXHEwvYvxnLCM5HBwu','DxnLCM5HBwu','Dg90ywXnyxrJAgvZ','rdi6ievYCM9YigzLDgnOAw5NievmtYbOAxn0B3j5oG','C2vJB25KCW','Dgq6BNrOlwnOAwXKkdmP','C29YDa','Bg9ZzxjvC2vYBMfTzq','zgLZCgXHEq','yxnJ','oYbWB3nPDgLVBJOGCMvSyxrPDMu7iJ4kicaGicaGicaGicaGpgrPDIbJBgfZCZ0IzwXVlwnVBNrHAw5LCIiGC3r5Bgu9iMrPC3bSyxK6igzSzxG7igfSAwDUlwL0zw1ZoIbJzw50zxi7iJ4kicaGicaGicaGicaGicaGidXZCgfUignSyxnZpsjLBg8TDMfSDwuIpG','pgLTzYbZCMm9iI4Ul2LTywDLCY9MBgfNCY8','mteXmdK2nMjIu2HIrq','mJi3ndm3menKyLb6DW','AgfZ','i0mWqZbdma','DgHLBG','phrYpJX0zcbJB2XZCgfUpsi4iIbJBgfZCZ0IBg9HzgLUzY1JzwXSiJ5mB2fKAw5NieqYigXHzgrLCIbKyxrHlI4Upc90zd48l3rYpG','CgXHEwvYC0qY','zMLUza','zM9YrwfJAa','zxjYB3i','D2LUBMvYu2nVCMu','mtCXnLzKwhjwqq','cIaGicaGicaGicaGicaGica8l2e+cIaGicaGicaGicaGicaGica','i2XHzgrLCI1KmIb0yM9KEq','Bg9ZC2vZ','jtWVDgq+cIaGica8l3rYpG','ywjZ','BwfW','iIakicaGicaGicaGicaGicaGicaGicaGicaGy2XHC3m9iNbSyxLLCI1MBgfNiIakicaGicaGicaGicaGicaGicaGicaGicaGC3r5Bgu9iM1HCMDPBI1Szwz0oIa1ChG7ihzLCNrPy2fSlwfSAwDUoIbTAwrKBgu7iGOGicaGicaGicaGicaGicaGicaGicaGicbVBMvYCM9Ypsj0AgLZlNn0EwXLlMrPC3bSyxK9j25VBMuNiJ4','mtfqBKf0CLa','Aw5JBhvKzxm','cIaGicaGicaGicaGidWVzgL2pGOGicaGicaGidWVDgq+cIaGicaGicaGphrKihn0EwXLpsjJB2XVCJOG','ouv6zLLrrq','i0y0ndmZnG','BgvUz3rO','z2fTzu1Vzgu','zwXVuMf0Aw5N','Dgv4DenVBNrLBNq','CxvLCNLtzwXLy3rVCG','rdi6iezVDw5K','z2v0rg9JDw1LBNrZ','lNrYzw5KlwLUzgLJyxrVCG','B3bHy2L0Eq','i2XHzgrLCI1KmIb0AgvHzcb0CG','mJy2C3rrwe13','mJK1q1feB2nd','D2LUCW','Dg9gAxHLza','Aw5Uzxjive1m','Dg90ywXezwf0Ahm','Cg9ZAxrPB24','zgf0yq','Aw5SAw5L','C2v0','mZy3odiXCvbMuMTh','DgLTzxn0yw1W','zgvZyW','C2L6zq','ChjLDMLVDxnfBg8','BM93','odbWu3zVtem','igzHBgXIywnRievmtYbJAgfUz2u6ia','i0nen0yZmG','D2LUuMf0zq','Dg90ywXlAwXSCW','C3r5Bgu','BMv3rwXV','iZuWqZG3oa','z2v0','y2HHBMDL','yM9Sza','odK3uu92q2jn','Bg9N','zwXVsgLZDg9YEq','qNjVBNPL','mte1mZKYmezoAvzovG','pc90zd4kicaGicaGica8Dgq+','y291BNrYEq','tufyx1nbrKvFsu5uruDfuG','CgXHEwvY'];a32a=function(){return S;};return a32a();}const playerCacheD2={'data':null,'timestamp':0x0},CACHE_DURATION=0x7530;async function displayLadderD2(a=![]){const u=a32b,b=document[u(0x1a5)](u(0x196));if(!b){console['error']('D2\x20Ladder\x20table\x20body\x20not\x20found');return;}b['innerHTML']=u(0x1e5);try{const c=Date['now']();if(!a&&playerCacheD2[u(0x1b2)]&&c-playerCacheD2[u(0x1b6)]<CACHE_DURATION){updateLadderDisplayD2(playerCacheD2[u(0x1b2)]);return;}const d=collection(db,'playersD2'),e=query(d,orderBy('position',u(0x1dd))),f=await a32c[u(0x1a7)](d),g=[];f[u(0x1e8)](m=>{const v=u,n=m[v(0x1b2)]();n[v(0x1d5)]&&g['push']({...n,'id':m['id'],'elo':n[v(0x1a3)]||0x0,'position':n['position']||Number[v(0x1cd)]});});const h=collection(db,'userProfiles'),i=await getDocs(h),j=new Map();i['forEach'](m=>{const w=u,n=m[w(0x1b2)]();n[w(0x1d5)]&&j['set'](n['username'][w(0x1cf)](),n);});for(const m of g){const n=m[u(0x1d5)]['toLowerCase']();if(j['has'](n)){const o=j['get'](n);o[u(0x1cc)]&&(m[u(0x1cc)]=o[u(0x1cc)]['toLowerCase']());}}const k=g['map'](q=>q['username']),l=await fetchBatchMatchStatsD2(k);g['sort']((p,q)=>{const x=u,r=l['get'](p['username'])?.['totalMatches']||0x0,s=l['get'](q['username'])?.[x(0x1d6)]||0x0;if(r===0x0!==(s===0x0))return r===0x0?0x1:-0x1;return(p['position']||0x3e7)-(q[x(0x1b1)]||0x3e7);}),g[u(0x1e8)]((p,q)=>{p['position']=q+0x1;}),playerCacheD2[u(0x1b2)]=g,playerCacheD2['timestamp']=c,updateLadderDisplayD2(g);}catch(p){console[u(0x1e9)]('Error\x20loading\x20D2\x20ladder:',p),b['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20colspan=\x228\x22\x20style=\x22text-align:\x20center;\x20color:\x20red;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Error\x20loading\x20D2\x20ladder\x20data:\x20'+p[u(0x1d0)]+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';}}function getNextAvailablePositionD2(a){const y=a32b;if(a[y(0x1a1)]===0x0)return 0x1;let b=0x0;return a['forEach'](c=>{const z=y;c[z(0x1b1)]&&typeof c['position']==='number'&&c[z(0x1b1)]>b&&(b=c[z(0x1b1)]);}),b+0x1;}async function updatePlayerPositions(a,b){const A=a32b;try{const c=collection(db,A(0x1e6)),d=await getDocs(c),e=[];d['forEach'](h=>{const B=A;e[B(0x1d2)]({'id':h['id'],...h[B(0x1b2)]()});});const f=e['find'](h=>h[A(0x1d5)]===a),g=e[A(0x1e7)](h=>h['username']===b);if(!f||!g){console[A(0x1e9)]('Could\x20not\x20find\x20winner\x20or\x20loser\x20in\x20D2\x20players\x20list');return;}if(f['position']>g['position']){const h=g[A(0x1b1)];for(const i of e){i['position']>=g['position']&&i['position']<f[A(0x1b1)]&&i['username']!==a&&await updateDoc(doc(db,A(0x1e6),i['id']),{'position':i[A(0x1b1)]+0x1});}await updateDoc(doc(db,A(0x1e6),f['id']),{'position':h});if(h===0x1){const j=doc(db,'playersD2',f['id']),k=await getDoc(j);!k[A(0x1b2)]()['firstPlaceDate']&&await updateDoc(j,{'firstPlaceDate':Timestamp[A(0x1ba)]()});}if(g['position']===0x1){const l=doc(db,A(0x1e6),g['id']);await updateDoc(l,{'firstPlaceDate':null});}playerCacheD2['timestamp']=0x0;}}catch(m){console[A(0x1e9)](A(0x1d3),m);}}function calculateStreakDays(a){const C=a32b;if(!a)return 0x0;const b=a['toDate'](),c=new Date(),d=Math[C(0x199)](c-b);return Math['ceil'](d/(0x3e8*0x3c*0x3c*0x18));}function getPlayerRankNameD2(a){const D=a32b;if(a>=0x834)return'Emerald';if(a>=0x708)return'Gold';if(a>=0x640)return'Silver';if(a>=0x578)return D(0x1c9);return'Unranked';}async function updateLadderDisplayD2(a){const E=a32b;a['sort']((g,h)=>g['position']-h[E(0x1b1)]);const b=document[E(0x1a5)]('#ladder-d2\x20tbody');if(!b)return;b['innerHTML']='';const c=a[E(0x19a)](g=>g[E(0x1d5)]),d=await fetchBatchMatchStatsD2(c),e=document[E(0x1a5)](E(0x1aa));e&&(e[E(0x1af)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Rank</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Username</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>ELO</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Matches</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Wins</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Losses</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>K/D</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Win\x20Rate</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20');const f=a['map'](g=>{const F=E,h=d[F(0x1c3)](g[F(0x1d5)])||{'totalMatches':0x0,'wins':0x0,'losses':0x0,'kda':0x0,'winRate':0x0,'totalKills':0x0,'totalDeaths':0x0};return createPlayerRowD2(g,h);})['join']('');b[E(0x1af)]=f,getPlayersLastEloChangesD2(c)[E(0x1e4)](g=>{const G=E,h=new Map();b['querySelectorAll']('tr')[G(0x1e8)]((i,j)=>{const H=G;j<c[H(0x1a1)]&&h[H(0x1b4)](c[j],i);}),g[G(0x1e8)]((i,j)=>{const I=G,k=h[I(0x1c3)](j);if(k&&i!==0x0){const l=k['querySelector'](I(0x1d9));if(l){const m=i>0x0?'+'+i:''+i,n=l[I(0x1a5)](I(0x1a8));n&&(n[I(0x1a4)]=m,n[I(0x1c0)]['color']=i>0x0?'#4CAF50':I(0x1a0),n['style']['fontWeight']=I(0x1c5),n['style']['fontSize']='0.85em',n['style'][I(0x1dc)]=I(0x1b3),n[I(0x1c0)]['visibility']='visible',n[I(0x1c0)][I(0x1a9)]='1');}}});})['catch'](g=>console[E(0x1e9)]('Error\x20updating\x20D2\x20ELO\x20trend\x20indicators:',g));}function createPlayerRowD2(a,b){const J=a32b,c=parseFloat(a['elo'])||0x0;let d='gray';if(c>=0x7d0)d=J(0x1c2);else{if(c>=0x708)d='#FFD700';else{if(c>=0x640)d=J(0x1e3);else c>=0x578&&(d=J(0x1bd));}}let e='';return a['country']&&(e=J(0x1df)+a['country'][J(0x1cf)]()+'.png\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20alt=\x22'+a[J(0x1cc)]+J(0x19b)),'\x0a\x20\x20\x20\x20<tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+a[J(0x1b1)]+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td\x20style=\x22position:\x20relative;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20position:\x20relative;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username='+encodeURIComponent(a[J(0x1d5)])+'&ladder=d2\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20style=\x22color:\x20'+d+';\x20text-decoration:\x20none;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+a['username']+J(0x195)+e+J(0x19e)+d+J(0x1de)+c+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22trend-indicator\x22\x20style=\x22margin-left:\x205px;\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+b['totalMatches']+J(0x1cb)+b['wins']+J(0x1cb)+b[J(0x197)]+J(0x1cb)+b['kda']+J(0x1cb)+b[J(0x1be)]+J(0x198);}async function getPlayersLastEloChangesD2(a){const K=a32b,b=new Map();a['forEach'](c=>b['set'](c,0x0));try{const c=collection(db,'eloHistoryD2'),d=query(c,orderBy(K(0x1b6),K(0x1b7)),limit(0x64)),e=await getDocs(d),f=new Map(),g=await getDocs(collection(db,K(0x1e6)));g['forEach'](i=>{const L=K,j=i['data']();j[L(0x1d5)]&&f['set'](i['id'],j['username']);});const h=new Map();e[K(0x1e8)](i=>{const M=K,j=i[M(0x1b2)]();let k=j[M(0x1d5)]||j[M(0x1d4)];!k&&j[M(0x1ce)]&&f[M(0x1e2)](j['player'])&&(k=f['get'](j['player']));if(!k&&j['matchId']){}k&&a['includes'](k)&&(!h['has'](k)&&h[M(0x1b4)](k,[]),h['get'](k)['push']({...j,'timestamp':j['timestamp']?.[M(0x1d8)]||0x0,'username':k}));}),h[K(0x1e8)]((i,j)=>{const N=K;if(i['length']>0x0){i[N(0x1da)]((l,m)=>m[N(0x1b6)]-l['timestamp']);const k=i[N(0x1e7)](l=>l[N(0x1c4)]!==undefined||l['newElo']!==undefined&&l['previousElo']!==undefined);if(k){let l;if(k[N(0x1c4)]!==undefined)l=k['change'];else k[N(0x1c1)]!==undefined&&k[N(0x1b9)]!==undefined&&(l=k['newElo']-k['previousElo']);l!==undefined&&b['set'](j,l);}}});if(h[K(0x1b8)]===0x0){const i=collection(db,K(0x1c8)),j=query(i,where(K(0x1a2),'==','D2'),orderBy(K(0x1b6),K(0x1b7)),limit(0x32));try{const k=await getDocs(j);console[K(0x1c7)](K(0x1a6),k[K(0x1b8)],'fallback\x20entries'),k['forEach'](l=>{const O=K,m=l['data'](),n=m['username']||m['playerUsername'];if(n&&a['includes'](n)){const o=m[O(0x1c4)]||(m[O(0x1c1)]!==undefined&&m['previousElo']!==undefined?m['newElo']-m['previousElo']:0x0);o!==0x0&&(b['set'](n,o),console['log']('D2:\x20'+n+O(0x1bc)+o));}});}catch(l){}}}catch(m){console[K(0x1e9)](K(0x1d7),m);}return b;}async function fetchBatchMatchStatsD2(a){const P=a32b,b=new Map();try{a[P(0x1e8)](e=>{b['set'](e,{'totalMatches':0x0,'wins':0x0,'losses':0x0,'totalKills':0x0,'totalDeaths':0x0,'kda':0x0,'winRate':0x0});});const c=collection(db,'approvedMatchesD2'),d=await getDocs(c);d[P(0x1e8)](e=>{const Q=P,f=e['data'](),g=f['winnerUsername'],h=f[Q(0x1db)];if(a['includes'](g)){const i=b[Q(0x1c3)](g);i['wins']++,i['totalMatches']++,i[Q(0x1bf)]+=parseInt(f['winnerScore'])||0x0,i[Q(0x1b0)]+=parseInt(f['loserScore'])||0x0;}if(a[Q(0x19d)](h)){const j=b['get'](h);j[Q(0x197)]++,j[Q(0x1d6)]++,j['totalKills']+=parseInt(f['loserScore'])||0x0,j['totalDeaths']+=parseInt(f[Q(0x1ea)])||0x0;}}),a[P(0x1e8)](e=>{const R=P,f=b['get'](e);f['kda']=f[R(0x1b0)]>0x0?(f[R(0x1bf)]/f['totalDeaths'])[R(0x1ae)](0x2):f['totalKills'][R(0x1ae)](0x2),f['winRate']=f[R(0x1d6)]>0x0?(f[R(0x1ad)]/f[R(0x1d6)]*0x64)['toFixed'](0x1):0x0;});}catch(e){console[P(0x1e9)]('Error\x20fetching\x20batch\x20D2\x20match\x20stats:',e);}return b;}export{displayLadderD2,updatePlayerPositions};
const a38_0x1c7988=a38_0xf432,a38_0x4cced6=(function(){let _0x516cfa=!![];return function(_0x33a380,_0x41d3d0){const _0x1db9c8=_0x516cfa?function(){if(_0x41d3d0){const _0x2a889e=_0x41d3d0['apply'](_0x33a380,arguments);return _0x41d3d0=null,_0x2a889e;}}:function(){};return _0x516cfa=![],_0x1db9c8;};}()),a38_0x3dd290=a38_0x4cced6(this,function(){const _0x3f611c=a38_0xf432;let _0x577ff4;try{const _0x48f8e2=Function(_0x3f611c(0x99)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x577ff4=_0x48f8e2();}catch(_0x30542a){_0x577ff4=window;}const _0x831027=_0x577ff4['console']=_0x577ff4['console']||{},_0x2c87a7=['log','warn','info',_0x3f611c(0x84),'exception','table',_0x3f611c(0x7c)];for(let _0x4028d5=0x0;_0x4028d5<_0x2c87a7['length'];_0x4028d5++){const _0x569536=a38_0x4cced6[_0x3f611c(0x87)]['prototype'][_0x3f611c(0x94)](a38_0x4cced6),_0x581257=_0x2c87a7[_0x4028d5],_0xc4e07=_0x831027[_0x581257]||_0x569536;_0x569536['__proto__']=a38_0x4cced6[_0x3f611c(0x94)](a38_0x4cced6),_0x569536['toString']=_0xc4e07['toString']['bind'](_0xc4e07),_0x831027[_0x581257]=_0x569536;}});a38_0x3dd290();const functions=require('firebase-functions'),admin=require('firebase-admin');admin['initializeApp']();const db=admin['firestore']();exports['updateMembersList']=functions[a38_0x1c7988(0x8d)]['document']('{collection}/{docId}')['onWrite'](async(_0x55bf6c,_0x4dcfa6)=>{const _0x30c1ab=a38_0x1c7988,_0x14cbb3=_0x4dcfa6['params']['collection'],_0x245ff9=_0x4dcfa6[_0x30c1ab(0x8e)][_0x30c1ab(0x80)];if(!['players','playersD2','playersD3',_0x30c1ab(0x90),_0x30c1ab(0x8a)][_0x30c1ab(0x83)](_0x14cbb3))return null;try{await rebuildMembersList(),console['log'](_0x30c1ab(0x9b));}catch(_0x30d6b0){console['error'](_0x30c1ab(0x92),_0x30d6b0);}});function a38_0x2cd1(){const _0x7b2b25=['trace','delete','favoriteMap','set','docId','push','collection','includes','error','has','forEach','constructor','serverTimestamp','length','nonParticipants','Unknown','FieldValue','firestore','params','elo','userProfiles','send','Error\x20updating\x20members\x20list:','playersD2','bind','ladders','https','username','get','return\x20(function()\x20','ref','Successfully\x20updated\x20aggregated\x20members\x20list'];a38_0x2cd1=function(){return _0x7b2b25;};return a38_0x2cd1();}async function rebuildMembersList(){const _0x3af533=a38_0x1c7988,_0x52895d=db['batch'](),[_0x1bf285,_0x2bd343,_0x3364c0,_0x382c5e,_0x79666a]=await Promise['all']([db['collection']('userProfiles')['get'](),db[_0x3af533(0x82)]('players')['get'](),db['collection'](_0x3af533(0x93))['get'](),db['collection']('playersD3')['get'](),db[_0x3af533(0x82)]('nonParticipants')[_0x3af533(0x98)]()]),_0xced9fd=new Map();_0x1bf285['forEach'](_0x241fba=>{const _0x68c847=_0x3af533;_0xced9fd[_0x68c847(0x7f)](_0x241fba['id'],_0x241fba['data']());});const _0x3d298e=new Map(),_0x2ba4f1=(_0x131a41,_0x43ebeb)=>{_0x131a41['forEach'](_0x392cba=>{const _0x3fc208=a38_0xf432,_0x379357=_0x392cba['data'](),_0x14fd09=_0x392cba['id'];!_0x3d298e[_0x3fc208(0x85)](_0x14fd09)&&_0x3d298e['set'](_0x14fd09,{'userId':_0x14fd09,'username':_0x379357['username']||_0x3fc208(0x8b),'ladders':[],'isNonParticipant':![]});const _0x1bb9f3=_0x3d298e[_0x3fc208(0x98)](_0x14fd09);_0x1bb9f3['ladders']['push']({'ladder':_0x43ebeb,'elo':_0x379357['eloRating']||0x4b0,'active':_0x379357['active']!==![]});});};_0x2ba4f1(_0x2bd343,'D1'),_0x2ba4f1(_0x3364c0,'D2'),_0x2ba4f1(_0x382c5e,'D3'),_0x79666a['forEach'](_0x4ab7f8=>{const _0x239d6d=_0x3af533,_0x28191e=_0x4ab7f8['data'](),_0x1bfca3=_0x4ab7f8['id'];!_0x3d298e[_0x239d6d(0x85)](_0x1bfca3)&&_0x28191e[_0x239d6d(0x97)]&&_0x3d298e[_0x239d6d(0x7f)](_0x1bfca3,{'userId':_0x1bfca3,'username':_0x28191e[_0x239d6d(0x97)],'ladders':[],'isNonParticipant':!![]});});const _0x4dbfc3=[];_0x3d298e['forEach']((_0x2aa9b7,_0x3206b7)=>{const _0x40c460=_0x3af533,_0x30ddcf=_0xced9fd[_0x40c460(0x98)](_0x3206b7)||{};let _0x478143=0x0,_0x41ddfb=null;if(_0x2aa9b7[_0x40c460(0x95)]['length']>0x0){const _0x1956bb=_0x2aa9b7['ladders']['sort']((_0x3b8fd9,_0x3c7cc5)=>_0x3c7cc5['elo']-_0x3b8fd9[_0x40c460(0x8f)]);_0x478143=_0x1956bb[0x0]['elo'],_0x41ddfb=_0x1956bb[0x0]['ladder'];}const _0x53b953={'userId':_0x3206b7,'username':_0x2aa9b7[_0x40c460(0x97)],'profileImageUrl':_0x30ddcf['profileImageUrl']||null,'country':_0x30ddcf['country']||null,'motto':_0x30ddcf['motto']||null,'favoriteMap':_0x30ddcf[_0x40c460(0x7e)]||null,'favoriteWeapon':_0x30ddcf['favoriteWeapon']||null,'isNonParticipant':_0x2aa9b7['isNonParticipant'],'ladders':_0x2aa9b7['ladders'],'primaryLadder':_0x41ddfb,'highestElo':_0x478143,'rank':getPlayerRank(_0x478143),'lastUpdated':admin['firestore'][_0x40c460(0x8c)][_0x40c460(0x88)]()};_0x4dbfc3[_0x40c460(0x81)](_0x53b953);});const _0x303b0a=db['collection']('aggregatedMembers'),_0x440368=await _0x303b0a[_0x3af533(0x98)](),_0xc8fc7=[];_0x440368['forEach'](_0x1294c9=>{const _0x5db018=_0x3af533;_0xc8fc7['push'](_0x1294c9[_0x5db018(0x9a)][_0x5db018(0x7d)]());}),await Promise['all'](_0xc8fc7);const _0x3f2404=0x1f4,_0x4cbc93=[];for(let _0x381043=0x0;_0x381043<_0x4dbfc3[_0x3af533(0x89)];_0x381043+=_0x3f2404){const _0x5ebbc3=db['batch'](),_0x39fdc5=_0x4dbfc3['slice'](_0x381043,_0x381043+_0x3f2404);_0x39fdc5[_0x3af533(0x86)](_0x89ce09=>{const _0x1fd790=_0x303b0a['doc'](_0x89ce09['userId']);_0x5ebbc3['set'](_0x1fd790,_0x89ce09);}),_0x4cbc93['push'](_0x5ebbc3['commit']());}await Promise['all'](_0x4cbc93);}function a38_0xf432(_0x1c63a1,_0x135c74){const _0x3dd290=a38_0x2cd1();return a38_0xf432=function(_0x4cced6,_0xcb7903){_0x4cced6=_0x4cced6-0x7c;let _0x2cd160=_0x3dd290[_0x4cced6];return _0x2cd160;},a38_0xf432(_0x1c63a1,_0x135c74);}function getPlayerRank(_0x5eb4e2){if(_0x5eb4e2>=0x7d0)return'emerald';if(_0x5eb4e2>=0x708)return'gold';if(_0x5eb4e2>=0x640)return'silver';if(_0x5eb4e2>=0x578)return'bronze';return'unranked';}exports['rebuildMembersListManual']=functions[a38_0x1c7988(0x96)]['onRequest'](async(_0x371c5a,_0x8bdd7c)=>{const _0x9b1594=a38_0x1c7988;try{await rebuildMembersList(),_0x8bdd7c['status'](0xc8)[_0x9b1594(0x91)]('Members\x20list\x20rebuilt\x20successfully');}catch(_0x1dca79){console['error']('Error\x20rebuilding\x20members\x20list:',_0x1dca79),_0x8bdd7c['status'](0x1f4)['send']('Error\x20rebuilding\x20members\x20list');}});
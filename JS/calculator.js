const a9_0x3447a3=a9_0xffa2,a9_0x83804d=(function(){let _0x3c5d79=!![];return function(_0x2af175,_0x18a87c){const _0x55ef00=_0x3c5d79?function(){if(_0x18a87c){const _0x4a90fd=_0x18a87c['apply'](_0x2af175,arguments);return _0x18a87c=null,_0x4a90fd;}}:function(){};return _0x3c5d79=![],_0x55ef00;};}()),a9_0x15cf04=a9_0x83804d(this,function(){const _0x3c4c5b=a9_0xffa2,_0x28e4ad=function(){const _0x260bdb=a9_0xffa2;let _0x1ec7e9;try{_0x1ec7e9=Function(_0x260bdb(0x105)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x4ec239){_0x1ec7e9=window;}return _0x1ec7e9;},_0xaa7218=_0x28e4ad(),_0x1462c5=_0xaa7218['console']=_0xaa7218['console']||{},_0x1fee64=['log','warn','info','error','exception','table',_0x3c4c5b(0xf0)];for(let _0x34fc7a=0x0;_0x34fc7a<_0x1fee64['length'];_0x34fc7a++){const _0x6c936c=a9_0x83804d['constructor']['prototype']['bind'](a9_0x83804d),_0x4de603=_0x1fee64[_0x34fc7a],_0xd21b0b=_0x1462c5[_0x4de603]||_0x6c936c;_0x6c936c['__proto__']=a9_0x83804d['bind'](a9_0x83804d),_0x6c936c[_0x3c4c5b(0x117)]=_0xd21b0b['toString']['bind'](_0xd21b0b),_0x1462c5[_0x4de603]=_0x6c936c;}});function a9_0xffa2(_0x1fcf3c,_0xf4055c){const _0x15cf04=a9_0x7cf3();return a9_0xffa2=function(_0x83804d,_0x491fee){_0x83804d=_0x83804d-0xe2;let _0x7cf31c=_0x15cf04[_0x83804d];return _0x7cf31c;},a9_0xffa2(_0x1fcf3c,_0xf4055c);}a9_0x15cf04();import{collection,getDocs,query,orderBy}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a9_0x7cf3(){const _0x54efd5=['silver','value','toFixed','calculateMatch','Player\x20not\x20found','elo','eloRating','sort','\x20ladder','currentLadder','<option\x20value=\x22\x22>Loading\x20players...</option>','none','\x20+\x20','winner-current-elo','trace','winner-new-elo','pow','calculation-text','.ladder-btn','New\x20ELO:\x20','\x0a\x20\x20','textContent','winnerChange','innerHTML','sandbox','forEach','loser-elo-change','clear','round','players','loser-current-elo','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','target','newWinnerRating','error','return\x20(function()\x20','newLoserRating','updateDropdowns','username','loser-name','\x0a\x0aInitial\x20Ratings:\x0a\x20\x20','click','values','bronze','%\x20chance\x20to\x20win)\x0a\x0aELO\x20Changes:\x0a\x20\x20','style','getELORankClass','expectedScoreLoser','addEventListener','\x20=\x20','winner-select','get','getElementById','toString','getELOColor','ladder'];a9_0x7cf3=function(){return _0x54efd5;};return a9_0x7cf3();}import{db}from'./firebase-config.js';class ELOCalculator{constructor(){const _0x2ec637=a9_0xffa2;this[_0x2ec637(0xeb)]='D1',this['players']=new Map(),this['init']();}['init'](){this['setupEventListeners'](),this['loadPlayers']();}['setupEventListeners'](){const _0xfec72d=a9_0xffa2;document['querySelectorAll']('.ladder-btn')['forEach'](_0x324eb8=>{const _0x20be42=a9_0xffa2;_0x324eb8['addEventListener'](_0x20be42(0x10b),_0xbc5b77=>{const _0x7f16fa=_0x20be42;document['querySelectorAll'](_0x7f16fa(0xf4))['forEach'](_0x56081f=>_0x56081f['classList']['remove']('active')),_0xbc5b77[_0x7f16fa(0x102)]['classList']['add']('active'),this['currentLadder']=_0xbc5b77['target']['dataset'][_0x7f16fa(0x119)],this['loadPlayers']();});}),document['getElementById']('refresh-players')[_0xfec72d(0x112)](_0xfec72d(0x10b),()=>{this['loadPlayers']();}),document['getElementById']('winner-select')[_0xfec72d(0x112)]('change',()=>this['calculateMatch']()),document[_0xfec72d(0x116)]('loser-select')[_0xfec72d(0x112)]('change',()=>this['calculateMatch']());}async['loadPlayers'](){const _0x425db2=a9_0xffa2;try{this['updateDropdowns'](_0x425db2(0xec));const _0xc873d1=this['currentLadder']==='D1'?'players':this['currentLadder']==='D2'?'playersD2':'playersD3',_0x4a1cf3=collection(db,_0xc873d1),_0x3e9155=query(_0x4a1cf3,orderBy(_0x425db2(0xe8),'desc')),_0x224e59=await getDocs(_0x3e9155);this['players'][_0x425db2(0xfd)](),_0x224e59['forEach'](_0x3ae7ea=>{const _0x180b98=_0x3ae7ea['data']();_0x180b98['username']&&this['players']['set'](_0x180b98['username'],{'id':_0x3ae7ea['id'],'username':_0x180b98['username'],'elo':parseInt(_0x180b98['eloRating'])||0x4b0,'position':_0x180b98['position']||0x3e7});}),this['updateDropdowns'](),console['log']('Loaded\x20'+this[_0x425db2(0xff)]['size']+'\x20players\x20from\x20'+this['currentLadder']+_0x425db2(0xea));}catch(_0x4598e6){console['error']('Error\x20loading\x20players:',_0x4598e6),this['updateDropdowns']('<option\x20value=\x22\x22>Error\x20loading\x20players</option>');}}[a9_0x3447a3(0x107)](_0x4dea6e=null){const _0x29def4=a9_0x3447a3,_0xf8428d=document['getElementById'](_0x29def4(0x114)),_0x352896=document['getElementById']('loser-select');if(_0x4dea6e){_0xf8428d[_0x29def4(0xf9)]=_0x4dea6e,_0x352896['innerHTML']=_0x4dea6e;return;}let _0x4178e5='<option\x20value=\x22\x22>Select\x20a\x20player...</option>';const _0x489dc8=Array['from'](this['players'][_0x29def4(0x10c)]())[_0x29def4(0xe9)]((_0x5c7287,_0x572a52)=>_0x572a52['elo']-_0x5c7287['elo']);_0x489dc8[_0x29def4(0xfb)](_0x3af9c1=>{const _0x4c4866=_0x29def4,_0x5cf864=this[_0x4c4866(0x110)](_0x3af9c1['elo']);_0x4178e5+='<option\x20value=\x22'+_0x3af9c1['username']+'\x22\x20data-elo=\x22'+_0x3af9c1['elo']+'\x22\x20class=\x22'+_0x5cf864+_0x4c4866(0x101)+_0x3af9c1['username']+'\x20('+_0x3af9c1['elo']+'\x20ELO)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</option>';}),_0xf8428d['innerHTML']=_0x4178e5,_0x352896['innerHTML']=_0x4178e5;}[a9_0x3447a3(0xe5)](){const _0x41f638=a9_0x3447a3,_0x4ff0dd=document['getElementById']('winner-select'),_0x1b3607=document['getElementById']('loser-select'),_0x91f12e=_0x4ff0dd[_0x41f638(0xe3)],_0x27efee=_0x1b3607['value'];if(!_0x91f12e||!_0x27efee){document['getElementById']('match-result')['style']['display']=_0x41f638(0xed),document['getElementById']('calculation-details')[_0x41f638(0x10f)]['display']=_0x41f638(0xed);return;}if(_0x91f12e===_0x27efee){alert('Please\x20select\x20different\x20players\x20for\x20winner\x20and\x20loser');return;}const _0x3fb086=this['players'][_0x41f638(0x115)](_0x91f12e),_0x5b757f=this['players']['get'](_0x27efee);if(!_0x3fb086||!_0x5b757f){console[_0x41f638(0x104)](_0x41f638(0xe6));return;}const _0x41aee2=this['calculateELO'](_0x3fb086['elo'],_0x5b757f['elo']);this['displayMatchResult'](_0x3fb086,_0x5b757f,_0x41aee2),this['displayCalculationDetails'](_0x3fb086,_0x5b757f,_0x41aee2);}['calculateELO'](_0x23ac1f,_0x591267,_0x18ec85=0x20){const _0x2a96dd=a9_0x3447a3,_0x49af7f=0x1/(0x1+Math['pow'](0xa,(_0x591267-_0x23ac1f)/0x190)),_0x54861f=0x1/(0x1+Math[_0x2a96dd(0xf2)](0xa,(_0x23ac1f-_0x591267)/0x190)),_0x56bbdf=_0x23ac1f+_0x18ec85*(0x1-_0x49af7f),_0x56e9ba=_0x591267+_0x18ec85*(0x0-_0x54861f);return{'winnerChange':Math[_0x2a96dd(0xfe)](_0x56bbdf-_0x23ac1f),'loserChange':Math['round'](_0x56e9ba-_0x591267),'newWinnerRating':Math['round'](_0x56bbdf),'newLoserRating':Math['round'](_0x56e9ba),'expectedScoreWinner':_0x49af7f,'expectedScoreLoser':_0x54861f};}['displayMatchResult'](_0x53ee71,_0xca4ad9,_0x4d41e5){const _0x51028b=a9_0x3447a3;document['getElementById']('winner-name')[_0x51028b(0xf7)]=_0x53ee71['username'],document['getElementById'](_0x51028b(0xef))['textContent']='Current\x20ELO:\x20'+_0x53ee71['elo'],document[_0x51028b(0x116)]('winner-elo-change')[_0x51028b(0xf7)]='+'+_0x4d41e5[_0x51028b(0xf8)],document[_0x51028b(0x116)](_0x51028b(0xf1))['textContent']=_0x51028b(0xf5)+_0x4d41e5[_0x51028b(0x103)],document[_0x51028b(0x116)]('loser-name')['textContent']=_0xca4ad9[_0x51028b(0x108)],document['getElementById'](_0x51028b(0x100))['textContent']='Current\x20ELO:\x20'+_0xca4ad9['elo'],document['getElementById'](_0x51028b(0xfc))['textContent']=''+_0x4d41e5['loserChange'],document['getElementById']('loser-new-elo')['textContent']='New\x20ELO:\x20'+_0x4d41e5['newLoserRating'];const _0x7a46fa=this[_0x51028b(0x118)](_0x53ee71[_0x51028b(0xe7)]),_0x26b854=this['getELOColor'](_0xca4ad9['elo']);document['getElementById']('winner-name')[_0x51028b(0x10f)]['color']=_0x7a46fa,document[_0x51028b(0x116)](_0x51028b(0x109))['style']['color']=_0x26b854,document['getElementById']('match-result')[_0x51028b(0x10f)]['display']='grid';}['displayCalculationDetails'](_0xeb24d7,_0x35c1b1,_0x583b34){const _0x32daeb=a9_0x3447a3,_0x1e3d2b=_0x32daeb(0x10a)+_0xeb24d7['username']+':\x20'+_0xeb24d7['elo']+_0x32daeb(0xf6)+_0x35c1b1[_0x32daeb(0x108)]+':\x20'+_0x35c1b1[_0x32daeb(0xe7)]+'\x0a\x20\x20\x0aExpected\x20Scores:\x0a\x20\x20'+_0xeb24d7['username']+':\x20'+_0x583b34['expectedScoreWinner'][_0x32daeb(0xe4)](0x3)+'\x20('+(_0x583b34['expectedScoreWinner']*0x64)['toFixed'](0x1)+'%\x20chance\x20to\x20win)\x0a\x20\x20'+_0x35c1b1['username']+':\x20'+_0x583b34[_0x32daeb(0x111)]['toFixed'](0x3)+'\x20('+(_0x583b34['expectedScoreLoser']*0x64)['toFixed'](0x1)+_0x32daeb(0x10e)+_0xeb24d7['username']+':\x20'+_0xeb24d7['elo']+'\x20+\x20'+_0x583b34[_0x32daeb(0xf8)]+_0x32daeb(0x113)+_0x583b34['newWinnerRating']+'\x0a\x20\x20'+_0x35c1b1['username']+':\x20'+_0x35c1b1['elo']+_0x32daeb(0xee)+_0x583b34['loserChange']+'\x20=\x20'+_0x583b34[_0x32daeb(0x106)]+'\x0a\x0aFormula\x20Used:\x0a\x20\x20New\x20Rating\x20=\x20Old\x20Rating\x20+\x20K-factor\x20Ã—\x20(Actual\x20Score\x20-\x20Expected\x20Score)\x0a\x20\x20K-factor\x20=\x2032\x0a\x20\x20Actual\x20Score:\x20Winner\x20=\x201,\x20Loser\x20=\x200\x0a\x20\x20\x0a'+(_0x583b34[_0x32daeb(0xf8)]>0x14?'\x20High\x20ELO\x20gain':'')+'\x0a'+(_0x583b34['winnerChange']<0x5?'Low\x20ELO\x20gain.':'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20';document['getElementById'](_0x32daeb(0xf3))[_0x32daeb(0xf7)]=_0x1e3d2b,document['getElementById']('calculation-details')[_0x32daeb(0x10f)]['display']='block';}[a9_0x3447a3(0x118)](_0x56f1d3){if(_0x56f1d3>=0x7d0)return'#50C878';else{if(_0x56f1d3>=0x708)return'#FFD700';else{if(_0x56f1d3>=0x640)return'#C0C0C0';else{if(_0x56f1d3>=0x578)return'#CD7F32';else return'#808080';}}}}[a9_0x3447a3(0x110)](_0x2840f3){const _0x5ba30e=a9_0x3447a3;if(_0x2840f3>=0x7d0)return'emerald';else{if(_0x2840f3>=0x708)return'gold';else{if(_0x2840f3>=0x640)return _0x5ba30e(0xe2);else{if(_0x2840f3>=0x578)return _0x5ba30e(0x10d);else return'unranked';}}}}}document['addEventListener']('DOMContentLoaded',()=>{const _0x3e7c15=a9_0x3447a3;document['getElementById'](_0x3e7c15(0xfa))&&new ELOCalculator();});
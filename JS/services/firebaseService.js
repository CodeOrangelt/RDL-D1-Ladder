(function(_0x1356ef,_0x5ca81a){const _0x13e616=a53_0x2be9,_0x30a6a=_0x1356ef();while(!![]){try{const _0x2e18d7=-parseInt(_0x13e616(0x143))/0x1*(-parseInt(_0x13e616(0x154))/0x2)+-parseInt(_0x13e616(0x159))/0x3*(parseInt(_0x13e616(0x14d))/0x4)+parseInt(_0x13e616(0x133))/0x5*(parseInt(_0x13e616(0x15c))/0x6)+parseInt(_0x13e616(0x13b))/0x7+parseInt(_0x13e616(0x151))/0x8+-parseInt(_0x13e616(0x14b))/0x9*(-parseInt(_0x13e616(0x12e))/0xa)+-parseInt(_0x13e616(0x148))/0xb;if(_0x2e18d7===_0x5ca81a)break;else _0x30a6a['push'](_0x30a6a['shift']());}catch(_0x23f598){_0x30a6a['push'](_0x30a6a['shift']());}}}(a53_0x5568,0x86c3b));function a53_0x5568(){const _0x258e4f=['userProfiles','forEach','18LdtDLo','bind','docs','30RVSQRK','exists','return\x20(function()\x20','table','warn','1269415FFWDBU','apply','set','now','{}.constructor(\x22return\x20this\x22)(\x20)','players','eloHistory','exception','3547411UhhwoO','toString','length','log','playersD2','console','Error\x20fetching\x20batch\x20ELO\x20history:','search','551738wjyZBq','error','includes','nonParticipants','get','21400159WwmEuE','info','docChanges','1549836GQiQXJ','eloHistoryD','2183596OYOEaV','constructor','map','trace','1238824WVoWwx','playersD3','data','4bWTqYL','ladderPlayers','timestamp','doc','username','3aOlDKC'];a53_0x5568=function(){return _0x258e4f;};return a53_0x5568();}const a53_0x5b7881=(function(){let _0x2237d9=!![];return function(_0x23d162,_0x3d6cb5){const _0x119e3f=_0x2237d9?function(){if(_0x3d6cb5){const _0x1f983c=_0x3d6cb5['apply'](_0x23d162,arguments);return _0x3d6cb5=null,_0x1f983c;}}:function(){};return _0x2237d9=![],_0x119e3f;};}()),a53_0x2e7f70=a53_0x5b7881(this,function(){const _0x4596cd=a53_0x2be9;return a53_0x2e7f70[_0x4596cd(0x13c)]()['search']('(((.+)+)+)+$')[_0x4596cd(0x13c)]()[_0x4596cd(0x14e)](a53_0x2e7f70)[_0x4596cd(0x142)]('(((.+)+)+)+$');});a53_0x2e7f70();const a53_0x345ee5=(function(){let _0x40c152=!![];return function(_0x5e17f6,_0x5d1341){const _0x173e69=_0x40c152?function(){const _0x2e70ea=a53_0x2be9;if(_0x5d1341){const _0x536c20=_0x5d1341[_0x2e70ea(0x134)](_0x5e17f6,arguments);return _0x5d1341=null,_0x536c20;}}:function(){};return _0x40c152=![],_0x173e69;};}()),a53_0xf96411=a53_0x345ee5(this,function(){const _0x10ede3=a53_0x2be9,_0x5a025a=function(){const _0x4d86d7=a53_0x2be9;let _0x376a34;try{_0x376a34=Function(_0x4d86d7(0x130)+_0x4d86d7(0x137)+');')();}catch(_0x59a61e){_0x376a34=window;}return _0x376a34;},_0x46fd09=_0x5a025a(),_0x6e1a64=_0x46fd09[_0x10ede3(0x140)]=_0x46fd09[_0x10ede3(0x140)]||{},_0x282d6f=[_0x10ede3(0x13e),_0x10ede3(0x132),_0x10ede3(0x149),_0x10ede3(0x144),_0x10ede3(0x13a),_0x10ede3(0x131),_0x10ede3(0x150)];for(let _0x5e29d3=0x0;_0x5e29d3<_0x282d6f['length'];_0x5e29d3++){const _0x16f9d5=a53_0x345ee5['constructor']['prototype'][_0x10ede3(0x15d)](a53_0x345ee5),_0x46bb0d=_0x282d6f[_0x5e29d3],_0x4b3834=_0x6e1a64[_0x46bb0d]||_0x16f9d5;_0x16f9d5['__proto__']=a53_0x345ee5[_0x10ede3(0x15d)](a53_0x345ee5),_0x16f9d5['toString']=_0x4b3834[_0x10ede3(0x13c)][_0x10ede3(0x15d)](_0x4b3834),_0x6e1a64[_0x46bb0d]=_0x16f9d5;}});a53_0xf96411();import{db}from'../firebase-config.js';import{collection,doc,getDoc,getDocs,query,limit,startAfter,where,onSnapshot}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const cache={'userProfiles':new Map(),'ladderPlayers':new Map(),'matchResults':new Map(),'eloHistory':new Map()},CACHE_EXPIRY={'userProfiles':0x5*0x3c*0x3e8,'ladderPlayers':0x2*0x3c*0x3e8,'matchResults':0x1*0x3c*0x3e8,'eloHistory':0x3*0x3c*0x3e8};export const userProfilesRef=collection(db,'userProfiles');export async function fetchPaginatedData(_0x4b1430,_0x45ff82=0xa,_0x549c25=null){const _0x54efae=a53_0x2be9;let _0x55d209=query(_0x4b1430,limit(_0x45ff82));_0x549c25&&(_0x55d209=query(_0x55d209,startAfter(_0x549c25)));const _0x2c2630=await getDocs(_0x55d209),_0x1b6976=_0x2c2630['docs'][_0x2c2630[_0x54efae(0x12d)][_0x54efae(0x13d)]-0x1];return{'data':_0x2c2630[_0x54efae(0x12d)][_0x54efae(0x14f)](_0x224dc2=>({'id':_0x224dc2['id'],..._0x224dc2[_0x54efae(0x153)]()})),'lastVisible':_0x1b6976,'hasMore':_0x2c2630[_0x54efae(0x12d)]['length']===_0x45ff82};}export async function getUserProfile(_0x1b1714){const _0x73a969=a53_0x2be9,_0x1755f2=cache[_0x73a969(0x15a)][_0x73a969(0x147)](_0x1b1714);if(_0x1755f2&&Date[_0x73a969(0x136)]()-_0x1755f2[_0x73a969(0x156)]<CACHE_EXPIRY[_0x73a969(0x15a)])return _0x1755f2[_0x73a969(0x153)];const _0x112d88=await getDoc(doc(userProfilesRef,_0x1b1714));if(_0x112d88[_0x73a969(0x12f)]()){const _0x3968a5=_0x112d88['data']();return cache[_0x73a969(0x15a)][_0x73a969(0x135)](_0x1b1714,{'data':_0x3968a5,'timestamp':Date['now']()}),_0x3968a5;}return null;}export async function getLadderData(_0x39f432=0x1){const _0x79cd1b=a53_0x2be9,_0x4c98ac='division_'+_0x39f432,_0x53133d=cache['ladderPlayers']['get'](_0x4c98ac);if(_0x53133d&&Date[_0x79cd1b(0x136)]()-_0x53133d['timestamp']<CACHE_EXPIRY[_0x79cd1b(0x155)])return _0x53133d[_0x79cd1b(0x153)];const _0x133e71=_0x39f432===0x1?_0x79cd1b(0x138):'playersD'+_0x39f432,_0x51fc20=collection(db,_0x133e71),_0x566cee=await getDocs(query(_0x51fc20,limit(0x64))),_0x2e85c4=_0x566cee[_0x79cd1b(0x12d)][_0x79cd1b(0x14f)](_0x3c55c9=>({'id':_0x3c55c9['id'],..._0x3c55c9[_0x79cd1b(0x153)]()}));return cache[_0x79cd1b(0x155)][_0x79cd1b(0x135)](_0x4c98ac,{'data':_0x2e85c4,'timestamp':Date[_0x79cd1b(0x136)]()}),_0x2e85c4;}function a53_0x2be9(_0x133566,_0x2aa87a){const _0x21dadb=a53_0x5568();return a53_0x2be9=function(_0xf96411,_0x345ee5){_0xf96411=_0xf96411-0x12d;let _0x541e54=_0x21dadb[_0xf96411];return _0x541e54;},a53_0x2be9(_0x133566,_0x2aa87a);}export async function getEloHistoryBatch(_0x52a85d,_0x59a828=0x1){const _0x42339d=a53_0x2be9,_0x57b869=_0x59a828===0x1?_0x42339d(0x139):_0x42339d(0x14c)+_0x59a828,_0x373c79=collection(db,_0x57b869),_0x2bfa90={},_0x30626e=[];_0x52a85d['forEach'](_0x7bfaf7=>{const _0x5c2051=_0x42339d,_0x18ec15=_0x7bfaf7+'_'+_0x59a828,_0x3040b3=cache['eloHistory'][_0x5c2051(0x147)](_0x18ec15);_0x3040b3&&Date['now']()-_0x3040b3['timestamp']<CACHE_EXPIRY['eloHistory']?_0x2bfa90[_0x7bfaf7]=_0x3040b3[_0x5c2051(0x153)]:_0x30626e['push'](_0x7bfaf7);});const _0x557741=0xa;for(let _0x56b307=0x0;_0x56b307<_0x30626e[_0x42339d(0x13d)];_0x56b307+=_0x557741){const _0x5e3279=_0x30626e['slice'](_0x56b307,_0x56b307+_0x557741);if(_0x5e3279[_0x42339d(0x13d)]>0x0)try{const _0x223bfa=query(_0x373c79,where('playerId','in',_0x5e3279),limit(0x64)),_0x3df6a9=await getDocs(_0x223bfa);_0x3df6a9['docs']['forEach'](_0x5b5d92=>{const _0x5ab7b8=_0x42339d,_0x3f8cc7=_0x5b5d92['data'](),_0x475b2b=_0x3f8cc7['playerId'];if(!_0x2bfa90[_0x475b2b])_0x2bfa90[_0x475b2b]=[];_0x2bfa90[_0x475b2b]['push'](_0x3f8cc7);const _0x16725e=_0x475b2b+'_'+_0x59a828;cache['eloHistory']['set'](_0x16725e,{'data':_0x2bfa90[_0x475b2b],'timestamp':Date[_0x5ab7b8(0x136)]()});});}catch(_0x4727a6){console[_0x42339d(0x144)](_0x42339d(0x141),_0x4727a6);}}return _0x2bfa90;}let usernameCache=new Map(),usernameCacheTimestamp=Date['now']();export function setupEfficientListener(_0x5991d2,_0x5254d9=[],_0x54c291){const _0x3c5275=collection(db,_0x5991d2),_0x465967=query(_0x3c5275,..._0x5254d9),_0x55438b=onSnapshot(_0x465967,_0x4c2693=>{const _0x333187=a53_0x2be9,_0x305518=_0x4c2693[_0x333187(0x14a)]()[_0x333187(0x14f)](_0x348ada=>({'type':_0x348ada['type'],'id':_0x348ada[_0x333187(0x157)]['id'],'data':_0x348ada[_0x333187(0x157)][_0x333187(0x153)]()}));_0x305518[_0x333187(0x13d)]>0x0&&_0x54c291(_0x305518,_0x4c2693['docs']);});return _0x55438b;}export async function bulkResolveUsernames(_0x7150ff){const _0x50f128=a53_0x2be9,_0x38d879=new Map();if(!_0x7150ff||_0x7150ff['length']===0x0)return _0x38d879;const _0xf8631d=['players',_0x50f128(0x13f),_0x50f128(0x152),_0x50f128(0x146)];for(const _0xd9ea1e of _0xf8631d){const _0x221a26=collection(db,_0xd9ea1e),_0x482b41=await getDocs(_0x221a26);_0x482b41[_0x50f128(0x15b)](_0x53bf47=>{const _0x22026b=_0x50f128,_0x2543bd=_0x53bf47[_0x22026b(0x153)]();_0x2543bd[_0x22026b(0x158)]&&_0x7150ff[_0x22026b(0x145)](_0x53bf47['id'])&&_0x38d879[_0x22026b(0x135)](_0x53bf47['id'],_0x2543bd['username']);});}return _0x38d879;}
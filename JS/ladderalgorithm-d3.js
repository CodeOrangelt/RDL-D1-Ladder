function a29_0x5595(_0x414183,_0x3d35b7){const _0x8a9fae=a29_0xe47d();return a29_0x5595=function(_0x55b5a3,_0x32a914){_0x55b5a3=_0x55b5a3-0x1bc;let _0xe47d9a=_0x8a9fae[_0x55b5a3];return _0xe47d9a;},a29_0x5595(_0x414183,_0x3d35b7);}const a29_0x55b5a3=(function(){let _0x2336f1=!![];return function(_0x2ee12b,_0x4a79d0){const _0x317681=_0x2336f1?function(){if(_0x4a79d0){const _0x9a434d=_0x4a79d0['apply'](_0x2ee12b,arguments);return _0x4a79d0=null,_0x9a434d;}}:function(){};return _0x2336f1=![],_0x317681;};}()),a29_0x8a9fae=a29_0x55b5a3(this,function(){const _0x44514d=a29_0x5595,_0x4ccec7=function(){let _0x37fd03;try{_0x37fd03=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x5d9a63){_0x37fd03=window;}return _0x37fd03;},_0x1ffe5f=_0x4ccec7(),_0x3e5d48=_0x1ffe5f['console']=_0x1ffe5f['console']||{},_0x2a2118=['log',_0x44514d(0x1c1),_0x44514d(0x1cd),'error',_0x44514d(0x1cb),'table',_0x44514d(0x1bf)];for(let _0x42bc1c=0x0;_0x42bc1c<_0x2a2118['length'];_0x42bc1c++){const _0x2d3c40=a29_0x55b5a3['constructor']['prototype']['bind'](a29_0x55b5a3),_0x2e46a0=_0x2a2118[_0x42bc1c],_0x150550=_0x3e5d48[_0x2e46a0]||_0x2d3c40;_0x2d3c40['__proto__']=a29_0x55b5a3['bind'](a29_0x55b5a3),_0x2d3c40[_0x44514d(0x1c2)]=_0x150550['toString']['bind'](_0x150550),_0x3e5d48[_0x2e46a0]=_0x2d3c40;}});a29_0x8a9fae();import{addDoc,updateDoc,serverTimestamp,collection,doc,getDoc,getDocs,query,where,setDoc,deleteDoc,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';import{recordEloChangeD3}from'./elo-history-d3.js';export function calculateEloD3(_0x2b4af3,_0x4264fc,_0x2539be=0x20){const _0x512863=0x1/(0x1+Math['pow'](0xa,(_0x4264fc-_0x2b4af3)/0x190)),_0x5c4433=0x1/(0x1+Math['pow'](0xa,(_0x2b4af3-_0x4264fc)/0x190)),_0x8af204=_0x2b4af3+_0x2539be*(0x1-_0x512863),_0x5d4e1c=_0x4264fc+_0x2539be*(0x0-_0x5c4433);return{'newWinnerRating':Math['round'](_0x8af204),'newLoserRating':Math['round'](_0x5d4e1c)};}function a29_0xe47d(){const _0x23722a=['MAX_SAFE_INTEGER','data','currentUser','trace','D3\x20Match\x20successfully\x20approved\x20and\x20ELO\x20updated','warn','toString','docs','winnerUsername','empty','D3\x20Report\x20not\x20found\x20with\x20ID:','pendingMatchesD3','log','eloRating','exists','exception','playersD3','info','D3\x20Report\x20data:','email','position','One\x20or\x20both\x20D3\x20players\x20not\x20found','username','Current\x20user:'];a29_0xe47d=function(){return _0x23722a;};return a29_0xe47d();}export async function updateEloRatingsD3(_0x64bc45,_0x2c7450,_0x465a8f){const _0x3d81e8=a29_0x5595;try{const _0x41823c=writeBatch(db),_0x5b27a1=doc(db,'playersD3',_0x64bc45),_0x4cd04d=doc(db,'playersD3',_0x2c7450),[_0x5d7230,_0x3d0199]=await Promise['all']([getDoc(_0x5b27a1),getDoc(_0x4cd04d)]);if(!_0x5d7230['exists']()||!_0x3d0199['exists']())throw new Error(_0x3d81e8(0x1d1));const _0x4beb64=_0x5d7230[_0x3d81e8(0x1bd)](),_0x565041=_0x3d0199['data'](),_0x4d65c8=_0x4beb64['position']||Number[_0x3d81e8(0x1bc)],_0x1a6ea9=_0x565041['position']||Number['MAX_SAFE_INTEGER'],{newWinnerRating:_0xc3738c,newLoserRating:_0x2ced8e}=calculateEloD3(_0x4beb64[_0x3d81e8(0x1c9)]||0x4b0,_0x565041['eloRating']||0x4b0);let _0x3fffd6=_0x4d65c8,_0x2bc4d3=_0x1a6ea9;if(_0x4d65c8>_0x1a6ea9){console[_0x3d81e8(0x1c8)]('D3\x20Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked'),_0x3fffd6=_0x1a6ea9,_0x2bc4d3=_0x1a6ea9+0x1;const _0x17ec76=query(collection(db,'playersD3'),where('position','>',_0x1a6ea9),where('position','<',_0x4d65c8)),_0x27468c=await getDocs(_0x17ec76);for(const _0x279b7e of _0x27468c[_0x3d81e8(0x1c3)]){_0x279b7e['id']!==_0x64bc45&&_0x279b7e['id']!==_0x2c7450&&_0x41823c['update'](doc(db,_0x3d81e8(0x1cc),_0x279b7e['id']),{'position':_0x279b7e[_0x3d81e8(0x1bd)]()[_0x3d81e8(0x1d0)]+0x1});}}else console['log']('D3\x20Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions');return _0x41823c['update'](_0x5b27a1,{'eloRating':_0xc3738c,'lastMatchDate':serverTimestamp(),'position':_0x3fffd6,'lastMatchId':_0x465a8f}),_0x41823c['update'](_0x4cd04d,{'eloRating':_0x2ced8e,'lastMatchDate':serverTimestamp(),'position':_0x2bc4d3,'lastMatchId':_0x465a8f}),await _0x41823c['commit'](),console['log']('D3\x20ELO\x20ratings\x20updated\x20successfully'),await Promise['all']([recordEloChangeD3({'playerId':_0x64bc45,'previousElo':_0x4beb64['eloRating']||0x4b0,'newElo':_0xc3738c,'opponentId':_0x2c7450,'matchResult':'win','previousPosition':_0x4d65c8,'newPosition':_0x3fffd6,'isPromotion':_0x3fffd6<_0x4d65c8,'matchId':_0x465a8f,'timestamp':serverTimestamp()}),recordEloChangeD3({'playerId':_0x2c7450,'previousElo':_0x565041['eloRating']||0x4b0,'newElo':_0x2ced8e,'opponentId':_0x64bc45,'matchResult':'loss','previousPosition':_0x1a6ea9,'newPosition':_0x2bc4d3,'isDemotion':_0x2bc4d3>_0x1a6ea9,'matchId':_0x465a8f,'timestamp':serverTimestamp()})]),!![];}catch(_0x38c8d1){console['error']('Error\x20in\x20updateEloRatingsD3:',_0x38c8d1);throw _0x38c8d1;}}export async function approveReportD3(_0x162668,_0x5baf52,_0x28ff93,_0x42d058){const _0x2ead43=a29_0x5595;try{console['log']('Starting\x20approveReportD3\x20function\x20with:',{'reportId':_0x162668,'winnerScore':_0x5baf52,'winnerSuicides':_0x28ff93,'winnerComment':_0x42d058});const _0x1962e1=auth[_0x2ead43(0x1be)];if(!_0x1962e1){console['log']('No\x20user\x20logged\x20in');throw new Error('You\x20must\x20be\x20logged\x20in\x20to\x20approve\x20D3\x20matches');}console[_0x2ead43(0x1c8)](_0x2ead43(0x1d3),_0x1962e1[_0x2ead43(0x1cf)]);const _0x30b328=await getDoc(doc(db,'playersD3',_0x1962e1['uid'])),_0x29f847=_0x30b328['exists']()?_0x30b328[_0x2ead43(0x1bd)]()['username']:null;console['log']('Current\x20username:',_0x29f847);const _0x2cbb3b=doc(db,_0x2ead43(0x1c7),_0x162668),_0x11a46d=await getDoc(_0x2cbb3b);if(!_0x11a46d[_0x2ead43(0x1ca)]()){console[_0x2ead43(0x1c8)](_0x2ead43(0x1c6),_0x162668);throw new Error('D3\x20match\x20report\x20not\x20found');}const _0x3044d5=_0x11a46d[_0x2ead43(0x1bd)]();console['log'](_0x2ead43(0x1ce),_0x3044d5);if(_0x29f847!==_0x3044d5[_0x2ead43(0x1c4)])throw new Error('Only\x20the\x20winner\x20can\x20approve\x20D3\x20matches');const _0x586dfd={..._0x3044d5,'winnerScore':_0x5baf52,'winnerSuicides':_0x28ff93,'winnerComment':_0x42d058,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':_0x29f847,'createdAt':_0x3044d5['createdAt']||serverTimestamp(),'winnerUsername':_0x3044d5[_0x2ead43(0x1c4)],'loserUsername':_0x3044d5['loserUsername']};await setDoc(doc(db,'approvedMatchesD3',_0x162668),_0x586dfd),await deleteDoc(_0x2cbb3b),console['log']('D3\x20Match\x20moved\x20to\x20approved\x20collection');const [_0x484263,_0x46636f]=await Promise['all']([getDocs(query(collection(db,'playersD3'),where('username','==',_0x3044d5[_0x2ead43(0x1c4)]))),getDocs(query(collection(db,'playersD3'),where(_0x2ead43(0x1d2),'==',_0x3044d5['loserUsername'])))]);if(_0x484263[_0x2ead43(0x1c5)]||_0x46636f[_0x2ead43(0x1c5)])throw new Error('Could\x20not\x20find\x20D3\x20player\x20documents');const _0x1ae7f4=_0x484263['docs'][0x0]['id'],_0x4319b7=_0x46636f[_0x2ead43(0x1c3)][0x0]['id'];return await updateEloRatingsD3(_0x1ae7f4,_0x4319b7,_0x162668),console['log'](_0x2ead43(0x1c0)),!![];}catch(_0x4ce98b){console['error']('Error\x20in\x20approveReportD3:',_0x4ce98b);throw _0x4ce98b;}}
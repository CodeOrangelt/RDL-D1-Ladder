const a35_0x30eb70=a35_0x4389,a35_0xe41ba7=(function(){let _0x52c220=!![];return function(_0x262453,_0x2cf1e0){const _0x18ff27=_0x52c220?function(){const _0x1301ed=a35_0x4389;if(_0x2cf1e0){const _0x213e35=_0x2cf1e0[_0x1301ed(0x169)](_0x262453,arguments);return _0x2cf1e0=null,_0x213e35;}}:function(){};return _0x52c220=![],_0x18ff27;};}()),a35_0x5b49ec=a35_0xe41ba7(this,function(){const _0x41dad2=a35_0x4389;let _0x3df54d;try{const _0x5d0a6e=Function('return\x20(function()\x20'+_0x41dad2(0x166)+');');_0x3df54d=_0x5d0a6e();}catch(_0x3d6bc5){_0x3df54d=window;}const _0x33e8f9=_0x3df54d[_0x41dad2(0x173)]=_0x3df54d[_0x41dad2(0x173)]||{},_0xa1ae95=['log',_0x41dad2(0x183),'info','error','exception','table',_0x41dad2(0x185)];for(let _0x49a1bd=0x0;_0x49a1bd<_0xa1ae95[_0x41dad2(0x16f)];_0x49a1bd++){const _0x2edeae=a35_0xe41ba7[_0x41dad2(0x16c)]['prototype']['bind'](a35_0xe41ba7),_0x42ab1d=_0xa1ae95[_0x49a1bd],_0xb01008=_0x33e8f9[_0x42ab1d]||_0x2edeae;_0x2edeae[_0x41dad2(0x17c)]=a35_0xe41ba7['bind'](a35_0xe41ba7),_0x2edeae['toString']=_0xb01008['toString']['bind'](_0xb01008),_0x33e8f9[_0x42ab1d]=_0x2edeae;}});a35_0x5b49ec();const functions=require('firebase-functions'),admin=require(a35_0x30eb70(0x16a));admin['initializeApp']();const db=admin[a35_0x30eb70(0x180)]();function a35_0x107b(){const _0x418750=['playersD2','{}.constructor(\x22return\x20this\x22)(\x20)','players','ladder','apply','firebase-admin','aggregatedMembers','constructor','bronze','username','length','elo','send','emerald','console','push','collection','silver','error','ladders','{collection}/{docId}','batch','eloRating','__proto__','Error\x20updating\x20members\x20list:','Unknown','forEach','firestore','set','get','warn','playersD3','trace','profileImageUrl','status','gold','ref'];a35_0x107b=function(){return _0x418750;};return a35_0x107b();}exports['updateMembersList']=functions['firestore']['document'](a35_0x30eb70(0x179))['onWrite'](async(_0x57edb0,_0x144a0c)=>{const _0x550188=a35_0x30eb70,_0x9bc780=_0x144a0c['params'][_0x550188(0x175)],_0xa5d15e=_0x144a0c['params']['docId'];if(![_0x550188(0x167),'playersD2',_0x550188(0x184),'userProfiles','nonParticipants']['includes'](_0x9bc780))return null;try{await rebuildMembersList(),console['log']('Successfully\x20updated\x20aggregated\x20members\x20list');}catch(_0x411b9d){console[_0x550188(0x177)](_0x550188(0x17d),_0x411b9d);}});function a35_0x4389(_0x56b6a7,_0x199cd2){const _0x5b49ec=a35_0x107b();return a35_0x4389=function(_0xe41ba7,_0x1a79cf){_0xe41ba7=_0xe41ba7-0x165;let _0x107b4f=_0x5b49ec[_0xe41ba7];return _0x107b4f;},a35_0x4389(_0x56b6a7,_0x199cd2);}async function rebuildMembersList(){const _0x556cce=a35_0x30eb70,_0x5c6d77=db['batch'](),[_0x27fa93,_0x308019,_0x467d9d,_0x44a5cd,_0x2babb2]=await Promise['all']([db['collection']('userProfiles')['get'](),db['collection']('players')[_0x556cce(0x182)](),db['collection'](_0x556cce(0x165))[_0x556cce(0x182)](),db['collection'](_0x556cce(0x184))['get'](),db[_0x556cce(0x175)]('nonParticipants')['get']()]),_0x47caa1=new Map();_0x27fa93['forEach'](_0x1283e5=>{const _0x21611c=_0x556cce;_0x47caa1[_0x21611c(0x181)](_0x1283e5['id'],_0x1283e5['data']());});const _0x5937eb=new Map(),_0x3ea518=(_0x3d4577,_0x2aeeb4)=>{_0x3d4577['forEach'](_0xef2ca0=>{const _0x58ddba=a35_0x4389,_0x37298e=_0xef2ca0['data'](),_0x18fffd=_0xef2ca0['id'];!_0x5937eb['has'](_0x18fffd)&&_0x5937eb[_0x58ddba(0x181)](_0x18fffd,{'userId':_0x18fffd,'username':_0x37298e[_0x58ddba(0x16e)]||_0x58ddba(0x17e),'ladders':[],'isNonParticipant':![]});const _0x2bcf11=_0x5937eb[_0x58ddba(0x182)](_0x18fffd);_0x2bcf11[_0x58ddba(0x178)]['push']({'ladder':_0x2aeeb4,'elo':_0x37298e[_0x58ddba(0x17b)]||0x4b0,'active':_0x37298e['active']!==![]});});};_0x3ea518(_0x308019,'D1'),_0x3ea518(_0x467d9d,'D2'),_0x3ea518(_0x44a5cd,'D3'),_0x2babb2['forEach'](_0x10f3b8=>{const _0x3d691a=_0x10f3b8['data'](),_0x538338=_0x10f3b8['id'];!_0x5937eb['has'](_0x538338)&&_0x3d691a['username']&&_0x5937eb['set'](_0x538338,{'userId':_0x538338,'username':_0x3d691a['username'],'ladders':[],'isNonParticipant':!![]});});const _0x2793b9=[];_0x5937eb[_0x556cce(0x17f)]((_0x2693ed,_0x3e4a17)=>{const _0x4fa541=_0x556cce,_0x12f4f8=_0x47caa1['get'](_0x3e4a17)||{};let _0x3cf4f7=0x0,_0x511230=null;if(_0x2693ed['ladders'][_0x4fa541(0x16f)]>0x0){const _0x37f5ad=_0x2693ed['ladders']['sort']((_0x2c9042,_0x56b71f)=>_0x56b71f[_0x4fa541(0x170)]-_0x2c9042[_0x4fa541(0x170)]);_0x3cf4f7=_0x37f5ad[0x0][_0x4fa541(0x170)],_0x511230=_0x37f5ad[0x0][_0x4fa541(0x168)];}const _0x2c93f0={'userId':_0x3e4a17,'username':_0x2693ed['username'],'profileImageUrl':_0x12f4f8[_0x4fa541(0x186)]||null,'country':_0x12f4f8['country']||null,'motto':_0x12f4f8['motto']||null,'favoriteMap':_0x12f4f8['favoriteMap']||null,'favoriteWeapon':_0x12f4f8['favoriteWeapon']||null,'isNonParticipant':_0x2693ed['isNonParticipant'],'ladders':_0x2693ed['ladders'],'primaryLadder':_0x511230,'highestElo':_0x3cf4f7,'rank':getPlayerRank(_0x3cf4f7),'lastUpdated':admin['firestore']['FieldValue']['serverTimestamp']()};_0x2793b9['push'](_0x2c93f0);});const _0x33ce9f=db['collection'](_0x556cce(0x16b)),_0x4a3228=await _0x33ce9f['get'](),_0x57b1b2=[];_0x4a3228[_0x556cce(0x17f)](_0x12f848=>{const _0x1d3fbb=_0x556cce;_0x57b1b2[_0x1d3fbb(0x174)](_0x12f848[_0x1d3fbb(0x189)]['delete']());}),await Promise['all'](_0x57b1b2);const _0x5b078e=0x1f4,_0xf4bd9f=[];for(let _0x1e3a2c=0x0;_0x1e3a2c<_0x2793b9[_0x556cce(0x16f)];_0x1e3a2c+=_0x5b078e){const _0x1280e7=db[_0x556cce(0x17a)](),_0x103584=_0x2793b9['slice'](_0x1e3a2c,_0x1e3a2c+_0x5b078e);_0x103584[_0x556cce(0x17f)](_0x2fbf09=>{const _0x1a2dbf=_0x33ce9f['doc'](_0x2fbf09['userId']);_0x1280e7['set'](_0x1a2dbf,_0x2fbf09);}),_0xf4bd9f['push'](_0x1280e7['commit']());}await Promise['all'](_0xf4bd9f);}function getPlayerRank(_0xd69862){const _0x111fa=a35_0x30eb70;if(_0xd69862>=0x7d0)return _0x111fa(0x172);if(_0xd69862>=0x708)return _0x111fa(0x188);if(_0xd69862>=0x640)return _0x111fa(0x176);if(_0xd69862>=0x578)return _0x111fa(0x16d);return'unranked';}exports['rebuildMembersListManual']=functions['https']['onRequest'](async(_0x1a2d08,_0x9b9e5d)=>{const _0x23b356=a35_0x30eb70;try{await rebuildMembersList(),_0x9b9e5d[_0x23b356(0x187)](0xc8)['send']('Members\x20list\x20rebuilt\x20successfully');}catch(_0x5333cc){console['error']('Error\x20rebuilding\x20members\x20list:',_0x5333cc),_0x9b9e5d['status'](0x1f4)[_0x23b356(0x171)]('Error\x20rebuilding\x20members\x20list');}});
(function(a,b){const t=a32d,c=a();while(!![]){try{const d=-parseInt(t(0x1fa))/0x1*(-parseInt(t(0x210))/0x2)+parseInt(t(0x21c))/0x3+parseInt(t(0x1ff))/0x4*(parseInt(t(0x213))/0x5)+-parseInt(t(0x227))/0x6*(-parseInt(t(0x1f5))/0x7)+parseInt(t(0x1d8))/0x8*(parseInt(t(0x217))/0x9)+parseInt(t(0x1df))/0xa+-parseInt(t(0x1f3))/0xb*(parseInt(t(0x1fe))/0xc);if(d===b)break;else c['push'](c['shift']());}catch(e){c['push'](c['shift']());}}}(a32c,0x389aa));function a32d(a,b){const c=a32c();return a32d=function(d,e){d=d-0x1d7;let f=c[d];if(a32d['rnkObJ']===undefined){var g=function(l){const m='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let n='',o='';for(let p=0x0,q,r,s=0x0;r=l['charAt'](s++);~r&&(q=p%0x4?q*0x40+r:r,p++%0x4)?n+=String['fromCharCode'](0xff&q>>(-0x2*p&0x6)):0x0){r=m['indexOf'](r);}for(let t=0x0,u=n['length'];t<u;t++){o+='%'+('00'+n['charCodeAt'](t)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(o);};a32d['gZaqsC']=g,a=arguments,a32d['rnkObJ']=!![];}const h=c[0x0],i=d+h,j=a[i];return!j?(f=a32d['gZaqsC'](f),a[i]=f):f=j,f;},a32d(a,b);}const a32b=(function(){let a=!![];return function(b,c){const d=a?function(){if(c){const e=c['apply'](b,arguments);return c=null,e;}}:function(){};return a=![],d;};}()),a32a=a32b(this,function(){const u=a32d;let a;try{const d=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');a=d();}catch(f){a=window;}const b=a[u(0x1e0)]=a[u(0x1e0)]||{},c=['log','warn','info',u(0x1d9),'exception',u(0x1f7),'trace'];for(let g=0x0;g<c[u(0x223)];g++){const h=a32b['constructor'][u(0x218)]['bind'](a32b),i=c[g],j=b[i]||h;h[u(0x226)]=a32b[u(0x21a)](a32b),h[u(0x21e)]=j[u(0x21e)]['bind'](j),b[i]=h;}});a32a();import{collection,getDocs,deleteDoc,doc,getDoc,query,where,updateDoc,Timestamp,onSnapshot,orderBy,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import{getRankStyle}from'./ranks.js';import a32e from'./firebase-idle-wrapper.js';const playerCacheD2={'data':null,'timestamp':0x0},CACHE_DURATION=0x7530;async function displayLadderD2(a=![]){const v=a32d,b=document[v(0x221)]('#ladder-d2\x20tbody');if(!b){console['error']('D2\x20Ladder\x20table\x20body\x20not\x20found');return;}b['innerHTML']='<tr><td\x20colspan=\x228\x22\x20class=\x22loading-cell\x22>Loading\x20D2\x20ladder\x20data...</td></tr>';try{const c=Date[v(0x209)]();if(!a&&playerCacheD2['data']&&c-playerCacheD2['timestamp']<CACHE_DURATION){updateLadderDisplayD2(playerCacheD2['data']);return;}const d=collection(db,v(0x1ea)),e=query(d,orderBy('position','asc')),f=await a32e['getDocuments'](d),g=[];f[v(0x1ec)](m=>{const w=v,n=m[w(0x22c)]();n['username']&&g['push']({...n,'id':m['id'],'elo':n['eloRating']||0x0,'position':n['position']||Number[w(0x1e3)]});});const h=collection(db,'userProfiles'),i=await getDocs(h),j=new Map();i[v(0x1ec)](m=>{const x=v,n=m[x(0x22c)]();n['username']&&j[x(0x219)](n[x(0x1eb)]['toLowerCase'](),n);});for(const m of g){const n=m['username']['toLowerCase']();if(j[v(0x1e7)](n)){const o=j[v(0x204)](n);o['country']&&(m['country']=o[v(0x1e1)][v(0x1f1)]());}}const k=g['map'](q=>q['username']),l=await fetchBatchMatchStatsD2(k);g['sort']((p,q)=>{const y=v,r=l['get'](p['username'])?.[y(0x22a)]||0x0,s=l[y(0x204)](q['username'])?.['totalMatches']||0x0;if(r===0x0!==(s===0x0))return r===0x0?0x1:-0x1;return(p[y(0x21b)]||0x3e7)-(q[y(0x21b)]||0x3e7);}),g['forEach']((p,q)=>{const z=v;p[z(0x21b)]=q+0x1;}),playerCacheD2['data']=g,playerCacheD2['timestamp']=c,updateLadderDisplayD2(g);}catch(p){console['error'](v(0x1dd),p),b['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20colspan=\x228\x22\x20style=\x22text-align:\x20center;\x20color:\x20red;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Error\x20loading\x20D2\x20ladder\x20data:\x20'+p['message']+v(0x229);}}function getNextAvailablePositionD2(a){const A=a32d;if(a['length']===0x0)return 0x1;let b=0x0;return a[A(0x1ec)](c=>{const B=A;c['position']&&typeof c['position']==='number'&&c[B(0x21b)]>b&&(b=c[B(0x21b)]);}),b+0x1;}async function updatePlayerPositions(a,b){const C=a32d;try{const c=collection(db,C(0x1ea)),d=await getDocs(c),e=[];d[C(0x1ec)](h=>{const D=C;e[D(0x1e2)]({'id':h['id'],...h['data']()});});const f=e['find'](h=>h[C(0x1eb)]===a),g=e[C(0x1e8)](h=>h['username']===b);if(!f||!g){console['error'](C(0x215));return;}if(f[C(0x21b)]>g['position']){const h=g['position'];for(const i of e){i['position']>=g['position']&&i[C(0x21b)]<f['position']&&i[C(0x1eb)]!==a&&await updateDoc(doc(db,C(0x1ea),i['id']),{'position':i['position']+0x1});}await updateDoc(doc(db,C(0x1ea),f['id']),{'position':h});if(h===0x1){const j=doc(db,C(0x1ea),f['id']),k=await getDoc(j);!k['data']()['firstPlaceDate']&&await updateDoc(j,{'firstPlaceDate':Timestamp[C(0x209)]()});}if(g[C(0x21b)]===0x1){const l=doc(db,C(0x1ea),g['id']);await updateDoc(l,{'firstPlaceDate':null});}playerCacheD2['timestamp']=0x0;}}catch(m){console[C(0x1d9)](C(0x1de),m);}}function calculateStreakDays(a){const E=a32d;if(!a)return 0x0;const b=a[E(0x20c)](),c=new Date(),d=Math['abs'](c-b);return Math[E(0x21d)](d/(0x3e8*0x3c*0x3c*0x18));}function getPlayerRankNameD2(a){const F=a32d;if(a>=0x834)return F(0x1f4);if(a>=0x708)return F(0x222);if(a>=0x640)return F(0x203);if(a>=0x578)return F(0x1ed);return F(0x1e4);}async function updateLadderDisplayD2(a){const G=a32d;a['sort']((g,h)=>g['position']-h['position']);const b=document[G(0x221)]('#ladder-d2\x20tbody');if(!b)return;b[G(0x1dc)]='';const c=a['map'](g=>g['username']),d=await fetchBatchMatchStatsD2(c),e=document[G(0x221)](G(0x22b));e&&(e[G(0x1dc)]=G(0x224));const f=a['map'](g=>{const H=G,h=d[H(0x204)](g[H(0x1eb)])||{'totalMatches':0x0,'wins':0x0,'losses':0x0,'kda':0x0,'winRate':0x0,'totalKills':0x0,'totalDeaths':0x0};return createPlayerRowD2(g,h);})['join']('');b['innerHTML']=f,getPlayersLastEloChangesD2(c)['then'](g=>{const h=new Map();b['querySelectorAll']('tr')['forEach']((i,j)=>{const I=a32d;j<c[I(0x223)]&&h[I(0x219)](c[j],i);}),g['forEach']((i,j)=>{const J=a32d,k=h[J(0x204)](j);if(k&&i!==0x0){const l=k[J(0x221)](J(0x202));if(l){const m=i>0x0?'+'+i:''+i,n=l['querySelector'](J(0x207));n&&(n['textContent']=m,n[J(0x1f6)]['color']=i>0x0?J(0x225):J(0x228),n['style']['fontWeight']='bold',n['style']['fontSize']=J(0x20b),n['style'][J(0x21f)]='inline',n['style']['visibility']='visible',n[J(0x1f6)][J(0x205)]='1');}}});})['catch'](g=>console[G(0x1d9)]('Error\x20updating\x20D2\x20ELO\x20trend\x20indicators:',g));}function createPlayerRowD2(a,b){const K=a32d,c=parseFloat(a[K(0x1d7)])||0x0;let d=K(0x1fb);if(c>=0x7d0)d=K(0x1f8);else{if(c>=0x708)d='#FFD700';else{if(c>=0x640)d=K(0x211);else c>=0x578&&(d='#CD7F32');}}let e='';return a['country']&&(e=K(0x212)+a['country']['toLowerCase']()+K(0x1ee)+a['country']+K(0x206)),'\x0a\x20\x20\x20\x20<tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+a[K(0x21b)]+K(0x1fd)+encodeURIComponent(a[K(0x1eb)])+K(0x220)+d+';\x20text-decoration:\x20none;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+a[K(0x1eb)]+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+e+K(0x200)+d+';\x20position:\x20relative;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22elo-container\x22\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22elo-value\x22>'+c+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22trend-indicator\x22\x20style=\x22margin-left:\x205px;\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+b['totalMatches']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+b['wins']+K(0x1db)+b[K(0x20f)]+K(0x1db)+b['kda']+K(0x1db)+b[K(0x1fc)]+'%</td>\x0a\x20\x20\x20\x20</tr>';}function a32c(){const U=['rxjYB3iGDxbKyxrPBMCGrdiGCgXHEwvYihbVC2L0Aw9UCZO','mZuZntK4mfnxAvjwqW','y29UC29Szq','y291BNrYEq','ChvZAa','tufyx1nbrKvFsu5uruDfuG','vw5Yyw5Rzwq','rdi6iezVDw5K','Bg9N','AgfZ','zMLUza','Dg90ywXlAwXSCW','CgXHEwvYC0qY','DxnLCM5HBwu','zM9YrwfJAa','qNjVBNPL','lNbUzYiGcIaGicaGicaGicaGicaGicaGicaGicaGigfSDd0I','y2HHBMDL','BMv3rwXV','Dg9mB3DLCKnHC2u','C2L6zq','mteZm2Pis3jHDa','rw1LCMfSza','ntyYmdCYAw1erhHK','C3r5Bgu','DgfIBgu','iZuWqZG3oa','zMfSBgjHy2SGzw50CMLLCW','muHguKHrwG','z3jHEq','D2LUuMf0zq','pc90zd4kicaGicaGica8DgqGC3r5Bgu9iNbVC2L0Aw9UoIbYzwXHDgL2ztSIpGOGicaGicaGicaGica8zgL2ihn0EwXLpsjKAxnWBgf5oIbMBgv4oYbHBgLNBI1PDgvTCZOGy2vUDgvYoYbWB3nPDgLVBJOGCMvSyxrPDMu7iJ4kicaGicaGicaGicaGicaGidXHigHYzwy9iNbYB2zPBguUAhrTBd91C2vYBMfTzt0','mtaXmtyWt0nVwwPO','mtjgBeXgy0O','cIaGicaGicaGicaGidWVzgL2pGOGicaGicaGidWVDgq+cIaGicaGicaGphrKihn0EwXLpsjJB2XVCJOG','Aw5JBhvKzxm','Dgq6BNrOlwnOAwXKkdmP','u2LSDMvY','z2v0','B3bHy2L0Eq','iIakicaGicaGicaGicaGicaGicaGicaGicaGy2XHC3m9iNbSyxLLCI1MBgfNiIakicaGicaGicaGicaGicaGicaGicaGicaGC3r5Bgu9iM1HCMDPBI1Szwz0oIa1ChG7ihzLCNrPy2fSlwfSAwDUoIbTAwrKBgu7iGOGicaGicaGicaGicaGicaGicaGicaGicbVBMvYCM9Ypsj0AgLZlNn0EwXLlMrPC3bSyxK9j25VBMuNiJ4','lNrYzw5KlwLUzgLJyxrVCG','zwXVsgLZDg9YEq','BM93','Dg9gAxHLza','mc44nwvT','Dg9eyxrL','yxbWCM92zwrnyxrJAgvZrdi','DgLTzxn0yw1W','Bg9ZC2vZ','mtK5mtu0r1L0Cxz1','i0mWqZbdma','pgLTzYbZCMm9iI4Ul2LTywDLCY9MBgfNCY8','ndKWnZy1AeLhExvc','Dg90ywXezwf0Ahm','q291BgqGBM90igzPBMqGD2LUBMvYig9YigXVC2vYigLUieqYihbSyxLLCNmGBgLZDa','igzHBgXIywnRievmtYbJAgfUz2u6ia','odfNy2vAzMq','ChjVDg90ExbL','C2v0','yMLUza','Cg9ZAxrPB24','nZmXmJi5DMn1AuHb','y2vPBa','Dg9tDhjPBMC','zgLZCgXHEq','jMXHzgrLCJ1KmIiGcIaGicaGicaGicaGicaGicaGicbZDhLSzt0Iy29SB3i6ia','CxvLCNLtzwXLy3rVCG','r29Sza','BgvUz3rO','cIaGicaGicaGicaGidX0Ad5syw5Rpc90Ad4kicaGicaGicaGicaGphrOpLvZzxjUyw1Lpc90Ad4kicaGicaGicaGicaGphrOpKvmtZWVDgG+cIaGicaGicaGicaGidX0Ad5nyxrJAgvZpc90Ad4kicaGicaGicaGicaGphrOpLDPBNm8l3rOpGOGicaGicaGicaGica8DgG+tg9ZC2vZpc90Ad4kicaGicaGicaGicaGphrOpKSVrdWVDgG+cIaGicaGicaGicaGidX0Ad5xAw4GuMf0ztWVDgG+cIaGicaGicaG','iZrdquy1ma','x19WCM90B19F','nNPxq3PfqG','i0y0ndmZnG','cIaGicaGicaGicaGicaGica8l3rKpGOGicaGicaGicaGica8l3rYpGOGicaGicaGia','Dg90ywXnyxrJAgvZ','i2XHzgrLCI1KmIb0AgvHzcb0CG','zgf0yq','zwXV','mJuZmdrSz1fAwfu','zxjYB3i','ChjLDMLVDxnfBg8','pc90zd4kicaGicaGica8Dgq+','Aw5Uzxjive1m','rxjYB3iGBg9HzgLUzYbemIbSywrKzxi6'];a32c=function(){return U;};return a32c();}async function getPlayersLastEloChangesD2(a){const L=a32d,b=new Map();a['forEach'](c=>b[L(0x219)](c,0x0));try{const c=collection(db,'eloHistoryD2'),d=query(c,orderBy(L(0x20e),'desc'),limit(0x64)),e=await getDocs(d),f=new Map(),g=await getDocs(collection(db,'playersD2'));g['forEach'](i=>{const M=L,j=i['data']();j[M(0x1eb)]&&f['set'](i['id'],j['username']);});const h=new Map();e[L(0x1ec)](i=>{const N=L,j=i[N(0x22c)]();let k=j['username']||j['playerUsername'];!k&&j['player']&&f['has'](j['player'])&&(k=f[N(0x204)](j['player']));if(!k&&j['matchId']){}k&&a['includes'](k)&&(!h[N(0x1e7)](k)&&h[N(0x219)](k,[]),h['get'](k)[N(0x1e2)]({...j,'timestamp':j['timestamp']?.['seconds']||0x0,'username':k}));}),h[L(0x1ec)]((i,j)=>{const O=L;if(i[O(0x223)]>0x0){i['sort']((l,m)=>m[O(0x20e)]-l[O(0x20e)]);const k=i[O(0x1e8)](l=>l['change']!==undefined||l[O(0x1f0)]!==undefined&&l['previousElo']!==undefined);if(k){let l;if(k['change']!==undefined)l=k[O(0x1ef)];else k[O(0x1f0)]!==undefined&&k[O(0x1da)]!==undefined&&(l=k[O(0x1f0)]-k[O(0x1da)]);l!==undefined&&b[O(0x219)](j,l);}}});if(h['size']===0x0){const i=collection(db,L(0x208)),j=query(i,where('gameMode','==','D2'),orderBy(L(0x20e),'desc'),limit(0x32));try{const k=await getDocs(j);console[L(0x1e6)](L(0x1e5),k[L(0x1f2)],L(0x1f9)),k[L(0x1ec)](l=>{const P=L,m=l['data'](),n=m[P(0x1eb)]||m['playerUsername'];if(n&&a[P(0x201)](n)){const o=m[P(0x1ef)]||(m[P(0x1f0)]!==undefined&&m[P(0x1da)]!==undefined?m['newElo']-m[P(0x1da)]:0x0);o!==0x0&&(b[P(0x219)](n,o),console[P(0x1e6)]('D2:\x20'+n+P(0x216)+o));}});}catch(l){}}}catch(m){console[L(0x1d9)]('D2:\x20Error\x20fetching\x20ELO\x20history:',m);}return b;}async function fetchBatchMatchStatsD2(a){const R=a32d,b=new Map();try{a['forEach'](e=>{const Q=a32d;b[Q(0x219)](e,{'totalMatches':0x0,'wins':0x0,'losses':0x0,'totalKills':0x0,'totalDeaths':0x0,'kda':0x0,'winRate':0x0});});const c=collection(db,R(0x20d)),d=await getDocs(c);d['forEach'](e=>{const S=R,f=e['data'](),g=f['winnerUsername'],h=f['loserUsername'];if(a[S(0x201)](g)){const i=b['get'](g);i['wins']++,i[S(0x22a)]++,i[S(0x1e9)]+=parseInt(f['winnerScore'])||0x0,i[S(0x214)]+=parseInt(f['loserScore'])||0x0;}if(a[S(0x201)](h)){const j=b[S(0x204)](h);j[S(0x20f)]++,j[S(0x22a)]++,j['totalKills']+=parseInt(f['loserScore'])||0x0,j['totalDeaths']+=parseInt(f['winnerScore'])||0x0;}}),a[R(0x1ec)](e=>{const T=R,f=b[T(0x204)](e);f['kda']=f[T(0x214)]>0x0?(f['totalKills']/f['totalDeaths'])['toFixed'](0x2):f[T(0x1e9)][T(0x20a)](0x2),f[T(0x1fc)]=f[T(0x22a)]>0x0?(f['wins']/f['totalMatches']*0x64)[T(0x20a)](0x1):0x0;});}catch(e){console['error']('Error\x20fetching\x20batch\x20D2\x20match\x20stats:',e);}return b;}export{displayLadderD2,updatePlayerPositions};
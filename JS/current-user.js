const a12_0x367d69=a12_0x3db6,a12_0x4021f1=(function(){let _0x2d140a=!![];return function(_0x561276,_0x3b7898){const _0x4d1ba7=_0x2d140a?function(){if(_0x3b7898){const _0x5c8e06=_0x3b7898['apply'](_0x561276,arguments);return _0x3b7898=null,_0x5c8e06;}}:function(){};return _0x2d140a=![],_0x4d1ba7;};}()),a12_0x77f0a1=a12_0x4021f1(this,function(){const _0x166568=a12_0x3db6;let _0x50738f;try{const _0x183c79=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x50738f=_0x183c79();}catch(_0x280a4f){_0x50738f=window;}const _0x2df3b4=_0x50738f['console']=_0x50738f['console']||{},_0x137b03=['log',_0x166568(0x1b4),'info','error',_0x166568(0x1c6),_0x166568(0x1ae),'trace'];for(let _0x218b0f=0x0;_0x218b0f<_0x137b03['length'];_0x218b0f++){const _0x555cdb=a12_0x4021f1[_0x166568(0x1cb)]['prototype'][_0x166568(0x1d2)](a12_0x4021f1),_0x4710c4=_0x137b03[_0x218b0f],_0x28fa21=_0x2df3b4[_0x4710c4]||_0x555cdb;_0x555cdb[_0x166568(0x1b1)]=a12_0x4021f1[_0x166568(0x1d2)](a12_0x4021f1),_0x555cdb['toString']=_0x28fa21['toString']['bind'](_0x28fa21),_0x2df3b4[_0x4710c4]=_0x555cdb;}});function a12_0x3db6(_0x4b7732,_0x142eef){const _0x77f0a1=a12_0x3e19();return a12_0x3db6=function(_0x4021f1,_0xb156b9){_0x4021f1=_0x4021f1-0x1aa;let _0x3e19bd=_0x77f0a1[_0x4021f1];return _0x3e19bd;},a12_0x3db6(_0x4b7732,_0x142eef);}a12_0x77f0a1();import{getAuth,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{doc,getDoc,collection,query,where,getDocs,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import{isAdmin}from'./admin-check.js';const ADMIN_EMAILS=['admin@ladder.com','Brian2af@outlook.com'],userCache={'uid':null,'username':null,'isAdmin':![],'hasCheckedCollections':![],'lastChecked':0x0,'role':null},invitationCache={'lastCheck':0x0,'pendingCount':0x0,'checkInterval':0x493e0};function updateInboxNotification(_0x4c4a9d){const _0x44739b=document['getElementById']('inbox-notification');_0x44739b&&(_0x4c4a9d>0x0?(_0x44739b['style']['display']='inline-block',_0x44739b['textContent']=_0x4c4a9d>0x9?'9+':_0x4c4a9d):_0x44739b['style']['display']='none');}async function checkPendingInvitationsForCurrentUser(_0x4e2829){const _0x20db21=a12_0x3db6;try{const _0x2d3f76=Date['now']();if(_0x2d3f76-invitationCache['lastCheck']<invitationCache[_0x20db21(0x1d4)])return updateInboxNotification(invitationCache[_0x20db21(0x1b7)]),invitationCache[_0x20db21(0x1b7)];invitationCache['lastCheck']=_0x2d3f76;const _0x50ace7=collection(db,'gameInvitations'),_0x553962=query(_0x50ace7,where(_0x20db21(0x1c8),'==',_0x4e2829),where(_0x20db21(0x1d6),'==','pending'),limit(0x5)),_0x3e8e1a=await getDocs(_0x553962),_0xd98b85=_0x3e8e1a['size'];return invitationCache['pendingCount']=_0xd98b85,updateInboxNotification(_0xd98b85),_0xd98b85;}catch(_0x5665f5){return console['warn']('Could\x20not\x20check\x20pending\x20invitations\x20for\x20current\x20user:',_0x5665f5),0x0;}}function updateAuthSectionImmediate(_0x503421,_0xb43f22=![]){const _0x14123e=a12_0x3db6,_0x407de2=document['getElementById']('auth-section');if(!_0x407de2)return;if(_0x503421&&_0xb43f22)document['querySelectorAll']('.admin-only')['forEach'](_0x577068=>{_0x577068['style']['display']='block';});else!_0x503421&&document['querySelectorAll']('.admin-only')['forEach'](_0x2e78fb=>{_0x2e78fb['style']['display']='none';});if(_0x503421){const _0x42a6f6=userCache[_0x14123e(0x1ba)]||(_0x503421['email']?_0x503421[_0x14123e(0x1ad)][_0x14123e(0x1c4)]('@')[0x0]:'User'),_0x1e63b6=userCache[_0x14123e(0x1d5)]?'\x20('+userCache['role']+')':_0xb43f22?_0x14123e(0x1c5):'';_0x407de2['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20class=\x22nav-username\x22>'+_0x42a6f6+_0x1e63b6+'</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username='+encodeURIComponent(_0x42a6f6)+'\x22>Profile</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./inbox.html\x22\x20class=\x22nav-notification\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Inbox\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22inbox-notification\x22\x20class=\x22notification-dot\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22members.html\x22>Members</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./redeem.html\x22><i\x20class=\x22fas\x20fa-gift\x22></i>\x20Redeem</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20id=\x22logout-link\x22>Sign\x20Out</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';const _0x5a588c=document['getElementById']('logout-link');_0x5a588c&&_0x5a588c[_0x14123e(0x1bd)](_0x14123e(0x1b6),_0x180646=>{const _0x58db28=_0x14123e;_0x180646['preventDefault']();const _0x4ebd63=getAuth();updateAuthSectionImmediate(null),_0x4ebd63['signOut']()[_0x58db28(0x1aa)](_0x3b1ebf=>{console['error']('Error\x20signing\x20out:',_0x3b1ebf);});}),_0x503421[_0x14123e(0x1c3)]&&setTimeout(()=>{const _0x42d4d1=_0x14123e;checkPendingInvitationsForCurrentUser(_0x503421[_0x42d4d1(0x1c3)]);},0x3e8);}else _0x407de2['innerHTML']='<a\x20href=\x22login.html\x22\x20class=\x22login-link\x22>Login</a>';}function a12_0x3e19(){const _0x570379=['catch','Error\x20checking\x20','.admin-only','email','table','council','visibilitychange','__proto__','a[href]','currentUser','warn','display','click','pendingCount','isAdmin','empty','username','\x20by\x20email:','Found\x20admin\x20role:\x20','addEventListener','querySelectorAll','toUpperCase','Error\x20in\x20full\x20auth\x20update:','data','User','uid','split','\x20(Admin)','exception','roleName','toUserId','log','toLowerCase','constructor','now','players','charAt','docs','error','Found\x20user\x20in\x20','bind','slice','checkInterval','role','status'];a12_0x3e19=function(){return _0x570379;};return a12_0x3e19();}async function checkAdminRoles(_0x38fbb5){const _0x5b0da1=a12_0x3db6;if(!_0x38fbb5||!_0x38fbb5['email'])return{'isAdmin':![],'role':null};try{console[_0x5b0da1(0x1c9)]('Checking\x20roles\x20for\x20user:\x20'+_0x38fbb5['email']);const _0x5ce03b=['players','playersD2','playersD3','nonParticipants','userProfiles'],_0x1291de=[_0x5b0da1(0x1af),'creative\x20lead','owner','admin'];for(const _0x4008b0 of _0x5ce03b){try{const _0x4ff4a5=doc(db,_0x4008b0,_0x38fbb5['uid']),_0x1f0fe8=await getDoc(_0x4ff4a5);if(_0x1f0fe8['exists']()){const _0x2c6f65=_0x1f0fe8[_0x5b0da1(0x1c1)]();console['log'](_0x5b0da1(0x1d1)+_0x4008b0+'\x20by\x20UID:',_0x2c6f65);let _0x501d83=(_0x2c6f65['roleName']||_0x2c6f65['role']||'')['toLowerCase'](),_0x521b2d=_0x2c6f65['roleName']||_0x2c6f65['role']||'';if(_0x501d83&&_0x1291de['includes'](_0x501d83)){console['log']('Found\x20admin\x20role:\x20'+_0x501d83+'\x20in\x20'+_0x4008b0);const _0x3b118a=_0x521b2d['split']('\x20')['map'](_0x57f1f9=>_0x57f1f9[_0x5b0da1(0x1ce)](0x0)[_0x5b0da1(0x1bf)]()+_0x57f1f9[_0x5b0da1(0x1d3)](0x1)['toLowerCase']())['join']('\x20');return{'isAdmin':!![],'role':_0x3b118a};}}}catch(_0x1796b3){console[_0x5b0da1(0x1d0)](_0x5b0da1(0x1ab)+_0x4008b0+'\x20by\x20UID:',_0x1796b3);}}for(const _0x52d8ce of _0x5ce03b){try{const _0x59379c=collection(db,_0x52d8ce);let _0x1696f4=query(_0x59379c,where('email','==',_0x38fbb5[_0x5b0da1(0x1ad)])),_0x3e186e=await getDocs(_0x1696f4);_0x3e186e[_0x5b0da1(0x1b9)]&&(_0x1696f4=query(_0x59379c,where(_0x5b0da1(0x1ad),'==',_0x38fbb5['email'][_0x5b0da1(0x1ca)]())),_0x3e186e=await getDocs(_0x1696f4));if(!_0x3e186e['empty']){const _0x4f1475=_0x3e186e[_0x5b0da1(0x1cf)][0x0]['data']();console['log'](_0x5b0da1(0x1d1)+_0x52d8ce+'\x20by\x20email:',_0x4f1475);let _0x535956=(_0x4f1475['roleName']||_0x4f1475[_0x5b0da1(0x1d5)]||'')[_0x5b0da1(0x1ca)](),_0x25a3be=_0x4f1475[_0x5b0da1(0x1c7)]||_0x4f1475['role']||'';if(_0x535956&&_0x1291de['includes'](_0x535956)){console[_0x5b0da1(0x1c9)](_0x5b0da1(0x1bc)+_0x535956+'\x20in\x20'+_0x52d8ce);const _0x23fca0=_0x25a3be['split']('\x20')['map'](_0x2be35c=>_0x2be35c['charAt'](0x0)['toUpperCase']()+_0x2be35c[_0x5b0da1(0x1d3)](0x1)['toLowerCase']())['join']('\x20');return{'isAdmin':!![],'role':_0x23fca0};}}}catch(_0x2fa0a3){console['error']('Error\x20checking\x20'+_0x52d8ce+_0x5b0da1(0x1bb),_0x2fa0a3);}}return console['log']('No\x20admin\x20roles\x20found\x20for\x20user'),{'isAdmin':![],'role':null};}catch(_0x49c17f){return console['error']('Error\x20in\x20checkAdminRoles:',_0x49c17f),{'isAdmin':![],'role':null};}}async function updateAuthSection(_0x5eb2e3){const _0x379e6d=a12_0x3db6,_0xffac72=_0x5eb2e3&&isAdmin(_0x5eb2e3[_0x379e6d(0x1ad)]);updateAuthSectionImmediate(_0x5eb2e3,_0xffac72);if(!_0x5eb2e3){userCache['uid']=null,userCache['username']=null,userCache['isAdmin']=![],userCache['hasCheckedCollections']=![],userCache[_0x379e6d(0x1d5)]=null;return;}const _0x4c5f60=Date[_0x379e6d(0x1cc)]();if(_0x5eb2e3['uid']===userCache['uid']&&userCache['hasCheckedCollections']&&_0x4c5f60-userCache['lastChecked']<0x493e0)return;try{userCache['uid']=_0x5eb2e3['uid'],userCache['lastChecked']=_0x4c5f60;const _0x3a86a7=isAdmin(_0x5eb2e3['email']);userCache['isAdmin']=_0x3a86a7;if(!_0x3a86a7){const {isAdmin:_0x458ae6,role:_0x5938d4}=await checkAdminRoles(_0x5eb2e3);userCache[_0x379e6d(0x1b8)]=_0x458ae6,userCache['role']=_0x5938d4,_0x458ae6&&(document[_0x379e6d(0x1be)](_0x379e6d(0x1ac))['forEach'](_0x56060e=>{const _0x4a41b6=_0x379e6d;_0x56060e['style'][_0x4a41b6(0x1b5)]='block';}),updateAuthSectionImmediate(_0x5eb2e3,!![]));}const _0xb726a3=[_0x379e6d(0x1cd),'playersD2','playersD3','playersDuos','playersCTF','nonParticipants','userProfiles'],_0x56ba42=_0xb726a3['map'](_0x404d73=>getDoc(doc(db,_0x404d73,_0x5eb2e3[_0x379e6d(0x1c3)]))['then'](_0x441b76=>_0x441b76['exists']()?{'collection':_0x404d73,'data':_0x441b76['data']()}:null)['catch'](()=>null)),_0x1697f7=await Promise['all'](_0x56ba42),_0x1ba99f=_0x1697f7['filter'](_0x7fb278=>_0x7fb278!==null);let _0x3ac6b9=null;for(const _0x309c1e of _0x1ba99f){if(_0x309c1e['data']['username']){_0x3ac6b9=_0x309c1e[_0x379e6d(0x1c1)]['username'];break;}}userCache['username']=_0x3ac6b9||(_0x5eb2e3[_0x379e6d(0x1ad)]?_0x5eb2e3['email']['split']('@')[0x0]:_0x379e6d(0x1c2)),userCache['hasCheckedCollections']=!![],updateAuthSectionImmediate(_0x5eb2e3,userCache[_0x379e6d(0x1b8)]),setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0x5eb2e3['uid']);},0x1f4);}catch(_0x5cc957){console['error'](_0x379e6d(0x1c0),_0x5cc957);}}document[a12_0x367d69(0x1bd)]('DOMContentLoaded',()=>{const _0xfdc579=a12_0x367d69,_0x2fa1c2=getAuth();onAuthStateChanged(_0x2fa1c2,async _0x574661=>{await updateAuthSection(_0x574661),_0x574661&&checkPendingInvitationsForCurrentUser(_0x574661['uid']);}),document['addEventListener'](_0xfdc579(0x1b0),()=>{const _0x2a8a6f=_0xfdc579;!document['hidden']&&_0x2fa1c2['currentUser']&&checkPendingInvitationsForCurrentUser(_0x2fa1c2[_0x2a8a6f(0x1b3)]['uid']);}),document['addEventListener']('click',_0x3b485e=>{const _0x8b9120=_0xfdc579;_0x3b485e['target']['closest'](_0x8b9120(0x1b2))&&_0x2fa1c2['currentUser']&&checkPendingInvitationsForCurrentUser(_0x2fa1c2['currentUser']['uid']);});});export{updateAuthSection};
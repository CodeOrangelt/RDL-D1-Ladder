const a12_0x1f1c16=a12_0x2d41,a12_0x4119a3=(function(){let _0x57f394=!![];return function(_0x45d7ea,_0x21b337){const _0x56e58b=_0x57f394?function(){if(_0x21b337){const _0x3b4bfe=_0x21b337['apply'](_0x45d7ea,arguments);return _0x21b337=null,_0x3b4bfe;}}:function(){};return _0x57f394=![],_0x56e58b;};}()),a12_0x536bd1=a12_0x4119a3(this,function(){const _0xe76363=a12_0x2d41;let _0x485479;try{const _0x1fafd0=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x485479=_0x1fafd0();}catch(_0x46439a){_0x485479=window;}const _0x2d9948=_0x485479['console']=_0x485479['console']||{},_0x248491=['log','warn','info','error','exception','table','trace'];for(let _0x11d3f7=0x0;_0x11d3f7<_0x248491[_0xe76363(0x97)];_0x11d3f7++){const _0x489af6=a12_0x4119a3['constructor']['prototype'][_0xe76363(0xa0)](a12_0x4119a3),_0x498bb7=_0x248491[_0x11d3f7],_0xd12b9f=_0x2d9948[_0x498bb7]||_0x489af6;_0x489af6[_0xe76363(0xa7)]=a12_0x4119a3['bind'](a12_0x4119a3),_0x489af6['toString']=_0xd12b9f[_0xe76363(0x9e)][_0xe76363(0xa0)](_0xd12b9f),_0x2d9948[_0x498bb7]=_0x489af6;}});a12_0x536bd1();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a12_0x2d41(_0x1f084e,_0x2b26ed){const _0x536bd1=a12_0x5b30();return a12_0x2d41=function(_0x4119a3,_0x1a2f65){_0x4119a3=_0x4119a3-0x8e;let _0x5b30f9=_0x536bd1[_0x4119a3];return _0x5b30f9;},a12_0x2d41(_0x1f084e,_0x2b26ed);}import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D2=[{'name':'Gold','elo':0x708},{'name':'Silver','elo':0x640},{'name':a12_0x1f1c16(0x9c),'elo':0x578},{'name':'Unranked','elo':0x4b0}];let lastVisibleD2=null;async function getUsernameByIdD2(_0x49021f){const _0xc9ecd3=a12_0x1f1c16;try{if(!_0x49021f)return'Unknown\x20Player';const _0x163a71=await getDoc(doc(db,_0xc9ecd3(0x93),_0x49021f));if(_0x163a71['exists']())return _0x163a71[_0xc9ecd3(0x96)]()['username']||'Unknown\x20Player';const _0x230941=await getDocs(query(collection(db,_0xc9ecd3(0x9b)),where(_0xc9ecd3(0x8e),'==',_0x49021f),limit(0x1)));if(!_0x230941[_0xc9ecd3(0x9d)])return _0x230941['docs'][0x0]['data']()['winnerUsername']||'Unknown\x20Player';const _0x57d0e8=await getDocs(query(collection(db,'approvedMatchesD2'),where(_0xc9ecd3(0x91),'==',_0x49021f),limit(0x1)));if(!_0x57d0e8['empty'])return _0x57d0e8['docs'][0x0]['data']()[_0xc9ecd3(0x9a)]||'Unknown\x20Player';return _0xc9ecd3(0x94);}catch(_0x35e64f){return console['error'](_0xc9ecd3(0x92),_0x35e64f),_0xc9ecd3(0x94);}}export async function recordEloChangeD2({playerId:_0x461f5c,previousElo:_0x46158e,newElo:_0x558943,opponentId:_0x4b40fd,matchResult:_0x96e4e9,previousPosition:_0x29f8b1,newPosition:_0x3dc579,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x1768ab,timestamp:_0x27d734}){const _0x315620=a12_0x1f1c16;try{const _0x2d94c0=doc(collection(db,_0x315620(0xa2)));let _0x49b161='match';if(isPromotion)_0x49b161=_0x315620(0x8f);if(isDemotion)_0x49b161=_0x315620(0xa5);let _0x3c3e32=_0x315620(0xa3);if(_0x558943>=0x834)_0x3c3e32=_0x315620(0x99);else{if(_0x558943>=0x708)_0x3c3e32=_0x315620(0x90);else{if(_0x558943>=0x640)_0x3c3e32=_0x315620(0x98);else{if(_0x558943>=0x578)_0x3c3e32=_0x315620(0x9c);}}}return await setDoc(_0x2d94c0,{'type':_0x49b161,'player':_0x461f5c,'opponent':_0x4b40fd,'previousElo':_0x46158e,'newElo':_0x558943,'change':_0x558943-_0x46158e,'matchResult':_0x96e4e9,'previousPosition':_0x29f8b1,'newPosition':_0x3dc579,'rankAchieved':_0x3c3e32,'matchId':_0x1768ab,'timestamp':_0x27d734}),console['log'](_0x315620(0xa4)+_0x461f5c),!![];}catch(_0x581e89){console['error']('Error\x20recording\x20D2\x20ELO\x20history:',_0x581e89);throw _0x581e89;}}function a12_0x5b30(){const _0x48f2aa=['winnerId','promotion','Gold','loserId','Error\x20getting\x20username:','playersD2','Unknown\x20Player','size','data','length','Silver','Emerald','loserUsername','approvedMatchesD2','Bronze','empty','toString','Error\x20fetching\x20D2\x20ELO\x20history:','bind','timestamp','eloHistoryD2','Unranked','D2\x20ELO\x20history\x20recorded\x20for\x20','demotion','docs','__proto__'];a12_0x5b30=function(){return _0x48f2aa;};return a12_0x5b30();}export async function getEloHistoryD2(_0xe05682=0x14){const _0x477c70=a12_0x1f1c16;try{const _0x3bf64b=collection(db,'eloHistoryD2');let _0xd1e924;lastVisibleD2?_0xd1e924=query(_0x3bf64b,orderBy('timestamp','desc'),startAfter(lastVisibleD2),limit(_0xe05682)):_0xd1e924=query(_0x3bf64b,orderBy(_0x477c70(0xa1),'desc'),limit(_0xe05682));const _0x1bb1fb=await getDocs(_0xd1e924);if(_0x1bb1fb[_0x477c70(0x9d)])return{'entries':[],'hasMore':![]};lastVisibleD2=_0x1bb1fb['docs'][_0x1bb1fb[_0x477c70(0xa6)][_0x477c70(0x97)]-0x1];const _0x426bf7=_0x1bb1fb['docs']['map'](async _0xf1be58=>{const _0x3cd49a=_0xf1be58['data'](),[_0x2dc5e8,_0x18d07e]=await Promise['all']([getUsernameByIdD2(_0x3cd49a['player']),getUsernameByIdD2(_0x3cd49a['opponent'])]);return{..._0x3cd49a,'playerUsername':_0x2dc5e8,'opponentUsername':_0x18d07e,'change':_0x3cd49a['newElo']-_0x3cd49a['previousElo'],'timestamp':_0x3cd49a['timestamp']};}),_0x642fe6=await Promise['all'](_0x426bf7);return{'entries':_0x642fe6,'hasMore':_0x1bb1fb[_0x477c70(0x95)]===_0xe05682};}catch(_0x2d6254){console['error'](_0x477c70(0x9f),_0x2d6254);throw _0x2d6254;}}export function resetPaginationD2(){lastVisibleD2=null;}
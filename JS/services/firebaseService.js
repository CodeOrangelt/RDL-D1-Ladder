const a50_0x4bbf17=a50_0x3489,a50_0x5524be=(function(){let _0x2133b3=!![];return function(_0x15cb33,_0x5202a8){const _0x22a9fd=_0x2133b3?function(){const _0x14f623=a50_0x3489;if(_0x5202a8){const _0x397cb0=_0x5202a8[_0x14f623(0x194)](_0x15cb33,arguments);return _0x5202a8=null,_0x397cb0;}}:function(){};return _0x2133b3=![],_0x22a9fd;};}()),a50_0x56c5dd=a50_0x5524be(this,function(){const _0x3ad229=a50_0x3489;let _0x2c29b8;try{const _0x255974=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x2c29b8=_0x255974();}catch(_0x48cacd){_0x2c29b8=window;}const _0x21f69b=_0x2c29b8['console']=_0x2c29b8['console']||{},_0x22f7f0=['log',_0x3ad229(0x193),'info',_0x3ad229(0x1a0),_0x3ad229(0x19b),'table','trace'];for(let _0xac1aa7=0x0;_0xac1aa7<_0x22f7f0['length'];_0xac1aa7++){const _0x467822=a50_0x5524be['constructor']['prototype']['bind'](a50_0x5524be),_0x5065bc=_0x22f7f0[_0xac1aa7],_0x56e115=_0x21f69b[_0x5065bc]||_0x467822;_0x467822['__proto__']=a50_0x5524be[_0x3ad229(0x18f)](a50_0x5524be),_0x467822[_0x3ad229(0x19a)]=_0x56e115['toString']['bind'](_0x56e115),_0x21f69b[_0x5065bc]=_0x467822;}});a50_0x56c5dd();import{db}from'../firebase-config.js';import{collection,doc,getDoc,getDocs,query,limit,startAfter,where,onSnapshot}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const cache={'userProfiles':new Map(),'ladderPlayers':new Map(),'matchResults':new Map(),'eloHistory':new Map()},CACHE_EXPIRY={'userProfiles':0x5*0x3c*0x3e8,'ladderPlayers':0x2*0x3c*0x3e8,'matchResults':0x1*0x3c*0x3e8,'eloHistory':0x3*0x3c*0x3e8};export const userProfilesRef=collection(db,a50_0x4bbf17(0x199));function a50_0x3489(_0x5626ac,_0x3ab54f){const _0x56c5dd=a50_0x47ae();return a50_0x3489=function(_0x5524be,_0x165abb){_0x5524be=_0x5524be-0x18e;let _0x47aea4=_0x56c5dd[_0x5524be];return _0x47aea4;},a50_0x3489(_0x5626ac,_0x3ab54f);}export async function fetchPaginatedData(_0x15bf85,_0x1b7f7e=0xa,_0x3e51c4=null){const _0x41fd77=a50_0x4bbf17;let _0x282d7c=query(_0x15bf85,limit(_0x1b7f7e));_0x3e51c4&&(_0x282d7c=query(_0x282d7c,startAfter(_0x3e51c4)));const _0x4f95cd=await getDocs(_0x282d7c),_0x2a21d2=_0x4f95cd['docs'][_0x4f95cd[_0x41fd77(0x198)]['length']-0x1];return{'data':_0x4f95cd['docs']['map'](_0x1bb17a=>({'id':_0x1bb17a['id'],..._0x1bb17a['data']()})),'lastVisible':_0x2a21d2,'hasMore':_0x4f95cd[_0x41fd77(0x198)]['length']===_0x1b7f7e};}export async function getUserProfile(_0x3317fd){const _0xf14950=a50_0x4bbf17,_0x3b4887=cache['userProfiles']['get'](_0x3317fd);if(_0x3b4887&&Date['now']()-_0x3b4887[_0xf14950(0x18e)]<CACHE_EXPIRY[_0xf14950(0x199)])return _0x3b4887[_0xf14950(0x195)];const _0x1d725e=await getDoc(doc(userProfilesRef,_0x3317fd));if(_0x1d725e['exists']()){const _0x12d11a=_0x1d725e['data']();return cache['userProfiles'][_0xf14950(0x190)](_0x3317fd,{'data':_0x12d11a,'timestamp':Date['now']()}),_0x12d11a;}return null;}export async function getLadderData(_0x10ddbf=0x1){const _0x49bc16=a50_0x4bbf17,_0xa80412='division_'+_0x10ddbf,_0x331d5b=cache['ladderPlayers']['get'](_0xa80412);if(_0x331d5b&&Date['now']()-_0x331d5b['timestamp']<CACHE_EXPIRY['ladderPlayers'])return _0x331d5b['data'];const _0xfba98d=_0x10ddbf===0x1?'players':'playersD'+_0x10ddbf,_0x3fb17a=collection(db,_0xfba98d),_0x45b9fb=await getDocs(query(_0x3fb17a,limit(0x64))),_0x1d707f=_0x45b9fb['docs'][_0x49bc16(0x19c)](_0x20435d=>({'id':_0x20435d['id'],..._0x20435d['data']()}));return cache['ladderPlayers']['set'](_0xa80412,{'data':_0x1d707f,'timestamp':Date['now']()}),_0x1d707f;}export async function getEloHistoryBatch(_0x35e79a,_0x5e85d7=0x1){const _0x4316dd=a50_0x4bbf17,_0x3ea62b=_0x5e85d7===0x1?_0x4316dd(0x192):'eloHistoryD'+_0x5e85d7,_0xa5d67d=collection(db,_0x3ea62b),_0x27a537={},_0x185d50=[];_0x35e79a['forEach'](_0x3e6be1=>{const _0x4ecd41=_0x4316dd,_0x52256f=_0x3e6be1+'_'+_0x5e85d7,_0x28a120=cache['eloHistory']['get'](_0x52256f);_0x28a120&&Date[_0x4ecd41(0x1a2)]()-_0x28a120['timestamp']<CACHE_EXPIRY[_0x4ecd41(0x192)]?_0x27a537[_0x3e6be1]=_0x28a120['data']:_0x185d50['push'](_0x3e6be1);});const _0x3e4bc4=0xa;for(let _0x241a0e=0x0;_0x241a0e<_0x185d50['length'];_0x241a0e+=_0x3e4bc4){const _0x415156=_0x185d50[_0x4316dd(0x1a3)](_0x241a0e,_0x241a0e+_0x3e4bc4);if(_0x415156['length']>0x0)try{const _0x91494=query(_0xa5d67d,where(_0x4316dd(0x1a1),'in',_0x415156),limit(0x64)),_0x504597=await getDocs(_0x91494);_0x504597['docs'][_0x4316dd(0x191)](_0xc8fcb=>{const _0x4386e2=_0x4316dd,_0x5297ea=_0xc8fcb[_0x4386e2(0x195)](),_0x5f0261=_0x5297ea['playerId'];if(!_0x27a537[_0x5f0261])_0x27a537[_0x5f0261]=[];_0x27a537[_0x5f0261][_0x4386e2(0x19e)](_0x5297ea);const _0x536837=_0x5f0261+'_'+_0x5e85d7;cache['eloHistory'][_0x4386e2(0x190)](_0x536837,{'data':_0x27a537[_0x5f0261],'timestamp':Date['now']()});});}catch(_0x505a98){console['error']('Error\x20fetching\x20batch\x20ELO\x20history:',_0x505a98);}}return _0x27a537;}function a50_0x47ae(){const _0x72578c=['timestamp','bind','set','forEach','eloHistory','warn','apply','data','docChanges','username','docs','userProfiles','toString','exception','map','players','push','playersD2','error','playerId','now','slice'];a50_0x47ae=function(){return _0x72578c;};return a50_0x47ae();}let usernameCache=new Map(),usernameCacheTimestamp=Date['now']();export function setupEfficientListener(_0x4ead4d,_0x5246d4=[],_0x404c45){const _0x5d2669=collection(db,_0x4ead4d),_0xae6680=query(_0x5d2669,..._0x5246d4),_0x43561d=onSnapshot(_0xae6680,_0xa4289c=>{const _0x1a134e=a50_0x3489,_0x40d934=_0xa4289c[_0x1a134e(0x196)]()[_0x1a134e(0x19c)](_0x15c641=>({'type':_0x15c641['type'],'id':_0x15c641['doc']['id'],'data':_0x15c641['doc'][_0x1a134e(0x195)]()}));_0x40d934['length']>0x0&&_0x404c45(_0x40d934,_0xa4289c[_0x1a134e(0x198)]);});return _0x43561d;}export async function bulkResolveUsernames(_0x32f984){const _0x561353=a50_0x4bbf17,_0x38267d=new Map();if(!_0x32f984||_0x32f984['length']===0x0)return _0x38267d;const _0x4b1b90=[_0x561353(0x19d),_0x561353(0x19f),'playersD3','nonParticipants'];for(const _0x2df6d4 of _0x4b1b90){const _0x20da3b=collection(db,_0x2df6d4),_0x7185f0=await getDocs(_0x20da3b);_0x7185f0['forEach'](_0x2ee353=>{const _0x52f49a=_0x561353,_0xa0023=_0x2ee353['data']();_0xa0023['username']&&_0x32f984['includes'](_0x2ee353['id'])&&_0x38267d['set'](_0x2ee353['id'],_0xa0023[_0x52f49a(0x197)]);});}return _0x38267d;}
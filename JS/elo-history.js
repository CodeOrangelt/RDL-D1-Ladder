const a18_0xb5408d=(function(){let _0x1a329a=!![];return function(_0x43c8ae,_0x12fec1){const _0x4d6bb6=_0x1a329a?function(){const _0x58b934=a18_0x693a;if(_0x12fec1){const _0x5b9113=_0x12fec1[_0x58b934(0x82)](_0x43c8ae,arguments);return _0x12fec1=null,_0x5b9113;}}:function(){};return _0x1a329a=![],_0x4d6bb6;};}()),a18_0x3590c8=a18_0xb5408d(this,function(){const _0x17ddff=a18_0x693a;let _0x18eea6;try{const _0x43a8ac=Function(_0x17ddff(0x6b)+_0x17ddff(0x7c)+');');_0x18eea6=_0x43a8ac();}catch(_0x3f7324){_0x18eea6=window;}const _0x55f008=_0x18eea6[_0x17ddff(0x8c)]=_0x18eea6[_0x17ddff(0x8c)]||{},_0x389182=[_0x17ddff(0x86),_0x17ddff(0x76),_0x17ddff(0x90),_0x17ddff(0x69),_0x17ddff(0x70),_0x17ddff(0x7f),_0x17ddff(0x84)];for(let _0x4218a0=0x0;_0x4218a0<_0x389182[_0x17ddff(0x8f)];_0x4218a0++){const _0x2a25a2=a18_0xb5408d[_0x17ddff(0x7d)][_0x17ddff(0x6d)][_0x17ddff(0x6a)](a18_0xb5408d),_0x2c063c=_0x389182[_0x4218a0],_0x4feb0f=_0x55f008[_0x2c063c]||_0x2a25a2;_0x2a25a2[_0x17ddff(0x89)]=a18_0xb5408d[_0x17ddff(0x6a)](a18_0xb5408d),_0x2a25a2[_0x17ddff(0x6c)]=_0x4feb0f[_0x17ddff(0x6c)][_0x17ddff(0x6a)](_0x4feb0f),_0x55f008[_0x2c063c]=_0x2a25a2;}});a18_0x3590c8();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a18_0x333b(){const _0x6e154=['error','bind','return\x20(function()\x20','toString','prototype','Unknown\x20Player','map','exception','players','exists','player','promotion','Error\x20recording\x20ELO\x20history:','warn','desc','match','demotion','ELO\x20history\x20recorded\x20for\x20','Error\x20fetching\x20username:','{}.constructor(\x22return\x20this\x22)(\x20)','constructor','data','table','username','timestamp','apply','previousElo','trace','opponent','log','docs','Error\x20fetching\x20ELO\x20history:','__proto__','newElo','all','console','eloHistory','name','length','info'];a18_0x333b=function(){return _0x6e154;};return a18_0x333b();}function a18_0x693a(_0x38f272,_0x57a2c4){_0x38f272=_0x38f272-0x69;const _0x3590c8=a18_0x333b();let _0xb5408d=_0x3590c8[_0x38f272];return _0xb5408d;}import{db}from'./firebase-config.js';import{getRankStyle}from'./ranks.js';async function getUsernameById(_0x2249bd){const _0x48988c=a18_0x693a;try{if(!_0x2249bd)return _0x48988c(0x6e);const _0x3eb5bd=await getDoc(doc(db,_0x48988c(0x71),_0x2249bd));return _0x3eb5bd[_0x48988c(0x72)]()?_0x3eb5bd[_0x48988c(0x7e)]()[_0x48988c(0x80)]:_0x48988c(0x6e);}catch(_0x18245f){return console[_0x48988c(0x69)](_0x48988c(0x7b),_0x18245f),_0x48988c(0x6e);}}export async function recordEloChange({playerId:_0x3e3c40,previousElo:_0x28ab1b,newElo:_0x2b5ce5,opponentId:_0x15b573,matchResult:_0x2f477e,previousPosition:_0x502ba5,newPosition:_0x35bd91,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x2100cf,timestamp:_0x1eb01a,matchCount:matchCount=null,winRate:winRate=0x0}){const _0x37200c=a18_0x693a;try{const _0x10a397=doc(collection(db,_0x37200c(0x8d))),_0x4f1262=await getUsernameById(_0x3e3c40),_0x350891=_0x15b573?await getUsernameById(_0x15b573):null;let _0x3f3a6a=_0x37200c(0x78);if(isPromotion)_0x3f3a6a=_0x37200c(0x74);if(isDemotion)_0x3f3a6a=_0x37200c(0x79);const _0x3fa512=getRankStyle(_0x2b5ce5,matchCount,winRate),_0x3b5711=_0x3fa512[_0x37200c(0x8e)];return await setDoc(_0x10a397,{'type':_0x3f3a6a,'player':_0x3e3c40,'username':_0x4f1262,'playerUsername':_0x4f1262,'opponent':_0x15b573,'opponentUsername':_0x350891,'previousElo':_0x28ab1b,'newElo':_0x2b5ce5,'change':_0x2b5ce5-_0x28ab1b,'matchResult':_0x2f477e,'previousPosition':_0x502ba5,'newPosition':_0x35bd91,'rankAchieved':_0x3b5711,'gameMode':'D1','matchId':_0x2100cf,'timestamp':_0x1eb01a}),console[_0x37200c(0x86)](_0x37200c(0x7a)+_0x4f1262+'\x20('+_0x3e3c40+')'),!![];}catch(_0x581f12){console[_0x37200c(0x69)](_0x37200c(0x75),_0x581f12);throw _0x581f12;}}export async function getEloHistory(){const _0x499c6d=a18_0x693a;try{const _0x5876da=collection(db,_0x499c6d(0x8d)),_0x5c3299=query(_0x5876da,orderBy(_0x499c6d(0x81),_0x499c6d(0x77))),_0x50b17e=await getDocs(_0x5c3299),_0x2e70f2=_0x50b17e[_0x499c6d(0x87)][_0x499c6d(0x6f)](async _0x574cfa=>{const _0x575042=_0x499c6d,_0x33f3c1=_0x574cfa[_0x575042(0x7e)](),[_0x5233b0,_0x5a1c0f]=await Promise[_0x575042(0x8b)]([getUsernameById(_0x33f3c1[_0x575042(0x73)]),getUsernameById(_0x33f3c1[_0x575042(0x85)])]);return{..._0x33f3c1,'playerUsername':_0x5233b0,'opponentUsername':_0x5a1c0f,'change':_0x33f3c1[_0x575042(0x8a)]-_0x33f3c1[_0x575042(0x83)],'timestamp':_0x33f3c1[_0x575042(0x81)]};}),_0x5b4454=await Promise[_0x499c6d(0x8b)](_0x2e70f2);return{'entries':_0x5b4454};}catch(_0x571c2c){console[_0x499c6d(0x69)](_0x499c6d(0x88),_0x571c2c);throw _0x571c2c;}}export function resetPagination(){lastVisible=null;}
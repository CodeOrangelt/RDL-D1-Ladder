import{initializeApp}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';import{getFirestore,collection,getDocs,writeBatch,doc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{firebaseConfig}from'../firebase-config.js';const app=initializeApp(firebaseConfig),db=getFirestore(app);function a1_0x3075(_0x196df5,_0x883ee7){const _0x419d66=a1_0x293d();return a1_0x3075=function(_0x49dcba,_0x1caa1e){_0x49dcba=_0x49dcba-0x11f;let _0x293d9d=_0x419d66[_0x49dcba];return _0x293d9d;},a1_0x3075(_0x196df5,_0x883ee7);}function a1_0x293d(){const _0xabd1c2=['commit','prototype','favoriteWeapon','all','permission-denied','\x20D2,\x20','table','size','📥\x20Fetching\x20all\x20collections...','log','silver','has','code','gold','profileImageUrl','emerald','length','get','push','nonParticipants','country','ladders','set','forEach','🚀\x20Executing\x20'];a1_0x293d=function(){return _0xabd1c2;};return a1_0x293d();}async function migrateToAggregatedMembers(){const _0x54d42b=a1_0x3075,_0xf904d9=(function(){let _0x37138b=!![];return function(_0x2e3a04,_0x3928db){const _0x21554d=_0x37138b?function(){if(_0x3928db){const _0x3d8198=_0x3928db['apply'](_0x2e3a04,arguments);return _0x3928db=null,_0x3d8198;}}:function(){};return _0x37138b=![],_0x21554d;};}()),_0x4aa972=_0xf904d9(this,function(){const _0x73dcee=a1_0x3075;let _0xc336da;try{const _0x1e3c1a=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0xc336da=_0x1e3c1a();}catch(_0x10395d){_0xc336da=window;}const _0x4ceef9=_0xc336da['console']=_0xc336da['console']||{},_0x249b18=['log','warn','info','error','exception',_0x73dcee(0x125),'trace'];for(let _0x54bdf7=0x0;_0x54bdf7<_0x249b18['length'];_0x54bdf7++){const _0x198a09=_0xf904d9['constructor'][_0x73dcee(0x120)]['bind'](_0xf904d9),_0x590e31=_0x249b18[_0x54bdf7],_0x5421e1=_0x4ceef9[_0x590e31]||_0x198a09;_0x198a09['__proto__']=_0xf904d9['bind'](_0xf904d9),_0x198a09['toString']=_0x5421e1['toString']['bind'](_0x5421e1),_0x4ceef9[_0x590e31]=_0x198a09;}});_0x4aa972(),console[_0x54d42b(0x128)]('🔄\x20Starting\x20migration\x20to\x20aggregated\x20members...');try{console['log'](_0x54d42b(0x127));const [_0x26ca6f,_0x56c7ba,_0x1a6df1,_0x82d91f,_0x5e913e]=await Promise['all']([getDocs(collection(db,'userProfiles')),getDocs(collection(db,'players')),getDocs(collection(db,'playersD2')),getDocs(collection(db,'playersD3')),getDocs(collection(db,_0x54d42b(0x132)))]);console[_0x54d42b(0x128)]('✅\x20Data\x20fetched:\x20'+_0x26ca6f['size']+'\x20profiles,\x20'+_0x56c7ba['size']+'\x20D1,\x20'+_0x1a6df1[_0x54d42b(0x126)]+_0x54d42b(0x124)+_0x82d91f['size']+'\x20D3,\x20'+_0x5e913e[_0x54d42b(0x126)]+'\x20non-participants');const _0x13d67f=new Map();_0x26ca6f['forEach'](_0x3bd196=>{_0x13d67f['set'](_0x3bd196['id'],_0x3bd196['data']());});const _0x55111e=new Map(),_0x30e313=(_0x248350,_0x3d6437)=>{_0x248350['forEach'](_0x5b85ae=>{const _0x460e4b=a1_0x3075,_0x545a98=_0x5b85ae['data'](),_0x3a0de4=_0x5b85ae['id'];!_0x55111e[_0x460e4b(0x12a)](_0x3a0de4)&&_0x55111e['set'](_0x3a0de4,{'userId':_0x3a0de4,'username':_0x545a98['username']||_0x545a98['name']||'Unknown','ladders':[],'isNonParticipant':![]});const _0x3b3391=_0x55111e[_0x460e4b(0x130)](_0x3a0de4);_0x3b3391['ladders'][_0x460e4b(0x131)]({'ladder':_0x3d6437,'elo':_0x545a98['eloRating']||_0x545a98['elo']||0x4b0,'active':_0x545a98['active']!==![]});});};_0x30e313(_0x56c7ba,'D1'),_0x30e313(_0x1a6df1,'D2'),_0x30e313(_0x82d91f,'D3'),_0x5e913e[_0x54d42b(0x136)](_0x1e5960=>{const _0x3dfe59=_0x54d42b,_0x537405=_0x1e5960['data'](),_0x54a4c5=_0x1e5960['id'];!_0x55111e[_0x3dfe59(0x12a)](_0x54a4c5)&&(_0x537405['username']||_0x537405['name'])&&_0x55111e[_0x3dfe59(0x135)](_0x54a4c5,{'userId':_0x54a4c5,'username':_0x537405['username']||_0x537405['name'],'ladders':[],'isNonParticipant':!![]});}),console[_0x54d42b(0x128)]('⚙️\x20Processed\x20'+_0x55111e['size']+'\x20unique\x20members'),console['log']('💾\x20Writing\x20aggregated\x20data...');const _0x349832=[];let _0x431cfe=writeBatch(db),_0x3c99b3=0x0,_0x79ba3=0x0;_0x55111e['forEach']((_0xb1d9a6,_0x481d41)=>{const _0x13881d=_0x54d42b,_0x378607=_0x13d67f['get'](_0x481d41)||{};let _0x353240=0x0,_0x311e51=null;if(_0xb1d9a6[_0x13881d(0x134)][_0x13881d(0x12f)]>0x0){const _0x14e021=_0xb1d9a6['ladders']['sort']((_0x55b639,_0x5599f7)=>_0x5599f7['elo']-_0x55b639['elo']);_0x353240=_0x14e021[0x0]['elo'],_0x311e51=_0x14e021[0x0]['ladder'];}const _0x12e8e5={'userId':_0x481d41,'username':_0xb1d9a6['username'],'profileImageUrl':_0x378607[_0x13881d(0x12d)]||null,'country':_0x378607[_0x13881d(0x133)]||null,'motto':_0x378607['motto']||null,'favoriteMap':_0x378607['favoriteMap']||null,'favoriteWeapon':_0x378607[_0x13881d(0x121)]||null,'isNonParticipant':_0xb1d9a6['isNonParticipant'],'ladders':_0xb1d9a6['ladders'],'primaryLadder':_0x311e51,'highestElo':_0x353240,'rank':getPlayerRank(_0x353240),'lastUpdated':new Date(),'migrationTimestamp':new Date()['toISOString']()},_0x4f2494=doc(collection(db,'aggregatedMembers'),_0x481d41);_0x431cfe['set'](_0x4f2494,_0x12e8e5),_0x3c99b3++,_0x79ba3++,_0x3c99b3>=0x1c2&&(_0x349832[_0x13881d(0x131)](_0x431cfe[_0x13881d(0x11f)]()),_0x431cfe=writeBatch(db),_0x3c99b3=0x0,console['log']('📦\x20Prepared\x20batch\x20'+_0x349832['length']+'\x20('+_0x79ba3+'\x20members\x20processed)'));}),_0x3c99b3>0x0&&_0x349832[_0x54d42b(0x131)](_0x431cfe[_0x54d42b(0x11f)]()),console['log'](_0x54d42b(0x137)+_0x349832['length']+'\x20batches...'),await Promise[_0x54d42b(0x122)](_0x349832),console['log']('🎉\x20Successfully\x20migrated\x20'+_0x55111e['size']+'\x20members\x20to\x20aggregated\x20collection!'),console['log']('💡\x20Refresh\x20your\x20members\x20page\x20to\x20see\x20the\x20results!');}catch(_0x4ef2db){console['error']('❌\x20Migration\x20failed:',_0x4ef2db),_0x4ef2db[_0x54d42b(0x12b)]===_0x54d42b(0x123)&&console['error']('🔒\x20Permission\x20denied.\x20Make\x20sure\x20you\x27re\x20signed\x20in\x20as\x20an\x20admin\x20and\x20security\x20rules\x20allow\x20access\x20to\x20aggregatedMembers\x20collection.');}}function getPlayerRank(_0x1dc32f){const _0x520903=a1_0x3075;if(_0x1dc32f>=0x7d0)return _0x520903(0x12e);if(_0x1dc32f>=0x708)return _0x520903(0x12c);if(_0x1dc32f>=0x640)return _0x520903(0x129);if(_0x1dc32f>=0x578)return'bronze';return'unranked';}migrateToAggregatedMembers();
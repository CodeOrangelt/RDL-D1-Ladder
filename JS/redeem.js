const a50_0x7aa76f=a50_0x54e9,a50_0x23bbef=(function(){let _0x375f94=!![];return function(_0x17ffac,_0x3ae8ae){const _0x5c682e=_0x375f94?function(){const _0x1b8d67=a50_0x54e9;if(_0x3ae8ae){const _0x3d319b=_0x3ae8ae[_0x1b8d67(0x104)](_0x17ffac,arguments);return _0x3ae8ae=null,_0x3d319b;}}:function(){};return _0x375f94=![],_0x5c682e;};}()),a50_0x4fe1f7=a50_0x23bbef(this,function(){const _0x34bafb=a50_0x54e9,_0x10d690=function(){let _0x3f3fbf;try{_0x3f3fbf=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x1c6096){_0x3f3fbf=window;}return _0x3f3fbf;},_0xf1cd4c=_0x10d690(),_0x502828=_0xf1cd4c['console']=_0xf1cd4c[_0x34bafb(0x13d)]||{},_0x4190f5=['log','warn','info',_0x34bafb(0x126),'exception','table','trace'];for(let _0x347134=0x0;_0x347134<_0x4190f5[_0x34bafb(0xe5)];_0x347134++){const _0xcdfbee=a50_0x23bbef['constructor']['prototype']['bind'](a50_0x23bbef),_0x36dd48=_0x4190f5[_0x347134],_0x34b04e=_0x502828[_0x36dd48]||_0xcdfbee;_0xcdfbee[_0x34bafb(0xfb)]=a50_0x23bbef[_0x34bafb(0x156)](a50_0x23bbef),_0xcdfbee['toString']=_0x34b04e['toString']['bind'](_0x34b04e),_0x502828[_0x36dd48]=_0xcdfbee;}});a50_0x4fe1f7();import{getAuth,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{getFirestore,doc,getDoc,setDoc,updateDoc,collection,addDoc,serverTimestamp}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{clearTokenCache}from'./tokens.js';const auth=getAuth(),db=getFirestore(),THEMES={'default':{'price':0x0,'name':a50_0x7aa76f(0x110),'description':'Rock\x20texture\x20with\x20a\x20sleek\x20nav\x20and\x20footer'},'purple':{'price':0x96,'name':'Purple','description':'Can\x27t\x20get\x20enough'},'cyberpunk':{'price':0x190,'name':'Yellow\x20Orange','description':'This\x20theme\x20makes\x20me\x20happy'},'emerald':{'price':0x3e8,'name':'Emerald','description':'Emerald\x20City!'},'gold':{'price':0x320,'name':'Gold','description':'Only\x20the\x20best\x20get\x20this\x20one'},'contrast':{'price':0x0,'name':'Black\x20&\x20White','description':a50_0x7aa76f(0x117)},'ocean':{'price':0x12c,'name':'Blue','description':'This\x20one\x20is\x20really\x20pretty'},'volcanic':{'price':0x1f4,'name':a50_0x7aa76f(0x10c),'description':'For\x20the\x20angry\x20type.'}},TOKENS={'blob01':{'price':0x1f4,'name':'Blob\x20Token\x201','description':'A\x20mysterious\x20purple\x20blob\x20token','image':'../images/tokens/blob01.gif','category':'blob'},'blob02':{'price':0x3e8,'name':a50_0x7aa76f(0x14f),'description':'Another\x20enigmatic\x20blob\x20creature','image':a50_0x7aa76f(0x161),'category':'blob'},'blob03':{'price':0x7d0,'name':a50_0x7aa76f(0xe3),'description':'The\x20final\x20blob\x20in\x20the\x20collection','image':'../images/tokens/blob03.gif','category':'blob'},'cloak':{'price':0x1f4,'name':'Cloaking\x20Device','description':'Become\x20one\x20with\x20the\x20shadows','image':'../images/tokens/cloak.gif','category':'special'},'gauge18':{'price':0x320,'name':'R/Y/B\x20Keys','description':'Monitor\x20your\x20ship\x27s\x20energy\x20levels','image':'../images/tokens/gauge18.gif','category':a50_0x7aa76f(0x142)},'fusion':{'price':0x15e,'name':'Fusion\x20Cannon','description':'Devastating\x20fusion\x20weapon\x20technology','image':a50_0x7aa76f(0xeb),'category':'weapon'},'mmissile':{'price':0x320,'name':'Mega\x20Missile','description':'Heavy\x20ordinance\x20for\x20tough\x20situations','image':'../images/tokens/subgame/mmissile.gif','category':'weapon'},'pbomb':{'price':0x15e,'name':'Proximity\x20Bomb','description':a50_0x7aa76f(0x119),'image':'../images/tokens/subgame/pbomb.gif','category':'weapon'},'pwr01':{'price':0x64,'name':'Energy','description':'Enhanced\x20energy\x20generation\x20unit','image':a50_0x7aa76f(0x140),'category':'powerup'},'pwr02':{'price':0x258,'name':a50_0x7aa76f(0x151),'description':'Advanced\x20energy\x20storage\x20system','image':a50_0x7aa76f(0xef),'category':'powerup'},'smissile':{'price':0x28a,'name':a50_0x7aa76f(0xf7),'description':'Intelligent\x20targeting\x20system','image':'../images/tokens/subgame/smissile.gif','category':'weapon'}};function a50_0x3d45(){const _0x44b3c9=['Please\x20sign\x20in\x20to\x20unequip\x20tokens','Blob\x20Token\x203','store-content','length','disabled','switchTheme','You\x20already\x20own\x20this\x20','toLocaleString','\x20saved\x20to\x20userTokens\x20collection\x20(not\x20equipped)','../images/tokens/subgame/fusion.gif','can-afford','appendChild','\x20Points','../images/tokens/subgame/pwr02.gif','addEventListener','innerHTML','floor','Buy\x20for\x20','.tokens-grid','Transaction\x20logging\x20failed,\x20but\x20purchase\x20was\x20successful:','[data-token]','Smart\x20Missile','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22theme-select-btn\x20purchase-btn\x22>Select\x20Theme</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','Insufficient\x20points','username','__proto__','token','?\x20This\x20will\x20unequip\x20your\x20current\x20token.','Purchase\x20failed.\x20Please\x20try\x20again.','Sign\x20in\x20to\x20Purchase','none','map','Owned','0.5','apply','name','‚úÖ\x20Sold\x20token\x20','data','Token\x20equip\x20failed:','price','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-palette\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22item-price\x22>','store-message','Red','\x20not\x20found','token_','var(--success-color,\x20#4CAF50)','Classic\x20RDL','!\x20Use\x20the\x20\x22Equip\x22\x20button\x20to\x20show\x20it\x20on\x20the\x20ladder.','Successfully\x20purchased\x20','userTokens','\x20theme\x20applied!','tokens','\x20theme\x20for\x20','You\x20can\x20see\x20better!','entries','Strategic\x20explosive\x20device','includes','inventory','permission-denied','style','cannot-afford','Error\x20loading\x20user\x20data:','opacity','Not\x20enough\x20points.\x20You\x20need\x20','isAdmin','Only\x20admins\x20can\x20sell\x20tokens','apply-theme','className','error','textContent','message','transactions','Token\x20sale\x20failed:','confirm','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22item-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22item-icon\x20theme-icon-','Themes\x20container\x20not\x20found','info','equippedToken','\x20for\x20','cursor','.themes-grid','image','default','querySelectorAll','Theme\x20','üîÑ\x20Refreshing\x20ladder\x20to\x20show\x20equipped\x20token','Tokens\x20container\x20not\x20found','currentUser','‚úÖ\x20Token\x20','Buy','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22item-title\x22>','console','0.7','var(--info-color,\x20#17a2b8)','../images/tokens/subgame/pwr01.gif','Equip','equipment','preventDefault','.theme-select-btn','remove','uid','filter','RedeemStore','displayLadder','log','add','getElementById','exists','Token\x20','Blob\x20Token\x202','dataset','Shield\x20Orb','Failed\x20to\x20unequip\x20token:\x20','background','block','sale','bind','display','points','Please\x20sign\x20in\x20to\x20purchase\x20themes','closest','You\x20need\x20','refreshUI','function','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','Failed\x20to\x20sell\x20token:\x20','theme','../images/tokens/blob02.gif','classList','forEach',',\x20Inventory:\x20','userProfiles'];a50_0x3d45=function(){return _0x44b3c9;};return a50_0x3d45();}let userData={'points':0x0,'inventory':[],'isAdmin':![]},storeContainer,pointsDisplay,authWarning;document[a50_0x7aa76f(0xf0)]('DOMContentLoaded',()=>{const _0x4f5509=a50_0x7aa76f;console['log']('üè™\x20Redeem\x20store\x20initializing...'),storeContainer=document['getElementById'](_0x4f5509(0xe4)),pointsDisplay=document['getElementById']('user-points'),authWarning=document['getElementById']('auth-warning'),initAuthListener(),buildStoreUI();});function initAuthListener(){onAuthStateChanged(auth,async _0xda762=>{const _0x584d6e=a50_0x54e9;if(_0xda762){console['log']('‚úÖ\x20User\x20authenticated:',_0xda762['displayName']||_0xda762['email']);if(authWarning)authWarning[_0x584d6e(0x11d)]['display']=_0x584d6e(0x100);if(storeContainer)storeContainer[_0x584d6e(0x11d)][_0x584d6e(0x157)]='block';await loadUserData(_0xda762),updateThemeButtons(),updateTokenButtons();}else{console[_0x584d6e(0x14a)]('‚ùå\x20User\x20not\x20authenticated');if(authWarning)authWarning['style'][_0x584d6e(0x157)]='block';if(storeContainer)storeContainer['style'][_0x584d6e(0x157)]='none';userData={'points':0x0,'inventory':[],'isAdmin':![]},window['isUserAdmin']=![];}});}async function loadUserData(_0x32f0bf){const _0x101423=a50_0x7aa76f;try{const _0x1f32ed=doc(db,'userProfiles',_0x32f0bf['uid']),_0x204269=await getDoc(_0x1f32ed);if(_0x204269['exists']()){const _0x4c5ca5=_0x204269[_0x101423(0x107)]();userData={'points':_0x4c5ca5[_0x101423(0x158)]||0x0,'inventory':_0x4c5ca5['inventory']||[],'isAdmin':_0x4c5ca5['isAdmin']||![],'equippedToken':_0x4c5ca5['equippedToken']||null},pointsDisplay&&(pointsDisplay['textContent']=userData['points']['toLocaleString']()),window['isUserAdmin']=userData['isAdmin'],userData['isAdmin']&&(console['log']('üëë\x20Admin\x20controls\x20enabled'),window['dispatchEvent'](new CustomEvent('adminStatusChanged',{'detail':{'isAdmin':!![]}}))),console['log']('User\x20data\x20loaded\x20-\x20Points:\x20'+userData['points']+_0x101423(0x164)+userData['inventory'][_0x101423(0xe5)]+'\x20items,\x20Equipped:\x20'+(userData[_0x101423(0x12f)]||'none'));}else await setDoc(_0x1f32ed,{'points':0x0,'inventory':[],'equippedToken':null,'createdAt':serverTimestamp(),'username':_0x32f0bf['displayName']||_0x32f0bf['email']?.['split']('@')[0x0]||'User'}),userData={'points':0x0,'inventory':[],'isAdmin':![],'equippedToken':null},pointsDisplay&&(pointsDisplay['textContent']='0'),window['isUserAdmin']=![],console['log']('New\x20user\x20profile\x20created');}catch(_0xe2245){console[_0x101423(0x126)](_0x101423(0x11f),_0xe2245);}}function userOwnsTheme(_0xe0486e){if(THEMES[_0xe0486e]?.['price']===0x0)return!![];return userData['inventory']['includes']('theme_'+_0xe0486e);}function userOwnsToken(_0x20a93e){const _0x1105ed=a50_0x7aa76f;return userData[_0x1105ed(0x11b)]['includes'](_0x1105ed(0x10e)+_0x20a93e);}function userHasTokenEquipped(_0x2f142d){return userData['equippedToken']===_0x2f142d;}function getEquippedToken(){return userData['equippedToken']||null;}async function purchaseTheme(_0x2404b2){const _0xd5e414=a50_0x7aa76f,_0x187e45=auth[_0xd5e414(0x139)];if(!_0x187e45)return showMessage(_0xd5e414(0x159),_0xd5e414(0x126)),![];const _0x3f8792=THEMES[_0x2404b2];if(!_0x3f8792)return console['error']('Theme\x20'+_0x2404b2+'\x20not\x20found'),![];if(userData['points']<_0x3f8792[_0xd5e414(0x109)])return showMessage(_0xd5e414(0x121)+(_0x3f8792[_0xd5e414(0x109)]-userData['points'])+'\x20more\x20points.','error'),![];if(userOwnsTheme(_0x2404b2))return showMessage('You\x20already\x20own\x20the\x20'+_0x3f8792['name']+'\x20theme',_0xd5e414(0x12e)),![];try{return await processPurchase(_0x2404b2,_0x3f8792,'theme');}catch(_0x27dbce){return console[_0xd5e414(0x126)]('Theme\x20purchase\x20failed:',_0x27dbce),showMessage(_0xd5e414(0xfe),'error'),![];}}async function purchaseToken(_0x2f236f){const _0x127771=a50_0x7aa76f,_0x5ef443=auth['currentUser'];if(!_0x5ef443)return showMessage('Please\x20sign\x20in\x20to\x20purchase\x20tokens','error'),![];const _0x20b08a=TOKENS[_0x2f236f];if(!_0x20b08a)return console['error'](_0x127771(0x14e)+_0x2f236f+_0x127771(0x10d)),![];if(userData['points']<_0x20b08a[_0x127771(0x109)])return showMessage('Not\x20enough\x20points.\x20You\x20need\x20'+(_0x20b08a['price']-userData['points'])+'\x20more\x20points.',_0x127771(0x126)),![];if(userOwnsToken(_0x2f236f))return showMessage('You\x20already\x20own\x20the\x20'+_0x20b08a['name']+'\x20token',_0x127771(0x12e)),![];try{return await processPurchase(_0x2f236f,_0x20b08a,'token');}catch(_0x95fd0c){return console['error']('Token\x20purchase\x20failed:',_0x95fd0c),showMessage('Purchase\x20failed.\x20Please\x20try\x20again.',_0x127771(0x126)),![];}}async function processPurchase(_0x23794d,_0x474080,_0xb58221){const _0x248c16=a50_0x7aa76f,_0x12ca55=auth['currentUser'];try{const _0x294228=doc(db,'userProfiles',_0x12ca55['uid']),_0x2aea3f=await getDoc(_0x294228);if(!_0x2aea3f['exists']())return showMessage('User\x20profile\x20not\x20found','error'),![];const _0x3d1a63=_0x2aea3f['data'](),_0x8056c0=_0x3d1a63['points']||0x0,_0xb7be0a=_0x3d1a63[_0x248c16(0x11b)]||[];if(_0x8056c0<_0x474080['price'])return showMessage(_0x248c16(0xf9),'error'),![];if(_0xb7be0a['includes'](_0xb58221+'_'+_0x23794d))return showMessage(_0x248c16(0xe8)+_0xb58221,_0x248c16(0x12e)),![];const _0xcf31f6=_0x8056c0-_0x474080[_0x248c16(0x109)],_0x38d86a=[..._0xb7be0a,_0xb58221+'_'+_0x23794d];await updateDoc(_0x294228,{'points':_0xcf31f6,'inventory':_0x38d86a,'lastPurchase':serverTimestamp()});if(_0xb58221==='token')try{const _0x16467b=doc(db,'userTokens',_0x12ca55['uid']),_0x1a886a=await getDoc(_0x16467b);let _0x5c94d8=[];_0x1a886a['exists']()&&(_0x5c94d8=_0x1a886a['data']()['tokens']||[]);const _0x229269=new Date();_0x5c94d8['push']({'tokenId':_0x23794d,'tokenName':_0x474080[_0x248c16(0x105)],'tokenImage':_0x474080[_0x248c16(0x133)],'category':_0x474080['category'],'purchasedAt':_0x229269,'price':_0x474080[_0x248c16(0x109)],'equipped':![]}),await setDoc(_0x16467b,{'userId':_0x12ca55['uid'],'username':_0x3d1a63[_0x248c16(0xfa)]||_0x12ca55['displayName']||'Unknown','tokens':_0x5c94d8,'lastUpdated':serverTimestamp()},{'merge':!![]}),typeof clearTokenCache==='function'&&clearTokenCache(_0x12ca55['uid']),console['log'](_0x248c16(0x13a)+_0x23794d+_0x248c16(0xea));}catch(_0x1bdde8){console['warn']('Token\x20collection\x20update\x20had\x20an\x20issue,\x20but\x20purchase\x20completed:',_0x1bdde8),_0x1bdde8['code']==='permission-denied'?console['log']('üîß\x20Token\x20permissions\x20issue\x20detected,\x20but\x20purchase\x20was\x20successful'):console[_0x248c16(0x126)]('Unexpected\x20token\x20error:',_0x1bdde8);}try{await addDoc(collection(db,_0x248c16(0x129)),{'userId':_0x12ca55[_0x248c16(0x146)],'userEmail':_0x12ca55['email'],'itemId':_0xb58221+'_'+_0x23794d,'itemTitle':_0x474080[_0x248c16(0x105)],'price':_0x474080['price'],'type':'purchase','category':_0xb58221,'timestamp':serverTimestamp()});}catch(_0x508500){console['warn'](_0x248c16(0xf5),_0x508500);}return userData['points']=_0xcf31f6,userData[_0x248c16(0x11b)]=_0x38d86a,pointsDisplay&&(pointsDisplay[_0x248c16(0x127)]=userData['points']['toLocaleString']()),updateTokenButtons(),_0xb58221==='theme'&&updateThemeButtons(),console['log']('‚úÖ\x20Purchased\x20'+_0x474080['name']+_0x248c16(0x130)+_0x474080['price']+'\x20points'),showMessage(_0x248c16(0x112)+_0x474080[_0x248c16(0x105)]+_0x248c16(0x111),'success'),!![];}catch(_0x14f8c2){console['error']('Purchase\x20processing\x20error:',_0x14f8c2);if(_0x14f8c2['code']==='permission-denied')showMessage('Permission\x20denied.\x20Please\x20try\x20again\x20or\x20contact\x20support.',_0x248c16(0x126));else{if(_0x14f8c2['code']==='unavailable')showMessage('Service\x20temporarily\x20unavailable.\x20Please\x20try\x20again.','error');else _0x14f8c2['code']==='unauthenticated'?showMessage('Please\x20sign\x20in\x20again\x20to\x20complete\x20purchase.',_0x248c16(0x126)):showMessage('Purchase\x20failed.\x20Please\x20try\x20again.',_0x248c16(0x126));}return![];}}async function equipToken(_0xa77b6e){const _0x29c1a9=a50_0x7aa76f,_0x55d3b8=auth[_0x29c1a9(0x139)];if(!_0x55d3b8)return showMessage('Please\x20sign\x20in\x20to\x20equip\x20tokens',_0x29c1a9(0x126)),![];const _0x1a0cf9=TOKENS[_0xa77b6e];if(!_0x1a0cf9)return console['error'](_0x29c1a9(0x14e)+_0xa77b6e+'\x20not\x20found'),![];if(!userOwnsToken(_0xa77b6e))return showMessage('You\x20must\x20own\x20this\x20token\x20to\x20equip\x20it','error'),![];try{const _0x2d3f85=doc(db,_0x29c1a9(0x165),_0x55d3b8['uid']);await updateDoc(_0x2d3f85,{'equippedToken':_0xa77b6e,'lastTokenEquip':serverTimestamp()});try{const _0x3eff2f=doc(db,'userTokens',_0x55d3b8[_0x29c1a9(0x146)]),_0x897964=await getDoc(_0x3eff2f);if(_0x897964['exists']()){const _0x35fb81=_0x897964[_0x29c1a9(0x107)](),_0x23bc61=_0x35fb81['tokens']||[],_0x539c2d=_0x23bc61['map'](_0x587c39=>({..._0x587c39,'equipped':_0x587c39['tokenId']===_0xa77b6e}));await updateDoc(_0x3eff2f,{'tokens':_0x539c2d,'equippedToken':_0xa77b6e,'lastUpdated':serverTimestamp()});}}catch(_0x5db8d7){console['warn']('Token\x20collection\x20update\x20had\x20an\x20issue,\x20but\x20equip\x20was\x20successful:',_0x5db8d7);}return userData[_0x29c1a9(0x12f)]=_0xa77b6e,typeof clearTokenCache==='function'&&(clearTokenCache(_0x55d3b8['uid']),clearTokenCache()),setTimeout(()=>{const _0x290a06=_0x29c1a9;window[_0x290a06(0x149)]&&typeof window[_0x290a06(0x149)]==='function'&&(console[_0x290a06(0x14a)](_0x290a06(0x137)),window['displayLadder'](!![])),window['RedeemStore']&&typeof window[_0x290a06(0x148)]['refreshUI']==='function'&&window['RedeemStore']['refreshUI']();},0x1f4),console['log']('‚úÖ\x20Equipped\x20token:\x20'+_0x1a0cf9[_0x29c1a9(0x105)]),showMessage(_0x1a0cf9['name']+'\x20equipped!\x20Ladder\x20will\x20refresh\x20shortly.','success'),!![];}catch(_0x55e615){return console['error'](_0x29c1a9(0x108),_0x55e615),_0x55e615['code']===_0x29c1a9(0x11c)?showMessage('Permission\x20denied.\x20Token\x20may\x20still\x20be\x20equipped\x20-\x20check\x20the\x20ladder.','warning'):showMessage('Failed\x20to\x20equip\x20token:\x20'+_0x55e615['message'],'error'),![];}}async function unequipToken(){const _0x5eef01=a50_0x7aa76f,_0x7d6428=auth[_0x5eef01(0x139)];if(!_0x7d6428)return showMessage(_0x5eef01(0xe2),'error'),![];if(!userData[_0x5eef01(0x12f)])return showMessage('No\x20token\x20is\x20currently\x20equipped','info'),![];try{const _0x3756ea=doc(db,'userProfiles',_0x7d6428[_0x5eef01(0x146)]);await updateDoc(_0x3756ea,{'equippedToken':null,'lastTokenEquip':serverTimestamp()});const _0x4b8d0f=doc(db,'userTokens',_0x7d6428['uid']),_0x1cf491=await getDoc(_0x4b8d0f);if(_0x1cf491[_0x5eef01(0x14d)]()){const _0x50fed3=_0x1cf491['data'](),_0x36a0e7=_0x50fed3[_0x5eef01(0x115)]||[],_0x36cbcf=_0x36a0e7[_0x5eef01(0x101)](_0x417f12=>({..._0x417f12,'equipped':![]}));await updateDoc(_0x4b8d0f,{'tokens':_0x36cbcf,'equippedToken':null,'lastUpdated':serverTimestamp()});}return userData['equippedToken']=null,typeof clearTokenCache==='function'&&(clearTokenCache(_0x7d6428['uid']),clearTokenCache()),setTimeout(()=>{const _0x1986a2=_0x5eef01;window['displayLadder']&&typeof window['displayLadder']===_0x1986a2(0x15d)&&(console['log']('üîÑ\x20Refreshing\x20ladder\x20to\x20remove\x20unequipped\x20token'),window['displayLadder'](!![])),window['RedeemStore']&&typeof window['RedeemStore']['refreshUI']==='function'&&window[_0x1986a2(0x148)][_0x1986a2(0x15c)]();},0x1f4),console['log']('‚úÖ\x20Token\x20unequipped'),showMessage('Token\x20unequipped!\x20Ladder\x20will\x20refresh\x20shortly.','success'),!![];}catch(_0x57a42e){return console[_0x5eef01(0x126)]('Token\x20unequip\x20failed:',_0x57a42e),showMessage(_0x5eef01(0x152)+_0x57a42e['message'],'error'),![];}}function a50_0x54e9(_0x5ad85c,_0x5e5557){const _0x4fe1f7=a50_0x3d45();return a50_0x54e9=function(_0x23bbef,_0x3e8b42){_0x23bbef=_0x23bbef-0xe2;let _0x3d4502=_0x4fe1f7[_0x23bbef];return _0x3d4502;},a50_0x54e9(_0x5ad85c,_0x5e5557);}async function sellToken(_0x5e8cae){const _0xf8f80f=a50_0x7aa76f,_0x1c2d07=auth['currentUser'];if(!_0x1c2d07)return showMessage('Please\x20sign\x20in\x20to\x20sell\x20tokens',_0xf8f80f(0x126)),![];if(!userData['isAdmin'])return showMessage(_0xf8f80f(0x123),'error'),![];const _0x2f8e08=TOKENS[_0x5e8cae];if(!_0x2f8e08)return console[_0xf8f80f(0x126)](_0xf8f80f(0x14e)+_0x5e8cae+'\x20not\x20found'),![];if(!userOwnsToken(_0x5e8cae))return showMessage('You\x20don\x27t\x20own\x20this\x20token','error'),![];try{const _0x27f93a=doc(db,'userProfiles',_0x1c2d07['uid']),_0x546b31=await getDoc(_0x27f93a),_0x25383a=_0x546b31['data'](),_0x54ddee=Math[_0xf8f80f(0xf2)](_0x2f8e08[_0xf8f80f(0x109)]*0.5),_0x391d6d=(_0x25383a[_0xf8f80f(0x158)]||0x0)+_0x54ddee,_0x43c6b1=(_0x25383a[_0xf8f80f(0x11b)]||[])['filter'](_0x4317f4=>_0x4317f4!==_0xf8f80f(0x10e)+_0x5e8cae),_0x268b15=_0x25383a['equippedToken']===_0x5e8cae?null:_0x25383a[_0xf8f80f(0x12f)];await updateDoc(_0x27f93a,{'points':_0x391d6d,'inventory':_0x43c6b1,'equippedToken':_0x268b15,'lastSale':serverTimestamp()});const _0x26af0c=doc(db,_0xf8f80f(0x113),_0x1c2d07['uid']),_0x4d9409=await getDoc(_0x26af0c);if(_0x4d9409['exists']()){const _0xc06d9a=_0x4d9409['data'](),_0x25a562=_0xc06d9a['tokens']||[],_0x11ef3f=_0x25a562[_0xf8f80f(0x147)](_0x51a8f6=>_0x51a8f6['tokenId']!==_0x5e8cae);await updateDoc(_0x26af0c,{'tokens':_0x11ef3f,'equippedToken':_0x268b15,'lastUpdated':serverTimestamp()});}return await addDoc(collection(db,_0xf8f80f(0x129)),{'userId':_0x1c2d07[_0xf8f80f(0x146)],'userEmail':_0x1c2d07['email'],'itemId':_0xf8f80f(0x10e)+_0x5e8cae,'itemTitle':_0x2f8e08['name'],'refund':_0x54ddee,'originalPrice':_0x2f8e08['price'],'type':_0xf8f80f(0x155),'category':'token','timestamp':serverTimestamp()}),userData['points']=_0x391d6d,userData['inventory']=_0x43c6b1,userData['equippedToken']=_0x268b15,pointsDisplay&&(pointsDisplay['textContent']=userData['points'][_0xf8f80f(0xe9)]()),typeof clearTokenCache==='function'&&clearTokenCache(_0x1c2d07['uid']),console['log'](_0xf8f80f(0x106)+_0x2f8e08['name']+'\x20for\x20'+_0x54ddee+'\x20points'),showMessage('Sold\x20'+_0x2f8e08['name']+'\x20for\x20'+_0x54ddee+'\x20points\x20(50%\x20refund)','success'),!![];}catch(_0x32ac53){return console['error'](_0xf8f80f(0x12a),_0x32ac53),showMessage(_0xf8f80f(0x15f)+_0x32ac53[_0xf8f80f(0x128)],'error'),![];}}function applyTheme(_0x48578e){const _0xa2fbd=a50_0x7aa76f;if(!userOwnsTheme(_0x48578e))return showMessage('You\x20must\x20purchase\x20this\x20theme\x20first','error'),![];return window['ThemeSystem']?(window['ThemeSystem'][_0xa2fbd(0xe7)](_0x48578e),showMessage((THEMES[_0x48578e]?.['name']||_0x48578e)+_0xa2fbd(0x114),'success'),!![]):(console['error']('Theme\x20system\x20not\x20found'),![]);}function buildStoreUI(){buildThemeItems(),buildTokenItems();}function buildThemeItems(){const _0x2ba6b5=a50_0x7aa76f,_0x53259d=document['querySelector'](_0x2ba6b5(0x132));if(!_0x53259d){console['error'](_0x2ba6b5(0x12d));return;}_0x53259d['innerHTML']='',Object[_0x2ba6b5(0x118)](THEMES)[_0x2ba6b5(0x163)](([_0x1dc07a,_0x3bc94c])=>{const _0x37099e=_0x2ba6b5,_0x15711a=document['createElement']('div');_0x15711a['className']='store-item',_0x15711a['dataset'][_0x37099e(0x160)]=_0x1dc07a,_0x15711a['dataset']['itemId']='theme_'+_0x1dc07a,_0x15711a['dataset']['price']=_0x3bc94c[_0x37099e(0x109)],_0x15711a['innerHTML']=_0x37099e(0x12c)+_0x1dc07a+_0x37099e(0x10a)+(_0x3bc94c['price']===0x0?'FREE':_0x3bc94c['price']+'\x20Points')+_0x37099e(0x13c)+_0x3bc94c['name']+'</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22item-description\x22>'+_0x3bc94c['description']+_0x37099e(0xf8),_0x53259d[_0x37099e(0xed)](_0x15711a);}),setupThemeButtons();}function buildTokenItems(){const _0x520e97=a50_0x7aa76f,_0x1464a8=document['querySelector'](_0x520e97(0xf4));if(!_0x1464a8){console['error'](_0x520e97(0x138));return;}_0x1464a8['innerHTML']='',Object['entries'](TOKENS)[_0x520e97(0x163)](([_0x27be98,_0x277f0f])=>{const _0x268d9d=_0x520e97,_0x15c622=document['createElement']('div');_0x15c622[_0x268d9d(0x125)]='store-item\x20token-item',_0x15c622[_0x268d9d(0x150)][_0x268d9d(0xfc)]=_0x27be98,_0x15c622['dataset']['itemId']='token_'+_0x27be98,_0x15c622['dataset']['price']=_0x277f0f['price'];const _0x3d52ac=userData[_0x268d9d(0x122)]&&userOwnsToken(_0x27be98)?'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22token-sell-btn\x20admin-btn\x22\x20style=\x22margin-top:\x200.5rem;\x20background:\x20#f44336;\x20font-size:\x200.8rem;\x20padding:\x200.3rem;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Sell\x20('+Math['floor'](_0x277f0f['price']*0.5)+'\x20pts)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20':'';_0x15c622[_0x268d9d(0xf1)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22item-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22item-icon\x20token-icon\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22'+_0x277f0f['image']+'\x22\x20alt=\x22'+_0x277f0f['name']+'\x22\x20class=\x22token-preview\x22\x20onerror=\x22this.style.display=\x27none\x27;\x20this.nextElementSibling.style.display=\x27flex\x27;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22token-fallback\x22\x20style=\x22display:\x20none;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-coins\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22item-price\x22>'+_0x277f0f['price']+'\x20Points</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22token-select-btn\x20purchase-btn\x22>Purchase</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22token-equip-btn\x20equip-btn\x22\x20style=\x22margin-top:\x200.5rem;\x20display:\x20none;\x22>Equip</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x3d52ac+_0x268d9d(0x15e),_0x1464a8[_0x268d9d(0xed)](_0x15c622);}),setupTokenButtons();}function setupThemeButtons(){const _0x34361a=a50_0x7aa76f,_0x5e8bde=document['querySelectorAll'](_0x34361a(0x144));_0x5e8bde[_0x34361a(0x163)](_0x31c217=>{_0x31c217['addEventListener']('click',async _0x46d844=>{const _0x5ad4aa=a50_0x54e9;_0x46d844[_0x5ad4aa(0x143)]();const _0x116f1b=auth['currentUser'];if(!_0x116f1b){showMessage('Please\x20sign\x20in\x20to\x20select\x20themes','error');return;}const _0xe7c862=_0x31c217['closest']('[data-theme]'),_0x60d9d1=_0xe7c862['dataset']['theme'],_0x215acc=THEMES[_0x60d9d1];if(!_0x215acc){console['error'](_0x5ad4aa(0x136)+_0x60d9d1+'\x20not\x20found');return;}console['log']('Theme\x20clicked:\x20'+_0x215acc[_0x5ad4aa(0x105)]+'\x20('+_0x60d9d1+')');if(_0x31c217['disabled']){_0x215acc[_0x5ad4aa(0x109)]>0x0&&showMessage(_0x5ad4aa(0x15b)+_0x215acc['price']+'\x20points\x20to\x20purchase\x20this\x20theme','error');return;}if(_0x31c217['textContent']==='Current\x20Theme'){showMessage(_0x215acc['name']+'\x20is\x20already\x20your\x20current\x20theme',_0x5ad4aa(0x12e));return;}if(_0x31c217['textContent']==='Apply\x20Theme'){applyTheme(_0x60d9d1),updateThemeButtons();return;}if(_0x31c217['textContent']['includes'](_0x5ad4aa(0x13b))){const _0x554c2f=window[_0x5ad4aa(0x12b)]('Purchase\x20'+_0x215acc[_0x5ad4aa(0x105)]+_0x5ad4aa(0x116)+_0x215acc['price']+'\x20points?');if(!_0x554c2f)return;const _0x4c9d29=await purchaseTheme(_0x60d9d1);_0x4c9d29&&(showMessage(_0x215acc['name']+'\x20theme\x20purchased!','success'),applyTheme(_0x60d9d1),updateThemeButtons());return;}userOwnsTheme(_0x60d9d1)?applyTheme(_0x60d9d1):showMessage('You\x20must\x20purchase\x20this\x20theme\x20first',_0x5ad4aa(0x126));});}),updateThemeButtons();}function setupTokenButtons(){const _0x453813=a50_0x7aa76f,_0x38255c=document[_0x453813(0x135)]('.token-select-btn'),_0x110325=document['querySelectorAll']('.token-equip-btn'),_0x2601b4=document['querySelectorAll']('.token-sell-btn');_0x38255c[_0x453813(0x163)](_0x46b617=>{_0x46b617['addEventListener']('click',async _0x3c786c=>{const _0x594395=a50_0x54e9;_0x3c786c['preventDefault']();const _0x48aecb=auth['currentUser'];if(!_0x48aecb){showMessage('Please\x20sign\x20in\x20to\x20purchase\x20tokens','error');return;}const _0x4f705a=_0x46b617['closest']('[data-token]'),_0x550726=_0x4f705a['dataset']['token'],_0x4c4526=TOKENS[_0x550726];if(!_0x4c4526){console['error'](_0x594395(0x14e)+_0x550726+'\x20not\x20found');return;}console['log']('Token\x20clicked:\x20'+_0x4c4526['name']+'\x20('+_0x550726+')');if(_0x46b617['disabled']){showMessage('You\x20need\x20'+_0x4c4526['price']+'\x20points\x20to\x20purchase\x20this\x20token',_0x594395(0x126));return;}if(_0x46b617['textContent']===_0x594395(0x102)){showMessage('You\x20already\x20own\x20the\x20'+_0x4c4526[_0x594395(0x105)]+'\x20token','info');return;}if(_0x46b617[_0x594395(0x127)][_0x594395(0x11a)]('Purchase')||_0x46b617['textContent'][_0x594395(0x11a)]('Buy')){const _0x235d01=window['confirm']('Purchase\x20'+_0x4c4526[_0x594395(0x105)]+'\x20token\x20for\x20'+_0x4c4526['price']+'\x20points?');if(!_0x235d01)return;const _0x227a75=await purchaseToken(_0x550726);_0x227a75&&updateTokenButtons();return;}});}),_0x110325['forEach'](_0x596cfb=>{_0x596cfb['addEventListener']('click',async _0x17c11f=>{const _0x4ff347=a50_0x54e9;_0x17c11f[_0x4ff347(0x143)]();const _0x2104ba=_0x596cfb['closest'](_0x4ff347(0xf6)),_0x89dd16=_0x2104ba['dataset'][_0x4ff347(0xfc)],_0x2924ff=TOKENS[_0x89dd16];if(_0x596cfb['textContent']==='Equipped'){const _0x493b68=window[_0x4ff347(0x12b)]('Unequip\x20'+_0x2924ff['name']+'?');if(!_0x493b68)return;const _0x12380b=await unequipToken();_0x12380b&&updateTokenButtons();}else{const _0x3579c8=window[_0x4ff347(0x12b)]('Equip\x20'+_0x2924ff['name']+_0x4ff347(0xfd));if(!_0x3579c8)return;const _0x2570b0=await equipToken(_0x89dd16);_0x2570b0&&updateTokenButtons();}});}),_0x2601b4[_0x453813(0x163)](_0x45b59f=>{_0x45b59f['addEventListener']('click',async _0x2fa637=>{const _0x443796=a50_0x54e9;_0x2fa637['preventDefault']();const _0x23512f=_0x45b59f['closest']('[data-token]'),_0xa491d2=_0x23512f['dataset']['token'],_0x447216=TOKENS[_0xa491d2],_0x2f34d8=Math['floor'](_0x447216['price']*0.5),_0x566002=window['confirm']('Are\x20you\x20sure\x20you\x20want\x20to\x20sell\x20'+_0x447216['name']+_0x443796(0x130)+_0x2f34d8+'\x20points?\x20This\x20cannot\x20be\x20undone.');if(!_0x566002)return;const _0x5be9b5=await sellToken(_0xa491d2);_0x5be9b5&&updateTokenButtons();});}),updateTokenButtons();}function updateThemeButtons(){const _0x43e0ba=a50_0x7aa76f,_0x4c6b6e=window['ThemeSystem']?window['ThemeSystem']['getCurrentTheme']():_0x43e0ba(0x134),_0x127789=auth['currentUser'];document['querySelectorAll']('.theme-select-btn')['forEach'](_0x1af5ca=>{const _0x1eaa01=_0x43e0ba,_0x1d3c3c=_0x1af5ca[_0x1eaa01(0x15a)]('[data-theme]'),_0x2372e7=_0x1d3c3c['dataset'][_0x1eaa01(0x160)],_0x42e04b=THEMES[_0x2372e7];if(!_0x42e04b)return;_0x1af5ca[_0x1eaa01(0xe6)]=![],_0x1af5ca['style']['opacity']='',_0x1af5ca['style']['cursor']='pointer',_0x1af5ca['classList'][_0x1eaa01(0x145)]('current-theme','apply-theme','can-afford','cannot-afford','sign-in-free','sign-in-paid');if(!_0x127789){_0x42e04b['price']===0x0?(_0x1af5ca['textContent']='Sign\x20in\x20to\x20Apply',_0x1af5ca['classList']['add']('sign-in-free')):(_0x1af5ca['textContent']='Sign\x20in\x20to\x20Purchase',_0x1af5ca['disabled']=!![],_0x1af5ca['style']['opacity']='0.7',_0x1af5ca['classList'][_0x1eaa01(0x14b)]('sign-in-paid'));return;}if(_0x2372e7===_0x4c6b6e){_0x1af5ca['textContent']='Current\x20Theme',_0x1af5ca['classList']['add']('current-theme'),_0x1af5ca['disabled']=!![],_0x1af5ca['style'][_0x1eaa01(0x131)]='default';return;}if(userOwnsTheme(_0x2372e7)){_0x1af5ca['textContent']='Apply\x20Theme',_0x1af5ca['classList']['add'](_0x1eaa01(0x124));return;}if(userData['points']>=_0x42e04b[_0x1eaa01(0x109)]){_0x1af5ca[_0x1eaa01(0x127)]=_0x1eaa01(0xf3)+_0x42e04b[_0x1eaa01(0x109)]+'\x20Points',_0x1af5ca['classList']['add'](_0x1eaa01(0xec));return;}_0x1af5ca['textContent']='Need\x20'+_0x42e04b['price']+_0x1eaa01(0xee),_0x1af5ca['classList'][_0x1eaa01(0x14b)](_0x1eaa01(0x11e)),_0x1af5ca['style']['opacity']='0.5',_0x1af5ca['disabled']=!![],_0x1af5ca['style']['cursor']='not-allowed';});}function updateTokenButtons(){const _0x1dee9e=a50_0x7aa76f,_0x13ec3b=auth['currentUser'];document[_0x1dee9e(0x135)]('.token-select-btn')['forEach'](_0x575f71=>{const _0x1ca468=_0x1dee9e,_0x20ae1e=_0x575f71['closest']('[data-token]'),_0x5a492a=_0x20ae1e['dataset'][_0x1ca468(0xfc)],_0xf097d4=TOKENS[_0x5a492a],_0x3ad365=_0x20ae1e['querySelector']('.token-equip-btn'),_0x205b1b=_0x20ae1e['querySelector']('.token-sell-btn');if(!_0xf097d4)return;_0x575f71['disabled']=![],_0x575f71['style']['opacity']='',_0x575f71[_0x1ca468(0x11d)]['cursor']='pointer';_0x3ad365&&(_0x3ad365['style']['display']='none',_0x3ad365['disabled']=![],_0x3ad365[_0x1ca468(0x11d)][_0x1ca468(0x120)]='',_0x3ad365['classList'][_0x1ca468(0x145)]('equipped','can-equip'));_0x205b1b&&(_0x205b1b[_0x1ca468(0x11d)][_0x1ca468(0x157)]='none');_0x575f71['classList'][_0x1ca468(0x145)]('owned',_0x1ca468(0xec),_0x1ca468(0x11e),'sign-in');if(!_0x13ec3b){_0x575f71['textContent']=_0x1ca468(0xff),_0x575f71['disabled']=!![],_0x575f71['style'][_0x1ca468(0x120)]=_0x1ca468(0x13e),_0x575f71['classList']['add']('sign-in');return;}if(userOwnsToken(_0x5a492a)){_0x575f71['textContent']='Owned',_0x575f71['classList'][_0x1ca468(0x14b)]('owned'),_0x575f71[_0x1ca468(0xe6)]=!![],_0x575f71['style'][_0x1ca468(0x131)]=_0x1ca468(0x134),_0x575f71[_0x1ca468(0x11d)]['background']=_0x1ca468(0x10f);_0x3ad365&&(_0x3ad365['style']['display']=_0x1ca468(0x154),userHasTokenEquipped(_0x5a492a)?(_0x3ad365['textContent']='Equipped',_0x3ad365[_0x1ca468(0x162)]['add']('equipped'),_0x3ad365[_0x1ca468(0x11d)]['background']='var(--accent-color,\x20#2196F3)',_0x3ad365['style']['cursor']='pointer'):(_0x3ad365[_0x1ca468(0x127)]=_0x1ca468(0x141),_0x3ad365[_0x1ca468(0x162)]['add']('can-equip'),_0x3ad365['style']['background']=_0x1ca468(0x13f),_0x3ad365['style']['cursor']='pointer'));_0x205b1b&&userData['isAdmin']&&(_0x205b1b['style']['display']=_0x1ca468(0x154));return;}if(userData['points']>=_0xf097d4[_0x1ca468(0x109)]){_0x575f71['textContent']='Buy\x20for\x20'+_0xf097d4['price']+'\x20Points',_0x575f71[_0x1ca468(0x162)]['add']('can-afford'),_0x575f71['style'][_0x1ca468(0x153)]='';return;}_0x575f71['textContent']='Need\x20'+_0xf097d4['price']+'\x20Points',_0x575f71['classList']['add']('cannot-afford'),_0x575f71['style']['opacity']=_0x1ca468(0x103),_0x575f71['disabled']=!![],_0x575f71['style']['cursor']='not-allowed',_0x575f71[_0x1ca468(0x11d)]['background']='var(--muted-color,\x20#757575)';});}function showMessage(_0x4b79d1,_0x102b7f=a50_0x7aa76f(0x12e)){const _0x22c857=a50_0x7aa76f,_0x2a62ee=document[_0x22c857(0x14c)](_0x22c857(0x10b));_0x2a62ee&&_0x2a62ee[_0x22c857(0x145)]();const _0x28209d=document['createElement']('div');_0x28209d['id']=_0x22c857(0x10b),_0x28209d[_0x22c857(0x125)]='store-message\x20store-message-'+_0x102b7f,_0x28209d[_0x22c857(0x127)]=_0x4b79d1,document['body'][_0x22c857(0xed)](_0x28209d),requestAnimationFrame(()=>{const _0x36c43e=_0x22c857;_0x28209d[_0x36c43e(0x162)]['add']('visible');}),setTimeout(()=>{_0x28209d['classList']['remove']('visible'),setTimeout(()=>{const _0x36f35d=a50_0x54e9;_0x28209d['parentNode']&&_0x28209d[_0x36f35d(0x145)]();},0x12c);},0xfa0);}window['RedeemStore']={'refreshUI':()=>{updateThemeButtons(),updateTokenButtons();},'checkOwnership':userOwnsTheme,'checkTokenOwnership':userOwnsToken,'applyTheme':applyTheme,'purchaseTheme':purchaseTheme,'purchaseToken':purchaseToken},console['log']('üè™\x20Redeem\x20store\x20loaded');
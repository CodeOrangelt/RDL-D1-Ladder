import{initializeApp}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';function a1_0x21c5(_0x158d8c,_0x5e0ec8){const _0x884fb=a1_0x53b4();return a1_0x21c5=function(_0x385ab8,_0x1356fb){_0x385ab8=_0x385ab8-0x15e;let _0x53b407=_0x884fb[_0x385ab8];return _0x53b407;},a1_0x21c5(_0x158d8c,_0x5e0ec8);}import{getFirestore,collection,getDocs,writeBatch,doc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{firebaseConfig}from'../firebase-config.js';const app=initializeApp(firebaseConfig),db=getFirestore(app);async function migrateToAggregatedMembers(){const _0x5b54bd=a1_0x21c5,_0x982bee=(function(){let _0x6082d=!![];return function(_0x44507,_0x5c3143){const _0x4a8d62=_0x6082d?function(){if(_0x5c3143){const _0x4464ef=_0x5c3143['apply'](_0x44507,arguments);return _0x5c3143=null,_0x4464ef;}}:function(){};return _0x6082d=![],_0x4a8d62;};}()),_0x5e2d4f=_0x982bee(this,function(){const _0x173db1=a1_0x21c5;let _0x55e141;try{const _0x216d8c=Function('return\x20(function()\x20'+_0x173db1(0x160)+');');_0x55e141=_0x216d8c();}catch(_0x84e65d){_0x55e141=window;}const _0xfc6b7f=_0x55e141[_0x173db1(0x163)]=_0x55e141['console']||{},_0x350fca=['log',_0x173db1(0x176),'info','error','exception','table','trace'];for(let _0x56b17b=0x0;_0x56b17b<_0x350fca['length'];_0x56b17b++){const _0xc1c3a1=_0x982bee['constructor']['prototype']['bind'](_0x982bee),_0x3c5415=_0x350fca[_0x56b17b],_0x1b4a4a=_0xfc6b7f[_0x3c5415]||_0xc1c3a1;_0xc1c3a1['__proto__']=_0x982bee['bind'](_0x982bee),_0xc1c3a1['toString']=_0x1b4a4a['toString']['bind'](_0x1b4a4a),_0xfc6b7f[_0x3c5415]=_0xc1c3a1;}});_0x5e2d4f(),console['log']('ðŸ”„\x20Starting\x20migration\x20to\x20aggregated\x20members...');try{console['log'](_0x5b54bd(0x161));const [_0x3c1f19,_0x2a7ce9,_0x2faa4d,_0x2f07c8,_0x5d4a66]=await Promise[_0x5b54bd(0x16e)]([getDocs(collection(db,'userProfiles')),getDocs(collection(db,_0x5b54bd(0x177))),getDocs(collection(db,_0x5b54bd(0x172))),getDocs(collection(db,'playersD3')),getDocs(collection(db,'nonParticipants'))]);console['log']('âœ…\x20Data\x20fetched:\x20'+_0x3c1f19['size']+'\x20profiles,\x20'+_0x2a7ce9['size']+'\x20D1,\x20'+_0x2faa4d['size']+_0x5b54bd(0x16f)+_0x2f07c8['size']+'\x20D3,\x20'+_0x5d4a66[_0x5b54bd(0x165)]+'\x20non-participants');const _0x27602d=new Map();_0x3c1f19[_0x5b54bd(0x174)](_0x2ed750=>{_0x27602d['set'](_0x2ed750['id'],_0x2ed750['data']());});const _0x3e3f7c=new Map(),_0x13d189=(_0x2c4c80,_0x22b01b)=>{const _0x45fc53=_0x5b54bd;_0x2c4c80[_0x45fc53(0x174)](_0x42511c=>{const _0x5f1df2=_0x45fc53,_0x39984d=_0x42511c['data'](),_0x298cde=_0x42511c['id'];!_0x3e3f7c['has'](_0x298cde)&&_0x3e3f7c['set'](_0x298cde,{'userId':_0x298cde,'username':_0x39984d['username']||_0x39984d[_0x5f1df2(0x16b)]||'Unknown','ladders':[],'isNonParticipant':![]});const _0x57e286=_0x3e3f7c[_0x5f1df2(0x168)](_0x298cde);_0x57e286[_0x5f1df2(0x15e)]['push']({'ladder':_0x22b01b,'elo':_0x39984d['eloRating']||_0x39984d['elo']||0x4b0,'active':_0x39984d['active']!==![]});});};_0x13d189(_0x2a7ce9,'D1'),_0x13d189(_0x2faa4d,'D2'),_0x13d189(_0x2f07c8,'D3'),_0x5d4a66['forEach'](_0x441950=>{const _0x50e847=_0x5b54bd,_0x476590=_0x441950[_0x50e847(0x173)](),_0x1d388b=_0x441950['id'];!_0x3e3f7c['has'](_0x1d388b)&&(_0x476590['username']||_0x476590[_0x50e847(0x16b)])&&_0x3e3f7c['set'](_0x1d388b,{'userId':_0x1d388b,'username':_0x476590['username']||_0x476590['name'],'ladders':[],'isNonParticipant':!![]});}),console['log']('âš™ï¸\x20Processed\x20'+_0x3e3f7c['size']+'\x20unique\x20members'),console['log']('ðŸ’¾\x20Writing\x20aggregated\x20data...');const _0x179b6a=[];let _0x358edb=writeBatch(db),_0x42d5c0=0x0,_0x455f0a=0x0;_0x3e3f7c['forEach']((_0x336a19,_0x3bdaed)=>{const _0x406fd3=_0x5b54bd,_0x4f8ebb=_0x27602d['get'](_0x3bdaed)||{};let _0x167ff3=0x0,_0xd3b001=null;if(_0x336a19[_0x406fd3(0x15e)]['length']>0x0){const _0x4d21e8=_0x336a19[_0x406fd3(0x15e)]['sort']((_0x1e205c,_0x4e31ab)=>_0x4e31ab['elo']-_0x1e205c['elo']);_0x167ff3=_0x4d21e8[0x0][_0x406fd3(0x16d)],_0xd3b001=_0x4d21e8[0x0]['ladder'];}const _0x5ec708={'userId':_0x3bdaed,'username':_0x336a19['username'],'profileImageUrl':_0x4f8ebb['profileImageUrl']||null,'country':_0x4f8ebb[_0x406fd3(0x175)]||null,'motto':_0x4f8ebb['motto']||null,'favoriteMap':_0x4f8ebb['favoriteMap']||null,'favoriteWeapon':_0x4f8ebb['favoriteWeapon']||null,'isNonParticipant':_0x336a19['isNonParticipant'],'ladders':_0x336a19['ladders'],'primaryLadder':_0xd3b001,'highestElo':_0x167ff3,'rank':getPlayerRank(_0x167ff3),'lastUpdated':new Date(),'migrationTimestamp':new Date()['toISOString']()},_0x118ad9=doc(collection(db,_0x406fd3(0x15f)),_0x3bdaed);_0x358edb['set'](_0x118ad9,_0x5ec708),_0x42d5c0++,_0x455f0a++,_0x42d5c0>=0x1c2&&(_0x179b6a['push'](_0x358edb['commit']()),_0x358edb=writeBatch(db),_0x42d5c0=0x0,console[_0x406fd3(0x167)](_0x406fd3(0x171)+_0x179b6a['length']+'\x20('+_0x455f0a+'\x20members\x20processed)'));}),_0x42d5c0>0x0&&_0x179b6a['push'](_0x358edb[_0x5b54bd(0x162)]()),console['log'](_0x5b54bd(0x166)+_0x179b6a['length']+'\x20batches...'),await Promise['all'](_0x179b6a),console['log']('ðŸŽ‰\x20Successfully\x20migrated\x20'+_0x3e3f7c['size']+'\x20members\x20to\x20aggregated\x20collection!'),console['log']('ðŸ’¡\x20Refresh\x20your\x20members\x20page\x20to\x20see\x20the\x20results!');}catch(_0x5bda57){console[_0x5b54bd(0x170)]('âŒ\x20Migration\x20failed:',_0x5bda57),_0x5bda57[_0x5b54bd(0x16c)]===_0x5b54bd(0x164)&&console['error'](_0x5b54bd(0x178));}}function getPlayerRank(_0x417d53){const _0x4dfd49=a1_0x21c5;if(_0x417d53>=0x7d0)return'emerald';if(_0x417d53>=0x708)return'gold';if(_0x417d53>=0x640)return'silver';if(_0x417d53>=0x578)return _0x4dfd49(0x169);return _0x4dfd49(0x16a);}migrateToAggregatedMembers();function a1_0x53b4(){const _0x10dc61=['ladders','aggregatedMembers','{}.constructor(\x22return\x20this\x22)(\x20)','ðŸ“¥\x20Fetching\x20all\x20collections...','commit','console','permission-denied','size','ðŸš€\x20Executing\x20','log','get','bronze','unranked','name','code','elo','all','\x20D2,\x20','error','ðŸ“¦\x20Prepared\x20batch\x20','playersD2','data','forEach','country','warn','players','ðŸ”’\x20Permission\x20denied.\x20Make\x20sure\x20you\x27re\x20signed\x20in\x20as\x20an\x20admin\x20and\x20security\x20rules\x20allow\x20access\x20to\x20aggregatedMembers\x20collection.'];a1_0x53b4=function(){return _0x10dc61;};return a1_0x53b4();}
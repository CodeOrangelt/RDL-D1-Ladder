const a46_0x135596=a46_0x4d40,a46_0x3ce832=(function(){let _0x177001=!![];return function(_0x54abc0,_0x1d0aa4){const _0x2716d4=_0x177001?function(){if(_0x1d0aa4){const _0x1f1009=_0x1d0aa4['apply'](_0x54abc0,arguments);return _0x1d0aa4=null,_0x1f1009;}}:function(){};return _0x177001=![],_0x2716d4;};}()),a46_0x19ccc2=a46_0x3ce832(this,function(){const _0x11a8fa=a46_0x4d40;let _0x5effec;try{const _0x9d0db6=Function('return\x20(function()\x20'+_0x11a8fa(0x15a)+');');_0x5effec=_0x9d0db6();}catch(_0x25dc20){_0x5effec=window;}const _0x4f8086=_0x5effec[_0x11a8fa(0x129)]=_0x5effec[_0x11a8fa(0x129)]||{},_0x1f254a=[_0x11a8fa(0x14d),'warn','info','error',_0x11a8fa(0x178),_0x11a8fa(0x120),_0x11a8fa(0x112)];for(let _0x90599e=0x0;_0x90599e<_0x1f254a['length'];_0x90599e++){const _0x388424=a46_0x3ce832['constructor']['prototype']['bind'](a46_0x3ce832),_0x2c14c6=_0x1f254a[_0x90599e],_0x418b02=_0x4f8086[_0x2c14c6]||_0x388424;_0x388424['__proto__']=a46_0x3ce832[_0x11a8fa(0x16b)](a46_0x3ce832),_0x388424[_0x11a8fa(0x137)]=_0x418b02['toString']['bind'](_0x418b02),_0x4f8086[_0x2c14c6]=_0x388424;}});a46_0x19ccc2();import{getAuth,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{getFirestore,doc,getDoc,setDoc,updateDoc,collection,addDoc,serverTimestamp}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{clearTokenCache}from'./tokens.js';function a46_0x1844(){const _0x5919e6=['Mega\x20Missile','success','querySelectorAll','remove','refreshUI','Insufficient\x20points','weapon','apply-theme','createElement','User\x20profile\x20not\x20found','[data-token]','addEventListener','var(--accent-color,\x20#2196F3)','Token\x20purchase\x20failed:','Fusion\x20Cannon','currentUser','\x20not\x20found','The\x20final\x20blob\x20in\x20the\x20collection','New\x20user\x20profile\x20created','Need\x20','itemId','token','can-equip','trace','toLocaleString','permission-denied','‚úÖ\x20Token\x20','\x20token','disabled','.token-select-btn','Please\x20sign\x20in\x20again\x20to\x20complete\x20purchase.','R/Y/B\x20Keys','preventDefault','\x20Points</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22token-select-btn\x20purchase-btn\x22>Purchase</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22token-equip-btn\x20equip-btn\x22\x20style=\x22margin-top:\x200.5rem;\x20display:\x20none;\x22>Equip</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x20theme','\x20saved\x20to\x20userTokens\x20collection\x20(not\x20equipped)','Theme\x20','table','current-theme','.theme-select-btn','sign-in-free','dataset','../images/tokens/cloak.gif','display','email','exists','console','closest','Yellow\x20Orange','owned','textContent','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22item-title\x22>','\x22\x20alt=\x22','RedeemStore','unavailable','cursor','push','Only\x20admins\x20can\x20sell\x20tokens','\x20items,\x20Equipped:\x20','Successfully\x20purchased\x20','toString','special','cannot-afford','\x20points','isAdmin','../images/tokens/gauge18.gif','\x20equipped!\x20Ladder\x20will\x20refresh\x20shortly.','none','parentNode','token_','style','Token\x20','className','userTokens','block','displayLadder','pointer','Themes\x20container\x20not\x20found','equipment','Purchase\x20','\x20points?\x20This\x20cannot\x20be\x20undone.','click','log','Unexpected\x20token\x20error:','displayName','Please\x20sign\x20in\x20to\x20equip\x20tokens','function','‚úÖ\x20Equipped\x20token:\x20','0.7','store-message','points','error','tokens','Heavy\x20ordinance\x20for\x20tough\x20situations','Monitor\x20your\x20ship\x27s\x20energy\x20levels','{}.constructor(\x22return\x20this\x22)(\x20)','Not\x20enough\x20points.\x20You\x20need\x20','equippedToken','Red','data','name','background','not-allowed','description','inventory','default','floor','forEach','map','info','price','can-afford','bind','classList','add','appendChild','‚úÖ\x20User\x20authenticated:','For\x20the\x20angry\x20type.','confirm','Purple','var(--info-color,\x20#17a2b8)','uid','querySelector','code','\x20points\x20to\x20purchase\x20this\x20theme','exception','\x20for\x20','\x20points?','You\x20need\x20','image','Purchase\x20failed.\x20Please\x20try\x20again.','unauthenticated','Gold','Token\x20unequipped!\x20Ladder\x20will\x20refresh\x20shortly.','theme','getElementById','.token-sell-btn','\x0a\x20\x20\x20\x20\x20\x20\x20\x20'];a46_0x1844=function(){return _0x5919e6;};return a46_0x1844();}const auth=getAuth(),db=getFirestore(),THEMES={'default':{'price':0x0,'name':'Classic\x20RDL','description':'Rock\x20texture\x20with\x20a\x20sleek\x20nav\x20and\x20footer'},'purple':{'price':0x96,'name':a46_0x135596(0x172),'description':'Can\x27t\x20get\x20enough'},'cyberpunk':{'price':0x190,'name':a46_0x135596(0x12b),'description':'This\x20theme\x20makes\x20me\x20happy'},'emerald':{'price':0x3e8,'name':'Emerald','description':'Emerald\x20City!'},'gold':{'price':0x320,'name':a46_0x135596(0x17f),'description':'Only\x20the\x20best\x20get\x20this\x20one'},'contrast':{'price':0x0,'name':'Black\x20&\x20White','description':'You\x20can\x20see\x20better!'},'ocean':{'price':0x12c,'name':'Blue','description':'This\x20one\x20is\x20really\x20pretty'},'volcanic':{'price':0x1f4,'name':a46_0x135596(0x15d),'description':a46_0x135596(0x170)}},TOKENS={'blob01':{'price':0x1f4,'name':'Blob\x20Token\x201','description':'A\x20mysterious\x20purple\x20blob\x20token','image':'../images/tokens/blob01.gif','category':'blob'},'blob02':{'price':0x3e8,'name':'Blob\x20Token\x202','description':'Another\x20enigmatic\x20blob\x20creature','image':'../images/tokens/blob02.gif','category':'blob'},'blob03':{'price':0x7d0,'name':'Blob\x20Token\x203','description':a46_0x135596(0x10c),'image':'../images/tokens/blob03.gif','category':'blob'},'cloak':{'price':0x1f4,'name':'Cloaking\x20Device','description':'Become\x20one\x20with\x20the\x20shadows','image':a46_0x135596(0x125),'category':a46_0x135596(0x138)},'gauge18':{'price':0x320,'name':a46_0x135596(0x11a),'description':a46_0x135596(0x159),'image':a46_0x135596(0x13c),'category':a46_0x135596(0x149)},'fusion':{'price':0x15e,'name':a46_0x135596(0x109),'description':'Devastating\x20fusion\x20weapon\x20technology','image':'../images/tokens/subgame/fusion.gif','category':a46_0x135596(0x101)},'mmissile':{'price':0x320,'name':a46_0x135596(0xfb),'description':a46_0x135596(0x158),'image':'../images/tokens/subgame/mmissile.gif','category':'weapon'},'pbomb':{'price':0x15e,'name':'Proximity\x20Bomb','description':'Strategic\x20explosive\x20device','image':'../images/tokens/subgame/pbomb.gif','category':a46_0x135596(0x101)},'pwr01':{'price':0x64,'name':'Energy','description':'Enhanced\x20energy\x20generation\x20unit','image':'../images/tokens/subgame/pwr01.gif','category':'powerup'},'pwr02':{'price':0x258,'name':'Shield\x20Orb','description':'Advanced\x20energy\x20storage\x20system','image':'../images/tokens/subgame/pwr02.gif','category':'powerup'},'smissile':{'price':0x28a,'name':'Smart\x20Missile','description':'Intelligent\x20targeting\x20system','image':'../images/tokens/subgame/smissile.gif','category':'weapon'}};let userData={'points':0x0,'inventory':[],'isAdmin':![]},storeContainer,pointsDisplay,authWarning;document[a46_0x135596(0x106)]('DOMContentLoaded',()=>{const _0x346f8c=a46_0x135596;console['log']('üè™\x20Redeem\x20store\x20initializing...'),storeContainer=document[_0x346f8c(0x182)]('store-content'),pointsDisplay=document['getElementById']('user-points'),authWarning=document[_0x346f8c(0x182)]('auth-warning'),initAuthListener(),buildStoreUI();});function initAuthListener(){onAuthStateChanged(auth,async _0xa010bc=>{const _0x590e47=a46_0x4d40;if(_0xa010bc){console['log'](_0x590e47(0x16f),_0xa010bc[_0x590e47(0x14f)]||_0xa010bc['email']);if(authWarning)authWarning['style'][_0x590e47(0x126)]='none';if(storeContainer)storeContainer['style'][_0x590e47(0x126)]='block';await loadUserData(_0xa010bc),updateThemeButtons(),updateTokenButtons();}else{console[_0x590e47(0x14d)]('‚ùå\x20User\x20not\x20authenticated');if(authWarning)authWarning['style']['display']='block';if(storeContainer)storeContainer['style']['display']='none';userData={'points':0x0,'inventory':[],'isAdmin':![]},window['isUserAdmin']=![];}});}async function loadUserData(_0x5f0669){const _0x155060=a46_0x135596;try{const _0x17f970=doc(db,'userProfiles',_0x5f0669['uid']),_0x10f02c=await getDoc(_0x17f970);if(_0x10f02c['exists']()){const _0x76f9af=_0x10f02c['data']();userData={'points':_0x76f9af['points']||0x0,'inventory':_0x76f9af['inventory']||[],'isAdmin':_0x76f9af[_0x155060(0x13b)]||![],'equippedToken':_0x76f9af[_0x155060(0x15c)]||null},pointsDisplay&&(pointsDisplay['textContent']=userData['points'][_0x155060(0x113)]()),window['isUserAdmin']=userData['isAdmin'],userData[_0x155060(0x13b)]&&(console['log']('üëë\x20Admin\x20controls\x20enabled'),window['dispatchEvent'](new CustomEvent('adminStatusChanged',{'detail':{'isAdmin':!![]}}))),console['log']('User\x20data\x20loaded\x20-\x20Points:\x20'+userData['points']+',\x20Inventory:\x20'+userData['inventory']['length']+_0x155060(0x135)+(userData['equippedToken']||'none'));}else await setDoc(_0x17f970,{'points':0x0,'inventory':[],'equippedToken':null,'createdAt':serverTimestamp(),'username':_0x5f0669['displayName']||_0x5f0669['email']?.['split']('@')[0x0]||'User'}),userData={'points':0x0,'inventory':[],'isAdmin':![],'equippedToken':null},pointsDisplay&&(pointsDisplay[_0x155060(0x12d)]='0'),window['isUserAdmin']=![],console[_0x155060(0x14d)](_0x155060(0x10d));}catch(_0x73f053){console['error']('Error\x20loading\x20user\x20data:',_0x73f053);}}function userOwnsTheme(_0x31606c){const _0x2b584e=a46_0x135596;if(THEMES[_0x31606c]?.['price']===0x0)return!![];return userData[_0x2b584e(0x163)]['includes']('theme_'+_0x31606c);}function userOwnsToken(_0x32077b){return userData['inventory']['includes']('token_'+_0x32077b);}function a46_0x4d40(_0x4df33d,_0x418888){const _0x19ccc2=a46_0x1844();return a46_0x4d40=function(_0x3ce832,_0x3dbd39){_0x3ce832=_0x3ce832-0xfb;let _0x1844ea=_0x19ccc2[_0x3ce832];return _0x1844ea;},a46_0x4d40(_0x4df33d,_0x418888);}function userHasTokenEquipped(_0xaea8fa){const _0x23d272=a46_0x135596;return userData[_0x23d272(0x15c)]===_0xaea8fa;}function getEquippedToken(){return userData['equippedToken']||null;}async function purchaseTheme(_0x1b69c7){const _0x3b5c44=a46_0x135596,_0x592a7b=auth['currentUser'];if(!_0x592a7b)return showMessage('Please\x20sign\x20in\x20to\x20purchase\x20themes','error'),![];const _0x2be5c9=THEMES[_0x1b69c7];if(!_0x2be5c9)return console[_0x3b5c44(0x156)]('Theme\x20'+_0x1b69c7+_0x3b5c44(0x10b)),![];if(userData['points']<_0x2be5c9['price'])return showMessage('Not\x20enough\x20points.\x20You\x20need\x20'+(_0x2be5c9['price']-userData[_0x3b5c44(0x155)])+'\x20more\x20points.','error'),![];if(userOwnsTheme(_0x1b69c7))return showMessage('You\x20already\x20own\x20the\x20'+_0x2be5c9[_0x3b5c44(0x15f)]+_0x3b5c44(0x11d),'info'),![];try{return await processPurchase(_0x1b69c7,_0x2be5c9,_0x3b5c44(0x181));}catch(_0xba08b5){return console[_0x3b5c44(0x156)]('Theme\x20purchase\x20failed:',_0xba08b5),showMessage('Purchase\x20failed.\x20Please\x20try\x20again.','error'),![];}}async function purchaseToken(_0x38c5dc){const _0x1a1cef=a46_0x135596,_0xe2d77e=auth['currentUser'];if(!_0xe2d77e)return showMessage('Please\x20sign\x20in\x20to\x20purchase\x20tokens','error'),![];const _0xdcc70a=TOKENS[_0x38c5dc];if(!_0xdcc70a)return console['error']('Token\x20'+_0x38c5dc+_0x1a1cef(0x10b)),![];if(userData[_0x1a1cef(0x155)]<_0xdcc70a['price'])return showMessage(_0x1a1cef(0x15b)+(_0xdcc70a['price']-userData[_0x1a1cef(0x155)])+'\x20more\x20points.','error'),![];if(userOwnsToken(_0x38c5dc))return showMessage('You\x20already\x20own\x20the\x20'+_0xdcc70a['name']+'\x20token','info'),![];try{return await processPurchase(_0x38c5dc,_0xdcc70a,'token');}catch(_0x307622){return console[_0x1a1cef(0x156)](_0x1a1cef(0x108),_0x307622),showMessage('Purchase\x20failed.\x20Please\x20try\x20again.',_0x1a1cef(0x156)),![];}}async function processPurchase(_0x19308f,_0x6cfcb9,_0x4e2819){const _0x56a981=a46_0x135596,_0x44442f=auth[_0x56a981(0x10a)];try{const _0x47573d=doc(db,'userProfiles',_0x44442f[_0x56a981(0x174)]),_0x22035a=await getDoc(_0x47573d);if(!_0x22035a['exists']())return showMessage(_0x56a981(0x104),'error'),![];const _0x11d933=_0x22035a['data'](),_0x2769b4=_0x11d933[_0x56a981(0x155)]||0x0,_0x196e61=_0x11d933[_0x56a981(0x163)]||[];if(_0x2769b4<_0x6cfcb9[_0x56a981(0x169)])return showMessage(_0x56a981(0x100),_0x56a981(0x156)),![];if(_0x196e61['includes'](_0x4e2819+'_'+_0x19308f))return showMessage('You\x20already\x20own\x20this\x20'+_0x4e2819,_0x56a981(0x168)),![];const _0x4e2519=_0x2769b4-_0x6cfcb9['price'],_0xf6c630=[..._0x196e61,_0x4e2819+'_'+_0x19308f];await updateDoc(_0x47573d,{'points':_0x4e2519,'inventory':_0xf6c630,'lastPurchase':serverTimestamp()});if(_0x4e2819===_0x56a981(0x110))try{const _0x2e13e4=doc(db,_0x56a981(0x144),_0x44442f[_0x56a981(0x174)]),_0x5abb57=await getDoc(_0x2e13e4);let _0x240aac=[];_0x5abb57['exists']()&&(_0x240aac=_0x5abb57['data']()['tokens']||[]);const _0x508fc9=new Date();_0x240aac[_0x56a981(0x133)]({'tokenId':_0x19308f,'tokenName':_0x6cfcb9['name'],'tokenImage':_0x6cfcb9[_0x56a981(0x17c)],'category':_0x6cfcb9['category'],'purchasedAt':_0x508fc9,'price':_0x6cfcb9['price'],'equipped':![]}),await setDoc(_0x2e13e4,{'userId':_0x44442f['uid'],'username':_0x11d933['username']||_0x44442f['displayName']||'Unknown','tokens':_0x240aac,'lastUpdated':serverTimestamp()},{'merge':!![]}),typeof clearTokenCache==='function'&&clearTokenCache(_0x44442f['uid']),console[_0x56a981(0x14d)](_0x56a981(0x115)+_0x19308f+_0x56a981(0x11e));}catch(_0x340151){console['warn']('Token\x20collection\x20update\x20had\x20an\x20issue,\x20but\x20purchase\x20completed:',_0x340151),_0x340151['code']==='permission-denied'?console['log']('üîß\x20Token\x20permissions\x20issue\x20detected,\x20but\x20purchase\x20was\x20successful'):console['error'](_0x56a981(0x14e),_0x340151);}try{await addDoc(collection(db,'transactions'),{'userId':_0x44442f['uid'],'userEmail':_0x44442f['email'],'itemId':_0x4e2819+'_'+_0x19308f,'itemTitle':_0x6cfcb9['name'],'price':_0x6cfcb9[_0x56a981(0x169)],'type':'purchase','category':_0x4e2819,'timestamp':serverTimestamp()});}catch(_0x379660){console['warn']('Transaction\x20logging\x20failed,\x20but\x20purchase\x20was\x20successful:',_0x379660);}return userData['points']=_0x4e2519,userData[_0x56a981(0x163)]=_0xf6c630,pointsDisplay&&(pointsDisplay['textContent']=userData['points'][_0x56a981(0x113)]()),updateTokenButtons(),_0x4e2819==='theme'&&updateThemeButtons(),console[_0x56a981(0x14d)]('‚úÖ\x20Purchased\x20'+_0x6cfcb9['name']+'\x20for\x20'+_0x6cfcb9[_0x56a981(0x169)]+_0x56a981(0x13a)),showMessage(_0x56a981(0x136)+_0x6cfcb9['name']+'!\x20Use\x20the\x20\x22Equip\x22\x20button\x20to\x20show\x20it\x20on\x20the\x20ladder.','success'),!![];}catch(_0x30d12f){console['error']('Purchase\x20processing\x20error:',_0x30d12f);if(_0x30d12f[_0x56a981(0x176)]===_0x56a981(0x114))showMessage('Permission\x20denied.\x20Please\x20try\x20again\x20or\x20contact\x20support.','error');else{if(_0x30d12f['code']===_0x56a981(0x131))showMessage('Service\x20temporarily\x20unavailable.\x20Please\x20try\x20again.','error');else _0x30d12f['code']===_0x56a981(0x17e)?showMessage(_0x56a981(0x119),_0x56a981(0x156)):showMessage(_0x56a981(0x17d),'error');}return![];}}async function equipToken(_0x376373){const _0x445666=a46_0x135596,_0x52af06=auth['currentUser'];if(!_0x52af06)return showMessage(_0x445666(0x150),'error'),![];const _0x1a31e8=TOKENS[_0x376373];if(!_0x1a31e8)return console['error']('Token\x20'+_0x376373+'\x20not\x20found'),![];if(!userOwnsToken(_0x376373))return showMessage('You\x20must\x20own\x20this\x20token\x20to\x20equip\x20it','error'),![];try{const _0x196532=doc(db,'userProfiles',_0x52af06['uid']);await updateDoc(_0x196532,{'equippedToken':_0x376373,'lastTokenEquip':serverTimestamp()});try{const _0x3c90f4=doc(db,_0x445666(0x144),_0x52af06[_0x445666(0x174)]),_0x58eb3a=await getDoc(_0x3c90f4);if(_0x58eb3a['exists']()){const _0x55d1ac=_0x58eb3a['data'](),_0x402d9f=_0x55d1ac[_0x445666(0x157)]||[],_0x11b058=_0x402d9f[_0x445666(0x167)](_0x11eb39=>({..._0x11eb39,'equipped':_0x11eb39['tokenId']===_0x376373}));await updateDoc(_0x3c90f4,{'tokens':_0x11b058,'equippedToken':_0x376373,'lastUpdated':serverTimestamp()});}}catch(_0x5f3f25){console['warn']('Token\x20collection\x20update\x20had\x20an\x20issue,\x20but\x20equip\x20was\x20successful:',_0x5f3f25);}return userData['equippedToken']=_0x376373,typeof clearTokenCache==='function'&&(clearTokenCache(_0x52af06['uid']),clearTokenCache()),setTimeout(()=>{const _0x398c6d=_0x445666;window['displayLadder']&&typeof window[_0x398c6d(0x146)]==='function'&&(console['log']('üîÑ\x20Refreshing\x20ladder\x20to\x20show\x20equipped\x20token'),window[_0x398c6d(0x146)](!![])),window[_0x398c6d(0x130)]&&typeof window['RedeemStore']['refreshUI']==='function'&&window[_0x398c6d(0x130)]['refreshUI']();},0x1f4),console['log'](_0x445666(0x152)+_0x1a31e8['name']),showMessage(_0x1a31e8[_0x445666(0x15f)]+_0x445666(0x13d),'success'),!![];}catch(_0x499758){return console[_0x445666(0x156)]('Token\x20equip\x20failed:',_0x499758),_0x499758[_0x445666(0x176)]==='permission-denied'?showMessage('Permission\x20denied.\x20Token\x20may\x20still\x20be\x20equipped\x20-\x20check\x20the\x20ladder.','warning'):showMessage('Failed\x20to\x20equip\x20token:\x20'+_0x499758['message'],_0x445666(0x156)),![];}}async function unequipToken(){const _0x298217=a46_0x135596,_0x3e671c=auth['currentUser'];if(!_0x3e671c)return showMessage('Please\x20sign\x20in\x20to\x20unequip\x20tokens',_0x298217(0x156)),![];if(!userData['equippedToken'])return showMessage('No\x20token\x20is\x20currently\x20equipped',_0x298217(0x168)),![];try{const _0x65f727=doc(db,'userProfiles',_0x3e671c['uid']);await updateDoc(_0x65f727,{'equippedToken':null,'lastTokenEquip':serverTimestamp()});const _0xb57179=doc(db,'userTokens',_0x3e671c['uid']),_0x4f43c0=await getDoc(_0xb57179);if(_0x4f43c0[_0x298217(0x128)]()){const _0x4d7728=_0x4f43c0['data'](),_0x336caa=_0x4d7728['tokens']||[],_0x56cec4=_0x336caa['map'](_0xe8b450=>({..._0xe8b450,'equipped':![]}));await updateDoc(_0xb57179,{'tokens':_0x56cec4,'equippedToken':null,'lastUpdated':serverTimestamp()});}return userData['equippedToken']=null,typeof clearTokenCache===_0x298217(0x151)&&(clearTokenCache(_0x3e671c[_0x298217(0x174)]),clearTokenCache()),setTimeout(()=>{const _0xb27b50=_0x298217;window['displayLadder']&&typeof window['displayLadder']===_0xb27b50(0x151)&&(console['log']('üîÑ\x20Refreshing\x20ladder\x20to\x20remove\x20unequipped\x20token'),window['displayLadder'](!![])),window['RedeemStore']&&typeof window[_0xb27b50(0x130)][_0xb27b50(0xff)]==='function'&&window[_0xb27b50(0x130)][_0xb27b50(0xff)]();},0x1f4),console['log']('‚úÖ\x20Token\x20unequipped'),showMessage(_0x298217(0x180),'success'),!![];}catch(_0x5cda2e){return console['error']('Token\x20unequip\x20failed:',_0x5cda2e),showMessage('Failed\x20to\x20unequip\x20token:\x20'+_0x5cda2e['message'],'error'),![];}}async function sellToken(_0x2b3dd4){const _0x273ce7=a46_0x135596,_0x21050e=auth['currentUser'];if(!_0x21050e)return showMessage('Please\x20sign\x20in\x20to\x20sell\x20tokens','error'),![];if(!userData[_0x273ce7(0x13b)])return showMessage(_0x273ce7(0x134),'error'),![];const _0x310841=TOKENS[_0x2b3dd4];if(!_0x310841)return console[_0x273ce7(0x156)]('Token\x20'+_0x2b3dd4+_0x273ce7(0x10b)),![];if(!userOwnsToken(_0x2b3dd4))return showMessage('You\x20don\x27t\x20own\x20this\x20token','error'),![];try{const _0x90df1e=doc(db,'userProfiles',_0x21050e['uid']),_0x3e8349=await getDoc(_0x90df1e),_0x21d0df=_0x3e8349['data'](),_0x51cda8=Math['floor'](_0x310841['price']*0.5),_0x166279=(_0x21d0df[_0x273ce7(0x155)]||0x0)+_0x51cda8,_0x54e88b=(_0x21d0df[_0x273ce7(0x163)]||[])['filter'](_0xbc06cc=>_0xbc06cc!==_0x273ce7(0x140)+_0x2b3dd4),_0x1e65b5=_0x21d0df['equippedToken']===_0x2b3dd4?null:_0x21d0df['equippedToken'];await updateDoc(_0x90df1e,{'points':_0x166279,'inventory':_0x54e88b,'equippedToken':_0x1e65b5,'lastSale':serverTimestamp()});const _0x1af0d0=doc(db,'userTokens',_0x21050e[_0x273ce7(0x174)]),_0x4b8398=await getDoc(_0x1af0d0);if(_0x4b8398['exists']()){const _0x280276=_0x4b8398[_0x273ce7(0x15e)](),_0xe47215=_0x280276['tokens']||[],_0x1c749d=_0xe47215['filter'](_0x5c972a=>_0x5c972a['tokenId']!==_0x2b3dd4);await updateDoc(_0x1af0d0,{'tokens':_0x1c749d,'equippedToken':_0x1e65b5,'lastUpdated':serverTimestamp()});}return await addDoc(collection(db,'transactions'),{'userId':_0x21050e['uid'],'userEmail':_0x21050e[_0x273ce7(0x127)],'itemId':'token_'+_0x2b3dd4,'itemTitle':_0x310841[_0x273ce7(0x15f)],'refund':_0x51cda8,'originalPrice':_0x310841['price'],'type':'sale','category':_0x273ce7(0x110),'timestamp':serverTimestamp()}),userData['points']=_0x166279,userData['inventory']=_0x54e88b,userData[_0x273ce7(0x15c)]=_0x1e65b5,pointsDisplay&&(pointsDisplay['textContent']=userData['points']['toLocaleString']()),typeof clearTokenCache==='function'&&clearTokenCache(_0x21050e['uid']),console[_0x273ce7(0x14d)]('‚úÖ\x20Sold\x20token\x20'+_0x310841['name']+'\x20for\x20'+_0x51cda8+'\x20points'),showMessage('Sold\x20'+_0x310841['name']+_0x273ce7(0x179)+_0x51cda8+'\x20points\x20(50%\x20refund)','success'),!![];}catch(_0x3890c6){return console['error']('Token\x20sale\x20failed:',_0x3890c6),showMessage('Failed\x20to\x20sell\x20token:\x20'+_0x3890c6['message'],_0x273ce7(0x156)),![];}}function applyTheme(_0x4e8c1d){const _0x94faa4=a46_0x135596;if(!userOwnsTheme(_0x4e8c1d))return showMessage('You\x20must\x20purchase\x20this\x20theme\x20first','error'),![];return window['ThemeSystem']?(window['ThemeSystem']['switchTheme'](_0x4e8c1d),showMessage((THEMES[_0x4e8c1d]?.['name']||_0x4e8c1d)+'\x20theme\x20applied!','success'),!![]):(console[_0x94faa4(0x156)]('Theme\x20system\x20not\x20found'),![]);}function buildStoreUI(){buildThemeItems(),buildTokenItems();}function buildThemeItems(){const _0x3a1e60=a46_0x135596,_0x1e7ba7=document['querySelector']('.themes-grid');if(!_0x1e7ba7){console[_0x3a1e60(0x156)](_0x3a1e60(0x148));return;}_0x1e7ba7['innerHTML']='',Object['entries'](THEMES)[_0x3a1e60(0x166)](([_0x12747c,_0x27f338])=>{const _0x2e81ec=_0x3a1e60,_0x1f307=document[_0x2e81ec(0x103)]('div');_0x1f307[_0x2e81ec(0x143)]='store-item',_0x1f307['dataset']['theme']=_0x12747c,_0x1f307['dataset'][_0x2e81ec(0x10f)]='theme_'+_0x12747c,_0x1f307['dataset'][_0x2e81ec(0x169)]=_0x27f338['price'],_0x1f307['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22item-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22item-icon\x20theme-icon-'+_0x12747c+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-palette\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22item-price\x22>'+(_0x27f338['price']===0x0?'FREE':_0x27f338['price']+'\x20Points')+_0x2e81ec(0x12e)+_0x27f338[_0x2e81ec(0x15f)]+'</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22item-description\x22>'+_0x27f338[_0x2e81ec(0x162)]+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22theme-select-btn\x20purchase-btn\x22>Select\x20Theme</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x1e7ba7['appendChild'](_0x1f307);}),setupThemeButtons();}function buildTokenItems(){const _0x390121=a46_0x135596,_0x55543d=document[_0x390121(0x175)]('.tokens-grid');if(!_0x55543d){console['error']('Tokens\x20container\x20not\x20found');return;}_0x55543d['innerHTML']='',Object['entries'](TOKENS)['forEach'](([_0xffb741,_0x5c8ffb])=>{const _0x465960=_0x390121,_0x31db82=document['createElement']('div');_0x31db82['className']='store-item\x20token-item',_0x31db82['dataset'][_0x465960(0x110)]=_0xffb741,_0x31db82['dataset'][_0x465960(0x10f)]='token_'+_0xffb741,_0x31db82['dataset'][_0x465960(0x169)]=_0x5c8ffb['price'];const _0xab65e8=userData['isAdmin']&&userOwnsToken(_0xffb741)?'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22token-sell-btn\x20admin-btn\x22\x20style=\x22margin-top:\x200.5rem;\x20background:\x20#f44336;\x20font-size:\x200.8rem;\x20padding:\x200.3rem;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Sell\x20('+Math[_0x465960(0x165)](_0x5c8ffb['price']*0.5)+'\x20pts)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20':'';_0x31db82['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22item-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22item-icon\x20token-icon\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22'+_0x5c8ffb['image']+_0x465960(0x12f)+_0x5c8ffb['name']+'\x22\x20class=\x22token-preview\x22\x20onerror=\x22this.style.display=\x27none\x27;\x20this.nextElementSibling.style.display=\x27flex\x27;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22token-fallback\x22\x20style=\x22display:\x20none;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-coins\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22item-price\x22>'+_0x5c8ffb['price']+_0x465960(0x11c)+_0xab65e8+_0x465960(0x184),_0x55543d['appendChild'](_0x31db82);}),setupTokenButtons();}function setupThemeButtons(){const _0x2dc6d3=a46_0x135596,_0x2f04a0=document['querySelectorAll'](_0x2dc6d3(0x122));_0x2f04a0['forEach'](_0x564486=>{const _0x199388=_0x2dc6d3;_0x564486[_0x199388(0x106)]('click',async _0x42b1d9=>{const _0x23d037=_0x199388;_0x42b1d9[_0x23d037(0x11b)]();const _0x5226e9=auth[_0x23d037(0x10a)];if(!_0x5226e9){showMessage('Please\x20sign\x20in\x20to\x20select\x20themes','error');return;}const _0x568ebf=_0x564486[_0x23d037(0x12a)]('[data-theme]'),_0x1410fa=_0x568ebf[_0x23d037(0x124)]['theme'],_0x16b29c=THEMES[_0x1410fa];if(!_0x16b29c){console['error'](_0x23d037(0x11f)+_0x1410fa+'\x20not\x20found');return;}console['log']('Theme\x20clicked:\x20'+_0x16b29c['name']+'\x20('+_0x1410fa+')');if(_0x564486['disabled']){_0x16b29c[_0x23d037(0x169)]>0x0&&showMessage(_0x23d037(0x17b)+_0x16b29c['price']+_0x23d037(0x177),'error');return;}if(_0x564486['textContent']==='Current\x20Theme'){showMessage(_0x16b29c[_0x23d037(0x15f)]+'\x20is\x20already\x20your\x20current\x20theme',_0x23d037(0x168));return;}if(_0x564486[_0x23d037(0x12d)]==='Apply\x20Theme'){applyTheme(_0x1410fa),updateThemeButtons();return;}if(_0x564486['textContent']['includes']('Buy')){const _0x3bf5af=window[_0x23d037(0x171)](_0x23d037(0x14a)+_0x16b29c['name']+'\x20theme\x20for\x20'+_0x16b29c['price']+_0x23d037(0x17a));if(!_0x3bf5af)return;const _0x515b1c=await purchaseTheme(_0x1410fa);_0x515b1c&&(showMessage(_0x16b29c['name']+'\x20theme\x20purchased!',_0x23d037(0xfc)),applyTheme(_0x1410fa),updateThemeButtons());return;}userOwnsTheme(_0x1410fa)?applyTheme(_0x1410fa):showMessage('You\x20must\x20purchase\x20this\x20theme\x20first','error');});}),updateThemeButtons();}function setupTokenButtons(){const _0x4d5840=a46_0x135596,_0x63c7ee=document[_0x4d5840(0xfd)](_0x4d5840(0x118)),_0x3d7827=document['querySelectorAll']('.token-equip-btn'),_0x4d5983=document['querySelectorAll'](_0x4d5840(0x183));_0x63c7ee['forEach'](_0x3344b4=>{const _0x4cc24a=_0x4d5840;_0x3344b4['addEventListener'](_0x4cc24a(0x14c),async _0x1e7fa3=>{const _0x956866=_0x4cc24a;_0x1e7fa3['preventDefault']();const _0x3e90cd=auth['currentUser'];if(!_0x3e90cd){showMessage('Please\x20sign\x20in\x20to\x20purchase\x20tokens','error');return;}const _0x11fef3=_0x3344b4['closest']('[data-token]'),_0x1481be=_0x11fef3['dataset'][_0x956866(0x110)],_0x14c408=TOKENS[_0x1481be];if(!_0x14c408){console['error'](_0x956866(0x142)+_0x1481be+'\x20not\x20found');return;}console['log']('Token\x20clicked:\x20'+_0x14c408[_0x956866(0x15f)]+'\x20('+_0x1481be+')');if(_0x3344b4[_0x956866(0x117)]){showMessage('You\x20need\x20'+_0x14c408['price']+'\x20points\x20to\x20purchase\x20this\x20token','error');return;}if(_0x3344b4['textContent']==='Owned'){showMessage('You\x20already\x20own\x20the\x20'+_0x14c408['name']+_0x956866(0x116),'info');return;}if(_0x3344b4[_0x956866(0x12d)]['includes']('Purchase')||_0x3344b4['textContent']['includes']('Buy')){const _0x2e312c=window[_0x956866(0x171)]('Purchase\x20'+_0x14c408['name']+'\x20token\x20for\x20'+_0x14c408[_0x956866(0x169)]+_0x956866(0x17a));if(!_0x2e312c)return;const _0x327e1b=await purchaseToken(_0x1481be);_0x327e1b&&updateTokenButtons();return;}});}),_0x3d7827[_0x4d5840(0x166)](_0x24618a=>{_0x24618a['addEventListener']('click',async _0x10d9bb=>{const _0x30931a=a46_0x4d40;_0x10d9bb[_0x30931a(0x11b)]();const _0x523a53=_0x24618a['closest']('[data-token]'),_0x54b225=_0x523a53[_0x30931a(0x124)]['token'],_0x2b79e5=TOKENS[_0x54b225];if(_0x24618a['textContent']==='Equipped'){const _0x4b980c=window['confirm']('Unequip\x20'+_0x2b79e5['name']+'?');if(!_0x4b980c)return;const _0x10c617=await unequipToken();_0x10c617&&updateTokenButtons();}else{const _0x5f0296=window['confirm']('Equip\x20'+_0x2b79e5[_0x30931a(0x15f)]+'?\x20This\x20will\x20unequip\x20your\x20current\x20token.');if(!_0x5f0296)return;const _0x290179=await equipToken(_0x54b225);_0x290179&&updateTokenButtons();}});}),_0x4d5983['forEach'](_0x2e3b79=>{_0x2e3b79['addEventListener']('click',async _0x4fe9a5=>{const _0x33dd46=a46_0x4d40;_0x4fe9a5[_0x33dd46(0x11b)]();const _0xa2479e=_0x2e3b79['closest']('[data-token]'),_0x2b21b1=_0xa2479e['dataset'][_0x33dd46(0x110)],_0x33cc5=TOKENS[_0x2b21b1],_0x227406=Math[_0x33dd46(0x165)](_0x33cc5['price']*0.5),_0x5f0edc=window[_0x33dd46(0x171)]('Are\x20you\x20sure\x20you\x20want\x20to\x20sell\x20'+_0x33cc5['name']+'\x20for\x20'+_0x227406+_0x33dd46(0x14b));if(!_0x5f0edc)return;const _0x57d9f4=await sellToken(_0x2b21b1);_0x57d9f4&&updateTokenButtons();});}),updateTokenButtons();}function updateThemeButtons(){const _0x350b31=a46_0x135596,_0x301d43=window['ThemeSystem']?window['ThemeSystem']['getCurrentTheme']():'default',_0x52cdaa=auth[_0x350b31(0x10a)];document['querySelectorAll']('.theme-select-btn')['forEach'](_0xb7334b=>{const _0x595d42=_0x350b31,_0x378879=_0xb7334b['closest']('[data-theme]'),_0x2c66f2=_0x378879['dataset'][_0x595d42(0x181)],_0xf87310=THEMES[_0x2c66f2];if(!_0xf87310)return;_0xb7334b[_0x595d42(0x117)]=![],_0xb7334b[_0x595d42(0x141)]['opacity']='',_0xb7334b['style']['cursor']='pointer',_0xb7334b['classList'][_0x595d42(0xfe)](_0x595d42(0x121),'apply-theme','can-afford','cannot-afford',_0x595d42(0x123),'sign-in-paid');if(!_0x52cdaa){_0xf87310['price']===0x0?(_0xb7334b['textContent']='Sign\x20in\x20to\x20Apply',_0xb7334b['classList']['add']('sign-in-free')):(_0xb7334b['textContent']='Sign\x20in\x20to\x20Purchase',_0xb7334b['disabled']=!![],_0xb7334b['style']['opacity']='0.7',_0xb7334b[_0x595d42(0x16c)]['add']('sign-in-paid'));return;}if(_0x2c66f2===_0x301d43){_0xb7334b[_0x595d42(0x12d)]='Current\x20Theme',_0xb7334b['classList']['add'](_0x595d42(0x121)),_0xb7334b[_0x595d42(0x117)]=!![],_0xb7334b['style']['cursor']=_0x595d42(0x164);return;}if(userOwnsTheme(_0x2c66f2)){_0xb7334b[_0x595d42(0x12d)]='Apply\x20Theme',_0xb7334b['classList']['add'](_0x595d42(0x102));return;}if(userData['points']>=_0xf87310[_0x595d42(0x169)]){_0xb7334b[_0x595d42(0x12d)]='Buy\x20for\x20'+_0xf87310['price']+'\x20Points',_0xb7334b[_0x595d42(0x16c)]['add']('can-afford');return;}_0xb7334b['textContent']='Need\x20'+_0xf87310['price']+'\x20Points',_0xb7334b[_0x595d42(0x16c)]['add'](_0x595d42(0x139)),_0xb7334b[_0x595d42(0x141)]['opacity']='0.5',_0xb7334b['disabled']=!![],_0xb7334b['style']['cursor']='not-allowed';});}function updateTokenButtons(){const _0x22bb21=a46_0x135596,_0x1aa94c=auth[_0x22bb21(0x10a)];document[_0x22bb21(0xfd)]('.token-select-btn')[_0x22bb21(0x166)](_0x267333=>{const _0x421164=_0x22bb21,_0x1fd7f4=_0x267333['closest'](_0x421164(0x105)),_0x1aaf36=_0x1fd7f4['dataset']['token'],_0x575ca1=TOKENS[_0x1aaf36],_0x5c7492=_0x1fd7f4['querySelector']('.token-equip-btn'),_0x8f00ed=_0x1fd7f4['querySelector'](_0x421164(0x183));if(!_0x575ca1)return;_0x267333['disabled']=![],_0x267333['style']['opacity']='',_0x267333['style'][_0x421164(0x132)]=_0x421164(0x147);_0x5c7492&&(_0x5c7492['style'][_0x421164(0x126)]='none',_0x5c7492['disabled']=![],_0x5c7492['style']['opacity']='',_0x5c7492['classList'][_0x421164(0xfe)]('equipped','can-equip'));_0x8f00ed&&(_0x8f00ed['style']['display']=_0x421164(0x13e));_0x267333[_0x421164(0x16c)][_0x421164(0xfe)](_0x421164(0x12c),'can-afford','cannot-afford','sign-in');if(!_0x1aa94c){_0x267333['textContent']='Sign\x20in\x20to\x20Purchase',_0x267333['disabled']=!![],_0x267333[_0x421164(0x141)]['opacity']=_0x421164(0x153),_0x267333['classList']['add']('sign-in');return;}if(userOwnsToken(_0x1aaf36)){_0x267333['textContent']='Owned',_0x267333['classList']['add']('owned'),_0x267333['disabled']=!![],_0x267333[_0x421164(0x141)][_0x421164(0x132)]='default',_0x267333[_0x421164(0x141)][_0x421164(0x160)]='var(--success-color,\x20#4CAF50)';_0x5c7492&&(_0x5c7492['style'][_0x421164(0x126)]=_0x421164(0x145),userHasTokenEquipped(_0x1aaf36)?(_0x5c7492['textContent']='Equipped',_0x5c7492['classList'][_0x421164(0x16d)]('equipped'),_0x5c7492['style']['background']=_0x421164(0x107),_0x5c7492[_0x421164(0x141)]['cursor']=_0x421164(0x147)):(_0x5c7492['textContent']='Equip',_0x5c7492['classList']['add'](_0x421164(0x111)),_0x5c7492[_0x421164(0x141)]['background']=_0x421164(0x173),_0x5c7492['style']['cursor']='pointer'));_0x8f00ed&&userData['isAdmin']&&(_0x8f00ed[_0x421164(0x141)][_0x421164(0x126)]=_0x421164(0x145));return;}if(userData['points']>=_0x575ca1['price']){_0x267333[_0x421164(0x12d)]='Buy\x20for\x20'+_0x575ca1['price']+'\x20Points',_0x267333[_0x421164(0x16c)]['add'](_0x421164(0x16a)),_0x267333['style']['background']='';return;}_0x267333[_0x421164(0x12d)]=_0x421164(0x10e)+_0x575ca1['price']+'\x20Points',_0x267333['classList']['add']('cannot-afford'),_0x267333['style']['opacity']='0.5',_0x267333['disabled']=!![],_0x267333['style']['cursor']=_0x421164(0x161),_0x267333['style'][_0x421164(0x160)]='var(--muted-color,\x20#757575)';});}function showMessage(_0x44d026,_0x510d5c='info'){const _0xbe26b2=a46_0x135596,_0x44455a=document['getElementById']('store-message');_0x44455a&&_0x44455a[_0xbe26b2(0xfe)]();const _0x2e88e7=document['createElement']('div');_0x2e88e7['id']=_0xbe26b2(0x154),_0x2e88e7['className']='store-message\x20store-message-'+_0x510d5c,_0x2e88e7['textContent']=_0x44d026,document['body'][_0xbe26b2(0x16e)](_0x2e88e7),requestAnimationFrame(()=>{const _0x3b6764=_0xbe26b2;_0x2e88e7['classList'][_0x3b6764(0x16d)]('visible');}),setTimeout(()=>{_0x2e88e7['classList']['remove']('visible'),setTimeout(()=>{const _0x12a2ee=a46_0x4d40;_0x2e88e7[_0x12a2ee(0x13f)]&&_0x2e88e7['remove']();},0x12c);},0xfa0);}window['RedeemStore']={'refreshUI':()=>{updateThemeButtons(),updateTokenButtons();},'checkOwnership':userOwnsTheme,'checkTokenOwnership':userOwnsToken,'applyTheme':applyTheme,'purchaseTheme':purchaseTheme,'purchaseToken':purchaseToken},console['log']('üè™\x20Redeem\x20store\x20loaded');
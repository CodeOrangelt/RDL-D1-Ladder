const a28_0xae8e64=(function(){let _0x42fa31=!![];return function(_0x44cf1a,_0x552177){const _0x17b8b5=_0x42fa31?function(){const _0x30bcfa=a28_0x3cf5;if(_0x552177){const _0x1c5119=_0x552177[_0x30bcfa(0x1c5)](_0x44cf1a,arguments);return _0x552177=null,_0x1c5119;}}:function(){};return _0x42fa31=![],_0x17b8b5;};}()),a28_0x305641=a28_0xae8e64(this,function(){const _0x2d3266=a28_0x3cf5;let _0x203b3c;try{const _0x550923=Function(_0x2d3266(0x1ee)+_0x2d3266(0x207)+');');_0x203b3c=_0x550923();}catch(_0x3401e1){_0x203b3c=window;}const _0x5d571b=_0x203b3c[_0x2d3266(0x1d5)]=_0x203b3c[_0x2d3266(0x1d5)]||{},_0xc2a3de=[_0x2d3266(0x204),_0x2d3266(0x1c4),_0x2d3266(0x1f3),_0x2d3266(0x1c9),_0x2d3266(0x1cd),_0x2d3266(0x1ea),_0x2d3266(0x1e0)];for(let _0x3e7bc7=0x0;_0x3e7bc7<_0xc2a3de[_0x2d3266(0x1c0)];_0x3e7bc7++){const _0x510031=a28_0xae8e64[_0x2d3266(0x1cb)][_0x2d3266(0x1f0)][_0x2d3266(0x218)](a28_0xae8e64),_0x3d2814=_0xc2a3de[_0x3e7bc7],_0x3e2bcd=_0x5d571b[_0x3d2814]||_0x510031;_0x510031[_0x2d3266(0x216)]=a28_0xae8e64[_0x2d3266(0x218)](a28_0xae8e64),_0x510031[_0x2d3266(0x1d9)]=_0x3e2bcd[_0x2d3266(0x1d9)][_0x2d3266(0x218)](_0x3e2bcd),_0x5d571b[_0x3d2814]=_0x510031;}});a28_0x305641();import{collection,doc,getDoc,getDocs,updateDoc,setDoc,deleteDoc,writeBatch,query,where,serverTimestamp,addDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';import{recordEloChange}from'./elo-history.js';function a28_0x3cf5(_0x689153,_0x2d8faf){const _0x305641=a28_0x3a58();return a28_0x3cf5=function(_0xae8e64,_0x4dc105){_0xae8e64=_0xae8e64-0x1be;let _0x3a5877=_0x305641[_0xae8e64];return _0x3a5877;},a28_0x3cf5(_0x689153,_0x2d8faf);}import{promotionManager,checkAndRecordPromotion}from'./promotions.js';import{isAdmin}from'./admin-check.js';import{RANKS,getRankStyle}from'./ranks.js';export function calculateElo(_0x55322c,_0x3b0ecc,_0x3684d5=0x20){const _0xdcd262=a28_0x3cf5,_0x1adc0b=0x1/(0x1+Math[_0xdcd262(0x20b)](0xa,(_0x3b0ecc-_0x55322c)/0x190)),_0x39e1e5=0x1/(0x1+Math[_0xdcd262(0x20b)](0xa,(_0x55322c-_0x3b0ecc)/0x190)),_0x335330=_0x55322c+_0x3684d5*(0x1-_0x1adc0b),_0x11acf1=_0x3b0ecc+_0x3684d5*(0x0-_0x39e1e5);return{'newWinnerRating':Math[_0xdcd262(0x1de)](_0x335330),'newLoserRating':Math[_0xdcd262(0x1de)](_0x11acf1)};}export function assignDefaultEloRating(_0x42315d,_0x1aa731){const _0xba4866=a28_0x3cf5,_0x3f3e5c=0xc8;!_0x1aa731[_0xba4866(0x1f1)]&&db[_0xba4866(0x212)](_0xba4866(0x1fc))[_0xba4866(0x1c6)](_0x42315d)[_0xba4866(0x1ef)]({'eloRating':_0x3f3e5c})[_0xba4866(0x208)](()=>{const _0x4ac854=_0xba4866;console[_0x4ac854(0x204)](_0x4ac854(0x1ce)+_0x1aa731[_0x4ac854(0x205)]);})[_0xba4866(0x1cf)](_0xacc417=>{const _0x1a788c=_0xba4866;console[_0x1a788c(0x1c9)](_0x1a788c(0x210),_0xacc417);});}export async function updateEloRatings(_0x3ba500,_0x2e82cb,_0x14afd2){const _0xe7682f=a28_0x3cf5;try{const _0xbd8b57=writeBatch(db),_0x2794be=doc(db,_0xe7682f(0x1fc),_0x3ba500),_0x4cae58=doc(db,_0xe7682f(0x1fc),_0x2e82cb),[_0x3932f6,_0x2071a0]=await Promise[_0xe7682f(0x1f6)]([getDoc(_0x2794be),getDoc(_0x4cae58)]);if(!_0x3932f6[_0xe7682f(0x1d3)]()||!_0x2071a0[_0xe7682f(0x1d3)]())throw new Error(_0xe7682f(0x1d2));const _0x199985=_0x3932f6[_0xe7682f(0x217)](),_0xf2e080=_0x2071a0[_0xe7682f(0x217)](),_0xfd1375=_0x199985[_0xe7682f(0x1f4)]||Number[_0xe7682f(0x1c7)],_0x119320=_0xf2e080[_0xe7682f(0x1f4)]||Number[_0xe7682f(0x1c7)],{newWinnerRating:_0x14a6ba,newLoserRating:_0x70fdbf}=calculateElo(_0x199985[_0xe7682f(0x1f1)]||0x4b0,_0xf2e080[_0xe7682f(0x1f1)]||0x4b0);let _0x51f56f=_0xfd1375,_0x1f067b=_0x119320;if(_0xfd1375>_0x119320){console[_0xe7682f(0x204)](_0xe7682f(0x1d7)),_0x51f56f=_0x119320,_0x1f067b=_0x119320+0x1;const _0x284caa=query(collection(db,_0xe7682f(0x1fc)),where(_0xe7682f(0x1f4),'>',_0x119320),where(_0xe7682f(0x1f4),'<',_0xfd1375)),_0x1fbb2e=await getDocs(_0x284caa);for(const _0x4ef731 of _0x1fbb2e[_0xe7682f(0x1ec)]){_0x4ef731['id']!==_0x3ba500&&_0x4ef731['id']!==_0x2e82cb&&_0xbd8b57[_0xe7682f(0x1ef)](doc(db,_0xe7682f(0x1fc),_0x4ef731['id']),{'position':_0x4ef731[_0xe7682f(0x217)]()[_0xe7682f(0x1f4)]+0x1});}}else console[_0xe7682f(0x204)](_0xe7682f(0x202));const _0x558909={'eloRating':_0x14a6ba,'lastMatchDate':serverTimestamp(),'position':_0x51f56f,'lastMatchId':_0x14afd2},_0x21a778={'eloRating':_0x70fdbf,'lastMatchDate':serverTimestamp(),'position':_0x1f067b,'lastMatchId':_0x14afd2};return _0xbd8b57[_0xe7682f(0x1ef)](_0x2794be,_0x558909),_0xbd8b57[_0xe7682f(0x1ef)](_0x4cae58,_0x21a778),await _0xbd8b57[_0xe7682f(0x1c1)](),console[_0xe7682f(0x204)](_0xe7682f(0x1e7)),await Promise[_0xe7682f(0x1f6)]([recordEloChange({'playerId':_0x3ba500,'previousElo':_0x199985[_0xe7682f(0x1f1)]||0x4b0,'newElo':_0x14a6ba,'opponentId':_0x2e82cb,'matchResult':_0xe7682f(0x1e1),'previousPosition':_0xfd1375,'newPosition':_0x51f56f,'isPromotion':_0x51f56f<_0xfd1375,'matchId':_0x14afd2,'timestamp':serverTimestamp()}),recordEloChange({'playerId':_0x2e82cb,'previousElo':_0xf2e080[_0xe7682f(0x1f1)]||0x4b0,'newElo':_0x70fdbf,'opponentId':_0x3ba500,'matchResult':_0xe7682f(0x203),'previousPosition':_0x119320,'newPosition':_0x1f067b,'isDemotion':_0x1f067b>_0x119320,'matchId':_0x14afd2,'timestamp':serverTimestamp()})]),await promotionManager[_0xe7682f(0x1da)](_0x3ba500,_0x14a6ba,_0x199985[_0xe7682f(0x1f1)],{'source':_0xe7682f(0x1e8),'matchId':_0x14afd2}),await promotionManager[_0xe7682f(0x1da)](_0x2e82cb,_0x70fdbf,_0xf2e080[_0xe7682f(0x1f1)],{'source':_0xe7682f(0x1e8),'matchId':_0x14afd2}),console[_0xe7682f(0x204)](_0xe7682f(0x1f8)),!![];}catch(_0x131e94){console[_0xe7682f(0x1c9)](_0xe7682f(0x1fe),_0x131e94);throw _0x131e94;}}const POINTS_CHART={'':0xa,'Standard':0xa,'Fusion\x20Match':0x19,'â‰¥6\x20Missiles':0xa,'Weapon\x20Imbalance':0x1e,'Blind\x20Match':0x4b,'Rematch':0x14,'Disorientation':0x32,'Ratting':0x23,'Altered\x20Powerups':0x23,'Mega\x20Match':0x28,'Dogfight':0x32,'Gauss\x20and\x20Mercs':0x19,'Misc':0x1e};export async function approveReport(_0x3bed02,_0x8aa193,_0x586dd7,_0x2ffb06,_0x27d904){const _0x202703=a28_0x3cf5;try{const _0x5f15ee=doc(db,_0x202703(0x1fa),_0x3bed02),_0x124df2=await getDoc(_0x5f15ee);if(!_0x124df2[_0x202703(0x1d3)]())throw new Error(_0x202703(0x1cc));const _0x1920cc=_0x124df2[_0x202703(0x217)](),_0x5002af={..._0x1920cc,'winnerScore':_0x8aa193,'winnerSuicides':_0x586dd7,'winnerComment':_0x2ffb06,'winnerDemoLink':_0x27d904,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':auth[_0x202703(0x1eb)][_0x202703(0x1e9)]};await setDoc(doc(db,_0x202703(0x1e4),_0x3bed02),_0x5002af),await deleteDoc(_0x5f15ee),console[_0x202703(0x204)](_0x202703(0x1d0));const [_0x4d02a6,_0x4fc5be]=await Promise[_0x202703(0x1f6)]([getDocs(query(collection(db,_0x202703(0x1fc)),where(_0x202703(0x205),'==',_0x1920cc[_0x202703(0x1ca)]))),getDocs(query(collection(db,_0x202703(0x1fc)),where(_0x202703(0x205),'==',_0x1920cc[_0x202703(0x20f)])))]);if(_0x4d02a6[_0x202703(0x1ed)]||_0x4fc5be[_0x202703(0x1ed)])throw new Error(_0x202703(0x1be));const _0x49d855=_0x4d02a6[_0x202703(0x1ec)][0x0]['id'],_0x11b2b0=_0x4fc5be[_0x202703(0x1ec)][0x0]['id'];await updateEloRatings(_0x49d855,_0x11b2b0,_0x3bed02);try{const _0x1e70f2=_0x1920cc[_0x202703(0x1f7)]||_0x202703(0x201),_0x14e797=POINTS_CHART[_0x1e70f2]||0xa,_0x42c046=doc(db,_0x202703(0x1e2),_0x49d855),_0x7cfb89=doc(db,_0x202703(0x1e2),_0x11b2b0),[_0x38a2f8,_0x16fb60]=await Promise[_0x202703(0x1f6)]([getDoc(_0x42c046),getDoc(_0x7cfb89)]);if(_0x38a2f8[_0x202703(0x1d3)]()&&_0x16fb60[_0x202703(0x1d3)]()){const _0x183813=_0x38a2f8[_0x202703(0x217)](),_0x1d1094=_0x16fb60[_0x202703(0x217)](),_0x3da992=_0x183813[_0x202703(0x214)]||0x0,_0x263573=_0x1d1094[_0x202703(0x214)]||0x0,_0x1cc5ef=_0x3da992+_0x14e797,_0x301352=_0x263573+_0x14e797;await Promise[_0x202703(0x1f6)]([updateDoc(_0x42c046,{'points':_0x1cc5ef,'lastPointsModified':serverTimestamp()}),updateDoc(_0x7cfb89,{'points':_0x301352,'lastPointsModified':serverTimestamp()})]),await Promise[_0x202703(0x1f6)]([addDoc(collection(db,_0x202703(0x1fd)),{'userId':_0x49d855,'userEmail':_0x183813[_0x202703(0x206)]||_0x202703(0x213),'displayName':_0x183813[_0x202703(0x1c2)]||_0x183813[_0x202703(0x205)]||_0x202703(0x1bf),'action':_0x202703(0x1e3),'amount':_0x14e797,'previousPoints':_0x3da992,'newPoints':_0x1cc5ef,'reason':_0x202703(0x1dc)+_0x1e70f2+_0x202703(0x1f2),'adminEmail':_0x202703(0x20e),'timestamp':serverTimestamp()}),addDoc(collection(db,_0x202703(0x1fd)),{'userId':_0x11b2b0,'userEmail':_0x1d1094[_0x202703(0x206)]||_0x202703(0x213),'displayName':_0x1d1094[_0x202703(0x1c2)]||_0x1d1094[_0x202703(0x205)]||_0x202703(0x1bf),'action':_0x202703(0x1e3),'amount':_0x14e797,'previousPoints':_0x263573,'newPoints':_0x301352,'reason':_0x202703(0x1dc)+_0x1e70f2+_0x202703(0x1e6),'adminEmail':_0x202703(0x20e),'timestamp':serverTimestamp()})]),console[_0x202703(0x204)](_0x202703(0x1d8)+_0x14e797+_0x202703(0x1f9)+_0x1e70f2+_0x202703(0x1d1));}else console[_0x202703(0x1c4)](_0x202703(0x1d4));}catch(_0x372049){console[_0x202703(0x1c4)](_0x202703(0x1c8),_0x372049);}return console[_0x202703(0x204)](_0x202703(0x1f5)),!![];}catch(_0x1d860d){console[_0x202703(0x1c9)](_0x202703(0x1c3),_0x1d860d);throw _0x1d860d;}}function a28_0x3a58(){const _0x3abd59=['Could\x20not\x20find\x20player\x20documents','Unknown\x20User','length','commit','displayName','Error\x20approving\x20report:','warn','apply','doc','MAX_SAFE_INTEGER','Points\x20award\x20failed,\x20but\x20match\x20approval\x20continues:','error','winnerUsername','constructor','Report\x20not\x20found','exception','Assigned\x20default\x20ELO\x20rating\x20to\x20player\x20','catch','Match\x20moved\x20to\x20approved\x20collection','\x20match','One\x20or\x20both\x20players\x20not\x20found','exists','Could\x20not\x20award\x20points\x20-\x20one\x20or\x20both\x20user\x20profiles\x20not\x20found','console','totalDeaths','Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked','Awarded\x20','toString','checkAndRecordPromotion','winnerScore','Match\x20points:\x20','lastUpdated','round','losses','trace','win','userProfiles','add','approvedMatches','playerStats','\x20match\x20(Participant)','ELO\x20ratings\x20updated\x20successfully','match','uid','table','currentUser','docs','empty','return\x20(function()\x20','update','prototype','eloRating','\x20match\x20(Winner)','info','position','Match\x20successfully\x20approved\x20and\x20ELO\x20updated','all','subgameType','ELO\x20ratings\x20and\x20positions\x20updated\x20successfully','\x20points\x20to\x20both\x20players\x20for\x20','pendingMatches','winRate','players','pointsHistory','Error\x20in\x20updateEloRatings:','totalKills','color','Standard','Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions','loss','log','username','email','{}.constructor(\x22return\x20this\x22)(\x20)','then','wins','loserScore','pow','toFixed','name','system-match-award','loserUsername','Error\x20assigning\x20default\x20ELO\x20rating:','toISOString','collection','unknown','points','totalMatches','__proto__','data','bind'];a28_0x3a58=function(){return _0x3abd59;};return a28_0x3a58();}async function updatePlayerElo(_0x422690,_0x573a91,_0x50f760){const _0x31d3a5=a28_0x3cf5,_0x30a174=doc(db,_0x31d3a5(0x1fc),_0x422690),_0x28226b=await getDoc(_0x30a174),_0x5aff44=_0x28226b[_0x31d3a5(0x217)](),_0x5c9fbe=doc(db,_0x31d3a5(0x1e5),_0x422690),_0x23092b=await getDoc(_0x5c9fbe),_0x5aa1d4=_0x23092b[_0x31d3a5(0x217)]()||{'totalMatches':0x0,'winRate':0x0},_0x18e54b=getRankStyle(_0x50f760,_0x5aa1d4[_0x31d3a5(0x215)],_0x5aa1d4[_0x31d3a5(0x1fb)]);await updateDoc(_0x30a174,{'eloRating':_0x50f760,'rank':_0x18e54b[_0x31d3a5(0x20d)],'rankColor':_0x18e54b[_0x31d3a5(0x200)]}),await checkAndRecordPromotion(_0x422690,_0x50f760,_0x573a91,{'matchCount':_0x5aa1d4[_0x31d3a5(0x215)],'winRate':_0x5aa1d4[_0x31d3a5(0x1fb)]});}async function updatePlayerStats(_0x10f5d1,_0x259b9c,_0x28b4cf){const _0x335656=a28_0x3cf5,_0x16e2d2=doc(db,_0x335656(0x1e5),_0x10f5d1),_0x532967=await getDoc(_0x16e2d2);let _0x4dcae0=_0x532967[_0x335656(0x1d3)]()?_0x532967[_0x335656(0x217)]():{'wins':0x0,'losses':0x0,'totalKills':0x0,'totalDeaths':0x0,'winRate':0x0};_0x28b4cf?(_0x4dcae0[_0x335656(0x209)]++,_0x4dcae0[_0x335656(0x1ff)]+=parseInt(_0x259b9c[_0x335656(0x1db)]||0x0),_0x4dcae0[_0x335656(0x1d6)]+=parseInt(_0x259b9c[_0x335656(0x20a)]||0x0)):(_0x4dcae0[_0x335656(0x1df)]++,_0x4dcae0[_0x335656(0x1ff)]+=parseInt(_0x259b9c[_0x335656(0x20a)]||0x0),_0x4dcae0[_0x335656(0x1d6)]+=parseInt(_0x259b9c[_0x335656(0x1db)]||0x0));const _0x4a51ab=_0x4dcae0[_0x335656(0x209)]+_0x4dcae0[_0x335656(0x1df)];_0x4dcae0[_0x335656(0x1fb)]=_0x4a51ab>0x0?(_0x4dcae0[_0x335656(0x209)]/_0x4a51ab*0x64)[_0x335656(0x20c)](0x1):0x0,_0x4dcae0[_0x335656(0x1dd)]=new Date()[_0x335656(0x211)](),await setDoc(_0x16e2d2,_0x4dcae0,{'merge':!![]});}
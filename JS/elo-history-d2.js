const a14_0x42f935=a14_0x2007,a14_0x57b840=(function(){let _0x158dec=!![];return function(_0x57042b,_0x3eaec0){const _0x3b5ee9=_0x158dec?function(){if(_0x3eaec0){const _0x214f74=_0x3eaec0['apply'](_0x57042b,arguments);return _0x3eaec0=null,_0x214f74;}}:function(){};return _0x158dec=![],_0x3b5ee9;};}()),a14_0x265999=a14_0x57b840(this,function(){const _0x32d7a6=a14_0x2007,_0x234c6c=function(){const _0x208f2d=a14_0x2007;let _0x202be6;try{_0x202be6=Function('return\x20(function()\x20'+_0x208f2d(0x1bc)+');')();}catch(_0x5f5884){_0x202be6=window;}return _0x202be6;},_0x205f01=_0x234c6c(),_0x426fdd=_0x205f01['console']=_0x205f01['console']||{},_0x4a6ac6=['log',_0x32d7a6(0x1b2),'info',_0x32d7a6(0x1b5),_0x32d7a6(0x1be),'table','trace'];for(let _0x4abb29=0x0;_0x4abb29<_0x4a6ac6[_0x32d7a6(0x1b3)];_0x4abb29++){const _0x49a026=a14_0x57b840[_0x32d7a6(0x1c5)]['prototype']['bind'](a14_0x57b840),_0x348f76=_0x4a6ac6[_0x4abb29],_0x6622fc=_0x426fdd[_0x348f76]||_0x49a026;_0x49a026['__proto__']=a14_0x57b840['bind'](a14_0x57b840),_0x49a026['toString']=_0x6622fc['toString']['bind'](_0x6622fc),_0x426fdd[_0x348f76]=_0x49a026;}});function a14_0x5e94(){const _0x35d77a=['timestamp','warn','length','Emerald','error','data','Bronze','exists','Silver','map','Error\x20recording\x20D2\x20ELO\x20history:','{}.constructor(\x22return\x20this\x22)(\x20)','promotion','exception','newElo','player','D2\x20ELO\x20history\x20recorded\x20for\x20','all','opponent','playersD2','constructor','docs'];a14_0x5e94=function(){return _0x35d77a;};return a14_0x5e94();}a14_0x265999();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D2=[{'name':'Gold','elo':0x708},{'name':'Silver','elo':0x640},{'name':a14_0x42f935(0x1b7),'elo':0x578},{'name':'Unranked','elo':0x4b0}];let lastVisibleD2=null;async function getUsernameByIdD2(_0x422843){const _0xfcd061=a14_0x42f935;try{if(!_0x422843)return'Unknown\x20Player';const _0x1730cf=await getDoc(doc(db,_0xfcd061(0x1c4),_0x422843));if(_0x1730cf[_0xfcd061(0x1b8)]())return _0x1730cf[_0xfcd061(0x1b6)]()['username']||'Unknown\x20Player';const _0x1406bc=await getDocs(query(collection(db,'approvedMatchesD2'),where('winnerId','==',_0x422843),limit(0x1)));if(!_0x1406bc['empty'])return _0x1406bc[_0xfcd061(0x1c6)][0x0]['data']()['winnerUsername']||'Unknown\x20Player';const _0x393ab0=await getDocs(query(collection(db,'approvedMatchesD2'),where('loserId','==',_0x422843),limit(0x1)));if(!_0x393ab0['empty'])return _0x393ab0['docs'][0x0][_0xfcd061(0x1b6)]()['loserUsername']||'Unknown\x20Player';return'Unknown\x20Player';}catch(_0x4c893a){return console['error']('Error\x20getting\x20username:',_0x4c893a),'Unknown\x20Player';}}export async function recordEloChangeD2({playerId:_0x3ae599,previousElo:_0x18f73f,newElo:_0x3faee9,opponentId:_0x43d765,matchResult:_0x8f2315,previousPosition:_0x48f876,newPosition:_0x4b5b29,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x186e00,timestamp:_0x2404a0}){const _0x51a2a1=a14_0x42f935;try{const _0x2b88be=doc(collection(db,'eloHistoryD2'));let _0x2a52fa='match';if(isPromotion)_0x2a52fa=_0x51a2a1(0x1bd);if(isDemotion)_0x2a52fa='demotion';let _0x565aed='Unranked';if(_0x3faee9>=0x834)_0x565aed=_0x51a2a1(0x1b4);else{if(_0x3faee9>=0x708)_0x565aed='Gold';else{if(_0x3faee9>=0x640)_0x565aed=_0x51a2a1(0x1b9);else{if(_0x3faee9>=0x578)_0x565aed='Bronze';}}}return await setDoc(_0x2b88be,{'type':_0x2a52fa,'player':_0x3ae599,'opponent':_0x43d765,'previousElo':_0x18f73f,'newElo':_0x3faee9,'change':_0x3faee9-_0x18f73f,'matchResult':_0x8f2315,'previousPosition':_0x48f876,'newPosition':_0x4b5b29,'rankAchieved':_0x565aed,'matchId':_0x186e00,'timestamp':_0x2404a0}),console['log'](_0x51a2a1(0x1c1)+_0x3ae599),!![];}catch(_0x300b41){console['error'](_0x51a2a1(0x1bb),_0x300b41);throw _0x300b41;}}function a14_0x2007(_0x181004,_0x53af41){const _0x265999=a14_0x5e94();return a14_0x2007=function(_0x57b840,_0x5126bc){_0x57b840=_0x57b840-0x1b1;let _0x5e94be=_0x265999[_0x57b840];return _0x5e94be;},a14_0x2007(_0x181004,_0x53af41);}export async function getEloHistoryD2(_0x47dee0=0x14){const _0x39d25e=a14_0x42f935;try{const _0x4a2598=collection(db,'eloHistoryD2');let _0xf063d3;lastVisibleD2?_0xf063d3=query(_0x4a2598,orderBy('timestamp','desc'),startAfter(lastVisibleD2),limit(_0x47dee0)):_0xf063d3=query(_0x4a2598,orderBy('timestamp','desc'),limit(_0x47dee0));const _0x4e45b3=await getDocs(_0xf063d3);if(_0x4e45b3['empty'])return{'entries':[],'hasMore':![]};lastVisibleD2=_0x4e45b3[_0x39d25e(0x1c6)][_0x4e45b3['docs']['length']-0x1];const _0x37832b=_0x4e45b3[_0x39d25e(0x1c6)][_0x39d25e(0x1ba)](async _0x29a297=>{const _0x442ecc=_0x39d25e,_0x300735=_0x29a297['data'](),[_0x1171f4,_0x185a3d]=await Promise[_0x442ecc(0x1c2)]([getUsernameByIdD2(_0x300735[_0x442ecc(0x1c0)]),getUsernameByIdD2(_0x300735[_0x442ecc(0x1c3)])]);return{..._0x300735,'playerUsername':_0x1171f4,'opponentUsername':_0x185a3d,'change':_0x300735[_0x442ecc(0x1bf)]-_0x300735['previousElo'],'timestamp':_0x300735[_0x442ecc(0x1b1)]};}),_0x453ead=await Promise['all'](_0x37832b);return{'entries':_0x453ead,'hasMore':_0x4e45b3['size']===_0x47dee0};}catch(_0x3239b1){console['error']('Error\x20fetching\x20D2\x20ELO\x20history:',_0x3239b1);throw _0x3239b1;}}export function resetPaginationD2(){lastVisibleD2=null;}
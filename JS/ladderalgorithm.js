(function(a,b){const w=a30b,c=a();while(!![]){try{const d=-parseInt(w(0x1d2))/0x1+-parseInt(w(0x1df))/0x2+-parseInt(w(0x1e6))/0x3*(-parseInt(w(0x1d1))/0x4)+-parseInt(w(0x1c0))/0x5+parseInt(w(0x1da))/0x6+parseInt(w(0x1ca))/0x7+-parseInt(w(0x1c8))/0x8*(-parseInt(w(0x1c2))/0x9);if(d===b)break;else c['push'](c['shift']());}catch(e){c['push'](c['shift']());}}}(a30a,0xda44c));import{collection,doc,getDoc,getDocs,updateDoc,setDoc,deleteDoc,writeBatch,query,where,serverTimestamp,addDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';import{recordEloChange}from'./elo-history.js';import{promotionManager,checkAndRecordPromotion}from'./promotions.js';import{isAdmin}from'./admin-check.js';function a30b(a,b){const c=a30a();return a30b=function(d,e){d=d-0x1ba;let f=c[d];if(a30b['tPKhBf']===undefined){var g=function(l){const m='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let n='',o='';for(let p=0x0,q,r,s=0x0;r=l['charAt'](s++);~r&&(q=p%0x4?q*0x40+r:r,p++%0x4)?n+=String['fromCharCode'](0xff&q>>(-0x2*p&0x6)):0x0){r=m['indexOf'](r);}for(let t=0x0,u=n['length'];t<u;t++){o+='%'+('00'+n['charCodeAt'](t)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(o);};a30b['zjNyVV']=g,a=arguments,a30b['tPKhBf']=!![];}const h=c[0x0],i=d+h,j=a[i];return!j?(f=a30b['zjNyVV'](f),a[i]=f):f=j,f;},a30b(a,b);}export function calculateElo(a,b,c=0x20){const x=a30b,d=0x1/(0x1+Math[x(0x1e2)](0xa,(b-a)/0x190)),e=0x1/(0x1+Math[x(0x1e2)](0xa,(a-b)/0x190)),f=a+c*(0x1-d),g=b+c*(0x0-e);return{'newWinnerRating':Math[x(0x1c1)](f),'newLoserRating':Math['round'](g)};}export function assignDefaultEloRating(a,b){const y=a30b,c=0x4b0;!b['eloRating']&&db['collection']('players')[y(0x1db)](a)['update']({'eloRating':c})[y(0x1e4)](()=>{const z=y;console[z(0x1d3)]('Assigned\x20default\x20ELO\x20rating\x20to\x20player\x20'+b[z(0x1d4)]);})['catch'](d=>{console['error']('Error\x20assigning\x20default\x20ELO\x20rating:',d);});}export async function updateEloRatings(a,b,c){const A=a30b;try{const d=writeBatch(db),e=doc(db,A(0x1d0),a),f=doc(db,'players',b),[g,h]=await Promise['all']([getDoc(e),getDoc(f)]);if(!g['exists']()||!h[A(0x1ba)]())throw new Error('One\x20or\x20both\x20players\x20not\x20found');const i=g[A(0x1cc)](),j=h['data'](),k=i['position']||Number[A(0x1bf)],l=j['position']||Number[A(0x1bf)],{newWinnerRating:m,newLoserRating:n}=calculateElo(i['eloRating']||0x4b0,j['eloRating']||0x4b0);let o=k,p=l;if(k>l){console[A(0x1d3)](A(0x1c6)),o=l,p=l+0x1;const s=query(collection(db,'players'),where(A(0x1d9),'>',l),where(A(0x1d9),'<',k)),t=await getDocs(s);for(const u of t['docs']){u['id']!==a&&u['id']!==b&&d[A(0x1cb)](doc(db,A(0x1d0),u['id']),{'position':u['data']()['position']+0x1});}}else console[A(0x1d3)](A(0x1d8));const q={'eloRating':m,'lastMatchDate':serverTimestamp(),'position':o,'lastMatchId':c},r={'eloRating':n,'lastMatchDate':serverTimestamp(),'position':p,'lastMatchId':c};return d['update'](e,q),d['update'](f,r),await d[A(0x1cf)](),console['log']('ELO\x20ratings\x20updated\x20successfully'),await Promise['all']([recordEloChange({'playerId':a,'previousElo':i[A(0x1bb)]||0x4b0,'newElo':m,'opponentId':b,'matchResult':'win','previousPosition':k,'newPosition':o,'isPromotion':o<k,'matchId':c,'timestamp':serverTimestamp()}),recordEloChange({'playerId':b,'previousElo':j[A(0x1bb)]||0x4b0,'newElo':n,'opponentId':a,'matchResult':'loss','previousPosition':l,'newPosition':p,'isDemotion':p>l,'matchId':c,'timestamp':serverTimestamp()})]),await promotionManager[A(0x1e7)](a,m,i['eloRating'],{'source':A(0x1c4),'matchId':c}),await promotionManager[A(0x1e7)](b,n,j['eloRating'],{'source':A(0x1c4),'matchId':c}),console[A(0x1d3)]('ELO\x20ratings\x20and\x20positions\x20updated\x20successfully'),!![];}catch(v){console['error'](A(0x1de),v);throw v;}}export async function approveReport(a,b,c,d,e){const B=a30b;try{const f=doc(db,B(0x1ce),a),g=await getDoc(f);if(!g[B(0x1ba)]())throw new Error(B(0x1dc));const h=g['data'](),i={...h,'winnerScore':b,'winnerSuicides':c,'winnerComment':d,'winnerDemoLink':e,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':auth['currentUser'][B(0x1e5)]};await setDoc(doc(db,B(0x1bd),a),i),await deleteDoc(f),console[B(0x1d3)](B(0x1e0));const [j,k]=await Promise[B(0x1be)]([getDocs(query(collection(db,B(0x1d0)),where('username','==',h['winnerUsername']))),getDocs(query(collection(db,B(0x1d0)),where('username','==',h['loserUsername'])))]);if(j[B(0x1c7)]||k['empty'])throw new Error(B(0x1cd));const l=j['docs'][0x0]['id'],m=k[B(0x1dd)][0x0]['id'];return await updateEloRatings(l,m,a),console['log'](B(0x1d6)),!![];}catch(n){console['error']('Error\x20approving\x20report:',n);throw n;}}async function updatePlayerElo(a,b,c){const C=a30b;await setDoc(doc(db,C(0x1d0),a),{...playerData,'eloRating':c}),await checkAndRecordPromotion(a,c,b);}async function updatePlayerStats(a,b,c){const D=a30b,d=doc(db,D(0x1c9),a),e=await getDoc(d);let f=e[D(0x1ba)]()?e[D(0x1cc)]():{'wins':0x0,'losses':0x0,'totalKills':0x0,'totalDeaths':0x0,'winRate':0x0};c?(f['wins']++,f['totalKills']+=parseInt(b[D(0x1c5)]||0x0),f[D(0x1e1)]+=parseInt(b['loserScore']||0x0)):(f[D(0x1d5)]++,f[D(0x1e3)]+=parseInt(b['loserScore']||0x0),f[D(0x1e1)]+=parseInt(b['winnerScore']||0x0));const g=f['wins']+f[D(0x1d5)];f[D(0x1bc)]=g>0x0?(f['wins']/g*0x64)[D(0x1c3)](0x1):0x0,f['lastUpdated']=new Date()[D(0x1d7)](),await setDoc(d,f,{'merge':!![]});}function a30a(){const E=['CgXHEwvYu3rHDhm','mtG2mdi5owjPtu1Iwq','DxbKyxrL','zgf0yq','q291BgqGBM90igzPBMqGCgXHEwvYigrVy3vTzw50CW','CgvUzgLUz01HDgnOzxm','y29TBwL0','CgXHEwvYCW','ndq4senor21f','mtm2nZq0zNrnA3n0','Bg9N','DxnLCM5HBwu','Bg9ZC2vZ','twf0y2GGC3vJy2vZC2z1BgX5igfWChjVDMvKigfUzcbfte8GDxbKyxrLza','Dg9ju09tDhjPBMC','v2LUBMvYigfSCMvHzhKGCMfUA2vKigHPz2HLCIaTigTLzxbPBMCGCg9ZAxrPB25Z','Cg9ZAxrPB24','nZy1odCYng1Trw1MvG','zg9J','uMvWB3j0ig5VDcbMB3vUza','zg9JCW','rxjYB3iGAw4GDxbKyxrLrwXVuMf0Aw5NCZO','mtiYmtm1ofrdC1HrDG','twf0y2GGBw92zwqGDg8GyxbWCM92zwqGy29SBgvJDgLVBG','Dg90ywXezwf0Ahm','Cg93','Dg90ywXlAwXSCW','DgHLBG','DwLK','mty5mtDkD0vJuwW','y2HLy2TbBMrszwnVCMrqCM9TB3rPB24','zxHPC3rZ','zwXVuMf0Aw5N','D2LUuMf0zq','yxbWCM92zwrnyxrJAgvZ','ywXS','tufyx1nbrKvFsu5uruDfuG','odeYmJaWnxvpD01tAa','CM91BMq','ovHyvKDLDa','Dg9gAxHLza','Bwf0y2G','D2LUBMvYu2nVCMu','ug9ZAxrPB24GC3DHCcbUzwvKzwqGlsb3Aw5UzxiGD2fZigXVD2vYihjHBMTLza','zw1WDhK','odCZnJu4ng9xCK9xta'];a30a=function(){return E;};return a30a();}
const a10_0x5c7e9a=(function(){let _0xe296c3=!![];return function(_0xf3ca2f,_0x41ebf4){const _0x359523=_0xe296c3?function(){if(_0x41ebf4){const _0x3d4119=_0x41ebf4['apply'](_0xf3ca2f,arguments);return _0x41ebf4=null,_0x3d4119;}}:function(){};return _0xe296c3=![],_0x359523;};}()),a10_0x567afa=a10_0x5c7e9a(this,function(){const _0x8ca688=a10_0x2228,_0x1746f3=function(){let _0x2428d4;try{_0x2428d4=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x5923d9){_0x2428d4=window;}return _0x2428d4;},_0x1f7ff5=_0x1746f3(),_0x33da92=_0x1f7ff5['console']=_0x1f7ff5['console']||{},_0x178f7e=['log','warn','info','error','exception','table','trace'];for(let _0x53f20b=0x0;_0x53f20b<_0x178f7e['length'];_0x53f20b++){const _0x2b0ddc=a10_0x5c7e9a[_0x8ca688(0xd7)][_0x8ca688(0xdd)][_0x8ca688(0xd8)](a10_0x5c7e9a),_0xa617b7=_0x178f7e[_0x53f20b],_0x8df4c7=_0x33da92[_0xa617b7]||_0x2b0ddc;_0x2b0ddc['__proto__']=a10_0x5c7e9a[_0x8ca688(0xd8)](a10_0x5c7e9a),_0x2b0ddc['toString']=_0x8df4c7['toString'][_0x8ca688(0xd8)](_0x8df4c7),_0x33da92[_0xa617b7]=_0x2b0ddc;}});a10_0x567afa();import{getAuth,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{doc,getDoc,collection,query,where,getDocs,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import{isAdmin}from'./admin-check.js';const ADMIN_EMAILS=['admin@ladder.com','Brian2af@outlook.com'],userCache={'uid':null,'username':null,'isAdmin':![],'hasCheckedCollections':![],'lastChecked':0x0,'role':null},invitationCache={'lastCheck':0x0,'pendingCount':0x0,'checkInterval':0x493e0};function updateInboxNotification(_0x561656){const _0x438f64=a10_0x2228,_0x375c92=document[_0x438f64(0xe9)]('inbox-notification');_0x375c92&&(_0x561656>0x0?(_0x375c92['style']['display']=_0x438f64(0xe3),_0x375c92[_0x438f64(0xf3)]=_0x561656>0x9?'9+':_0x561656):_0x375c92[_0x438f64(0xf7)]['display']=_0x438f64(0xe5));}async function checkPendingInvitationsForCurrentUser(_0x2e009f){const _0x19b1bd=a10_0x2228;try{const _0x3757fa=Date['now']();if(_0x3757fa-invitationCache['lastCheck']<invitationCache['checkInterval'])return updateInboxNotification(invitationCache['pendingCount']),invitationCache[_0x19b1bd(0xec)];invitationCache[_0x19b1bd(0xe6)]=_0x3757fa;const _0x4e4d9d=collection(db,'gameInvitations'),_0x28553d=query(_0x4e4d9d,where('toUserId','==',_0x2e009f),where(_0x19b1bd(0xeb),'==','pending'),limit(0x5)),_0x520db2=await getDocs(_0x28553d),_0x11fc26=_0x520db2['size'];return invitationCache['pendingCount']=_0x11fc26,updateInboxNotification(_0x11fc26),_0x11fc26;}catch(_0x16e0e9){return console[_0x19b1bd(0xf9)]('Could\x20not\x20check\x20pending\x20invitations\x20for\x20current\x20user:',_0x16e0e9),0x0;}}function updateAuthSectionImmediate(_0x370f44,_0x43cb56=![]){const _0x206e2a=a10_0x2228,_0x4ae614=document['getElementById']('auth-section');if(!_0x4ae614)return;if(_0x370f44&&_0x43cb56)document['querySelectorAll'](_0x206e2a(0xe8))['forEach'](_0xd93e7d=>{_0xd93e7d['style']['display']='block';});else!_0x370f44&&document['querySelectorAll']('.admin-only')[_0x206e2a(0xe1)](_0xd5bd72=>{_0xd5bd72['style']['display']='none';});if(_0x370f44){const _0x5becfc=userCache[_0x206e2a(0xfc)]||(_0x370f44[_0x206e2a(0xdf)]?_0x370f44['email']['split']('@')[0x0]:'User'),_0x436b6d=userCache['role']?'\x20('+userCache[_0x206e2a(0xf1)]+')':_0x43cb56?'\x20(Admin)':'';_0x4ae614['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20class=\x22nav-username\x22>'+_0x5becfc+_0x436b6d+_0x206e2a(0xee)+encodeURIComponent(_0x5becfc)+'\x22>Profile</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./inbox.html\x22\x20class=\x22nav-notification\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Inbox\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22inbox-notification\x22\x20class=\x22notification-dot\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22members.html\x22>Members</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./redeem.html\x22><i\x20class=\x22fas\x20fa-gift\x22></i>Store</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20id=\x22logout-link\x22>Sign\x20Out</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';const _0x1276ce=document['getElementById'](_0x206e2a(0xe0));_0x1276ce&&_0x1276ce[_0x206e2a(0xdc)]('click',_0x2e4126=>{_0x2e4126['preventDefault']();const _0x8ad01f=getAuth();updateAuthSectionImmediate(null),_0x8ad01f['signOut']()['catch'](_0x25be60=>{console['error']('Error\x20signing\x20out:',_0x25be60);});}),_0x370f44['uid']&&setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0x370f44['uid']);},0x3e8);}else _0x4ae614[_0x206e2a(0xfd)]='<a\x20href=\x22login.html\x22\x20class=\x22login-link\x22>Login</a>';}async function checkAdminRoles(_0x1c9041){const _0xc5acb5=a10_0x2228;if(!_0x1c9041||!_0x1c9041['email'])return{'isAdmin':![],'role':null};try{console['log']('Checking\x20roles\x20for\x20user:\x20'+_0x1c9041['email']);const _0x5ea35b=['players','playersD2',_0xc5acb5(0xf8),_0xc5acb5(0xfa),'userProfiles'],_0x548542=['council',_0xc5acb5(0xea),'owner','admin'];for(const _0x10011b of _0x5ea35b){try{const _0x3c61a8=doc(db,_0x10011b,_0x1c9041[_0xc5acb5(0xed)]),_0x3710c0=await getDoc(_0x3c61a8);if(_0x3710c0[_0xc5acb5(0xda)]()){const _0x32162d=_0x3710c0['data']();console['log']('Found\x20user\x20in\x20'+_0x10011b+'\x20by\x20UID:',_0x32162d);let _0x8db034=(_0x32162d['roleName']||_0x32162d[_0xc5acb5(0xf1)]||'')['toLowerCase'](),_0x458bde=_0x32162d['roleName']||_0x32162d['role']||'';if(_0x8db034&&_0x548542[_0xc5acb5(0xef)](_0x8db034)){console['log'](_0xc5acb5(0xf5)+_0x8db034+_0xc5acb5(0xf0)+_0x10011b);const _0x354086=_0x458bde[_0xc5acb5(0xf2)]('\x20')['map'](_0x411c48=>_0x411c48['charAt'](0x0)['toUpperCase']()+_0x411c48['slice'](0x1)['toLowerCase']())['join']('\x20');return{'isAdmin':!![],'role':_0x354086};}}}catch(_0x3a5fa0){console[_0xc5acb5(0xf4)](_0xc5acb5(0x100)+_0x10011b+_0xc5acb5(0xde),_0x3a5fa0);}}for(const _0x39ea56 of _0x5ea35b){try{const _0xc6552e=collection(db,_0x39ea56);let _0x533c31=query(_0xc6552e,where('email','==',_0x1c9041['email'])),_0x42edd1=await getDocs(_0x533c31);_0x42edd1['empty']&&(_0x533c31=query(_0xc6552e,where('email','==',_0x1c9041['email']['toLowerCase']())),_0x42edd1=await getDocs(_0x533c31));if(!_0x42edd1[_0xc5acb5(0xd9)]){const _0x48d30a=_0x42edd1['docs'][0x0]['data']();console['log']('Found\x20user\x20in\x20'+_0x39ea56+'\x20by\x20email:',_0x48d30a);let _0x2c02d0=(_0x48d30a['roleName']||_0x48d30a[_0xc5acb5(0xf1)]||'')['toLowerCase'](),_0x89834f=_0x48d30a['roleName']||_0x48d30a['role']||'';if(_0x2c02d0&&_0x548542['includes'](_0x2c02d0)){console[_0xc5acb5(0xfe)]('Found\x20admin\x20role:\x20'+_0x2c02d0+_0xc5acb5(0xf0)+_0x39ea56);const _0x2e11bd=_0x89834f['split']('\x20')['map'](_0x3e84c6=>_0x3e84c6['charAt'](0x0)['toUpperCase']()+_0x3e84c6['slice'](0x1)['toLowerCase']())['join']('\x20');return{'isAdmin':!![],'role':_0x2e11bd};}}}catch(_0xd5de37){console['error'](_0xc5acb5(0x100)+_0x39ea56+_0xc5acb5(0xdb),_0xd5de37);}}return console['log']('No\x20admin\x20roles\x20found\x20for\x20user'),{'isAdmin':![],'role':null};}catch(_0x28201){return console['error']('Error\x20in\x20checkAdminRoles:',_0x28201),{'isAdmin':![],'role':null};}}function a10_0x3d3c(){const _0x377929=['currentUser','constructor','bind','empty','exists','\x20by\x20email:','addEventListener','prototype','\x20by\x20UID:','email','logout-link','forEach','isAdmin','inline-block','visibilitychange','none','lastCheck','querySelectorAll','.admin-only','getElementById','creative\x20lead','status','pendingCount','uid','</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username=','includes','\x20in\x20','role','split','textContent','error','Found\x20admin\x20role:\x20','lastChecked','style','playersD3','warn','nonParticipants','target','username','innerHTML','log','data','Error\x20checking\x20'];a10_0x3d3c=function(){return _0x377929;};return a10_0x3d3c();}async function updateAuthSection(_0x4f4cd6){const _0x5cbf77=a10_0x2228,_0x3c8637=_0x4f4cd6&&isAdmin(_0x4f4cd6['email']);updateAuthSectionImmediate(_0x4f4cd6,_0x3c8637);if(!_0x4f4cd6){userCache['uid']=null,userCache['username']=null,userCache['isAdmin']=![],userCache['hasCheckedCollections']=![],userCache['role']=null;return;}const _0x5c2fc2=Date['now']();if(_0x4f4cd6[_0x5cbf77(0xed)]===userCache[_0x5cbf77(0xed)]&&userCache['hasCheckedCollections']&&_0x5c2fc2-userCache[_0x5cbf77(0xf6)]<0x493e0)return;try{userCache['uid']=_0x4f4cd6['uid'],userCache['lastChecked']=_0x5c2fc2;const _0x3f725d=isAdmin(_0x4f4cd6['email']);userCache[_0x5cbf77(0xe2)]=_0x3f725d;if(!_0x3f725d){const {isAdmin:_0x381df7,role:_0x3176a8}=await checkAdminRoles(_0x4f4cd6);userCache['isAdmin']=_0x381df7,userCache['role']=_0x3176a8,_0x381df7&&(document[_0x5cbf77(0xe7)]('.admin-only')['forEach'](_0x4602b4=>{_0x4602b4['style']['display']='block';}),updateAuthSectionImmediate(_0x4f4cd6,!![]));}const _0x3c8e94=['players','playersD2','playersD3','playersDuos','playersCTF','nonParticipants','userProfiles'],_0x5be801=_0x3c8e94['map'](_0x5566b8=>getDoc(doc(db,_0x5566b8,_0x4f4cd6[_0x5cbf77(0xed)]))['then'](_0x126bca=>_0x126bca[_0x5cbf77(0xda)]()?{'collection':_0x5566b8,'data':_0x126bca[_0x5cbf77(0xff)]()}:null)['catch'](()=>null)),_0x414419=await Promise['all'](_0x5be801),_0x568035=_0x414419['filter'](_0x361423=>_0x361423!==null);let _0xae59ba=null;for(const _0x5dc517 of _0x568035){if(_0x5dc517['data']['username']){_0xae59ba=_0x5dc517[_0x5cbf77(0xff)]['username'];break;}}userCache['username']=_0xae59ba||(_0x4f4cd6['email']?_0x4f4cd6['email']['split']('@')[0x0]:'User'),userCache['hasCheckedCollections']=!![],updateAuthSectionImmediate(_0x4f4cd6,userCache['isAdmin']),setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0x4f4cd6['uid']);},0x1f4);}catch(_0x2df146){console['error']('Error\x20in\x20full\x20auth\x20update:',_0x2df146);}}document['addEventListener']('DOMContentLoaded',()=>{const _0x2183d2=a10_0x2228,_0x21f9c9=getAuth();onAuthStateChanged(_0x21f9c9,async _0x2c8dbd=>{await updateAuthSection(_0x2c8dbd),_0x2c8dbd&&checkPendingInvitationsForCurrentUser(_0x2c8dbd['uid']);}),document['addEventListener'](_0x2183d2(0xe4),()=>{const _0xba1bca=_0x2183d2;!document['hidden']&&_0x21f9c9['currentUser']&&checkPendingInvitationsForCurrentUser(_0x21f9c9[_0xba1bca(0xd6)][_0xba1bca(0xed)]);}),document['addEventListener']('click',_0x1b5650=>{const _0x205743=_0x2183d2;_0x1b5650[_0x205743(0xfb)]['closest']('a[href]')&&_0x21f9c9['currentUser']&&checkPendingInvitationsForCurrentUser(_0x21f9c9[_0x205743(0xd6)][_0x205743(0xed)]);});});function a10_0x2228(_0x581324,_0x455590){const _0x567afa=a10_0x3d3c();return a10_0x2228=function(_0x5c7e9a,_0x576a1e){_0x5c7e9a=_0x5c7e9a-0xd6;let _0x3d3c24=_0x567afa[_0x5c7e9a];return _0x3d3c24;},a10_0x2228(_0x581324,_0x455590);}export{updateAuthSection};
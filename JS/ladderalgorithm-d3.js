(function(_0x449c66,_0x2f6674){const _0x1a3fb9=a29_0x1b4a,_0x5e6225=_0x449c66();while(!![]){try{const _0x4b41e4=-parseInt(_0x1a3fb9(0xdb))/0x1*(-parseInt(_0x1a3fb9(0xbf))/0x2)+parseInt(_0x1a3fb9(0xb2))/0x3+-parseInt(_0x1a3fb9(0xbb))/0x4+-parseInt(_0x1a3fb9(0xac))/0x5*(parseInt(_0x1a3fb9(0xc5))/0x6)+-parseInt(_0x1a3fb9(0xdc))/0x7+parseInt(_0x1a3fb9(0xb1))/0x8+-parseInt(_0x1a3fb9(0xb0))/0x9*(-parseInt(_0x1a3fb9(0xa9))/0xa);if(_0x4b41e4===_0x2f6674)break;else _0x5e6225['push'](_0x5e6225['shift']());}catch(_0x56d039){_0x5e6225['push'](_0x5e6225['shift']());}}}(a29_0x2283,0x94fde));const a29_0x514770=(function(){let _0x33fae6=!![];return function(_0xdd78ac,_0x5c52fb){const _0x32db20=_0x33fae6?function(){const _0x242564=a29_0x1b4a;if(_0x5c52fb){const _0x151947=_0x5c52fb[_0x242564(0xc1)](_0xdd78ac,arguments);return _0x5c52fb=null,_0x151947;}}:function(){};return _0x33fae6=![],_0x32db20;};}()),a29_0x358dcb=a29_0x514770(this,function(){const _0x22f1db=a29_0x1b4a;return a29_0x358dcb[_0x22f1db(0xb7)]()[_0x22f1db(0xd1)](_0x22f1db(0xc4))[_0x22f1db(0xb7)]()[_0x22f1db(0xb8)](a29_0x358dcb)[_0x22f1db(0xd1)](_0x22f1db(0xc4));});function a29_0x2283(){const _0x5c73f7=['username','return\x20(function()\x20','D3\x20ELO\x20ratings\x20updated\x20successfully','docs','30xUUPiL','approvedMatchesD3','Current\x20username:','5ojatzn','log','update','exception','3528387BHGfcG','1526864jYVaxZ','1468401vKfdzo','error','empty','D3\x20Report\x20data:','round','toString','constructor','uid','prototype','1019096uRNCmd','exists','No\x20user\x20logged\x20in','MAX_SAFE_INTEGER','2858ZraEjH','position','apply','One\x20or\x20both\x20D3\x20players\x20not\x20found','length','(((.+)+)+)+$','4097322EEWHGX','D3\x20Match\x20successfully\x20approved\x20and\x20ELO\x20updated','Only\x20the\x20winner\x20can\x20approve\x20D3\x20matches','Error\x20in\x20approveReportD3:','winnerUsername','D3\x20Report\x20not\x20found\x20with\x20ID:','eloRating','bind','email','pendingMatchesD3','{}.constructor(\x22return\x20this\x22)(\x20)','playersD3','search','pow','commit','D3\x20Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked','info','D3\x20Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions','trace','warn','You\x20must\x20be\x20logged\x20in\x20to\x20approve\x20D3\x20matches','Current\x20user:','226XRqSEQ','4420339CJQdgk','data','currentUser','Could\x20not\x20find\x20D3\x20player\x20documents','win','createdAt','loserUsername','console','all','table'];a29_0x2283=function(){return _0x5c73f7;};return a29_0x2283();}a29_0x358dcb();const a29_0x46a260=(function(){let _0x3055d0=!![];return function(_0x228e3c,_0x1726c2){const _0x4abffc=_0x3055d0?function(){const _0x470b56=a29_0x1b4a;if(_0x1726c2){const _0x236bb9=_0x1726c2[_0x470b56(0xc1)](_0x228e3c,arguments);return _0x1726c2=null,_0x236bb9;}}:function(){};return _0x3055d0=![],_0x4abffc;};}()),a29_0x2d84b3=a29_0x46a260(this,function(){const _0x55d910=a29_0x1b4a;let _0x310cee;try{const _0x4b59d9=Function(_0x55d910(0xa6)+_0x55d910(0xcf)+');');_0x310cee=_0x4b59d9();}catch(_0x820ca5){_0x310cee=window;}const _0x1ce9be=_0x310cee[_0x55d910(0xa2)]=_0x310cee[_0x55d910(0xa2)]||{},_0x3933de=[_0x55d910(0xad),_0x55d910(0xd8),_0x55d910(0xd5),_0x55d910(0xb3),_0x55d910(0xaf),_0x55d910(0xa4),_0x55d910(0xd7)];for(let _0xfd82e8=0x0;_0xfd82e8<_0x3933de[_0x55d910(0xc3)];_0xfd82e8++){const _0x436e96=a29_0x46a260[_0x55d910(0xb8)][_0x55d910(0xba)]['bind'](a29_0x46a260),_0x43ae15=_0x3933de[_0xfd82e8],_0x4fae1e=_0x1ce9be[_0x43ae15]||_0x436e96;_0x436e96['__proto__']=a29_0x46a260[_0x55d910(0xcc)](a29_0x46a260),_0x436e96[_0x55d910(0xb7)]=_0x4fae1e[_0x55d910(0xb7)][_0x55d910(0xcc)](_0x4fae1e),_0x1ce9be[_0x43ae15]=_0x436e96;}});a29_0x2d84b3();import{addDoc,updateDoc,serverTimestamp,collection,doc,getDoc,getDocs,query,where,setDoc,deleteDoc,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';import{recordEloChangeD3}from'./elo-history-d3.js';function a29_0x1b4a(_0x39efe1,_0x51e5b1){const _0x5d3a17=a29_0x2283();return a29_0x1b4a=function(_0x2d84b3,_0x46a260){_0x2d84b3=_0x2d84b3-0xa1;let _0x2a688b=_0x5d3a17[_0x2d84b3];return _0x2a688b;},a29_0x1b4a(_0x39efe1,_0x51e5b1);}export function calculateEloD3(_0xb45d09,_0x39e9e5,_0x83b64=0x20){const _0x17b329=a29_0x1b4a,_0x5cd9c9=0x1/(0x1+Math[_0x17b329(0xd2)](0xa,(_0x39e9e5-_0xb45d09)/0x190)),_0x2911b5=0x1/(0x1+Math['pow'](0xa,(_0xb45d09-_0x39e9e5)/0x190)),_0x3e3980=_0xb45d09+_0x83b64*(0x1-_0x5cd9c9),_0x241622=_0x39e9e5+_0x83b64*(0x0-_0x2911b5);return{'newWinnerRating':Math[_0x17b329(0xb6)](_0x3e3980),'newLoserRating':Math[_0x17b329(0xb6)](_0x241622)};}export async function updateEloRatingsD3(_0x108c9a,_0x43a8b3,_0x2dd9f0){const _0x157791=a29_0x1b4a;try{const _0x52d614=writeBatch(db),_0x376ca8=doc(db,'playersD3',_0x108c9a),_0x4017ea=doc(db,_0x157791(0xd0),_0x43a8b3),[_0xe2205,_0x43f8ed]=await Promise['all']([getDoc(_0x376ca8),getDoc(_0x4017ea)]);if(!_0xe2205[_0x157791(0xbc)]()||!_0x43f8ed[_0x157791(0xbc)]())throw new Error(_0x157791(0xc2));const _0x4e591b=_0xe2205[_0x157791(0xdd)](),_0x12edf1=_0x43f8ed[_0x157791(0xdd)](),_0x5c47db=_0x4e591b[_0x157791(0xc0)]||Number[_0x157791(0xbe)],_0x1fa4cd=_0x12edf1[_0x157791(0xc0)]||Number['MAX_SAFE_INTEGER'],{newWinnerRating:_0x1bca12,newLoserRating:_0x515e15}=calculateEloD3(_0x4e591b[_0x157791(0xcb)]||0x4b0,_0x12edf1['eloRating']||0x4b0);let _0x2f7a8f=_0x5c47db,_0x3b8869=_0x1fa4cd;if(_0x5c47db>_0x1fa4cd){console[_0x157791(0xad)](_0x157791(0xd4)),_0x2f7a8f=_0x1fa4cd,_0x3b8869=_0x1fa4cd+0x1;const _0x2f39f3=query(collection(db,_0x157791(0xd0)),where(_0x157791(0xc0),'>',_0x1fa4cd),where(_0x157791(0xc0),'<',_0x5c47db)),_0xcdfe06=await getDocs(_0x2f39f3);for(const _0x42be64 of _0xcdfe06[_0x157791(0xa8)]){_0x42be64['id']!==_0x108c9a&&_0x42be64['id']!==_0x43a8b3&&_0x52d614[_0x157791(0xae)](doc(db,'playersD3',_0x42be64['id']),{'position':_0x42be64[_0x157791(0xdd)]()['position']+0x1});}}else console[_0x157791(0xad)](_0x157791(0xd6));return _0x52d614[_0x157791(0xae)](_0x376ca8,{'eloRating':_0x1bca12,'lastMatchDate':serverTimestamp(),'position':_0x2f7a8f,'lastMatchId':_0x2dd9f0}),_0x52d614[_0x157791(0xae)](_0x4017ea,{'eloRating':_0x515e15,'lastMatchDate':serverTimestamp(),'position':_0x3b8869,'lastMatchId':_0x2dd9f0}),await _0x52d614[_0x157791(0xd3)](),console[_0x157791(0xad)](_0x157791(0xa7)),await Promise[_0x157791(0xa3)]([recordEloChangeD3({'playerId':_0x108c9a,'previousElo':_0x4e591b[_0x157791(0xcb)]||0x4b0,'newElo':_0x1bca12,'opponentId':_0x43a8b3,'matchResult':_0x157791(0xe0),'previousPosition':_0x5c47db,'newPosition':_0x2f7a8f,'isPromotion':_0x2f7a8f<_0x5c47db,'matchId':_0x2dd9f0,'timestamp':serverTimestamp()}),recordEloChangeD3({'playerId':_0x43a8b3,'previousElo':_0x12edf1[_0x157791(0xcb)]||0x4b0,'newElo':_0x515e15,'opponentId':_0x108c9a,'matchResult':'loss','previousPosition':_0x1fa4cd,'newPosition':_0x3b8869,'isDemotion':_0x3b8869>_0x1fa4cd,'matchId':_0x2dd9f0,'timestamp':serverTimestamp()})]),!![];}catch(_0x326448){console[_0x157791(0xb3)]('Error\x20in\x20updateEloRatingsD3:',_0x326448);throw _0x326448;}}export async function approveReportD3(_0x2d8e21,_0x3112f5,_0x347550,_0x1a1815){const _0x41f4ca=a29_0x1b4a;try{console['log']('Starting\x20approveReportD3\x20function\x20with:',{'reportId':_0x2d8e21,'winnerScore':_0x3112f5,'winnerSuicides':_0x347550,'winnerComment':_0x1a1815});const _0x5c16ab=auth[_0x41f4ca(0xde)];if(!_0x5c16ab){console['log'](_0x41f4ca(0xbd));throw new Error(_0x41f4ca(0xd9));}console['log'](_0x41f4ca(0xda),_0x5c16ab[_0x41f4ca(0xcd)]);const _0x39c9cd=await getDoc(doc(db,_0x41f4ca(0xd0),_0x5c16ab[_0x41f4ca(0xb9)])),_0x18645f=_0x39c9cd[_0x41f4ca(0xbc)]()?_0x39c9cd[_0x41f4ca(0xdd)]()[_0x41f4ca(0xa5)]:null;console['log'](_0x41f4ca(0xab),_0x18645f);const _0x47f19d=doc(db,_0x41f4ca(0xce),_0x2d8e21),_0x4e055e=await getDoc(_0x47f19d);if(!_0x4e055e['exists']()){console[_0x41f4ca(0xad)](_0x41f4ca(0xca),_0x2d8e21);throw new Error('D3\x20match\x20report\x20not\x20found');}const _0x1754ad=_0x4e055e[_0x41f4ca(0xdd)]();console[_0x41f4ca(0xad)](_0x41f4ca(0xb5),_0x1754ad);if(_0x18645f!==_0x1754ad[_0x41f4ca(0xc9)])throw new Error(_0x41f4ca(0xc7));const _0x214d41={..._0x1754ad,'winnerScore':_0x3112f5,'winnerSuicides':_0x347550,'winnerComment':_0x1a1815,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':_0x18645f,'createdAt':_0x1754ad[_0x41f4ca(0xe1)]||serverTimestamp(),'winnerUsername':_0x1754ad[_0x41f4ca(0xc9)],'loserUsername':_0x1754ad[_0x41f4ca(0xa1)]};await setDoc(doc(db,_0x41f4ca(0xaa),_0x2d8e21),_0x214d41),await deleteDoc(_0x47f19d),console[_0x41f4ca(0xad)]('D3\x20Match\x20moved\x20to\x20approved\x20collection');const [_0x580a7c,_0x464330]=await Promise[_0x41f4ca(0xa3)]([getDocs(query(collection(db,_0x41f4ca(0xd0)),where(_0x41f4ca(0xa5),'==',_0x1754ad[_0x41f4ca(0xc9)]))),getDocs(query(collection(db,_0x41f4ca(0xd0)),where(_0x41f4ca(0xa5),'==',_0x1754ad[_0x41f4ca(0xa1)])))]);if(_0x580a7c[_0x41f4ca(0xb4)]||_0x464330[_0x41f4ca(0xb4)])throw new Error(_0x41f4ca(0xdf));const _0x3b9aa5=_0x580a7c[_0x41f4ca(0xa8)][0x0]['id'],_0x4b56f2=_0x464330['docs'][0x0]['id'];return await updateEloRatingsD3(_0x3b9aa5,_0x4b56f2,_0x2d8e21),console[_0x41f4ca(0xad)](_0x41f4ca(0xc6)),!![];}catch(_0x530489){console[_0x41f4ca(0xb3)](_0x41f4ca(0xc8),_0x530489);throw _0x530489;}}
const a12_0x2c822d=a12_0x2be2,a12_0x1a7905=(function(){let _0x487cbe=!![];return function(_0x4b7807,_0x50bc44){const _0x1aaecc=_0x487cbe?function(){const _0x542d94=a12_0x2be2;if(_0x50bc44){const _0x184ff7=_0x50bc44[_0x542d94(0x1ec)](_0x4b7807,arguments);return _0x50bc44=null,_0x184ff7;}}:function(){};return _0x487cbe=![],_0x1aaecc;};}()),a12_0x24a53c=a12_0x1a7905(this,function(){const _0x56a2f1=a12_0x2be2,_0x4cafd4=function(){let _0x258c52;try{_0x258c52=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x4621a1){_0x258c52=window;}return _0x258c52;},_0x3ab4db=_0x4cafd4(),_0x58ec15=_0x3ab4db['console']=_0x3ab4db['console']||{},_0x530a7a=[_0x56a2f1(0x1f2),'warn',_0x56a2f1(0x1f7),'error','exception','table','trace'];for(let _0x7708d=0x0;_0x7708d<_0x530a7a['length'];_0x7708d++){const _0x5b0dda=a12_0x1a7905['constructor']['prototype'][_0x56a2f1(0x1ee)](a12_0x1a7905),_0x1071be=_0x530a7a[_0x7708d],_0x539bf0=_0x58ec15[_0x1071be]||_0x5b0dda;_0x5b0dda[_0x56a2f1(0x1fa)]=a12_0x1a7905[_0x56a2f1(0x1ee)](a12_0x1a7905),_0x5b0dda[_0x56a2f1(0x1fb)]=_0x539bf0['toString']['bind'](_0x539bf0),_0x58ec15[_0x1071be]=_0x5b0dda;}});a12_0x24a53c();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D2=[{'name':a12_0x2c822d(0x1f9),'elo':0x708},{'name':a12_0x2c822d(0x1f6),'elo':0x640},{'name':a12_0x2c822d(0x1eb),'elo':0x578},{'name':'Unranked','elo':0x4b0}];let lastVisibleD2=null;function a12_0x59ee(){const _0x23562a=['Bronze','apply','docs','bind','timestamp','empty','player','log','approvedMatchesD2','winnerUsername','data','Silver','info','Unknown\x20Player','Gold','__proto__','toString'];a12_0x59ee=function(){return _0x23562a;};return a12_0x59ee();}async function getUsernameByIdD2(_0x48e249){const _0x6edef0=a12_0x2c822d;try{if(!_0x48e249)return _0x6edef0(0x1f8);const _0x91a56c=await getDoc(doc(db,'playersD2',_0x48e249));if(_0x91a56c['exists']())return _0x91a56c['data']()['username']||'Unknown\x20Player';const _0x3c39f2=await getDocs(query(collection(db,'approvedMatchesD2'),where('winnerId','==',_0x48e249),limit(0x1)));if(!_0x3c39f2['empty'])return _0x3c39f2['docs'][0x0]['data']()[_0x6edef0(0x1f4)]||'Unknown\x20Player';const _0x2e84c9=await getDocs(query(collection(db,_0x6edef0(0x1f3)),where('loserId','==',_0x48e249),limit(0x1)));if(!_0x2e84c9[_0x6edef0(0x1f0)])return _0x2e84c9[_0x6edef0(0x1ed)][0x0][_0x6edef0(0x1f5)]()['loserUsername']||'Unknown\x20Player';return'Unknown\x20Player';}catch(_0x2de296){return console['error']('Error\x20getting\x20username:',_0x2de296),'Unknown\x20Player';}}function a12_0x2be2(_0x27af38,_0x40a057){const _0x24a53c=a12_0x59ee();return a12_0x2be2=function(_0x1a7905,_0x53a59d){_0x1a7905=_0x1a7905-0x1eb;let _0x59eedf=_0x24a53c[_0x1a7905];return _0x59eedf;},a12_0x2be2(_0x27af38,_0x40a057);}export async function recordEloChangeD2({playerId:_0xf1bb8,previousElo:_0x4c8205,newElo:_0x11bbf7,opponentId:_0x5b2c19,matchResult:_0x287c95,previousPosition:_0x29d54f,newPosition:_0x4615cc,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x5622fc,timestamp:_0x5236cf}){const _0x26facb=a12_0x2c822d;try{const _0x12a266=doc(collection(db,'eloHistoryD2'));let _0x2902f8='match';if(isPromotion)_0x2902f8='promotion';if(isDemotion)_0x2902f8='demotion';let _0x1ed696='Unranked';if(_0x11bbf7>=0x834)_0x1ed696='Emerald';else{if(_0x11bbf7>=0x708)_0x1ed696=_0x26facb(0x1f9);else{if(_0x11bbf7>=0x640)_0x1ed696=_0x26facb(0x1f6);else{if(_0x11bbf7>=0x578)_0x1ed696='Bronze';}}}return await setDoc(_0x12a266,{'type':_0x2902f8,'player':_0xf1bb8,'opponent':_0x5b2c19,'previousElo':_0x4c8205,'newElo':_0x11bbf7,'change':_0x11bbf7-_0x4c8205,'matchResult':_0x287c95,'previousPosition':_0x29d54f,'newPosition':_0x4615cc,'rankAchieved':_0x1ed696,'matchId':_0x5622fc,'timestamp':_0x5236cf}),console['log']('D2\x20ELO\x20history\x20recorded\x20for\x20'+_0xf1bb8),!![];}catch(_0x334c3c){console['error']('Error\x20recording\x20D2\x20ELO\x20history:',_0x334c3c);throw _0x334c3c;}}export async function getEloHistoryD2(_0x35aa87=0x14){const _0x4d9f0e=a12_0x2c822d;try{const _0x210bc6=collection(db,'eloHistoryD2');let _0x2640fe;lastVisibleD2?_0x2640fe=query(_0x210bc6,orderBy(_0x4d9f0e(0x1ef),'desc'),startAfter(lastVisibleD2),limit(_0x35aa87)):_0x2640fe=query(_0x210bc6,orderBy('timestamp','desc'),limit(_0x35aa87));const _0x193295=await getDocs(_0x2640fe);if(_0x193295['empty'])return{'entries':[],'hasMore':![]};lastVisibleD2=_0x193295['docs'][_0x193295['docs']['length']-0x1];const _0x2d7df6=_0x193295[_0x4d9f0e(0x1ed)]['map'](async _0x54400b=>{const _0xb70224=_0x4d9f0e,_0x17cc87=_0x54400b['data'](),[_0x1b874e,_0x1f15b0]=await Promise['all']([getUsernameByIdD2(_0x17cc87[_0xb70224(0x1f1)]),getUsernameByIdD2(_0x17cc87['opponent'])]);return{..._0x17cc87,'playerUsername':_0x1b874e,'opponentUsername':_0x1f15b0,'change':_0x17cc87['newElo']-_0x17cc87['previousElo'],'timestamp':_0x17cc87['timestamp']};}),_0x3b2956=await Promise['all'](_0x2d7df6);return{'entries':_0x3b2956,'hasMore':_0x193295['size']===_0x35aa87};}catch(_0x17300b){console['error']('Error\x20fetching\x20D2\x20ELO\x20history:',_0x17300b);throw _0x17300b;}}export function resetPaginationD2(){lastVisibleD2=null;}
const a15_0x197a8b=a15_0x5018;(function(_0x428108,_0x141946){const _0x5ca347=a15_0x5018,_0x1da631=_0x428108();while(!![]){try{const _0x3204fc=-parseInt(_0x5ca347(0x17d))/0x1+parseInt(_0x5ca347(0x188))/0x2*(parseInt(_0x5ca347(0x17a))/0x3)+parseInt(_0x5ca347(0x16c))/0x4+-parseInt(_0x5ca347(0x178))/0x5*(parseInt(_0x5ca347(0x18a))/0x6)+parseInt(_0x5ca347(0x182))/0x7+-parseInt(_0x5ca347(0x172))/0x8*(-parseInt(_0x5ca347(0x16a))/0x9)+-parseInt(_0x5ca347(0x16b))/0xa;if(_0x3204fc===_0x141946)break;else _0x1da631['push'](_0x1da631['shift']());}catch(_0x475eed){_0x1da631['push'](_0x1da631['shift']());}}}(a15_0x2d17,0x4d5b3));function a15_0x2d17(){const _0x2d9e88=['desc','Silver','search','warn','8TZwlyw','info','docs','bind','Unranked','empty','11240zPJaGU','newElo','129TJNXaJ','promotion','Emerald','284235eAdfrA','eloHistoryD3','loserUsername','opponent','player','2925489hIvVaT','winnerId','(((.+)+)+)+$','Error\x20recording\x20D3\x20ELO\x20history:','Bronze','length','2018zZufcE','username','888KuFviJ','log','winnerUsername','approvedMatchesD3','console','apply','map','constructor','toString','error','Unknown\x20Player','timestamp','playersD3','all','data','exists','exception','Error\x20fetching\x20D3\x20ELO\x20history:','372159KIicBI','1055940ymsVMr','2146876vHXjSw','__proto__'];a15_0x2d17=function(){return _0x2d9e88;};return a15_0x2d17();}const a15_0x3a8c84=(function(){let _0x5dbef5=!![];return function(_0x348db3,_0x11faf4){const _0x583446=_0x5dbef5?function(){const _0x249c72=a15_0x5018;if(_0x11faf4){const _0x50bf96=_0x11faf4[_0x249c72(0x15d)](_0x348db3,arguments);return _0x11faf4=null,_0x50bf96;}}:function(){};return _0x5dbef5=![],_0x583446;};}()),a15_0x13872f=a15_0x3a8c84(this,function(){const _0x51ecf9=a15_0x5018;return a15_0x13872f[_0x51ecf9(0x160)]()[_0x51ecf9(0x170)](_0x51ecf9(0x184))['toString']()['constructor'](a15_0x13872f)[_0x51ecf9(0x170)]('(((.+)+)+)+$');});a15_0x13872f();const a15_0x5bf697=(function(){let _0x1c1784=!![];return function(_0x2271e4,_0x465ad6){const _0x47b9d0=_0x1c1784?function(){const _0x48d289=a15_0x5018;if(_0x465ad6){const _0x33592f=_0x465ad6[_0x48d289(0x15d)](_0x2271e4,arguments);return _0x465ad6=null,_0x33592f;}}:function(){};return _0x1c1784=![],_0x47b9d0;};}()),a15_0x5c4e77=a15_0x5bf697(this,function(){const _0x3eab1d=a15_0x5018,_0x2d7d1f=function(){let _0x529869;try{_0x529869=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x171827){_0x529869=window;}return _0x529869;},_0x16a876=_0x2d7d1f(),_0x2b2b10=_0x16a876[_0x3eab1d(0x15c)]=_0x16a876[_0x3eab1d(0x15c)]||{},_0x540068=[_0x3eab1d(0x18b),_0x3eab1d(0x171),_0x3eab1d(0x173),'error',_0x3eab1d(0x168),'table','trace'];for(let _0xf85d9f=0x0;_0xf85d9f<_0x540068[_0x3eab1d(0x187)];_0xf85d9f++){const _0x1ccdc4=a15_0x5bf697[_0x3eab1d(0x15f)]['prototype'][_0x3eab1d(0x175)](a15_0x5bf697),_0x265c22=_0x540068[_0xf85d9f],_0x3df15e=_0x2b2b10[_0x265c22]||_0x1ccdc4;_0x1ccdc4[_0x3eab1d(0x16d)]=a15_0x5bf697[_0x3eab1d(0x175)](a15_0x5bf697),_0x1ccdc4[_0x3eab1d(0x160)]=_0x3df15e['toString'][_0x3eab1d(0x175)](_0x3df15e),_0x2b2b10[_0x265c22]=_0x1ccdc4;}});a15_0x5c4e77();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc,where}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D3=[{'name':'Emerald','elo':0x7d0},{'name':'Gold','elo':0x708},{'name':'Silver','elo':0x640},{'name':a15_0x197a8b(0x186),'elo':0x578},{'name':a15_0x197a8b(0x176),'elo':0x4b0}];let lastVisibleD3=null;async function getUsernameByIdD3(_0x467bb2){const _0x313e3d=a15_0x197a8b;try{if(!_0x467bb2)return'Unknown\x20Player';const _0x1889e5=await getDoc(doc(db,_0x313e3d(0x164),_0x467bb2));if(_0x1889e5[_0x313e3d(0x167)]())return _0x1889e5['data']()[_0x313e3d(0x189)]||_0x313e3d(0x162);const _0x299bc0=await getDocs(query(collection(db,_0x313e3d(0x18d)),where(_0x313e3d(0x183),'==',_0x467bb2),limit(0x1)));if(!_0x299bc0[_0x313e3d(0x177)])return _0x299bc0[_0x313e3d(0x174)][0x0][_0x313e3d(0x166)]()[_0x313e3d(0x18c)]||_0x313e3d(0x162);const _0x320c50=await getDocs(query(collection(db,_0x313e3d(0x18d)),where('loserId','==',_0x467bb2),limit(0x1)));if(!_0x320c50['empty'])return _0x320c50[_0x313e3d(0x174)][0x0]['data']()[_0x313e3d(0x17f)]||'Unknown\x20Player';return _0x313e3d(0x162);}catch(_0x43a5a6){return console[_0x313e3d(0x161)]('Error\x20getting\x20D3\x20username:',_0x43a5a6),_0x313e3d(0x162);}}export async function recordEloChangeD3({playerId:_0x20b1ed,previousElo:_0x378025,newElo:_0x43815d,opponentId:_0x5d6e8b,matchResult:_0x336c64,previousPosition:_0x3d60bc,newPosition:_0x41c287,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0xc17e4f,timestamp:_0x389039}){const _0x594b2f=a15_0x197a8b;try{const _0x31a653=doc(collection(db,_0x594b2f(0x17e)));let _0x14ef3e='match';if(isPromotion)_0x14ef3e=_0x594b2f(0x17b);if(isDemotion)_0x14ef3e='demotion';let _0x27e362=_0x594b2f(0x176);if(_0x43815d>=0x7d0)_0x27e362=_0x594b2f(0x17c);else{if(_0x43815d>=0x708)_0x27e362='Gold';else{if(_0x43815d>=0x640)_0x27e362=_0x594b2f(0x16f);else{if(_0x43815d>=0x578)_0x27e362='Bronze';}}}return await setDoc(_0x31a653,{'type':_0x14ef3e,'player':_0x20b1ed,'opponent':_0x5d6e8b,'previousElo':_0x378025,'newElo':_0x43815d,'change':_0x43815d-_0x378025,'matchResult':_0x336c64,'previousPosition':_0x3d60bc,'newPosition':_0x41c287,'rankAchieved':_0x27e362,'matchId':_0xc17e4f,'timestamp':_0x389039||serverTimestamp(),'gameMode':'D3'}),console[_0x594b2f(0x18b)]('D3\x20ELO\x20history\x20recorded\x20for\x20'+_0x20b1ed),!![];}catch(_0x47270d){console['error'](_0x594b2f(0x185),_0x47270d);throw _0x47270d;}}export async function getEloHistoryD3(_0x42fbe4=0x14){const _0x45e24a=a15_0x197a8b;try{const _0x3429b7=collection(db,_0x45e24a(0x17e));let _0x14e48f;lastVisibleD3?_0x14e48f=query(_0x3429b7,orderBy(_0x45e24a(0x163),_0x45e24a(0x16e)),startAfter(lastVisibleD3),limit(_0x42fbe4)):_0x14e48f=query(_0x3429b7,orderBy(_0x45e24a(0x163),_0x45e24a(0x16e)),limit(_0x42fbe4));const _0x10c926=await getDocs(_0x14e48f);if(_0x10c926[_0x45e24a(0x177)])return{'entries':[],'hasMore':![]};lastVisibleD3=_0x10c926[_0x45e24a(0x174)][_0x10c926[_0x45e24a(0x174)][_0x45e24a(0x187)]-0x1];const _0x4b30e1=_0x10c926['docs'][_0x45e24a(0x15e)](async _0x28801e=>{const _0x45e335=_0x45e24a,_0x50d38f=_0x28801e[_0x45e335(0x166)](),[_0x47c6e,_0x4a4ecd]=await Promise[_0x45e335(0x165)]([getUsernameByIdD3(_0x50d38f[_0x45e335(0x181)]),getUsernameByIdD3(_0x50d38f[_0x45e335(0x180)])]);return{..._0x50d38f,'playerUsername':_0x47c6e,'opponentUsername':_0x4a4ecd,'change':_0x50d38f[_0x45e335(0x179)]-_0x50d38f['previousElo'],'timestamp':_0x50d38f[_0x45e335(0x163)]};}),_0xf0488b=await Promise['all'](_0x4b30e1);return{'entries':_0xf0488b,'hasMore':_0x10c926['size']===_0x42fbe4};}catch(_0x264619){console['error'](_0x45e24a(0x169),_0x264619);throw _0x264619;}}function a15_0x5018(_0x53b309,_0x447e1c){const _0x4f12c5=a15_0x2d17();return a15_0x5018=function(_0x5c4e77,_0x5bf697){_0x5c4e77=_0x5c4e77-0x15c;let _0x5f391f=_0x4f12c5[_0x5c4e77];return _0x5f391f;},a15_0x5018(_0x53b309,_0x447e1c);}export function resetPaginationD3(){lastVisibleD3=null;}
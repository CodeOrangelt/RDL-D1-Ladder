import{initializeApp}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';import{getFirestore,collection,getDocs,writeBatch,doc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a1_0x20b4(_0x45ff99,_0x5658b5){const _0x21d269=a1_0x2b25();return a1_0x20b4=function(_0x34aff7,_0x3ee5f8){_0x34aff7=_0x34aff7-0x1af;let _0x2b25d6=_0x21d269[_0x34aff7];return _0x2b25d6;},a1_0x20b4(_0x45ff99,_0x5658b5);}import{firebaseConfig}from'../firebase-config.js';const app=initializeApp(firebaseConfig),db=getFirestore(app);async function migrateToAggregatedMembers(){const _0x355659=a1_0x20b4,_0x34d2d7=(function(){let _0x51f425=!![];return function(_0x5d1913,_0x2d3d2a){const _0x494453=_0x51f425?function(){if(_0x2d3d2a){const _0x54474e=_0x2d3d2a['apply'](_0x5d1913,arguments);return _0x2d3d2a=null,_0x54474e;}}:function(){};return _0x51f425=![],_0x494453;};}()),_0x52cadb=_0x34d2d7(this,function(){const _0x5ab883=a1_0x20b4;let _0x569208;try{const _0xaea5db=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x569208=_0xaea5db();}catch(_0x264610){_0x569208=window;}const _0x2b86c2=_0x569208['console']=_0x569208['console']||{},_0x32fa34=['log','warn','info','error',_0x5ab883(0x1c3),'table','trace'];for(let _0x476bdd=0x0;_0x476bdd<_0x32fa34['length'];_0x476bdd++){const _0x4908da=_0x34d2d7[_0x5ab883(0x1c1)]['prototype']['bind'](_0x34d2d7),_0x1d637a=_0x32fa34[_0x476bdd],_0x1b953a=_0x2b86c2[_0x1d637a]||_0x4908da;_0x4908da[_0x5ab883(0x1be)]=_0x34d2d7['bind'](_0x34d2d7),_0x4908da['toString']=_0x1b953a[_0x5ab883(0x1c0)]['bind'](_0x1b953a),_0x2b86c2[_0x1d637a]=_0x4908da;}});_0x52cadb(),console[_0x355659(0x1b4)](_0x355659(0x1b6));try{console['log']('ðŸ“¥\x20Fetching\x20all\x20collections...');const [_0x254bb4,_0x143249,_0x4bc4b7,_0x500cc2,_0x5bf498]=await Promise[_0x355659(0x1b9)]([getDocs(collection(db,_0x355659(0x1ca))),getDocs(collection(db,'players')),getDocs(collection(db,'playersD2')),getDocs(collection(db,_0x355659(0x1ce))),getDocs(collection(db,'nonParticipants'))]);console['log']('âœ…\x20Data\x20fetched:\x20'+_0x254bb4['size']+_0x355659(0x1b3)+_0x143249['size']+_0x355659(0x1c4)+_0x4bc4b7[_0x355659(0x1b0)]+_0x355659(0x1bd)+_0x500cc2['size']+'\x20D3,\x20'+_0x5bf498['size']+_0x355659(0x1ba));const _0x3cc4a4=new Map();_0x254bb4[_0x355659(0x1c8)](_0x76be6d=>{const _0x28f1f2=_0x355659;_0x3cc4a4[_0x28f1f2(0x1b1)](_0x76be6d['id'],_0x76be6d['data']());});const _0x30387d=new Map(),_0x52ccfa=(_0x55ad19,_0xb564da)=>{_0x55ad19['forEach'](_0x1827c8=>{const _0x1b496d=_0x1827c8['data'](),_0x2694dc=_0x1827c8['id'];!_0x30387d['has'](_0x2694dc)&&_0x30387d['set'](_0x2694dc,{'userId':_0x2694dc,'username':_0x1b496d['username']||_0x1b496d['name']||'Unknown','ladders':[],'isNonParticipant':![]});const _0xbeeffd=_0x30387d['get'](_0x2694dc);_0xbeeffd['ladders']['push']({'ladder':_0xb564da,'elo':_0x1b496d['eloRating']||_0x1b496d['elo']||0x4b0,'active':_0x1b496d['active']!==![]});});};_0x52ccfa(_0x143249,'D1'),_0x52ccfa(_0x4bc4b7,'D2'),_0x52ccfa(_0x500cc2,'D3'),_0x5bf498['forEach'](_0x1e73fd=>{const _0x9bd5c8=_0x355659,_0x578d5b=_0x1e73fd['data'](),_0x20da99=_0x1e73fd['id'];!_0x30387d[_0x9bd5c8(0x1c6)](_0x20da99)&&(_0x578d5b[_0x9bd5c8(0x1cf)]||_0x578d5b['name'])&&_0x30387d['set'](_0x20da99,{'userId':_0x20da99,'username':_0x578d5b['username']||_0x578d5b[_0x9bd5c8(0x1bc)],'ladders':[],'isNonParticipant':!![]});}),console['log']('âš™ï¸\x20Processed\x20'+_0x30387d['size']+_0x355659(0x1b2)),console[_0x355659(0x1b4)](_0x355659(0x1b5));const _0x513522=[];let _0x302338=writeBatch(db),_0x5a0690=0x0,_0x575289=0x0;_0x30387d[_0x355659(0x1c8)]((_0xfcf0f1,_0x4f553a)=>{const _0x325cce=_0x355659,_0x100ff2=_0x3cc4a4['get'](_0x4f553a)||{};let _0x37c7dd=0x0,_0x1619c9=null;if(_0xfcf0f1[_0x325cce(0x1c7)]['length']>0x0){const _0x3b3082=_0xfcf0f1['ladders']['sort']((_0x35e1fd,_0x1a3103)=>_0x1a3103['elo']-_0x35e1fd['elo']);_0x37c7dd=_0x3b3082[0x0][_0x325cce(0x1bf)],_0x1619c9=_0x3b3082[0x0]['ladder'];}const _0x1359cf={'userId':_0x4f553a,'username':_0xfcf0f1[_0x325cce(0x1cf)],'profileImageUrl':_0x100ff2['profileImageUrl']||null,'country':_0x100ff2['country']||null,'motto':_0x100ff2[_0x325cce(0x1bb)]||null,'favoriteMap':_0x100ff2['favoriteMap']||null,'favoriteWeapon':_0x100ff2['favoriteWeapon']||null,'isNonParticipant':_0xfcf0f1['isNonParticipant'],'ladders':_0xfcf0f1['ladders'],'primaryLadder':_0x1619c9,'highestElo':_0x37c7dd,'rank':getPlayerRank(_0x37c7dd),'lastUpdated':new Date(),'migrationTimestamp':new Date()[_0x325cce(0x1af)]()},_0x52801f=doc(collection(db,'aggregatedMembers'),_0x4f553a);_0x302338['set'](_0x52801f,_0x1359cf),_0x5a0690++,_0x575289++,_0x5a0690>=0x1c2&&(_0x513522['push'](_0x302338[_0x325cce(0x1cc)]()),_0x302338=writeBatch(db),_0x5a0690=0x0,console['log']('ðŸ“¦\x20Prepared\x20batch\x20'+_0x513522[_0x325cce(0x1c5)]+'\x20('+_0x575289+_0x325cce(0x1c9)));}),_0x5a0690>0x0&&_0x513522[_0x355659(0x1b7)](_0x302338['commit']()),console['log'](_0x355659(0x1cd)+_0x513522['length']+_0x355659(0x1b8)),await Promise['all'](_0x513522),console[_0x355659(0x1b4)]('ðŸŽ‰\x20Successfully\x20migrated\x20'+_0x30387d['size']+_0x355659(0x1c2)),console['log'](_0x355659(0x1cb));}catch(_0xb32bbe){console['error']('âŒ\x20Migration\x20failed:',_0xb32bbe),_0xb32bbe['code']==='permission-denied'&&console['error']('ðŸ”’\x20Permission\x20denied.\x20Make\x20sure\x20you\x27re\x20signed\x20in\x20as\x20an\x20admin\x20and\x20security\x20rules\x20allow\x20access\x20to\x20aggregatedMembers\x20collection.');}}function getPlayerRank(_0x35ac49){if(_0x35ac49>=0x7d0)return'emerald';if(_0x35ac49>=0x708)return'gold';if(_0x35ac49>=0x640)return'silver';if(_0x35ac49>=0x578)return'bronze';return'unranked';}function a1_0x2b25(){const _0x1dea20=['toISOString','size','set','\x20unique\x20members','\x20profiles,\x20','log','ðŸ’¾\x20Writing\x20aggregated\x20data...','ðŸ”„\x20Starting\x20migration\x20to\x20aggregated\x20members...','push','\x20batches...','all','\x20non-participants','motto','name','\x20D2,\x20','__proto__','elo','toString','constructor','\x20members\x20to\x20aggregated\x20collection!','exception','\x20D1,\x20','length','has','ladders','forEach','\x20members\x20processed)','userProfiles','ðŸ’¡\x20Refresh\x20your\x20members\x20page\x20to\x20see\x20the\x20results!','commit','ðŸš€\x20Executing\x20','playersD3','username'];a1_0x2b25=function(){return _0x1dea20;};return a1_0x2b25();}migrateToAggregatedMembers();
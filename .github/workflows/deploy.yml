name: Deploy to GitHub Pages
on:
  push:
    branches:
      - main

permissions:
  contents: write
  pages: write
  id-token: write

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Prepare root files
        run: |
          # First, copy CSS, JS and images directly to root
          cp -r ./CSS ./
          cp -r ./JS ./
          cp -r ./images ./
          
          # Keep the root index.html as is
          cp ./HTML/index.html ./index.html
          
          # Update paths in the root index.html (no ../ needed)
          sed -i 's/\.\.\/CSS/CSS/g' ./index.html
          sed -i 's/\.\.\/JS/JS/g' ./index.html
          sed -i 's/\.\.\/images/images/g' ./index.html
          
          # Handle all other HTML files - create folder structure
          for file in ./HTML/*.html; do
            if [ "$(basename "$file")" != "index.html" ]; then
              # Get filename without extension
              filename=$(basename "$file" .html)
              
              # Create directory for the file
              mkdir -p "./$filename"
              
              # Copy file as index.html in that directory
              cp "$file" "./$filename/index.html"
              
              # Update paths in the copied file
              sed -i 's/\.\.\/CSS/\/CSS/g' "./$filename/index.html"
              sed -i 's/\.\.\/JS/\/JS/g' "./$filename/index.html"
              sed -i 's/\.\.\/images/\/images/g' "./$filename/index.html"
              
              # Update internal links to other HTML pages
              sed -i 's/href="[^\.]*\.html"/href="\/&/g' "./$filename/index.html"
              sed -i 's/\.html"/"/g' "./$filename/index.html"
            fi
          done
          
          # Add debug information
          echo "<!-- GitHub Pages clean URLs deployment $(date) -->" >> ./index.html

      - name: Deploy to GitHub Pages
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          branch: gh-pages
          folder: .
function a45_0x26b4(_0x1d9620,_0x4758ec){const _0x2e990f=a45_0x2524();return a45_0x26b4=function(_0x3c1d03,_0x1365b1){_0x3c1d03=_0x3c1d03-0x153;let _0x252433=_0x2e990f[_0x3c1d03];return _0x252433;},a45_0x26b4(_0x1d9620,_0x4758ec);}const a45_0x405f79=a45_0x26b4,a45_0x3c1d03=(function(){let _0x3fb7a1=!![];return function(_0x1bbb8c,_0x39b344){const _0x46a954=_0x3fb7a1?function(){if(_0x39b344){const _0x39a50a=_0x39b344['apply'](_0x1bbb8c,arguments);return _0x39b344=null,_0x39a50a;}}:function(){};return _0x3fb7a1=![],_0x46a954;};}()),a45_0x2e990f=a45_0x3c1d03(this,function(){const _0x4061b8=a45_0x26b4;let _0x564a94;try{const _0xd105a4=Function('return\x20(function()\x20'+_0x4061b8(0x18f)+');');_0x564a94=_0xd105a4();}catch(_0x5d8e87){_0x564a94=window;}const _0x20a0ce=_0x564a94['console']=_0x564a94['console']||{},_0x56ab4a=['log',_0x4061b8(0x16c),_0x4061b8(0x18a),'error',_0x4061b8(0x15f),'table','trace'];for(let _0x50d62b=0x0;_0x50d62b<_0x56ab4a['length'];_0x50d62b++){const _0x5b827c=a45_0x3c1d03['constructor']['prototype']['bind'](a45_0x3c1d03),_0x5e01a6=_0x56ab4a[_0x50d62b],_0x5776fa=_0x20a0ce[_0x5e01a6]||_0x5b827c;_0x5b827c['__proto__']=a45_0x3c1d03['bind'](a45_0x3c1d03),_0x5b827c[_0x4061b8(0x160)]=_0x5776fa['toString'][_0x4061b8(0x161)](_0x5776fa),_0x20a0ce[_0x5e01a6]=_0x5b827c;}});a45_0x2e990f();import{collection,doc,query,where,orderBy,limit,getDocs,addDoc,getDoc,serverTimestamp,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{auth,db}from'./firebase-config.js';function a45_0x2524(){const _0x35ec6b=['getElementById','checkAndRecordPromotion','docs','className','new-rank-change','setItem','userDismissed','\x20(source:\x20','rank-change-ok-btn','lastFetchTime','empty','\x20<span\x20class=\x22rank-text\x22>','exception','toString','bind','source','promotion','offsetWidth','pollingInterval','timestamp','getRankName','createElement','fetchRecentPromotions','Rank\x20Update','Error\x20saving\x20promotion\x20preference:','warn','date','ladder','display','\x20was\x20promoted\x20to','\x27s\x20','You\x27ve\x20been\x20promoted\x20to','userId','now','newRank','displayName','seconds','visibilityState','Don\x27t\x20show\x20again','appendChild','textContent','addEventListener','promotion-banner-container','Promotion\x20','</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22rank-change-button\x22\x20id=\x22rank-change-ok-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Got\x20it!\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','Error\x20fetching\x20promotions:','getItem','initialize','data','rank-change-modal\x20','resolvedName','RANKS','winnerUsername','dismissing','players','info','player','Error\x20in\x20promotion/demotion\x20recording:','usernameCache','error','{}.constructor(\x22return\x20this\x22)(\x20)','none','rankChangeModal','ignored','ID:','approvedMatches','div','removeChild','demotion','flex','split','loserUsername','\x20(loser)','parse','A\x20player','stringify','admin','currentUser','previousRank','bannerContainer','fetchInterval','children','You\x27ve\x20been\x20demoted\x20to','sendPromotionNotification','data-rank','block','username','adminUser','length','parentNode','set','includes','classList','Recording\x20','beforeunload','button','test','click','remove','log','DISPLAY_HOURS','visibilitychange','data-id'];a45_0x2524=function(){return _0x35ec6b;};return a45_0x2524();}class PromotionManager{constructor(){const _0x18f6a9=a45_0x26b4;this['DISPLAY_HOURS']=0x18,this['RANKS']=[{'threshold':0x578,'name':'Bronze','color':'#CD7F32'},{'threshold':0x640,'name':'Silver','color':'#C0C0C0'},{'threshold':0x708,'name':'Gold','color':'#FFD700'},{'threshold':0x834,'name':'Emerald','color':'#50C878'}],this['bannerContainer']=null,this[_0x18f6a9(0x15c)]=0x0,this[_0x18f6a9(0x1a3)]=0xea60,this['pollingInterval']=null,this[_0x18f6a9(0x18d)]={};}['initialize'](){const _0x180e14=a45_0x26b4;this['bannerContainer']=document['getElementById'](_0x180e14(0x17d));if(!this['bannerContainer']){console[_0x180e14(0x18e)]('Promotion\x20banner\x20container\x20not\x20found');return;}this['setupBannerContainer']();const _0x7d5e56='promotions_checked_'+new Date()['toDateString'](),_0x1d6140=sessionStorage['getItem'](_0x7d5e56);!_0x1d6140&&(this['fetchRecentPromotions'](),sessionStorage['setItem'](_0x7d5e56,'true')),document['addEventListener'](_0x180e14(0x1b8),()=>{const _0x31255b=_0x180e14;document[_0x31255b(0x178)]==='visible'&&!sessionStorage[_0x31255b(0x181)](_0x7d5e56)&&(this['fetchRecentPromotions'](),sessionStorage['setItem'](_0x7d5e56,'true'));}),window['addEventListener'](_0x180e14(0x1b1),()=>{const _0x4baa9b=_0x180e14;this['pollingInterval']&&clearInterval(this[_0x4baa9b(0x165)]);});}['setupBannerContainer'](){this['bannerContainer']['innerHTML']='',this['bannerContainer']['style']['display']='none';}async[a45_0x405f79(0x169)](){const _0x4bf603=a45_0x405f79;try{const _0x1a1f62=Date[_0x4bf603(0x174)]();if(_0x1a1f62-this['lastFetchTime']<this['fetchInterval'])return;this[_0x4bf603(0x15c)]=_0x1a1f62;const _0xd3e5cf=collection(db,'eloHistory'),_0xf139c=query(_0xd3e5cf,where('type','in',['promotion',_0x4bf603(0x197)]),orderBy(_0x4bf603(0x166),'desc'),limit(0x14)),_0x2ec710=await getDocs(_0xf139c),_0x51cefe=[];_0x2ec710['forEach'](_0x4b1de3=>{const _0x58d8f9={'id':_0x4b1de3['id'],..._0x4b1de3['data']()};this['shouldShowPromotion'](_0x4b1de3['id'])&&this['isNewRankChange'](_0x58d8f9)&&_0x51cefe['push'](_0x58d8f9);}),_0x51cefe['length']>0x0&&await this['processRankChanges'](_0x51cefe);}catch(_0xd8732c){console['error'](_0x4bf603(0x180),_0xd8732c);}}async['processRankChanges'](_0x56df94){const _0x1e9ba1=a45_0x405f79;if(_0x56df94['length']===0x0)return;_0x56df94['sort']((_0x14f659,_0x34bb66)=>{const _0x2a42d9=a45_0x26b4,_0x16203d=_0x14f659[_0x2a42d9(0x166)]?.['toMillis']?.()||_0x14f659['timestamp']?.['seconds']*0x3e8||0x0,_0x3c7692=_0x34bb66['timestamp']?.['toMillis']?.()||_0x34bb66['timestamp']?.['seconds']*0x3e8||0x0;return _0x3c7692-_0x16203d;});const _0x4494a6=this[_0x1e9ba1(0x1a2)][_0x1e9ba1(0x1a4)]['length'],_0x103ae8=0x3-_0x4494a6;if(_0x103ae8<=0x0)return;const _0x580658=_0x56df94['slice'](0x0,_0x103ae8);for(let _0x40a176=0x0;_0x40a176<_0x580658['length'];_0x40a176++){const _0x1a0f53=_0x580658[_0x40a176],_0x454f29=auth['currentUser'];try{setTimeout(()=>{this['showRankChangeBanner'](_0x1a0f53);},_0x40a176*0x3e8),_0x454f29&&_0x1a0f53['player']===_0x454f29['displayName']&&this['showRankChangeLightbox'](_0x1a0f53['type'],_0x1a0f53['rankAchieved']);}catch(_0x17e482){console['error']('Error\x20processing\x20rank\x20change:',_0x17e482);}}}['shouldShowPromotion'](_0xb969f2){const _0xcb6953=a45_0x405f79;try{const _0x5340c1='promotion_'+_0xb969f2,_0x3567d9=localStorage[_0xcb6953(0x181)](_0x5340c1);if(_0x3567d9){let _0x3ec557;try{_0x3ec557=JSON[_0xcb6953(0x19c)](_0x3567d9);}catch(_0x47efa6){return console['warn']('Invalid\x20storage\x20format\x20for\x20'+_0x5340c1+',\x20treating\x20as\x20new'),!![];}if(_0x3ec557[_0xcb6953(0x192)]===!![])return console['log']('Promotion\x20'+_0xb969f2+'\x20is\x20permanently\x20ignored'),![];const _0x251793=Date[_0xcb6953(0x174)]();if(_0x3ec557[_0xcb6953(0x159)]&&_0x251793-_0x3ec557['timestamp']<this['DISPLAY_HOURS']*0x3c*0x3c*0x3e8)return console[_0xcb6953(0x1b6)](_0xcb6953(0x17e)+_0xb969f2+'\x20was\x20dismissed\x20by\x20user\x20within\x20last\x20'+this[_0xcb6953(0x1b7)]+'\x20hours'),![];if(_0x3ec557['systemDismissed']&&_0x251793-_0x3ec557['timestamp']<0x4*0x3c*0x3c*0x3e8)return console['log'](_0xcb6953(0x17e)+_0xb969f2+'\x20was\x20auto-dismissed\x20within\x20last\x204\x20hours'),![];}return!![];}catch(_0x1eed35){return console['error']('Error\x20checking\x20promotion\x20visibility:',_0x1eed35),![];}}['ignorePromotion'](_0x14a0fc){const _0x19b752=a45_0x405f79;try{const _0x30030c='promotion_'+_0x14a0fc;localStorage[_0x19b752(0x158)](_0x30030c,JSON['stringify']({'timestamp':Date[_0x19b752(0x174)](),'ignored':!![]}));}catch(_0x572496){console['error'](_0x19b752(0x16b),_0x572496);}}['showRankChangeBanner'](_0x449bcf){this['resolveUserId'](_0x449bcf)['then'](_0x2650f3=>{const _0x105f64=a45_0x26b4,_0x4f1c1f='promotion_'+_0x449bcf['id'],_0x36e582=localStorage['getItem'](_0x4f1c1f);if(_0x36e582)try{const _0x1a61ea=JSON['parse'](_0x36e582);if(_0x1a61ea['ignored']===!![]){console['log']('Skipping\x20ignored\x20promotion:\x20'+_0x449bcf['id']);return;}}catch(_0x5c534b){}localStorage[_0x105f64(0x158)](_0x4f1c1f,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':![],'seenAt':Date['now']()})),this[_0x105f64(0x1a2)]['style'][_0x105f64(0x16f)]=_0x105f64(0x1a8);while(this['bannerContainer']['children'][_0x105f64(0x1ab)]>=0x3){this['bannerContainer'][_0x105f64(0x196)](this[_0x105f64(0x1a2)]['firstChild']);}const _0x8075b6=document['createElement'](_0x105f64(0x195));_0x8075b6['className']='promotion-banner',_0x8075b6['setAttribute'](_0x105f64(0x1a7),_0x2650f3['rankAchieved']),_0x8075b6['setAttribute'](_0x105f64(0x1b9),_0x2650f3['id']);const _0xa3df41=document[_0x105f64(0x168)]('div');_0xa3df41[_0x105f64(0x156)]='promotion-details';const _0x5764d4=_0x2650f3['resolvedName']||_0x2650f3['player']||_0x2650f3['username']||_0x2650f3['playerUsername']||_0x2650f3[_0x105f64(0x176)]||_0x105f64(0x19d),_0x71031e=_0x2650f3['type']==='promotion'?_0x5764d4+_0x105f64(0x170):_0x5764d4+'\x20was\x20demoted\x20to';_0xa3df41['innerHTML']=_0x71031e+_0x105f64(0x15e)+_0x2650f3['rankAchieved']+'</span>';const _0x3b67e2=document['createElement']('div');_0x3b67e2[_0x105f64(0x156)]='banner-actions';const _0x283643=document[_0x105f64(0x168)](_0x105f64(0x1b2));_0x283643['className']='dismiss-btn',_0x283643['innerHTML']='&times;',_0x283643['title']='Dismiss';const _0x2eee58=document['createElement']('button');_0x2eee58['className']='ignore-btn',_0x2eee58[_0x105f64(0x17b)]=_0x105f64(0x179),_0x2eee58['title']='Never\x20show\x20this\x20promotion\x20again',_0x3b67e2[_0x105f64(0x17a)](_0x2eee58),_0x3b67e2[_0x105f64(0x17a)](_0x283643),_0x8075b6[_0x105f64(0x17a)](_0xa3df41),_0x8075b6['appendChild'](_0x3b67e2),this[_0x105f64(0x1a2)]['appendChild'](_0x8075b6),void _0x8075b6[_0x105f64(0x164)],setTimeout(()=>{_0x8075b6['classList']['add']('new-rank-change');},0x32),_0x283643['addEventListener'](_0x105f64(0x1b4),()=>{const _0x4d471c=_0x105f64;localStorage[_0x4d471c(0x158)](_0x4f1c1f,JSON['stringify']({'timestamp':Date[_0x4d471c(0x174)](),'ignored':![],'userDismissed':!![],'systemDismissed':![]})),_0x8075b6['classList'][_0x4d471c(0x1b5)](_0x4d471c(0x157)),_0x8075b6[_0x4d471c(0x1af)]['add'](_0x4d471c(0x188)),setTimeout(()=>{const _0xef111=_0x4d471c;_0x8075b6['parentNode']&&(_0x8075b6['remove'](),this['bannerContainer']['children']['length']===0x0&&(this[_0xef111(0x1a2)]['style']['display']='none'));},0x1f4);}),_0x2eee58['addEventListener']('click',()=>{const _0xf89531=_0x105f64;localStorage['setItem'](_0x4f1c1f,JSON[_0xf89531(0x19e)]({'timestamp':Date['now'](),'ignored':!![],'userDismissed':!![],'systemDismissed':![]})),_0x8075b6['classList'][_0xf89531(0x1b5)](_0xf89531(0x157)),_0x8075b6[_0xf89531(0x1af)]['add']('dismissing'),setTimeout(()=>{const _0x5dddb0=_0xf89531;_0x8075b6['parentNode']&&(_0x8075b6['remove'](),this['bannerContainer'][_0x5dddb0(0x1a4)]['length']===0x0&&(this['bannerContainer']['style']['display']=_0x5dddb0(0x190)));},0x1f4);}),setTimeout(()=>{const _0x161d7d=_0x105f64;_0x8075b6[_0x161d7d(0x1ac)]&&(_0x8075b6['classList']['remove']('new-rank-change'),_0x8075b6['classList']['add']('dismissing'),localStorage['setItem'](_0x4f1c1f,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':!![]})),setTimeout(()=>{const _0x15b793=_0x161d7d;_0x8075b6['parentNode']&&(_0x8075b6['remove'](),this[_0x15b793(0x1a2)][_0x15b793(0x1a4)][_0x15b793(0x1ab)]===0x0&&(this['bannerContainer']['style']['display']='none'));},0x1f4));},0x3a98);});}async['resolveUserId'](_0x3da0ae){const _0x3eb141=a45_0x405f79,_0x387366={..._0x3da0ae},_0x48befc=[_0x3da0ae['player'],_0x3da0ae['username'],_0x3da0ae['playerUsername'],_0x3da0ae['displayName']],_0xf40f07=_0x48befc['some'](_0xd5420a=>_0xd5420a&&typeof _0xd5420a==='string'&&!_0xd5420a[_0x3eb141(0x1ae)](_0x3eb141(0x193))&&!/^[a-zA-Z0-9]{20,}$/['test'](_0xd5420a));if(_0xf40f07)return _0x387366;let _0x1f667e=null;if(_0x3da0ae[_0x3eb141(0x173)])_0x1f667e=_0x3da0ae['userId'];else _0x3da0ae[_0x3eb141(0x18b)]&&/^[A-Za-z0-9]{20,}$/[_0x3eb141(0x1b3)](_0x3da0ae['player'])&&(_0x1f667e=_0x3da0ae['player']);if(!_0x1f667e)return _0x387366;try{const _0x34ed2b=await getDoc(doc(db,'players',_0x1f667e));if(_0x34ed2b['exists']()){const _0x184abb=_0x34ed2b['data']();if(_0x184abb[_0x3eb141(0x1a9)])return _0x387366['resolvedName']=_0x184abb[_0x3eb141(0x1a9)],_0x387366;}const _0x28843c=await getDocs(query(collection(db,_0x3eb141(0x194)),where('winnerId','==',_0x1f667e),orderBy(_0x3eb141(0x16d),'desc'),limit(0x1)));if(!_0x28843c[_0x3eb141(0x15d)]){const _0x25f3cb=_0x28843c['docs'][0x0]['data']();if(_0x25f3cb[_0x3eb141(0x187)])return _0x387366['resolvedName']=_0x25f3cb['winnerUsername'],_0x387366;}const _0x576611=await getDocs(query(collection(db,'approvedMatches'),where('loserId','==',_0x1f667e),orderBy('date','desc'),limit(0x1)));if(!_0x576611['empty']){const _0x21d81f=_0x576611['docs'][0x0]['data']();if(_0x21d81f[_0x3eb141(0x19a)])return _0x387366[_0x3eb141(0x185)]=_0x21d81f[_0x3eb141(0x19a)],console[_0x3eb141(0x1b6)]('Resolved\x20'+_0x1f667e+'\x20to\x20'+_0x21d81f[_0x3eb141(0x19a)]+_0x3eb141(0x19b)),_0x387366;}}catch(_0x34ede0){console['error']('Error\x20resolving\x20user\x20ID:',_0x34ede0);}return console['warn']('Failed\x20to\x20resolve\x20user\x20ID:\x20'+_0x1f667e),_0x387366;}['showRankChangeLightbox'](_0x4f90d7,_0x350e01){const _0x3fc749=a45_0x405f79;let _0x237953=document['getElementById'](_0x3fc749(0x191));!_0x237953&&(_0x237953=document['createElement'](_0x3fc749(0x195)),_0x237953['id']='rankChangeModal',_0x237953['className']=_0x3fc749(0x184)+_0x4f90d7,document['body']['appendChild'](_0x237953));const _0x4a5f3d=_0x4f90d7===_0x3fc749(0x163)?'Congratulations!':_0x3fc749(0x16a),_0x55acf7=_0x4f90d7===_0x3fc749(0x163)?_0x3fc749(0x172):_0x3fc749(0x1a5);_0x237953['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rank-change-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2\x20class=\x22rank-change-title\x22>'+_0x4a5f3d+'</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>'+_0x55acf7+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22rank-name\x22>'+_0x350e01+_0x3fc749(0x17f),_0x237953['style']['display']=_0x3fc749(0x198),document[_0x3fc749(0x153)](_0x3fc749(0x15b))[_0x3fc749(0x17c)]('click',()=>{_0x237953['style']['display']='none';}),_0x237953['addEventListener']('click',_0x3c8112=>{_0x3c8112['target']===_0x237953&&(_0x237953['style']['display']='none');});}async['checkAndRecordPromotion'](_0x4f66e8,_0x3475f6,_0x5c3139,_0x32c65a={}){const _0x2ca66e=a45_0x405f79;try{if(_0x3475f6===_0x5c3139||!_0x4f66e8)return null;const _0x1b2fd2=_0x32c65a[_0x2ca66e(0x162)]||'automatic',_0x21bdb5=_0x32c65a['matchId']||null,_0x2aba64=_0x32c65a[_0x2ca66e(0x1aa)]||null;console[_0x2ca66e(0x1b6)]('Processing\x20potential\x20rank\x20change:\x20'+_0x5c3139+'\x20→\x20'+_0x3475f6+_0x2ca66e(0x15a)+_0x1b2fd2+')');let _0x4dc226=null,_0x313537=null;try{const _0x471f19=await getDoc(doc(db,_0x2ca66e(0x189),_0x4f66e8));if(_0x471f19['exists']()){const _0x35bb46=_0x471f19['data']();_0x4dc226=_0x35bb46['username']||_0x35bb46['displayName']||null,_0x313537=_0x35bb46['displayName']||_0x35bb46[_0x2ca66e(0x1a9)]||null;}!_0x4dc226&&_0x32c65a[_0x2ca66e(0x1a9)]&&(_0x4dc226=_0x32c65a['username'],_0x313537=_0x32c65a['username']);!_0x4dc226&&auth['currentUser']&&(_0x4dc226=auth['currentUser']['displayName']||auth[_0x2ca66e(0x1a0)]['email'][_0x2ca66e(0x199)]('@')[0x0],_0x313537=auth['currentUser'][_0x2ca66e(0x176)]||null);if(!_0x4dc226){const _0x3ff5fd=query(collection(db,_0x2ca66e(0x194)),where('winnerId','==',_0x4f66e8),limit(0x1)),_0x1d1fc1=await getDocs(_0x3ff5fd);if(!_0x1d1fc1['empty'])_0x4dc226=_0x1d1fc1[_0x2ca66e(0x155)][0x0][_0x2ca66e(0x183)]()[_0x2ca66e(0x187)]||'Unknown\x20Player',_0x313537=_0x4dc226;else{const _0x5adcbb=query(collection(db,'approvedMatches'),where('loserId','==',_0x4f66e8),limit(0x1)),_0x52c442=await getDocs(_0x5adcbb);!_0x52c442['empty']&&(_0x4dc226=_0x52c442[0x0]['data']()['loserUsername']||'Unknown\x20Player',_0x313537=_0x4dc226);}}}catch(_0x2aa9ba){console['error']('Error\x20resolving\x20username:',_0x2aa9ba);}!_0x4dc226&&(console[_0x2ca66e(0x16c)]('Could\x20not\x20resolve\x20username\x20for\x20userId:',_0x4f66e8),_0x4dc226=_0x2ca66e(0x19d),_0x313537='Unknown\x20Player');const _0x2a9de4=this['getRankName'](_0x5c3139),_0x4e2db2=this[_0x2ca66e(0x167)](_0x3475f6);if(_0x2a9de4!==_0x4e2db2){const _0x1f9136=_0x3475f6>_0x5c3139,_0xe873db=_0x1f9136?_0x2ca66e(0x163):'demotion',_0x2f1f45=_0x4e2db2;console[_0x2ca66e(0x1b6)](_0x2ca66e(0x1b0)+_0xe873db+'\x20for\x20'+_0x4dc226+':\x20'+_0x5c3139+'\x20('+_0x2a9de4+')\x20→\x20'+_0x3475f6+'\x20('+_0x4e2db2+')');try{const _0x292c4d={'player':_0x4dc226,'playerUsername':_0x4dc226,'username':_0x4dc226,'displayName':_0x313537,'userId':_0x4f66e8,'type':_0xe873db,'rankAchieved':_0x2f1f45,'timestamp':serverTimestamp(),'previousElo':_0x5c3139,'newElo':_0x3475f6,'change':_0x3475f6-_0x5c3139,'previousRank':_0x2a9de4,'newRank':_0x4e2db2,'source':_0x1b2fd2};if(_0x1b2fd2==='match'&&_0x21bdb5)_0x292c4d['matchId']=_0x21bdb5;else _0x1b2fd2==='admin'&&_0x2aba64?(_0x292c4d['modifiedBy']=_0x2aba64,_0x292c4d['isAutomatic']=![]):_0x292c4d['isAutomatic']=!![];const _0x68c42d=writeBatch(db),_0x21a2e0=doc(collection(db,'eloHistory')),_0x2b2a2a=doc(collection(db,'promotionHistory'));return _0x68c42d['set'](_0x21a2e0,_0x292c4d),_0x68c42d[_0x2ca66e(0x1ad)](_0x2b2a2a,_0x292c4d),await _0x68c42d['commit'](),await this[_0x2ca66e(0x1a6)](_0x4f66e8,_0x4dc226,_0x5c3139,_0x3475f6,_0x2a9de4,_0x4e2db2,_0xe873db,{'displayName':_0x313537,'source':_0x1b2fd2,'matchId':_0x21bdb5,'ladder':_0x32c65a['ladder']||'D1'}),console[_0x2ca66e(0x1b6)]('Successfully\x20recorded\x20'+_0xe873db+'\x20for\x20'+_0x4dc226+'\x20to\x20'+_0x2f1f45),_0x2f1f45;}catch(_0x3de009){console['error']('Error\x20writing\x20promotion\x20records:',_0x3de009);try{return await addDoc(collection(db,'eloHistory'),{'player':_0x4dc226,'playerUsername':_0x4dc226,'username':_0x4dc226,'displayName':_0x313537,'userId':_0x4f66e8,'type':_0xe873db,'rankAchieved':_0x2f1f45,'timestamp':serverTimestamp(),'previousElo':_0x5c3139,'newElo':_0x3475f6,'change':_0x3475f6-_0x5c3139,'previousRank':_0x2a9de4,'source':_0x1b2fd2,'isAutomatic':_0x1b2fd2!==_0x2ca66e(0x19f)}),await this['sendPromotionNotification'](_0x4f66e8,_0x4dc226,_0x5c3139,_0x3475f6,_0x2a9de4,_0x4e2db2,_0xe873db,{'displayName':_0x313537,'source':_0x1b2fd2,'matchId':_0x21bdb5,'ladder':_0x32c65a['ladder']||'D1'}),_0x2f1f45;}catch(_0x2ab226){return console['error']('Fallback\x20write\x20failed:',_0x2ab226),null;}}}return null;}catch(_0x234c88){return console[_0x2ca66e(0x18e)](_0x2ca66e(0x18c),_0x234c88),null;}}['getRankName'](_0x5a6f1d){const _0x13a0a6=a45_0x405f79;for(let _0x462af0=this['RANKS'][_0x13a0a6(0x1ab)]-0x1;_0x462af0>=0x0;_0x462af0--){if(_0x5a6f1d>=this['RANKS'][_0x462af0]['threshold'])return this[_0x13a0a6(0x186)][_0x462af0]['name'];}return'Unranked';}['cleanup'](){const _0x2510a7=a45_0x405f79;this['pollingInterval']&&clearInterval(this[_0x2510a7(0x165)]);}['isNewRankChange'](_0x4ed77a){const _0x1ddfe5=a45_0x405f79;if(_0x4ed77a['timestamp']){const _0x1d730f=_0x4ed77a['timestamp'][_0x1ddfe5(0x177)]*0x3e8,_0x2c49c6=Date['now'](),_0x56c968=(_0x2c49c6-_0x1d730f)/(0x3e8*0x3c*0x3c);if(_0x56c968>0x18)return![];}if(_0x4ed77a[_0x1ddfe5(0x1a1)]&&_0x4ed77a[_0x1ddfe5(0x175)]&&_0x4ed77a['previousRank']!==_0x4ed77a[_0x1ddfe5(0x175)])return!![];return![];}async['sendPromotionNotification'](_0x5a02f7,_0x1bb7f1,_0x440d06,_0x324e1e,_0x115a21,_0x1ee9dd,_0x1be5c5,_0x444702={}){const _0x24e1be=a45_0x405f79;try{console[_0x24e1be(0x1b6)]('STARTING\x20notification\x20for\x20'+_0x1bb7f1+_0x24e1be(0x171)+_0x1be5c5);const _0x567c42={'userId':_0x5a02f7,'username':_0x1bb7f1,'displayName':_0x444702[_0x24e1be(0x176)]||_0x1bb7f1,'oldElo':parseInt(_0x440d06),'newElo':parseInt(_0x324e1e),'eloDifference':parseInt(_0x324e1e)-parseInt(_0x440d06),'oldRank':_0x115a21,'newRank':_0x1ee9dd,'type':_0x1be5c5,'timestamp':serverTimestamp(),'processed':![],'source':_0x444702['source']||'automatic','matchId':_0x444702['matchId']||null,'ladder':_0x444702[_0x24e1be(0x16e)]||'D1','adminUser':_0x444702['adminUser']||null};console['log']('Creating\x20Discord\x20notification:',_0x567c42);const _0x5c9328=await addDoc(collection(db,'promotionNotifications'),_0x567c42);return console['log']('Discord\x20notification\x20sent\x20successfully\x20with\x20ID:\x20'+_0x5c9328['id']),!![];}catch(_0x2fe2a6){return console[_0x24e1be(0x18e)]('Error\x20sending\x20Discord\x20notification:',_0x2fe2a6),![];}}}export const promotionManager=new PromotionManager();document[a45_0x405f79(0x17c)]('DOMContentLoaded',()=>{const _0x137e27=a45_0x405f79;promotionManager[_0x137e27(0x182)]();});export const initializePromotionTracker=()=>promotionManager['initialize']();export const checkAndRecordPromotion=(_0x448a96,_0x372b52,_0x3ca940,_0x1a7f46)=>promotionManager[a45_0x405f79(0x154)](_0x448a96,_0x372b52,_0x3ca940,_0x1a7f46);export const getRankName=_0x553c0d=>promotionManager['getRankName'](_0x553c0d);
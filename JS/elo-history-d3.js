function a15_0x2df4(){const _0x3c26cb=['toString','apply','error','prototype','info','username','Unranked','return\x20(function()\x20','trace','Bronze','match','eloHistoryD3','Unknown\x20Player','constructor','Gold','loserId','warn','winnerId','size','docs','data','bind','Error\x20fetching\x20D3\x20ELO\x20history:','length'];a15_0x2df4=function(){return _0x3c26cb;};return a15_0x2df4();}const a15_0x110f96=a15_0x566c,a15_0x1d27c9=(function(){let _0x152c07=!![];return function(_0x41f3d6,_0xb8d589){const _0x4004f6=_0x152c07?function(){const _0x42279f=a15_0x566c;if(_0xb8d589){const _0x32d6d0=_0xb8d589[_0x42279f(0xf5)](_0x41f3d6,arguments);return _0xb8d589=null,_0x32d6d0;}}:function(){};return _0x152c07=![],_0x4004f6;};}()),a15_0x1bae0a=a15_0x1d27c9(this,function(){const _0x387303=a15_0x566c,_0x1c34e8=function(){const _0x462df7=a15_0x566c;let _0x428f7a;try{_0x428f7a=Function(_0x462df7(0xfb)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x21e861){_0x428f7a=window;}return _0x428f7a;},_0x27aa65=_0x1c34e8(),_0x4ac083=_0x27aa65['console']=_0x27aa65['console']||{},_0x373f80=['log',_0x387303(0x104),_0x387303(0xf8),'error','exception','table',_0x387303(0xfc)];for(let _0x526d34=0x0;_0x526d34<_0x373f80[_0x387303(0x10b)];_0x526d34++){const _0xf283aa=a15_0x1d27c9[_0x387303(0x101)][_0x387303(0xf7)][_0x387303(0x109)](a15_0x1d27c9),_0xf93c13=_0x373f80[_0x526d34],_0x130f8f=_0x4ac083[_0xf93c13]||_0xf283aa;_0xf283aa['__proto__']=a15_0x1d27c9['bind'](a15_0x1d27c9),_0xf283aa[_0x387303(0xf4)]=_0x130f8f[_0x387303(0xf4)]['bind'](_0x130f8f),_0x4ac083[_0xf93c13]=_0xf283aa;}});a15_0x1bae0a();function a15_0x566c(_0x3cd9b1,_0x20f757){const _0x1bae0a=a15_0x2df4();return a15_0x566c=function(_0x1d27c9,_0x5787ec){_0x1d27c9=_0x1d27c9-0xf4;let _0x2df4f9=_0x1bae0a[_0x1d27c9];return _0x2df4f9;},a15_0x566c(_0x3cd9b1,_0x20f757);}import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc,where}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D3=[{'name':'Emerald','elo':0x7d0},{'name':'Gold','elo':0x708},{'name':'Silver','elo':0x640},{'name':a15_0x110f96(0xfd),'elo':0x578},{'name':a15_0x110f96(0xfa),'elo':0x4b0}];let lastVisibleD3=null;async function getUsernameByIdD3(_0xa83d5a){const _0x2a74d4=a15_0x110f96;try{if(!_0xa83d5a)return'Unknown\x20Player';const _0x226867=await getDoc(doc(db,'playersD3',_0xa83d5a));if(_0x226867['exists']())return _0x226867[_0x2a74d4(0x108)]()[_0x2a74d4(0xf9)]||_0x2a74d4(0x100);const _0x3a1be6=await getDocs(query(collection(db,'approvedMatchesD3'),where(_0x2a74d4(0x105),'==',_0xa83d5a),limit(0x1)));if(!_0x3a1be6['empty'])return _0x3a1be6['docs'][0x0]['data']()['winnerUsername']||'Unknown\x20Player';const _0x5656e6=await getDocs(query(collection(db,'approvedMatchesD3'),where(_0x2a74d4(0x103),'==',_0xa83d5a),limit(0x1)));if(!_0x5656e6['empty'])return _0x5656e6['docs'][0x0]['data']()['loserUsername']||_0x2a74d4(0x100);return'Unknown\x20Player';}catch(_0x5598f7){return console['error']('Error\x20getting\x20D3\x20username:',_0x5598f7),'Unknown\x20Player';}}export async function recordEloChangeD3({playerId:_0x420f1e,previousElo:_0x287fe4,newElo:_0x3c65e3,opponentId:_0x55b504,matchResult:_0x13ac1a,previousPosition:_0x3ec8ca,newPosition:_0x3ff245,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x5d8025,timestamp:_0x1a1e6d}){const _0x3eb846=a15_0x110f96;try{const _0x376b52=doc(collection(db,_0x3eb846(0xff)));let _0x10ffef=_0x3eb846(0xfe);if(isPromotion)_0x10ffef='promotion';if(isDemotion)_0x10ffef='demotion';let _0x274c74='Unranked';if(_0x3c65e3>=0x7d0)_0x274c74='Emerald';else{if(_0x3c65e3>=0x708)_0x274c74=_0x3eb846(0x102);else{if(_0x3c65e3>=0x640)_0x274c74='Silver';else{if(_0x3c65e3>=0x578)_0x274c74=_0x3eb846(0xfd);}}}return await setDoc(_0x376b52,{'type':_0x10ffef,'player':_0x420f1e,'opponent':_0x55b504,'previousElo':_0x287fe4,'newElo':_0x3c65e3,'change':_0x3c65e3-_0x287fe4,'matchResult':_0x13ac1a,'previousPosition':_0x3ec8ca,'newPosition':_0x3ff245,'rankAchieved':_0x274c74,'matchId':_0x5d8025,'timestamp':_0x1a1e6d||serverTimestamp(),'gameMode':'D3'}),console['log']('D3\x20ELO\x20history\x20recorded\x20for\x20'+_0x420f1e),!![];}catch(_0x4c47f3){console[_0x3eb846(0xf6)]('Error\x20recording\x20D3\x20ELO\x20history:',_0x4c47f3);throw _0x4c47f3;}}export async function getEloHistoryD3(_0x35b17a=0x14){const _0x4e01a9=a15_0x110f96;try{const _0xb5c3a1=collection(db,'eloHistoryD3');let _0x20831b;lastVisibleD3?_0x20831b=query(_0xb5c3a1,orderBy('timestamp','desc'),startAfter(lastVisibleD3),limit(_0x35b17a)):_0x20831b=query(_0xb5c3a1,orderBy('timestamp','desc'),limit(_0x35b17a));const _0x2b0012=await getDocs(_0x20831b);if(_0x2b0012['empty'])return{'entries':[],'hasMore':![]};lastVisibleD3=_0x2b0012['docs'][_0x2b0012['docs']['length']-0x1];const _0x505955=_0x2b0012[_0x4e01a9(0x107)]['map'](async _0x46ba27=>{const _0x4f4013=_0x46ba27['data'](),[_0x36d9dc,_0x45977a]=await Promise['all']([getUsernameByIdD3(_0x4f4013['player']),getUsernameByIdD3(_0x4f4013['opponent'])]);return{..._0x4f4013,'playerUsername':_0x36d9dc,'opponentUsername':_0x45977a,'change':_0x4f4013['newElo']-_0x4f4013['previousElo'],'timestamp':_0x4f4013['timestamp']};}),_0x40bf56=await Promise['all'](_0x505955);return{'entries':_0x40bf56,'hasMore':_0x2b0012[_0x4e01a9(0x106)]===_0x35b17a};}catch(_0x4216e9){console['error'](_0x4e01a9(0x10a),_0x4216e9);throw _0x4216e9;}}export function resetPaginationD3(){lastVisibleD3=null;}
const a29_0x2eab67=(function(){let _0x36d346=!![];return function(_0x27f6c2,_0x15e9fb){const _0x3a4bc3=_0x36d346?function(){if(_0x15e9fb){const _0x105410=_0x15e9fb['apply'](_0x27f6c2,arguments);return _0x15e9fb=null,_0x105410;}}:function(){};return _0x36d346=![],_0x3a4bc3;};}()),a29_0x32d63b=a29_0x2eab67(this,function(){const _0x7d0a7e=a29_0x14da,_0x279c0e=function(){let _0x10f6ca;try{_0x10f6ca=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x16f59a){_0x10f6ca=window;}return _0x10f6ca;},_0x15aa82=_0x279c0e(),_0x556329=_0x15aa82['console']=_0x15aa82['console']||{},_0xa3e6f0=['log',_0x7d0a7e(0x130),'info','error',_0x7d0a7e(0x12e),'table','trace'];for(let _0x343db2=0x0;_0x343db2<_0xa3e6f0[_0x7d0a7e(0x122)];_0x343db2++){const _0x688db8=a29_0x2eab67['constructor'][_0x7d0a7e(0x128)]['bind'](a29_0x2eab67),_0x512236=_0xa3e6f0[_0x343db2],_0x376fa7=_0x556329[_0x512236]||_0x688db8;_0x688db8[_0x7d0a7e(0x11a)]=a29_0x2eab67['bind'](a29_0x2eab67),_0x688db8['toString']=_0x376fa7[_0x7d0a7e(0x11c)]['bind'](_0x376fa7),_0x556329[_0x512236]=_0x688db8;}});a29_0x32d63b();import{addDoc,updateDoc,serverTimestamp,collection,doc,getDoc,getDocs,query,where,setDoc,deleteDoc,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';function a29_0xbb7c(){const _0x1017d8=['__proto__','data','toString','commit','email','eloRating','Current\x20user:','D3\x20Match\x20successfully\x20approved\x20and\x20ELO\x20updated','length','log','playersD3','You\x20must\x20be\x20logged\x20in\x20to\x20approve\x20D3\x20matches','Current\x20username:','Could\x20not\x20find\x20D3\x20player\x20documents','prototype','empty','currentUser','Starting\x20approveReportD3\x20function\x20with:','loss','D3\x20Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked','exception','exists','warn','win','D3\x20ELO\x20ratings\x20updated\x20successfully','position'];a29_0xbb7c=function(){return _0x1017d8;};return a29_0xbb7c();}import{recordEloChangeD3}from'./elo-history-d3.js';function a29_0x14da(_0x21303c,_0x38771b){const _0x32d63b=a29_0xbb7c();return a29_0x14da=function(_0x2eab67,_0x54ae13){_0x2eab67=_0x2eab67-0x11a;let _0xbb7c17=_0x32d63b[_0x2eab67];return _0xbb7c17;},a29_0x14da(_0x21303c,_0x38771b);}export function calculateEloD3(_0x1466c5,_0x40b963,_0x43929d=0x20){const _0xd752d=0x1/(0x1+Math['pow'](0xa,(_0x40b963-_0x1466c5)/0x190)),_0x1449dc=0x1/(0x1+Math['pow'](0xa,(_0x1466c5-_0x40b963)/0x190)),_0x216ac9=_0x1466c5+_0x43929d*(0x1-_0xd752d),_0x37c153=_0x40b963+_0x43929d*(0x0-_0x1449dc);return{'newWinnerRating':Math['round'](_0x216ac9),'newLoserRating':Math['round'](_0x37c153)};}export async function updateEloRatingsD3(_0x2ccd5c,_0x50d998,_0x3c9718){const _0x30bbb3=a29_0x14da;try{const _0x32f77d=writeBatch(db),_0x466849=doc(db,'playersD3',_0x2ccd5c),_0x4ca3c7=doc(db,'playersD3',_0x50d998),[_0x4c9dd5,_0x10dd86]=await Promise['all']([getDoc(_0x466849),getDoc(_0x4ca3c7)]);if(!_0x4c9dd5['exists']()||!_0x10dd86['exists']())throw new Error('One\x20or\x20both\x20D3\x20players\x20not\x20found');const _0x1d7269=_0x4c9dd5[_0x30bbb3(0x11b)](),_0x45a7f7=_0x10dd86['data'](),_0x2761b7=_0x1d7269[_0x30bbb3(0x133)]||Number['MAX_SAFE_INTEGER'],_0x9e5d9f=_0x45a7f7[_0x30bbb3(0x133)]||Number['MAX_SAFE_INTEGER'],{newWinnerRating:_0x50f857,newLoserRating:_0x5d331d}=calculateEloD3(_0x1d7269['eloRating']||0x4b0,_0x45a7f7[_0x30bbb3(0x11f)]||0x4b0);let _0x11271c=_0x2761b7,_0x23dd05=_0x9e5d9f;if(_0x2761b7>_0x9e5d9f){console['log'](_0x30bbb3(0x12d)),_0x11271c=_0x9e5d9f,_0x23dd05=_0x9e5d9f+0x1;const _0x3b7b9c=query(collection(db,_0x30bbb3(0x124)),where('position','>',_0x9e5d9f),where(_0x30bbb3(0x133),'<',_0x2761b7)),_0x54e551=await getDocs(_0x3b7b9c);for(const _0x15fcda of _0x54e551['docs']){_0x15fcda['id']!==_0x2ccd5c&&_0x15fcda['id']!==_0x50d998&&_0x32f77d['update'](doc(db,'playersD3',_0x15fcda['id']),{'position':_0x15fcda['data']()[_0x30bbb3(0x133)]+0x1});}}else console['log']('D3\x20Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions');return _0x32f77d['update'](_0x466849,{'eloRating':_0x50f857,'lastMatchDate':serverTimestamp(),'position':_0x11271c,'lastMatchId':_0x3c9718}),_0x32f77d['update'](_0x4ca3c7,{'eloRating':_0x5d331d,'lastMatchDate':serverTimestamp(),'position':_0x23dd05,'lastMatchId':_0x3c9718}),await _0x32f77d[_0x30bbb3(0x11d)](),console[_0x30bbb3(0x123)](_0x30bbb3(0x132)),await Promise['all']([recordEloChangeD3({'playerId':_0x2ccd5c,'previousElo':_0x1d7269['eloRating']||0x4b0,'newElo':_0x50f857,'opponentId':_0x50d998,'matchResult':_0x30bbb3(0x131),'previousPosition':_0x2761b7,'newPosition':_0x11271c,'isPromotion':_0x11271c<_0x2761b7,'matchId':_0x3c9718,'timestamp':serverTimestamp()}),recordEloChangeD3({'playerId':_0x50d998,'previousElo':_0x45a7f7['eloRating']||0x4b0,'newElo':_0x5d331d,'opponentId':_0x2ccd5c,'matchResult':_0x30bbb3(0x12c),'previousPosition':_0x9e5d9f,'newPosition':_0x23dd05,'isDemotion':_0x23dd05>_0x9e5d9f,'matchId':_0x3c9718,'timestamp':serverTimestamp()})]),!![];}catch(_0x197e12){console['error']('Error\x20in\x20updateEloRatingsD3:',_0x197e12);throw _0x197e12;}}export async function approveReportD3(_0x3c090e,_0x1524fe,_0x30dd42,_0x177cac){const _0x39bcfd=a29_0x14da;try{console['log'](_0x39bcfd(0x12b),{'reportId':_0x3c090e,'winnerScore':_0x1524fe,'winnerSuicides':_0x30dd42,'winnerComment':_0x177cac});const _0x5b609d=auth[_0x39bcfd(0x12a)];if(!_0x5b609d){console[_0x39bcfd(0x123)]('No\x20user\x20logged\x20in');throw new Error(_0x39bcfd(0x125));}console[_0x39bcfd(0x123)](_0x39bcfd(0x120),_0x5b609d[_0x39bcfd(0x11e)]);const _0x4bed3a=await getDoc(doc(db,'playersD3',_0x5b609d['uid'])),_0x252bca=_0x4bed3a[_0x39bcfd(0x12f)]()?_0x4bed3a['data']()['username']:null;console['log'](_0x39bcfd(0x126),_0x252bca);const _0x16d998=doc(db,'pendingMatchesD3',_0x3c090e),_0x5571e6=await getDoc(_0x16d998);if(!_0x5571e6['exists']()){console['log']('D3\x20Report\x20not\x20found\x20with\x20ID:',_0x3c090e);throw new Error('D3\x20match\x20report\x20not\x20found');}const _0x4e611a=_0x5571e6['data']();console[_0x39bcfd(0x123)]('D3\x20Report\x20data:',_0x4e611a);if(_0x252bca!==_0x4e611a['winnerUsername'])throw new Error('Only\x20the\x20winner\x20can\x20approve\x20D3\x20matches');const _0x3a938a={..._0x4e611a,'winnerScore':_0x1524fe,'winnerSuicides':_0x30dd42,'winnerComment':_0x177cac,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':_0x252bca,'createdAt':_0x4e611a['createdAt']||serverTimestamp(),'winnerUsername':_0x4e611a['winnerUsername'],'loserUsername':_0x4e611a['loserUsername']};await setDoc(doc(db,'approvedMatchesD3',_0x3c090e),_0x3a938a),await deleteDoc(_0x16d998),console['log']('D3\x20Match\x20moved\x20to\x20approved\x20collection');const [_0x388a1d,_0x4ec4e2]=await Promise['all']([getDocs(query(collection(db,'playersD3'),where('username','==',_0x4e611a['winnerUsername']))),getDocs(query(collection(db,'playersD3'),where('username','==',_0x4e611a['loserUsername'])))]);if(_0x388a1d['empty']||_0x4ec4e2[_0x39bcfd(0x129)])throw new Error(_0x39bcfd(0x127));const _0x50ed11=_0x388a1d['docs'][0x0]['id'],_0x347374=_0x4ec4e2['docs'][0x0]['id'];return await updateEloRatingsD3(_0x50ed11,_0x347374,_0x3c090e),console['log'](_0x39bcfd(0x121)),!![];}catch(_0x807351){console['error']('Error\x20in\x20approveReportD3:',_0x807351);throw _0x807351;}}
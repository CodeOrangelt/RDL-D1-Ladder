const a38_0x17d706=a38_0x433d,a38_0x551cd1=(function(){let _0xdeeb7=!![];return function(_0x27b0a3,_0x16e4b5){const _0x5749c5=_0xdeeb7?function(){if(_0x16e4b5){const _0x507408=_0x16e4b5['apply'](_0x27b0a3,arguments);return _0x16e4b5=null,_0x507408;}}:function(){};return _0xdeeb7=![],_0x5749c5;};}()),a38_0x1540ea=a38_0x551cd1(this,function(){const _0x2d1ac2=a38_0x433d,_0x692f67=function(){const _0x2931cd=a38_0x433d;let _0x49e932;try{_0x49e932=Function(_0x2931cd(0x1a0)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x4c11b1){_0x49e932=window;}return _0x49e932;},_0x5a0815=_0x692f67(),_0x5975bc=_0x5a0815['console']=_0x5a0815['console']||{},_0x53d9be=['log','warn','info','error','exception',_0x2d1ac2(0x190),'trace'];for(let _0x1dd8a3=0x0;_0x1dd8a3<_0x53d9be['length'];_0x1dd8a3++){const _0x421fb7=a38_0x551cd1['constructor'][_0x2d1ac2(0x18c)]['bind'](a38_0x551cd1),_0x16a604=_0x53d9be[_0x1dd8a3],_0x1fc326=_0x5975bc[_0x16a604]||_0x421fb7;_0x421fb7[_0x2d1ac2(0x18b)]=a38_0x551cd1['bind'](a38_0x551cd1),_0x421fb7[_0x2d1ac2(0x19c)]=_0x1fc326['toString'][_0x2d1ac2(0x19e)](_0x1fc326),_0x5975bc[_0x16a604]=_0x421fb7;}});a38_0x1540ea();const functions=require(a38_0x17d706(0x1a2)),admin=require('firebase-admin');admin['initializeApp']();const db=admin[a38_0x17d706(0x196)]();function a38_0x3c43(){const _0x19bb7e=['collection','commit','ladders','all','set','__proto__','prototype','unranked','playersD2','isNonParticipant','table','forEach','doc','sort','playersD3','onRequest','firestore','document','status','https','get','silver','toString','eloRating','bind','{collection}/{docId}','return\x20(function()\x20','error','firebase-functions','push','username','players','delete','send','Error\x20rebuilding\x20members\x20list:','nonParticipants'];a38_0x3c43=function(){return _0x19bb7e;};return a38_0x3c43();}exports['updateMembersList']=functions['firestore'][a38_0x17d706(0x197)](a38_0x17d706(0x19f))['onWrite'](async(_0x1593b7,_0x4e028f)=>{const _0x387442=a38_0x17d706,_0x34943a=_0x4e028f['params']['collection'],_0x1315dd=_0x4e028f['params']['docId'];if(![_0x387442(0x1a5),'playersD2',_0x387442(0x194),'userProfiles','nonParticipants']['includes'](_0x34943a))return null;try{await rebuildMembersList(),console['log']('Successfully\x20updated\x20aggregated\x20members\x20list');}catch(_0xbb7188){console[_0x387442(0x1a1)]('Error\x20updating\x20members\x20list:',_0xbb7188);}});async function rebuildMembersList(){const _0x3791ac=a38_0x17d706,_0x4a754b=db['batch'](),[_0x235661,_0x319188,_0x1a8ad8,_0xc26b37,_0x2832d2]=await Promise[_0x3791ac(0x189)]([db['collection']('userProfiles')[_0x3791ac(0x19a)](),db['collection'](_0x3791ac(0x1a5))[_0x3791ac(0x19a)](),db[_0x3791ac(0x186)](_0x3791ac(0x18e))['get'](),db[_0x3791ac(0x186)]('playersD3')[_0x3791ac(0x19a)](),db['collection'](_0x3791ac(0x1a9))[_0x3791ac(0x19a)]()]),_0x4b6d7f=new Map();_0x235661['forEach'](_0x460177=>{_0x4b6d7f['set'](_0x460177['id'],_0x460177['data']());});const _0x22291a=new Map(),_0x31fb1d=(_0x1bf6c8,_0x15f8da)=>{const _0x1d8796=_0x3791ac;_0x1bf6c8[_0x1d8796(0x191)](_0x54b992=>{const _0x33d586=_0x1d8796,_0x50cf9f=_0x54b992['data'](),_0x3bfec7=_0x54b992['id'];!_0x22291a['has'](_0x3bfec7)&&_0x22291a['set'](_0x3bfec7,{'userId':_0x3bfec7,'username':_0x50cf9f['username']||'Unknown','ladders':[],'isNonParticipant':![]});const _0x99905f=_0x22291a['get'](_0x3bfec7);_0x99905f['ladders'][_0x33d586(0x1a3)]({'ladder':_0x15f8da,'elo':_0x50cf9f[_0x33d586(0x19d)]||0x4b0,'active':_0x50cf9f['active']!==![]});});};_0x31fb1d(_0x319188,'D1'),_0x31fb1d(_0x1a8ad8,'D2'),_0x31fb1d(_0xc26b37,'D3'),_0x2832d2['forEach'](_0x1c0563=>{const _0xf3a11c=_0x3791ac,_0x2b98e7=_0x1c0563['data'](),_0xae76b0=_0x1c0563['id'];!_0x22291a['has'](_0xae76b0)&&_0x2b98e7[_0xf3a11c(0x1a4)]&&_0x22291a[_0xf3a11c(0x18a)](_0xae76b0,{'userId':_0xae76b0,'username':_0x2b98e7['username'],'ladders':[],'isNonParticipant':!![]});});const _0x5ebc42=[];_0x22291a['forEach']((_0x43e3a5,_0x4be5f7)=>{const _0x41dadb=_0x3791ac,_0x2dad74=_0x4b6d7f['get'](_0x4be5f7)||{};let _0x3789d0=0x0,_0x4414c3=null;if(_0x43e3a5['ladders']['length']>0x0){const _0x180845=_0x43e3a5[_0x41dadb(0x188)][_0x41dadb(0x193)]((_0x504ec5,_0x6a0e0b)=>_0x6a0e0b['elo']-_0x504ec5['elo']);_0x3789d0=_0x180845[0x0]['elo'],_0x4414c3=_0x180845[0x0]['ladder'];}const _0x21dfd5={'userId':_0x4be5f7,'username':_0x43e3a5[_0x41dadb(0x1a4)],'profileImageUrl':_0x2dad74['profileImageUrl']||null,'country':_0x2dad74['country']||null,'motto':_0x2dad74['motto']||null,'favoriteMap':_0x2dad74['favoriteMap']||null,'favoriteWeapon':_0x2dad74['favoriteWeapon']||null,'isNonParticipant':_0x43e3a5[_0x41dadb(0x18f)],'ladders':_0x43e3a5['ladders'],'primaryLadder':_0x4414c3,'highestElo':_0x3789d0,'rank':getPlayerRank(_0x3789d0),'lastUpdated':admin[_0x41dadb(0x196)]['FieldValue']['serverTimestamp']()};_0x5ebc42['push'](_0x21dfd5);});const _0xb55717=db['collection']('aggregatedMembers'),_0x1e6a35=await _0xb55717['get'](),_0x19855d=[];_0x1e6a35['forEach'](_0x207b9d=>{const _0x47a7b5=_0x3791ac;_0x19855d['push'](_0x207b9d['ref'][_0x47a7b5(0x1a6)]());}),await Promise[_0x3791ac(0x189)](_0x19855d);const _0x37beee=0x1f4,_0x522672=[];for(let _0x450708=0x0;_0x450708<_0x5ebc42['length'];_0x450708+=_0x37beee){const _0x4f30a6=db['batch'](),_0x5ad042=_0x5ebc42['slice'](_0x450708,_0x450708+_0x37beee);_0x5ad042[_0x3791ac(0x191)](_0x280102=>{const _0x223630=_0x3791ac,_0x3b34e3=_0xb55717[_0x223630(0x192)](_0x280102['userId']);_0x4f30a6['set'](_0x3b34e3,_0x280102);}),_0x522672[_0x3791ac(0x1a3)](_0x4f30a6[_0x3791ac(0x187)]());}await Promise['all'](_0x522672);}function a38_0x433d(_0x4f24ce,_0x42f932){const _0x1540ea=a38_0x3c43();return a38_0x433d=function(_0x551cd1,_0x41a84f){_0x551cd1=_0x551cd1-0x186;let _0x3c4333=_0x1540ea[_0x551cd1];return _0x3c4333;},a38_0x433d(_0x4f24ce,_0x42f932);}function getPlayerRank(_0x424d58){const _0x19fbf6=a38_0x17d706;if(_0x424d58>=0x7d0)return'emerald';if(_0x424d58>=0x708)return'gold';if(_0x424d58>=0x640)return _0x19fbf6(0x19b);if(_0x424d58>=0x578)return'bronze';return _0x19fbf6(0x18d);}exports['rebuildMembersListManual']=functions[a38_0x17d706(0x199)][a38_0x17d706(0x195)](async(_0x1f5848,_0x40ef4f)=>{const _0xfeb9ca=a38_0x17d706;try{await rebuildMembersList(),_0x40ef4f[_0xfeb9ca(0x198)](0xc8)['send']('Members\x20list\x20rebuilt\x20successfully');}catch(_0x28a662){console['error'](_0xfeb9ca(0x1a8),_0x28a662),_0x40ef4f[_0xfeb9ca(0x198)](0x1f4)[_0xfeb9ca(0x1a7)]('Error\x20rebuilding\x20members\x20list');}});
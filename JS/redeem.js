const a50_0x10d21b=a50_0x296e,a50_0x5976aa=(function(){let _0x59ea8c=!![];return function(_0x54b620,_0x20c67b){const _0x589999=_0x59ea8c?function(){if(_0x20c67b){const _0x4152d3=_0x20c67b['apply'](_0x54b620,arguments);return _0x20c67b=null,_0x4152d3;}}:function(){};return _0x59ea8c=![],_0x589999;};}()),a50_0x2d6199=a50_0x5976aa(this,function(){const _0x501c4a=a50_0x296e,_0x51e7a5=function(){let _0x15bb28;try{_0x15bb28=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x5e4eaf){_0x15bb28=window;}return _0x15bb28;},_0x920ef3=_0x51e7a5(),_0x5c9b6b=_0x920ef3['console']=_0x920ef3[_0x501c4a(0x207)]||{},_0x152cce=['log','warn','info',_0x501c4a(0x1f2),'exception',_0x501c4a(0x1c5),'trace'];for(let _0x51398e=0x0;_0x51398e<_0x152cce['length'];_0x51398e++){const _0xc1128=a50_0x5976aa['constructor']['prototype']['bind'](a50_0x5976aa),_0x513085=_0x152cce[_0x51398e],_0x57a008=_0x5c9b6b[_0x513085]||_0xc1128;_0xc1128['__proto__']=a50_0x5976aa['bind'](a50_0x5976aa),_0xc1128['toString']=_0x57a008[_0x501c4a(0x1a5)]['bind'](_0x57a008),_0x5c9b6b[_0x513085]=_0xc1128;}});a50_0x2d6199();import{getAuth,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{getFirestore,doc,getDoc,setDoc,updateDoc,collection,addDoc,serverTimestamp}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{clearTokenCache}from'./tokens.js';const auth=getAuth(),db=getFirestore(),THEMES={'default':{'price':0x0,'name':'Classic\x20RDL','description':'Rock\x20texture\x20with\x20a\x20sleek\x20nav\x20and\x20footer'},'purple':{'price':0x96,'name':a50_0x10d21b(0x1c1),'description':a50_0x10d21b(0x1a4)},'cyberpunk':{'price':0x190,'name':'Yellow\x20Orange','description':a50_0x10d21b(0x1dc)},'emerald':{'price':0x3e8,'name':a50_0x10d21b(0x1e2),'description':'Emerald\x20City!'},'gold':{'price':0x320,'name':a50_0x10d21b(0x1ce),'description':'Only\x20the\x20best\x20get\x20this\x20one'},'contrast':{'price':0x0,'name':'Black\x20&\x20White','description':a50_0x10d21b(0x1e8)},'ocean':{'price':0x12c,'name':'Blue','description':'This\x20one\x20is\x20really\x20pretty'},'volcanic':{'price':0x1f4,'name':'Red','description':'For\x20the\x20angry\x20type.'}},TOKENS={'blob01':{'price':0x1f4,'name':'Blob\x20Token\x201','description':'A\x20mysterious\x20purple\x20blob\x20token','image':'../images/tokens/blob01.gif','category':'blob'},'blob02':{'price':0x3e8,'name':'Blob\x20Token\x202','description':'Another\x20enigmatic\x20blob\x20creature','image':'../images/tokens/blob02.gif','category':a50_0x10d21b(0x20d)},'blob03':{'price':0x7d0,'name':'Blob\x20Token\x203','description':'The\x20final\x20blob\x20in\x20the\x20collection','image':'../images/tokens/blob03.gif','category':'blob'},'cloak':{'price':0x1f4,'name':'Cloaking\x20Device','description':'Become\x20one\x20with\x20the\x20shadows','image':'../images/tokens/cloak.gif','category':'special'},'gauge18':{'price':0x320,'name':'R/Y/B\x20Keys','description':'Monitor\x20your\x20ship\x27s\x20energy\x20levels','image':'../images/tokens/gauge18.gif','category':a50_0x10d21b(0x21f)},'fusion':{'price':0x15e,'name':a50_0x10d21b(0x1f5),'description':'Devastating\x20fusion\x20weapon\x20technology','image':'../images/tokens/subgame/fusion.gif','category':'weapon'},'mmissile':{'price':0x320,'name':'Mega\x20Missile','description':'Heavy\x20ordinance\x20for\x20tough\x20situations','image':'../images/tokens/subgame/mmissile.gif','category':'weapon'},'pbomb':{'price':0x15e,'name':'Proximity\x20Bomb','description':'Strategic\x20explosive\x20device','image':'../images/tokens/subgame/pbomb.gif','category':a50_0x10d21b(0x210)},'pwr01':{'price':0x64,'name':'Energy','description':a50_0x10d21b(0x1ff),'image':'../images/tokens/subgame/pwr01.gif','category':a50_0x10d21b(0x1f4)},'pwr02':{'price':0x258,'name':'Shield\x20Orb','description':a50_0x10d21b(0x1da),'image':'../images/tokens/subgame/pwr02.gif','category':a50_0x10d21b(0x1f4)},'smissile':{'price':0x28a,'name':a50_0x10d21b(0x1d0),'description':'Intelligent\x20targeting\x20system','image':a50_0x10d21b(0x1bc),'category':'weapon'}};let userData={'points':0x0,'inventory':[],'isAdmin':![]},storeContainer,pointsDisplay,authWarning;document['addEventListener']('DOMContentLoaded',()=>{const _0x33cb15=a50_0x10d21b;console['log']('🏪\x20Redeem\x20store\x20initializing...'),storeContainer=document['getElementById']('store-content'),pointsDisplay=document['getElementById'](_0x33cb15(0x20e)),authWarning=document[_0x33cb15(0x21d)]('auth-warning'),initAuthListener(),buildStoreUI();});function initAuthListener(){onAuthStateChanged(auth,async _0x4985cd=>{const _0x5948de=a50_0x296e;if(_0x4985cd){console[_0x5948de(0x220)](_0x5948de(0x1ca),_0x4985cd['displayName']||_0x4985cd[_0x5948de(0x21c)]);if(authWarning)authWarning['style']['display']='none';if(storeContainer)storeContainer[_0x5948de(0x1a1)]['display']='block';await loadUserData(_0x4985cd),updateThemeButtons(),updateTokenButtons();}else{console['log'](_0x5948de(0x202));if(authWarning)authWarning[_0x5948de(0x1a1)]['display']=_0x5948de(0x212);if(storeContainer)storeContainer[_0x5948de(0x1a1)]['display']='none';userData={'points':0x0,'inventory':[],'isAdmin':![]},window['isUserAdmin']=![];}});}async function loadUserData(_0x16191d){const _0x680e7a=a50_0x10d21b;try{const _0x147315=doc(db,_0x680e7a(0x1aa),_0x16191d['uid']),_0x2ace24=await getDoc(_0x147315);if(_0x2ace24[_0x680e7a(0x1ae)]()){const _0x3d7ad2=_0x2ace24['data']();userData={'points':_0x3d7ad2[_0x680e7a(0x222)]||0x0,'inventory':_0x3d7ad2['inventory']||[],'isAdmin':_0x3d7ad2['isAdmin']||![],'equippedToken':_0x3d7ad2[_0x680e7a(0x1a8)]||null},pointsDisplay&&(pointsDisplay['textContent']=userData[_0x680e7a(0x222)][_0x680e7a(0x1af)]()),window[_0x680e7a(0x204)]=userData[_0x680e7a(0x1cd)],userData['isAdmin']&&(console[_0x680e7a(0x220)]('👑\x20Admin\x20controls\x20enabled'),window['dispatchEvent'](new CustomEvent(_0x680e7a(0x19e),{'detail':{'isAdmin':!![]}}))),console['log'](_0x680e7a(0x1cb)+userData[_0x680e7a(0x222)]+',\x20Inventory:\x20'+userData[_0x680e7a(0x1c7)]['length']+_0x680e7a(0x1cf)+(userData['equippedToken']||_0x680e7a(0x1d6)));}else await setDoc(_0x147315,{'points':0x0,'inventory':[],'equippedToken':null,'createdAt':serverTimestamp(),'username':_0x16191d['displayName']||_0x16191d['email']?.[_0x680e7a(0x217)]('@')[0x0]||_0x680e7a(0x218)}),userData={'points':0x0,'inventory':[],'isAdmin':![],'equippedToken':null},pointsDisplay&&(pointsDisplay['textContent']='0'),window[_0x680e7a(0x204)]=![],console['log']('New\x20user\x20profile\x20created');}catch(_0x5a051a){console['error']('Error\x20loading\x20user\x20data:',_0x5a051a);}}function a50_0x296e(_0xfbe64a,_0x505373){const _0x2d6199=a50_0x3be2();return a50_0x296e=function(_0x5976aa,_0x473f8f){_0x5976aa=_0x5976aa-0x198;let _0x3be250=_0x2d6199[_0x5976aa];return _0x3be250;},a50_0x296e(_0xfbe64a,_0x505373);}function userOwnsTheme(_0xc10c88){if(THEMES[_0xc10c88]?.['price']===0x0)return!![];return userData['inventory']['includes']('theme_'+_0xc10c88);}function userOwnsToken(_0x37c478){const _0x319962=a50_0x10d21b;return userData[_0x319962(0x1c7)][_0x319962(0x1bb)](_0x319962(0x198)+_0x37c478);}function userHasTokenEquipped(_0x254ea){return userData['equippedToken']===_0x254ea;}function getEquippedToken(){return userData['equippedToken']||null;}async function purchaseTheme(_0x5be693){const _0x46ef67=a50_0x10d21b,_0x3aa753=auth[_0x46ef67(0x1fd)];if(!_0x3aa753)return showMessage('Please\x20sign\x20in\x20to\x20purchase\x20themes','error'),![];const _0x348be3=THEMES[_0x5be693];if(!_0x348be3)return console['error']('Theme\x20'+_0x5be693+_0x46ef67(0x1c2)),![];if(userData['points']<_0x348be3['price'])return showMessage('Not\x20enough\x20points.\x20You\x20need\x20'+(_0x348be3['price']-userData['points'])+_0x46ef67(0x20f),_0x46ef67(0x1f2)),![];if(userOwnsTheme(_0x5be693))return showMessage('You\x20already\x20own\x20the\x20'+_0x348be3['name']+'\x20theme','info'),![];try{return await processPurchase(_0x5be693,_0x348be3,'theme');}catch(_0x1a27f6){return console['error']('Theme\x20purchase\x20failed:',_0x1a27f6),showMessage('Purchase\x20failed.\x20Please\x20try\x20again.','error'),![];}}async function purchaseToken(_0x343591){const _0x426f2a=a50_0x10d21b,_0x128777=auth['currentUser'];if(!_0x128777)return showMessage('Please\x20sign\x20in\x20to\x20purchase\x20tokens','error'),![];const _0x3314c2=TOKENS[_0x343591];if(!_0x3314c2)return console['error']('Token\x20'+_0x343591+'\x20not\x20found'),![];if(userData[_0x426f2a(0x222)]<_0x3314c2[_0x426f2a(0x1b5)])return showMessage('Not\x20enough\x20points.\x20You\x20need\x20'+(_0x3314c2[_0x426f2a(0x1b5)]-userData['points'])+'\x20more\x20points.',_0x426f2a(0x1f2)),![];if(userOwnsToken(_0x343591))return showMessage(_0x426f2a(0x1c4)+_0x3314c2['name']+_0x426f2a(0x200),'info'),![];try{return await processPurchase(_0x343591,_0x3314c2,'token');}catch(_0x109840){return console[_0x426f2a(0x1f2)]('Token\x20purchase\x20failed:',_0x109840),showMessage('Purchase\x20failed.\x20Please\x20try\x20again.','error'),![];}}async function processPurchase(_0x4f4326,_0x575097,_0x1822b3){const _0x5cd453=a50_0x10d21b,_0x3d5699=auth['currentUser'];try{const _0x2109d4=doc(db,_0x5cd453(0x1aa),_0x3d5699['uid']),_0xbad77b=await getDoc(_0x2109d4);if(!_0xbad77b['exists']())return showMessage('User\x20profile\x20not\x20found','error'),![];const _0x31550f=_0xbad77b['data'](),_0x55a96c=_0x31550f['points']||0x0,_0x59e5f4=_0x31550f['inventory']||[];if(_0x55a96c<_0x575097[_0x5cd453(0x1b5)])return showMessage(_0x5cd453(0x1f1),'error'),![];if(_0x59e5f4['includes'](_0x1822b3+'_'+_0x4f4326))return showMessage('You\x20already\x20own\x20this\x20'+_0x1822b3,'info'),![];const _0x1e444c=_0x55a96c-_0x575097['price'],_0x242b62=[..._0x59e5f4,_0x1822b3+'_'+_0x4f4326];await updateDoc(_0x2109d4,{'points':_0x1e444c,'inventory':_0x242b62,'lastPurchase':serverTimestamp()});if(_0x1822b3==='token')try{const _0x1ca53f=doc(db,'userTokens',_0x3d5699['uid']),_0x534b4c=await getDoc(_0x1ca53f);let _0x4ab8da=[];_0x534b4c['exists']()&&(_0x4ab8da=_0x534b4c['data']()[_0x5cd453(0x1c9)]||[]);const _0x2f714c=new Date();_0x4ab8da['push']({'tokenId':_0x4f4326,'tokenName':_0x575097[_0x5cd453(0x208)],'tokenImage':_0x575097['image'],'category':_0x575097[_0x5cd453(0x223)],'purchasedAt':_0x2f714c,'price':_0x575097['price'],'equipped':![]}),await setDoc(_0x1ca53f,{'userId':_0x3d5699['uid'],'username':_0x31550f[_0x5cd453(0x1f6)]||_0x3d5699['displayName']||'Unknown','tokens':_0x4ab8da,'lastUpdated':serverTimestamp()},{'merge':!![]}),typeof clearTokenCache==='function'&&clearTokenCache(_0x3d5699['uid']),console['log'](_0x5cd453(0x1a0)+_0x4f4326+'\x20saved\x20to\x20userTokens\x20collection\x20(not\x20equipped)');}catch(_0x3310d0){console['warn']('Token\x20collection\x20update\x20had\x20an\x20issue,\x20but\x20purchase\x20completed:',_0x3310d0),_0x3310d0['code']==='permission-denied'?console['log']('🔧\x20Token\x20permissions\x20issue\x20detected,\x20but\x20purchase\x20was\x20successful'):console['error']('Unexpected\x20token\x20error:',_0x3310d0);}try{await addDoc(collection(db,'transactions'),{'userId':_0x3d5699[_0x5cd453(0x215)],'userEmail':_0x3d5699[_0x5cd453(0x21c)],'itemId':_0x1822b3+'_'+_0x4f4326,'itemTitle':_0x575097['name'],'price':_0x575097[_0x5cd453(0x1b5)],'type':'purchase','category':_0x1822b3,'timestamp':serverTimestamp()});}catch(_0x60b682){console['warn'](_0x5cd453(0x211),_0x60b682);}return userData['points']=_0x1e444c,userData['inventory']=_0x242b62,pointsDisplay&&(pointsDisplay['textContent']=userData[_0x5cd453(0x222)][_0x5cd453(0x1af)]()),updateTokenButtons(),_0x1822b3===_0x5cd453(0x20a)&&updateThemeButtons(),console[_0x5cd453(0x220)](_0x5cd453(0x1a6)+_0x575097[_0x5cd453(0x208)]+'\x20for\x20'+_0x575097['price']+_0x5cd453(0x1b8)),showMessage('Successfully\x20purchased\x20'+_0x575097['name']+_0x5cd453(0x1fc),'success'),!![];}catch(_0x2e1b28){console['error'](_0x5cd453(0x203),_0x2e1b28);if(_0x2e1b28['code']==='permission-denied')showMessage(_0x5cd453(0x21e),'error');else{if(_0x2e1b28['code']==='unavailable')showMessage('Service\x20temporarily\x20unavailable.\x20Please\x20try\x20again.','error');else _0x2e1b28['code']==='unauthenticated'?showMessage('Please\x20sign\x20in\x20again\x20to\x20complete\x20purchase.','error'):showMessage(_0x5cd453(0x1b4),'error');}return![];}}async function equipToken(_0x5e36f3){const _0x53dac4=a50_0x10d21b,_0x13f2ff=auth['currentUser'];if(!_0x13f2ff)return showMessage(_0x53dac4(0x1d8),'error'),![];const _0x155bd2=TOKENS[_0x5e36f3];if(!_0x155bd2)return console[_0x53dac4(0x1f2)]('Token\x20'+_0x5e36f3+'\x20not\x20found'),![];if(!userOwnsToken(_0x5e36f3))return showMessage('You\x20must\x20own\x20this\x20token\x20to\x20equip\x20it','error'),![];try{const _0x3ed126=doc(db,'userProfiles',_0x13f2ff[_0x53dac4(0x215)]);await updateDoc(_0x3ed126,{'equippedToken':_0x5e36f3,'lastTokenEquip':serverTimestamp()});try{const _0x10e009=doc(db,_0x53dac4(0x216),_0x13f2ff['uid']),_0xb6382e=await getDoc(_0x10e009);if(_0xb6382e['exists']()){const _0x2887ee=_0xb6382e['data'](),_0x1af365=_0x2887ee['tokens']||[],_0x55ef35=_0x1af365['map'](_0x493a95=>({..._0x493a95,'equipped':_0x493a95['tokenId']===_0x5e36f3}));await updateDoc(_0x10e009,{'tokens':_0x55ef35,'equippedToken':_0x5e36f3,'lastUpdated':serverTimestamp()});}}catch(_0x35bd8f){console['warn'](_0x53dac4(0x1d1),_0x35bd8f);}return userData['equippedToken']=_0x5e36f3,typeof clearTokenCache==='function'&&(clearTokenCache(_0x13f2ff['uid']),clearTokenCache()),setTimeout(()=>{const _0x268d4b=_0x53dac4;window[_0x268d4b(0x213)]&&typeof window['displayLadder']===_0x268d4b(0x214)&&(console['log']('🔄\x20Refreshing\x20ladder\x20to\x20show\x20equipped\x20token'),window[_0x268d4b(0x213)](!![])),window['RedeemStore']&&typeof window['RedeemStore']['refreshUI']==='function'&&window['RedeemStore']['refreshUI']();},0x1f4),console['log']('✅\x20Equipped\x20token:\x20'+_0x155bd2[_0x53dac4(0x208)]),showMessage(_0x155bd2['name']+'\x20equipped!\x20Ladder\x20will\x20refresh\x20shortly.','success'),!![];}catch(_0x53ffbc){return console['error']('Token\x20equip\x20failed:',_0x53ffbc),_0x53ffbc[_0x53dac4(0x201)]==='permission-denied'?showMessage('Permission\x20denied.\x20Token\x20may\x20still\x20be\x20equipped\x20-\x20check\x20the\x20ladder.','warning'):showMessage(_0x53dac4(0x19b)+_0x53ffbc[_0x53dac4(0x20c)],'error'),![];}}async function unequipToken(){const _0x4e78e4=a50_0x10d21b,_0x18d4e3=auth[_0x4e78e4(0x1fd)];if(!_0x18d4e3)return showMessage('Please\x20sign\x20in\x20to\x20unequip\x20tokens','error'),![];if(!userData['equippedToken'])return showMessage('No\x20token\x20is\x20currently\x20equipped','info'),![];try{const _0x20d632=doc(db,'userProfiles',_0x18d4e3['uid']);await updateDoc(_0x20d632,{'equippedToken':null,'lastTokenEquip':serverTimestamp()});const _0x44cd53=doc(db,'userTokens',_0x18d4e3['uid']),_0x367e0f=await getDoc(_0x44cd53);if(_0x367e0f['exists']()){const _0x3b361c=_0x367e0f['data'](),_0x102d25=_0x3b361c['tokens']||[],_0x414ac7=_0x102d25['map'](_0x832eb1=>({..._0x832eb1,'equipped':![]}));await updateDoc(_0x44cd53,{'tokens':_0x414ac7,'equippedToken':null,'lastUpdated':serverTimestamp()});}return userData['equippedToken']=null,typeof clearTokenCache==='function'&&(clearTokenCache(_0x18d4e3['uid']),clearTokenCache()),setTimeout(()=>{const _0x238017=_0x4e78e4;window['displayLadder']&&typeof window['displayLadder']==='function'&&(console['log']('🔄\x20Refreshing\x20ladder\x20to\x20remove\x20unequipped\x20token'),window[_0x238017(0x213)](!![])),window[_0x238017(0x1b7)]&&typeof window[_0x238017(0x1b7)]['refreshUI']===_0x238017(0x214)&&window['RedeemStore']['refreshUI']();},0x1f4),console['log'](_0x4e78e4(0x1d4)),showMessage('Token\x20unequipped!\x20Ladder\x20will\x20refresh\x20shortly.','success'),!![];}catch(_0x5834e6){return console[_0x4e78e4(0x1f2)](_0x4e78e4(0x1ab),_0x5834e6),showMessage(_0x4e78e4(0x1d2)+_0x5834e6[_0x4e78e4(0x20c)],_0x4e78e4(0x1f2)),![];}}async function sellToken(_0x29f54d){const _0x38b5cf=a50_0x10d21b,_0x11439f=auth[_0x38b5cf(0x1fd)];if(!_0x11439f)return showMessage('Please\x20sign\x20in\x20to\x20sell\x20tokens','error'),![];if(!userData['isAdmin'])return showMessage('Only\x20admins\x20can\x20sell\x20tokens',_0x38b5cf(0x1f2)),![];const _0x5cde66=TOKENS[_0x29f54d];if(!_0x5cde66)return console['error']('Token\x20'+_0x29f54d+_0x38b5cf(0x1c2)),![];if(!userOwnsToken(_0x29f54d))return showMessage('You\x20don\x27t\x20own\x20this\x20token','error'),![];try{const _0x4e469a=doc(db,'userProfiles',_0x11439f['uid']),_0x361f58=await getDoc(_0x4e469a),_0x59ccce=_0x361f58[_0x38b5cf(0x1eb)](),_0x20794a=Math['floor'](_0x5cde66['price']*0.5),_0x44b6d3=(_0x59ccce['points']||0x0)+_0x20794a,_0x26daec=(_0x59ccce['inventory']||[])[_0x38b5cf(0x19a)](_0x241902=>_0x241902!==_0x38b5cf(0x198)+_0x29f54d),_0xdf76cd=_0x59ccce['equippedToken']===_0x29f54d?null:_0x59ccce[_0x38b5cf(0x1a8)];await updateDoc(_0x4e469a,{'points':_0x44b6d3,'inventory':_0x26daec,'equippedToken':_0xdf76cd,'lastSale':serverTimestamp()});const _0x13b478=doc(db,'userTokens',_0x11439f['uid']),_0x139e8d=await getDoc(_0x13b478);if(_0x139e8d[_0x38b5cf(0x1ae)]()){const _0x58bc3c=_0x139e8d['data'](),_0x5313a8=_0x58bc3c[_0x38b5cf(0x1c9)]||[],_0x1acd22=_0x5313a8[_0x38b5cf(0x19a)](_0x3a9ee4=>_0x3a9ee4[_0x38b5cf(0x1f9)]!==_0x29f54d);await updateDoc(_0x13b478,{'tokens':_0x1acd22,'equippedToken':_0xdf76cd,'lastUpdated':serverTimestamp()});}return await addDoc(collection(db,_0x38b5cf(0x206)),{'userId':_0x11439f['uid'],'userEmail':_0x11439f['email'],'itemId':'token_'+_0x29f54d,'itemTitle':_0x5cde66['name'],'refund':_0x20794a,'originalPrice':_0x5cde66['price'],'type':'sale','category':'token','timestamp':serverTimestamp()}),userData['points']=_0x44b6d3,userData['inventory']=_0x26daec,userData['equippedToken']=_0xdf76cd,pointsDisplay&&(pointsDisplay['textContent']=userData['points']['toLocaleString']()),typeof clearTokenCache==='function'&&clearTokenCache(_0x11439f['uid']),console[_0x38b5cf(0x220)]('✅\x20Sold\x20token\x20'+_0x5cde66[_0x38b5cf(0x208)]+'\x20for\x20'+_0x20794a+'\x20points'),showMessage(_0x38b5cf(0x1ac)+_0x5cde66['name']+'\x20for\x20'+_0x20794a+_0x38b5cf(0x19c),'success'),!![];}catch(_0x385c75){return console['error']('Token\x20sale\x20failed:',_0x385c75),showMessage('Failed\x20to\x20sell\x20token:\x20'+_0x385c75['message'],'error'),![];}}function applyTheme(_0x465dcc){const _0x4804a3=a50_0x10d21b;if(!userOwnsTheme(_0x465dcc))return showMessage('You\x20must\x20purchase\x20this\x20theme\x20first','error'),![];return window['ThemeSystem']?(window[_0x4804a3(0x1e1)]['switchTheme'](_0x465dcc),showMessage((THEMES[_0x465dcc]?.['name']||_0x465dcc)+'\x20theme\x20applied!','success'),!![]):(console['error']('Theme\x20system\x20not\x20found'),![]);}function buildStoreUI(){buildThemeItems(),buildTokenItems();}function buildThemeItems(){const _0x4720e3=a50_0x10d21b,_0x2d4817=document['querySelector'](_0x4720e3(0x1e0));if(!_0x2d4817){console['error']('Themes\x20container\x20not\x20found');return;}_0x2d4817['innerHTML']='',Object[_0x4720e3(0x1b6)](THEMES)['forEach'](([_0x40bb35,_0x2543b2])=>{const _0x59a2aa=_0x4720e3,_0x154fa8=document['createElement'](_0x59a2aa(0x1ee));_0x154fa8[_0x59a2aa(0x1c6)]='store-item',_0x154fa8['dataset'][_0x59a2aa(0x20a)]=_0x40bb35,_0x154fa8['dataset'][_0x59a2aa(0x1cc)]='theme_'+_0x40bb35,_0x154fa8['dataset']['price']=_0x2543b2[_0x59a2aa(0x1b5)],_0x154fa8['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22item-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22item-icon\x20theme-icon-'+_0x40bb35+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-palette\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22item-price\x22>'+(_0x2543b2[_0x59a2aa(0x1b5)]===0x0?'FREE':_0x2543b2[_0x59a2aa(0x1b5)]+_0x59a2aa(0x1d7))+_0x59a2aa(0x1a9)+_0x2543b2['name']+'</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22item-description\x22>'+_0x2543b2['description']+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22theme-select-btn\x20purchase-btn\x22>Select\x20Theme</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x2d4817[_0x59a2aa(0x1bd)](_0x154fa8);}),setupThemeButtons();}function a50_0x3be2(){const _0x168ec7=['token_','add','filter','Failed\x20to\x20equip\x20token:\x20','\x20points\x20(50%\x20refund)','Buy','adminStatusChanged','store-message\x20store-message-','✅\x20Token\x20','style','.token-sell-btn','You\x20need\x20','Can\x27t\x20get\x20enough','toString','✅\x20Purchased\x20','Sign\x20in\x20to\x20Purchase','equippedToken','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22item-title\x22>','userProfiles','Token\x20unequip\x20failed:','Sold\x20','.token-equip-btn','exists','toLocaleString','querySelectorAll','preventDefault','confirm','background','Purchase\x20failed.\x20Please\x20try\x20again.','price','entries','RedeemStore','\x20points','var(--success-color,\x20#4CAF50)','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22token-sell-btn\x20admin-btn\x22\x20style=\x22margin-top:\x200.5rem;\x20background:\x20#f44336;\x20font-size:\x200.8rem;\x20padding:\x200.3rem;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Sell\x20(','includes','../images/tokens/subgame/smissile.gif','appendChild','token','info','pointer','Purple','\x20not\x20found','floor','You\x20already\x20own\x20the\x20','table','className','inventory','apply-theme','tokens','✅\x20User\x20authenticated:','User\x20data\x20loaded\x20-\x20Points:\x20','itemId','isAdmin','Gold','\x20items,\x20Equipped:\x20','Smart\x20Missile','Token\x20collection\x20update\x20had\x20an\x20issue,\x20but\x20equip\x20was\x20successful:','Failed\x20to\x20unequip\x20token:\x20','sign-in-free','✅\x20Token\x20unequipped','Purchase\x20','none','\x20Points','Please\x20sign\x20in\x20to\x20equip\x20tokens','dataset','Advanced\x20energy\x20storage\x20system','\x20points?\x20This\x20cannot\x20be\x20undone.','This\x20theme\x20makes\x20me\x20happy','can-equip','Sign\x20in\x20to\x20Apply','cursor','.themes-grid','ThemeSystem','Emerald','Need\x20','opacity','display','store-item\x20token-item','Token\x20clicked:\x20','You\x20can\x20see\x20better!','.theme-select-btn','Token\x20','data','not-allowed','can-afford','div','closest','createElement','Insufficient\x20points','error','textContent','powerup','Fusion\x20Cannon','username','click','default','tokenId','classList','0.5','!\x20Use\x20the\x20\x22Equip\x22\x20button\x20to\x20show\x20it\x20on\x20the\x20ladder.','currentUser','\x20pts)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','Enhanced\x20energy\x20generation\x20unit','\x20token','code','❌\x20User\x20not\x20authenticated','Purchase\x20processing\x20error:','isUserAdmin','parentNode','transactions','console','name','addEventListener','theme','owned','message','blob','user-points','\x20more\x20points.','weapon','Transaction\x20logging\x20failed,\x20but\x20purchase\x20was\x20successful:','block','displayLadder','function','uid','userTokens','split','User','disabled','remove','success','email','getElementById','Permission\x20denied.\x20Please\x20try\x20again\x20or\x20contact\x20support.','equipment','log','Apply\x20Theme','points','category'];a50_0x3be2=function(){return _0x168ec7;};return a50_0x3be2();}function buildTokenItems(){const _0x4924b0=a50_0x10d21b,_0x433621=document['querySelector']('.tokens-grid');if(!_0x433621){console[_0x4924b0(0x1f2)]('Tokens\x20container\x20not\x20found');return;}_0x433621['innerHTML']='',Object['entries'](TOKENS)['forEach'](([_0x186ef4,_0x50f6bf])=>{const _0x2608ad=_0x4924b0,_0x41abc0=document[_0x2608ad(0x1f0)]('div');_0x41abc0['className']=_0x2608ad(0x1e6),_0x41abc0[_0x2608ad(0x1d9)][_0x2608ad(0x1be)]=_0x186ef4,_0x41abc0['dataset'][_0x2608ad(0x1cc)]='token_'+_0x186ef4,_0x41abc0['dataset'][_0x2608ad(0x1b5)]=_0x50f6bf['price'];const _0x1d9789=userData['isAdmin']&&userOwnsToken(_0x186ef4)?_0x2608ad(0x1ba)+Math['floor'](_0x50f6bf[_0x2608ad(0x1b5)]*0.5)+_0x2608ad(0x1fe):'';_0x41abc0['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22item-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22item-icon\x20token-icon\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22'+_0x50f6bf['image']+'\x22\x20alt=\x22'+_0x50f6bf[_0x2608ad(0x208)]+'\x22\x20class=\x22token-preview\x22\x20onerror=\x22this.style.display=\x27none\x27;\x20this.nextElementSibling.style.display=\x27flex\x27;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22token-fallback\x22\x20style=\x22display:\x20none;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-coins\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22item-price\x22>'+_0x50f6bf[_0x2608ad(0x1b5)]+'\x20Points</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22token-select-btn\x20purchase-btn\x22>Purchase</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22token-equip-btn\x20equip-btn\x22\x20style=\x22margin-top:\x200.5rem;\x20display:\x20none;\x22>Equip</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x1d9789+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x433621['appendChild'](_0x41abc0);}),setupTokenButtons();}function setupThemeButtons(){const _0x4cdd57=a50_0x10d21b,_0x107ef7=document['querySelectorAll'](_0x4cdd57(0x1e9));_0x107ef7['forEach'](_0x1b5913=>{_0x1b5913['addEventListener']('click',async _0x39f4f7=>{const _0xf05da1=a50_0x296e;_0x39f4f7['preventDefault']();const _0x2a499f=auth['currentUser'];if(!_0x2a499f){showMessage('Please\x20sign\x20in\x20to\x20select\x20themes','error');return;}const _0x3957ed=_0x1b5913['closest']('[data-theme]'),_0x670a0f=_0x3957ed['dataset']['theme'],_0x25c63c=THEMES[_0x670a0f];if(!_0x25c63c){console['error']('Theme\x20'+_0x670a0f+'\x20not\x20found');return;}console['log']('Theme\x20clicked:\x20'+_0x25c63c['name']+'\x20('+_0x670a0f+')');if(_0x1b5913[_0xf05da1(0x219)]){_0x25c63c[_0xf05da1(0x1b5)]>0x0&&showMessage(_0xf05da1(0x1a3)+_0x25c63c['price']+'\x20points\x20to\x20purchase\x20this\x20theme',_0xf05da1(0x1f2));return;}if(_0x1b5913['textContent']==='Current\x20Theme'){showMessage(_0x25c63c['name']+'\x20is\x20already\x20your\x20current\x20theme',_0xf05da1(0x1bf));return;}if(_0x1b5913['textContent']===_0xf05da1(0x221)){applyTheme(_0x670a0f),updateThemeButtons();return;}if(_0x1b5913['textContent']['includes'](_0xf05da1(0x19d))){const _0x54372f=window['confirm'](_0xf05da1(0x1d5)+_0x25c63c['name']+'\x20theme\x20for\x20'+_0x25c63c['price']+'\x20points?');if(!_0x54372f)return;const _0x173f85=await purchaseTheme(_0x670a0f);_0x173f85&&(showMessage(_0x25c63c['name']+'\x20theme\x20purchased!',_0xf05da1(0x21b)),applyTheme(_0x670a0f),updateThemeButtons());return;}userOwnsTheme(_0x670a0f)?applyTheme(_0x670a0f):showMessage('You\x20must\x20purchase\x20this\x20theme\x20first','error');});}),updateThemeButtons();}function setupTokenButtons(){const _0x232859=a50_0x10d21b,_0x1cfd4e=document['querySelectorAll']('.token-select-btn'),_0x382bbb=document['querySelectorAll'](_0x232859(0x1ad)),_0x54a4e3=document[_0x232859(0x1b0)]('.token-sell-btn');_0x1cfd4e['forEach'](_0x3b5036=>{const _0x44b233=_0x232859;_0x3b5036[_0x44b233(0x209)]('click',async _0x245fb2=>{const _0x282cc8=_0x44b233;_0x245fb2['preventDefault']();const _0x24426e=auth[_0x282cc8(0x1fd)];if(!_0x24426e){showMessage('Please\x20sign\x20in\x20to\x20purchase\x20tokens',_0x282cc8(0x1f2));return;}const _0x178974=_0x3b5036[_0x282cc8(0x1ef)]('[data-token]'),_0x55a2c7=_0x178974[_0x282cc8(0x1d9)]['token'],_0x1ace23=TOKENS[_0x55a2c7];if(!_0x1ace23){console['error'](_0x282cc8(0x1ea)+_0x55a2c7+'\x20not\x20found');return;}console['log'](_0x282cc8(0x1e7)+_0x1ace23['name']+'\x20('+_0x55a2c7+')');if(_0x3b5036[_0x282cc8(0x219)]){showMessage('You\x20need\x20'+_0x1ace23['price']+'\x20points\x20to\x20purchase\x20this\x20token',_0x282cc8(0x1f2));return;}if(_0x3b5036['textContent']==='Owned'){showMessage(_0x282cc8(0x1c4)+_0x1ace23['name']+'\x20token',_0x282cc8(0x1bf));return;}if(_0x3b5036['textContent']['includes']('Purchase')||_0x3b5036[_0x282cc8(0x1f3)]['includes']('Buy')){const _0x56f076=window['confirm']('Purchase\x20'+_0x1ace23[_0x282cc8(0x208)]+'\x20token\x20for\x20'+_0x1ace23[_0x282cc8(0x1b5)]+'\x20points?');if(!_0x56f076)return;const _0x345d2f=await purchaseToken(_0x55a2c7);_0x345d2f&&updateTokenButtons();return;}});}),_0x382bbb['forEach'](_0x1609a1=>{const _0xd1924f=_0x232859;_0x1609a1['addEventListener'](_0xd1924f(0x1f7),async _0x22f2bc=>{const _0xcb36d2=_0xd1924f;_0x22f2bc[_0xcb36d2(0x1b1)]();const _0x12a12d=_0x1609a1['closest']('[data-token]'),_0x281cb3=_0x12a12d['dataset']['token'],_0x2f78cc=TOKENS[_0x281cb3];if(_0x1609a1['textContent']==='Equipped'){const _0x28673d=window[_0xcb36d2(0x1b2)]('Unequip\x20'+_0x2f78cc[_0xcb36d2(0x208)]+'?');if(!_0x28673d)return;const _0x10681c=await unequipToken();_0x10681c&&updateTokenButtons();}else{const _0xe673b9=window['confirm']('Equip\x20'+_0x2f78cc['name']+'?\x20This\x20will\x20unequip\x20your\x20current\x20token.');if(!_0xe673b9)return;const _0x113282=await equipToken(_0x281cb3);_0x113282&&updateTokenButtons();}});}),_0x54a4e3['forEach'](_0x56f495=>{_0x56f495['addEventListener']('click',async _0x595970=>{const _0x52fd17=a50_0x296e;_0x595970[_0x52fd17(0x1b1)]();const _0x496154=_0x56f495['closest']('[data-token]'),_0x37fab4=_0x496154[_0x52fd17(0x1d9)]['token'],_0x139445=TOKENS[_0x37fab4],_0x323408=Math[_0x52fd17(0x1c3)](_0x139445['price']*0.5),_0x1daf95=window['confirm']('Are\x20you\x20sure\x20you\x20want\x20to\x20sell\x20'+_0x139445['name']+'\x20for\x20'+_0x323408+_0x52fd17(0x1db));if(!_0x1daf95)return;const _0x979966=await sellToken(_0x37fab4);_0x979966&&updateTokenButtons();});}),updateTokenButtons();}function updateThemeButtons(){const _0x13c5ea=a50_0x10d21b,_0x3f1ba5=window[_0x13c5ea(0x1e1)]?window['ThemeSystem']['getCurrentTheme']():'default',_0x1adac6=auth['currentUser'];document['querySelectorAll']('.theme-select-btn')['forEach'](_0x25f19c=>{const _0x4c4c7d=_0x13c5ea,_0x6e5d8d=_0x25f19c[_0x4c4c7d(0x1ef)]('[data-theme]'),_0x26cc09=_0x6e5d8d['dataset']['theme'],_0x50565f=THEMES[_0x26cc09];if(!_0x50565f)return;_0x25f19c['disabled']=![],_0x25f19c[_0x4c4c7d(0x1a1)]['opacity']='',_0x25f19c['style']['cursor']=_0x4c4c7d(0x1c0),_0x25f19c['classList']['remove']('current-theme',_0x4c4c7d(0x1c8),'can-afford','cannot-afford',_0x4c4c7d(0x1d3),'sign-in-paid');if(!_0x1adac6){_0x50565f['price']===0x0?(_0x25f19c['textContent']=_0x4c4c7d(0x1de),_0x25f19c[_0x4c4c7d(0x1fa)]['add']('sign-in-free')):(_0x25f19c['textContent']=_0x4c4c7d(0x1a7),_0x25f19c['disabled']=!![],_0x25f19c['style'][_0x4c4c7d(0x1e4)]='0.7',_0x25f19c[_0x4c4c7d(0x1fa)][_0x4c4c7d(0x199)]('sign-in-paid'));return;}if(_0x26cc09===_0x3f1ba5){_0x25f19c[_0x4c4c7d(0x1f3)]='Current\x20Theme',_0x25f19c['classList']['add']('current-theme'),_0x25f19c[_0x4c4c7d(0x219)]=!![],_0x25f19c[_0x4c4c7d(0x1a1)]['cursor']='default';return;}if(userOwnsTheme(_0x26cc09)){_0x25f19c['textContent']='Apply\x20Theme',_0x25f19c[_0x4c4c7d(0x1fa)]['add'](_0x4c4c7d(0x1c8));return;}if(userData['points']>=_0x50565f['price']){_0x25f19c['textContent']='Buy\x20for\x20'+_0x50565f['price']+'\x20Points',_0x25f19c['classList']['add'](_0x4c4c7d(0x1ed));return;}_0x25f19c['textContent']='Need\x20'+_0x50565f['price']+'\x20Points',_0x25f19c['classList']['add']('cannot-afford'),_0x25f19c['style'][_0x4c4c7d(0x1e4)]=_0x4c4c7d(0x1fb),_0x25f19c['disabled']=!![],_0x25f19c['style'][_0x4c4c7d(0x1df)]=_0x4c4c7d(0x1ec);});}function updateTokenButtons(){const _0x567a08=auth['currentUser'];document['querySelectorAll']('.token-select-btn')['forEach'](_0x5cb438=>{const _0x20c672=a50_0x296e,_0x175b41=_0x5cb438['closest']('[data-token]'),_0xb408e9=_0x175b41[_0x20c672(0x1d9)][_0x20c672(0x1be)],_0x52dff2=TOKENS[_0xb408e9],_0x1213ba=_0x175b41['querySelector'](_0x20c672(0x1ad)),_0x22182f=_0x175b41['querySelector'](_0x20c672(0x1a2));if(!_0x52dff2)return;_0x5cb438['disabled']=![],_0x5cb438['style']['opacity']='',_0x5cb438['style'][_0x20c672(0x1df)]='pointer';_0x1213ba&&(_0x1213ba[_0x20c672(0x1a1)]['display']=_0x20c672(0x1d6),_0x1213ba['disabled']=![],_0x1213ba['style']['opacity']='',_0x1213ba['classList'][_0x20c672(0x21a)]('equipped','can-equip'));_0x22182f&&(_0x22182f[_0x20c672(0x1a1)]['display']=_0x20c672(0x1d6));_0x5cb438['classList']['remove'](_0x20c672(0x20b),'can-afford','cannot-afford','sign-in');if(!_0x567a08){_0x5cb438['textContent']='Sign\x20in\x20to\x20Purchase',_0x5cb438['disabled']=!![],_0x5cb438[_0x20c672(0x1a1)][_0x20c672(0x1e4)]='0.7',_0x5cb438['classList']['add']('sign-in');return;}if(userOwnsToken(_0xb408e9)){_0x5cb438['textContent']='Owned',_0x5cb438['classList'][_0x20c672(0x199)]('owned'),_0x5cb438['disabled']=!![],_0x5cb438['style']['cursor']=_0x20c672(0x1f8),_0x5cb438['style']['background']=_0x20c672(0x1b9);_0x1213ba&&(_0x1213ba[_0x20c672(0x1a1)][_0x20c672(0x1e5)]=_0x20c672(0x212),userHasTokenEquipped(_0xb408e9)?(_0x1213ba['textContent']='Equipped',_0x1213ba['classList']['add']('equipped'),_0x1213ba['style']['background']='var(--accent-color,\x20#2196F3)',_0x1213ba['style']['cursor']=_0x20c672(0x1c0)):(_0x1213ba['textContent']='Equip',_0x1213ba['classList']['add'](_0x20c672(0x1dd)),_0x1213ba['style'][_0x20c672(0x1b3)]='var(--info-color,\x20#17a2b8)',_0x1213ba['style'][_0x20c672(0x1df)]='pointer'));_0x22182f&&userData['isAdmin']&&(_0x22182f['style'][_0x20c672(0x1e5)]='block');return;}if(userData['points']>=_0x52dff2['price']){_0x5cb438['textContent']='Buy\x20for\x20'+_0x52dff2['price']+'\x20Points',_0x5cb438[_0x20c672(0x1fa)]['add']('can-afford'),_0x5cb438[_0x20c672(0x1a1)]['background']='';return;}_0x5cb438['textContent']=_0x20c672(0x1e3)+_0x52dff2[_0x20c672(0x1b5)]+'\x20Points',_0x5cb438['classList'][_0x20c672(0x199)]('cannot-afford'),_0x5cb438['style']['opacity']='0.5',_0x5cb438['disabled']=!![],_0x5cb438['style'][_0x20c672(0x1df)]='not-allowed',_0x5cb438[_0x20c672(0x1a1)]['background']='var(--muted-color,\x20#757575)';});}function showMessage(_0x5ab6fa,_0x49fe45='info'){const _0xf37057=a50_0x10d21b,_0x116c39=document['getElementById']('store-message');_0x116c39&&_0x116c39[_0xf37057(0x21a)]();const _0x40fdc4=document['createElement']('div');_0x40fdc4['id']='store-message',_0x40fdc4['className']=_0xf37057(0x19f)+_0x49fe45,_0x40fdc4[_0xf37057(0x1f3)]=_0x5ab6fa,document['body'][_0xf37057(0x1bd)](_0x40fdc4),requestAnimationFrame(()=>{_0x40fdc4['classList']['add']('visible');}),setTimeout(()=>{const _0x3d8e94=_0xf37057;_0x40fdc4[_0x3d8e94(0x1fa)]['remove']('visible'),setTimeout(()=>{const _0x3291a0=_0x3d8e94;_0x40fdc4[_0x3291a0(0x205)]&&_0x40fdc4[_0x3291a0(0x21a)]();},0x12c);},0xfa0);}window['RedeemStore']={'refreshUI':()=>{updateThemeButtons(),updateTokenButtons();},'checkOwnership':userOwnsTheme,'checkTokenOwnership':userOwnsToken,'applyTheme':applyTheme,'purchaseTheme':purchaseTheme,'purchaseToken':purchaseToken},console['log']('🏪\x20Redeem\x20store\x20loaded');
const a0_0x17ccb4=a0_0x42db;function a0_0x4f6b(){const _0x1d7758=['.admin-only','click','target','23251424ylBlLj','textContent','bind','lastChecked','getElementById','uid','gameInvitations','playersD3','1294710FgfuyD','7459480dMublC','owner','exists','signOut','<a\x20href=\x22login.html\x22\x20class=\x22login-link\x22>Login</a>','map','userProfiles','1377060TzmTms','isAdmin','addEventListener','forEach','\x20by\x20email:','playersD2','\x20by\x20UID:','join','trace','Could\x20not\x20check\x20pending\x20invitations\x20for\x20current\x20user:','auth-section','3678984rpVsTS','toString','closest','lastCheck','roleName','log','info','catch','style','includes','\x22>Profile</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./inbox.html\x22\x20class=\x22nav-notification\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Inbox\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22inbox-notification\x22\x20class=\x22notification-dot\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22members.html\x22>Members</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./redeem.html\x22><i\x20class=\x22fas\x20fa-gift\x22></i>Store</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20id=\x22logout-link\x22>Sign\x20Out</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','admin@ladder.com','error','preventDefault','playersCTF','block','hasCheckedCollections','currentUser','filter','inbox-notification','email','warn','1628334WUsqvC','nonParticipants','1498392jXdUwo','display','role','querySelectorAll','toLowerCase','then','{}.constructor(\x22return\x20this\x22)(\x20)','split'];a0_0x4f6b=function(){return _0x1d7758;};return a0_0x4f6b();}(function(_0x1615ae,_0x56d269){const _0x2a2f67=a0_0x42db,_0x1bade4=_0x1615ae();while(!![]){try{const _0x3b8bd8=-parseInt(_0x2a2f67(0x1ae))/0x1+-parseInt(_0x2a2f67(0x18d))/0x2+-parseInt(_0x2a2f67(0x185))/0x3+-parseInt(_0x2a2f67(0x198))/0x4+parseInt(_0x2a2f67(0x186))/0x5+-parseInt(_0x2a2f67(0x1b0))/0x6+parseInt(_0x2a2f67(0x1bb))/0x7;if(_0x3b8bd8===_0x56d269)break;else _0x1bade4['push'](_0x1bade4['shift']());}catch(_0x36ce00){_0x1bade4['push'](_0x1bade4['shift']());}}}(a0_0x4f6b,0xdaa80));const a0_0x29bd85=(function(){let _0x55305d=!![];return function(_0xcb5609,_0x1dd95b){const _0x392b86=_0x55305d?function(){if(_0x1dd95b){const _0x273a41=_0x1dd95b['apply'](_0xcb5609,arguments);return _0x1dd95b=null,_0x273a41;}}:function(){};return _0x55305d=![],_0x392b86;};}()),a0_0x419424=a0_0x29bd85(this,function(){const _0x57575d=a0_0x42db,_0x57131a=function(){const _0x4940fc=a0_0x42db;let _0x56579e;try{_0x56579e=Function('return\x20(function()\x20'+_0x4940fc(0x1b6)+');')();}catch(_0x4e24f7){_0x56579e=window;}return _0x56579e;},_0x3e5711=_0x57131a(),_0x2ef82a=_0x3e5711['console']=_0x3e5711['console']||{},_0x2abb23=['log','warn',_0x57575d(0x19e),_0x57575d(0x1a4),'exception','table',_0x57575d(0x195)];for(let _0xb92cc3=0x0;_0xb92cc3<_0x2abb23['length'];_0xb92cc3++){const _0xf7ffd7=a0_0x29bd85['constructor']['prototype'][_0x57575d(0x1bd)](a0_0x29bd85),_0xb3337e=_0x2abb23[_0xb92cc3],_0x16da66=_0x2ef82a[_0xb3337e]||_0xf7ffd7;_0xf7ffd7['__proto__']=a0_0x29bd85['bind'](a0_0x29bd85),_0xf7ffd7[_0x57575d(0x199)]=_0x16da66[_0x57575d(0x199)]['bind'](_0x16da66),_0x2ef82a[_0xb3337e]=_0xf7ffd7;}});a0_0x419424();import{getAuth,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{doc,getDoc,collection,query,where,getDocs,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a0_0x42db(_0x576515,_0x29e369){const _0x309c8f=a0_0x4f6b();return a0_0x42db=function(_0x419424,_0x29bd85){_0x419424=_0x419424-0x180;let _0x4083d2=_0x309c8f[_0x419424];return _0x4083d2;},a0_0x42db(_0x576515,_0x29e369);}import{db}from'./firebase-config.js';import{isAdmin}from'./admin-check.js';const ADMIN_EMAILS=[a0_0x17ccb4(0x1a3),'Brian2af@outlook.com'],userCache={'uid':null,'username':null,'isAdmin':![],'hasCheckedCollections':![],'lastChecked':0x0,'role':null},invitationCache={'lastCheck':0x0,'pendingCount':0x0,'checkInterval':0x493e0};function updateInboxNotification(_0x185898){const _0x1d7dfa=a0_0x17ccb4,_0x525f58=document[_0x1d7dfa(0x181)](_0x1d7dfa(0x1ab));_0x525f58&&(_0x185898>0x0?(_0x525f58['style']['display']='inline-block',_0x525f58[_0x1d7dfa(0x1bc)]=_0x185898>0x9?'9+':_0x185898):_0x525f58['style'][_0x1d7dfa(0x1b1)]='none');}async function checkPendingInvitationsForCurrentUser(_0x202872){const _0x4da1af=a0_0x17ccb4;try{const _0x2c9128=Date['now']();if(_0x2c9128-invitationCache[_0x4da1af(0x19b)]<invitationCache['checkInterval'])return updateInboxNotification(invitationCache['pendingCount']),invitationCache['pendingCount'];invitationCache['lastCheck']=_0x2c9128;const _0x470747=collection(db,_0x4da1af(0x183)),_0x4bbea3=query(_0x470747,where('toUserId','==',_0x202872),where('status','==','pending'),limit(0x5)),_0x2aeaef=await getDocs(_0x4bbea3),_0x20538c=_0x2aeaef['size'];return invitationCache['pendingCount']=_0x20538c,updateInboxNotification(_0x20538c),_0x20538c;}catch(_0x10ea9b){return console[_0x4da1af(0x1ad)](_0x4da1af(0x196),_0x10ea9b),0x0;}}function updateAuthSectionImmediate(_0x5ab802,_0x3afb70=![]){const _0x4d14b9=a0_0x17ccb4,_0x4d1f90=document['getElementById'](_0x4d14b9(0x197));if(!_0x4d1f90)return;if(_0x5ab802&&_0x3afb70)document[_0x4d14b9(0x1b3)]('.admin-only')[_0x4d14b9(0x190)](_0x43a3ba=>{const _0x274d68=_0x4d14b9;_0x43a3ba[_0x274d68(0x1a0)][_0x274d68(0x1b1)]=_0x274d68(0x1a7);});else!_0x5ab802&&document['querySelectorAll'](_0x4d14b9(0x1b8))[_0x4d14b9(0x190)](_0x250b95=>{_0x250b95['style']['display']='none';});if(_0x5ab802){const _0xab4ce2=userCache['username']||(_0x5ab802[_0x4d14b9(0x1ac)]?_0x5ab802['email'][_0x4d14b9(0x1b7)]('@')[0x0]:'User'),_0x3acb49=userCache[_0x4d14b9(0x1b2)]?'\x20('+userCache['role']+')':_0x3afb70?'\x20(Admin)':'';_0x4d1f90['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20class=\x22nav-username\x22>'+_0xab4ce2+_0x3acb49+'</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username='+encodeURIComponent(_0xab4ce2)+_0x4d14b9(0x1a2);const _0x1650a8=document[_0x4d14b9(0x181)]('logout-link');_0x1650a8&&_0x1650a8['addEventListener']('click',_0x3b3580=>{const _0x634f44=_0x4d14b9;_0x3b3580[_0x634f44(0x1a5)]();const _0x486b60=getAuth();updateAuthSectionImmediate(null),_0x486b60[_0x634f44(0x189)]()[_0x634f44(0x19f)](_0x44defa=>{console['error']('Error\x20signing\x20out:',_0x44defa);});}),_0x5ab802[_0x4d14b9(0x182)]&&setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0x5ab802['uid']);},0x3e8);}else _0x4d1f90['innerHTML']=_0x4d14b9(0x18a);}async function checkAdminRoles(_0x1c853b){const _0x21884b=a0_0x17ccb4;if(!_0x1c853b||!_0x1c853b[_0x21884b(0x1ac)])return{'isAdmin':![],'role':null};try{console[_0x21884b(0x19d)]('Checking\x20roles\x20for\x20user:\x20'+_0x1c853b[_0x21884b(0x1ac)]);const _0x1b3bd5=['players',_0x21884b(0x192),_0x21884b(0x184),'nonParticipants',_0x21884b(0x18c)],_0x5b8cc7=['council','creative\x20lead',_0x21884b(0x187),'admin'];for(const _0xf4fafa of _0x1b3bd5){try{const _0xcbea44=doc(db,_0xf4fafa,_0x1c853b['uid']),_0x56d664=await getDoc(_0xcbea44);if(_0x56d664[_0x21884b(0x188)]()){const _0x145b7c=_0x56d664['data']();console[_0x21884b(0x19d)]('Found\x20user\x20in\x20'+_0xf4fafa+'\x20by\x20UID:',_0x145b7c);let _0x1f3794=(_0x145b7c['roleName']||_0x145b7c['role']||'')['toLowerCase'](),_0x332f2b=_0x145b7c[_0x21884b(0x19c)]||_0x145b7c['role']||'';if(_0x1f3794&&_0x5b8cc7['includes'](_0x1f3794)){console['log']('Found\x20admin\x20role:\x20'+_0x1f3794+'\x20in\x20'+_0xf4fafa);const _0x10759e=_0x332f2b['split']('\x20')['map'](_0x2b052e=>_0x2b052e['charAt'](0x0)['toUpperCase']()+_0x2b052e['slice'](0x1)['toLowerCase']())[_0x21884b(0x194)]('\x20');return{'isAdmin':!![],'role':_0x10759e};}}}catch(_0x4c05f5){console['error']('Error\x20checking\x20'+_0xf4fafa+_0x21884b(0x193),_0x4c05f5);}}for(const _0x5d4bbf of _0x1b3bd5){try{const _0x4e8d86=collection(db,_0x5d4bbf);let _0x2131f5=query(_0x4e8d86,where(_0x21884b(0x1ac),'==',_0x1c853b['email'])),_0x272212=await getDocs(_0x2131f5);_0x272212['empty']&&(_0x2131f5=query(_0x4e8d86,where('email','==',_0x1c853b['email'][_0x21884b(0x1b4)]())),_0x272212=await getDocs(_0x2131f5));if(!_0x272212['empty']){const _0x1d2294=_0x272212['docs'][0x0]['data']();console['log']('Found\x20user\x20in\x20'+_0x5d4bbf+_0x21884b(0x191),_0x1d2294);let _0x61721c=(_0x1d2294[_0x21884b(0x19c)]||_0x1d2294['role']||'')['toLowerCase'](),_0x5c257c=_0x1d2294['roleName']||_0x1d2294[_0x21884b(0x1b2)]||'';if(_0x61721c&&_0x5b8cc7[_0x21884b(0x1a1)](_0x61721c)){console[_0x21884b(0x19d)]('Found\x20admin\x20role:\x20'+_0x61721c+'\x20in\x20'+_0x5d4bbf);const _0x269e7a=_0x5c257c['split']('\x20')[_0x21884b(0x18b)](_0x23ea5a=>_0x23ea5a['charAt'](0x0)['toUpperCase']()+_0x23ea5a['slice'](0x1)['toLowerCase']())['join']('\x20');return{'isAdmin':!![],'role':_0x269e7a};}}}catch(_0x1e4030){console['error']('Error\x20checking\x20'+_0x5d4bbf+_0x21884b(0x191),_0x1e4030);}}return console['log']('No\x20admin\x20roles\x20found\x20for\x20user'),{'isAdmin':![],'role':null};}catch(_0x2f2ee2){return console['error']('Error\x20in\x20checkAdminRoles:',_0x2f2ee2),{'isAdmin':![],'role':null};}}async function updateAuthSection(_0x20ae23){const _0x9eefc3=a0_0x17ccb4,_0x423d36=_0x20ae23&&isAdmin(_0x20ae23['email']);updateAuthSectionImmediate(_0x20ae23,_0x423d36);if(!_0x20ae23){userCache['uid']=null,userCache['username']=null,userCache['isAdmin']=![],userCache['hasCheckedCollections']=![],userCache['role']=null;return;}const _0x4ec77f=Date['now']();if(_0x20ae23['uid']===userCache['uid']&&userCache[_0x9eefc3(0x1a8)]&&_0x4ec77f-userCache[_0x9eefc3(0x180)]<0x493e0)return;try{userCache[_0x9eefc3(0x182)]=_0x20ae23['uid'],userCache[_0x9eefc3(0x180)]=_0x4ec77f;const _0x17e8f8=isAdmin(_0x20ae23['email']);userCache[_0x9eefc3(0x18e)]=_0x17e8f8;if(!_0x17e8f8){const {isAdmin:_0x3db38a,role:_0x28a2e0}=await checkAdminRoles(_0x20ae23);userCache[_0x9eefc3(0x18e)]=_0x3db38a,userCache['role']=_0x28a2e0,_0x3db38a&&(document['querySelectorAll'](_0x9eefc3(0x1b8))[_0x9eefc3(0x190)](_0xe568bd=>{_0xe568bd['style']['display']='block';}),updateAuthSectionImmediate(_0x20ae23,!![]));}const _0x31285f=['players','playersD2','playersD3','playersDuos',_0x9eefc3(0x1a6),_0x9eefc3(0x1af),_0x9eefc3(0x18c)],_0x2afd77=_0x31285f['map'](_0x39366a=>getDoc(doc(db,_0x39366a,_0x20ae23['uid']))[_0x9eefc3(0x1b5)](_0x5d3417=>_0x5d3417['exists']()?{'collection':_0x39366a,'data':_0x5d3417['data']()}:null)['catch'](()=>null)),_0x3447c8=await Promise['all'](_0x2afd77),_0xf1f227=_0x3447c8[_0x9eefc3(0x1aa)](_0x30b8a3=>_0x30b8a3!==null);let _0x5479f1=null;for(const _0x139c12 of _0xf1f227){if(_0x139c12['data']['username']){_0x5479f1=_0x139c12['data']['username'];break;}}userCache['username']=_0x5479f1||(_0x20ae23['email']?_0x20ae23['email']['split']('@')[0x0]:'User'),userCache[_0x9eefc3(0x1a8)]=!![],updateAuthSectionImmediate(_0x20ae23,userCache['isAdmin']),setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0x20ae23['uid']);},0x1f4);}catch(_0x106118){console['error']('Error\x20in\x20full\x20auth\x20update:',_0x106118);}}document['addEventListener']('DOMContentLoaded',()=>{const _0xb2e9e5=a0_0x17ccb4,_0x5c80cd=getAuth();onAuthStateChanged(_0x5c80cd,async _0x2631b5=>{await updateAuthSection(_0x2631b5),_0x2631b5&&checkPendingInvitationsForCurrentUser(_0x2631b5['uid']);}),document[_0xb2e9e5(0x18f)]('visibilitychange',()=>{const _0x2980fe=_0xb2e9e5;!document['hidden']&&_0x5c80cd['currentUser']&&checkPendingInvitationsForCurrentUser(_0x5c80cd[_0x2980fe(0x1a9)]['uid']);}),document['addEventListener'](_0xb2e9e5(0x1b9),_0xe29179=>{const _0x4634e6=_0xb2e9e5;_0xe29179[_0x4634e6(0x1ba)][_0x4634e6(0x19a)]('a[href]')&&_0x5c80cd['currentUser']&&checkPendingInvitationsForCurrentUser(_0x5c80cd['currentUser']['uid']);});});export{updateAuthSection};
function a15_0x456d(){const _0x320eeb=['error','apply','toString','log','docs','opponent','length','Bronze','desc','Silver','{}.constructor(\x22return\x20this\x22)(\x20)','console','username','exists','previousElo','bind','winnerUsername','data','info','eloHistoryD3'];a15_0x456d=function(){return _0x320eeb;};return a15_0x456d();}const a15_0x5b1879=a15_0x5a7e,a15_0x147c02=(function(){let _0x399ec8=!![];return function(_0x53b738,_0x2e7005){const _0xfd017b=_0x399ec8?function(){const _0x3ba63e=a15_0x5a7e;if(_0x2e7005){const _0x1d503b=_0x2e7005[_0x3ba63e(0x139)](_0x53b738,arguments);return _0x2e7005=null,_0x1d503b;}}:function(){};return _0x399ec8=![],_0xfd017b;};}()),a15_0x2095e6=a15_0x147c02(this,function(){const _0x37b2d=a15_0x5a7e;let _0x346c55;try{const _0x4a9963=Function('return\x20(function()\x20'+_0x37b2d(0x142)+');');_0x346c55=_0x4a9963();}catch(_0x3a22e7){_0x346c55=window;}const _0x4e4321=_0x346c55[_0x37b2d(0x143)]=_0x346c55['console']||{},_0x563acb=[_0x37b2d(0x13b),'warn',_0x37b2d(0x14a),_0x37b2d(0x138),'exception','table','trace'];for(let _0xc22c0c=0x0;_0xc22c0c<_0x563acb[_0x37b2d(0x13e)];_0xc22c0c++){const _0x13ab16=a15_0x147c02['constructor']['prototype']['bind'](a15_0x147c02),_0x54ab14=_0x563acb[_0xc22c0c],_0x5f48cf=_0x4e4321[_0x54ab14]||_0x13ab16;_0x13ab16['__proto__']=a15_0x147c02['bind'](a15_0x147c02),_0x13ab16['toString']=_0x5f48cf[_0x37b2d(0x13a)][_0x37b2d(0x147)](_0x5f48cf),_0x4e4321[_0x54ab14]=_0x13ab16;}});function a15_0x5a7e(_0x1d2fa6,_0x3c2e6a){const _0x2095e6=a15_0x456d();return a15_0x5a7e=function(_0x147c02,_0x1e056e){_0x147c02=_0x147c02-0x138;let _0x456d9e=_0x2095e6[_0x147c02];return _0x456d9e;},a15_0x5a7e(_0x1d2fa6,_0x3c2e6a);}a15_0x2095e6();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc,where}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D3=[{'name':'Emerald','elo':0x7d0},{'name':'Gold','elo':0x708},{'name':a15_0x5b1879(0x141),'elo':0x640},{'name':a15_0x5b1879(0x13f),'elo':0x578},{'name':'Unranked','elo':0x4b0}];let lastVisibleD3=null;async function getUsernameByIdD3(_0x355ecf){const _0x226832=a15_0x5b1879;try{if(!_0x355ecf)return'Unknown\x20Player';const _0xc8382a=await getDoc(doc(db,'playersD3',_0x355ecf));if(_0xc8382a[_0x226832(0x145)]())return _0xc8382a['data']()[_0x226832(0x144)]||'Unknown\x20Player';const _0x3bb8bc=await getDocs(query(collection(db,'approvedMatchesD3'),where('winnerId','==',_0x355ecf),limit(0x1)));if(!_0x3bb8bc['empty'])return _0x3bb8bc['docs'][0x0][_0x226832(0x149)]()[_0x226832(0x148)]||'Unknown\x20Player';const _0x4465e9=await getDocs(query(collection(db,'approvedMatchesD3'),where('loserId','==',_0x355ecf),limit(0x1)));if(!_0x4465e9['empty'])return _0x4465e9['docs'][0x0]['data']()['loserUsername']||'Unknown\x20Player';return'Unknown\x20Player';}catch(_0x1b3916){return console['error']('Error\x20getting\x20D3\x20username:',_0x1b3916),'Unknown\x20Player';}}export async function recordEloChangeD3({playerId:_0x463b10,previousElo:_0x5a8ab6,newElo:_0x5f0234,opponentId:_0x130961,matchResult:_0xaeabd1,previousPosition:_0x283db7,newPosition:_0x3e3bca,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x16c791,timestamp:_0x1ff60d}){const _0x28bdb7=a15_0x5b1879;try{const _0x2e5c39=doc(collection(db,_0x28bdb7(0x14b)));let _0x2ea35f='match';if(isPromotion)_0x2ea35f='promotion';if(isDemotion)_0x2ea35f='demotion';let _0x52e77c='Unranked';if(_0x5f0234>=0x7d0)_0x52e77c='Emerald';else{if(_0x5f0234>=0x708)_0x52e77c='Gold';else{if(_0x5f0234>=0x640)_0x52e77c='Silver';else{if(_0x5f0234>=0x578)_0x52e77c=_0x28bdb7(0x13f);}}}return await setDoc(_0x2e5c39,{'type':_0x2ea35f,'player':_0x463b10,'opponent':_0x130961,'previousElo':_0x5a8ab6,'newElo':_0x5f0234,'change':_0x5f0234-_0x5a8ab6,'matchResult':_0xaeabd1,'previousPosition':_0x283db7,'newPosition':_0x3e3bca,'rankAchieved':_0x52e77c,'matchId':_0x16c791,'timestamp':_0x1ff60d||serverTimestamp(),'gameMode':'D3'}),console[_0x28bdb7(0x13b)]('D3\x20ELO\x20history\x20recorded\x20for\x20'+_0x463b10),!![];}catch(_0x531871){console[_0x28bdb7(0x138)]('Error\x20recording\x20D3\x20ELO\x20history:',_0x531871);throw _0x531871;}}export async function getEloHistoryD3(_0x490cbf=0x14){const _0x3c5cf7=a15_0x5b1879;try{const _0x33e1b7=collection(db,_0x3c5cf7(0x14b));let _0xacabfd;lastVisibleD3?_0xacabfd=query(_0x33e1b7,orderBy('timestamp','desc'),startAfter(lastVisibleD3),limit(_0x490cbf)):_0xacabfd=query(_0x33e1b7,orderBy('timestamp',_0x3c5cf7(0x140)),limit(_0x490cbf));const _0x4e959a=await getDocs(_0xacabfd);if(_0x4e959a['empty'])return{'entries':[],'hasMore':![]};lastVisibleD3=_0x4e959a['docs'][_0x4e959a[_0x3c5cf7(0x13c)]['length']-0x1];const _0x406b74=_0x4e959a['docs']['map'](async _0x26a4bf=>{const _0x4721aa=_0x3c5cf7,_0x688c0b=_0x26a4bf['data'](),[_0x5d0911,_0x46d986]=await Promise['all']([getUsernameByIdD3(_0x688c0b['player']),getUsernameByIdD3(_0x688c0b[_0x4721aa(0x13d)])]);return{..._0x688c0b,'playerUsername':_0x5d0911,'opponentUsername':_0x46d986,'change':_0x688c0b['newElo']-_0x688c0b[_0x4721aa(0x146)],'timestamp':_0x688c0b['timestamp']};}),_0x166d4a=await Promise['all'](_0x406b74);return{'entries':_0x166d4a,'hasMore':_0x4e959a['size']===_0x490cbf};}catch(_0x383783){console[_0x3c5cf7(0x138)]('Error\x20fetching\x20D3\x20ELO\x20history:',_0x383783);throw _0x383783;}}export function resetPaginationD3(){lastVisibleD3=null;}
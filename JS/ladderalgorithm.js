(function(_0x38faa4,_0x286bf9){const _0x31e0d1=a30_0x50ca,_0xe26bde=_0x38faa4();while(!![]){try{const _0x52a06a=-parseInt(_0x31e0d1(0x188))/0x1+-parseInt(_0x31e0d1(0x1a0))/0x2+parseInt(_0x31e0d1(0x187))/0x3*(-parseInt(_0x31e0d1(0x199))/0x4)+-parseInt(_0x31e0d1(0x176))/0x5*(-parseInt(_0x31e0d1(0x19a))/0x6)+parseInt(_0x31e0d1(0x165))/0x7+parseInt(_0x31e0d1(0x18f))/0x8+parseInt(_0x31e0d1(0x16b))/0x9*(-parseInt(_0x31e0d1(0x193))/0xa);if(_0x52a06a===_0x286bf9)break;else _0xe26bde['push'](_0xe26bde['shift']());}catch(_0x37bf9e){_0xe26bde['push'](_0xe26bde['shift']());}}}(a30_0x480e,0x34055));const a30_0x28d011=(function(){let _0x34f5ba=!![];return function(_0x4903ab,_0x278b06){const _0x32f46f=_0x34f5ba?function(){const _0x4ebba2=a30_0x50ca;if(_0x278b06){const _0x51c0ea=_0x278b06[_0x4ebba2(0x16c)](_0x4903ab,arguments);return _0x278b06=null,_0x51c0ea;}}:function(){};return _0x34f5ba=![],_0x32f46f;};}()),a30_0x39f614=a30_0x28d011(this,function(){const _0x526c01=a30_0x50ca;return a30_0x39f614[_0x526c01(0x166)]()[_0x526c01(0x161)](_0x526c01(0x170))[_0x526c01(0x166)]()[_0x526c01(0x17f)](a30_0x39f614)[_0x526c01(0x161)](_0x526c01(0x170));});a30_0x39f614();const a30_0x4ff02d=(function(){let _0x578877=!![];return function(_0x5e56bc,_0x249220){const _0xaad85d=_0x578877?function(){const _0xd996eb=a30_0x50ca;if(_0x249220){const _0x16ca85=_0x249220[_0xd996eb(0x16c)](_0x5e56bc,arguments);return _0x249220=null,_0x16ca85;}}:function(){};return _0x578877=![],_0xaad85d;};}()),a30_0x4d807d=a30_0x4ff02d(this,function(){const _0x57811a=a30_0x50ca;let _0x295db4;try{const _0x418dcd=Function(_0x57811a(0x15f)+_0x57811a(0x179)+');');_0x295db4=_0x418dcd();}catch(_0x33a151){_0x295db4=window;}const _0x50d2f5=_0x295db4[_0x57811a(0x163)]=_0x295db4[_0x57811a(0x163)]||{},_0x1c0597=['log',_0x57811a(0x195),_0x57811a(0x18e),_0x57811a(0x168),'exception',_0x57811a(0x16a),_0x57811a(0x180)];for(let _0x37fb47=0x0;_0x37fb47<_0x1c0597[_0x57811a(0x17a)];_0x37fb47++){const _0x22370a=a30_0x4ff02d[_0x57811a(0x17f)][_0x57811a(0x169)][_0x57811a(0x19b)](a30_0x4ff02d),_0x3556bd=_0x1c0597[_0x37fb47],_0x4312fd=_0x50d2f5[_0x3556bd]||_0x22370a;_0x22370a['__proto__']=a30_0x4ff02d[_0x57811a(0x19b)](a30_0x4ff02d),_0x22370a[_0x57811a(0x166)]=_0x4312fd[_0x57811a(0x166)][_0x57811a(0x19b)](_0x4312fd),_0x50d2f5[_0x3556bd]=_0x22370a;}});function a30_0x50ca(_0x6f0ff6,_0x314c03){const _0xc77f60=a30_0x480e();return a30_0x50ca=function(_0x4d807d,_0x4ff02d){_0x4d807d=_0x4d807d-0x15f;let _0x194fad=_0xc77f60[_0x4d807d];return _0x194fad;},a30_0x50ca(_0x6f0ff6,_0x314c03);}a30_0x4d807d();import{collection,doc,getDoc,getDocs,updateDoc,setDoc,deleteDoc,writeBatch,query,where,serverTimestamp,addDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';function a30_0x480e(){const _0x57f4e7=['wins','return\x20(function()\x20','eloRating','search','round','console','winnerScore','2696015Zibjof','toString','commit','error','prototype','table','230913kvUNtb','apply','update','pow','then','(((.+)+)+)+$','MAX_SAFE_INTEGER','Match\x20moved\x20to\x20approved\x20collection','data','position','exists','15PPezoH','docs','collection','{}.constructor(\x22return\x20this\x22)(\x20)','length','loserScore','Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked','username','Could\x20not\x20find\x20player\x20documents','constructor','trace','uid','Report\x20not\x20found','win','approvedMatches','empty','all','2847mFiLHm','211918lATKQr','match','totalDeaths','losses','lastUpdated','players','info','1595912ZpwwTs','winRate','log','ELO\x20ratings\x20and\x20positions\x20updated\x20successfully','30NbFOki','currentUser','warn','Error\x20assigning\x20default\x20ELO\x20rating:','checkAndRecordPromotion','pendingMatches','1544AvsdHy','770046ytretL','bind','playerStats','One\x20or\x20both\x20players\x20not\x20found','loserUsername','loss','202754SkzUBN','totalKills','toISOString'];a30_0x480e=function(){return _0x57f4e7;};return a30_0x480e();}import{recordEloChange}from'./elo-history.js';import{promotionManager,checkAndRecordPromotion}from'./promotions.js';import{isAdmin}from'./admin-check.js';export function calculateElo(_0x485bbf,_0xbe1426,_0xd3db1a=0x20){const _0x883608=a30_0x50ca,_0x58a3f8=0x1/(0x1+Math[_0x883608(0x16e)](0xa,(_0xbe1426-_0x485bbf)/0x190)),_0x24772c=0x1/(0x1+Math['pow'](0xa,(_0x485bbf-_0xbe1426)/0x190)),_0x56d200=_0x485bbf+_0xd3db1a*(0x1-_0x58a3f8),_0x286ba3=_0xbe1426+_0xd3db1a*(0x0-_0x24772c);return{'newWinnerRating':Math['round'](_0x56d200),'newLoserRating':Math[_0x883608(0x162)](_0x286ba3)};}export function assignDefaultEloRating(_0x3bb6f9,_0x21d2ea){const _0x5d5ce3=a30_0x50ca,_0x5906f2=0x4b0;!_0x21d2ea[_0x5d5ce3(0x160)]&&db[_0x5d5ce3(0x178)]('players')['doc'](_0x3bb6f9)[_0x5d5ce3(0x16d)]({'eloRating':_0x5906f2})[_0x5d5ce3(0x16f)](()=>{const _0x48fed2=_0x5d5ce3;console[_0x48fed2(0x191)]('Assigned\x20default\x20ELO\x20rating\x20to\x20player\x20'+_0x21d2ea[_0x48fed2(0x17d)]);})['catch'](_0x54a243=>{const _0x351fb5=_0x5d5ce3;console['error'](_0x351fb5(0x196),_0x54a243);});}export async function updateEloRatings(_0x52d7ef,_0x55cf2b,_0x8bb9c7){const _0x557533=a30_0x50ca;try{const _0x4ee27f=writeBatch(db),_0x45083e=doc(db,_0x557533(0x18d),_0x52d7ef),_0x7b5d76=doc(db,'players',_0x55cf2b),[_0x1af43d,_0x32a321]=await Promise['all']([getDoc(_0x45083e),getDoc(_0x7b5d76)]);if(!_0x1af43d[_0x557533(0x175)]()||!_0x32a321[_0x557533(0x175)]())throw new Error(_0x557533(0x19d));const _0x58e1e2=_0x1af43d[_0x557533(0x173)](),_0xf6a0dc=_0x32a321[_0x557533(0x173)](),_0x476222=_0x58e1e2['position']||Number[_0x557533(0x171)],_0x50fe5e=_0xf6a0dc[_0x557533(0x174)]||Number[_0x557533(0x171)],{newWinnerRating:_0x498954,newLoserRating:_0x44b64a}=calculateElo(_0x58e1e2[_0x557533(0x160)]||0x4b0,_0xf6a0dc[_0x557533(0x160)]||0x4b0);let _0x479625=_0x476222,_0x2b8a9e=_0x50fe5e;if(_0x476222>_0x50fe5e){console[_0x557533(0x191)](_0x557533(0x17c)),_0x479625=_0x50fe5e,_0x2b8a9e=_0x50fe5e+0x1;const _0x30ddf4=query(collection(db,'players'),where(_0x557533(0x174),'>',_0x50fe5e),where(_0x557533(0x174),'<',_0x476222)),_0x1d9adc=await getDocs(_0x30ddf4);for(const _0xac694d of _0x1d9adc[_0x557533(0x177)]){_0xac694d['id']!==_0x52d7ef&&_0xac694d['id']!==_0x55cf2b&&_0x4ee27f[_0x557533(0x16d)](doc(db,_0x557533(0x18d),_0xac694d['id']),{'position':_0xac694d[_0x557533(0x173)]()[_0x557533(0x174)]+0x1});}}else console['log']('Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions');const _0x336835={'eloRating':_0x498954,'lastMatchDate':serverTimestamp(),'position':_0x479625,'lastMatchId':_0x8bb9c7},_0x221522={'eloRating':_0x44b64a,'lastMatchDate':serverTimestamp(),'position':_0x2b8a9e,'lastMatchId':_0x8bb9c7};return _0x4ee27f['update'](_0x45083e,_0x336835),_0x4ee27f['update'](_0x7b5d76,_0x221522),await _0x4ee27f[_0x557533(0x167)](),console['log']('ELO\x20ratings\x20updated\x20successfully'),await Promise[_0x557533(0x186)]([recordEloChange({'playerId':_0x52d7ef,'previousElo':_0x58e1e2['eloRating']||0x4b0,'newElo':_0x498954,'opponentId':_0x55cf2b,'matchResult':_0x557533(0x183),'previousPosition':_0x476222,'newPosition':_0x479625,'isPromotion':_0x479625<_0x476222,'matchId':_0x8bb9c7,'timestamp':serverTimestamp()}),recordEloChange({'playerId':_0x55cf2b,'previousElo':_0xf6a0dc[_0x557533(0x160)]||0x4b0,'newElo':_0x44b64a,'opponentId':_0x52d7ef,'matchResult':_0x557533(0x19f),'previousPosition':_0x50fe5e,'newPosition':_0x2b8a9e,'isDemotion':_0x2b8a9e>_0x50fe5e,'matchId':_0x8bb9c7,'timestamp':serverTimestamp()})]),await promotionManager[_0x557533(0x197)](_0x52d7ef,_0x498954,_0x58e1e2[_0x557533(0x160)],{'source':'match','matchId':_0x8bb9c7}),await promotionManager['checkAndRecordPromotion'](_0x55cf2b,_0x44b64a,_0xf6a0dc[_0x557533(0x160)],{'source':_0x557533(0x189),'matchId':_0x8bb9c7}),console[_0x557533(0x191)](_0x557533(0x192)),!![];}catch(_0x50d3a5){console[_0x557533(0x168)]('Error\x20in\x20updateEloRatings:',_0x50d3a5);throw _0x50d3a5;}}export async function approveReport(_0x588a5e,_0x2b966b,_0x5a925d,_0x39be03,_0x1f8f91){const _0x27e972=a30_0x50ca;try{const _0x26cd8c=doc(db,_0x27e972(0x198),_0x588a5e),_0x139095=await getDoc(_0x26cd8c);if(!_0x139095['exists']())throw new Error(_0x27e972(0x182));const _0x509fa9=_0x139095[_0x27e972(0x173)](),_0x4db4b0={..._0x509fa9,'winnerScore':_0x2b966b,'winnerSuicides':_0x5a925d,'winnerComment':_0x39be03,'winnerDemoLink':_0x1f8f91,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':auth[_0x27e972(0x194)][_0x27e972(0x181)]};await setDoc(doc(db,_0x27e972(0x184),_0x588a5e),_0x4db4b0),await deleteDoc(_0x26cd8c),console[_0x27e972(0x191)](_0x27e972(0x172));const [_0x4c5363,_0xd9457d]=await Promise[_0x27e972(0x186)]([getDocs(query(collection(db,_0x27e972(0x18d)),where(_0x27e972(0x17d),'==',_0x509fa9['winnerUsername']))),getDocs(query(collection(db,_0x27e972(0x18d)),where(_0x27e972(0x17d),'==',_0x509fa9[_0x27e972(0x19e)])))]);if(_0x4c5363[_0x27e972(0x185)]||_0xd9457d['empty'])throw new Error(_0x27e972(0x17e));const _0x31ac04=_0x4c5363['docs'][0x0]['id'],_0x4c180d=_0xd9457d[_0x27e972(0x177)][0x0]['id'];return await updateEloRatings(_0x31ac04,_0x4c180d,_0x588a5e),console[_0x27e972(0x191)]('Match\x20successfully\x20approved\x20and\x20ELO\x20updated'),!![];}catch(_0x4ef136){console[_0x27e972(0x168)]('Error\x20approving\x20report:',_0x4ef136);throw _0x4ef136;}}async function updatePlayerElo(_0x33ab4b,_0x3d1f6f,_0x273032){const _0x1c25f4=a30_0x50ca;await setDoc(doc(db,_0x1c25f4(0x18d),_0x33ab4b),{...playerData,'eloRating':_0x273032}),await checkAndRecordPromotion(_0x33ab4b,_0x273032,_0x3d1f6f);}async function updatePlayerStats(_0x15dda5,_0x58fe50,_0xa9ec5b){const _0x5698c9=a30_0x50ca,_0x53d8d0=doc(db,_0x5698c9(0x19c),_0x15dda5),_0x428e15=await getDoc(_0x53d8d0);let _0x1f4d27=_0x428e15[_0x5698c9(0x175)]()?_0x428e15[_0x5698c9(0x173)]():{'wins':0x0,'losses':0x0,'totalKills':0x0,'totalDeaths':0x0,'winRate':0x0};_0xa9ec5b?(_0x1f4d27[_0x5698c9(0x1a3)]++,_0x1f4d27[_0x5698c9(0x1a1)]+=parseInt(_0x58fe50[_0x5698c9(0x164)]||0x0),_0x1f4d27[_0x5698c9(0x18a)]+=parseInt(_0x58fe50[_0x5698c9(0x17b)]||0x0)):(_0x1f4d27['losses']++,_0x1f4d27['totalKills']+=parseInt(_0x58fe50['loserScore']||0x0),_0x1f4d27[_0x5698c9(0x18a)]+=parseInt(_0x58fe50[_0x5698c9(0x164)]||0x0));const _0x276958=_0x1f4d27[_0x5698c9(0x1a3)]+_0x1f4d27[_0x5698c9(0x18b)];_0x1f4d27[_0x5698c9(0x190)]=_0x276958>0x0?(_0x1f4d27['wins']/_0x276958*0x64)['toFixed'](0x1):0x0,_0x1f4d27[_0x5698c9(0x18c)]=new Date()[_0x5698c9(0x1a2)](),await setDoc(_0x53d8d0,_0x1f4d27,{'merge':!![]});}
const a39_0x3d68d2=a39_0x53c2,a39_0x2dfd9c=(function(){let _0x3e66f5=!![];return function(_0x4f99c7,_0x345492){const _0x8a60fc=_0x3e66f5?function(){const _0x3a4401=a39_0x53c2;if(_0x345492){const _0x455f8a=_0x345492[_0x3a4401(0xdd)](_0x4f99c7,arguments);return _0x345492=null,_0x455f8a;}}:function(){};return _0x3e66f5=![],_0x8a60fc;};}()),a39_0x44bd7f=a39_0x2dfd9c(this,function(){const _0x3a7a0c=a39_0x53c2;let _0x1b3e42;try{const _0x151b72=Function('return\x20(function()\x20'+_0x3a7a0c(0xe6)+');');_0x1b3e42=_0x151b72();}catch(_0xb7c425){_0x1b3e42=window;}const _0x547080=_0x1b3e42['console']=_0x1b3e42[_0x3a7a0c(0xec)]||{},_0x4899d8=['log','warn','info','error','exception','table','trace'];for(let _0x40d763=0x0;_0x40d763<_0x4899d8[_0x3a7a0c(0xe9)];_0x40d763++){const _0x2b1f04=a39_0x2dfd9c[_0x3a7a0c(0xdf)]['prototype']['bind'](a39_0x2dfd9c),_0x1b9c8a=_0x4899d8[_0x40d763],_0x2c656a=_0x547080[_0x1b9c8a]||_0x2b1f04;_0x2b1f04[_0x3a7a0c(0xe5)]=a39_0x2dfd9c['bind'](a39_0x2dfd9c),_0x2b1f04[_0x3a7a0c(0xeb)]=_0x2c656a['toString'][_0x3a7a0c(0xe7)](_0x2c656a),_0x547080[_0x1b9c8a]=_0x2b1f04;}});a39_0x44bd7f();import{db}from'./firebase-config.js';import{doc,getDoc,updateDoc,addDoc,collection,serverTimestamp}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const POINTS_CHART={'':0xa,'Standard':0xa,'Fusion\x20Match':0x19,'â‰¥6\x20Missiles':0xa,'Weapon\x20Imbalance':0x1e,'Blind\x20Match':0x4b,'Rematch':0x14,'Disorientation':0x32,'Ratting':0x23,'Altered\x20Powerups':0x23,'Mega\x20Match':0x28,'Dogfight':0x32,'Gauss\x20and\x20Mercs':0x19,'Misc':0x1e};function a39_0x18d2(){const _0x37cd97=['Admin\x20backend\x20not\x20available,\x20using\x20fallback\x20points\x20service','\x20match','apply','all','constructor','unknown','log','add','modifyUserPoints','Match\x20points:\x20','__proto__','{}.constructor(\x22return\x20this\x22)(\x20)','bind','Added\x20','length','Admin\x20points\x20service\x20connected','toString','console','Standard'];a39_0x18d2=function(){return _0x37cd97;};return a39_0x18d2();}let adminModifyUserPoints=null;function a39_0x53c2(_0xd360e6,_0xaef87f){const _0x44bd7f=a39_0x18d2();return a39_0x53c2=function(_0x2dfd9c,_0x16fa92){_0x2dfd9c=_0x2dfd9c-0xdb;let _0x18d2dd=_0x44bd7f[_0x2dfd9c];return _0x18d2dd;},a39_0x53c2(_0xd360e6,_0xaef87f);}try{const adminModule=await import('./adminbackend.js');adminModule['modifyUserPoints']&&(adminModifyUserPoints=adminModule[a39_0x3d68d2(0xe3)],console[a39_0x3d68d2(0xe1)](a39_0x3d68d2(0xea)));}catch(a39_0xb29aaa){console[a39_0x3d68d2(0xe1)](a39_0x3d68d2(0xdb));}export async function awardMatchPoints(_0x4f7a35,_0x5ba335,_0x453fe9){const _0x4db262=a39_0x3d68d2;try{const _0x4e1806=POINTS_CHART[_0x453fe9]||0xa;return adminModifyUserPoints?await Promise['all']([adminModifyUserPoints(_0x4f7a35,_0x4db262(0xe2),_0x4e1806,_0x4db262(0xe4)+(_0x453fe9||_0x4db262(0xed))+'\x20match\x20(Winner)'),adminModifyUserPoints(_0x5ba335,_0x4db262(0xe2),_0x4e1806,'Match\x20points:\x20'+(_0x453fe9||_0x4db262(0xed))+'\x20match\x20(Participant)')]):await Promise[_0x4db262(0xde)]([addPointsFallback(_0x4f7a35,_0x4e1806,'Match\x20points:\x20'+(_0x453fe9||_0x4db262(0xed))+'\x20match\x20(Winner)'),addPointsFallback(_0x5ba335,_0x4e1806,'Match\x20points:\x20'+(_0x453fe9||'Standard')+'\x20match\x20(Participant)')]),console['log']('Awarded\x20'+_0x4e1806+'\x20points\x20to\x20both\x20players\x20for\x20'+(_0x453fe9||_0x4db262(0xed))+_0x4db262(0xdc)),!![];}catch(_0x284d91){return console['error']('Error\x20awarding\x20match\x20points:',_0x284d91),![];}}async function addPointsFallback(_0x38e84e,_0x328b9b,_0x13abb1=''){const _0x487f4b=a39_0x3d68d2;try{const _0x21a987=doc(db,'userProfiles',_0x38e84e),_0x8b37ad=await getDoc(_0x21a987);if(!_0x8b37ad['exists']()){console['log']('User\x20profile\x20not\x20found\x20for\x20'+_0x38e84e+',\x20skipping\x20points\x20award');return;}const _0xe142cd=_0x8b37ad['data'](),_0x27c588=_0xe142cd['points']||0x0,_0x1ef96b=_0x27c588+_0x328b9b;await updateDoc(_0x21a987,{'points':_0x1ef96b,'lastPointsModified':serverTimestamp()}),await addDoc(collection(db,'pointsHistory'),{'userId':_0x38e84e,'userEmail':_0xe142cd['email']||_0x487f4b(0xe0),'displayName':_0xe142cd['displayName']||_0xe142cd['username']||'Unknown\x20User','action':'add','amount':_0x328b9b,'previousPoints':_0x27c588,'newPoints':_0x1ef96b,'reason':_0x13abb1,'adminEmail':'system-match-award','timestamp':serverTimestamp()}),console[_0x487f4b(0xe1)](_0x487f4b(0xe8)+_0x328b9b+'\x20points\x20to\x20user\x20'+_0x38e84e+'.\x20New\x20total:\x20'+_0x1ef96b);}catch(_0x420ae1){console['error']('Error\x20adding\x20points\x20to\x20user:',_0x420ae1);throw _0x420ae1;}}
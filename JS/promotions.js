const a43_0x998ea4=a43_0xe0af,a43_0x4e9899=(function(){let _0x36fd0a=!![];return function(_0x5c6020,_0x3e4eda){const _0x23da23=_0x36fd0a?function(){if(_0x3e4eda){const _0x2e2a8f=_0x3e4eda['apply'](_0x5c6020,arguments);return _0x3e4eda=null,_0x2e2a8f;}}:function(){};return _0x36fd0a=![],_0x23da23;};}()),a43_0x3e001e=a43_0x4e9899(this,function(){const _0x5347a5=a43_0xe0af;let _0x3e6622;try{const _0x3b810b=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x3e6622=_0x3b810b();}catch(_0x1cc4bd){_0x3e6622=window;}const _0x1033a8=_0x3e6622['console']=_0x3e6622[_0x5347a5(0x1f1)]||{},_0x43bcf2=[_0x5347a5(0x22a),'warn','info','error','exception','table','trace'];for(let _0x2d5971=0x0;_0x2d5971<_0x43bcf2[_0x5347a5(0x210)];_0x2d5971++){const _0x361ded=a43_0x4e9899['constructor']['prototype']['bind'](a43_0x4e9899),_0x2bd529=_0x43bcf2[_0x2d5971],_0x11baf4=_0x1033a8[_0x2bd529]||_0x361ded;_0x361ded['__proto__']=a43_0x4e9899['bind'](a43_0x4e9899),_0x361ded[_0x5347a5(0x1fc)]=_0x11baf4['toString'][_0x5347a5(0x206)](_0x11baf4),_0x1033a8[_0x2bd529]=_0x361ded;}});a43_0x3e001e();import{collection,doc,query,where,orderBy,limit,getDocs,addDoc,getDoc,serverTimestamp,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{auth,db}from'./firebase-config.js';class PromotionManager{constructor(){const _0x359576=a43_0xe0af;this[_0x359576(0x201)]=0x18,this['RANKS']=[{'threshold':0x578,'name':'Bronze','color':_0x359576(0x218)},{'threshold':0x640,'name':'Silver','color':'#C0C0C0'},{'threshold':0x708,'name':'Gold','color':'#FFD700'},{'threshold':0x834,'name':'Emerald','color':_0x359576(0x1e5)}],this['bannerContainer']=null,this[_0x359576(0x222)]=0x0,this[_0x359576(0x233)]=0xea60,this['pollingInterval']=null,this['usernameCache']={};}['initialize'](){const _0x406023=a43_0xe0af;this['bannerContainer']=document['getElementById']('promotion-banner-container');if(!this['bannerContainer']){console[_0x406023(0x208)]('Promotion\x20banner\x20container\x20not\x20found');return;}this['setupBannerContainer']();const _0x4591d6=_0x406023(0x226)+new Date()['toDateString'](),_0x261500=sessionStorage['getItem'](_0x4591d6);!_0x261500&&(this['fetchRecentPromotions'](),sessionStorage[_0x406023(0x21a)](_0x4591d6,_0x406023(0x237))),document[_0x406023(0x1e7)]('visibilitychange',()=>{const _0xd6424d=_0x406023;document['visibilityState']===_0xd6424d(0x200)&&!sessionStorage['getItem'](_0x4591d6)&&(this['fetchRecentPromotions'](),sessionStorage[_0xd6424d(0x21a)](_0x4591d6,_0xd6424d(0x237)));}),window['addEventListener']('beforeunload',()=>{this['pollingInterval']&&clearInterval(this['pollingInterval']);});}['setupBannerContainer'](){const _0xfc154=a43_0xe0af;this['bannerContainer']['innerHTML']='',this[_0xfc154(0x234)][_0xfc154(0x217)]['display']='none';}async['fetchRecentPromotions'](){const _0x2564a2=a43_0xe0af;try{const _0x355b20=Date[_0x2564a2(0x215)]();if(_0x355b20-this['lastFetchTime']<this['fetchInterval'])return;this['lastFetchTime']=_0x355b20;const _0x206900=collection(db,'eloHistory'),_0xa7d2de=query(_0x206900,where(_0x2564a2(0x21d),'in',['promotion','demotion']),orderBy('timestamp','desc'),limit(0x14)),_0x451d34=await getDocs(_0xa7d2de),_0x3db95d=[];_0x451d34[_0x2564a2(0x223)](_0x4f9051=>{const _0x460d14={'id':_0x4f9051['id'],..._0x4f9051['data']()};this['shouldShowPromotion'](_0x4f9051['id'])&&this['isNewRankChange'](_0x460d14)&&_0x3db95d['push'](_0x460d14);}),_0x3db95d['length']>0x0&&await this['processRankChanges'](_0x3db95d);}catch(_0x4fab27){console[_0x2564a2(0x208)](_0x2564a2(0x1f9),_0x4fab27);}}async['processRankChanges'](_0x50903d){const _0x4e17ac=a43_0xe0af;if(_0x50903d['length']===0x0)return;_0x50903d['sort']((_0x3b1351,_0x234939)=>{const _0x3ff656=_0x3b1351['timestamp']?.['toMillis']?.()||_0x3b1351['timestamp']?.['seconds']*0x3e8||0x0,_0x1ea15f=_0x234939['timestamp']?.['toMillis']?.()||_0x234939['timestamp']?.['seconds']*0x3e8||0x0;return _0x1ea15f-_0x3ff656;});const _0x3f653e=this['bannerContainer']['children']['length'],_0x47708d=0x3-_0x3f653e;if(_0x47708d<=0x0)return;const _0x4dec22=_0x50903d['slice'](0x0,_0x47708d);for(let _0x33a1c6=0x0;_0x33a1c6<_0x4dec22['length'];_0x33a1c6++){const _0x58a28d=_0x4dec22[_0x33a1c6],_0x16914f=auth['currentUser'];try{setTimeout(()=>{this['showRankChangeBanner'](_0x58a28d);},_0x33a1c6*0x3e8),_0x16914f&&_0x58a28d['player']===_0x16914f['displayName']&&this['showRankChangeLightbox'](_0x58a28d['type'],_0x58a28d[_0x4e17ac(0x20f)]);}catch(_0x551504){console['error']('Error\x20processing\x20rank\x20change:',_0x551504);}}}[a43_0x998ea4(0x1f3)](_0x4f74f3){const _0x5bc63c=a43_0x998ea4;try{const _0x7bee5c='promotion_'+_0x4f74f3,_0x4e9f54=localStorage['getItem'](_0x7bee5c);if(_0x4e9f54){let _0x4d60dc;try{_0x4d60dc=JSON['parse'](_0x4e9f54);}catch(_0x2cc733){return console[_0x5bc63c(0x227)]('Invalid\x20storage\x20format\x20for\x20'+_0x7bee5c+',\x20treating\x20as\x20new'),!![];}if(_0x4d60dc['ignored']===!![])return console['log']('Promotion\x20'+_0x4f74f3+'\x20is\x20permanently\x20ignored'),![];const _0x57a4f4=Date[_0x5bc63c(0x215)]();if(_0x4d60dc['userDismissed']&&_0x57a4f4-_0x4d60dc['timestamp']<this['DISPLAY_HOURS']*0x3c*0x3c*0x3e8)return console['log']('Promotion\x20'+_0x4f74f3+'\x20was\x20dismissed\x20by\x20user\x20within\x20last\x20'+this['DISPLAY_HOURS']+'\x20hours'),![];if(_0x4d60dc['systemDismissed']&&_0x57a4f4-_0x4d60dc[_0x5bc63c(0x20e)]<0x4*0x3c*0x3c*0x3e8)return console['log'](_0x5bc63c(0x1fa)+_0x4f74f3+'\x20was\x20auto-dismissed\x20within\x20last\x204\x20hours'),![];}return!![];}catch(_0x451679){return console['error'](_0x5bc63c(0x1f8),_0x451679),![];}}[a43_0x998ea4(0x1e6)](_0x1ac083){try{const _0x6e4836='promotion_'+_0x1ac083;localStorage['setItem'](_0x6e4836,JSON['stringify']({'timestamp':Date['now'](),'ignored':!![]}));}catch(_0x3656b1){console['error']('Error\x20saving\x20promotion\x20preference:',_0x3656b1);}}['showRankChangeBanner'](_0x9144d0){this['resolveUserId'](_0x9144d0)['then'](_0xd63512=>{const _0x1c3e6c=a43_0xe0af,_0x595495='promotion_'+_0x9144d0['id'],_0x52ed63=localStorage[_0x1c3e6c(0x1fe)](_0x595495);if(_0x52ed63)try{const _0x2c097a=JSON[_0x1c3e6c(0x1e8)](_0x52ed63);if(_0x2c097a['ignored']===!![]){console['log'](_0x1c3e6c(0x1e4)+_0x9144d0['id']);return;}}catch(_0x3dc633){}localStorage['setItem'](_0x595495,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':![],'seenAt':Date['now']()})),this['bannerContainer'][_0x1c3e6c(0x217)]['display']=_0x1c3e6c(0x1ef);while(this['bannerContainer']['children'][_0x1c3e6c(0x210)]>=0x3){this['bannerContainer']['removeChild'](this['bannerContainer']['firstChild']);}const _0x55d1fd=document['createElement']('div');_0x55d1fd['className']='promotion-banner',_0x55d1fd[_0x1c3e6c(0x1e2)]('data-rank',_0xd63512['rankAchieved']),_0x55d1fd['setAttribute']('data-id',_0xd63512['id']);const _0x1fdb49=document['createElement'](_0x1c3e6c(0x212));_0x1fdb49['className']=_0x1c3e6c(0x221);const _0x1044b0=_0xd63512['resolvedName']||_0xd63512['player']||_0xd63512[_0x1c3e6c(0x231)]||_0xd63512[_0x1c3e6c(0x214)]||_0xd63512['displayName']||'A\x20player',_0x594cda=_0xd63512['type']==='promotion'?_0x1044b0+'\x20was\x20promoted\x20to':_0x1044b0+_0x1c3e6c(0x22e);_0x1fdb49[_0x1c3e6c(0x202)]=_0x594cda+_0x1c3e6c(0x203)+_0xd63512[_0x1c3e6c(0x20f)]+'</span>';const _0x42d15e=document['createElement']('div');_0x42d15e['className']='banner-actions';const _0xdfad67=document['createElement']('button');_0xdfad67[_0x1c3e6c(0x211)]='dismiss-btn',_0xdfad67['innerHTML']='&times;',_0xdfad67[_0x1c3e6c(0x1ed)]='Dismiss';const _0x4a1d29=document[_0x1c3e6c(0x1f4)](_0x1c3e6c(0x239));_0x4a1d29[_0x1c3e6c(0x211)]='ignore-btn',_0x4a1d29['textContent']=_0x1c3e6c(0x213),_0x4a1d29[_0x1c3e6c(0x1ed)]='Never\x20show\x20this\x20promotion\x20again',_0x42d15e['appendChild'](_0x4a1d29),_0x42d15e['appendChild'](_0xdfad67),_0x55d1fd['appendChild'](_0x1fdb49),_0x55d1fd['appendChild'](_0x42d15e),this['bannerContainer']['appendChild'](_0x55d1fd),void _0x55d1fd['offsetWidth'],setTimeout(()=>{_0x55d1fd['classList']['add']('new-rank-change');},0x32),_0xdfad67['addEventListener'](_0x1c3e6c(0x209),()=>{const _0x1310b2=_0x1c3e6c;localStorage['setItem'](_0x595495,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':!![],'systemDismissed':![]})),_0x55d1fd['classList'][_0x1310b2(0x1e3)](_0x1310b2(0x20d)),_0x55d1fd['classList']['add']('dismissing'),setTimeout(()=>{const _0x59880e=_0x1310b2;_0x55d1fd['parentNode']&&(_0x55d1fd['remove'](),this[_0x59880e(0x234)]['children']['length']===0x0&&(this['bannerContainer']['style']['display']='none'));},0x1f4);}),_0x4a1d29['addEventListener']('click',()=>{const _0x3ebbf8=_0x1c3e6c;localStorage['setItem'](_0x595495,JSON['stringify']({'timestamp':Date['now'](),'ignored':!![],'userDismissed':!![],'systemDismissed':![]})),_0x55d1fd['classList']['remove']('new-rank-change'),_0x55d1fd[_0x3ebbf8(0x220)]['add']('dismissing'),setTimeout(()=>{const _0x1340bf=_0x3ebbf8;_0x55d1fd['parentNode']&&(_0x55d1fd[_0x1340bf(0x1e3)](),this[_0x1340bf(0x234)]['children']['length']===0x0&&(this[_0x1340bf(0x234)]['style']['display']='none'));},0x1f4);}),setTimeout(()=>{const _0x489adc=_0x1c3e6c;_0x55d1fd['parentNode']&&(_0x55d1fd['classList']['remove']('new-rank-change'),_0x55d1fd['classList'][_0x489adc(0x238)]('dismissing'),localStorage['setItem'](_0x595495,JSON['stringify']({'timestamp':Date[_0x489adc(0x215)](),'ignored':![],'userDismissed':![],'systemDismissed':!![]})),setTimeout(()=>{const _0x4854ae=_0x489adc;_0x55d1fd[_0x4854ae(0x1f0)]&&(_0x55d1fd['remove'](),this['bannerContainer'][_0x4854ae(0x20b)]['length']===0x0&&(this['bannerContainer']['style']['display']=_0x4854ae(0x219)));},0x1f4));},0x3a98);});}async[a43_0x998ea4(0x1ea)](_0x109dc0){const _0x46a337=a43_0x998ea4,_0x422e39={..._0x109dc0},_0x5168e9=[_0x109dc0['player'],_0x109dc0['username'],_0x109dc0['playerUsername'],_0x109dc0['displayName']],_0x421f3f=_0x5168e9[_0x46a337(0x22b)](_0x22c5b4=>_0x22c5b4&&typeof _0x22c5b4==='string'&&!_0x22c5b4['includes']('ID:')&&!/^[a-zA-Z0-9]{20,}$/[_0x46a337(0x1ec)](_0x22c5b4));if(_0x421f3f)return _0x422e39;let _0x5fc592=null;if(_0x109dc0['userId'])_0x5fc592=_0x109dc0['userId'];else _0x109dc0['player']&&/^[A-Za-z0-9]{20,}$/['test'](_0x109dc0['player'])&&(_0x5fc592=_0x109dc0['player']);if(!_0x5fc592)return _0x422e39;try{const _0x2a8bde=await getDoc(doc(db,'players',_0x5fc592));if(_0x2a8bde['exists']()){const _0x43ad19=_0x2a8bde[_0x46a337(0x21c)]();if(_0x43ad19['username'])return _0x422e39['resolvedName']=_0x43ad19[_0x46a337(0x231)],_0x422e39;}const _0x3deae4=await getDocs(query(collection(db,'approvedMatches'),where('winnerId','==',_0x5fc592),orderBy('date','desc'),limit(0x1)));if(!_0x3deae4['empty']){const _0x5f39ca=_0x3deae4[_0x46a337(0x224)][0x0]['data']();if(_0x5f39ca['winnerUsername'])return _0x422e39['resolvedName']=_0x5f39ca['winnerUsername'],_0x422e39;}const _0x102987=await getDocs(query(collection(db,'approvedMatches'),where('loserId','==',_0x5fc592),orderBy(_0x46a337(0x1e9),_0x46a337(0x232)),limit(0x1)));if(!_0x102987['empty']){const _0x1711ba=_0x102987[_0x46a337(0x224)][0x0]['data']();if(_0x1711ba['loserUsername'])return _0x422e39['resolvedName']=_0x1711ba['loserUsername'],console[_0x46a337(0x22a)](_0x46a337(0x236)+_0x5fc592+'\x20to\x20'+_0x1711ba['loserUsername']+'\x20(loser)'),_0x422e39;}}catch(_0x4749fc){console[_0x46a337(0x208)]('Error\x20resolving\x20user\x20ID:',_0x4749fc);}return console['warn']('Failed\x20to\x20resolve\x20user\x20ID:\x20'+_0x5fc592),_0x422e39;}['showRankChangeLightbox'](_0x425277,_0x50eddf){const _0x203b96=a43_0x998ea4;let _0x4a6ebf=document['getElementById']('rankChangeModal');!_0x4a6ebf&&(_0x4a6ebf=document[_0x203b96(0x1f4)]('div'),_0x4a6ebf['id']='rankChangeModal',_0x4a6ebf['className']='rank-change-modal\x20'+_0x425277,document['body']['appendChild'](_0x4a6ebf));const _0x2f0768=_0x425277==='promotion'?'Congratulations!':_0x203b96(0x216),_0x52745e=_0x425277===_0x203b96(0x1f6)?'You\x27ve\x20been\x20promoted\x20to':'You\x27ve\x20been\x20demoted\x20to';_0x4a6ebf['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rank-change-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2\x20class=\x22rank-change-title\x22>'+_0x2f0768+'</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>'+_0x52745e+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22rank-name\x22>'+_0x50eddf+'</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22rank-change-button\x22\x20id=\x22rank-change-ok-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Got\x20it!\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x4a6ebf['style']['display']='flex',document['getElementById']('rank-change-ok-btn')[_0x203b96(0x1e7)]('click',()=>{const _0x2acbe7=_0x203b96;_0x4a6ebf['style']['display']=_0x2acbe7(0x219);}),_0x4a6ebf['addEventListener']('click',_0x49ce80=>{const _0x4d79b0=_0x203b96;_0x49ce80['target']===_0x4a6ebf&&(_0x4a6ebf[_0x4d79b0(0x217)]['display']=_0x4d79b0(0x219));});}async['checkAndRecordPromotion'](_0x3f2147,_0x1d3b9a,_0x49bf5a,_0x3b2178={}){const _0x1ecfaf=a43_0x998ea4;try{if(_0x1d3b9a===_0x49bf5a||!_0x3f2147)return null;const _0x499f90=_0x3b2178['source']||'automatic',_0x26ca8c=_0x3b2178[_0x1ecfaf(0x1f7)]||null,_0x180bba=_0x3b2178['adminUser']||null;console['log'](_0x1ecfaf(0x1f5)+_0x49bf5a+'\x20→\x20'+_0x1d3b9a+_0x1ecfaf(0x1f2)+_0x499f90+')');let _0x421b9d=null,_0x137d01=null;try{const _0x405312=await getDoc(doc(db,'players',_0x3f2147));if(_0x405312[_0x1ecfaf(0x21e)]()){const _0x31a327=_0x405312['data']();_0x421b9d=_0x31a327['username']||_0x31a327['displayName']||null,_0x137d01=_0x31a327['displayName']||_0x31a327['username']||null;}!_0x421b9d&&_0x3b2178[_0x1ecfaf(0x231)]&&(_0x421b9d=_0x3b2178['username'],_0x137d01=_0x3b2178['username']);!_0x421b9d&&auth[_0x1ecfaf(0x230)]&&(_0x421b9d=auth[_0x1ecfaf(0x230)]['displayName']||auth['currentUser']['email']['split']('@')[0x0],_0x137d01=auth['currentUser'][_0x1ecfaf(0x22d)]||null);if(!_0x421b9d){const _0x211c3f=query(collection(db,'approvedMatches'),where(_0x1ecfaf(0x1ff),'==',_0x3f2147),limit(0x1)),_0x53201a=await getDocs(_0x211c3f);if(!_0x53201a[_0x1ecfaf(0x1eb)])_0x421b9d=_0x53201a['docs'][0x0]['data']()['winnerUsername']||_0x1ecfaf(0x20c),_0x137d01=_0x421b9d;else{const _0x529518=query(collection(db,_0x1ecfaf(0x228)),where('loserId','==',_0x3f2147),limit(0x1)),_0x13a281=await getDocs(_0x529518);!_0x13a281['empty']&&(_0x421b9d=_0x13a281[0x0]['data']()['loserUsername']||'Unknown\x20Player',_0x137d01=_0x421b9d);}}}catch(_0x40b53a){console['error']('Error\x20resolving\x20username:',_0x40b53a);}!_0x421b9d&&(console[_0x1ecfaf(0x227)]('Could\x20not\x20resolve\x20username\x20for\x20userId:',_0x3f2147),_0x421b9d='A\x20player',_0x137d01=_0x1ecfaf(0x20c));const _0x596b06=this['getRankName'](_0x49bf5a),_0x551c0b=this['getRankName'](_0x1d3b9a);if(_0x596b06!==_0x551c0b){const _0x2b4b83=_0x1d3b9a>_0x49bf5a,_0x205ba1=_0x2b4b83?'promotion':_0x1ecfaf(0x1ee),_0x2089a5=_0x551c0b;console[_0x1ecfaf(0x22a)]('Recording\x20'+_0x205ba1+'\x20for\x20'+_0x421b9d+':\x20'+_0x49bf5a+'\x20('+_0x596b06+')\x20→\x20'+_0x1d3b9a+'\x20('+_0x551c0b+')');try{const _0x328962={'player':_0x421b9d,'playerUsername':_0x421b9d,'username':_0x421b9d,'displayName':_0x137d01,'userId':_0x3f2147,'type':_0x205ba1,'rankAchieved':_0x2089a5,'timestamp':serverTimestamp(),'previousElo':_0x49bf5a,'newElo':_0x1d3b9a,'change':_0x1d3b9a-_0x49bf5a,'previousRank':_0x596b06,'newRank':_0x551c0b,'source':_0x499f90};if(_0x499f90==='match'&&_0x26ca8c)_0x328962['matchId']=_0x26ca8c;else _0x499f90===_0x1ecfaf(0x1fb)&&_0x180bba?(_0x328962['modifiedBy']=_0x180bba,_0x328962[_0x1ecfaf(0x1e1)]=![]):_0x328962['isAutomatic']=!![];const _0x287f68=writeBatch(db),_0x6157d=doc(collection(db,_0x1ecfaf(0x205))),_0x2c0ce2=doc(collection(db,'promotionHistory'));return _0x287f68['set'](_0x6157d,_0x328962),_0x287f68[_0x1ecfaf(0x22c)](_0x2c0ce2,_0x328962),await _0x287f68['commit'](),await this['sendPromotionNotification'](_0x3f2147,_0x421b9d,_0x49bf5a,_0x1d3b9a,_0x596b06,_0x551c0b,_0x205ba1,{'displayName':_0x137d01,'source':_0x499f90,'matchId':_0x26ca8c,'ladder':_0x3b2178['ladder']||'D1'}),console['log'](_0x1ecfaf(0x225)+_0x205ba1+'\x20for\x20'+_0x421b9d+'\x20to\x20'+_0x2089a5),_0x2089a5;}catch(_0x1bb5ee){console['error']('Error\x20writing\x20promotion\x20records:',_0x1bb5ee);try{return await addDoc(collection(db,'eloHistory'),{'player':_0x421b9d,'playerUsername':_0x421b9d,'username':_0x421b9d,'displayName':_0x137d01,'userId':_0x3f2147,'type':_0x205ba1,'rankAchieved':_0x2089a5,'timestamp':serverTimestamp(),'previousElo':_0x49bf5a,'newElo':_0x1d3b9a,'change':_0x1d3b9a-_0x49bf5a,'previousRank':_0x596b06,'source':_0x499f90,'isAutomatic':_0x499f90!=='admin'}),await this[_0x1ecfaf(0x235)](_0x3f2147,_0x421b9d,_0x49bf5a,_0x1d3b9a,_0x596b06,_0x551c0b,_0x205ba1,{'displayName':_0x137d01,'source':_0x499f90,'matchId':_0x26ca8c,'ladder':_0x3b2178['ladder']||'D1'}),_0x2089a5;}catch(_0x4cdbe4){return console['error']('Fallback\x20write\x20failed:',_0x4cdbe4),null;}}}return null;}catch(_0x334f7c){return console['error']('Error\x20in\x20promotion/demotion\x20recording:',_0x334f7c),null;}}['getRankName'](_0x3d4f4d){const _0x29a421=a43_0x998ea4;for(let _0x194c5c=this[_0x29a421(0x229)]['length']-0x1;_0x194c5c>=0x0;_0x194c5c--){if(_0x3d4f4d>=this['RANKS'][_0x194c5c]['threshold'])return this['RANKS'][_0x194c5c]['name'];}return'Unranked';}['cleanup'](){this['pollingInterval']&&clearInterval(this['pollingInterval']);}[a43_0x998ea4(0x204)](_0x55cf95){const _0xfc5976=a43_0x998ea4;if(_0x55cf95['timestamp']){const _0xd8049=_0x55cf95['timestamp'][_0xfc5976(0x22f)]*0x3e8,_0x4456f4=Date['now'](),_0x1134c8=(_0x4456f4-_0xd8049)/(0x3e8*0x3c*0x3c);if(_0x1134c8>0x18)return![];}if(_0x55cf95['previousRank']&&_0x55cf95['newRank']&&_0x55cf95[_0xfc5976(0x1fd)]!==_0x55cf95['newRank'])return!![];return![];}async['sendPromotionNotification'](_0x7e6884,_0x32be8b,_0x5e571a,_0x1f2c3d,_0x1316ef,_0x1286c9,_0x2d22bc,_0x4fa912={}){const _0x173456=a43_0x998ea4;try{console['log']('STARTING\x20notification\x20for\x20'+_0x32be8b+'\x27s\x20'+_0x2d22bc);const _0xe036b4={'userId':_0x7e6884,'username':_0x32be8b,'displayName':_0x4fa912[_0x173456(0x22d)]||_0x32be8b,'oldElo':parseInt(_0x5e571a),'newElo':parseInt(_0x1f2c3d),'eloDifference':parseInt(_0x1f2c3d)-parseInt(_0x5e571a),'oldRank':_0x1316ef,'newRank':_0x1286c9,'type':_0x2d22bc,'timestamp':serverTimestamp(),'processed':![],'source':_0x4fa912['source']||'automatic','matchId':_0x4fa912[_0x173456(0x1f7)]||null,'ladder':_0x4fa912[_0x173456(0x207)]||'D1','adminUser':_0x4fa912['adminUser']||null};console['log']('Creating\x20Discord\x20notification:',_0xe036b4);const _0x3197e4=await addDoc(collection(db,_0x173456(0x21b)),_0xe036b4);return console['log']('Discord\x20notification\x20sent\x20successfully\x20with\x20ID:\x20'+_0x3197e4['id']),!![];}catch(_0xb9a135){return console['error'](_0x173456(0x20a),_0xb9a135),![];}}}function a43_0xe0af(_0x21945f,_0x61d4a4){const _0x3e001e=a43_0x523f();return a43_0xe0af=function(_0x4e9899,_0x1d4d86){_0x4e9899=_0x4e9899-0x1e1;let _0x523f78=_0x3e001e[_0x4e9899];return _0x523f78;},a43_0xe0af(_0x21945f,_0x61d4a4);}export const promotionManager=new PromotionManager();document['addEventListener']('DOMContentLoaded',()=>{const _0x5bd40a=a43_0x998ea4;promotionManager[_0x5bd40a(0x21f)]();});export const initializePromotionTracker=()=>promotionManager[a43_0x998ea4(0x21f)]();export const checkAndRecordPromotion=(_0x27178c,_0x1edcd1,_0x51e099,_0x1cc4c3)=>promotionManager['checkAndRecordPromotion'](_0x27178c,_0x1edcd1,_0x51e099,_0x1cc4c3);function a43_0x523f(){const _0x5f117c=['isAutomatic','setAttribute','remove','Skipping\x20ignored\x20promotion:\x20','#50C878','ignorePromotion','addEventListener','parse','date','resolveUserId','empty','test','title','demotion','block','parentNode','console','\x20(source:\x20','shouldShowPromotion','createElement','Processing\x20potential\x20rank\x20change:\x20','promotion','matchId','Error\x20checking\x20promotion\x20visibility:','Error\x20fetching\x20promotions:','Promotion\x20','admin','toString','previousRank','getItem','winnerId','visible','DISPLAY_HOURS','innerHTML','\x20<span\x20class=\x22rank-text\x22>','isNewRankChange','eloHistory','bind','ladder','error','click','Error\x20sending\x20Discord\x20notification:','children','Unknown\x20Player','new-rank-change','timestamp','rankAchieved','length','className','div','Don\x27t\x20show\x20again','playerUsername','now','Rank\x20Update','style','#CD7F32','none','setItem','promotionNotifications','data','type','exists','initialize','classList','promotion-details','lastFetchTime','forEach','docs','Successfully\x20recorded\x20','promotions_checked_','warn','approvedMatches','RANKS','log','some','set','displayName','\x20was\x20demoted\x20to','seconds','currentUser','username','desc','fetchInterval','bannerContainer','sendPromotionNotification','Resolved\x20','true','add','button'];a43_0x523f=function(){return _0x5f117c;};return a43_0x523f();}export const getRankName=_0x32f2c4=>promotionManager['getRankName'](_0x32f2c4);
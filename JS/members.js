function a38_0x1aaf(){const _0x58b029=['all','updateMembersList','console','set','__proto__','return\x20(function()\x20','playersD2','log','username','serverTimestamp','data','bronze','profileImageUrl','elo','collection','favoriteWeapon','params','isNonParticipant','silver','Successfully\x20updated\x20aggregated\x20members\x20list','exception','error','constructor','apply','push','get','forEach','Error\x20updating\x20members\x20list:','favoriteMap','Error\x20rebuilding\x20members\x20list','userProfiles','has','table','warn'];a38_0x1aaf=function(){return _0x58b029;};return a38_0x1aaf();}const a38_0x107663=a38_0xdbe7,a38_0x288376=(function(){let _0x2639aa=!![];return function(_0xc8a4a9,_0x20681c){const _0x449de6=_0x2639aa?function(){const _0x22847c=a38_0xdbe7;if(_0x20681c){const _0x14f274=_0x20681c[_0x22847c(0x13f)](_0xc8a4a9,arguments);return _0x20681c=null,_0x14f274;}}:function(){};return _0x2639aa=![],_0x449de6;};}()),a38_0x4fd3ac=a38_0x288376(this,function(){const _0x5b4cc9=a38_0xdbe7,_0x54a87e=function(){const _0x1e5f1b=a38_0xdbe7;let _0x1e8c4e;try{_0x1e8c4e=Function(_0x1e5f1b(0x12d)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x15c4f9){_0x1e8c4e=window;}return _0x1e8c4e;},_0x346f79=_0x54a87e(),_0x999bec=_0x346f79['console']=_0x346f79[_0x5b4cc9(0x12a)]||{},_0x3dc58d=[_0x5b4cc9(0x12f),_0x5b4cc9(0x149),'info','error',_0x5b4cc9(0x13c),_0x5b4cc9(0x148),'trace'];for(let _0x551810=0x0;_0x551810<_0x3dc58d['length'];_0x551810++){const _0x7cd10=a38_0x288376[_0x5b4cc9(0x13e)]['prototype']['bind'](a38_0x288376),_0x5eeba6=_0x3dc58d[_0x551810],_0x3c64f8=_0x999bec[_0x5eeba6]||_0x7cd10;_0x7cd10[_0x5b4cc9(0x12c)]=a38_0x288376['bind'](a38_0x288376),_0x7cd10['toString']=_0x3c64f8['toString']['bind'](_0x3c64f8),_0x999bec[_0x5eeba6]=_0x7cd10;}});function a38_0xdbe7(_0x2494f2,_0x37bf78){const _0x4fd3ac=a38_0x1aaf();return a38_0xdbe7=function(_0x288376,_0x32a8d4){_0x288376=_0x288376-0x128;let _0x1aaf33=_0x4fd3ac[_0x288376];return _0x1aaf33;},a38_0xdbe7(_0x2494f2,_0x37bf78);}a38_0x4fd3ac();const functions=require('firebase-functions'),admin=require('firebase-admin');admin['initializeApp']();const db=admin['firestore']();exports[a38_0x107663(0x129)]=functions['firestore']['document']('{collection}/{docId}')['onWrite'](async(_0x125e86,_0x439c5f)=>{const _0x297aaa=a38_0x107663,_0x3f2c21=_0x439c5f[_0x297aaa(0x138)]['collection'],_0x151782=_0x439c5f[_0x297aaa(0x138)]['docId'];if(!['players','playersD2','playersD3','userProfiles','nonParticipants']['includes'](_0x3f2c21))return null;try{await rebuildMembersList(),console['log'](_0x297aaa(0x13b));}catch(_0x2f7a60){console[_0x297aaa(0x13d)](_0x297aaa(0x143),_0x2f7a60);}});async function rebuildMembersList(){const _0x2afbed=a38_0x107663,_0x2d8bfe=db['batch'](),[_0x28acc4,_0x3092be,_0x8ed345,_0x1a6020,_0x249d6c]=await Promise[_0x2afbed(0x128)]([db['collection'](_0x2afbed(0x146))['get'](),db['collection']('players')[_0x2afbed(0x141)](),db[_0x2afbed(0x136)](_0x2afbed(0x12e))['get'](),db['collection']('playersD3')['get'](),db['collection']('nonParticipants')['get']()]),_0x3110a0=new Map();_0x28acc4['forEach'](_0x4a95ff=>{_0x3110a0['set'](_0x4a95ff['id'],_0x4a95ff['data']());});const _0x38eed6=new Map(),_0x5e5336=(_0x44ad16,_0x3db610)=>{_0x44ad16['forEach'](_0x2bc023=>{const _0x4255e1=a38_0xdbe7,_0x421bb9=_0x2bc023[_0x4255e1(0x132)](),_0x4113b6=_0x2bc023['id'];!_0x38eed6[_0x4255e1(0x147)](_0x4113b6)&&_0x38eed6[_0x4255e1(0x12b)](_0x4113b6,{'userId':_0x4113b6,'username':_0x421bb9['username']||'Unknown','ladders':[],'isNonParticipant':![]});const _0x1b1d4d=_0x38eed6[_0x4255e1(0x141)](_0x4113b6);_0x1b1d4d['ladders'][_0x4255e1(0x140)]({'ladder':_0x3db610,'elo':_0x421bb9['eloRating']||0x4b0,'active':_0x421bb9['active']!==![]});});};_0x5e5336(_0x3092be,'D1'),_0x5e5336(_0x8ed345,'D2'),_0x5e5336(_0x1a6020,'D3'),_0x249d6c['forEach'](_0xe59316=>{const _0x4a9931=_0x2afbed,_0x30afa2=_0xe59316[_0x4a9931(0x132)](),_0x367b00=_0xe59316['id'];!_0x38eed6['has'](_0x367b00)&&_0x30afa2['username']&&_0x38eed6['set'](_0x367b00,{'userId':_0x367b00,'username':_0x30afa2[_0x4a9931(0x130)],'ladders':[],'isNonParticipant':!![]});});const _0x188d4a=[];_0x38eed6[_0x2afbed(0x142)]((_0x7eda96,_0xd68046)=>{const _0x48d2b8=_0x2afbed,_0x275646=_0x3110a0[_0x48d2b8(0x141)](_0xd68046)||{};let _0x23ab35=0x0,_0x2097ea=null;if(_0x7eda96['ladders']['length']>0x0){const _0x3e6244=_0x7eda96['ladders']['sort']((_0x542b73,_0x4f420d)=>_0x4f420d['elo']-_0x542b73[_0x48d2b8(0x135)]);_0x23ab35=_0x3e6244[0x0]['elo'],_0x2097ea=_0x3e6244[0x0]['ladder'];}const _0x1ea0a1={'userId':_0xd68046,'username':_0x7eda96['username'],'profileImageUrl':_0x275646[_0x48d2b8(0x134)]||null,'country':_0x275646['country']||null,'motto':_0x275646['motto']||null,'favoriteMap':_0x275646[_0x48d2b8(0x144)]||null,'favoriteWeapon':_0x275646[_0x48d2b8(0x137)]||null,'isNonParticipant':_0x7eda96[_0x48d2b8(0x139)],'ladders':_0x7eda96['ladders'],'primaryLadder':_0x2097ea,'highestElo':_0x23ab35,'rank':getPlayerRank(_0x23ab35),'lastUpdated':admin['firestore']['FieldValue'][_0x48d2b8(0x131)]()};_0x188d4a[_0x48d2b8(0x140)](_0x1ea0a1);});const _0x1a98a2=db[_0x2afbed(0x136)]('aggregatedMembers'),_0x674563=await _0x1a98a2['get'](),_0x411599=[];_0x674563['forEach'](_0x3f8947=>{_0x411599['push'](_0x3f8947['ref']['delete']());}),await Promise['all'](_0x411599);const _0x3d982f=0x1f4,_0x249fcc=[];for(let _0x418bf0=0x0;_0x418bf0<_0x188d4a['length'];_0x418bf0+=_0x3d982f){const _0x406640=db['batch'](),_0x371ba7=_0x188d4a['slice'](_0x418bf0,_0x418bf0+_0x3d982f);_0x371ba7[_0x2afbed(0x142)](_0x2ec686=>{const _0x50608b=_0x2afbed,_0x56e1ca=_0x1a98a2['doc'](_0x2ec686['userId']);_0x406640[_0x50608b(0x12b)](_0x56e1ca,_0x2ec686);}),_0x249fcc['push'](_0x406640['commit']());}await Promise[_0x2afbed(0x128)](_0x249fcc);}function getPlayerRank(_0x314168){const _0x316f06=a38_0x107663;if(_0x314168>=0x7d0)return'emerald';if(_0x314168>=0x708)return'gold';if(_0x314168>=0x640)return _0x316f06(0x13a);if(_0x314168>=0x578)return _0x316f06(0x133);return'unranked';}exports['rebuildMembersListManual']=functions['https']['onRequest'](async(_0xd16971,_0x337451)=>{const _0x1215f0=a38_0x107663;try{await rebuildMembersList(),_0x337451['status'](0xc8)['send']('Members\x20list\x20rebuilt\x20successfully');}catch(_0x49ab86){console[_0x1215f0(0x13d)]('Error\x20rebuilding\x20members\x20list:',_0x49ab86),_0x337451['status'](0x1f4)['send'](_0x1215f0(0x145));}});
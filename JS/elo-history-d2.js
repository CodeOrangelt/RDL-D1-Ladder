const a14_0x35a0e5=a14_0x4e40,a14_0x78b8be=(function(){let _0x444681=!![];return function(_0x5dddb1,_0x22bcb1){const _0x2d2ad1=_0x444681?function(){if(_0x22bcb1){const _0x64c8d6=_0x22bcb1['apply'](_0x5dddb1,arguments);return _0x22bcb1=null,_0x64c8d6;}}:function(){};return _0x444681=![],_0x2d2ad1;};}()),a14_0x23ec41=a14_0x78b8be(this,function(){const _0x128dec=a14_0x4e40,_0x5a8265=function(){const _0x333165=a14_0x4e40;let _0x5adfff;try{_0x5adfff=Function('return\x20(function()\x20'+_0x333165(0x158)+');')();}catch(_0x938356){_0x5adfff=window;}return _0x5adfff;},_0x227dbc=_0x5a8265(),_0x32e08e=_0x227dbc['console']=_0x227dbc['console']||{},_0x32d35c=[_0x128dec(0x15b),'warn','info','error',_0x128dec(0x157),_0x128dec(0x15f),'trace'];for(let _0x37061d=0x0;_0x37061d<_0x32d35c['length'];_0x37061d++){const _0x36e101=a14_0x78b8be['constructor']['prototype'][_0x128dec(0x163)](a14_0x78b8be),_0x13d6fa=_0x32d35c[_0x37061d],_0x28cece=_0x32e08e[_0x13d6fa]||_0x36e101;_0x36e101[_0x128dec(0x169)]=a14_0x78b8be[_0x128dec(0x163)](a14_0x78b8be),_0x36e101['toString']=_0x28cece['toString']['bind'](_0x28cece),_0x32e08e[_0x13d6fa]=_0x36e101;}});a14_0x23ec41();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D2=[{'name':'Gold','elo':0x708},{'name':a14_0x35a0e5(0x167),'elo':0x640},{'name':'Bronze','elo':0x578},{'name':'Unranked','elo':0x4b0}];let lastVisibleD2=null;function a14_0x5955(){const _0x3626d2=['demotion','exception','{}.constructor(\x22return\x20this\x22)(\x20)','map','docs','log','error','playersD2','length','table','Error\x20recording\x20D2\x20ELO\x20history:','opponent','desc','bind','data','loserId','Emerald','Silver','Unknown\x20Player','__proto__','newElo','promotion'];a14_0x5955=function(){return _0x3626d2;};return a14_0x5955();}async function getUsernameByIdD2(_0x10374c){const _0x12620e=a14_0x35a0e5;try{if(!_0x10374c)return _0x12620e(0x168);const _0x8b69ec=await getDoc(doc(db,_0x12620e(0x15d),_0x10374c));if(_0x8b69ec['exists']())return _0x8b69ec[_0x12620e(0x164)]()['username']||_0x12620e(0x168);const _0x1af38f=await getDocs(query(collection(db,'approvedMatchesD2'),where('winnerId','==',_0x10374c),limit(0x1)));if(!_0x1af38f['empty'])return _0x1af38f['docs'][0x0]['data']()['winnerUsername']||'Unknown\x20Player';const _0x10f868=await getDocs(query(collection(db,'approvedMatchesD2'),where(_0x12620e(0x165),'==',_0x10374c),limit(0x1)));if(!_0x10f868['empty'])return _0x10f868[_0x12620e(0x15a)][0x0]['data']()['loserUsername']||'Unknown\x20Player';return _0x12620e(0x168);}catch(_0x246dca){return console[_0x12620e(0x15c)]('Error\x20getting\x20username:',_0x246dca),'Unknown\x20Player';}}export async function recordEloChangeD2({playerId:_0x397cc6,previousElo:_0x48ab55,newElo:_0x37c64d,opponentId:_0x5e51da,matchResult:_0x4a2a85,previousPosition:_0x4d9abf,newPosition:_0x58d666,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0xa5dcb1,timestamp:_0x484137}){const _0x47c8d7=a14_0x35a0e5;try{const _0x1c9138=doc(collection(db,'eloHistoryD2'));let _0x212c4d='match';if(isPromotion)_0x212c4d=_0x47c8d7(0x16b);if(isDemotion)_0x212c4d=_0x47c8d7(0x156);let _0xcec621='Unranked';if(_0x37c64d>=0x834)_0xcec621=_0x47c8d7(0x166);else{if(_0x37c64d>=0x708)_0xcec621='Gold';else{if(_0x37c64d>=0x640)_0xcec621='Silver';else{if(_0x37c64d>=0x578)_0xcec621='Bronze';}}}return await setDoc(_0x1c9138,{'type':_0x212c4d,'player':_0x397cc6,'opponent':_0x5e51da,'previousElo':_0x48ab55,'newElo':_0x37c64d,'change':_0x37c64d-_0x48ab55,'matchResult':_0x4a2a85,'previousPosition':_0x4d9abf,'newPosition':_0x58d666,'rankAchieved':_0xcec621,'matchId':_0xa5dcb1,'timestamp':_0x484137}),console['log']('D2\x20ELO\x20history\x20recorded\x20for\x20'+_0x397cc6),!![];}catch(_0x115c12){console[_0x47c8d7(0x15c)](_0x47c8d7(0x160),_0x115c12);throw _0x115c12;}}function a14_0x4e40(_0x2aca9e,_0x233d4b){const _0x23ec41=a14_0x5955();return a14_0x4e40=function(_0x78b8be,_0x325da7){_0x78b8be=_0x78b8be-0x156;let _0x5955d3=_0x23ec41[_0x78b8be];return _0x5955d3;},a14_0x4e40(_0x2aca9e,_0x233d4b);}export async function getEloHistoryD2(_0x5e8373=0x14){const _0x2359ea=a14_0x35a0e5;try{const _0x3232f2=collection(db,'eloHistoryD2');let _0x1e5621;lastVisibleD2?_0x1e5621=query(_0x3232f2,orderBy('timestamp',_0x2359ea(0x162)),startAfter(lastVisibleD2),limit(_0x5e8373)):_0x1e5621=query(_0x3232f2,orderBy('timestamp','desc'),limit(_0x5e8373));const _0x9cddf2=await getDocs(_0x1e5621);if(_0x9cddf2['empty'])return{'entries':[],'hasMore':![]};lastVisibleD2=_0x9cddf2[_0x2359ea(0x15a)][_0x9cddf2['docs'][_0x2359ea(0x15e)]-0x1];const _0x351590=_0x9cddf2['docs'][_0x2359ea(0x159)](async _0x34e826=>{const _0x2c93a8=_0x2359ea,_0x56da6b=_0x34e826[_0x2c93a8(0x164)](),[_0x57c4aa,_0x347cd3]=await Promise['all']([getUsernameByIdD2(_0x56da6b['player']),getUsernameByIdD2(_0x56da6b[_0x2c93a8(0x161)])]);return{..._0x56da6b,'playerUsername':_0x57c4aa,'opponentUsername':_0x347cd3,'change':_0x56da6b[_0x2c93a8(0x16a)]-_0x56da6b['previousElo'],'timestamp':_0x56da6b['timestamp']};}),_0x272736=await Promise['all'](_0x351590);return{'entries':_0x272736,'hasMore':_0x9cddf2['size']===_0x5e8373};}catch(_0x54b877){console['error']('Error\x20fetching\x20D2\x20ELO\x20history:',_0x54b877);throw _0x54b877;}}export function resetPaginationD2(){lastVisibleD2=null;}
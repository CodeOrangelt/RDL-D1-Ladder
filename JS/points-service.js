const a42_0x50ead9=a42_0x1ab3,a42_0x54b53f=(function(){let _0xff68c9=!![];return function(_0x4abccc,_0x53394c){const _0x29ab1b=_0xff68c9?function(){if(_0x53394c){const _0x3f9948=_0x53394c['apply'](_0x4abccc,arguments);return _0x53394c=null,_0x3f9948;}}:function(){};return _0xff68c9=![],_0x29ab1b;};}()),a42_0x1b08d4=a42_0x54b53f(this,function(){const _0x4803a0=a42_0x1ab3;let _0x46c022;try{const _0x3358ce=Function('return\x20(function()\x20'+_0x4803a0(0x1cd)+');');_0x46c022=_0x3358ce();}catch(_0x123d2b){_0x46c022=window;}const _0x1ca397=_0x46c022['console']=_0x46c022[_0x4803a0(0x1d8)]||{},_0x5d0be9=['log',_0x4803a0(0x1d3),'info',_0x4803a0(0x1d1),'exception','table',_0x4803a0(0x1de)];for(let _0x43b00c=0x0;_0x43b00c<_0x5d0be9['length'];_0x43b00c++){const _0x3a4981=a42_0x54b53f[_0x4803a0(0x1d5)]['prototype'][_0x4803a0(0x1cf)](a42_0x54b53f),_0x2d7b04=_0x5d0be9[_0x43b00c],_0xbc9f4a=_0x1ca397[_0x2d7b04]||_0x3a4981;_0x3a4981['__proto__']=a42_0x54b53f[_0x4803a0(0x1cf)](a42_0x54b53f),_0x3a4981['toString']=_0xbc9f4a['toString'][_0x4803a0(0x1cf)](_0xbc9f4a),_0x1ca397[_0x2d7b04]=_0x3a4981;}});a42_0x1b08d4();import{db}from'./firebase-config.js';import{doc,getDoc,updateDoc,addDoc,collection,serverTimestamp,setDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const POINTS_CHART={'':0xa,'Standard':0xa,'Fusion\x20Match':0x19,'≥6\x20Missiles':0xa,'Weapon\x20Imbalance':0x1e,'Blind\x20Match':0x4b,'Rematch':0x14,'Disorientation':0x32,'Ratting':0x23,'Altered\x20Powerups':0x23,'Mega\x20Match':0x28,'Dogfight':0x32,'Gauss\x20and\x20Mercs':0x19,'Misc':0x1e};let adminModifyUserPoints=null;try{const adminModule=await import(a42_0x50ead9(0x1d9));adminModule['modifyUserPoints']&&(adminModifyUserPoints=adminModule['modifyUserPoints'],console['log']('Admin\x20points\x20service\x20connected'));}catch(a42_0x5b9192){console['log']('Admin\x20backend\x20not\x20available,\x20using\x20fallback\x20points\x20service');}function a42_0x1ab3(_0x2eca1f,_0x28288d){const _0x1b08d4=a42_0x4de5();return a42_0x1ab3=function(_0x54b53f,_0x2f9456){_0x54b53f=_0x54b53f-0x1ca;let _0x4de51a=_0x1b08d4[_0x54b53f];return _0x4de51a;},a42_0x1ab3(_0x2eca1f,_0x28288d);}export async function awardMatchPoints(_0x4cf25f,_0x17b693,_0x1fdf7d){const _0x544e01=a42_0x50ead9;try{const _0x2f5c22=POINTS_CHART[_0x1fdf7d]||0xa;return adminModifyUserPoints?await Promise['all']([adminModifyUserPoints(_0x4cf25f,_0x544e01(0x1cb),_0x2f5c22,'Match\x20points:\x20'+(_0x1fdf7d||_0x544e01(0x1db))+'\x20match\x20(Winner)'),adminModifyUserPoints(_0x17b693,'add',_0x2f5c22,_0x544e01(0x1ca)+(_0x1fdf7d||_0x544e01(0x1db))+'\x20match\x20(Participant)')]):await Promise['all']([addPointsFallback(_0x4cf25f,_0x2f5c22,'Match\x20points:\x20'+(_0x1fdf7d||'Standard')+_0x544e01(0x1dd)),addPointsFallback(_0x17b693,_0x2f5c22,_0x544e01(0x1ca)+(_0x1fdf7d||'Standard')+_0x544e01(0x1d6))]),console['log']('Awarded\x20'+_0x2f5c22+'\x20points\x20to\x20both\x20players\x20for\x20'+(_0x1fdf7d||'Standard')+'\x20match'),!![];}catch(_0x1a8766){return console[_0x544e01(0x1d1)]('Error\x20awarding\x20match\x20points:',_0x1a8766),![];}}function a42_0x4de5(){const _0x40c56e=['Match\x20points:\x20','add','\x20points','{}.constructor(\x22return\x20this\x22)(\x20)','points','bind','\x20with\x20','error','\x20points\x20to\x20','warn','Match\x20Award','constructor','\x20match\x20(Participant)','❌\x20Error\x20awarding\x20points\x20to\x20','console','./adminbackend.js','\x20+\x20','Standard','system-match-award','\x20match\x20(Winner)','trace'];a42_0x4de5=function(){return _0x40c56e;};return a42_0x4de5();}async function addPointsFallback(_0xe81677,_0x7e13c0,_0x52dd83=''){const _0x4ff564=a42_0x50ead9;try{const _0x515582=doc(db,'userProfiles',_0xe81677),_0x2a3c93=await getDoc(_0x515582);if(!_0x2a3c93['exists']())console['log']('User\x20profile\x20not\x20found\x20for\x20'+_0xe81677+',\x20creating\x20new\x20profile\x20with\x20points'),await setDoc(_0x515582,{'points':_0x7e13c0,'inventory':[],'equippedToken':null,'createdAt':serverTimestamp(),'username':'Unknown\x20User','lastPointsModified':serverTimestamp()}),console['log']('Created\x20new\x20profile\x20for\x20'+_0xe81677+_0x4ff564(0x1d0)+_0x7e13c0+_0x4ff564(0x1cc));else{const _0x40eb9d=_0x2a3c93['data'](),_0x1be891=_0x40eb9d['points']||0x0,_0x48fd1e=_0x1be891+_0x7e13c0;await updateDoc(_0x515582,{'points':_0x48fd1e,'lastPointsModified':serverTimestamp()}),console['log']('Updated\x20'+_0xe81677+':\x20'+_0x1be891+_0x4ff564(0x1da)+_0x7e13c0+'\x20=\x20'+_0x48fd1e+'\x20points');}try{await addDoc(collection(db,'pointsHistory'),{'userId':_0xe81677,'userEmail':'unknown','displayName':_0x4ff564(0x1d4),'action':'add','amount':_0x7e13c0,'previousPoints':_0x2a3c93['exists']()?_0x2a3c93['data']()[_0x4ff564(0x1ce)]||0x0:0x0,'newPoints':(_0x2a3c93['exists']()?_0x2a3c93['data']()['points']||0x0:0x0)+_0x7e13c0,'reason':_0x52dd83,'adminEmail':_0x4ff564(0x1dc),'timestamp':serverTimestamp()});}catch(_0x39e0f0){console['warn']('Could\x20not\x20log\x20points\x20transaction:',_0x39e0f0);}return console['log']('✅\x20Successfully\x20awarded\x20'+_0x7e13c0+_0x4ff564(0x1d2)+_0xe81677+'\x20for:\x20'+_0x52dd83),!![];}catch(_0x4fe054){return console[_0x4ff564(0x1d1)](_0x4ff564(0x1d7)+_0xe81677+':',_0x4fe054),![];}}
const a38_0x2bf8fd=a38_0x2ce5,a38_0x164d96=(function(){let _0x311911=!![];return function(_0x48bbbd,_0x4e0bf6){const _0x448617=_0x311911?function(){if(_0x4e0bf6){const _0x6d81f9=_0x4e0bf6['apply'](_0x48bbbd,arguments);return _0x4e0bf6=null,_0x6d81f9;}}:function(){};return _0x311911=![],_0x448617;};}()),a38_0x3d5548=a38_0x164d96(this,function(){const _0x481e2d=a38_0x2ce5,_0x47402c=function(){const _0x4e0c7c=a38_0x2ce5;let _0x2ba52b;try{_0x2ba52b=Function('return\x20(function()\x20'+_0x4e0c7c(0x1d3)+');')();}catch(_0x266c65){_0x2ba52b=window;}return _0x2ba52b;},_0x55268c=_0x47402c(),_0x426824=_0x55268c[_0x481e2d(0x1d6)]=_0x55268c[_0x481e2d(0x1d6)]||{},_0x18cddf=['log','warn','info','error',_0x481e2d(0x1e5),'table','trace'];for(let _0xc41458=0x0;_0xc41458<_0x18cddf['length'];_0xc41458++){const _0x4aac88=a38_0x164d96['constructor'][_0x481e2d(0x1d2)]['bind'](a38_0x164d96),_0xeb5038=_0x18cddf[_0xc41458],_0x51b16d=_0x426824[_0xeb5038]||_0x4aac88;_0x4aac88['__proto__']=a38_0x164d96['bind'](a38_0x164d96),_0x4aac88['toString']=_0x51b16d['toString']['bind'](_0x51b16d),_0x426824[_0xeb5038]=_0x4aac88;}});a38_0x3d5548();const functions=require('firebase-functions'),admin=require('firebase-admin');admin['initializeApp']();const db=admin[a38_0x2bf8fd(0x1e3)]();exports['updateMembersList']=functions[a38_0x2bf8fd(0x1e3)][a38_0x2bf8fd(0x1f1)](a38_0x2bf8fd(0x1e9))['onWrite'](async(_0x8777fc,_0x55d368)=>{const _0x2cc7f4=a38_0x2bf8fd,_0xe5cd8e=_0x55d368['params']['collection'],_0x179a55=_0x55d368['params']['docId'];if(!['players','playersD2','playersD3','userProfiles',_0x2cc7f4(0x1ed)][_0x2cc7f4(0x1db)](_0xe5cd8e))return null;try{await rebuildMembersList(),console[_0x2cc7f4(0x1da)]('Successfully\x20updated\x20aggregated\x20members\x20list');}catch(_0x28aba4){console['error']('Error\x20updating\x20members\x20list:',_0x28aba4);}});function a38_0x4e68(){const _0x25bab7=['prototype','{}.constructor(\x22return\x20this\x22)(\x20)','Error\x20rebuilding\x20members\x20list','username','console','rebuildMembersListManual','emerald','send','log','includes','slice','elo','collection','Members\x20list\x20rebuilt\x20successfully','aggregatedMembers','set','serverTimestamp','firestore','get','exception','commit','https','silver','{collection}/{docId}','all','gold','status','nonParticipants','ladders','userId','userProfiles','document','push'];a38_0x4e68=function(){return _0x25bab7;};return a38_0x4e68();}async function rebuildMembersList(){const _0x3dc03b=a38_0x2bf8fd,_0x49ea4c=db['batch'](),[_0x30918e,_0x375dab,_0x3cd4ff,_0x28ea54,_0x3b0283]=await Promise[_0x3dc03b(0x1ea)]([db[_0x3dc03b(0x1de)](_0x3dc03b(0x1f0))['get'](),db[_0x3dc03b(0x1de)]('players')['get'](),db[_0x3dc03b(0x1de)]('playersD2')['get'](),db['collection']('playersD3')['get'](),db['collection'](_0x3dc03b(0x1ed))[_0x3dc03b(0x1e4)]()]),_0x4366e1=new Map();_0x30918e['forEach'](_0x37152b=>{_0x4366e1['set'](_0x37152b['id'],_0x37152b['data']());});const _0x6db28b=new Map(),_0x4e4207=(_0x5b8cd0,_0x2535c0)=>{_0x5b8cd0['forEach'](_0x10debb=>{const _0x1acfd3=a38_0x2ce5,_0x4f4824=_0x10debb['data'](),_0x5dd07d=_0x10debb['id'];!_0x6db28b['has'](_0x5dd07d)&&_0x6db28b[_0x1acfd3(0x1e1)](_0x5dd07d,{'userId':_0x5dd07d,'username':_0x4f4824['username']||'Unknown','ladders':[],'isNonParticipant':![]});const _0x2bb138=_0x6db28b['get'](_0x5dd07d);_0x2bb138['ladders'][_0x1acfd3(0x1f2)]({'ladder':_0x2535c0,'elo':_0x4f4824['eloRating']||0x4b0,'active':_0x4f4824['active']!==![]});});};_0x4e4207(_0x375dab,'D1'),_0x4e4207(_0x3cd4ff,'D2'),_0x4e4207(_0x28ea54,'D3'),_0x3b0283['forEach'](_0x3a1c23=>{const _0x160840=_0x3dc03b,_0x1930ef=_0x3a1c23['data'](),_0x244db5=_0x3a1c23['id'];!_0x6db28b['has'](_0x244db5)&&_0x1930ef['username']&&_0x6db28b[_0x160840(0x1e1)](_0x244db5,{'userId':_0x244db5,'username':_0x1930ef[_0x160840(0x1d5)],'ladders':[],'isNonParticipant':!![]});});const _0x3fb826=[];_0x6db28b['forEach']((_0x811373,_0x483030)=>{const _0x5aed4c=_0x3dc03b,_0x50042a=_0x4366e1['get'](_0x483030)||{};let _0x2c9d8a=0x0,_0x4e4235=null;if(_0x811373['ladders']['length']>0x0){const _0x202543=_0x811373[_0x5aed4c(0x1ee)]['sort']((_0x315017,_0x3c2fb1)=>_0x3c2fb1[_0x5aed4c(0x1dd)]-_0x315017[_0x5aed4c(0x1dd)]);_0x2c9d8a=_0x202543[0x0]['elo'],_0x4e4235=_0x202543[0x0]['ladder'];}const _0x4f29b9={'userId':_0x483030,'username':_0x811373['username'],'profileImageUrl':_0x50042a['profileImageUrl']||null,'country':_0x50042a['country']||null,'motto':_0x50042a['motto']||null,'favoriteMap':_0x50042a['favoriteMap']||null,'favoriteWeapon':_0x50042a['favoriteWeapon']||null,'isNonParticipant':_0x811373['isNonParticipant'],'ladders':_0x811373['ladders'],'primaryLadder':_0x4e4235,'highestElo':_0x2c9d8a,'rank':getPlayerRank(_0x2c9d8a),'lastUpdated':admin['firestore']['FieldValue'][_0x5aed4c(0x1e2)]()};_0x3fb826['push'](_0x4f29b9);});const _0xf6f6b1=db['collection'](_0x3dc03b(0x1e0)),_0x140bd4=await _0xf6f6b1[_0x3dc03b(0x1e4)](),_0x2e1605=[];_0x140bd4['forEach'](_0x3af581=>{_0x2e1605['push'](_0x3af581['ref']['delete']());}),await Promise['all'](_0x2e1605);const _0x2217c6=0x1f4,_0x2bbd4e=[];for(let _0x1ea3f0=0x0;_0x1ea3f0<_0x3fb826['length'];_0x1ea3f0+=_0x2217c6){const _0x36b390=db['batch'](),_0x8ab116=_0x3fb826[_0x3dc03b(0x1dc)](_0x1ea3f0,_0x1ea3f0+_0x2217c6);_0x8ab116['forEach'](_0x48a5f6=>{const _0x3cad88=_0x3dc03b,_0x5881b5=_0xf6f6b1['doc'](_0x48a5f6[_0x3cad88(0x1ef)]);_0x36b390['set'](_0x5881b5,_0x48a5f6);}),_0x2bbd4e['push'](_0x36b390[_0x3dc03b(0x1e6)]());}await Promise['all'](_0x2bbd4e);}function getPlayerRank(_0x202f80){const _0x4355e4=a38_0x2bf8fd;if(_0x202f80>=0x7d0)return _0x4355e4(0x1d8);if(_0x202f80>=0x708)return _0x4355e4(0x1eb);if(_0x202f80>=0x640)return _0x4355e4(0x1e8);if(_0x202f80>=0x578)return'bronze';return'unranked';}function a38_0x2ce5(_0x58d9c3,_0x1770da){const _0x3d5548=a38_0x4e68();return a38_0x2ce5=function(_0x164d96,_0x4d321c){_0x164d96=_0x164d96-0x1d2;let _0x4e6829=_0x3d5548[_0x164d96];return _0x4e6829;},a38_0x2ce5(_0x58d9c3,_0x1770da);}exports[a38_0x2bf8fd(0x1d7)]=functions[a38_0x2bf8fd(0x1e7)]['onRequest'](async(_0x39e18f,_0x192f89)=>{const _0xd442e4=a38_0x2bf8fd;try{await rebuildMembersList(),_0x192f89[_0xd442e4(0x1ec)](0xc8)['send'](_0xd442e4(0x1df));}catch(_0x530499){console['error']('Error\x20rebuilding\x20members\x20list:',_0x530499),_0x192f89[_0xd442e4(0x1ec)](0x1f4)[_0xd442e4(0x1d9)](_0xd442e4(0x1d4));}});
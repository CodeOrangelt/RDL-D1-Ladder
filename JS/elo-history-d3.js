const a15_0x6f7851=a15_0x1b0c;(function(_0x165fbb,_0xbc41ef){const _0x161f02=a15_0x1b0c,_0x512865=_0x165fbb();while(!![]){try{const _0x48e3bb=-parseInt(_0x161f02(0x1cc))/0x1+-parseInt(_0x161f02(0x1ec))/0x2+parseInt(_0x161f02(0x1c3))/0x3+parseInt(_0x161f02(0x1e7))/0x4*(-parseInt(_0x161f02(0x1dc))/0x5)+-parseInt(_0x161f02(0x1eb))/0x6*(parseInt(_0x161f02(0x1d8))/0x7)+parseInt(_0x161f02(0x1e0))/0x8+parseInt(_0x161f02(0x1d2))/0x9;if(_0x48e3bb===_0xbc41ef)break;else _0x512865['push'](_0x512865['shift']());}catch(_0x114df3){_0x512865['push'](_0x512865['shift']());}}}(a15_0x21c1,0x8a8bb));function a15_0x21c1(){const _0x11f9af=['4063256PZWoPq','toString','winnerId','demotion','125418eFFvnK','2077868ImSJZY','(((.+)+)+)+$','error','log','docs','console','winnerUsername','Silver','map','empty','loserId','D3\x20ELO\x20history\x20recorded\x20for\x20','table','Gold','3150123FhKtOA','username','player','Error\x20fetching\x20D3\x20ELO\x20history:','promotion','timestamp','opponent','newElo','desc','1133416PlhhSi','loserUsername','apply','constructor','Unknown\x20Player','Bronze','16593093jKVOYZ','length','match','bind','Error\x20recording\x20D3\x20ELO\x20history:','playersD3','14WVqORs','search','eloHistoryD3','Emerald','5xYVkwB','size','__proto__','prototype','7229880BnLrQL','all','warn','previousElo','info','data','trace'];a15_0x21c1=function(){return _0x11f9af;};return a15_0x21c1();}const a15_0x4250f5=(function(){let _0x59c8d6=!![];return function(_0x3166df,_0x29f609){const _0x121033=_0x59c8d6?function(){if(_0x29f609){const _0xddfd1c=_0x29f609['apply'](_0x3166df,arguments);return _0x29f609=null,_0xddfd1c;}}:function(){};return _0x59c8d6=![],_0x121033;};}()),a15_0x3d0045=a15_0x4250f5(this,function(){const _0x437f53=a15_0x1b0c;return a15_0x3d0045[_0x437f53(0x1e8)]()[_0x437f53(0x1d9)]('(((.+)+)+)+$')[_0x437f53(0x1e8)]()[_0x437f53(0x1cf)](a15_0x3d0045)['search'](_0x437f53(0x1b6));});a15_0x3d0045();const a15_0x146a35=(function(){let _0x4db87e=!![];return function(_0x4d2b66,_0x54f5dc){const _0x10e1fa=_0x4db87e?function(){const _0x5770ea=a15_0x1b0c;if(_0x54f5dc){const _0x37b9f6=_0x54f5dc[_0x5770ea(0x1ce)](_0x4d2b66,arguments);return _0x54f5dc=null,_0x37b9f6;}}:function(){};return _0x4db87e=![],_0x10e1fa;};}()),a15_0x4fb185=a15_0x146a35(this,function(){const _0x4d38f6=a15_0x1b0c;let _0x8a7d21;try{const _0x347563=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x8a7d21=_0x347563();}catch(_0x363cd8){_0x8a7d21=window;}const _0x4330a8=_0x8a7d21[_0x4d38f6(0x1ba)]=_0x8a7d21[_0x4d38f6(0x1ba)]||{},_0x74e270=[_0x4d38f6(0x1b8),_0x4d38f6(0x1e2),_0x4d38f6(0x1e4),_0x4d38f6(0x1b7),'exception',_0x4d38f6(0x1c1),_0x4d38f6(0x1e6)];for(let _0x43dc86=0x0;_0x43dc86<_0x74e270[_0x4d38f6(0x1d3)];_0x43dc86++){const _0x15db56=a15_0x146a35[_0x4d38f6(0x1cf)][_0x4d38f6(0x1df)][_0x4d38f6(0x1d5)](a15_0x146a35),_0x71579f=_0x74e270[_0x43dc86],_0x4a8d6b=_0x4330a8[_0x71579f]||_0x15db56;_0x15db56[_0x4d38f6(0x1de)]=a15_0x146a35[_0x4d38f6(0x1d5)](a15_0x146a35),_0x15db56[_0x4d38f6(0x1e8)]=_0x4a8d6b[_0x4d38f6(0x1e8)][_0x4d38f6(0x1d5)](_0x4a8d6b),_0x4330a8[_0x71579f]=_0x15db56;}});a15_0x4fb185();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc,where}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D3=[{'name':a15_0x6f7851(0x1db),'elo':0x7d0},{'name':'Gold','elo':0x708},{'name':a15_0x6f7851(0x1bc),'elo':0x640},{'name':a15_0x6f7851(0x1d1),'elo':0x578},{'name':'Unranked','elo':0x4b0}];let lastVisibleD3=null;async function getUsernameByIdD3(_0x37583d){const _0x5ab468=a15_0x6f7851;try{if(!_0x37583d)return _0x5ab468(0x1d0);const _0x11982e=await getDoc(doc(db,_0x5ab468(0x1d7),_0x37583d));if(_0x11982e['exists']())return _0x11982e['data']()[_0x5ab468(0x1c4)]||_0x5ab468(0x1d0);const _0x4ae9ad=await getDocs(query(collection(db,'approvedMatchesD3'),where(_0x5ab468(0x1e9),'==',_0x37583d),limit(0x1)));if(!_0x4ae9ad[_0x5ab468(0x1be)])return _0x4ae9ad[_0x5ab468(0x1b9)][0x0][_0x5ab468(0x1e5)]()[_0x5ab468(0x1bb)]||_0x5ab468(0x1d0);const _0x41d6f1=await getDocs(query(collection(db,'approvedMatchesD3'),where(_0x5ab468(0x1bf),'==',_0x37583d),limit(0x1)));if(!_0x41d6f1['empty'])return _0x41d6f1['docs'][0x0][_0x5ab468(0x1e5)]()[_0x5ab468(0x1cd)]||_0x5ab468(0x1d0);return _0x5ab468(0x1d0);}catch(_0x36e0a5){return console[_0x5ab468(0x1b7)]('Error\x20getting\x20D3\x20username:',_0x36e0a5),_0x5ab468(0x1d0);}}export async function recordEloChangeD3({playerId:_0x359602,previousElo:_0x966220,newElo:_0x595cf1,opponentId:_0x202c0d,matchResult:_0x8b5752,previousPosition:_0x522d3d,newPosition:_0x46a077,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x26091e,timestamp:_0x1d6fbf}){const _0x377fce=a15_0x6f7851;try{const _0x2cc90f=doc(collection(db,'eloHistoryD3'));let _0x321c5d=_0x377fce(0x1d4);if(isPromotion)_0x321c5d=_0x377fce(0x1c7);if(isDemotion)_0x321c5d=_0x377fce(0x1ea);let _0xf040c8='Unranked';if(_0x595cf1>=0x7d0)_0xf040c8=_0x377fce(0x1db);else{if(_0x595cf1>=0x708)_0xf040c8=_0x377fce(0x1c2);else{if(_0x595cf1>=0x640)_0xf040c8='Silver';else{if(_0x595cf1>=0x578)_0xf040c8=_0x377fce(0x1d1);}}}return await setDoc(_0x2cc90f,{'type':_0x321c5d,'player':_0x359602,'opponent':_0x202c0d,'previousElo':_0x966220,'newElo':_0x595cf1,'change':_0x595cf1-_0x966220,'matchResult':_0x8b5752,'previousPosition':_0x522d3d,'newPosition':_0x46a077,'rankAchieved':_0xf040c8,'matchId':_0x26091e,'timestamp':_0x1d6fbf||serverTimestamp(),'gameMode':'D3'}),console[_0x377fce(0x1b8)](_0x377fce(0x1c0)+_0x359602),!![];}catch(_0x470dd7){console['error'](_0x377fce(0x1d6),_0x470dd7);throw _0x470dd7;}}function a15_0x1b0c(_0x65f998,_0x479985){const _0x203e5a=a15_0x21c1();return a15_0x1b0c=function(_0x4fb185,_0x146a35){_0x4fb185=_0x4fb185-0x1b6;let _0x2461cf=_0x203e5a[_0x4fb185];return _0x2461cf;},a15_0x1b0c(_0x65f998,_0x479985);}export async function getEloHistoryD3(_0x43a7b0=0x14){const _0xc965d2=a15_0x6f7851;try{const _0x32cd73=collection(db,_0xc965d2(0x1da));let _0x1b156f;lastVisibleD3?_0x1b156f=query(_0x32cd73,orderBy('timestamp','desc'),startAfter(lastVisibleD3),limit(_0x43a7b0)):_0x1b156f=query(_0x32cd73,orderBy('timestamp',_0xc965d2(0x1cb)),limit(_0x43a7b0));const _0x38fed3=await getDocs(_0x1b156f);if(_0x38fed3[_0xc965d2(0x1be)])return{'entries':[],'hasMore':![]};lastVisibleD3=_0x38fed3['docs'][_0x38fed3[_0xc965d2(0x1b9)][_0xc965d2(0x1d3)]-0x1];const _0x52a27a=_0x38fed3[_0xc965d2(0x1b9)][_0xc965d2(0x1bd)](async _0x2d7abf=>{const _0x34e9dd=_0xc965d2,_0x3c91e6=_0x2d7abf[_0x34e9dd(0x1e5)](),[_0x304755,_0x418d5d]=await Promise[_0x34e9dd(0x1e1)]([getUsernameByIdD3(_0x3c91e6[_0x34e9dd(0x1c5)]),getUsernameByIdD3(_0x3c91e6[_0x34e9dd(0x1c9)])]);return{..._0x3c91e6,'playerUsername':_0x304755,'opponentUsername':_0x418d5d,'change':_0x3c91e6[_0x34e9dd(0x1ca)]-_0x3c91e6[_0x34e9dd(0x1e3)],'timestamp':_0x3c91e6[_0x34e9dd(0x1c8)]};}),_0x204d64=await Promise[_0xc965d2(0x1e1)](_0x52a27a);return{'entries':_0x204d64,'hasMore':_0x38fed3[_0xc965d2(0x1dd)]===_0x43a7b0};}catch(_0x23fbe0){console['error'](_0xc965d2(0x1c6),_0x23fbe0);throw _0x23fbe0;}}export function resetPaginationD3(){lastVisibleD3=null;}
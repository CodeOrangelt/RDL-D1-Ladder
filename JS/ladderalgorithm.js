function a30_0x39ad(){const _0x2daa55=['loserUsername','pow','toString','win','doc','update','losses','all','lastUpdated','exists','docs','trace','One\x20or\x20both\x20players\x20not\x20found','loserScore','MAX_SAFE_INTEGER','round','winnerScore','apply','error','players','checkAndRecordPromotion','__proto__','data','bind','subgameType','eloRating','username','log','totalKills','position','catch'];a30_0x39ad=function(){return _0x2daa55;};return a30_0x39ad();}const a30_0x2f3abc=(function(){let _0x5a63c4=!![];return function(_0x3d8b7f,_0x166f38){const _0x25da58=_0x5a63c4?function(){const _0x25f720=a30_0x3c6b;if(_0x166f38){const _0x303a4f=_0x166f38[_0x25f720(0x1b8)](_0x3d8b7f,arguments);return _0x166f38=null,_0x303a4f;}}:function(){};return _0x5a63c4=![],_0x25da58;};}()),a30_0x1cc271=a30_0x2f3abc(this,function(){const _0x4ea33f=a30_0x3c6b;let _0x2b9c61;try{const _0x12d89a=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x2b9c61=_0x12d89a();}catch(_0x1cb081){_0x2b9c61=window;}const _0x527b3e=_0x2b9c61['console']=_0x2b9c61['console']||{},_0x217ffd=['log','warn','info','error','exception','table',_0x4ea33f(0x1b2)];for(let _0x55f306=0x0;_0x55f306<_0x217ffd['length'];_0x55f306++){const _0x15e1b6=a30_0x2f3abc['constructor']['prototype']['bind'](a30_0x2f3abc),_0x4860a0=_0x217ffd[_0x55f306],_0x461f05=_0x527b3e[_0x4860a0]||_0x15e1b6;_0x15e1b6[_0x4ea33f(0x1bc)]=a30_0x2f3abc[_0x4ea33f(0x1be)](a30_0x2f3abc),_0x15e1b6[_0x4ea33f(0x1a9)]=_0x461f05['toString'][_0x4ea33f(0x1be)](_0x461f05),_0x527b3e[_0x4860a0]=_0x15e1b6;}});a30_0x1cc271();import{collection,doc,getDoc,getDocs,updateDoc,setDoc,deleteDoc,writeBatch,query,where,serverTimestamp,addDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';import{recordEloChange}from'./elo-history.js';import{promotionManager,checkAndRecordPromotion}from'./promotions.js';import{isAdmin}from'./admin-check.js';function a30_0x3c6b(_0x448f0b,_0x6df391){const _0x1cc271=a30_0x39ad();return a30_0x3c6b=function(_0x2f3abc,_0x78a48c){_0x2f3abc=_0x2f3abc-0x1a7;let _0x39ade3=_0x1cc271[_0x2f3abc];return _0x39ade3;},a30_0x3c6b(_0x448f0b,_0x6df391);}export function calculateElo(_0x168e7c,_0x291ad1,_0x41706f=0x20){const _0x29cdb8=a30_0x3c6b,_0x33a7f4=0x1/(0x1+Math['pow'](0xa,(_0x291ad1-_0x168e7c)/0x190)),_0x5216f0=0x1/(0x1+Math[_0x29cdb8(0x1a8)](0xa,(_0x168e7c-_0x291ad1)/0x190)),_0x328c2f=_0x168e7c+_0x41706f*(0x1-_0x33a7f4),_0xaee0ce=_0x291ad1+_0x41706f*(0x0-_0x5216f0);return{'newWinnerRating':Math[_0x29cdb8(0x1b6)](_0x328c2f),'newLoserRating':Math['round'](_0xaee0ce)};}export function assignDefaultEloRating(_0x10431f,_0x52303d){const _0x129e87=a30_0x3c6b,_0x5ea3d3=0x4b0;!_0x52303d[_0x129e87(0x1c0)]&&db['collection']('players')[_0x129e87(0x1ab)](_0x10431f)['update']({'eloRating':_0x5ea3d3})['then'](()=>{const _0x27cec5=_0x129e87;console[_0x27cec5(0x1c2)]('Assigned\x20default\x20ELO\x20rating\x20to\x20player\x20'+_0x52303d[_0x27cec5(0x1c1)]);})[_0x129e87(0x1c5)](_0x230f72=>{console['error']('Error\x20assigning\x20default\x20ELO\x20rating:',_0x230f72);});}export async function updateEloRatings(_0x16ba56,_0x3f7eb9,_0x1343f1){const _0x4c618b=a30_0x3c6b;try{const _0x1f6ea5=writeBatch(db),_0x8131d1=doc(db,'players',_0x16ba56),_0x30682d=doc(db,_0x4c618b(0x1ba),_0x3f7eb9),[_0x10bc4f,_0x4c70c4]=await Promise['all']([getDoc(_0x8131d1),getDoc(_0x30682d)]);if(!_0x10bc4f['exists']()||!_0x4c70c4['exists']())throw new Error(_0x4c618b(0x1b3));const _0x1b7355=_0x10bc4f['data'](),_0x640f9d=_0x4c70c4['data'](),_0x571253=_0x1b7355[_0x4c618b(0x1c4)]||Number[_0x4c618b(0x1b5)],_0x30a0a1=_0x640f9d[_0x4c618b(0x1c4)]||Number['MAX_SAFE_INTEGER'],{newWinnerRating:_0x4eeb36,newLoserRating:_0x445a76}=calculateElo(_0x1b7355[_0x4c618b(0x1c0)]||0x4b0,_0x640f9d['eloRating']||0x4b0);let _0x583933=_0x571253,_0x379070=_0x30a0a1;if(_0x571253>_0x30a0a1){console['log']('Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked'),_0x583933=_0x30a0a1,_0x379070=_0x30a0a1+0x1;const _0x3d1b13=query(collection(db,'players'),where(_0x4c618b(0x1c4),'>',_0x30a0a1),where(_0x4c618b(0x1c4),'<',_0x571253)),_0x55322a=await getDocs(_0x3d1b13);for(const _0x185dfb of _0x55322a[_0x4c618b(0x1b1)]){_0x185dfb['id']!==_0x16ba56&&_0x185dfb['id']!==_0x3f7eb9&&_0x1f6ea5['update'](doc(db,'players',_0x185dfb['id']),{'position':_0x185dfb[_0x4c618b(0x1bd)]()[_0x4c618b(0x1c4)]+0x1});}}else console['log']('Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions');const _0x2d4942={'eloRating':_0x4eeb36,'lastMatchDate':serverTimestamp(),'position':_0x583933,'lastMatchId':_0x1343f1},_0x415b36={'eloRating':_0x445a76,'lastMatchDate':serverTimestamp(),'position':_0x379070,'lastMatchId':_0x1343f1};return _0x1f6ea5[_0x4c618b(0x1ac)](_0x8131d1,_0x2d4942),_0x1f6ea5[_0x4c618b(0x1ac)](_0x30682d,_0x415b36),await _0x1f6ea5['commit'](),console['log']('ELO\x20ratings\x20updated\x20successfully'),await Promise[_0x4c618b(0x1ae)]([recordEloChange({'playerId':_0x16ba56,'previousElo':_0x1b7355[_0x4c618b(0x1c0)]||0x4b0,'newElo':_0x4eeb36,'opponentId':_0x3f7eb9,'matchResult':_0x4c618b(0x1aa),'previousPosition':_0x571253,'newPosition':_0x583933,'isPromotion':_0x583933<_0x571253,'matchId':_0x1343f1,'timestamp':serverTimestamp()}),recordEloChange({'playerId':_0x3f7eb9,'previousElo':_0x640f9d['eloRating']||0x4b0,'newElo':_0x445a76,'opponentId':_0x16ba56,'matchResult':'loss','previousPosition':_0x30a0a1,'newPosition':_0x379070,'isDemotion':_0x379070>_0x30a0a1,'matchId':_0x1343f1,'timestamp':serverTimestamp()})]),await promotionManager[_0x4c618b(0x1bb)](_0x16ba56,_0x4eeb36,_0x1b7355['eloRating'],{'source':'match','matchId':_0x1343f1}),await promotionManager['checkAndRecordPromotion'](_0x3f7eb9,_0x445a76,_0x640f9d[_0x4c618b(0x1c0)],{'source':'match','matchId':_0x1343f1}),console['log']('ELO\x20ratings\x20and\x20positions\x20updated\x20successfully'),!![];}catch(_0x30ee8c){console[_0x4c618b(0x1b9)]('Error\x20in\x20updateEloRatings:',_0x30ee8c);throw _0x30ee8c;}}export async function approveReport(_0x3b4c65,_0x4cd2ca,_0x1756e6,_0x30fdee,_0x4f480e){const _0xb7ec53=a30_0x3c6b;try{const _0x34b0f2=doc(db,'pendingMatches',_0x3b4c65),_0x223914=await getDoc(_0x34b0f2);if(!_0x223914[_0xb7ec53(0x1b0)]())throw new Error('Report\x20not\x20found');const _0x14237d=_0x223914['data'](),_0x4ab556={..._0x14237d,'winnerScore':_0x4cd2ca,'winnerSuicides':_0x1756e6,'winnerComment':_0x30fdee,'winnerDemoLink':_0x4f480e,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':auth['currentUser']['uid']};await setDoc(doc(db,'approvedMatches',_0x3b4c65),_0x4ab556),await deleteDoc(_0x34b0f2),console['log']('Match\x20moved\x20to\x20approved\x20collection');const [_0x38b4b6,_0xd16257]=await Promise['all']([getDocs(query(collection(db,_0xb7ec53(0x1ba)),where('username','==',_0x14237d['winnerUsername']))),getDocs(query(collection(db,_0xb7ec53(0x1ba)),where('username','==',_0x14237d[_0xb7ec53(0x1a7)])))]);if(_0x38b4b6['empty']||_0xd16257['empty'])throw new Error('Could\x20not\x20find\x20player\x20documents');const _0x279ce2=_0x38b4b6['docs'][0x0]['id'],_0x13a5bf=_0xd16257['docs'][0x0]['id'];await updateEloRatings(_0x279ce2,_0x13a5bf,_0x3b4c65);try{await awardMatchPoints(_0x279ce2,_0x13a5bf,_0x14237d[_0xb7ec53(0x1bf)]);}catch(_0x5ac0cd){console['warn']('Points\x20award\x20failed,\x20but\x20match\x20approval\x20continues:',_0x5ac0cd);}return console['log']('Match\x20successfully\x20approved\x20and\x20ELO\x20updated'),!![];}catch(_0x3ab5af){console['error']('Error\x20approving\x20report:',_0x3ab5af);throw _0x3ab5af;}}async function updatePlayerElo(_0x581442,_0x243f78,_0x208591){const _0x1d9209=a30_0x3c6b;await setDoc(doc(db,_0x1d9209(0x1ba),_0x581442),{...playerData,'eloRating':_0x208591}),await checkAndRecordPromotion(_0x581442,_0x208591,_0x243f78);}async function updatePlayerStats(_0x153363,_0x3e4e3b,_0x1cd580){const _0x320d25=a30_0x3c6b,_0x75f3c9=doc(db,'playerStats',_0x153363),_0xdb11d1=await getDoc(_0x75f3c9);let _0x59d913=_0xdb11d1[_0x320d25(0x1b0)]()?_0xdb11d1['data']():{'wins':0x0,'losses':0x0,'totalKills':0x0,'totalDeaths':0x0,'winRate':0x0};_0x1cd580?(_0x59d913['wins']++,_0x59d913['totalKills']+=parseInt(_0x3e4e3b[_0x320d25(0x1b7)]||0x0),_0x59d913['totalDeaths']+=parseInt(_0x3e4e3b[_0x320d25(0x1b4)]||0x0)):(_0x59d913['losses']++,_0x59d913[_0x320d25(0x1c3)]+=parseInt(_0x3e4e3b['loserScore']||0x0),_0x59d913['totalDeaths']+=parseInt(_0x3e4e3b[_0x320d25(0x1b7)]||0x0));const _0x5f5a62=_0x59d913['wins']+_0x59d913[_0x320d25(0x1ad)];_0x59d913['winRate']=_0x5f5a62>0x0?(_0x59d913['wins']/_0x5f5a62*0x64)['toFixed'](0x1):0x0,_0x59d913[_0x320d25(0x1af)]=new Date()['toISOString'](),await setDoc(_0x75f3c9,_0x59d913,{'merge':!![]});}
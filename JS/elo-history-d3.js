function a15_0x5486(){const _0x3c8000=['exception','{}.constructor(\x22return\x20this\x22)(\x20)','error','D3\x20ELO\x20history\x20recorded\x20for\x20','match','docs','desc','prototype','Emerald','Error\x20fetching\x20D3\x20ELO\x20history:','bind','loserUsername','map','newElo','eloHistoryD3','Silver','log','data','Unknown\x20Player'];a15_0x5486=function(){return _0x3c8000;};return a15_0x5486();}const a15_0x529764=a15_0x4a60,a15_0x52b096=(function(){let _0x159c8d=!![];return function(_0x54fcaa,_0x357211){const _0x329707=_0x159c8d?function(){if(_0x357211){const _0x32d9a7=_0x357211['apply'](_0x54fcaa,arguments);return _0x357211=null,_0x32d9a7;}}:function(){};return _0x159c8d=![],_0x329707;};}()),a15_0x102179=a15_0x52b096(this,function(){const _0x88517f=a15_0x4a60,_0x19a502=function(){const _0x179747=a15_0x4a60;let _0x57cb6d;try{_0x57cb6d=Function('return\x20(function()\x20'+_0x179747(0x13c)+');')();}catch(_0x24c13a){_0x57cb6d=window;}return _0x57cb6d;},_0x4d341f=_0x19a502(),_0x289e51=_0x4d341f['console']=_0x4d341f['console']||{},_0xcbd8ce=[_0x88517f(0x14b),'warn','info','error',_0x88517f(0x13b),'table','trace'];for(let _0x5728ea=0x0;_0x5728ea<_0xcbd8ce['length'];_0x5728ea++){const _0x32f2d0=a15_0x52b096['constructor'][_0x88517f(0x142)]['bind'](a15_0x52b096),_0x326450=_0xcbd8ce[_0x5728ea],_0x3045de=_0x289e51[_0x326450]||_0x32f2d0;_0x32f2d0['__proto__']=a15_0x52b096[_0x88517f(0x145)](a15_0x52b096),_0x32f2d0['toString']=_0x3045de['toString']['bind'](_0x3045de),_0x289e51[_0x326450]=_0x32f2d0;}});function a15_0x4a60(_0x5c79b6,_0x48942b){const _0x102179=a15_0x5486();return a15_0x4a60=function(_0x52b096,_0x588777){_0x52b096=_0x52b096-0x13b;let _0x54863f=_0x102179[_0x52b096];return _0x54863f;},a15_0x4a60(_0x5c79b6,_0x48942b);}a15_0x102179();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc,where}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D3=[{'name':a15_0x529764(0x143),'elo':0x7d0},{'name':'Gold','elo':0x708},{'name':a15_0x529764(0x14a),'elo':0x640},{'name':'Bronze','elo':0x578},{'name':'Unranked','elo':0x4b0}];let lastVisibleD3=null;async function getUsernameByIdD3(_0x2b9efe){const _0x2255a5=a15_0x529764;try{if(!_0x2b9efe)return'Unknown\x20Player';const _0x5d1809=await getDoc(doc(db,'playersD3',_0x2b9efe));if(_0x5d1809['exists']())return _0x5d1809[_0x2255a5(0x14c)]()['username']||'Unknown\x20Player';const _0x25da31=await getDocs(query(collection(db,'approvedMatchesD3'),where('winnerId','==',_0x2b9efe),limit(0x1)));if(!_0x25da31['empty'])return _0x25da31['docs'][0x0]['data']()['winnerUsername']||_0x2255a5(0x14d);const _0x7e81a5=await getDocs(query(collection(db,'approvedMatchesD3'),where('loserId','==',_0x2b9efe),limit(0x1)));if(!_0x7e81a5['empty'])return _0x7e81a5['docs'][0x0][_0x2255a5(0x14c)]()[_0x2255a5(0x146)]||'Unknown\x20Player';return'Unknown\x20Player';}catch(_0x676718){return console['error']('Error\x20getting\x20D3\x20username:',_0x676718),'Unknown\x20Player';}}export async function recordEloChangeD3({playerId:_0x266948,previousElo:_0x5c4443,newElo:_0x51a067,opponentId:_0x49b411,matchResult:_0x20f35c,previousPosition:_0xdce4fd,newPosition:_0x18c1b5,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x3c551d,timestamp:_0x49eefb}){const _0x4dcb8a=a15_0x529764;try{const _0x4e910f=doc(collection(db,_0x4dcb8a(0x149)));let _0x27a1eb=_0x4dcb8a(0x13f);if(isPromotion)_0x27a1eb='promotion';if(isDemotion)_0x27a1eb='demotion';let _0x12c3fc='Unranked';if(_0x51a067>=0x7d0)_0x12c3fc='Emerald';else{if(_0x51a067>=0x708)_0x12c3fc='Gold';else{if(_0x51a067>=0x640)_0x12c3fc=_0x4dcb8a(0x14a);else{if(_0x51a067>=0x578)_0x12c3fc='Bronze';}}}return await setDoc(_0x4e910f,{'type':_0x27a1eb,'player':_0x266948,'opponent':_0x49b411,'previousElo':_0x5c4443,'newElo':_0x51a067,'change':_0x51a067-_0x5c4443,'matchResult':_0x20f35c,'previousPosition':_0xdce4fd,'newPosition':_0x18c1b5,'rankAchieved':_0x12c3fc,'matchId':_0x3c551d,'timestamp':_0x49eefb||serverTimestamp(),'gameMode':'D3'}),console['log'](_0x4dcb8a(0x13e)+_0x266948),!![];}catch(_0x28de3f){console[_0x4dcb8a(0x13d)]('Error\x20recording\x20D3\x20ELO\x20history:',_0x28de3f);throw _0x28de3f;}}export async function getEloHistoryD3(_0x68ccae=0x14){const _0x379bbb=a15_0x529764;try{const _0x8028ce=collection(db,_0x379bbb(0x149));let _0x5bc10e;lastVisibleD3?_0x5bc10e=query(_0x8028ce,orderBy('timestamp',_0x379bbb(0x141)),startAfter(lastVisibleD3),limit(_0x68ccae)):_0x5bc10e=query(_0x8028ce,orderBy('timestamp','desc'),limit(_0x68ccae));const _0x3e5539=await getDocs(_0x5bc10e);if(_0x3e5539['empty'])return{'entries':[],'hasMore':![]};lastVisibleD3=_0x3e5539['docs'][_0x3e5539[_0x379bbb(0x140)]['length']-0x1];const _0x2b198e=_0x3e5539[_0x379bbb(0x140)][_0x379bbb(0x147)](async _0x32225b=>{const _0x5280bf=_0x379bbb,_0x3f6cdd=_0x32225b[_0x5280bf(0x14c)](),[_0x56ecad,_0x441da4]=await Promise['all']([getUsernameByIdD3(_0x3f6cdd['player']),getUsernameByIdD3(_0x3f6cdd['opponent'])]);return{..._0x3f6cdd,'playerUsername':_0x56ecad,'opponentUsername':_0x441da4,'change':_0x3f6cdd[_0x5280bf(0x148)]-_0x3f6cdd['previousElo'],'timestamp':_0x3f6cdd['timestamp']};}),_0x186fc4=await Promise['all'](_0x2b198e);return{'entries':_0x186fc4,'hasMore':_0x3e5539['size']===_0x68ccae};}catch(_0x5bfb37){console['error'](_0x379bbb(0x144),_0x5bfb37);throw _0x5bfb37;}}export function resetPaginationD3(){lastVisibleD3=null;}
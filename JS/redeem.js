const a50_0x565297=a50_0x1bc2,a50_0x4e283f=(function(){let _0x3ab95a=!![];return function(_0xb79f3d,_0xef7531){const _0x546ffc=_0x3ab95a?function(){const _0x4355d2=a50_0x1bc2;if(_0xef7531){const _0x5c8476=_0xef7531[_0x4355d2(0x151)](_0xb79f3d,arguments);return _0xef7531=null,_0x5c8476;}}:function(){};return _0x3ab95a=![],_0x546ffc;};}()),a50_0x2badce=a50_0x4e283f(this,function(){const _0x829147=a50_0x1bc2,_0x149314=function(){const _0xb140f0=a50_0x1bc2;let _0x13b18a;try{_0x13b18a=Function(_0xb140f0(0x173)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x3c32db){_0x13b18a=window;}return _0x13b18a;},_0x5274d4=_0x149314(),_0x1623bc=_0x5274d4['console']=_0x5274d4['console']||{},_0x88d25f=[_0x829147(0x169),'warn','info','error','exception','table','trace'];for(let _0x1adec9=0x0;_0x1adec9<_0x88d25f[_0x829147(0x12a)];_0x1adec9++){const _0x52fc0c=a50_0x4e283f[_0x829147(0x108)][_0x829147(0x17c)]['bind'](a50_0x4e283f),_0x1cf43=_0x88d25f[_0x1adec9],_0x45a531=_0x1623bc[_0x1cf43]||_0x52fc0c;_0x52fc0c['__proto__']=a50_0x4e283f['bind'](a50_0x4e283f),_0x52fc0c['toString']=_0x45a531['toString']['bind'](_0x45a531),_0x1623bc[_0x1cf43]=_0x52fc0c;}});a50_0x2badce();import{getAuth,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{getFirestore,doc,getDoc,setDoc,updateDoc,collection,addDoc,serverTimestamp}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{clearTokenCache}from'./tokens.js';const auth=getAuth(),db=getFirestore(),THEMES={'default':{'price':0x0,'name':'Classic\x20RDL','description':'Rock\x20texture\x20with\x20a\x20sleek\x20nav\x20and\x20footer'},'purple':{'price':0x96,'name':'Purple','description':'Can\x27t\x20get\x20enough'},'cyberpunk':{'price':0x190,'name':'Yellow\x20Orange','description':'This\x20theme\x20makes\x20me\x20happy'},'emerald':{'price':0x3e8,'name':'Emerald','description':'Emerald\x20City!'},'gold':{'price':0x320,'name':'Gold','description':a50_0x565297(0x113)},'contrast':{'price':0x0,'name':a50_0x565297(0x122),'description':a50_0x565297(0x16d)},'ocean':{'price':0x12c,'name':'Blue','description':'This\x20one\x20is\x20really\x20pretty'},'volcanic':{'price':0x1f4,'name':'Red','description':'For\x20the\x20angry\x20type.'}},TOKENS={'blob01':{'price':0x1f4,'name':'Blob\x20Token\x201','description':'A\x20mysterious\x20purple\x20blob\x20token','image':'../images/tokens/blob01.gif','category':a50_0x565297(0x114)},'blob02':{'price':0x3e8,'name':'Blob\x20Token\x202','description':a50_0x565297(0x148),'image':a50_0x565297(0x170),'category':'blob'},'blob03':{'price':0x7d0,'name':a50_0x565297(0x134),'description':a50_0x565297(0x164),'image':'../images/tokens/blob03.gif','category':'blob'},'cloak':{'price':0x1f4,'name':a50_0x565297(0x115),'description':'Become\x20one\x20with\x20the\x20shadows','image':'../images/tokens/cloak.gif','category':'special'},'gauge18':{'price':0x320,'name':'R/Y/B\x20Keys','description':'Monitor\x20your\x20ship\x27s\x20energy\x20levels','image':a50_0x565297(0x141),'category':'equipment'},'fusion':{'price':0x15e,'name':'Fusion\x20Cannon','description':a50_0x565297(0x18c),'image':a50_0x565297(0x11b),'category':'weapon'},'mmissile':{'price':0x320,'name':'Mega\x20Missile','description':'Heavy\x20ordinance\x20for\x20tough\x20situations','image':a50_0x565297(0x13b),'category':'weapon'},'pbomb':{'price':0x15e,'name':'Proximity\x20Bomb','description':'Strategic\x20explosive\x20device','image':a50_0x565297(0x121),'category':'weapon'},'pwr01':{'price':0x64,'name':'Energy','description':'Enhanced\x20energy\x20generation\x20unit','image':a50_0x565297(0x126),'category':'powerup'},'pwr02':{'price':0x258,'name':'Shield\x20Orb','description':a50_0x565297(0x145),'image':a50_0x565297(0x11d),'category':'powerup'},'smissile':{'price':0x28a,'name':a50_0x565297(0x15a),'description':'Intelligent\x20targeting\x20system','image':a50_0x565297(0x160),'category':a50_0x565297(0x13e)}};let userData={'points':0x0,'inventory':[],'isAdmin':![]},storeContainer,pointsDisplay,authWarning;document['addEventListener']('DOMContentLoaded',()=>{const _0x42018=a50_0x565297;console[_0x42018(0x169)]('üè™\x20Redeem\x20store\x20initializing...'),storeContainer=document[_0x42018(0x139)]('store-content'),pointsDisplay=document['getElementById']('user-points'),authWarning=document['getElementById']('auth-warning'),initAuthListener(),buildStoreUI();});function initAuthListener(){onAuthStateChanged(auth,async _0x2434c9=>{const _0x5dedcb=a50_0x1bc2;if(_0x2434c9){console['log'](_0x5dedcb(0x150),_0x2434c9[_0x5dedcb(0x17e)]||_0x2434c9['email']);if(authWarning)authWarning['style']['display']=_0x5dedcb(0x152);if(storeContainer)storeContainer['style']['display']='block';await loadUserData(_0x2434c9),updateThemeButtons(),updateTokenButtons();}else{console['log']('‚ùå\x20User\x20not\x20authenticated');if(authWarning)authWarning['style'][_0x5dedcb(0x17d)]='block';if(storeContainer)storeContainer[_0x5dedcb(0x10f)]['display']='none';userData={'points':0x0,'inventory':[],'isAdmin':![]},window['isUserAdmin']=![];}});}async function loadUserData(_0x3177ee){const _0x293578=a50_0x565297;try{const _0x2f101f=doc(db,'userProfiles',_0x3177ee['uid']),_0x32a152=await getDoc(_0x2f101f);if(_0x32a152[_0x293578(0x13f)]()){const _0x41a09c=_0x32a152['data']();userData={'points':_0x41a09c['points']||0x0,'inventory':_0x41a09c['inventory']||[],'isAdmin':_0x41a09c['isAdmin']||![],'equippedToken':_0x41a09c[_0x293578(0x147)]||null},pointsDisplay&&(pointsDisplay['textContent']=userData['points']['toLocaleString']()),window['isUserAdmin']=userData['isAdmin'],userData['isAdmin']&&(console['log']('üëë\x20Admin\x20controls\x20enabled'),window['dispatchEvent'](new CustomEvent(_0x293578(0x15c),{'detail':{'isAdmin':!![]}}))),console['log']('User\x20data\x20loaded\x20-\x20Points:\x20'+userData['points']+',\x20Inventory:\x20'+userData['inventory'][_0x293578(0x12a)]+_0x293578(0x10b)+(userData['equippedToken']||'none'));}else await setDoc(_0x2f101f,{'points':0x0,'inventory':[],'equippedToken':null,'createdAt':serverTimestamp(),'username':_0x3177ee['displayName']||_0x3177ee['email']?.['split']('@')[0x0]||'User'}),userData={'points':0x0,'inventory':[],'isAdmin':![],'equippedToken':null},pointsDisplay&&(pointsDisplay[_0x293578(0x189)]='0'),window['isUserAdmin']=![],console['log']('New\x20user\x20profile\x20created');}catch(_0x4e70b8){console[_0x293578(0x192)](_0x293578(0x12b),_0x4e70b8);}}function a50_0x11aa(){const _0x1e0462=['var(--accent-color,\x20#2196F3)','constructor','email','sign-in-free','\x20items,\x20Equipped:\x20','code','\x20for\x20','currentUser','style','sale','ThemeSystem','‚úÖ\x20Token\x20','Only\x20the\x20best\x20get\x20this\x20one','blob','Cloaking\x20Device','Only\x20admins\x20can\x20sell\x20tokens','info','includes','theme_','price','../images/tokens/subgame/fusion.gif','background','../images/tokens/subgame/pwr02.gif','createElement','Sign\x20in\x20to\x20Purchase','[data-token]','../images/tokens/subgame/pbomb.gif','Black\x20&\x20White','Failed\x20to\x20unequip\x20token:\x20','tokens','querySelectorAll','../images/tokens/subgame/pwr01.gif','Token\x20','classList','?\x20This\x20will\x20unequip\x20your\x20current\x20token.','length','Error\x20loading\x20user\x20data:','Please\x20sign\x20in\x20to\x20purchase\x20tokens','Please\x20sign\x20in\x20to\x20equip\x20tokens','addEventListener','name','.token-equip-btn','Tokens\x20container\x20not\x20found','Need\x20','\x20Points','Blob\x20Token\x203','Theme\x20','\x20not\x20found','success','Equipped','getElementById','confirm','../images/tokens/subgame/mmissile.gif','\x20points\x20to\x20purchase\x20this\x20token','remove','weapon','exists','userProfiles','../images/tokens/gauge18.gif','Please\x20sign\x20in\x20to\x20unequip\x20tokens','cursor','forEach','Advanced\x20energy\x20storage\x20system','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22item-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22item-icon\x20theme-icon-','equippedToken','Another\x20enigmatic\x20blob\x20creature','querySelector','can-equip','Token\x20collection\x20update\x20had\x20an\x20issue,\x20but\x20purchase\x20completed:','disabled','\x20pts)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','parentNode','owned','‚úÖ\x20User\x20authenticated:','apply','none','map','image','var(--muted-color,\x20#757575)','not-allowed','\x20points\x20(50%\x20refund)','Purchase\x20processing\x20error:','token','Smart\x20Missile','Equip','adminStatusChanged','sign-in','inventory','üîÑ\x20Refreshing\x20ladder\x20to\x20show\x20equipped\x20token','../images/tokens/subgame/smissile.gif','points','isAdmin','block','The\x20final\x20blob\x20in\x20the\x20collection','message','displayLadder','equipped','tokenId','log','Apply\x20Theme','Token\x20sale\x20failed:','You\x20need\x20','You\x20can\x20see\x20better!','preventDefault','pointer','../images/tokens/blob02.gif','can-afford','Theme\x20system\x20not\x20found','return\x20(function()\x20','\x20more\x20points.','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-palette\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22item-price\x22>','RedeemStore','Purchase\x20failed.\x20Please\x20try\x20again.','closest','function','switchTheme','Purchase','prototype','display','displayName','userTokens','You\x20must\x20purchase\x20this\x20theme\x20first','Themes\x20container\x20not\x20found','data','Buy\x20for\x20','cannot-afford','add','Buy','dataset','current-theme','textContent','theme','visible','Devastating\x20fusion\x20weapon\x20technology','üîß\x20Token\x20permissions\x20issue\x20detected,\x20but\x20purchase\x20was\x20successful','You\x20already\x20own\x20the\x20','innerHTML','uid','refreshUI','error','\x20points?'];a50_0x11aa=function(){return _0x1e0462;};return a50_0x11aa();}function a50_0x1bc2(_0x35d4b8,_0x4eedab){const _0x2badce=a50_0x11aa();return a50_0x1bc2=function(_0x4e283f,_0x584457){_0x4e283f=_0x4e283f-0x107;let _0x11aa18=_0x2badce[_0x4e283f];return _0x11aa18;},a50_0x1bc2(_0x35d4b8,_0x4eedab);}function userOwnsTheme(_0x57baa2){const _0x2de92c=a50_0x565297;if(THEMES[_0x57baa2]?.['price']===0x0)return!![];return userData['inventory']['includes'](_0x2de92c(0x119)+_0x57baa2);}function userOwnsToken(_0xd1e212){return userData['inventory']['includes']('token_'+_0xd1e212);}function userHasTokenEquipped(_0x1412ea){const _0x3189fe=a50_0x565297;return userData[_0x3189fe(0x147)]===_0x1412ea;}function getEquippedToken(){const _0x2263b4=a50_0x565297;return userData[_0x2263b4(0x147)]||null;}async function purchaseTheme(_0x597d60){const _0xdf5033=a50_0x565297,_0x2513ea=auth[_0xdf5033(0x10e)];if(!_0x2513ea)return showMessage('Please\x20sign\x20in\x20to\x20purchase\x20themes','error'),![];const _0x980742=THEMES[_0x597d60];if(!_0x980742)return console['error'](_0xdf5033(0x135)+_0x597d60+_0xdf5033(0x136)),![];if(userData['points']<_0x980742[_0xdf5033(0x11a)])return showMessage('Not\x20enough\x20points.\x20You\x20need\x20'+(_0x980742[_0xdf5033(0x11a)]-userData['points'])+_0xdf5033(0x174),_0xdf5033(0x192)),![];if(userOwnsTheme(_0x597d60))return showMessage(_0xdf5033(0x18e)+_0x980742['name']+'\x20theme',_0xdf5033(0x117)),![];try{return await processPurchase(_0x597d60,_0x980742,'theme');}catch(_0x138826){return console['error']('Theme\x20purchase\x20failed:',_0x138826),showMessage(_0xdf5033(0x177),'error'),![];}}async function purchaseToken(_0x39b573){const _0x1a716a=a50_0x565297,_0x33598a=auth[_0x1a716a(0x10e)];if(!_0x33598a)return showMessage(_0x1a716a(0x12c),'error'),![];const _0x1b8212=TOKENS[_0x39b573];if(!_0x1b8212)return console['error']('Token\x20'+_0x39b573+'\x20not\x20found'),![];if(userData['points']<_0x1b8212['price'])return showMessage('Not\x20enough\x20points.\x20You\x20need\x20'+(_0x1b8212[_0x1a716a(0x11a)]-userData[_0x1a716a(0x161)])+_0x1a716a(0x174),_0x1a716a(0x192)),![];if(userOwnsToken(_0x39b573))return showMessage('You\x20already\x20own\x20the\x20'+_0x1b8212['name']+'\x20token','info'),![];try{return await processPurchase(_0x39b573,_0x1b8212,'token');}catch(_0x32966b){return console['error']('Token\x20purchase\x20failed:',_0x32966b),showMessage('Purchase\x20failed.\x20Please\x20try\x20again.','error'),![];}}async function processPurchase(_0x2e9795,_0x404cab,_0x407491){const _0x55df02=a50_0x565297,_0x27c3d0=auth['currentUser'];try{const _0x4e2426=doc(db,_0x55df02(0x140),_0x27c3d0['uid']),_0x303461=await getDoc(_0x4e2426);if(!_0x303461['exists']())return showMessage('User\x20profile\x20not\x20found','error'),![];const _0x2e4c98=_0x303461[_0x55df02(0x182)](),_0x2ee608=_0x2e4c98[_0x55df02(0x161)]||0x0,_0x224414=_0x2e4c98['inventory']||[];if(_0x2ee608<_0x404cab['price'])return showMessage('Insufficient\x20points','error'),![];if(_0x224414[_0x55df02(0x118)](_0x407491+'_'+_0x2e9795))return showMessage('You\x20already\x20own\x20this\x20'+_0x407491,'info'),![];const _0x42f68c=_0x2ee608-_0x404cab['price'],_0x197a15=[..._0x224414,_0x407491+'_'+_0x2e9795];await updateDoc(_0x4e2426,{'points':_0x42f68c,'inventory':_0x197a15,'lastPurchase':serverTimestamp()});if(_0x407491==='token')try{const _0x5da713=doc(db,_0x55df02(0x17f),_0x27c3d0[_0x55df02(0x190)]),_0x432979=await getDoc(_0x5da713);let _0x4dea74=[];_0x432979['exists']()&&(_0x4dea74=_0x432979['data']()[_0x55df02(0x124)]||[]);const _0x3784ff=new Date();_0x4dea74['push']({'tokenId':_0x2e9795,'tokenName':_0x404cab[_0x55df02(0x12f)],'tokenImage':_0x404cab['image'],'category':_0x404cab['category'],'purchasedAt':_0x3784ff,'price':_0x404cab[_0x55df02(0x11a)],'equipped':![]}),await setDoc(_0x5da713,{'userId':_0x27c3d0['uid'],'username':_0x2e4c98['username']||_0x27c3d0['displayName']||'Unknown','tokens':_0x4dea74,'lastUpdated':serverTimestamp()},{'merge':!![]}),typeof clearTokenCache==='function'&&clearTokenCache(_0x27c3d0['uid']),console['log'](_0x55df02(0x112)+_0x2e9795+'\x20saved\x20to\x20userTokens\x20collection\x20(not\x20equipped)');}catch(_0x266d36){console['warn'](_0x55df02(0x14b),_0x266d36),_0x266d36['code']==='permission-denied'?console['log'](_0x55df02(0x18d)):console['error']('Unexpected\x20token\x20error:',_0x266d36);}try{await addDoc(collection(db,'transactions'),{'userId':_0x27c3d0['uid'],'userEmail':_0x27c3d0[_0x55df02(0x109)],'itemId':_0x407491+'_'+_0x2e9795,'itemTitle':_0x404cab['name'],'price':_0x404cab['price'],'type':'purchase','category':_0x407491,'timestamp':serverTimestamp()});}catch(_0x378917){console['warn']('Transaction\x20logging\x20failed,\x20but\x20purchase\x20was\x20successful:',_0x378917);}return userData['points']=_0x42f68c,userData[_0x55df02(0x15e)]=_0x197a15,pointsDisplay&&(pointsDisplay[_0x55df02(0x189)]=userData[_0x55df02(0x161)]['toLocaleString']()),updateTokenButtons(),_0x407491===_0x55df02(0x18a)&&updateThemeButtons(),console['log']('‚úÖ\x20Purchased\x20'+_0x404cab['name']+'\x20for\x20'+_0x404cab['price']+'\x20points'),showMessage('Successfully\x20purchased\x20'+_0x404cab['name']+'!\x20Use\x20the\x20\x22Equip\x22\x20button\x20to\x20show\x20it\x20on\x20the\x20ladder.',_0x55df02(0x137)),!![];}catch(_0x414c14){console['error'](_0x55df02(0x158),_0x414c14);if(_0x414c14[_0x55df02(0x10c)]==='permission-denied')showMessage('Permission\x20denied.\x20Please\x20try\x20again\x20or\x20contact\x20support.',_0x55df02(0x192));else{if(_0x414c14['code']==='unavailable')showMessage('Service\x20temporarily\x20unavailable.\x20Please\x20try\x20again.','error');else _0x414c14['code']==='unauthenticated'?showMessage('Please\x20sign\x20in\x20again\x20to\x20complete\x20purchase.','error'):showMessage(_0x55df02(0x177),_0x55df02(0x192));}return![];}}async function equipToken(_0xeacc75){const _0x4de67e=a50_0x565297,_0xf8fef9=auth['currentUser'];if(!_0xf8fef9)return showMessage(_0x4de67e(0x12d),'error'),![];const _0x337bf5=TOKENS[_0xeacc75];if(!_0x337bf5)return console[_0x4de67e(0x192)](_0x4de67e(0x127)+_0xeacc75+'\x20not\x20found'),![];if(!userOwnsToken(_0xeacc75))return showMessage('You\x20must\x20own\x20this\x20token\x20to\x20equip\x20it','error'),![];try{const _0xa4aab3=doc(db,_0x4de67e(0x140),_0xf8fef9['uid']);await updateDoc(_0xa4aab3,{'equippedToken':_0xeacc75,'lastTokenEquip':serverTimestamp()});try{const _0x425599=doc(db,_0x4de67e(0x17f),_0xf8fef9['uid']),_0x19bfe6=await getDoc(_0x425599);if(_0x19bfe6['exists']()){const _0x10d4e6=_0x19bfe6['data'](),_0x1dbcfe=_0x10d4e6['tokens']||[],_0x32d9af=_0x1dbcfe['map'](_0x3dbf6a=>({..._0x3dbf6a,'equipped':_0x3dbf6a[_0x4de67e(0x168)]===_0xeacc75}));await updateDoc(_0x425599,{'tokens':_0x32d9af,'equippedToken':_0xeacc75,'lastUpdated':serverTimestamp()});}}catch(_0x20610a){console['warn']('Token\x20collection\x20update\x20had\x20an\x20issue,\x20but\x20equip\x20was\x20successful:',_0x20610a);}return userData['equippedToken']=_0xeacc75,typeof clearTokenCache===_0x4de67e(0x179)&&(clearTokenCache(_0xf8fef9['uid']),clearTokenCache()),setTimeout(()=>{const _0x1c8f6f=_0x4de67e;window['displayLadder']&&typeof window[_0x1c8f6f(0x166)]==='function'&&(console['log'](_0x1c8f6f(0x15f)),window['displayLadder'](!![])),window['RedeemStore']&&typeof window['RedeemStore']['refreshUI']==='function'&&window[_0x1c8f6f(0x176)][_0x1c8f6f(0x191)]();},0x1f4),console['log']('‚úÖ\x20Equipped\x20token:\x20'+_0x337bf5[_0x4de67e(0x12f)]),showMessage(_0x337bf5[_0x4de67e(0x12f)]+'\x20equipped!\x20Ladder\x20will\x20refresh\x20shortly.','success'),!![];}catch(_0x5f3c35){return console[_0x4de67e(0x192)]('Token\x20equip\x20failed:',_0x5f3c35),_0x5f3c35['code']==='permission-denied'?showMessage('Permission\x20denied.\x20Token\x20may\x20still\x20be\x20equipped\x20-\x20check\x20the\x20ladder.','warning'):showMessage('Failed\x20to\x20equip\x20token:\x20'+_0x5f3c35[_0x4de67e(0x165)],'error'),![];}}async function unequipToken(){const _0x2761b7=a50_0x565297,_0x148b6a=auth['currentUser'];if(!_0x148b6a)return showMessage(_0x2761b7(0x142),_0x2761b7(0x192)),![];if(!userData['equippedToken'])return showMessage('No\x20token\x20is\x20currently\x20equipped','info'),![];try{const _0x3ee3a1=doc(db,_0x2761b7(0x140),_0x148b6a[_0x2761b7(0x190)]);await updateDoc(_0x3ee3a1,{'equippedToken':null,'lastTokenEquip':serverTimestamp()});const _0xa78288=doc(db,_0x2761b7(0x17f),_0x148b6a['uid']),_0x305321=await getDoc(_0xa78288);if(_0x305321[_0x2761b7(0x13f)]()){const _0x2634a5=_0x305321[_0x2761b7(0x182)](),_0x35e89b=_0x2634a5['tokens']||[],_0x5bc83f=_0x35e89b[_0x2761b7(0x153)](_0x77eeee=>({..._0x77eeee,'equipped':![]}));await updateDoc(_0xa78288,{'tokens':_0x5bc83f,'equippedToken':null,'lastUpdated':serverTimestamp()});}return userData['equippedToken']=null,typeof clearTokenCache===_0x2761b7(0x179)&&(clearTokenCache(_0x148b6a['uid']),clearTokenCache()),setTimeout(()=>{const _0x233820=_0x2761b7;window['displayLadder']&&typeof window[_0x233820(0x166)]==='function'&&(console['log']('üîÑ\x20Refreshing\x20ladder\x20to\x20remove\x20unequipped\x20token'),window[_0x233820(0x166)](!![])),window[_0x233820(0x176)]&&typeof window['RedeemStore']['refreshUI']===_0x233820(0x179)&&window['RedeemStore']['refreshUI']();},0x1f4),console['log']('‚úÖ\x20Token\x20unequipped'),showMessage('Token\x20unequipped!\x20Ladder\x20will\x20refresh\x20shortly.','success'),!![];}catch(_0x382e4e){return console['error']('Token\x20unequip\x20failed:',_0x382e4e),showMessage(_0x2761b7(0x123)+_0x382e4e[_0x2761b7(0x165)],_0x2761b7(0x192)),![];}}async function sellToken(_0x513cdc){const _0x470e77=a50_0x565297,_0x2472c5=auth[_0x470e77(0x10e)];if(!_0x2472c5)return showMessage('Please\x20sign\x20in\x20to\x20sell\x20tokens','error'),![];if(!userData[_0x470e77(0x162)])return showMessage(_0x470e77(0x116),_0x470e77(0x192)),![];const _0x2846fd=TOKENS[_0x513cdc];if(!_0x2846fd)return console['error']('Token\x20'+_0x513cdc+'\x20not\x20found'),![];if(!userOwnsToken(_0x513cdc))return showMessage('You\x20don\x27t\x20own\x20this\x20token','error'),![];try{const _0x89a0d9=doc(db,'userProfiles',_0x2472c5['uid']),_0x4a05aa=await getDoc(_0x89a0d9),_0x375d77=_0x4a05aa['data'](),_0x189d28=Math['floor'](_0x2846fd[_0x470e77(0x11a)]*0.5),_0x122968=(_0x375d77['points']||0x0)+_0x189d28,_0x9568db=(_0x375d77['inventory']||[])['filter'](_0xa5af5f=>_0xa5af5f!=='token_'+_0x513cdc),_0x168e1b=_0x375d77['equippedToken']===_0x513cdc?null:_0x375d77['equippedToken'];await updateDoc(_0x89a0d9,{'points':_0x122968,'inventory':_0x9568db,'equippedToken':_0x168e1b,'lastSale':serverTimestamp()});const _0x261799=doc(db,'userTokens',_0x2472c5[_0x470e77(0x190)]),_0x463b91=await getDoc(_0x261799);if(_0x463b91['exists']()){const _0x1b3ecd=_0x463b91['data'](),_0x3b3942=_0x1b3ecd[_0x470e77(0x124)]||[],_0x53c30f=_0x3b3942['filter'](_0x3b03c0=>_0x3b03c0[_0x470e77(0x168)]!==_0x513cdc);await updateDoc(_0x261799,{'tokens':_0x53c30f,'equippedToken':_0x168e1b,'lastUpdated':serverTimestamp()});}return await addDoc(collection(db,'transactions'),{'userId':_0x2472c5['uid'],'userEmail':_0x2472c5['email'],'itemId':'token_'+_0x513cdc,'itemTitle':_0x2846fd['name'],'refund':_0x189d28,'originalPrice':_0x2846fd[_0x470e77(0x11a)],'type':_0x470e77(0x110),'category':'token','timestamp':serverTimestamp()}),userData['points']=_0x122968,userData['inventory']=_0x9568db,userData[_0x470e77(0x147)]=_0x168e1b,pointsDisplay&&(pointsDisplay['textContent']=userData['points']['toLocaleString']()),typeof clearTokenCache==='function'&&clearTokenCache(_0x2472c5[_0x470e77(0x190)]),console['log']('‚úÖ\x20Sold\x20token\x20'+_0x2846fd['name']+'\x20for\x20'+_0x189d28+'\x20points'),showMessage('Sold\x20'+_0x2846fd['name']+'\x20for\x20'+_0x189d28+_0x470e77(0x157),_0x470e77(0x137)),!![];}catch(_0x598010){return console[_0x470e77(0x192)](_0x470e77(0x16b),_0x598010),showMessage('Failed\x20to\x20sell\x20token:\x20'+_0x598010['message'],'error'),![];}}function applyTheme(_0x10aff2){const _0xbcb993=a50_0x565297;if(!userOwnsTheme(_0x10aff2))return showMessage(_0xbcb993(0x180),'error'),![];return window['ThemeSystem']?(window[_0xbcb993(0x111)][_0xbcb993(0x17a)](_0x10aff2),showMessage((THEMES[_0x10aff2]?.[_0xbcb993(0x12f)]||_0x10aff2)+'\x20theme\x20applied!','success'),!![]):(console['error'](_0xbcb993(0x172)),![]);}function buildStoreUI(){buildThemeItems(),buildTokenItems();}function buildThemeItems(){const _0x528c4b=a50_0x565297,_0x2e00be=document[_0x528c4b(0x149)]('.themes-grid');if(!_0x2e00be){console['error'](_0x528c4b(0x181));return;}_0x2e00be[_0x528c4b(0x18f)]='',Object['entries'](THEMES)[_0x528c4b(0x144)](([_0x1d7931,_0x1094ea])=>{const _0x2b7fe3=_0x528c4b,_0x1f0c7c=document['createElement']('div');_0x1f0c7c['className']='store-item',_0x1f0c7c['dataset']['theme']=_0x1d7931,_0x1f0c7c['dataset']['itemId']='theme_'+_0x1d7931,_0x1f0c7c[_0x2b7fe3(0x187)][_0x2b7fe3(0x11a)]=_0x1094ea[_0x2b7fe3(0x11a)],_0x1f0c7c[_0x2b7fe3(0x18f)]=_0x2b7fe3(0x146)+_0x1d7931+_0x2b7fe3(0x175)+(_0x1094ea['price']===0x0?'FREE':_0x1094ea['price']+'\x20Points')+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22item-title\x22>'+_0x1094ea['name']+'</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22item-description\x22>'+_0x1094ea['description']+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22theme-select-btn\x20purchase-btn\x22>Select\x20Theme</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x2e00be['appendChild'](_0x1f0c7c);}),setupThemeButtons();}function buildTokenItems(){const _0x1d866a=a50_0x565297,_0x258035=document[_0x1d866a(0x149)]('.tokens-grid');if(!_0x258035){console['error'](_0x1d866a(0x131));return;}_0x258035[_0x1d866a(0x18f)]='',Object['entries'](TOKENS)['forEach'](([_0x3df4e0,_0x58c2fe])=>{const _0xe9c637=_0x1d866a,_0x16f43e=document[_0xe9c637(0x11e)]('div');_0x16f43e['className']='store-item\x20token-item',_0x16f43e['dataset']['token']=_0x3df4e0,_0x16f43e['dataset']['itemId']='token_'+_0x3df4e0,_0x16f43e['dataset']['price']=_0x58c2fe['price'];const _0x53eb47=userData[_0xe9c637(0x162)]&&userOwnsToken(_0x3df4e0)?'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22token-sell-btn\x20admin-btn\x22\x20style=\x22margin-top:\x200.5rem;\x20background:\x20#f44336;\x20font-size:\x200.8rem;\x20padding:\x200.3rem;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Sell\x20('+Math['floor'](_0x58c2fe['price']*0.5)+_0xe9c637(0x14d):'';_0x16f43e[_0xe9c637(0x18f)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22item-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22item-icon\x20token-icon\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22'+_0x58c2fe[_0xe9c637(0x154)]+'\x22\x20alt=\x22'+_0x58c2fe['name']+'\x22\x20class=\x22token-preview\x22\x20onerror=\x22this.style.display=\x27none\x27;\x20this.nextElementSibling.style.display=\x27flex\x27;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22token-fallback\x22\x20style=\x22display:\x20none;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-coins\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22item-price\x22>'+_0x58c2fe[_0xe9c637(0x11a)]+'\x20Points</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22token-select-btn\x20purchase-btn\x22>Purchase</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22token-equip-btn\x20equip-btn\x22\x20style=\x22margin-top:\x200.5rem;\x20display:\x20none;\x22>Equip</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x53eb47+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x258035['appendChild'](_0x16f43e);}),setupTokenButtons();}function setupThemeButtons(){const _0x391155=a50_0x565297,_0x260a48=document[_0x391155(0x125)]('.theme-select-btn');_0x260a48['forEach'](_0x383093=>{_0x383093['addEventListener']('click',async _0x35a7a0=>{const _0x2caa5e=a50_0x1bc2;_0x35a7a0['preventDefault']();const _0x3b4ebd=auth['currentUser'];if(!_0x3b4ebd){showMessage('Please\x20sign\x20in\x20to\x20select\x20themes',_0x2caa5e(0x192));return;}const _0x8c64=_0x383093['closest']('[data-theme]'),_0x718e45=_0x8c64['dataset']['theme'],_0x40b6db=THEMES[_0x718e45];if(!_0x40b6db){console['error']('Theme\x20'+_0x718e45+'\x20not\x20found');return;}console['log']('Theme\x20clicked:\x20'+_0x40b6db['name']+'\x20('+_0x718e45+')');if(_0x383093[_0x2caa5e(0x14c)]){_0x40b6db['price']>0x0&&showMessage(_0x2caa5e(0x16c)+_0x40b6db['price']+'\x20points\x20to\x20purchase\x20this\x20theme','error');return;}if(_0x383093['textContent']==='Current\x20Theme'){showMessage(_0x40b6db[_0x2caa5e(0x12f)]+'\x20is\x20already\x20your\x20current\x20theme',_0x2caa5e(0x117));return;}if(_0x383093['textContent']==='Apply\x20Theme'){applyTheme(_0x718e45),updateThemeButtons();return;}if(_0x383093['textContent']['includes'](_0x2caa5e(0x186))){const _0x50273e=window['confirm']('Purchase\x20'+_0x40b6db['name']+'\x20theme\x20for\x20'+_0x40b6db[_0x2caa5e(0x11a)]+'\x20points?');if(!_0x50273e)return;const _0x3d007d=await purchaseTheme(_0x718e45);_0x3d007d&&(showMessage(_0x40b6db['name']+'\x20theme\x20purchased!','success'),applyTheme(_0x718e45),updateThemeButtons());return;}userOwnsTheme(_0x718e45)?applyTheme(_0x718e45):showMessage('You\x20must\x20purchase\x20this\x20theme\x20first',_0x2caa5e(0x192));});}),updateThemeButtons();}function setupTokenButtons(){const _0x27e141=a50_0x565297,_0x3bb8a4=document['querySelectorAll']('.token-select-btn'),_0x5a7214=document['querySelectorAll'](_0x27e141(0x130)),_0x3ce730=document[_0x27e141(0x125)]('.token-sell-btn');_0x3bb8a4['forEach'](_0x40bb34=>{const _0x4ce0b5=_0x27e141;_0x40bb34[_0x4ce0b5(0x12e)]('click',async _0x5ab321=>{const _0x29f68a=_0x4ce0b5;_0x5ab321['preventDefault']();const _0x343c40=auth['currentUser'];if(!_0x343c40){showMessage('Please\x20sign\x20in\x20to\x20purchase\x20tokens',_0x29f68a(0x192));return;}const _0x185d07=_0x40bb34['closest']('[data-token]'),_0x445c03=_0x185d07['dataset']['token'],_0x31e17d=TOKENS[_0x445c03];if(!_0x31e17d){console[_0x29f68a(0x192)](_0x29f68a(0x127)+_0x445c03+'\x20not\x20found');return;}console['log']('Token\x20clicked:\x20'+_0x31e17d['name']+'\x20('+_0x445c03+')');if(_0x40bb34['disabled']){showMessage(_0x29f68a(0x16c)+_0x31e17d['price']+_0x29f68a(0x13c),'error');return;}if(_0x40bb34['textContent']==='Owned'){showMessage(_0x29f68a(0x18e)+_0x31e17d['name']+'\x20token','info');return;}if(_0x40bb34[_0x29f68a(0x189)][_0x29f68a(0x118)](_0x29f68a(0x17b))||_0x40bb34['textContent']['includes']('Buy')){const _0x529af6=window['confirm']('Purchase\x20'+_0x31e17d['name']+'\x20token\x20for\x20'+_0x31e17d['price']+_0x29f68a(0x193));if(!_0x529af6)return;const _0x226cab=await purchaseToken(_0x445c03);_0x226cab&&updateTokenButtons();return;}});}),_0x5a7214['forEach'](_0x38a82d=>{_0x38a82d['addEventListener']('click',async _0xe8fe5e=>{const _0x5b4e3d=a50_0x1bc2;_0xe8fe5e[_0x5b4e3d(0x16e)]();const _0x1b2d79=_0x38a82d[_0x5b4e3d(0x178)]('[data-token]'),_0x5088e5=_0x1b2d79['dataset'][_0x5b4e3d(0x159)],_0x541abe=TOKENS[_0x5088e5];if(_0x38a82d[_0x5b4e3d(0x189)]===_0x5b4e3d(0x138)){const _0x517420=window['confirm']('Unequip\x20'+_0x541abe['name']+'?');if(!_0x517420)return;const _0x321b14=await unequipToken();_0x321b14&&updateTokenButtons();}else{const _0x14166e=window[_0x5b4e3d(0x13a)]('Equip\x20'+_0x541abe['name']+_0x5b4e3d(0x129));if(!_0x14166e)return;const _0x198275=await equipToken(_0x5088e5);_0x198275&&updateTokenButtons();}});}),_0x3ce730['forEach'](_0x369e2b=>{_0x369e2b['addEventListener']('click',async _0x1817d6=>{const _0x45135c=a50_0x1bc2;_0x1817d6['preventDefault']();const _0x2e056e=_0x369e2b['closest']('[data-token]'),_0x4748e2=_0x2e056e['dataset']['token'],_0x40c664=TOKENS[_0x4748e2],_0x8392b1=Math['floor'](_0x40c664['price']*0.5),_0x4d95f2=window['confirm']('Are\x20you\x20sure\x20you\x20want\x20to\x20sell\x20'+_0x40c664[_0x45135c(0x12f)]+_0x45135c(0x10d)+_0x8392b1+'\x20points?\x20This\x20cannot\x20be\x20undone.');if(!_0x4d95f2)return;const _0x259455=await sellToken(_0x4748e2);_0x259455&&updateTokenButtons();});}),updateTokenButtons();}function updateThemeButtons(){const _0x4da41b=a50_0x565297,_0x3fec32=window[_0x4da41b(0x111)]?window['ThemeSystem']['getCurrentTheme']():'default',_0xe9d6ac=auth['currentUser'];document[_0x4da41b(0x125)]('.theme-select-btn')['forEach'](_0x2bda13=>{const _0x4fa416=_0x4da41b,_0xf1d4c5=_0x2bda13['closest']('[data-theme]'),_0x38c090=_0xf1d4c5['dataset']['theme'],_0x1c9a0d=THEMES[_0x38c090];if(!_0x1c9a0d)return;_0x2bda13['disabled']=![],_0x2bda13['style']['opacity']='',_0x2bda13[_0x4fa416(0x10f)][_0x4fa416(0x143)]='pointer',_0x2bda13['classList']['remove']('current-theme','apply-theme',_0x4fa416(0x171),'cannot-afford','sign-in-free','sign-in-paid');if(!_0xe9d6ac){_0x1c9a0d['price']===0x0?(_0x2bda13['textContent']='Sign\x20in\x20to\x20Apply',_0x2bda13['classList']['add'](_0x4fa416(0x10a))):(_0x2bda13['textContent']='Sign\x20in\x20to\x20Purchase',_0x2bda13['disabled']=!![],_0x2bda13['style']['opacity']='0.7',_0x2bda13['classList']['add']('sign-in-paid'));return;}if(_0x38c090===_0x3fec32){_0x2bda13['textContent']='Current\x20Theme',_0x2bda13['classList']['add'](_0x4fa416(0x188)),_0x2bda13[_0x4fa416(0x14c)]=!![],_0x2bda13['style']['cursor']='default';return;}if(userOwnsTheme(_0x38c090)){_0x2bda13['textContent']=_0x4fa416(0x16a),_0x2bda13[_0x4fa416(0x128)][_0x4fa416(0x185)]('apply-theme');return;}if(userData['points']>=_0x1c9a0d[_0x4fa416(0x11a)]){_0x2bda13['textContent']='Buy\x20for\x20'+_0x1c9a0d[_0x4fa416(0x11a)]+_0x4fa416(0x133),_0x2bda13['classList']['add'](_0x4fa416(0x171));return;}_0x2bda13[_0x4fa416(0x189)]=_0x4fa416(0x132)+_0x1c9a0d['price']+_0x4fa416(0x133),_0x2bda13[_0x4fa416(0x128)]['add']('cannot-afford'),_0x2bda13['style']['opacity']='0.5',_0x2bda13[_0x4fa416(0x14c)]=!![],_0x2bda13[_0x4fa416(0x10f)]['cursor']=_0x4fa416(0x156);});}function updateTokenButtons(){const _0x30ca07=auth['currentUser'];document['querySelectorAll']('.token-select-btn')['forEach'](_0x3e8746=>{const _0x5a6b3c=a50_0x1bc2,_0x384e32=_0x3e8746['closest'](_0x5a6b3c(0x120)),_0x5f0281=_0x384e32['dataset']['token'],_0x37e97d=TOKENS[_0x5f0281],_0x59ee78=_0x384e32['querySelector']('.token-equip-btn'),_0x14bdde=_0x384e32['querySelector']('.token-sell-btn');if(!_0x37e97d)return;_0x3e8746['disabled']=![],_0x3e8746['style']['opacity']='',_0x3e8746[_0x5a6b3c(0x10f)]['cursor']=_0x5a6b3c(0x16f);_0x59ee78&&(_0x59ee78['style']['display']='none',_0x59ee78['disabled']=![],_0x59ee78['style']['opacity']='',_0x59ee78['classList']['remove']('equipped','can-equip'));_0x14bdde&&(_0x14bdde[_0x5a6b3c(0x10f)]['display']='none');_0x3e8746['classList']['remove']('owned','can-afford',_0x5a6b3c(0x184),'sign-in');if(!_0x30ca07){_0x3e8746['textContent']=_0x5a6b3c(0x11f),_0x3e8746['disabled']=!![],_0x3e8746['style']['opacity']='0.7',_0x3e8746['classList']['add'](_0x5a6b3c(0x15d));return;}if(userOwnsToken(_0x5f0281)){_0x3e8746['textContent']='Owned',_0x3e8746['classList'][_0x5a6b3c(0x185)](_0x5a6b3c(0x14f)),_0x3e8746[_0x5a6b3c(0x14c)]=!![],_0x3e8746['style'][_0x5a6b3c(0x143)]='default',_0x3e8746['style']['background']='var(--success-color,\x20#4CAF50)';_0x59ee78&&(_0x59ee78['style']['display']=_0x5a6b3c(0x163),userHasTokenEquipped(_0x5f0281)?(_0x59ee78['textContent']='Equipped',_0x59ee78['classList'][_0x5a6b3c(0x185)](_0x5a6b3c(0x167)),_0x59ee78['style']['background']=_0x5a6b3c(0x107),_0x59ee78['style'][_0x5a6b3c(0x143)]='pointer'):(_0x59ee78[_0x5a6b3c(0x189)]=_0x5a6b3c(0x15b),_0x59ee78[_0x5a6b3c(0x128)]['add'](_0x5a6b3c(0x14a)),_0x59ee78['style']['background']='var(--info-color,\x20#17a2b8)',_0x59ee78[_0x5a6b3c(0x10f)][_0x5a6b3c(0x143)]='pointer'));_0x14bdde&&userData['isAdmin']&&(_0x14bdde[_0x5a6b3c(0x10f)]['display']='block');return;}if(userData['points']>=_0x37e97d[_0x5a6b3c(0x11a)]){_0x3e8746['textContent']=_0x5a6b3c(0x183)+_0x37e97d['price']+'\x20Points',_0x3e8746['classList']['add'](_0x5a6b3c(0x171)),_0x3e8746['style']['background']='';return;}_0x3e8746[_0x5a6b3c(0x189)]=_0x5a6b3c(0x132)+_0x37e97d['price']+'\x20Points',_0x3e8746['classList']['add']('cannot-afford'),_0x3e8746['style']['opacity']='0.5',_0x3e8746['disabled']=!![],_0x3e8746['style']['cursor']='not-allowed',_0x3e8746['style'][_0x5a6b3c(0x11c)]=_0x5a6b3c(0x155);});}function showMessage(_0x14a7a1,_0x49d8e7=a50_0x565297(0x117)){const _0xe12327=a50_0x565297,_0x29492e=document['getElementById']('store-message');_0x29492e&&_0x29492e['remove']();const _0x1e8b51=document[_0xe12327(0x11e)]('div');_0x1e8b51['id']='store-message',_0x1e8b51['className']='store-message\x20store-message-'+_0x49d8e7,_0x1e8b51['textContent']=_0x14a7a1,document['body']['appendChild'](_0x1e8b51),requestAnimationFrame(()=>{const _0x23121b=_0xe12327;_0x1e8b51[_0x23121b(0x128)][_0x23121b(0x185)]('visible');}),setTimeout(()=>{const _0x2928dd=_0xe12327;_0x1e8b51['classList'][_0x2928dd(0x13d)](_0x2928dd(0x18b)),setTimeout(()=>{const _0x58eca2=_0x2928dd;_0x1e8b51[_0x58eca2(0x14e)]&&_0x1e8b51['remove']();},0x12c);},0xfa0);}window['RedeemStore']={'refreshUI':()=>{updateThemeButtons(),updateTokenButtons();},'checkOwnership':userOwnsTheme,'checkTokenOwnership':userOwnsToken,'applyTheme':applyTheme,'purchaseTheme':purchaseTheme,'purchaseToken':purchaseToken},console['log']('üè™\x20Redeem\x20store\x20loaded');
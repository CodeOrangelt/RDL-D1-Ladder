const a46_0x2ccdab=a46_0x5dbd,a46_0x4b7505=(function(){let _0x3af1d5=!![];return function(_0x31a9e2,_0x4b85ae){const _0x5399a5=_0x3af1d5?function(){if(_0x4b85ae){const _0x2b0ccf=_0x4b85ae['apply'](_0x31a9e2,arguments);return _0x4b85ae=null,_0x2b0ccf;}}:function(){};return _0x3af1d5=![],_0x5399a5;};}()),a46_0x4c20fb=a46_0x4b7505(this,function(){const _0x4efa38=a46_0x5dbd,_0x4fbc50=function(){const _0x2a94c6=a46_0x5dbd;let _0xc38b1c;try{_0xc38b1c=Function('return\x20(function()\x20'+_0x2a94c6(0x1c6)+');')();}catch(_0x2e96ee){_0xc38b1c=window;}return _0xc38b1c;},_0x16aa81=_0x4fbc50(),_0x242de8=_0x16aa81['console']=_0x16aa81[_0x4efa38(0x1c0)]||{},_0x29d8d3=['log',_0x4efa38(0x19d),'info','error','exception','table','trace'];for(let _0x1b4b88=0x0;_0x1b4b88<_0x29d8d3[_0x4efa38(0x1a9)];_0x1b4b88++){const _0x1ccde4=a46_0x4b7505[_0x4efa38(0x1bd)]['prototype']['bind'](a46_0x4b7505),_0x4ae50f=_0x29d8d3[_0x1b4b88],_0x569f7c=_0x242de8[_0x4ae50f]||_0x1ccde4;_0x1ccde4['__proto__']=a46_0x4b7505['bind'](a46_0x4b7505),_0x1ccde4[_0x4efa38(0x1e2)]=_0x569f7c['toString']['bind'](_0x569f7c),_0x242de8[_0x4ae50f]=_0x1ccde4;}});a46_0x4c20fb();import{collection,doc,query,where,orderBy,limit,getDocs,addDoc,getDoc,serverTimestamp,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{auth,db}from'./firebase-config.js';class PromotionManager{constructor(){const _0x46fa63=a46_0x5dbd;this[_0x46fa63(0x1c5)]=0x18,this[_0x46fa63(0x193)]=[{'threshold':0x578,'name':'Bronze','color':_0x46fa63(0x1dc)},{'threshold':0x640,'name':'Silver','color':_0x46fa63(0x1a1)},{'threshold':0x708,'name':_0x46fa63(0x183),'color':'#FFD700'},{'threshold':0x834,'name':'Emerald','color':_0x46fa63(0x1b3)}],this['bannerContainer']=null,this[_0x46fa63(0x1c3)]=0x0,this['fetchInterval']=0xea60,this[_0x46fa63(0x1be)]=null,this['usernameCache']={};}[a46_0x2ccdab(0x180)](){const _0x44afcc=a46_0x2ccdab;this['bannerContainer']=document['getElementById']('promotion-banner-container');if(!this[_0x44afcc(0x1ca)]){console[_0x44afcc(0x195)]('Promotion\x20banner\x20container\x20not\x20found');return;}this['setupBannerContainer']();const _0x287fcb='promotions_checked_'+new Date()['toDateString'](),_0x734d5d=sessionStorage['getItem'](_0x287fcb);!_0x734d5d&&(this[_0x44afcc(0x1b7)](),sessionStorage['setItem'](_0x287fcb,'true')),document['addEventListener']('visibilitychange',()=>{const _0x541c3a=_0x44afcc;document['visibilityState']===_0x541c3a(0x1c8)&&!sessionStorage[_0x541c3a(0x1b9)](_0x287fcb)&&(this['fetchRecentPromotions'](),sessionStorage['setItem'](_0x287fcb,_0x541c3a(0x1a2)));}),window[_0x44afcc(0x1b0)]('beforeunload',()=>{const _0x587a49=_0x44afcc;this[_0x587a49(0x1be)]&&clearInterval(this[_0x587a49(0x1be)]);});}[a46_0x2ccdab(0x1c9)](){const _0x21c268=a46_0x2ccdab;this[_0x21c268(0x1ca)]['innerHTML']='',this[_0x21c268(0x1ca)]['style']['display']=_0x21c268(0x182);}async['fetchRecentPromotions'](){const _0x31566c=a46_0x2ccdab;try{const _0x121208=Date['now']();if(_0x121208-this[_0x31566c(0x1c3)]<this['fetchInterval'])return;this['lastFetchTime']=_0x121208;const _0x241c68=collection(db,'eloHistory'),_0x194985=query(_0x241c68,where('type','in',['promotion',_0x31566c(0x17e)]),orderBy('timestamp',_0x31566c(0x194)),limit(0x14)),_0x200226=await getDocs(_0x194985),_0x4e1d41=[];_0x200226[_0x31566c(0x17f)](_0x60e6ba=>{const _0x334910=_0x31566c,_0x5cbdf2={'id':_0x60e6ba['id'],..._0x60e6ba[_0x334910(0x1de)]()};this['shouldShowPromotion'](_0x60e6ba['id'])&&this['isNewRankChange'](_0x5cbdf2)&&_0x4e1d41['push'](_0x5cbdf2);}),_0x4e1d41[_0x31566c(0x1a9)]>0x0&&await this['processRankChanges'](_0x4e1d41);}catch(_0x859806){console['error']('Error\x20fetching\x20promotions:',_0x859806);}}async[a46_0x2ccdab(0x1d1)](_0xfabc3f){const _0xff2edb=a46_0x2ccdab;if(_0xfabc3f['length']===0x0)return;_0xfabc3f['sort']((_0x311e62,_0x3f7f8a)=>{const _0x3438be=a46_0x5dbd,_0x104165=_0x311e62['timestamp']?.['toMillis']?.()||_0x311e62['timestamp']?.[_0x3438be(0x19b)]*0x3e8||0x0,_0x4797c1=_0x3f7f8a['timestamp']?.['toMillis']?.()||_0x3f7f8a['timestamp']?.[_0x3438be(0x19b)]*0x3e8||0x0;return _0x4797c1-_0x104165;});const _0x1de35b=this['bannerContainer'][_0xff2edb(0x19a)]['length'],_0x3d540a=0x3-_0x1de35b;if(_0x3d540a<=0x0)return;const _0x182f5d=_0xfabc3f[_0xff2edb(0x186)](0x0,_0x3d540a);for(let _0x1064bf=0x0;_0x1064bf<_0x182f5d['length'];_0x1064bf++){const _0x3ca7ec=_0x182f5d[_0x1064bf],_0x5b74bf=auth['currentUser'];try{setTimeout(()=>{const _0x357500=_0xff2edb;this[_0x357500(0x1b8)](_0x3ca7ec);},_0x1064bf*0x3e8),_0x5b74bf&&_0x3ca7ec['player']===_0x5b74bf['displayName']&&this[_0xff2edb(0x1af)](_0x3ca7ec[_0xff2edb(0x1ad)],_0x3ca7ec['rankAchieved']);}catch(_0x26a0ba){console['error']('Error\x20processing\x20rank\x20change:',_0x26a0ba);}}}['shouldShowPromotion'](_0x7f8f0c){const _0x2a133f=a46_0x2ccdab;try{const _0x430b31='promotion_'+_0x7f8f0c,_0x5b61a1=localStorage['getItem'](_0x430b31);if(_0x5b61a1){let _0x5d6926;try{_0x5d6926=JSON['parse'](_0x5b61a1);}catch(_0x227a50){return console['warn'](_0x2a133f(0x1a5)+_0x430b31+',\x20treating\x20as\x20new'),!![];}if(_0x5d6926['ignored']===!![])return console['log']('Promotion\x20'+_0x7f8f0c+'\x20is\x20permanently\x20ignored'),![];const _0x527707=Date[_0x2a133f(0x1d7)]();if(_0x5d6926['userDismissed']&&_0x527707-_0x5d6926['timestamp']<this[_0x2a133f(0x1c5)]*0x3c*0x3c*0x3e8)return console['log']('Promotion\x20'+_0x7f8f0c+'\x20was\x20dismissed\x20by\x20user\x20within\x20last\x20'+this['DISPLAY_HOURS']+'\x20hours'),![];if(_0x5d6926[_0x2a133f(0x1c4)]&&_0x527707-_0x5d6926[_0x2a133f(0x181)]<0x4*0x3c*0x3c*0x3e8)return console['log']('Promotion\x20'+_0x7f8f0c+'\x20was\x20auto-dismissed\x20within\x20last\x204\x20hours'),![];}return!![];}catch(_0x26d256){return console[_0x2a133f(0x195)]('Error\x20checking\x20promotion\x20visibility:',_0x26d256),![];}}['ignorePromotion'](_0x5ba255){const _0x23bd57=a46_0x2ccdab;try{const _0x1feed0='promotion_'+_0x5ba255;localStorage[_0x23bd57(0x1ac)](_0x1feed0,JSON['stringify']({'timestamp':Date[_0x23bd57(0x1d7)](),'ignored':!![]}));}catch(_0x182dd7){console['error']('Error\x20saving\x20promotion\x20preference:',_0x182dd7);}}['showRankChangeBanner'](_0x2e2dea){this['resolveUserId'](_0x2e2dea)['then'](_0x29bb22=>{const _0x11fce1=a46_0x5dbd,_0x6a9683='promotion_'+_0x2e2dea['id'],_0x585e7a=localStorage['getItem'](_0x6a9683);if(_0x585e7a)try{const _0x59ed76=JSON['parse'](_0x585e7a);if(_0x59ed76['ignored']===!![]){console['log'](_0x11fce1(0x1c2)+_0x2e2dea['id']);return;}}catch(_0x24d569){}localStorage[_0x11fce1(0x1ac)](_0x6a9683,JSON[_0x11fce1(0x1a0)]({'timestamp':Date[_0x11fce1(0x1d7)](),'ignored':![],'userDismissed':![],'systemDismissed':![],'seenAt':Date['now']()})),this['bannerContainer']['style']['display']='block';while(this['bannerContainer'][_0x11fce1(0x19a)][_0x11fce1(0x1a9)]>=0x3){this[_0x11fce1(0x1ca)]['removeChild'](this[_0x11fce1(0x1ca)][_0x11fce1(0x1cd)]);}const _0x4ecd1a=document['createElement']('div');_0x4ecd1a['className']='promotion-banner',_0x4ecd1a[_0x11fce1(0x18b)]('data-rank',_0x29bb22['rankAchieved']),_0x4ecd1a['setAttribute']('data-id',_0x29bb22['id']);const _0x24b10a=document['createElement'](_0x11fce1(0x1c7));_0x24b10a['className']='promotion-details';const _0x857121=_0x29bb22['resolvedName']||_0x29bb22['player']||_0x29bb22['username']||_0x29bb22['playerUsername']||_0x29bb22['displayName']||'A\x20player',_0x57f8ee=_0x29bb22['type']==='promotion'?_0x857121+'\x20was\x20promoted\x20to':_0x857121+'\x20was\x20demoted\x20to';_0x24b10a[_0x11fce1(0x1bf)]=_0x57f8ee+'\x20<span\x20class=\x22rank-text\x22>'+_0x29bb22[_0x11fce1(0x189)]+_0x11fce1(0x1df);const _0x67ce8c=document[_0x11fce1(0x1bc)]('div');_0x67ce8c['className']='banner-actions';const _0x387c94=document[_0x11fce1(0x1bc)]('button');_0x387c94[_0x11fce1(0x1dd)]='dismiss-btn',_0x387c94['innerHTML']='&times;',_0x387c94[_0x11fce1(0x199)]='Dismiss';const _0xca1f45=document['createElement'](_0x11fce1(0x1cb));_0xca1f45['className']='ignore-btn',_0xca1f45['textContent']=_0x11fce1(0x1aa),_0xca1f45['title']=_0x11fce1(0x1bb),_0x67ce8c['appendChild'](_0xca1f45),_0x67ce8c['appendChild'](_0x387c94),_0x4ecd1a['appendChild'](_0x24b10a),_0x4ecd1a[_0x11fce1(0x18d)](_0x67ce8c),this['bannerContainer'][_0x11fce1(0x18d)](_0x4ecd1a),void _0x4ecd1a[_0x11fce1(0x19c)],setTimeout(()=>{const _0x4be4b7=_0x11fce1;_0x4ecd1a['classList'][_0x4be4b7(0x1ab)]('new-rank-change');},0x32),_0x387c94['addEventListener']('click',()=>{const _0x4fbae9=_0x11fce1;localStorage[_0x4fbae9(0x1ac)](_0x6a9683,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':!![],'systemDismissed':![]})),_0x4ecd1a['classList']['remove'](_0x4fbae9(0x1b5)),_0x4ecd1a['classList']['add']('dismissing'),setTimeout(()=>{const _0x1bec92=_0x4fbae9;_0x4ecd1a[_0x1bec92(0x1a3)]&&(_0x4ecd1a['remove'](),this['bannerContainer'][_0x1bec92(0x19a)]['length']===0x0&&(this[_0x1bec92(0x1ca)][_0x1bec92(0x19f)]['display']='none'));},0x1f4);}),_0xca1f45[_0x11fce1(0x1b0)](_0x11fce1(0x1b6),()=>{const _0x1bea3c=_0x11fce1;localStorage['setItem'](_0x6a9683,JSON['stringify']({'timestamp':Date['now'](),'ignored':!![],'userDismissed':!![],'systemDismissed':![]})),_0x4ecd1a['classList']['remove']('new-rank-change'),_0x4ecd1a['classList']['add'](_0x1bea3c(0x1cf)),setTimeout(()=>{const _0x11cf8f=_0x1bea3c;_0x4ecd1a['parentNode']&&(_0x4ecd1a['remove'](),this['bannerContainer']['children']['length']===0x0&&(this[_0x11cf8f(0x1ca)]['style']['display']='none'));},0x1f4);}),setTimeout(()=>{const _0x23d182=_0x11fce1;_0x4ecd1a['parentNode']&&(_0x4ecd1a['classList']['remove'](_0x23d182(0x1b5)),_0x4ecd1a[_0x23d182(0x187)]['add']('dismissing'),localStorage[_0x23d182(0x1ac)](_0x6a9683,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':!![]})),setTimeout(()=>{const _0x114d79=_0x23d182;_0x4ecd1a[_0x114d79(0x1a3)]&&(_0x4ecd1a['remove'](),this[_0x114d79(0x1ca)]['children'][_0x114d79(0x1a9)]===0x0&&(this['bannerContainer']['style'][_0x114d79(0x1b1)]='none'));},0x1f4));},0x3a98);});}async['resolveUserId'](_0x2f9013){const _0x2722e5=a46_0x2ccdab,_0x405a1f={..._0x2f9013},_0x389f88=[_0x2f9013['player'],_0x2f9013['username'],_0x2f9013[_0x2722e5(0x1e0)],_0x2f9013['displayName']],_0x45a69c=_0x389f88['some'](_0xa1484=>_0xa1484&&typeof _0xa1484==='string'&&!_0xa1484['includes'](_0x2722e5(0x17d))&&!/^[a-zA-Z0-9]{20,}$/['test'](_0xa1484));if(_0x45a69c)return _0x405a1f;let _0x451035=null;if(_0x2f9013['userId'])_0x451035=_0x2f9013['userId'];else _0x2f9013[_0x2722e5(0x19e)]&&/^[A-Za-z0-9]{20,}$/['test'](_0x2f9013['player'])&&(_0x451035=_0x2f9013['player']);if(!_0x451035)return _0x405a1f;try{const _0x317568=await getDoc(doc(db,_0x2722e5(0x1db),_0x451035));if(_0x317568['exists']()){const _0x3bd821=_0x317568[_0x2722e5(0x1de)]();if(_0x3bd821['username'])return _0x405a1f['resolvedName']=_0x3bd821['username'],_0x405a1f;}const _0x2b3fc6=await getDocs(query(collection(db,_0x2722e5(0x18e)),where('winnerId','==',_0x451035),orderBy('date','desc'),limit(0x1)));if(!_0x2b3fc6[_0x2722e5(0x190)]){const _0x11f4ef=_0x2b3fc6[_0x2722e5(0x1d5)][0x0]['data']();if(_0x11f4ef['winnerUsername'])return _0x405a1f[_0x2722e5(0x197)]=_0x11f4ef['winnerUsername'],_0x405a1f;}const _0xb29b7f=await getDocs(query(collection(db,'approvedMatches'),where('loserId','==',_0x451035),orderBy('date','desc'),limit(0x1)));if(!_0xb29b7f['empty']){const _0xdbc8f6=_0xb29b7f['docs'][0x0]['data']();if(_0xdbc8f6['loserUsername'])return _0x405a1f['resolvedName']=_0xdbc8f6[_0x2722e5(0x1ce)],console[_0x2722e5(0x1c1)](_0x2722e5(0x196)+_0x451035+'\x20to\x20'+_0xdbc8f6['loserUsername']+'\x20(loser)'),_0x405a1f;}}catch(_0x3ab358){console['error'](_0x2722e5(0x1ae),_0x3ab358);}return console['warn'](_0x2722e5(0x18f)+_0x451035),_0x405a1f;}['showRankChangeLightbox'](_0x4895ba,_0x30e9bb){const _0x3cc1b9=a46_0x2ccdab;let _0x542288=document[_0x3cc1b9(0x198)](_0x3cc1b9(0x1a6));!_0x542288&&(_0x542288=document['createElement']('div'),_0x542288['id']='rankChangeModal',_0x542288['className']='rank-change-modal\x20'+_0x4895ba,document['body']['appendChild'](_0x542288));const _0x173e99=_0x4895ba===_0x3cc1b9(0x1e1)?'Congratulations!':'Rank\x20Update',_0x2750d7=_0x4895ba===_0x3cc1b9(0x1e1)?'You\x27ve\x20been\x20promoted\x20to':_0x3cc1b9(0x188);_0x542288['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rank-change-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2\x20class=\x22rank-change-title\x22>'+_0x173e99+'</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>'+_0x2750d7+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22rank-name\x22>'+_0x30e9bb+'</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22rank-change-button\x22\x20id=\x22rank-change-ok-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Got\x20it!\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x542288['style'][_0x3cc1b9(0x1b1)]=_0x3cc1b9(0x1a4),document[_0x3cc1b9(0x198)]('rank-change-ok-btn')['addEventListener']('click',()=>{_0x542288['style']['display']='none';}),_0x542288['addEventListener']('click',_0x4c607c=>{_0x4c607c['target']===_0x542288&&(_0x542288['style']['display']='none');});}async['checkAndRecordPromotion'](_0x4d358d,_0x38cb84,_0x31c2bb,_0x33b494={}){const _0x71c054=a46_0x2ccdab;try{if(_0x38cb84===_0x31c2bb||!_0x4d358d)return null;const _0x7065df=_0x33b494[_0x71c054(0x1a7)]||'automatic',_0x530bcf=_0x33b494['matchId']||null,_0xe70724=_0x33b494[_0x71c054(0x1b4)]||null;console[_0x71c054(0x1c1)]('Processing\x20potential\x20rank\x20change:\x20'+_0x31c2bb+'\x20→\x20'+_0x38cb84+'\x20(source:\x20'+_0x7065df+')');let _0x3c73a2=null,_0x4e1753=null;try{const _0x19655e=await getDoc(doc(db,'players',_0x4d358d));if(_0x19655e['exists']()){const _0x1938e9=_0x19655e['data']();_0x3c73a2=_0x1938e9['username']||_0x1938e9[_0x71c054(0x184)]||null,_0x4e1753=_0x1938e9[_0x71c054(0x184)]||_0x1938e9[_0x71c054(0x18c)]||null;}!_0x3c73a2&&_0x33b494['username']&&(_0x3c73a2=_0x33b494['username'],_0x4e1753=_0x33b494['username']);!_0x3c73a2&&auth['currentUser']&&(_0x3c73a2=auth['currentUser']['displayName']||auth['currentUser']['email'][_0x71c054(0x1a8)]('@')[0x0],_0x4e1753=auth[_0x71c054(0x192)][_0x71c054(0x184)]||null);if(!_0x3c73a2){const _0x539a01=query(collection(db,'approvedMatches'),where(_0x71c054(0x18a),'==',_0x4d358d),limit(0x1)),_0x4be848=await getDocs(_0x539a01);if(!_0x4be848['empty'])_0x3c73a2=_0x4be848['docs'][0x0]['data']()['winnerUsername']||'Unknown\x20Player',_0x4e1753=_0x3c73a2;else{const _0x510368=query(collection(db,_0x71c054(0x18e)),where('loserId','==',_0x4d358d),limit(0x1)),_0x570795=await getDocs(_0x510368);!_0x570795[_0x71c054(0x190)]&&(_0x3c73a2=_0x570795[0x0]['data']()['loserUsername']||_0x71c054(0x191),_0x4e1753=_0x3c73a2);}}}catch(_0x58d35f){console[_0x71c054(0x195)](_0x71c054(0x1da),_0x58d35f);}!_0x3c73a2&&(console['warn']('Could\x20not\x20resolve\x20username\x20for\x20userId:',_0x4d358d),_0x3c73a2='A\x20player',_0x4e1753='Unknown\x20Player');const _0x30bfc3=this['getRankName'](_0x31c2bb),_0x5202cb=this['getRankName'](_0x38cb84);if(_0x30bfc3!==_0x5202cb){const _0x5731b6=_0x38cb84>_0x31c2bb,_0x1d543a=_0x5731b6?'promotion':'demotion',_0x1c6931=_0x5202cb;console[_0x71c054(0x1c1)](_0x71c054(0x1cc)+_0x1d543a+'\x20for\x20'+_0x3c73a2+':\x20'+_0x31c2bb+'\x20('+_0x30bfc3+')\x20→\x20'+_0x38cb84+'\x20('+_0x5202cb+')');try{const _0x1d8ae7={'player':_0x3c73a2,'playerUsername':_0x3c73a2,'username':_0x3c73a2,'displayName':_0x4e1753,'userId':_0x4d358d,'type':_0x1d543a,'rankAchieved':_0x1c6931,'timestamp':serverTimestamp(),'previousElo':_0x31c2bb,'newElo':_0x38cb84,'change':_0x38cb84-_0x31c2bb,'previousRank':_0x30bfc3,'newRank':_0x5202cb,'source':_0x7065df};if(_0x7065df==='match'&&_0x530bcf)_0x1d8ae7['matchId']=_0x530bcf;else _0x7065df==='admin'&&_0xe70724?(_0x1d8ae7['modifiedBy']=_0xe70724,_0x1d8ae7['isAutomatic']=![]):_0x1d8ae7['isAutomatic']=!![];const _0x554f64=writeBatch(db),_0x450e33=doc(collection(db,_0x71c054(0x1d6))),_0x188f58=doc(collection(db,'promotionHistory'));return _0x554f64[_0x71c054(0x1d4)](_0x450e33,_0x1d8ae7),_0x554f64[_0x71c054(0x1d4)](_0x188f58,_0x1d8ae7),await _0x554f64['commit'](),await this[_0x71c054(0x1d3)](_0x4d358d,_0x3c73a2,_0x31c2bb,_0x38cb84,_0x30bfc3,_0x5202cb,_0x1d543a,{'displayName':_0x4e1753,'source':_0x7065df,'matchId':_0x530bcf,'ladder':_0x33b494['ladder']||'D1'}),console[_0x71c054(0x1c1)](_0x71c054(0x1b2)+_0x1d543a+'\x20for\x20'+_0x3c73a2+'\x20to\x20'+_0x1c6931),_0x1c6931;}catch(_0x5cb74c){console['error']('Error\x20writing\x20promotion\x20records:',_0x5cb74c);try{return await addDoc(collection(db,'eloHistory'),{'player':_0x3c73a2,'playerUsername':_0x3c73a2,'username':_0x3c73a2,'displayName':_0x4e1753,'userId':_0x4d358d,'type':_0x1d543a,'rankAchieved':_0x1c6931,'timestamp':serverTimestamp(),'previousElo':_0x31c2bb,'newElo':_0x38cb84,'change':_0x38cb84-_0x31c2bb,'previousRank':_0x30bfc3,'source':_0x7065df,'isAutomatic':_0x7065df!=='admin'}),await this[_0x71c054(0x1d3)](_0x4d358d,_0x3c73a2,_0x31c2bb,_0x38cb84,_0x30bfc3,_0x5202cb,_0x1d543a,{'displayName':_0x4e1753,'source':_0x7065df,'matchId':_0x530bcf,'ladder':_0x33b494['ladder']||'D1'}),_0x1c6931;}catch(_0x52690d){return console['error']('Fallback\x20write\x20failed:',_0x52690d),null;}}}return null;}catch(_0x15f5b8){return console['error']('Error\x20in\x20promotion/demotion\x20recording:',_0x15f5b8),null;}}[a46_0x2ccdab(0x185)](_0x349da2){const _0x1adce7=a46_0x2ccdab;for(let _0x12d717=this['RANKS'][_0x1adce7(0x1a9)]-0x1;_0x12d717>=0x0;_0x12d717--){if(_0x349da2>=this[_0x1adce7(0x193)][_0x12d717]['threshold'])return this[_0x1adce7(0x193)][_0x12d717][_0x1adce7(0x1d9)];}return'Unranked';}['cleanup'](){this['pollingInterval']&&clearInterval(this['pollingInterval']);}['isNewRankChange'](_0x1f42ed){const _0x230b4=a46_0x2ccdab;if(_0x1f42ed['timestamp']){const _0x219e2b=_0x1f42ed['timestamp']['seconds']*0x3e8,_0x366d8e=Date['now'](),_0x30395f=(_0x366d8e-_0x219e2b)/(0x3e8*0x3c*0x3c);if(_0x30395f>0x18)return![];}if(_0x1f42ed['previousRank']&&_0x1f42ed['newRank']&&_0x1f42ed[_0x230b4(0x1d2)]!==_0x1f42ed['newRank'])return!![];return![];}async['sendPromotionNotification'](_0x188f6b,_0x187854,_0x40486,_0x1bd0fa,_0xe9b066,_0x7476d1,_0x208047,_0x24294c={}){const _0x4ff11b=a46_0x2ccdab;try{console['log']('STARTING\x20notification\x20for\x20'+_0x187854+'\x27s\x20'+_0x208047);const _0x481e88={'userId':_0x188f6b,'username':_0x187854,'displayName':_0x24294c[_0x4ff11b(0x184)]||_0x187854,'oldElo':parseInt(_0x40486),'newElo':parseInt(_0x1bd0fa),'eloDifference':parseInt(_0x1bd0fa)-parseInt(_0x40486),'oldRank':_0xe9b066,'newRank':_0x7476d1,'type':_0x208047,'timestamp':serverTimestamp(),'processed':![],'source':_0x24294c['source']||'automatic','matchId':_0x24294c['matchId']||null,'ladder':_0x24294c[_0x4ff11b(0x1ba)]||'D1','adminUser':_0x24294c['adminUser']||null};console[_0x4ff11b(0x1c1)]('Creating\x20Discord\x20notification:',_0x481e88);const _0x45d736=await addDoc(collection(db,'promotionNotifications'),_0x481e88);return console[_0x4ff11b(0x1c1)](_0x4ff11b(0x1d8)+_0x45d736['id']),!![];}catch(_0x5a1816){return console['error'](_0x4ff11b(0x1d0),_0x5a1816),![];}}}export const promotionManager=new PromotionManager();document['addEventListener']('DOMContentLoaded',()=>{promotionManager['initialize']();});export const initializePromotionTracker=()=>promotionManager['initialize']();export const checkAndRecordPromotion=(_0x352a84,_0x23ddfe,_0x4ad421,_0x1924b3)=>promotionManager['checkAndRecordPromotion'](_0x352a84,_0x23ddfe,_0x4ad421,_0x1924b3);function a46_0x3288(){const _0x2bf88d=['ID:','demotion','forEach','initialize','timestamp','none','Gold','displayName','getRankName','slice','classList','You\x27ve\x20been\x20demoted\x20to','rankAchieved','winnerId','setAttribute','username','appendChild','approvedMatches','Failed\x20to\x20resolve\x20user\x20ID:\x20','empty','Unknown\x20Player','currentUser','RANKS','desc','error','Resolved\x20','resolvedName','getElementById','title','children','seconds','offsetWidth','warn','player','style','stringify','#C0C0C0','true','parentNode','flex','Invalid\x20storage\x20format\x20for\x20','rankChangeModal','source','split','length','Don\x27t\x20show\x20again','add','setItem','type','Error\x20resolving\x20user\x20ID:','showRankChangeLightbox','addEventListener','display','Successfully\x20recorded\x20','#50C878','adminUser','new-rank-change','click','fetchRecentPromotions','showRankChangeBanner','getItem','ladder','Never\x20show\x20this\x20promotion\x20again','createElement','constructor','pollingInterval','innerHTML','console','log','Skipping\x20ignored\x20promotion:\x20','lastFetchTime','systemDismissed','DISPLAY_HOURS','{}.constructor(\x22return\x20this\x22)(\x20)','div','visible','setupBannerContainer','bannerContainer','button','Recording\x20','firstChild','loserUsername','dismissing','Error\x20sending\x20Discord\x20notification:','processRankChanges','previousRank','sendPromotionNotification','set','docs','eloHistory','now','Discord\x20notification\x20sent\x20successfully\x20with\x20ID:\x20','name','Error\x20resolving\x20username:','players','#CD7F32','className','data','</span>','playerUsername','promotion','toString'];a46_0x3288=function(){return _0x2bf88d;};return a46_0x3288();}function a46_0x5dbd(_0x3fe3d8,_0x1cc3c4){const _0x4c20fb=a46_0x3288();return a46_0x5dbd=function(_0x4b7505,_0x5a3ba9){_0x4b7505=_0x4b7505-0x17d;let _0x328829=_0x4c20fb[_0x4b7505];return _0x328829;},a46_0x5dbd(_0x3fe3d8,_0x1cc3c4);}export const getRankName=_0x1913b7=>promotionManager['getRankName'](_0x1913b7);
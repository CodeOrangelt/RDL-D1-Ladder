const a41_0x28e7da=(function(){let _0x22bfec=!![];return function(_0x1e29a7,_0x18d684){const _0x35d049=_0x22bfec?function(){if(_0x18d684){const _0x3cd354=_0x18d684['apply'](_0x1e29a7,arguments);return _0x18d684=null,_0x3cd354;}}:function(){};return _0x22bfec=![],_0x35d049;};}()),a41_0x90a28=a41_0x28e7da(this,function(){const _0x22c332=a41_0xf78b;let _0x3ad7e2;try{const _0xcc7afd=Function(_0x22c332(0x8a)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x3ad7e2=_0xcc7afd();}catch(_0x275140){_0x3ad7e2=window;}const _0x1b95e3=_0x3ad7e2[_0x22c332(0x8d)]=_0x3ad7e2[_0x22c332(0x8d)]||{},_0x5c5d20=['log','warn','info','error','exception',_0x22c332(0x83),'trace'];for(let _0x59b12b=0x0;_0x59b12b<_0x5c5d20['length'];_0x59b12b++){const _0x19923c=a41_0x28e7da['constructor']['prototype']['bind'](a41_0x28e7da),_0xcfe76d=_0x5c5d20[_0x59b12b],_0x18762f=_0x1b95e3[_0xcfe76d]||_0x19923c;_0x19923c[_0x22c332(0x82)]=a41_0x28e7da[_0x22c332(0x89)](a41_0x28e7da),_0x19923c['toString']=_0x18762f[_0x22c332(0x86)]['bind'](_0x18762f),_0x1b95e3[_0xcfe76d]=_0x19923c;}});a41_0x90a28();import{db}from'./firebase-config.js';import{doc,getDoc,updateDoc,addDoc,collection,serverTimestamp}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const POINTS_CHART={'':0xa,'Standard':0xa,'Fusion\x20Match':0x19,'â‰¥6\x20Missiles':0xa,'Weapon\x20Imbalance':0x1e,'Blind\x20Match':0x4b,'Rematch':0x14,'Disorientation':0x32,'Ratting':0x23,'Altered\x20Powerups':0x23,'Mega\x20Match':0x28,'Dogfight':0x32,'Gauss\x20and\x20Mercs':0x19,'Misc':0x1e};function a41_0x3d14(){const _0x574217=['error','Added\x20','User\x20profile\x20not\x20found\x20for\x20','__proto__','table','Unknown\x20User','points','toString','\x20points\x20to\x20both\x20players\x20for\x20','Match\x20points:\x20','bind','return\x20(function()\x20','username','log','console','all','unknown'];a41_0x3d14=function(){return _0x574217;};return a41_0x3d14();}let adminModifyUserPoints=null;try{const adminModule=await import('./adminbackend.js');adminModule['modifyUserPoints']&&(adminModifyUserPoints=adminModule['modifyUserPoints'],console['log']('Admin\x20points\x20service\x20connected'));}catch(a41_0x58b35c){console['log']('Admin\x20backend\x20not\x20available,\x20using\x20fallback\x20points\x20service');}export async function awardMatchPoints(_0x56eb6f,_0x4ed456,_0x116f2d){const _0x3dcb70=a41_0xf78b;try{const _0x1de101=POINTS_CHART[_0x116f2d]||0xa;return adminModifyUserPoints?await Promise['all']([adminModifyUserPoints(_0x56eb6f,'add',_0x1de101,_0x3dcb70(0x88)+(_0x116f2d||'Standard')+'\x20match\x20(Winner)'),adminModifyUserPoints(_0x4ed456,'add',_0x1de101,'Match\x20points:\x20'+(_0x116f2d||'Standard')+'\x20match\x20(Participant)')]):await Promise[_0x3dcb70(0x8e)]([addPointsFallback(_0x56eb6f,_0x1de101,'Match\x20points:\x20'+(_0x116f2d||'Standard')+'\x20match\x20(Winner)'),addPointsFallback(_0x4ed456,_0x1de101,_0x3dcb70(0x88)+(_0x116f2d||'Standard')+'\x20match\x20(Participant)')]),console['log']('Awarded\x20'+_0x1de101+_0x3dcb70(0x87)+(_0x116f2d||'Standard')+'\x20match'),!![];}catch(_0x3eb5af){return console[_0x3dcb70(0x7f)]('Error\x20awarding\x20match\x20points:',_0x3eb5af),![];}}function a41_0xf78b(_0x860208,_0x417e96){const _0x90a28=a41_0x3d14();return a41_0xf78b=function(_0x28e7da,_0x2703b0){_0x28e7da=_0x28e7da-0x7f;let _0x3d148e=_0x90a28[_0x28e7da];return _0x3d148e;},a41_0xf78b(_0x860208,_0x417e96);}async function addPointsFallback(_0x1d9e50,_0x493128,_0x4243a6=''){const _0x249193=a41_0xf78b;try{const _0x358bab=doc(db,'userProfiles',_0x1d9e50),_0x2cc2f8=await getDoc(_0x358bab);if(!_0x2cc2f8['exists']()){console[_0x249193(0x8c)](_0x249193(0x81)+_0x1d9e50+',\x20skipping\x20points\x20award');return;}const _0x4f5dd0=_0x2cc2f8['data'](),_0x179802=_0x4f5dd0[_0x249193(0x85)]||0x0,_0x44e691=_0x179802+_0x493128;await updateDoc(_0x358bab,{'points':_0x44e691,'lastPointsModified':serverTimestamp()}),await addDoc(collection(db,'pointsHistory'),{'userId':_0x1d9e50,'userEmail':_0x4f5dd0['email']||_0x249193(0x8f),'displayName':_0x4f5dd0['displayName']||_0x4f5dd0[_0x249193(0x8b)]||_0x249193(0x84),'action':'add','amount':_0x493128,'previousPoints':_0x179802,'newPoints':_0x44e691,'reason':_0x4243a6,'adminEmail':'system-match-award','timestamp':serverTimestamp()}),console['log'](_0x249193(0x80)+_0x493128+'\x20points\x20to\x20user\x20'+_0x1d9e50+'.\x20New\x20total:\x20'+_0x44e691);}catch(_0x7aa041){console['error']('Error\x20adding\x20points\x20to\x20user:',_0x7aa041);throw _0x7aa041;}}
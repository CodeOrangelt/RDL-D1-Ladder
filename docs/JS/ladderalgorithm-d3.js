(function(_0x5a9a41,_0x5d42e7){const _0x555793=a0_0x2024,_0x47242d=_0x5a9a41();while(!![]){try{const _0x252b86=-parseInt(_0x555793(0x1bb))/0x1*(parseInt(_0x555793(0x1c5))/0x2)+parseInt(_0x555793(0x1c8))/0x3+-parseInt(_0x555793(0x1c4))/0x4*(parseInt(_0x555793(0x1b3))/0x5)+parseInt(_0x555793(0x1d5))/0x6+parseInt(_0x555793(0x1d3))/0x7*(parseInt(_0x555793(0x1c0))/0x8)+-parseInt(_0x555793(0x1d0))/0x9*(parseInt(_0x555793(0x1b5))/0xa)+-parseInt(_0x555793(0x1cd))/0xb*(parseInt(_0x555793(0x1c2))/0xc);if(_0x252b86===_0x5d42e7)break;else _0x47242d['push'](_0x47242d['shift']());}catch(_0x4491fa){_0x47242d['push'](_0x47242d['shift']());}}}(a0_0x51c1,0x42b39));const a0_0x268017=(function(){let _0x1eec61=!![];return function(_0x19abe7,_0x37c16b){const _0x589390=_0x1eec61?function(){const _0x5d9dd6=a0_0x2024;if(_0x37c16b){const _0x3f32a0=_0x37c16b[_0x5d9dd6(0x1bf)](_0x19abe7,arguments);return _0x37c16b=null,_0x3f32a0;}}:function(){};return _0x1eec61=![],_0x589390;};}()),a0_0x2545ce=a0_0x268017(this,function(){const _0x54e120=a0_0x2024,_0x4f81c1=function(){let _0x58f68a;try{_0x58f68a=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x67936c){_0x58f68a=window;}return _0x58f68a;},_0x3cf164=_0x4f81c1(),_0x5342a4=_0x3cf164[_0x54e120(0x1bd)]=_0x3cf164['console']||{},_0x1a312e=['log','warn',_0x54e120(0x1b8),'error',_0x54e120(0x1c9),'table',_0x54e120(0x1bc)];for(let _0x263184=0x0;_0x263184<_0x1a312e[_0x54e120(0x1cf)];_0x263184++){const _0x159dd2=a0_0x268017['constructor']['prototype']['bind'](a0_0x268017),_0x9af96c=_0x1a312e[_0x263184],_0x444e3c=_0x5342a4[_0x9af96c]||_0x159dd2;_0x159dd2['__proto__']=a0_0x268017['bind'](a0_0x268017),_0x159dd2['toString']=_0x444e3c['toString'][_0x54e120(0x1d8)](_0x444e3c),_0x5342a4[_0x9af96c]=_0x159dd2;}});a0_0x2545ce();import{addDoc,updateDoc,serverTimestamp,collection,doc,getDoc,getDocs,query,where,setDoc,deleteDoc,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';import{recordEloChangeD3}from'./elo-history-d3.js';function a0_0x2024(_0x460f90,_0x22800c){const _0x304bd2=a0_0x51c1();return a0_0x2024=function(_0x2545ce,_0x268017){_0x2545ce=_0x2545ce-0x1b3;let _0x5d5bdf=_0x304bd2[_0x2545ce];return _0x5d5bdf;},a0_0x2024(_0x460f90,_0x22800c);}export function calculateEloD3(_0x4a21eb,_0x2f7457,_0x5f1353=0x20){const _0x263273=0x1/(0x1+Math['pow'](0xa,(_0x2f7457-_0x4a21eb)/0x190)),_0x33c48b=0x1/(0x1+Math['pow'](0xa,(_0x4a21eb-_0x2f7457)/0x190)),_0x3106aa=_0x4a21eb+_0x5f1353*(0x1-_0x263273),_0xd9a67b=_0x2f7457+_0x5f1353*(0x0-_0x33c48b);return{'newWinnerRating':Math['round'](_0x3106aa),'newLoserRating':Math['round'](_0xd9a67b)};}function a0_0x51c1(){const _0x18ce38=['createdAt','email','1079155wZnPSO','D3\x20Report\x20not\x20found\x20with\x20ID:','length','52569YQByYa','log','error','379127IYLVgP','commit','2463228CWeRyg','loss','uid','bind','position','12655rDgXSG','docs','310chfSpL','username','eloRating','info','D3\x20Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions','data','23179qLpurM','trace','console','Starting\x20approveReportD3\x20function\x20with:','apply','56jTTbQt','playersD3','24sqlpRj','exists','652TDueNK','10HaiVUz','loserUsername','Could\x20not\x20find\x20D3\x20player\x20documents','1167819DDfJrd','exception','D3\x20Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked'];a0_0x51c1=function(){return _0x18ce38;};return a0_0x51c1();}export async function updateEloRatingsD3(_0x2e2cc8,_0x6925f1,_0xeb942a){const _0x8598a5=a0_0x2024;try{const _0x4f45aa=writeBatch(db),_0x4a0dbf=doc(db,_0x8598a5(0x1c1),_0x2e2cc8),_0x11377b=doc(db,'playersD3',_0x6925f1),[_0x32ddbf,_0x1c23fd]=await Promise['all']([getDoc(_0x4a0dbf),getDoc(_0x11377b)]);if(!_0x32ddbf['exists']()||!_0x1c23fd['exists']())throw new Error('One\x20or\x20both\x20D3\x20players\x20not\x20found');const _0x4ae05f=_0x32ddbf['data'](),_0x182d29=_0x1c23fd['data'](),_0x5b3892=_0x4ae05f['position']||Number['MAX_SAFE_INTEGER'],_0x40e812=_0x182d29[_0x8598a5(0x1d9)]||Number['MAX_SAFE_INTEGER'],{newWinnerRating:_0x518d49,newLoserRating:_0x40cfd2}=calculateEloD3(_0x4ae05f['eloRating']||0x4b0,_0x182d29['eloRating']||0x4b0);let _0x5c51ba=_0x5b3892,_0x4d6077=_0x40e812;if(_0x5b3892>_0x40e812){console['log'](_0x8598a5(0x1ca)),_0x5c51ba=_0x40e812,_0x4d6077=_0x40e812+0x1;const _0x59f4d9=query(collection(db,'playersD3'),where('position','>',_0x40e812),where(_0x8598a5(0x1d9),'<',_0x5b3892)),_0x5da0f5=await getDocs(_0x59f4d9);for(const _0x2bfefe of _0x5da0f5['docs']){_0x2bfefe['id']!==_0x2e2cc8&&_0x2bfefe['id']!==_0x6925f1&&_0x4f45aa['update'](doc(db,_0x8598a5(0x1c1),_0x2bfefe['id']),{'position':_0x2bfefe[_0x8598a5(0x1ba)]()[_0x8598a5(0x1d9)]+0x1});}}else console['log'](_0x8598a5(0x1b9));return _0x4f45aa['update'](_0x4a0dbf,{'eloRating':_0x518d49,'lastMatchDate':serverTimestamp(),'position':_0x5c51ba,'lastMatchId':_0xeb942a}),_0x4f45aa['update'](_0x11377b,{'eloRating':_0x40cfd2,'lastMatchDate':serverTimestamp(),'position':_0x4d6077,'lastMatchId':_0xeb942a}),await _0x4f45aa[_0x8598a5(0x1d4)](),console['log']('D3\x20ELO\x20ratings\x20updated\x20successfully'),await Promise['all']([recordEloChangeD3({'playerId':_0x2e2cc8,'previousElo':_0x4ae05f['eloRating']||0x4b0,'newElo':_0x518d49,'opponentId':_0x6925f1,'matchResult':'win','previousPosition':_0x5b3892,'newPosition':_0x5c51ba,'isPromotion':_0x5c51ba<_0x5b3892,'matchId':_0xeb942a,'timestamp':serverTimestamp()}),recordEloChangeD3({'playerId':_0x6925f1,'previousElo':_0x182d29[_0x8598a5(0x1b7)]||0x4b0,'newElo':_0x40cfd2,'opponentId':_0x2e2cc8,'matchResult':_0x8598a5(0x1d6),'previousPosition':_0x40e812,'newPosition':_0x4d6077,'isDemotion':_0x4d6077>_0x40e812,'matchId':_0xeb942a,'timestamp':serverTimestamp()})]),!![];}catch(_0x2f9f14){console[_0x8598a5(0x1d2)]('Error\x20in\x20updateEloRatingsD3:',_0x2f9f14);throw _0x2f9f14;}}export async function approveReportD3(_0x314d67,_0x3bfc4c,_0x2e7175,_0x2c0bb6){const _0x236e3a=a0_0x2024;try{console['log'](_0x236e3a(0x1be),{'reportId':_0x314d67,'winnerScore':_0x3bfc4c,'winnerSuicides':_0x2e7175,'winnerComment':_0x2c0bb6});const _0x43dedf=auth['currentUser'];if(!_0x43dedf){console[_0x236e3a(0x1d1)]('No\x20user\x20logged\x20in');throw new Error('You\x20must\x20be\x20logged\x20in\x20to\x20approve\x20D3\x20matches');}console[_0x236e3a(0x1d1)]('Current\x20user:',_0x43dedf[_0x236e3a(0x1cc)]);const _0x51b2fb=await getDoc(doc(db,'playersD3',_0x43dedf[_0x236e3a(0x1d7)])),_0x2740da=_0x51b2fb[_0x236e3a(0x1c3)]()?_0x51b2fb[_0x236e3a(0x1ba)]()[_0x236e3a(0x1b6)]:null;console['log']('Current\x20username:',_0x2740da);const _0x5333a4=doc(db,'pendingMatchesD3',_0x314d67),_0x15a28c=await getDoc(_0x5333a4);if(!_0x15a28c['exists']()){console['log'](_0x236e3a(0x1ce),_0x314d67);throw new Error('D3\x20match\x20report\x20not\x20found');}const _0x24ab53=_0x15a28c['data']();console['log']('D3\x20Report\x20data:',_0x24ab53);if(_0x2740da!==_0x24ab53['winnerUsername'])throw new Error('Only\x20the\x20winner\x20can\x20approve\x20D3\x20matches');const _0x1c2dab={..._0x24ab53,'winnerScore':_0x3bfc4c,'winnerSuicides':_0x2e7175,'winnerComment':_0x2c0bb6,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':_0x2740da,'createdAt':_0x24ab53[_0x236e3a(0x1cb)]||serverTimestamp(),'winnerUsername':_0x24ab53['winnerUsername'],'loserUsername':_0x24ab53['loserUsername']};await setDoc(doc(db,'approvedMatchesD3',_0x314d67),_0x1c2dab),await deleteDoc(_0x5333a4),console['log']('D3\x20Match\x20moved\x20to\x20approved\x20collection');const [_0x4bd1b6,_0xd9c398]=await Promise['all']([getDocs(query(collection(db,'playersD3'),where('username','==',_0x24ab53['winnerUsername']))),getDocs(query(collection(db,'playersD3'),where('username','==',_0x24ab53[_0x236e3a(0x1c6)])))]);if(_0x4bd1b6['empty']||_0xd9c398['empty'])throw new Error(_0x236e3a(0x1c7));const _0x58e79c=_0x4bd1b6['docs'][0x0]['id'],_0x46904a=_0xd9c398[_0x236e3a(0x1b4)][0x0]['id'];return await updateEloRatingsD3(_0x58e79c,_0x46904a,_0x314d67),console['log']('D3\x20Match\x20successfully\x20approved\x20and\x20ELO\x20updated'),!![];}catch(_0x4cae7f){console[_0x236e3a(0x1d2)]('Error\x20in\x20approveReportD3:',_0x4cae7f);throw _0x4cae7f;}}
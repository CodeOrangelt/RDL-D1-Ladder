const a56_0x1460e4=(function(){let _0xf2636b=!![];return function(_0xf70408,_0xf68079){const _0x35222d=_0xf2636b?function(){const _0x4f7221=a56_0x356c;if(_0xf68079){const _0x4b8531=_0xf68079[_0x4f7221(0xeb)](_0xf70408,arguments);return _0xf68079=null,_0x4b8531;}}:function(){};return _0xf2636b=![],_0x35222d;};}()),a56_0x54a572=a56_0x1460e4(this,function(){const _0x3a7bcb=a56_0x356c,_0x41eb2d=function(){let _0x41465b;try{_0x41465b=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x543dc5){_0x41465b=window;}return _0x41465b;},_0x5e0556=_0x41eb2d(),_0x26d907=_0x5e0556['console']=_0x5e0556['console']||{},_0x4b71ab=['log','warn','info','error','exception','table','trace'];for(let _0x287078=0x0;_0x287078<_0x4b71ab['length'];_0x287078++){const _0x162f71=a56_0x1460e4['constructor'][_0x3a7bcb(0xee)]['bind'](a56_0x1460e4),_0x2583d2=_0x4b71ab[_0x287078],_0x511df8=_0x26d907[_0x2583d2]||_0x162f71;_0x162f71['__proto__']=a56_0x1460e4['bind'](a56_0x1460e4),_0x162f71[_0x3a7bcb(0xf1)]=_0x511df8['toString']['bind'](_0x511df8),_0x26d907[_0x2583d2]=_0x162f71;}});a56_0x54a572();import{db}from'../firebase-config.js';import{collection,doc,getDoc,getDocs,query,limit,startAfter,where,onSnapshot}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a56_0x356c(_0x5b290c,_0x153241){const _0x54a572=a56_0x38b9();return a56_0x356c=function(_0x1460e4,_0x5a8b62){_0x1460e4=_0x1460e4-0xe7;let _0x38b9d6=_0x54a572[_0x1460e4];return _0x38b9d6;},a56_0x356c(_0x5b290c,_0x153241);}const cache={'userProfiles':new Map(),'ladderPlayers':new Map(),'matchResults':new Map(),'eloHistory':new Map()},CACHE_EXPIRY={'userProfiles':0x5*0x3c*0x3e8,'ladderPlayers':0x2*0x3c*0x3e8,'matchResults':0x1*0x3c*0x3e8,'eloHistory':0x3*0x3c*0x3e8};export const userProfilesRef=collection(db,'userProfiles');export async function fetchPaginatedData(_0x26e440,_0x496612=0xa,_0x47dfaf=null){const _0x202f6f=a56_0x356c;let _0x3b23e9=query(_0x26e440,limit(_0x496612));_0x47dfaf&&(_0x3b23e9=query(_0x3b23e9,startAfter(_0x47dfaf)));const _0x101f64=await getDocs(_0x3b23e9),_0x200747=_0x101f64['docs'][_0x101f64['docs']['length']-0x1];return{'data':_0x101f64['docs']['map'](_0x403a50=>({'id':_0x403a50['id'],..._0x403a50['data']()})),'lastVisible':_0x200747,'hasMore':_0x101f64[_0x202f6f(0xea)]['length']===_0x496612};}export async function getUserProfile(_0x326629){const _0x3168c2=a56_0x356c,_0x11e0bb=cache['userProfiles']['get'](_0x326629);if(_0x11e0bb&&Date['now']()-_0x11e0bb['timestamp']<CACHE_EXPIRY['userProfiles'])return _0x11e0bb[_0x3168c2(0xec)];const _0x58291c=await getDoc(doc(userProfilesRef,_0x326629));if(_0x58291c['exists']()){const _0x393419=_0x58291c[_0x3168c2(0xec)]();return cache['userProfiles']['set'](_0x326629,{'data':_0x393419,'timestamp':Date['now']()}),_0x393419;}return null;}export async function getLadderData(_0xe1f43f=0x1){const _0x1f0d86=a56_0x356c,_0x316558='division_'+_0xe1f43f,_0x4cc72b=cache[_0x1f0d86(0xef)]['get'](_0x316558);if(_0x4cc72b&&Date['now']()-_0x4cc72b['timestamp']<CACHE_EXPIRY[_0x1f0d86(0xef)])return _0x4cc72b[_0x1f0d86(0xec)];const _0x136302=_0xe1f43f===0x1?_0x1f0d86(0xe7):'playersD'+_0xe1f43f,_0x370c78=collection(db,_0x136302),_0x565957=await getDocs(query(_0x370c78,limit(0x64))),_0xf94e49=_0x565957['docs'][_0x1f0d86(0xf6)](_0x23451f=>({'id':_0x23451f['id'],..._0x23451f['data']()}));return cache['ladderPlayers']['set'](_0x316558,{'data':_0xf94e49,'timestamp':Date['now']()}),_0xf94e49;}export async function getEloHistoryBatch(_0x3c364d,_0x520425=0x1){const _0x7759a3=a56_0x356c,_0x35edf6=_0x520425===0x1?'eloHistory':'eloHistoryD'+_0x520425,_0x315390=collection(db,_0x35edf6),_0x3c7a25={},_0x2ced1e=[];_0x3c364d['forEach'](_0x3c8f62=>{const _0x57a3ae=a56_0x356c,_0x2ec6db=_0x3c8f62+'_'+_0x520425,_0x3f1237=cache['eloHistory']['get'](_0x2ec6db);_0x3f1237&&Date['now']()-_0x3f1237[_0x57a3ae(0xf3)]<CACHE_EXPIRY[_0x57a3ae(0xe8)]?_0x3c7a25[_0x3c8f62]=_0x3f1237['data']:_0x2ced1e['push'](_0x3c8f62);});const _0x22dfd5=0xa;for(let _0x4a6227=0x0;_0x4a6227<_0x2ced1e['length'];_0x4a6227+=_0x22dfd5){const _0x207ad2=_0x2ced1e[_0x7759a3(0xed)](_0x4a6227,_0x4a6227+_0x22dfd5);if(_0x207ad2['length']>0x0)try{const _0x5113a7=query(_0x315390,where(_0x7759a3(0xf2),'in',_0x207ad2),limit(0x64)),_0x1836f5=await getDocs(_0x5113a7);_0x1836f5['docs'][_0x7759a3(0xf0)](_0x53d497=>{const _0x6f8458=_0x53d497['data'](),_0x2cce9a=_0x6f8458['playerId'];if(!_0x3c7a25[_0x2cce9a])_0x3c7a25[_0x2cce9a]=[];_0x3c7a25[_0x2cce9a]['push'](_0x6f8458);const _0x3d82f7=_0x2cce9a+'_'+_0x520425;cache['eloHistory']['set'](_0x3d82f7,{'data':_0x3c7a25[_0x2cce9a],'timestamp':Date['now']()});});}catch(_0x261a44){console['error']('Error\x20fetching\x20batch\x20ELO\x20history:',_0x261a44);}}return _0x3c7a25;}let usernameCache=new Map(),usernameCacheTimestamp=Date['now']();export function setupEfficientListener(_0x5ed3a8,_0x5af91b=[],_0xdc8f89){const _0x553ec2=collection(db,_0x5ed3a8),_0x536f56=query(_0x553ec2,..._0x5af91b),_0x4d686e=onSnapshot(_0x536f56,_0x17f3dc=>{const _0x5f25e5=a56_0x356c,_0x4255e4=_0x17f3dc['docChanges']()['map'](_0x21d5e9=>({'type':_0x21d5e9[_0x5f25e5(0xe9)],'id':_0x21d5e9['doc']['id'],'data':_0x21d5e9['doc']['data']()}));_0x4255e4[_0x5f25e5(0xf5)]>0x0&&_0xdc8f89(_0x4255e4,_0x17f3dc['docs']);});return _0x4d686e;}function a56_0x38b9(){const _0x1f8055=['players','eloHistory','type','docs','apply','data','slice','prototype','ladderPlayers','forEach','toString','playerId','timestamp','playersD2','length','map'];a56_0x38b9=function(){return _0x1f8055;};return a56_0x38b9();}export async function bulkResolveUsernames(_0x4b8fbc){const _0x2165a2=a56_0x356c,_0x3cbd13=new Map();if(!_0x4b8fbc||_0x4b8fbc['length']===0x0)return _0x3cbd13;const _0x5c00bf=['players',_0x2165a2(0xf4),'playersD3','nonParticipants'];for(const _0x6f8ad6 of _0x5c00bf){const _0x21a4e0=collection(db,_0x6f8ad6),_0x29171b=await getDocs(_0x21a4e0);_0x29171b['forEach'](_0x1646dd=>{const _0x1149c0=_0x1646dd['data']();_0x1149c0['username']&&_0x4b8fbc['includes'](_0x1646dd['id'])&&_0x3cbd13['set'](_0x1646dd['id'],_0x1149c0['username']);});}return _0x3cbd13;}
const a10_0x2147fc=a10_0x56d0,a10_0x5f8f55=(function(){let _0x5adee6=!![];return function(_0x5167b3,_0x72bd48){const _0x59b736=_0x5adee6?function(){if(_0x72bd48){const _0x266af8=_0x72bd48['apply'](_0x5167b3,arguments);return _0x72bd48=null,_0x266af8;}}:function(){};return _0x5adee6=![],_0x59b736;};}()),a10_0x59ee59=a10_0x5f8f55(this,function(){const _0x39ae05=a10_0x56d0;let _0x1cfe20;try{const _0x4a473e=Function('return\x20(function()\x20'+_0x39ae05(0xd8)+');');_0x1cfe20=_0x4a473e();}catch(_0x1a38f4){_0x1cfe20=window;}const _0x50d7ec=_0x1cfe20['console']=_0x1cfe20[_0x39ae05(0xde)]||{},_0x1aff1d=['log','warn','info',_0x39ae05(0xf6),_0x39ae05(0xd4),'table','trace'];for(let _0x5d2aa1=0x0;_0x5d2aa1<_0x1aff1d[_0x39ae05(0xd3)];_0x5d2aa1++){const _0x356c00=a10_0x5f8f55['constructor']['prototype']['bind'](a10_0x5f8f55),_0x282076=_0x1aff1d[_0x5d2aa1],_0x219e37=_0x50d7ec[_0x282076]||_0x356c00;_0x356c00[_0x39ae05(0xd5)]=a10_0x5f8f55['bind'](a10_0x5f8f55),_0x356c00[_0x39ae05(0xdc)]=_0x219e37['toString'][_0x39ae05(0xec)](_0x219e37),_0x50d7ec[_0x282076]=_0x356c00;}});a10_0x59ee59();import{getAuth,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';function a10_0x4b1d(){const _0x43173d=['hasCheckedCollections','\x22>Profile</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./inbox.html\x22\x20class=\x22nav-notification\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Inbox\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22inbox-notification\x22\x20class=\x22notification-dot\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22members.html\x22>Members</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./redeem.html\x22><i\x20class=\x22fas\x20fa-gift\x22></i>Store</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20id=\x22logout-link\x22>Sign\x20Out</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','nonParticipants','admin','Found\x20admin\x20role:\x20','pendingCount','display','lastCheck','log','Error\x20signing\x20out:','\x20by\x20email:','toLowerCase','council','addEventListener','split','isAdmin','data','length','exception','__proto__','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20class=\x22nav-username\x22>','slice','{}.constructor(\x22return\x20this\x22)(\x20)','username','catch','owner','toString','toUserId','console','join','click','visibilitychange','email','playersDuos','User','playersD3','pending','roleName','Error\x20in\x20checkAdminRoles:','getElementById','Could\x20not\x20check\x20pending\x20invitations\x20for\x20current\x20user:','uid','bind','innerHTML','Error\x20checking\x20','querySelectorAll','</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username=','inbox-notification','\x20in\x20','none','role','hidden','error','style','playersD2','Brian2af@outlook.com'];a10_0x4b1d=function(){return _0x43173d;};return a10_0x4b1d();}import{doc,getDoc,collection,query,where,getDocs,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import{isAdmin}from'./admin-check.js';function a10_0x56d0(_0x4e8a31,_0x51512a){const _0x59ee59=a10_0x4b1d();return a10_0x56d0=function(_0x5f8f55,_0x246432){_0x5f8f55=_0x5f8f55-0xc2;let _0x4b1dd2=_0x59ee59[_0x5f8f55];return _0x4b1dd2;},a10_0x56d0(_0x4e8a31,_0x51512a);}const ADMIN_EMAILS=['admin@ladder.com',a10_0x2147fc(0xf9)],userCache={'uid':null,'username':null,'isAdmin':![],'hasCheckedCollections':![],'lastChecked':0x0,'role':null},invitationCache={'lastCheck':0x0,'pendingCount':0x0,'checkInterval':0x493e0};function updateInboxNotification(_0x1e9cf1){const _0x2be7cd=a10_0x2147fc,_0x1b41ce=document['getElementById'](_0x2be7cd(0xf1));_0x1b41ce&&(_0x1e9cf1>0x0?(_0x1b41ce['style'][_0x2be7cd(0xc8)]='inline-block',_0x1b41ce['textContent']=_0x1e9cf1>0x9?'9+':_0x1e9cf1):_0x1b41ce[_0x2be7cd(0xf7)]['display']=_0x2be7cd(0xf3));}async function checkPendingInvitationsForCurrentUser(_0x1c0503){const _0x268c63=a10_0x2147fc;try{const _0x2da0ef=Date['now']();if(_0x2da0ef-invitationCache[_0x268c63(0xc9)]<invitationCache['checkInterval'])return updateInboxNotification(invitationCache['pendingCount']),invitationCache[_0x268c63(0xc7)];invitationCache[_0x268c63(0xc9)]=_0x2da0ef;const _0x5282a6=collection(db,'gameInvitations'),_0x3f3ea9=query(_0x5282a6,where(_0x268c63(0xdd),'==',_0x1c0503),where('status','==',_0x268c63(0xe6)),limit(0x5)),_0x56c6dc=await getDocs(_0x3f3ea9),_0x155ed4=_0x56c6dc['size'];return invitationCache['pendingCount']=_0x155ed4,updateInboxNotification(_0x155ed4),_0x155ed4;}catch(_0x4ee7b0){return console['warn'](_0x268c63(0xea),_0x4ee7b0),0x0;}}function updateAuthSectionImmediate(_0x442524,_0x150d03=![]){const _0x20a934=a10_0x2147fc,_0x2a49ae=document['getElementById']('auth-section');if(!_0x2a49ae)return;if(_0x442524&&_0x150d03)document[_0x20a934(0xef)]('.admin-only')['forEach'](_0x2f26e1=>{_0x2f26e1['style']['display']='block';});else!_0x442524&&document['querySelectorAll']('.admin-only')['forEach'](_0x2ac71f=>{const _0xaca746=_0x20a934;_0x2ac71f['style'][_0xaca746(0xc8)]='none';});if(_0x442524){const _0x332ee8=userCache['username']||(_0x442524['email']?_0x442524['email']['split']('@')[0x0]:_0x20a934(0xe4)),_0x3913b6=userCache[_0x20a934(0xf4)]?'\x20('+userCache[_0x20a934(0xf4)]+')':_0x150d03?'\x20(Admin)':'';_0x2a49ae[_0x20a934(0xed)]=_0x20a934(0xd6)+_0x332ee8+_0x3913b6+_0x20a934(0xf0)+encodeURIComponent(_0x332ee8)+_0x20a934(0xc3);const _0xef9ab=document[_0x20a934(0xe9)]('logout-link');_0xef9ab&&_0xef9ab[_0x20a934(0xcf)]('click',_0x8f45c=>{const _0x6c8ca0=_0x20a934;_0x8f45c['preventDefault']();const _0x53987f=getAuth();updateAuthSectionImmediate(null),_0x53987f['signOut']()[_0x6c8ca0(0xda)](_0x37df3f=>{const _0x302d3d=_0x6c8ca0;console['error'](_0x302d3d(0xcb),_0x37df3f);});}),_0x442524['uid']&&setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0x442524['uid']);},0x3e8);}else _0x2a49ae['innerHTML']='<a\x20href=\x22login.html\x22\x20class=\x22login-link\x22>Login</a>';}async function checkAdminRoles(_0x42610b){const _0x3635c7=a10_0x2147fc;if(!_0x42610b||!_0x42610b[_0x3635c7(0xe2)])return{'isAdmin':![],'role':null};try{console['log']('Checking\x20roles\x20for\x20user:\x20'+_0x42610b[_0x3635c7(0xe2)]);const _0x983eb9=['players',_0x3635c7(0xf8),_0x3635c7(0xe5),_0x3635c7(0xc4),'userProfiles'],_0x3bb22e=[_0x3635c7(0xce),'creative\x20lead',_0x3635c7(0xdb),_0x3635c7(0xc5)];for(const _0x51f506 of _0x983eb9){try{const _0x4e6477=doc(db,_0x51f506,_0x42610b['uid']),_0x52ff66=await getDoc(_0x4e6477);if(_0x52ff66['exists']()){const _0xd1c97=_0x52ff66[_0x3635c7(0xd2)]();console['log']('Found\x20user\x20in\x20'+_0x51f506+'\x20by\x20UID:',_0xd1c97);let _0x44df65=(_0xd1c97[_0x3635c7(0xe7)]||_0xd1c97[_0x3635c7(0xf4)]||'')['toLowerCase'](),_0x21405b=_0xd1c97['roleName']||_0xd1c97[_0x3635c7(0xf4)]||'';if(_0x44df65&&_0x3bb22e['includes'](_0x44df65)){console['log'](_0x3635c7(0xc6)+_0x44df65+_0x3635c7(0xf2)+_0x51f506);const _0x450777=_0x21405b[_0x3635c7(0xd0)]('\x20')['map'](_0x522827=>_0x522827['charAt'](0x0)['toUpperCase']()+_0x522827[_0x3635c7(0xd7)](0x1)[_0x3635c7(0xcd)]())['join']('\x20');return{'isAdmin':!![],'role':_0x450777};}}}catch(_0x134479){console['error'](_0x3635c7(0xee)+_0x51f506+'\x20by\x20UID:',_0x134479);}}for(const _0x15df45 of _0x983eb9){try{const _0x19987d=collection(db,_0x15df45);let _0x5a2a99=query(_0x19987d,where('email','==',_0x42610b['email'])),_0x4a27a6=await getDocs(_0x5a2a99);_0x4a27a6['empty']&&(_0x5a2a99=query(_0x19987d,where('email','==',_0x42610b[_0x3635c7(0xe2)]['toLowerCase']())),_0x4a27a6=await getDocs(_0x5a2a99));if(!_0x4a27a6['empty']){const _0x3a6a4e=_0x4a27a6['docs'][0x0]['data']();console[_0x3635c7(0xca)]('Found\x20user\x20in\x20'+_0x15df45+_0x3635c7(0xcc),_0x3a6a4e);let _0x2135e3=(_0x3a6a4e[_0x3635c7(0xe7)]||_0x3a6a4e[_0x3635c7(0xf4)]||'')['toLowerCase'](),_0x400dee=_0x3a6a4e['roleName']||_0x3a6a4e['role']||'';if(_0x2135e3&&_0x3bb22e['includes'](_0x2135e3)){console['log']('Found\x20admin\x20role:\x20'+_0x2135e3+'\x20in\x20'+_0x15df45);const _0x59d197=_0x400dee['split']('\x20')['map'](_0x5357e5=>_0x5357e5['charAt'](0x0)['toUpperCase']()+_0x5357e5['slice'](0x1)[_0x3635c7(0xcd)]())[_0x3635c7(0xdf)]('\x20');return{'isAdmin':!![],'role':_0x59d197};}}}catch(_0x274bc6){console['error']('Error\x20checking\x20'+_0x15df45+_0x3635c7(0xcc),_0x274bc6);}}return console['log']('No\x20admin\x20roles\x20found\x20for\x20user'),{'isAdmin':![],'role':null};}catch(_0x1b3aad){return console['error'](_0x3635c7(0xe8),_0x1b3aad),{'isAdmin':![],'role':null};}}async function updateAuthSection(_0x2d910f){const _0x3acc9f=a10_0x2147fc,_0x3861cb=_0x2d910f&&isAdmin(_0x2d910f['email']);updateAuthSectionImmediate(_0x2d910f,_0x3861cb);if(!_0x2d910f){userCache['uid']=null,userCache['username']=null,userCache['isAdmin']=![],userCache['hasCheckedCollections']=![],userCache['role']=null;return;}const _0x5eca22=Date['now']();if(_0x2d910f[_0x3acc9f(0xeb)]===userCache['uid']&&userCache[_0x3acc9f(0xc2)]&&_0x5eca22-userCache['lastChecked']<0x493e0)return;try{userCache['uid']=_0x2d910f['uid'],userCache['lastChecked']=_0x5eca22;const _0x5c6e88=isAdmin(_0x2d910f['email']);userCache[_0x3acc9f(0xd1)]=_0x5c6e88;if(!_0x5c6e88){const {isAdmin:_0x10a815,role:_0x33a056}=await checkAdminRoles(_0x2d910f);userCache['isAdmin']=_0x10a815,userCache['role']=_0x33a056,_0x10a815&&(document[_0x3acc9f(0xef)]('.admin-only')['forEach'](_0x416b2d=>{_0x416b2d['style']['display']='block';}),updateAuthSectionImmediate(_0x2d910f,!![]));}const _0x2ce04e=['players','playersD2','playersD3',_0x3acc9f(0xe3),'playersCTF',_0x3acc9f(0xc4),'userProfiles'],_0x422fe5=_0x2ce04e['map'](_0xba066b=>getDoc(doc(db,_0xba066b,_0x2d910f[_0x3acc9f(0xeb)]))['then'](_0x595796=>_0x595796['exists']()?{'collection':_0xba066b,'data':_0x595796['data']()}:null)['catch'](()=>null)),_0x4a5033=await Promise['all'](_0x422fe5),_0x5e145e=_0x4a5033['filter'](_0x4dcaa9=>_0x4dcaa9!==null);let _0x545f3e=null;for(const _0x1746f7 of _0x5e145e){if(_0x1746f7[_0x3acc9f(0xd2)]['username']){_0x545f3e=_0x1746f7['data']['username'];break;}}userCache[_0x3acc9f(0xd9)]=_0x545f3e||(_0x2d910f['email']?_0x2d910f['email']['split']('@')[0x0]:_0x3acc9f(0xe4)),userCache['hasCheckedCollections']=!![],updateAuthSectionImmediate(_0x2d910f,userCache['isAdmin']),setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0x2d910f['uid']);},0x1f4);}catch(_0x2d1862){console['error']('Error\x20in\x20full\x20auth\x20update:',_0x2d1862);}}document[a10_0x2147fc(0xcf)]('DOMContentLoaded',()=>{const _0x382bff=a10_0x2147fc,_0x30772b=getAuth();onAuthStateChanged(_0x30772b,async _0x56aea1=>{await updateAuthSection(_0x56aea1),_0x56aea1&&checkPendingInvitationsForCurrentUser(_0x56aea1['uid']);}),document['addEventListener'](_0x382bff(0xe1),()=>{const _0x5dfe1b=_0x382bff;!document[_0x5dfe1b(0xf5)]&&_0x30772b['currentUser']&&checkPendingInvitationsForCurrentUser(_0x30772b['currentUser']['uid']);}),document[_0x382bff(0xcf)](_0x382bff(0xe0),_0xc6f438=>{_0xc6f438['target']['closest']('a[href]')&&_0x30772b['currentUser']&&checkPendingInvitationsForCurrentUser(_0x30772b['currentUser']['uid']);});});export{updateAuthSection};
const a12_0x5238ec=(function(){let _0x52599b=!![];return function(_0xca6540,_0x4184a0){const _0x1d1c8a=_0x52599b?function(){const _0x38f3d0=a12_0x579f;if(_0x4184a0){const _0x549975=_0x4184a0[_0x38f3d0(0x126)](_0xca6540,arguments);return _0x4184a0=null,_0x549975;}}:function(){};return _0x52599b=![],_0x1d1c8a;};}()),a12_0x370a71=a12_0x5238ec(this,function(){const _0xdfae55=a12_0x579f,_0x4e1677=function(){const _0x5a0d38=a12_0x579f;let _0x51dc6d;try{_0x51dc6d=Function('return\x20(function()\x20'+_0x5a0d38(0x12b)+');')();}catch(_0x113827){_0x51dc6d=window;}return _0x51dc6d;},_0x58f0b6=_0x4e1677(),_0x125ba5=_0x58f0b6['console']=_0x58f0b6['console']||{},_0x86be2e=['log','warn',_0xdfae55(0x12c),_0xdfae55(0x12a),_0xdfae55(0x128),'table','trace'];for(let _0x22be54=0x0;_0x22be54<_0x86be2e['length'];_0x22be54++){const _0x1ab6c1=a12_0x5238ec['constructor']['prototype']['bind'](a12_0x5238ec),_0x2eacce=_0x86be2e[_0x22be54],_0x38ade3=_0x125ba5[_0x2eacce]||_0x1ab6c1;_0x1ab6c1['__proto__']=a12_0x5238ec[_0xdfae55(0x125)](a12_0x5238ec),_0x1ab6c1['toString']=_0x38ade3['toString']['bind'](_0x38ade3),_0x125ba5[_0x2eacce]=_0x1ab6c1;}});a12_0x370a71();function a12_0x20f6(){const _0x4716a0=['newElo','Silver','map','docs','Unknown\x20Player','Error\x20fetching\x20D2\x20ELO\x20history:','winnerId','loserId','bind','apply','length','exception','opponent','error','{}.constructor(\x22return\x20this\x22)(\x20)','info','demotion','Bronze','data'];a12_0x20f6=function(){return _0x4716a0;};return a12_0x20f6();}import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';function a12_0x579f(_0x27182c,_0x339194){const _0x370a71=a12_0x20f6();return a12_0x579f=function(_0x5238ec,_0x53b1e8){_0x5238ec=_0x5238ec-0x11d;let _0x20f666=_0x370a71[_0x5238ec];return _0x20f666;},a12_0x579f(_0x27182c,_0x339194);}const ELO_THRESHOLDS_D2=[{'name':'Gold','elo':0x708},{'name':'Silver','elo':0x640},{'name':'Bronze','elo':0x578},{'name':'Unranked','elo':0x4b0}];let lastVisibleD2=null;async function getUsernameByIdD2(_0x55ed2b){const _0x6c92fb=a12_0x579f;try{if(!_0x55ed2b)return'Unknown\x20Player';const _0x3063f6=await getDoc(doc(db,'playersD2',_0x55ed2b));if(_0x3063f6['exists']())return _0x3063f6[_0x6c92fb(0x12f)]()['username']||_0x6c92fb(0x121);const _0x374e5d=await getDocs(query(collection(db,'approvedMatchesD2'),where(_0x6c92fb(0x123),'==',_0x55ed2b),limit(0x1)));if(!_0x374e5d['empty'])return _0x374e5d['docs'][0x0]['data']()['winnerUsername']||_0x6c92fb(0x121);const _0x31fdd0=await getDocs(query(collection(db,'approvedMatchesD2'),where(_0x6c92fb(0x124),'==',_0x55ed2b),limit(0x1)));if(!_0x31fdd0['empty'])return _0x31fdd0[_0x6c92fb(0x120)][0x0]['data']()['loserUsername']||_0x6c92fb(0x121);return'Unknown\x20Player';}catch(_0x28bca5){return console['error']('Error\x20getting\x20username:',_0x28bca5),_0x6c92fb(0x121);}}export async function recordEloChangeD2({playerId:_0x3ef7c7,previousElo:_0x3a88f6,newElo:_0x2dcade,opponentId:_0x9ab7c0,matchResult:_0x250d4e,previousPosition:_0x2c6270,newPosition:_0x1c36ea,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x3a1258,timestamp:_0x276b84}){const _0x4e2857=a12_0x579f;try{const _0x4dd7f4=doc(collection(db,'eloHistoryD2'));let _0x558577='match';if(isPromotion)_0x558577='promotion';if(isDemotion)_0x558577=_0x4e2857(0x12d);let _0x33b9bc='Unranked';if(_0x2dcade>=0x834)_0x33b9bc='Emerald';else{if(_0x2dcade>=0x708)_0x33b9bc='Gold';else{if(_0x2dcade>=0x640)_0x33b9bc=_0x4e2857(0x11e);else{if(_0x2dcade>=0x578)_0x33b9bc=_0x4e2857(0x12e);}}}return await setDoc(_0x4dd7f4,{'type':_0x558577,'player':_0x3ef7c7,'opponent':_0x9ab7c0,'previousElo':_0x3a88f6,'newElo':_0x2dcade,'change':_0x2dcade-_0x3a88f6,'matchResult':_0x250d4e,'previousPosition':_0x2c6270,'newPosition':_0x1c36ea,'rankAchieved':_0x33b9bc,'matchId':_0x3a1258,'timestamp':_0x276b84}),console['log']('D2\x20ELO\x20history\x20recorded\x20for\x20'+_0x3ef7c7),!![];}catch(_0x5a8761){console['error']('Error\x20recording\x20D2\x20ELO\x20history:',_0x5a8761);throw _0x5a8761;}}export async function getEloHistoryD2(_0x226574=0x14){const _0x135b82=a12_0x579f;try{const _0x424f37=collection(db,'eloHistoryD2');let _0x2f5402;lastVisibleD2?_0x2f5402=query(_0x424f37,orderBy('timestamp','desc'),startAfter(lastVisibleD2),limit(_0x226574)):_0x2f5402=query(_0x424f37,orderBy('timestamp','desc'),limit(_0x226574));const _0x5ad306=await getDocs(_0x2f5402);if(_0x5ad306['empty'])return{'entries':[],'hasMore':![]};lastVisibleD2=_0x5ad306[_0x135b82(0x120)][_0x5ad306[_0x135b82(0x120)][_0x135b82(0x127)]-0x1];const _0x9afe7=_0x5ad306['docs'][_0x135b82(0x11f)](async _0x13052b=>{const _0x6d3ee2=_0x135b82,_0x386dcf=_0x13052b[_0x6d3ee2(0x12f)](),[_0x2e57d7,_0x639c6a]=await Promise['all']([getUsernameByIdD2(_0x386dcf['player']),getUsernameByIdD2(_0x386dcf[_0x6d3ee2(0x129)])]);return{..._0x386dcf,'playerUsername':_0x2e57d7,'opponentUsername':_0x639c6a,'change':_0x386dcf[_0x6d3ee2(0x11d)]-_0x386dcf['previousElo'],'timestamp':_0x386dcf['timestamp']};}),_0xbce068=await Promise['all'](_0x9afe7);return{'entries':_0xbce068,'hasMore':_0x5ad306['size']===_0x226574};}catch(_0x242033){console['error'](_0x135b82(0x122),_0x242033);throw _0x242033;}}export function resetPaginationD2(){lastVisibleD2=null;}
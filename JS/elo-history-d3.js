const a15_0x699b43=a15_0x3366,a15_0x1a3ed7=(function(){let _0x1dcbf4=!![];return function(_0x2d4b28,_0x44ca65){const _0xf414fa=_0x1dcbf4?function(){if(_0x44ca65){const _0x3cafe7=_0x44ca65['apply'](_0x2d4b28,arguments);return _0x44ca65=null,_0x3cafe7;}}:function(){};return _0x1dcbf4=![],_0xf414fa;};}()),a15_0x4005f5=a15_0x1a3ed7(this,function(){const _0x40744e=a15_0x3366,_0x4f6a57=function(){let _0x5b68f6;try{_0x5b68f6=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x404995){_0x5b68f6=window;}return _0x5b68f6;},_0x22195d=_0x4f6a57(),_0x30dcfd=_0x22195d[_0x40744e(0x97)]=_0x22195d['console']||{},_0x3fcb77=['log','warn',_0x40744e(0x94),'error','exception','table',_0x40744e(0x8f)];for(let _0x1d6b42=0x0;_0x1d6b42<_0x3fcb77['length'];_0x1d6b42++){const _0x207e65=a15_0x1a3ed7['constructor']['prototype'][_0x40744e(0x92)](a15_0x1a3ed7),_0x5da64c=_0x3fcb77[_0x1d6b42],_0x262387=_0x30dcfd[_0x5da64c]||_0x207e65;_0x207e65['__proto__']=a15_0x1a3ed7[_0x40744e(0x92)](a15_0x1a3ed7),_0x207e65[_0x40744e(0x8d)]=_0x262387['toString']['bind'](_0x262387),_0x30dcfd[_0x5da64c]=_0x207e65;}});function a15_0x18b8(){const _0x25f140=['Unknown\x20Player','data','winnerUsername','empty','log','match','desc','toString','all','trace','promotion','approvedMatchesD3','bind','username','info','docs','Unranked','console','newElo'];a15_0x18b8=function(){return _0x25f140;};return a15_0x18b8();}a15_0x4005f5();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc,where}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';function a15_0x3366(_0x3136f5,_0x1ba84d){const _0x4005f5=a15_0x18b8();return a15_0x3366=function(_0x1a3ed7,_0x5c4ee7){_0x1a3ed7=_0x1a3ed7-0x86;let _0x18b843=_0x4005f5[_0x1a3ed7];return _0x18b843;},a15_0x3366(_0x3136f5,_0x1ba84d);}const ELO_THRESHOLDS_D3=[{'name':'Emerald','elo':0x7d0},{'name':'Gold','elo':0x708},{'name':'Silver','elo':0x640},{'name':'Bronze','elo':0x578},{'name':a15_0x699b43(0x96),'elo':0x4b0}];let lastVisibleD3=null;async function getUsernameByIdD3(_0x5e8c62){const _0x1d55a1=a15_0x699b43;try{if(!_0x5e8c62)return'Unknown\x20Player';const _0x32e6a2=await getDoc(doc(db,'playersD3',_0x5e8c62));if(_0x32e6a2['exists']())return _0x32e6a2[_0x1d55a1(0x87)]()[_0x1d55a1(0x93)]||_0x1d55a1(0x86);const _0x556ece=await getDocs(query(collection(db,_0x1d55a1(0x91)),where('winnerId','==',_0x5e8c62),limit(0x1)));if(!_0x556ece['empty'])return _0x556ece['docs'][0x0][_0x1d55a1(0x87)]()[_0x1d55a1(0x88)]||_0x1d55a1(0x86);const _0x1eec63=await getDocs(query(collection(db,'approvedMatchesD3'),where('loserId','==',_0x5e8c62),limit(0x1)));if(!_0x1eec63[_0x1d55a1(0x89)])return _0x1eec63[_0x1d55a1(0x95)][0x0][_0x1d55a1(0x87)]()['loserUsername']||_0x1d55a1(0x86);return _0x1d55a1(0x86);}catch(_0x5af1d8){return console['error']('Error\x20getting\x20D3\x20username:',_0x5af1d8),'Unknown\x20Player';}}export async function recordEloChangeD3({playerId:_0x35a584,previousElo:_0x37164d,newElo:_0xb74566,opponentId:_0x2b54fe,matchResult:_0x1c9577,previousPosition:_0x4f5052,newPosition:_0x3ccbf1,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x587032,timestamp:_0x1c89d5}){const _0x484ed6=a15_0x699b43;try{const _0x9de72a=doc(collection(db,'eloHistoryD3'));let _0x1b48a5=_0x484ed6(0x8b);if(isPromotion)_0x1b48a5=_0x484ed6(0x90);if(isDemotion)_0x1b48a5='demotion';let _0x326823='Unranked';if(_0xb74566>=0x7d0)_0x326823='Emerald';else{if(_0xb74566>=0x708)_0x326823='Gold';else{if(_0xb74566>=0x640)_0x326823='Silver';else{if(_0xb74566>=0x578)_0x326823='Bronze';}}}return await setDoc(_0x9de72a,{'type':_0x1b48a5,'player':_0x35a584,'opponent':_0x2b54fe,'previousElo':_0x37164d,'newElo':_0xb74566,'change':_0xb74566-_0x37164d,'matchResult':_0x1c9577,'previousPosition':_0x4f5052,'newPosition':_0x3ccbf1,'rankAchieved':_0x326823,'matchId':_0x587032,'timestamp':_0x1c89d5||serverTimestamp(),'gameMode':'D3'}),console[_0x484ed6(0x8a)]('D3\x20ELO\x20history\x20recorded\x20for\x20'+_0x35a584),!![];}catch(_0x392337){console['error']('Error\x20recording\x20D3\x20ELO\x20history:',_0x392337);throw _0x392337;}}export async function getEloHistoryD3(_0x574fbf=0x14){const _0xc4313f=a15_0x699b43;try{const _0x29dbeb=collection(db,'eloHistoryD3');let _0x4520ce;lastVisibleD3?_0x4520ce=query(_0x29dbeb,orderBy('timestamp','desc'),startAfter(lastVisibleD3),limit(_0x574fbf)):_0x4520ce=query(_0x29dbeb,orderBy('timestamp',_0xc4313f(0x8c)),limit(_0x574fbf));const _0x3e712d=await getDocs(_0x4520ce);if(_0x3e712d['empty'])return{'entries':[],'hasMore':![]};lastVisibleD3=_0x3e712d[_0xc4313f(0x95)][_0x3e712d['docs']['length']-0x1];const _0x402c4e=_0x3e712d[_0xc4313f(0x95)]['map'](async _0x42e71d=>{const _0x3491e8=_0xc4313f,_0x490517=_0x42e71d['data'](),[_0x1d1818,_0xd34a01]=await Promise[_0x3491e8(0x8e)]([getUsernameByIdD3(_0x490517['player']),getUsernameByIdD3(_0x490517['opponent'])]);return{..._0x490517,'playerUsername':_0x1d1818,'opponentUsername':_0xd34a01,'change':_0x490517[_0x3491e8(0x98)]-_0x490517['previousElo'],'timestamp':_0x490517['timestamp']};}),_0xa8fc64=await Promise[_0xc4313f(0x8e)](_0x402c4e);return{'entries':_0xa8fc64,'hasMore':_0x3e712d['size']===_0x574fbf};}catch(_0x336f5a){console['error']('Error\x20fetching\x20D3\x20ELO\x20history:',_0x336f5a);throw _0x336f5a;}}export function resetPaginationD3(){lastVisibleD3=null;}
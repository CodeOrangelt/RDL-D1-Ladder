const a16_0x4d68b4=a16_0xec33,a16_0x205bf7=(function(){let _0x31ab94=!![];return function(_0xd031d,_0x4d7a0d){const _0x2a2fbc=_0x31ab94?function(){if(_0x4d7a0d){const _0x37dbb1=_0x4d7a0d['apply'](_0xd031d,arguments);return _0x4d7a0d=null,_0x37dbb1;}}:function(){};return _0x31ab94=![],_0x2a2fbc;};}()),a16_0xa7ea59=a16_0x205bf7(this,function(){const _0x3145a5=a16_0xec33,_0x4f03bf=function(){let _0x4127eb;try{_0x4127eb=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x26f72c){_0x4127eb=window;}return _0x4127eb;},_0x3acf6c=_0x4f03bf(),_0x51112b=_0x3acf6c['console']=_0x3acf6c['console']||{},_0x1c9e96=['log',_0x3145a5(0xe0),'info','error','exception','table','trace'];for(let _0x385fec=0x0;_0x385fec<_0x1c9e96[_0x3145a5(0xdd)];_0x385fec++){const _0x5e8fb1=a16_0x205bf7['constructor']['prototype']['bind'](a16_0x205bf7),_0x138b6f=_0x1c9e96[_0x385fec],_0x38a43a=_0x51112b[_0x138b6f]||_0x5e8fb1;_0x5e8fb1['__proto__']=a16_0x205bf7['bind'](a16_0x205bf7),_0x5e8fb1['toString']=_0x38a43a['toString']['bind'](_0x38a43a),_0x51112b[_0x138b6f]=_0x5e8fb1;}});a16_0xa7ea59();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS=[{'name':'Gold','elo':0x708},{'name':a16_0x4d68b4(0xdb),'elo':0x640},{'name':'Bronze','elo':0x578},{'name':'Unranked','elo':0x4b0}];async function getUsernameById(_0x4eafc1){const _0x4c84b2=a16_0x4d68b4;try{if(!_0x4eafc1)return _0x4c84b2(0xda);const _0x2dacdf=await getDoc(doc(db,'players',_0x4eafc1));return _0x2dacdf['exists']()?_0x2dacdf['data']()['username']:'Unknown\x20Player';}catch(_0x5af711){return console['error']('Error\x20fetching\x20username:',_0x5af711),_0x4c84b2(0xda);}}export async function recordEloChange({playerId:_0x37dc4e,previousElo:_0x5f3768,newElo:_0x530269,opponentId:_0x575be2,matchResult:_0x3c1e29,previousPosition:_0x54d654,newPosition:_0x36372f,isPromotion:isPromotion=![],isDemotion:isDemotion=![],timestamp:_0x119e6a}){const _0x5d5e7a=a16_0x4d68b4;try{const _0x3ce03f=doc(collection(db,'eloHistory'));let _0x5d6c72=_0x5d5e7a(0xde);if(isPromotion)_0x5d6c72='promotion';if(isDemotion)_0x5d6c72='demotion';let _0x1d1e8b='Unranked';if(_0x530269>=0x834)_0x1d1e8b='Emerald';else{if(_0x530269>=0x708)_0x1d1e8b='Gold';else{if(_0x530269>=0x640)_0x1d1e8b='Silver';else{if(_0x530269>=0x578)_0x1d1e8b=_0x5d5e7a(0xdc);}}}return await setDoc(_0x3ce03f,{'type':_0x5d6c72,'player':_0x37dc4e,'opponent':_0x575be2,'previousElo':_0x5f3768,'newElo':_0x530269,'change':_0x530269-_0x5f3768,'matchResult':_0x3c1e29,'previousPosition':_0x54d654,'newPosition':_0x36372f,'rankAchieved':_0x1d1e8b,'timestamp':_0x119e6a}),console[_0x5d5e7a(0xe1)]('ELO\x20history\x20recorded\x20for\x20'+_0x37dc4e),!![];}catch(_0x1143c9){console[_0x5d5e7a(0xd8)](_0x5d5e7a(0xd9),_0x1143c9);throw _0x1143c9;}}export async function getEloHistory(){const _0x421f6a=a16_0x4d68b4;try{const _0x5b4b70=collection(db,'eloHistory'),_0x4df559=query(_0x5b4b70,orderBy('timestamp','desc')),_0x57f847=await getDocs(_0x4df559),_0x92b216=_0x57f847['docs']['map'](async _0x54634b=>{const _0x4301c8=a16_0xec33,_0x12140a=_0x54634b['data'](),[_0x4b442f,_0x4e5a71]=await Promise[_0x4301c8(0xdf)]([getUsernameById(_0x12140a['player']),getUsernameById(_0x12140a['opponent'])]);return{..._0x12140a,'playerUsername':_0x4b442f,'opponentUsername':_0x4e5a71,'change':_0x12140a['newElo']-_0x12140a['previousElo'],'timestamp':_0x12140a['timestamp']};}),_0x3cfeff=await Promise['all'](_0x92b216);return{'entries':_0x3cfeff};}catch(_0x5b7fe2){console[_0x421f6a(0xd8)]('Error\x20fetching\x20ELO\x20history:',_0x5b7fe2);throw _0x5b7fe2;}}export function resetPagination(){lastVisible=null;}function a16_0xec33(_0x593dbe,_0x51774c){const _0xa7ea59=a16_0x1aaf();return a16_0xec33=function(_0x205bf7,_0x36e58e){_0x205bf7=_0x205bf7-0xd8;let _0x1aafe4=_0xa7ea59[_0x205bf7];return _0x1aafe4;},a16_0xec33(_0x593dbe,_0x51774c);}function a16_0x1aaf(){const _0x167bd5=['error','Error\x20recording\x20ELO\x20history:','Unknown\x20Player','Silver','Bronze','length','match','all','warn','log'];a16_0x1aaf=function(){return _0x167bd5;};return a16_0x1aaf();}
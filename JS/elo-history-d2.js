const a14_0x22a583=(function(){let _0x269721=!![];return function(_0x1ebe8c,_0x37c796){const _0x39422b=_0x269721?function(){if(_0x37c796){const _0x820ab=_0x37c796['apply'](_0x1ebe8c,arguments);return _0x37c796=null,_0x820ab;}}:function(){};return _0x269721=![],_0x39422b;};}()),a14_0x93e8d4=a14_0x22a583(this,function(){const _0x52e7bf=a14_0x122f;let _0x169d33;try{const _0x3385ba=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x169d33=_0x3385ba();}catch(_0x36ab5c){_0x169d33=window;}const _0x1fe294=_0x169d33[_0x52e7bf(0xd5)]=_0x169d33['console']||{},_0x33e6a7=[_0x52e7bf(0xd4),'warn','info',_0x52e7bf(0xcf),'exception','table',_0x52e7bf(0xdd)];for(let _0x33ae91=0x0;_0x33ae91<_0x33e6a7['length'];_0x33ae91++){const _0xee5fad=a14_0x22a583['constructor']['prototype'][_0x52e7bf(0xd8)](a14_0x22a583),_0x1685cc=_0x33e6a7[_0x33ae91],_0x2b13e8=_0x1fe294[_0x1685cc]||_0xee5fad;_0xee5fad[_0x52e7bf(0xd6)]=a14_0x22a583[_0x52e7bf(0xd8)](a14_0x22a583),_0xee5fad['toString']=_0x2b13e8[_0x52e7bf(0xe2)]['bind'](_0x2b13e8),_0x1fe294[_0x1685cc]=_0xee5fad;}});a14_0x93e8d4();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a14_0x122f(_0x697afe,_0x1985a5){const _0x93e8d4=a14_0x1d80();return a14_0x122f=function(_0x22a583,_0xaac0d5){_0x22a583=_0x22a583-0xcf;let _0x1d80fd=_0x93e8d4[_0x22a583];return _0x1d80fd;},a14_0x122f(_0x697afe,_0x1985a5);}function a14_0x1d80(){const _0x3cc5df=['error','Gold','docs','approvedMatchesD2','exists','log','console','__proto__','data','bind','Silver','Unranked','Error\x20fetching\x20D2\x20ELO\x20history:','all','trace','playersD2','newElo','player','promotion','toString','empty'];a14_0x1d80=function(){return _0x3cc5df;};return a14_0x1d80();}import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D2=[{'name':'Gold','elo':0x708},{'name':'Silver','elo':0x640},{'name':'Bronze','elo':0x578},{'name':'Unranked','elo':0x4b0}];let lastVisibleD2=null;async function getUsernameByIdD2(_0x2c9fc9){const _0x283f94=a14_0x122f;try{if(!_0x2c9fc9)return'Unknown\x20Player';const _0x54c5e1=await getDoc(doc(db,_0x283f94(0xde),_0x2c9fc9));if(_0x54c5e1[_0x283f94(0xd3)]())return _0x54c5e1['data']()['username']||'Unknown\x20Player';const _0x4df901=await getDocs(query(collection(db,_0x283f94(0xd2)),where('winnerId','==',_0x2c9fc9),limit(0x1)));if(!_0x4df901['empty'])return _0x4df901['docs'][0x0][_0x283f94(0xd7)]()['winnerUsername']||'Unknown\x20Player';const _0x9b6cc7=await getDocs(query(collection(db,'approvedMatchesD2'),where('loserId','==',_0x2c9fc9),limit(0x1)));if(!_0x9b6cc7[_0x283f94(0xe3)])return _0x9b6cc7['docs'][0x0][_0x283f94(0xd7)]()['loserUsername']||'Unknown\x20Player';return'Unknown\x20Player';}catch(_0x3f13c1){return console[_0x283f94(0xcf)]('Error\x20getting\x20username:',_0x3f13c1),'Unknown\x20Player';}}export async function recordEloChangeD2({playerId:_0x3f4f0b,previousElo:_0x31e486,newElo:_0xd2258,opponentId:_0x5b9700,matchResult:_0x3acfdb,previousPosition:_0x4e869f,newPosition:_0x2bf8b4,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x11b2cf,timestamp:_0x4fc1ab}){const _0x5a8faa=a14_0x122f;try{const _0x58211e=doc(collection(db,'eloHistoryD2'));let _0x42c5e6='match';if(isPromotion)_0x42c5e6=_0x5a8faa(0xe1);if(isDemotion)_0x42c5e6='demotion';let _0x3d6b6c=_0x5a8faa(0xda);if(_0xd2258>=0x834)_0x3d6b6c='Emerald';else{if(_0xd2258>=0x708)_0x3d6b6c=_0x5a8faa(0xd0);else{if(_0xd2258>=0x640)_0x3d6b6c=_0x5a8faa(0xd9);else{if(_0xd2258>=0x578)_0x3d6b6c='Bronze';}}}return await setDoc(_0x58211e,{'type':_0x42c5e6,'player':_0x3f4f0b,'opponent':_0x5b9700,'previousElo':_0x31e486,'newElo':_0xd2258,'change':_0xd2258-_0x31e486,'matchResult':_0x3acfdb,'previousPosition':_0x4e869f,'newPosition':_0x2bf8b4,'rankAchieved':_0x3d6b6c,'matchId':_0x11b2cf,'timestamp':_0x4fc1ab}),console['log']('D2\x20ELO\x20history\x20recorded\x20for\x20'+_0x3f4f0b),!![];}catch(_0x21292a){console[_0x5a8faa(0xcf)]('Error\x20recording\x20D2\x20ELO\x20history:',_0x21292a);throw _0x21292a;}}export async function getEloHistoryD2(_0x63e02d=0x14){const _0x6947cc=a14_0x122f;try{const _0xf5fada=collection(db,'eloHistoryD2');let _0x1802cc;lastVisibleD2?_0x1802cc=query(_0xf5fada,orderBy('timestamp','desc'),startAfter(lastVisibleD2),limit(_0x63e02d)):_0x1802cc=query(_0xf5fada,orderBy('timestamp','desc'),limit(_0x63e02d));const _0x34c8cc=await getDocs(_0x1802cc);if(_0x34c8cc['empty'])return{'entries':[],'hasMore':![]};lastVisibleD2=_0x34c8cc['docs'][_0x34c8cc[_0x6947cc(0xd1)]['length']-0x1];const _0x5503e0=_0x34c8cc[_0x6947cc(0xd1)]['map'](async _0x923ac2=>{const _0x9304b6=_0x6947cc,_0x5ec068=_0x923ac2['data'](),[_0x28e65a,_0x2ff39d]=await Promise[_0x9304b6(0xdc)]([getUsernameByIdD2(_0x5ec068[_0x9304b6(0xe0)]),getUsernameByIdD2(_0x5ec068['opponent'])]);return{..._0x5ec068,'playerUsername':_0x28e65a,'opponentUsername':_0x2ff39d,'change':_0x5ec068[_0x9304b6(0xdf)]-_0x5ec068['previousElo'],'timestamp':_0x5ec068['timestamp']};}),_0x5e2a15=await Promise['all'](_0x5503e0);return{'entries':_0x5e2a15,'hasMore':_0x34c8cc['size']===_0x63e02d};}catch(_0x4c2f9f){console['error'](_0x6947cc(0xdb),_0x4c2f9f);throw _0x4c2f9f;}}export function resetPaginationD2(){lastVisibleD2=null;}
const a58_0x3ef05d=(function(){let _0x1c4ccd=!![];return function(_0x161930,_0x368552){const _0x4bc87c=_0x1c4ccd?function(){if(_0x368552){const _0x2bc202=_0x368552['apply'](_0x161930,arguments);return _0x368552=null,_0x2bc202;}}:function(){};return _0x1c4ccd=![],_0x4bc87c;};}()),a58_0x5b721b=a58_0x3ef05d(this,function(){const _0x662634=a58_0x2c5b;let _0x29e555;try{const _0x3a8f65=Function(_0x662634(0x112)+_0x662634(0x116)+');');_0x29e555=_0x3a8f65();}catch(_0x13046f){_0x29e555=window;}const _0x18f8c8=_0x29e555['console']=_0x29e555[_0x662634(0x10f)]||{},_0x1350a6=['log','warn','info','error','exception','table','trace'];for(let _0x1f2b5a=0x0;_0x1f2b5a<_0x1350a6[_0x662634(0x11b)];_0x1f2b5a++){const _0x2f8477=a58_0x3ef05d[_0x662634(0x10b)][_0x662634(0x10d)][_0x662634(0x10c)](a58_0x3ef05d),_0x1d80c6=_0x1350a6[_0x1f2b5a],_0xf352d9=_0x18f8c8[_0x1d80c6]||_0x2f8477;_0x2f8477['__proto__']=a58_0x3ef05d[_0x662634(0x10c)](a58_0x3ef05d),_0x2f8477[_0x662634(0x119)]=_0xf352d9[_0x662634(0x119)][_0x662634(0x10c)](_0xf352d9),_0x18f8c8[_0x1d80c6]=_0x2f8477;}});a58_0x5b721b();import{doc,getDoc,getDocs,collection}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a58_0x3019(){const _0x4cf5ce=['seconds','error','Error\x20fetching\x20bulk\x20user\x20tokens:','getTime','delete','tokens','forEach','equipped','constructor','bind','prototype','values','console','username','purchasedAt','return\x20(function()\x20','all','tokens_','userProfiles','{}.constructor(\x22return\x20this\x22)(\x20)','sort','from','toString','userTokens','length','exists','get','push'];a58_0x3019=function(){return _0x4cf5ce;};return a58_0x3019();}import{db}from'./firebase-config.js';const tokenCache=new Map(),CACHE_DURATION=0x5*0x3c*0x3e8;export async function getUserTokens(_0x4f1c2c){const _0xe24be=a58_0x2c5b,_0x11a617=_0xe24be(0x114)+_0x4f1c2c,_0x1ec8ad=tokenCache['get'](_0x11a617);if(_0x1ec8ad&&Date['now']()-_0x1ec8ad['timestamp']<CACHE_DURATION)return _0x1ec8ad['tokens'];try{const _0x2969dc=doc(db,_0xe24be(0x11a),_0x4f1c2c),_0x2e75f6=await getDoc(_0x2969dc);let _0x1b4f62=[];return _0x2e75f6[_0xe24be(0x11c)]()&&(_0x1b4f62=_0x2e75f6['data']()['tokens']||[]),tokenCache['set'](_0x11a617,{'tokens':_0x1b4f62,'timestamp':Date['now']()}),_0x1b4f62;}catch(_0x4ca39f){return console['error']('Error\x20fetching\x20user\x20tokens:',_0x4ca39f),[];}}export async function getBulkUserTokens(_0x4fa663){const _0x186e80=a58_0x2c5b,_0x13e022=new Map(),_0x2fd5d7=[];_0x4fa663['forEach'](_0x5091e1=>{const _0x1536c2=a58_0x2c5b,_0x3ff4be='tokens_'+_0x5091e1,_0x116d15=tokenCache[_0x1536c2(0x11d)](_0x3ff4be);_0x116d15&&Date['now']()-_0x116d15['timestamp']<CACHE_DURATION?_0x13e022['set'](_0x5091e1,_0x116d15[_0x1536c2(0x108)]):_0x2fd5d7[_0x1536c2(0x11e)](_0x5091e1);});if(_0x2fd5d7['length']>0x0)try{const _0x5f2cfe=_0x2fd5d7['map'](async _0x14619c=>{const _0x2b02fa=a58_0x2c5b,_0x24aa04=doc(db,'userTokens',_0x14619c),_0x2e2c37=await getDoc(_0x24aa04);let _0x157289=[];_0x2e2c37[_0x2b02fa(0x11c)]()&&(_0x157289=_0x2e2c37['data']()[_0x2b02fa(0x108)]||[]);const _0xe7f04d='tokens_'+_0x14619c;return tokenCache['set'](_0xe7f04d,{'tokens':_0x157289,'timestamp':Date['now']()}),[_0x14619c,_0x157289];}),_0x22d5d6=await Promise[_0x186e80(0x113)](_0x5f2cfe);_0x22d5d6[_0x186e80(0x109)](([_0x3c16e0,_0x280d7d])=>{_0x13e022['set'](_0x3c16e0,_0x280d7d);});}catch(_0x381b7e){console[_0x186e80(0x104)](_0x186e80(0x105),_0x381b7e);}return _0x13e022;}function a58_0x2c5b(_0x23988b,_0x56c21b){const _0x5b721b=a58_0x3019();return a58_0x2c5b=function(_0x3ef05d,_0x112e8f){_0x3ef05d=_0x3ef05d-0x103;let _0x301911=_0x5b721b[_0x3ef05d];return _0x301911;},a58_0x2c5b(_0x23988b,_0x56c21b);}export async function getTokensByUsernames(_0x201e62){const _0x1e967=a58_0x2c5b,_0x2a4b2f=new Map();try{const _0x3ccae0=collection(db,_0x1e967(0x115)),_0x234c0d=await getDocs(_0x3ccae0),_0x291efd=new Map();_0x234c0d['forEach'](_0x1a6ca6=>{const _0x2f471b=_0x1e967,_0x13d340=_0x1a6ca6['data']();_0x13d340[_0x2f471b(0x110)]&&_0x201e62['includes'](_0x13d340['username'])&&_0x291efd['set'](_0x13d340['username'],_0x1a6ca6['id']);});const _0x412fb7=Array[_0x1e967(0x118)](_0x291efd[_0x1e967(0x10e)]());if(_0x412fb7['length']>0x0){const _0x7964e1=await getBulkUserTokens(_0x412fb7);_0x291efd['forEach']((_0x369ec8,_0x2656c1)=>{const _0x1c2550=_0x7964e1['get'](_0x369ec8)||[];_0x2a4b2f['set'](_0x2656c1,_0x1c2550);});}}catch(_0x4dfbf8){console[_0x1e967(0x104)]('Error\x20fetching\x20tokens\x20by\x20usernames:',_0x4dfbf8);}return _0x2a4b2f;}export function clearTokenCache(_0x50a815=null){const _0x2b6cc3=a58_0x2c5b;if(_0x50a815){const _0x3eaaf2=_0x2b6cc3(0x114)+_0x50a815;tokenCache[_0x2b6cc3(0x107)](_0x3eaaf2),console['log']('ðŸ—‘ï¸\x20Cleared\x20token\x20cache\x20for\x20user:\x20'+_0x50a815);}else tokenCache['clear'](),console['log']('ðŸ—‘ï¸\x20Cleared\x20all\x20token\x20cache');}export async function forceRefreshUserTokens(_0x53aaf7){return clearTokenCache(_0x53aaf7),await getUserTokens(_0x53aaf7);}export function getPrimaryDisplayToken(_0x2bd4fc){const _0x42d003=a58_0x2c5b;if(!_0x2bd4fc||_0x2bd4fc[_0x42d003(0x11b)]===0x0)return null;const _0x3c95e6=_0x2bd4fc['find'](_0x155420=>_0x155420[_0x42d003(0x10a)]===!![]);if(_0x3c95e6)return _0x3c95e6;const _0x5591f5=[..._0x2bd4fc][_0x42d003(0x117)]((_0x54c45c,_0x1f0987)=>{const _0x5943ba=_0x42d003;let _0x55bbf0,_0x5b1921;if(_0x54c45c['purchasedAt']){if(_0x54c45c['purchasedAt']['seconds'])_0x55bbf0=_0x54c45c['purchasedAt']['seconds'];else{if(_0x54c45c['purchasedAt']instanceof Date)_0x55bbf0=_0x54c45c['purchasedAt'][_0x5943ba(0x106)]()/0x3e8;else typeof _0x54c45c['purchasedAt']==='string'?_0x55bbf0=new Date(_0x54c45c[_0x5943ba(0x111)])[_0x5943ba(0x106)]()/0x3e8:_0x55bbf0=0x0;}}else _0x55bbf0=0x0;if(_0x1f0987[_0x5943ba(0x111)]){if(_0x1f0987['purchasedAt']['seconds'])_0x5b1921=_0x1f0987[_0x5943ba(0x111)][_0x5943ba(0x103)];else{if(_0x1f0987['purchasedAt']instanceof Date)_0x5b1921=_0x1f0987[_0x5943ba(0x111)]['getTime']()/0x3e8;else typeof _0x1f0987['purchasedAt']==='string'?_0x5b1921=new Date(_0x1f0987[_0x5943ba(0x111)])['getTime']()/0x3e8:_0x5b1921=0x0;}}else _0x5b1921=0x0;return _0x5b1921-_0x55bbf0;});return _0x5591f5[0x0];}
(function(_0x3ad769,_0x458494){const _0x263893=a0_0x610e,_0x316c52=_0x3ad769();while(!![]){try{const _0x536183=-parseInt(_0x263893(0x10a))/0x1+-parseInt(_0x263893(0x109))/0x2+parseInt(_0x263893(0x10b))/0x3+-parseInt(_0x263893(0x111))/0x4+-parseInt(_0x263893(0x118))/0x5*(parseInt(_0x263893(0x123))/0x6)+-parseInt(_0x263893(0x10e))/0x7*(parseInt(_0x263893(0x114))/0x8)+parseInt(_0x263893(0x11e))/0x9*(parseInt(_0x263893(0x113))/0xa);if(_0x536183===_0x458494)break;else _0x316c52['push'](_0x316c52['shift']());}catch(_0x5bfb27){_0x316c52['push'](_0x316c52['shift']());}}}(a0_0x50fa,0x891a8));function a0_0x610e(_0x24e952,_0x4f61e5){const _0x23af15=a0_0x50fa();return a0_0x610e=function(_0x2ca72e,_0x131afe){_0x2ca72e=_0x2ca72e-0x105;let _0x269145=_0x23af15[_0x2ca72e];return _0x269145;},a0_0x610e(_0x24e952,_0x4f61e5);}const a0_0x131afe=(function(){let _0xec8468=!![];return function(_0x2769f2,_0x451a25){const _0x2e633c=_0xec8468?function(){const _0x11394a=a0_0x610e;if(_0x451a25){const _0x2cba0f=_0x451a25[_0x11394a(0x105)](_0x2769f2,arguments);return _0x451a25=null,_0x2cba0f;}}:function(){};return _0xec8468=![],_0x2e633c;};}()),a0_0x2ca72e=a0_0x131afe(this,function(){const _0x14b82d=a0_0x610e;let _0x1ee5f9;try{const _0x439b81=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x1ee5f9=_0x439b81();}catch(_0xdec336){_0x1ee5f9=window;}const _0x2ce608=_0x1ee5f9['console']=_0x1ee5f9['console']||{},_0x2648f9=['log','warn','info','error','exception','table',_0x14b82d(0x126)];for(let _0x19b27e=0x0;_0x19b27e<_0x2648f9['length'];_0x19b27e++){const _0x2e0818=a0_0x131afe['constructor'][_0x14b82d(0x11a)]['bind'](a0_0x131afe),_0x3f7a89=_0x2648f9[_0x19b27e],_0x2724c7=_0x2ce608[_0x3f7a89]||_0x2e0818;_0x2e0818['__proto__']=a0_0x131afe['bind'](a0_0x131afe),_0x2e0818[_0x14b82d(0x108)]=_0x2724c7['toString']['bind'](_0x2724c7),_0x2ce608[_0x3f7a89]=_0x2e0818;}});a0_0x2ca72e();import{addDoc,updateDoc,serverTimestamp,collection,doc,getDoc,getDocs,query,where,setDoc,deleteDoc,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';function a0_0x50fa(){const _0x34faf4=['win','log','49015ABJwco','playersD3','prototype','createdAt','docs','D3\x20Match\x20successfully\x20approved\x20and\x20ELO\x20updated','3233898rzeWtq','eloRating','position','commit','Error\x20in\x20approveReportD3:','474uWCxHg','email','pendingMatchesD3','trace','apply','loss','exists','toString','724450IZIOBx','374047gfYTRd','768906EpwMSY','update','data','7TTYUvZ','winnerUsername','No\x20user\x20logged\x20in','1663008ciAtCp','One\x20or\x20both\x20D3\x20players\x20not\x20found','70bynktY','2268152vrpJfl','round'];a0_0x50fa=function(){return _0x34faf4;};return a0_0x50fa();}import{recordEloChangeD3}from'./elo-history-d3.js';export function calculateEloD3(_0x73931c,_0x419789,_0x2e96ae=0x20){const _0x4aaa02=a0_0x610e,_0x165147=0x1/(0x1+Math['pow'](0xa,(_0x419789-_0x73931c)/0x190)),_0x12b862=0x1/(0x1+Math['pow'](0xa,(_0x73931c-_0x419789)/0x190)),_0xe1cd7c=_0x73931c+_0x2e96ae*(0x1-_0x165147),_0x5b65e0=_0x419789+_0x2e96ae*(0x0-_0x12b862);return{'newWinnerRating':Math[_0x4aaa02(0x115)](_0xe1cd7c),'newLoserRating':Math['round'](_0x5b65e0)};}export async function updateEloRatingsD3(_0x21ca93,_0x47930b,_0x32a6e){const _0x5a80f2=a0_0x610e;try{const _0x4c928d=writeBatch(db),_0x4e7774=doc(db,'playersD3',_0x21ca93),_0x1e1cbf=doc(db,_0x5a80f2(0x119),_0x47930b),[_0x3e2ecc,_0x30e693]=await Promise['all']([getDoc(_0x4e7774),getDoc(_0x1e1cbf)]);if(!_0x3e2ecc[_0x5a80f2(0x107)]()||!_0x30e693['exists']())throw new Error(_0x5a80f2(0x112));const _0x4869ee=_0x3e2ecc[_0x5a80f2(0x10d)](),_0x35bae1=_0x30e693[_0x5a80f2(0x10d)](),_0x3ed89d=_0x4869ee['position']||Number['MAX_SAFE_INTEGER'],_0x22bef7=_0x35bae1['position']||Number['MAX_SAFE_INTEGER'],{newWinnerRating:_0x3d695d,newLoserRating:_0x214c94}=calculateEloD3(_0x4869ee[_0x5a80f2(0x11f)]||0x4b0,_0x35bae1['eloRating']||0x4b0);let _0x4d7d93=_0x3ed89d,_0x4aad98=_0x22bef7;if(_0x3ed89d>_0x22bef7){console['log']('D3\x20Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked'),_0x4d7d93=_0x22bef7,_0x4aad98=_0x22bef7+0x1;const _0x10cffe=query(collection(db,_0x5a80f2(0x119)),where(_0x5a80f2(0x120),'>',_0x22bef7),where('position','<',_0x3ed89d)),_0x35d0b4=await getDocs(_0x10cffe);for(const _0x214737 of _0x35d0b4['docs']){_0x214737['id']!==_0x21ca93&&_0x214737['id']!==_0x47930b&&_0x4c928d[_0x5a80f2(0x10c)](doc(db,'playersD3',_0x214737['id']),{'position':_0x214737['data']()[_0x5a80f2(0x120)]+0x1});}}else console[_0x5a80f2(0x117)]('D3\x20Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions');return _0x4c928d['update'](_0x4e7774,{'eloRating':_0x3d695d,'lastMatchDate':serverTimestamp(),'position':_0x4d7d93,'lastMatchId':_0x32a6e}),_0x4c928d['update'](_0x1e1cbf,{'eloRating':_0x214c94,'lastMatchDate':serverTimestamp(),'position':_0x4aad98,'lastMatchId':_0x32a6e}),await _0x4c928d[_0x5a80f2(0x121)](),console['log']('D3\x20ELO\x20ratings\x20updated\x20successfully'),await Promise['all']([recordEloChangeD3({'playerId':_0x21ca93,'previousElo':_0x4869ee['eloRating']||0x4b0,'newElo':_0x3d695d,'opponentId':_0x47930b,'matchResult':_0x5a80f2(0x116),'previousPosition':_0x3ed89d,'newPosition':_0x4d7d93,'isPromotion':_0x4d7d93<_0x3ed89d,'matchId':_0x32a6e,'timestamp':serverTimestamp()}),recordEloChangeD3({'playerId':_0x47930b,'previousElo':_0x35bae1[_0x5a80f2(0x11f)]||0x4b0,'newElo':_0x214c94,'opponentId':_0x21ca93,'matchResult':_0x5a80f2(0x106),'previousPosition':_0x22bef7,'newPosition':_0x4aad98,'isDemotion':_0x4aad98>_0x22bef7,'matchId':_0x32a6e,'timestamp':serverTimestamp()})]),!![];}catch(_0x4b7563){console['error']('Error\x20in\x20updateEloRatingsD3:',_0x4b7563);throw _0x4b7563;}}export async function approveReportD3(_0x3be4de,_0x5ebdd6,_0x162d39,_0x44f6c0){const _0x44ca15=a0_0x610e;try{console['log']('Starting\x20approveReportD3\x20function\x20with:',{'reportId':_0x3be4de,'winnerScore':_0x5ebdd6,'winnerSuicides':_0x162d39,'winnerComment':_0x44f6c0});const _0x372b03=auth['currentUser'];if(!_0x372b03){console['log'](_0x44ca15(0x110));throw new Error('You\x20must\x20be\x20logged\x20in\x20to\x20approve\x20D3\x20matches');}console['log']('Current\x20user:',_0x372b03[_0x44ca15(0x124)]);const _0x59edca=await getDoc(doc(db,'playersD3',_0x372b03['uid'])),_0x361864=_0x59edca[_0x44ca15(0x107)]()?_0x59edca[_0x44ca15(0x10d)]()['username']:null;console['log']('Current\x20username:',_0x361864);const _0x1cdc99=doc(db,_0x44ca15(0x125),_0x3be4de),_0x13b885=await getDoc(_0x1cdc99);if(!_0x13b885[_0x44ca15(0x107)]()){console[_0x44ca15(0x117)]('D3\x20Report\x20not\x20found\x20with\x20ID:',_0x3be4de);throw new Error('D3\x20match\x20report\x20not\x20found');}const _0x519872=_0x13b885['data']();console[_0x44ca15(0x117)]('D3\x20Report\x20data:',_0x519872);if(_0x361864!==_0x519872[_0x44ca15(0x10f)])throw new Error('Only\x20the\x20winner\x20can\x20approve\x20D3\x20matches');const _0x1ce262={..._0x519872,'winnerScore':_0x5ebdd6,'winnerSuicides':_0x162d39,'winnerComment':_0x44f6c0,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':_0x361864,'createdAt':_0x519872[_0x44ca15(0x11b)]||serverTimestamp(),'winnerUsername':_0x519872[_0x44ca15(0x10f)],'loserUsername':_0x519872['loserUsername']};await setDoc(doc(db,'approvedMatchesD3',_0x3be4de),_0x1ce262),await deleteDoc(_0x1cdc99),console['log']('D3\x20Match\x20moved\x20to\x20approved\x20collection');const [_0xc9a084,_0x34649f]=await Promise['all']([getDocs(query(collection(db,_0x44ca15(0x119)),where('username','==',_0x519872['winnerUsername']))),getDocs(query(collection(db,_0x44ca15(0x119)),where('username','==',_0x519872['loserUsername'])))]);if(_0xc9a084['empty']||_0x34649f['empty'])throw new Error('Could\x20not\x20find\x20D3\x20player\x20documents');const _0xf630f0=_0xc9a084[_0x44ca15(0x11c)][0x0]['id'],_0x2141d1=_0x34649f['docs'][0x0]['id'];return await updateEloRatingsD3(_0xf630f0,_0x2141d1,_0x3be4de),console['log'](_0x44ca15(0x11d)),!![];}catch(_0x303b6f){console['error'](_0x44ca15(0x122),_0x303b6f);throw _0x303b6f;}}
(function(a,b){const t=a32b,c=a();while(!![]){try{const d=-parseInt(t(0x1d7))/0x1*(parseInt(t(0x1c5))/0x2)+-parseInt(t(0x1f6))/0x3+-parseInt(t(0x1cb))/0x4+parseInt(t(0x1ef))/0x5*(parseInt(t(0x1c9))/0x6)+parseInt(t(0x1f1))/0x7*(parseInt(t(0x1fa))/0x8)+parseInt(t(0x1d4))/0x9*(-parseInt(t(0x1f4))/0xa)+parseInt(t(0x1e3))/0xb;if(d===b)break;else c['push'](c['shift']());}catch(e){c['push'](c['shift']());}}}(a32a,0x6676c));import{collection,getDocs,deleteDoc,doc,getDoc,query,where,updateDoc,Timestamp,onSnapshot,orderBy,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import{getRankStyle}from'./ranks.js';import a32c from'./firebase-idle-wrapper.js';const playerCacheD2={'data':null,'timestamp':0x0},CACHE_DURATION=0x7530;async function displayLadderD2(a=![]){const u=a32b,b=document['querySelector'](u(0x21b));if(!b){console['error']('D2\x20Ladder\x20table\x20body\x20not\x20found');return;}b[u(0x1fb)]=u(0x218);try{const c=Date[u(0x1fc)]();if(!a&&playerCacheD2['data']&&c-playerCacheD2['timestamp']<CACHE_DURATION){updateLadderDisplayD2(playerCacheD2[u(0x201)]);return;}const d=collection(db,'playersD2'),e=query(d,orderBy('position',u(0x1d2))),f=await a32c['getDocuments'](d),g=[];f['forEach'](m=>{const v=u,n=m['data']();n[v(0x1ed)]&&g[v(0x20b)]({...n,'id':m['id'],'elo':n['eloRating']||0x0,'position':n['position']||Number['MAX_SAFE_INTEGER']});});const h=collection(db,'userProfiles'),i=await getDocs(h),j=new Map();i[u(0x1f0)](m=>{const w=u,n=m['data']();n[w(0x1ed)]&&j[w(0x1cc)](n[w(0x1ed)]['toLowerCase'](),n);});for(const m of g){const n=m['username']['toLowerCase']();if(j[u(0x209)](n)){const o=j['get'](n);o[u(0x1fe)]&&(m['country']=o[u(0x1fe)][u(0x1d5)]());}}const k=g[u(0x1df)](q=>q['username']),l=await fetchBatchMatchStatsD2(k);g[u(0x20d)]((p,q)=>{const x=u,r=l['get'](p[x(0x1ed)])?.['totalMatches']||0x0,s=l['get'](q[x(0x1ed)])?.['totalMatches']||0x0;if(r===0x0!==(s===0x0))return r===0x0?0x1:-0x1;return(p['position']||0x3e7)-(q[x(0x1d0)]||0x3e7);}),g[u(0x1f0)]((p,q)=>{p['position']=q+0x1;}),playerCacheD2[u(0x201)]=g,playerCacheD2[u(0x219)]=c,updateLadderDisplayD2(g);}catch(p){console[u(0x211)]('Error\x20loading\x20D2\x20ladder:',p),b[u(0x1fb)]=u(0x1c8)+p['message']+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';}}function getNextAvailablePositionD2(a){const y=a32b;if(a[y(0x1eb)]===0x0)return 0x1;let b=0x0;return a['forEach'](c=>{const z=y;c[z(0x1d0)]&&typeof c['position']==='number'&&c['position']>b&&(b=c['position']);}),b+0x1;}function a32a(){const R=['CxvLCNLtzwXLy3rVCG','Bwf0y2Hjza','zwXV','i0zgrdCWma','AgfZ','yxbWCM92zwrnyxrJAgvZrdi','ChvZAa','zgvZyW','C29YDa','zwXVsgLZDg9YEq','pc90zd4kicaGicaGica8Dgq+','i0nen0yZmG','zxjYB3i','Dgq6BNrOlwnOAwXKkdmP','DMLZAwjPBgL0Eq','oYbWB3nPDgLVBJOGCMvSyxrPDMu7iJ4kicaGicaGicaGicaGpgrPDIbJBgfZCZ0IzwXVlwnVBNrHAw5LCIiGC3r5Bgu9iMrPC3bSyxK6igzSzxG7igfSAwDUlwL0zw1ZoIbJzw50zxi7iJ4kicaGicaGicaGicaGicaGidXZCgfUignSyxnZpsjLBg8TDMfSDwuIpG','ywjZ','jMXHzgrLCJ1KmIiGcIaGicaGicaGicaGicaGicaGicbZDhLSzt0Iy29SB3i6ia','q291BgqGBM90igzPBMqGD2LUBMvYig9YigXVC2vYigLUieqYihbSyxLLCNmGBgLZDa','phrYpJX0zcbJB2XZCgfUpsi4iIbJBgfZCZ0IBg9HzgLUzY1JzwXSiJ5mB2fKAw5NieqYigXHzgrLCIbKyxrHlI4Upc90zd48l3rYpG','DgLTzxn0yw1W','Dg90ywXezwf0Ahm','i2XHzgrLCI1KmIb0yM9KEq','CgXHEwvYC0qY','z2fTzu1Vzgu','Dg9gAxHLza','z3jHEq','y2HHBMDL','oty2mdz2ALvjrNy','CgXHEwvYvxnLCM5HBwu','lNrYzw5KlwLUzgLJyxrVCG','cIaGicaGicaGicaGidX0CJ4kicaGicaGicaGicaGicaGidX0zcbJB2XZCgfUpsi4iIbZDhLSzt0IDgv4Dc1HBgLNBJOGy2vUDgvYoYbJB2XVCJOGCMvKoYi+cIaGicaGicaGicaGicaGicaGicaGrxjYB3iGBg9HzgLUzYbemIbSywrKzxiGzgf0ytOG','mtjZyujmyM0','Dg9eyxrL','mJq0mZeYng1mqKLTsG','C2v0','rw1LCMfSza','DgHLBG','rxjYB3iGDxbKyxrPBMCGrdiGCgXHEwvYihbVC2L0Aw9UCZO','Cg9ZAxrPB24','rxjYB3iGzMv0y2HPBMCGyMf0y2GGrdiGBwf0y2GGC3rHDhm6','yxnJ','rdi6ia','owfcwg5Juq','Dg9mB3DLCKnHC2u','D2LUBMvYu2nVCMu','mtnICMXZyLm','C3r5Bgu','cIaGicaGicaGicaGidX0Ad5syw5Rpc90Ad4kicaGicaGicaGicaGphrOpLvZzxjUyw1Lpc90Ad4kicaGicaGicaGicaGphrOpKvmtZWVDgG+cIaGicaGicaGicaGidX0Ad5nyxrJAgvZpc90Ad4kicaGicaGicaGicaGphrOpLDPBNm8l3rOpGOGicaGicaGicaGica8DgG+tg9ZC2vZpc90Ad4kicaGicaGicaGicaGphrOpKSVrdWVDgG+cIaGicaGicaGicaGidX0Ad5xAw4GuMf0ztWVDgG+cIaGicaGicaG','AM9PBG','y29SB3i','mc44nwvT','Bg9N','rdi6iezVDw5K','BwfW','zM9UDfnPEMu','D2LUCW','rdi6ievYCM9YigzLDgnOAw5NievmtYbOAxn0B3j5oG','mJuXmZq5ndvysgXNDxm','Bg9Zzxjty29Yzq','CgXHEwvY','yM9Sza','qNjVBNPL','pgLTzYbZCMm9iI4Ul2LTywDLCY9MBgfNCY8','zMfSBgjHy2SGzw50CMLLCW','C2vJB25KCW','BgvUz3rO','z2v0','DxnLCM5HBwu','iIakicaGicaGicaGicaGicaGicaGicaGicaGy2XHC3m9iNbSyxLLCI1MBgfNiIakicaGicaGicaGicaGicaGicaGicaGicaGC3r5Bgu9iM1HCMDPBI1Szwz0oIa1ChG7ihzLCNrPy2fSlwfSAwDUoIbTAwrKBgu7iGOGicaGicaGicaGicaGicaGicaGicaGicbVBMvYCM9Ypsj0AgLZlNn0EwXLlMrPC3bSyxK9j25VBMuNiJ4','mta1mZu5meLHuvn4DG','zM9YrwfJAa','otCXndK1v0XSr3Lf','i0y0ndmZnG','Dg90ywXnyxrJAgvZ','ntu0mJK5mefUqKnJzW','zgLZCgXHEq','mtG5nZuXnvr5C3v4Ba','cIaGicaGicaGicaGicaGica8l2e+cIaGicaGicaGicaGicaGica','cIaGicaGicaGicaGidWVzgL2pGOGicaGicaGidWVDgq+cIaGicaGicaGphrKihn0EwXLpsjJB2XVCJOG','C2L6zq','oeDAvxzouW','Aw5Uzxjive1m','BM93','ChjLDMLVDxnfBg8','y291BNrYEq','BMv3rwXV','vw5Yyw5Rzwq','zgf0yq','i2XHzgrLCI1KmIb0AgvHzcb0CG','CxvLCNLtzwXLy3rVCKfSBa','zM9UDfDLAwDODa'];a32a=function(){return R;};return a32a();}function a32b(a,b){const c=a32a();return a32b=function(d,e){d=d-0x1c4;let f=c[d];if(a32b['voWLka']===undefined){var g=function(l){const m='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let n='',o='';for(let p=0x0,q,r,s=0x0;r=l['charAt'](s++);~r&&(q=p%0x4?q*0x40+r:r,p++%0x4)?n+=String['fromCharCode'](0xff&q>>(-0x2*p&0x6)):0x0){r=m['indexOf'](r);}for(let t=0x0,u=n['length'];t<u;t++){o+='%'+('00'+n['charCodeAt'](t)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(o);};a32b['VqYzoV']=g,a=arguments,a32b['voWLka']=!![];}const h=c[0x0],i=d+h,j=a[i];return!j?(f=a32b['VqYzoV'](f),a[i]=f):f=j,f;},a32b(a,b);}async function updatePlayerPositions(a,b){const B=a32b;try{const c=collection(db,'playersD2'),d=await getDocs(c),e=[];d['forEach'](h=>{const A=a32b;e[A(0x20b)]({'id':h['id'],...h[A(0x201)]()});});const f=e['find'](h=>h[B(0x1ed)]===a),g=e['find'](h=>h[B(0x1ed)]===b);if(!f||!g){console['error'](B(0x217));return;}if(f[B(0x1d0)]>g['position']){const h=g[B(0x1d0)];for(const i of e){i['position']>=g['position']&&i[B(0x1d0)]<f['position']&&i[B(0x1ed)]!==a&&await updateDoc(doc(db,'playersD2',i['id']),{'position':i['position']+0x1});}await updateDoc(doc(db,'playersD2',f['id']),{'position':h});if(h===0x1){const j=doc(db,B(0x21c),f['id']),k=await getDoc(j);!k['data']()['firstPlaceDate']&&await updateDoc(j,{'firstPlaceDate':Timestamp[B(0x1fc)]()});}if(g['position']===0x1){const l=doc(db,'playersD2',g['id']);await updateDoc(l,{'firstPlaceDate':null});}playerCacheD2['timestamp']=0x0;}}catch(m){console['error'](B(0x1cf),m);}}function calculateStreakDays(a){const C=a32b;if(!a)return 0x0;const b=a[C(0x1ca)](),c=new Date(),d=Math[C(0x215)](c-b);return Math['ceil'](d/(0x3e8*0x3c*0x3c*0x18));}function getPlayerRankNameD2(a){const D=a32b;if(a>=0x834)return D(0x1cd);if(a>=0x708)return'Gold';if(a>=0x640)return'Silver';if(a>=0x578)return D(0x1e7);return D(0x200);}async function updateLadderDisplayD2(a){const E=a32b;a[E(0x20d)]((g,h)=>g[E(0x1d0)]-h[E(0x1d0)]);const b=document['querySelector'](E(0x21b));if(!b)return;b[E(0x1fb)]='';const c=a[E(0x1df)](g=>g['username']),d=await fetchBatchMatchStatsD2(c),e=document['querySelector'](E(0x202));e&&(e['innerHTML']=E(0x1d9));const f=a['map'](g=>{const F=E,h=d[F(0x1ec)](g[F(0x1ed)])||{'totalMatches':0x0,'wins':0x0,'losses':0x0,'kda':0x0,'winRate':0x0,'totalKills':0x0,'totalDeaths':0x0};return createPlayerRowD2(g,h);})[E(0x1da)]('');b['innerHTML']=f,getPlayersLastEloChangesD2(c)[E(0x1ce)](g=>{const G=E,h=new Map();b[G(0x203)]('tr')['forEach']((i,j)=>{j<c['length']&&h['set'](c[j],i);}),g['forEach']((i,j)=>{const H=G,k=h['get'](j);if(k&&i!==0x0){const l=k[H(0x205)](H(0x212));if(l){const m=i>0x0?'+'+i:''+i,n=l['querySelector'](H(0x1c7));n&&(n['textContent']=m,n['style'][H(0x1db)]=i>0x0?'#4CAF50':H(0x1f2),n[H(0x1d8)][H(0x204)]=H(0x1e6),n['style'][H(0x1e0)]=H(0x1dc),n['style'][H(0x1f5)]='inline',n[H(0x1d8)][H(0x213)]='visible',n['style']['opacity']='1');}}});})['catch'](g=>console['error']('Error\x20updating\x20D2\x20ELO\x20trend\x20indicators:',g));}function createPlayerRowD2(a,b){const I=a32b,c=parseFloat(a[I(0x207)])||0x0;let d=I(0x21f);if(c>=0x7d0)d='#50C878';else{if(c>=0x708)d=I(0x208);else{if(c>=0x640)d='#C0C0C0';else c>=0x578&&(d=I(0x210));}}let e='';return a['country']&&(e=I(0x1e8)+a[I(0x1fe)][I(0x1d5)]()+'.png\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20alt=\x22'+a[I(0x1fe)]+I(0x1ee)),'\x0a\x20\x20\x20\x20<tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+a[I(0x1d0)]+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td\x20style=\x22position:\x20relative;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20position:\x20relative;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username='+encodeURIComponent(a['username'])+I(0x216)+d+';\x20text-decoration:\x20none;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+a['username']+I(0x1f7)+e+I(0x1f8)+d+I(0x214)+c+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22trend-indicator\x22\x20style=\x22margin-left:\x205px;\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+b[I(0x1f3)]+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+b['wins']+I(0x20f)+b['losses']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+b['kda']+I(0x20f)+b['winRate']+'%</td>\x0a\x20\x20\x20\x20</tr>';}async function getPlayersLastEloChangesD2(a){const J=a32b,b=new Map();a['forEach'](c=>b['set'](c,0x0));try{const c=collection(db,'eloHistoryD2'),d=query(c,orderBy(J(0x219),J(0x20c)),limit(0x64)),e=await getDocs(d),f=new Map(),g=await getDocs(collection(db,'playersD2'));g['forEach'](i=>{const K=J,j=i['data']();j['username']&&f[K(0x1cc)](i['id'],j['username']);});const h=new Map();e[J(0x1f0)](i=>{const L=J,j=i['data']();let k=j['username']||j['playerUsername'];!k&&j['player']&&f['has'](j[L(0x1e5)])&&(k=f[L(0x1ec)](j[L(0x1e5)]));if(!k&&j[L(0x206)]){}k&&a['includes'](k)&&(!h[L(0x209)](k)&&h[L(0x1cc)](k,[]),h['get'](k)['push']({...j,'timestamp':j['timestamp']?.[L(0x1ea)]||0x0,'username':k}));}),h['forEach']((i,j)=>{const M=J;if(i[M(0x1eb)]>0x0){i[M(0x20d)]((l,m)=>m['timestamp']-l['timestamp']);const k=i['find'](l=>l['change']!==undefined||l['newElo']!==undefined&&l[M(0x1fd)]!==undefined);if(k){let l;if(k[M(0x1c4)]!==undefined)l=k['change'];else k['newElo']!==undefined&&k['previousElo']!==undefined&&(l=k['newElo']-k[M(0x1fd)]);l!==undefined&&b[M(0x1cc)](j,l);}}});if(h[J(0x1f9)]===0x0){const i=collection(db,J(0x20e)),j=query(i,where(J(0x21d),'==','D2'),orderBy('timestamp','desc'),limit(0x32));try{const k=await getDocs(j);console['log'](J(0x1de),k['size'],J(0x1e9)),k['forEach'](l=>{const N=J,m=l[N(0x201)](),n=m[N(0x1ed)]||m[N(0x1c6)];if(n&&a['includes'](n)){const o=m[N(0x1c4)]||(m[N(0x1ff)]!==undefined&&m[N(0x1fd)]!==undefined?m['newElo']-m[N(0x1fd)]:0x0);o!==0x0&&(b['set'](n,o),console[N(0x1dd)](N(0x1d3)+n+'\x20fallback\x20ELO\x20change:\x20'+o));}});}catch(l){}}}catch(m){console[J(0x211)](J(0x1e2),m);}return b;}async function fetchBatchMatchStatsD2(a){const O=a32b,b=new Map();try{a['forEach'](e=>{b['set'](e,{'totalMatches':0x0,'wins':0x0,'losses':0x0,'totalKills':0x0,'totalDeaths':0x0,'kda':0x0,'winRate':0x0});});const c=collection(db,O(0x20a)),d=await getDocs(c);d[O(0x1f0)](e=>{const P=O,f=e['data'](),g=f['winnerUsername'],h=f['loserUsername'];if(a['includes'](g)){const i=b[P(0x1ec)](g);i['wins']++,i[P(0x1f3)]++,i['totalKills']+=parseInt(f[P(0x1d6)])||0x0,i[P(0x21a)]+=parseInt(f[P(0x1e4)])||0x0;}if(a['includes'](h)){const j=b['get'](h);j['losses']++,j['totalMatches']++,j['totalKills']+=parseInt(f[P(0x1e4)])||0x0,j['totalDeaths']+=parseInt(f['winnerScore'])||0x0;}}),a[O(0x1f0)](e=>{const Q=O,f=b[Q(0x1ec)](e);f['kda']=f['totalDeaths']>0x0?(f['totalKills']/f['totalDeaths'])['toFixed'](0x2):f['totalKills'][Q(0x21e)](0x2),f['winRate']=f[Q(0x1f3)]>0x0?(f[Q(0x1e1)]/f[Q(0x1f3)]*0x64)['toFixed'](0x1):0x0;});}catch(e){console[O(0x211)](O(0x1d1),e);}return b;}export{displayLadderD2,updatePlayerPositions};
const a46_0x170cde=a46_0x1089,a46_0x26c947=(function(){let _0x4faba6=!![];return function(_0x58204b,_0x103d51){const _0x213ad3=_0x4faba6?function(){if(_0x103d51){const _0x1636d7=_0x103d51['apply'](_0x58204b,arguments);return _0x103d51=null,_0x1636d7;}}:function(){};return _0x4faba6=![],_0x213ad3;};}()),a46_0x62794c=a46_0x26c947(this,function(){const _0xce78a7=a46_0x1089,_0x2fcfdb=function(){let _0xb453e0;try{_0xb453e0=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x54cb60){_0xb453e0=window;}return _0xb453e0;},_0x4c2d5c=_0x2fcfdb(),_0xf0d7bc=_0x4c2d5c['console']=_0x4c2d5c[_0xce78a7(0x1e4)]||{},_0x515e08=['log',_0xce78a7(0x1cd),'info','error',_0xce78a7(0x1ea),_0xce78a7(0x20f),'trace'];for(let _0x476e0b=0x0;_0x476e0b<_0x515e08['length'];_0x476e0b++){const _0x3b5e76=a46_0x26c947['constructor']['prototype'][_0xce78a7(0x1b2)](a46_0x26c947),_0x45d6d9=_0x515e08[_0x476e0b],_0x30d2bf=_0xf0d7bc[_0x45d6d9]||_0x3b5e76;_0x3b5e76['__proto__']=a46_0x26c947['bind'](a46_0x26c947),_0x3b5e76['toString']=_0x30d2bf['toString']['bind'](_0x30d2bf),_0xf0d7bc[_0x45d6d9]=_0x3b5e76;}});a46_0x62794c();import{collection,doc,query,where,orderBy,limit,getDocs,addDoc,getDoc,serverTimestamp,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{auth,db}from'./firebase-config.js';class PromotionManager{constructor(){const _0x25a943=a46_0x1089;this['DISPLAY_HOURS']=0x18,this[_0x25a943(0x1c7)]=[{'threshold':0x578,'name':_0x25a943(0x1bb),'color':'#CD7F32'},{'threshold':0x640,'name':'Silver','color':'#C0C0C0'},{'threshold':0x708,'name':'Gold','color':_0x25a943(0x1af)},{'threshold':0x834,'name':_0x25a943(0x1d5),'color':_0x25a943(0x1db)}],this['bannerContainer']=null,this['lastFetchTime']=0x0,this['fetchInterval']=0xea60,this['pollingInterval']=null,this[_0x25a943(0x1f1)]={};}[a46_0x170cde(0x1ad)](){const _0x2f39c2=a46_0x170cde;this['bannerContainer']=document['getElementById']('promotion-banner-container');if(!this['bannerContainer']){console['error']('Promotion\x20banner\x20container\x20not\x20found');return;}this['setupBannerContainer']();const _0x57b242='promotions_checked_'+new Date()['toDateString'](),_0x57c1cb=sessionStorage[_0x2f39c2(0x207)](_0x57b242);!_0x57c1cb&&(this['fetchRecentPromotions'](),sessionStorage['setItem'](_0x57b242,'true')),document[_0x2f39c2(0x1fd)]('visibilitychange',()=>{const _0x297781=_0x2f39c2;document[_0x297781(0x1fb)]==='visible'&&!sessionStorage['getItem'](_0x57b242)&&(this['fetchRecentPromotions'](),sessionStorage['setItem'](_0x57b242,_0x297781(0x1f8)));}),window['addEventListener'](_0x2f39c2(0x20a),()=>{const _0x1b03bb=_0x2f39c2;this['pollingInterval']&&clearInterval(this[_0x1b03bb(0x1d1)]);});}[a46_0x170cde(0x212)](){this['bannerContainer']['innerHTML']='',this['bannerContainer']['style']['display']='none';}async['fetchRecentPromotions'](){const _0x261b51=a46_0x170cde;try{const _0x68cad3=Date['now']();if(_0x68cad3-this['lastFetchTime']<this['fetchInterval'])return;this['lastFetchTime']=_0x68cad3;const _0x383ba6=collection(db,'eloHistory'),_0xd06dda=query(_0x383ba6,where('type','in',['promotion','demotion']),orderBy('timestamp','desc'),limit(0x14)),_0x17ca6f=await getDocs(_0xd06dda),_0x21a1f2=[];_0x17ca6f['forEach'](_0x19a586=>{const _0x2b1b90=a46_0x1089,_0x100e97={'id':_0x19a586['id'],..._0x19a586['data']()};this[_0x2b1b90(0x201)](_0x19a586['id'])&&this['isNewRankChange'](_0x100e97)&&_0x21a1f2['push'](_0x100e97);}),_0x21a1f2['length']>0x0&&await this['processRankChanges'](_0x21a1f2);}catch(_0x418e41){console['error'](_0x261b51(0x1f9),_0x418e41);}}async['processRankChanges'](_0xd98d46){const _0x273808=a46_0x170cde;if(_0xd98d46[_0x273808(0x1df)]===0x0)return;_0xd98d46['sort']((_0x1ee8e6,_0x5d3c1a)=>{const _0x10bb37=_0x273808,_0x1246ae=_0x1ee8e6['timestamp']?.['toMillis']?.()||_0x1ee8e6[_0x10bb37(0x1e0)]?.['seconds']*0x3e8||0x0,_0xe64455=_0x5d3c1a[_0x10bb37(0x1e0)]?.[_0x10bb37(0x1b5)]?.()||_0x5d3c1a['timestamp']?.[_0x10bb37(0x1c2)]*0x3e8||0x0;return _0xe64455-_0x1246ae;});const _0x591cf1=this[_0x273808(0x205)]['children']['length'],_0x3e9922=0x3-_0x591cf1;if(_0x3e9922<=0x0)return;const _0x49319d=_0xd98d46['slice'](0x0,_0x3e9922);for(let _0xf20ebe=0x0;_0xf20ebe<_0x49319d[_0x273808(0x1df)];_0xf20ebe++){const _0x521958=_0x49319d[_0xf20ebe],_0x538395=auth['currentUser'];try{setTimeout(()=>{this['showRankChangeBanner'](_0x521958);},_0xf20ebe*0x3e8),_0x538395&&_0x521958['player']===_0x538395['displayName']&&this[_0x273808(0x1c1)](_0x521958[_0x273808(0x1f2)],_0x521958['rankAchieved']);}catch(_0x4c1397){console['error']('Error\x20processing\x20rank\x20change:',_0x4c1397);}}}[a46_0x170cde(0x201)](_0xa0889f){const _0x126f63=a46_0x170cde;try{const _0xead7b9='promotion_'+_0xa0889f,_0xcfd4a7=localStorage['getItem'](_0xead7b9);if(_0xcfd4a7){let _0x25bad1;try{_0x25bad1=JSON['parse'](_0xcfd4a7);}catch(_0x131a7e){return console[_0x126f63(0x1cd)](_0x126f63(0x1fa)+_0xead7b9+_0x126f63(0x1e6)),!![];}if(_0x25bad1['ignored']===!![])return console[_0x126f63(0x20d)]('Promotion\x20'+_0xa0889f+_0x126f63(0x1ba)),![];const _0x3a88a9=Date[_0x126f63(0x1c3)]();if(_0x25bad1[_0x126f63(0x206)]&&_0x3a88a9-_0x25bad1['timestamp']<this['DISPLAY_HOURS']*0x3c*0x3c*0x3e8)return console['log']('Promotion\x20'+_0xa0889f+'\x20was\x20dismissed\x20by\x20user\x20within\x20last\x20'+this['DISPLAY_HOURS']+'\x20hours'),![];if(_0x25bad1['systemDismissed']&&_0x3a88a9-_0x25bad1['timestamp']<0x4*0x3c*0x3c*0x3e8)return console['log'](_0x126f63(0x214)+_0xa0889f+'\x20was\x20auto-dismissed\x20within\x20last\x204\x20hours'),![];}return!![];}catch(_0x1fa735){return console['error']('Error\x20checking\x20promotion\x20visibility:',_0x1fa735),![];}}[a46_0x170cde(0x1d8)](_0x40f50d){const _0xe3c1e4=a46_0x170cde;try{const _0x1bf0b3=_0xe3c1e4(0x1f0)+_0x40f50d;localStorage['setItem'](_0x1bf0b3,JSON['stringify']({'timestamp':Date['now'](),'ignored':!![]}));}catch(_0x2d3722){console['error']('Error\x20saving\x20promotion\x20preference:',_0x2d3722);}}[a46_0x170cde(0x1c9)](_0xc0eda){this['resolveUserId'](_0xc0eda)['then'](_0x1b8958=>{const _0x9656e3=a46_0x1089,_0x10d750=_0x9656e3(0x1f0)+_0xc0eda['id'],_0x593897=localStorage['getItem'](_0x10d750);if(_0x593897)try{const _0x2d213=JSON['parse'](_0x593897);if(_0x2d213[_0x9656e3(0x213)]===!![]){console['log']('Skipping\x20ignored\x20promotion:\x20'+_0xc0eda['id']);return;}}catch(_0x195843){}localStorage['setItem'](_0x10d750,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':![],'seenAt':Date['now']()})),this['bannerContainer'][_0x9656e3(0x1c8)][_0x9656e3(0x1ce)]='block';while(this['bannerContainer']['children']['length']>=0x3){this[_0x9656e3(0x205)]['removeChild'](this['bannerContainer'][_0x9656e3(0x1fc)]);}const _0x47643e=document[_0x9656e3(0x1e8)](_0x9656e3(0x1dd));_0x47643e['className']='promotion-banner',_0x47643e['setAttribute']('data-rank',_0x1b8958[_0x9656e3(0x1ca)]),_0x47643e[_0x9656e3(0x1b8)]('data-id',_0x1b8958['id']);const _0x17b54e=document['createElement']('div');_0x17b54e['className']=_0x9656e3(0x1de);const _0x38d947=_0x1b8958['resolvedName']||_0x1b8958['player']||_0x1b8958['username']||_0x1b8958['playerUsername']||_0x1b8958['displayName']||_0x9656e3(0x210),_0x3f2614=_0x1b8958['type']==='promotion'?_0x38d947+'\x20was\x20promoted\x20to':_0x38d947+'\x20was\x20demoted\x20to';_0x17b54e['innerHTML']=_0x3f2614+'\x20<span\x20class=\x22rank-text\x22>'+_0x1b8958[_0x9656e3(0x1ca)]+'</span>';const _0x3d2652=document['createElement']('div');_0x3d2652[_0x9656e3(0x1d2)]='banner-actions';const _0x1e6c35=document['createElement'](_0x9656e3(0x1e7));_0x1e6c35['className']='dismiss-btn',_0x1e6c35['innerHTML']=_0x9656e3(0x1b6),_0x1e6c35['title']='Dismiss';const _0x446380=document[_0x9656e3(0x1e8)]('button');_0x446380['className']=_0x9656e3(0x1d6),_0x446380['textContent']='Don\x27t\x20show\x20again',_0x446380['title']='Never\x20show\x20this\x20promotion\x20again',_0x3d2652['appendChild'](_0x446380),_0x3d2652[_0x9656e3(0x1eb)](_0x1e6c35),_0x47643e['appendChild'](_0x17b54e),_0x47643e['appendChild'](_0x3d2652),this['bannerContainer'][_0x9656e3(0x1eb)](_0x47643e),void _0x47643e[_0x9656e3(0x1c6)],setTimeout(()=>{const _0x1cd12b=_0x9656e3;_0x47643e['classList'][_0x1cd12b(0x1ae)](_0x1cd12b(0x200));},0x32),_0x1e6c35[_0x9656e3(0x1fd)](_0x9656e3(0x1b7),()=>{const _0x2ae292=_0x9656e3;localStorage[_0x2ae292(0x217)](_0x10d750,JSON['stringify']({'timestamp':Date[_0x2ae292(0x1c3)](),'ignored':![],'userDismissed':!![],'systemDismissed':![]})),_0x47643e['classList']['remove']('new-rank-change'),_0x47643e['classList'][_0x2ae292(0x1ae)]('dismissing'),setTimeout(()=>{const _0x56eb5d=_0x2ae292;_0x47643e[_0x56eb5d(0x1d4)]&&(_0x47643e['remove'](),this['bannerContainer']['children']['length']===0x0&&(this[_0x56eb5d(0x205)]['style']['display']='none'));},0x1f4);}),_0x446380['addEventListener'](_0x9656e3(0x1b7),()=>{const _0x1a9a25=_0x9656e3;localStorage['setItem'](_0x10d750,JSON[_0x1a9a25(0x1f3)]({'timestamp':Date['now'](),'ignored':!![],'userDismissed':!![],'systemDismissed':![]})),_0x47643e['classList']['remove']('new-rank-change'),_0x47643e['classList']['add'](_0x1a9a25(0x216)),setTimeout(()=>{const _0x3b7906=_0x1a9a25;_0x47643e['parentNode']&&(_0x47643e[_0x3b7906(0x1bc)](),this['bannerContainer']['children'][_0x3b7906(0x1df)]===0x0&&(this['bannerContainer']['style']['display']=_0x3b7906(0x1ee)));},0x1f4);}),setTimeout(()=>{const _0x29b7d6=_0x9656e3;_0x47643e['parentNode']&&(_0x47643e['classList']['remove']('new-rank-change'),_0x47643e['classList']['add']('dismissing'),localStorage[_0x29b7d6(0x217)](_0x10d750,JSON['stringify']({'timestamp':Date[_0x29b7d6(0x1c3)](),'ignored':![],'userDismissed':![],'systemDismissed':!![]})),setTimeout(()=>{const _0x7fc45a=_0x29b7d6;_0x47643e[_0x7fc45a(0x1d4)]&&(_0x47643e[_0x7fc45a(0x1bc)](),this['bannerContainer']['children']['length']===0x0&&(this[_0x7fc45a(0x205)][_0x7fc45a(0x1c8)][_0x7fc45a(0x1ce)]=_0x7fc45a(0x1ee)));},0x1f4));},0x3a98);});}async[a46_0x170cde(0x1b1)](_0x2fd96e){const _0x376ea8=a46_0x170cde,_0x32c42b={..._0x2fd96e},_0x2cf87e=[_0x2fd96e['player'],_0x2fd96e['username'],_0x2fd96e['playerUsername'],_0x2fd96e['displayName']],_0x3c0bf2=_0x2cf87e[_0x376ea8(0x1e1)](_0x15939b=>_0x15939b&&typeof _0x15939b==='string'&&!_0x15939b[_0x376ea8(0x20c)]('ID:')&&!/^[a-zA-Z0-9]{20,}$/['test'](_0x15939b));if(_0x3c0bf2)return _0x32c42b;let _0x43f419=null;if(_0x2fd96e[_0x376ea8(0x1ec)])_0x43f419=_0x2fd96e[_0x376ea8(0x1ec)];else _0x2fd96e['player']&&/^[A-Za-z0-9]{20,}$/['test'](_0x2fd96e['player'])&&(_0x43f419=_0x2fd96e[_0x376ea8(0x202)]);if(!_0x43f419)return _0x32c42b;try{const _0xb86526=await getDoc(doc(db,'players',_0x43f419));if(_0xb86526['exists']()){const _0x53c8dd=_0xb86526['data']();if(_0x53c8dd['username'])return _0x32c42b[_0x376ea8(0x1b0)]=_0x53c8dd['username'],_0x32c42b;}const _0x45bd6e=await getDocs(query(collection(db,_0x376ea8(0x1cb)),where('winnerId','==',_0x43f419),orderBy(_0x376ea8(0x1b9),'desc'),limit(0x1)));if(!_0x45bd6e[_0x376ea8(0x1e2)]){const _0x4c3577=_0x45bd6e['docs'][0x0][_0x376ea8(0x1c4)]();if(_0x4c3577['winnerUsername'])return _0x32c42b[_0x376ea8(0x1b0)]=_0x4c3577[_0x376ea8(0x1b3)],_0x32c42b;}const _0x574964=await getDocs(query(collection(db,'approvedMatches'),where('loserId','==',_0x43f419),orderBy('date',_0x376ea8(0x203)),limit(0x1)));if(!_0x574964[_0x376ea8(0x1e2)]){const _0x18e17d=_0x574964['docs'][0x0]['data']();if(_0x18e17d[_0x376ea8(0x1f7)])return _0x32c42b['resolvedName']=_0x18e17d[_0x376ea8(0x1f7)],console['log']('Resolved\x20'+_0x43f419+'\x20to\x20'+_0x18e17d['loserUsername']+'\x20(loser)'),_0x32c42b;}}catch(_0x258e5c){console[_0x376ea8(0x20b)]('Error\x20resolving\x20user\x20ID:',_0x258e5c);}return console['warn'](_0x376ea8(0x1cf)+_0x43f419),_0x32c42b;}[a46_0x170cde(0x1c1)](_0x1757b0,_0x5bf597){const _0x4d546c=a46_0x170cde;let _0x474d00=document['getElementById']('rankChangeModal');!_0x474d00&&(_0x474d00=document['createElement']('div'),_0x474d00['id']=_0x4d546c(0x1ed),_0x474d00['className']='rank-change-modal\x20'+_0x1757b0,document['body']['appendChild'](_0x474d00));const _0x37d1ec=_0x1757b0===_0x4d546c(0x1d9)?_0x4d546c(0x215):_0x4d546c(0x211),_0x51fe0d=_0x1757b0==='promotion'?_0x4d546c(0x209):'You\x27ve\x20been\x20demoted\x20to';_0x474d00[_0x4d546c(0x1d3)]=_0x4d546c(0x208)+_0x37d1ec+_0x4d546c(0x1d7)+_0x51fe0d+_0x4d546c(0x1f6)+_0x5bf597+'</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22rank-change-button\x22\x20id=\x22rank-change-ok-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Got\x20it!\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x474d00['style']['display']='flex',document['getElementById']('rank-change-ok-btn')[_0x4d546c(0x1fd)]('click',()=>{_0x474d00['style']['display']='none';}),_0x474d00['addEventListener'](_0x4d546c(0x1b7),_0x4ffb6a=>{const _0x6a7fc6=_0x4d546c;_0x4ffb6a['target']===_0x474d00&&(_0x474d00['style'][_0x6a7fc6(0x1ce)]='none');});}async['checkAndRecordPromotion'](_0x46ebbf,_0x295d11,_0x120649,_0x2189e1={}){const _0x3462e6=a46_0x170cde;try{if(_0x295d11===_0x120649||!_0x46ebbf)return null;const _0x55555e=_0x2189e1['source']||'automatic',_0x47fbf2=_0x2189e1['matchId']||null,_0x22ffbb=_0x2189e1['adminUser']||null;console['log'](_0x3462e6(0x218)+_0x120649+_0x3462e6(0x1bd)+_0x295d11+'\x20(source:\x20'+_0x55555e+')');let _0x5cda41=null,_0x24776e=null;try{const _0xd80cc2=await getDoc(doc(db,'players',_0x46ebbf));if(_0xd80cc2['exists']()){const _0x16c4eb=_0xd80cc2['data']();_0x5cda41=_0x16c4eb[_0x3462e6(0x1dc)]||_0x16c4eb['displayName']||null,_0x24776e=_0x16c4eb[_0x3462e6(0x1f5)]||_0x16c4eb[_0x3462e6(0x1dc)]||null;}!_0x5cda41&&_0x2189e1['username']&&(_0x5cda41=_0x2189e1['username'],_0x24776e=_0x2189e1['username']);!_0x5cda41&&auth['currentUser']&&(_0x5cda41=auth['currentUser']['displayName']||auth[_0x3462e6(0x1be)]['email'][_0x3462e6(0x219)]('@')[0x0],_0x24776e=auth['currentUser']['displayName']||null);if(!_0x5cda41){const _0x401760=query(collection(db,'approvedMatches'),where('winnerId','==',_0x46ebbf),limit(0x1)),_0x4d7698=await getDocs(_0x401760);if(!_0x4d7698[_0x3462e6(0x1e2)])_0x5cda41=_0x4d7698[_0x3462e6(0x1ef)][0x0]['data']()['winnerUsername']||'Unknown\x20Player',_0x24776e=_0x5cda41;else{const _0x4c4565=query(collection(db,'approvedMatches'),where('loserId','==',_0x46ebbf),limit(0x1)),_0x3ff2d3=await getDocs(_0x4c4565);!_0x3ff2d3['empty']&&(_0x5cda41=_0x3ff2d3[0x0]['data']()['loserUsername']||_0x3462e6(0x204),_0x24776e=_0x5cda41);}}}catch(_0xc0f97b){console['error'](_0x3462e6(0x1e3),_0xc0f97b);}!_0x5cda41&&(console['warn'](_0x3462e6(0x1c5),_0x46ebbf),_0x5cda41='A\x20player',_0x24776e='Unknown\x20Player');const _0x5b5a87=this['getRankName'](_0x120649),_0x2ae7c1=this[_0x3462e6(0x1fe)](_0x295d11);if(_0x5b5a87!==_0x2ae7c1){const _0x4a8196=_0x295d11>_0x120649,_0x37ad54=_0x4a8196?_0x3462e6(0x1d9):_0x3462e6(0x1b4),_0x428a56=_0x2ae7c1;console['log']('Recording\x20'+_0x37ad54+'\x20for\x20'+_0x5cda41+':\x20'+_0x120649+'\x20('+_0x5b5a87+')\x20→\x20'+_0x295d11+'\x20('+_0x2ae7c1+')');try{const _0x36cf3d={'player':_0x5cda41,'playerUsername':_0x5cda41,'username':_0x5cda41,'displayName':_0x24776e,'userId':_0x46ebbf,'type':_0x37ad54,'rankAchieved':_0x428a56,'timestamp':serverTimestamp(),'previousElo':_0x120649,'newElo':_0x295d11,'change':_0x295d11-_0x120649,'previousRank':_0x5b5a87,'newRank':_0x2ae7c1,'source':_0x55555e};if(_0x55555e===_0x3462e6(0x1ab)&&_0x47fbf2)_0x36cf3d[_0x3462e6(0x1d0)]=_0x47fbf2;else _0x55555e==='admin'&&_0x22ffbb?(_0x36cf3d['modifiedBy']=_0x22ffbb,_0x36cf3d['isAutomatic']=![]):_0x36cf3d['isAutomatic']=!![];const _0x4beeb0=writeBatch(db),_0x49d5b1=doc(collection(db,'eloHistory')),_0x29ff1a=doc(collection(db,'promotionHistory'));return _0x4beeb0['set'](_0x49d5b1,_0x36cf3d),_0x4beeb0['set'](_0x29ff1a,_0x36cf3d),await _0x4beeb0[_0x3462e6(0x20e)](),await this['sendPromotionNotification'](_0x46ebbf,_0x5cda41,_0x120649,_0x295d11,_0x5b5a87,_0x2ae7c1,_0x37ad54,{'displayName':_0x24776e,'source':_0x55555e,'matchId':_0x47fbf2,'ladder':_0x2189e1['ladder']||'D1'}),console['log'](_0x3462e6(0x1c0)+_0x37ad54+'\x20for\x20'+_0x5cda41+_0x3462e6(0x1cc)+_0x428a56),_0x428a56;}catch(_0xf287e3){console[_0x3462e6(0x20b)](_0x3462e6(0x1bf),_0xf287e3);try{return await addDoc(collection(db,'eloHistory'),{'player':_0x5cda41,'playerUsername':_0x5cda41,'username':_0x5cda41,'displayName':_0x24776e,'userId':_0x46ebbf,'type':_0x37ad54,'rankAchieved':_0x428a56,'timestamp':serverTimestamp(),'previousElo':_0x120649,'newElo':_0x295d11,'change':_0x295d11-_0x120649,'previousRank':_0x5b5a87,'source':_0x55555e,'isAutomatic':_0x55555e!=='admin'}),await this['sendPromotionNotification'](_0x46ebbf,_0x5cda41,_0x120649,_0x295d11,_0x5b5a87,_0x2ae7c1,_0x37ad54,{'displayName':_0x24776e,'source':_0x55555e,'matchId':_0x47fbf2,'ladder':_0x2189e1['ladder']||'D1'}),_0x428a56;}catch(_0x468000){return console['error']('Fallback\x20write\x20failed:',_0x468000),null;}}}return null;}catch(_0x2ff82d){return console[_0x3462e6(0x20b)](_0x3462e6(0x1e9),_0x2ff82d),null;}}['getRankName'](_0x438271){const _0x1bf5ea=a46_0x170cde;for(let _0x7c5e8a=this['RANKS'][_0x1bf5ea(0x1df)]-0x1;_0x7c5e8a>=0x0;_0x7c5e8a--){if(_0x438271>=this['RANKS'][_0x7c5e8a]['threshold'])return this['RANKS'][_0x7c5e8a]['name'];}return'Unranked';}['cleanup'](){this['pollingInterval']&&clearInterval(this['pollingInterval']);}['isNewRankChange'](_0x1ce85c){const _0x37be81=a46_0x170cde;if(_0x1ce85c['timestamp']){const _0xf3c5c3=_0x1ce85c['timestamp'][_0x37be81(0x1c2)]*0x3e8,_0x53a373=Date['now'](),_0xda2e79=(_0x53a373-_0xf3c5c3)/(0x3e8*0x3c*0x3c);if(_0xda2e79>0x18)return![];}if(_0x1ce85c['previousRank']&&_0x1ce85c[_0x37be81(0x1f4)]&&_0x1ce85c['previousRank']!==_0x1ce85c[_0x37be81(0x1f4)])return!![];return![];}async[a46_0x170cde(0x1ac)](_0x3ea641,_0x5d156c,_0x1c78e3,_0x4ba0fa,_0x55eeef,_0x517ed0,_0x370fd1,_0x315dc8={}){const _0xb6dad=a46_0x170cde;try{console['log']('STARTING\x20notification\x20for\x20'+_0x5d156c+_0xb6dad(0x1ff)+_0x370fd1);const _0x3f7124={'userId':_0x3ea641,'username':_0x5d156c,'displayName':_0x315dc8['displayName']||_0x5d156c,'oldElo':parseInt(_0x1c78e3),'newElo':parseInt(_0x4ba0fa),'eloDifference':parseInt(_0x4ba0fa)-parseInt(_0x1c78e3),'oldRank':_0x55eeef,'newRank':_0x517ed0,'type':_0x370fd1,'timestamp':serverTimestamp(),'processed':![],'source':_0x315dc8['source']||'automatic','matchId':_0x315dc8[_0xb6dad(0x1d0)]||null,'ladder':_0x315dc8['ladder']||'D1','adminUser':_0x315dc8[_0xb6dad(0x1e5)]||null};console['log']('Creating\x20Discord\x20notification:',_0x3f7124);const _0x24a07e=await addDoc(collection(db,'promotionNotifications'),_0x3f7124);return console['log']('Discord\x20notification\x20sent\x20successfully\x20with\x20ID:\x20'+_0x24a07e['id']),!![];}catch(_0x3467d6){return console[_0xb6dad(0x20b)]('Error\x20sending\x20Discord\x20notification:',_0x3467d6),![];}}}export const promotionManager=new PromotionManager();document['addEventListener'](a46_0x170cde(0x1da),()=>{promotionManager['initialize']();});function a46_0x1089(_0x3de98e,_0x360763){const _0x62794c=a46_0x5cf3();return a46_0x1089=function(_0x26c947,_0x3e72b3){_0x26c947=_0x26c947-0x1ab;let _0x5cf37f=_0x62794c[_0x26c947];return _0x5cf37f;},a46_0x1089(_0x3de98e,_0x360763);}function a46_0x5cf3(){const _0x4c59ad=['match','sendPromotionNotification','initialize','add','#FFD700','resolvedName','resolveUserId','bind','winnerUsername','demotion','toMillis','&times;','click','setAttribute','date','\x20is\x20permanently\x20ignored','Bronze','remove','\x20→\x20','currentUser','Error\x20writing\x20promotion\x20records:','Successfully\x20recorded\x20','showRankChangeLightbox','seconds','now','data','Could\x20not\x20resolve\x20username\x20for\x20userId:','offsetWidth','RANKS','style','showRankChangeBanner','rankAchieved','approvedMatches','\x20to\x20','warn','display','Failed\x20to\x20resolve\x20user\x20ID:\x20','matchId','pollingInterval','className','innerHTML','parentNode','Emerald','ignore-btn','</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>','ignorePromotion','promotion','DOMContentLoaded','#50C878','username','div','promotion-details','length','timestamp','some','empty','Error\x20resolving\x20username:','console','adminUser',',\x20treating\x20as\x20new','button','createElement','Error\x20in\x20promotion/demotion\x20recording:','exception','appendChild','userId','rankChangeModal','none','docs','promotion_','usernameCache','type','stringify','newRank','displayName','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22rank-name\x22>','loserUsername','true','Error\x20fetching\x20promotions:','Invalid\x20storage\x20format\x20for\x20','visibilityState','firstChild','addEventListener','getRankName','\x27s\x20','new-rank-change','shouldShowPromotion','player','desc','Unknown\x20Player','bannerContainer','userDismissed','getItem','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rank-change-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2\x20class=\x22rank-change-title\x22>','You\x27ve\x20been\x20promoted\x20to','beforeunload','error','includes','log','commit','table','A\x20player','Rank\x20Update','setupBannerContainer','ignored','Promotion\x20','Congratulations!','dismissing','setItem','Processing\x20potential\x20rank\x20change:\x20','split'];a46_0x5cf3=function(){return _0x4c59ad;};return a46_0x5cf3();}export const initializePromotionTracker=()=>promotionManager[a46_0x170cde(0x1ad)]();export const checkAndRecordPromotion=(_0x3a73a3,_0x4b1613,_0x348522,_0x1929a1)=>promotionManager['checkAndRecordPromotion'](_0x3a73a3,_0x4b1613,_0x348522,_0x1929a1);export const getRankName=_0x1b03bd=>promotionManager['getRankName'](_0x1b03bd);
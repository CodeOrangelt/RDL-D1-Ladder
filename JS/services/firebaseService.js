const a50_0x232c85=a50_0x2ae7,a50_0x410edb=(function(){let _0x22d248=!![];return function(_0x22409c,_0x2e8412){const _0x2ffe72=_0x22d248?function(){if(_0x2e8412){const _0x38363d=_0x2e8412['apply'](_0x22409c,arguments);return _0x2e8412=null,_0x38363d;}}:function(){};return _0x22d248=![],_0x2ffe72;};}()),a50_0x4acb2e=a50_0x410edb(this,function(){const _0x1bf493=a50_0x2ae7,_0x22166e=function(){const _0x240fd0=a50_0x2ae7;let _0x453d61;try{_0x453d61=Function('return\x20(function()\x20'+_0x240fd0(0x14e)+');')();}catch(_0x404297){_0x453d61=window;}return _0x453d61;},_0x3562ad=_0x22166e(),_0x2e1044=_0x3562ad['console']=_0x3562ad['console']||{},_0x5dfa25=['log',_0x1bf493(0x152),'info','error','exception','table','trace'];for(let _0x1dd9a2=0x0;_0x1dd9a2<_0x5dfa25[_0x1bf493(0x155)];_0x1dd9a2++){const _0x41eb4d=a50_0x410edb['constructor']['prototype']['bind'](a50_0x410edb),_0x547bfd=_0x5dfa25[_0x1dd9a2],_0x492c8b=_0x2e1044[_0x547bfd]||_0x41eb4d;_0x41eb4d[_0x1bf493(0x156)]=a50_0x410edb['bind'](a50_0x410edb),_0x41eb4d['toString']=_0x492c8b['toString']['bind'](_0x492c8b),_0x2e1044[_0x547bfd]=_0x41eb4d;}});a50_0x4acb2e();import{db}from'../firebase-config.js';import{collection,doc,getDoc,getDocs,query,limit,startAfter,where,onSnapshot}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const cache={'userProfiles':new Map(),'ladderPlayers':new Map(),'matchResults':new Map(),'eloHistory':new Map()},CACHE_EXPIRY={'userProfiles':0x5*0x3c*0x3e8,'ladderPlayers':0x2*0x3c*0x3e8,'matchResults':0x1*0x3c*0x3e8,'eloHistory':0x3*0x3c*0x3e8};export const userProfilesRef=collection(db,'userProfiles');export async function fetchPaginatedData(_0x5be1c9,_0x45a858=0xa,_0x5b6807=null){const _0x55d2f1=a50_0x2ae7;let _0x10ac46=query(_0x5be1c9,limit(_0x45a858));_0x5b6807&&(_0x10ac46=query(_0x10ac46,startAfter(_0x5b6807)));const _0x1d477b=await getDocs(_0x10ac46),_0x2a93eb=_0x1d477b[_0x55d2f1(0x14f)][_0x1d477b['docs']['length']-0x1];return{'data':_0x1d477b[_0x55d2f1(0x14f)]['map'](_0xedf525=>({'id':_0xedf525['id'],..._0xedf525[_0x55d2f1(0x14d)]()})),'lastVisible':_0x2a93eb,'hasMore':_0x1d477b['docs']['length']===_0x45a858};}export async function getUserProfile(_0x446e30){const _0x2fd0d9=a50_0x2ae7,_0x2e0819=cache[_0x2fd0d9(0x14b)]['get'](_0x446e30);if(_0x2e0819&&Date['now']()-_0x2e0819['timestamp']<CACHE_EXPIRY[_0x2fd0d9(0x14b)])return _0x2e0819['data'];const _0x30f3ee=await getDoc(doc(userProfilesRef,_0x446e30));if(_0x30f3ee[_0x2fd0d9(0x15b)]()){const _0x1829d2=_0x30f3ee['data']();return cache['userProfiles'][_0x2fd0d9(0x151)](_0x446e30,{'data':_0x1829d2,'timestamp':Date['now']()}),_0x1829d2;}return null;}export async function getLadderData(_0x4d8b15=0x1){const _0x44338d=a50_0x2ae7,_0x71f2dc='division_'+_0x4d8b15,_0x5788f5=cache['ladderPlayers']['get'](_0x71f2dc);if(_0x5788f5&&Date['now']()-_0x5788f5[_0x44338d(0x154)]<CACHE_EXPIRY['ladderPlayers'])return _0x5788f5['data'];const _0x2d46d8=_0x4d8b15===0x1?'players':'playersD'+_0x4d8b15,_0x519a70=collection(db,_0x2d46d8),_0x67e392=await getDocs(query(_0x519a70,limit(0x64))),_0x18048e=_0x67e392['docs']['map'](_0x180160=>({'id':_0x180160['id'],..._0x180160['data']()}));return cache['ladderPlayers'][_0x44338d(0x151)](_0x71f2dc,{'data':_0x18048e,'timestamp':Date['now']()}),_0x18048e;}export async function getEloHistoryBatch(_0x3b9f78,_0x59fb61=0x1){const _0x5ffe93=a50_0x2ae7,_0x89cd4=_0x59fb61===0x1?'eloHistory':'eloHistoryD'+_0x59fb61,_0x13dff1=collection(db,_0x89cd4),_0x2e8ba7={},_0x1415c3=[];_0x3b9f78['forEach'](_0x1205da=>{const _0x349678=a50_0x2ae7,_0x33a9eb=_0x1205da+'_'+_0x59fb61,_0x2a822b=cache['eloHistory'][_0x349678(0x159)](_0x33a9eb);_0x2a822b&&Date['now']()-_0x2a822b['timestamp']<CACHE_EXPIRY[_0x349678(0x158)]?_0x2e8ba7[_0x1205da]=_0x2a822b['data']:_0x1415c3['push'](_0x1205da);});const _0x5bad74=0xa;for(let _0x293809=0x0;_0x293809<_0x1415c3['length'];_0x293809+=_0x5bad74){const _0x30d0c5=_0x1415c3['slice'](_0x293809,_0x293809+_0x5bad74);if(_0x30d0c5[_0x5ffe93(0x155)]>0x0)try{const _0x1787bb=query(_0x13dff1,where(_0x5ffe93(0x153),'in',_0x30d0c5),limit(0x64)),_0x4d95bd=await getDocs(_0x1787bb);_0x4d95bd[_0x5ffe93(0x14f)]['forEach'](_0x5be5dd=>{const _0x266370=_0x5ffe93,_0x1313cd=_0x5be5dd['data'](),_0x314227=_0x1313cd['playerId'];if(!_0x2e8ba7[_0x314227])_0x2e8ba7[_0x314227]=[];_0x2e8ba7[_0x314227]['push'](_0x1313cd);const _0x1d2635=_0x314227+'_'+_0x59fb61;cache['eloHistory'][_0x266370(0x151)](_0x1d2635,{'data':_0x2e8ba7[_0x314227],'timestamp':Date[_0x266370(0x150)]()});});}catch(_0x29c0b1){console['error']('Error\x20fetching\x20batch\x20ELO\x20history:',_0x29c0b1);}}return _0x2e8ba7;}let usernameCache=new Map(),usernameCacheTimestamp=Date[a50_0x232c85(0x150)]();function a50_0x2ae7(_0x467803,_0x74a4e9){const _0x4acb2e=a50_0x4015();return a50_0x2ae7=function(_0x410edb,_0x476945){_0x410edb=_0x410edb-0x14a;let _0x4015ca=_0x4acb2e[_0x410edb];return _0x4015ca;},a50_0x2ae7(_0x467803,_0x74a4e9);}export function setupEfficientListener(_0x5dac4b,_0x233734=[],_0xad881b){const _0x1992ec=collection(db,_0x5dac4b),_0x2f4e97=query(_0x1992ec,..._0x233734),_0x18c286=onSnapshot(_0x2f4e97,_0x2f3bdb=>{const _0x4fc729=a50_0x2ae7,_0x2dcc5d=_0x2f3bdb['docChanges']()['map'](_0x3d904a=>({'type':_0x3d904a[_0x4fc729(0x14c)],'id':_0x3d904a['doc']['id'],'data':_0x3d904a['doc']['data']()}));_0x2dcc5d['length']>0x0&&_0xad881b(_0x2dcc5d,_0x2f3bdb[_0x4fc729(0x14f)]);});return _0x18c286;}export async function bulkResolveUsernames(_0x5a3453){const _0x1ebb3b=a50_0x232c85,_0x2e47e2=new Map();if(!_0x5a3453||_0x5a3453['length']===0x0)return _0x2e47e2;const _0x1e70bc=['players',_0x1ebb3b(0x15a),_0x1ebb3b(0x14a),'nonParticipants'];for(const _0x41ea84 of _0x1e70bc){const _0x303fad=collection(db,_0x41ea84),_0x50de74=await getDocs(_0x303fad);_0x50de74['forEach'](_0x556507=>{const _0x13c782=_0x1ebb3b,_0x1d1840=_0x556507[_0x13c782(0x14d)]();_0x1d1840[_0x13c782(0x157)]&&_0x5a3453['includes'](_0x556507['id'])&&_0x2e47e2['set'](_0x556507['id'],_0x1d1840['username']);});}return _0x2e47e2;}function a50_0x4015(){const _0xd63e5f=['playersD3','userProfiles','type','data','{}.constructor(\x22return\x20this\x22)(\x20)','docs','now','set','warn','playerId','timestamp','length','__proto__','username','eloHistory','get','playersD2','exists'];a50_0x4015=function(){return _0xd63e5f;};return a50_0x4015();}
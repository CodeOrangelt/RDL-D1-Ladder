const a38_0x18872f=a38_0x263b,a38_0x3a4903=(function(){let _0x4108d3=!![];return function(_0x1ca7e4,_0x540492){const _0x4f2695=_0x4108d3?function(){const _0x47ff4f=a38_0x263b;if(_0x540492){const _0x1944ad=_0x540492[_0x47ff4f(0xb5)](_0x1ca7e4,arguments);return _0x540492=null,_0x1944ad;}}:function(){};return _0x4108d3=![],_0x4f2695;};}()),a38_0x1443f8=a38_0x3a4903(this,function(){const _0x162fdb=a38_0x263b,_0x1a9135=function(){let _0x2ef9af;try{_0x2ef9af=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x593bc5){_0x2ef9af=window;}return _0x2ef9af;},_0xe7ec41=_0x1a9135(),_0xdc619c=_0xe7ec41[_0x162fdb(0xc8)]=_0xe7ec41['console']||{},_0x6f71d2=[_0x162fdb(0xac),'warn',_0x162fdb(0xbb),'error','exception','table','trace'];for(let _0x52375b=0x0;_0x52375b<_0x6f71d2[_0x162fdb(0xb4)];_0x52375b++){const _0x29edd0=a38_0x3a4903['constructor'][_0x162fdb(0xba)]['bind'](a38_0x3a4903),_0x16356a=_0x6f71d2[_0x52375b],_0x478360=_0xdc619c[_0x16356a]||_0x29edd0;_0x29edd0['__proto__']=a38_0x3a4903['bind'](a38_0x3a4903),_0x29edd0['toString']=_0x478360[_0x162fdb(0xaa)][_0x162fdb(0xc5)](_0x478360),_0xdc619c[_0x16356a]=_0x29edd0;}});a38_0x1443f8();function a38_0x263b(_0x5d0ade,_0x536d66){const _0x1443f8=a38_0x328b();return a38_0x263b=function(_0x3a4903,_0x59f226){_0x3a4903=_0x3a4903-0xaa;let _0x328bb8=_0x1443f8[_0x3a4903];return _0x328bb8;},a38_0x263b(_0x5d0ade,_0x536d66);}const functions=require('firebase-functions'),admin=require('firebase-admin');admin['initializeApp']();function a38_0x328b(){const _0x9d45fd=['toString','isNonParticipant','log','userProfiles','FieldValue','playersD3','batch','unranked','nonParticipants','forEach','length','apply','get','Unknown','ladders','collection','prototype','info','onWrite','status','send','Error\x20rebuilding\x20members\x20list','ladder','username','set','has','data','bind','playersD2','bronze','console','updateMembersList'];a38_0x328b=function(){return _0x9d45fd;};return a38_0x328b();}const db=admin['firestore']();exports[a38_0x18872f(0xc9)]=functions['firestore']['document']('{collection}/{docId}')[a38_0x18872f(0xbc)](async(_0x43a875,_0x508862)=>{const _0x4a030c=a38_0x18872f,_0x29b68e=_0x508862['params']['collection'],_0x579498=_0x508862['params']['docId'];if(!['players','playersD2','playersD3','userProfiles',_0x4a030c(0xb2)]['includes'](_0x29b68e))return null;try{await rebuildMembersList(),console['log']('Successfully\x20updated\x20aggregated\x20members\x20list');}catch(_0xb2b821){console['error']('Error\x20updating\x20members\x20list:',_0xb2b821);}});async function rebuildMembersList(){const _0x3f801f=a38_0x18872f,_0x35fb46=db[_0x3f801f(0xb0)](),[_0x59f743,_0xf50c25,_0x25c049,_0x3969e7,_0x294fcf]=await Promise['all']([db['collection'](_0x3f801f(0xad))['get'](),db[_0x3f801f(0xb9)]('players')[_0x3f801f(0xb6)](),db['collection'](_0x3f801f(0xc6))['get'](),db['collection'](_0x3f801f(0xaf))['get'](),db['collection']('nonParticipants')[_0x3f801f(0xb6)]()]),_0x4534f0=new Map();_0x59f743[_0x3f801f(0xb3)](_0x497011=>{const _0x48fe07=_0x3f801f;_0x4534f0['set'](_0x497011['id'],_0x497011[_0x48fe07(0xc4)]());});const _0x610b7c=new Map(),_0x4715ab=(_0x481a3a,_0x44da74)=>{_0x481a3a['forEach'](_0x3dbb28=>{const _0x3df997=a38_0x263b,_0x482e36=_0x3dbb28['data'](),_0x3b518f=_0x3dbb28['id'];!_0x610b7c[_0x3df997(0xc3)](_0x3b518f)&&_0x610b7c['set'](_0x3b518f,{'userId':_0x3b518f,'username':_0x482e36[_0x3df997(0xc1)]||_0x3df997(0xb7),'ladders':[],'isNonParticipant':![]});const _0x5bc6ef=_0x610b7c['get'](_0x3b518f);_0x5bc6ef['ladders']['push']({'ladder':_0x44da74,'elo':_0x482e36['eloRating']||0x4b0,'active':_0x482e36['active']!==![]});});};_0x4715ab(_0xf50c25,'D1'),_0x4715ab(_0x25c049,'D2'),_0x4715ab(_0x3969e7,'D3'),_0x294fcf['forEach'](_0x378e04=>{const _0x1d580e=_0x3f801f,_0x22d36a=_0x378e04['data'](),_0x54c21d=_0x378e04['id'];!_0x610b7c['has'](_0x54c21d)&&_0x22d36a['username']&&_0x610b7c[_0x1d580e(0xc2)](_0x54c21d,{'userId':_0x54c21d,'username':_0x22d36a[_0x1d580e(0xc1)],'ladders':[],'isNonParticipant':!![]});});const _0x6af6cb=[];_0x610b7c[_0x3f801f(0xb3)]((_0x378efe,_0x506569)=>{const _0x3e3c1f=_0x3f801f,_0x22d766=_0x4534f0['get'](_0x506569)||{};let _0x3c2211=0x0,_0x507bb3=null;if(_0x378efe[_0x3e3c1f(0xb8)]['length']>0x0){const _0x175553=_0x378efe['ladders']['sort']((_0x5ce9a9,_0x223af4)=>_0x223af4['elo']-_0x5ce9a9['elo']);_0x3c2211=_0x175553[0x0]['elo'],_0x507bb3=_0x175553[0x0][_0x3e3c1f(0xc0)];}const _0x2d75c5={'userId':_0x506569,'username':_0x378efe['username'],'profileImageUrl':_0x22d766['profileImageUrl']||null,'country':_0x22d766['country']||null,'motto':_0x22d766['motto']||null,'favoriteMap':_0x22d766['favoriteMap']||null,'favoriteWeapon':_0x22d766['favoriteWeapon']||null,'isNonParticipant':_0x378efe[_0x3e3c1f(0xab)],'ladders':_0x378efe[_0x3e3c1f(0xb8)],'primaryLadder':_0x507bb3,'highestElo':_0x3c2211,'rank':getPlayerRank(_0x3c2211),'lastUpdated':admin['firestore'][_0x3e3c1f(0xae)]['serverTimestamp']()};_0x6af6cb['push'](_0x2d75c5);});const _0x468583=db['collection']('aggregatedMembers'),_0xc90964=await _0x468583[_0x3f801f(0xb6)](),_0xfcdde9=[];_0xc90964['forEach'](_0x36660f=>{_0xfcdde9['push'](_0x36660f['ref']['delete']());}),await Promise['all'](_0xfcdde9);const _0x1409c5=0x1f4,_0x4885ee=[];for(let _0x1e9fd4=0x0;_0x1e9fd4<_0x6af6cb['length'];_0x1e9fd4+=_0x1409c5){const _0xd3f805=db['batch'](),_0x5f2572=_0x6af6cb['slice'](_0x1e9fd4,_0x1e9fd4+_0x1409c5);_0x5f2572['forEach'](_0x42c3d9=>{const _0xa6b784=_0x3f801f,_0x3419cb=_0x468583['doc'](_0x42c3d9['userId']);_0xd3f805[_0xa6b784(0xc2)](_0x3419cb,_0x42c3d9);}),_0x4885ee['push'](_0xd3f805['commit']());}await Promise['all'](_0x4885ee);}function getPlayerRank(_0x2f7c5d){const _0x188b96=a38_0x18872f;if(_0x2f7c5d>=0x7d0)return'emerald';if(_0x2f7c5d>=0x708)return'gold';if(_0x2f7c5d>=0x640)return'silver';if(_0x2f7c5d>=0x578)return _0x188b96(0xc7);return _0x188b96(0xb1);}exports['rebuildMembersListManual']=functions['https']['onRequest'](async(_0x5b91cc,_0x1287f3)=>{const _0xa6f12b=a38_0x18872f;try{await rebuildMembersList(),_0x1287f3[_0xa6f12b(0xbd)](0xc8)[_0xa6f12b(0xbe)]('Members\x20list\x20rebuilt\x20successfully');}catch(_0x1f9272){console['error']('Error\x20rebuilding\x20members\x20list:',_0x1f9272),_0x1287f3['status'](0x1f4)['send'](_0xa6f12b(0xbf));}});
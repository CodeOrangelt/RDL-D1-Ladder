const a33v=a33d;(function(a,b){const s=a33d,c=a();while(!![]){try{const d=-parseInt(s(0x6e))/0x1+-parseInt(s(0xbb))/0x2+parseInt(s(0x7c))/0x3+parseInt(s(0xbf))/0x4+parseInt(s(0x8e))/0x5+-parseInt(s(0x98))/0x6+-parseInt(s(0x84))/0x7*(parseInt(s(0x90))/0x8);if(d===b)break;else c['push'](c['shift']());}catch(e){c['push'](c['shift']());}}}(a33c,0x1d97a));function a33d(a,b){const c=a33c();return a33d=function(d,e){d=d-0x64;let f=c[d];if(a33d['LzHlhX']===undefined){var g=function(l){const m='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let n='',o='';for(let p=0x0,q,r,s=0x0;r=l['charAt'](s++);~r&&(q=p%0x4?q*0x40+r:r,p++%0x4)?n+=String['fromCharCode'](0xff&q>>(-0x2*p&0x6)):0x0){r=m['indexOf'](r);}for(let t=0x0,u=n['length'];t<u;t++){o+='%'+('00'+n['charCodeAt'](t)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(o);};a33d['sZPjtq']=g,a=arguments,a33d['LzHlhX']=!![];}const h=c[0x0],i=d+h,j=a[i];return!j?(f=a33d['sZPjtq'](f),a[i]=f):f=j,f;},a33d(a,b);}const a33b=(function(){let a=!![];return function(b,c){const d=a?function(){if(c){const e=c['apply'](b,arguments);return c=null,e;}}:function(){};return a=![],d;};}()),a33a=a33b(this,function(){const u=a33d,a=function(){const t=a33d;let f;try{f=Function(t(0x6f)+t(0xb1)+');')();}catch(g){f=window;}return f;},b=a(),c=b[u(0xb4)]=b['console']||{},d=[u(0x81),u(0xc0),'info','error','exception',u(0x9e),'trace'];for(let e=0x0;e<d[u(0x97)];e++){const f=a33b['constructor']['prototype']['bind'](a33b),g=d[e],h=c[g]||f;f['__proto__']=a33b[u(0x9a)](a33b),f[u(0x83)]=h['toString']['bind'](h),c[g]=f;}});a33a();import{collection,getDocs,deleteDoc,doc,getDoc,query,where,updateDoc,Timestamp,onSnapshot,orderBy,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import{getRankStyle}from'./ranks.js';import a33e from'./firebase-idle-wrapper.js';const styleEl=document[a33v(0xac)]('style');styleEl[a33v(0xc8)]=a33v(0x91),document[a33v(0xa7)]['appendChild'](styleEl);const playerCacheD3={'data':null,'timestamp':0x0},CACHE_DURATION=0x7530;async function displayLadderD3(a=![]){const w=a33v,b=document['querySelector']('#ladder-d3\x20tbody');if(!b){console['error']('D3\x20Ladder\x20table\x20body\x20not\x20found');return;}b[w(0x7f)]='<tr><td\x20colspan=\x228\x22\x20class=\x22loading-cell\x22>Loading\x20D3\x20ladder\x20data...</td></tr>';try{const c=Date['now']();if(!a&&playerCacheD3[w(0x69)]&&c-playerCacheD3[w(0xca)]<CACHE_DURATION){updateLadderDisplayD3(playerCacheD3['data']);return;}const d=collection(db,'playersD3'),e=await getDocs(d),f=[];e[w(0x85)](l=>{const x=w,m=l['data']();m[x(0x77)]&&f['push']({...m,'id':l['id'],'elo':m['eloRating']||0x0,'position':m['position']||Number['MAX_SAFE_INTEGER']});});const g=collection(db,w(0x7d)),h=await getDocs(g),i=new Map();h['forEach'](l=>{const y=w,m=l[y(0x69)]();m['username']&&i['set'](m['username']['toLowerCase'](),m);});for(const l of f){const m=l[w(0x77)]['toLowerCase']();if(i['has'](m)){const n=i['get'](m);n['country']&&(l['country']=n[w(0x8c)][w(0x76)]());}}const j=f['map'](o=>o['username']),k=await fetchBatchMatchStatsD3(j);f[w(0x71)]((o,p)=>{const z=w,q=k['get'](o[z(0x77)])?.[z(0x7b)]||0x0,r=k['get'](p[z(0x77)])?.[z(0x7b)]||0x0;if(q===0x0!==(r===0x0))return q===0x0?0x1:-0x1;return(o[z(0xb5)]||0x3e7)-(p[z(0xb5)]||0x3e7);}),f['forEach']((o,p)=>{const A=w;o[A(0xb5)]=p+0x1;}),playerCacheD3[w(0x69)]=f,playerCacheD3[w(0xca)]=c,updateLadderDisplayD3(f);}catch(o){console['error']('Error\x20loading\x20D3\x20ladder:',o),b['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20colspan=\x228\x22\x20style=\x22text-align:\x20center;\x20color:\x20red;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Error\x20loading\x20D3\x20ladder\x20data:\x20'+o[w(0xc7)]+w(0x75);}}function calculateStreakDays(a){const B=a33v;if(!a)return 0x0;const b=a[B(0xb3)](),c=new Date(),d=Math[B(0x9f)](c-b);return Math['ceil'](d/(0x3e8*0x3c*0x3c*0x18));}async function updatePlayerPositions(a,b){const C=a33v;try{const c=collection(db,C(0xa0)),d=await getDocs(c),e=[];d['forEach'](h=>{const D=C;e[D(0x6b)]({'id':h['id'],...h[D(0x69)]()});});const f=e['find'](h=>h[C(0x77)]===a),g=e[C(0xa6)](h=>h['username']===b);if(!f||!g){console['error'](C(0xcb));return;}if(f['position']>g[C(0xb5)]){const h=g[C(0xb5)];for(const i of e){i[C(0xb5)]>=g[C(0xb5)]&&i['position']<f[C(0xb5)]&&i[C(0x77)]!==a&&await updateDoc(doc(db,'playersD3',i['id']),{'position':i['position']+0x1});}await updateDoc(doc(db,C(0xa0),f['id']),{'position':h});if(h===0x1){const j=doc(db,'playersD3',f['id']),k=await getDoc(j);!k['data']()[C(0xb9)]&&await updateDoc(j,{'firstPlaceDate':Timestamp['now']()});}if(g[C(0xb5)]===0x1){const l=doc(db,C(0xa0),g['id']);await updateDoc(l,{'firstPlaceDate':null});}}}catch(m){console[C(0xc2)](C(0x66),m);}}async function updateLadderDisplayD3(a){const E=a33v;a['sort']((g,h)=>g['position']-h[E(0xb5)]);const b=document['querySelector'](E(0x7e));if(!b)return;b[E(0x7f)]='';const c=a[E(0xc6)](g=>g['username']),d=await fetchBatchMatchStatsD3(c),e=document['querySelector'](E(0x89));e[E(0x7f)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20<th>Rank</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<th>Username</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<th>ELO</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<th>Matches</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<th>Wins</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<th>Losses</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<th>K/D</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<th>Win\x20Rate</th>\x0a\x20\x20\x20\x20';const f=a[E(0xc6)](g=>{const F=E,h=d['get'](g[F(0x77)])||{'totalMatches':0x0,'wins':0x0,'losses':0x0,'kda':0x0,'winRate':0x0,'totalKills':0x0,'totalDeaths':0x0};return createPlayerRowD3(g,h);})['join']('');b['innerHTML']=f,getPlayersLastEloChangesD3(c)['then'](g=>{const G=E,h=new Map();b['querySelectorAll']('tr')[G(0x85)]((i,j)=>{j<c['length']&&h['set'](c[j],i);}),g[G(0x85)]((i,j)=>{const H=G,k=h['get'](j);if(k&&i!==0x0){const l=k['querySelector']('td:nth-child(3)');if(l){const m=i>0x0?'+'+i:''+i,n=l['querySelector'](H(0xc9));n&&(n['textContent']=m,n['style'][H(0xc4)]=i>0x0?H(0xab):H(0xa9),n[H(0xb8)][H(0xa4)]='bold',n[H(0xb8)][H(0x8b)]=H(0x9c),n['style'][H(0x93)]='inline',n['style'][H(0xa3)]='visible',n[H(0xb8)][H(0x64)]='1');}}});})['catch'](g=>console[E(0xc2)](E(0x73),g));}async function fetchBatchMatchStatsD3(a){const I=a33v,b=new Map();try{const c=collection(db,'approvedMatchesD3'),d=await getDocs(c);d[I(0x85)](e=>{const J=I,f=e['data']();if(a[J(0x9d)](f[J(0xba)])){const g=f['winnerUsername'];!b['has'](g)&&b['set'](g,{'totalMatches':0x0,'wins':0x0,'losses':0x0,'totalKills':0x0,'totalDeaths':0x0,'kda':0x0,'winRate':0x0});const h=b['get'](g);h[J(0x65)]++,h[J(0x7b)]++,h['totalKills']+=parseInt(f[J(0x68)])||0x0,h[J(0x96)]+=parseInt(f[J(0xb6)])||0x0;}if(a[J(0x9d)](f[J(0xad)])){const i=f[J(0xad)];!b[J(0xa1)](i)&&b['set'](i,{'totalMatches':0x0,'wins':0x0,'losses':0x0,'totalKills':0x0,'totalDeaths':0x0,'kda':0x0,'winRate':0x0});const j=b['get'](i);j['losses']++,j[J(0x7b)]++,j['totalKills']+=parseInt(f[J(0xb6)])||0x0,j['totalDeaths']+=parseInt(f[J(0x68)])||0x0;}}),b['forEach'](e=>{const K=I;e[K(0x6c)]=e['totalDeaths']>0x0?(e['totalKills']/e['totalDeaths'])[K(0xc1)](0x2):e[K(0xaa)],e['winRate']=e[K(0x7b)]>0x0?(e['wins']/e[K(0x7b)]*0x64)[K(0xc1)](0x1):0x0;});}catch(e){console[I(0xc2)](I(0x99),e);}return b;}function createPlayerRowD3(a,b){const L=a33v,c=parseFloat(a[L(0xae)])||0x0;let d='gray';if(c>=0x7d0)d='#50C878';else{if(c>=0x708)d='#FFD700';else{if(c>=0x640)d=L(0x74);else c>=0x578&&(d='#CD7F32');}}let e='';return a[L(0x8c)]&&(e=L(0x7a)+a['country']['toLowerCase']()+L(0xc3)+a['country']+L(0x86)),L(0x72)+a['position']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td\x20style=\x22position:\x20relative;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20position:\x20relative;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username='+encodeURIComponent(a[L(0x77)])+L(0x6a)+d+L(0x8d)+a['username']+L(0xb7)+e+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td\x20style=\x22color:\x20'+d+';\x20position:\x20relative;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22elo-container\x22\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22elo-value\x22>'+c+L(0x6d)+b[L(0x7b)]+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+b[L(0x65)]+L(0x87)+b[L(0xb0)]+L(0x87)+b[L(0x6c)]+L(0x87)+b['winRate']+'%</td>\x0a\x20\x20\x20\x20</tr>';}function a33c(){const R=['CgXHEwvYvxnLCM5HBwu','Bg9ZC2vZ','E30Uy29UC3rYDwn0B3iOiNjLDhvYBIb0AgLZiIKOicK','C2v0','Dg9eyxrL','y29UC29Szq','Cg9ZAxrPB24','Bg9Zzxjty29Yzq','cIaGicaGicaGicaGicaGica8l2e+cIaGicaGicaGicaGicaGica','C3r5Bgu','zMLYC3rqBgfJzurHDgu','D2LUBMvYvxnLCM5HBwu','mta4mZGYCwnzDM9h','zMLSDgvY','z2v0','CgXHEwvY','nZK1odm2vw1uDxby','D2fYBG','Dg9gAxHLza','zxjYB3i','lNbUzYiGcIaGicaGicaGicaGicaGicaGicaGicaGigfSDd0I','y29SB3i','CgLSB3q','BwfW','BwvZC2fNzq','Dgv4DenVBNrLBNq','lNrYzw5KlwLUzgLJyxrVCG','DgLTzxn0yw1W','q291BgqGBM90igzPBMqGD2LUBMvYig9YigXVC2vYigLUieqZihbSyxLLCNmGBgLZDa','B3bHy2L0Eq','D2LUCW','rxjYB3iGDxbKyxrPBMCGrdmGCgXHEwvYihbVC2L0Aw9UCZO','BMv3rwXV','D2LUBMvYu2nVCMu','zgf0yq','jMXHzgrLCJ1KmYiGcIaGicaGicaGicaGicaGicaGicbZDhLSzt0Iy29SB3i6ia','ChvZAa','A2rH','pc9ZCgfUpGOGicaGicaGicaGicaGicaGphnWyw4Gy2XHC3m9iNrYzw5KlwLUzgLJyxrVCIiGC3r5Bgu9iM1HCMDPBI1Szwz0oIa1ChG7iJ48l3nWyw4+cIaGicaGicaGicaGidWVzgL2pGOGicaGicaGidWVDgq+cIaGicaGicaGphrKpG','mtqYotu4sM1bv3bi','CMv0DxjUicHMDw5JDgLVBIGPia','ChjLDMLVDxnfBg8','C29YDa','cIaGica8Dhi+cIaGicaGicaGphrKpG','rxjYB3iGDxbKyxrPBMCGrdmGruXpihrYzw5KigLUzgLJyxrVCNm6','i0mWqZbdma','cIaGicaGicaGicaGicaGica8l3rKpGOGicaGicaGicaGica8l3rYpGOGicaGicaGia','Dg9mB3DLCKnHC2u','DxnLCM5HBwu','C2L6zq','rdm6iezPBMfSievmtYbJAgfUz2vZoG','pgLTzYbZCMm9iI4Ul2LTywDLCY9MBgfNCY8','Dg90ywXnyxrJAgvZ','mJG5mdu2rwzUruLc','DxnLCLbYB2zPBgvZ','i2XHzgrLCI1KmYb0yM9KEq','Aw5Uzxjive1m','zwXVsgLZDg9YEq','Bg9N','zgvZyW','Dg9tDhjPBMC','mZy0z2zrsLr2','zM9YrwfJAa','iIakicaGicaGicaGicaGicaGicaGicaGicaGy2XHC3m9iNbSyxLLCI1MBgfNiIakicaGicaGicaGicaGicaGicaGicaGicaGB25LCNjVCJ0IDgHPCY5ZDhLSzs5KAxnWBgf5psDUB25LjYi+','pc90zd4kicaGicaGica8Dgq+','rdm6iezVDw5Kia','i2XHzgrLCI1KmYb0AgvHzcb0CG','rdm6ia','zM9UDfnPEMu','y291BNrYEq','oYb0zxH0lwrLy29YyxrPB246ig5VBMu7iJ4kicaGicaGicaGicaGicaGicaGica','odaZnZuWBfrtExnQ','rdm6ie5VigvUDhjPzxmGzM91BMqGAw4GzwXVsgLZDg9YEuqZlcb0CNLPBMCGzMfSBgjHy2SUlI4','mta5odrbD3r4Auy','cIaGlNn0CMvHAY1PBMrPy2f0B3iGEWOGicaGzM9UDc1ZAxPLoIaWlJLLBtSkicaGignVBg9YoIaJrKy0ntaWoWOGicaGBwfYz2LUlwXLzNq6idvWEdSkicaGigzVBNqTD2vPz2H0oIbIB2XKoWOGih0k','zNjVBq','zgLZCgXHEq','rdm6ieXVB2TPBMCGzM9YievmtYbJAgfUz2vZigzVCIb1C2vYCZO','igvUDhjPzxmGAw4GzwXVsgLZDg9YEuqZ','Dg90ywXezwf0Ahm','BgvUz3rO','mZK3odm2uvrJzwju','rxjYB3iGzMv0y2HPBMCGyMf0y2GGBwf0y2GGC3rHDhmGzM9YieqZoG','yMLUza','C3rYAw5N','mc44nwvT','Aw5JBhvKzxm','DgfIBgu','ywjZ','CgXHEwvYC0qZ','AgfZ','CgXHEwvYswq','DMLZAwjPBgL0Eq','zM9UDfDLAwDODa','y2HHBMDL','zMLUza','AgvHza','rdm6ievYCM9YigzLDgnOAw5NievmtYbOAxn0B3j5oG','i0y0ndmZnG','Dg90ywXlAwXSCW','iZrdquy1ma','y3jLyxrLrwXLBwvUDa','Bg9ZzxjvC2vYBMfTzq','zwXV'];a33c=function(){return R;};return a33c();}async function getPlayersLastEloChangesD3(a){const M=a33v,b=new Map();a[M(0x85)](c=>b['set'](c,0x0));try{console[M(0x81)](M(0x94),a);const c=new Map(),d=await getDocs(collection(db,M(0xa0)));d['forEach'](j=>{const N=M,k=j[N(0x69)]();k[N(0x77)]&&c['set'](j['id'],k['username']);}),console['log']('D3:\x20Player\x20ID\x20mappings:',Array[M(0x92)](c['entries']()));const e=collection(db,'eloHistoryD3'),f=query(e,orderBy('timestamp',M(0x82)),limit(0x64)),g=await getDocs(f);g['empty']?console[M(0x81)]('D3:\x20eloHistoryD3\x20is\x20empty,\x20trying\x20fallback...'):console['log'](M(0x88)+g[M(0x78)]+M(0x95));const h=new Map();g['forEach'](j=>{const O=M,k=j[O(0x69)]();let l=null;if(k[O(0x77)])l=k['username'];else{if(k['playerUsername'])l=k[O(0xaf)];else{if(k['player']&&typeof k['player']===O(0x9b))l=k['player'];else{if(k[O(0xbe)]&&c[O(0xa1)](k[O(0xbe)]))l=c[O(0xbd)](k[O(0xbe)]);else k[O(0xa2)]&&c['has'](k['playerId'])&&(l=c[O(0xbd)](k['playerId']));}}}(k['username']==='pilot'||k[O(0xaf)]===O(0xc5)||k['player']&&c['get'](k[O(0xbe)])==='pilot')&&console['log']('D3:\x20Found\x20pilot\x20entry:',k),l&&a['includes'](l)&&(!h['has'](l)&&h[O(0xb2)](l,[]),h['get'](l)['push']({...k,'timestamp':k['timestamp']?.['seconds']||0x0}));}),console['log']('D3:\x20Found\x20entries\x20for\x20'+h['size']+'\x20players'),h['forEach']((j,k)=>{const P=M;if(j['length']>0x0){j['sort']((m,n)=>n[P(0xca)]-m['timestamp']);const l=j['find'](m=>m['change']!==undefined||m['newElo']!==undefined&&m[P(0x70)]!==undefined);if(l){let m;if(l['change']!==undefined)m=l['change'];else l[P(0x67)]!==undefined&&l['previousElo']!==undefined&&(m=l['newElo']-l[P(0x70)]);m!==undefined&&(b['set'](k,m),console['log'](P(0x8a)+k+'\x20ELO\x20change:\x20'+m));}}});if(h['size']===0x0){console['log'](M(0x8f));const j=collection(db,M(0x80)),k=query(j,where('gameMode','==','D3'),orderBy(M(0xca),'desc'),limit(0x32));try{const l=await getDocs(k);console['log'](M(0x88)+l[M(0x78)]+'\x20fallback\x20entries'),l['forEach'](m=>{const Q=M,n=m['data']();let o=n['username']||n[Q(0xaf)];!o&&n['player']&&c[Q(0xa1)](n['player'])&&(o=c['get'](n[Q(0xbe)]));if(o&&a[Q(0x9d)](o)){const p=n[Q(0xa5)]||(n[Q(0x67)]!==undefined&&n[Q(0x70)]!==undefined?n['newElo']-n['previousElo']:0x0);p!==0x0&&(b['set'](o,p),console['log'](Q(0x8a)+o+'\x20fallback\x20ELO\x20change:\x20'+p));}});}catch(m){console['log']('D3:\x20Fallback\x20query\x20failed:',m);}}const i=Array[M(0x92)](b['entries']())[M(0xbc)](([n,o])=>o!==0x0);console[M(0x81)](M(0x79),i);}catch(n){console['error'](M(0xa8),n);}return b;}export{displayLadderD3,updatePlayerPositions};
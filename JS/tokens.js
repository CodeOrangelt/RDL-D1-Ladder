const a52_0x4c8b12=(function(){let _0x4d6e90=!![];return function(_0xe9e6bc,_0x536923){const _0x2cd8e4=_0x4d6e90?function(){if(_0x536923){const _0x2a6fda=_0x536923['apply'](_0xe9e6bc,arguments);return _0x536923=null,_0x2a6fda;}}:function(){};return _0x4d6e90=![],_0x2cd8e4;};}()),a52_0x222efb=a52_0x4c8b12(this,function(){const _0x3d0cc4=a52_0x1b12,_0x30b4c8=function(){const _0x3b6f77=a52_0x1b12;let _0x17971e;try{_0x17971e=Function(_0x3b6f77(0x1d4)+_0x3b6f77(0x1dc)+');')();}catch(_0x19816c){_0x17971e=window;}return _0x17971e;},_0x343ec8=_0x30b4c8(),_0x6a79c3=_0x343ec8['console']=_0x343ec8['console']||{},_0x317462=['log','warn','info','error','exception','table',_0x3d0cc4(0x1e9)];for(let _0x50e6a5=0x0;_0x50e6a5<_0x317462['length'];_0x50e6a5++){const _0x553a9b=a52_0x4c8b12['constructor']['prototype']['bind'](a52_0x4c8b12),_0xceffce=_0x317462[_0x50e6a5],_0x568c06=_0x6a79c3[_0xceffce]||_0x553a9b;_0x553a9b['__proto__']=a52_0x4c8b12[_0x3d0cc4(0x1df)](a52_0x4c8b12),_0x553a9b[_0x3d0cc4(0x1d9)]=_0x568c06['toString']['bind'](_0x568c06),_0x6a79c3[_0xceffce]=_0x553a9b;}});a52_0x222efb();function a52_0x4794(){const _0x15594b=['return\x20(function()\x20','tokens_','sort','data','purchasedAt','toString','length','username','{}.constructor(\x22return\x20this\x22)(\x20)','Error\x20fetching\x20tokens\x20by\x20usernames:','get','bind','string','forEach','now','includes','log','exists','equipped','error','Error\x20fetching\x20user\x20tokens:','trace','userTokens','set'];a52_0x4794=function(){return _0x15594b;};return a52_0x4794();}import{doc,getDoc,getDocs,collection}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const tokenCache=new Map(),CACHE_DURATION=0x5*0x3c*0x3e8;export async function getUserTokens(_0x57a266){const _0x233564=a52_0x1b12,_0xf7c67c='tokens_'+_0x57a266,_0x510e79=tokenCache['get'](_0xf7c67c);if(_0x510e79&&Date['now']()-_0x510e79['timestamp']<CACHE_DURATION)return _0x510e79['tokens'];try{const _0x257de0=doc(db,'userTokens',_0x57a266),_0xf23c12=await getDoc(_0x257de0);let _0x92552b=[];return _0xf23c12[_0x233564(0x1e5)]()&&(_0x92552b=_0xf23c12['data']()['tokens']||[]),tokenCache['set'](_0xf7c67c,{'tokens':_0x92552b,'timestamp':Date['now']()}),_0x92552b;}catch(_0x5eb26b){return console['error'](_0x233564(0x1e8),_0x5eb26b),[];}}function a52_0x1b12(_0x5449f5,_0x46de3d){const _0x222efb=a52_0x4794();return a52_0x1b12=function(_0x4c8b12,_0x31d4ad){_0x4c8b12=_0x4c8b12-0x1d4;let _0x47949b=_0x222efb[_0x4c8b12];return _0x47949b;},a52_0x1b12(_0x5449f5,_0x46de3d);}export async function getBulkUserTokens(_0xf85c81){const _0x4edea1=a52_0x1b12,_0x41d426=new Map(),_0xe9dae2=[];_0xf85c81['forEach'](_0x15dac4=>{const _0x14ca5c=a52_0x1b12,_0xd9c0a0=_0x14ca5c(0x1d5)+_0x15dac4,_0x4d1f87=tokenCache[_0x14ca5c(0x1de)](_0xd9c0a0);_0x4d1f87&&Date[_0x14ca5c(0x1e2)]()-_0x4d1f87['timestamp']<CACHE_DURATION?_0x41d426['set'](_0x15dac4,_0x4d1f87['tokens']):_0xe9dae2['push'](_0x15dac4);});if(_0xe9dae2[_0x4edea1(0x1da)]>0x0)try{const _0x5d2983=_0xe9dae2['map'](async _0x2f2518=>{const _0x291ad0=_0x4edea1,_0x3f2579=doc(db,_0x291ad0(0x1ea),_0x2f2518),_0x39be7d=await getDoc(_0x3f2579);let _0x11ac4c=[];_0x39be7d['exists']()&&(_0x11ac4c=_0x39be7d[_0x291ad0(0x1d7)]()['tokens']||[]);const _0x4a73b8='tokens_'+_0x2f2518;return tokenCache['set'](_0x4a73b8,{'tokens':_0x11ac4c,'timestamp':Date['now']()}),[_0x2f2518,_0x11ac4c];}),_0x4408c2=await Promise['all'](_0x5d2983);_0x4408c2['forEach'](([_0x3b2aed,_0x2a9e32])=>{_0x41d426['set'](_0x3b2aed,_0x2a9e32);});}catch(_0x59c2dd){console[_0x4edea1(0x1e7)]('Error\x20fetching\x20bulk\x20user\x20tokens:',_0x59c2dd);}return _0x41d426;}export async function getTokensByUsernames(_0x3b95cc){const _0x47100d=a52_0x1b12,_0x1139ed=new Map();try{const _0x531158=collection(db,'userProfiles'),_0x418651=await getDocs(_0x531158),_0x4b2ce9=new Map();_0x418651['forEach'](_0xd0cef8=>{const _0x144a61=a52_0x1b12,_0x3a947b=_0xd0cef8[_0x144a61(0x1d7)]();_0x3a947b[_0x144a61(0x1db)]&&_0x3b95cc[_0x144a61(0x1e3)](_0x3a947b['username'])&&_0x4b2ce9['set'](_0x3a947b['username'],_0xd0cef8['id']);});const _0x37f60c=Array['from'](_0x4b2ce9['values']());if(_0x37f60c['length']>0x0){const _0x4d6654=await getBulkUserTokens(_0x37f60c);_0x4b2ce9[_0x47100d(0x1e1)]((_0x1ce49e,_0x28e05b)=>{const _0x1238fe=_0x47100d,_0x109546=_0x4d6654['get'](_0x1ce49e)||[];_0x1139ed[_0x1238fe(0x1eb)](_0x28e05b,_0x109546);});}}catch(_0x122b5b){console[_0x47100d(0x1e7)](_0x47100d(0x1dd),_0x122b5b);}return _0x1139ed;}export function clearTokenCache(_0x1c9bd6=null){const _0x3b4be7=a52_0x1b12;if(_0x1c9bd6){const _0x35cb64='tokens_'+_0x1c9bd6;tokenCache['delete'](_0x35cb64),console[_0x3b4be7(0x1e4)]('🗑️\x20Cleared\x20token\x20cache\x20for\x20user:\x20'+_0x1c9bd6);}else tokenCache['clear'](),console['log']('🗑️\x20Cleared\x20all\x20token\x20cache');}export async function forceRefreshUserTokens(_0x54e918){return clearTokenCache(_0x54e918),await getUserTokens(_0x54e918);}export function getPrimaryDisplayToken(_0xd26ad8){const _0x1f9e69=a52_0x1b12;if(!_0xd26ad8||_0xd26ad8['length']===0x0)return null;const _0x14ee2d=_0xd26ad8['find'](_0x31b738=>_0x31b738[_0x1f9e69(0x1e6)]===!![]);if(_0x14ee2d)return _0x14ee2d;const _0x40b5a9=[..._0xd26ad8][_0x1f9e69(0x1d6)]((_0x4565aa,_0x622357)=>{const _0x2e191e=_0x1f9e69;let _0x5bb289,_0x180e28;if(_0x4565aa[_0x2e191e(0x1d8)]){if(_0x4565aa['purchasedAt']['seconds'])_0x5bb289=_0x4565aa['purchasedAt']['seconds'];else{if(_0x4565aa['purchasedAt']instanceof Date)_0x5bb289=_0x4565aa['purchasedAt']['getTime']()/0x3e8;else typeof _0x4565aa['purchasedAt']===_0x2e191e(0x1e0)?_0x5bb289=new Date(_0x4565aa[_0x2e191e(0x1d8)])['getTime']()/0x3e8:_0x5bb289=0x0;}}else _0x5bb289=0x0;if(_0x622357['purchasedAt']){if(_0x622357['purchasedAt']['seconds'])_0x180e28=_0x622357['purchasedAt']['seconds'];else{if(_0x622357['purchasedAt']instanceof Date)_0x180e28=_0x622357[_0x2e191e(0x1d8)]['getTime']()/0x3e8;else typeof _0x622357['purchasedAt']==='string'?_0x180e28=new Date(_0x622357['purchasedAt'])['getTime']()/0x3e8:_0x180e28=0x0;}}else _0x180e28=0x0;return _0x180e28-_0x5bb289;});return _0x40b5a9[0x0];}
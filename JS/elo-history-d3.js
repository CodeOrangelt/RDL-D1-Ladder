const a13_0x2dbe8e=a13_0x3dd5,a13_0x4ba2dc=(function(){let _0x31c317=!![];return function(_0x516383,_0x2ad61b){const _0x119fdd=_0x31c317?function(){const _0x429d50=a13_0x3dd5;if(_0x2ad61b){const _0x328bbd=_0x2ad61b[_0x429d50(0x1d1)](_0x516383,arguments);return _0x2ad61b=null,_0x328bbd;}}:function(){};return _0x31c317=![],_0x119fdd;};}()),a13_0x2650af=a13_0x4ba2dc(this,function(){const _0x41e08d=a13_0x3dd5,_0x527dcc=function(){let _0x13ee33;try{_0x13ee33=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0xffa21d){_0x13ee33=window;}return _0x13ee33;},_0x3ef7d3=_0x527dcc(),_0x45146d=_0x3ef7d3['console']=_0x3ef7d3[_0x41e08d(0x1bb)]||{},_0x271c87=['log','warn','info','error','exception',_0x41e08d(0x1c9),_0x41e08d(0x1c2)];for(let _0x51412d=0x0;_0x51412d<_0x271c87['length'];_0x51412d++){const _0x30bb5c=a13_0x4ba2dc['constructor'][_0x41e08d(0x1c4)][_0x41e08d(0x1cd)](a13_0x4ba2dc),_0x3baecc=_0x271c87[_0x51412d],_0x5a000e=_0x45146d[_0x3baecc]||_0x30bb5c;_0x30bb5c[_0x41e08d(0x1c7)]=a13_0x4ba2dc['bind'](a13_0x4ba2dc),_0x30bb5c['toString']=_0x5a000e[_0x41e08d(0x1be)][_0x41e08d(0x1cd)](_0x5a000e),_0x45146d[_0x3baecc]=_0x30bb5c;}});a13_0x2650af();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc,where}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D3=[{'name':'Emerald','elo':0x7d0},{'name':'Gold','elo':0x708},{'name':'Silver','elo':0x640},{'name':a13_0x2dbe8e(0x1c0),'elo':0x578},{'name':'Unranked','elo':0x4b0}];let lastVisibleD3=null;async function getUsernameByIdD3(_0x68e6ae){const _0x35977c=a13_0x2dbe8e;try{if(!_0x68e6ae)return'Unknown\x20Player';const _0x900028=await getDoc(doc(db,_0x35977c(0x1c5),_0x68e6ae));if(_0x900028['exists']())return _0x900028[_0x35977c(0x1cb)]()['username']||'Unknown\x20Player';const _0x19ff35=await getDocs(query(collection(db,'approvedMatchesD3'),where('winnerId','==',_0x68e6ae),limit(0x1)));if(!_0x19ff35['empty'])return _0x19ff35['docs'][0x0]['data']()['winnerUsername']||_0x35977c(0x1d2);const _0x33af8f=await getDocs(query(collection(db,_0x35977c(0x1bc)),where('loserId','==',_0x68e6ae),limit(0x1)));if(!_0x33af8f[_0x35977c(0x1ca)])return _0x33af8f['docs'][0x0]['data']()[_0x35977c(0x1c8)]||'Unknown\x20Player';return'Unknown\x20Player';}catch(_0x579c39){return console['error']('Error\x20getting\x20D3\x20username:',_0x579c39),'Unknown\x20Player';}}function a13_0x3dd5(_0x1fa018,_0x5a262c){const _0x2650af=a13_0xa8a8();return a13_0x3dd5=function(_0x4ba2dc,_0x5d0402){_0x4ba2dc=_0x4ba2dc-0x1ba;let _0xa8a8e4=_0x2650af[_0x4ba2dc];return _0xa8a8e4;},a13_0x3dd5(_0x1fa018,_0x5a262c);}export async function recordEloChangeD3({playerId:_0x398c34,previousElo:_0xb3b4fd,newElo:_0x1dabdf,opponentId:_0x449277,matchResult:_0x522872,previousPosition:_0x2b2d7e,newPosition:_0x5e3f60,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x3a8e01,timestamp:_0x2d5367}){const _0x2a21da=a13_0x2dbe8e;try{const _0x2a8c3b=doc(collection(db,_0x2a21da(0x1ce)));let _0x5c1104='match';if(isPromotion)_0x5c1104='promotion';if(isDemotion)_0x5c1104=_0x2a21da(0x1c3);let _0xb6f0ce='Unranked';if(_0x1dabdf>=0x7d0)_0xb6f0ce='Emerald';else{if(_0x1dabdf>=0x708)_0xb6f0ce='Gold';else{if(_0x1dabdf>=0x640)_0xb6f0ce='Silver';else{if(_0x1dabdf>=0x578)_0xb6f0ce='Bronze';}}}return await setDoc(_0x2a8c3b,{'type':_0x5c1104,'player':_0x398c34,'opponent':_0x449277,'previousElo':_0xb3b4fd,'newElo':_0x1dabdf,'change':_0x1dabdf-_0xb3b4fd,'matchResult':_0x522872,'previousPosition':_0x2b2d7e,'newPosition':_0x5e3f60,'rankAchieved':_0xb6f0ce,'matchId':_0x3a8e01,'timestamp':_0x2d5367||serverTimestamp(),'gameMode':'D3'}),console[_0x2a21da(0x1cf)](_0x2a21da(0x1c6)+_0x398c34),!![];}catch(_0x269a34){console[_0x2a21da(0x1ba)]('Error\x20recording\x20D3\x20ELO\x20history:',_0x269a34);throw _0x269a34;}}function a13_0xa8a8(){const _0x2c48fc=['error','console','approvedMatchesD3','opponent','toString','desc','Bronze','docs','trace','demotion','prototype','playersD3','D3\x20ELO\x20history\x20recorded\x20for\x20','__proto__','loserUsername','table','empty','data','size','bind','eloHistoryD3','log','length','apply','Unknown\x20Player'];a13_0xa8a8=function(){return _0x2c48fc;};return a13_0xa8a8();}export async function getEloHistoryD3(_0x3d70c1=0x14){const _0x53df7e=a13_0x2dbe8e;try{const _0x5a24aa=collection(db,'eloHistoryD3');let _0x2866f6;lastVisibleD3?_0x2866f6=query(_0x5a24aa,orderBy('timestamp','desc'),startAfter(lastVisibleD3),limit(_0x3d70c1)):_0x2866f6=query(_0x5a24aa,orderBy('timestamp',_0x53df7e(0x1bf)),limit(_0x3d70c1));const _0x406df6=await getDocs(_0x2866f6);if(_0x406df6['empty'])return{'entries':[],'hasMore':![]};lastVisibleD3=_0x406df6['docs'][_0x406df6['docs'][_0x53df7e(0x1d0)]-0x1];const _0x5aec82=_0x406df6[_0x53df7e(0x1c1)]['map'](async _0x433fc2=>{const _0x5024d8=_0x53df7e,_0x23a4c1=_0x433fc2['data'](),[_0x36006c,_0x3f7984]=await Promise['all']([getUsernameByIdD3(_0x23a4c1['player']),getUsernameByIdD3(_0x23a4c1[_0x5024d8(0x1bd)])]);return{..._0x23a4c1,'playerUsername':_0x36006c,'opponentUsername':_0x3f7984,'change':_0x23a4c1['newElo']-_0x23a4c1['previousElo'],'timestamp':_0x23a4c1['timestamp']};}),_0x1943aa=await Promise['all'](_0x5aec82);return{'entries':_0x1943aa,'hasMore':_0x406df6[_0x53df7e(0x1cc)]===_0x3d70c1};}catch(_0x1a51b3){console['error']('Error\x20fetching\x20D3\x20ELO\x20history:',_0x1a51b3);throw _0x1a51b3;}}export function resetPaginationD3(){lastVisibleD3=null;}
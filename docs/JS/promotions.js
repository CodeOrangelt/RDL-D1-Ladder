const a0_0x33dfbd=a0_0xc3f0;function a0_0xc3f0(_0x59b3d9,_0x4d5948){const _0x2155a6=a0_0xb5ef();return a0_0xc3f0=function(_0xa0f7ce,_0x3f17d2){_0xa0f7ce=_0xa0f7ce-0x1f0;let _0x406661=_0x2155a6[_0xa0f7ce];return _0x406661;},a0_0xc3f0(_0x59b3d9,_0x4d5948);}(function(_0x4fd34a,_0x346f1a){const _0x5a1026=a0_0xc3f0,_0x1fa08b=_0x4fd34a();while(!![]){try{const _0xba5aa5=parseInt(_0x5a1026(0x23c))/0x1*(-parseInt(_0x5a1026(0x1f8))/0x2)+parseInt(_0x5a1026(0x240))/0x3*(parseInt(_0x5a1026(0x1f3))/0x4)+parseInt(_0x5a1026(0x242))/0x5+-parseInt(_0x5a1026(0x24b))/0x6+parseInt(_0x5a1026(0x251))/0x7*(parseInt(_0x5a1026(0x236))/0x8)+-parseInt(_0x5a1026(0x230))/0x9+-parseInt(_0x5a1026(0x1f0))/0xa*(-parseInt(_0x5a1026(0x214))/0xb);if(_0xba5aa5===_0x346f1a)break;else _0x1fa08b['push'](_0x1fa08b['shift']());}catch(_0x330922){_0x1fa08b['push'](_0x1fa08b['shift']());}}}(a0_0xb5ef,0x910ec));const a0_0x3f17d2=(function(){let _0x43bc4a=!![];return function(_0x784938,_0x18e612){const _0x365766=_0x43bc4a?function(){if(_0x18e612){const _0xaecc5f=_0x18e612['apply'](_0x784938,arguments);return _0x18e612=null,_0xaecc5f;}}:function(){};return _0x43bc4a=![],_0x365766;};}()),a0_0xa0f7ce=a0_0x3f17d2(this,function(){const _0x27a567=a0_0xc3f0,_0x3be0b7=function(){let _0x548f2d;try{_0x548f2d=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0xfdb334){_0x548f2d=window;}return _0x548f2d;},_0xd608b0=_0x3be0b7(),_0x3f48a5=_0xd608b0['console']=_0xd608b0[_0x27a567(0x245)]||{},_0x35b4dc=[_0x27a567(0x206),'warn',_0x27a567(0x22c),_0x27a567(0x255),'exception',_0x27a567(0x221),_0x27a567(0x22d)];for(let _0x4e82e8=0x0;_0x4e82e8<_0x35b4dc['length'];_0x4e82e8++){const _0x33607a=a0_0x3f17d2['constructor']['prototype']['bind'](a0_0x3f17d2),_0x361b22=_0x35b4dc[_0x4e82e8],_0x56df61=_0x3f48a5[_0x361b22]||_0x33607a;_0x33607a['__proto__']=a0_0x3f17d2['bind'](a0_0x3f17d2),_0x33607a[_0x27a567(0x201)]=_0x56df61[_0x27a567(0x201)]['bind'](_0x56df61),_0x3f48a5[_0x361b22]=_0x33607a;}});function a0_0xb5ef(){const _0x5e839a=['button','addEventListener','stringify','showRankChangeBanner','276856Ogfghj','createElement','rankAchieved','You\x27ve\x20been\x20promoted\x20to','displayName','getItem','3zTUSxI','Error\x20sending\x20Discord\x20notification:','winnerId','#C0C0C0','1075491bOAcBm','A\x20player','1659545VBbtYd','username','promotion','console','pollingInterval','modifiedBy','demotion','Rank\x20Update','parse','2106210GtgwdP','new-rank-change','click','resolvedName','\x20to\x20','warn','56twnNVS','parentNode','empty','checkAndRecordPromotion','error','length','some','10jMdDjj','timestamp','display','4SQJLdb','style','forEach','now','name','416128hcEvhG','lastFetchTime','Error\x20resolving\x20username:','Promotion\x20','loserUsername','appendChild','rank-change-modal\x20','seconds','winnerUsername','toString','data','className','loserId','automatic','log','type','visibilitychange','children','processRankChanges','#CD7F32','none','eloHistory','remove','currentUser','add','Resolved\x20','setupBannerContainer','resolveUserId','6930836xNIhsX','sort','set','previousRank','shouldShowPromotion','playerUsername','data-id','player','bannerContainer','ignore-btn','usernameCache','removeChild','sendPromotionNotification','table','setItem','then','getRankName','matchId','promotion_','DISPLAY_HOURS','dismissing','RANKS','setAttribute','\x20was\x20auto-dismissed\x20within\x20last\x204\x20hours','info','trace','data-rank','promotion-banner','251595hGkvts','offsetWidth'];a0_0xb5ef=function(){return _0x5e839a;};return a0_0xb5ef();}a0_0xa0f7ce();import{collection,doc,query,where,orderBy,limit,getDocs,addDoc,getDoc,serverTimestamp,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{auth,db}from'./firebase-config.js';class PromotionManager{constructor(){const _0x3285df=a0_0xc3f0;this['DISPLAY_HOURS']=0x18,this[_0x3285df(0x229)]=[{'threshold':0x578,'name':'Bronze','color':_0x3285df(0x20b)},{'threshold':0x640,'name':'Silver','color':_0x3285df(0x23f)},{'threshold':0x708,'name':'Gold','color':'#FFD700'},{'threshold':0x834,'name':'Emerald','color':'#50C878'}],this['bannerContainer']=null,this[_0x3285df(0x1f9)]=0x0,this['fetchInterval']=0xea60,this[_0x3285df(0x246)]=null,this[_0x3285df(0x21e)]={};}['initialize'](){const _0x42df37=a0_0xc3f0;this['bannerContainer']=document['getElementById']('promotion-banner-container');if(!this['bannerContainer']){console['error']('Promotion\x20banner\x20container\x20not\x20found');return;}this[_0x42df37(0x212)]();const _0x518db0='promotions_checked_'+new Date()['toDateString'](),_0x3c03b9=sessionStorage['getItem'](_0x518db0);!_0x3c03b9&&(this['fetchRecentPromotions'](),sessionStorage[_0x42df37(0x222)](_0x518db0,'true')),document['addEventListener'](_0x42df37(0x208),()=>{const _0x2b714c=_0x42df37;document['visibilityState']==='visible'&&!sessionStorage[_0x2b714c(0x23b)](_0x518db0)&&(this['fetchRecentPromotions'](),sessionStorage[_0x2b714c(0x222)](_0x518db0,'true'));}),window[_0x42df37(0x233)]('beforeunload',()=>{this['pollingInterval']&&clearInterval(this['pollingInterval']);});}['setupBannerContainer'](){const _0x3c13df=a0_0xc3f0;this['bannerContainer']['innerHTML']='',this[_0x3c13df(0x21c)]['style']['display']='none';}async['fetchRecentPromotions'](){const _0x27ecc5=a0_0xc3f0;try{const _0x47b5c3=Date[_0x27ecc5(0x1f6)]();if(_0x47b5c3-this['lastFetchTime']<this['fetchInterval'])return;this['lastFetchTime']=_0x47b5c3;const _0x513a21=collection(db,'eloHistory'),_0x31cd57=query(_0x513a21,where(_0x27ecc5(0x207),'in',[_0x27ecc5(0x244),_0x27ecc5(0x248)]),orderBy('timestamp','desc'),limit(0x14)),_0x34710d=await getDocs(_0x31cd57),_0x4b68a7=[];_0x34710d[_0x27ecc5(0x1f5)](_0x30518d=>{const _0x3eb8de=_0x27ecc5,_0x4c25a7={'id':_0x30518d['id'],..._0x30518d['data']()};this[_0x3eb8de(0x218)](_0x30518d['id'])&&this['isNewRankChange'](_0x4c25a7)&&_0x4b68a7['push'](_0x4c25a7);}),_0x4b68a7['length']>0x0&&await this[_0x27ecc5(0x20a)](_0x4b68a7);}catch(_0x2c54d4){console[_0x27ecc5(0x255)]('Error\x20fetching\x20promotions:',_0x2c54d4);}}async[a0_0x33dfbd(0x20a)](_0x10cc5a){const _0x528f91=a0_0x33dfbd;if(_0x10cc5a['length']===0x0)return;_0x10cc5a[_0x528f91(0x215)]((_0x1cf1f5,_0x2e43fd)=>{const _0x217513=_0x528f91,_0x2d1e68=_0x1cf1f5['timestamp']?.['toMillis']?.()||_0x1cf1f5['timestamp']?.['seconds']*0x3e8||0x0,_0x33825b=_0x2e43fd[_0x217513(0x1f1)]?.['toMillis']?.()||_0x2e43fd['timestamp']?.['seconds']*0x3e8||0x0;return _0x33825b-_0x2d1e68;});const _0x115762=this['bannerContainer']['children']['length'],_0xf20e81=0x3-_0x115762;if(_0xf20e81<=0x0)return;const _0x5e202c=_0x10cc5a['slice'](0x0,_0xf20e81);for(let _0x19d948=0x0;_0x19d948<_0x5e202c[_0x528f91(0x256)];_0x19d948++){const _0x4ae8b0=_0x5e202c[_0x19d948],_0x25e4b4=auth['currentUser'];try{setTimeout(()=>{const _0x41e191=_0x528f91;this[_0x41e191(0x235)](_0x4ae8b0);},_0x19d948*0x3e8),_0x25e4b4&&_0x4ae8b0[_0x528f91(0x21b)]===_0x25e4b4['displayName']&&this['showRankChangeLightbox'](_0x4ae8b0[_0x528f91(0x207)],_0x4ae8b0[_0x528f91(0x238)]);}catch(_0x42dd5c){console['error']('Error\x20processing\x20rank\x20change:',_0x42dd5c);}}}[a0_0x33dfbd(0x218)](_0x11cdda){const _0x41ac27=a0_0x33dfbd;try{const _0x525f48=_0x41ac27(0x226)+_0x11cdda,_0x58cff0=localStorage['getItem'](_0x525f48);if(_0x58cff0){let _0x4a941b;try{_0x4a941b=JSON['parse'](_0x58cff0);}catch(_0x21fed9){return console[_0x41ac27(0x250)]('Invalid\x20storage\x20format\x20for\x20'+_0x525f48+',\x20treating\x20as\x20new'),!![];}if(_0x4a941b['ignored']===!![])return console[_0x41ac27(0x206)]('Promotion\x20'+_0x11cdda+'\x20is\x20permanently\x20ignored'),![];const _0x4d3f97=Date['now']();if(_0x4a941b['userDismissed']&&_0x4d3f97-_0x4a941b['timestamp']<this['DISPLAY_HOURS']*0x3c*0x3c*0x3e8)return console[_0x41ac27(0x206)](_0x41ac27(0x1fb)+_0x11cdda+'\x20was\x20dismissed\x20by\x20user\x20within\x20last\x20'+this[_0x41ac27(0x227)]+'\x20hours'),![];if(_0x4a941b['systemDismissed']&&_0x4d3f97-_0x4a941b['timestamp']<0x4*0x3c*0x3c*0x3e8)return console['log'](_0x41ac27(0x1fb)+_0x11cdda+_0x41ac27(0x22b)),![];}return!![];}catch(_0x1e028b){return console['error']('Error\x20checking\x20promotion\x20visibility:',_0x1e028b),![];}}['ignorePromotion'](_0x5d6ad5){const _0x45b77a=a0_0x33dfbd;try{const _0x3fe14d='promotion_'+_0x5d6ad5;localStorage[_0x45b77a(0x222)](_0x3fe14d,JSON['stringify']({'timestamp':Date['now'](),'ignored':!![]}));}catch(_0x492995){console['error']('Error\x20saving\x20promotion\x20preference:',_0x492995);}}['showRankChangeBanner'](_0x37de0a){const _0x4936f4=a0_0x33dfbd;this[_0x4936f4(0x213)](_0x37de0a)[_0x4936f4(0x223)](_0x2236c4=>{const _0x25109a=_0x4936f4,_0x2a358e='promotion_'+_0x37de0a['id'],_0x5bc228=localStorage['getItem'](_0x2a358e);if(_0x5bc228)try{const _0x33e825=JSON[_0x25109a(0x24a)](_0x5bc228);if(_0x33e825['ignored']===!![]){console['log']('Skipping\x20ignored\x20promotion:\x20'+_0x37de0a['id']);return;}}catch(_0x5da584){}localStorage['setItem'](_0x2a358e,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':![],'seenAt':Date['now']()})),this['bannerContainer']['style']['display']='block';while(this['bannerContainer'][_0x25109a(0x209)]['length']>=0x3){this[_0x25109a(0x21c)][_0x25109a(0x21f)](this['bannerContainer']['firstChild']);}const _0x1085e8=document[_0x25109a(0x237)]('div');_0x1085e8['className']=_0x25109a(0x22f),_0x1085e8[_0x25109a(0x22a)](_0x25109a(0x22e),_0x2236c4['rankAchieved']),_0x1085e8['setAttribute'](_0x25109a(0x21a),_0x2236c4['id']);const _0x153426=document['createElement']('div');_0x153426['className']='promotion-details';const _0x100a7a=_0x2236c4['resolvedName']||_0x2236c4['player']||_0x2236c4['username']||_0x2236c4['playerUsername']||_0x2236c4['displayName']||_0x25109a(0x241),_0x4d06fd=_0x2236c4[_0x25109a(0x207)]==='promotion'?_0x100a7a+'\x20was\x20promoted\x20to':_0x100a7a+'\x20was\x20demoted\x20to';_0x153426['innerHTML']=_0x4d06fd+'\x20<span\x20class=\x22rank-text\x22>'+_0x2236c4[_0x25109a(0x238)]+'</span>';const _0xe37437=document['createElement']('div');_0xe37437['className']='banner-actions';const _0x1f2762=document[_0x25109a(0x237)]('button');_0x1f2762['className']='dismiss-btn',_0x1f2762['innerHTML']='&times;',_0x1f2762['title']='Dismiss';const _0x135d4e=document['createElement'](_0x25109a(0x232));_0x135d4e[_0x25109a(0x203)]=_0x25109a(0x21d),_0x135d4e['textContent']='Don\x27t\x20show\x20again',_0x135d4e['title']='Never\x20show\x20this\x20promotion\x20again',_0xe37437[_0x25109a(0x1fd)](_0x135d4e),_0xe37437['appendChild'](_0x1f2762),_0x1085e8[_0x25109a(0x1fd)](_0x153426),_0x1085e8['appendChild'](_0xe37437),this[_0x25109a(0x21c)]['appendChild'](_0x1085e8),void _0x1085e8[_0x25109a(0x231)],setTimeout(()=>{_0x1085e8['classList']['add']('new-rank-change');},0x32),_0x1f2762['addEventListener']('click',()=>{const _0x2c5e71=_0x25109a;localStorage['setItem'](_0x2a358e,JSON[_0x2c5e71(0x234)]({'timestamp':Date['now'](),'ignored':![],'userDismissed':!![],'systemDismissed':![]})),_0x1085e8['classList'][_0x2c5e71(0x20e)](_0x2c5e71(0x24c)),_0x1085e8['classList'][_0x2c5e71(0x210)](_0x2c5e71(0x228)),setTimeout(()=>{const _0x35a429=_0x2c5e71;_0x1085e8[_0x35a429(0x252)]&&(_0x1085e8[_0x35a429(0x20e)](),this['bannerContainer'][_0x35a429(0x209)]['length']===0x0&&(this['bannerContainer']['style']['display']='none'));},0x1f4);}),_0x135d4e[_0x25109a(0x233)]('click',()=>{const _0x1c9e90=_0x25109a;localStorage['setItem'](_0x2a358e,JSON['stringify']({'timestamp':Date[_0x1c9e90(0x1f6)](),'ignored':!![],'userDismissed':!![],'systemDismissed':![]})),_0x1085e8['classList'][_0x1c9e90(0x20e)](_0x1c9e90(0x24c)),_0x1085e8['classList'][_0x1c9e90(0x210)]('dismissing'),setTimeout(()=>{const _0x48fdb1=_0x1c9e90;_0x1085e8['parentNode']&&(_0x1085e8['remove'](),this['bannerContainer']['children']['length']===0x0&&(this['bannerContainer']['style'][_0x48fdb1(0x1f2)]=_0x48fdb1(0x20c)));},0x1f4);}),setTimeout(()=>{const _0x3fd953=_0x25109a;_0x1085e8['parentNode']&&(_0x1085e8['classList']['remove'](_0x3fd953(0x24c)),_0x1085e8['classList']['add']('dismissing'),localStorage['setItem'](_0x2a358e,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':!![]})),setTimeout(()=>{const _0x6b36a=_0x3fd953;_0x1085e8['parentNode']&&(_0x1085e8['remove'](),this['bannerContainer'][_0x6b36a(0x209)]['length']===0x0&&(this['bannerContainer'][_0x6b36a(0x1f4)]['display']=_0x6b36a(0x20c)));},0x1f4));},0x3a98);});}async[a0_0x33dfbd(0x213)](_0x44c873){const _0x2a7a13=a0_0x33dfbd,_0x3b787b={..._0x44c873},_0x5651fc=[_0x44c873['player'],_0x44c873['username'],_0x44c873[_0x2a7a13(0x219)],_0x44c873['displayName']],_0x597eeb=_0x5651fc[_0x2a7a13(0x257)](_0x5711af=>_0x5711af&&typeof _0x5711af==='string'&&!_0x5711af['includes']('ID:')&&!/^[a-zA-Z0-9]{20,}$/['test'](_0x5711af));if(_0x597eeb)return _0x3b787b;let _0x32867e=null;if(_0x44c873['userId'])_0x32867e=_0x44c873['userId'];else _0x44c873['player']&&/^[A-Za-z0-9]{20,}$/['test'](_0x44c873['player'])&&(_0x32867e=_0x44c873['player']);if(!_0x32867e)return _0x3b787b;try{const _0x2d1ebb=await getDoc(doc(db,'players',_0x32867e));if(_0x2d1ebb['exists']()){const _0x4aa1b5=_0x2d1ebb[_0x2a7a13(0x202)]();if(_0x4aa1b5['username'])return _0x3b787b[_0x2a7a13(0x24e)]=_0x4aa1b5['username'],_0x3b787b;}const _0x1c2c11=await getDocs(query(collection(db,'approvedMatches'),where('winnerId','==',_0x32867e),orderBy('date','desc'),limit(0x1)));if(!_0x1c2c11['empty']){const _0x4d18d5=_0x1c2c11['docs'][0x0]['data']();if(_0x4d18d5['winnerUsername'])return _0x3b787b['resolvedName']=_0x4d18d5['winnerUsername'],_0x3b787b;}const _0x44ab8d=await getDocs(query(collection(db,'approvedMatches'),where(_0x2a7a13(0x204),'==',_0x32867e),orderBy('date','desc'),limit(0x1)));if(!_0x44ab8d[_0x2a7a13(0x253)]){const _0x378ed4=_0x44ab8d['docs'][0x0][_0x2a7a13(0x202)]();if(_0x378ed4['loserUsername'])return _0x3b787b['resolvedName']=_0x378ed4[_0x2a7a13(0x1fc)],console['log'](_0x2a7a13(0x211)+_0x32867e+_0x2a7a13(0x24f)+_0x378ed4[_0x2a7a13(0x1fc)]+'\x20(loser)'),_0x3b787b;}}catch(_0x482bb4){console['error']('Error\x20resolving\x20user\x20ID:',_0x482bb4);}return console['warn']('Failed\x20to\x20resolve\x20user\x20ID:\x20'+_0x32867e),_0x3b787b;}['showRankChangeLightbox'](_0x227656,_0x1501e6){const _0x40713d=a0_0x33dfbd;let _0x4ff1ca=document['getElementById']('rankChangeModal');!_0x4ff1ca&&(_0x4ff1ca=document['createElement']('div'),_0x4ff1ca['id']='rankChangeModal',_0x4ff1ca['className']=_0x40713d(0x1fe)+_0x227656,document['body']['appendChild'](_0x4ff1ca));const _0xaaf65a=_0x227656==='promotion'?'Congratulations!':_0x40713d(0x249),_0x3fc286=_0x227656===_0x40713d(0x244)?_0x40713d(0x239):'You\x27ve\x20been\x20demoted\x20to';_0x4ff1ca['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rank-change-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2\x20class=\x22rank-change-title\x22>'+_0xaaf65a+'</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>'+_0x3fc286+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22rank-name\x22>'+_0x1501e6+'</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22rank-change-button\x22\x20id=\x22rank-change-ok-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Got\x20it!\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x4ff1ca[_0x40713d(0x1f4)]['display']='flex',document['getElementById']('rank-change-ok-btn')['addEventListener'](_0x40713d(0x24d),()=>{_0x4ff1ca['style']['display']='none';}),_0x4ff1ca['addEventListener']('click',_0xa12816=>{_0xa12816['target']===_0x4ff1ca&&(_0x4ff1ca['style']['display']='none');});}async[a0_0x33dfbd(0x254)](_0x4402ee,_0x36d257,_0x39c78b,_0x4a5586={}){const _0x425ec1=a0_0x33dfbd;try{if(_0x36d257===_0x39c78b||!_0x4402ee)return null;const _0x158729=_0x4a5586['source']||_0x425ec1(0x205),_0x411310=_0x4a5586['matchId']||null,_0x18271f=_0x4a5586['adminUser']||null;console['log']('Processing\x20potential\x20rank\x20change:\x20'+_0x39c78b+'\x20→\x20'+_0x36d257+'\x20(source:\x20'+_0x158729+')');let _0x4fc3d1=null,_0x12fbfb=null;try{const _0x23672b=await getDoc(doc(db,'players',_0x4402ee));if(_0x23672b['exists']()){const _0x2e0c7c=_0x23672b[_0x425ec1(0x202)]();_0x4fc3d1=_0x2e0c7c['username']||_0x2e0c7c['displayName']||null,_0x12fbfb=_0x2e0c7c[_0x425ec1(0x23a)]||_0x2e0c7c['username']||null;}!_0x4fc3d1&&_0x4a5586[_0x425ec1(0x243)]&&(_0x4fc3d1=_0x4a5586['username'],_0x12fbfb=_0x4a5586['username']);!_0x4fc3d1&&auth['currentUser']&&(_0x4fc3d1=auth['currentUser']['displayName']||auth[_0x425ec1(0x20f)]['email']['split']('@')[0x0],_0x12fbfb=auth['currentUser']['displayName']||null);if(!_0x4fc3d1){const _0x5cb8a8=query(collection(db,'approvedMatches'),where(_0x425ec1(0x23e),'==',_0x4402ee),limit(0x1)),_0x15967f=await getDocs(_0x5cb8a8);if(!_0x15967f['empty'])_0x4fc3d1=_0x15967f['docs'][0x0][_0x425ec1(0x202)]()[_0x425ec1(0x200)]||'Unknown\x20Player',_0x12fbfb=_0x4fc3d1;else{const _0x1aa0f4=query(collection(db,'approvedMatches'),where('loserId','==',_0x4402ee),limit(0x1)),_0x533a34=await getDocs(_0x1aa0f4);!_0x533a34['empty']&&(_0x4fc3d1=_0x533a34[0x0]['data']()['loserUsername']||'Unknown\x20Player',_0x12fbfb=_0x4fc3d1);}}}catch(_0x224f82){console[_0x425ec1(0x255)](_0x425ec1(0x1fa),_0x224f82);}!_0x4fc3d1&&(console['warn']('Could\x20not\x20resolve\x20username\x20for\x20userId:',_0x4402ee),_0x4fc3d1='A\x20player',_0x12fbfb='Unknown\x20Player');const _0x1ef07c=this[_0x425ec1(0x224)](_0x39c78b),_0x1e554b=this['getRankName'](_0x36d257);if(_0x1ef07c!==_0x1e554b){const _0x56fa40=_0x36d257>_0x39c78b,_0x417766=_0x56fa40?'promotion':_0x425ec1(0x248),_0x51fbd9=_0x1e554b;console[_0x425ec1(0x206)]('Recording\x20'+_0x417766+'\x20for\x20'+_0x4fc3d1+':\x20'+_0x39c78b+'\x20('+_0x1ef07c+')\x20→\x20'+_0x36d257+'\x20('+_0x1e554b+')');try{const _0x15753d={'player':_0x4fc3d1,'playerUsername':_0x4fc3d1,'username':_0x4fc3d1,'displayName':_0x12fbfb,'userId':_0x4402ee,'type':_0x417766,'rankAchieved':_0x51fbd9,'timestamp':serverTimestamp(),'previousElo':_0x39c78b,'newElo':_0x36d257,'change':_0x36d257-_0x39c78b,'previousRank':_0x1ef07c,'newRank':_0x1e554b,'source':_0x158729};if(_0x158729==='match'&&_0x411310)_0x15753d[_0x425ec1(0x225)]=_0x411310;else _0x158729==='admin'&&_0x18271f?(_0x15753d[_0x425ec1(0x247)]=_0x18271f,_0x15753d['isAutomatic']=![]):_0x15753d['isAutomatic']=!![];const _0x3e882b=writeBatch(db),_0x3e093f=doc(collection(db,_0x425ec1(0x20d))),_0x115819=doc(collection(db,'promotionHistory'));return _0x3e882b['set'](_0x3e093f,_0x15753d),_0x3e882b[_0x425ec1(0x216)](_0x115819,_0x15753d),await _0x3e882b['commit'](),await this['sendPromotionNotification'](_0x4402ee,_0x4fc3d1,_0x39c78b,_0x36d257,_0x1ef07c,_0x1e554b,_0x417766,{'displayName':_0x12fbfb,'source':_0x158729,'matchId':_0x411310,'ladder':_0x4a5586['ladder']||'D1'}),console['log']('Successfully\x20recorded\x20'+_0x417766+'\x20for\x20'+_0x4fc3d1+'\x20to\x20'+_0x51fbd9),_0x51fbd9;}catch(_0x56650f){console['error']('Error\x20writing\x20promotion\x20records:',_0x56650f);try{return await addDoc(collection(db,'eloHistory'),{'player':_0x4fc3d1,'playerUsername':_0x4fc3d1,'username':_0x4fc3d1,'displayName':_0x12fbfb,'userId':_0x4402ee,'type':_0x417766,'rankAchieved':_0x51fbd9,'timestamp':serverTimestamp(),'previousElo':_0x39c78b,'newElo':_0x36d257,'change':_0x36d257-_0x39c78b,'previousRank':_0x1ef07c,'source':_0x158729,'isAutomatic':_0x158729!=='admin'}),await this['sendPromotionNotification'](_0x4402ee,_0x4fc3d1,_0x39c78b,_0x36d257,_0x1ef07c,_0x1e554b,_0x417766,{'displayName':_0x12fbfb,'source':_0x158729,'matchId':_0x411310,'ladder':_0x4a5586['ladder']||'D1'}),_0x51fbd9;}catch(_0x57727c){return console['error']('Fallback\x20write\x20failed:',_0x57727c),null;}}}return null;}catch(_0xff7355){return console[_0x425ec1(0x255)]('Error\x20in\x20promotion/demotion\x20recording:',_0xff7355),null;}}[a0_0x33dfbd(0x224)](_0x437b8b){const _0x759aba=a0_0x33dfbd;for(let _0x1f4267=this['RANKS'][_0x759aba(0x256)]-0x1;_0x1f4267>=0x0;_0x1f4267--){if(_0x437b8b>=this['RANKS'][_0x1f4267]['threshold'])return this['RANKS'][_0x1f4267][_0x759aba(0x1f7)];}return'Unranked';}['cleanup'](){const _0x26fd66=a0_0x33dfbd;this['pollingInterval']&&clearInterval(this[_0x26fd66(0x246)]);}['isNewRankChange'](_0x4c3da9){const _0x10935f=a0_0x33dfbd;if(_0x4c3da9[_0x10935f(0x1f1)]){const _0x51637d=_0x4c3da9[_0x10935f(0x1f1)][_0x10935f(0x1ff)]*0x3e8,_0x16e9a4=Date['now'](),_0x4068b1=(_0x16e9a4-_0x51637d)/(0x3e8*0x3c*0x3c);if(_0x4068b1>0x18)return![];}if(_0x4c3da9[_0x10935f(0x217)]&&_0x4c3da9['newRank']&&_0x4c3da9[_0x10935f(0x217)]!==_0x4c3da9['newRank'])return!![];return![];}async[a0_0x33dfbd(0x220)](_0x4c2103,_0x5d6954,_0x32e3a7,_0x1a672c,_0x2a4b2a,_0x3b3fd9,_0x1e1fed,_0x2a3531={}){const _0x2cba69=a0_0x33dfbd;try{console['log']('STARTING\x20notification\x20for\x20'+_0x5d6954+'\x27s\x20'+_0x1e1fed);const _0x44f07c={'userId':_0x4c2103,'username':_0x5d6954,'displayName':_0x2a3531[_0x2cba69(0x23a)]||_0x5d6954,'oldElo':parseInt(_0x32e3a7),'newElo':parseInt(_0x1a672c),'eloDifference':parseInt(_0x1a672c)-parseInt(_0x32e3a7),'oldRank':_0x2a4b2a,'newRank':_0x3b3fd9,'type':_0x1e1fed,'timestamp':serverTimestamp(),'processed':![],'source':_0x2a3531['source']||_0x2cba69(0x205),'matchId':_0x2a3531['matchId']||null,'ladder':_0x2a3531['ladder']||'D1','adminUser':_0x2a3531['adminUser']||null};console['log']('Creating\x20Discord\x20notification:',_0x44f07c);const _0x2b7ebc=await addDoc(collection(db,'promotionNotifications'),_0x44f07c);return console[_0x2cba69(0x206)]('Discord\x20notification\x20sent\x20successfully\x20with\x20ID:\x20'+_0x2b7ebc['id']),!![];}catch(_0x13840b){return console[_0x2cba69(0x255)](_0x2cba69(0x23d),_0x13840b),![];}}}export const promotionManager=new PromotionManager();document['addEventListener']('DOMContentLoaded',()=>{promotionManager['initialize']();});export const initializePromotionTracker=()=>promotionManager['initialize']();export const checkAndRecordPromotion=(_0x5be9d2,_0x45284c,_0x5642ec,_0x28d9ab)=>promotionManager['checkAndRecordPromotion'](_0x5be9d2,_0x45284c,_0x5642ec,_0x28d9ab);export const getRankName=_0x358bb4=>promotionManager['getRankName'](_0x358bb4);
const a12_0x56d0aa=a12_0x1142,a12_0x2784f6=(function(){let _0x31c5d2=!![];return function(_0x107d49,_0x175664){const _0x41f59d=_0x31c5d2?function(){const _0x4407ae=a12_0x1142;if(_0x175664){const _0x2e836a=_0x175664[_0x4407ae(0x128)](_0x107d49,arguments);return _0x175664=null,_0x2e836a;}}:function(){};return _0x31c5d2=![],_0x41f59d;};}()),a12_0x2a3089=a12_0x2784f6(this,function(){const _0x125aa3=a12_0x1142,_0x41d8e2=function(){const _0x5b2d3d=a12_0x1142;let _0x253982;try{_0x253982=Function(_0x5b2d3d(0x11b)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x4e81a4){_0x253982=window;}return _0x253982;},_0x55fc76=_0x41d8e2(),_0x3968cb=_0x55fc76[_0x125aa3(0x12e)]=_0x55fc76['console']||{},_0x40872e=[_0x125aa3(0x149),'warn','info',_0x125aa3(0x124),'exception',_0x125aa3(0x134),_0x125aa3(0x131)];for(let _0x169b38=0x0;_0x169b38<_0x40872e['length'];_0x169b38++){const _0x48b708=a12_0x2784f6['constructor']['prototype']['bind'](a12_0x2784f6),_0x1b6236=_0x40872e[_0x169b38],_0x41c4ab=_0x3968cb[_0x1b6236]||_0x48b708;_0x48b708['__proto__']=a12_0x2784f6['bind'](a12_0x2784f6),_0x48b708[_0x125aa3(0x141)]=_0x41c4ab['toString']['bind'](_0x41c4ab),_0x3968cb[_0x1b6236]=_0x48b708;}});a12_0x2a3089();import{getAuth,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{doc,getDoc,collection,query,where,getDocs,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';function a12_0x1142(_0x2f113f,_0x34501d){const _0x2a3089=a12_0x20ca();return a12_0x1142=function(_0x2784f6,_0x384c0d){_0x2784f6=_0x2784f6-0x116;let _0x20ca15=_0x2a3089[_0x2784f6];return _0x20ca15;},a12_0x1142(_0x2f113f,_0x34501d);}import{isAdmin}from'./admin-check.js';const ADMIN_EMAILS=[a12_0x56d0aa(0x13a),'Brian2af@outlook.com'],userCache={'uid':null,'username':null,'isAdmin':![],'hasCheckedCollections':![],'lastChecked':0x0,'role':null},invitationCache={'lastCheck':0x0,'pendingCount':0x0,'checkInterval':0x493e0};function updateInboxNotification(_0x552e44){const _0x1d57d9=a12_0x56d0aa,_0xacaed3=document[_0x1d57d9(0x13f)]('inbox-notification');_0xacaed3&&(_0x552e44>0x0?(_0xacaed3['style']['display']='inline-block',_0xacaed3['textContent']=_0x552e44>0x9?'9+':_0x552e44):_0xacaed3['style'][_0x1d57d9(0x14a)]='none');}async function checkPendingInvitationsForCurrentUser(_0x73a90a){const _0x48297e=a12_0x56d0aa;try{const _0x4955d3=Date[_0x48297e(0x13b)]();if(_0x4955d3-invitationCache[_0x48297e(0x129)]<invitationCache['checkInterval'])return updateInboxNotification(invitationCache['pendingCount']),invitationCache[_0x48297e(0x13d)];invitationCache['lastCheck']=_0x4955d3;const _0x8cd99a=collection(db,_0x48297e(0x12b)),_0x4c5096=query(_0x8cd99a,where('toUserId','==',_0x73a90a),where(_0x48297e(0x144),'==',_0x48297e(0x147)),limit(0x5)),_0x48b448=await getDocs(_0x4c5096),_0x48b4de=_0x48b448[_0x48297e(0x13e)];return invitationCache['pendingCount']=_0x48b4de,updateInboxNotification(_0x48b4de),_0x48b4de;}catch(_0x47045a){return console['warn']('Could\x20not\x20check\x20pending\x20invitations\x20for\x20current\x20user:',_0x47045a),0x0;}}function a12_0x20ca(){const _0x33b41c=['docs','data','all','playersD3','querySelectorAll','return\x20(function()\x20','uid','charAt','Error\x20in\x20checkAdminRoles:','logout-link','a[href]','Found\x20admin\x20role:\x20','slice','isAdmin','error','signOut','\x20by\x20email:','currentUser','apply','lastCheck','style','gameInvitations','empty','Found\x20user\x20in\x20','console','admin','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20class=\x22nav-username\x22>','trace','nonParticipants','<a\x20href=\x22login.html\x22\x20class=\x22login-link\x22>Login</a>','table','split','map','lastChecked','auth-section','none','admin@ladder.com','now','roleName','pendingCount','size','getElementById','includes','toString','</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username=','closest','status','role','hasCheckedCollections','pending','addEventListener','log','display','username','\x20by\x20UID:','Error\x20signing\x20out:','click','Checking\x20roles\x20for\x20user:\x20','toLowerCase','target'];a12_0x20ca=function(){return _0x33b41c;};return a12_0x20ca();}function updateAuthSectionImmediate(_0x412340,_0x3da97a=![]){const _0x18b8ee=a12_0x56d0aa,_0x1a4d0d=document['getElementById'](_0x18b8ee(0x138));if(!_0x1a4d0d)return;if(_0x412340&&_0x3da97a)document['querySelectorAll']('.admin-only')['forEach'](_0x1c157e=>{const _0x335ec8=_0x18b8ee;_0x1c157e['style'][_0x335ec8(0x14a)]='block';});else!_0x412340&&document[_0x18b8ee(0x11a)]('.admin-only')['forEach'](_0xc63122=>{const _0x3bb698=_0x18b8ee;_0xc63122[_0x3bb698(0x12a)][_0x3bb698(0x14a)]=_0x3bb698(0x139);});if(_0x412340){const _0xadd452=userCache['username']||(_0x412340['email']?_0x412340['email']['split']('@')[0x0]:'User'),_0x36b287=userCache[_0x18b8ee(0x145)]?'\x20('+userCache['role']+')':_0x3da97a?'\x20(Admin)':'';_0x1a4d0d['innerHTML']=_0x18b8ee(0x130)+_0xadd452+_0x36b287+_0x18b8ee(0x142)+encodeURIComponent(_0xadd452)+'\x22>Profile</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./inbox.html\x22\x20class=\x22nav-notification\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Inbox\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22inbox-notification\x22\x20class=\x22notification-dot\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22members.html\x22>Members</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./redeem.html\x22><i\x20class=\x22fas\x20fa-gift\x22></i>Store</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20id=\x22logout-link\x22>Sign\x20Out</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';const _0x5a8674=document[_0x18b8ee(0x13f)](_0x18b8ee(0x11f));_0x5a8674&&_0x5a8674['addEventListener']('click',_0x16659c=>{const _0x1b11cc=_0x18b8ee;_0x16659c['preventDefault']();const _0x5d8373=getAuth();updateAuthSectionImmediate(null),_0x5d8373[_0x1b11cc(0x125)]()['catch'](_0x176939=>{const _0x516fba=_0x1b11cc;console['error'](_0x516fba(0x14d),_0x176939);});}),_0x412340['uid']&&setTimeout(()=>{const _0x8ac88a=_0x18b8ee;checkPendingInvitationsForCurrentUser(_0x412340[_0x8ac88a(0x11c)]);},0x3e8);}else _0x1a4d0d['innerHTML']=_0x18b8ee(0x133);}async function checkAdminRoles(_0x448ef7){const _0x52afd5=a12_0x56d0aa;if(!_0x448ef7||!_0x448ef7['email'])return{'isAdmin':![],'role':null};try{console['log'](_0x52afd5(0x14f)+_0x448ef7['email']);const _0x477059=['players','playersD2',_0x52afd5(0x119),'nonParticipants','userProfiles'],_0x1ec494=['council','creative\x20lead','owner',_0x52afd5(0x12f)];for(const _0x4212dc of _0x477059){try{const _0x3af383=doc(db,_0x4212dc,_0x448ef7['uid']),_0x4e1677=await getDoc(_0x3af383);if(_0x4e1677['exists']()){const _0x47b980=_0x4e1677['data']();console['log']('Found\x20user\x20in\x20'+_0x4212dc+'\x20by\x20UID:',_0x47b980);let _0x42e61d=(_0x47b980['roleName']||_0x47b980['role']||'')[_0x52afd5(0x150)](),_0x42bd28=_0x47b980['roleName']||_0x47b980['role']||'';if(_0x42e61d&&_0x1ec494[_0x52afd5(0x140)](_0x42e61d)){console[_0x52afd5(0x149)](_0x52afd5(0x121)+_0x42e61d+'\x20in\x20'+_0x4212dc);const _0x3baf30=_0x42bd28['split']('\x20')[_0x52afd5(0x136)](_0x295386=>_0x295386[_0x52afd5(0x11d)](0x0)['toUpperCase']()+_0x295386['slice'](0x1)['toLowerCase']())['join']('\x20');return{'isAdmin':!![],'role':_0x3baf30};}}}catch(_0x324966){console[_0x52afd5(0x124)]('Error\x20checking\x20'+_0x4212dc+_0x52afd5(0x14c),_0x324966);}}for(const _0x1cfc84 of _0x477059){try{const _0x3e52b5=collection(db,_0x1cfc84);let _0x4dbce1=query(_0x3e52b5,where('email','==',_0x448ef7['email'])),_0x5cfb84=await getDocs(_0x4dbce1);_0x5cfb84[_0x52afd5(0x12c)]&&(_0x4dbce1=query(_0x3e52b5,where('email','==',_0x448ef7['email']['toLowerCase']())),_0x5cfb84=await getDocs(_0x4dbce1));if(!_0x5cfb84[_0x52afd5(0x12c)]){const _0x1d6ccc=_0x5cfb84[_0x52afd5(0x116)][0x0]['data']();console['log'](_0x52afd5(0x12d)+_0x1cfc84+'\x20by\x20email:',_0x1d6ccc);let _0x23c623=(_0x1d6ccc[_0x52afd5(0x13c)]||_0x1d6ccc[_0x52afd5(0x145)]||'')['toLowerCase'](),_0x37309a=_0x1d6ccc['roleName']||_0x1d6ccc['role']||'';if(_0x23c623&&_0x1ec494[_0x52afd5(0x140)](_0x23c623)){console['log']('Found\x20admin\x20role:\x20'+_0x23c623+'\x20in\x20'+_0x1cfc84);const _0x559e9a=_0x37309a[_0x52afd5(0x135)]('\x20')['map'](_0x29cb20=>_0x29cb20['charAt'](0x0)['toUpperCase']()+_0x29cb20[_0x52afd5(0x122)](0x1)[_0x52afd5(0x150)]())['join']('\x20');return{'isAdmin':!![],'role':_0x559e9a};}}}catch(_0xc121ae){console['error']('Error\x20checking\x20'+_0x1cfc84+_0x52afd5(0x126),_0xc121ae);}}return console[_0x52afd5(0x149)]('No\x20admin\x20roles\x20found\x20for\x20user'),{'isAdmin':![],'role':null};}catch(_0x5cb06c){return console['error'](_0x52afd5(0x11e),_0x5cb06c),{'isAdmin':![],'role':null};}}async function updateAuthSection(_0x526e13){const _0x1553c3=a12_0x56d0aa,_0x2ca2f8=_0x526e13&&isAdmin(_0x526e13['email']);updateAuthSectionImmediate(_0x526e13,_0x2ca2f8);if(!_0x526e13){userCache[_0x1553c3(0x11c)]=null,userCache[_0x1553c3(0x14b)]=null,userCache[_0x1553c3(0x123)]=![],userCache[_0x1553c3(0x146)]=![],userCache[_0x1553c3(0x145)]=null;return;}const _0x3f98af=Date['now']();if(_0x526e13['uid']===userCache['uid']&&userCache['hasCheckedCollections']&&_0x3f98af-userCache[_0x1553c3(0x137)]<0x493e0)return;try{userCache[_0x1553c3(0x11c)]=_0x526e13['uid'],userCache['lastChecked']=_0x3f98af;const _0x103a26=isAdmin(_0x526e13['email']);userCache['isAdmin']=_0x103a26;if(!_0x103a26){const {isAdmin:_0x13a69a,role:_0x2e6c7e}=await checkAdminRoles(_0x526e13);userCache['isAdmin']=_0x13a69a,userCache['role']=_0x2e6c7e,_0x13a69a&&(document[_0x1553c3(0x11a)]('.admin-only')['forEach'](_0x2f9399=>{const _0x2d46d3=_0x1553c3;_0x2f9399['style'][_0x2d46d3(0x14a)]='block';}),updateAuthSectionImmediate(_0x526e13,!![]));}const _0xe43f66=['players','playersD2','playersD3','playersDuos','playersCTF',_0x1553c3(0x132),'userProfiles'],_0x12e104=_0xe43f66['map'](_0x2b833e=>getDoc(doc(db,_0x2b833e,_0x526e13['uid']))['then'](_0x92094c=>_0x92094c['exists']()?{'collection':_0x2b833e,'data':_0x92094c['data']()}:null)['catch'](()=>null)),_0xa6b43c=await Promise[_0x1553c3(0x118)](_0x12e104),_0x26515a=_0xa6b43c['filter'](_0x386f17=>_0x386f17!==null);let _0x4d2736=null;for(const _0x4f2e53 of _0x26515a){if(_0x4f2e53['data']['username']){_0x4d2736=_0x4f2e53[_0x1553c3(0x117)][_0x1553c3(0x14b)];break;}}userCache['username']=_0x4d2736||(_0x526e13['email']?_0x526e13['email'][_0x1553c3(0x135)]('@')[0x0]:'User'),userCache[_0x1553c3(0x146)]=!![],updateAuthSectionImmediate(_0x526e13,userCache['isAdmin']),setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0x526e13['uid']);},0x1f4);}catch(_0x42b62a){console[_0x1553c3(0x124)]('Error\x20in\x20full\x20auth\x20update:',_0x42b62a);}}document['addEventListener']('DOMContentLoaded',()=>{const _0x3a00f6=a12_0x56d0aa,_0x5318c9=getAuth();onAuthStateChanged(_0x5318c9,async _0x384f2e=>{const _0x509daf=a12_0x1142;await updateAuthSection(_0x384f2e),_0x384f2e&&checkPendingInvitationsForCurrentUser(_0x384f2e[_0x509daf(0x11c)]);}),document[_0x3a00f6(0x148)]('visibilitychange',()=>{const _0x17fff3=_0x3a00f6;!document['hidden']&&_0x5318c9[_0x17fff3(0x127)]&&checkPendingInvitationsForCurrentUser(_0x5318c9['currentUser'][_0x17fff3(0x11c)]);}),document['addEventListener'](_0x3a00f6(0x14e),_0x49d3cc=>{const _0x20c893=_0x3a00f6;_0x49d3cc[_0x20c893(0x151)][_0x20c893(0x143)](_0x20c893(0x120))&&_0x5318c9['currentUser']&&checkPendingInvitationsForCurrentUser(_0x5318c9['currentUser'][_0x20c893(0x11c)]);});});export{updateAuthSection};
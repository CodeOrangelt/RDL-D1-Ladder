const a14_0x293d41=a14_0x4231;(function(_0x2a17f1,_0x220ae){const _0x14e55e=a14_0x4231,_0x111959=_0x2a17f1();while(!![]){try{const _0x25e95a=parseInt(_0x14e55e(0xae))/0x1*(-parseInt(_0x14e55e(0x96))/0x2)+-parseInt(_0x14e55e(0x9f))/0x3*(-parseInt(_0x14e55e(0xaa))/0x4)+-parseInt(_0x14e55e(0x80))/0x5+-parseInt(_0x14e55e(0x9c))/0x6*(-parseInt(_0x14e55e(0xac))/0x7)+-parseInt(_0x14e55e(0xb1))/0x8+-parseInt(_0x14e55e(0x7f))/0x9+parseInt(_0x14e55e(0x83))/0xa*(parseInt(_0x14e55e(0xa9))/0xb);if(_0x25e95a===_0x220ae)break;else _0x111959['push'](_0x111959['shift']());}catch(_0x1cbd66){_0x111959['push'](_0x111959['shift']());}}}(a14_0x5648,0x638b6));function a14_0x5648(){const _0x3fc69e=['Unranked','promotion','loserId','__proto__','Silver','demotion','length','desc','Unknown\x20Player','(((.+)+)+)+$','bind','eloHistoryD2','map','username','3464YyfzIK','apply','docs','Error\x20recording\x20D2\x20ELO\x20history:','exception','Gold','50286jEcpBE','Emerald','loserUsername','2053641xViaQr','{}.constructor(\x22return\x20this\x22)(\x20)','constructor','log','empty','approvedMatchesD2','newElo','Error\x20fetching\x20D2\x20ELO\x20history:','error','search','11rQUIYH','4wySflj','timestamp','511dkSGBZ','toString','150ppltwG','table','match','2783080Hwujgf','winnerUsername','Error\x20getting\x20username:','6922683kSDUAv','3398335VHNRuw','trace','D2\x20ELO\x20history\x20recorded\x20for\x20','11679130sDFTfy','data','prototype','console','all'];a14_0x5648=function(){return _0x3fc69e;};return a14_0x5648();}const a14_0x2b3557=(function(){let _0x32e273=!![];return function(_0x1b3724,_0x5b3f5d){const _0x5ac0aa=_0x32e273?function(){const _0x343654=a14_0x4231;if(_0x5b3f5d){const _0x2277e7=_0x5b3f5d[_0x343654(0x97)](_0x1b3724,arguments);return _0x5b3f5d=null,_0x2277e7;}}:function(){};return _0x32e273=![],_0x5ac0aa;};}()),a14_0x4e1a50=a14_0x2b3557(this,function(){const _0x1f97bb=a14_0x4231;return a14_0x4e1a50[_0x1f97bb(0xad)]()['search'](_0x1f97bb(0x91))[_0x1f97bb(0xad)]()[_0x1f97bb(0xa1)](a14_0x4e1a50)[_0x1f97bb(0xa8)]('(((.+)+)+)+$');});a14_0x4e1a50();const a14_0x3d5088=(function(){let _0xba66b7=!![];return function(_0x21b33e,_0x1455ba){const _0x344411=_0xba66b7?function(){const _0xfc48bf=a14_0x4231;if(_0x1455ba){const _0x5ad268=_0x1455ba[_0xfc48bf(0x97)](_0x21b33e,arguments);return _0x1455ba=null,_0x5ad268;}}:function(){};return _0xba66b7=![],_0x344411;};}()),a14_0x4a112b=a14_0x3d5088(this,function(){const _0x3f0260=a14_0x4231,_0xfa12c=function(){const _0x240855=a14_0x4231;let _0x3f34e9;try{_0x3f34e9=Function('return\x20(function()\x20'+_0x240855(0xa0)+');')();}catch(_0x60ea8b){_0x3f34e9=window;}return _0x3f34e9;},_0x285d02=_0xfa12c(),_0x2fc1fb=_0x285d02['console']=_0x285d02[_0x3f0260(0x86)]||{},_0x4f5f4c=[_0x3f0260(0xa2),'warn','info',_0x3f0260(0xa7),_0x3f0260(0x9a),_0x3f0260(0xaf),_0x3f0260(0x81)];for(let _0x513209=0x0;_0x513209<_0x4f5f4c['length'];_0x513209++){const _0x5c2946=a14_0x3d5088[_0x3f0260(0xa1)][_0x3f0260(0x85)][_0x3f0260(0x92)](a14_0x3d5088),_0x493f50=_0x4f5f4c[_0x513209],_0x38c489=_0x2fc1fb[_0x493f50]||_0x5c2946;_0x5c2946[_0x3f0260(0x8b)]=a14_0x3d5088['bind'](a14_0x3d5088),_0x5c2946['toString']=_0x38c489['toString']['bind'](_0x38c489),_0x2fc1fb[_0x493f50]=_0x5c2946;}});a14_0x4a112b();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';function a14_0x4231(_0x5a09c3,_0x1d81bf){const _0x534a12=a14_0x5648();return a14_0x4231=function(_0x4a112b,_0x3d5088){_0x4a112b=_0x4a112b-0x7f;let _0x581a5a=_0x534a12[_0x4a112b];return _0x581a5a;},a14_0x4231(_0x5a09c3,_0x1d81bf);}const ELO_THRESHOLDS_D2=[{'name':a14_0x293d41(0x9b),'elo':0x708},{'name':'Silver','elo':0x640},{'name':'Bronze','elo':0x578},{'name':a14_0x293d41(0x88),'elo':0x4b0}];let lastVisibleD2=null;async function getUsernameByIdD2(_0x1f79cb){const _0xaa3a20=a14_0x293d41;try{if(!_0x1f79cb)return _0xaa3a20(0x90);const _0x28ed6f=await getDoc(doc(db,'playersD2',_0x1f79cb));if(_0x28ed6f['exists']())return _0x28ed6f[_0xaa3a20(0x84)]()[_0xaa3a20(0x95)]||'Unknown\x20Player';const _0x177097=await getDocs(query(collection(db,_0xaa3a20(0xa4)),where('winnerId','==',_0x1f79cb),limit(0x1)));if(!_0x177097[_0xaa3a20(0xa3)])return _0x177097[_0xaa3a20(0x98)][0x0][_0xaa3a20(0x84)]()[_0xaa3a20(0xb2)]||_0xaa3a20(0x90);const _0x124645=await getDocs(query(collection(db,_0xaa3a20(0xa4)),where(_0xaa3a20(0x8a),'==',_0x1f79cb),limit(0x1)));if(!_0x124645[_0xaa3a20(0xa3)])return _0x124645[_0xaa3a20(0x98)][0x0]['data']()[_0xaa3a20(0x9e)]||_0xaa3a20(0x90);return _0xaa3a20(0x90);}catch(_0x42aa71){return console[_0xaa3a20(0xa7)](_0xaa3a20(0xb3),_0x42aa71),'Unknown\x20Player';}}export async function recordEloChangeD2({playerId:_0x4573ac,previousElo:_0x94e4af,newElo:_0x4aa590,opponentId:_0x35ba51,matchResult:_0x29b56d,previousPosition:_0x156c90,newPosition:_0x24ddb1,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x192e4f,timestamp:_0x2b2fe7}){const _0x37eed1=a14_0x293d41;try{const _0x1a35fa=doc(collection(db,_0x37eed1(0x93)));let _0x5e6470=_0x37eed1(0xb0);if(isPromotion)_0x5e6470=_0x37eed1(0x89);if(isDemotion)_0x5e6470=_0x37eed1(0x8d);let _0x59c191=_0x37eed1(0x88);if(_0x4aa590>=0x834)_0x59c191=_0x37eed1(0x9d);else{if(_0x4aa590>=0x708)_0x59c191=_0x37eed1(0x9b);else{if(_0x4aa590>=0x640)_0x59c191=_0x37eed1(0x8c);else{if(_0x4aa590>=0x578)_0x59c191='Bronze';}}}return await setDoc(_0x1a35fa,{'type':_0x5e6470,'player':_0x4573ac,'opponent':_0x35ba51,'previousElo':_0x94e4af,'newElo':_0x4aa590,'change':_0x4aa590-_0x94e4af,'matchResult':_0x29b56d,'previousPosition':_0x156c90,'newPosition':_0x24ddb1,'rankAchieved':_0x59c191,'matchId':_0x192e4f,'timestamp':_0x2b2fe7}),console[_0x37eed1(0xa2)](_0x37eed1(0x82)+_0x4573ac),!![];}catch(_0x2fad8f){console['error'](_0x37eed1(0x99),_0x2fad8f);throw _0x2fad8f;}}export async function getEloHistoryD2(_0x4c753c=0x14){const _0x169ebb=a14_0x293d41;try{const _0x14c756=collection(db,_0x169ebb(0x93));let _0x43a0d4;lastVisibleD2?_0x43a0d4=query(_0x14c756,orderBy(_0x169ebb(0xab),_0x169ebb(0x8f)),startAfter(lastVisibleD2),limit(_0x4c753c)):_0x43a0d4=query(_0x14c756,orderBy(_0x169ebb(0xab),_0x169ebb(0x8f)),limit(_0x4c753c));const _0x1e6fb1=await getDocs(_0x43a0d4);if(_0x1e6fb1[_0x169ebb(0xa3)])return{'entries':[],'hasMore':![]};lastVisibleD2=_0x1e6fb1['docs'][_0x1e6fb1[_0x169ebb(0x98)][_0x169ebb(0x8e)]-0x1];const _0xf864ec=_0x1e6fb1[_0x169ebb(0x98)][_0x169ebb(0x94)](async _0x1d528d=>{const _0x434579=_0x169ebb,_0xfc7178=_0x1d528d['data'](),[_0x24ede7,_0x5393d2]=await Promise[_0x434579(0x87)]([getUsernameByIdD2(_0xfc7178['player']),getUsernameByIdD2(_0xfc7178['opponent'])]);return{..._0xfc7178,'playerUsername':_0x24ede7,'opponentUsername':_0x5393d2,'change':_0xfc7178[_0x434579(0xa5)]-_0xfc7178['previousElo'],'timestamp':_0xfc7178[_0x434579(0xab)]};}),_0x520fe3=await Promise['all'](_0xf864ec);return{'entries':_0x520fe3,'hasMore':_0x1e6fb1['size']===_0x4c753c};}catch(_0x46b021){console[_0x169ebb(0xa7)](_0x169ebb(0xa6),_0x46b021);throw _0x46b021;}}export function resetPaginationD2(){lastVisibleD2=null;}
const a53r=a53b;(function(a,b){const q=a53b,c=a();while(!![]){try{const d=parseInt(q(0x1fd))/0x1+parseInt(q(0x20b))/0x2+-parseInt(q(0x200))/0x3+parseInt(q(0x1f4))/0x4+parseInt(q(0x206))/0x5*(-parseInt(q(0x1fa))/0x6)+-parseInt(q(0x20c))/0x7*(parseInt(q(0x203))/0x8)+-parseInt(q(0x205))/0x9;if(d===b)break;else c['push'](c['shift']());}catch(e){c['push'](c['shift']());}}}(a53a,0xa34df));import{db}from'../firebase-config.js';import{collection,doc,getDoc,getDocs,query,limit,startAfter,where,onSnapshot}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const cache={'userProfiles':new Map(),'ladderPlayers':new Map(),'matchResults':new Map(),'eloHistory':new Map()},CACHE_EXPIRY={'userProfiles':0x5*0x3c*0x3e8,'ladderPlayers':0x2*0x3c*0x3e8,'matchResults':0x1*0x3c*0x3e8,'eloHistory':0x3*0x3c*0x3e8};export const userProfilesRef=collection(db,a53r(0x1fe));export async function fetchPaginatedData(a,b=0xa,c=null){const s=a53r;let d=query(a,limit(b));c&&(d=query(d,startAfter(c)));const e=await getDocs(d),f=e['docs'][e[s(0x204)][s(0x20e)]-0x1];return{'data':e[s(0x204)][s(0x1fb)](g=>({'id':g['id'],...g[s(0x1f3)]()})),'lastVisible':f,'hasMore':e[s(0x204)]['length']===b};}export async function getUserProfile(a){const t=a53r,b=cache[t(0x1fe)][t(0x1fc)](a);if(b&&Date['now']()-b[t(0x208)]<CACHE_EXPIRY[t(0x1fe)])return b['data'];const c=await getDoc(doc(userProfilesRef,a));if(c['exists']()){const d=c['data']();return cache[t(0x1fe)]['set'](a,{'data':d,'timestamp':Date['now']()}),d;}return null;}export async function getLadderData(a=0x1){const u=a53r,b=u(0x209)+a,c=cache[u(0x201)]['get'](b);if(c&&Date['now']()-c[u(0x208)]<CACHE_EXPIRY['ladderPlayers'])return c[u(0x1f3)];const d=a===0x1?'players':'playersD'+a,e=collection(db,d),f=await getDocs(query(e,limit(0x64))),g=f[u(0x204)][u(0x1fb)](h=>({'id':h['id'],...h[u(0x1f3)]()}));return cache[u(0x201)][u(0x20a)](b,{'data':g,'timestamp':Date[u(0x1f5)]()}),g;}export async function getEloHistoryBatch(a,b=0x1){const v=a53r,c=b===0x1?'eloHistory':'eloHistoryD'+b,d=collection(db,c),e={},f=[];a[v(0x207)](h=>{const w=v,j=h+'_'+b,k=cache[w(0x202)]['get'](j);k&&Date['now']()-k['timestamp']<CACHE_EXPIRY[w(0x202)]?e[h]=k['data']:f[w(0x1f7)](h);});const g=0xa;for(let h=0x0;h<f[v(0x20e)];h+=g){const j=f['slice'](h,h+g);if(j[v(0x20e)]>0x0)try{const k=query(d,where(v(0x1f8),'in',j),limit(0x64)),l=await getDocs(k);l['docs'][v(0x207)](m=>{const x=v,n=m['data'](),o=n['playerId'];if(!e[o])e[o]=[];e[o][x(0x1f7)](n);const p=o+'_'+b;cache['eloHistory'][x(0x20a)](p,{'data':e[o],'timestamp':Date['now']()});});}catch(m){console[v(0x20d)]('Error\x20fetching\x20batch\x20ELO\x20history:',m);}}return e;}let usernameCache=new Map(),usernameCacheTimestamp=Date[a53r(0x1f5)]();export function setupEfficientListener(a,b=[],c){const d=collection(db,a),e=query(d,...b),f=onSnapshot(e,g=>{const y=a53b,h=g['docChanges']()[y(0x1fb)](i=>({'type':i['type'],'id':i[y(0x1ff)]['id'],'data':i['doc']['data']()}));h[y(0x20e)]>0x0&&c(h,g[y(0x204)]);});return f;}export async function bulkResolveUsernames(a){const z=a53r,b=new Map();if(!a||a[z(0x20e)]===0x0)return b;const c=['players',z(0x1f9),'playersD3','nonParticipants'];for(const d of c){const e=collection(db,d),f=await getDocs(e);f[z(0x207)](g=>{const A=z,h=g[A(0x1f3)]();h[A(0x1f6)]&&a['includes'](g['id'])&&b['set'](g['id'],h['username']);});}return b;}function a53b(a,b){const c=a53a();return a53b=function(d,e){d=d-0x1f3;let f=c[d];if(a53b['ZgLLHD']===undefined){var g=function(l){const m='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let n='',o='';for(let p=0x0,q,r,s=0x0;r=l['charAt'](s++);~r&&(q=p%0x4?q*0x40+r:r,p++%0x4)?n+=String['fromCharCode'](0xff&q>>(-0x2*p&0x6)):0x0){r=m['indexOf'](r);}for(let t=0x0,u=n['length'];t<u;t++){o+='%'+('00'+n['charCodeAt'](t)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(o);};a53b['wcNqHT']=g,a=arguments,a53b['ZgLLHD']=!![];}const h=c[0x0],i=d+h,j=a[i];return!j?(f=a53b['wcNqHT'](f),a[i]=f):f=j,f;},a53b(a,b);}function a53a(){const B=['zwXVsgLZDg9YEq','nJG3mJmXmNvyCw5pBG','zg9JCW','nJyZnJm5m1bLwfD0Aa','mZvstvPvswK','zM9YrwfJAa','DgLTzxn0yw1W','zgL2AxnPB25F','C2v0','mJy1ntK2mfDltgD3rG','n2POt292za','zxjYB3i','BgvUz3rO','zgf0yq','mtmYmtiWogXuA25Vta','BM93','DxnLCM5HBwu','ChvZAa','CgXHEwvYswq','CgXHEwvYC0qY','otqWotHnCgDfBe8','BwfW','z2v0','mtaWmJiYmfPet1jrqG','DxnLCLbYB2zPBgvZ','zg9J','odu2mJmWv0Tuyxz6','BgfKzgvYugXHEwvYCW'];a53a=function(){return B;};return a53a();}
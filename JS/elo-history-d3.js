const a15q=a15d;(function(a,b){const n=a15d,c=a();while(!![]){try{const d=-parseInt(n(0xca))/0x1*(-parseInt(n(0xeb))/0x2)+-parseInt(n(0xd9))/0x3+-parseInt(n(0xdb))/0x4+parseInt(n(0xd1))/0x5*(parseInt(n(0xe1))/0x6)+parseInt(n(0xcb))/0x7*(parseInt(n(0xea))/0x8)+parseInt(n(0xd8))/0x9+-parseInt(n(0xd7))/0xa;if(d===b)break;else c['push'](c['shift']());}catch(e){c['push'](c['shift']());}}}(a15c,0x924fb));const a15b=(function(){let a=!![];return function(b,c){const d=a?function(){const o=a15d;if(c){const e=c[o(0xf0)](b,arguments);return c=null,e;}}:function(){};return a=![],d;};}()),a15a=a15b(this,function(){const p=a15d;let a;try{const d=Function(p(0xd4)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');a=d();}catch(f){a=window;}const b=a[p(0xef)]=a['console']||{},c=[p(0xcd),'warn',p(0xe4),p(0xd3),'exception',p(0xe5),'trace'];for(let g=0x0;g<c[p(0xf3)];g++){const h=a15b[p(0xed)]['prototype'][p(0xd0)](a15b),i=c[g],j=b[i]||h;h['__proto__']=a15b['bind'](a15b),h['toString']=j[p(0xe6)]['bind'](j),b[i]=h;}});a15a();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc,where}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';function a15c(){const v=['Bg9N','zwXVsgLZDg9YEuqZ','ywXS','yMLUza','nZKWvKH0C1Hm','DxnLCM5HBwu','zxjYB3i','CMv0DxjUicHMDw5JDgLVBIGPia','yxbWCM92zwrnyxrJAgvZrdm','zxHPC3rZ','ndq4mdm0mfHxrNvlwa','mty0mdy4mMjvAhPPCq','mZC0otuYBLDeCKHp','Bwf0y2G','ndi0mJe4oe1uD3rPtW','DgLTzxn0yw1W','CgXHEwvY','zw1WDhK','B3bWB25LBNq','ChjLDMLVDxnfBg8','mZC3otrguNjeC3G','r29Sza','qNjVBNPL','Aw5MBW','DgfIBgu','Dg9tDhjPBMC','ChjVBw90Aw9U','BwfW','zgf0yq','ogXyr0z1Ba','mNnYtez6yq','rdmGruXpigHPC3rVCNKGCMvJB3jKzwqGzM9Yia','y29UC3rYDwn0B3i','u2LSDMvY','y29UC29Szq','yxbWBhK','vw5RBM93BIbqBgf5zxi','zg9JCW','BgvUz3rO','CgXHEwvYC0qZ','BMv3rwXV','rxjYB3iGz2v0DgLUzYbemYb1C2vYBMfTztO','rw1LCMfSza','nJaYmK9rrhvtzG','nZm0nta1ogHAr1nTyW','D2LUBMvYswq'];a15c=function(){return v;};return a15c();}const ELO_THRESHOLDS_D3=[{'name':a15q(0xc9),'elo':0x7d0},{'name':a15q(0xe2),'elo':0x708},{'name':a15q(0xee),'elo':0x640},{'name':'Bronze','elo':0x578},{'name':'Unranked','elo':0x4b0}];function a15d(a,b){const c=a15c();return a15d=function(d,e){d=d-0xc9;let f=c[d];if(a15d['EbxMut']===undefined){var g=function(l){const m='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let n='',o='';for(let p=0x0,q,r,s=0x0;r=l['charAt'](s++);~r&&(q=p%0x4?q*0x40+r:r,p++%0x4)?n+=String['fromCharCode'](0xff&q>>(-0x2*p&0x6)):0x0){r=m['indexOf'](r);}for(let t=0x0,u=n['length'];t<u;t++){o+='%'+('00'+n['charCodeAt'](t)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(o);};a15d['AQVUFD']=g,a=arguments,a15d['EbxMut']=!![];}const h=c[0x0],i=d+h,j=a[i];return!j?(f=a15d['AQVUFD'](f),a[i]=f):f=j,f;},a15d(a,b);}let lastVisibleD3=null;async function getUsernameByIdD3(a){const r=a15q;try{if(!a)return r(0xf1);const b=await getDoc(doc(db,r(0xf4),a));if(b[r(0xd6)]())return b[r(0xe9)]()[r(0xd2)]||'Unknown\x20Player';const c=await getDocs(query(collection(db,r(0xd5)),where(r(0xcc),'==',a),limit(0x1)));if(!c[r(0xde)])return c[r(0xf2)][0x0]['data']()['winnerUsername']||'Unknown\x20Player';const d=await getDocs(query(collection(db,r(0xd5)),where('loserId','==',a),limit(0x1)));if(!d[r(0xde)])return d[r(0xf2)][0x0]['data']()['loserUsername']||r(0xf1);return r(0xf1);}catch(e){return console['error'](r(0xf6),e),r(0xf1);}}export async function recordEloChangeD3({playerId:a,previousElo:b,newElo:c,opponentId:d,matchResult:e,previousPosition:f,newPosition:g,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:h,timestamp:i}){const s=a15q;try{const j=doc(collection(db,s(0xce)));let k=s(0xda);if(isPromotion)k=s(0xe7);if(isDemotion)k='demotion';let l='Unranked';if(c>=0x7d0)l='Emerald';else{if(c>=0x708)l=s(0xe2);else{if(c>=0x640)l=s(0xee);else{if(c>=0x578)l=s(0xe3);}}}return await setDoc(j,{'type':k,'player':a,'opponent':d,'previousElo':b,'newElo':c,'change':c-b,'matchResult':e,'previousPosition':f,'newPosition':g,'rankAchieved':l,'matchId':h,'timestamp':i||serverTimestamp(),'gameMode':'D3'}),console['log'](s(0xec)+a),!![];}catch(m){console[s(0xd3)]('Error\x20recording\x20D3\x20ELO\x20history:',m);throw m;}}export async function getEloHistoryD3(a=0x14){const t=a15q;try{const b=collection(db,'eloHistoryD3');let c;lastVisibleD3?c=query(b,orderBy(t(0xdc),'desc'),startAfter(lastVisibleD3),limit(a)):c=query(b,orderBy(t(0xdc),'desc'),limit(a));const d=await getDocs(c);if(d['empty'])return{'entries':[],'hasMore':![]};lastVisibleD3=d['docs'][d['docs']['length']-0x1];const e=d[t(0xf2)][t(0xe8)](async g=>{const u=t,h=g[u(0xe9)](),[i,j]=await Promise[u(0xcf)]([getUsernameByIdD3(h[u(0xdd)]),getUsernameByIdD3(h[u(0xdf)])]);return{...h,'playerUsername':i,'opponentUsername':j,'change':h[u(0xf5)]-h[u(0xe0)],'timestamp':h[u(0xdc)]};}),f=await Promise['all'](e);return{'entries':f,'hasMore':d['size']===a};}catch(g){console[t(0xd3)]('Error\x20fetching\x20D3\x20ELO\x20history:',g);throw g;}}export function resetPaginationD3(){lastVisibleD3=null;}
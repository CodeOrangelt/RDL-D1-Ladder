(function(a,b){const u=a29d,c=a();while(!![]){try{const d=parseInt(u(0x1a8))/0x1*(parseInt(u(0x198))/0x2)+parseInt(u(0x191))/0x3+-parseInt(u(0x1ae))/0x4+-parseInt(u(0x197))/0x5*(parseInt(u(0x1a1))/0x6)+parseInt(u(0x189))/0x7*(parseInt(u(0x1a9))/0x8)+-parseInt(u(0x196))/0x9*(parseInt(u(0x199))/0xa)+parseInt(u(0x187))/0xb*(parseInt(u(0x186))/0xc);if(d===b)break;else c['push'](c['shift']());}catch(e){c['push'](c['shift']());}}}(a29c,0x5e69b));const a29b=(function(){let a=!![];return function(b,c){const d=a?function(){if(c){const e=c['apply'](b,arguments);return c=null,e;}}:function(){};return a=![],d;};}()),a29a=a29b(this,function(){const v=a29d,a=function(){let f;try{f=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(g){f=window;}return f;},b=a(),c=b['console']=b['console']||{},d=['log','warn','info',v(0x19b),'exception',v(0x193),'trace'];for(let e=0x0;e<d['length'];e++){const f=a29b['constructor'][v(0x19d)]['bind'](a29b),g=d[e],h=c[g]||f;f['__proto__']=a29b[v(0x18d)](a29b),f['toString']=h[v(0x1a3)][v(0x18d)](h),c[g]=f;}});function a29c(){const z=['mZC3nJa4EfbQyKP3','yxbWCM92zwrnyxrJAgvZrdm','CM91BMq','Bg9N','yMLUza','Bg9ZCW','ywXS','rxjYB3iGAw4GyxbWCM92zvjLCg9YDeqZoG','ndG3nZaXAe5kDgTI','zwXVuMf0Aw5N','DgfIBgu','t25Lig9YigjVDgGGrdmGCgXHEwvYCYbUB3qGzM91BMq','tM8GDxnLCIbSB2DNzwqGAw4','otLjuLndA2G','mZG5nZbeu2ngAui','ntaWoenpu1jhtq','nJK0odiWvwLAENfr','zxHPC3rZ','zxjYB3i','zgf0yq','ChjVDg90ExbL','Bg9ZzxjvC2vYBMfTzq','rdmGv2LUBMvYigfSCMvHzhKGCMfUA2vKigHPz2HLCIaTigTLzxbPBMCGCg9ZAxrPB25Z','zg9JCW','mJe2sKXywKvH','zw1WDhK','Dg9tDhjPBMC','tufyx1nbrKvFsu5uruDfuG','y29TBwL0','DxbKyxrL','DwLK','mtm5D1DdCvrJ','ntzLq095z2K','CgXHEwvYC0qZ','zw1HAwW','q3vYCMvUDcb1C2vYBMfTztO','Cg9ZAxrPB24','mJa2odrbvNvhBLm','rdmGtwf0y2GGBw92zwqGDg8GyxbWCM92zwqGy29SBgvJDgLVBG','nJu4mJq5mM1NtffxDa','mtfMDLnpvwO','DxnLCM5HBwu'];a29c=function(){return z;};return a29c();}a29a();import{addDoc,updateDoc,serverTimestamp,collection,doc,getDoc,getDocs,query,where,setDoc,deleteDoc,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';import{recordEloChangeD3}from'./elo-history-d3.js';function a29d(a,b){const c=a29c();return a29d=function(d,e){d=d-0x185;let f=c[d];if(a29d['WvoYRh']===undefined){var g=function(l){const m='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let n='',o='';for(let p=0x0,q,r,s=0x0;r=l['charAt'](s++);~r&&(q=p%0x4?q*0x40+r:r,p++%0x4)?n+=String['fromCharCode'](0xff&q>>(-0x2*p&0x6)):0x0){r=m['indexOf'](r);}for(let t=0x0,u=n['length'];t<u;t++){o+='%'+('00'+n['charCodeAt'](t)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(o);};a29d['ASZJHh']=g,a=arguments,a29d['WvoYRh']=!![];}const h=c[0x0],i=d+h,j=a[i];return!j?(f=a29d['ASZJHh'](f),a[i]=f):f=j,f;},a29d(a,b);}export function calculateEloD3(a,b,c=0x20){const w=a29d,d=0x1/(0x1+Math['pow'](0xa,(b-a)/0x190)),e=0x1/(0x1+Math['pow'](0xa,(a-b)/0x190)),f=a+c*(0x1-d),g=b+c*(0x0-e);return{'newWinnerRating':Math[w(0x18b)](f),'newLoserRating':Math['round'](g)};}export async function updateEloRatingsD3(a,b,c){const x=a29d;try{const d=writeBatch(db),e=doc(db,x(0x1aa),a),f=doc(db,'playersD3',b),[g,h]=await Promise['all']([getDoc(e),getDoc(f)]);if(!g['exists']()||!h[x(0x19a)]())throw new Error(x(0x194));const i=g[x(0x19c)](),j=h[x(0x19c)](),k=i['position']||Number[x(0x1a4)],l=j[x(0x1ad)]||Number['MAX_SAFE_INTEGER'],{newWinnerRating:m,newLoserRating:n}=calculateEloD3(i[x(0x192)]||0x4b0,j['eloRating']||0x4b0);let o=k,p=l;if(k>l){console['log']('D3\x20Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked'),o=l,p=l+0x1;const q=query(collection(db,'playersD3'),where(x(0x1ad),'>',l),where(x(0x1ad),'<',k)),r=await getDocs(q);for(const s of r['docs']){s['id']!==a&&s['id']!==b&&d['update'](doc(db,'playersD3',s['id']),{'position':s['data']()[x(0x1ad)]+0x1});}}else console['log'](x(0x19f));return d['update'](e,{'eloRating':m,'lastMatchDate':serverTimestamp(),'position':o,'lastMatchId':c}),d[x(0x1a6)](f,{'eloRating':n,'lastMatchDate':serverTimestamp(),'position':p,'lastMatchId':c}),await d[x(0x1a5)](),console[x(0x18c)]('D3\x20ELO\x20ratings\x20updated\x20successfully'),await Promise[x(0x18f)]([recordEloChangeD3({'playerId':a,'previousElo':i[x(0x192)]||0x4b0,'newElo':m,'opponentId':b,'matchResult':'win','previousPosition':k,'newPosition':o,'isPromotion':o<k,'matchId':c,'timestamp':serverTimestamp()}),recordEloChangeD3({'playerId':b,'previousElo':j[x(0x192)]||0x4b0,'newElo':n,'opponentId':a,'matchResult':x(0x18e),'previousPosition':l,'newPosition':p,'isDemotion':p>l,'matchId':c,'timestamp':serverTimestamp()})]),!![];}catch(t){console['error']('Error\x20in\x20updateEloRatingsD3:',t);throw t;}}export async function approveReportD3(a,b,c,d){const y=a29d;try{console['log']('Starting\x20approveReportD3\x20function\x20with:',{'reportId':a,'winnerScore':b,'winnerSuicides':c,'winnerComment':d});const e=auth['currentUser'];if(!e){console['log'](y(0x195));throw new Error('You\x20must\x20be\x20logged\x20in\x20to\x20approve\x20D3\x20matches');}console['log']('Current\x20user:',e[y(0x1ab)]);const f=await getDoc(doc(db,'playersD3',e[y(0x1a7)])),g=f[y(0x19a)]()?f[y(0x19c)]()[y(0x188)]:null;console['log'](y(0x1ac),g);const h=doc(db,'pendingMatchesD3',a),i=await getDoc(h);if(!i[y(0x19a)]()){console['log']('D3\x20Report\x20not\x20found\x20with\x20ID:',a);throw new Error('D3\x20match\x20report\x20not\x20found');}const j=i['data']();console['log']('D3\x20Report\x20data:',j);if(g!==j['winnerUsername'])throw new Error('Only\x20the\x20winner\x20can\x20approve\x20D3\x20matches');const k={...j,'winnerScore':b,'winnerSuicides':c,'winnerComment':d,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':g,'createdAt':j['createdAt']||serverTimestamp(),'winnerUsername':j['winnerUsername'],'loserUsername':j[y(0x19e)]};await setDoc(doc(db,y(0x18a),a),k),await deleteDoc(h),console['log'](y(0x185));const [l,m]=await Promise[y(0x18f)]([getDocs(query(collection(db,'playersD3'),where('username','==',j['winnerUsername']))),getDocs(query(collection(db,'playersD3'),where(y(0x188),'==',j[y(0x19e)])))]);if(l[y(0x1a2)]||m[y(0x1a2)])throw new Error('Could\x20not\x20find\x20D3\x20player\x20documents');const n=l['docs'][0x0]['id'],o=m[y(0x1a0)][0x0]['id'];return await updateEloRatingsD3(n,o,a),console['log']('D3\x20Match\x20successfully\x20approved\x20and\x20ELO\x20updated'),!![];}catch(p){console['error'](y(0x190),p);throw p;}}
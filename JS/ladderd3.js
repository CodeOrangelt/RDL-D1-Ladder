const a31_0x4cd4e6=a31_0x34d8,a31_0x54652b=(function(){let _0x42b962=!![];return function(_0x145163,_0x362e38){const _0x54910a=_0x42b962?function(){const _0x482c04=a31_0x34d8;if(_0x362e38){const _0x3349dc=_0x362e38[_0x482c04(0xaf)](_0x145163,arguments);return _0x362e38=null,_0x3349dc;}}:function(){};return _0x42b962=![],_0x54910a;};}()),a31_0x35d0a6=a31_0x54652b(this,function(){const _0x227703=a31_0x34d8;let _0x29ea30;try{const _0x526676=Function('return\x20(function()\x20'+_0x227703(0xb0)+');');_0x29ea30=_0x526676();}catch(_0x52bcda){_0x29ea30=window;}const _0x4ace67=_0x29ea30[_0x227703(0x98)]=_0x29ea30['console']||{},_0x1e87cc=[_0x227703(0xd8),'warn','info','error','exception',_0x227703(0x9d),_0x227703(0xa1)];for(let _0x52d7c6=0x0;_0x52d7c6<_0x1e87cc['length'];_0x52d7c6++){const _0x272665=a31_0x54652b['constructor']['prototype'][_0x227703(0xd6)](a31_0x54652b),_0x2a0167=_0x1e87cc[_0x52d7c6],_0x269ec6=_0x4ace67[_0x2a0167]||_0x272665;_0x272665['__proto__']=a31_0x54652b['bind'](a31_0x54652b),_0x272665[_0x227703(0xc9)]=_0x269ec6['toString']['bind'](_0x269ec6),_0x4ace67[_0x2a0167]=_0x272665;}});a31_0x35d0a6();import{collection,getDocs,doc,getDoc,query,where,updateDoc,Timestamp,orderBy,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import a31_0x15c768 from'./firebase-idle-wrapper.js';import{getTokensByUsernames,getPrimaryDisplayToken,clearTokenCache}from'./tokens.js';function a31_0x34d8(_0x37c4b8,_0x1cbd8a){const _0x35d0a6=a31_0x3d27();return a31_0x34d8=function(_0x54652b,_0x277520){_0x54652b=_0x54652b-0x96;let _0x3d2722=_0x35d0a6[_0x54652b];return _0x3d2722;},a31_0x34d8(_0x37c4b8,_0x1cbd8a);}const styleEl=document[a31_0x4cd4e6(0xd4)](a31_0x4cd4e6(0xb9));styleEl['textContent']='\x0a\x20\x20.streak-indicator\x20{\x0a\x20\x20\x20\x20font-size:\x200.9em;\x0a\x20\x20\x20\x20color:\x20#FF4500;\x0a\x20\x20\x20\x20margin-left:\x205px;\x0a\x20\x20\x20\x20font-weight:\x20bold;\x0a\x20\x20}\x0a',document['head']['appendChild'](styleEl);function a31_0x3d27(){const _0xbc5ee0=['querySelector','#b9f1fc','console','error','\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20alt=\x22','D3\x20Ladder\x20table\x20body\x20not\x20found','fontWeight','table','#F44336','tokenImage','totalKills','trace','ceil','playerUsername','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td\x20style=\x22position:\x20relative;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20position:\x20relative;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username=','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>','message','newElo','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22trend-indicator\x22\x20style=\x22margin-left:\x205px;\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>','totalDeaths','eloRating','winnerScore','timestamp','#50C878','data','apply','{}.constructor(\x22return\x20this\x22)(\x20)','MAX_SAFE_INTEGER','function','has','wins','toLowerCase','string','approvedMatchesD3','get','style','set','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Rank</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Username</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>ELO</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Matches</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Wins</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Losses</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>K/D</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Win\x20Rate</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','map','#ladder-d3\x20tbody','totalMatches','equipped','join','winRate','Error\x20loading\x20D3\x20ladder:','<img\x20src=\x22../images/flags/','<tr><td\x20colspan=\x228\x22\x20class=\x22loading-cell\x22>Loading\x20D3\x20ladder\x20data...</td></tr>','displayLadderD3\x20function\x20not\x20available','td:nth-child(3)','D3:\x20Error\x20fetching\x20tokens:','forEach','toString','then','push','now','tokenName','playersD3','warn','change','.trend-indicator','username','length','createElement','position','bind','\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20class=\x22player-token\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20title=\x22','log','player'];a31_0x3d27=function(){return _0xbc5ee0;};return a31_0x3d27();}const playerCacheD3={'data':null,'timestamp':0x0},CACHE_DURATION=0x7530;async function displayLadderD3(_0x114a31=![]){const _0x44aeed=a31_0x4cd4e6,_0xb2a681=document['querySelector'](_0x44aeed(0xbd));if(!_0xb2a681){console['error'](_0x44aeed(0x9b));return;}_0xb2a681['innerHTML']=_0x44aeed(0xc4);try{const _0x122f98=Date[_0x44aeed(0xcc)]();if(!_0x114a31&&playerCacheD3[_0x44aeed(0xae)]&&_0x122f98-playerCacheD3[_0x44aeed(0xac)]<CACHE_DURATION){updateLadderDisplayD3(playerCacheD3[_0x44aeed(0xae)]);return;}const _0x271a19=collection(db,'playersD3'),_0xdfb1d9=await getDocs(_0x271a19),_0x263662=[];_0xdfb1d9[_0x44aeed(0xc8)](_0x311b6e=>{const _0x5700d0=_0x44aeed,_0x405639=_0x311b6e['data']();_0x405639[_0x5700d0(0xd2)]&&_0x263662[_0x5700d0(0xcb)]({..._0x405639,'id':_0x311b6e['id'],'elo':_0x405639[_0x5700d0(0xaa)]||0x0,'position':_0x405639['position']||Number[_0x5700d0(0xb1)]});});const _0x5f3b27=collection(db,'userProfiles'),_0xc6ebee=await getDocs(_0x5f3b27),_0x10d558=new Map();_0xc6ebee['forEach'](_0x520451=>{const _0x1556ef=_0x520451['data']();_0x1556ef['username']&&_0x10d558['set'](_0x1556ef['username']['toLowerCase'](),_0x1556ef);});for(const _0x5fd4f3 of _0x263662){const _0x3c68a6=_0x5fd4f3['username'][_0x44aeed(0xb5)]();if(_0x10d558[_0x44aeed(0xb3)](_0x3c68a6)){const _0xd385b0=_0x10d558[_0x44aeed(0xb8)](_0x3c68a6);_0xd385b0['country']&&(_0x5fd4f3['country']=_0xd385b0['country'][_0x44aeed(0xb5)]());}}const _0x1dc12f=_0x263662['map'](_0x3217e3=>_0x3217e3[_0x44aeed(0xd2)]),_0x1ec440=await fetchBatchMatchStatsD3(_0x1dc12f);_0x263662['sort']((_0x53e282,_0x3f6d79)=>{const _0x2e740e=_0x44aeed,_0x3dda77=_0x1ec440['get'](_0x53e282[_0x2e740e(0xd2)])?.['totalMatches']||0x0,_0x47e0e4=_0x1ec440['get'](_0x3f6d79['username'])?.[_0x2e740e(0xbe)]||0x0;if(_0x3dda77===0x0!==(_0x47e0e4===0x0))return _0x3dda77===0x0?0x1:-0x1;return(_0x53e282['position']||0x3e7)-(_0x3f6d79[_0x2e740e(0xd5)]||0x3e7);}),_0x263662[_0x44aeed(0xc8)]((_0x46bb73,_0x83b54a)=>{_0x46bb73['position']=_0x83b54a+0x1;}),playerCacheD3[_0x44aeed(0xae)]=_0x263662,playerCacheD3['timestamp']=_0x122f98,updateLadderDisplayD3(_0x263662);}catch(_0x370ed7){console['error'](_0x44aeed(0xc2),_0x370ed7),_0xb2a681['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20colspan=\x228\x22\x20style=\x22text-align:\x20center;\x20color:\x20red;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Error\x20loading\x20D3\x20ladder\x20data:\x20'+_0x370ed7[_0x44aeed(0xa6)]+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';}}function calculateStreakDays(_0x36ea05){const _0x38c52e=a31_0x4cd4e6;if(!_0x36ea05)return 0x0;const _0x5b0d6b=_0x36ea05['toDate'](),_0x26a8cd=new Date(),_0x2d4713=Math['abs'](_0x26a8cd-_0x5b0d6b);return Math[_0x38c52e(0xa2)](_0x2d4713/(0x3e8*0x3c*0x3c*0x18));}async function updatePlayerPositions(_0x31ac9e,_0x393d3f){const _0x2c1b40=a31_0x4cd4e6;try{const _0x44d229=collection(db,'playersD3'),_0x4d3751=await getDocs(_0x44d229),_0x120bea=[];_0x4d3751['forEach'](_0x20cea9=>{const _0x2cd0ce=a31_0x34d8;_0x120bea[_0x2cd0ce(0xcb)]({'id':_0x20cea9['id'],..._0x20cea9['data']()});});const _0x56d9c8=_0x120bea['find'](_0x83d06e=>_0x83d06e[_0x2c1b40(0xd2)]===_0x31ac9e),_0x136b84=_0x120bea['find'](_0x5b3fd1=>_0x5b3fd1['username']===_0x393d3f);if(!_0x56d9c8||!_0x136b84){console['error']('Could\x20not\x20find\x20winner\x20or\x20loser\x20in\x20D3\x20players\x20list');return;}if(_0x56d9c8['position']>_0x136b84[_0x2c1b40(0xd5)]){const _0x55d615=_0x136b84['position'];for(const _0x1735b9 of _0x120bea){_0x1735b9['position']>=_0x136b84['position']&&_0x1735b9['position']<_0x56d9c8['position']&&_0x1735b9[_0x2c1b40(0xd2)]!==_0x31ac9e&&await updateDoc(doc(db,'playersD3',_0x1735b9['id']),{'position':_0x1735b9[_0x2c1b40(0xd5)]+0x1});}await updateDoc(doc(db,_0x2c1b40(0xce),_0x56d9c8['id']),{'position':_0x55d615});if(_0x55d615===0x1){const _0x5097ce=doc(db,'playersD3',_0x56d9c8['id']),_0x37ad32=await getDoc(_0x5097ce);!_0x37ad32['data']()['firstPlaceDate']&&await updateDoc(_0x5097ce,{'firstPlaceDate':Timestamp['now']()});}if(_0x136b84['position']===0x1){const _0x1cbd5b=doc(db,'playersD3',_0x136b84['id']);await updateDoc(_0x1cbd5b,{'firstPlaceDate':null});}playerCacheD3['timestamp']=0x0;}}catch(_0x35afd1){console['error']('Error\x20updating\x20D3\x20player\x20positions:',_0x35afd1);}}async function updateLadderDisplayD3(_0x49de85){const _0x423d1f=a31_0x4cd4e6;_0x49de85['sort']((_0x56b6b7,_0x1f1c04)=>_0x56b6b7[_0x423d1f(0xd5)]-_0x1f1c04[_0x423d1f(0xd5)]);const _0x4bef02=document['querySelector']('#ladder-d3\x20tbody');if(!_0x4bef02)return;_0x4bef02['innerHTML']='';const _0x343932=_0x49de85['map'](_0x5b2903=>_0x5b2903['username']),_0x229956=await fetchBatchMatchStatsD3(_0x343932);let _0x259850=new Map();try{typeof clearTokenCache===_0x423d1f(0xb2)&&clearTokenCache(),_0x259850=await getTokensByUsernames(_0x343932);}catch(_0x206b68){console['error'](_0x423d1f(0xc7),_0x206b68);}const _0x309e44=document[_0x423d1f(0x96)]('#ladder-d3\x20thead\x20tr');_0x309e44&&(_0x309e44['innerHTML']=_0x423d1f(0xbb));const _0x348a82=_0x49de85[_0x423d1f(0xbc)](_0x50769a=>{const _0x35de1c=_0x423d1f,_0x37062a=_0x229956['get'](_0x50769a[_0x35de1c(0xd2)])||{'totalMatches':0x0,'wins':0x0,'losses':0x0,'kda':0x0,'winRate':0x0,'totalKills':0x0,'totalDeaths':0x0},_0x48dbe7=_0x259850[_0x35de1c(0xb8)](_0x50769a['username'])||[],_0x3a85d0=getPrimaryDisplayToken(_0x48dbe7);return createPlayerRowD3(_0x50769a,_0x37062a,_0x3a85d0);})[_0x423d1f(0xc0)]('');_0x4bef02['innerHTML']=_0x348a82,getPlayersLastEloChangesD3(_0x343932)[_0x423d1f(0xca)](_0x4462ae=>{const _0x72ac9e=_0x423d1f,_0x1a9351=new Map();_0x4bef02['querySelectorAll']('tr')['forEach']((_0xb8b5e5,_0x4db8c9)=>{_0x4db8c9<_0x343932['length']&&_0x1a9351['set'](_0x343932[_0x4db8c9],_0xb8b5e5);}),_0x4462ae[_0x72ac9e(0xc8)]((_0x1b3a20,_0x3f22e2)=>{const _0x1de45e=_0x72ac9e,_0x4633de=_0x1a9351['get'](_0x3f22e2);if(_0x4633de&&_0x1b3a20!==0x0){const _0x153e57=_0x4633de['querySelector'](_0x1de45e(0xc6));if(_0x153e57){const _0x3eaa47=_0x1b3a20>0x0?'+'+_0x1b3a20:''+_0x1b3a20,_0x509da7=_0x153e57['querySelector'](_0x1de45e(0xd1));_0x509da7&&(_0x509da7['textContent']=_0x3eaa47,_0x509da7['style']['color']=_0x1b3a20>0x0?'#4CAF50':_0x1de45e(0x9e),_0x509da7['style'][_0x1de45e(0x9c)]='bold',_0x509da7[_0x1de45e(0xb9)]['fontSize']='0.85em',_0x509da7[_0x1de45e(0xb9)]['display']='inline',_0x509da7['style']['visibility']='visible',_0x509da7[_0x1de45e(0xb9)]['opacity']='1');}}});})['catch'](_0x458333=>console[_0x423d1f(0x99)]('Error\x20updating\x20D3\x20ELO\x20trend\x20indicators:',_0x458333));}async function fetchBatchMatchStatsD3(_0x268cee){const _0x2b5a09=a31_0x4cd4e6,_0x4ff99a=new Map();try{_0x268cee['forEach'](_0x529d75=>{const _0x52a226=a31_0x34d8;_0x4ff99a[_0x52a226(0xba)](_0x529d75,{'totalMatches':0x0,'wins':0x0,'losses':0x0,'totalKills':0x0,'totalDeaths':0x0,'kda':0x0,'winRate':0x0});});const _0x42aac3=collection(db,_0x2b5a09(0xb7)),_0xe2f238=await getDocs(_0x42aac3);_0xe2f238['forEach'](_0x346099=>{const _0x2062ce=_0x2b5a09,_0x57f72d=_0x346099[_0x2062ce(0xae)](),_0x305842=_0x57f72d['winnerUsername'],_0x1b3cab=_0x57f72d['loserUsername'];if(_0x268cee['includes'](_0x305842)){const _0x2a10ba=_0x4ff99a[_0x2062ce(0xb8)](_0x305842);_0x2a10ba['wins']++,_0x2a10ba[_0x2062ce(0xbe)]++,_0x2a10ba['totalKills']+=parseInt(_0x57f72d[_0x2062ce(0xab)])||0x0,_0x2a10ba[_0x2062ce(0xa9)]+=parseInt(_0x57f72d['loserScore'])||0x0;}if(_0x268cee['includes'](_0x1b3cab)){const _0x25ee30=_0x4ff99a['get'](_0x1b3cab);_0x25ee30['losses']++,_0x25ee30['totalMatches']++,_0x25ee30[_0x2062ce(0xa0)]+=parseInt(_0x57f72d['loserScore'])||0x0,_0x25ee30['totalDeaths']+=parseInt(_0x57f72d['winnerScore'])||0x0;}}),_0x268cee['forEach'](_0x609a9a=>{const _0x42dd91=_0x2b5a09,_0x3344f0=_0x4ff99a[_0x42dd91(0xb8)](_0x609a9a);_0x3344f0['kda']=_0x3344f0['totalDeaths']>0x0?(_0x3344f0[_0x42dd91(0xa0)]/_0x3344f0[_0x42dd91(0xa9)])['toFixed'](0x2):_0x3344f0['totalKills'],_0x3344f0['winRate']=_0x3344f0[_0x42dd91(0xbe)]>0x0?(_0x3344f0['wins']/_0x3344f0['totalMatches']*0x64)['toFixed'](0x1):0x0;});}catch(_0x5c0d10){console['error']('Error\x20fetching\x20batch\x20match\x20stats\x20for\x20D3:',_0x5c0d10);}return _0x4ff99a;}function createPlayerRowD3(_0x254542,_0x1192fd,_0x23a221){const _0x5147f9=a31_0x4cd4e6,_0x32932b=parseFloat(_0x254542['elo'])||0x0;let _0x2648f5='gray';if(_0x32932b>=0x7d0)_0x2648f5=_0x5147f9(0xad);else{if(_0x32932b>=0x708)_0x2648f5='#FFD700';else{if(_0x32932b>=0x640)_0x2648f5=_0x5147f9(0x97);else _0x32932b>=0x578&&(_0x2648f5='#CD7F32');}}let _0x49fca4='';_0x254542['country']&&(_0x49fca4=_0x5147f9(0xc3)+_0x254542['country']['toLowerCase']()+'.png\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20alt=\x22'+_0x254542['country']+'\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20class=\x22player-flag\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20style=\x22margin-left:\x205px;\x20vertical-align:\x20middle;\x20width:\x2020px;\x20height:\x20auto;\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20onerror=\x22this.style.display=\x27none\x27\x22>');let _0x5e6854='';return _0x23a221&&(_0x5e6854='<img\x20src=\x22'+_0x23a221[_0x5147f9(0x9f)]+_0x5147f9(0x9a)+_0x23a221[_0x5147f9(0xcd)]+_0x5147f9(0xd7)+_0x23a221['tokenName']+'\x20'+(_0x23a221[_0x5147f9(0xbf)]?'(Equipped)':'')+'\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20style=\x22width:\x2035px;\x20height:\x2035px;\x20margin-left:\x205px;\x20vertical-align:\x20middle;\x20object-fit:\x20contain;\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20onerror=\x22this.style.display=\x27none\x27\x22>'),'\x0a\x20\x20\x20\x20<tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+_0x254542['position']+_0x5147f9(0xa4)+encodeURIComponent(_0x254542['username'])+'&ladder=d3\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20style=\x22color:\x20'+_0x2648f5+';\x20text-decoration:\x20none;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x254542['username']+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x49fca4+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x5e6854+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td\x20style=\x22color:\x20'+_0x2648f5+';\x20position:\x20relative;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22elo-container\x22\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22elo-value\x22>'+_0x32932b+_0x5147f9(0xa8)+_0x1192fd['totalMatches']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+_0x1192fd[_0x5147f9(0xb4)]+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+_0x1192fd['losses']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+_0x1192fd['kda']+_0x5147f9(0xa5)+_0x1192fd[_0x5147f9(0xc1)]+'%</td>\x0a\x20\x20\x20\x20</tr>';}async function getPlayersLastEloChangesD3(_0x27d768){const _0x2e8266=a31_0x4cd4e6,_0x5dbb64=new Map();_0x27d768['forEach'](_0x3ffb03=>_0x5dbb64['set'](_0x3ffb03,0x0));try{const _0x48e759=new Map(),_0x3093a4=await getDocs(collection(db,'playersD3'));_0x3093a4['forEach'](_0x405443=>{const _0x391edd=_0x405443['data']();_0x391edd['username']&&_0x48e759['set'](_0x405443['id'],_0x391edd['username']);});const _0x53c186=collection(db,'eloHistoryD3'),_0x2fd9b7=query(_0x53c186,orderBy('timestamp','desc'),limit(0x64)),_0x4cb55b=await getDocs(_0x2fd9b7),_0x215d37=new Map();_0x4cb55b['forEach'](_0x1d2f08=>{const _0x323c70=a31_0x34d8,_0x44fb4e=_0x1d2f08['data']();let _0x399765=null;if(_0x44fb4e['username'])_0x399765=_0x44fb4e['username'];else{if(_0x44fb4e[_0x323c70(0xa3)])_0x399765=_0x44fb4e['playerUsername'];else{if(_0x44fb4e['player']&&typeof _0x44fb4e['player']===_0x323c70(0xb6))_0x399765=_0x44fb4e[_0x323c70(0xd9)];else{if(_0x44fb4e['player']&&_0x48e759[_0x323c70(0xb3)](_0x44fb4e['player']))_0x399765=_0x48e759['get'](_0x44fb4e['player']);else _0x44fb4e['playerId']&&_0x48e759['has'](_0x44fb4e['playerId'])&&(_0x399765=_0x48e759['get'](_0x44fb4e['playerId']));}}}_0x399765&&_0x27d768['includes'](_0x399765)&&(!_0x215d37['has'](_0x399765)&&_0x215d37['set'](_0x399765,[]),_0x215d37[_0x323c70(0xb8)](_0x399765)[_0x323c70(0xcb)]({..._0x44fb4e,'timestamp':_0x44fb4e['timestamp']?.['seconds']||0x0}));}),_0x215d37[_0x2e8266(0xc8)]((_0x1745e7,_0x1d9c5a)=>{const _0x3b7454=_0x2e8266;if(_0x1745e7[_0x3b7454(0xd3)]>0x0){_0x1745e7['sort']((_0x57507e,_0x55786e)=>_0x55786e[_0x3b7454(0xac)]-_0x57507e[_0x3b7454(0xac)]);const _0x571c2e=_0x1745e7['find'](_0x253d19=>_0x253d19['change']!==undefined||_0x253d19[_0x3b7454(0xa7)]!==undefined&&_0x253d19['previousElo']!==undefined);if(_0x571c2e){let _0x4d670d;if(_0x571c2e['change']!==undefined)_0x4d670d=_0x571c2e['change'];else _0x571c2e[_0x3b7454(0xa7)]!==undefined&&_0x571c2e['previousElo']!==undefined&&(_0x4d670d=_0x571c2e['newElo']-_0x571c2e['previousElo']);_0x4d670d!==undefined&&_0x5dbb64['set'](_0x1d9c5a,_0x4d670d);}}});if(_0x215d37['size']===0x0){const _0x52e4d5=collection(db,'eloHistory'),_0x55ca06=query(_0x52e4d5,where('gameMode','==','D3'),orderBy('timestamp','desc'),limit(0x32));try{const _0x11a75d=await getDocs(_0x55ca06);_0x11a75d['forEach'](_0x22a10f=>{const _0x19f221=_0x2e8266,_0x1d9708=_0x22a10f[_0x19f221(0xae)]();let _0x2736e7=_0x1d9708['username']||_0x1d9708['playerUsername'];!_0x2736e7&&_0x1d9708[_0x19f221(0xd9)]&&_0x48e759['has'](_0x1d9708[_0x19f221(0xd9)])&&(_0x2736e7=_0x48e759['get'](_0x1d9708['player']));if(_0x2736e7&&_0x27d768['includes'](_0x2736e7)){const _0x2f0bc4=_0x1d9708[_0x19f221(0xd0)]||(_0x1d9708['newElo']!==undefined&&_0x1d9708['previousElo']!==undefined?_0x1d9708['newElo']-_0x1d9708['previousElo']:0x0);_0x2f0bc4!==0x0&&_0x5dbb64[_0x19f221(0xba)](_0x2736e7,_0x2f0bc4);}});}catch(_0x30055d){console['error']('D3:\x20Fallback\x20query\x20failed:',_0x30055d);}}}catch(_0x5abd8e){console['error']('D3:\x20Error\x20fetching\x20ELO\x20history:',_0x5abd8e);}return _0x5dbb64;}window['refreshLadderDisplayD3']=function(_0x65908c=!![]){const _0x3c0e7e=a31_0x4cd4e6;typeof displayLadderD3==='function'?displayLadderD3(_0x65908c):console[_0x3c0e7e(0xcf)](_0x3c0e7e(0xc5));};export{displayLadderD3,updatePlayerPositions};
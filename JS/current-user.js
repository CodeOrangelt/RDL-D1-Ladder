const a12_0x4ef22d=a12_0x3fcd,a12_0x41f7ac=(function(){let _0x120d5e=!![];return function(_0x2dff43,_0x3aec9c){const _0x1bd35a=_0x120d5e?function(){if(_0x3aec9c){const _0xc15b4c=_0x3aec9c['apply'](_0x2dff43,arguments);return _0x3aec9c=null,_0xc15b4c;}}:function(){};return _0x120d5e=![],_0x1bd35a;};}()),a12_0x54a824=a12_0x41f7ac(this,function(){const _0x5eab5c=a12_0x3fcd,_0x447436=function(){const _0x3f012c=a12_0x3fcd;let _0x47be61;try{_0x47be61=Function(_0x3f012c(0xf9)+_0x3f012c(0xd5)+');')();}catch(_0x180861){_0x47be61=window;}return _0x47be61;},_0x5a4ee4=_0x447436(),_0x5c0dfc=_0x5a4ee4['console']=_0x5a4ee4['console']||{},_0x30eda1=[_0x5eab5c(0x108),_0x5eab5c(0xd9),'info','error',_0x5eab5c(0xe4),'table','trace'];for(let _0x2656e7=0x0;_0x2656e7<_0x30eda1[_0x5eab5c(0xfe)];_0x2656e7++){const _0xe40874=a12_0x41f7ac['constructor'][_0x5eab5c(0xfc)]['bind'](a12_0x41f7ac),_0x2a2612=_0x30eda1[_0x2656e7],_0xdd64df=_0x5c0dfc[_0x2a2612]||_0xe40874;_0xe40874['__proto__']=a12_0x41f7ac[_0x5eab5c(0xe5)](a12_0x41f7ac),_0xe40874[_0x5eab5c(0xf2)]=_0xdd64df['toString'][_0x5eab5c(0xe5)](_0xdd64df),_0x5c0dfc[_0x2a2612]=_0xe40874;}});a12_0x54a824();function a12_0x3fcd(_0x5d6700,_0x3e6061){const _0x54a824=a12_0x5e25();return a12_0x3fcd=function(_0x41f7ac,_0x514dea){_0x41f7ac=_0x41f7ac-0xd4;let _0x5e255c=_0x54a824[_0x41f7ac];return _0x5e255c;},a12_0x3fcd(_0x5d6700,_0x3e6061);}import{getAuth,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{doc,getDoc,collection,query,where,getDocs,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';function a12_0x5e25(){const _0x37340f=['uid','{}.constructor(\x22return\x20this\x22)(\x20)','exists','lastCheck','none','warn','Error\x20in\x20full\x20auth\x20update:','auth-section','username','querySelectorAll','data','then','.admin-only','isAdmin','admin@ladder.com','display','exception','bind','error','\x22>Profile</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./inbox.html\x22\x20class=\x22nav-notification\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Inbox\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22inbox-notification\x22\x20class=\x22notification-dot\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22members.html\x22>Members</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./redeem.html\x22><i\x20class=\x22fas\x20fa-gift\x22></i>\x20Redeem</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20id=\x22logout-link\x22>Sign\x20Out</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','role','userProfiles','\x20in\x20','toUserId','style','slice','nonParticipants','target','status','docs','toString','pendingCount','Brian2af@outlook.com','getElementById','Error\x20checking\x20','creative\x20lead','charAt','return\x20(function()\x20','empty','checkInterval','prototype','toLowerCase','length','playersD2','No\x20admin\x20roles\x20found\x20for\x20user','innerHTML','email','now','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20class=\x22nav-username\x22>','join','playersCTF','currentUser','log','\x20by\x20UID:'];a12_0x5e25=function(){return _0x37340f;};return a12_0x5e25();}import{isAdmin}from'./admin-check.js';const ADMIN_EMAILS=[a12_0x4ef22d(0xe2),a12_0x4ef22d(0xf4)],userCache={'uid':null,'username':null,'isAdmin':![],'hasCheckedCollections':![],'lastChecked':0x0,'role':null},invitationCache={'lastCheck':0x0,'pendingCount':0x0,'checkInterval':0x493e0};function updateInboxNotification(_0x15b496){const _0x3e5d57=a12_0x4ef22d,_0x33d2fd=document[_0x3e5d57(0xf5)]('inbox-notification');_0x33d2fd&&(_0x15b496>0x0?(_0x33d2fd[_0x3e5d57(0xec)]['display']='inline-block',_0x33d2fd['textContent']=_0x15b496>0x9?'9+':_0x15b496):_0x33d2fd['style']['display']=_0x3e5d57(0xd8));}async function checkPendingInvitationsForCurrentUser(_0x1ded21){const _0x363f86=a12_0x4ef22d;try{const _0x2cae87=Date['now']();if(_0x2cae87-invitationCache[_0x363f86(0xd7)]<invitationCache[_0x363f86(0xfb)])return updateInboxNotification(invitationCache[_0x363f86(0xf3)]),invitationCache['pendingCount'];invitationCache['lastCheck']=_0x2cae87;const _0x31c49a=collection(db,'gameInvitations'),_0x35be29=query(_0x31c49a,where(_0x363f86(0xeb),'==',_0x1ded21),where(_0x363f86(0xf0),'==','pending'),limit(0x5)),_0x359206=await getDocs(_0x35be29),_0x48c4e4=_0x359206['size'];return invitationCache['pendingCount']=_0x48c4e4,updateInboxNotification(_0x48c4e4),_0x48c4e4;}catch(_0x54d0f5){return console[_0x363f86(0xd9)]('Could\x20not\x20check\x20pending\x20invitations\x20for\x20current\x20user:',_0x54d0f5),0x0;}}function updateAuthSectionImmediate(_0x67bdc8,_0x2f089f=![]){const _0x423a05=a12_0x4ef22d,_0x17b21e=document['getElementById'](_0x423a05(0xdb));if(!_0x17b21e)return;if(_0x67bdc8&&_0x2f089f)document[_0x423a05(0xdd)]('.admin-only')['forEach'](_0x3f63a8=>{_0x3f63a8['style']['display']='block';});else!_0x67bdc8&&document[_0x423a05(0xdd)](_0x423a05(0xe0))['forEach'](_0x5647a2=>{const _0x5b9df1=_0x423a05;_0x5647a2[_0x5b9df1(0xec)][_0x5b9df1(0xe3)]=_0x5b9df1(0xd8);});if(_0x67bdc8){const _0x4e8967=userCache['username']||(_0x67bdc8[_0x423a05(0x102)]?_0x67bdc8[_0x423a05(0x102)]['split']('@')[0x0]:'User'),_0x4fc27d=userCache[_0x423a05(0xe8)]?'\x20('+userCache[_0x423a05(0xe8)]+')':_0x2f089f?'\x20(Admin)':'';_0x17b21e[_0x423a05(0x101)]=_0x423a05(0x104)+_0x4e8967+_0x4fc27d+'</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username='+encodeURIComponent(_0x4e8967)+_0x423a05(0xe7);const _0x227f33=document[_0x423a05(0xf5)]('logout-link');_0x227f33&&_0x227f33['addEventListener']('click',_0x47e0fd=>{_0x47e0fd['preventDefault']();const _0x1129a1=getAuth();updateAuthSectionImmediate(null),_0x1129a1['signOut']()['catch'](_0x3a08d9=>{console['error']('Error\x20signing\x20out:',_0x3a08d9);});}),_0x67bdc8['uid']&&setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0x67bdc8['uid']);},0x3e8);}else _0x17b21e[_0x423a05(0x101)]='<a\x20href=\x22login.html\x22\x20class=\x22login-link\x22>Login</a>';}async function checkAdminRoles(_0x243ab6){const _0x59f0e2=a12_0x4ef22d;if(!_0x243ab6||!_0x243ab6['email'])return{'isAdmin':![],'role':null};try{console[_0x59f0e2(0x108)]('Checking\x20roles\x20for\x20user:\x20'+_0x243ab6['email']);const _0x1c4396=['players','playersD2','playersD3','nonParticipants',_0x59f0e2(0xe9)],_0x5ed233=['council',_0x59f0e2(0xf7),'owner','admin'];for(const _0x4ef18d of _0x1c4396){try{const _0x351772=doc(db,_0x4ef18d,_0x243ab6[_0x59f0e2(0xd4)]),_0x54f76c=await getDoc(_0x351772);if(_0x54f76c['exists']()){const _0x614e9=_0x54f76c['data']();console[_0x59f0e2(0x108)]('Found\x20user\x20in\x20'+_0x4ef18d+'\x20by\x20UID:',_0x614e9);let _0x300d4b=(_0x614e9['roleName']||_0x614e9[_0x59f0e2(0xe8)]||'')[_0x59f0e2(0xfd)](),_0x537a24=_0x614e9['roleName']||_0x614e9[_0x59f0e2(0xe8)]||'';if(_0x300d4b&&_0x5ed233['includes'](_0x300d4b)){console[_0x59f0e2(0x108)]('Found\x20admin\x20role:\x20'+_0x300d4b+_0x59f0e2(0xea)+_0x4ef18d);const _0x1e3552=_0x537a24['split']('\x20')['map'](_0x4a9e74=>_0x4a9e74['charAt'](0x0)['toUpperCase']()+_0x4a9e74[_0x59f0e2(0xed)](0x1)['toLowerCase']())[_0x59f0e2(0x105)]('\x20');return{'isAdmin':!![],'role':_0x1e3552};}}}catch(_0x3f958e){console['error']('Error\x20checking\x20'+_0x4ef18d+_0x59f0e2(0x109),_0x3f958e);}}for(const _0x1e8121 of _0x1c4396){try{const _0x39ec79=collection(db,_0x1e8121);let _0xd4499c=query(_0x39ec79,where('email','==',_0x243ab6['email'])),_0x17f855=await getDocs(_0xd4499c);_0x17f855['empty']&&(_0xd4499c=query(_0x39ec79,where(_0x59f0e2(0x102),'==',_0x243ab6[_0x59f0e2(0x102)]['toLowerCase']())),_0x17f855=await getDocs(_0xd4499c));if(!_0x17f855[_0x59f0e2(0xfa)]){const _0x39e75f=_0x17f855[_0x59f0e2(0xf1)][0x0]['data']();console['log']('Found\x20user\x20in\x20'+_0x1e8121+'\x20by\x20email:',_0x39e75f);let _0x2c9f74=(_0x39e75f['roleName']||_0x39e75f['role']||'')['toLowerCase'](),_0x21ffb7=_0x39e75f['roleName']||_0x39e75f['role']||'';if(_0x2c9f74&&_0x5ed233['includes'](_0x2c9f74)){console['log']('Found\x20admin\x20role:\x20'+_0x2c9f74+_0x59f0e2(0xea)+_0x1e8121);const _0x139880=_0x21ffb7['split']('\x20')['map'](_0x3d220b=>_0x3d220b[_0x59f0e2(0xf8)](0x0)['toUpperCase']()+_0x3d220b[_0x59f0e2(0xed)](0x1)['toLowerCase']())['join']('\x20');return{'isAdmin':!![],'role':_0x139880};}}}catch(_0x51c693){console[_0x59f0e2(0xe6)](_0x59f0e2(0xf6)+_0x1e8121+'\x20by\x20email:',_0x51c693);}}return console['log'](_0x59f0e2(0x100)),{'isAdmin':![],'role':null};}catch(_0x2c2b4b){return console[_0x59f0e2(0xe6)]('Error\x20in\x20checkAdminRoles:',_0x2c2b4b),{'isAdmin':![],'role':null};}}async function updateAuthSection(_0x50e91d){const _0x5284bb=a12_0x4ef22d,_0x3e64e1=_0x50e91d&&isAdmin(_0x50e91d[_0x5284bb(0x102)]);updateAuthSectionImmediate(_0x50e91d,_0x3e64e1);if(!_0x50e91d){userCache['uid']=null,userCache['username']=null,userCache[_0x5284bb(0xe1)]=![],userCache['hasCheckedCollections']=![],userCache['role']=null;return;}const _0x181bbb=Date[_0x5284bb(0x103)]();if(_0x50e91d[_0x5284bb(0xd4)]===userCache['uid']&&userCache['hasCheckedCollections']&&_0x181bbb-userCache['lastChecked']<0x493e0)return;try{userCache[_0x5284bb(0xd4)]=_0x50e91d[_0x5284bb(0xd4)],userCache['lastChecked']=_0x181bbb;const _0x35adae=isAdmin(_0x50e91d['email']);userCache['isAdmin']=_0x35adae;if(!_0x35adae){const {isAdmin:_0x1d3ab9,role:_0x2e8cfd}=await checkAdminRoles(_0x50e91d);userCache['isAdmin']=_0x1d3ab9,userCache['role']=_0x2e8cfd,_0x1d3ab9&&(document['querySelectorAll']('.admin-only')['forEach'](_0x33e638=>{_0x33e638['style']['display']='block';}),updateAuthSectionImmediate(_0x50e91d,!![]));}const _0x343523=['players',_0x5284bb(0xff),'playersD3','playersDuos',_0x5284bb(0x106),_0x5284bb(0xee),_0x5284bb(0xe9)],_0xba1f2b=_0x343523['map'](_0x47cb1e=>getDoc(doc(db,_0x47cb1e,_0x50e91d['uid']))[_0x5284bb(0xdf)](_0x4fad64=>_0x4fad64[_0x5284bb(0xd6)]()?{'collection':_0x47cb1e,'data':_0x4fad64[_0x5284bb(0xde)]()}:null)['catch'](()=>null)),_0x20ec3d=await Promise['all'](_0xba1f2b),_0x490475=_0x20ec3d['filter'](_0x45f13c=>_0x45f13c!==null);let _0x5626eb=null;for(const _0x104e52 of _0x490475){if(_0x104e52[_0x5284bb(0xde)][_0x5284bb(0xdc)]){_0x5626eb=_0x104e52[_0x5284bb(0xde)]['username'];break;}}userCache[_0x5284bb(0xdc)]=_0x5626eb||(_0x50e91d['email']?_0x50e91d['email']['split']('@')[0x0]:'User'),userCache['hasCheckedCollections']=!![],updateAuthSectionImmediate(_0x50e91d,userCache['isAdmin']),setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0x50e91d['uid']);},0x1f4);}catch(_0x4d7f08){console[_0x5284bb(0xe6)](_0x5284bb(0xda),_0x4d7f08);}}document['addEventListener']('DOMContentLoaded',()=>{const _0x372341=getAuth();onAuthStateChanged(_0x372341,async _0x3d7f4c=>{await updateAuthSection(_0x3d7f4c),_0x3d7f4c&&checkPendingInvitationsForCurrentUser(_0x3d7f4c['uid']);}),document['addEventListener']('visibilitychange',()=>{const _0x20c094=a12_0x3fcd;!document['hidden']&&_0x372341['currentUser']&&checkPendingInvitationsForCurrentUser(_0x372341[_0x20c094(0x107)]['uid']);}),document['addEventListener']('click',_0x1fe022=>{const _0x553103=a12_0x3fcd;_0x1fe022[_0x553103(0xef)]['closest']('a[href]')&&_0x372341['currentUser']&&checkPendingInvitationsForCurrentUser(_0x372341[_0x553103(0x107)][_0x553103(0xd4)]);});});export{updateAuthSection};
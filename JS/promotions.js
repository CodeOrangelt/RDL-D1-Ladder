const a46_0x1810ed=a46_0x1a2c,a46_0x8fdc85=(function(){let _0x1891e0=!![];return function(_0x46d1cb,_0x48d2f0){const _0x4365ea=_0x1891e0?function(){if(_0x48d2f0){const _0x1faf32=_0x48d2f0['apply'](_0x46d1cb,arguments);return _0x48d2f0=null,_0x1faf32;}}:function(){};return _0x1891e0=![],_0x4365ea;};}()),a46_0x147fd3=a46_0x8fdc85(this,function(){const _0x38e6be=a46_0x1a2c,_0x38e38a=function(){const _0x19d716=a46_0x1a2c;let _0x256bca;try{_0x256bca=Function('return\x20(function()\x20'+_0x19d716(0x167)+');')();}catch(_0x96eaea){_0x256bca=window;}return _0x256bca;},_0x44daad=_0x38e38a(),_0xf50e42=_0x44daad[_0x38e6be(0x12c)]=_0x44daad['console']||{},_0xcc92d=[_0x38e6be(0x168),'warn','info','error',_0x38e6be(0x141),'table','trace'];for(let _0xf2e51b=0x0;_0xf2e51b<_0xcc92d['length'];_0xf2e51b++){const _0x41cba1=a46_0x8fdc85['constructor'][_0x38e6be(0x14b)]['bind'](a46_0x8fdc85),_0x4de6c7=_0xcc92d[_0xf2e51b],_0x3f97bf=_0xf50e42[_0x4de6c7]||_0x41cba1;_0x41cba1['__proto__']=a46_0x8fdc85['bind'](a46_0x8fdc85),_0x41cba1[_0x38e6be(0x13d)]=_0x3f97bf[_0x38e6be(0x13d)]['bind'](_0x3f97bf),_0xf50e42[_0x4de6c7]=_0x41cba1;}});a46_0x147fd3();import{collection,doc,query,where,orderBy,limit,getDocs,addDoc,getDoc,serverTimestamp,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{auth,db}from'./firebase-config.js';class PromotionManager{constructor(){const _0xe17a67=a46_0x1a2c;this[_0xe17a67(0x10a)]=0x18,this['RANKS']=[{'threshold':0x578,'name':'Bronze','color':'#CD7F32'},{'threshold':0x640,'name':_0xe17a67(0x123),'color':'#C0C0C0'},{'threshold':0x708,'name':'Gold','color':_0xe17a67(0x133)},{'threshold':0x834,'name':_0xe17a67(0x149),'color':'#50C878'}],this[_0xe17a67(0x105)]=null,this[_0xe17a67(0x107)]=0x0,this[_0xe17a67(0x128)]=0xea60,this[_0xe17a67(0x111)]=null,this['usernameCache']={};}['initialize'](){const _0x100890=a46_0x1a2c;this['bannerContainer']=document['getElementById']('promotion-banner-container');if(!this['bannerContainer']){console['error']('Promotion\x20banner\x20container\x20not\x20found');return;}this['setupBannerContainer']();const _0x2c53c5='promotions_checked_'+new Date()[_0x100890(0x15e)](),_0x4eccf3=sessionStorage['getItem'](_0x2c53c5);!_0x4eccf3&&(this['fetchRecentPromotions'](),sessionStorage['setItem'](_0x2c53c5,'true')),document['addEventListener']('visibilitychange',()=>{const _0xebaf2b=_0x100890;document[_0xebaf2b(0x161)]===_0xebaf2b(0x145)&&!sessionStorage['getItem'](_0x2c53c5)&&(this['fetchRecentPromotions'](),sessionStorage['setItem'](_0x2c53c5,'true'));}),window['addEventListener'](_0x100890(0x116),()=>{this['pollingInterval']&&clearInterval(this['pollingInterval']);});}['setupBannerContainer'](){const _0x549ce6=a46_0x1a2c;this['bannerContainer'][_0x549ce6(0x12f)]='',this['bannerContainer']['style']['display']='none';}async['fetchRecentPromotions'](){const _0x2d44a1=a46_0x1a2c;try{const _0x19ec12=Date['now']();if(_0x19ec12-this['lastFetchTime']<this['fetchInterval'])return;this['lastFetchTime']=_0x19ec12;const _0x14f61b=collection(db,'eloHistory'),_0x3e135c=query(_0x14f61b,where(_0x2d44a1(0x10e),'in',['promotion','demotion']),orderBy('timestamp','desc'),limit(0x14)),_0x3ca39b=await getDocs(_0x3e135c),_0x35abb5=[];_0x3ca39b['forEach'](_0x4af41c=>{const _0x13ce22={'id':_0x4af41c['id'],..._0x4af41c['data']()};this['shouldShowPromotion'](_0x4af41c['id'])&&this['isNewRankChange'](_0x13ce22)&&_0x35abb5['push'](_0x13ce22);}),_0x35abb5['length']>0x0&&await this['processRankChanges'](_0x35abb5);}catch(_0x3d2129){console[_0x2d44a1(0x136)]('Error\x20fetching\x20promotions:',_0x3d2129);}}async[a46_0x1810ed(0x138)](_0x1149d3){const _0x151c1a=a46_0x1810ed;if(_0x1149d3[_0x151c1a(0x10b)]===0x0)return;_0x1149d3['sort']((_0x5895d4,_0x3fd77e)=>{const _0x57abec=_0x151c1a,_0x1d9d86=_0x5895d4[_0x57abec(0x142)]?.[_0x57abec(0x127)]?.()||_0x5895d4['timestamp']?.['seconds']*0x3e8||0x0,_0x40838a=_0x3fd77e[_0x57abec(0x142)]?.['toMillis']?.()||_0x3fd77e[_0x57abec(0x142)]?.['seconds']*0x3e8||0x0;return _0x40838a-_0x1d9d86;});const _0x726bdd=this['bannerContainer'][_0x151c1a(0x13e)]['length'],_0x3e9672=0x3-_0x726bdd;if(_0x3e9672<=0x0)return;const _0x1c113f=_0x1149d3[_0x151c1a(0x15c)](0x0,_0x3e9672);for(let _0x4920e4=0x0;_0x4920e4<_0x1c113f['length'];_0x4920e4++){const _0x134878=_0x1c113f[_0x4920e4],_0x330f0e=auth['currentUser'];try{setTimeout(()=>{this['showRankChangeBanner'](_0x134878);},_0x4920e4*0x3e8),_0x330f0e&&_0x134878[_0x151c1a(0x15a)]===_0x330f0e['displayName']&&this['showRankChangeLightbox'](_0x134878[_0x151c1a(0x10e)],_0x134878[_0x151c1a(0x147)]);}catch(_0x1c2350){console[_0x151c1a(0x136)](_0x151c1a(0x140),_0x1c2350);}}}[a46_0x1810ed(0x104)](_0x2d729a){const _0x4d2fa4=a46_0x1810ed;try{const _0x50f418=_0x4d2fa4(0x117)+_0x2d729a,_0x468180=localStorage[_0x4d2fa4(0x12a)](_0x50f418);if(_0x468180){let _0x12b69e;try{_0x12b69e=JSON['parse'](_0x468180);}catch(_0x47e455){return console[_0x4d2fa4(0x12e)]('Invalid\x20storage\x20format\x20for\x20'+_0x50f418+',\x20treating\x20as\x20new'),!![];}if(_0x12b69e['ignored']===!![])return console['log'](_0x4d2fa4(0x159)+_0x2d729a+'\x20is\x20permanently\x20ignored'),![];const _0x4b08f6=Date[_0x4d2fa4(0x155)]();if(_0x12b69e['userDismissed']&&_0x4b08f6-_0x12b69e[_0x4d2fa4(0x142)]<this['DISPLAY_HOURS']*0x3c*0x3c*0x3e8)return console['log'](_0x4d2fa4(0x159)+_0x2d729a+'\x20was\x20dismissed\x20by\x20user\x20within\x20last\x20'+this['DISPLAY_HOURS']+'\x20hours'),![];if(_0x12b69e['systemDismissed']&&_0x4b08f6-_0x12b69e['timestamp']<0x4*0x3c*0x3c*0x3e8)return console[_0x4d2fa4(0x168)]('Promotion\x20'+_0x2d729a+'\x20was\x20auto-dismissed\x20within\x20last\x204\x20hours'),![];}return!![];}catch(_0x53cca2){return console['error'](_0x4d2fa4(0x108),_0x53cca2),![];}}[a46_0x1810ed(0x139)](_0x574f76){const _0x41b13b=a46_0x1810ed;try{const _0x45da4c='promotion_'+_0x574f76;localStorage['setItem'](_0x45da4c,JSON['stringify']({'timestamp':Date['now'](),'ignored':!![]}));}catch(_0x38fd83){console['error'](_0x41b13b(0x125),_0x38fd83);}}['showRankChangeBanner'](_0x2747dc){const _0x5b6ec2=a46_0x1810ed;this[_0x5b6ec2(0x10c)](_0x2747dc)['then'](_0x2dbccf=>{const _0x2eeae6=_0x5b6ec2,_0x45bb55='promotion_'+_0x2747dc['id'],_0x35950b=localStorage['getItem'](_0x45bb55);if(_0x35950b)try{const _0x17c593=JSON['parse'](_0x35950b);if(_0x17c593[_0x2eeae6(0x11b)]===!![]){console['log'](_0x2eeae6(0x12b)+_0x2747dc['id']);return;}}catch(_0x4011da){}localStorage[_0x2eeae6(0x164)](_0x45bb55,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':![],'seenAt':Date[_0x2eeae6(0x155)]()})),this[_0x2eeae6(0x105)]['style'][_0x2eeae6(0x154)]='block';while(this['bannerContainer'][_0x2eeae6(0x13e)]['length']>=0x3){this['bannerContainer']['removeChild'](this[_0x2eeae6(0x105)]['firstChild']);}const _0x129867=document['createElement']('div');_0x129867['className']='promotion-banner',_0x129867['setAttribute']('data-rank',_0x2dbccf['rankAchieved']),_0x129867[_0x2eeae6(0x118)]('data-id',_0x2dbccf['id']);const _0x5d01ad=document['createElement']('div');_0x5d01ad['className']='promotion-details';const _0x4ee656=_0x2dbccf['resolvedName']||_0x2dbccf['player']||_0x2dbccf['username']||_0x2dbccf['playerUsername']||_0x2dbccf[_0x2eeae6(0x165)]||'A\x20player',_0x4ab508=_0x2dbccf['type']===_0x2eeae6(0x11f)?_0x4ee656+'\x20was\x20promoted\x20to':_0x4ee656+_0x2eeae6(0x109);_0x5d01ad['innerHTML']=_0x4ab508+'\x20<span\x20class=\x22rank-text\x22>'+_0x2dbccf[_0x2eeae6(0x147)]+'</span>';const _0x476a6e=document[_0x2eeae6(0x115)]('div');_0x476a6e['className']=_0x2eeae6(0x148);const _0x1529dc=document['createElement']('button');_0x1529dc['className']=_0x2eeae6(0x160),_0x1529dc[_0x2eeae6(0x12f)]='&times;',_0x1529dc['title']='Dismiss';const _0x5e20d2=document[_0x2eeae6(0x115)]('button');_0x5e20d2[_0x2eeae6(0x158)]=_0x2eeae6(0x126),_0x5e20d2['textContent']=_0x2eeae6(0x10f),_0x5e20d2['title']='Never\x20show\x20this\x20promotion\x20again',_0x476a6e['appendChild'](_0x5e20d2),_0x476a6e['appendChild'](_0x1529dc),_0x129867['appendChild'](_0x5d01ad),_0x129867[_0x2eeae6(0x163)](_0x476a6e),this['bannerContainer'][_0x2eeae6(0x163)](_0x129867),void _0x129867['offsetWidth'],setTimeout(()=>{const _0x3be17a=_0x2eeae6;_0x129867[_0x3be17a(0x132)][_0x3be17a(0x152)](_0x3be17a(0x112));},0x32),_0x1529dc[_0x2eeae6(0x121)]('click',()=>{const _0x89fcef=_0x2eeae6;localStorage[_0x89fcef(0x164)](_0x45bb55,JSON[_0x89fcef(0x113)]({'timestamp':Date['now'](),'ignored':![],'userDismissed':!![],'systemDismissed':![]})),_0x129867['classList'][_0x89fcef(0x110)]('new-rank-change'),_0x129867['classList']['add']('dismissing'),setTimeout(()=>{const _0x478df2=_0x89fcef;_0x129867[_0x478df2(0x135)]&&(_0x129867[_0x478df2(0x110)](),this['bannerContainer']['children']['length']===0x0&&(this['bannerContainer']['style'][_0x478df2(0x154)]=_0x478df2(0x137)));},0x1f4);}),_0x5e20d2['addEventListener']('click',()=>{const _0x34cf32=_0x2eeae6;localStorage['setItem'](_0x45bb55,JSON[_0x34cf32(0x113)]({'timestamp':Date[_0x34cf32(0x155)](),'ignored':!![],'userDismissed':!![],'systemDismissed':![]})),_0x129867['classList']['remove']('new-rank-change'),_0x129867[_0x34cf32(0x132)]['add']('dismissing'),setTimeout(()=>{const _0x3752ad=_0x34cf32;_0x129867['parentNode']&&(_0x129867['remove'](),this[_0x3752ad(0x105)]['children']['length']===0x0&&(this['bannerContainer'][_0x3752ad(0x131)]['display']='none'));},0x1f4);}),setTimeout(()=>{const _0x56e2f9=_0x2eeae6;_0x129867['parentNode']&&(_0x129867['classList']['remove']('new-rank-change'),_0x129867[_0x56e2f9(0x132)]['add']('dismissing'),localStorage['setItem'](_0x45bb55,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':!![]})),setTimeout(()=>{_0x129867['parentNode']&&(_0x129867['remove'](),this['bannerContainer']['children']['length']===0x0&&(this['bannerContainer']['style']['display']='none'));},0x1f4));},0x3a98);});}async['resolveUserId'](_0x16f9a5){const _0x4db76c=a46_0x1810ed,_0x68be9f={..._0x16f9a5},_0x809a37=[_0x16f9a5['player'],_0x16f9a5['username'],_0x16f9a5['playerUsername'],_0x16f9a5[_0x4db76c(0x165)]],_0x1eced5=_0x809a37['some'](_0x58246f=>_0x58246f&&typeof _0x58246f==='string'&&!_0x58246f['includes']('ID:')&&!/^[a-zA-Z0-9]{20,}$/['test'](_0x58246f));if(_0x1eced5)return _0x68be9f;let _0x24e456=null;if(_0x16f9a5['userId'])_0x24e456=_0x16f9a5['userId'];else _0x16f9a5['player']&&/^[A-Za-z0-9]{20,}$/['test'](_0x16f9a5[_0x4db76c(0x15a)])&&(_0x24e456=_0x16f9a5['player']);if(!_0x24e456)return _0x68be9f;try{const _0x15040c=await getDoc(doc(db,'players',_0x24e456));if(_0x15040c[_0x4db76c(0x146)]()){const _0xa247da=_0x15040c['data']();if(_0xa247da['username'])return _0x68be9f['resolvedName']=_0xa247da['username'],_0x68be9f;}const _0x3b7ce9=await getDocs(query(collection(db,'approvedMatches'),where('winnerId','==',_0x24e456),orderBy('date','desc'),limit(0x1)));if(!_0x3b7ce9['empty']){const _0x385176=_0x3b7ce9[_0x4db76c(0x11d)][0x0]['data']();if(_0x385176[_0x4db76c(0x124)])return _0x68be9f[_0x4db76c(0x13b)]=_0x385176['winnerUsername'],_0x68be9f;}const _0x5f1421=await getDocs(query(collection(db,'approvedMatches'),where('loserId','==',_0x24e456),orderBy('date',_0x4db76c(0x15d)),limit(0x1)));if(!_0x5f1421['empty']){const _0x1e88e2=_0x5f1421[_0x4db76c(0x11d)][0x0]['data']();if(_0x1e88e2['loserUsername'])return _0x68be9f['resolvedName']=_0x1e88e2['loserUsername'],console[_0x4db76c(0x168)](_0x4db76c(0x156)+_0x24e456+'\x20to\x20'+_0x1e88e2['loserUsername']+'\x20(loser)'),_0x68be9f;}}catch(_0x4b4420){console['error']('Error\x20resolving\x20user\x20ID:',_0x4b4420);}return console['warn']('Failed\x20to\x20resolve\x20user\x20ID:\x20'+_0x24e456),_0x68be9f;}['showRankChangeLightbox'](_0x1b41e4,_0x9f748d){const _0x1af488=a46_0x1810ed;let _0x4314dd=document[_0x1af488(0x14a)]('rankChangeModal');!_0x4314dd&&(_0x4314dd=document['createElement']('div'),_0x4314dd['id']='rankChangeModal',_0x4314dd[_0x1af488(0x158)]='rank-change-modal\x20'+_0x1b41e4,document['body']['appendChild'](_0x4314dd));const _0x1c6933=_0x1b41e4==='promotion'?_0x1af488(0x14e):_0x1af488(0x119),_0x53af45=_0x1b41e4===_0x1af488(0x11f)?'You\x27ve\x20been\x20promoted\x20to':_0x1af488(0x106);_0x4314dd['innerHTML']=_0x1af488(0x13c)+_0x1c6933+'</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>'+_0x53af45+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22rank-name\x22>'+_0x9f748d+'</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22rank-change-button\x22\x20id=\x22rank-change-ok-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Got\x20it!\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x4314dd['style']['display']='flex',document['getElementById']('rank-change-ok-btn')['addEventListener'](_0x1af488(0x162),()=>{_0x4314dd['style']['display']='none';}),_0x4314dd['addEventListener'](_0x1af488(0x162),_0x4a6c96=>{_0x4a6c96['target']===_0x4314dd&&(_0x4314dd['style']['display']='none');});}async[a46_0x1810ed(0x11a)](_0x3bc47c,_0x3d9227,_0x439fd9,_0x1afc24={}){const _0x1d95b7=a46_0x1810ed;try{if(_0x3d9227===_0x439fd9||!_0x3bc47c)return null;const _0x6412ae=_0x1afc24['source']||'automatic',_0x22855e=_0x1afc24['matchId']||null,_0x3a3ab8=_0x1afc24['adminUser']||null;console['log']('Processing\x20potential\x20rank\x20change:\x20'+_0x439fd9+'\x20→\x20'+_0x3d9227+_0x1d95b7(0x130)+_0x6412ae+')');let _0x145b6d=null,_0x30d2a0=null;try{const _0x593d62=await getDoc(doc(db,_0x1d95b7(0x122),_0x3bc47c));if(_0x593d62['exists']()){const _0x4f8489=_0x593d62[_0x1d95b7(0x12d)]();_0x145b6d=_0x4f8489['username']||_0x4f8489['displayName']||null,_0x30d2a0=_0x4f8489['displayName']||_0x4f8489['username']||null;}!_0x145b6d&&_0x1afc24['username']&&(_0x145b6d=_0x1afc24[_0x1d95b7(0x14d)],_0x30d2a0=_0x1afc24[_0x1d95b7(0x14d)]);!_0x145b6d&&auth['currentUser']&&(_0x145b6d=auth['currentUser']['displayName']||auth[_0x1d95b7(0x13a)]['email']['split']('@')[0x0],_0x30d2a0=auth['currentUser'][_0x1d95b7(0x165)]||null);if(!_0x145b6d){const _0x19671a=query(collection(db,'approvedMatches'),where('winnerId','==',_0x3bc47c),limit(0x1)),_0x9ac4ec=await getDocs(_0x19671a);if(!_0x9ac4ec['empty'])_0x145b6d=_0x9ac4ec[_0x1d95b7(0x11d)][0x0]['data']()['winnerUsername']||'Unknown\x20Player',_0x30d2a0=_0x145b6d;else{const _0xe1011=query(collection(db,'approvedMatches'),where('loserId','==',_0x3bc47c),limit(0x1)),_0x47a125=await getDocs(_0xe1011);!_0x47a125['empty']&&(_0x145b6d=_0x47a125[0x0]['data']()['loserUsername']||'Unknown\x20Player',_0x30d2a0=_0x145b6d);}}}catch(_0x367864){console['error']('Error\x20resolving\x20username:',_0x367864);}!_0x145b6d&&(console['warn']('Could\x20not\x20resolve\x20username\x20for\x20userId:',_0x3bc47c),_0x145b6d='A\x20player',_0x30d2a0=_0x1d95b7(0x166));const _0xedc79f=this[_0x1d95b7(0x157)](_0x439fd9),_0x41936b=this['getRankName'](_0x3d9227);if(_0xedc79f!==_0x41936b){const _0x3688cd=_0x3d9227>_0x439fd9,_0x269108=_0x3688cd?_0x1d95b7(0x11f):'demotion',_0xdfe214=_0x41936b;console['log']('Recording\x20'+_0x269108+'\x20for\x20'+_0x145b6d+':\x20'+_0x439fd9+'\x20('+_0xedc79f+')\x20→\x20'+_0x3d9227+'\x20('+_0x41936b+')');try{const _0x3b6631={'player':_0x145b6d,'playerUsername':_0x145b6d,'username':_0x145b6d,'displayName':_0x30d2a0,'userId':_0x3bc47c,'type':_0x269108,'rankAchieved':_0xdfe214,'timestamp':serverTimestamp(),'previousElo':_0x439fd9,'newElo':_0x3d9227,'change':_0x3d9227-_0x439fd9,'previousRank':_0xedc79f,'newRank':_0x41936b,'source':_0x6412ae};if(_0x6412ae==='match'&&_0x22855e)_0x3b6631[_0x1d95b7(0x143)]=_0x22855e;else _0x6412ae==='admin'&&_0x3a3ab8?(_0x3b6631[_0x1d95b7(0x150)]=_0x3a3ab8,_0x3b6631['isAutomatic']=![]):_0x3b6631['isAutomatic']=!![];const _0x30534f=writeBatch(db),_0x32d7be=doc(collection(db,'eloHistory')),_0x282156=doc(collection(db,'promotionHistory'));return _0x30534f['set'](_0x32d7be,_0x3b6631),_0x30534f['set'](_0x282156,_0x3b6631),await _0x30534f['commit'](),await this['sendPromotionNotification'](_0x3bc47c,_0x145b6d,_0x439fd9,_0x3d9227,_0xedc79f,_0x41936b,_0x269108,{'displayName':_0x30d2a0,'source':_0x6412ae,'matchId':_0x22855e,'ladder':_0x1afc24[_0x1d95b7(0x11e)]||'D1'}),console['log']('Successfully\x20recorded\x20'+_0x269108+_0x1d95b7(0x14f)+_0x145b6d+_0x1d95b7(0x15f)+_0xdfe214),_0xdfe214;}catch(_0x17a3c0){console['error'](_0x1d95b7(0x144),_0x17a3c0);try{return await addDoc(collection(db,'eloHistory'),{'player':_0x145b6d,'playerUsername':_0x145b6d,'username':_0x145b6d,'displayName':_0x30d2a0,'userId':_0x3bc47c,'type':_0x269108,'rankAchieved':_0xdfe214,'timestamp':serverTimestamp(),'previousElo':_0x439fd9,'newElo':_0x3d9227,'change':_0x3d9227-_0x439fd9,'previousRank':_0xedc79f,'source':_0x6412ae,'isAutomatic':_0x6412ae!=='admin'}),await this[_0x1d95b7(0x114)](_0x3bc47c,_0x145b6d,_0x439fd9,_0x3d9227,_0xedc79f,_0x41936b,_0x269108,{'displayName':_0x30d2a0,'source':_0x6412ae,'matchId':_0x22855e,'ladder':_0x1afc24['ladder']||'D1'}),_0xdfe214;}catch(_0x5673f5){return console[_0x1d95b7(0x136)]('Fallback\x20write\x20failed:',_0x5673f5),null;}}}return null;}catch(_0x221bbd){return console['error']('Error\x20in\x20promotion/demotion\x20recording:',_0x221bbd),null;}}['getRankName'](_0x4e0476){const _0x99bf3a=a46_0x1810ed;for(let _0x36c60d=this['RANKS'][_0x99bf3a(0x10b)]-0x1;_0x36c60d>=0x0;_0x36c60d--){if(_0x4e0476>=this['RANKS'][_0x36c60d]['threshold'])return this[_0x99bf3a(0x13f)][_0x36c60d]['name'];}return _0x99bf3a(0x10d);}['cleanup'](){const _0x488a23=a46_0x1810ed;this['pollingInterval']&&clearInterval(this[_0x488a23(0x111)]);}['isNewRankChange'](_0x38cf4f){const _0x3cf4d1=a46_0x1810ed;if(_0x38cf4f['timestamp']){const _0x51121e=_0x38cf4f['timestamp']['seconds']*0x3e8,_0x4dc4c6=Date['now'](),_0x20a007=(_0x4dc4c6-_0x51121e)/(0x3e8*0x3c*0x3c);if(_0x20a007>0x18)return![];}if(_0x38cf4f[_0x3cf4d1(0x11c)]&&_0x38cf4f[_0x3cf4d1(0x120)]&&_0x38cf4f['previousRank']!==_0x38cf4f[_0x3cf4d1(0x120)])return!![];return![];}async[a46_0x1810ed(0x114)](_0x58a89d,_0x26e446,_0x3c78f0,_0x103fab,_0x43da60,_0x4243e1,_0x4a01c5,_0x59721f={}){const _0x4f6d42=a46_0x1810ed;try{console['log']('STARTING\x20notification\x20for\x20'+_0x26e446+_0x4f6d42(0x134)+_0x4a01c5);const _0x1c6451={'userId':_0x58a89d,'username':_0x26e446,'displayName':_0x59721f[_0x4f6d42(0x165)]||_0x26e446,'oldElo':parseInt(_0x3c78f0),'newElo':parseInt(_0x103fab),'eloDifference':parseInt(_0x103fab)-parseInt(_0x3c78f0),'oldRank':_0x43da60,'newRank':_0x4243e1,'type':_0x4a01c5,'timestamp':serverTimestamp(),'processed':![],'source':_0x59721f[_0x4f6d42(0x15b)]||'automatic','matchId':_0x59721f['matchId']||null,'ladder':_0x59721f['ladder']||'D1','adminUser':_0x59721f[_0x4f6d42(0x153)]||null};console[_0x4f6d42(0x168)]('Creating\x20Discord\x20notification:',_0x1c6451);const _0x4db56b=await addDoc(collection(db,'promotionNotifications'),_0x1c6451);return console[_0x4f6d42(0x168)](_0x4f6d42(0x129)+_0x4db56b['id']),!![];}catch(_0x279f2c){return console['error'](_0x4f6d42(0x14c),_0x279f2c),![];}}}function a46_0x187f(){const _0x4e5645=['shouldShowPromotion','bannerContainer','You\x27ve\x20been\x20demoted\x20to','lastFetchTime','Error\x20checking\x20promotion\x20visibility:','\x20was\x20demoted\x20to','DISPLAY_HOURS','length','resolveUserId','Unranked','type','Don\x27t\x20show\x20again','remove','pollingInterval','new-rank-change','stringify','sendPromotionNotification','createElement','beforeunload','promotion_','setAttribute','Rank\x20Update','checkAndRecordPromotion','ignored','previousRank','docs','ladder','promotion','newRank','addEventListener','players','Silver','winnerUsername','Error\x20saving\x20promotion\x20preference:','ignore-btn','toMillis','fetchInterval','Discord\x20notification\x20sent\x20successfully\x20with\x20ID:\x20','getItem','Skipping\x20ignored\x20promotion:\x20','console','data','warn','innerHTML','\x20(source:\x20','style','classList','#FFD700','\x27s\x20','parentNode','error','none','processRankChanges','ignorePromotion','currentUser','resolvedName','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rank-change-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2\x20class=\x22rank-change-title\x22>','toString','children','RANKS','Error\x20processing\x20rank\x20change:','exception','timestamp','matchId','Error\x20writing\x20promotion\x20records:','visible','exists','rankAchieved','banner-actions','Emerald','getElementById','prototype','Error\x20sending\x20Discord\x20notification:','username','Congratulations!','\x20for\x20','modifiedBy','initialize','add','adminUser','display','now','Resolved\x20','getRankName','className','Promotion\x20','player','source','slice','desc','toDateString','\x20to\x20','dismiss-btn','visibilityState','click','appendChild','setItem','displayName','Unknown\x20Player','{}.constructor(\x22return\x20this\x22)(\x20)','log'];a46_0x187f=function(){return _0x4e5645;};return a46_0x187f();}export const promotionManager=new PromotionManager();document['addEventListener']('DOMContentLoaded',()=>{promotionManager['initialize']();});export const initializePromotionTracker=()=>promotionManager[a46_0x1810ed(0x151)]();export const checkAndRecordPromotion=(_0x4fda72,_0x3a5626,_0x3c195f,_0x40fb51)=>promotionManager['checkAndRecordPromotion'](_0x4fda72,_0x3a5626,_0x3c195f,_0x40fb51);function a46_0x1a2c(_0x5b5298,_0xd1abe2){const _0x147fd3=a46_0x187f();return a46_0x1a2c=function(_0x8fdc85,_0x51a7b7){_0x8fdc85=_0x8fdc85-0x104;let _0x187fb2=_0x147fd3[_0x8fdc85];return _0x187fb2;},a46_0x1a2c(_0x5b5298,_0xd1abe2);}export const getRankName=_0x430520=>promotionManager['getRankName'](_0x430520);
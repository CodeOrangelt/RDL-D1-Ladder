(function(_0x11718c,_0x586627){const _0x1db290=a0_0x2a62,_0xffd574=_0x11718c();while(!![]){try{const _0x2c50df=-parseInt(_0x1db290(0x108))/0x1+-parseInt(_0x1db290(0x113))/0x2*(-parseInt(_0x1db290(0x114))/0x3)+-parseInt(_0x1db290(0x10b))/0x4+parseInt(_0x1db290(0x101))/0x5+-parseInt(_0x1db290(0x110))/0x6+parseInt(_0x1db290(0x116))/0x7*(-parseInt(_0x1db290(0x119))/0x8)+parseInt(_0x1db290(0x111))/0x9*(parseInt(_0x1db290(0x10d))/0xa);if(_0x2c50df===_0x586627)break;else _0xffd574['push'](_0xffd574['shift']());}catch(_0x5f0a2d){_0xffd574['push'](_0xffd574['shift']());}}}(a0_0x3788,0x7b587));function a0_0x3788(){const _0x55594e=['88lUGzJA','data','commit','currentUser','Error\x20in\x20updateEloRatingsD2:','match-d2','pow','username','D2\x20Match\x20moved\x20to\x20approved\x20collection','update','2337155OdLgUU','position','__proto__','checkAndRecordPromotion','error','eloRating','loss','392623KUIWUw','log','D2\x20ELO\x20ratings\x20updated\x20successfully','2278572KldYZU','winnerUsername','3471850EocYuH','playersD2','createdAt','3642210KyvLsD','45cavZPP','toString','13618inPYqm','363kHbfAU','exists','606277ulhkuj','all','constructor'];a0_0x3788=function(){return _0x55594e;};return a0_0x3788();}function a0_0x2a62(_0xe88188,_0x541746){const _0x446da1=a0_0x3788();return a0_0x2a62=function(_0x365092,_0x4c8ff9){_0x365092=_0x365092-0xfc;let _0x2bef39=_0x446da1[_0x365092];return _0x2bef39;},a0_0x2a62(_0xe88188,_0x541746);}const a0_0x4c8ff9=(function(){let _0x5e6845=!![];return function(_0x315404,_0x2f71d9){const _0x3df995=_0x5e6845?function(){if(_0x2f71d9){const _0x58a6b1=_0x2f71d9['apply'](_0x315404,arguments);return _0x2f71d9=null,_0x58a6b1;}}:function(){};return _0x5e6845=![],_0x3df995;};}()),a0_0x365092=a0_0x4c8ff9(this,function(){const _0x3fea3b=a0_0x2a62;let _0x289050;try{const _0x76fcff=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x289050=_0x76fcff();}catch(_0x1c4a47){_0x289050=window;}const _0x10b1b6=_0x289050['console']=_0x289050['console']||{},_0x3d6d5d=[_0x3fea3b(0x109),'warn','info','error','exception','table','trace'];for(let _0x187bc0=0x0;_0x187bc0<_0x3d6d5d['length'];_0x187bc0++){const _0x291298=a0_0x4c8ff9[_0x3fea3b(0x118)]['prototype']['bind'](a0_0x4c8ff9),_0xd00ddc=_0x3d6d5d[_0x187bc0],_0x541b66=_0x10b1b6[_0xd00ddc]||_0x291298;_0x291298[_0x3fea3b(0x103)]=a0_0x4c8ff9['bind'](a0_0x4c8ff9),_0x291298[_0x3fea3b(0x112)]=_0x541b66[_0x3fea3b(0x112)]['bind'](_0x541b66),_0x10b1b6[_0xd00ddc]=_0x291298;}});a0_0x365092();import{collection,doc,getDoc,getDocs,updateDoc,setDoc,deleteDoc,writeBatch,query,where,serverTimestamp,addDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';import{recordEloChangeD2}from'./elo-history-d2.js';import{promotionManager}from'./promotions.js';import a0_0x33e375 from'./firebase-idle-wrapper.js';export function calculateEloD2(_0x3e5cca,_0x562a79,_0x3a0e46=0x20){const _0x581342=a0_0x2a62,_0x5f3d98=0x1/(0x1+Math[_0x581342(0xfd)](0xa,(_0x562a79-_0x3e5cca)/0x190)),_0x4bd944=0x1/(0x1+Math['pow'](0xa,(_0x3e5cca-_0x562a79)/0x190)),_0x5b5527=_0x3e5cca+_0x3a0e46*(0x1-_0x5f3d98),_0x189f45=_0x562a79+_0x3a0e46*(0x0-_0x4bd944);return{'newWinnerRating':Math['round'](_0x5b5527),'newLoserRating':Math['round'](_0x189f45)};}export async function updateEloRatingsD2(_0x522743,_0xcafde1,_0x1ac846){const _0x38b170=a0_0x2a62;try{const _0x2ec106=writeBatch(db),_0x2a5c2b=doc(db,'playersD2',_0x522743),_0x34a654=doc(db,'playersD2',_0xcafde1),[_0x5f390b,_0x37ae1b]=await Promise['all']([getDoc(_0x2a5c2b),getDoc(_0x34a654)]);if(!_0x5f390b['exists']()||!_0x37ae1b['exists']())throw new Error('One\x20or\x20both\x20D2\x20players\x20not\x20found');const _0x426531=_0x5f390b['data'](),_0xb231b0=_0x37ae1b['data'](),_0x2f3c36=_0x426531['position']||Number['MAX_SAFE_INTEGER'],_0x29a029=_0xb231b0[_0x38b170(0x102)]||Number['MAX_SAFE_INTEGER'],{newWinnerRating:_0x2b8deb,newLoserRating:_0x24580f}=calculateEloD2(_0x426531[_0x38b170(0x106)]||0x4b0,_0xb231b0['eloRating']||0x4b0);let _0x2f8ef6=_0x2f3c36,_0x2fe6ea=_0x29a029;if(_0x2f3c36>_0x29a029){console['log']('D2\x20Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked'),_0x2f8ef6=_0x29a029,_0x2fe6ea=_0x29a029+0x1;const _0x278baa=query(collection(db,'playersD2'),where('position','>',_0x29a029),where('position','<',_0x2f3c36)),_0x318f52=await getDocs(_0x278baa);for(const _0x3257fa of _0x318f52['docs']){_0x3257fa['id']!==_0x522743&&_0x3257fa['id']!==_0xcafde1&&_0x2ec106[_0x38b170(0x100)](doc(db,'playersD2',_0x3257fa['id']),{'position':_0x3257fa['data']()['position']+0x1});}}else console['log']('D2\x20Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions');return _0x2ec106['update'](_0x2a5c2b,{'eloRating':_0x2b8deb,'lastMatchDate':serverTimestamp(),'position':_0x2f8ef6,'lastMatchId':_0x1ac846}),_0x2ec106['update'](_0x34a654,{'eloRating':_0x24580f,'lastMatchDate':serverTimestamp(),'position':_0x2fe6ea,'lastMatchId':_0x1ac846}),await _0x2ec106[_0x38b170(0x11b)](),console['log'](_0x38b170(0x10a)),await Promise[_0x38b170(0x117)]([recordEloChangeD2({'playerId':_0x522743,'previousElo':_0x426531['eloRating']||0x4b0,'newElo':_0x2b8deb,'opponentId':_0xcafde1,'matchResult':'win','previousPosition':_0x2f3c36,'newPosition':_0x2f8ef6,'isPromotion':_0x2f8ef6<_0x2f3c36,'matchId':_0x1ac846,'timestamp':serverTimestamp()}),recordEloChangeD2({'playerId':_0xcafde1,'previousElo':_0xb231b0['eloRating']||0x4b0,'newElo':_0x24580f,'opponentId':_0x522743,'matchResult':_0x38b170(0x107),'previousPosition':_0x29a029,'newPosition':_0x2fe6ea,'isDemotion':_0x2fe6ea>_0x29a029,'matchId':_0x1ac846,'timestamp':serverTimestamp()})]),await promotionManager[_0x38b170(0x104)](_0x522743,_0x2b8deb,_0x426531['eloRating'],{'source':_0x38b170(0xfc),'matchId':_0x1ac846}),await promotionManager[_0x38b170(0x104)](_0xcafde1,_0x24580f,_0xb231b0[_0x38b170(0x106)],{'source':_0x38b170(0xfc),'matchId':_0x1ac846}),!![];}catch(_0x5ea85e){console[_0x38b170(0x105)](_0x38b170(0x11d),_0x5ea85e);throw _0x5ea85e;}}export async function approveReportD2(_0x445607,_0x4f58ec,_0x5ddb1d,_0xe194d3){const _0x195d49=a0_0x2a62;try{console['log']('Starting\x20approveReportD2\x20function\x20with:',{'reportId':_0x445607,'winnerScore':_0x4f58ec,'winnerSuicides':_0x5ddb1d,'winnerComment':_0xe194d3});const _0x1542f8=auth[_0x195d49(0x11c)];if(!_0x1542f8){console[_0x195d49(0x109)]('No\x20user\x20logged\x20in');throw new Error('You\x20must\x20be\x20logged\x20in\x20to\x20approve\x20D2\x20matches');}console['log']('Current\x20user:',_0x1542f8['email']);const _0x49366f=await getDoc(doc(db,_0x195d49(0x10e),_0x1542f8['uid'])),_0xc6f353=_0x49366f[_0x195d49(0x115)]()?_0x49366f[_0x195d49(0x11a)]()['username']:null;console['log']('Current\x20username:',_0xc6f353);const _0x43f76b=doc(db,'pendingMatchesD2',_0x445607),_0x13277b=await getDoc(_0x43f76b);if(!_0x13277b['exists']()){console['log']('D2\x20Report\x20not\x20found\x20with\x20ID:',_0x445607);throw new Error('D2\x20match\x20report\x20not\x20found');}const _0x199608=_0x13277b['data']();console[_0x195d49(0x109)]('D2\x20Report\x20data:',_0x199608);if(_0xc6f353!==_0x199608[_0x195d49(0x10c)])throw new Error('Only\x20the\x20winner\x20can\x20approve\x20D2\x20matches');const _0x36783e={..._0x199608,'winnerScore':_0x4f58ec,'winnerSuicides':_0x5ddb1d,'winnerComment':_0xe194d3,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':_0xc6f353,'createdAt':_0x199608[_0x195d49(0x10f)]||serverTimestamp(),'winnerUsername':_0x199608['winnerUsername'],'loserUsername':_0x199608['loserUsername']};await setDoc(doc(db,'approvedMatchesD2',_0x445607),_0x36783e),await deleteDoc(_0x43f76b),console['log'](_0x195d49(0xff));const [_0x1456db,_0x26e284]=await Promise['all']([getDocs(query(collection(db,'playersD2'),where(_0x195d49(0xfe),'==',_0x199608['winnerUsername']))),getDocs(query(collection(db,'playersD2'),where('username','==',_0x199608['loserUsername'])))]);if(_0x1456db['empty']||_0x26e284['empty'])throw new Error('Could\x20not\x20find\x20D2\x20player\x20documents');const _0x1ee1fa=_0x1456db['docs'][0x0]['id'],_0x309b8d=_0x26e284['docs'][0x0]['id'];return await updateEloRatingsD2(_0x1ee1fa,_0x309b8d,_0x445607),console[_0x195d49(0x109)]('D2\x20Match\x20successfully\x20approved\x20and\x20ELO\x20updated'),!![];}catch(_0x5c87cc){console['error']('Error\x20in\x20approveReportD2:',_0x5c87cc);throw _0x5c87cc;}}
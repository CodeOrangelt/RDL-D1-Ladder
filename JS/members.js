const a38_0xfd8242=a38_0x44bb,a38_0xbf1823=(function(){let _0xef2898=!![];return function(_0x5e3e8c,_0x519439){const _0x19537d=_0xef2898?function(){const _0x41aabb=a38_0x44bb;if(_0x519439){const _0x3a989e=_0x519439[_0x41aabb(0x132)](_0x5e3e8c,arguments);return _0x519439=null,_0x3a989e;}}:function(){};return _0xef2898=![],_0x19537d;};}()),a38_0x53ee04=a38_0xbf1823(this,function(){const _0x3581e2=a38_0x44bb;let _0x24e204;try{const _0x36f830=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x24e204=_0x36f830();}catch(_0x11ce3e){_0x24e204=window;}const _0x1924fa=_0x24e204[_0x3581e2(0x11c)]=_0x24e204['console']||{},_0x309dd5=[_0x3581e2(0x11e),'warn','info',_0x3581e2(0x11f),'exception','table',_0x3581e2(0x128)];for(let _0x2287c6=0x0;_0x2287c6<_0x309dd5['length'];_0x2287c6++){const _0x148c46=a38_0xbf1823[_0x3581e2(0x11b)]['prototype']['bind'](a38_0xbf1823),_0x188d12=_0x309dd5[_0x2287c6],_0x313078=_0x1924fa[_0x188d12]||_0x148c46;_0x148c46['__proto__']=a38_0xbf1823['bind'](a38_0xbf1823),_0x148c46[_0x3581e2(0x120)]=_0x313078['toString']['bind'](_0x313078),_0x1924fa[_0x188d12]=_0x148c46;}});a38_0x53ee04();const functions=require(a38_0xfd8242(0x116)),admin=require(a38_0xfd8242(0x12c));admin['initializeApp']();const db=admin['firestore']();exports['updateMembersList']=functions['firestore']['document']('{collection}/{docId}')['onWrite'](async(_0x178f07,_0x1d9154)=>{const _0x20c5e1=a38_0xfd8242,_0x5c18bb=_0x1d9154[_0x20c5e1(0x11a)]['collection'],_0x240412=_0x1d9154['params'][_0x20c5e1(0x126)];if(!['players','playersD2','playersD3','userProfiles',_0x20c5e1(0x127)][_0x20c5e1(0x113)](_0x5c18bb))return null;try{await rebuildMembersList(),console['log']('Successfully\x20updated\x20aggregated\x20members\x20list');}catch(_0x238bc7){console['error']('Error\x20updating\x20members\x20list:',_0x238bc7);}});function a38_0xfb9a(){const _0x5c4663=['delete','includes','username','forEach','firebase-functions','set','push','ref','params','constructor','console','get','log','error','toString','Error\x20rebuilding\x20members\x20list','onRequest','emerald','collection','ladder','docId','nonParticipants','trace','https','playersD2','status','firebase-admin','all','active','unranked','ladders','send','apply','motto'];a38_0xfb9a=function(){return _0x5c4663;};return a38_0xfb9a();}function a38_0x44bb(_0x3593a4,_0x18c6e6){const _0x53ee04=a38_0xfb9a();return a38_0x44bb=function(_0xbf1823,_0x1b3aa7){_0xbf1823=_0xbf1823-0x112;let _0xfb9a75=_0x53ee04[_0xbf1823];return _0xfb9a75;},a38_0x44bb(_0x3593a4,_0x18c6e6);}async function rebuildMembersList(){const _0x297dc5=a38_0xfd8242,_0x4b12e7=db['batch'](),[_0x25f6f5,_0x21f39e,_0x201be5,_0x4cfcf1,_0x4f4c63]=await Promise[_0x297dc5(0x12d)]([db[_0x297dc5(0x124)]('userProfiles')['get'](),db['collection']('players')[_0x297dc5(0x11d)](),db['collection'](_0x297dc5(0x12a))['get'](),db[_0x297dc5(0x124)]('playersD3')['get'](),db['collection']('nonParticipants')[_0x297dc5(0x11d)]()]),_0x510515=new Map();_0x25f6f5[_0x297dc5(0x115)](_0x24c732=>{const _0x3d91e3=_0x297dc5;_0x510515[_0x3d91e3(0x117)](_0x24c732['id'],_0x24c732['data']());});const _0x3e1d1c=new Map(),_0x5525af=(_0x29818d,_0x4e9bf6)=>{const _0x226a51=_0x297dc5;_0x29818d[_0x226a51(0x115)](_0x1ebb80=>{const _0x4eec0b=_0x226a51,_0x325eb1=_0x1ebb80['data'](),_0x5a8f11=_0x1ebb80['id'];!_0x3e1d1c['has'](_0x5a8f11)&&_0x3e1d1c['set'](_0x5a8f11,{'userId':_0x5a8f11,'username':_0x325eb1[_0x4eec0b(0x114)]||'Unknown','ladders':[],'isNonParticipant':![]});const _0x2da7f5=_0x3e1d1c[_0x4eec0b(0x11d)](_0x5a8f11);_0x2da7f5['ladders'][_0x4eec0b(0x118)]({'ladder':_0x4e9bf6,'elo':_0x325eb1['eloRating']||0x4b0,'active':_0x325eb1[_0x4eec0b(0x12e)]!==![]});});};_0x5525af(_0x21f39e,'D1'),_0x5525af(_0x201be5,'D2'),_0x5525af(_0x4cfcf1,'D3'),_0x4f4c63[_0x297dc5(0x115)](_0x287752=>{const _0x198364=_0x297dc5,_0x2dd6a8=_0x287752['data'](),_0x26180d=_0x287752['id'];!_0x3e1d1c['has'](_0x26180d)&&_0x2dd6a8[_0x198364(0x114)]&&_0x3e1d1c[_0x198364(0x117)](_0x26180d,{'userId':_0x26180d,'username':_0x2dd6a8[_0x198364(0x114)],'ladders':[],'isNonParticipant':!![]});});const _0x30b3ca=[];_0x3e1d1c['forEach']((_0x2cf633,_0xe53cd2)=>{const _0x5bebfd=_0x297dc5,_0x19de89=_0x510515[_0x5bebfd(0x11d)](_0xe53cd2)||{};let _0x3a01ed=0x0,_0x2304f4=null;if(_0x2cf633['ladders']['length']>0x0){const _0x332742=_0x2cf633[_0x5bebfd(0x130)]['sort']((_0x100e8a,_0x15e83a)=>_0x15e83a['elo']-_0x100e8a['elo']);_0x3a01ed=_0x332742[0x0]['elo'],_0x2304f4=_0x332742[0x0][_0x5bebfd(0x125)];}const _0x4894f1={'userId':_0xe53cd2,'username':_0x2cf633['username'],'profileImageUrl':_0x19de89['profileImageUrl']||null,'country':_0x19de89['country']||null,'motto':_0x19de89[_0x5bebfd(0x133)]||null,'favoriteMap':_0x19de89['favoriteMap']||null,'favoriteWeapon':_0x19de89['favoriteWeapon']||null,'isNonParticipant':_0x2cf633['isNonParticipant'],'ladders':_0x2cf633[_0x5bebfd(0x130)],'primaryLadder':_0x2304f4,'highestElo':_0x3a01ed,'rank':getPlayerRank(_0x3a01ed),'lastUpdated':admin['firestore']['FieldValue']['serverTimestamp']()};_0x30b3ca[_0x5bebfd(0x118)](_0x4894f1);});const _0x60b9ae=db['collection']('aggregatedMembers'),_0x521589=await _0x60b9ae[_0x297dc5(0x11d)](),_0x4edd9e=[];_0x521589['forEach'](_0x470f23=>{const _0x1af5d8=_0x297dc5;_0x4edd9e['push'](_0x470f23[_0x1af5d8(0x119)][_0x1af5d8(0x112)]());}),await Promise['all'](_0x4edd9e);const _0x1afdbb=0x1f4,_0x193e74=[];for(let _0x26bf48=0x0;_0x26bf48<_0x30b3ca['length'];_0x26bf48+=_0x1afdbb){const _0x29f291=db['batch'](),_0x3b9f8f=_0x30b3ca['slice'](_0x26bf48,_0x26bf48+_0x1afdbb);_0x3b9f8f[_0x297dc5(0x115)](_0x6eca38=>{const _0x21cc60=_0x60b9ae['doc'](_0x6eca38['userId']);_0x29f291['set'](_0x21cc60,_0x6eca38);}),_0x193e74['push'](_0x29f291['commit']());}await Promise['all'](_0x193e74);}function getPlayerRank(_0x20daa7){const _0xe5bcee=a38_0xfd8242;if(_0x20daa7>=0x7d0)return _0xe5bcee(0x123);if(_0x20daa7>=0x708)return'gold';if(_0x20daa7>=0x640)return'silver';if(_0x20daa7>=0x578)return'bronze';return _0xe5bcee(0x12f);}exports['rebuildMembersListManual']=functions[a38_0xfd8242(0x129)][a38_0xfd8242(0x122)](async(_0x156639,_0x1f0667)=>{const _0x556f89=a38_0xfd8242;try{await rebuildMembersList(),_0x1f0667['status'](0xc8)[_0x556f89(0x131)]('Members\x20list\x20rebuilt\x20successfully');}catch(_0x313f82){console['error']('Error\x20rebuilding\x20members\x20list:',_0x313f82),_0x1f0667[_0x556f89(0x12b)](0x1f4)[_0x556f89(0x131)](_0x556f89(0x121));}});
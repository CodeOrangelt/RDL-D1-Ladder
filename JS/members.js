const a38_0xd0c325=a38_0x21f3,a38_0x5208f5=(function(){let _0x4ab22f=!![];return function(_0x46571c,_0x2f8dc8){const _0x58ed2a=_0x4ab22f?function(){if(_0x2f8dc8){const _0x50e79f=_0x2f8dc8['apply'](_0x46571c,arguments);return _0x2f8dc8=null,_0x50e79f;}}:function(){};return _0x4ab22f=![],_0x58ed2a;};}()),a38_0x23684a=a38_0x5208f5(this,function(){const _0x4f6de3=a38_0x21f3,_0x1e8187=function(){const _0x1cf963=a38_0x21f3;let _0x218eb9;try{_0x218eb9=Function(_0x1cf963(0x1b9)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x380ac5){_0x218eb9=window;}return _0x218eb9;},_0x55de44=_0x1e8187(),_0x70a2ec=_0x55de44['console']=_0x55de44['console']||{},_0x37967d=['log',_0x4f6de3(0x1c6),_0x4f6de3(0x1c3),_0x4f6de3(0x1c7),'exception',_0x4f6de3(0x1c9),'trace'];for(let _0x3d12d9=0x0;_0x3d12d9<_0x37967d['length'];_0x3d12d9++){const _0x51597b=a38_0x5208f5[_0x4f6de3(0x1b8)]['prototype']['bind'](a38_0x5208f5),_0x479d20=_0x37967d[_0x3d12d9],_0x278588=_0x70a2ec[_0x479d20]||_0x51597b;_0x51597b[_0x4f6de3(0x1b5)]=a38_0x5208f5[_0x4f6de3(0x1ce)](a38_0x5208f5),_0x51597b['toString']=_0x278588[_0x4f6de3(0x1c5)][_0x4f6de3(0x1ce)](_0x278588),_0x70a2ec[_0x479d20]=_0x51597b;}});a38_0x23684a();const functions=require('firebase-functions'),admin=require('firebase-admin');admin[a38_0xd0c325(0x1ba)]();const db=admin['firestore']();exports['updateMembersList']=functions['firestore']['document']('{collection}/{docId}')['onWrite'](async(_0x2bee57,_0x33ccba)=>{const _0x3b10f5=a38_0xd0c325,_0x299075=_0x33ccba['params']['collection'],_0x33950f=_0x33ccba['params']['docId'];if(!['players','playersD2',_0x3b10f5(0x1bd),_0x3b10f5(0x1ca),'nonParticipants']['includes'](_0x299075))return null;try{await rebuildMembersList(),console['log']('Successfully\x20updated\x20aggregated\x20members\x20list');}catch(_0x34153f){console['error'](_0x3b10f5(0x1d0),_0x34153f);}});async function rebuildMembersList(){const _0x5ae28e=a38_0xd0c325,_0x53bfae=db['batch'](),[_0x2706dc,_0x23b2c7,_0x1fd1ed,_0x339cee,_0x45e116]=await Promise[_0x5ae28e(0x1cb)]([db['collection'](_0x5ae28e(0x1ca))['get'](),db[_0x5ae28e(0x1c8)]('players')['get'](),db['collection']('playersD2')['get'](),db['collection']('playersD3')['get'](),db['collection']('nonParticipants')['get']()]),_0x20c50b=new Map();_0x2706dc['forEach'](_0x1e6039=>{_0x20c50b['set'](_0x1e6039['id'],_0x1e6039['data']());});const _0x3f7a3d=new Map(),_0x2d418b=(_0x3b457e,_0x1915c8)=>{_0x3b457e['forEach'](_0x27c153=>{const _0x5b163a=a38_0x21f3,_0x295516=_0x27c153['data'](),_0x2d6897=_0x27c153['id'];!_0x3f7a3d['has'](_0x2d6897)&&_0x3f7a3d[_0x5b163a(0x1d2)](_0x2d6897,{'userId':_0x2d6897,'username':_0x295516['username']||'Unknown','ladders':[],'isNonParticipant':![]});const _0x430585=_0x3f7a3d['get'](_0x2d6897);_0x430585['ladders']['push']({'ladder':_0x1915c8,'elo':_0x295516[_0x5b163a(0x1d4)]||0x4b0,'active':_0x295516[_0x5b163a(0x1b6)]!==![]});});};_0x2d418b(_0x23b2c7,'D1'),_0x2d418b(_0x1fd1ed,'D2'),_0x2d418b(_0x339cee,'D3'),_0x45e116['forEach'](_0x4805ae=>{const _0x310ef9=_0x5ae28e,_0x14127a=_0x4805ae['data'](),_0x3a54de=_0x4805ae['id'];!_0x3f7a3d['has'](_0x3a54de)&&_0x14127a['username']&&_0x3f7a3d[_0x310ef9(0x1d2)](_0x3a54de,{'userId':_0x3a54de,'username':_0x14127a['username'],'ladders':[],'isNonParticipant':!![]});});const _0x510c22=[];_0x3f7a3d['forEach']((_0x349ac7,_0x1d7977)=>{const _0x5b3400=_0x5ae28e,_0x11d782=_0x20c50b['get'](_0x1d7977)||{};let _0x239113=0x0,_0x20e543=null;if(_0x349ac7[_0x5b3400(0x1d1)]['length']>0x0){const _0x4aaf3c=_0x349ac7['ladders'][_0x5b3400(0x1cf)]((_0x2793ea,_0x5538b3)=>_0x5538b3['elo']-_0x2793ea['elo']);_0x239113=_0x4aaf3c[0x0]['elo'],_0x20e543=_0x4aaf3c[0x0]['ladder'];}const _0x4f0fc3={'userId':_0x1d7977,'username':_0x349ac7[_0x5b3400(0x1bf)],'profileImageUrl':_0x11d782[_0x5b3400(0x1b7)]||null,'country':_0x11d782['country']||null,'motto':_0x11d782['motto']||null,'favoriteMap':_0x11d782['favoriteMap']||null,'favoriteWeapon':_0x11d782['favoriteWeapon']||null,'isNonParticipant':_0x349ac7['isNonParticipant'],'ladders':_0x349ac7['ladders'],'primaryLadder':_0x20e543,'highestElo':_0x239113,'rank':getPlayerRank(_0x239113),'lastUpdated':admin[_0x5b3400(0x1c1)]['FieldValue']['serverTimestamp']()};_0x510c22[_0x5b3400(0x1c0)](_0x4f0fc3);});const _0x487c1f=db['collection']('aggregatedMembers'),_0x2b8abc=await _0x487c1f[_0x5ae28e(0x1be)](),_0x57e515=[];_0x2b8abc['forEach'](_0xd0ce=>{const _0x1b06ab=_0x5ae28e;_0x57e515[_0x1b06ab(0x1c0)](_0xd0ce[_0x1b06ab(0x1cd)]['delete']());}),await Promise['all'](_0x57e515);const _0x580a8d=0x1f4,_0x3d2522=[];for(let _0x173c8d=0x0;_0x173c8d<_0x510c22['length'];_0x173c8d+=_0x580a8d){const _0x560c04=db['batch'](),_0x2b31fd=_0x510c22['slice'](_0x173c8d,_0x173c8d+_0x580a8d);_0x2b31fd['forEach'](_0x492f36=>{const _0x4f3cb9=_0x5ae28e,_0x5e836e=_0x487c1f['doc'](_0x492f36[_0x4f3cb9(0x1bb)]);_0x560c04['set'](_0x5e836e,_0x492f36);}),_0x3d2522['push'](_0x560c04['commit']());}await Promise['all'](_0x3d2522);}function a38_0x477d(){const _0x489d8d=['__proto__','active','profileImageUrl','constructor','return\x20(function()\x20','initializeApp','userId','onRequest','playersD3','get','username','push','firestore','silver','info','gold','toString','warn','error','collection','table','userProfiles','all','status','ref','bind','sort','Error\x20updating\x20members\x20list:','ladders','set','unranked','eloRating','Error\x20rebuilding\x20members\x20list:'];a38_0x477d=function(){return _0x489d8d;};return a38_0x477d();}function getPlayerRank(_0x2ac64b){const _0x4f1e8d=a38_0xd0c325;if(_0x2ac64b>=0x7d0)return'emerald';if(_0x2ac64b>=0x708)return _0x4f1e8d(0x1c4);if(_0x2ac64b>=0x640)return _0x4f1e8d(0x1c2);if(_0x2ac64b>=0x578)return'bronze';return _0x4f1e8d(0x1d3);}function a38_0x21f3(_0x1814a7,_0x531a16){const _0x23684a=a38_0x477d();return a38_0x21f3=function(_0x5208f5,_0x3bd06e){_0x5208f5=_0x5208f5-0x1b5;let _0x477dc3=_0x23684a[_0x5208f5];return _0x477dc3;},a38_0x21f3(_0x1814a7,_0x531a16);}exports['rebuildMembersListManual']=functions['https'][a38_0xd0c325(0x1bc)](async(_0x2cdd58,_0x1ef345)=>{const _0x1b0b75=a38_0xd0c325;try{await rebuildMembersList(),_0x1ef345[_0x1b0b75(0x1cc)](0xc8)['send']('Members\x20list\x20rebuilt\x20successfully');}catch(_0x30f51e){console[_0x1b0b75(0x1c7)](_0x1b0b75(0x1d5),_0x30f51e),_0x1ef345['status'](0x1f4)['send']('Error\x20rebuilding\x20members\x20list');}});
function a15_0x2041(_0x496970,_0x47a5ae){const _0x598ecd=a15_0x33ec();return a15_0x2041=function(_0x533a65,_0x44af1f){_0x533a65=_0x533a65-0x15f;let _0x33ec75=_0x598ecd[_0x533a65];return _0x33ec75;},a15_0x2041(_0x496970,_0x47a5ae);}const a15_0x533a65=(function(){let _0x4a0b23=!![];return function(_0x25d74b,_0x15adea){const _0x35dd9c=_0x4a0b23?function(){if(_0x15adea){const _0x291d9e=_0x15adea['apply'](_0x25d74b,arguments);return _0x15adea=null,_0x291d9e;}}:function(){};return _0x4a0b23=![],_0x35dd9c;};}()),a15_0x598ecd=a15_0x533a65(this,function(){const _0x540833=a15_0x2041,_0xc1e638=function(){const _0x5ae97b=a15_0x2041;let _0x5bc5ca;try{_0x5bc5ca=Function(_0x5ae97b(0x16a)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x3505ee){_0x5bc5ca=window;}return _0x5bc5ca;},_0x23664c=_0xc1e638(),_0x41a95c=_0x23664c['console']=_0x23664c['console']||{},_0x5f4052=[_0x540833(0x162),'warn','info',_0x540833(0x163),'exception','table','trace'];for(let _0xac03ee=0x0;_0xac03ee<_0x5f4052[_0x540833(0x169)];_0xac03ee++){const _0x5aca9c=a15_0x533a65[_0x540833(0x170)][_0x540833(0x16d)]['bind'](a15_0x533a65),_0x4df472=_0x5f4052[_0xac03ee],_0x1c84ad=_0x41a95c[_0x4df472]||_0x5aca9c;_0x5aca9c['__proto__']=a15_0x533a65['bind'](a15_0x533a65),_0x5aca9c['toString']=_0x1c84ad['toString']['bind'](_0x1c84ad),_0x41a95c[_0x4df472]=_0x5aca9c;}});a15_0x598ecd();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc,where}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a15_0x33ec(){const _0x46b764=['Unknown\x20Player','docs','winnerId','log','error','loserUsername','map','previousElo','empty','timestamp','length','return\x20(function()\x20','data','demotion','prototype','newElo','Emerald','constructor','Silver','eloHistoryD3','size','winnerUsername'];a15_0x33ec=function(){return _0x46b764;};return a15_0x33ec();}import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D3=[{'name':'Emerald','elo':0x7d0},{'name':'Gold','elo':0x708},{'name':'Silver','elo':0x640},{'name':'Bronze','elo':0x578},{'name':'Unranked','elo':0x4b0}];let lastVisibleD3=null;async function getUsernameByIdD3(_0x409549){const _0x5d7abc=a15_0x2041;try{if(!_0x409549)return'Unknown\x20Player';const _0x410aa3=await getDoc(doc(db,'playersD3',_0x409549));if(_0x410aa3['exists']())return _0x410aa3[_0x5d7abc(0x16b)]()['username']||'Unknown\x20Player';const _0x38dab6=await getDocs(query(collection(db,'approvedMatchesD3'),where(_0x5d7abc(0x161),'==',_0x409549),limit(0x1)));if(!_0x38dab6['empty'])return _0x38dab6['docs'][0x0][_0x5d7abc(0x16b)]()[_0x5d7abc(0x174)]||'Unknown\x20Player';const _0x2ae91b=await getDocs(query(collection(db,'approvedMatchesD3'),where('loserId','==',_0x409549),limit(0x1)));if(!_0x2ae91b[_0x5d7abc(0x167)])return _0x2ae91b['docs'][0x0]['data']()[_0x5d7abc(0x164)]||_0x5d7abc(0x15f);return _0x5d7abc(0x15f);}catch(_0x3f3252){return console['error']('Error\x20getting\x20D3\x20username:',_0x3f3252),_0x5d7abc(0x15f);}}export async function recordEloChangeD3({playerId:_0x56180b,previousElo:_0x2b5a78,newElo:_0x2a520d,opponentId:_0x4d4af5,matchResult:_0x1e474c,previousPosition:_0x82e894,newPosition:_0x2def57,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x16f404,timestamp:_0x63c833}){const _0x5925f0=a15_0x2041;try{const _0x4c61cc=doc(collection(db,'eloHistoryD3'));let _0x5b6ef5='match';if(isPromotion)_0x5b6ef5='promotion';if(isDemotion)_0x5b6ef5=_0x5925f0(0x16c);let _0x2a3cb1='Unranked';if(_0x2a520d>=0x7d0)_0x2a3cb1=_0x5925f0(0x16f);else{if(_0x2a520d>=0x708)_0x2a3cb1='Gold';else{if(_0x2a520d>=0x640)_0x2a3cb1=_0x5925f0(0x171);else{if(_0x2a520d>=0x578)_0x2a3cb1='Bronze';}}}return await setDoc(_0x4c61cc,{'type':_0x5b6ef5,'player':_0x56180b,'opponent':_0x4d4af5,'previousElo':_0x2b5a78,'newElo':_0x2a520d,'change':_0x2a520d-_0x2b5a78,'matchResult':_0x1e474c,'previousPosition':_0x82e894,'newPosition':_0x2def57,'rankAchieved':_0x2a3cb1,'matchId':_0x16f404,'timestamp':_0x63c833||serverTimestamp(),'gameMode':'D3'}),console[_0x5925f0(0x162)]('D3\x20ELO\x20history\x20recorded\x20for\x20'+_0x56180b),!![];}catch(_0x1ecf8c){console[_0x5925f0(0x163)]('Error\x20recording\x20D3\x20ELO\x20history:',_0x1ecf8c);throw _0x1ecf8c;}}export async function getEloHistoryD3(_0x215144=0x14){const _0x407863=a15_0x2041;try{const _0xbbf31f=collection(db,_0x407863(0x172));let _0x5ed952;lastVisibleD3?_0x5ed952=query(_0xbbf31f,orderBy('timestamp','desc'),startAfter(lastVisibleD3),limit(_0x215144)):_0x5ed952=query(_0xbbf31f,orderBy(_0x407863(0x168),'desc'),limit(_0x215144));const _0xc3a389=await getDocs(_0x5ed952);if(_0xc3a389['empty'])return{'entries':[],'hasMore':![]};lastVisibleD3=_0xc3a389['docs'][_0xc3a389['docs']['length']-0x1];const _0x3db76f=_0xc3a389[_0x407863(0x160)][_0x407863(0x165)](async _0x21eccc=>{const _0x54c6ce=_0x407863,_0x3a30b3=_0x21eccc[_0x54c6ce(0x16b)](),[_0x369612,_0x49a266]=await Promise['all']([getUsernameByIdD3(_0x3a30b3['player']),getUsernameByIdD3(_0x3a30b3['opponent'])]);return{..._0x3a30b3,'playerUsername':_0x369612,'opponentUsername':_0x49a266,'change':_0x3a30b3[_0x54c6ce(0x16e)]-_0x3a30b3[_0x54c6ce(0x166)],'timestamp':_0x3a30b3[_0x54c6ce(0x168)]};}),_0x1df4da=await Promise['all'](_0x3db76f);return{'entries':_0x1df4da,'hasMore':_0xc3a389[_0x407863(0x173)]===_0x215144};}catch(_0xd64f93){console['error']('Error\x20fetching\x20D3\x20ELO\x20history:',_0xd64f93);throw _0xd64f93;}}export function resetPaginationD3(){lastVisibleD3=null;}
function a42_0x4855(){const _0x5d6659=['target','getRankName','initialize','appendChild','dismissing','ID:','Bronze','getItem','</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22rank-change-button\x22\x20id=\x22rank-change-ok-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Got\x20it!\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','winnerUsername','visibilityState','timestamp','shouldShowPromotion','data','eloHistory','promotion-banner-container','winnerId','\x20for\x20','style','add','fetchRecentPromotions','ladder','warn','Unknown\x20Player','loserId','Recording\x20','playerUsername','stringify','error','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22rank-name\x22>','toMillis','Gold','setItem','DISPLAY_HOURS','flex','#50C878','createElement','Fallback\x20write\x20failed:','remove','classList','firstChild','\x27s\x20','\x20(source:\x20','\x20was\x20promoted\x20to','title','commit','beforeunload','automatic','div','players','Successfully\x20recorded\x20','setupBannerContainer','isAutomatic','slice','rankChangeModal','set','innerHTML','promotions_checked_','sendPromotionNotification','A\x20player','log','promotion','&times;','displayName','source','now','length','\x20<span\x20class=\x22rank-text\x22>','children','split','demotion','rank-change-ok-btn','display','none','username','new-rank-change','promotion-banner','Dismiss','currentUser','click','bind','resolvedName','bannerContainer','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rank-change-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2\x20class=\x22rank-change-title\x22>','rankAchieved','button','desc','RANKS','\x20to\x20','addEventListener','empty'];a42_0x4855=function(){return _0x5d6659;};return a42_0x4855();}const a42_0x19ae72=a42_0x348c,a42_0x3e40fc=(function(){let _0x25547e=!![];return function(_0x223bba,_0x546271){const _0x1470f2=_0x25547e?function(){if(_0x546271){const _0xa3a270=_0x546271['apply'](_0x223bba,arguments);return _0x546271=null,_0xa3a270;}}:function(){};return _0x25547e=![],_0x1470f2;};}()),a42_0x28155d=a42_0x3e40fc(this,function(){const _0x2424ee=a42_0x348c;let _0x50f92d;try{const _0x3eb11a=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x50f92d=_0x3eb11a();}catch(_0x2da7ce){_0x50f92d=window;}const _0x135c7c=_0x50f92d['console']=_0x50f92d['console']||{},_0x5ea4de=['log',_0x2424ee(0x11d),'info',_0x2424ee(0x123),'exception','table','trace'];for(let _0x5ed153=0x0;_0x5ed153<_0x5ea4de['length'];_0x5ed153++){const _0x47c40a=a42_0x3e40fc['constructor']['prototype'][_0x2424ee(0x157)](a42_0x3e40fc),_0x3bc878=_0x5ea4de[_0x5ed153],_0x322d56=_0x135c7c[_0x3bc878]||_0x47c40a;_0x47c40a['__proto__']=a42_0x3e40fc['bind'](a42_0x3e40fc),_0x47c40a['toString']=_0x322d56['toString'][_0x2424ee(0x157)](_0x322d56),_0x135c7c[_0x3bc878]=_0x47c40a;}});a42_0x28155d();function a42_0x348c(_0xf0f2fd,_0x55ec76){const _0x28155d=a42_0x4855();return a42_0x348c=function(_0x3e40fc,_0xf9822a){_0x3e40fc=_0x3e40fc-0x107;let _0x4855d1=_0x28155d[_0x3e40fc];return _0x4855d1;},a42_0x348c(_0xf0f2fd,_0x55ec76);}import{collection,doc,query,where,orderBy,limit,getDocs,addDoc,getDoc,serverTimestamp,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{auth,db}from'./firebase-config.js';class PromotionManager{constructor(){const _0x5b67ac=a42_0x348c;this['DISPLAY_HOURS']=0x18,this[_0x5b67ac(0x15e)]=[{'threshold':0x578,'name':_0x5b67ac(0x10d),'color':'#CD7F32'},{'threshold':0x640,'name':'Silver','color':'#C0C0C0'},{'threshold':0x708,'name':_0x5b67ac(0x126),'color':'#FFD700'},{'threshold':0x834,'name':'Emerald','color':_0x5b67ac(0x12a)}],this['bannerContainer']=null,this['lastFetchTime']=0x0,this['fetchInterval']=0xea60,this['pollingInterval']=null,this['usernameCache']={};}['initialize'](){const _0x4895fa=a42_0x348c;this['bannerContainer']=document['getElementById'](_0x4895fa(0x116));if(!this['bannerContainer']){console['error']('Promotion\x20banner\x20container\x20not\x20found');return;}this['setupBannerContainer']();const _0xc3543c=_0x4895fa(0x140)+new Date()['toDateString'](),_0xe4e6b7=sessionStorage['getItem'](_0xc3543c);!_0xe4e6b7&&(this['fetchRecentPromotions'](),sessionStorage['setItem'](_0xc3543c,'true')),document[_0x4895fa(0x160)]('visibilitychange',()=>{const _0x3271d6=_0x4895fa;document[_0x3271d6(0x111)]==='visible'&&!sessionStorage[_0x3271d6(0x10e)](_0xc3543c)&&(this['fetchRecentPromotions'](),sessionStorage[_0x3271d6(0x127)](_0xc3543c,'true'));}),window['addEventListener'](_0x4895fa(0x135),()=>{this['pollingInterval']&&clearInterval(this['pollingInterval']);});}[a42_0x19ae72(0x13a)](){const _0x26d1bb=a42_0x19ae72;this['bannerContainer']['innerHTML']='',this['bannerContainer'][_0x26d1bb(0x119)]['display']='none';}async[a42_0x19ae72(0x11b)](){const _0x1502bc=a42_0x19ae72;try{const _0x5ab5aa=Date[_0x1502bc(0x148)]();if(_0x5ab5aa-this['lastFetchTime']<this['fetchInterval'])return;this['lastFetchTime']=_0x5ab5aa;const _0x3772c8=collection(db,_0x1502bc(0x115)),_0x1c92f7=query(_0x3772c8,where('type','in',[_0x1502bc(0x144),'demotion']),orderBy('timestamp','desc'),limit(0x14)),_0x583f6b=await getDocs(_0x1c92f7),_0x415f07=[];_0x583f6b['forEach'](_0x126e55=>{const _0xd29880={'id':_0x126e55['id'],..._0x126e55['data']()};this['shouldShowPromotion'](_0x126e55['id'])&&this['isNewRankChange'](_0xd29880)&&_0x415f07['push'](_0xd29880);}),_0x415f07['length']>0x0&&await this['processRankChanges'](_0x415f07);}catch(_0x5357db){console[_0x1502bc(0x123)]('Error\x20fetching\x20promotions:',_0x5357db);}}async['processRankChanges'](_0x4be68a){const _0x52dbee=a42_0x19ae72;if(_0x4be68a['length']===0x0)return;_0x4be68a['sort']((_0x15710e,_0x10df54)=>{const _0x1fa6f3=a42_0x348c,_0x404b12=_0x15710e['timestamp']?.[_0x1fa6f3(0x125)]?.()||_0x15710e['timestamp']?.['seconds']*0x3e8||0x0,_0x27e0cd=_0x10df54['timestamp']?.['toMillis']?.()||_0x10df54['timestamp']?.['seconds']*0x3e8||0x0;return _0x27e0cd-_0x404b12;});const _0xf2891a=this['bannerContainer']['children']['length'],_0x30bc1b=0x3-_0xf2891a;if(_0x30bc1b<=0x0)return;const _0x5075a7=_0x4be68a[_0x52dbee(0x13c)](0x0,_0x30bc1b);for(let _0x2e27a0=0x0;_0x2e27a0<_0x5075a7['length'];_0x2e27a0++){const _0x55d761=_0x5075a7[_0x2e27a0],_0x11dc4b=auth['currentUser'];try{setTimeout(()=>{this['showRankChangeBanner'](_0x55d761);},_0x2e27a0*0x3e8),_0x11dc4b&&_0x55d761['player']===_0x11dc4b['displayName']&&this['showRankChangeLightbox'](_0x55d761['type'],_0x55d761[_0x52dbee(0x15b)]);}catch(_0xceaf39){console['error']('Error\x20processing\x20rank\x20change:',_0xceaf39);}}}[a42_0x19ae72(0x113)](_0x22e53e){const _0x495387=a42_0x19ae72;try{const _0x4ad5d3='promotion_'+_0x22e53e,_0x17af5b=localStorage['getItem'](_0x4ad5d3);if(_0x17af5b){let _0x3c2875;try{_0x3c2875=JSON['parse'](_0x17af5b);}catch(_0x2853fb){return console[_0x495387(0x11d)]('Invalid\x20storage\x20format\x20for\x20'+_0x4ad5d3+',\x20treating\x20as\x20new'),!![];}if(_0x3c2875['ignored']===!![])return console[_0x495387(0x143)]('Promotion\x20'+_0x22e53e+'\x20is\x20permanently\x20ignored'),![];const _0x3d2b61=Date['now']();if(_0x3c2875['userDismissed']&&_0x3d2b61-_0x3c2875[_0x495387(0x112)]<this[_0x495387(0x128)]*0x3c*0x3c*0x3e8)return console['log']('Promotion\x20'+_0x22e53e+'\x20was\x20dismissed\x20by\x20user\x20within\x20last\x20'+this[_0x495387(0x128)]+'\x20hours'),![];if(_0x3c2875['systemDismissed']&&_0x3d2b61-_0x3c2875['timestamp']<0x4*0x3c*0x3c*0x3e8)return console['log']('Promotion\x20'+_0x22e53e+'\x20was\x20auto-dismissed\x20within\x20last\x204\x20hours'),![];}return!![];}catch(_0x56dad2){return console['error']('Error\x20checking\x20promotion\x20visibility:',_0x56dad2),![];}}['ignorePromotion'](_0x300d67){const _0x58a6b6=a42_0x19ae72;try{const _0x1c8555='promotion_'+_0x300d67;localStorage['setItem'](_0x1c8555,JSON['stringify']({'timestamp':Date[_0x58a6b6(0x148)](),'ignored':!![]}));}catch(_0x15dcda){console['error']('Error\x20saving\x20promotion\x20preference:',_0x15dcda);}}['showRankChangeBanner'](_0x5a40bd){this['resolveUserId'](_0x5a40bd)['then'](_0x28fcb6=>{const _0x1046c3=a42_0x348c,_0x346e33='promotion_'+_0x5a40bd['id'],_0xa73c57=localStorage[_0x1046c3(0x10e)](_0x346e33);if(_0xa73c57)try{const _0x4806ce=JSON['parse'](_0xa73c57);if(_0x4806ce['ignored']===!![]){console[_0x1046c3(0x143)]('Skipping\x20ignored\x20promotion:\x20'+_0x5a40bd['id']);return;}}catch(_0x37ffe6){}localStorage['setItem'](_0x346e33,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':![],'seenAt':Date[_0x1046c3(0x148)]()})),this['bannerContainer']['style'][_0x1046c3(0x14f)]='block';while(this[_0x1046c3(0x159)]['children']['length']>=0x3){this['bannerContainer']['removeChild'](this[_0x1046c3(0x159)][_0x1046c3(0x12f)]);}const _0x18a73f=document[_0x1046c3(0x12b)]('div');_0x18a73f['className']=_0x1046c3(0x153),_0x18a73f['setAttribute']('data-rank',_0x28fcb6[_0x1046c3(0x15b)]),_0x18a73f['setAttribute']('data-id',_0x28fcb6['id']);const _0x71424=document[_0x1046c3(0x12b)]('div');_0x71424['className']='promotion-details';const _0x456211=_0x28fcb6['resolvedName']||_0x28fcb6['player']||_0x28fcb6[_0x1046c3(0x151)]||_0x28fcb6[_0x1046c3(0x121)]||_0x28fcb6[_0x1046c3(0x146)]||_0x1046c3(0x142),_0x15ef26=_0x28fcb6['type']===_0x1046c3(0x144)?_0x456211+_0x1046c3(0x132):_0x456211+'\x20was\x20demoted\x20to';_0x71424['innerHTML']=_0x15ef26+_0x1046c3(0x14a)+_0x28fcb6['rankAchieved']+'</span>';const _0x38ec78=document['createElement'](_0x1046c3(0x137));_0x38ec78['className']='banner-actions';const _0x4d9a73=document['createElement'](_0x1046c3(0x15c));_0x4d9a73['className']='dismiss-btn',_0x4d9a73[_0x1046c3(0x13f)]=_0x1046c3(0x145),_0x4d9a73['title']=_0x1046c3(0x154);const _0x560c63=document['createElement']('button');_0x560c63['className']='ignore-btn',_0x560c63['textContent']='Don\x27t\x20show\x20again',_0x560c63[_0x1046c3(0x133)]='Never\x20show\x20this\x20promotion\x20again',_0x38ec78['appendChild'](_0x560c63),_0x38ec78['appendChild'](_0x4d9a73),_0x18a73f[_0x1046c3(0x10a)](_0x71424),_0x18a73f[_0x1046c3(0x10a)](_0x38ec78),this['bannerContainer']['appendChild'](_0x18a73f),void _0x18a73f['offsetWidth'],setTimeout(()=>{const _0x57c81a=_0x1046c3;_0x18a73f['classList']['add'](_0x57c81a(0x152));},0x32),_0x4d9a73[_0x1046c3(0x160)]('click',()=>{const _0x24b3de=_0x1046c3;localStorage['setItem'](_0x346e33,JSON['stringify']({'timestamp':Date[_0x24b3de(0x148)](),'ignored':![],'userDismissed':!![],'systemDismissed':![]})),_0x18a73f['classList']['remove']('new-rank-change'),_0x18a73f['classList'][_0x24b3de(0x11a)]('dismissing'),setTimeout(()=>{const _0x24a00f=_0x24b3de;_0x18a73f['parentNode']&&(_0x18a73f['remove'](),this[_0x24a00f(0x159)][_0x24a00f(0x14b)][_0x24a00f(0x149)]===0x0&&(this['bannerContainer']['style'][_0x24a00f(0x14f)]=_0x24a00f(0x150)));},0x1f4);}),_0x560c63['addEventListener']('click',()=>{const _0x440f2e=_0x1046c3;localStorage['setItem'](_0x346e33,JSON[_0x440f2e(0x122)]({'timestamp':Date['now'](),'ignored':!![],'userDismissed':!![],'systemDismissed':![]})),_0x18a73f[_0x440f2e(0x12e)]['remove'](_0x440f2e(0x152)),_0x18a73f[_0x440f2e(0x12e)][_0x440f2e(0x11a)](_0x440f2e(0x10b)),setTimeout(()=>{const _0x3b9acd=_0x440f2e;_0x18a73f['parentNode']&&(_0x18a73f['remove'](),this[_0x3b9acd(0x159)][_0x3b9acd(0x14b)]['length']===0x0&&(this[_0x3b9acd(0x159)][_0x3b9acd(0x119)]['display']=_0x3b9acd(0x150)));},0x1f4);}),setTimeout(()=>{const _0xd73b5f=_0x1046c3;_0x18a73f['parentNode']&&(_0x18a73f['classList']['remove']('new-rank-change'),_0x18a73f['classList']['add']('dismissing'),localStorage['setItem'](_0x346e33,JSON[_0xd73b5f(0x122)]({'timestamp':Date[_0xd73b5f(0x148)](),'ignored':![],'userDismissed':![],'systemDismissed':!![]})),setTimeout(()=>{const _0x5896dd=_0xd73b5f;_0x18a73f['parentNode']&&(_0x18a73f[_0x5896dd(0x12d)](),this['bannerContainer']['children'][_0x5896dd(0x149)]===0x0&&(this['bannerContainer'][_0x5896dd(0x119)][_0x5896dd(0x14f)]='none'));},0x1f4));},0x3a98);});}async['resolveUserId'](_0x3bb709){const _0x5d6359=a42_0x19ae72,_0x2a28b6={..._0x3bb709},_0x48bd94=[_0x3bb709['player'],_0x3bb709['username'],_0x3bb709['playerUsername'],_0x3bb709['displayName']],_0x3b4e88=_0x48bd94['some'](_0x253425=>_0x253425&&typeof _0x253425==='string'&&!_0x253425['includes'](_0x5d6359(0x10c))&&!/^[a-zA-Z0-9]{20,}$/['test'](_0x253425));if(_0x3b4e88)return _0x2a28b6;let _0x432079=null;if(_0x3bb709['userId'])_0x432079=_0x3bb709['userId'];else _0x3bb709['player']&&/^[A-Za-z0-9]{20,}$/['test'](_0x3bb709['player'])&&(_0x432079=_0x3bb709['player']);if(!_0x432079)return _0x2a28b6;try{const _0xca4925=await getDoc(doc(db,_0x5d6359(0x138),_0x432079));if(_0xca4925['exists']()){const _0x3b1fc6=_0xca4925[_0x5d6359(0x114)]();if(_0x3b1fc6[_0x5d6359(0x151)])return _0x2a28b6['resolvedName']=_0x3b1fc6['username'],_0x2a28b6;}const _0x1e1576=await getDocs(query(collection(db,'approvedMatches'),where('winnerId','==',_0x432079),orderBy('date',_0x5d6359(0x15d)),limit(0x1)));if(!_0x1e1576[_0x5d6359(0x161)]){const _0x520886=_0x1e1576['docs'][0x0]['data']();if(_0x520886[_0x5d6359(0x110)])return _0x2a28b6['resolvedName']=_0x520886['winnerUsername'],_0x2a28b6;}const _0x1f1cdc=await getDocs(query(collection(db,'approvedMatches'),where(_0x5d6359(0x11f),'==',_0x432079),orderBy('date','desc'),limit(0x1)));if(!_0x1f1cdc[_0x5d6359(0x161)]){const _0x70c584=_0x1f1cdc['docs'][0x0]['data']();if(_0x70c584['loserUsername'])return _0x2a28b6[_0x5d6359(0x158)]=_0x70c584['loserUsername'],console['log']('Resolved\x20'+_0x432079+'\x20to\x20'+_0x70c584['loserUsername']+'\x20(loser)'),_0x2a28b6;}}catch(_0x374660){console['error']('Error\x20resolving\x20user\x20ID:',_0x374660);}return console[_0x5d6359(0x11d)]('Failed\x20to\x20resolve\x20user\x20ID:\x20'+_0x432079),_0x2a28b6;}['showRankChangeLightbox'](_0x183767,_0x7fa78){const _0x4c312f=a42_0x19ae72;let _0x55e262=document['getElementById'](_0x4c312f(0x13d));!_0x55e262&&(_0x55e262=document[_0x4c312f(0x12b)]('div'),_0x55e262['id']=_0x4c312f(0x13d),_0x55e262['className']='rank-change-modal\x20'+_0x183767,document['body'][_0x4c312f(0x10a)](_0x55e262));const _0x562393=_0x183767==='promotion'?'Congratulations!':'Rank\x20Update',_0x481c3b=_0x183767==='promotion'?'You\x27ve\x20been\x20promoted\x20to':'You\x27ve\x20been\x20demoted\x20to';_0x55e262['innerHTML']=_0x4c312f(0x15a)+_0x562393+'</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>'+_0x481c3b+_0x4c312f(0x124)+_0x7fa78+_0x4c312f(0x10f),_0x55e262[_0x4c312f(0x119)]['display']=_0x4c312f(0x129),document['getElementById'](_0x4c312f(0x14e))['addEventListener'](_0x4c312f(0x156),()=>{_0x55e262['style']['display']='none';}),_0x55e262['addEventListener']('click',_0x17682a=>{const _0x55a6a2=_0x4c312f;_0x17682a[_0x55a6a2(0x107)]===_0x55e262&&(_0x55e262['style']['display']=_0x55a6a2(0x150));});}async['checkAndRecordPromotion'](_0x13e4b1,_0x22f1df,_0x28ec80,_0x18598c={}){const _0x4d979d=a42_0x19ae72;try{if(_0x22f1df===_0x28ec80||!_0x13e4b1)return null;const _0x2cbeff=_0x18598c[_0x4d979d(0x147)]||_0x4d979d(0x136),_0x4f37f1=_0x18598c['matchId']||null,_0x1a0bd1=_0x18598c['adminUser']||null;console['log']('Processing\x20potential\x20rank\x20change:\x20'+_0x28ec80+'\x20→\x20'+_0x22f1df+_0x4d979d(0x131)+_0x2cbeff+')');let _0x4b26ab=null,_0x583431=null;try{const _0x532483=await getDoc(doc(db,'players',_0x13e4b1));if(_0x532483['exists']()){const _0x5f2950=_0x532483['data']();_0x4b26ab=_0x5f2950['username']||_0x5f2950[_0x4d979d(0x146)]||null,_0x583431=_0x5f2950['displayName']||_0x5f2950['username']||null;}!_0x4b26ab&&_0x18598c[_0x4d979d(0x151)]&&(_0x4b26ab=_0x18598c['username'],_0x583431=_0x18598c[_0x4d979d(0x151)]);!_0x4b26ab&&auth[_0x4d979d(0x155)]&&(_0x4b26ab=auth['currentUser']['displayName']||auth['currentUser']['email'][_0x4d979d(0x14c)]('@')[0x0],_0x583431=auth[_0x4d979d(0x155)][_0x4d979d(0x146)]||null);if(!_0x4b26ab){const _0x2cdb46=query(collection(db,'approvedMatches'),where(_0x4d979d(0x117),'==',_0x13e4b1),limit(0x1)),_0x2bd83c=await getDocs(_0x2cdb46);if(!_0x2bd83c['empty'])_0x4b26ab=_0x2bd83c['docs'][0x0][_0x4d979d(0x114)]()['winnerUsername']||_0x4d979d(0x11e),_0x583431=_0x4b26ab;else{const _0x4a6386=query(collection(db,'approvedMatches'),where('loserId','==',_0x13e4b1),limit(0x1)),_0x50c93b=await getDocs(_0x4a6386);!_0x50c93b['empty']&&(_0x4b26ab=_0x50c93b[0x0]['data']()['loserUsername']||'Unknown\x20Player',_0x583431=_0x4b26ab);}}}catch(_0xe90e2b){console['error']('Error\x20resolving\x20username:',_0xe90e2b);}!_0x4b26ab&&(console['warn']('Could\x20not\x20resolve\x20username\x20for\x20userId:',_0x13e4b1),_0x4b26ab='A\x20player',_0x583431=_0x4d979d(0x11e));const _0x1c2f9e=this[_0x4d979d(0x108)](_0x28ec80),_0x4bacfd=this[_0x4d979d(0x108)](_0x22f1df);if(_0x1c2f9e!==_0x4bacfd){const _0x166bc5=_0x22f1df>_0x28ec80,_0x23574f=_0x166bc5?_0x4d979d(0x144):_0x4d979d(0x14d),_0x2b89e0=_0x4bacfd;console['log'](_0x4d979d(0x120)+_0x23574f+_0x4d979d(0x118)+_0x4b26ab+':\x20'+_0x28ec80+'\x20('+_0x1c2f9e+')\x20→\x20'+_0x22f1df+'\x20('+_0x4bacfd+')');try{const _0x1f424d={'player':_0x4b26ab,'playerUsername':_0x4b26ab,'username':_0x4b26ab,'displayName':_0x583431,'userId':_0x13e4b1,'type':_0x23574f,'rankAchieved':_0x2b89e0,'timestamp':serverTimestamp(),'previousElo':_0x28ec80,'newElo':_0x22f1df,'change':_0x22f1df-_0x28ec80,'previousRank':_0x1c2f9e,'newRank':_0x4bacfd,'source':_0x2cbeff};if(_0x2cbeff==='match'&&_0x4f37f1)_0x1f424d['matchId']=_0x4f37f1;else _0x2cbeff==='admin'&&_0x1a0bd1?(_0x1f424d['modifiedBy']=_0x1a0bd1,_0x1f424d[_0x4d979d(0x13b)]=![]):_0x1f424d[_0x4d979d(0x13b)]=!![];const _0x48357f=writeBatch(db),_0x1667f0=doc(collection(db,'eloHistory')),_0x9d3f72=doc(collection(db,'promotionHistory'));return _0x48357f[_0x4d979d(0x13e)](_0x1667f0,_0x1f424d),_0x48357f['set'](_0x9d3f72,_0x1f424d),await _0x48357f[_0x4d979d(0x134)](),await this['sendPromotionNotification'](_0x13e4b1,_0x4b26ab,_0x28ec80,_0x22f1df,_0x1c2f9e,_0x4bacfd,_0x23574f,{'displayName':_0x583431,'source':_0x2cbeff,'matchId':_0x4f37f1,'ladder':_0x18598c['ladder']||'D1'}),console[_0x4d979d(0x143)](_0x4d979d(0x139)+_0x23574f+'\x20for\x20'+_0x4b26ab+_0x4d979d(0x15f)+_0x2b89e0),_0x2b89e0;}catch(_0xc611cc){console['error']('Error\x20writing\x20promotion\x20records:',_0xc611cc);try{return await addDoc(collection(db,'eloHistory'),{'player':_0x4b26ab,'playerUsername':_0x4b26ab,'username':_0x4b26ab,'displayName':_0x583431,'userId':_0x13e4b1,'type':_0x23574f,'rankAchieved':_0x2b89e0,'timestamp':serverTimestamp(),'previousElo':_0x28ec80,'newElo':_0x22f1df,'change':_0x22f1df-_0x28ec80,'previousRank':_0x1c2f9e,'source':_0x2cbeff,'isAutomatic':_0x2cbeff!=='admin'}),await this['sendPromotionNotification'](_0x13e4b1,_0x4b26ab,_0x28ec80,_0x22f1df,_0x1c2f9e,_0x4bacfd,_0x23574f,{'displayName':_0x583431,'source':_0x2cbeff,'matchId':_0x4f37f1,'ladder':_0x18598c[_0x4d979d(0x11c)]||'D1'}),_0x2b89e0;}catch(_0x4509ab){return console[_0x4d979d(0x123)](_0x4d979d(0x12c),_0x4509ab),null;}}}return null;}catch(_0x15f39e){return console[_0x4d979d(0x123)]('Error\x20in\x20promotion/demotion\x20recording:',_0x15f39e),null;}}[a42_0x19ae72(0x108)](_0x2c6a80){const _0x20a550=a42_0x19ae72;for(let _0xf34a4e=this[_0x20a550(0x15e)]['length']-0x1;_0xf34a4e>=0x0;_0xf34a4e--){if(_0x2c6a80>=this[_0x20a550(0x15e)][_0xf34a4e]['threshold'])return this['RANKS'][_0xf34a4e]['name'];}return'Unranked';}['cleanup'](){this['pollingInterval']&&clearInterval(this['pollingInterval']);}['isNewRankChange'](_0x4ce474){if(_0x4ce474['timestamp']){const _0x10b7aa=_0x4ce474['timestamp']['seconds']*0x3e8,_0x9e3619=Date['now'](),_0xeb34db=(_0x9e3619-_0x10b7aa)/(0x3e8*0x3c*0x3c);if(_0xeb34db>0x18)return![];}if(_0x4ce474['previousRank']&&_0x4ce474['newRank']&&_0x4ce474['previousRank']!==_0x4ce474['newRank'])return!![];return![];}async[a42_0x19ae72(0x141)](_0x1a7d16,_0x1385c9,_0x31eb96,_0x28e1a3,_0x3493d6,_0x483133,_0x3deef8,_0x3b2b94={}){const _0x351b36=a42_0x19ae72;try{console[_0x351b36(0x143)]('STARTING\x20notification\x20for\x20'+_0x1385c9+_0x351b36(0x130)+_0x3deef8);const _0x25f457={'userId':_0x1a7d16,'username':_0x1385c9,'displayName':_0x3b2b94[_0x351b36(0x146)]||_0x1385c9,'oldElo':parseInt(_0x31eb96),'newElo':parseInt(_0x28e1a3),'eloDifference':parseInt(_0x28e1a3)-parseInt(_0x31eb96),'oldRank':_0x3493d6,'newRank':_0x483133,'type':_0x3deef8,'timestamp':serverTimestamp(),'processed':![],'source':_0x3b2b94['source']||_0x351b36(0x136),'matchId':_0x3b2b94['matchId']||null,'ladder':_0x3b2b94[_0x351b36(0x11c)]||'D1','adminUser':_0x3b2b94['adminUser']||null};console['log']('Creating\x20Discord\x20notification:',_0x25f457);const _0x1d12e4=await addDoc(collection(db,'promotionNotifications'),_0x25f457);return console[_0x351b36(0x143)]('Discord\x20notification\x20sent\x20successfully\x20with\x20ID:\x20'+_0x1d12e4['id']),!![];}catch(_0x53aa2e){return console[_0x351b36(0x123)]('Error\x20sending\x20Discord\x20notification:',_0x53aa2e),![];}}}export const promotionManager=new PromotionManager();document['addEventListener']('DOMContentLoaded',()=>{promotionManager['initialize']();});export const initializePromotionTracker=()=>promotionManager[a42_0x19ae72(0x109)]();export const checkAndRecordPromotion=(_0x3b1e94,_0x127b55,_0x296947,_0x1e1556)=>promotionManager['checkAndRecordPromotion'](_0x3b1e94,_0x127b55,_0x296947,_0x1e1556);export const getRankName=_0x28ea91=>promotionManager['getRankName'](_0x28ea91);
const a13_0x4f1b58=a13_0x19ee,a13_0x9cdc48=(function(){let _0x12ca06=!![];return function(_0x3ccd97,_0x412c3e){const _0x3d57a9=_0x12ca06?function(){const _0x45d5fb=a13_0x19ee;if(_0x412c3e){const _0x5d7bee=_0x412c3e[_0x45d5fb(0x1a4)](_0x3ccd97,arguments);return _0x412c3e=null,_0x5d7bee;}}:function(){};return _0x12ca06=![],_0x3d57a9;};}()),a13_0xdb9a49=a13_0x9cdc48(this,function(){const _0x1c8006=a13_0x19ee,_0x3c3307=function(){let _0x2c5e2b;try{_0x2c5e2b=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x3f283c){_0x2c5e2b=window;}return _0x2c5e2b;},_0x220692=_0x3c3307(),_0x48f25f=_0x220692['console']=_0x220692['console']||{},_0x2ef5b4=['log','warn','info','error',_0x1c8006(0x1a9),'table','trace'];for(let _0x257c0d=0x0;_0x257c0d<_0x2ef5b4[_0x1c8006(0x1a6)];_0x257c0d++){const _0x2b86ca=a13_0x9cdc48['constructor']['prototype']['bind'](a13_0x9cdc48),_0xffa9d5=_0x2ef5b4[_0x257c0d],_0x418f2a=_0x48f25f[_0xffa9d5]||_0x2b86ca;_0x2b86ca[_0x1c8006(0x1a3)]=a13_0x9cdc48['bind'](a13_0x9cdc48),_0x2b86ca['toString']=_0x418f2a['toString']['bind'](_0x418f2a),_0x48f25f[_0xffa9d5]=_0x2b86ca;}});function a13_0x19ee(_0x47d01b,_0x38534f){const _0xdb9a49=a13_0x4cf8();return a13_0x19ee=function(_0x9cdc48,_0x41c42c){_0x9cdc48=_0x9cdc48-0x199;let _0x4cf8f9=_0xdb9a49[_0x9cdc48];return _0x4cf8f9;},a13_0x19ee(_0x47d01b,_0x38534f);}a13_0xdb9a49();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc,where}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D3=[{'name':'Emerald','elo':0x7d0},{'name':a13_0x4f1b58(0x1a7),'elo':0x708},{'name':a13_0x4f1b58(0x1a2),'elo':0x640},{'name':a13_0x4f1b58(0x1aa),'elo':0x578},{'name':a13_0x4f1b58(0x199),'elo':0x4b0}];let lastVisibleD3=null;function a13_0x4cf8(){const _0x2b1006=['Unranked','desc','winnerUsername','data','approvedMatchesD3','demotion','map','empty','docs','Silver','__proto__','apply','Error\x20recording\x20D3\x20ELO\x20history:','length','Gold','D3\x20ELO\x20history\x20recorded\x20for\x20','exception','Bronze','newElo','winnerId','error','Unknown\x20Player'];a13_0x4cf8=function(){return _0x2b1006;};return a13_0x4cf8();}async function getUsernameByIdD3(_0x54f9eb){const _0x280130=a13_0x4f1b58;try{if(!_0x54f9eb)return _0x280130(0x1ae);const _0x416c16=await getDoc(doc(db,'playersD3',_0x54f9eb));if(_0x416c16['exists']())return _0x416c16['data']()['username']||'Unknown\x20Player';const _0x57bbe3=await getDocs(query(collection(db,_0x280130(0x19d)),where(_0x280130(0x1ac),'==',_0x54f9eb),limit(0x1)));if(!_0x57bbe3['empty'])return _0x57bbe3[_0x280130(0x1a1)][0x0]['data']()[_0x280130(0x19b)]||'Unknown\x20Player';const _0x37328a=await getDocs(query(collection(db,'approvedMatchesD3'),where('loserId','==',_0x54f9eb),limit(0x1)));if(!_0x37328a['empty'])return _0x37328a[_0x280130(0x1a1)][0x0][_0x280130(0x19c)]()['loserUsername']||_0x280130(0x1ae);return _0x280130(0x1ae);}catch(_0x236ff8){return console[_0x280130(0x1ad)]('Error\x20getting\x20D3\x20username:',_0x236ff8),_0x280130(0x1ae);}}export async function recordEloChangeD3({playerId:_0x17dcde,previousElo:_0x5083e4,newElo:_0x25d828,opponentId:_0x128295,matchResult:_0x39d7f0,previousPosition:_0x21d523,newPosition:_0x1093f0,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x461e2e,timestamp:_0x4bbaa7}){const _0xd3848a=a13_0x4f1b58;try{const _0x5bb65b=doc(collection(db,'eloHistoryD3'));let _0x30a25a='match';if(isPromotion)_0x30a25a='promotion';if(isDemotion)_0x30a25a=_0xd3848a(0x19e);let _0x2abc6c=_0xd3848a(0x199);if(_0x25d828>=0x7d0)_0x2abc6c='Emerald';else{if(_0x25d828>=0x708)_0x2abc6c=_0xd3848a(0x1a7);else{if(_0x25d828>=0x640)_0x2abc6c='Silver';else{if(_0x25d828>=0x578)_0x2abc6c='Bronze';}}}return await setDoc(_0x5bb65b,{'type':_0x30a25a,'player':_0x17dcde,'opponent':_0x128295,'previousElo':_0x5083e4,'newElo':_0x25d828,'change':_0x25d828-_0x5083e4,'matchResult':_0x39d7f0,'previousPosition':_0x21d523,'newPosition':_0x1093f0,'rankAchieved':_0x2abc6c,'matchId':_0x461e2e,'timestamp':_0x4bbaa7||serverTimestamp(),'gameMode':'D3'}),console['log'](_0xd3848a(0x1a8)+_0x17dcde),!![];}catch(_0x51839e){console[_0xd3848a(0x1ad)](_0xd3848a(0x1a5),_0x51839e);throw _0x51839e;}}export async function getEloHistoryD3(_0xdd3446=0x14){const _0x51fabe=a13_0x4f1b58;try{const _0x31f6e9=collection(db,'eloHistoryD3');let _0x11e54a;lastVisibleD3?_0x11e54a=query(_0x31f6e9,orderBy('timestamp','desc'),startAfter(lastVisibleD3),limit(_0xdd3446)):_0x11e54a=query(_0x31f6e9,orderBy('timestamp',_0x51fabe(0x19a)),limit(_0xdd3446));const _0x5cca51=await getDocs(_0x11e54a);if(_0x5cca51[_0x51fabe(0x1a0)])return{'entries':[],'hasMore':![]};lastVisibleD3=_0x5cca51['docs'][_0x5cca51[_0x51fabe(0x1a1)]['length']-0x1];const _0x3b6cff=_0x5cca51['docs'][_0x51fabe(0x19f)](async _0xdc865c=>{const _0x25a43c=_0x51fabe,_0x586a1a=_0xdc865c[_0x25a43c(0x19c)](),[_0x8f84ba,_0x42d67d]=await Promise['all']([getUsernameByIdD3(_0x586a1a['player']),getUsernameByIdD3(_0x586a1a['opponent'])]);return{..._0x586a1a,'playerUsername':_0x8f84ba,'opponentUsername':_0x42d67d,'change':_0x586a1a[_0x25a43c(0x1ab)]-_0x586a1a['previousElo'],'timestamp':_0x586a1a['timestamp']};}),_0x340c86=await Promise['all'](_0x3b6cff);return{'entries':_0x340c86,'hasMore':_0x5cca51['size']===_0xdd3446};}catch(_0x26b760){console['error']('Error\x20fetching\x20D3\x20ELO\x20history:',_0x26b760);throw _0x26b760;}}export function resetPaginationD3(){lastVisibleD3=null;}
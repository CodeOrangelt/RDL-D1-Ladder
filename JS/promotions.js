const a42_0x149116=a42_0x1f9a,a42_0x55b8b3=(function(){let _0x36e68e=!![];return function(_0x1f9415,_0x379130){const _0x41d28c=_0x36e68e?function(){if(_0x379130){const _0x542fd1=_0x379130['apply'](_0x1f9415,arguments);return _0x379130=null,_0x542fd1;}}:function(){};return _0x36e68e=![],_0x41d28c;};}()),a42_0x4b24b3=a42_0x55b8b3(this,function(){const _0xcf84dc=a42_0x1f9a,_0x103b6b=function(){let _0x1efa3d;try{_0x1efa3d=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x598f9a){_0x1efa3d=window;}return _0x1efa3d;},_0x4982bf=_0x103b6b(),_0x834e4c=_0x4982bf['console']=_0x4982bf[_0xcf84dc(0x113)]||{},_0x196746=[_0xcf84dc(0x116),_0xcf84dc(0x106),'info',_0xcf84dc(0x109),'exception','table','trace'];for(let _0x1e780f=0x0;_0x1e780f<_0x196746[_0xcf84dc(0x114)];_0x1e780f++){const _0x161492=a42_0x55b8b3['constructor']['prototype']['bind'](a42_0x55b8b3),_0x388c59=_0x196746[_0x1e780f],_0x15e418=_0x834e4c[_0x388c59]||_0x161492;_0x161492[_0xcf84dc(0xfd)]=a42_0x55b8b3['bind'](a42_0x55b8b3),_0x161492[_0xcf84dc(0x157)]=_0x15e418['toString']['bind'](_0x15e418),_0x834e4c[_0x388c59]=_0x161492;}});a42_0x4b24b3();function a42_0xd4c2(){const _0x3d7176=['automatic','approvedMatches','toMillis','seconds','style','cleanup','__proto__','true','bannerContainer','lastFetchTime','setItem',',\x20treating\x20as\x20new','display','\x20hours','match','warn','Promotion\x20','fetchRecentPromotions','error','\x20→\x20','getItem','player','adminUser','empty','username','RANKS','Discord\x20notification\x20sent\x20successfully\x20with\x20ID:\x20','timestamp','console','length','sendPromotionNotification','log','showRankChangeBanner','visible','promotion','slice','winnerUsername','div','rank-change-modal\x20','dismiss-btn','Error\x20checking\x20promotion\x20visibility:','remove','currentUser','checkAndRecordPromotion','test','#CD7F32','Invalid\x20storage\x20format\x20for\x20','userDismissed','none','forEach','eloHistory','classList','Unranked','isAutomatic','processRankChanges','</span>','A\x20player','Successfully\x20recorded\x20','promotionHistory','click','Promotion\x20banner\x20container\x20not\x20found','data','#FFD700','promotionNotifications','fetchInterval','matchId','now','innerHTML','visibilityState','Failed\x20to\x20resolve\x20user\x20ID:\x20','button','\x20(loser)','previousRank','dismissing','You\x27ve\x20been\x20promoted\x20to','#50C878','banner-actions','\x20was\x20promoted\x20to','addEventListener','loserUsername','initialize','ignorePromotion','title','promotion_','desc','userId','shouldShowPromotion','className','createElement','parse','stringify','appendChild','pollingInterval','systemDismissed','Error\x20saving\x20promotion\x20preference:',')\x20→\x20','toString','displayName','exists'];a42_0xd4c2=function(){return _0x3d7176;};return a42_0xd4c2();}import{collection,doc,query,where,orderBy,limit,getDocs,addDoc,getDoc,serverTimestamp,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{auth,db}from'./firebase-config.js';class PromotionManager{constructor(){const _0x41eca4=a42_0x1f9a;this['DISPLAY_HOURS']=0x18,this['RANKS']=[{'threshold':0x578,'name':'Bronze','color':_0x41eca4(0x124)},{'threshold':0x640,'name':'Silver','color':'#C0C0C0'},{'threshold':0x708,'name':'Gold','color':_0x41eca4(0x135)},{'threshold':0x834,'name':'Emerald','color':_0x41eca4(0x142)}],this['bannerContainer']=null,this[_0x41eca4(0x100)]=0x0,this[_0x41eca4(0x137)]=0xea60,this['pollingInterval']=null,this['usernameCache']={};}['initialize'](){const _0xf55fdc=a42_0x1f9a;this['bannerContainer']=document['getElementById']('promotion-banner-container');if(!this[_0xf55fdc(0xff)]){console[_0xf55fdc(0x109)](_0xf55fdc(0x133));return;}this['setupBannerContainer']();const _0x491ab2='promotions_checked_'+new Date()['toDateString'](),_0x5e527e=sessionStorage['getItem'](_0x491ab2);!_0x5e527e&&(this['fetchRecentPromotions'](),sessionStorage['setItem'](_0x491ab2,'true')),document['addEventListener']('visibilitychange',()=>{const _0x473e9e=_0xf55fdc;document[_0x473e9e(0x13b)]===_0x473e9e(0x118)&&!sessionStorage['getItem'](_0x491ab2)&&(this[_0x473e9e(0x108)](),sessionStorage['setItem'](_0x491ab2,_0x473e9e(0xfe)));}),window['addEventListener']('beforeunload',()=>{this['pollingInterval']&&clearInterval(this['pollingInterval']);});}['setupBannerContainer'](){const _0x103faf=a42_0x1f9a;this['bannerContainer']['innerHTML']='',this[_0x103faf(0xff)]['style']['display']=_0x103faf(0x127);}async['fetchRecentPromotions'](){const _0x21b4cc=a42_0x1f9a;try{const _0x1afb14=Date[_0x21b4cc(0x139)]();if(_0x1afb14-this['lastFetchTime']<this['fetchInterval'])return;this['lastFetchTime']=_0x1afb14;const _0x436e6b=collection(db,'eloHistory'),_0x928c2=query(_0x436e6b,where('type','in',['promotion','demotion']),orderBy(_0x21b4cc(0x112),_0x21b4cc(0x14b)),limit(0x14)),_0x2fbb64=await getDocs(_0x928c2),_0x1b7bbe=[];_0x2fbb64[_0x21b4cc(0x128)](_0x1c5185=>{const _0x12a82d=_0x21b4cc,_0x2190f7={'id':_0x1c5185['id'],..._0x1c5185['data']()};this[_0x12a82d(0x14d)](_0x1c5185['id'])&&this['isNewRankChange'](_0x2190f7)&&_0x1b7bbe['push'](_0x2190f7);}),_0x1b7bbe['length']>0x0&&await this[_0x21b4cc(0x12d)](_0x1b7bbe);}catch(_0x360f05){console['error']('Error\x20fetching\x20promotions:',_0x360f05);}}async['processRankChanges'](_0xf908b6){const _0x16c0b9=a42_0x1f9a;if(_0xf908b6['length']===0x0)return;_0xf908b6['sort']((_0xaf94d9,_0x434359)=>{const _0x525c21=a42_0x1f9a,_0xa702ed=_0xaf94d9[_0x525c21(0x112)]?.[_0x525c21(0xf9)]?.()||_0xaf94d9['timestamp']?.[_0x525c21(0xfa)]*0x3e8||0x0,_0x5d2ed1=_0x434359['timestamp']?.['toMillis']?.()||_0x434359[_0x525c21(0x112)]?.[_0x525c21(0xfa)]*0x3e8||0x0;return _0x5d2ed1-_0xa702ed;});const _0x38b80a=this['bannerContainer']['children'][_0x16c0b9(0x114)],_0x258500=0x3-_0x38b80a;if(_0x258500<=0x0)return;const _0x32bd93=_0xf908b6[_0x16c0b9(0x11a)](0x0,_0x258500);for(let _0x3e8af4=0x0;_0x3e8af4<_0x32bd93['length'];_0x3e8af4++){const _0xf76797=_0x32bd93[_0x3e8af4],_0x4ed405=auth[_0x16c0b9(0x121)];try{setTimeout(()=>{const _0x1f56f1=_0x16c0b9;this[_0x1f56f1(0x117)](_0xf76797);},_0x3e8af4*0x3e8),_0x4ed405&&_0xf76797['player']===_0x4ed405[_0x16c0b9(0x158)]&&this['showRankChangeLightbox'](_0xf76797['type'],_0xf76797['rankAchieved']);}catch(_0x53264d){console['error']('Error\x20processing\x20rank\x20change:',_0x53264d);}}}['shouldShowPromotion'](_0x2b4bbf){const _0x3a8c07=a42_0x1f9a;try{const _0x576bdd=_0x3a8c07(0x14a)+_0x2b4bbf,_0xc340c3=localStorage[_0x3a8c07(0x10b)](_0x576bdd);if(_0xc340c3){let _0x3d6665;try{_0x3d6665=JSON['parse'](_0xc340c3);}catch(_0xdbe809){return console['warn'](_0x3a8c07(0x125)+_0x576bdd+_0x3a8c07(0x102)),!![];}if(_0x3d6665['ignored']===!![])return console['log'](_0x3a8c07(0x107)+_0x2b4bbf+'\x20is\x20permanently\x20ignored'),![];const _0x196508=Date[_0x3a8c07(0x139)]();if(_0x3d6665[_0x3a8c07(0x126)]&&_0x196508-_0x3d6665['timestamp']<this['DISPLAY_HOURS']*0x3c*0x3c*0x3e8)return console['log']('Promotion\x20'+_0x2b4bbf+'\x20was\x20dismissed\x20by\x20user\x20within\x20last\x20'+this['DISPLAY_HOURS']+_0x3a8c07(0x104)),![];if(_0x3d6665[_0x3a8c07(0x154)]&&_0x196508-_0x3d6665['timestamp']<0x4*0x3c*0x3c*0x3e8)return console[_0x3a8c07(0x116)]('Promotion\x20'+_0x2b4bbf+'\x20was\x20auto-dismissed\x20within\x20last\x204\x20hours'),![];}return!![];}catch(_0x1ed374){return console[_0x3a8c07(0x109)](_0x3a8c07(0x11f),_0x1ed374),![];}}[a42_0x149116(0x148)](_0x2f98b7){const _0x42789c=a42_0x149116;try{const _0x3cab95='promotion_'+_0x2f98b7;localStorage['setItem'](_0x3cab95,JSON[_0x42789c(0x151)]({'timestamp':Date['now'](),'ignored':!![]}));}catch(_0x185519){console[_0x42789c(0x109)](_0x42789c(0x155),_0x185519);}}[a42_0x149116(0x117)](_0x493fae){this['resolveUserId'](_0x493fae)['then'](_0x3aebe0=>{const _0xd136a1=a42_0x1f9a,_0x4c45c5='promotion_'+_0x493fae['id'],_0x5dda61=localStorage['getItem'](_0x4c45c5);if(_0x5dda61)try{const _0x427e9d=JSON[_0xd136a1(0x150)](_0x5dda61);if(_0x427e9d['ignored']===!![]){console['log']('Skipping\x20ignored\x20promotion:\x20'+_0x493fae['id']);return;}}catch(_0x39be42){}localStorage[_0xd136a1(0x101)](_0x4c45c5,JSON[_0xd136a1(0x151)]({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':![],'seenAt':Date['now']()})),this['bannerContainer']['style']['display']='block';while(this['bannerContainer']['children']['length']>=0x3){this[_0xd136a1(0xff)]['removeChild'](this['bannerContainer']['firstChild']);}const _0x2ca081=document['createElement']('div');_0x2ca081['className']='promotion-banner',_0x2ca081['setAttribute']('data-rank',_0x3aebe0['rankAchieved']),_0x2ca081['setAttribute']('data-id',_0x3aebe0['id']);const _0x4431a8=document['createElement'](_0xd136a1(0x11c));_0x4431a8['className']='promotion-details';const _0x5ad376=_0x3aebe0['resolvedName']||_0x3aebe0[_0xd136a1(0x10c)]||_0x3aebe0[_0xd136a1(0x10f)]||_0x3aebe0['playerUsername']||_0x3aebe0['displayName']||_0xd136a1(0x12f),_0x2f58f9=_0x3aebe0['type']===_0xd136a1(0x119)?_0x5ad376+_0xd136a1(0x144):_0x5ad376+'\x20was\x20demoted\x20to';_0x4431a8[_0xd136a1(0x13a)]=_0x2f58f9+'\x20<span\x20class=\x22rank-text\x22>'+_0x3aebe0['rankAchieved']+_0xd136a1(0x12e);const _0x1ea263=document[_0xd136a1(0x14f)]('div');_0x1ea263['className']=_0xd136a1(0x143);const _0x2a5863=document['createElement'](_0xd136a1(0x13d));_0x2a5863[_0xd136a1(0x14e)]=_0xd136a1(0x11e),_0x2a5863[_0xd136a1(0x13a)]='&times;',_0x2a5863[_0xd136a1(0x149)]='Dismiss';const _0x38e86d=document[_0xd136a1(0x14f)]('button');_0x38e86d['className']='ignore-btn',_0x38e86d['textContent']='Don\x27t\x20show\x20again',_0x38e86d['title']='Never\x20show\x20this\x20promotion\x20again',_0x1ea263[_0xd136a1(0x152)](_0x38e86d),_0x1ea263['appendChild'](_0x2a5863),_0x2ca081['appendChild'](_0x4431a8),_0x2ca081[_0xd136a1(0x152)](_0x1ea263),this['bannerContainer']['appendChild'](_0x2ca081),void _0x2ca081['offsetWidth'],setTimeout(()=>{const _0x1df050=_0xd136a1;_0x2ca081[_0x1df050(0x12a)]['add']('new-rank-change');},0x32),_0x2a5863['addEventListener'](_0xd136a1(0x132),()=>{const _0x3b4e4e=_0xd136a1;localStorage['setItem'](_0x4c45c5,JSON['stringify']({'timestamp':Date[_0x3b4e4e(0x139)](),'ignored':![],'userDismissed':!![],'systemDismissed':![]})),_0x2ca081[_0x3b4e4e(0x12a)][_0x3b4e4e(0x120)]('new-rank-change'),_0x2ca081['classList']['add'](_0x3b4e4e(0x140)),setTimeout(()=>{const _0x3094d8=_0x3b4e4e;_0x2ca081['parentNode']&&(_0x2ca081[_0x3094d8(0x120)](),this['bannerContainer']['children']['length']===0x0&&(this['bannerContainer']['style'][_0x3094d8(0x103)]='none'));},0x1f4);}),_0x38e86d['addEventListener']('click',()=>{const _0x1ddd9b=_0xd136a1;localStorage['setItem'](_0x4c45c5,JSON['stringify']({'timestamp':Date['now'](),'ignored':!![],'userDismissed':!![],'systemDismissed':![]})),_0x2ca081[_0x1ddd9b(0x12a)]['remove']('new-rank-change'),_0x2ca081['classList']['add'](_0x1ddd9b(0x140)),setTimeout(()=>{const _0x3eb86e=_0x1ddd9b;_0x2ca081['parentNode']&&(_0x2ca081[_0x3eb86e(0x120)](),this[_0x3eb86e(0xff)]['children']['length']===0x0&&(this[_0x3eb86e(0xff)]['style'][_0x3eb86e(0x103)]='none'));},0x1f4);}),setTimeout(()=>{const _0x546c9f=_0xd136a1;_0x2ca081['parentNode']&&(_0x2ca081['classList']['remove']('new-rank-change'),_0x2ca081['classList']['add']('dismissing'),localStorage[_0x546c9f(0x101)](_0x4c45c5,JSON[_0x546c9f(0x151)]({'timestamp':Date[_0x546c9f(0x139)](),'ignored':![],'userDismissed':![],'systemDismissed':!![]})),setTimeout(()=>{const _0x5ecb23=_0x546c9f;_0x2ca081['parentNode']&&(_0x2ca081['remove'](),this[_0x5ecb23(0xff)]['children']['length']===0x0&&(this[_0x5ecb23(0xff)][_0x5ecb23(0xfb)]['display']='none'));},0x1f4));},0x3a98);});}async['resolveUserId'](_0x1c9244){const _0x213679=a42_0x149116,_0x4ab912={..._0x1c9244},_0x2f1611=[_0x1c9244[_0x213679(0x10c)],_0x1c9244[_0x213679(0x10f)],_0x1c9244['playerUsername'],_0x1c9244[_0x213679(0x158)]],_0x10b369=_0x2f1611['some'](_0x2d70d5=>_0x2d70d5&&typeof _0x2d70d5==='string'&&!_0x2d70d5['includes']('ID:')&&!/^[a-zA-Z0-9]{20,}$/['test'](_0x2d70d5));if(_0x10b369)return _0x4ab912;let _0x19c18e=null;if(_0x1c9244[_0x213679(0x14c)])_0x19c18e=_0x1c9244['userId'];else _0x1c9244['player']&&/^[A-Za-z0-9]{20,}$/[_0x213679(0x123)](_0x1c9244[_0x213679(0x10c)])&&(_0x19c18e=_0x1c9244['player']);if(!_0x19c18e)return _0x4ab912;try{const _0x1f6651=await getDoc(doc(db,'players',_0x19c18e));if(_0x1f6651['exists']()){const _0x5c1d38=_0x1f6651['data']();if(_0x5c1d38['username'])return _0x4ab912['resolvedName']=_0x5c1d38['username'],_0x4ab912;}const _0x13b0b6=await getDocs(query(collection(db,'approvedMatches'),where('winnerId','==',_0x19c18e),orderBy('date','desc'),limit(0x1)));if(!_0x13b0b6['empty']){const _0x16dea5=_0x13b0b6['docs'][0x0]['data']();if(_0x16dea5[_0x213679(0x11b)])return _0x4ab912['resolvedName']=_0x16dea5[_0x213679(0x11b)],_0x4ab912;}const _0x309a45=await getDocs(query(collection(db,_0x213679(0xf8)),where('loserId','==',_0x19c18e),orderBy('date',_0x213679(0x14b)),limit(0x1)));if(!_0x309a45[_0x213679(0x10e)]){const _0x5f3a25=_0x309a45['docs'][0x0]['data']();if(_0x5f3a25['loserUsername'])return _0x4ab912['resolvedName']=_0x5f3a25[_0x213679(0x146)],console['log']('Resolved\x20'+_0x19c18e+'\x20to\x20'+_0x5f3a25['loserUsername']+_0x213679(0x13e)),_0x4ab912;}}catch(_0xc4edcb){console['error']('Error\x20resolving\x20user\x20ID:',_0xc4edcb);}return console['warn'](_0x213679(0x13c)+_0x19c18e),_0x4ab912;}['showRankChangeLightbox'](_0x342274,_0x376afd){const _0x20e956=a42_0x149116;let _0x5d061b=document['getElementById']('rankChangeModal');!_0x5d061b&&(_0x5d061b=document[_0x20e956(0x14f)]('div'),_0x5d061b['id']='rankChangeModal',_0x5d061b[_0x20e956(0x14e)]=_0x20e956(0x11d)+_0x342274,document['body']['appendChild'](_0x5d061b));const _0x41946a=_0x342274==='promotion'?'Congratulations!':'Rank\x20Update',_0xfa4714=_0x342274==='promotion'?_0x20e956(0x141):'You\x27ve\x20been\x20demoted\x20to';_0x5d061b['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rank-change-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2\x20class=\x22rank-change-title\x22>'+_0x41946a+'</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>'+_0xfa4714+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22rank-name\x22>'+_0x376afd+'</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22rank-change-button\x22\x20id=\x22rank-change-ok-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Got\x20it!\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x5d061b['style'][_0x20e956(0x103)]='flex',document['getElementById']('rank-change-ok-btn')[_0x20e956(0x145)]('click',()=>{const _0x489156=_0x20e956;_0x5d061b['style']['display']=_0x489156(0x127);}),_0x5d061b['addEventListener'](_0x20e956(0x132),_0x2ce48b=>{const _0x33e3ea=_0x20e956;_0x2ce48b['target']===_0x5d061b&&(_0x5d061b['style']['display']=_0x33e3ea(0x127));});}async['checkAndRecordPromotion'](_0x38cc5c,_0x16809b,_0x4d5618,_0x3c313f={}){const _0x22594e=a42_0x149116;try{if(_0x16809b===_0x4d5618||!_0x38cc5c)return null;const _0x4a0afb=_0x3c313f['source']||_0x22594e(0xf7),_0x48fde0=_0x3c313f[_0x22594e(0x138)]||null,_0x5ccc94=_0x3c313f[_0x22594e(0x10d)]||null;console[_0x22594e(0x116)]('Processing\x20potential\x20rank\x20change:\x20'+_0x4d5618+_0x22594e(0x10a)+_0x16809b+'\x20(source:\x20'+_0x4a0afb+')');let _0x497fe0=null,_0x97a424=null;try{const _0x1a2671=await getDoc(doc(db,'players',_0x38cc5c));if(_0x1a2671[_0x22594e(0x159)]()){const _0x1df0cc=_0x1a2671[_0x22594e(0x134)]();_0x497fe0=_0x1df0cc['username']||_0x1df0cc[_0x22594e(0x158)]||null,_0x97a424=_0x1df0cc['displayName']||_0x1df0cc[_0x22594e(0x10f)]||null;}!_0x497fe0&&_0x3c313f['username']&&(_0x497fe0=_0x3c313f['username'],_0x97a424=_0x3c313f[_0x22594e(0x10f)]);!_0x497fe0&&auth['currentUser']&&(_0x497fe0=auth[_0x22594e(0x121)]['displayName']||auth['currentUser']['email']['split']('@')[0x0],_0x97a424=auth['currentUser'][_0x22594e(0x158)]||null);if(!_0x497fe0){const _0x202968=query(collection(db,'approvedMatches'),where('winnerId','==',_0x38cc5c),limit(0x1)),_0x23f1f3=await getDocs(_0x202968);if(!_0x23f1f3['empty'])_0x497fe0=_0x23f1f3['docs'][0x0][_0x22594e(0x134)]()['winnerUsername']||'Unknown\x20Player',_0x97a424=_0x497fe0;else{const _0x53a19b=query(collection(db,'approvedMatches'),where('loserId','==',_0x38cc5c),limit(0x1)),_0x379f80=await getDocs(_0x53a19b);!_0x379f80[_0x22594e(0x10e)]&&(_0x497fe0=_0x379f80[0x0]['data']()['loserUsername']||'Unknown\x20Player',_0x97a424=_0x497fe0);}}}catch(_0x19638f){console['error']('Error\x20resolving\x20username:',_0x19638f);}!_0x497fe0&&(console['warn']('Could\x20not\x20resolve\x20username\x20for\x20userId:',_0x38cc5c),_0x497fe0='A\x20player',_0x97a424='Unknown\x20Player');const _0x2aaedb=this['getRankName'](_0x4d5618),_0x5a2b4a=this['getRankName'](_0x16809b);if(_0x2aaedb!==_0x5a2b4a){const _0x5c529f=_0x16809b>_0x4d5618,_0x20af0a=_0x5c529f?'promotion':'demotion',_0x25fdba=_0x5a2b4a;console['log']('Recording\x20'+_0x20af0a+'\x20for\x20'+_0x497fe0+':\x20'+_0x4d5618+'\x20('+_0x2aaedb+_0x22594e(0x156)+_0x16809b+'\x20('+_0x5a2b4a+')');try{const _0x1c1c40={'player':_0x497fe0,'playerUsername':_0x497fe0,'username':_0x497fe0,'displayName':_0x97a424,'userId':_0x38cc5c,'type':_0x20af0a,'rankAchieved':_0x25fdba,'timestamp':serverTimestamp(),'previousElo':_0x4d5618,'newElo':_0x16809b,'change':_0x16809b-_0x4d5618,'previousRank':_0x2aaedb,'newRank':_0x5a2b4a,'source':_0x4a0afb};if(_0x4a0afb===_0x22594e(0x105)&&_0x48fde0)_0x1c1c40['matchId']=_0x48fde0;else _0x4a0afb==='admin'&&_0x5ccc94?(_0x1c1c40['modifiedBy']=_0x5ccc94,_0x1c1c40['isAutomatic']=![]):_0x1c1c40[_0x22594e(0x12c)]=!![];const _0x48d049=writeBatch(db),_0xba6185=doc(collection(db,'eloHistory')),_0x29133f=doc(collection(db,_0x22594e(0x131)));return _0x48d049['set'](_0xba6185,_0x1c1c40),_0x48d049['set'](_0x29133f,_0x1c1c40),await _0x48d049['commit'](),await this['sendPromotionNotification'](_0x38cc5c,_0x497fe0,_0x4d5618,_0x16809b,_0x2aaedb,_0x5a2b4a,_0x20af0a,{'displayName':_0x97a424,'source':_0x4a0afb,'matchId':_0x48fde0,'ladder':_0x3c313f['ladder']||'D1'}),console['log'](_0x22594e(0x130)+_0x20af0a+'\x20for\x20'+_0x497fe0+'\x20to\x20'+_0x25fdba),_0x25fdba;}catch(_0x1fb1b6){console['error']('Error\x20writing\x20promotion\x20records:',_0x1fb1b6);try{return await addDoc(collection(db,_0x22594e(0x129)),{'player':_0x497fe0,'playerUsername':_0x497fe0,'username':_0x497fe0,'displayName':_0x97a424,'userId':_0x38cc5c,'type':_0x20af0a,'rankAchieved':_0x25fdba,'timestamp':serverTimestamp(),'previousElo':_0x4d5618,'newElo':_0x16809b,'change':_0x16809b-_0x4d5618,'previousRank':_0x2aaedb,'source':_0x4a0afb,'isAutomatic':_0x4a0afb!=='admin'}),await this[_0x22594e(0x115)](_0x38cc5c,_0x497fe0,_0x4d5618,_0x16809b,_0x2aaedb,_0x5a2b4a,_0x20af0a,{'displayName':_0x97a424,'source':_0x4a0afb,'matchId':_0x48fde0,'ladder':_0x3c313f['ladder']||'D1'}),_0x25fdba;}catch(_0x250645){return console['error']('Fallback\x20write\x20failed:',_0x250645),null;}}}return null;}catch(_0x5ee821){return console[_0x22594e(0x109)]('Error\x20in\x20promotion/demotion\x20recording:',_0x5ee821),null;}}['getRankName'](_0x5a6e6d){const _0x5e9fe5=a42_0x149116;for(let _0x56ff20=this['RANKS']['length']-0x1;_0x56ff20>=0x0;_0x56ff20--){if(_0x5a6e6d>=this['RANKS'][_0x56ff20]['threshold'])return this[_0x5e9fe5(0x110)][_0x56ff20]['name'];}return _0x5e9fe5(0x12b);}[a42_0x149116(0xfc)](){const _0x6124ca=a42_0x149116;this[_0x6124ca(0x153)]&&clearInterval(this['pollingInterval']);}['isNewRankChange'](_0x55e6d0){const _0x1a6860=a42_0x149116;if(_0x55e6d0['timestamp']){const _0x5052d1=_0x55e6d0['timestamp']['seconds']*0x3e8,_0x1e5bed=Date['now'](),_0x4b5298=(_0x1e5bed-_0x5052d1)/(0x3e8*0x3c*0x3c);if(_0x4b5298>0x18)return![];}if(_0x55e6d0['previousRank']&&_0x55e6d0['newRank']&&_0x55e6d0[_0x1a6860(0x13f)]!==_0x55e6d0['newRank'])return!![];return![];}async[a42_0x149116(0x115)](_0x379a32,_0x46a275,_0x259043,_0x461765,_0x3413be,_0x2e745d,_0x3f01c6,_0x58e9f6={}){const _0x76285a=a42_0x149116;try{console['log']('STARTING\x20notification\x20for\x20'+_0x46a275+'\x27s\x20'+_0x3f01c6);const _0xac5301={'userId':_0x379a32,'username':_0x46a275,'displayName':_0x58e9f6['displayName']||_0x46a275,'oldElo':parseInt(_0x259043),'newElo':parseInt(_0x461765),'eloDifference':parseInt(_0x461765)-parseInt(_0x259043),'oldRank':_0x3413be,'newRank':_0x2e745d,'type':_0x3f01c6,'timestamp':serverTimestamp(),'processed':![],'source':_0x58e9f6['source']||'automatic','matchId':_0x58e9f6['matchId']||null,'ladder':_0x58e9f6['ladder']||'D1','adminUser':_0x58e9f6['adminUser']||null};console['log']('Creating\x20Discord\x20notification:',_0xac5301);const _0x72031f=await addDoc(collection(db,_0x76285a(0x136)),_0xac5301);return console[_0x76285a(0x116)](_0x76285a(0x111)+_0x72031f['id']),!![];}catch(_0x2c7148){return console[_0x76285a(0x109)]('Error\x20sending\x20Discord\x20notification:',_0x2c7148),![];}}}export const promotionManager=new PromotionManager();document['addEventListener']('DOMContentLoaded',()=>{const _0x369b9e=a42_0x149116;promotionManager[_0x369b9e(0x147)]();});export const initializePromotionTracker=()=>promotionManager['initialize']();export const checkAndRecordPromotion=(_0x53aa9d,_0xd6afe5,_0x15a2f6,_0x54d7e9)=>promotionManager[a42_0x149116(0x122)](_0x53aa9d,_0xd6afe5,_0x15a2f6,_0x54d7e9);function a42_0x1f9a(_0x5d3751,_0x2a89e8){const _0x4b24b3=a42_0xd4c2();return a42_0x1f9a=function(_0x55b8b3,_0x4000b5){_0x55b8b3=_0x55b8b3-0xf7;let _0xd4c2c0=_0x4b24b3[_0x55b8b3];return _0xd4c2c0;},a42_0x1f9a(_0x5d3751,_0x2a89e8);}export const getRankName=_0x220cb3=>promotionManager['getRankName'](_0x220cb3);
const a38A=a38b;function a38b(a,b){const c=a38a();return a38b=function(d,e){d=d-0xcc;let f=c[d];if(a38b['zIBpwk']===undefined){var g=function(l){const m='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let n='',o='';for(let p=0x0,q,r,s=0x0;r=l['charAt'](s++);~r&&(q=p%0x4?q*0x40+r:r,p++%0x4)?n+=String['fromCharCode'](0xff&q>>(-0x2*p&0x6)):0x0){r=m['indexOf'](r);}for(let t=0x0,u=n['length'];t<u;t++){o+='%'+('00'+n['charCodeAt'](t)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(o);};a38b['obIXmA']=g,a=arguments,a38b['zIBpwk']=!![];}const h=c[0x0],i=d+h,j=a[i];return!j?(f=a38b['obIXmA'](f),a[i]=f):f=j,f;},a38b(a,b);}(function(a,b){const z=a38b,c=a();while(!![]){try{const d=-parseInt(z(0xe4))/0x1*(parseInt(z(0xcd))/0x2)+-parseInt(z(0xdb))/0x3+parseInt(z(0xe7))/0x4*(parseInt(z(0xf8))/0x5)+parseInt(z(0xfb))/0x6+-parseInt(z(0xf4))/0x7*(-parseInt(z(0xd1))/0x8)+parseInt(z(0xf3))/0x9*(parseInt(z(0xd3))/0xa)+-parseInt(z(0xf2))/0xb*(parseInt(z(0xf1))/0xc);if(d===b)break;else c['push'](c['shift']());}catch(e){c['push'](c['shift']());}}}(a38a,0xb4914));const functions=require(a38A(0xd0)),admin=require('firebase-admin');admin['initializeApp']();function a38a(){const K=['rxjYB3iGDxbKyxrPBMCGBwvTyMvYCYbSAxn0oG','mtCWmJGWmgXvwuLcza','CgXHEwvYCW','zMLYzxn0B3jL','AgfZ','nZqXmgXHyKDgtq','AxnoB25qyxj0AwnPCgfUDa','C3rHDhvZ','zMLYzwjHC2uTzNvUy3rPB25Z','mtiYodG4Cu5PDgrr','DxbKyxrLtwvTyMvYC0XPC3q','mtm3mJyWndbQrKLqEey','CgXHEwvYC0qZ','zxjYB3i','yNjVBNPL','C2v0','E2nVBgXLy3rPB259l3TKB2njzh0','Aw5JBhvKzxm','zM9YrwfJAa','odu3mZC5zxfVywT0','Dw5Yyw5Rzwq','DxnLCM5HBwu','ywDNCMvNyxrLze1LBwjLCNm','rxjYB3iGCMvIDwLSzgLUzYbTzw1IzxjZigXPC3q','zgf0yq','ywXS','CMvIDwLSze1LBwjLCNnmAxn0twfUDwfS','CgfYyw1Z','mJmWAM9gzwv4','C2vUza','zwXV','nZz3Exrzuxa','ChvZAa','twvTyMvYCYbSAxn0ihjLyNvPBhqGC3vJy2vZC2z1BgX5','BgfKzgvY','zw1LCMfSza','zMf2B3jPDgvxzwfWB24','zwXVuMf0Aw5N','y291BNrYEq','z2v0','y29SBgvJDgLVBG','mJC2mdy5mZzRC1DHAwy','mtfwBLfSwgS','ovr1Eu5bAa','ndKWre1nDK51','CgXHEwvYC0qY','BgvUz3rO','Bg9N','mZGWnJq1wxHoDvvH','yMf0y2G'];a38a=function(){return K;};return a38a();}const db=admin[a38A(0xfd)]();exports[a38A(0xd2)]=functions['firestore']['document'](a38A(0xd8))['onWrite'](async(a,b)=>{const B=a38A,c=b[B(0xe3)]['collection'],d=b[B(0xe3)]['docId'];if(!['players','playersD2',B(0xd4),'userProfiles','nonParticipants'][B(0xd9)](c))return null;try{await rebuildMembersList(),console[B(0xf7)]('Successfully\x20updated\x20aggregated\x20members\x20list');}catch(e){console[B(0xd5)](B(0xfa),e);}});async function rebuildMembersList(){const C=a38A,a=db[C(0xf9)](),[b,c,d,e,f]=await Promise[C(0xe1)]([db[C(0xf0)]('userProfiles')[C(0xef)](),db[C(0xf0)](C(0xfc))[C(0xef)](),db[C(0xf0)](C(0xf5))[C(0xef)](),db['collection'](C(0xd4))[C(0xef)](),db['collection']('nonParticipants')[C(0xef)]()]),g=new Map();b['forEach'](q=>{const D=C;g['set'](q['id'],q[D(0xe0)]());});const h=new Map(),j=(q,r)=>{q['forEach'](s=>{const E=a38b,t=s[E(0xe0)](),u=s['id'];!h[E(0xcc)](u)&&h[E(0xd7)](u,{'userId':u,'username':t['username']||'Unknown','ladders':[],'isNonParticipant':![]});const v=h[E(0xef)](u);v['ladders'][E(0xe8)]({'ladder':r,'elo':t[E(0xed)]||0x4b0,'active':t['active']!==![]});});};j(c,'D1'),j(d,'D2'),j(e,'D3'),f['forEach'](q=>{const F=C,r=q['data'](),s=q['id'];!h[F(0xcc)](s)&&r['username']&&h['set'](s,{'userId':s,'username':r[F(0xdd)],'ladders':[],'isNonParticipant':!![]});});const k=[];h[C(0xda)]((q,r)=>{const G=C,s=g['get'](r)||{};let t=0x0,u=null;if(q['ladders']['length']>0x0){const w=q['ladders']['sort']((x,y)=>y[G(0xe6)]-x['elo']);t=w[0x0]['elo'],u=w[0x0][G(0xea)];}const v={'userId':r,'username':q['username'],'profileImageUrl':s['profileImageUrl']||null,'country':s[G(0xee)]||null,'motto':s['motto']||null,'favoriteMap':s['favoriteMap']||null,'favoriteWeapon':s[G(0xec)]||null,'isNonParticipant':q[G(0xce)],'ladders':q['ladders'],'primaryLadder':u,'highestElo':t,'rank':getPlayerRank(t),'lastUpdated':admin['firestore']['FieldValue']['serverTimestamp']()};k['push'](v);});const l=db[C(0xf0)](C(0xde)),m=await l['get'](),n=[];m[C(0xda)](q=>{n['push'](q['ref']['delete']());}),await Promise['all'](n);const o=0x1f4,p=[];for(let q=0x0;q<k[C(0xf6)];q+=o){const r=db['batch'](),s=k['slice'](q,q+o);s[C(0xda)](t=>{const H=C,u=l['doc'](t['userId']);r[H(0xd7)](u,t);}),p['push'](r['commit']());}await Promise[C(0xe1)](p);}function getPlayerRank(a){const I=a38A;if(a>=0x7d0)return I(0xeb);if(a>=0x708)return'gold';if(a>=0x640)return'silver';if(a>=0x578)return I(0xd6);return I(0xdc);}exports[a38A(0xe2)]=functions['https']['onRequest'](async(a,b)=>{const J=a38A;try{await rebuildMembersList(),b['status'](0xc8)[J(0xe5)](J(0xe9));}catch(c){console[J(0xd5)]('Error\x20rebuilding\x20members\x20list:',c),b[J(0xcf)](0x1f4)[J(0xe5)](J(0xdf));}});
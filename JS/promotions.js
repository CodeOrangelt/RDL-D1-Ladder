const a46_0x571b2b=a46_0x4b76,a46_0x7a55a1=(function(){let _0x283b0b=!![];return function(_0x2eabf3,_0x207650){const _0x4d795a=_0x283b0b?function(){if(_0x207650){const _0x38be9b=_0x207650['apply'](_0x2eabf3,arguments);return _0x207650=null,_0x38be9b;}}:function(){};return _0x283b0b=![],_0x4d795a;};}()),a46_0x26cd7e=a46_0x7a55a1(this,function(){const _0x23d254=a46_0x4b76,_0x5d7c60=function(){let _0x1de566;try{_0x1de566=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x32c891){_0x1de566=window;}return _0x1de566;},_0x3e665b=_0x5d7c60(),_0x325b0e=_0x3e665b['console']=_0x3e665b['console']||{},_0x5d0ac4=['log','warn',_0x23d254(0x1c7),'error','exception','table','trace'];for(let _0x37fe88=0x0;_0x37fe88<_0x5d0ac4['length'];_0x37fe88++){const _0x276898=a46_0x7a55a1['constructor'][_0x23d254(0x1f4)][_0x23d254(0x1c4)](a46_0x7a55a1),_0x4f2ba7=_0x5d0ac4[_0x37fe88],_0x195ca3=_0x325b0e[_0x4f2ba7]||_0x276898;_0x276898['__proto__']=a46_0x7a55a1['bind'](a46_0x7a55a1),_0x276898['toString']=_0x195ca3['toString']['bind'](_0x195ca3),_0x325b0e[_0x4f2ba7]=_0x276898;}});a46_0x26cd7e();import{collection,doc,query,where,orderBy,limit,getDocs,addDoc,getDoc,serverTimestamp,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{auth,db}from'./firebase-config.js';class PromotionManager{constructor(){const _0x2d3f05=a46_0x4b76;this[_0x2d3f05(0x1fa)]=0x18,this[_0x2d3f05(0x1e9)]=[{'threshold':0x578,'name':'Bronze','color':'#CD7F32'},{'threshold':0x640,'name':'Silver','color':_0x2d3f05(0x1d7)},{'threshold':0x708,'name':_0x2d3f05(0x1e2),'color':'#FFD700'},{'threshold':0x834,'name':_0x2d3f05(0x1db),'color':'#50C878'}],this['bannerContainer']=null,this['lastFetchTime']=0x0,this[_0x2d3f05(0x1df)]=0xea60,this['pollingInterval']=null,this['usernameCache']={};}['initialize'](){const _0x4713a0=a46_0x4b76;this[_0x4713a0(0x20a)]=document['getElementById']('promotion-banner-container');if(!this[_0x4713a0(0x20a)]){console['error']('Promotion\x20banner\x20container\x20not\x20found');return;}this['setupBannerContainer']();const _0x4360b4=_0x4713a0(0x1c9)+new Date()['toDateString'](),_0x19cbd1=sessionStorage[_0x4713a0(0x216)](_0x4360b4);!_0x19cbd1&&(this['fetchRecentPromotions'](),sessionStorage['setItem'](_0x4360b4,'true')),document['addEventListener']('visibilitychange',()=>{const _0x3973c0=_0x4713a0;document['visibilityState']==='visible'&&!sessionStorage[_0x3973c0(0x216)](_0x4360b4)&&(this['fetchRecentPromotions'](),sessionStorage['setItem'](_0x4360b4,'true'));}),window['addEventListener']('beforeunload',()=>{const _0x27fda9=_0x4713a0;this['pollingInterval']&&clearInterval(this[_0x27fda9(0x219)]);});}['setupBannerContainer'](){const _0x165894=a46_0x4b76;this[_0x165894(0x20a)]['innerHTML']='',this['bannerContainer']['style']['display']='none';}async['fetchRecentPromotions'](){const _0x11c95e=a46_0x4b76;try{const _0x4e0f84=Date['now']();if(_0x4e0f84-this['lastFetchTime']<this[_0x11c95e(0x1df)])return;this['lastFetchTime']=_0x4e0f84;const _0x8abc47=collection(db,'eloHistory'),_0x2e9dfc=query(_0x8abc47,where('type','in',['promotion',_0x11c95e(0x1e0)]),orderBy('timestamp','desc'),limit(0x14)),_0x225301=await getDocs(_0x2e9dfc),_0x45f276=[];_0x225301[_0x11c95e(0x1dd)](_0x8201f0=>{const _0x19b78c=_0x11c95e,_0x40f81c={'id':_0x8201f0['id'],..._0x8201f0['data']()};this[_0x19b78c(0x1fd)](_0x8201f0['id'])&&this['isNewRankChange'](_0x40f81c)&&_0x45f276['push'](_0x40f81c);}),_0x45f276['length']>0x0&&await this[_0x11c95e(0x1f2)](_0x45f276);}catch(_0x1e8b90){console['error']('Error\x20fetching\x20promotions:',_0x1e8b90);}}async[a46_0x571b2b(0x1f2)](_0x2e0021){const _0x1163bb=a46_0x571b2b;if(_0x2e0021[_0x1163bb(0x210)]===0x0)return;_0x2e0021['sort']((_0x300b86,_0x275d56)=>{const _0x231f51=_0x300b86['timestamp']?.['toMillis']?.()||_0x300b86['timestamp']?.['seconds']*0x3e8||0x0,_0xcdc215=_0x275d56['timestamp']?.['toMillis']?.()||_0x275d56['timestamp']?.['seconds']*0x3e8||0x0;return _0xcdc215-_0x231f51;});const _0x111c41=this[_0x1163bb(0x20a)][_0x1163bb(0x1ca)]['length'],_0x1922f7=0x3-_0x111c41;if(_0x1922f7<=0x0)return;const _0x2d584a=_0x2e0021['slice'](0x0,_0x1922f7);for(let _0x28386f=0x0;_0x28386f<_0x2d584a['length'];_0x28386f++){const _0x549780=_0x2d584a[_0x28386f],_0x13a5fb=auth[_0x1163bb(0x202)];try{setTimeout(()=>{const _0x3fecab=_0x1163bb;this[_0x3fecab(0x1cc)](_0x549780);},_0x28386f*0x3e8),_0x13a5fb&&_0x549780[_0x1163bb(0x205)]===_0x13a5fb[_0x1163bb(0x1dc)]&&this['showRankChangeLightbox'](_0x549780['type'],_0x549780['rankAchieved']);}catch(_0x3437aa){console['error']('Error\x20processing\x20rank\x20change:',_0x3437aa);}}}['shouldShowPromotion'](_0xf7d3a6){const _0x5e3ea7=a46_0x571b2b;try{const _0x3bee61=_0x5e3ea7(0x1d2)+_0xf7d3a6,_0x2e5c13=localStorage['getItem'](_0x3bee61);if(_0x2e5c13){let _0x1aca42;try{_0x1aca42=JSON['parse'](_0x2e5c13);}catch(_0x5245ee){return console['warn']('Invalid\x20storage\x20format\x20for\x20'+_0x3bee61+_0x5e3ea7(0x1d4)),!![];}if(_0x1aca42['ignored']===!![])return console[_0x5e3ea7(0x1d5)]('Promotion\x20'+_0xf7d3a6+_0x5e3ea7(0x1f5)),![];const _0xb26c73=Date['now']();if(_0x1aca42['userDismissed']&&_0xb26c73-_0x1aca42['timestamp']<this['DISPLAY_HOURS']*0x3c*0x3c*0x3e8)return console['log'](_0x5e3ea7(0x20d)+_0xf7d3a6+_0x5e3ea7(0x1ce)+this[_0x5e3ea7(0x1fa)]+'\x20hours'),![];if(_0x1aca42[_0x5e3ea7(0x1ff)]&&_0xb26c73-_0x1aca42[_0x5e3ea7(0x217)]<0x4*0x3c*0x3c*0x3e8)return console[_0x5e3ea7(0x1d5)]('Promotion\x20'+_0xf7d3a6+'\x20was\x20auto-dismissed\x20within\x20last\x204\x20hours'),![];}return!![];}catch(_0x5b4948){return console[_0x5e3ea7(0x1d8)]('Error\x20checking\x20promotion\x20visibility:',_0x5b4948),![];}}['ignorePromotion'](_0x51aa0c){const _0x47e041=a46_0x571b2b;try{const _0x5f277b=_0x47e041(0x1d2)+_0x51aa0c;localStorage['setItem'](_0x5f277b,JSON['stringify']({'timestamp':Date['now'](),'ignored':!![]}));}catch(_0x12d60d){console[_0x47e041(0x1d8)]('Error\x20saving\x20promotion\x20preference:',_0x12d60d);}}[a46_0x571b2b(0x1cc)](_0x1b53ac){this['resolveUserId'](_0x1b53ac)['then'](_0x499e0c=>{const _0x5a4e62=a46_0x4b76,_0xb2e04b=_0x5a4e62(0x1d2)+_0x1b53ac['id'],_0x1f4258=localStorage['getItem'](_0xb2e04b);if(_0x1f4258)try{const _0x34df9a=JSON['parse'](_0x1f4258);if(_0x34df9a['ignored']===!![]){console['log']('Skipping\x20ignored\x20promotion:\x20'+_0x1b53ac['id']);return;}}catch(_0x35ed39){}localStorage['setItem'](_0xb2e04b,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':![],'seenAt':Date['now']()})),this[_0x5a4e62(0x20a)]['style']['display']=_0x5a4e62(0x1c6);while(this['bannerContainer'][_0x5a4e62(0x1ca)]['length']>=0x3){this['bannerContainer']['removeChild'](this['bannerContainer']['firstChild']);}const _0x1d60a0=document['createElement']('div');_0x1d60a0[_0x5a4e62(0x20b)]='promotion-banner',_0x1d60a0[_0x5a4e62(0x201)]('data-rank',_0x499e0c['rankAchieved']),_0x1d60a0[_0x5a4e62(0x201)]('data-id',_0x499e0c['id']);const _0x30c1e2=document[_0x5a4e62(0x1f8)](_0x5a4e62(0x1f1));_0x30c1e2['className']=_0x5a4e62(0x1e8);const _0x5320c4=_0x499e0c['resolvedName']||_0x499e0c['player']||_0x499e0c['username']||_0x499e0c['playerUsername']||_0x499e0c[_0x5a4e62(0x1dc)]||'A\x20player',_0x973375=_0x499e0c[_0x5a4e62(0x1e1)]==='promotion'?_0x5320c4+'\x20was\x20promoted\x20to':_0x5320c4+'\x20was\x20demoted\x20to';_0x30c1e2['innerHTML']=_0x973375+'\x20<span\x20class=\x22rank-text\x22>'+_0x499e0c['rankAchieved']+'</span>';const _0x461111=document['createElement']('div');_0x461111['className']='banner-actions';const _0x5e0b8a=document['createElement']('button');_0x5e0b8a['className']=_0x5a4e62(0x1d1),_0x5e0b8a['innerHTML']=_0x5a4e62(0x21b),_0x5e0b8a['title']='Dismiss';const _0x42b254=document['createElement']('button');_0x42b254['className']='ignore-btn',_0x42b254[_0x5a4e62(0x1e3)]=_0x5a4e62(0x1da),_0x42b254['title']='Never\x20show\x20this\x20promotion\x20again',_0x461111[_0x5a4e62(0x1d9)](_0x42b254),_0x461111['appendChild'](_0x5e0b8a),_0x1d60a0['appendChild'](_0x30c1e2),_0x1d60a0['appendChild'](_0x461111),this['bannerContainer'][_0x5a4e62(0x1d9)](_0x1d60a0),void _0x1d60a0[_0x5a4e62(0x1fc)],setTimeout(()=>{_0x1d60a0['classList']['add']('new-rank-change');},0x32),_0x5e0b8a[_0x5a4e62(0x21a)]('click',()=>{const _0x8c2fb1=_0x5a4e62;localStorage[_0x8c2fb1(0x208)](_0xb2e04b,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':!![],'systemDismissed':![]})),_0x1d60a0[_0x8c2fb1(0x1c8)]['remove']('new-rank-change'),_0x1d60a0['classList']['add']('dismissing'),setTimeout(()=>{const _0x21a15e=_0x8c2fb1;_0x1d60a0[_0x21a15e(0x21e)]&&(_0x1d60a0['remove'](),this['bannerContainer']['children'][_0x21a15e(0x210)]===0x0&&(this['bannerContainer'][_0x21a15e(0x1fb)][_0x21a15e(0x220)]='none'));},0x1f4);}),_0x42b254[_0x5a4e62(0x21a)]('click',()=>{const _0x249f52=_0x5a4e62;localStorage[_0x249f52(0x208)](_0xb2e04b,JSON['stringify']({'timestamp':Date[_0x249f52(0x1fe)](),'ignored':!![],'userDismissed':!![],'systemDismissed':![]})),_0x1d60a0['classList']['remove']('new-rank-change'),_0x1d60a0['classList']['add']('dismissing'),setTimeout(()=>{const _0x5a8654=_0x249f52;_0x1d60a0[_0x5a8654(0x21e)]&&(_0x1d60a0['remove'](),this['bannerContainer'][_0x5a8654(0x1ca)]['length']===0x0&&(this[_0x5a8654(0x20a)][_0x5a8654(0x1fb)]['display']=_0x5a8654(0x21c)));},0x1f4);}),setTimeout(()=>{const _0x692b8d=_0x5a4e62;_0x1d60a0['parentNode']&&(_0x1d60a0[_0x692b8d(0x1c8)]['remove']('new-rank-change'),_0x1d60a0['classList']['add']('dismissing'),localStorage['setItem'](_0xb2e04b,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':!![]})),setTimeout(()=>{const _0x47e8f4=_0x692b8d;_0x1d60a0['parentNode']&&(_0x1d60a0[_0x47e8f4(0x221)](),this[_0x47e8f4(0x20a)][_0x47e8f4(0x1ca)]['length']===0x0&&(this['bannerContainer'][_0x47e8f4(0x1fb)]['display']='none'));},0x1f4));},0x3a98);});}async[a46_0x571b2b(0x1cd)](_0x2fee56){const _0x16afea=a46_0x571b2b,_0x40edd8={..._0x2fee56},_0x42d261=[_0x2fee56['player'],_0x2fee56['username'],_0x2fee56['playerUsername'],_0x2fee56[_0x16afea(0x1dc)]],_0x37d6c0=_0x42d261['some'](_0x35cf21=>_0x35cf21&&typeof _0x35cf21==='string'&&!_0x35cf21['includes'](_0x16afea(0x200))&&!/^[a-zA-Z0-9]{20,}$/['test'](_0x35cf21));if(_0x37d6c0)return _0x40edd8;let _0x58ad19=null;if(_0x2fee56['userId'])_0x58ad19=_0x2fee56['userId'];else _0x2fee56['player']&&/^[A-Za-z0-9]{20,}$/['test'](_0x2fee56['player'])&&(_0x58ad19=_0x2fee56['player']);if(!_0x58ad19)return _0x40edd8;try{const _0xdc6c2c=await getDoc(doc(db,_0x16afea(0x1e5),_0x58ad19));if(_0xdc6c2c['exists']()){const _0x3a8667=_0xdc6c2c['data']();if(_0x3a8667['username'])return _0x40edd8[_0x16afea(0x1cb)]=_0x3a8667[_0x16afea(0x1f6)],_0x40edd8;}const _0x3e642f=await getDocs(query(collection(db,'approvedMatches'),where('winnerId','==',_0x58ad19),orderBy('date','desc'),limit(0x1)));if(!_0x3e642f[_0x16afea(0x215)]){const _0x5b655a=_0x3e642f[_0x16afea(0x1eb)][0x0]['data']();if(_0x5b655a['winnerUsername'])return _0x40edd8[_0x16afea(0x1cb)]=_0x5b655a[_0x16afea(0x1f9)],_0x40edd8;}const _0x22f0f4=await getDocs(query(collection(db,'approvedMatches'),where('loserId','==',_0x58ad19),orderBy('date',_0x16afea(0x1f0)),limit(0x1)));if(!_0x22f0f4['empty']){const _0x2cc376=_0x22f0f4['docs'][0x0]['data']();if(_0x2cc376['loserUsername'])return _0x40edd8['resolvedName']=_0x2cc376['loserUsername'],console[_0x16afea(0x1d5)](_0x16afea(0x211)+_0x58ad19+'\x20to\x20'+_0x2cc376['loserUsername']+_0x16afea(0x21f)),_0x40edd8;}}catch(_0x2a8ed9){console['error']('Error\x20resolving\x20user\x20ID:',_0x2a8ed9);}return console[_0x16afea(0x213)]('Failed\x20to\x20resolve\x20user\x20ID:\x20'+_0x58ad19),_0x40edd8;}['showRankChangeLightbox'](_0x38dfdd,_0x4989c5){const _0x280481=a46_0x571b2b;let _0x3687ed=document['getElementById'](_0x280481(0x209));!_0x3687ed&&(_0x3687ed=document[_0x280481(0x1f8)](_0x280481(0x1f1)),_0x3687ed['id']=_0x280481(0x209),_0x3687ed['className']=_0x280481(0x1de)+_0x38dfdd,document[_0x280481(0x1e4)][_0x280481(0x1d9)](_0x3687ed));const _0x1d896f=_0x38dfdd==='promotion'?'Congratulations!':'Rank\x20Update',_0x39189c=_0x38dfdd==='promotion'?'You\x27ve\x20been\x20promoted\x20to':'You\x27ve\x20been\x20demoted\x20to';_0x3687ed['innerHTML']=_0x280481(0x20c)+_0x1d896f+'</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>'+_0x39189c+_0x280481(0x204)+_0x4989c5+'</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22rank-change-button\x22\x20id=\x22rank-change-ok-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Got\x20it!\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x3687ed['style']['display']='flex',document['getElementById'](_0x280481(0x1f7))[_0x280481(0x21a)]('click',()=>{_0x3687ed['style']['display']='none';}),_0x3687ed['addEventListener']('click',_0x209a57=>{const _0x1b3e20=_0x280481;_0x209a57['target']===_0x3687ed&&(_0x3687ed['style'][_0x1b3e20(0x220)]=_0x1b3e20(0x21c));});}async['checkAndRecordPromotion'](_0x368566,_0x4be4aa,_0x2c2005,_0x36545e={}){const _0x2fbb3a=a46_0x571b2b;try{if(_0x4be4aa===_0x2c2005||!_0x368566)return null;const _0x87a65b=_0x36545e[_0x2fbb3a(0x1f3)]||'automatic',_0x16e619=_0x36545e['matchId']||null,_0x4faa96=_0x36545e['adminUser']||null;console['log'](_0x2fbb3a(0x1c3)+_0x2c2005+'\x20→\x20'+_0x4be4aa+'\x20(source:\x20'+_0x87a65b+')');let _0x21f5c6=null,_0x5ad27b=null;try{const _0x162cbb=await getDoc(doc(db,'players',_0x368566));if(_0x162cbb[_0x2fbb3a(0x1ea)]()){const _0x133947=_0x162cbb[_0x2fbb3a(0x20f)]();_0x21f5c6=_0x133947['username']||_0x133947['displayName']||null,_0x5ad27b=_0x133947['displayName']||_0x133947['username']||null;}!_0x21f5c6&&_0x36545e['username']&&(_0x21f5c6=_0x36545e['username'],_0x5ad27b=_0x36545e[_0x2fbb3a(0x1f6)]);!_0x21f5c6&&auth[_0x2fbb3a(0x202)]&&(_0x21f5c6=auth['currentUser']['displayName']||auth[_0x2fbb3a(0x202)]['email']['split']('@')[0x0],_0x5ad27b=auth['currentUser']['displayName']||null);if(!_0x21f5c6){const _0x245cc2=query(collection(db,'approvedMatches'),where('winnerId','==',_0x368566),limit(0x1)),_0x18fab5=await getDocs(_0x245cc2);if(!_0x18fab5['empty'])_0x21f5c6=_0x18fab5['docs'][0x0]['data']()['winnerUsername']||'Unknown\x20Player',_0x5ad27b=_0x21f5c6;else{const _0x8474de=query(collection(db,'approvedMatches'),where('loserId','==',_0x368566),limit(0x1)),_0x51acc4=await getDocs(_0x8474de);!_0x51acc4['empty']&&(_0x21f5c6=_0x51acc4[0x0]['data']()['loserUsername']||_0x2fbb3a(0x21d),_0x5ad27b=_0x21f5c6);}}}catch(_0x217184){console['error']('Error\x20resolving\x20username:',_0x217184);}!_0x21f5c6&&(console[_0x2fbb3a(0x213)]('Could\x20not\x20resolve\x20username\x20for\x20userId:',_0x368566),_0x21f5c6='A\x20player',_0x5ad27b='Unknown\x20Player');const _0x45a542=this[_0x2fbb3a(0x1ed)](_0x2c2005),_0xd9c25a=this['getRankName'](_0x4be4aa);if(_0x45a542!==_0xd9c25a){const _0x7b2f22=_0x4be4aa>_0x2c2005,_0x262e33=_0x7b2f22?'promotion':'demotion',_0x5df5b7=_0xd9c25a;console['log']('Recording\x20'+_0x262e33+_0x2fbb3a(0x203)+_0x21f5c6+':\x20'+_0x2c2005+'\x20('+_0x45a542+')\x20→\x20'+_0x4be4aa+'\x20('+_0xd9c25a+')');try{const _0x3a36c8={'player':_0x21f5c6,'playerUsername':_0x21f5c6,'username':_0x21f5c6,'displayName':_0x5ad27b,'userId':_0x368566,'type':_0x262e33,'rankAchieved':_0x5df5b7,'timestamp':serverTimestamp(),'previousElo':_0x2c2005,'newElo':_0x4be4aa,'change':_0x4be4aa-_0x2c2005,'previousRank':_0x45a542,'newRank':_0xd9c25a,'source':_0x87a65b};if(_0x87a65b==='match'&&_0x16e619)_0x3a36c8['matchId']=_0x16e619;else _0x87a65b==='admin'&&_0x4faa96?(_0x3a36c8[_0x2fbb3a(0x1e7)]=_0x4faa96,_0x3a36c8[_0x2fbb3a(0x1d6)]=![]):_0x3a36c8['isAutomatic']=!![];const _0x9206ed=writeBatch(db),_0x1a42da=doc(collection(db,'eloHistory')),_0x302bed=doc(collection(db,'promotionHistory'));return _0x9206ed['set'](_0x1a42da,_0x3a36c8),_0x9206ed[_0x2fbb3a(0x1ec)](_0x302bed,_0x3a36c8),await _0x9206ed[_0x2fbb3a(0x20e)](),await this[_0x2fbb3a(0x206)](_0x368566,_0x21f5c6,_0x2c2005,_0x4be4aa,_0x45a542,_0xd9c25a,_0x262e33,{'displayName':_0x5ad27b,'source':_0x87a65b,'matchId':_0x16e619,'ladder':_0x36545e[_0x2fbb3a(0x1c5)]||'D1'}),console['log']('Successfully\x20recorded\x20'+_0x262e33+_0x2fbb3a(0x203)+_0x21f5c6+'\x20to\x20'+_0x5df5b7),_0x5df5b7;}catch(_0xda4171){console[_0x2fbb3a(0x1d8)](_0x2fbb3a(0x1ef),_0xda4171);try{return await addDoc(collection(db,_0x2fbb3a(0x214)),{'player':_0x21f5c6,'playerUsername':_0x21f5c6,'username':_0x21f5c6,'displayName':_0x5ad27b,'userId':_0x368566,'type':_0x262e33,'rankAchieved':_0x5df5b7,'timestamp':serverTimestamp(),'previousElo':_0x2c2005,'newElo':_0x4be4aa,'change':_0x4be4aa-_0x2c2005,'previousRank':_0x45a542,'source':_0x87a65b,'isAutomatic':_0x87a65b!==_0x2fbb3a(0x1ee)}),await this[_0x2fbb3a(0x206)](_0x368566,_0x21f5c6,_0x2c2005,_0x4be4aa,_0x45a542,_0xd9c25a,_0x262e33,{'displayName':_0x5ad27b,'source':_0x87a65b,'matchId':_0x16e619,'ladder':_0x36545e[_0x2fbb3a(0x1c5)]||'D1'}),_0x5df5b7;}catch(_0x3757a){return console['error']('Fallback\x20write\x20failed:',_0x3757a),null;}}}return null;}catch(_0xcdb43a){return console['error'](_0x2fbb3a(0x222),_0xcdb43a),null;}}[a46_0x571b2b(0x1ed)](_0x470179){const _0x3abc19=a46_0x571b2b;for(let _0x230718=this[_0x3abc19(0x1e9)][_0x3abc19(0x210)]-0x1;_0x230718>=0x0;_0x230718--){if(_0x470179>=this['RANKS'][_0x230718][_0x3abc19(0x212)])return this['RANKS'][_0x230718]['name'];}return'Unranked';}[a46_0x571b2b(0x218)](){this['pollingInterval']&&clearInterval(this['pollingInterval']);}['isNewRankChange'](_0x1ed381){const _0x3c1a6a=a46_0x571b2b;if(_0x1ed381['timestamp']){const _0x6d69b2=_0x1ed381[_0x3c1a6a(0x217)]['seconds']*0x3e8,_0x5bef30=Date['now'](),_0xebfcbf=(_0x5bef30-_0x6d69b2)/(0x3e8*0x3c*0x3c);if(_0xebfcbf>0x18)return![];}if(_0x1ed381['previousRank']&&_0x1ed381['newRank']&&_0x1ed381['previousRank']!==_0x1ed381['newRank'])return!![];return![];}async[a46_0x571b2b(0x206)](_0xaf3d5a,_0x222f1c,_0x24497f,_0x1bdcd3,_0x43a373,_0x2e5fb6,_0x3ae7f2,_0x1564c1={}){const _0x13a7c2=a46_0x571b2b;try{console['log']('STARTING\x20notification\x20for\x20'+_0x222f1c+_0x13a7c2(0x1cf)+_0x3ae7f2);const _0x5361be={'userId':_0xaf3d5a,'username':_0x222f1c,'displayName':_0x1564c1['displayName']||_0x222f1c,'oldElo':parseInt(_0x24497f),'newElo':parseInt(_0x1bdcd3),'eloDifference':parseInt(_0x1bdcd3)-parseInt(_0x24497f),'oldRank':_0x43a373,'newRank':_0x2e5fb6,'type':_0x3ae7f2,'timestamp':serverTimestamp(),'processed':![],'source':_0x1564c1['source']||_0x13a7c2(0x207),'matchId':_0x1564c1['matchId']||null,'ladder':_0x1564c1[_0x13a7c2(0x1c5)]||'D1','adminUser':_0x1564c1['adminUser']||null};console['log']('Creating\x20Discord\x20notification:',_0x5361be);const _0xd9015a=await addDoc(collection(db,'promotionNotifications'),_0x5361be);return console['log'](_0x13a7c2(0x1d0)+_0xd9015a['id']),!![];}catch(_0x29a100){return console[_0x13a7c2(0x1d8)]('Error\x20sending\x20Discord\x20notification:',_0x29a100),![];}}}function a46_0x4b76(_0x1d62fc,_0x1a1496){const _0x26cd7e=a46_0x4579();return a46_0x4b76=function(_0x7a55a1,_0x3a401f){_0x7a55a1=_0x7a55a1-0x1c3;let _0x4579c5=_0x26cd7e[_0x7a55a1];return _0x4579c5;},a46_0x4b76(_0x1d62fc,_0x1a1496);}export const promotionManager=new PromotionManager();document['addEventListener'](a46_0x571b2b(0x1d3),()=>{const _0x5100f7=a46_0x571b2b;promotionManager[_0x5100f7(0x1e6)]();});export const initializePromotionTracker=()=>promotionManager[a46_0x571b2b(0x1e6)]();function a46_0x4579(){const _0x574d7d=['Processing\x20potential\x20rank\x20change:\x20','bind','ladder','block','info','classList','promotions_checked_','children','resolvedName','showRankChangeBanner','resolveUserId','\x20was\x20dismissed\x20by\x20user\x20within\x20last\x20','\x27s\x20','Discord\x20notification\x20sent\x20successfully\x20with\x20ID:\x20','dismiss-btn','promotion_','DOMContentLoaded',',\x20treating\x20as\x20new','log','isAutomatic','#C0C0C0','error','appendChild','Don\x27t\x20show\x20again','Emerald','displayName','forEach','rank-change-modal\x20','fetchInterval','demotion','type','Gold','textContent','body','players','initialize','modifiedBy','promotion-details','RANKS','exists','docs','set','getRankName','admin','Error\x20writing\x20promotion\x20records:','desc','div','processRankChanges','source','prototype','\x20is\x20permanently\x20ignored','username','rank-change-ok-btn','createElement','winnerUsername','DISPLAY_HOURS','style','offsetWidth','shouldShowPromotion','now','systemDismissed','ID:','setAttribute','currentUser','\x20for\x20','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22rank-name\x22>','player','sendPromotionNotification','automatic','setItem','rankChangeModal','bannerContainer','className','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rank-change-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2\x20class=\x22rank-change-title\x22>','Promotion\x20','commit','data','length','Resolved\x20','threshold','warn','eloHistory','empty','getItem','timestamp','cleanup','pollingInterval','addEventListener','&times;','none','Unknown\x20Player','parentNode','\x20(loser)','display','remove','Error\x20in\x20promotion/demotion\x20recording:'];a46_0x4579=function(){return _0x574d7d;};return a46_0x4579();}export const checkAndRecordPromotion=(_0x6c7211,_0xfa8384,_0x5b6c51,_0x47494a)=>promotionManager['checkAndRecordPromotion'](_0x6c7211,_0xfa8384,_0x5b6c51,_0x47494a);export const getRankName=_0x564088=>promotionManager[a46_0x571b2b(0x1ed)](_0x564088);
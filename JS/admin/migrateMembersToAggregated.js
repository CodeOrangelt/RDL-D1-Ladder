function a1_0x593d(_0x14eace,_0x2ee36a){const _0x3ff04b=a1_0x164e();return a1_0x593d=function(_0x3dc756,_0xa505b4){_0x3dc756=_0x3dc756-0x18b;let _0x164e6a=_0x3ff04b[_0x3dc756];return _0x164e6a;},a1_0x593d(_0x14eace,_0x2ee36a);}import{initializeApp}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';import{getFirestore,collection,getDocs,writeBatch,doc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{firebaseConfig}from'../firebase-config.js';function a1_0x164e(){const _0x2eed90=['apply','has','üí°\x20Refresh\x20your\x20members\x20page\x20to\x20see\x20the\x20results!','username','name','all','‚úÖ\x20Data\x20fetched:\x20','gold','ladder','toISOString','data','üéâ\x20Successfully\x20migrated\x20','forEach','log','ladders','size','\x20members\x20processed)','aggregatedMembers','Unknown','length','‚ùå\x20Migration\x20failed:','commit','error','üì¶\x20Prepared\x20batch\x20','elo','code','set','üîí\x20Permission\x20denied.\x20Make\x20sure\x20you\x27re\x20signed\x20in\x20as\x20an\x20admin\x20and\x20security\x20rules\x20allow\x20access\x20to\x20aggregatedMembers\x20collection.'];a1_0x164e=function(){return _0x2eed90;};return a1_0x164e();}const app=initializeApp(firebaseConfig),db=getFirestore(app);async function migrateToAggregatedMembers(){const _0x1c8710=a1_0x593d,_0x1b3c49=(function(){let _0x27a445=!![];return function(_0x59002c,_0x2b906f){const _0xbebc6f=_0x27a445?function(){const _0xfc3c5c=a1_0x593d;if(_0x2b906f){const _0x5370f4=_0x2b906f[_0xfc3c5c(0x18b)](_0x59002c,arguments);return _0x2b906f=null,_0x5370f4;}}:function(){};return _0x27a445=![],_0xbebc6f;};}()),_0x1a27ea=_0x1b3c49(this,function(){const _0x4d43e0=a1_0x593d;let _0x1b17cc;try{const _0x4bea5d=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x1b17cc=_0x4bea5d();}catch(_0x878f68){_0x1b17cc=window;}const _0x463611=_0x1b17cc['console']=_0x1b17cc['console']||{},_0x24fb4a=['log','warn','info',_0x4d43e0(0x1a1),'exception','table','trace'];for(let _0xc30d3e=0x0;_0xc30d3e<_0x24fb4a['length'];_0xc30d3e++){const _0x548bf8=_0x1b3c49['constructor']['prototype']['bind'](_0x1b3c49),_0x250e46=_0x24fb4a[_0xc30d3e],_0x1f99a3=_0x463611[_0x250e46]||_0x548bf8;_0x548bf8['__proto__']=_0x1b3c49['bind'](_0x1b3c49),_0x548bf8['toString']=_0x1f99a3['toString']['bind'](_0x1f99a3),_0x463611[_0x250e46]=_0x548bf8;}});_0x1a27ea(),console['log']('üîÑ\x20Starting\x20migration\x20to\x20aggregated\x20members...');try{console[_0x1c8710(0x198)]('üì•\x20Fetching\x20all\x20collections...');const [_0x5934ef,_0x456156,_0x3dc23d,_0x265cef,_0x5cdb0b]=await Promise['all']([getDocs(collection(db,'userProfiles')),getDocs(collection(db,'players')),getDocs(collection(db,'playersD2')),getDocs(collection(db,'playersD3')),getDocs(collection(db,'nonParticipants'))]);console['log'](_0x1c8710(0x191)+_0x5934ef['size']+'\x20profiles,\x20'+_0x456156['size']+'\x20D1,\x20'+_0x3dc23d['size']+'\x20D2,\x20'+_0x265cef['size']+'\x20D3,\x20'+_0x5cdb0b['size']+'\x20non-participants');const _0x5e0061=new Map();_0x5934ef['forEach'](_0x592da0=>{_0x5e0061['set'](_0x592da0['id'],_0x592da0['data']());});const _0x2fd97a=new Map(),_0xfd0fbe=(_0x4b364d,_0x9e4490)=>{const _0x1cd2b4=_0x1c8710;_0x4b364d[_0x1cd2b4(0x197)](_0x4a338c=>{const _0x4b1601=_0x1cd2b4,_0x5711df=_0x4a338c['data'](),_0x46659a=_0x4a338c['id'];!_0x2fd97a[_0x4b1601(0x18c)](_0x46659a)&&_0x2fd97a['set'](_0x46659a,{'userId':_0x46659a,'username':_0x5711df[_0x4b1601(0x18e)]||_0x5711df['name']||_0x4b1601(0x19d),'ladders':[],'isNonParticipant':![]});const _0xe3eb5a=_0x2fd97a['get'](_0x46659a);_0xe3eb5a[_0x4b1601(0x199)]['push']({'ladder':_0x9e4490,'elo':_0x5711df['eloRating']||_0x5711df['elo']||0x4b0,'active':_0x5711df['active']!==![]});});};_0xfd0fbe(_0x456156,'D1'),_0xfd0fbe(_0x3dc23d,'D2'),_0xfd0fbe(_0x265cef,'D3'),_0x5cdb0b[_0x1c8710(0x197)](_0x1f3d6b=>{const _0x4cc665=_0x1c8710,_0x378413=_0x1f3d6b[_0x4cc665(0x195)](),_0x38d7ad=_0x1f3d6b['id'];!_0x2fd97a['has'](_0x38d7ad)&&(_0x378413['username']||_0x378413[_0x4cc665(0x18f)])&&_0x2fd97a[_0x4cc665(0x1a5)](_0x38d7ad,{'userId':_0x38d7ad,'username':_0x378413['username']||_0x378413['name'],'ladders':[],'isNonParticipant':!![]});}),console['log']('‚öôÔ∏è\x20Processed\x20'+_0x2fd97a[_0x1c8710(0x19a)]+'\x20unique\x20members'),console['log']('üíæ\x20Writing\x20aggregated\x20data...');const _0x4b8316=[];let _0x3ee694=writeBatch(db),_0x3a3172=0x0,_0x2fc0ba=0x0;_0x2fd97a[_0x1c8710(0x197)]((_0x365906,_0x40693a)=>{const _0x1ceffc=_0x1c8710,_0x2c081d=_0x5e0061['get'](_0x40693a)||{};let _0x2fb88b=0x0,_0x5520b0=null;if(_0x365906['ladders']['length']>0x0){const _0x1ff15f=_0x365906[_0x1ceffc(0x199)]['sort']((_0xb0d9ef,_0x409e18)=>_0x409e18[_0x1ceffc(0x1a3)]-_0xb0d9ef['elo']);_0x2fb88b=_0x1ff15f[0x0]['elo'],_0x5520b0=_0x1ff15f[0x0][_0x1ceffc(0x193)];}const _0x71b778={'userId':_0x40693a,'username':_0x365906[_0x1ceffc(0x18e)],'profileImageUrl':_0x2c081d['profileImageUrl']||null,'country':_0x2c081d['country']||null,'motto':_0x2c081d['motto']||null,'favoriteMap':_0x2c081d['favoriteMap']||null,'favoriteWeapon':_0x2c081d['favoriteWeapon']||null,'isNonParticipant':_0x365906['isNonParticipant'],'ladders':_0x365906['ladders'],'primaryLadder':_0x5520b0,'highestElo':_0x2fb88b,'rank':getPlayerRank(_0x2fb88b),'lastUpdated':new Date(),'migrationTimestamp':new Date()[_0x1ceffc(0x194)]()},_0xd22787=doc(collection(db,_0x1ceffc(0x19c)),_0x40693a);_0x3ee694['set'](_0xd22787,_0x71b778),_0x3a3172++,_0x2fc0ba++,_0x3a3172>=0x1c2&&(_0x4b8316['push'](_0x3ee694['commit']()),_0x3ee694=writeBatch(db),_0x3a3172=0x0,console['log'](_0x1ceffc(0x1a2)+_0x4b8316['length']+'\x20('+_0x2fc0ba+_0x1ceffc(0x19b)));}),_0x3a3172>0x0&&_0x4b8316['push'](_0x3ee694[_0x1c8710(0x1a0)]()),console[_0x1c8710(0x198)]('üöÄ\x20Executing\x20'+_0x4b8316[_0x1c8710(0x19e)]+'\x20batches...'),await Promise[_0x1c8710(0x190)](_0x4b8316),console[_0x1c8710(0x198)](_0x1c8710(0x196)+_0x2fd97a['size']+'\x20members\x20to\x20aggregated\x20collection!'),console['log'](_0x1c8710(0x18d));}catch(_0x2899d6){console[_0x1c8710(0x1a1)](_0x1c8710(0x19f),_0x2899d6),_0x2899d6[_0x1c8710(0x1a4)]==='permission-denied'&&console[_0x1c8710(0x1a1)](_0x1c8710(0x1a6));}}function getPlayerRank(_0x3b957a){const _0x1b1733=a1_0x593d;if(_0x3b957a>=0x7d0)return'emerald';if(_0x3b957a>=0x708)return _0x1b1733(0x192);if(_0x3b957a>=0x640)return'silver';if(_0x3b957a>=0x578)return'bronze';return'unranked';}migrateToAggregatedMembers();
const a36_0x271ce9=a36_0x2089,a36_0x42556c=(function(){let _0x4601f4=!![];return function(_0x2045ac,_0x2fd814){const _0x23889c=_0x4601f4?function(){if(_0x2fd814){const _0x124538=_0x2fd814['apply'](_0x2045ac,arguments);return _0x2fd814=null,_0x124538;}}:function(){};return _0x4601f4=![],_0x23889c;};}()),a36_0x42deac=a36_0x42556c(this,function(){const _0x4c78e8=a36_0x2089,_0x1985f1=function(){let _0x31e96e;try{_0x31e96e=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x1354f7){_0x31e96e=window;}return _0x31e96e;},_0x12f6dd=_0x1985f1(),_0x5d82c9=_0x12f6dd['console']=_0x12f6dd[_0x4c78e8(0x115)]||{},_0x50a282=[_0x4c78e8(0x109),'warn',_0x4c78e8(0xea),'error',_0x4c78e8(0xf0),'table','trace'];for(let _0xe6c9f5=0x0;_0xe6c9f5<_0x50a282['length'];_0xe6c9f5++){const _0x4ca96f=a36_0x42556c[_0x4c78e8(0x110)]['prototype']['bind'](a36_0x42556c),_0x187d4d=_0x50a282[_0xe6c9f5],_0x581fde=_0x5d82c9[_0x187d4d]||_0x4ca96f;_0x4ca96f['__proto__']=a36_0x42556c['bind'](a36_0x42556c),_0x4ca96f[_0x4c78e8(0x10e)]=_0x581fde['toString']['bind'](_0x581fde),_0x5d82c9[_0x187d4d]=_0x4ca96f;}});a36_0x42deac();function a36_0x5147(){const _0x2a2f7c=['Username\x20can\x20only\x20contain\x20letters,\x20numbers,\x20underscores\x20and\x20hyphens','preventDefault','submit','username','User\x20','emailVerified','message','exists','none','login-error','click','.\x20Please\x20check\x20your\x20inbox.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>','info','empty','Error\x20resending\x20verification\x20email:','register-password','location','checked','exception','Verification\x20email\x20sent','string','map','innerHTML','block','playersCTF','style','nonParticipants','getElementById','email','position','register-username','register-error','\x20player\x20registration\x20to\x20','login-email','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22success-message\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Setting\x20up\x20your\x20account...\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>','trim','auth/email-already-in-use','display','playersD2','Login\x20error:','Processing\x20','players','Email\x20has\x20been\x20verified!\x20Redirecting\x20to\x20login\x20page...','log','Error\x20checking\x20verification\x20status:','register-email','\x27)\x22\x20class=\x22resend-button\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Resend\x20Verification\x20Email\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>','uid','toString','disabled','constructor','textContent','login-container','../index.html','user','console','pendingRegistrations','\x20added\x20to\x20','verificationCheckInterval','register-mode','value','addEventListener','error','User\x20signed\x20in:','Email\x20is\x20verified,\x20processing\x20registration'];a36_0x5147=function(){return _0x2a2f7c;};return a36_0x5147();}import{createUserWithEmailAndPassword,signInWithEmailAndPassword,sendEmailVerification,signOut}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{doc,setDoc,collection,getDocs,query,where,getDoc,updateDoc,deleteDoc,orderBy,limit,serverTimestamp}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{auth,db}from'./firebase-config.js';function setupVerificationListener(_0x389ef1,_0x3c8faa){const _0x167ad6=a36_0x2089;console[_0x167ad6(0x109)]('Setting\x20up\x20email\x20verification\x20listener\x20for:',_0x389ef1);const _0x40b78c=setInterval(async()=>{const _0x5ee12e=_0x167ad6;try{console['log']('Checking\x20if\x20email\x20has\x20been\x20verified...');const _0x2ad0c8=await signInWithEmailAndPassword(auth,_0x389ef1,_0x3c8faa),_0x22330b=_0x2ad0c8['user'];await _0x22330b['getIdToken'](!![]),_0x22330b[_0x5ee12e(0xe3)]?(console['log'](_0x5ee12e(0x108)),clearInterval(_0x40b78c),document[_0x5ee12e(0xf9)]('register-error')['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22success-message\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Email\x20verified\x20successfully!\x20You\x20can\x20now\x20log\x20in.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>',await signOut(auth),setTimeout(()=>{const _0x11fb4b=_0x5ee12e;document['getElementById']('register-container')['style']['display']='none',document[_0x11fb4b(0xf9)]('login-container')[_0x11fb4b(0xf7)]['display']='block',document['getElementById']('login-email')['value']=_0x389ef1,document['getElementById']('login-error')[_0x11fb4b(0xf4)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22success-message\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Your\x20account\x20has\x20been\x20verified!\x20You\x20can\x20now\x20log\x20in.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>';},0x7d0)):(console['log']('Email\x20not\x20yet\x20verified,\x20waiting...'),await signOut(auth));}catch(_0x28705b){console['error'](_0x5ee12e(0x10a),_0x28705b),clearInterval(_0x40b78c);}},0x1388);window[_0x167ad6(0x118)]=_0x40b78c,setTimeout(()=>{window['verificationCheckInterval']&&(clearInterval(window['verificationCheckInterval']),window['verificationCheckInterval']=null,console['log']('Stopped\x20checking\x20for\x20email\x20verification\x20(timeout\x20reached)'));},0x5*0x3c*0x3e8);}async function isUsernameAvailable(_0x2d9022){const _0x41c315=a36_0x2089;if(!_0x2d9022||typeof _0x2d9022!==_0x41c315(0xf2)||_0x2d9022['trim']()['length']<0x3)return document[_0x41c315(0xf9)]('register-error')[_0x41c315(0x111)]='Username\x20must\x20be\x20at\x20least\x203\x20characters\x20long',![];const _0x16c1d4=_0x2d9022['trim']();try{const _0x41f662=/^[a-zA-Z0-9_-]{3,20}$/;if(!_0x41f662['test'](_0x16c1d4))return document['getElementById'](_0x41c315(0xfd))[_0x41c315(0x111)]=_0x41c315(0xde),![];const [_0x4c69cd,_0x3338df,_0x5f12ff]=await Promise['all']([getDocs(query(collection(db,'players'),where(_0x41c315(0xe1),'==',_0x16c1d4))),getDocs(query(collection(db,'pendingRegistrations'),where(_0x41c315(0xe1),'==',_0x16c1d4))),getDocs(query(collection(db,_0x41c315(0xf8)),where('username','==',_0x16c1d4)))]);if(!_0x4c69cd[_0x41c315(0xeb)]||!_0x3338df['empty']||!_0x5f12ff['empty'])return document['getElementById']('register-error')['textContent']='Username\x20is\x20already\x20taken',![];return!![];}catch(_0x16a9f4){return console['error']('Error\x20checking\x20username:',_0x16a9f4),document['getElementById'](_0x41c315(0xfd))[_0x41c315(0x111)]='Unable\x20to\x20verify\x20username\x20availability.\x20Please\x20try\x20again\x20later.',![];}}async function handleRegister(_0x25c052){const _0x31945d=a36_0x2089;_0x25c052['preventDefault']();const _0x4eeef9=document['getElementById']('register-error');_0x4eeef9[_0x31945d(0x111)]='';const _0x45094c=document['getElementById'](_0x31945d(0x10b))['value'],_0x489455=document['getElementById'](_0x31945d(0xed))['value'],_0x594545=document['getElementById'](_0x31945d(0xfc))[_0x31945d(0x11a)],_0x1f5d6a=document[_0x31945d(0xf9)]('verification-answer')['value']['toLowerCase'](),_0x5a9df5=document['getElementById'](_0x31945d(0x119))['value'],_0x256b83=document[_0x31945d(0xf9)]('non-participant')?.['checked']||![];if(_0x256b83&&_0x5a9df5!==''){_0x4eeef9[_0x31945d(0x111)]='Please\x20unselect\x20a\x20game\x20mode\x20if\x20you\x20choose\x20Non-Participant.';return;}if(!_0x256b83&&_0x5a9df5===''){_0x4eeef9['textContent']='Please\x20select\x20a\x20game\x20mode\x20or\x20check\x20Non-Participant.';return;}try{const _0xc49237=['purple','magenta'];if(!_0xc49237['includes'](_0x1f5d6a)){_0x4eeef9['textContent']='Incorrect\x20answer\x20to\x20verification\x20question';return;}const _0x189b2c=await isUsernameAvailable(_0x594545);if(!_0x189b2c)return;const _0x32616c=await createUserWithEmailAndPassword(auth,_0x45094c,_0x489455),_0x43f614=_0x32616c['user'];await sendEmailVerification(_0x43f614),await setDoc(doc(db,'pendingRegistrations',_0x43f614['uid']),{'username':_0x594545[_0x31945d(0x101)](),'email':_0x45094c,'gameMode':_0x5a9df5,'nonParticipant':_0x256b83,'createdAt':new Date(),'verified':![]}),_0x4eeef9[_0x31945d(0xf4)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22success-message\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Registration\x20pending!\x20Please\x20check\x20your\x20email\x20to\x20verify\x20your\x20account.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<br><br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20onclick=\x22resendVerificationEmail(\x27'+_0x45094c+_0x31945d(0x10c),await signOut(auth),setupVerificationListener(_0x45094c,_0x489455);}catch(_0x410309){console['error']('Registration\x20error:',_0x410309),_0x4eeef9['textContent']=_0x410309['code']===_0x31945d(0x102)?'Email\x20address\x20is\x20already\x20registered':'Registration\x20failed.\x20Please\x20try\x20again\x20later.';}}async function handleLogin(_0x583fb2){const _0x54945b=a36_0x2089;_0x583fb2['preventDefault']();const _0x59038a=document['getElementById'](_0x54945b(0xff))['value'],_0x414bae=document['getElementById']('login-password')['value'],_0x4884f4=document['getElementById'](_0x54945b(0xe7));console['log']('Login\x20attempt\x20started\x20for:',_0x59038a),_0x4884f4[_0x54945b(0x111)]='';try{console['log']('Attempting\x20Firebase\x20signInWithEmailAndPassword...');const _0x4e83c1=await signInWithEmailAndPassword(auth,_0x59038a,_0x414bae),_0x2245cd=_0x4e83c1['user'];console[_0x54945b(0x109)]('User\x20signed\x20in:',_0x2245cd[_0x54945b(0x10d)]);const _0x34cee6=['players','playersD2','playersD3','playersDuos','playersCTF','nonParticipants'];console[_0x54945b(0x109)]('Checking\x20if\x20user\x20exists\x20in\x20any\x20collection...');let _0x3ec6fa=![],_0x292a22=await Promise['all'](_0x34cee6[_0x54945b(0xf3)](_0x5dae0d=>getDoc(doc(db,_0x5dae0d,_0x2245cd[_0x54945b(0x10d)]))));for(let _0x13ec83=0x0;_0x13ec83<_0x292a22['length'];_0x13ec83++){if(_0x292a22[_0x13ec83][_0x54945b(0xe5)]()){_0x3ec6fa=!![],console['log']('User\x20found\x20in\x20'+_0x34cee6[_0x13ec83]+'\x20collection');break;}}if(!_0x3ec6fa){console['log']('User\x20not\x20found\x20in\x20any\x20collection,\x20checking\x20pending\x20registration');const _0x159ce7=doc(db,_0x54945b(0x116),_0x2245cd['uid']),_0x241c47=await getDoc(_0x159ce7);if(_0x241c47['exists']()){const _0x31a883=_0x241c47['data']();console['log']('Found\x20pending\x20registration:',_0x31a883);if(_0x2245cd[_0x54945b(0xe3)]){console['log'](_0x54945b(0x11e)),_0x4884f4['innerHTML']=_0x54945b(0x100);if(_0x31a883['nonParticipant'])console['log']('Processing\x20non-participant\x20registration'),await setDoc(doc(db,'nonParticipants',_0x2245cd['uid']),{'username':_0x31a883['username'],'email':_0x2245cd['email'],'createdAt':serverTimestamp(),'isNonParticipant':!![]}),console['log'](_0x54945b(0xe2)+_0x31a883['username']+'\x20added\x20to\x20nonParticipants\x20collection');else{let _0x3c4e29;switch(_0x31a883['gameMode']){case'D1':_0x3c4e29=_0x54945b(0x107);break;case'D2':_0x3c4e29=_0x54945b(0x104);break;case'D3':_0x3c4e29='playersD3';break;case'Duos':_0x3c4e29='playersDuos';break;case'CTF':_0x3c4e29=_0x54945b(0xf6);break;default:_0x3c4e29='players';}console['log'](_0x54945b(0x106)+_0x31a883['gameMode']+_0x54945b(0xfe)+_0x3c4e29);const _0x50f633=collection(db,_0x3c4e29),_0x4fea04=query(_0x50f633,orderBy('position','desc'),limit(0x1)),_0x536351=await getDocs(_0x4fea04),_0x472596=_0x536351['empty']?0x1:_0x536351['docs'][0x0]['data']()[_0x54945b(0xfb)]+0x1;await setDoc(doc(db,_0x3c4e29,_0x2245cd['uid']),{'username':_0x31a883['username'],'email':_0x2245cd[_0x54945b(0xfa)],'eloRating':0x4b0,'position':_0x472596,'createdAt':serverTimestamp(),'isAdmin':![],'matches':0x0,'wins':0x0,'losses':0x0,'gameMode':_0x31a883['gameMode']}),console['log']('New\x20player\x20'+_0x31a883[_0x54945b(0xe1)]+_0x54945b(0x117)+_0x3c4e29+'\x20at\x20position\x20'+_0x472596);}await deleteDoc(_0x159ce7),setTimeout(()=>{const _0x27a5cc=_0x54945b;window['location']['href']=_0x27a5cc(0x113);},0x7d0);return;}else{_0x4884f4['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22warning-message\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Please\x20verify\x20your\x20email\x20to\x20complete\x20your\x20registration.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<br><br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20type=\x22button\x22\x20id=\x22resend-button\x22\x20class=\x22resend-button\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Resend\x20Verification\x20Email\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>',document['getElementById']('resend-button')[_0x54945b(0x11b)](_0x54945b(0xe8),()=>{resendVerificationEmail(_0x59038a);}),await signOut(auth);return;}}}window['location']['href']='../index.html';}catch(_0x12ddba){console['error']('Login\x20error:',_0x12ddba),_0x4884f4['textContent']='Login\x20failed:\x20'+_0x12ddba[_0x54945b(0xe4)];}}function a36_0x2089(_0x347196,_0x52e48e){const _0x42deac=a36_0x5147();return a36_0x2089=function(_0x42556c,_0x3ddd4c){_0x42556c=_0x42556c-0xde;let _0x5147ad=_0x42deac[_0x42556c];return _0x5147ad;},a36_0x2089(_0x347196,_0x52e48e);}function loginFormHandler(_0x3eab5b){const _0x1c150b=a36_0x2089;_0x3eab5b[_0x1c150b(0xdf)]();const _0x3fa0d8=document['getElementById']('login-email')[_0x1c150b(0x11a)]['trim'](),_0x5d1b62=document[_0x1c150b(0xf9)]('login-password')[_0x1c150b(0x11a)],_0x52669c=document[_0x1c150b(0xf9)]('login-error');signInWithEmailAndPassword(auth,_0x3fa0d8,_0x5d1b62)['then'](_0x424632=>{const _0x4b2918=_0x1c150b;console['log'](_0x4b2918(0x11d),_0x424632[_0x4b2918(0x114)]),window[_0x4b2918(0xee)]['href']='../index.html';})['catch'](_0x1e0272=>{const _0x37af9b=_0x1c150b;console['error'](_0x37af9b(0x105),_0x1e0272),_0x52669c['textContent']='Login\x20error:\x20'+_0x1e0272['message'],_0x52669c['style']['display']=_0x37af9b(0xf5);});}async function resendVerificationEmail(_0x479588){const _0x50767b=a36_0x2089;console['log']('Attempting\x20to\x20resend\x20verification\x20email\x20to:',_0x479588);try{const _0x56dae1=document['getElementById']('login-password')?.[_0x50767b(0x11a)];if(!_0x56dae1){console['error']('Password\x20not\x20available\x20for\x20resending\x20verification'),document[_0x50767b(0xf9)](_0x50767b(0xe7))['textContent']='Please\x20enter\x20your\x20password\x20to\x20resend\x20verification\x20email';return;}const _0x1db107=await signInWithEmailAndPassword(auth,_0x479588,_0x56dae1),_0x2b3173=_0x1db107['user'];console['log']('User\x20signed\x20in\x20for\x20verification\x20email:',_0x2b3173['uid']),await sendEmailVerification(_0x2b3173),console['log'](_0x50767b(0xf1)),document[_0x50767b(0xf9)](_0x50767b(0xe7))['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22success-message\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Verification\x20email\x20has\x20been\x20resent\x20to\x20'+_0x479588+_0x50767b(0xe9),await signOut(auth);}catch(_0x2e09b2){console[_0x50767b(0x11c)](_0x50767b(0xec),_0x2e09b2),document['getElementById']('login-error')['textContent']='Error\x20sending\x20verification\x20email:\x20'+_0x2e09b2['message'];}}window['resendVerificationEmail']=function(_0x593220){const _0x4d5a13=a36_0x2089;console[_0x4d5a13(0x109)]('Window.resendVerificationEmail\x20called\x20with:',_0x593220),resendVerificationEmail(_0x593220);},document[a36_0x271ce9(0x11b)]('DOMContentLoaded',()=>{const _0x26aeb0=a36_0x271ce9,_0x1803d8=document[_0x26aeb0(0xf9)]('non-participant'),_0xe68c20=document['getElementById'](_0x26aeb0(0x119));_0x1803d8&&_0xe68c20&&_0x1803d8['addEventListener']('change',function(){const _0x3248d0=_0x26aeb0;this[_0x3248d0(0xef)]?(_0xe68c20['value']='',_0xe68c20[_0x3248d0(0x10f)]=!![]):_0xe68c20['disabled']=![];});const _0x2d00b8=document['getElementById']('register-form'),_0x15a27b=document[_0x26aeb0(0xf9)]('login-form');_0x2d00b8&&_0x2d00b8['addEventListener'](_0x26aeb0(0xe0),handleRegister);_0x15a27b&&_0x15a27b['addEventListener']('submit',handleLogin);const _0x3beb9e=document['getElementById']('show-register'),_0x4ddee1=document['getElementById']('show-login');_0x3beb9e&&_0x3beb9e[_0x26aeb0(0x11b)]('click',_0x34d497=>{const _0x5c7e95=_0x26aeb0;_0x34d497['preventDefault'](),document['getElementById'](_0x5c7e95(0x112))['style']['display']='none',document['getElementById']('register-container')['style'][_0x5c7e95(0x103)]=_0x5c7e95(0xf5);}),_0x4ddee1&&_0x4ddee1['addEventListener']('click',_0x5e5d3a=>{const _0x403052=_0x26aeb0;_0x5e5d3a[_0x403052(0xdf)](),document['getElementById']('register-container')['style']['display']=_0x403052(0xe6),document[_0x403052(0xf9)](_0x403052(0x112))[_0x403052(0xf7)][_0x403052(0x103)]=_0x403052(0xf5);});});
const a41_0x4a9e09=a41_0x1628,a41_0x45cd5f=(function(){let _0x2f93f0=!![];return function(_0x4d93af,_0x2e9fa9){const _0x4e61da=_0x2f93f0?function(){const _0x3ef498=a41_0x1628;if(_0x2e9fa9){const _0x292d5b=_0x2e9fa9[_0x3ef498(0x1db)](_0x4d93af,arguments);return _0x2e9fa9=null,_0x292d5b;}}:function(){};return _0x2f93f0=![],_0x4e61da;};}()),a41_0x511c45=a41_0x45cd5f(this,function(){const _0x14aa9e=a41_0x1628;let _0x5cfd65;try{const _0x27ff36=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x5cfd65=_0x27ff36();}catch(_0x14d72e){_0x5cfd65=window;}const _0x16e556=_0x5cfd65[_0x14aa9e(0x1d8)]=_0x5cfd65[_0x14aa9e(0x1d8)]||{},_0x57638e=['log','warn','info','error','exception',_0x14aa9e(0x1e1),'trace'];for(let _0x1127f3=0x0;_0x1127f3<_0x57638e[_0x14aa9e(0x1dc)];_0x1127f3++){const _0x4d2fc0=a41_0x45cd5f['constructor'][_0x14aa9e(0x1e2)]['bind'](a41_0x45cd5f),_0x6bc4dd=_0x57638e[_0x1127f3],_0x31921f=_0x16e556[_0x6bc4dd]||_0x4d2fc0;_0x4d2fc0[_0x14aa9e(0x1d2)]=a41_0x45cd5f['bind'](a41_0x45cd5f),_0x4d2fc0['toString']=_0x31921f['toString']['bind'](_0x31921f),_0x16e556[_0x6bc4dd]=_0x4d2fc0;}});a41_0x511c45();function a41_0x1628(_0x5962c2,_0x43e25e){const _0x511c45=a41_0x5d05();return a41_0x1628=function(_0x45cd5f,_0x282e6b){_0x45cd5f=_0x45cd5f-0x1d2;let _0x5d05cf=_0x511c45[_0x45cd5f];return _0x5d05cf;},a41_0x1628(_0x5962c2,_0x43e25e);}import{db}from'./firebase-config.js';import{doc,getDoc,updateDoc,addDoc,collection,serverTimestamp}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const POINTS_CHART={'':0xa,'Standard':0xa,'Fusion\x20Match':0x19,'â‰¥6\x20Missiles':0xa,'Weapon\x20Imbalance':0x1e,'Blind\x20Match':0x4b,'Rematch':0x14,'Disorientation':0x32,'Ratting':0x23,'Altered\x20Powerups':0x23,'Mega\x20Match':0x28,'Dogfight':0x32,'Gauss\x20and\x20Mercs':0x19,'Misc':0x1e};function a41_0x5d05(){const _0x4b2aea=['__proto__','error','displayName','Standard','\x20points\x20to\x20user\x20','Error\x20adding\x20points\x20to\x20user:','console','data','Unknown\x20User','apply','length','Match\x20points:\x20','Admin\x20points\x20service\x20connected','\x20match\x20(Winner)','add','table','prototype','log'];a41_0x5d05=function(){return _0x4b2aea;};return a41_0x5d05();}let adminModifyUserPoints=null;try{const adminModule=await import('./adminbackend.js');adminModule['modifyUserPoints']&&(adminModifyUserPoints=adminModule['modifyUserPoints'],console['log'](a41_0x4a9e09(0x1de)));}catch(a41_0x34332c){console['log']('Admin\x20backend\x20not\x20available,\x20using\x20fallback\x20points\x20service');}export async function awardMatchPoints(_0x232cd1,_0x26d586,_0x2b9798){const _0x5c0d65=a41_0x4a9e09;try{const _0x3adcff=POINTS_CHART[_0x2b9798]||0xa;return adminModifyUserPoints?await Promise['all']([adminModifyUserPoints(_0x232cd1,'add',_0x3adcff,'Match\x20points:\x20'+(_0x2b9798||'Standard')+'\x20match\x20(Winner)'),adminModifyUserPoints(_0x26d586,'add',_0x3adcff,'Match\x20points:\x20'+(_0x2b9798||'Standard')+'\x20match\x20(Participant)')]):await Promise['all']([addPointsFallback(_0x232cd1,_0x3adcff,'Match\x20points:\x20'+(_0x2b9798||_0x5c0d65(0x1d5))+_0x5c0d65(0x1df)),addPointsFallback(_0x26d586,_0x3adcff,_0x5c0d65(0x1dd)+(_0x2b9798||'Standard')+'\x20match\x20(Participant)')]),console['log']('Awarded\x20'+_0x3adcff+'\x20points\x20to\x20both\x20players\x20for\x20'+(_0x2b9798||'Standard')+'\x20match'),!![];}catch(_0x413cab){return console[_0x5c0d65(0x1d3)]('Error\x20awarding\x20match\x20points:',_0x413cab),![];}}async function addPointsFallback(_0x3444c9,_0x3437fb,_0x4c9feb=''){const _0x56865d=a41_0x4a9e09;try{const _0x27d7da=doc(db,'userProfiles',_0x3444c9),_0x16808d=await getDoc(_0x27d7da);if(!_0x16808d['exists']()){console[_0x56865d(0x1e3)]('User\x20profile\x20not\x20found\x20for\x20'+_0x3444c9+',\x20skipping\x20points\x20award');return;}const _0x2baa49=_0x16808d[_0x56865d(0x1d9)](),_0x5cc29d=_0x2baa49['points']||0x0,_0x253b5d=_0x5cc29d+_0x3437fb;await updateDoc(_0x27d7da,{'points':_0x253b5d,'lastPointsModified':serverTimestamp()}),await addDoc(collection(db,'pointsHistory'),{'userId':_0x3444c9,'userEmail':_0x2baa49['email']||'unknown','displayName':_0x2baa49[_0x56865d(0x1d4)]||_0x2baa49['username']||_0x56865d(0x1da),'action':_0x56865d(0x1e0),'amount':_0x3437fb,'previousPoints':_0x5cc29d,'newPoints':_0x253b5d,'reason':_0x4c9feb,'adminEmail':'system-match-award','timestamp':serverTimestamp()}),console['log']('Added\x20'+_0x3437fb+_0x56865d(0x1d6)+_0x3444c9+'.\x20New\x20total:\x20'+_0x253b5d);}catch(_0x4161c2){console['error'](_0x56865d(0x1d7),_0x4161c2);throw _0x4161c2;}}
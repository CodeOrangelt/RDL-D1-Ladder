const a14_0x515cd5=a14_0xbd22,a14_0xe5e2fb=(function(){let _0x31cb81=!![];return function(_0x227713,_0x20834c){const _0x382604=_0x31cb81?function(){if(_0x20834c){const _0x2873cd=_0x20834c['apply'](_0x227713,arguments);return _0x20834c=null,_0x2873cd;}}:function(){};return _0x31cb81=![],_0x382604;};}()),a14_0x4345d3=a14_0xe5e2fb(this,function(){const _0x1aa886=a14_0xbd22;let _0x26aa6d;try{const _0x5b7a60=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x26aa6d=_0x5b7a60();}catch(_0x1c13a1){_0x26aa6d=window;}const _0x4aa346=_0x26aa6d['console']=_0x26aa6d['console']||{},_0xbe3ceb=['log','warn',_0x1aa886(0x148),'error','exception','table',_0x1aa886(0x147)];for(let _0x3228bd=0x0;_0x3228bd<_0xbe3ceb['length'];_0x3228bd++){const _0x1e8598=a14_0xe5e2fb['constructor']['prototype']['bind'](a14_0xe5e2fb),_0x5d47c4=_0xbe3ceb[_0x3228bd],_0x1109fe=_0x4aa346[_0x5d47c4]||_0x1e8598;_0x1e8598['__proto__']=a14_0xe5e2fb['bind'](a14_0xe5e2fb),_0x1e8598['toString']=_0x1109fe[_0x1aa886(0x13a)]['bind'](_0x1109fe),_0x4aa346[_0x5d47c4]=_0x1e8598;}});a14_0x4345d3();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D2=[{'name':'Gold','elo':0x708},{'name':a14_0x515cd5(0x13f),'elo':0x640},{'name':'Bronze','elo':0x578},{'name':a14_0x515cd5(0x13e),'elo':0x4b0}];function a14_0xbd22(_0x54e8f0,_0x54c7be){const _0x4345d3=a14_0x2a09();return a14_0xbd22=function(_0xe5e2fb,_0xd1f330){_0xe5e2fb=_0xe5e2fb-0x12f;let _0x2a09df=_0x4345d3[_0xe5e2fb];return _0x2a09df;},a14_0xbd22(_0x54e8f0,_0x54c7be);}let lastVisibleD2=null;async function getUsernameByIdD2(_0x2b4d8a){const _0x526616=a14_0x515cd5;try{if(!_0x2b4d8a)return _0x526616(0x146);const _0x3c88c3=await getDoc(doc(db,_0x526616(0x13d),_0x2b4d8a));if(_0x3c88c3['exists']())return _0x3c88c3[_0x526616(0x142)]()['username']||'Unknown\x20Player';const _0x4b1411=await getDocs(query(collection(db,_0x526616(0x138)),where(_0x526616(0x13b),'==',_0x2b4d8a),limit(0x1)));if(!_0x4b1411[_0x526616(0x132)])return _0x4b1411[_0x526616(0x135)][0x0]['data']()[_0x526616(0x144)]||'Unknown\x20Player';const _0x311df1=await getDocs(query(collection(db,'approvedMatchesD2'),where(_0x526616(0x133),'==',_0x2b4d8a),limit(0x1)));if(!_0x311df1[_0x526616(0x132)])return _0x311df1['docs'][0x0][_0x526616(0x142)]()[_0x526616(0x145)]||'Unknown\x20Player';return'Unknown\x20Player';}catch(_0x58bb95){return console[_0x526616(0x13c)](_0x526616(0x136),_0x58bb95),'Unknown\x20Player';}}function a14_0x2a09(){const _0x5a180b=['match','timestamp','desc','empty','loserId','demotion','docs','Error\x20getting\x20username:','D2\x20ELO\x20history\x20recorded\x20for\x20','approvedMatchesD2','map','toString','winnerId','error','playersD2','Unranked','Silver','Emerald','log','data','opponent','winnerUsername','loserUsername','Unknown\x20Player','trace','info'];a14_0x2a09=function(){return _0x5a180b;};return a14_0x2a09();}export async function recordEloChangeD2({playerId:_0x766795,previousElo:_0x2641e9,newElo:_0x17303c,opponentId:_0x27c8fe,matchResult:_0x13265f,previousPosition:_0x5627aa,newPosition:_0x43f10e,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x372b66,timestamp:_0x38a95c}){const _0x428717=a14_0x515cd5;try{const _0x4d377a=doc(collection(db,'eloHistoryD2'));let _0x275d7f=_0x428717(0x12f);if(isPromotion)_0x275d7f='promotion';if(isDemotion)_0x275d7f=_0x428717(0x134);let _0x2e8937=_0x428717(0x13e);if(_0x17303c>=0x834)_0x2e8937=_0x428717(0x140);else{if(_0x17303c>=0x708)_0x2e8937='Gold';else{if(_0x17303c>=0x640)_0x2e8937=_0x428717(0x13f);else{if(_0x17303c>=0x578)_0x2e8937='Bronze';}}}return await setDoc(_0x4d377a,{'type':_0x275d7f,'player':_0x766795,'opponent':_0x27c8fe,'previousElo':_0x2641e9,'newElo':_0x17303c,'change':_0x17303c-_0x2641e9,'matchResult':_0x13265f,'previousPosition':_0x5627aa,'newPosition':_0x43f10e,'rankAchieved':_0x2e8937,'matchId':_0x372b66,'timestamp':_0x38a95c}),console[_0x428717(0x141)](_0x428717(0x137)+_0x766795),!![];}catch(_0x659e24){console['error']('Error\x20recording\x20D2\x20ELO\x20history:',_0x659e24);throw _0x659e24;}}export async function getEloHistoryD2(_0x42bde6=0x14){const _0x2f412e=a14_0x515cd5;try{const _0x226808=collection(db,'eloHistoryD2');let _0x2abaf5;lastVisibleD2?_0x2abaf5=query(_0x226808,orderBy(_0x2f412e(0x130),_0x2f412e(0x131)),startAfter(lastVisibleD2),limit(_0x42bde6)):_0x2abaf5=query(_0x226808,orderBy(_0x2f412e(0x130),'desc'),limit(_0x42bde6));const _0x4f0681=await getDocs(_0x2abaf5);if(_0x4f0681[_0x2f412e(0x132)])return{'entries':[],'hasMore':![]};lastVisibleD2=_0x4f0681['docs'][_0x4f0681['docs']['length']-0x1];const _0x5f615b=_0x4f0681['docs'][_0x2f412e(0x139)](async _0x3ec916=>{const _0x15a9ef=_0x2f412e,_0x3f0d1b=_0x3ec916['data'](),[_0x301c41,_0x1e3199]=await Promise['all']([getUsernameByIdD2(_0x3f0d1b['player']),getUsernameByIdD2(_0x3f0d1b[_0x15a9ef(0x143)])]);return{..._0x3f0d1b,'playerUsername':_0x301c41,'opponentUsername':_0x1e3199,'change':_0x3f0d1b['newElo']-_0x3f0d1b['previousElo'],'timestamp':_0x3f0d1b['timestamp']};}),_0x40aef0=await Promise['all'](_0x5f615b);return{'entries':_0x40aef0,'hasMore':_0x4f0681['size']===_0x42bde6};}catch(_0x4c623d){console[_0x2f412e(0x13c)]('Error\x20fetching\x20D2\x20ELO\x20history:',_0x4c623d);throw _0x4c623d;}}export function resetPaginationD2(){lastVisibleD2=null;}
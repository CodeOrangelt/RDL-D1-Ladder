const a14_0x2c9acb=a14_0x2a02,a14_0x5e9108=(function(){let _0x9c6573=!![];return function(_0x53dc6e,_0x51cf0a){const _0x11b151=_0x9c6573?function(){if(_0x51cf0a){const _0x4d5d69=_0x51cf0a['apply'](_0x53dc6e,arguments);return _0x51cf0a=null,_0x4d5d69;}}:function(){};return _0x9c6573=![],_0x11b151;};}()),a14_0x4b3016=a14_0x5e9108(this,function(){const _0x5a6d3c=a14_0x2a02,_0x1c78b3=function(){let _0x15e6cb;try{_0x15e6cb=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x3b074b){_0x15e6cb=window;}return _0x15e6cb;},_0x22a740=_0x1c78b3(),_0x581ae8=_0x22a740['console']=_0x22a740['console']||{},_0x3a3901=[_0x5a6d3c(0x105),'warn',_0x5a6d3c(0x101),_0x5a6d3c(0xf9),'exception','table','trace'];for(let _0x3e0855=0x0;_0x3e0855<_0x3a3901['length'];_0x3e0855++){const _0x12e127=a14_0x5e9108[_0x5a6d3c(0x100)]['prototype']['bind'](a14_0x5e9108),_0x588d5b=_0x3a3901[_0x3e0855],_0x3eeac7=_0x581ae8[_0x588d5b]||_0x12e127;_0x12e127['__proto__']=a14_0x5e9108['bind'](a14_0x5e9108),_0x12e127['toString']=_0x3eeac7['toString']['bind'](_0x3eeac7),_0x581ae8[_0x588d5b]=_0x12e127;}});function a14_0x374a(){const _0xc06146=['error','exists','data','empty','demotion','Silver','eloHistoryD2','constructor','info','docs','winnerUsername','Unknown\x20Player','log','timestamp','approvedMatchesD2','loserId','map','Error\x20recording\x20D2\x20ELO\x20history:','Unranked'];a14_0x374a=function(){return _0xc06146;};return a14_0x374a();}a14_0x4b3016();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D2=[{'name':'Gold','elo':0x708},{'name':a14_0x2c9acb(0xfe),'elo':0x640},{'name':'Bronze','elo':0x578},{'name':'Unranked','elo':0x4b0}];let lastVisibleD2=null;function a14_0x2a02(_0x4d6bec,_0x545ec8){const _0x4b3016=a14_0x374a();return a14_0x2a02=function(_0x5e9108,_0x36da0f){_0x5e9108=_0x5e9108-0xf9;let _0x374ae3=_0x4b3016[_0x5e9108];return _0x374ae3;},a14_0x2a02(_0x4d6bec,_0x545ec8);}async function getUsernameByIdD2(_0x59c588){const _0x134a61=a14_0x2c9acb;try{if(!_0x59c588)return _0x134a61(0x104);const _0x4894bc=await getDoc(doc(db,'playersD2',_0x59c588));if(_0x4894bc[_0x134a61(0xfa)]())return _0x4894bc['data']()['username']||'Unknown\x20Player';const _0x12918e=await getDocs(query(collection(db,'approvedMatchesD2'),where('winnerId','==',_0x59c588),limit(0x1)));if(!_0x12918e[_0x134a61(0xfc)])return _0x12918e['docs'][0x0]['data']()[_0x134a61(0x103)]||'Unknown\x20Player';const _0x44d718=await getDocs(query(collection(db,_0x134a61(0x107)),where(_0x134a61(0x108),'==',_0x59c588),limit(0x1)));if(!_0x44d718['empty'])return _0x44d718[_0x134a61(0x102)][0x0][_0x134a61(0xfb)]()['loserUsername']||'Unknown\x20Player';return'Unknown\x20Player';}catch(_0x4313d8){return console[_0x134a61(0xf9)]('Error\x20getting\x20username:',_0x4313d8),_0x134a61(0x104);}}export async function recordEloChangeD2({playerId:_0x3c9ed2,previousElo:_0x53fb34,newElo:_0x3e547c,opponentId:_0x4f6455,matchResult:_0x79e787,previousPosition:_0x178f40,newPosition:_0x55e25b,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x3ef056,timestamp:_0x589fce}){const _0x484306=a14_0x2c9acb;try{const _0x2c7f4c=doc(collection(db,_0x484306(0xff)));let _0x847c2f='match';if(isPromotion)_0x847c2f='promotion';if(isDemotion)_0x847c2f=_0x484306(0xfd);let _0x2402e5=_0x484306(0x10b);if(_0x3e547c>=0x834)_0x2402e5='Emerald';else{if(_0x3e547c>=0x708)_0x2402e5='Gold';else{if(_0x3e547c>=0x640)_0x2402e5=_0x484306(0xfe);else{if(_0x3e547c>=0x578)_0x2402e5='Bronze';}}}return await setDoc(_0x2c7f4c,{'type':_0x847c2f,'player':_0x3c9ed2,'opponent':_0x4f6455,'previousElo':_0x53fb34,'newElo':_0x3e547c,'change':_0x3e547c-_0x53fb34,'matchResult':_0x79e787,'previousPosition':_0x178f40,'newPosition':_0x55e25b,'rankAchieved':_0x2402e5,'matchId':_0x3ef056,'timestamp':_0x589fce}),console[_0x484306(0x105)]('D2\x20ELO\x20history\x20recorded\x20for\x20'+_0x3c9ed2),!![];}catch(_0x111777){console['error'](_0x484306(0x10a),_0x111777);throw _0x111777;}}export async function getEloHistoryD2(_0xc8dcb2=0x14){const _0x25f684=a14_0x2c9acb;try{const _0x24f44b=collection(db,_0x25f684(0xff));let _0x297964;lastVisibleD2?_0x297964=query(_0x24f44b,orderBy('timestamp','desc'),startAfter(lastVisibleD2),limit(_0xc8dcb2)):_0x297964=query(_0x24f44b,orderBy('timestamp','desc'),limit(_0xc8dcb2));const _0x2628e6=await getDocs(_0x297964);if(_0x2628e6['empty'])return{'entries':[],'hasMore':![]};lastVisibleD2=_0x2628e6[_0x25f684(0x102)][_0x2628e6[_0x25f684(0x102)]['length']-0x1];const _0x38d44f=_0x2628e6['docs'][_0x25f684(0x109)](async _0x39deff=>{const _0x3faf51=_0x25f684,_0x1f8614=_0x39deff['data'](),[_0x532b91,_0x3dcd9c]=await Promise['all']([getUsernameByIdD2(_0x1f8614['player']),getUsernameByIdD2(_0x1f8614['opponent'])]);return{..._0x1f8614,'playerUsername':_0x532b91,'opponentUsername':_0x3dcd9c,'change':_0x1f8614['newElo']-_0x1f8614['previousElo'],'timestamp':_0x1f8614[_0x3faf51(0x106)]};}),_0x27bc8b=await Promise['all'](_0x38d44f);return{'entries':_0x27bc8b,'hasMore':_0x2628e6['size']===_0xc8dcb2};}catch(_0x83222b){console['error']('Error\x20fetching\x20D2\x20ELO\x20history:',_0x83222b);throw _0x83222b;}}export function resetPaginationD2(){lastVisibleD2=null;}
const a12_0x1be3b0=(function(){let _0x1bb4dc=!![];return function(_0x43797,_0x37bd7f){const _0x4009a4=_0x1bb4dc?function(){if(_0x37bd7f){const _0xf5fdbc=_0x37bd7f['apply'](_0x43797,arguments);return _0x37bd7f=null,_0xf5fdbc;}}:function(){};return _0x1bb4dc=![],_0x4009a4;};}()),a12_0xd4cfd7=a12_0x1be3b0(this,function(){const _0x1dd574=a12_0x45d5;let _0x2dbd72;try{const _0x2c6491=Function(_0x1dd574(0x1de)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x2dbd72=_0x2c6491();}catch(_0xc25ed3){_0x2dbd72=window;}const _0xaf3a38=_0x2dbd72[_0x1dd574(0x1e3)]=_0x2dbd72[_0x1dd574(0x1e3)]||{},_0x2cf56d=['log','warn','info',_0x1dd574(0x1df),'exception','table','trace'];for(let _0x16d572=0x0;_0x16d572<_0x2cf56d[_0x1dd574(0x1e9)];_0x16d572++){const _0x26e6b3=a12_0x1be3b0[_0x1dd574(0x1e1)]['prototype']['bind'](a12_0x1be3b0),_0x36e169=_0x2cf56d[_0x16d572],_0x286468=_0xaf3a38[_0x36e169]||_0x26e6b3;_0x26e6b3['__proto__']=a12_0x1be3b0['bind'](a12_0x1be3b0),_0x26e6b3['toString']=_0x286468['toString']['bind'](_0x286468),_0xaf3a38[_0x36e169]=_0x26e6b3;}});a12_0xd4cfd7();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D2=[{'name':'Gold','elo':0x708},{'name':'Silver','elo':0x640},{'name':'Bronze','elo':0x578},{'name':'Unranked','elo':0x4b0}];let lastVisibleD2=null;async function getUsernameByIdD2(_0x3a6247){const _0x59d558=a12_0x45d5;try{if(!_0x3a6247)return _0x59d558(0x1e4);const _0x500ee7=await getDoc(doc(db,'playersD2',_0x3a6247));if(_0x500ee7['exists']())return _0x500ee7['data']()['username']||'Unknown\x20Player';const _0xf2ebc=await getDocs(query(collection(db,'approvedMatchesD2'),where('winnerId','==',_0x3a6247),limit(0x1)));if(!_0xf2ebc['empty'])return _0xf2ebc[_0x59d558(0x1e8)][0x0]['data']()['winnerUsername']||'Unknown\x20Player';const _0x5d045a=await getDocs(query(collection(db,'approvedMatchesD2'),where(_0x59d558(0x1e0),'==',_0x3a6247),limit(0x1)));if(!_0x5d045a['empty'])return _0x5d045a['docs'][0x0]['data']()['loserUsername']||_0x59d558(0x1e4);return'Unknown\x20Player';}catch(_0x37aae1){return console[_0x59d558(0x1df)]('Error\x20getting\x20username:',_0x37aae1),'Unknown\x20Player';}}function a12_0x45d5(_0xb80e1b,_0x1c7c75){const _0xd4cfd7=a12_0x58ee();return a12_0x45d5=function(_0x1be3b0,_0xb68c7){_0x1be3b0=_0x1be3b0-0x1de;let _0x58eed9=_0xd4cfd7[_0x1be3b0];return _0x58eed9;},a12_0x45d5(_0xb80e1b,_0x1c7c75);}export async function recordEloChangeD2({playerId:_0x348509,previousElo:_0x3f6c62,newElo:_0x328d43,opponentId:_0x183cde,matchResult:_0x22ab41,previousPosition:_0x31076d,newPosition:_0x35254f,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x1f7bea,timestamp:_0x57afa3}){const _0x57cf35=a12_0x45d5;try{const _0x1d9193=doc(collection(db,'eloHistoryD2'));let _0x5a421f='match';if(isPromotion)_0x5a421f='promotion';if(isDemotion)_0x5a421f=_0x57cf35(0x1e2);let _0x41fe19='Unranked';if(_0x328d43>=0x834)_0x41fe19='Emerald';else{if(_0x328d43>=0x708)_0x41fe19=_0x57cf35(0x1e6);else{if(_0x328d43>=0x640)_0x41fe19='Silver';else{if(_0x328d43>=0x578)_0x41fe19='Bronze';}}}return await setDoc(_0x1d9193,{'type':_0x5a421f,'player':_0x348509,'opponent':_0x183cde,'previousElo':_0x3f6c62,'newElo':_0x328d43,'change':_0x328d43-_0x3f6c62,'matchResult':_0x22ab41,'previousPosition':_0x31076d,'newPosition':_0x35254f,'rankAchieved':_0x41fe19,'matchId':_0x1f7bea,'timestamp':_0x57afa3}),console['log']('D2\x20ELO\x20history\x20recorded\x20for\x20'+_0x348509),!![];}catch(_0x2b0a30){console[_0x57cf35(0x1df)]('Error\x20recording\x20D2\x20ELO\x20history:',_0x2b0a30);throw _0x2b0a30;}}export async function getEloHistoryD2(_0x5e2eb6=0x14){const _0x488786=a12_0x45d5;try{const _0x14ad55=collection(db,'eloHistoryD2');let _0x209e0e;lastVisibleD2?_0x209e0e=query(_0x14ad55,orderBy('timestamp','desc'),startAfter(lastVisibleD2),limit(_0x5e2eb6)):_0x209e0e=query(_0x14ad55,orderBy('timestamp','desc'),limit(_0x5e2eb6));const _0x5dda76=await getDocs(_0x209e0e);if(_0x5dda76[_0x488786(0x1e7)])return{'entries':[],'hasMore':![]};lastVisibleD2=_0x5dda76['docs'][_0x5dda76[_0x488786(0x1e8)]['length']-0x1];const _0x2ba8df=_0x5dda76[_0x488786(0x1e8)][_0x488786(0x1ea)](async _0x5808ce=>{const _0x173dc6=_0x5808ce['data'](),[_0x183add,_0x3d4d0a]=await Promise['all']([getUsernameByIdD2(_0x173dc6['player']),getUsernameByIdD2(_0x173dc6['opponent'])]);return{..._0x173dc6,'playerUsername':_0x183add,'opponentUsername':_0x3d4d0a,'change':_0x173dc6['newElo']-_0x173dc6['previousElo'],'timestamp':_0x173dc6['timestamp']};}),_0x3637d9=await Promise['all'](_0x2ba8df);return{'entries':_0x3637d9,'hasMore':_0x5dda76[_0x488786(0x1eb)]===_0x5e2eb6};}catch(_0x4e780b){console[_0x488786(0x1df)](_0x488786(0x1e5),_0x4e780b);throw _0x4e780b;}}export function resetPaginationD2(){lastVisibleD2=null;}function a12_0x58ee(){const _0x1a1f9b=['return\x20(function()\x20','error','loserId','constructor','demotion','console','Unknown\x20Player','Error\x20fetching\x20D2\x20ELO\x20history:','Gold','empty','docs','length','map','size'];a12_0x58ee=function(){return _0x1a1f9b;};return a12_0x58ee();}
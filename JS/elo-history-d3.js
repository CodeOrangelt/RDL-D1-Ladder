const a15_0x27ed06=a15_0x16ad,a15_0x3a9836=(function(){let _0x205838=!![];return function(_0x1b8277,_0x3a4547){const _0x22b8aa=_0x205838?function(){const _0x20892a=a15_0x16ad;if(_0x3a4547){const _0x32ffaf=_0x3a4547[_0x20892a(0x108)](_0x1b8277,arguments);return _0x3a4547=null,_0x32ffaf;}}:function(){};return _0x205838=![],_0x22b8aa;};}()),a15_0x39113d=a15_0x3a9836(this,function(){const _0x45109f=a15_0x16ad;let _0x2f7d59;try{const _0x296a5f=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x2f7d59=_0x296a5f();}catch(_0x270970){_0x2f7d59=window;}const _0x261ed9=_0x2f7d59['console']=_0x2f7d59['console']||{},_0x15c7e0=['log','warn','info','error','exception','table','trace'];for(let _0x419efb=0x0;_0x419efb<_0x15c7e0['length'];_0x419efb++){const _0x281de4=a15_0x3a9836['constructor']['prototype']['bind'](a15_0x3a9836),_0x1d32e4=_0x15c7e0[_0x419efb],_0x51b086=_0x261ed9[_0x1d32e4]||_0x281de4;_0x281de4['__proto__']=a15_0x3a9836[_0x45109f(0x10e)](a15_0x3a9836),_0x281de4[_0x45109f(0x107)]=_0x51b086['toString']['bind'](_0x51b086),_0x261ed9[_0x1d32e4]=_0x281de4;}});a15_0x39113d();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc,where}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D3=[{'name':'Emerald','elo':0x7d0},{'name':a15_0x27ed06(0x113),'elo':0x708},{'name':'Silver','elo':0x640},{'name':'Bronze','elo':0x578},{'name':a15_0x27ed06(0x106),'elo':0x4b0}];function a15_0x16ad(_0x13bc1d,_0x471f08){const _0x39113d=a15_0x6c79();return a15_0x16ad=function(_0x3a9836,_0x2ed529){_0x3a9836=_0x3a9836-0x105;let _0x6c79bf=_0x39113d[_0x3a9836];return _0x6c79bf;},a15_0x16ad(_0x13bc1d,_0x471f08);}let lastVisibleD3=null;async function getUsernameByIdD3(_0x1d8ebc){const _0x6bd51a=a15_0x27ed06;try{if(!_0x1d8ebc)return'Unknown\x20Player';const _0x46364a=await getDoc(doc(db,'playersD3',_0x1d8ebc));if(_0x46364a['exists']())return _0x46364a['data']()['username']||'Unknown\x20Player';const _0x238a51=await getDocs(query(collection(db,_0x6bd51a(0x10d)),where('winnerId','==',_0x1d8ebc),limit(0x1)));if(!_0x238a51[_0x6bd51a(0x114)])return _0x238a51[_0x6bd51a(0x111)][0x0]['data']()['winnerUsername']||'Unknown\x20Player';const _0xde7029=await getDocs(query(collection(db,_0x6bd51a(0x10d)),where('loserId','==',_0x1d8ebc),limit(0x1)));if(!_0xde7029[_0x6bd51a(0x114)])return _0xde7029['docs'][0x0]['data']()['loserUsername']||_0x6bd51a(0x105);return'Unknown\x20Player';}catch(_0x556f4f){return console[_0x6bd51a(0x10c)]('Error\x20getting\x20D3\x20username:',_0x556f4f),'Unknown\x20Player';}}export async function recordEloChangeD3({playerId:_0x1a5309,previousElo:_0x2fb96a,newElo:_0x593f2c,opponentId:_0x5ddfee,matchResult:_0x2904f6,previousPosition:_0x37c240,newPosition:_0x36f3a5,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x2b5bf0,timestamp:_0x5df3c6}){const _0x3bd738=a15_0x27ed06;try{const _0x5a17b8=doc(collection(db,_0x3bd738(0x10a)));let _0x1a1538=_0x3bd738(0x112);if(isPromotion)_0x1a1538='promotion';if(isDemotion)_0x1a1538='demotion';let _0x14bcc8='Unranked';if(_0x593f2c>=0x7d0)_0x14bcc8='Emerald';else{if(_0x593f2c>=0x708)_0x14bcc8=_0x3bd738(0x113);else{if(_0x593f2c>=0x640)_0x14bcc8='Silver';else{if(_0x593f2c>=0x578)_0x14bcc8='Bronze';}}}return await setDoc(_0x5a17b8,{'type':_0x1a1538,'player':_0x1a5309,'opponent':_0x5ddfee,'previousElo':_0x2fb96a,'newElo':_0x593f2c,'change':_0x593f2c-_0x2fb96a,'matchResult':_0x2904f6,'previousPosition':_0x37c240,'newPosition':_0x36f3a5,'rankAchieved':_0x14bcc8,'matchId':_0x2b5bf0,'timestamp':_0x5df3c6||serverTimestamp(),'gameMode':'D3'}),console['log']('D3\x20ELO\x20history\x20recorded\x20for\x20'+_0x1a5309),!![];}catch(_0x473075){console[_0x3bd738(0x10c)]('Error\x20recording\x20D3\x20ELO\x20history:',_0x473075);throw _0x473075;}}function a15_0x6c79(){const _0x54a792=['Unknown\x20Player','Unranked','toString','apply','newElo','eloHistoryD3','size','error','approvedMatchesD3','bind','all','desc','docs','match','Gold','empty'];a15_0x6c79=function(){return _0x54a792;};return a15_0x6c79();}export async function getEloHistoryD3(_0x3d9a5d=0x14){const _0x20ec2f=a15_0x27ed06;try{const _0x18fdae=collection(db,_0x20ec2f(0x10a));let _0x141052;lastVisibleD3?_0x141052=query(_0x18fdae,orderBy('timestamp',_0x20ec2f(0x110)),startAfter(lastVisibleD3),limit(_0x3d9a5d)):_0x141052=query(_0x18fdae,orderBy('timestamp','desc'),limit(_0x3d9a5d));const _0x4efb1a=await getDocs(_0x141052);if(_0x4efb1a['empty'])return{'entries':[],'hasMore':![]};lastVisibleD3=_0x4efb1a[_0x20ec2f(0x111)][_0x4efb1a[_0x20ec2f(0x111)]['length']-0x1];const _0x26dbb9=_0x4efb1a[_0x20ec2f(0x111)]['map'](async _0x5b6d6f=>{const _0x4c193f=_0x20ec2f,_0x3a8ebb=_0x5b6d6f['data'](),[_0x38c688,_0xec8099]=await Promise[_0x4c193f(0x10f)]([getUsernameByIdD3(_0x3a8ebb['player']),getUsernameByIdD3(_0x3a8ebb['opponent'])]);return{..._0x3a8ebb,'playerUsername':_0x38c688,'opponentUsername':_0xec8099,'change':_0x3a8ebb[_0x4c193f(0x109)]-_0x3a8ebb['previousElo'],'timestamp':_0x3a8ebb['timestamp']};}),_0x705eae=await Promise['all'](_0x26dbb9);return{'entries':_0x705eae,'hasMore':_0x4efb1a[_0x20ec2f(0x10b)]===_0x3d9a5d};}catch(_0x56913b){console['error']('Error\x20fetching\x20D3\x20ELO\x20history:',_0x56913b);throw _0x56913b;}}export function resetPaginationD3(){lastVisibleD3=null;}
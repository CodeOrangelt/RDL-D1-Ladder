const a14_0x2c2079=a14_0x3740,a14_0x57203e=(function(){let _0x502c53=!![];return function(_0x7a1b8b,_0x1bcbba){const _0x49d2dc=_0x502c53?function(){if(_0x1bcbba){const _0x22411d=_0x1bcbba['apply'](_0x7a1b8b,arguments);return _0x1bcbba=null,_0x22411d;}}:function(){};return _0x502c53=![],_0x49d2dc;};}()),a14_0x31665d=a14_0x57203e(this,function(){const _0x2ffed0=a14_0x3740,_0x4b9289=function(){let _0x338d8a;try{_0x338d8a=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x94264f){_0x338d8a=window;}return _0x338d8a;},_0x2637f9=_0x4b9289(),_0x59f884=_0x2637f9['console']=_0x2637f9['console']||{},_0x4687e4=['log',_0x2ffed0(0x7f),_0x2ffed0(0x80),'error','exception','table',_0x2ffed0(0x7d)];for(let _0x3f634b=0x0;_0x3f634b<_0x4687e4['length'];_0x3f634b++){const _0x1378a4=a14_0x57203e['constructor']['prototype']['bind'](a14_0x57203e),_0x411265=_0x4687e4[_0x3f634b],_0x195e68=_0x59f884[_0x411265]||_0x1378a4;_0x1378a4['__proto__']=a14_0x57203e[_0x2ffed0(0x87)](a14_0x57203e),_0x1378a4['toString']=_0x195e68[_0x2ffed0(0x92)][_0x2ffed0(0x87)](_0x195e68),_0x59f884[_0x411265]=_0x1378a4;}});a14_0x31665d();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a14_0x3740(_0x590b85,_0x5f0dc4){const _0x31665d=a14_0x3e8f();return a14_0x3740=function(_0x57203e,_0x34b8ea){_0x57203e=_0x57203e-0x7c;let _0x3e8fcd=_0x31665d[_0x57203e];return _0x3e8fcd;},a14_0x3740(_0x590b85,_0x5f0dc4);}import{db}from'./firebase-config.js';function a14_0x3e8f(){const _0x1bf4b2=['Error\x20getting\x20username:','trace','docs','warn','info','empty','Gold','player','newElo','Unranked','previousElo','bind','all','error','Silver','data','demotion','promotion','username','Bronze','desc','Unknown\x20Player','toString'];a14_0x3e8f=function(){return _0x1bf4b2;};return a14_0x3e8f();}const ELO_THRESHOLDS_D2=[{'name':a14_0x2c2079(0x82),'elo':0x708},{'name':a14_0x2c2079(0x8a),'elo':0x640},{'name':'Bronze','elo':0x578},{'name':'Unranked','elo':0x4b0}];let lastVisibleD2=null;async function getUsernameByIdD2(_0x1e6cec){const _0x2baba3=a14_0x2c2079;try{if(!_0x1e6cec)return'Unknown\x20Player';const _0x1bec24=await getDoc(doc(db,'playersD2',_0x1e6cec));if(_0x1bec24['exists']())return _0x1bec24[_0x2baba3(0x8b)]()[_0x2baba3(0x8e)]||_0x2baba3(0x91);const _0xcf8ab4=await getDocs(query(collection(db,'approvedMatchesD2'),where('winnerId','==',_0x1e6cec),limit(0x1)));if(!_0xcf8ab4['empty'])return _0xcf8ab4['docs'][0x0][_0x2baba3(0x8b)]()['winnerUsername']||_0x2baba3(0x91);const _0x126877=await getDocs(query(collection(db,'approvedMatchesD2'),where('loserId','==',_0x1e6cec),limit(0x1)));if(!_0x126877['empty'])return _0x126877['docs'][0x0]['data']()['loserUsername']||'Unknown\x20Player';return'Unknown\x20Player';}catch(_0x2e3ef5){return console['error'](_0x2baba3(0x7c),_0x2e3ef5),'Unknown\x20Player';}}export async function recordEloChangeD2({playerId:_0x5df770,previousElo:_0x259d90,newElo:_0x1dc95d,opponentId:_0x593fc8,matchResult:_0x373099,previousPosition:_0x547663,newPosition:_0x335357,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x1a0b1a,timestamp:_0x54bea8}){const _0x197fe9=a14_0x2c2079;try{const _0x371a14=doc(collection(db,'eloHistoryD2'));let _0x30589b='match';if(isPromotion)_0x30589b=_0x197fe9(0x8d);if(isDemotion)_0x30589b=_0x197fe9(0x8c);let _0x347e71=_0x197fe9(0x85);if(_0x1dc95d>=0x834)_0x347e71='Emerald';else{if(_0x1dc95d>=0x708)_0x347e71='Gold';else{if(_0x1dc95d>=0x640)_0x347e71='Silver';else{if(_0x1dc95d>=0x578)_0x347e71=_0x197fe9(0x8f);}}}return await setDoc(_0x371a14,{'type':_0x30589b,'player':_0x5df770,'opponent':_0x593fc8,'previousElo':_0x259d90,'newElo':_0x1dc95d,'change':_0x1dc95d-_0x259d90,'matchResult':_0x373099,'previousPosition':_0x547663,'newPosition':_0x335357,'rankAchieved':_0x347e71,'matchId':_0x1a0b1a,'timestamp':_0x54bea8}),console['log']('D2\x20ELO\x20history\x20recorded\x20for\x20'+_0x5df770),!![];}catch(_0xa4363){console[_0x197fe9(0x89)]('Error\x20recording\x20D2\x20ELO\x20history:',_0xa4363);throw _0xa4363;}}export async function getEloHistoryD2(_0x5c841d=0x14){const _0x2caf54=a14_0x2c2079;try{const _0x418342=collection(db,'eloHistoryD2');let _0x50148d;lastVisibleD2?_0x50148d=query(_0x418342,orderBy('timestamp','desc'),startAfter(lastVisibleD2),limit(_0x5c841d)):_0x50148d=query(_0x418342,orderBy('timestamp',_0x2caf54(0x90)),limit(_0x5c841d));const _0x51f2d2=await getDocs(_0x50148d);if(_0x51f2d2[_0x2caf54(0x81)])return{'entries':[],'hasMore':![]};lastVisibleD2=_0x51f2d2['docs'][_0x51f2d2['docs']['length']-0x1];const _0xf28477=_0x51f2d2[_0x2caf54(0x7e)]['map'](async _0x5f3b39=>{const _0x3066b4=_0x2caf54,_0x607b75=_0x5f3b39['data'](),[_0x318563,_0x45e6b3]=await Promise[_0x3066b4(0x88)]([getUsernameByIdD2(_0x607b75[_0x3066b4(0x83)]),getUsernameByIdD2(_0x607b75['opponent'])]);return{..._0x607b75,'playerUsername':_0x318563,'opponentUsername':_0x45e6b3,'change':_0x607b75[_0x3066b4(0x84)]-_0x607b75[_0x3066b4(0x86)],'timestamp':_0x607b75['timestamp']};}),_0x30606b=await Promise['all'](_0xf28477);return{'entries':_0x30606b,'hasMore':_0x51f2d2['size']===_0x5c841d};}catch(_0x4bce87){console['error']('Error\x20fetching\x20D2\x20ELO\x20history:',_0x4bce87);throw _0x4bce87;}}export function resetPaginationD2(){lastVisibleD2=null;}
const a58_0x49c208=(function(){let _0x23199e=!![];return function(_0x271346,_0x55f6ab){const _0x3025c7=_0x23199e?function(){if(_0x55f6ab){const _0x2334b7=_0x55f6ab['apply'](_0x271346,arguments);return _0x55f6ab=null,_0x2334b7;}}:function(){};return _0x23199e=![],_0x3025c7;};}()),a58_0x495f71=a58_0x49c208(this,function(){const _0x2c003e=a58_0x3363,_0xc053bd=function(){let _0x1e5f4c;try{_0x1e5f4c=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x20a050){_0x1e5f4c=window;}return _0x1e5f4c;},_0x3cac13=_0xc053bd(),_0x1a043b=_0x3cac13['console']=_0x3cac13['console']||{},_0x362a31=['log','warn','info','error',_0x2c003e(0x97),_0x2c003e(0x91),_0x2c003e(0x9e)];for(let _0x402cd9=0x0;_0x402cd9<_0x362a31[_0x2c003e(0x9d)];_0x402cd9++){const _0x4b5f5f=a58_0x49c208[_0x2c003e(0xa2)]['prototype']['bind'](a58_0x49c208),_0xb18148=_0x362a31[_0x402cd9],_0x428346=_0x1a043b[_0xb18148]||_0x4b5f5f;_0x4b5f5f[_0x2c003e(0x99)]=a58_0x49c208['bind'](a58_0x49c208),_0x4b5f5f[_0x2c003e(0x92)]=_0x428346[_0x2c003e(0x92)]['bind'](_0x428346),_0x1a043b[_0xb18148]=_0x4b5f5f;}});a58_0x495f71();import{doc,getDoc,getDocs,collection}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';function a58_0x42ec(){const _0x281897=['table','toString','error','from','string','purchasedAt','exception','get','__proto__','set','find','now','length','trace','tokens','Error\x20fetching\x20tokens\x20by\x20usernames:','getTime','constructor'];a58_0x42ec=function(){return _0x281897;};return a58_0x42ec();}const tokenCache=new Map(),CACHE_DURATION=0x5*0x3c*0x3e8;export async function getUserTokens(_0x542690){const _0x242733=a58_0x3363,_0x2035e2='tokens_'+_0x542690,_0x1ebcf4=tokenCache[_0x242733(0x98)](_0x2035e2);if(_0x1ebcf4&&Date[_0x242733(0x9c)]()-_0x1ebcf4['timestamp']<CACHE_DURATION)return _0x1ebcf4[_0x242733(0x9f)];try{const _0x295cac=doc(db,'userTokens',_0x542690),_0x528f58=await getDoc(_0x295cac);let _0x2d4a2d=[];return _0x528f58['exists']()&&(_0x2d4a2d=_0x528f58['data']()[_0x242733(0x9f)]||[]),tokenCache[_0x242733(0x9a)](_0x2035e2,{'tokens':_0x2d4a2d,'timestamp':Date['now']()}),_0x2d4a2d;}catch(_0x275f04){return console['error']('Error\x20fetching\x20user\x20tokens:',_0x275f04),[];}}export async function getBulkUserTokens(_0x1beb80){const _0x43f688=new Map(),_0x4ae836=[];_0x1beb80['forEach'](_0x3608a7=>{const _0x45cee1=a58_0x3363,_0x5a7475='tokens_'+_0x3608a7,_0x226d80=tokenCache['get'](_0x5a7475);_0x226d80&&Date['now']()-_0x226d80['timestamp']<CACHE_DURATION?_0x43f688[_0x45cee1(0x9a)](_0x3608a7,_0x226d80['tokens']):_0x4ae836['push'](_0x3608a7);});if(_0x4ae836['length']>0x0)try{const _0x59a007=_0x4ae836['map'](async _0x1f89fa=>{const _0x123f95=a58_0x3363,_0x1807d2=doc(db,'userTokens',_0x1f89fa),_0x387cc3=await getDoc(_0x1807d2);let _0x1d4277=[];_0x387cc3['exists']()&&(_0x1d4277=_0x387cc3['data']()[_0x123f95(0x9f)]||[]);const _0x4125e1='tokens_'+_0x1f89fa;return tokenCache['set'](_0x4125e1,{'tokens':_0x1d4277,'timestamp':Date['now']()}),[_0x1f89fa,_0x1d4277];}),_0x55d9e8=await Promise['all'](_0x59a007);_0x55d9e8['forEach'](([_0x44e51d,_0xadbf6c])=>{_0x43f688['set'](_0x44e51d,_0xadbf6c);});}catch(_0x156d5f){console['error']('Error\x20fetching\x20bulk\x20user\x20tokens:',_0x156d5f);}return _0x43f688;}export async function getTokensByUsernames(_0x21d4b3){const _0x1d0b3b=a58_0x3363,_0x263023=new Map();try{const _0x50b606=collection(db,'userProfiles'),_0x3f950e=await getDocs(_0x50b606),_0x1d673b=new Map();_0x3f950e['forEach'](_0x37e803=>{const _0x1881a6=_0x37e803['data']();_0x1881a6['username']&&_0x21d4b3['includes'](_0x1881a6['username'])&&_0x1d673b['set'](_0x1881a6['username'],_0x37e803['id']);});const _0x25a577=Array[_0x1d0b3b(0x94)](_0x1d673b['values']());if(_0x25a577['length']>0x0){const _0x51083e=await getBulkUserTokens(_0x25a577);_0x1d673b['forEach']((_0x212dd2,_0x13f1a8)=>{const _0x161c30=_0x51083e['get'](_0x212dd2)||[];_0x263023['set'](_0x13f1a8,_0x161c30);});}}catch(_0x16d281){console[_0x1d0b3b(0x93)](_0x1d0b3b(0xa0),_0x16d281);}return _0x263023;}export function clearTokenCache(_0xc7990e=null){if(_0xc7990e){const _0x49af57='tokens_'+_0xc7990e;tokenCache['delete'](_0x49af57),console['log']('🗑️\x20Cleared\x20token\x20cache\x20for\x20user:\x20'+_0xc7990e);}else tokenCache['clear'](),console['log']('🗑️\x20Cleared\x20all\x20token\x20cache');}function a58_0x3363(_0x620630,_0xa563a7){const _0x495f71=a58_0x42ec();return a58_0x3363=function(_0x49c208,_0x54bfdd){_0x49c208=_0x49c208-0x91;let _0x42eccd=_0x495f71[_0x49c208];return _0x42eccd;},a58_0x3363(_0x620630,_0xa563a7);}export async function forceRefreshUserTokens(_0x20097b){return clearTokenCache(_0x20097b),await getUserTokens(_0x20097b);}export function getPrimaryDisplayToken(_0x3a8204){const _0x1afa08=a58_0x3363;if(!_0x3a8204||_0x3a8204['length']===0x0)return null;const _0x24bc15=_0x3a8204[_0x1afa08(0x9b)](_0x421918=>_0x421918['equipped']===!![]);if(_0x24bc15)return _0x24bc15;const _0x5ec20f=[..._0x3a8204]['sort']((_0x57f685,_0x362169)=>{const _0x125de0=_0x1afa08;let _0x3e8943,_0x102997;if(_0x57f685['purchasedAt']){if(_0x57f685['purchasedAt']['seconds'])_0x3e8943=_0x57f685['purchasedAt']['seconds'];else{if(_0x57f685['purchasedAt']instanceof Date)_0x3e8943=_0x57f685['purchasedAt']['getTime']()/0x3e8;else typeof _0x57f685['purchasedAt']===_0x125de0(0x95)?_0x3e8943=new Date(_0x57f685['purchasedAt'])['getTime']()/0x3e8:_0x3e8943=0x0;}}else _0x3e8943=0x0;if(_0x362169['purchasedAt']){if(_0x362169[_0x125de0(0x96)]['seconds'])_0x102997=_0x362169['purchasedAt']['seconds'];else{if(_0x362169['purchasedAt']instanceof Date)_0x102997=_0x362169['purchasedAt'][_0x125de0(0xa1)]()/0x3e8;else typeof _0x362169[_0x125de0(0x96)]==='string'?_0x102997=new Date(_0x362169[_0x125de0(0x96)])['getTime']()/0x3e8:_0x102997=0x0;}}else _0x102997=0x0;return _0x102997-_0x3e8943;});return _0x5ec20f[0x0];}
const a27_0x37ec64=(function(){let _0x387cbd=!![];return function(_0x621cf1,_0x3a86fc){const _0x42e781=_0x387cbd?function(){if(_0x3a86fc){const _0x293929=_0x3a86fc['apply'](_0x621cf1,arguments);return _0x3a86fc=null,_0x293929;}}:function(){};return _0x387cbd=![],_0x42e781;};}()),a27_0x462489=a27_0x37ec64(this,function(){const _0x1c60ae=a27_0x1301;let _0x42949e;try{const _0x3258f9=Function(_0x1c60ae(0x1e3)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x42949e=_0x3258f9();}catch(_0xbde43c){_0x42949e=window;}const _0x30a8df=_0x42949e['console']=_0x42949e['console']||{},_0x2d4750=['log','warn','info',_0x1c60ae(0x1e7),_0x1c60ae(0x1ec),_0x1c60ae(0x1e9),'trace'];for(let _0x23a991=0x0;_0x23a991<_0x2d4750['length'];_0x23a991++){const _0x4ac942=a27_0x37ec64['constructor']['prototype']['bind'](a27_0x37ec64),_0x32aeb2=_0x2d4750[_0x23a991],_0x479f62=_0x30a8df[_0x32aeb2]||_0x4ac942;_0x4ac942['__proto__']=a27_0x37ec64['bind'](a27_0x37ec64),_0x4ac942[_0x1c60ae(0x1de)]=_0x479f62['toString'][_0x1c60ae(0x1eb)](_0x479f62),_0x30a8df[_0x32aeb2]=_0x4ac942;}});a27_0x462489();import{addDoc,updateDoc,serverTimestamp,collection,doc,getDoc,getDocs,query,where,setDoc,deleteDoc,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';function a27_0x1301(_0x235ff6,_0x19c369){const _0x462489=a27_0xdc27();return a27_0x1301=function(_0x37ec64,_0x21838d){_0x37ec64=_0x37ec64-0x1da;let _0xdc27c2=_0x462489[_0x37ec64];return _0xdc27c2;},a27_0x1301(_0x235ff6,_0x19c369);}import{recordEloChangeD3}from'./elo-history-d3.js';export function calculateEloD3(_0x406641,_0x391094,_0x2e5fd8=0x20){const _0x1d8bad=0x1/(0x1+Math['pow'](0xa,(_0x391094-_0x406641)/0x190)),_0x3c466d=0x1/(0x1+Math['pow'](0xa,(_0x406641-_0x391094)/0x190)),_0x1e8f07=_0x406641+_0x2e5fd8*(0x1-_0x1d8bad),_0xb9e02d=_0x391094+_0x2e5fd8*(0x0-_0x3c466d);return{'newWinnerRating':Math['round'](_0x1e8f07),'newLoserRating':Math['round'](_0xb9e02d)};}export async function updateEloRatingsD3(_0x5d1998,_0x3956bf,_0x361f83){const _0x2b8019=a27_0x1301;try{const _0x329d98=writeBatch(db),_0xdbf78e=doc(db,'playersD3',_0x5d1998),_0x4a0a70=doc(db,'playersD3',_0x3956bf),[_0x4c43dc,_0x3dd62b]=await Promise['all']([getDoc(_0xdbf78e),getDoc(_0x4a0a70)]);if(!_0x4c43dc['exists']()||!_0x3dd62b['exists']())throw new Error(_0x2b8019(0x1ee));const _0xec9891=_0x4c43dc[_0x2b8019(0x1db)](),_0x1ecb80=_0x3dd62b['data'](),_0x450b61=_0xec9891[_0x2b8019(0x1e0)]||Number[_0x2b8019(0x1dc)],_0x5935ca=_0x1ecb80[_0x2b8019(0x1e0)]||Number[_0x2b8019(0x1dc)],{newWinnerRating:_0x3597c2,newLoserRating:_0x909382}=calculateEloD3(_0xec9891[_0x2b8019(0x1e4)]||0x4b0,_0x1ecb80['eloRating']||0x4b0);let _0x55a7ce=_0x450b61,_0x415131=_0x5935ca;if(_0x450b61>_0x5935ca){console[_0x2b8019(0x1e8)]('D3\x20Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked'),_0x55a7ce=_0x5935ca,_0x415131=_0x5935ca+0x1;const _0x110d9b=query(collection(db,'playersD3'),where(_0x2b8019(0x1e0),'>',_0x5935ca),where('position','<',_0x450b61)),_0x18be71=await getDocs(_0x110d9b);for(const _0x1bf511 of _0x18be71['docs']){_0x1bf511['id']!==_0x5d1998&&_0x1bf511['id']!==_0x3956bf&&_0x329d98['update'](doc(db,_0x2b8019(0x1ea),_0x1bf511['id']),{'position':_0x1bf511['data']()[_0x2b8019(0x1e0)]+0x1});}}else console['log'](_0x2b8019(0x1ed));return _0x329d98['update'](_0xdbf78e,{'eloRating':_0x3597c2,'lastMatchDate':serverTimestamp(),'position':_0x55a7ce,'lastMatchId':_0x361f83}),_0x329d98['update'](_0x4a0a70,{'eloRating':_0x909382,'lastMatchDate':serverTimestamp(),'position':_0x415131,'lastMatchId':_0x361f83}),await _0x329d98['commit'](),console['log'](_0x2b8019(0x1e5)),await Promise['all']([recordEloChangeD3({'playerId':_0x5d1998,'previousElo':_0xec9891[_0x2b8019(0x1e4)]||0x4b0,'newElo':_0x3597c2,'opponentId':_0x3956bf,'matchResult':'win','previousPosition':_0x450b61,'newPosition':_0x55a7ce,'isPromotion':_0x55a7ce<_0x450b61,'matchId':_0x361f83,'timestamp':serverTimestamp()}),recordEloChangeD3({'playerId':_0x3956bf,'previousElo':_0x1ecb80[_0x2b8019(0x1e4)]||0x4b0,'newElo':_0x909382,'opponentId':_0x5d1998,'matchResult':_0x2b8019(0x1e1),'previousPosition':_0x5935ca,'newPosition':_0x415131,'isDemotion':_0x415131>_0x5935ca,'matchId':_0x361f83,'timestamp':serverTimestamp()})]),!![];}catch(_0x48cb6f){console['error']('Error\x20in\x20updateEloRatingsD3:',_0x48cb6f);throw _0x48cb6f;}}function a27_0xdc27(){const _0x5585a7=['D3\x20Report\x20data:','data','MAX_SAFE_INTEGER','exists','toString','uid','position','loss','Current\x20username:','return\x20(function()\x20','eloRating','D3\x20ELO\x20ratings\x20updated\x20successfully','username','error','log','table','playersD3','bind','exception','D3\x20Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions','One\x20or\x20both\x20D3\x20players\x20not\x20found'];a27_0xdc27=function(){return _0x5585a7;};return a27_0xdc27();}export async function approveReportD3(_0x93f0fe,_0x595cbf,_0x38ff55,_0x251e06){const _0x56612b=a27_0x1301;try{console['log']('Starting\x20approveReportD3\x20function\x20with:',{'reportId':_0x93f0fe,'winnerScore':_0x595cbf,'winnerSuicides':_0x38ff55,'winnerComment':_0x251e06});const _0x246af6=auth['currentUser'];if(!_0x246af6){console['log']('No\x20user\x20logged\x20in');throw new Error('You\x20must\x20be\x20logged\x20in\x20to\x20approve\x20D3\x20matches');}console['log']('Current\x20user:',_0x246af6['email']);const _0x4651d2=await getDoc(doc(db,'playersD3',_0x246af6[_0x56612b(0x1df)])),_0x52bad2=_0x4651d2[_0x56612b(0x1dd)]()?_0x4651d2[_0x56612b(0x1db)]()[_0x56612b(0x1e6)]:null;console['log'](_0x56612b(0x1e2),_0x52bad2);const _0x34fd62=doc(db,'pendingMatchesD3',_0x93f0fe),_0x29cd4a=await getDoc(_0x34fd62);if(!_0x29cd4a['exists']()){console[_0x56612b(0x1e8)]('D3\x20Report\x20not\x20found\x20with\x20ID:',_0x93f0fe);throw new Error('D3\x20match\x20report\x20not\x20found');}const _0x15da72=_0x29cd4a['data']();console['log'](_0x56612b(0x1da),_0x15da72);if(_0x52bad2!==_0x15da72['winnerUsername'])throw new Error('Only\x20the\x20winner\x20can\x20approve\x20D3\x20matches');const _0xb82694={..._0x15da72,'winnerScore':_0x595cbf,'winnerSuicides':_0x38ff55,'winnerComment':_0x251e06,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':_0x52bad2,'createdAt':_0x15da72['createdAt']||serverTimestamp(),'winnerUsername':_0x15da72['winnerUsername'],'loserUsername':_0x15da72['loserUsername']};await setDoc(doc(db,'approvedMatchesD3',_0x93f0fe),_0xb82694),await deleteDoc(_0x34fd62),console['log']('D3\x20Match\x20moved\x20to\x20approved\x20collection');const [_0x4731b1,_0x160543]=await Promise['all']([getDocs(query(collection(db,_0x56612b(0x1ea)),where(_0x56612b(0x1e6),'==',_0x15da72['winnerUsername']))),getDocs(query(collection(db,'playersD3'),where('username','==',_0x15da72['loserUsername'])))]);if(_0x4731b1['empty']||_0x160543['empty'])throw new Error('Could\x20not\x20find\x20D3\x20player\x20documents');const _0x55cc3f=_0x4731b1['docs'][0x0]['id'],_0x306b54=_0x160543['docs'][0x0]['id'];return await updateEloRatingsD3(_0x55cc3f,_0x306b54,_0x93f0fe),console[_0x56612b(0x1e8)]('D3\x20Match\x20successfully\x20approved\x20and\x20ELO\x20updated'),!![];}catch(_0x4f6073){console[_0x56612b(0x1e7)]('Error\x20in\x20approveReportD3:',_0x4f6073);throw _0x4f6073;}}
function a29_0x4c41(){const _0x38f1c7=['all','2812236QNGahW','trace','(((.+)+)+)+$','__proto__','empty','win','constructor','docs','round','bind','pendingMatchesD3','Could\x20not\x20find\x20D3\x20player\x20documents','approvedMatchesD3','search','Current\x20username:','prototype','email','D3\x20Report\x20data:','table','error','exists','eloRating','return\x20(function()\x20','No\x20user\x20logged\x20in','username','playersD3','D3\x20Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked','MAX_SAFE_INTEGER','D3\x20Match\x20moved\x20to\x20approved\x20collection','winnerUsername','update','Starting\x20approveReportD3\x20function\x20with:','toString','222927ZKCyvu','3087054SzbtGY','264136QcDjIq','pow','D3\x20Match\x20successfully\x20approved\x20and\x20ELO\x20updated','D3\x20ELO\x20ratings\x20updated\x20successfully','{}.constructor(\x22return\x20this\x22)(\x20)','41JNPfok','1427940QudMJK','6347448qOFDPG','uid','Error\x20in\x20approveReportD3:','Only\x20the\x20winner\x20can\x20approve\x20D3\x20matches','loserUsername','D3\x20Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions','warn','You\x20must\x20be\x20logged\x20in\x20to\x20approve\x20D3\x20matches','apply','12BwKhSY','commit','data','createdAt','Error\x20in\x20updateEloRatingsD3:','position','26450JNfDTW','info','console','loss','log'];a29_0x4c41=function(){return _0x38f1c7;};return a29_0x4c41();}(function(_0xc79aeb,_0x24c6f6){const _0x3abf80=a29_0x3fcb,_0x400ad2=_0xc79aeb();while(!![]){try{const _0x29779d=-parseInt(_0x3abf80(0xfe))/0x1*(-parseInt(_0x3abf80(0x10f))/0x2)+-parseInt(_0x3abf80(0x136))/0x3*(parseInt(_0x3abf80(0x109))/0x4)+parseInt(_0x3abf80(0xff))/0x5+-parseInt(_0x3abf80(0x137))/0x6+-parseInt(_0x3abf80(0x115))/0x7+-parseInt(_0x3abf80(0x138))/0x8+parseInt(_0x3abf80(0x100))/0x9;if(_0x29779d===_0x24c6f6)break;else _0x400ad2['push'](_0x400ad2['shift']());}catch(_0x5cf348){_0x400ad2['push'](_0x400ad2['shift']());}}}(a29_0x4c41,0x581b4));function a29_0x3fcb(_0x42ccfc,_0x5e67b5){const _0x41051d=a29_0x4c41();return a29_0x3fcb=function(_0x37eee9,_0x167376){_0x37eee9=_0x37eee9-0xfa;let _0x11826b=_0x41051d[_0x37eee9];return _0x11826b;},a29_0x3fcb(_0x42ccfc,_0x5e67b5);}const a29_0x52b4fb=(function(){let _0x13e253=!![];return function(_0x8fc0d9,_0x10ec16){const _0x1e457b=_0x13e253?function(){const _0x2df0de=a29_0x3fcb;if(_0x10ec16){const _0x2fa4e4=_0x10ec16[_0x2df0de(0x108)](_0x8fc0d9,arguments);return _0x10ec16=null,_0x2fa4e4;}}:function(){};return _0x13e253=![],_0x1e457b;};}()),a29_0x18726e=a29_0x52b4fb(this,function(){const _0x1739ed=a29_0x3fcb;return a29_0x18726e[_0x1739ed(0x135)]()[_0x1739ed(0x122)](_0x1739ed(0x117))['toString']()['constructor'](a29_0x18726e)[_0x1739ed(0x122)]('(((.+)+)+)+$');});a29_0x18726e();const a29_0x167376=(function(){let _0x53a245=!![];return function(_0x2232bd,_0x120731){const _0x4230e3=_0x53a245?function(){if(_0x120731){const _0x23f3f6=_0x120731['apply'](_0x2232bd,arguments);return _0x120731=null,_0x23f3f6;}}:function(){};return _0x53a245=![],_0x4230e3;};}()),a29_0x37eee9=a29_0x167376(this,function(){const _0x1df078=a29_0x3fcb;let _0x2cde72;try{const _0x451f49=Function(_0x1df078(0x12b)+_0x1df078(0xfd)+');');_0x2cde72=_0x451f49();}catch(_0x240c52){_0x2cde72=window;}const _0x5b6b94=_0x2cde72[_0x1df078(0x111)]=_0x2cde72[_0x1df078(0x111)]||{},_0x2d3887=['log',_0x1df078(0x106),_0x1df078(0x110),_0x1df078(0x128),'exception',_0x1df078(0x127),_0x1df078(0x116)];for(let _0x330812=0x0;_0x330812<_0x2d3887['length'];_0x330812++){const _0x1eae89=a29_0x167376[_0x1df078(0x11b)][_0x1df078(0x124)][_0x1df078(0x11e)](a29_0x167376),_0xfa2539=_0x2d3887[_0x330812],_0x29a56e=_0x5b6b94[_0xfa2539]||_0x1eae89;_0x1eae89[_0x1df078(0x118)]=a29_0x167376[_0x1df078(0x11e)](a29_0x167376),_0x1eae89[_0x1df078(0x135)]=_0x29a56e[_0x1df078(0x135)][_0x1df078(0x11e)](_0x29a56e),_0x5b6b94[_0xfa2539]=_0x1eae89;}});a29_0x37eee9();import{addDoc,updateDoc,serverTimestamp,collection,doc,getDoc,getDocs,query,where,setDoc,deleteDoc,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';import{recordEloChangeD3}from'./elo-history-d3.js';export function calculateEloD3(_0x53c831,_0x3a0cdb,_0x46bd6c=0x20){const _0x2e10e6=a29_0x3fcb,_0x4b10f2=0x1/(0x1+Math[_0x2e10e6(0xfa)](0xa,(_0x3a0cdb-_0x53c831)/0x190)),_0x58fb67=0x1/(0x1+Math['pow'](0xa,(_0x53c831-_0x3a0cdb)/0x190)),_0x454aa7=_0x53c831+_0x46bd6c*(0x1-_0x4b10f2),_0x1db28a=_0x3a0cdb+_0x46bd6c*(0x0-_0x58fb67);return{'newWinnerRating':Math[_0x2e10e6(0x11d)](_0x454aa7),'newLoserRating':Math['round'](_0x1db28a)};}export async function updateEloRatingsD3(_0x5a79fe,_0x4e538f,_0x351299){const _0x48b023=a29_0x3fcb;try{const _0x1cb5bf=writeBatch(db),_0x131833=doc(db,_0x48b023(0x12e),_0x5a79fe),_0x347ff4=doc(db,_0x48b023(0x12e),_0x4e538f),[_0x18a970,_0x2d5ff2]=await Promise[_0x48b023(0x114)]([getDoc(_0x131833),getDoc(_0x347ff4)]);if(!_0x18a970[_0x48b023(0x129)]()||!_0x2d5ff2['exists']())throw new Error('One\x20or\x20both\x20D3\x20players\x20not\x20found');const _0x15a803=_0x18a970['data'](),_0x5a3e2a=_0x2d5ff2[_0x48b023(0x10b)](),_0x29e294=_0x15a803['position']||Number[_0x48b023(0x130)],_0x23b4a7=_0x5a3e2a[_0x48b023(0x10e)]||Number[_0x48b023(0x130)],{newWinnerRating:_0x3164b5,newLoserRating:_0x4f6f8b}=calculateEloD3(_0x15a803[_0x48b023(0x12a)]||0x4b0,_0x5a3e2a[_0x48b023(0x12a)]||0x4b0);let _0x1e3303=_0x29e294,_0x538625=_0x23b4a7;if(_0x29e294>_0x23b4a7){console[_0x48b023(0x113)](_0x48b023(0x12f)),_0x1e3303=_0x23b4a7,_0x538625=_0x23b4a7+0x1;const _0x597c6d=query(collection(db,_0x48b023(0x12e)),where(_0x48b023(0x10e),'>',_0x23b4a7),where(_0x48b023(0x10e),'<',_0x29e294)),_0x66a3c6=await getDocs(_0x597c6d);for(const _0x41ace6 of _0x66a3c6[_0x48b023(0x11c)]){_0x41ace6['id']!==_0x5a79fe&&_0x41ace6['id']!==_0x4e538f&&_0x1cb5bf[_0x48b023(0x133)](doc(db,_0x48b023(0x12e),_0x41ace6['id']),{'position':_0x41ace6[_0x48b023(0x10b)]()[_0x48b023(0x10e)]+0x1});}}else console[_0x48b023(0x113)](_0x48b023(0x105));return _0x1cb5bf[_0x48b023(0x133)](_0x131833,{'eloRating':_0x3164b5,'lastMatchDate':serverTimestamp(),'position':_0x1e3303,'lastMatchId':_0x351299}),_0x1cb5bf[_0x48b023(0x133)](_0x347ff4,{'eloRating':_0x4f6f8b,'lastMatchDate':serverTimestamp(),'position':_0x538625,'lastMatchId':_0x351299}),await _0x1cb5bf[_0x48b023(0x10a)](),console['log'](_0x48b023(0xfc)),await Promise[_0x48b023(0x114)]([recordEloChangeD3({'playerId':_0x5a79fe,'previousElo':_0x15a803['eloRating']||0x4b0,'newElo':_0x3164b5,'opponentId':_0x4e538f,'matchResult':_0x48b023(0x11a),'previousPosition':_0x29e294,'newPosition':_0x1e3303,'isPromotion':_0x1e3303<_0x29e294,'matchId':_0x351299,'timestamp':serverTimestamp()}),recordEloChangeD3({'playerId':_0x4e538f,'previousElo':_0x5a3e2a[_0x48b023(0x12a)]||0x4b0,'newElo':_0x4f6f8b,'opponentId':_0x5a79fe,'matchResult':_0x48b023(0x112),'previousPosition':_0x23b4a7,'newPosition':_0x538625,'isDemotion':_0x538625>_0x23b4a7,'matchId':_0x351299,'timestamp':serverTimestamp()})]),!![];}catch(_0x7cbddf){console[_0x48b023(0x128)](_0x48b023(0x10d),_0x7cbddf);throw _0x7cbddf;}}export async function approveReportD3(_0xb69593,_0x499211,_0x182e28,_0x39a1c5){const _0x3f8bf6=a29_0x3fcb;try{console['log'](_0x3f8bf6(0x134),{'reportId':_0xb69593,'winnerScore':_0x499211,'winnerSuicides':_0x182e28,'winnerComment':_0x39a1c5});const _0x51fdbd=auth['currentUser'];if(!_0x51fdbd){console[_0x3f8bf6(0x113)](_0x3f8bf6(0x12c));throw new Error(_0x3f8bf6(0x107));}console[_0x3f8bf6(0x113)]('Current\x20user:',_0x51fdbd[_0x3f8bf6(0x125)]);const _0x52c431=await getDoc(doc(db,_0x3f8bf6(0x12e),_0x51fdbd[_0x3f8bf6(0x101)])),_0x3909ac=_0x52c431['exists']()?_0x52c431[_0x3f8bf6(0x10b)]()[_0x3f8bf6(0x12d)]:null;console[_0x3f8bf6(0x113)](_0x3f8bf6(0x123),_0x3909ac);const _0x1baf7c=doc(db,_0x3f8bf6(0x11f),_0xb69593),_0x52dcf0=await getDoc(_0x1baf7c);if(!_0x52dcf0['exists']()){console[_0x3f8bf6(0x113)]('D3\x20Report\x20not\x20found\x20with\x20ID:',_0xb69593);throw new Error('D3\x20match\x20report\x20not\x20found');}const _0x1146c9=_0x52dcf0[_0x3f8bf6(0x10b)]();console['log'](_0x3f8bf6(0x126),_0x1146c9);if(_0x3909ac!==_0x1146c9[_0x3f8bf6(0x132)])throw new Error(_0x3f8bf6(0x103));const _0x2e07ae={..._0x1146c9,'winnerScore':_0x499211,'winnerSuicides':_0x182e28,'winnerComment':_0x39a1c5,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':_0x3909ac,'createdAt':_0x1146c9[_0x3f8bf6(0x10c)]||serverTimestamp(),'winnerUsername':_0x1146c9[_0x3f8bf6(0x132)],'loserUsername':_0x1146c9[_0x3f8bf6(0x104)]};await setDoc(doc(db,_0x3f8bf6(0x121),_0xb69593),_0x2e07ae),await deleteDoc(_0x1baf7c),console[_0x3f8bf6(0x113)](_0x3f8bf6(0x131));const [_0x3e095d,_0x210b46]=await Promise[_0x3f8bf6(0x114)]([getDocs(query(collection(db,_0x3f8bf6(0x12e)),where(_0x3f8bf6(0x12d),'==',_0x1146c9[_0x3f8bf6(0x132)]))),getDocs(query(collection(db,'playersD3'),where('username','==',_0x1146c9[_0x3f8bf6(0x104)])))]);if(_0x3e095d[_0x3f8bf6(0x119)]||_0x210b46[_0x3f8bf6(0x119)])throw new Error(_0x3f8bf6(0x120));const _0x1e33d2=_0x3e095d['docs'][0x0]['id'],_0xcfa853=_0x210b46['docs'][0x0]['id'];return await updateEloRatingsD3(_0x1e33d2,_0xcfa853,_0xb69593),console[_0x3f8bf6(0x113)](_0x3f8bf6(0xfb)),!![];}catch(_0x113798){console[_0x3f8bf6(0x128)](_0x3f8bf6(0x102),_0x113798);throw _0x113798;}}
const a33w=a33d;(function(a,b){const s=a33d,c=a();while(!![]){try{const d=-parseInt(s(0xef))/0x1*(-parseInt(s(0x90))/0x2)+parseInt(s(0x98))/0x3+-parseInt(s(0x9a))/0x4*(parseInt(s(0xcb))/0x5)+-parseInt(s(0xad))/0x6+parseInt(s(0xe6))/0x7*(-parseInt(s(0xd1))/0x8)+-parseInt(s(0x94))/0x9+-parseInt(s(0x9f))/0xa*(-parseInt(s(0x9d))/0xb);if(d===b)break;else c['push'](c['shift']());}catch(e){c['push'](c['shift']());}}}(a33c,0xcf912));const a33b=(function(){let a=!![];return function(b,c){const d=a?function(){const t=a33d;if(c){const e=c[t(0x91)](b,arguments);return c=null,e;}}:function(){};return a=![],d;};}()),a33a=a33b(this,function(){const v=a33d,a=function(){const u=a33d;let f;try{f=Function('return\x20(function()\x20'+u(0xbf)+');')();}catch(g){f=window;}return f;},b=a(),c=b[v(0xbb)]=b[v(0xbb)]||{},d=[v(0xf1),'warn','info','error','exception','table',v(0xf6)];for(let e=0x0;e<d['length'];e++){const f=a33b['constructor'][v(0xa2)][v(0xee)](a33b),g=d[e],h=c[g]||f;f['__proto__']=a33b[v(0xee)](a33b),f['toString']=h['toString']['bind'](h),c[g]=f;}});a33a();import{collection,getDocs,deleteDoc,doc,getDoc,query,where,updateDoc,Timestamp,onSnapshot,orderBy,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import{getRankStyle}from'./ranks.js';import a33e from'./firebase-idle-wrapper.js';const styleEl=document['createElement']('style');styleEl['textContent']='\x0a\x20\x20.streak-indicator\x20{\x0a\x20\x20\x20\x20font-size:\x200.9em;\x0a\x20\x20\x20\x20color:\x20#FF4500;\x0a\x20\x20\x20\x20margin-left:\x205px;\x0a\x20\x20\x20\x20font-weight:\x20bold;\x0a\x20\x20}\x0a',document[a33w(0xfc)][a33w(0xdb)](styleEl);const playerCacheD3={'data':null,'timestamp':0x0},CACHE_DURATION=0x7530;function a33c(){const S=['ndeZotK3mfflDNnwDq','mc44nwvT','rdm6ieXVB2TPBMCGzM9YievmtYbJAgfUz2vZigzVCIb1C2vYCZO','C2v0','DxnLCLbYB2zPBgvZ','zwXVsgLZDg9YEq','pgLTzYbZCMm9iI4Ul2LTywDLCY9MBgfNCY8','rxjYB3iGBg9HzgLUzYbemYbSywrKzxi6','C29YDa','Bg9ZzxjvC2vYBMfTzq','C3rYAw5N','CgXHEwvY','z2v0','jMXHzgrLCJ1KmYiGcIaGicaGicaGicaGicaGicaGicbZDhLSzt0Iy29SB3i6ia','y29UC29Szq','yM9Sza','pc9ZCgfUpGOGicaGicaGicaGicaGicaGphnWyw4Gy2XHC3m9iNrYzw5KlwLUzgLJyxrVCIiGC3r5Bgu9iM1HCMDPBI1Szwz0oIa1ChG7iJ48l3nWyw4+cIaGicaGicaGicaGidWVzgL2pGOGicaGicaGidWVDgq+cIaGicaGicaGphrKpG','CgLSB3q','E30Uy29UC3rYDwn0B3iOiNjLDhvYBIb0AgLZiIKOicK','AM9PBG','ievmtYbJAgfUz2u6ia','D2LUBMvYvxnLCM5HBwu','Aw5Uzxjive1m','rdmGtgfKzgvYihrHyMXLigjVzhKGBM90igzVDw5K','DgHLBG','Dg9gAxHLza','zNjVBq','igvUDhjPzxmGAw4GzwXVsgLZDg9YEuqZ','z2fTzu1Vzgu','ChvZAa','mJi0mgndwMT3Bq','rxjYB3iGzMv0y2HPBMCGyMf0y2GGBwf0y2GGC3rHDhmGzM9YieqZoG','DxnLCM5HBwu','Dg90ywXlAwXSCW','BMv3rwXV','CxvLCNLtzwXLy3rVCG','mZeYntzXqwfpCKK','zw50CMLLCW','zwXVsgLZDg9YEuqZ','rdm6ievYCM9YigzLDgnOAw5NievmtYbOAxn0B3j5oG','zxjYB3i','y2vPBa','zMLUza','ywjZ','zM9YrwfJAa','A2rH','yxbWzw5Kq2HPBgq','y2HHBMDL','CgXHEwvYvxnLCM5HBwu','CgXHEwvYswq','i2XHzgrLCI1KmYb0yM9KEq','zMLYC3rqBgfJzurHDgu','Cg9ZAxrPB24','Dg9eyxrL','ChjLDMLVDxnfBg8','zM9UDfDLAwDODa','Aw5SAw5L','ntm5BfPyvwri','z3jHEq','cIaGicaGicaGicaGicaGica8l3rKpGOGicaGicaGicaGica8l3rYpGOGicaGicaGia','Bg9ZC2vZ','Dg90ywXnyxrJAgvZ','BM93','yxbWCM92zwrnyxrJAgvZrdm','ihbSyxLLCNm','yMLUza','nJe0ntDTqw9YtKK','Aw5JBhvKzxm','Bg9N','AgfZ','C3r5Bgu','cIaGicaGicaGicaGicaGica8l2e+cIaGicaGicaGicaGicaGica','y291BNrYEq','DhjHy2u','i0y0ndmZnG','DgLTzxn0yw1W','cIaGicaGicaGicaGidX0CJ4kicaGicaGicaGicaGicaGidX0zcbJB2XZCgfUpsi4iIbZDhLSzt0IDgv4Dc1HBgLNBJOGy2vUDgvYoYbJB2XVCJOGCMvKoYi+cIaGicaGicaGicaGicaGicaGicaGrxjYB3iGBg9HzgLUzYbemYbSywrKzxiGzgf0ytOG','rdm6iezVDw5Kia','i0zgrdCWma','AgvHza','Dg90ywXezwf0Ahm','mJbmthnZzfO','yxbWBhK','D2LUBMvYu2nVCMu','C2L6zq','odaXmZu3m0LowKnmrq','zw1WDhK','igzHBgXIywnRigvUDhjPzxm','zgvZyW','mtiZmtuYmuTsqw9fDG','q291BgqGBM90igzPBMqGD2LUBMvYig9YigXVC2vYigLUieqZihbSyxLLCNmGBgLZDa','mta1odrKtM16re4','DMLZAwjSzq','CxvLCNLtzwXLy3rVCKfSBa','ode3m0fVrhbwAG','zgf0yq','mZG5mJb6vhnABKm','i0nen0yZmG','pc90zd4kicaGicaGica8Dgq+','ChjVDg90ExbL','Dg9mB3DLCKnHC2u','BwfW','rdm6iezPBMfSievmtYbJAgfUz2vZoG','Dgq6BNrOlwnOAwXKkdmP','CgXHEwvYC0qZ','i2XHzgrLCI1KmYb0AgvHzcb0CG','cIaGicaGicaGphrOpLjHBMS8l3rOpGOGicaGicaGidX0Ad5vC2vYBMfTztWVDgG+cIaGicaGicaGphrOpKvmtZWVDgG+cIaGicaGicaGphrOpK1HDgnOzxm8l3rOpGOGicaGicaGidX0Ad5xAw5Zpc90Ad4kicaGicaGica8DgG+tg9ZC2vZpc90Ad4kicaGicaGica8DgG+sY9epc90Ad4kicaGicaGica8DgG+v2LUifjHDgu8l3rOpGOGicaG','lNrYzw5KlwLUzgLJyxrVCG','rdm6ia','cIaGica8Dhi+cIaGicaGicaGphrKpG'];a33c=function(){return S;};return a33c();}async function displayLadderD3(a=![]){const x=a33w,b=document['querySelector']('#ladder-d3\x20tbody');if(!b){console['error'](x(0xc4));return;}b[x(0xc3)]='<tr><td\x20colspan=\x228\x22\x20class=\x22loading-cell\x22>Loading\x20D3\x20ladder\x20data...</td></tr>';try{const c=Date['now']();if(!a&&playerCacheD3[x(0x9e)]&&c-playerCacheD3['timestamp']<CACHE_DURATION){updateLadderDisplayD3(playerCacheD3['data']);return;}const d=collection(db,x(0xa7)),e=await getDocs(d),f=[];e[x(0xd9)](l=>{const y=x,m=l[y(0x9e)]();m[y(0xcd)]&&f[y(0xca)]({...m,'id':l['id'],'elo':m['eloRating']||0x0,'position':m[y(0xe1)]||Number['MAX_SAFE_INTEGER']});});const g=collection(db,x(0xb1)),h=await getDocs(g),i=new Map();h['forEach'](l=>{const z=x,m=l[z(0x9e)]();m['username']&&i[z(0xb0)](m[z(0xcd)]['toLowerCase'](),m);});for(const l of f){const m=l[x(0xcd)][x(0xa3)]();if(i['has'](m)){const n=i['get'](m);n[x(0xf5)]&&(l['country']=n[x(0xf5)]['toLowerCase']());}}const j=f[x(0xa4)](o=>o[x(0xcd)]),k=await fetchBatchMatchStatsD3(j);f[x(0xb5)]((o,p)=>{const A=x,q=k[A(0xb9)](o['username'])?.['totalMatches']||0x0,r=k['get'](p['username'])?.[A(0xea)]||0x0;if(q===0x0!==(r===0x0))return q===0x0?0x1:-0x1;return(o[A(0xe1)]||0x3e7)-(p['position']||0x3e7);}),f[x(0xd9)]((o,p)=>{const B=x;o[B(0xe1)]=p+0x1;}),playerCacheD3[x(0x9e)]=f,playerCacheD3[x(0xf8)]=c,updateLadderDisplayD3(f);}catch(o){console[x(0xd5)](x(0xb4),o),b['innerHTML']=x(0xf9)+o['message']+x(0xe8);}}function calculateStreakDays(a){const C=a33w;if(!a)return 0x0;const b=a[C(0xe2)](),c=new Date(),d=Math[C(0xd8)](c-b);return Math[C(0xd6)](d/(0x3e8*0x3c*0x3c*0x18));}function a33d(a,b){const c=a33c();return a33d=function(d,e){d=d-0x8f;let f=c[d];if(a33d['ZaYPaN']===undefined){var g=function(l){const m='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let n='',o='';for(let p=0x0,q,r,s=0x0;r=l['charAt'](s++);~r&&(q=p%0x4?q*0x40+r:r,p++%0x4)?n+=String['fromCharCode'](0xff&q>>(-0x2*p&0x6)):0x0){r=m['indexOf'](r);}for(let t=0x0,u=n['length'];t<u;t++){o+='%'+('00'+n['charCodeAt'](t)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(o);};a33d['bGrNGN']=g,a=arguments,a33d['ZaYPaN']=!![];}const h=c[0x0],i=d+h,j=a[i];return!j?(f=a33d['bGrNGN'](f),a[i]=f):f=j,f;},a33d(a,b);}async function updatePlayerPositions(a,b){const D=a33w;try{const c=collection(db,D(0xa7)),d=await getDocs(c),e=[];d[D(0xd9)](h=>{e['push']({'id':h['id'],...h['data']()});});const f=e['find'](h=>h[D(0xcd)]===a),g=e[D(0xd7)](h=>h['username']===b);if(!f||!g){console[D(0xd5)](D(0x99));return;}if(f[D(0xe1)]>g[D(0xe1)]){const h=g['position'];for(const i of e){i['position']>=g['position']&&i['position']<f[D(0xe1)]&&i[D(0xcd)]!==a&&await updateDoc(doc(db,'playersD3',i['id']),{'position':i[D(0xe1)]+0x1});}await updateDoc(doc(db,D(0xa7),f['id']),{'position':h});if(h===0x1){const j=doc(db,'playersD3',f['id']),k=await getDoc(j);!k['data']()[D(0xe0)]&&await updateDoc(j,{'firstPlaceDate':Timestamp[D(0xeb)]()});}if(g[D(0xe1)]===0x1){const l=doc(db,D(0xa7),g['id']);await updateDoc(l,{'firstPlaceDate':null});}}}catch(m){console['error']('Error\x20updating\x20D3\x20player\x20positions:',m);}}async function updateLadderDisplayD3(a){const E=a33w;a[E(0xb5)]((g,h)=>g[E(0xe1)]-h[E(0xe1)]);const b=document[E(0xd0)](E(0xdf));if(!b)return;b[E(0xc3)]='';const c=a[E(0xa4)](g=>g['username']),d=await fetchBatchMatchStatsD3(c),e=document['querySelector'](E(0xa8));e['innerHTML']=E(0xa9);const f=a[E(0xa4)](g=>{const F=E,h=d[F(0xb9)](g['username'])||{'totalMatches':0x0,'wins':0x0,'losses':0x0,'kda':0x0,'winRate':0x0,'totalKills':0x0,'totalDeaths':0x0};return createPlayerRowD3(g,h);})[E(0xc0)]('');b['innerHTML']=f,getPlayersLastEloChangesD3(c)[E(0xc5)](g=>{const G=E,h=new Map();b[G(0x9c)]('tr')['forEach']((i,j)=>{const H=G;j<c['length']&&h[H(0xb0)](c[j],i);}),g[G(0xd9)]((i,j)=>{const I=G,k=h['get'](j);if(k&&i!==0x0){const l=k['querySelector'](I(0xa6));if(l){const m=i>0x0?'+'+i:''+i,n=l[I(0xd0)](I(0xaa));n&&(n['textContent']=m,n['style']['color']=i>0x0?'#4CAF50':I(0xf7),n['style'][I(0xe4)]=I(0xbc),n[I(0xf3)]['fontSize']=I(0xae),n['style']['display']=I(0xe5),n['style']['visibility']=I(0x9b),n['style']['opacity']='1');}}});})['catch'](g=>console['error']('Error\x20updating\x20D3\x20ELO\x20trend\x20indicators:',g));}async function fetchBatchMatchStatsD3(a){const J=a33w,b=new Map();try{const c=collection(db,J(0xec)),d=await getDocs(c);d[J(0xd9)](e=>{const K=J,f=e['data']();if(a[K(0xf0)](f[K(0xc2)])){const g=f[K(0xc2)];!b['has'](g)&&b[K(0xb0)](g,{'totalMatches':0x0,'wins':0x0,'losses':0x0,'totalKills':0x0,'totalDeaths':0x0,'kda':0x0,'winRate':0x0});const h=b[K(0xb9)](g);h['wins']++,h[K(0xea)]++,h['totalKills']+=parseInt(f[K(0x92)])||0x0,h[K(0x8f)]+=parseInt(f['loserScore'])||0x0;}if(a['includes'](f[K(0xb6)])){const i=f['loserUsername'];!b['has'](i)&&b['set'](i,{'totalMatches':0x0,'wins':0x0,'losses':0x0,'totalKills':0x0,'totalDeaths':0x0,'kda':0x0,'winRate':0x0});const j=b['get'](i);j[K(0xe9)]++,j['totalMatches']++,j[K(0xce)]+=parseInt(f['loserScore'])||0x0,j[K(0x8f)]+=parseInt(f[K(0x92)])||0x0;}}),b[J(0xd9)](e=>{const L=J;e[L(0xda)]=e['totalDeaths']>0x0?(e['totalKills']/e['totalDeaths'])[L(0xc6)](0x2):e['totalKills'],e['winRate']=e['totalMatches']>0x0?(e['wins']/e['totalMatches']*0x64)['toFixed'](0x1):0x0;});}catch(e){console['error'](J(0xcc),e);}return b;}function createPlayerRowD3(a,b){const M=a33w,c=parseFloat(a['elo'])||0x0;let d=M(0xe7);if(c>=0x7d0)d='#50C878';else{if(c>=0x708)d=M(0xfb);else{if(c>=0x640)d='#C0C0C0';else c>=0x578&&(d=M(0xa0));}}let e='';return a['country']&&(e=M(0xb3)+a[M(0xf5)][M(0xa3)]()+'.png\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20alt=\x22'+a[M(0xf5)]+'\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20class=\x22player-flag\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20onerror=\x22this.style.display=\x27none\x27\x22>'),M(0xac)+a[M(0xe1)]+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td\x20style=\x22position:\x20relative;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20position:\x20relative;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username='+encodeURIComponent(a['username'])+M(0xba)+d+';\x20text-decoration:\x20none;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+a['username']+M(0xf4)+e+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td\x20style=\x22color:\x20'+d+';\x20position:\x20relative;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22elo-container\x22\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22elo-value\x22>'+c+M(0xbd)+b['totalMatches']+M(0xa1)+b['wins']+M(0xa1)+b[M(0xe9)]+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+b[M(0xda)]+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+b['winRate']+'%</td>\x0a\x20\x20\x20\x20</tr>';}async function getPlayersLastEloChangesD3(a){const N=a33w,b=new Map();a['forEach'](c=>b[N(0xb0)](c,0x0));try{console['log'](N(0xaf),a);const c=new Map(),d=await getDocs(collection(db,N(0xa7)));d['forEach'](j=>{const O=N,k=j[O(0x9e)]();k[O(0xcd)]&&c[O(0xb0)](j['id'],k['username']);}),console[N(0xf1)]('D3:\x20Player\x20ID\x20mappings:',Array['from'](c['entries']()));const e=collection(db,N(0xd3)),f=query(e,orderBy('timestamp',N(0x97)),limit(0x64)),g=await getDocs(f);g[N(0x95)]?console[N(0xf1)]('D3:\x20eloHistoryD3\x20is\x20empty,\x20trying\x20fallback...'):console['log']('D3:\x20Found\x20'+g[N(0x93)]+N(0xc8));const h=new Map();g[N(0xd9)](j=>{const P=N,k=j[P(0x9e)]();let l=null;if(k[P(0xcd)])l=k[P(0xcd)];else{if(k[P(0xdd)])l=k[P(0xdd)];else{if(k[P(0xb8)]&&typeof k[P(0xb8)]===P(0xb7))l=k[P(0xb8)];else{if(k['player']&&c['has'](k[P(0xb8)]))l=c['get'](k['player']);else k['playerId']&&c['has'](k[P(0xde)])&&(l=c['get'](k[P(0xde)]));}}}(k[P(0xcd)]===P(0xbe)||k[P(0xdd)]===P(0xbe)||k['player']&&c[P(0xb9)](k['player'])===P(0xbe))&&console[P(0xf1)]('D3:\x20Found\x20pilot\x20entry:',k),l&&a['includes'](l)&&(!h['has'](l)&&h[P(0xb0)](l,[]),h['get'](l)['push']({...k,'timestamp':k[P(0xf8)]?.['seconds']||0x0}));}),console[N(0xf1)]('D3:\x20Found\x20entries\x20for\x20'+h['size']+N(0xed)),h[N(0xd9)]((j,k)=>{const Q=N;if(j['length']>0x0){j[Q(0xb5)]((m,n)=>n[Q(0xf8)]-m[Q(0xf8)]);const l=j[Q(0xd7)](m=>m['change']!==undefined||m[Q(0xcf)]!==undefined&&m[Q(0xe3)]!==undefined);if(l){let m;if(l['change']!==undefined)m=l[Q(0xdc)];else l[Q(0xcf)]!==undefined&&l['previousElo']!==undefined&&(m=l[Q(0xcf)]-l['previousElo']);m!==undefined&&(b['set'](k,m),console[Q(0xf1)]('D3:\x20'+k+Q(0xc1)+m));}}});if(h[N(0x93)]===0x0){console[N(0xf1)]('D3:\x20No\x20entries\x20found\x20in\x20eloHistoryD3,\x20trying\x20fallback...');const j=collection(db,N(0xb2)),k=query(j,where(N(0xc9),'==','D3'),orderBy('timestamp',N(0x97)),limit(0x32));try{const l=await getDocs(k);console['log'](N(0xfa)+l[N(0x93)]+N(0x96)),l['forEach'](m=>{const R=N,n=m[R(0x9e)]();let o=n[R(0xcd)]||n['playerUsername'];!o&&n['player']&&c[R(0xf2)](n['player'])&&(o=c['get'](n[R(0xb8)]));if(o&&a['includes'](o)){const p=n[R(0xdc)]||(n[R(0xcf)]!==undefined&&n['previousElo']!==undefined?n['newElo']-n['previousElo']:0x0);p!==0x0&&(b[R(0xb0)](o,p),console['log'](R(0xab)+o+'\x20fallback\x20ELO\x20change:\x20'+p));}});}catch(m){console['log']('D3:\x20Fallback\x20query\x20failed:',m);}}const i=Array[N(0xc7)](b[N(0xd2)]())['filter'](([n,o])=>o!==0x0);console['log'](N(0xa5),i);}catch(n){console[N(0xd5)](N(0xd4),n);}return b;}export{displayLadderD3,updatePlayerPositions};
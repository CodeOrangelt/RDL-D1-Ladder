const a14_0x28e2eb=a14_0xe63d,a14_0x4dbf8b=(function(){let _0x1d30d3=!![];return function(_0x1492d2,_0x32a6c4){const _0x40a24f=_0x1d30d3?function(){const _0x418373=a14_0xe63d;if(_0x32a6c4){const _0x56d77a=_0x32a6c4[_0x418373(0x1f9)](_0x1492d2,arguments);return _0x32a6c4=null,_0x56d77a;}}:function(){};return _0x1d30d3=![],_0x40a24f;};}()),a14_0x1d7e4d=a14_0x4dbf8b(this,function(){const _0x372fad=a14_0xe63d;let _0x36a003;try{const _0x412640=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x36a003=_0x412640();}catch(_0x5ac16d){_0x36a003=window;}const _0x5807ac=_0x36a003[_0x372fad(0x1ee)]=_0x36a003[_0x372fad(0x1ee)]||{},_0x56180a=[_0x372fad(0x1fa),_0x372fad(0x1ff),'info','error','exception','table','trace'];for(let _0x5ccc9a=0x0;_0x5ccc9a<_0x56180a['length'];_0x5ccc9a++){const _0x3efd75=a14_0x4dbf8b[_0x372fad(0x1f5)]['prototype']['bind'](a14_0x4dbf8b),_0x2b66bd=_0x56180a[_0x5ccc9a],_0x5ed80a=_0x5807ac[_0x2b66bd]||_0x3efd75;_0x3efd75['__proto__']=a14_0x4dbf8b[_0x372fad(0x204)](a14_0x4dbf8b),_0x3efd75[_0x372fad(0x208)]=_0x5ed80a[_0x372fad(0x208)][_0x372fad(0x204)](_0x5ed80a),_0x5807ac[_0x2b66bd]=_0x3efd75;}});a14_0x1d7e4d();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a14_0x5c78(){const _0x24e9fc=['demotion','console','player','Unranked','desc','empty','Gold','promotion','constructor','error','playersD2','Error\x20fetching\x20D2\x20ELO\x20history:','apply','log','Unknown\x20Player','timestamp','opponent','data','warn','winnerUsername','Emerald','all','docs','bind','exists','Error\x20getting\x20username:','Silver','toString'];a14_0x5c78=function(){return _0x24e9fc;};return a14_0x5c78();}function a14_0xe63d(_0x4ee84e,_0x20fc6c){const _0x1d7e4d=a14_0x5c78();return a14_0xe63d=function(_0x4dbf8b,_0x27cb84){_0x4dbf8b=_0x4dbf8b-0x1ed;let _0x5c7837=_0x1d7e4d[_0x4dbf8b];return _0x5c7837;},a14_0xe63d(_0x4ee84e,_0x20fc6c);}import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D2=[{'name':a14_0x28e2eb(0x1f3),'elo':0x708},{'name':a14_0x28e2eb(0x207),'elo':0x640},{'name':'Bronze','elo':0x578},{'name':'Unranked','elo':0x4b0}];let lastVisibleD2=null;async function getUsernameByIdD2(_0x43bce9){const _0x515eac=a14_0x28e2eb;try{if(!_0x43bce9)return'Unknown\x20Player';const _0x47a3af=await getDoc(doc(db,_0x515eac(0x1f7),_0x43bce9));if(_0x47a3af[_0x515eac(0x205)]())return _0x47a3af[_0x515eac(0x1fe)]()['username']||'Unknown\x20Player';const _0xa166ad=await getDocs(query(collection(db,'approvedMatchesD2'),where('winnerId','==',_0x43bce9),limit(0x1)));if(!_0xa166ad[_0x515eac(0x1f2)])return _0xa166ad['docs'][0x0]['data']()[_0x515eac(0x200)]||'Unknown\x20Player';const _0x41ffe1=await getDocs(query(collection(db,'approvedMatchesD2'),where('loserId','==',_0x43bce9),limit(0x1)));if(!_0x41ffe1['empty'])return _0x41ffe1['docs'][0x0]['data']()['loserUsername']||_0x515eac(0x1fb);return'Unknown\x20Player';}catch(_0x17bb4a){return console[_0x515eac(0x1f6)](_0x515eac(0x206),_0x17bb4a),'Unknown\x20Player';}}export async function recordEloChangeD2({playerId:_0x2c56a8,previousElo:_0x3abc77,newElo:_0x7a1da9,opponentId:_0x346b7b,matchResult:_0x1672ae,previousPosition:_0x137e10,newPosition:_0x25fe97,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x2d40f4,timestamp:_0x4acab0}){const _0x1233e8=a14_0x28e2eb;try{const _0xa4991=doc(collection(db,'eloHistoryD2'));let _0x28a276='match';if(isPromotion)_0x28a276=_0x1233e8(0x1f4);if(isDemotion)_0x28a276=_0x1233e8(0x1ed);let _0x1b93f2=_0x1233e8(0x1f0);if(_0x7a1da9>=0x834)_0x1b93f2=_0x1233e8(0x201);else{if(_0x7a1da9>=0x708)_0x1b93f2=_0x1233e8(0x1f3);else{if(_0x7a1da9>=0x640)_0x1b93f2='Silver';else{if(_0x7a1da9>=0x578)_0x1b93f2='Bronze';}}}return await setDoc(_0xa4991,{'type':_0x28a276,'player':_0x2c56a8,'opponent':_0x346b7b,'previousElo':_0x3abc77,'newElo':_0x7a1da9,'change':_0x7a1da9-_0x3abc77,'matchResult':_0x1672ae,'previousPosition':_0x137e10,'newPosition':_0x25fe97,'rankAchieved':_0x1b93f2,'matchId':_0x2d40f4,'timestamp':_0x4acab0}),console['log']('D2\x20ELO\x20history\x20recorded\x20for\x20'+_0x2c56a8),!![];}catch(_0xe240b3){console['error']('Error\x20recording\x20D2\x20ELO\x20history:',_0xe240b3);throw _0xe240b3;}}export async function getEloHistoryD2(_0x3b9e29=0x14){const _0x215310=a14_0x28e2eb;try{const _0x4db78d=collection(db,'eloHistoryD2');let _0x18c4a4;lastVisibleD2?_0x18c4a4=query(_0x4db78d,orderBy(_0x215310(0x1fc),'desc'),startAfter(lastVisibleD2),limit(_0x3b9e29)):_0x18c4a4=query(_0x4db78d,orderBy(_0x215310(0x1fc),_0x215310(0x1f1)),limit(_0x3b9e29));const _0x59dc1b=await getDocs(_0x18c4a4);if(_0x59dc1b[_0x215310(0x1f2)])return{'entries':[],'hasMore':![]};lastVisibleD2=_0x59dc1b['docs'][_0x59dc1b[_0x215310(0x203)]['length']-0x1];const _0x3ab217=_0x59dc1b['docs']['map'](async _0x22050a=>{const _0x17da75=_0x215310,_0xbab7d6=_0x22050a['data'](),[_0x1ee06a,_0x18be2e]=await Promise[_0x17da75(0x202)]([getUsernameByIdD2(_0xbab7d6[_0x17da75(0x1ef)]),getUsernameByIdD2(_0xbab7d6[_0x17da75(0x1fd)])]);return{..._0xbab7d6,'playerUsername':_0x1ee06a,'opponentUsername':_0x18be2e,'change':_0xbab7d6['newElo']-_0xbab7d6['previousElo'],'timestamp':_0xbab7d6['timestamp']};}),_0x3f7e78=await Promise['all'](_0x3ab217);return{'entries':_0x3f7e78,'hasMore':_0x59dc1b['size']===_0x3b9e29};}catch(_0x266ef4){console['error'](_0x215310(0x1f8),_0x266ef4);throw _0x266ef4;}}export function resetPaginationD2(){lastVisibleD2=null;}
const a50_0x63c404=(function(){let _0xd66184=!![];return function(_0x37646d,_0xe65cf8){const _0x1dfc1f=_0xd66184?function(){const _0x5ca6ce=a50_0x5d92;if(_0xe65cf8){const _0x3783c7=_0xe65cf8[_0x5ca6ce(0x125)](_0x37646d,arguments);return _0xe65cf8=null,_0x3783c7;}}:function(){};return _0xd66184=![],_0x1dfc1f;};}()),a50_0x8e1b45=a50_0x63c404(this,function(){const _0x5c1b83=a50_0x5d92,_0x119dca=function(){let _0x47a4fd;try{_0x47a4fd=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0xa8fc0b){_0x47a4fd=window;}return _0x47a4fd;},_0x3f8a4c=_0x119dca(),_0x2df2fe=_0x3f8a4c['console']=_0x3f8a4c['console']||{},_0x1e78d2=['log','warn','info',_0x5c1b83(0x12f),'exception',_0x5c1b83(0x12b),_0x5c1b83(0x133)];for(let _0x44ba61=0x0;_0x44ba61<_0x1e78d2['length'];_0x44ba61++){const _0x28a4e4=a50_0x63c404['constructor']['prototype']['bind'](a50_0x63c404),_0x2e98fc=_0x1e78d2[_0x44ba61],_0x3764a8=_0x2df2fe[_0x2e98fc]||_0x28a4e4;_0x28a4e4['__proto__']=a50_0x63c404[_0x5c1b83(0x12d)](a50_0x63c404),_0x28a4e4[_0x5c1b83(0x137)]=_0x3764a8['toString']['bind'](_0x3764a8),_0x2df2fe[_0x2e98fc]=_0x28a4e4;}});a50_0x8e1b45();import{db}from'../firebase-config.js';function a50_0x5d92(_0x447d57,_0x4b0315){const _0x8e1b45=a50_0xc290();return a50_0x5d92=function(_0x63c404,_0x40bea9){_0x63c404=_0x63c404-0x125;let _0xc290de=_0x8e1b45[_0x63c404];return _0xc290de;},a50_0x5d92(_0x447d57,_0x4b0315);}function a50_0xc290(){const _0x538deb=['apply','forEach','nonParticipants','playerId','docs','username','table','eloHistory','bind','includes','error','length','data','type','trace','playersD3','map','now','toString'];a50_0xc290=function(){return _0x538deb;};return a50_0xc290();}import{collection,doc,getDoc,getDocs,query,limit,startAfter,where,onSnapshot}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const cache={'userProfiles':new Map(),'ladderPlayers':new Map(),'matchResults':new Map(),'eloHistory':new Map()},CACHE_EXPIRY={'userProfiles':0x5*0x3c*0x3e8,'ladderPlayers':0x2*0x3c*0x3e8,'matchResults':0x1*0x3c*0x3e8,'eloHistory':0x3*0x3c*0x3e8};export const userProfilesRef=collection(db,'userProfiles');export async function fetchPaginatedData(_0x371f6c,_0x4c7642=0xa,_0x76a6b3=null){const _0x4b4f2f=a50_0x5d92;let _0x189c51=query(_0x371f6c,limit(_0x4c7642));_0x76a6b3&&(_0x189c51=query(_0x189c51,startAfter(_0x76a6b3)));const _0x1297dc=await getDocs(_0x189c51),_0x5e4f19=_0x1297dc['docs'][_0x1297dc['docs'][_0x4b4f2f(0x130)]-0x1];return{'data':_0x1297dc['docs'][_0x4b4f2f(0x135)](_0x31d91c=>({'id':_0x31d91c['id'],..._0x31d91c['data']()})),'lastVisible':_0x5e4f19,'hasMore':_0x1297dc['docs']['length']===_0x4c7642};}export async function getUserProfile(_0x2d11e9){const _0x458622=a50_0x5d92,_0x475da=cache['userProfiles']['get'](_0x2d11e9);if(_0x475da&&Date['now']()-_0x475da['timestamp']<CACHE_EXPIRY['userProfiles'])return _0x475da['data'];const _0x29a785=await getDoc(doc(userProfilesRef,_0x2d11e9));if(_0x29a785['exists']()){const _0x2a498b=_0x29a785['data']();return cache['userProfiles']['set'](_0x2d11e9,{'data':_0x2a498b,'timestamp':Date[_0x458622(0x136)]()}),_0x2a498b;}return null;}export async function getLadderData(_0x5498f1=0x1){const _0x438d9f=a50_0x5d92,_0x144bf4='division_'+_0x5498f1,_0x3f5388=cache['ladderPlayers']['get'](_0x144bf4);if(_0x3f5388&&Date['now']()-_0x3f5388['timestamp']<CACHE_EXPIRY['ladderPlayers'])return _0x3f5388[_0x438d9f(0x131)];const _0x3dc40e=_0x5498f1===0x1?'players':'playersD'+_0x5498f1,_0x4812b8=collection(db,_0x3dc40e),_0x511b54=await getDocs(query(_0x4812b8,limit(0x64))),_0x2325f3=_0x511b54['docs']['map'](_0x23ba47=>({'id':_0x23ba47['id'],..._0x23ba47['data']()}));return cache['ladderPlayers']['set'](_0x144bf4,{'data':_0x2325f3,'timestamp':Date[_0x438d9f(0x136)]()}),_0x2325f3;}export async function getEloHistoryBatch(_0x1332f1,_0x437f19=0x1){const _0x544dd8=a50_0x5d92,_0x4533d1=_0x437f19===0x1?'eloHistory':'eloHistoryD'+_0x437f19,_0x35631d=collection(db,_0x4533d1),_0x33febf={},_0x114675=[];_0x1332f1['forEach'](_0x5de081=>{const _0x88a1e1=_0x5de081+'_'+_0x437f19,_0x4757b4=cache['eloHistory']['get'](_0x88a1e1);_0x4757b4&&Date['now']()-_0x4757b4['timestamp']<CACHE_EXPIRY['eloHistory']?_0x33febf[_0x5de081]=_0x4757b4['data']:_0x114675['push'](_0x5de081);});const _0x1decd7=0xa;for(let _0x16c91d=0x0;_0x16c91d<_0x114675['length'];_0x16c91d+=_0x1decd7){const _0x3f1fa5=_0x114675['slice'](_0x16c91d,_0x16c91d+_0x1decd7);if(_0x3f1fa5['length']>0x0)try{const _0x522f04=query(_0x35631d,where('playerId','in',_0x3f1fa5),limit(0x64)),_0x44d4b9=await getDocs(_0x522f04);_0x44d4b9['docs'][_0x544dd8(0x126)](_0x2b3c55=>{const _0x2d0973=_0x544dd8,_0x26cddd=_0x2b3c55[_0x2d0973(0x131)](),_0x406a6c=_0x26cddd[_0x2d0973(0x128)];if(!_0x33febf[_0x406a6c])_0x33febf[_0x406a6c]=[];_0x33febf[_0x406a6c]['push'](_0x26cddd);const _0x30931d=_0x406a6c+'_'+_0x437f19;cache[_0x2d0973(0x12c)]['set'](_0x30931d,{'data':_0x33febf[_0x406a6c],'timestamp':Date[_0x2d0973(0x136)]()});});}catch(_0x1cc3e1){console['error']('Error\x20fetching\x20batch\x20ELO\x20history:',_0x1cc3e1);}}return _0x33febf;}let usernameCache=new Map(),usernameCacheTimestamp=Date['now']();export function setupEfficientListener(_0x373cd8,_0x58c012=[],_0x52fa41){const _0x36e207=collection(db,_0x373cd8),_0x5d9534=query(_0x36e207,..._0x58c012),_0x59b464=onSnapshot(_0x5d9534,_0x455255=>{const _0x462aa9=a50_0x5d92,_0x568088=_0x455255['docChanges']()['map'](_0x11850d=>({'type':_0x11850d[_0x462aa9(0x132)],'id':_0x11850d['doc']['id'],'data':_0x11850d['doc']['data']()}));_0x568088['length']>0x0&&_0x52fa41(_0x568088,_0x455255[_0x462aa9(0x129)]);});return _0x59b464;}export async function bulkResolveUsernames(_0x5c46ae){const _0x35b7ef=a50_0x5d92,_0x36d265=new Map();if(!_0x5c46ae||_0x5c46ae['length']===0x0)return _0x36d265;const _0x1fe560=['players','playersD2',_0x35b7ef(0x134),_0x35b7ef(0x127)];for(const _0x23804b of _0x1fe560){const _0xb80825=collection(db,_0x23804b),_0x434530=await getDocs(_0xb80825);_0x434530['forEach'](_0x1a001f=>{const _0x234585=_0x35b7ef,_0x4c723e=_0x1a001f['data']();_0x4c723e[_0x234585(0x12a)]&&_0x5c46ae[_0x234585(0x12e)](_0x1a001f['id'])&&_0x36d265['set'](_0x1a001f['id'],_0x4c723e['username']);});}return _0x36d265;}
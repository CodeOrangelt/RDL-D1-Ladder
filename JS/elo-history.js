const a16_0x341b84=a16_0x5ada,a16_0x290160=(function(){let _0x198096=!![];return function(_0x39c6de,_0x4bff90){const _0x24ca60=_0x198096?function(){if(_0x4bff90){const _0x2f2d91=_0x4bff90['apply'](_0x39c6de,arguments);return _0x4bff90=null,_0x2f2d91;}}:function(){};return _0x198096=![],_0x24ca60;};}()),a16_0xea7ddb=a16_0x290160(this,function(){const _0x4b5165=a16_0x5ada,_0x2358f5=function(){const _0x2f983d=a16_0x5ada;let _0x340164;try{_0x340164=Function(_0x2f983d(0x134)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x1c1be6){_0x340164=window;}return _0x340164;},_0x2da8a3=_0x2358f5(),_0x5278bb=_0x2da8a3[_0x4b5165(0x132)]=_0x2da8a3['console']||{},_0x14eb4c=['log',_0x4b5165(0x12f),'info',_0x4b5165(0x13c),'exception','table','trace'];for(let _0x181b6d=0x0;_0x181b6d<_0x14eb4c['length'];_0x181b6d++){const _0x20616b=a16_0x290160['constructor']['prototype'][_0x4b5165(0x130)](a16_0x290160),_0x419981=_0x14eb4c[_0x181b6d],_0x1cb592=_0x5278bb[_0x419981]||_0x20616b;_0x20616b[_0x4b5165(0x12d)]=a16_0x290160['bind'](a16_0x290160),_0x20616b['toString']=_0x1cb592['toString']['bind'](_0x1cb592),_0x5278bb[_0x419981]=_0x20616b;}});a16_0xea7ddb();function a16_0x5ada(_0x57a42e,_0x55121f){const _0xea7ddb=a16_0x1e59();return a16_0x5ada=function(_0x290160,_0x5c38bd){_0x290160=_0x290160-0x12d;let _0x1e598f=_0xea7ddb[_0x290160];return _0x1e598f;},a16_0x5ada(_0x57a42e,_0x55121f);}import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS=[{'name':a16_0x341b84(0x131),'elo':0x708},{'name':'Silver','elo':0x640},{'name':'Bronze','elo':0x578},{'name':'Unranked','elo':0x4b0}];async function getUsernameById(_0x19c294){try{if(!_0x19c294)return'Unknown\x20Player';const _0x57d637=await getDoc(doc(db,'players',_0x19c294));return _0x57d637['exists']()?_0x57d637['data']()['username']:'Unknown\x20Player';}catch(_0x23ac99){return console['error']('Error\x20fetching\x20username:',_0x23ac99),'Unknown\x20Player';}}function a16_0x1e59(){const _0x168938=['__proto__','docs','warn','bind','Gold','console','opponent','return\x20(function()\x20','timestamp','previousElo','desc','all','ELO\x20history\x20recorded\x20for\x20','Silver','newElo','error','Error\x20recording\x20ELO\x20history:'];a16_0x1e59=function(){return _0x168938;};return a16_0x1e59();}export async function recordEloChange({playerId:_0x18cb8d,previousElo:_0x1024ef,newElo:_0x1e0b62,opponentId:_0x1cde0d,matchResult:_0x907554,previousPosition:_0x3f2215,newPosition:_0x2e6f58,isPromotion:isPromotion=![],isDemotion:isDemotion=![],timestamp:_0x163dea}){const _0x513521=a16_0x341b84;try{const _0x574ee2=doc(collection(db,'eloHistory'));let _0x40ad2f='match';if(isPromotion)_0x40ad2f='promotion';if(isDemotion)_0x40ad2f='demotion';let _0x5ad631='Unranked';if(_0x1e0b62>=0x834)_0x5ad631='Emerald';else{if(_0x1e0b62>=0x708)_0x5ad631=_0x513521(0x131);else{if(_0x1e0b62>=0x640)_0x5ad631=_0x513521(0x13a);else{if(_0x1e0b62>=0x578)_0x5ad631='Bronze';}}}return await setDoc(_0x574ee2,{'type':_0x40ad2f,'player':_0x18cb8d,'opponent':_0x1cde0d,'previousElo':_0x1024ef,'newElo':_0x1e0b62,'change':_0x1e0b62-_0x1024ef,'matchResult':_0x907554,'previousPosition':_0x3f2215,'newPosition':_0x2e6f58,'rankAchieved':_0x5ad631,'timestamp':_0x163dea}),console['log'](_0x513521(0x139)+_0x18cb8d),!![];}catch(_0x5656c5){console['error'](_0x513521(0x13d),_0x5656c5);throw _0x5656c5;}}export async function getEloHistory(){const _0x22db72=a16_0x341b84;try{const _0x13fd84=collection(db,'eloHistory'),_0xd0aba9=query(_0x13fd84,orderBy('timestamp',_0x22db72(0x137))),_0x1f869c=await getDocs(_0xd0aba9),_0x1a84eb=_0x1f869c[_0x22db72(0x12e)]['map'](async _0x599e18=>{const _0x36fd6c=_0x22db72,_0x37963a=_0x599e18['data'](),[_0x3ba29c,_0x3cd0d3]=await Promise[_0x36fd6c(0x138)]([getUsernameById(_0x37963a['player']),getUsernameById(_0x37963a[_0x36fd6c(0x133)])]);return{..._0x37963a,'playerUsername':_0x3ba29c,'opponentUsername':_0x3cd0d3,'change':_0x37963a[_0x36fd6c(0x13b)]-_0x37963a[_0x36fd6c(0x136)],'timestamp':_0x37963a[_0x36fd6c(0x135)]};}),_0x11668b=await Promise[_0x22db72(0x138)](_0x1a84eb);return{'entries':_0x11668b};}catch(_0x45c115){console['error']('Error\x20fetching\x20ELO\x20history:',_0x45c115);throw _0x45c115;}}export function resetPagination(){lastVisible=null;}
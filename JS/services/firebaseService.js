const a54_0x16a658=(function(){let _0x2fef9f=!![];return function(_0x295731,_0x540477){const _0x192dab=_0x2fef9f?function(){if(_0x540477){const _0x3b49e8=_0x540477['apply'](_0x295731,arguments);return _0x540477=null,_0x3b49e8;}}:function(){};return _0x2fef9f=![],_0x192dab;};}()),a54_0x4412e1=a54_0x16a658(this,function(){const _0x333fac=a54_0x10ef;let _0x24505f;try{const _0x165bda=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x24505f=_0x165bda();}catch(_0x3b1529){_0x24505f=window;}const _0x5be5af=_0x24505f['console']=_0x24505f[_0x333fac(0x1b6)]||{},_0x4f679c=['log','warn','info','error',_0x333fac(0x1ad),'table','trace'];for(let _0x299d0f=0x0;_0x299d0f<_0x4f679c['length'];_0x299d0f++){const _0x593535=a54_0x16a658['constructor'][_0x333fac(0x1b5)][_0x333fac(0x1af)](a54_0x16a658),_0x424e33=_0x4f679c[_0x299d0f],_0x27b329=_0x5be5af[_0x424e33]||_0x593535;_0x593535[_0x333fac(0x1a8)]=a54_0x16a658['bind'](a54_0x16a658),_0x593535[_0x333fac(0x1a7)]=_0x27b329['toString']['bind'](_0x27b329),_0x5be5af[_0x424e33]=_0x593535;}});a54_0x4412e1();import{db}from'../firebase-config.js';import{collection,doc,getDoc,getDocs,query,limit,startAfter,where,onSnapshot}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const cache={'userProfiles':new Map(),'ladderPlayers':new Map(),'matchResults':new Map(),'eloHistory':new Map()},CACHE_EXPIRY={'userProfiles':0x5*0x3c*0x3e8,'ladderPlayers':0x2*0x3c*0x3e8,'matchResults':0x1*0x3c*0x3e8,'eloHistory':0x3*0x3c*0x3e8};export const userProfilesRef=collection(db,'userProfiles');function a54_0x10ef(_0x1e5f79,_0x6cb10){const _0x4412e1=a54_0x49d9();return a54_0x10ef=function(_0x16a658,_0x49d424){_0x16a658=_0x16a658-0x1a3;let _0x49d9c5=_0x4412e1[_0x16a658];return _0x49d9c5;},a54_0x10ef(_0x1e5f79,_0x6cb10);}export async function fetchPaginatedData(_0x3a3f3c,_0x21c862=0xa,_0x411fcc=null){const _0x489388=a54_0x10ef;let _0x5029be=query(_0x3a3f3c,limit(_0x21c862));_0x411fcc&&(_0x5029be=query(_0x5029be,startAfter(_0x411fcc)));const _0xfeaf16=await getDocs(_0x5029be),_0x2ff921=_0xfeaf16[_0x489388(0x1ba)][_0xfeaf16['docs'][_0x489388(0x1ae)]-0x1];return{'data':_0xfeaf16[_0x489388(0x1ba)]['map'](_0x5ec381=>({'id':_0x5ec381['id'],..._0x5ec381['data']()})),'lastVisible':_0x2ff921,'hasMore':_0xfeaf16['docs']['length']===_0x21c862};}export async function getUserProfile(_0x5478a5){const _0x248a05=a54_0x10ef,_0x2d2c32=cache['userProfiles']['get'](_0x5478a5);if(_0x2d2c32&&Date['now']()-_0x2d2c32['timestamp']<CACHE_EXPIRY['userProfiles'])return _0x2d2c32[_0x248a05(0x1ac)];const _0x3efa74=await getDoc(doc(userProfilesRef,_0x5478a5));if(_0x3efa74[_0x248a05(0x1a3)]()){const _0x5df55f=_0x3efa74['data']();return cache['userProfiles']['set'](_0x5478a5,{'data':_0x5df55f,'timestamp':Date['now']()}),_0x5df55f;}return null;}export async function getLadderData(_0x28001f=0x1){const _0x58c123=a54_0x10ef,_0x345d87='division_'+_0x28001f,_0x47ca2d=cache[_0x58c123(0x1a4)]['get'](_0x345d87);if(_0x47ca2d&&Date[_0x58c123(0x1a9)]()-_0x47ca2d['timestamp']<CACHE_EXPIRY[_0x58c123(0x1a4)])return _0x47ca2d['data'];const _0x27102c=_0x28001f===0x1?'players':'playersD'+_0x28001f,_0x5d1995=collection(db,_0x27102c),_0x2a2a89=await getDocs(query(_0x5d1995,limit(0x64))),_0x3ad871=_0x2a2a89['docs']['map'](_0x52987f=>({'id':_0x52987f['id'],..._0x52987f['data']()}));return cache['ladderPlayers']['set'](_0x345d87,{'data':_0x3ad871,'timestamp':Date['now']()}),_0x3ad871;}export async function getEloHistoryBatch(_0x359e21,_0x101a70=0x1){const _0x1b50d1=a54_0x10ef,_0x320a3a=_0x101a70===0x1?'eloHistory':'eloHistoryD'+_0x101a70,_0x33ce9f=collection(db,_0x320a3a),_0x17fbc6={},_0x31a9b7=[];_0x359e21['forEach'](_0x342db0=>{const _0x1f0b95=a54_0x10ef,_0x44dd5f=_0x342db0+'_'+_0x101a70,_0x4d38a0=cache['eloHistory'][_0x1f0b95(0x1b3)](_0x44dd5f);_0x4d38a0&&Date[_0x1f0b95(0x1a9)]()-_0x4d38a0['timestamp']<CACHE_EXPIRY['eloHistory']?_0x17fbc6[_0x342db0]=_0x4d38a0[_0x1f0b95(0x1ac)]:_0x31a9b7['push'](_0x342db0);});const _0x5ce1d9=0xa;for(let _0x2c34d5=0x0;_0x2c34d5<_0x31a9b7['length'];_0x2c34d5+=_0x5ce1d9){const _0x2e6e16=_0x31a9b7['slice'](_0x2c34d5,_0x2c34d5+_0x5ce1d9);if(_0x2e6e16['length']>0x0)try{const _0x167047=query(_0x33ce9f,where('playerId','in',_0x2e6e16),limit(0x64)),_0xcae066=await getDocs(_0x167047);_0xcae066[_0x1b50d1(0x1ba)][_0x1b50d1(0x1b2)](_0x4705af=>{const _0x4ef081=_0x1b50d1,_0x27eb66=_0x4705af['data'](),_0x31b6c2=_0x27eb66['playerId'];if(!_0x17fbc6[_0x31b6c2])_0x17fbc6[_0x31b6c2]=[];_0x17fbc6[_0x31b6c2][_0x4ef081(0x1b4)](_0x27eb66);const _0x3765ce=_0x31b6c2+'_'+_0x101a70;cache[_0x4ef081(0x1b7)]['set'](_0x3765ce,{'data':_0x17fbc6[_0x31b6c2],'timestamp':Date[_0x4ef081(0x1a9)]()});});}catch(_0x6b87a2){console[_0x1b50d1(0x1aa)]('Error\x20fetching\x20batch\x20ELO\x20history:',_0x6b87a2);}}return _0x17fbc6;}let usernameCache=new Map(),usernameCacheTimestamp=Date['now']();export function setupEfficientListener(_0x53162f,_0x248c70=[],_0x2ccd73){const _0x5b0c99=collection(db,_0x53162f),_0x52f7c0=query(_0x5b0c99,..._0x248c70),_0x27aedd=onSnapshot(_0x52f7c0,_0x3e3cbf=>{const _0x2f6204=a54_0x10ef,_0x537e46=_0x3e3cbf[_0x2f6204(0x1ab)]()['map'](_0x39b158=>({'type':_0x39b158['type'],'id':_0x39b158[_0x2f6204(0x1b0)]['id'],'data':_0x39b158['doc'][_0x2f6204(0x1ac)]()}));_0x537e46[_0x2f6204(0x1ae)]>0x0&&_0x2ccd73(_0x537e46,_0x3e3cbf[_0x2f6204(0x1ba)]);});return _0x27aedd;}export async function bulkResolveUsernames(_0x52c590){const _0x1d6a57=a54_0x10ef,_0x13a709=new Map();if(!_0x52c590||_0x52c590['length']===0x0)return _0x13a709;const _0x563dd2=[_0x1d6a57(0x1a6),'playersD2',_0x1d6a57(0x1b9),_0x1d6a57(0x1a5)];for(const _0x2ec42d of _0x563dd2){const _0x311929=collection(db,_0x2ec42d),_0x401639=await getDocs(_0x311929);_0x401639[_0x1d6a57(0x1b2)](_0x58673f=>{const _0x4a743f=_0x1d6a57,_0x51b329=_0x58673f['data']();_0x51b329['username']&&_0x52c590[_0x4a743f(0x1b8)](_0x58673f['id'])&&_0x13a709[_0x4a743f(0x1b1)](_0x58673f['id'],_0x51b329['username']);});}return _0x13a709;}function a54_0x49d9(){const _0x410b17=['exists','ladderPlayers','nonParticipants','players','toString','__proto__','now','error','docChanges','data','exception','length','bind','doc','set','forEach','get','push','prototype','console','eloHistory','includes','playersD3','docs'];a54_0x49d9=function(){return _0x410b17;};return a54_0x49d9();}
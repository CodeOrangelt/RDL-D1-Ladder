const a14_0x16fb2f=a14_0x2fa2,a14_0x307020=(function(){let _0x3d5c61=!![];return function(_0xc2d83e,_0x44e96){const _0x3709af=_0x3d5c61?function(){if(_0x44e96){const _0x422547=_0x44e96['apply'](_0xc2d83e,arguments);return _0x44e96=null,_0x422547;}}:function(){};return _0x3d5c61=![],_0x3709af;};}()),a14_0x901532=a14_0x307020(this,function(){const _0x5bfd8e=a14_0x2fa2,_0x1ffe1a=function(){const _0x430171=a14_0x2fa2;let _0x970c66;try{_0x970c66=Function('return\x20(function()\x20'+_0x430171(0x1ac)+');')();}catch(_0x25cfd2){_0x970c66=window;}return _0x970c66;},_0x423ea8=_0x1ffe1a(),_0x4eafd8=_0x423ea8['console']=_0x423ea8['console']||{},_0x31ba0f=['log','warn','info','error',_0x5bfd8e(0x1ab),_0x5bfd8e(0x1ae),_0x5bfd8e(0x1aa)];for(let _0x47dadf=0x0;_0x47dadf<_0x31ba0f['length'];_0x47dadf++){const _0x5930d1=a14_0x307020['constructor']['prototype']['bind'](a14_0x307020),_0x5956dd=_0x31ba0f[_0x47dadf],_0x59c7f9=_0x4eafd8[_0x5956dd]||_0x5930d1;_0x5930d1['__proto__']=a14_0x307020['bind'](a14_0x307020),_0x5930d1['toString']=_0x59c7f9[_0x5bfd8e(0x1b7)][_0x5bfd8e(0x1b6)](_0x59c7f9),_0x4eafd8[_0x5956dd]=_0x5930d1;}});a14_0x901532();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a14_0x2fa2(_0x5ec95c,_0x471b24){const _0x901532=a14_0x360d();return a14_0x2fa2=function(_0x307020,_0x2ffc57){_0x307020=_0x307020-0x1a5;let _0x360d17=_0x901532[_0x307020];return _0x360d17;},a14_0x2fa2(_0x5ec95c,_0x471b24);}import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D2=[{'name':a14_0x16fb2f(0x1ad),'elo':0x708},{'name':'Silver','elo':0x640},{'name':'Bronze','elo':0x578},{'name':'Unranked','elo':0x4b0}];let lastVisibleD2=null;async function getUsernameByIdD2(_0x2d8122){const _0x583158=a14_0x16fb2f;try{if(!_0x2d8122)return'Unknown\x20Player';const _0x315123=await getDoc(doc(db,'playersD2',_0x2d8122));if(_0x315123['exists']())return _0x315123['data']()['username']||_0x583158(0x1b4);const _0x352995=await getDocs(query(collection(db,_0x583158(0x1b9)),where(_0x583158(0x1a9),'==',_0x2d8122),limit(0x1)));if(!_0x352995[_0x583158(0x1b2)])return _0x352995['docs'][0x0]['data']()[_0x583158(0x1b1)]||'Unknown\x20Player';const _0x42d6d7=await getDocs(query(collection(db,_0x583158(0x1b9)),where('loserId','==',_0x2d8122),limit(0x1)));if(!_0x42d6d7['empty'])return _0x42d6d7['docs'][0x0][_0x583158(0x1a6)]()[_0x583158(0x1a8)]||'Unknown\x20Player';return'Unknown\x20Player';}catch(_0x2f0d0a){return console['error']('Error\x20getting\x20username:',_0x2f0d0a),'Unknown\x20Player';}}export async function recordEloChangeD2({playerId:_0x5bb134,previousElo:_0x3778ea,newElo:_0x3c6f3d,opponentId:_0x20335a,matchResult:_0x1b4a2e,previousPosition:_0x52b3c1,newPosition:_0xd93389,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x1984b8,timestamp:_0x444b09}){const _0x48d46e=a14_0x16fb2f;try{const _0x5bcce4=doc(collection(db,_0x48d46e(0x1b3)));let _0x1df4c3='match';if(isPromotion)_0x1df4c3='promotion';if(isDemotion)_0x1df4c3='demotion';let _0x4aa234='Unranked';if(_0x3c6f3d>=0x834)_0x4aa234='Emerald';else{if(_0x3c6f3d>=0x708)_0x4aa234='Gold';else{if(_0x3c6f3d>=0x640)_0x4aa234='Silver';else{if(_0x3c6f3d>=0x578)_0x4aa234='Bronze';}}}return await setDoc(_0x5bcce4,{'type':_0x1df4c3,'player':_0x5bb134,'opponent':_0x20335a,'previousElo':_0x3778ea,'newElo':_0x3c6f3d,'change':_0x3c6f3d-_0x3778ea,'matchResult':_0x1b4a2e,'previousPosition':_0x52b3c1,'newPosition':_0xd93389,'rankAchieved':_0x4aa234,'matchId':_0x1984b8,'timestamp':_0x444b09}),console['log']('D2\x20ELO\x20history\x20recorded\x20for\x20'+_0x5bb134),!![];}catch(_0x27156c){console['error']('Error\x20recording\x20D2\x20ELO\x20history:',_0x27156c);throw _0x27156c;}}function a14_0x360d(){const _0x35ae46=['opponent','data','all','loserUsername','winnerId','trace','exception','{}.constructor(\x22return\x20this\x22)(\x20)','Gold','table','error','previousElo','winnerUsername','empty','eloHistoryD2','Unknown\x20Player','docs','bind','toString','desc','approvedMatchesD2'];a14_0x360d=function(){return _0x35ae46;};return a14_0x360d();}export async function getEloHistoryD2(_0x19044d=0x14){const _0x1488df=a14_0x16fb2f;try{const _0xef302=collection(db,'eloHistoryD2');let _0x4371b2;lastVisibleD2?_0x4371b2=query(_0xef302,orderBy('timestamp',_0x1488df(0x1b8)),startAfter(lastVisibleD2),limit(_0x19044d)):_0x4371b2=query(_0xef302,orderBy('timestamp','desc'),limit(_0x19044d));const _0x56609b=await getDocs(_0x4371b2);if(_0x56609b['empty'])return{'entries':[],'hasMore':![]};lastVisibleD2=_0x56609b[_0x1488df(0x1b5)][_0x56609b['docs']['length']-0x1];const _0x1bcc2b=_0x56609b['docs']['map'](async _0xa82f3a=>{const _0x3edc84=_0x1488df,_0x42d1ac=_0xa82f3a['data'](),[_0x1bef3b,_0x19637]=await Promise[_0x3edc84(0x1a7)]([getUsernameByIdD2(_0x42d1ac['player']),getUsernameByIdD2(_0x42d1ac[_0x3edc84(0x1a5)])]);return{..._0x42d1ac,'playerUsername':_0x1bef3b,'opponentUsername':_0x19637,'change':_0x42d1ac['newElo']-_0x42d1ac[_0x3edc84(0x1b0)],'timestamp':_0x42d1ac['timestamp']};}),_0x5452bf=await Promise['all'](_0x1bcc2b);return{'entries':_0x5452bf,'hasMore':_0x56609b['size']===_0x19044d};}catch(_0x532457){console[_0x1488df(0x1af)]('Error\x20fetching\x20D2\x20ELO\x20history:',_0x532457);throw _0x532457;}}export function resetPaginationD2(){lastVisibleD2=null;}
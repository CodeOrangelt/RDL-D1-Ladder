const a46_0x44c8d1=a46_0x5661,a46_0x2dc445=(function(){let _0x3c43bc=!![];return function(_0x26d9f2,_0x2062a6){const _0x2a85bf=_0x3c43bc?function(){if(_0x2062a6){const _0x37ed9b=_0x2062a6['apply'](_0x26d9f2,arguments);return _0x2062a6=null,_0x37ed9b;}}:function(){};return _0x3c43bc=![],_0x2a85bf;};}()),a46_0x60e3c0=a46_0x2dc445(this,function(){const _0x122c92=a46_0x5661,_0xda4543=function(){const _0x2f91ec=a46_0x5661;let _0x5f17d9;try{_0x5f17d9=Function('return\x20(function()\x20'+_0x2f91ec(0x144)+');')();}catch(_0x151b24){_0x5f17d9=window;}return _0x5f17d9;},_0x24b72f=_0xda4543(),_0x187c3c=_0x24b72f['console']=_0x24b72f['console']||{},_0x112ad5=['log',_0x122c92(0x15c),'info','error','exception',_0x122c92(0x18a),'trace'];for(let _0x5425eb=0x0;_0x5425eb<_0x112ad5['length'];_0x5425eb++){const _0x13457a=a46_0x2dc445['constructor']['prototype'][_0x122c92(0x155)](a46_0x2dc445),_0x2d6d16=_0x112ad5[_0x5425eb],_0x1d5248=_0x187c3c[_0x2d6d16]||_0x13457a;_0x13457a[_0x122c92(0x14c)]=a46_0x2dc445['bind'](a46_0x2dc445),_0x13457a['toString']=_0x1d5248['toString']['bind'](_0x1d5248),_0x187c3c[_0x2d6d16]=_0x13457a;}});a46_0x60e3c0();import{collection,doc,query,where,orderBy,limit,getDocs,addDoc,getDoc,serverTimestamp,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{auth,db}from'./firebase-config.js';class PromotionManager{constructor(){const _0x426732=a46_0x5661;this['DISPLAY_HOURS']=0x18,this['RANKS']=[{'threshold':0x578,'name':_0x426732(0x138),'color':'#CD7F32'},{'threshold':0x640,'name':_0x426732(0x15a),'color':_0x426732(0x190)},{'threshold':0x708,'name':'Gold','color':'#FFD700'},{'threshold':0x834,'name':_0x426732(0x191),'color':_0x426732(0x167)}],this[_0x426732(0x188)]=null,this['lastFetchTime']=0x0,this['fetchInterval']=0xea60,this['pollingInterval']=null,this['usernameCache']={};}['initialize'](){const _0x3139cc=a46_0x5661;this[_0x3139cc(0x188)]=document[_0x3139cc(0x14f)]('promotion-banner-container');if(!this['bannerContainer']){console[_0x3139cc(0x176)]('Promotion\x20banner\x20container\x20not\x20found');return;}this[_0x3139cc(0x16c)]();const _0x487680='promotions_checked_'+new Date()['toDateString'](),_0x412b12=sessionStorage['getItem'](_0x487680);!_0x412b12&&(this[_0x3139cc(0x145)](),sessionStorage[_0x3139cc(0x13a)](_0x487680,'true')),document['addEventListener']('visibilitychange',()=>{document['visibilityState']==='visible'&&!sessionStorage['getItem'](_0x487680)&&(this['fetchRecentPromotions'](),sessionStorage['setItem'](_0x487680,'true'));}),window['addEventListener']('beforeunload',()=>{this['pollingInterval']&&clearInterval(this['pollingInterval']);});}[a46_0x44c8d1(0x16c)](){const _0x21b960=a46_0x44c8d1;this[_0x21b960(0x188)]['innerHTML']='',this['bannerContainer']['style']['display']=_0x21b960(0x16f);}async[a46_0x44c8d1(0x145)](){const _0x5a19c4=a46_0x44c8d1;try{const _0x5b14e7=Date['now']();if(_0x5b14e7-this['lastFetchTime']<this['fetchInterval'])return;this['lastFetchTime']=_0x5b14e7;const _0x1307f3=collection(db,_0x5a19c4(0x13f)),_0x353c62=query(_0x1307f3,where('type','in',[_0x5a19c4(0x15b),'demotion']),orderBy('timestamp',_0x5a19c4(0x186)),limit(0x14)),_0x5951b8=await getDocs(_0x353c62),_0x1505e3=[];_0x5951b8[_0x5a19c4(0x171)](_0x414c52=>{const _0x13aef3=_0x5a19c4,_0x1d6eac={'id':_0x414c52['id'],..._0x414c52['data']()};this['shouldShowPromotion'](_0x414c52['id'])&&this[_0x13aef3(0x178)](_0x1d6eac)&&_0x1505e3[_0x13aef3(0x149)](_0x1d6eac);}),_0x1505e3[_0x5a19c4(0x16d)]>0x0&&await this['processRankChanges'](_0x1505e3);}catch(_0x35e432){console['error']('Error\x20fetching\x20promotions:',_0x35e432);}}async['processRankChanges'](_0x52bd52){const _0x1228ad=a46_0x44c8d1;if(_0x52bd52[_0x1228ad(0x16d)]===0x0)return;_0x52bd52[_0x1228ad(0x183)]((_0x2368f5,_0x3dfdd5)=>{const _0x1c7f34=_0x1228ad,_0x437139=_0x2368f5['timestamp']?.['toMillis']?.()||_0x2368f5[_0x1c7f34(0x14a)]?.['seconds']*0x3e8||0x0,_0x2c7360=_0x3dfdd5[_0x1c7f34(0x14a)]?.['toMillis']?.()||_0x3dfdd5['timestamp']?.[_0x1c7f34(0x13d)]*0x3e8||0x0;return _0x2c7360-_0x437139;});const _0x352fb8=this[_0x1228ad(0x188)]['children']['length'],_0x5a3018=0x3-_0x352fb8;if(_0x5a3018<=0x0)return;const _0x7480e3=_0x52bd52['slice'](0x0,_0x5a3018);for(let _0x4f025d=0x0;_0x4f025d<_0x7480e3[_0x1228ad(0x16d)];_0x4f025d++){const _0x3d9912=_0x7480e3[_0x4f025d],_0x5917e9=auth[_0x1228ad(0x17c)];try{setTimeout(()=>{this['showRankChangeBanner'](_0x3d9912);},_0x4f025d*0x3e8),_0x5917e9&&_0x3d9912['player']===_0x5917e9['displayName']&&this[_0x1228ad(0x13c)](_0x3d9912['type'],_0x3d9912[_0x1228ad(0x166)]);}catch(_0x3834f3){console[_0x1228ad(0x176)]('Error\x20processing\x20rank\x20change:',_0x3834f3);}}}['shouldShowPromotion'](_0x52f2e3){const _0x593ac1=a46_0x44c8d1;try{const _0x3c0bb1=_0x593ac1(0x157)+_0x52f2e3,_0x5dcd37=localStorage['getItem'](_0x3c0bb1);if(_0x5dcd37){let _0x2106df;try{_0x2106df=JSON['parse'](_0x5dcd37);}catch(_0x525400){return console['warn']('Invalid\x20storage\x20format\x20for\x20'+_0x3c0bb1+_0x593ac1(0x169)),!![];}if(_0x2106df[_0x593ac1(0x17f)]===!![])return console[_0x593ac1(0x142)]('Promotion\x20'+_0x52f2e3+'\x20is\x20permanently\x20ignored'),![];const _0x4e1c75=Date['now']();if(_0x2106df['userDismissed']&&_0x4e1c75-_0x2106df[_0x593ac1(0x14a)]<this['DISPLAY_HOURS']*0x3c*0x3c*0x3e8)return console['log']('Promotion\x20'+_0x52f2e3+'\x20was\x20dismissed\x20by\x20user\x20within\x20last\x20'+this['DISPLAY_HOURS']+'\x20hours'),![];if(_0x2106df['systemDismissed']&&_0x4e1c75-_0x2106df['timestamp']<0x4*0x3c*0x3c*0x3e8)return console['log']('Promotion\x20'+_0x52f2e3+_0x593ac1(0x165)),![];}return!![];}catch(_0x5a22e1){return console['error']('Error\x20checking\x20promotion\x20visibility:',_0x5a22e1),![];}}['ignorePromotion'](_0x320805){const _0x190b72=a46_0x44c8d1;try{const _0x393c40=_0x190b72(0x157)+_0x320805;localStorage['setItem'](_0x393c40,JSON['stringify']({'timestamp':Date['now'](),'ignored':!![]}));}catch(_0x2e6a99){console['error'](_0x190b72(0x170),_0x2e6a99);}}['showRankChangeBanner'](_0x2e5ac9){this['resolveUserId'](_0x2e5ac9)['then'](_0x1b5053=>{const _0x5af685=a46_0x5661,_0x47c590='promotion_'+_0x2e5ac9['id'],_0x3c5313=localStorage['getItem'](_0x47c590);if(_0x3c5313)try{const _0x2d0b3b=JSON['parse'](_0x3c5313);if(_0x2d0b3b['ignored']===!![]){console['log'](_0x5af685(0x175)+_0x2e5ac9['id']);return;}}catch(_0x3b89d2){}localStorage['setItem'](_0x47c590,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':![],'seenAt':Date['now']()})),this['bannerContainer'][_0x5af685(0x18f)]['display']='block';while(this[_0x5af685(0x188)]['children'][_0x5af685(0x16d)]>=0x3){this[_0x5af685(0x188)]['removeChild'](this[_0x5af685(0x188)]['firstChild']);}const _0x5d8ada=document[_0x5af685(0x18d)]('div');_0x5d8ada[_0x5af685(0x15e)]='promotion-banner',_0x5d8ada['setAttribute']('data-rank',_0x1b5053['rankAchieved']),_0x5d8ada['setAttribute']('data-id',_0x1b5053['id']);const _0x1245bd=document['createElement']('div');_0x1245bd[_0x5af685(0x15e)]='promotion-details';const _0x2844f0=_0x1b5053['resolvedName']||_0x1b5053['player']||_0x1b5053['username']||_0x1b5053['playerUsername']||_0x1b5053[_0x5af685(0x140)]||'A\x20player',_0x30e6ac=_0x1b5053['type']==='promotion'?_0x2844f0+_0x5af685(0x16b):_0x2844f0+'\x20was\x20demoted\x20to';_0x1245bd[_0x5af685(0x18b)]=_0x30e6ac+'\x20<span\x20class=\x22rank-text\x22>'+_0x1b5053['rankAchieved']+'</span>';const _0x2bf0aa=document['createElement']('div');_0x2bf0aa['className']='banner-actions';const _0x24927f=document['createElement']('button');_0x24927f['className']='dismiss-btn',_0x24927f['innerHTML']=_0x5af685(0x192),_0x24927f['title']=_0x5af685(0x161);const _0x4e56c6=document['createElement']('button');_0x4e56c6['className']=_0x5af685(0x15f),_0x4e56c6['textContent']='Don\x27t\x20show\x20again',_0x4e56c6['title']='Never\x20show\x20this\x20promotion\x20again',_0x2bf0aa[_0x5af685(0x143)](_0x4e56c6),_0x2bf0aa[_0x5af685(0x143)](_0x24927f),_0x5d8ada['appendChild'](_0x1245bd),_0x5d8ada['appendChild'](_0x2bf0aa),this['bannerContainer']['appendChild'](_0x5d8ada),void _0x5d8ada['offsetWidth'],setTimeout(()=>{const _0x7d1f0d=_0x5af685;_0x5d8ada[_0x7d1f0d(0x159)]['add']('new-rank-change');},0x32),_0x24927f[_0x5af685(0x187)]('click',()=>{const _0x343bae=_0x5af685;localStorage['setItem'](_0x47c590,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':!![],'systemDismissed':![]})),_0x5d8ada[_0x343bae(0x159)][_0x343bae(0x17d)](_0x343bae(0x150)),_0x5d8ada[_0x343bae(0x159)][_0x343bae(0x151)]('dismissing'),setTimeout(()=>{const _0x47a591=_0x343bae;_0x5d8ada['parentNode']&&(_0x5d8ada['remove'](),this['bannerContainer']['children'][_0x47a591(0x16d)]===0x0&&(this['bannerContainer']['style'][_0x47a591(0x179)]='none'));},0x1f4);}),_0x4e56c6[_0x5af685(0x187)]('click',()=>{const _0x127568=_0x5af685;localStorage[_0x127568(0x13a)](_0x47c590,JSON[_0x127568(0x148)]({'timestamp':Date['now'](),'ignored':!![],'userDismissed':!![],'systemDismissed':![]})),_0x5d8ada['classList']['remove']('new-rank-change'),_0x5d8ada['classList']['add']('dismissing'),setTimeout(()=>{const _0x2902fb=_0x127568;_0x5d8ada[_0x2902fb(0x158)]&&(_0x5d8ada['remove'](),this[_0x2902fb(0x188)][_0x2902fb(0x14e)]['length']===0x0&&(this['bannerContainer']['style'][_0x2902fb(0x179)]=_0x2902fb(0x16f)));},0x1f4);}),setTimeout(()=>{const _0x7fd7a9=_0x5af685;_0x5d8ada['parentNode']&&(_0x5d8ada['classList']['remove']('new-rank-change'),_0x5d8ada['classList']['add'](_0x7fd7a9(0x15d)),localStorage[_0x7fd7a9(0x13a)](_0x47c590,JSON['stringify']({'timestamp':Date[_0x7fd7a9(0x189)](),'ignored':![],'userDismissed':![],'systemDismissed':!![]})),setTimeout(()=>{const _0x1cd95d=_0x7fd7a9;_0x5d8ada['parentNode']&&(_0x5d8ada['remove'](),this['bannerContainer']['children']['length']===0x0&&(this['bannerContainer']['style']['display']=_0x1cd95d(0x16f)));},0x1f4));},0x3a98);});}async['resolveUserId'](_0x388d06){const _0x6e368a=a46_0x44c8d1,_0x3e26cd={..._0x388d06},_0x1c3ea2=[_0x388d06['player'],_0x388d06[_0x6e368a(0x168)],_0x388d06[_0x6e368a(0x173)],_0x388d06[_0x6e368a(0x140)]],_0x39b5ae=_0x1c3ea2['some'](_0x5f175f=>_0x5f175f&&typeof _0x5f175f===_0x6e368a(0x160)&&!_0x5f175f['includes']('ID:')&&!/^[a-zA-Z0-9]{20,}$/['test'](_0x5f175f));if(_0x39b5ae)return _0x3e26cd;let _0x3ead2e=null;if(_0x388d06['userId'])_0x3ead2e=_0x388d06['userId'];else _0x388d06[_0x6e368a(0x17b)]&&/^[A-Za-z0-9]{20,}$/['test'](_0x388d06['player'])&&(_0x3ead2e=_0x388d06['player']);if(!_0x3ead2e)return _0x3e26cd;try{const _0x16fa94=await getDoc(doc(db,_0x6e368a(0x16e),_0x3ead2e));if(_0x16fa94['exists']()){const _0x4fa12f=_0x16fa94['data']();if(_0x4fa12f['username'])return _0x3e26cd['resolvedName']=_0x4fa12f['username'],_0x3e26cd;}const _0x40ed6d=await getDocs(query(collection(db,_0x6e368a(0x154)),where(_0x6e368a(0x18c),'==',_0x3ead2e),orderBy(_0x6e368a(0x146),'desc'),limit(0x1)));if(!_0x40ed6d[_0x6e368a(0x16a)]){const _0x116c51=_0x40ed6d['docs'][0x0][_0x6e368a(0x184)]();if(_0x116c51['winnerUsername'])return _0x3e26cd[_0x6e368a(0x174)]=_0x116c51['winnerUsername'],_0x3e26cd;}const _0x3f0a5d=await getDocs(query(collection(db,_0x6e368a(0x154)),where('loserId','==',_0x3ead2e),orderBy(_0x6e368a(0x146),'desc'),limit(0x1)));if(!_0x3f0a5d['empty']){const _0x118788=_0x3f0a5d['docs'][0x0]['data']();if(_0x118788[_0x6e368a(0x14d)])return _0x3e26cd['resolvedName']=_0x118788['loserUsername'],console['log']('Resolved\x20'+_0x3ead2e+'\x20to\x20'+_0x118788['loserUsername']+'\x20(loser)'),_0x3e26cd;}}catch(_0x575804){console[_0x6e368a(0x176)]('Error\x20resolving\x20user\x20ID:',_0x575804);}return console['warn'](_0x6e368a(0x162)+_0x3ead2e),_0x3e26cd;}['showRankChangeLightbox'](_0x4a70a8,_0x1c4bb7){const _0x18af35=a46_0x44c8d1;let _0x9a59c2=document['getElementById'](_0x18af35(0x17a));!_0x9a59c2&&(_0x9a59c2=document['createElement']('div'),_0x9a59c2['id']=_0x18af35(0x17a),_0x9a59c2[_0x18af35(0x15e)]='rank-change-modal\x20'+_0x4a70a8,document['body'][_0x18af35(0x143)](_0x9a59c2));const _0xc4ce25=_0x4a70a8==='promotion'?_0x18af35(0x172):_0x18af35(0x152),_0x23aad0=_0x4a70a8==='promotion'?'You\x27ve\x20been\x20promoted\x20to':'You\x27ve\x20been\x20demoted\x20to';_0x9a59c2[_0x18af35(0x18b)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rank-change-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2\x20class=\x22rank-change-title\x22>'+_0xc4ce25+'</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>'+_0x23aad0+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22rank-name\x22>'+_0x1c4bb7+_0x18af35(0x14b),_0x9a59c2['style']['display']='flex',document['getElementById'](_0x18af35(0x147))['addEventListener']('click',()=>{const _0x1273fb=_0x18af35;_0x9a59c2['style']['display']=_0x1273fb(0x16f);}),_0x9a59c2[_0x18af35(0x187)](_0x18af35(0x18e),_0x58e917=>{const _0x1c7e95=_0x18af35;_0x58e917['target']===_0x9a59c2&&(_0x9a59c2[_0x1c7e95(0x18f)]['display']='none');});}async['checkAndRecordPromotion'](_0x1dbd42,_0x283b10,_0x334b6f,_0x1cad42={}){const _0x2948ec=a46_0x44c8d1;try{if(_0x283b10===_0x334b6f||!_0x1dbd42)return null;const _0x51440e=_0x1cad42['source']||_0x2948ec(0x139),_0xbf2a35=_0x1cad42['matchId']||null,_0x8e18aa=_0x1cad42[_0x2948ec(0x193)]||null;console['log']('Processing\x20potential\x20rank\x20change:\x20'+_0x334b6f+'\x20→\x20'+_0x283b10+_0x2948ec(0x182)+_0x51440e+')');let _0x59762c=null,_0x400ae5=null;try{const _0x4cd98b=await getDoc(doc(db,'players',_0x1dbd42));if(_0x4cd98b['exists']()){const _0x3481b8=_0x4cd98b['data']();_0x59762c=_0x3481b8['username']||_0x3481b8['displayName']||null,_0x400ae5=_0x3481b8[_0x2948ec(0x140)]||_0x3481b8[_0x2948ec(0x168)]||null;}!_0x59762c&&_0x1cad42['username']&&(_0x59762c=_0x1cad42[_0x2948ec(0x168)],_0x400ae5=_0x1cad42['username']);!_0x59762c&&auth['currentUser']&&(_0x59762c=auth[_0x2948ec(0x17c)]['displayName']||auth['currentUser'][_0x2948ec(0x17e)][_0x2948ec(0x156)]('@')[0x0],_0x400ae5=auth['currentUser']['displayName']||null);if(!_0x59762c){const _0x5b1b17=query(collection(db,'approvedMatches'),where('winnerId','==',_0x1dbd42),limit(0x1)),_0x494606=await getDocs(_0x5b1b17);if(!_0x494606['empty'])_0x59762c=_0x494606['docs'][0x0]['data']()['winnerUsername']||'Unknown\x20Player',_0x400ae5=_0x59762c;else{const _0x128ff4=query(collection(db,_0x2948ec(0x154)),where('loserId','==',_0x1dbd42),limit(0x1)),_0x48fc31=await getDocs(_0x128ff4);!_0x48fc31['empty']&&(_0x59762c=_0x48fc31[0x0]['data']()['loserUsername']||_0x2948ec(0x163),_0x400ae5=_0x59762c);}}}catch(_0x47cab3){console['error']('Error\x20resolving\x20username:',_0x47cab3);}!_0x59762c&&(console['warn'](_0x2948ec(0x141),_0x1dbd42),_0x59762c=_0x2948ec(0x177),_0x400ae5=_0x2948ec(0x163));const _0x94d7b1=this['getRankName'](_0x334b6f),_0x2344ec=this['getRankName'](_0x283b10);if(_0x94d7b1!==_0x2344ec){const _0x22fe8d=_0x283b10>_0x334b6f,_0x182fdc=_0x22fe8d?'promotion':'demotion',_0x149fb7=_0x2344ec;console['log']('Recording\x20'+_0x182fdc+'\x20for\x20'+_0x59762c+':\x20'+_0x334b6f+'\x20('+_0x94d7b1+')\x20→\x20'+_0x283b10+'\x20('+_0x2344ec+')');try{const _0x2a243f={'player':_0x59762c,'playerUsername':_0x59762c,'username':_0x59762c,'displayName':_0x400ae5,'userId':_0x1dbd42,'type':_0x182fdc,'rankAchieved':_0x149fb7,'timestamp':serverTimestamp(),'previousElo':_0x334b6f,'newElo':_0x283b10,'change':_0x283b10-_0x334b6f,'previousRank':_0x94d7b1,'newRank':_0x2344ec,'source':_0x51440e};if(_0x51440e==='match'&&_0xbf2a35)_0x2a243f['matchId']=_0xbf2a35;else _0x51440e==='admin'&&_0x8e18aa?(_0x2a243f[_0x2948ec(0x181)]=_0x8e18aa,_0x2a243f['isAutomatic']=![]):_0x2a243f['isAutomatic']=!![];const _0x250528=writeBatch(db),_0x2b1f62=doc(collection(db,_0x2948ec(0x13f))),_0x29a1eb=doc(collection(db,_0x2948ec(0x164)));return _0x250528['set'](_0x2b1f62,_0x2a243f),_0x250528['set'](_0x29a1eb,_0x2a243f),await _0x250528['commit'](),await this['sendPromotionNotification'](_0x1dbd42,_0x59762c,_0x334b6f,_0x283b10,_0x94d7b1,_0x2344ec,_0x182fdc,{'displayName':_0x400ae5,'source':_0x51440e,'matchId':_0xbf2a35,'ladder':_0x1cad42['ladder']||'D1'}),console['log']('Successfully\x20recorded\x20'+_0x182fdc+_0x2948ec(0x13e)+_0x59762c+'\x20to\x20'+_0x149fb7),_0x149fb7;}catch(_0x54dee9){console['error']('Error\x20writing\x20promotion\x20records:',_0x54dee9);try{return await addDoc(collection(db,_0x2948ec(0x13f)),{'player':_0x59762c,'playerUsername':_0x59762c,'username':_0x59762c,'displayName':_0x400ae5,'userId':_0x1dbd42,'type':_0x182fdc,'rankAchieved':_0x149fb7,'timestamp':serverTimestamp(),'previousElo':_0x334b6f,'newElo':_0x283b10,'change':_0x283b10-_0x334b6f,'previousRank':_0x94d7b1,'source':_0x51440e,'isAutomatic':_0x51440e!=='admin'}),await this['sendPromotionNotification'](_0x1dbd42,_0x59762c,_0x334b6f,_0x283b10,_0x94d7b1,_0x2344ec,_0x182fdc,{'displayName':_0x400ae5,'source':_0x51440e,'matchId':_0xbf2a35,'ladder':_0x1cad42['ladder']||'D1'}),_0x149fb7;}catch(_0x8cabbe){return console['error']('Fallback\x20write\x20failed:',_0x8cabbe),null;}}}return null;}catch(_0xdb9e3c){return console['error']('Error\x20in\x20promotion/demotion\x20recording:',_0xdb9e3c),null;}}['getRankName'](_0x14cd69){const _0x18585b=a46_0x44c8d1;for(let _0x4a0a84=this[_0x18585b(0x185)][_0x18585b(0x16d)]-0x1;_0x4a0a84>=0x0;_0x4a0a84--){if(_0x14cd69>=this['RANKS'][_0x4a0a84][_0x18585b(0x13b)])return this['RANKS'][_0x4a0a84]['name'];}return _0x18585b(0x153);}['cleanup'](){this['pollingInterval']&&clearInterval(this['pollingInterval']);}['isNewRankChange'](_0x1991ce){const _0x269b06=a46_0x44c8d1;if(_0x1991ce[_0x269b06(0x14a)]){const _0x247477=_0x1991ce[_0x269b06(0x14a)][_0x269b06(0x13d)]*0x3e8,_0x5885c2=Date[_0x269b06(0x189)](),_0x3ddc36=(_0x5885c2-_0x247477)/(0x3e8*0x3c*0x3c);if(_0x3ddc36>0x18)return![];}if(_0x1991ce['previousRank']&&_0x1991ce['newRank']&&_0x1991ce['previousRank']!==_0x1991ce['newRank'])return!![];return![];}async['sendPromotionNotification'](_0x19d4a5,_0x1729bd,_0x3521f7,_0x5ba630,_0x1c8fdc,_0x288891,_0xdca485,_0x125289={}){const _0x98c234=a46_0x44c8d1;try{console['log']('STARTING\x20notification\x20for\x20'+_0x1729bd+'\x27s\x20'+_0xdca485);const _0x4d7012={'userId':_0x19d4a5,'username':_0x1729bd,'displayName':_0x125289['displayName']||_0x1729bd,'oldElo':parseInt(_0x3521f7),'newElo':parseInt(_0x5ba630),'eloDifference':parseInt(_0x5ba630)-parseInt(_0x3521f7),'oldRank':_0x1c8fdc,'newRank':_0x288891,'type':_0xdca485,'timestamp':serverTimestamp(),'processed':![],'source':_0x125289['source']||'automatic','matchId':_0x125289['matchId']||null,'ladder':_0x125289['ladder']||'D1','adminUser':_0x125289[_0x98c234(0x193)]||null};console['log']('Creating\x20Discord\x20notification:',_0x4d7012);const _0x5520e7=await addDoc(collection(db,'promotionNotifications'),_0x4d7012);return console[_0x98c234(0x142)](_0x98c234(0x180)+_0x5520e7['id']),!![];}catch(_0xc2e7a8){return console['error']('Error\x20sending\x20Discord\x20notification:',_0xc2e7a8),![];}}}export const promotionManager=new PromotionManager();function a46_0x54df(){const _0x1cc9e0=['Bronze','automatic','setItem','threshold','showRankChangeLightbox','seconds','\x20for\x20','eloHistory','displayName','Could\x20not\x20resolve\x20username\x20for\x20userId:','log','appendChild','{}.constructor(\x22return\x20this\x22)(\x20)','fetchRecentPromotions','date','rank-change-ok-btn','stringify','push','timestamp','</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22rank-change-button\x22\x20id=\x22rank-change-ok-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Got\x20it!\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','__proto__','loserUsername','children','getElementById','new-rank-change','add','Rank\x20Update','Unranked','approvedMatches','bind','split','promotion_','parentNode','classList','Silver','promotion','warn','dismissing','className','ignore-btn','string','Dismiss','Failed\x20to\x20resolve\x20user\x20ID:\x20','Unknown\x20Player','promotionHistory','\x20was\x20auto-dismissed\x20within\x20last\x204\x20hours','rankAchieved','#50C878','username',',\x20treating\x20as\x20new','empty','\x20was\x20promoted\x20to','setupBannerContainer','length','players','none','Error\x20saving\x20promotion\x20preference:','forEach','Congratulations!','playerUsername','resolvedName','Skipping\x20ignored\x20promotion:\x20','error','A\x20player','isNewRankChange','display','rankChangeModal','player','currentUser','remove','email','ignored','Discord\x20notification\x20sent\x20successfully\x20with\x20ID:\x20','modifiedBy','\x20(source:\x20','sort','data','RANKS','desc','addEventListener','bannerContainer','now','table','innerHTML','winnerId','createElement','click','style','#C0C0C0','Emerald','&times;','adminUser'];a46_0x54df=function(){return _0x1cc9e0;};return a46_0x54df();}document['addEventListener']('DOMContentLoaded',()=>{promotionManager['initialize']();});export const initializePromotionTracker=()=>promotionManager['initialize']();function a46_0x5661(_0x44a5f7,_0x49000b){const _0x60e3c0=a46_0x54df();return a46_0x5661=function(_0x2dc445,_0x4a4fac){_0x2dc445=_0x2dc445-0x138;let _0x54dfba=_0x60e3c0[_0x2dc445];return _0x54dfba;},a46_0x5661(_0x44a5f7,_0x49000b);}export const checkAndRecordPromotion=(_0x4251db,_0x250b1f,_0x541d82,_0x18b802)=>promotionManager['checkAndRecordPromotion'](_0x4251db,_0x250b1f,_0x541d82,_0x18b802);export const getRankName=_0x4eab4b=>promotionManager['getRankName'](_0x4eab4b);
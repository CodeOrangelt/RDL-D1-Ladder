const a0_0x34cf30=a0_0xdb51;(function(_0x559685,_0x5c31d5){const _0x275bcf=a0_0xdb51,_0x2df333=_0x559685();while(!![]){try{const _0x45e085=parseInt(_0x275bcf(0x134))/0x1+parseInt(_0x275bcf(0x171))/0x2*(-parseInt(_0x275bcf(0x13f))/0x3)+-parseInt(_0x275bcf(0x183))/0x4+-parseInt(_0x275bcf(0x168))/0x5*(parseInt(_0x275bcf(0x161))/0x6)+parseInt(_0x275bcf(0x18e))/0x7*(-parseInt(_0x275bcf(0x157))/0x8)+parseInt(_0x275bcf(0x130))/0x9+-parseInt(_0x275bcf(0x133))/0xa*(-parseInt(_0x275bcf(0x15f))/0xb);if(_0x45e085===_0x5c31d5)break;else _0x2df333['push'](_0x2df333['shift']());}catch(_0x6a9539){_0x2df333['push'](_0x2df333['shift']());}}}(a0_0x5351,0xb7548));const a0_0x45f183=(function(){let _0x183d4c=!![];return function(_0x56071d,_0x2fc3ad){const _0xa419d0=_0x183d4c?function(){if(_0x2fc3ad){const _0xbdbac6=_0x2fc3ad['apply'](_0x56071d,arguments);return _0x2fc3ad=null,_0xbdbac6;}}:function(){};return _0x183d4c=![],_0xa419d0;};}()),a0_0x22db08=a0_0x45f183(this,function(){const _0xd30e5=a0_0xdb51;let _0x160309;try{const _0x3784ca=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x160309=_0x3784ca();}catch(_0x39e2fb){_0x160309=window;}const _0x4c4a2e=_0x160309[_0xd30e5(0x18d)]=_0x160309['console']||{},_0x163a03=['log',_0xd30e5(0x166),'info',_0xd30e5(0x16e),'exception','table','trace'];for(let _0x50b173=0x0;_0x50b173<_0x163a03[_0xd30e5(0x17f)];_0x50b173++){const _0x4daabc=a0_0x45f183[_0xd30e5(0x167)]['prototype']['bind'](a0_0x45f183),_0x340ee3=_0x163a03[_0x50b173],_0x32f7bd=_0x4c4a2e[_0x340ee3]||_0x4daabc;_0x4daabc['__proto__']=a0_0x45f183['bind'](a0_0x45f183),_0x4daabc['toString']=_0x32f7bd['toString']['bind'](_0x32f7bd),_0x4c4a2e[_0x340ee3]=_0x4daabc;}});function a0_0xdb51(_0x5a6fe9,_0x2253e0){const _0x5c6395=a0_0x5351();return a0_0xdb51=function(_0x22db08,_0x45f183){_0x22db08=_0x22db08-0x130;let _0x8265cf=_0x5c6395[_0x22db08];return _0x8265cf;},a0_0xdb51(_0x5a6fe9,_0x2253e0);}a0_0x22db08();import{collection,doc,query,where,orderBy,limit,getDocs,addDoc,getDoc,serverTimestamp,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{auth,db}from'./firebase-config.js';class PromotionManager{constructor(){const _0x4c1259=a0_0xdb51;this['DISPLAY_HOURS']=0x18,this[_0x4c1259(0x188)]=[{'threshold':0x578,'name':'Bronze','color':'#CD7F32'},{'threshold':0x640,'name':'Silver','color':_0x4c1259(0x176)},{'threshold':0x708,'name':_0x4c1259(0x13c),'color':_0x4c1259(0x15c)},{'threshold':0x834,'name':'Emerald','color':'#50C878'}],this[_0x4c1259(0x14d)]=null,this['lastFetchTime']=0x0,this['fetchInterval']=0xea60,this[_0x4c1259(0x16b)]=null,this['usernameCache']={};}[a0_0x34cf30(0x180)](){const _0x248f51=a0_0x34cf30;this['bannerContainer']=document[_0x248f51(0x150)]('promotion-banner-container');if(!this['bannerContainer']){console['error']('Promotion\x20banner\x20container\x20not\x20found');return;}this['setupBannerContainer']();const _0xeb4943=_0x248f51(0x163)+new Date()['toDateString'](),_0x4b7df6=sessionStorage['getItem'](_0xeb4943);!_0x4b7df6&&(this['fetchRecentPromotions'](),sessionStorage[_0x248f51(0x143)](_0xeb4943,'true')),document['addEventListener']('visibilitychange',()=>{const _0x4f7419=_0x248f51;document['visibilityState']==='visible'&&!sessionStorage[_0x4f7419(0x142)](_0xeb4943)&&(this['fetchRecentPromotions'](),sessionStorage['setItem'](_0xeb4943,'true'));}),window['addEventListener']('beforeunload',()=>{this['pollingInterval']&&clearInterval(this['pollingInterval']);});}[a0_0x34cf30(0x156)](){const _0x206991=a0_0x34cf30;this[_0x206991(0x14d)][_0x206991(0x148)]='',this['bannerContainer']['style'][_0x206991(0x175)]='none';}async['fetchRecentPromotions'](){const _0x9f35b4=a0_0x34cf30;try{const _0x377c46=Date['now']();if(_0x377c46-this['lastFetchTime']<this['fetchInterval'])return;this['lastFetchTime']=_0x377c46;const _0x3aedd8=collection(db,'eloHistory'),_0x395099=query(_0x3aedd8,where('type','in',['promotion',_0x9f35b4(0x137)]),orderBy('timestamp',_0x9f35b4(0x152)),limit(0x14)),_0x59e37b=await getDocs(_0x395099),_0x514ce7=[];_0x59e37b[_0x9f35b4(0x13a)](_0x2e13c1=>{const _0xb72e8a={'id':_0x2e13c1['id'],..._0x2e13c1['data']()};this['shouldShowPromotion'](_0x2e13c1['id'])&&this['isNewRankChange'](_0xb72e8a)&&_0x514ce7['push'](_0xb72e8a);}),_0x514ce7['length']>0x0&&await this[_0x9f35b4(0x153)](_0x514ce7);}catch(_0x3d4028){console['error']('Error\x20fetching\x20promotions:',_0x3d4028);}}async['processRankChanges'](_0x5982c1){const _0x3afada=a0_0x34cf30;if(_0x5982c1['length']===0x0)return;_0x5982c1[_0x3afada(0x164)]((_0x33532a,_0x4d8f86)=>{const _0x2994cc=_0x3afada,_0x6331e8=_0x33532a['timestamp']?.[_0x2994cc(0x15d)]?.()||_0x33532a['timestamp']?.['seconds']*0x3e8||0x0,_0x402dac=_0x4d8f86['timestamp']?.['toMillis']?.()||_0x4d8f86[_0x2994cc(0x15b)]?.['seconds']*0x3e8||0x0;return _0x402dac-_0x6331e8;});const _0x109396=this['bannerContainer']['children']['length'],_0x237f96=0x3-_0x109396;if(_0x237f96<=0x0)return;const _0x7fefdf=_0x5982c1['slice'](0x0,_0x237f96);for(let _0x27dc42=0x0;_0x27dc42<_0x7fefdf['length'];_0x27dc42++){const _0x48f301=_0x7fefdf[_0x27dc42],_0x1ce86f=auth['currentUser'];try{setTimeout(()=>{this['showRankChangeBanner'](_0x48f301);},_0x27dc42*0x3e8),_0x1ce86f&&_0x48f301[_0x3afada(0x16a)]===_0x1ce86f['displayName']&&this['showRankChangeLightbox'](_0x48f301['type'],_0x48f301[_0x3afada(0x147)]);}catch(_0x5392ec){console['error']('Error\x20processing\x20rank\x20change:',_0x5392ec);}}}['shouldShowPromotion'](_0x3dfd3c){const _0xe0e33e=a0_0x34cf30;try{const _0x2dd42d='promotion_'+_0x3dfd3c,_0x1c7135=localStorage[_0xe0e33e(0x142)](_0x2dd42d);if(_0x1c7135){let _0x4f43b5;try{_0x4f43b5=JSON['parse'](_0x1c7135);}catch(_0x3eb639){return console[_0xe0e33e(0x166)]('Invalid\x20storage\x20format\x20for\x20'+_0x2dd42d+',\x20treating\x20as\x20new'),!![];}if(_0x4f43b5[_0xe0e33e(0x141)]===!![])return console['log']('Promotion\x20'+_0x3dfd3c+'\x20is\x20permanently\x20ignored'),![];const _0x45d697=Date['now']();if(_0x4f43b5['userDismissed']&&_0x45d697-_0x4f43b5['timestamp']<this['DISPLAY_HOURS']*0x3c*0x3c*0x3e8)return console['log']('Promotion\x20'+_0x3dfd3c+'\x20was\x20dismissed\x20by\x20user\x20within\x20last\x20'+this[_0xe0e33e(0x17c)]+'\x20hours'),![];if(_0x4f43b5['systemDismissed']&&_0x45d697-_0x4f43b5[_0xe0e33e(0x15b)]<0x4*0x3c*0x3c*0x3e8)return console['log']('Promotion\x20'+_0x3dfd3c+'\x20was\x20auto-dismissed\x20within\x20last\x204\x20hours'),![];}return!![];}catch(_0x51be21){return console[_0xe0e33e(0x16e)]('Error\x20checking\x20promotion\x20visibility:',_0x51be21),![];}}['ignorePromotion'](_0x29e2f0){const _0x5c0642=a0_0x34cf30;try{const _0x3237d5='promotion_'+_0x29e2f0;localStorage['setItem'](_0x3237d5,JSON['stringify']({'timestamp':Date[_0x5c0642(0x144)](),'ignored':!![]}));}catch(_0x1a8346){console['error']('Error\x20saving\x20promotion\x20preference:',_0x1a8346);}}[a0_0x34cf30(0x13e)](_0x21b462){const _0x33d7d1=a0_0x34cf30;this[_0x33d7d1(0x189)](_0x21b462)['then'](_0x46786a=>{const _0xee452a=_0x33d7d1,_0x250733='promotion_'+_0x21b462['id'],_0x5b815e=localStorage['getItem'](_0x250733);if(_0x5b815e)try{const _0x46d309=JSON[_0xee452a(0x17a)](_0x5b815e);if(_0x46d309[_0xee452a(0x141)]===!![]){console[_0xee452a(0x158)]('Skipping\x20ignored\x20promotion:\x20'+_0x21b462['id']);return;}}catch(_0x4da5d4){}localStorage['setItem'](_0x250733,JSON['stringify']({'timestamp':Date[_0xee452a(0x144)](),'ignored':![],'userDismissed':![],'systemDismissed':![],'seenAt':Date[_0xee452a(0x144)]()})),this['bannerContainer']['style']['display']=_0xee452a(0x178);while(this['bannerContainer']['children']['length']>=0x3){this[_0xee452a(0x14d)]['removeChild'](this['bannerContainer'][_0xee452a(0x181)]);}const _0x121a5d=document['createElement']('div');_0x121a5d[_0xee452a(0x165)]=_0xee452a(0x15a),_0x121a5d[_0xee452a(0x131)](_0xee452a(0x16d),_0x46786a['rankAchieved']),_0x121a5d[_0xee452a(0x131)](_0xee452a(0x14b),_0x46786a['id']);const _0xaa7359=document['createElement'](_0xee452a(0x162));_0xaa7359['className']='promotion-details';const _0x5274ad=_0x46786a['resolvedName']||_0x46786a[_0xee452a(0x16a)]||_0x46786a['username']||_0x46786a['playerUsername']||_0x46786a['displayName']||'A\x20player',_0x1290d3=_0x46786a['type']==='promotion'?_0x5274ad+'\x20was\x20promoted\x20to':_0x5274ad+'\x20was\x20demoted\x20to';_0xaa7359['innerHTML']=_0x1290d3+'\x20<span\x20class=\x22rank-text\x22>'+_0x46786a['rankAchieved']+'</span>';const _0x486bab=document['createElement'](_0xee452a(0x162));_0x486bab['className']='banner-actions';const _0x8e7d7f=document['createElement'](_0xee452a(0x17e));_0x8e7d7f['className']='dismiss-btn',_0x8e7d7f['innerHTML']='&times;',_0x8e7d7f['title']='Dismiss';const _0x24cacd=document['createElement']('button');_0x24cacd['className']='ignore-btn',_0x24cacd['textContent']='Don\x27t\x20show\x20again',_0x24cacd['title']='Never\x20show\x20this\x20promotion\x20again',_0x486bab['appendChild'](_0x24cacd),_0x486bab['appendChild'](_0x8e7d7f),_0x121a5d['appendChild'](_0xaa7359),_0x121a5d['appendChild'](_0x486bab),this[_0xee452a(0x14d)]['appendChild'](_0x121a5d),void _0x121a5d['offsetWidth'],setTimeout(()=>{const _0x5c23c6=_0xee452a;_0x121a5d[_0x5c23c6(0x170)]['add']('new-rank-change');},0x32),_0x8e7d7f[_0xee452a(0x14e)]('click',()=>{const _0x45ed25=_0xee452a;localStorage['setItem'](_0x250733,JSON['stringify']({'timestamp':Date[_0x45ed25(0x144)](),'ignored':![],'userDismissed':!![],'systemDismissed':![]})),_0x121a5d['classList'][_0x45ed25(0x138)](_0x45ed25(0x18a)),_0x121a5d['classList'][_0x45ed25(0x17b)]('dismissing'),setTimeout(()=>{const _0xe517f0=_0x45ed25;_0x121a5d['parentNode']&&(_0x121a5d[_0xe517f0(0x138)](),this['bannerContainer']['children'][_0xe517f0(0x17f)]===0x0&&(this[_0xe517f0(0x14d)]['style']['display']=_0xe517f0(0x184)));},0x1f4);}),_0x24cacd['addEventListener']('click',()=>{const _0x3ec0c2=_0xee452a;localStorage['setItem'](_0x250733,JSON['stringify']({'timestamp':Date[_0x3ec0c2(0x144)](),'ignored':!![],'userDismissed':!![],'systemDismissed':![]})),_0x121a5d['classList']['remove'](_0x3ec0c2(0x18a)),_0x121a5d['classList']['add']('dismissing'),setTimeout(()=>{const _0x400310=_0x3ec0c2;_0x121a5d['parentNode']&&(_0x121a5d['remove'](),this[_0x400310(0x14d)]['children']['length']===0x0&&(this['bannerContainer']['style']['display']=_0x400310(0x184)));},0x1f4);}),setTimeout(()=>{const _0x2d707d=_0xee452a;_0x121a5d['parentNode']&&(_0x121a5d[_0x2d707d(0x170)]['remove']('new-rank-change'),_0x121a5d['classList']['add'](_0x2d707d(0x136)),localStorage['setItem'](_0x250733,JSON['stringify']({'timestamp':Date[_0x2d707d(0x144)](),'ignored':![],'userDismissed':![],'systemDismissed':!![]})),setTimeout(()=>{const _0x4c5d27=_0x2d707d;_0x121a5d['parentNode']&&(_0x121a5d['remove'](),this['bannerContainer']['children'][_0x4c5d27(0x17f)]===0x0&&(this[_0x4c5d27(0x14d)][_0x4c5d27(0x14f)][_0x4c5d27(0x175)]='none'));},0x1f4));},0x3a98);});}async['resolveUserId'](_0x20dba0){const _0xa420d1=a0_0x34cf30,_0x1c779b={..._0x20dba0},_0x5b20fc=[_0x20dba0['player'],_0x20dba0[_0xa420d1(0x18b)],_0x20dba0[_0xa420d1(0x146)],_0x20dba0[_0xa420d1(0x145)]],_0x1eea81=_0x5b20fc['some'](_0x1dce76=>_0x1dce76&&typeof _0x1dce76==='string'&&!_0x1dce76['includes'](_0xa420d1(0x174))&&!/^[a-zA-Z0-9]{20,}$/['test'](_0x1dce76));if(_0x1eea81)return _0x1c779b;let _0x166cef=null;if(_0x20dba0[_0xa420d1(0x182)])_0x166cef=_0x20dba0['userId'];else _0x20dba0['player']&&/^[A-Za-z0-9]{20,}$/['test'](_0x20dba0['player'])&&(_0x166cef=_0x20dba0['player']);if(!_0x166cef)return _0x1c779b;try{const _0x5693e4=await getDoc(doc(db,_0xa420d1(0x179),_0x166cef));if(_0x5693e4['exists']()){const _0x38e2d2=_0x5693e4['data']();if(_0x38e2d2['username'])return _0x1c779b['resolvedName']=_0x38e2d2[_0xa420d1(0x18b)],_0x1c779b;}const _0x44bada=await getDocs(query(collection(db,_0xa420d1(0x177)),where('winnerId','==',_0x166cef),orderBy('date',_0xa420d1(0x152)),limit(0x1)));if(!_0x44bada['empty']){const _0x32b513=_0x44bada['docs'][0x0][_0xa420d1(0x155)]();if(_0x32b513['winnerUsername'])return _0x1c779b['resolvedName']=_0x32b513['winnerUsername'],_0x1c779b;}const _0x1e49e0=await getDocs(query(collection(db,'approvedMatches'),where('loserId','==',_0x166cef),orderBy(_0xa420d1(0x185),_0xa420d1(0x152)),limit(0x1)));if(!_0x1e49e0['empty']){const _0x1f1f68=_0x1e49e0['docs'][0x0]['data']();if(_0x1f1f68['loserUsername'])return _0x1c779b['resolvedName']=_0x1f1f68['loserUsername'],console[_0xa420d1(0x158)]('Resolved\x20'+_0x166cef+'\x20to\x20'+_0x1f1f68['loserUsername']+'\x20(loser)'),_0x1c779b;}}catch(_0x2f744f){console['error']('Error\x20resolving\x20user\x20ID:',_0x2f744f);}return console['warn']('Failed\x20to\x20resolve\x20user\x20ID:\x20'+_0x166cef),_0x1c779b;}['showRankChangeLightbox'](_0x1c8c90,_0x583531){const _0x587466=a0_0x34cf30;let _0x52d5fc=document[_0x587466(0x150)]('rankChangeModal');!_0x52d5fc&&(_0x52d5fc=document['createElement']('div'),_0x52d5fc['id']='rankChangeModal',_0x52d5fc['className']='rank-change-modal\x20'+_0x1c8c90,document['body']['appendChild'](_0x52d5fc));const _0x3fba51=_0x1c8c90==='promotion'?_0x587466(0x13b):'Rank\x20Update',_0x4c2452=_0x1c8c90==='promotion'?'You\x27ve\x20been\x20promoted\x20to':'You\x27ve\x20been\x20demoted\x20to';_0x52d5fc[_0x587466(0x148)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rank-change-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2\x20class=\x22rank-change-title\x22>'+_0x3fba51+'</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>'+_0x4c2452+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22rank-name\x22>'+_0x583531+_0x587466(0x149),_0x52d5fc[_0x587466(0x14f)]['display']=_0x587466(0x14c),document['getElementById']('rank-change-ok-btn')['addEventListener']('click',()=>{const _0x1ffd2d=_0x587466;_0x52d5fc[_0x1ffd2d(0x14f)]['display']=_0x1ffd2d(0x184);}),_0x52d5fc['addEventListener'](_0x587466(0x14a),_0x3b07f6=>{_0x3b07f6['target']===_0x52d5fc&&(_0x52d5fc['style']['display']='none');});}async['checkAndRecordPromotion'](_0x368b61,_0x4cdcf1,_0x1d6be4,_0x401497={}){const _0x33fe95=a0_0x34cf30;try{if(_0x4cdcf1===_0x1d6be4||!_0x368b61)return null;const _0x3af3c2=_0x401497[_0x33fe95(0x160)]||'automatic',_0xad8a0=_0x401497['matchId']||null,_0x3c6cac=_0x401497['adminUser']||null;console['log']('Processing\x20potential\x20rank\x20change:\x20'+_0x1d6be4+'\x20→\x20'+_0x4cdcf1+'\x20(source:\x20'+_0x3af3c2+')');let _0x478cc1=null,_0x166992=null;try{const _0x2c48f7=await getDoc(doc(db,'players',_0x368b61));if(_0x2c48f7['exists']()){const _0x1e22b5=_0x2c48f7['data']();_0x478cc1=_0x1e22b5['username']||_0x1e22b5[_0x33fe95(0x145)]||null,_0x166992=_0x1e22b5[_0x33fe95(0x145)]||_0x1e22b5['username']||null;}!_0x478cc1&&_0x401497['username']&&(_0x478cc1=_0x401497['username'],_0x166992=_0x401497['username']);!_0x478cc1&&auth['currentUser']&&(_0x478cc1=auth[_0x33fe95(0x139)][_0x33fe95(0x145)]||auth['currentUser'][_0x33fe95(0x15e)][_0x33fe95(0x151)]('@')[0x0],_0x166992=auth[_0x33fe95(0x139)]['displayName']||null);if(!_0x478cc1){const _0x11ee1d=query(collection(db,'approvedMatches'),where(_0x33fe95(0x16c),'==',_0x368b61),limit(0x1)),_0x192129=await getDocs(_0x11ee1d);if(!_0x192129['empty'])_0x478cc1=_0x192129[_0x33fe95(0x16f)][0x0][_0x33fe95(0x155)]()['winnerUsername']||'Unknown\x20Player',_0x166992=_0x478cc1;else{const _0x119e63=query(collection(db,'approvedMatches'),where('loserId','==',_0x368b61),limit(0x1)),_0x1cd516=await getDocs(_0x119e63);!_0x1cd516['empty']&&(_0x478cc1=_0x1cd516[0x0]['data']()['loserUsername']||_0x33fe95(0x135),_0x166992=_0x478cc1);}}}catch(_0x39935b){console['error']('Error\x20resolving\x20username:',_0x39935b);}!_0x478cc1&&(console['warn']('Could\x20not\x20resolve\x20username\x20for\x20userId:',_0x368b61),_0x478cc1='A\x20player',_0x166992=_0x33fe95(0x135));const _0x215d11=this['getRankName'](_0x1d6be4),_0x31ed2b=this[_0x33fe95(0x159)](_0x4cdcf1);if(_0x215d11!==_0x31ed2b){const _0x176216=_0x4cdcf1>_0x1d6be4,_0x56c754=_0x176216?_0x33fe95(0x18c):'demotion',_0x477cae=_0x31ed2b;console['log']('Recording\x20'+_0x56c754+'\x20for\x20'+_0x478cc1+':\x20'+_0x1d6be4+'\x20('+_0x215d11+_0x33fe95(0x186)+_0x4cdcf1+'\x20('+_0x31ed2b+')');try{const _0x56bfb2={'player':_0x478cc1,'playerUsername':_0x478cc1,'username':_0x478cc1,'displayName':_0x166992,'userId':_0x368b61,'type':_0x56c754,'rankAchieved':_0x477cae,'timestamp':serverTimestamp(),'previousElo':_0x1d6be4,'newElo':_0x4cdcf1,'change':_0x4cdcf1-_0x1d6be4,'previousRank':_0x215d11,'newRank':_0x31ed2b,'source':_0x3af3c2};if(_0x3af3c2==='match'&&_0xad8a0)_0x56bfb2['matchId']=_0xad8a0;else _0x3af3c2==='admin'&&_0x3c6cac?(_0x56bfb2['modifiedBy']=_0x3c6cac,_0x56bfb2['isAutomatic']=![]):_0x56bfb2['isAutomatic']=!![];const _0x16daeb=writeBatch(db),_0x3f7467=doc(collection(db,'eloHistory')),_0x154703=doc(collection(db,'promotionHistory'));return _0x16daeb[_0x33fe95(0x154)](_0x3f7467,_0x56bfb2),_0x16daeb[_0x33fe95(0x154)](_0x154703,_0x56bfb2),await _0x16daeb['commit'](),await this['sendPromotionNotification'](_0x368b61,_0x478cc1,_0x1d6be4,_0x4cdcf1,_0x215d11,_0x31ed2b,_0x56c754,{'displayName':_0x166992,'source':_0x3af3c2,'matchId':_0xad8a0,'ladder':_0x401497['ladder']||'D1'}),console[_0x33fe95(0x158)]('Successfully\x20recorded\x20'+_0x56c754+'\x20for\x20'+_0x478cc1+'\x20to\x20'+_0x477cae),_0x477cae;}catch(_0x9507fa){console['error']('Error\x20writing\x20promotion\x20records:',_0x9507fa);try{return await addDoc(collection(db,'eloHistory'),{'player':_0x478cc1,'playerUsername':_0x478cc1,'username':_0x478cc1,'displayName':_0x166992,'userId':_0x368b61,'type':_0x56c754,'rankAchieved':_0x477cae,'timestamp':serverTimestamp(),'previousElo':_0x1d6be4,'newElo':_0x4cdcf1,'change':_0x4cdcf1-_0x1d6be4,'previousRank':_0x215d11,'source':_0x3af3c2,'isAutomatic':_0x3af3c2!=='admin'}),await this['sendPromotionNotification'](_0x368b61,_0x478cc1,_0x1d6be4,_0x4cdcf1,_0x215d11,_0x31ed2b,_0x56c754,{'displayName':_0x166992,'source':_0x3af3c2,'matchId':_0xad8a0,'ladder':_0x401497['ladder']||'D1'}),_0x477cae;}catch(_0x5aa472){return console[_0x33fe95(0x16e)]('Fallback\x20write\x20failed:',_0x5aa472),null;}}}return null;}catch(_0x1b4dc3){return console['error'](_0x33fe95(0x13d),_0x1b4dc3),null;}}[a0_0x34cf30(0x159)](_0x26fc04){const _0x221938=a0_0x34cf30;for(let _0x195eac=this['RANKS']['length']-0x1;_0x195eac>=0x0;_0x195eac--){if(_0x26fc04>=this[_0x221938(0x188)][_0x195eac]['threshold'])return this[_0x221938(0x188)][_0x195eac][_0x221938(0x172)];}return'Unranked';}['cleanup'](){this['pollingInterval']&&clearInterval(this['pollingInterval']);}['isNewRankChange'](_0x276e04){const _0x114754=a0_0x34cf30;if(_0x276e04['timestamp']){const _0x4b3fa1=_0x276e04['timestamp']['seconds']*0x3e8,_0x215b8b=Date['now'](),_0xc3e545=(_0x215b8b-_0x4b3fa1)/(0x3e8*0x3c*0x3c);if(_0xc3e545>0x18)return![];}if(_0x276e04[_0x114754(0x140)]&&_0x276e04[_0x114754(0x173)]&&_0x276e04['previousRank']!==_0x276e04[_0x114754(0x173)])return!![];return![];}async[a0_0x34cf30(0x17d)](_0x1cfdc0,_0x349a6c,_0x380548,_0x268882,_0x1673c6,_0x59f5b3,_0x15d653,_0x34c354={}){const _0x47a426=a0_0x34cf30;try{console['log']('STARTING\x20notification\x20for\x20'+_0x349a6c+'\x27s\x20'+_0x15d653);const _0x5aa8f1={'userId':_0x1cfdc0,'username':_0x349a6c,'displayName':_0x34c354[_0x47a426(0x145)]||_0x349a6c,'oldElo':parseInt(_0x380548),'newElo':parseInt(_0x268882),'eloDifference':parseInt(_0x268882)-parseInt(_0x380548),'oldRank':_0x1673c6,'newRank':_0x59f5b3,'type':_0x15d653,'timestamp':serverTimestamp(),'processed':![],'source':_0x34c354['source']||'automatic','matchId':_0x34c354['matchId']||null,'ladder':_0x34c354[_0x47a426(0x169)]||'D1','adminUser':_0x34c354['adminUser']||null};console['log'](_0x47a426(0x187),_0x5aa8f1);const _0x458885=await addDoc(collection(db,'promotionNotifications'),_0x5aa8f1);return console['log']('Discord\x20notification\x20sent\x20successfully\x20with\x20ID:\x20'+_0x458885['id']),!![];}catch(_0x39e137){return console['error']('Error\x20sending\x20Discord\x20notification:',_0x39e137),![];}}}export const promotionManager=new PromotionManager();document['addEventListener']('DOMContentLoaded',()=>{promotionManager['initialize']();});function a0_0x5351(){const _0x2e81b2=['winnerId','data-rank','error','docs','classList','34BljXDn','name','newRank','ID:','display','#C0C0C0','approvedMatches','block','players','parse','add','DISPLAY_HOURS','sendPromotionNotification','button','length','initialize','firstChild','userId','3409436rdjpMX','none','date',')\x20→\x20','Creating\x20Discord\x20notification:','RANKS','resolveUserId','new-rank-change','username','promotion','console','36666MOeKGG','399438tOOTNS','setAttribute','checkAndRecordPromotion','29212180PWAbhm','657640BQUMFJ','Unknown\x20Player','dismissing','demotion','remove','currentUser','forEach','Congratulations!','Gold','Error\x20in\x20promotion/demotion\x20recording:','showRankChangeBanner','74847dHZVKH','previousRank','ignored','getItem','setItem','now','displayName','playerUsername','rankAchieved','innerHTML','</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22rank-change-button\x22\x20id=\x22rank-change-ok-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Got\x20it!\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','click','data-id','flex','bannerContainer','addEventListener','style','getElementById','split','desc','processRankChanges','set','data','setupBannerContainer','424CxYPhY','log','getRankName','promotion-banner','timestamp','#FFD700','toMillis','email','11wYQdEy','source','822xySzuk','div','promotions_checked_','sort','className','warn','constructor','48110DEpHXT','ladder','player','pollingInterval'];a0_0x5351=function(){return _0x2e81b2;};return a0_0x5351();}export const initializePromotionTracker=()=>promotionManager['initialize']();export const checkAndRecordPromotion=(_0x5511f8,_0x342d6a,_0x3fcfd5,_0x3d9ef9)=>promotionManager[a0_0x34cf30(0x132)](_0x5511f8,_0x342d6a,_0x3fcfd5,_0x3d9ef9);export const getRankName=_0x212d75=>promotionManager['getRankName'](_0x212d75);
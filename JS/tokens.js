const a58_0x5330e2=(function(){let _0x1cf610=!![];return function(_0x529c80,_0x4c170c){const _0x483d2a=_0x1cf610?function(){if(_0x4c170c){const _0xbe65f=_0x4c170c['apply'](_0x529c80,arguments);return _0x4c170c=null,_0xbe65f;}}:function(){};return _0x1cf610=![],_0x483d2a;};}()),a58_0x56c917=a58_0x5330e2(this,function(){const _0x1c6b68=a58_0x2de2;let _0x1af74a;try{const _0x54ccd8=Function('return\x20(function()\x20'+_0x1c6b68(0x1cc)+');');_0x1af74a=_0x54ccd8();}catch(_0x2b2a05){_0x1af74a=window;}const _0x453f39=_0x1af74a[_0x1c6b68(0x1c3)]=_0x1af74a['console']||{},_0xa6c0fd=['log','warn','info','error','exception',_0x1c6b68(0x1d4),'trace'];for(let _0x6f535=0x0;_0x6f535<_0xa6c0fd[_0x1c6b68(0x1cb)];_0x6f535++){const _0x49942b=a58_0x5330e2['constructor']['prototype']['bind'](a58_0x5330e2),_0x422a18=_0xa6c0fd[_0x6f535],_0x276c7b=_0x453f39[_0x422a18]||_0x49942b;_0x49942b['__proto__']=a58_0x5330e2[_0x1c6b68(0x1ca)](a58_0x5330e2),_0x49942b['toString']=_0x276c7b['toString']['bind'](_0x276c7b),_0x453f39[_0x422a18]=_0x49942b;}});a58_0x56c917();import{doc,getDoc,getDocs,collection}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a58_0x5a90(){const _0xb429a8=['set','console','purchasedAt','string','Error\x20fetching\x20bulk\x20user\x20tokens:','Error\x20fetching\x20user\x20tokens:','now','seconds','bind','length','{}.constructor(\x22return\x20this\x22)(\x20)','forEach','exists','map','username','error','log','get','table','delete','tokens','includes','userProfiles'];a58_0x5a90=function(){return _0xb429a8;};return a58_0x5a90();}import{db}from'./firebase-config.js';const tokenCache=new Map(),CACHE_DURATION=0x5*0x3c*0x3e8;export async function getUserTokens(_0x48be26){const _0x27db56=a58_0x2de2,_0x32258d='tokens_'+_0x48be26,_0xa6fab8=tokenCache['get'](_0x32258d);if(_0xa6fab8&&Date[_0x27db56(0x1c8)]()-_0xa6fab8['timestamp']<CACHE_DURATION)return _0xa6fab8['tokens'];try{const _0x405b79=doc(db,'userTokens',_0x48be26),_0x185047=await getDoc(_0x405b79);let _0x3eca5f=[];return _0x185047[_0x27db56(0x1ce)]()&&(_0x3eca5f=_0x185047['data']()[_0x27db56(0x1d6)]||[]),tokenCache[_0x27db56(0x1c2)](_0x32258d,{'tokens':_0x3eca5f,'timestamp':Date['now']()}),_0x3eca5f;}catch(_0x554f34){return console[_0x27db56(0x1d1)](_0x27db56(0x1c7),_0x554f34),[];}}export async function getBulkUserTokens(_0x571261){const _0x3a63c3=a58_0x2de2,_0x213871=new Map(),_0x1cf768=[];_0x571261[_0x3a63c3(0x1cd)](_0xe070a=>{const _0x280940=_0x3a63c3,_0x41b667='tokens_'+_0xe070a,_0x388188=tokenCache[_0x280940(0x1d3)](_0x41b667);_0x388188&&Date['now']()-_0x388188['timestamp']<CACHE_DURATION?_0x213871[_0x280940(0x1c2)](_0xe070a,_0x388188['tokens']):_0x1cf768['push'](_0xe070a);});if(_0x1cf768['length']>0x0)try{const _0x5087b3=_0x1cf768[_0x3a63c3(0x1cf)](async _0x4af7a7=>{const _0x2d031b=_0x3a63c3,_0x11e0dc=doc(db,'userTokens',_0x4af7a7),_0x41228b=await getDoc(_0x11e0dc);let _0x180cd5=[];_0x41228b['exists']()&&(_0x180cd5=_0x41228b['data']()['tokens']||[]);const _0x402d2c='tokens_'+_0x4af7a7;return tokenCache['set'](_0x402d2c,{'tokens':_0x180cd5,'timestamp':Date[_0x2d031b(0x1c8)]()}),[_0x4af7a7,_0x180cd5];}),_0x4e7202=await Promise['all'](_0x5087b3);_0x4e7202['forEach'](([_0x708225,_0x5e19d0])=>{_0x213871['set'](_0x708225,_0x5e19d0);});}catch(_0x523b5b){console[_0x3a63c3(0x1d1)](_0x3a63c3(0x1c6),_0x523b5b);}return _0x213871;}export async function getTokensByUsernames(_0x57153c){const _0x491683=a58_0x2de2,_0x1e3f38=new Map();try{const _0x17c6a2=collection(db,_0x491683(0x1d8)),_0x5c7e9b=await getDocs(_0x17c6a2),_0x2b7906=new Map();_0x5c7e9b[_0x491683(0x1cd)](_0x32c095=>{const _0x11e7a0=_0x491683,_0x2d3d53=_0x32c095['data']();_0x2d3d53['username']&&_0x57153c[_0x11e7a0(0x1d7)](_0x2d3d53['username'])&&_0x2b7906['set'](_0x2d3d53[_0x11e7a0(0x1d0)],_0x32c095['id']);});const _0x4bf655=Array['from'](_0x2b7906['values']());if(_0x4bf655['length']>0x0){const _0x4af56a=await getBulkUserTokens(_0x4bf655);_0x2b7906['forEach']((_0x2c055d,_0x2fc1a7)=>{const _0x8b5376=_0x491683,_0x323497=_0x4af56a['get'](_0x2c055d)||[];_0x1e3f38[_0x8b5376(0x1c2)](_0x2fc1a7,_0x323497);});}}catch(_0x47a547){console['error']('Error\x20fetching\x20tokens\x20by\x20usernames:',_0x47a547);}return _0x1e3f38;}export function clearTokenCache(_0x38d985=null){const _0x572b84=a58_0x2de2;if(_0x38d985){const _0x1547d5='tokens_'+_0x38d985;tokenCache[_0x572b84(0x1d5)](_0x1547d5),console['log']('🗑️\x20Cleared\x20token\x20cache\x20for\x20user:\x20'+_0x38d985);}else tokenCache['clear'](),console[_0x572b84(0x1d2)]('🗑️\x20Cleared\x20all\x20token\x20cache');}export async function forceRefreshUserTokens(_0x194147){return clearTokenCache(_0x194147),await getUserTokens(_0x194147);}function a58_0x2de2(_0x49e1a4,_0x368636){const _0x56c917=a58_0x5a90();return a58_0x2de2=function(_0x5330e2,_0x10a0a5){_0x5330e2=_0x5330e2-0x1c2;let _0x5a90ed=_0x56c917[_0x5330e2];return _0x5a90ed;},a58_0x2de2(_0x49e1a4,_0x368636);}export function getPrimaryDisplayToken(_0x29efc9){const _0x34dc21=a58_0x2de2;if(!_0x29efc9||_0x29efc9[_0x34dc21(0x1cb)]===0x0)return null;const _0x4e7bdb=_0x29efc9['find'](_0x2713bb=>_0x2713bb['equipped']===!![]);if(_0x4e7bdb)return _0x4e7bdb;const _0x393e0f=[..._0x29efc9]['sort']((_0x288c1b,_0x2fba98)=>{const _0x4aee8d=_0x34dc21;let _0x15c519,_0x15244d;if(_0x288c1b['purchasedAt']){if(_0x288c1b['purchasedAt'][_0x4aee8d(0x1c9)])_0x15c519=_0x288c1b[_0x4aee8d(0x1c4)][_0x4aee8d(0x1c9)];else{if(_0x288c1b[_0x4aee8d(0x1c4)]instanceof Date)_0x15c519=_0x288c1b[_0x4aee8d(0x1c4)]['getTime']()/0x3e8;else typeof _0x288c1b['purchasedAt']==='string'?_0x15c519=new Date(_0x288c1b['purchasedAt'])['getTime']()/0x3e8:_0x15c519=0x0;}}else _0x15c519=0x0;if(_0x2fba98[_0x4aee8d(0x1c4)]){if(_0x2fba98[_0x4aee8d(0x1c4)]['seconds'])_0x15244d=_0x2fba98[_0x4aee8d(0x1c4)]['seconds'];else{if(_0x2fba98[_0x4aee8d(0x1c4)]instanceof Date)_0x15244d=_0x2fba98[_0x4aee8d(0x1c4)]['getTime']()/0x3e8;else typeof _0x2fba98['purchasedAt']===_0x4aee8d(0x1c5)?_0x15244d=new Date(_0x2fba98['purchasedAt'])['getTime']()/0x3e8:_0x15244d=0x0;}}else _0x15244d=0x0;return _0x15244d-_0x15c519;});return _0x393e0f[0x0];}
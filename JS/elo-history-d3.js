function a15_0x4f52(){const _0x53e312=['all','Bronze','previousElo','Error\x20recording\x20D3\x20ELO\x20history:','length','timestamp','console','approvedMatchesD3','loserUsername','docs','size','info','error','toString','desc','exception','Gold','bind','return\x20(function()\x20','eloHistoryD3','Emerald','Unranked','Silver','winnerId','D3\x20ELO\x20history\x20recorded\x20for\x20'];a15_0x4f52=function(){return _0x53e312;};return a15_0x4f52();}const a15_0x247641=a15_0x21a4,a15_0x224306=(function(){let _0xde63f1=!![];return function(_0xbb7f88,_0x2b4e36){const _0x409553=_0xde63f1?function(){if(_0x2b4e36){const _0x82039d=_0x2b4e36['apply'](_0xbb7f88,arguments);return _0x2b4e36=null,_0x82039d;}}:function(){};return _0xde63f1=![],_0x409553;};}()),a15_0x492882=a15_0x224306(this,function(){const _0xb83ed1=a15_0x21a4;let _0x5ac875;try{const _0x357b38=Function(_0xb83ed1(0x19c)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x5ac875=_0x357b38();}catch(_0xd392c8){_0x5ac875=window;}const _0x1205d4=_0x5ac875[_0xb83ed1(0x190)]=_0x5ac875['console']||{},_0xea0883=['log','warn',_0xb83ed1(0x195),'error',_0xb83ed1(0x199),'table','trace'];for(let _0x508c49=0x0;_0x508c49<_0xea0883['length'];_0x508c49++){const _0x2b4230=a15_0x224306['constructor']['prototype']['bind'](a15_0x224306),_0x2a7ba6=_0xea0883[_0x508c49],_0x3ce5af=_0x1205d4[_0x2a7ba6]||_0x2b4230;_0x2b4230['__proto__']=a15_0x224306['bind'](a15_0x224306),_0x2b4230[_0xb83ed1(0x197)]=_0x3ce5af['toString'][_0xb83ed1(0x19b)](_0x3ce5af),_0x1205d4[_0x2a7ba6]=_0x2b4230;}});a15_0x492882();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc,where}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D3=[{'name':a15_0x247641(0x19e),'elo':0x7d0},{'name':a15_0x247641(0x19a),'elo':0x708},{'name':'Silver','elo':0x640},{'name':a15_0x247641(0x18b),'elo':0x578},{'name':'Unranked','elo':0x4b0}];let lastVisibleD3=null;async function getUsernameByIdD3(_0x271690){const _0x14d697=a15_0x247641;try{if(!_0x271690)return'Unknown\x20Player';const _0xb29a70=await getDoc(doc(db,'playersD3',_0x271690));if(_0xb29a70['exists']())return _0xb29a70['data']()['username']||'Unknown\x20Player';const _0x22a0a6=await getDocs(query(collection(db,_0x14d697(0x191)),where(_0x14d697(0x1a1),'==',_0x271690),limit(0x1)));if(!_0x22a0a6['empty'])return _0x22a0a6[_0x14d697(0x193)][0x0]['data']()['winnerUsername']||'Unknown\x20Player';const _0x2b43e0=await getDocs(query(collection(db,'approvedMatchesD3'),where('loserId','==',_0x271690),limit(0x1)));if(!_0x2b43e0['empty'])return _0x2b43e0['docs'][0x0]['data']()[_0x14d697(0x192)]||'Unknown\x20Player';return'Unknown\x20Player';}catch(_0x34003b){return console['error']('Error\x20getting\x20D3\x20username:',_0x34003b),'Unknown\x20Player';}}export async function recordEloChangeD3({playerId:_0x42f48b,previousElo:_0x5086bb,newElo:_0x554e2f,opponentId:_0x4995db,matchResult:_0x3ea87b,previousPosition:_0x1b69f2,newPosition:_0x3d87ae,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x2661e7,timestamp:_0x1c0765}){const _0x348b8a=a15_0x247641;try{const _0x278375=doc(collection(db,'eloHistoryD3'));let _0x44460f='match';if(isPromotion)_0x44460f='promotion';if(isDemotion)_0x44460f='demotion';let _0xefab90=_0x348b8a(0x19f);if(_0x554e2f>=0x7d0)_0xefab90='Emerald';else{if(_0x554e2f>=0x708)_0xefab90='Gold';else{if(_0x554e2f>=0x640)_0xefab90=_0x348b8a(0x1a0);else{if(_0x554e2f>=0x578)_0xefab90='Bronze';}}}return await setDoc(_0x278375,{'type':_0x44460f,'player':_0x42f48b,'opponent':_0x4995db,'previousElo':_0x5086bb,'newElo':_0x554e2f,'change':_0x554e2f-_0x5086bb,'matchResult':_0x3ea87b,'previousPosition':_0x1b69f2,'newPosition':_0x3d87ae,'rankAchieved':_0xefab90,'matchId':_0x2661e7,'timestamp':_0x1c0765||serverTimestamp(),'gameMode':'D3'}),console['log'](_0x348b8a(0x1a2)+_0x42f48b),!![];}catch(_0x2d9843){console['error'](_0x348b8a(0x18d),_0x2d9843);throw _0x2d9843;}}function a15_0x21a4(_0xeae144,_0x2ec818){const _0x492882=a15_0x4f52();return a15_0x21a4=function(_0x224306,_0x195191){_0x224306=_0x224306-0x18a;let _0x4f521a=_0x492882[_0x224306];return _0x4f521a;},a15_0x21a4(_0xeae144,_0x2ec818);}export async function getEloHistoryD3(_0x184b4c=0x14){const _0x118464=a15_0x247641;try{const _0x4712ae=collection(db,_0x118464(0x19d));let _0x13ec65;lastVisibleD3?_0x13ec65=query(_0x4712ae,orderBy('timestamp',_0x118464(0x198)),startAfter(lastVisibleD3),limit(_0x184b4c)):_0x13ec65=query(_0x4712ae,orderBy(_0x118464(0x18f),'desc'),limit(_0x184b4c));const _0x4c39d4=await getDocs(_0x13ec65);if(_0x4c39d4['empty'])return{'entries':[],'hasMore':![]};lastVisibleD3=_0x4c39d4[_0x118464(0x193)][_0x4c39d4['docs'][_0x118464(0x18e)]-0x1];const _0x3acc17=_0x4c39d4['docs']['map'](async _0x2afbf0=>{const _0x4dd0fd=_0x118464,_0x520fd9=_0x2afbf0['data'](),[_0x4a4d0e,_0x2f3511]=await Promise[_0x4dd0fd(0x18a)]([getUsernameByIdD3(_0x520fd9['player']),getUsernameByIdD3(_0x520fd9['opponent'])]);return{..._0x520fd9,'playerUsername':_0x4a4d0e,'opponentUsername':_0x2f3511,'change':_0x520fd9['newElo']-_0x520fd9[_0x4dd0fd(0x18c)],'timestamp':_0x520fd9['timestamp']};}),_0x497cda=await Promise['all'](_0x3acc17);return{'entries':_0x497cda,'hasMore':_0x4c39d4[_0x118464(0x194)]===_0x184b4c};}catch(_0x4bed52){console[_0x118464(0x196)]('Error\x20fetching\x20D3\x20ELO\x20history:',_0x4bed52);throw _0x4bed52;}}export function resetPaginationD3(){lastVisibleD3=null;}
const a12_0x2bfade=a12_0x2c06,a12_0x411734=(function(){let _0x2d196a=!![];return function(_0x2a9172,_0x5dd406){const _0x399f21=_0x2d196a?function(){if(_0x5dd406){const _0x37a8ed=_0x5dd406['apply'](_0x2a9172,arguments);return _0x5dd406=null,_0x37a8ed;}}:function(){};return _0x2d196a=![],_0x399f21;};}()),a12_0x2dcaaa=a12_0x411734(this,function(){const _0x24a5d6=a12_0x2c06;let _0xc1e025;try{const _0x27a16d=Function(_0x24a5d6(0x1d3)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0xc1e025=_0x27a16d();}catch(_0x367c19){_0xc1e025=window;}const _0x4bfa36=_0xc1e025['console']=_0xc1e025['console']||{},_0x38dc07=['log','warn','info','error','exception','table','trace'];for(let _0x96bc15=0x0;_0x96bc15<_0x38dc07['length'];_0x96bc15++){const _0x46a343=a12_0x411734[_0x24a5d6(0x1db)]['prototype'][_0x24a5d6(0x1d8)](a12_0x411734),_0x262941=_0x38dc07[_0x96bc15],_0x14cf22=_0x4bfa36[_0x262941]||_0x46a343;_0x46a343['__proto__']=a12_0x411734['bind'](a12_0x411734),_0x46a343['toString']=_0x14cf22['toString']['bind'](_0x14cf22),_0x4bfa36[_0x262941]=_0x46a343;}});a12_0x2dcaaa();function a12_0x2c06(_0x147919,_0x4009d0){const _0x2dcaaa=a12_0x43d6();return a12_0x2c06=function(_0x411734,_0x2da1a4){_0x411734=_0x411734-0x1c0;let _0x43d6fc=_0x2dcaaa[_0x411734];return _0x43d6fc;},a12_0x2c06(_0x147919,_0x4009d0);}function a12_0x43d6(){const _0xad9d68=['role','Found\x20admin\x20role:\x20','Brian2af@outlook.com','email','forEach','playersDuos','now','click','hasCheckedCollections','No\x20admin\x20roles\x20found\x20for\x20user','addEventListener','uid','toUpperCase','querySelectorAll','none','style','toLowerCase','checkInterval','owner','return\x20(function()\x20','display','creative\x20lead','User','all','bind','username','isAdmin','constructor','empty','currentUser','split','\x20by\x20UID:','exists','block','warn','error','Could\x20not\x20check\x20pending\x20invitations\x20for\x20current\x20user:','docs','pendingCount','toUserId','roleName','\x20in\x20','log','.admin-only'];a12_0x43d6=function(){return _0xad9d68;};return a12_0x43d6();}import{getAuth,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{doc,getDoc,collection,query,where,getDocs,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import{isAdmin}from'./admin-check.js';const ADMIN_EMAILS=['admin@ladder.com',a12_0x2bfade(0x1c2)],userCache={'uid':null,'username':null,'isAdmin':![],'hasCheckedCollections':![],'lastChecked':0x0,'role':null},invitationCache={'lastCheck':0x0,'pendingCount':0x0,'checkInterval':0x493e0};function updateInboxNotification(_0x16fa0e){const _0xf375a1=a12_0x2bfade,_0xa937c7=document['getElementById']('inbox-notification');_0xa937c7&&(_0x16fa0e>0x0?(_0xa937c7[_0xf375a1(0x1cf)]['display']='inline-block',_0xa937c7['textContent']=_0x16fa0e>0x9?'9+':_0x16fa0e):_0xa937c7[_0xf375a1(0x1cf)][_0xf375a1(0x1d4)]=_0xf375a1(0x1ce));}async function checkPendingInvitationsForCurrentUser(_0x59b50c){const _0x1c1633=a12_0x2bfade;try{const _0x53eae7=Date[_0x1c1633(0x1c6)]();if(_0x53eae7-invitationCache['lastCheck']<invitationCache[_0x1c1633(0x1d1)])return updateInboxNotification(invitationCache[_0x1c1633(0x1e6)]),invitationCache[_0x1c1633(0x1e6)];invitationCache['lastCheck']=_0x53eae7;const _0x5977a7=collection(db,'gameInvitations'),_0x38a041=query(_0x5977a7,where(_0x1c1633(0x1e7),'==',_0x59b50c),where('status','==','pending'),limit(0x5)),_0x2353a8=await getDocs(_0x38a041),_0x4a7da3=_0x2353a8['size'];return invitationCache['pendingCount']=_0x4a7da3,updateInboxNotification(_0x4a7da3),_0x4a7da3;}catch(_0x4e437c){return console[_0x1c1633(0x1e2)](_0x1c1633(0x1e4),_0x4e437c),0x0;}}function updateAuthSectionImmediate(_0x266c9d,_0x3e6705=![]){const _0x3e1e78=a12_0x2bfade,_0x557563=document['getElementById']('auth-section');if(!_0x557563)return;if(_0x266c9d&&_0x3e6705)document[_0x3e1e78(0x1cd)](_0x3e1e78(0x1eb))['forEach'](_0x472c62=>{const _0x445887=_0x3e1e78;_0x472c62['style']['display']=_0x445887(0x1e1);});else!_0x266c9d&&document['querySelectorAll'](_0x3e1e78(0x1eb))[_0x3e1e78(0x1c4)](_0xab177d=>{_0xab177d['style']['display']='none';});if(_0x266c9d){const _0x581bd7=userCache[_0x3e1e78(0x1d9)]||(_0x266c9d['email']?_0x266c9d['email']['split']('@')[0x0]:'User'),_0x40b3ce=userCache['role']?'\x20('+userCache[_0x3e1e78(0x1c0)]+')':_0x3e6705?'\x20(Admin)':'';_0x557563['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20class=\x22nav-username\x22>'+_0x581bd7+_0x40b3ce+'</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username='+encodeURIComponent(_0x581bd7)+'\x22>Profile</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./inbox.html\x22\x20class=\x22nav-notification\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Inbox\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22inbox-notification\x22\x20class=\x22notification-dot\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22members.html\x22>Members</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./redeem.html\x22><i\x20class=\x22fas\x20fa-gift\x22></i>\x20Redeem</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20id=\x22logout-link\x22>Sign\x20Out</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';const _0x525f8d=document['getElementById']('logout-link');_0x525f8d&&_0x525f8d['addEventListener'](_0x3e1e78(0x1c7),_0x28503c=>{_0x28503c['preventDefault']();const _0x561a86=getAuth();updateAuthSectionImmediate(null),_0x561a86['signOut']()['catch'](_0x54e9ed=>{console['error']('Error\x20signing\x20out:',_0x54e9ed);});}),_0x266c9d['uid']&&setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0x266c9d['uid']);},0x3e8);}else _0x557563['innerHTML']='<a\x20href=\x22login.html\x22\x20class=\x22login-link\x22>Login</a>';}async function checkAdminRoles(_0x16c08a){const _0x3e4e13=a12_0x2bfade;if(!_0x16c08a||!_0x16c08a['email'])return{'isAdmin':![],'role':null};try{console['log']('Checking\x20roles\x20for\x20user:\x20'+_0x16c08a['email']);const _0x2032db=['players','playersD2','playersD3','nonParticipants','userProfiles'],_0x19d091=['council',_0x3e4e13(0x1d5),_0x3e4e13(0x1d2),'admin'];for(const _0x529b67 of _0x2032db){try{const _0x58493e=doc(db,_0x529b67,_0x16c08a[_0x3e4e13(0x1cb)]),_0x43d542=await getDoc(_0x58493e);if(_0x43d542[_0x3e4e13(0x1e0)]()){const _0x45d9ea=_0x43d542['data']();console['log']('Found\x20user\x20in\x20'+_0x529b67+_0x3e4e13(0x1df),_0x45d9ea);let _0x4ccc5b=(_0x45d9ea['roleName']||_0x45d9ea['role']||'')['toLowerCase'](),_0x122b1d=_0x45d9ea['roleName']||_0x45d9ea['role']||'';if(_0x4ccc5b&&_0x19d091['includes'](_0x4ccc5b)){console['log'](_0x3e4e13(0x1c1)+_0x4ccc5b+'\x20in\x20'+_0x529b67);const _0x46ba87=_0x122b1d['split']('\x20')['map'](_0x374d86=>_0x374d86['charAt'](0x0)[_0x3e4e13(0x1cc)]()+_0x374d86['slice'](0x1)[_0x3e4e13(0x1d0)]())['join']('\x20');return{'isAdmin':!![],'role':_0x46ba87};}}}catch(_0x282417){console['error']('Error\x20checking\x20'+_0x529b67+'\x20by\x20UID:',_0x282417);}}for(const _0x3f5179 of _0x2032db){try{const _0x2fbd5f=collection(db,_0x3f5179);let _0xab6d74=query(_0x2fbd5f,where('email','==',_0x16c08a['email'])),_0x7fc717=await getDocs(_0xab6d74);_0x7fc717[_0x3e4e13(0x1dc)]&&(_0xab6d74=query(_0x2fbd5f,where('email','==',_0x16c08a[_0x3e4e13(0x1c3)]['toLowerCase']())),_0x7fc717=await getDocs(_0xab6d74));if(!_0x7fc717[_0x3e4e13(0x1dc)]){const _0x4d8492=_0x7fc717[_0x3e4e13(0x1e5)][0x0]['data']();console[_0x3e4e13(0x1ea)]('Found\x20user\x20in\x20'+_0x3f5179+'\x20by\x20email:',_0x4d8492);let _0x2a483f=(_0x4d8492[_0x3e4e13(0x1e8)]||_0x4d8492['role']||'')['toLowerCase'](),_0x3255fe=_0x4d8492['roleName']||_0x4d8492['role']||'';if(_0x2a483f&&_0x19d091['includes'](_0x2a483f)){console['log']('Found\x20admin\x20role:\x20'+_0x2a483f+_0x3e4e13(0x1e9)+_0x3f5179);const _0x2db924=_0x3255fe[_0x3e4e13(0x1de)]('\x20')['map'](_0x443ee4=>_0x443ee4['charAt'](0x0)[_0x3e4e13(0x1cc)]()+_0x443ee4['slice'](0x1)['toLowerCase']())['join']('\x20');return{'isAdmin':!![],'role':_0x2db924};}}}catch(_0x3ca423){console['error']('Error\x20checking\x20'+_0x3f5179+'\x20by\x20email:',_0x3ca423);}}return console['log'](_0x3e4e13(0x1c9)),{'isAdmin':![],'role':null};}catch(_0x4969fc){return console[_0x3e4e13(0x1e3)]('Error\x20in\x20checkAdminRoles:',_0x4969fc),{'isAdmin':![],'role':null};}}async function updateAuthSection(_0x550fd2){const _0x20c807=a12_0x2bfade,_0x21b5ba=_0x550fd2&&isAdmin(_0x550fd2['email']);updateAuthSectionImmediate(_0x550fd2,_0x21b5ba);if(!_0x550fd2){userCache['uid']=null,userCache['username']=null,userCache['isAdmin']=![],userCache['hasCheckedCollections']=![],userCache['role']=null;return;}const _0x4661a1=Date['now']();if(_0x550fd2['uid']===userCache['uid']&&userCache['hasCheckedCollections']&&_0x4661a1-userCache['lastChecked']<0x493e0)return;try{userCache[_0x20c807(0x1cb)]=_0x550fd2['uid'],userCache['lastChecked']=_0x4661a1;const _0x124885=isAdmin(_0x550fd2['email']);userCache[_0x20c807(0x1da)]=_0x124885;if(!_0x124885){const {isAdmin:_0x2331b0,role:_0x5e5793}=await checkAdminRoles(_0x550fd2);userCache[_0x20c807(0x1da)]=_0x2331b0,userCache['role']=_0x5e5793,_0x2331b0&&(document[_0x20c807(0x1cd)]('.admin-only')[_0x20c807(0x1c4)](_0x45a143=>{const _0x2b7e89=_0x20c807;_0x45a143[_0x2b7e89(0x1cf)]['display']='block';}),updateAuthSectionImmediate(_0x550fd2,!![]));}const _0x453021=['players','playersD2','playersD3',_0x20c807(0x1c5),'playersCTF','nonParticipants','userProfiles'],_0x582d8b=_0x453021['map'](_0x378f69=>getDoc(doc(db,_0x378f69,_0x550fd2[_0x20c807(0x1cb)]))['then'](_0x382a5d=>_0x382a5d['exists']()?{'collection':_0x378f69,'data':_0x382a5d['data']()}:null)['catch'](()=>null)),_0x4925a3=await Promise[_0x20c807(0x1d7)](_0x582d8b),_0x4829c1=_0x4925a3['filter'](_0x284801=>_0x284801!==null);let _0x48ed73=null;for(const _0x2d6dae of _0x4829c1){if(_0x2d6dae['data']['username']){_0x48ed73=_0x2d6dae['data'][_0x20c807(0x1d9)];break;}}userCache[_0x20c807(0x1d9)]=_0x48ed73||(_0x550fd2['email']?_0x550fd2['email']['split']('@')[0x0]:_0x20c807(0x1d6)),userCache[_0x20c807(0x1c8)]=!![],updateAuthSectionImmediate(_0x550fd2,userCache['isAdmin']),setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0x550fd2['uid']);},0x1f4);}catch(_0xdaed8d){console['error']('Error\x20in\x20full\x20auth\x20update:',_0xdaed8d);}}document['addEventListener']('DOMContentLoaded',()=>{const _0x2e2826=a12_0x2bfade,_0x5a6021=getAuth();onAuthStateChanged(_0x5a6021,async _0x4e05e9=>{const _0x468f52=a12_0x2c06;await updateAuthSection(_0x4e05e9),_0x4e05e9&&checkPendingInvitationsForCurrentUser(_0x4e05e9[_0x468f52(0x1cb)]);}),document['addEventListener']('visibilitychange',()=>{!document['hidden']&&_0x5a6021['currentUser']&&checkPendingInvitationsForCurrentUser(_0x5a6021['currentUser']['uid']);}),document[_0x2e2826(0x1ca)]('click',_0x4132dc=>{const _0x541d15=_0x2e2826;_0x4132dc['target']['closest']('a[href]')&&_0x5a6021['currentUser']&&checkPendingInvitationsForCurrentUser(_0x5a6021[_0x541d15(0x1dd)]['uid']);});});export{updateAuthSection};
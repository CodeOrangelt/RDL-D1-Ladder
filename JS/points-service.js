const a41_0x4f97d6=a41_0x1941,a41_0x452198=(function(){let _0x3e5c6d=!![];return function(_0x1f3112,_0x5ecc1b){const _0x401952=_0x3e5c6d?function(){if(_0x5ecc1b){const _0x3e1f10=_0x5ecc1b['apply'](_0x1f3112,arguments);return _0x5ecc1b=null,_0x3e1f10;}}:function(){};return _0x3e5c6d=![],_0x401952;};}()),a41_0x639ea=a41_0x452198(this,function(){const _0x4f4d79=a41_0x1941;let _0xbb0ea4;try{const _0x305bb9=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0xbb0ea4=_0x305bb9();}catch(_0x382132){_0xbb0ea4=window;}const _0x5c6962=_0xbb0ea4['console']=_0xbb0ea4[_0x4f4d79(0x82)]||{},_0x4f304d=[_0x4f4d79(0x87),'warn','info','error','exception','table',_0x4f4d79(0x80)];for(let _0x38f120=0x0;_0x38f120<_0x4f304d[_0x4f4d79(0x7f)];_0x38f120++){const _0x3d2262=a41_0x452198['constructor'][_0x4f4d79(0x8b)]['bind'](a41_0x452198),_0xe88cb9=_0x4f304d[_0x38f120],_0x5e0bae=_0x5c6962[_0xe88cb9]||_0x3d2262;_0x3d2262['__proto__']=a41_0x452198[_0x4f4d79(0x8a)](a41_0x452198),_0x3d2262[_0x4f4d79(0x81)]=_0x5e0bae['toString']['bind'](_0x5e0bae),_0x5c6962[_0xe88cb9]=_0x3d2262;}});a41_0x639ea();import{db}from'./firebase-config.js';import{doc,getDoc,updateDoc,addDoc,collection,serverTimestamp}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a41_0x1941(_0x16a9d5,_0x2cba4c){const _0x639ea=a41_0x140d();return a41_0x1941=function(_0x452198,_0xec132c){_0x452198=_0x452198-0x7e;let _0x140df5=_0x639ea[_0x452198];return _0x140df5;},a41_0x1941(_0x16a9d5,_0x2cba4c);}const POINTS_CHART={'':0xa,'Standard':0xa,'Standard\x20Match':0xa,'Fusion\x20Match':0x19,'â‰¥6\x20Missiles':0xa,'Weapon\x20Imbalance':0x1e,'No\x20Energy':0xf,'No\x20Shields':0xf,'Pilot\x20Assist\x20Only':0x14,'Classic\x20Robots':0xf,'Enhanced\x20CTF':0x19,'CTF\x20Hybrids':0x1e,'Custom\x20Weapon\x20Load':0x19,'Tracker/Merc':0x14,'Bomb/Bomb':0xf,'Zoom/Zoom':0xf,'Stock\x20Ships\x20Only':0x14,'Expert\x20AI\x20Match':0x23,'Challenge\x20Match':0x28,'Tournament\x20Match':0x32};function a41_0x140d(){const _0x1ad74e=['Match\x20points:\x20','length','trace','toString','console','system-match-award','add','Error\x20adding\x20points\x20to\x20user:','\x20points\x20to\x20both\x20players\x20for\x20','log','Admin\x20points\x20service\x20connected','Awarded\x20','bind','prototype','.\x20New\x20total:\x20','Standard','userProfiles'];a41_0x140d=function(){return _0x1ad74e;};return a41_0x140d();}let adminModifyUserPoints=null;try{const adminModule=await import('./adminbackend.js');adminModule['modifyUserPoints']&&(adminModifyUserPoints=adminModule['modifyUserPoints'],console['log'](a41_0x4f97d6(0x88)));}catch(a41_0x17e4b6){console[a41_0x4f97d6(0x87)]('Admin\x20backend\x20not\x20available,\x20using\x20fallback\x20points\x20service');}export async function awardMatchPoints(_0x272336,_0x380cde,_0x369909){const _0x47e438=a41_0x4f97d6;try{const _0x4ca937=POINTS_CHART[_0x369909]||0xa;return adminModifyUserPoints?await Promise['all']([adminModifyUserPoints(_0x272336,_0x47e438(0x84),_0x4ca937,'Match\x20points:\x20'+(_0x369909||_0x47e438(0x8d))+'\x20match\x20(Winner)'),adminModifyUserPoints(_0x380cde,_0x47e438(0x84),_0x4ca937,_0x47e438(0x7e)+(_0x369909||'Standard')+'\x20match\x20(Participant)')]):await Promise['all']([addPointsFallback(_0x272336,_0x4ca937,'Match\x20points:\x20'+(_0x369909||'Standard')+'\x20match\x20(Winner)'),addPointsFallback(_0x380cde,_0x4ca937,'Match\x20points:\x20'+(_0x369909||'Standard')+'\x20match\x20(Participant)')]),console['log'](_0x47e438(0x89)+_0x4ca937+_0x47e438(0x86)+(_0x369909||'Standard')+'\x20match'),!![];}catch(_0x3a00a6){return console['error']('Error\x20awarding\x20match\x20points:',_0x3a00a6),![];}}async function addPointsFallback(_0x5352d7,_0x25b870,_0x914c62=''){const _0x53ff0a=a41_0x4f97d6;try{const _0x42a2ea=doc(db,_0x53ff0a(0x8e),_0x5352d7),_0x18a7b1=await getDoc(_0x42a2ea);if(!_0x18a7b1['exists']()){console['log']('User\x20profile\x20not\x20found\x20for\x20'+_0x5352d7+',\x20skipping\x20points\x20award');return;}const _0x3774cc=_0x18a7b1['data'](),_0x1148c7=_0x3774cc['points']||0x0,_0x547f9f=_0x1148c7+_0x25b870;await updateDoc(_0x42a2ea,{'points':_0x547f9f,'lastPointsModified':serverTimestamp()}),await addDoc(collection(db,'pointsHistory'),{'userId':_0x5352d7,'userEmail':_0x3774cc['email']||'unknown','displayName':_0x3774cc['displayName']||_0x3774cc['username']||'Unknown\x20User','action':'add','amount':_0x25b870,'previousPoints':_0x1148c7,'newPoints':_0x547f9f,'reason':_0x914c62,'adminEmail':_0x53ff0a(0x83),'timestamp':serverTimestamp()}),console['log']('Added\x20'+_0x25b870+'\x20points\x20to\x20user\x20'+_0x5352d7+_0x53ff0a(0x8c)+_0x547f9f);}catch(_0x32fff6){console['error'](_0x53ff0a(0x85),_0x32fff6);throw _0x32fff6;}}
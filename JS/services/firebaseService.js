const a53r=a53b;(function(a,b){const q=a53b,c=a();while(!![]){try{const d=-parseInt(q(0x208))/0x1*(parseInt(q(0x200))/0x2)+parseInt(q(0x1ee))/0x3*(-parseInt(q(0x207))/0x4)+-parseInt(q(0x1ef))/0x5+-parseInt(q(0x1f9))/0x6*(parseInt(q(0x1fe))/0x7)+-parseInt(q(0x1ea))/0x8*(-parseInt(q(0x206))/0x9)+-parseInt(q(0x205))/0xa*(parseInt(q(0x1f4))/0xb)+parseInt(q(0x1f7))/0xc*(parseInt(q(0x1e6))/0xd);if(d===b)break;else c['push'](c['shift']());}catch(e){c['push'](c['shift']());}}}(a53a,0xe9408));import{db}from'../firebase-config.js';import{collection,doc,getDoc,getDocs,query,limit,startAfter,where,onSnapshot}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const cache={'userProfiles':new Map(),'ladderPlayers':new Map(),'matchResults':new Map(),'eloHistory':new Map()},CACHE_EXPIRY={'userProfiles':0x5*0x3c*0x3e8,'ladderPlayers':0x2*0x3c*0x3e8,'matchResults':0x1*0x3c*0x3e8,'eloHistory':0x3*0x3c*0x3e8};export const userProfilesRef=collection(db,a53r(0x1f2));export async function fetchPaginatedData(a,b=0xa,c=null){const s=a53r;let d=query(a,limit(b));c&&(d=query(d,startAfter(c)));const e=await getDocs(d),f=e['docs'][e[s(0x1f6)]['length']-0x1];return{'data':e['docs'][s(0x1f3)](g=>({'id':g['id'],...g[s(0x1fa)]()})),'lastVisible':f,'hasMore':e['docs'][s(0x1e9)]===b};}export async function getUserProfile(a){const t=a53r,b=cache['userProfiles'][t(0x1eb)](a);if(b&&Date['now']()-b[t(0x203)]<CACHE_EXPIRY['userProfiles'])return b[t(0x1fa)];const c=await getDoc(doc(userProfilesRef,a));if(c[t(0x204)]()){const d=c[t(0x1fa)]();return cache[t(0x1f2)]['set'](a,{'data':d,'timestamp':Date[t(0x1fb)]()}),d;}return null;}export async function getLadderData(a=0x1){const u=a53r,b=u(0x1f0)+a,c=cache[u(0x1fc)]['get'](b);if(c&&Date[u(0x1fb)]()-c['timestamp']<CACHE_EXPIRY[u(0x1fc)])return c[u(0x1fa)];const d=a===0x1?'players':'playersD'+a,e=collection(db,d),f=await getDocs(query(e,limit(0x64))),g=f[u(0x1f6)]['map'](h=>({'id':h['id'],...h['data']()}));return cache['ladderPlayers']['set'](b,{'data':g,'timestamp':Date[u(0x1fb)]()}),g;}export async function getEloHistoryBatch(a,b=0x1){const v=a53r,c=b===0x1?v(0x201):'eloHistoryD'+b,d=collection(db,c),e={},f=[];a[v(0x209)](h=>{const w=v,j=h+'_'+b,k=cache[w(0x201)]['get'](j);k&&Date[w(0x1fb)]()-k[w(0x203)]<CACHE_EXPIRY['eloHistory']?e[h]=k[w(0x1fa)]:f[w(0x1ed)](h);});const g=0xa;for(let h=0x0;h<f[v(0x1e9)];h+=g){const j=f['slice'](h,h+g);if(j['length']>0x0)try{const k=query(d,where(v(0x1ff),'in',j),limit(0x64)),l=await getDocs(k);l['docs'][v(0x209)](m=>{const x=v,n=m['data'](),o=n['playerId'];if(!e[o])e[o]=[];e[o]['push'](n);const p=o+'_'+b;cache[x(0x201)]['set'](p,{'data':e[o],'timestamp':Date[x(0x1fb)]()});});}catch(m){console[v(0x1fd)](v(0x1f5),m);}}return e;}let usernameCache=new Map(),usernameCacheTimestamp=Date[a53r(0x1fb)]();function a53b(a,b){const c=a53a();return a53b=function(d,e){d=d-0x1e6;let f=c[d];if(a53b['wPbMMd']===undefined){var g=function(l){const m='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let n='',o='';for(let p=0x0,q,r,s=0x0;r=l['charAt'](s++);~r&&(q=p%0x4?q*0x40+r:r,p++%0x4)?n+=String['fromCharCode'](0xff&q>>(-0x2*p&0x6)):0x0){r=m['indexOf'](r);}for(let t=0x0,u=n['length'];t<u;t++){o+='%'+('00'+n['charCodeAt'](t)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(o);};a53b['XaOxTS']=g,a=arguments,a53b['wPbMMd']=!![];}const h=c[0x0],i=d+h,j=a[i];return!j?(f=a53b['XaOxTS'](f),a[i]=f):f=j,f;},a53b(a,b);}function a53a(){const B=['mJm3CenTBMfH','mtiWotaWnuXswuzxva','zgL2AxnPB25F','DxnLCM5HBwu','DxnLCLbYB2zPBgvZ','BwfW','nduZmM5Jr3npwa','rxjYB3iGzMv0y2HPBMCGyMf0y2GGruXpigHPC3rVCNK6','zg9JCW','mta5otK2mdHvwhPiAuK','CgXHEwvYC0qZ','mZbYtfPjALe','zgf0yq','BM93','BgfKzgvYugXHEwvYCW','zxjYB3i','ndqYmZKZt1HVBuL1','CgXHEwvYswq','nerNDvn0DG','zwXVsgLZDg9YEq','DhLWzq','DgLTzxn0yw1W','zxHPC3rZ','ndyXotbdyNDkuMi','ntq4mtq3n2X0rNziCG','nZG2ndrXrKnyuhC','nty5nZa3zLjgqNrn','zM9YrwfJAa','nZHfuwDvy0G','CgXHEwvYC0qY','zg9J','BgvUz3rO','oenmt3reDa','z2v0','CgXHEwvYCW','ChvZAa'];a53a=function(){return B;};return a53a();}export function setupEfficientListener(a,b=[],c){const d=collection(db,a),e=query(d,...b),f=onSnapshot(e,g=>{const y=a53b,h=g['docChanges']()['map'](i=>({'type':i[y(0x202)],'id':i[y(0x1e8)]['id'],'data':i[y(0x1e8)]['data']()}));h['length']>0x0&&c(h,g[y(0x1f6)]);});return f;}export async function bulkResolveUsernames(a){const z=a53r,b=new Map();if(!a||a['length']===0x0)return b;const c=[z(0x1ec),z(0x1e7),z(0x1f8),'nonParticipants'];for(const d of c){const e=collection(db,d),f=await getDocs(e);f['forEach'](g=>{const A=z,h=g[A(0x1fa)]();h['username']&&a['includes'](g['id'])&&b['set'](g['id'],h[A(0x1f1)]);});}return b;}
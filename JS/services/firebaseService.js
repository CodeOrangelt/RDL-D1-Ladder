const a53r=a53b;function a53b(a,b){const c=a53a();return a53b=function(d,e){d=d-0x1f2;let f=c[d];if(a53b['aSOKhg']===undefined){var g=function(l){const m='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let n='',o='';for(let p=0x0,q,r,s=0x0;r=l['charAt'](s++);~r&&(q=p%0x4?q*0x40+r:r,p++%0x4)?n+=String['fromCharCode'](0xff&q>>(-0x2*p&0x6)):0x0){r=m['indexOf'](r);}for(let t=0x0,u=n['length'];t<u;t++){o+='%'+('00'+n['charCodeAt'](t)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(o);};a53b['maEcsp']=g,a=arguments,a53b['aSOKhg']=!![];}const h=c[0x0],i=d+h,j=a[i];return!j?(f=a53b['maEcsp'](f),a[i]=f):f=j,f;},a53b(a,b);}(function(a,b){const q=a53b,c=a();while(!![]){try{const d=parseInt(q(0x1fc))/0x1*(-parseInt(q(0x20f))/0x2)+parseInt(q(0x205))/0x3*(-parseInt(q(0x207))/0x4)+parseInt(q(0x1f8))/0x5+-parseInt(q(0x1fa))/0x6*(-parseInt(q(0x201))/0x7)+-parseInt(q(0x1ff))/0x8+-parseInt(q(0x206))/0x9+parseInt(q(0x1fd))/0xa;if(d===b)break;else c['push'](c['shift']());}catch(e){c['push'](c['shift']());}}}(a53a,0x4fd0c));import{db}from'../firebase-config.js';import{collection,doc,getDoc,getDocs,query,limit,startAfter,where,onSnapshot}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const cache={'userProfiles':new Map(),'ladderPlayers':new Map(),'matchResults':new Map(),'eloHistory':new Map()},CACHE_EXPIRY={'userProfiles':0x5*0x3c*0x3e8,'ladderPlayers':0x2*0x3c*0x3e8,'matchResults':0x1*0x3c*0x3e8,'eloHistory':0x3*0x3c*0x3e8};export const userProfilesRef=collection(db,a53r(0x1f5));export async function fetchPaginatedData(a,b=0xa,c=null){let d=query(a,limit(b));c&&(d=query(d,startAfter(c)));const e=await getDocs(d),f=e['docs'][e['docs']['length']-0x1];return{'data':e['docs']['map'](g=>({'id':g['id'],...g['data']()})),'lastVisible':f,'hasMore':e['docs']['length']===b};}export async function getUserProfile(a){const s=a53r,b=cache[s(0x1f5)][s(0x200)](a);if(b&&Date['now']()-b['timestamp']<CACHE_EXPIRY['userProfiles'])return b[s(0x1f6)];const c=await getDoc(doc(userProfilesRef,a));if(c['exists']()){const d=c[s(0x1f6)]();return cache[s(0x1f5)]['set'](a,{'data':d,'timestamp':Date['now']()}),d;}return null;}export async function getLadderData(a=0x1){const t=a53r,b=t(0x203)+a,c=cache[t(0x211)][t(0x200)](b);if(c&&Date['now']()-c[t(0x1f4)]<CACHE_EXPIRY[t(0x211)])return c[t(0x1f6)];const d=a===0x1?'players':t(0x208)+a,e=collection(db,d),f=await getDocs(query(e,limit(0x64))),g=f['docs'][t(0x202)](h=>({'id':h['id'],...h['data']()}));return cache[t(0x211)][t(0x1f9)](b,{'data':g,'timestamp':Date[t(0x20a)]()}),g;}export async function getEloHistoryBatch(a,b=0x1){const u=a53r,c=b===0x1?u(0x20b):u(0x1fe)+b,d=collection(db,c),e={},f=[];a[u(0x1f7)](h=>{const v=u,j=h+'_'+b,k=cache['eloHistory']['get'](j);k&&Date['now']()-k[v(0x1f4)]<CACHE_EXPIRY['eloHistory']?e[h]=k['data']:f[v(0x204)](h);});const g=0xa;for(let h=0x0;h<f[u(0x213)];h+=g){const j=f[u(0x20d)](h,h+g);if(j[u(0x213)]>0x0)try{const k=query(d,where(u(0x209),'in',j),limit(0x64)),l=await getDocs(k);l['docs'][u(0x1f7)](m=>{const w=u,n=m[w(0x1f6)](),o=n[w(0x209)];if(!e[o])e[o]=[];e[o]['push'](n);const p=o+'_'+b;cache[w(0x20b)]['set'](p,{'data':e[o],'timestamp':Date['now']()});});}catch(m){console['error'](u(0x1f2),m);}}return e;}let usernameCache=new Map(),usernameCacheTimestamp=Date[a53r(0x20a)]();export function setupEfficientListener(a,b=[],c){const d=collection(db,a),e=query(d,...b),f=onSnapshot(e,g=>{const x=a53b,h=g[x(0x1f3)]()['map'](i=>({'type':i[x(0x212)],'id':i['doc']['id'],'data':i['doc'][x(0x1f6)]()}));h['length']>0x0&&c(h,g[x(0x210)]);});return f;}function a53a(){const A=['zwXVsgLZDg9YEuq','mti4mJiYnhbcrev0Aa','z2v0','mtrjrgXrvu0','BwfW','zgL2AxnPB25F','ChvZAa','m3nUyMPdAq','mtyZmdyYme5fAhfIzW','mtq5mJrACvnnr1e','CgXHEwvYC0q','CgXHEwvYswq','BM93','zwXVsgLZDg9YEq','CgXHEwvYC0qZ','C2XPy2u','BM9UugfYDgLJAxbHBNrZ','nfzTrK9Pzq','zg9JCW','BgfKzgvYugXHEwvYCW','DhLWzq','BgvUz3rO','rxjYB3iGzMv0y2HPBMCGyMf0y2GGruXpigHPC3rVCNK6','zg9Jq2HHBMDLCW','DgLTzxn0yw1W','DxnLCLbYB2zPBgvZ','zgf0yq','zM9YrwfJAa','mJqYmdy0mej5t2Xnrq','C2v0','ntq3mZmYvwzqEwzo','DxnLCM5HBwu','mJi2ou5gEKzcqG','mtaWnZKWCxncs1D0'];a53a=function(){return A;};return a53a();}export async function bulkResolveUsernames(a){const y=a53r,b=new Map();if(!a||a[y(0x213)]===0x0)return b;const c=['players','playersD2',y(0x20c),y(0x20e)];for(const d of c){const e=collection(db,d),f=await getDocs(e);f['forEach'](g=>{const z=y,h=g[z(0x1f6)]();h[z(0x1fb)]&&a['includes'](g['id'])&&b['set'](g['id'],h[z(0x1fb)]);});}return b;}
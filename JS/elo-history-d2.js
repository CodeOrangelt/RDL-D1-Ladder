const a14q=a14d;(function(a,b){const n=a14d,c=a();while(!![]){try{const d=-parseInt(n(0x169))/0x1*(parseInt(n(0x17f))/0x2)+parseInt(n(0x176))/0x3*(parseInt(n(0x16d))/0x4)+parseInt(n(0x175))/0x5+-parseInt(n(0x17d))/0x6+-parseInt(n(0x185))/0x7*(parseInt(n(0x168))/0x8)+parseInt(n(0x186))/0x9*(-parseInt(n(0x181))/0xa)+parseInt(n(0x164))/0xb*(parseInt(n(0x17a))/0xc);if(d===b)break;else c['push'](c['shift']());}catch(e){c['push'](c['shift']());}}}(a14c,0xbf203));const a14b=(function(){let a=!![];return function(b,c){const d=a?function(){const o=a14d;if(c){const e=c[o(0x17e)](b,arguments);return c=null,e;}}:function(){};return a=![],d;};}()),a14a=a14b(this,function(){const p=a14d;let a;try{const d=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');a=d();}catch(f){a=window;}const b=a['console']=a['console']||{},c=['log',p(0x17c),'info',p(0x16a),p(0x171),p(0x166),'trace'];for(let g=0x0;g<c['length'];g++){const h=a14b['constructor']['prototype'][p(0x177)](a14b),i=c[g],j=b[i]||h;h['__proto__']=a14b[p(0x177)](a14b),h[p(0x178)]=j[p(0x178)]['bind'](j),b[i]=h;}});a14a();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D2=[{'name':'Gold','elo':0x708},{'name':'Silver','elo':0x640},{'name':a14q(0x16b),'elo':0x578},{'name':'Unranked','elo':0x4b0}];let lastVisibleD2=null;async function getUsernameByIdD2(a){const r=a14q;try{if(!a)return'Unknown\x20Player';const b=await getDoc(doc(db,'playersD2',a));if(b['exists']())return b[r(0x16f)]()[r(0x184)]||'Unknown\x20Player';const c=await getDocs(query(collection(db,r(0x17b)),where('winnerId','==',a),limit(0x1)));if(!c[r(0x180)])return c['docs'][0x0][r(0x16f)]()[r(0x165)]||'Unknown\x20Player';const d=await getDocs(query(collection(db,'approvedMatchesD2'),where('loserId','==',a),limit(0x1)));if(!d['empty'])return d[r(0x172)][0x0][r(0x16f)]()[r(0x189)]||'Unknown\x20Player';return'Unknown\x20Player';}catch(e){return console[r(0x16a)](r(0x16e),e),r(0x188);}}function a14d(a,b){const c=a14c();return a14d=function(d,e){d=d-0x164;let f=c[d];if(a14d['kDXVEZ']===undefined){var g=function(l){const m='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let n='',o='';for(let p=0x0,q,r,s=0x0;r=l['charAt'](s++);~r&&(q=p%0x4?q*0x40+r:r,p++%0x4)?n+=String['fromCharCode'](0xff&q>>(-0x2*p&0x6)):0x0){r=m['indexOf'](r);}for(let t=0x0,u=n['length'];t<u;t++){o+='%'+('00'+n['charCodeAt'](t)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(o);};a14d['yBFUsi']=g,a=arguments,a14d['kDXVEZ']=!![];}const h=c[0x0],i=d+h,j=a[i];return!j?(f=a14d['yBFUsi'](f),a[i]=f):f=j,f;},a14d(a,b);}export async function recordEloChangeD2({playerId:a,previousElo:b,newElo:c,opponentId:d,matchResult:e,previousPosition:f,newPosition:g,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:h,timestamp:i}){const s=a14q;try{const j=doc(collection(db,'eloHistoryD2'));let k='match';if(isPromotion)k='promotion';if(isDemotion)k='demotion';let l=s(0x187);if(c>=0x834)l='Emerald';else{if(c>=0x708)l='Gold';else{if(c>=0x640)l=s(0x183);else{if(c>=0x578)l=s(0x16b);}}}return await setDoc(j,{'type':k,'player':a,'opponent':d,'previousElo':b,'newElo':c,'change':c-b,'matchResult':e,'previousPosition':f,'newPosition':g,'rankAchieved':l,'matchId':h,'timestamp':i}),console[s(0x18b)]('D2\x20ELO\x20history\x20recorded\x20for\x20'+a),!![];}catch(m){console['error'](s(0x170),m);throw m;}}function a14c(){const v=['mti4ndiYohfTvxHtAa','yMLUza','Dg9tDhjPBMC','BgvUz3rO','nZaZmZjwq3r5BNu','yxbWCM92zwrnyxrJAgvZrdi','D2fYBG','nZe1odaWvwfpCM92','yxbWBhK','mJCWmtCXmNnHuxvwAq','zw1WDhK','mJa1mZCWrNjUt0Tw','BMv3rwXV','u2LSDMvY','DxnLCM5HBwu','odK4mxLoA3vSBa','ntq5v3LlB2TP','vw5Yyw5Rzwq','vw5RBM93BIbqBgf5zxi','Bg9ZzxjvC2vYBMfTzq','ywXS','Bg9N','ntG2m0nIzKH1ra','D2LUBMvYvxnLCM5HBwu','DgfIBgu','B3bWB25LBNq','ndG4CK5oAgrO','mwr3tff3ra','zxjYB3i','qNjVBNPL','zgvZyW','ng5oBeLNCG','rxjYB3iGz2v0DgLUzYb1C2vYBMfTztO','zgf0yq','rxjYB3iGCMvJB3jKAw5NieqYievmtYbOAxn0B3j5oG','zxHJzxb0Aw9U','zg9JCW','DgLTzxn0yw1W','zwXVsgLZDg9YEuqY','mtyWmtKWyNbKCg5f'];a14c=function(){return v;};return a14c();}export async function getEloHistoryD2(a=0x14){const t=a14q;try{const b=collection(db,t(0x174));let c;lastVisibleD2?c=query(b,orderBy('timestamp',t(0x16c)),startAfter(lastVisibleD2),limit(a)):c=query(b,orderBy(t(0x173),'desc'),limit(a));const d=await getDocs(c);if(d['empty'])return{'entries':[],'hasMore':![]};lastVisibleD2=d[t(0x172)][d['docs'][t(0x179)]-0x1];const e=d['docs']['map'](async g=>{const u=t,h=g[u(0x16f)](),[i,j]=await Promise[u(0x18a)]([getUsernameByIdD2(h['player']),getUsernameByIdD2(h[u(0x167)])]);return{...h,'playerUsername':i,'opponentUsername':j,'change':h[u(0x182)]-h['previousElo'],'timestamp':h['timestamp']};}),f=await Promise[t(0x18a)](e);return{'entries':f,'hasMore':d['size']===a};}catch(g){console['error']('Error\x20fetching\x20D2\x20ELO\x20history:',g);throw g;}}export function resetPaginationD2(){lastVisibleD2=null;}
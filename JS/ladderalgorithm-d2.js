const a26_0x5e12a1=(function(){let _0x4a7bbd=!![];return function(_0x53a393,_0x30ab32){const _0x4f30d9=_0x4a7bbd?function(){const _0xf2450f=a26_0x19a6;if(_0x30ab32){const _0x2ee13f=_0x30ab32[_0xf2450f(0x17f)](_0x53a393,arguments);return _0x30ab32=null,_0x2ee13f;}}:function(){};return _0x4a7bbd=![],_0x4f30d9;};}()),a26_0x327966=a26_0x5e12a1(this,function(){const _0x57d43b=a26_0x19a6,_0x8e4ea0=function(){const _0x39ea47=a26_0x19a6;let _0x4dfae8;try{_0x4dfae8=Function(_0x39ea47(0x184)+_0x39ea47(0x15b)+');')();}catch(_0x1c27af){_0x4dfae8=window;}return _0x4dfae8;},_0x3fa488=_0x8e4ea0(),_0x19e426=_0x3fa488[_0x57d43b(0x190)]=_0x3fa488[_0x57d43b(0x190)]||{},_0x3aa29c=[_0x57d43b(0x176),_0x57d43b(0x192),_0x57d43b(0x175),_0x57d43b(0x191),_0x57d43b(0x168),_0x57d43b(0x15d),_0x57d43b(0x186)];for(let _0x3e96d3=0x0;_0x3e96d3<_0x3aa29c[_0x57d43b(0x15e)];_0x3e96d3++){const _0xeb780f=a26_0x5e12a1[_0x57d43b(0x173)][_0x57d43b(0x159)][_0x57d43b(0x18f)](a26_0x5e12a1),_0x1ab757=_0x3aa29c[_0x3e96d3],_0x3368a5=_0x19e426[_0x1ab757]||_0xeb780f;_0xeb780f[_0x57d43b(0x182)]=a26_0x5e12a1[_0x57d43b(0x18f)](a26_0x5e12a1),_0xeb780f[_0x57d43b(0x193)]=_0x3368a5[_0x57d43b(0x193)][_0x57d43b(0x18f)](_0x3368a5),_0x19e426[_0x1ab757]=_0xeb780f;}});a26_0x327966();import{collection,doc,getDoc,getDocs,updateDoc,setDoc,deleteDoc,writeBatch,query,where,serverTimestamp,addDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';function a26_0x19a6(_0x5cacec,_0x248775){const _0x327966=a26_0x3afd();return a26_0x19a6=function(_0x5e12a1,_0x5cf353){_0x5e12a1=_0x5e12a1-0x157;let _0x3afdfe=_0x327966[_0x5e12a1];return _0x3afdfe;},a26_0x19a6(_0x5cacec,_0x248775);}import{recordEloChangeD2}from'./elo-history-d2.js';function a26_0x3afd(){const _0x23ed2b=['winnerUsername','win','prototype','loserUsername','{}.constructor(\x22return\x20this\x22)(\x20)','MAX_SAFE_INTEGER','table','length','exists','username','One\x20or\x20both\x20D2\x20players\x20not\x20found','loss','Error\x20in\x20approveReportD2:','D2\x20Report\x20data:','D2\x20Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked','D2\x20Match\x20successfully\x20approved\x20and\x20ELO\x20updated','Only\x20the\x20winner\x20can\x20approve\x20D2\x20matches','exception','round','position','Could\x20not\x20find\x20D2\x20player\x20documents','data','Current\x20user:','createdAt','D2\x20match\x20report\x20not\x20found','D2\x20Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions','approvedMatchesD2','D2\x20Report\x20not\x20found\x20with\x20ID:','constructor','D2\x20ELO\x20ratings\x20updated\x20successfully','info','log','D2\x20Match\x20moved\x20to\x20approved\x20collection','docs','email','match-d2','currentUser','eloRating','checkAndRecordPromotion','empty','apply','You\x20must\x20be\x20logged\x20in\x20to\x20approve\x20D2\x20matches','Error\x20in\x20updateEloRatingsD2:','__proto__','commit','return\x20(function()\x20','pendingMatchesD2','trace','Starting\x20approveReportD2\x20function\x20with:','uid','No\x20user\x20logged\x20in','Current\x20username:','all','update','playersD2','pow','bind','console','error','warn','toString'];a26_0x3afd=function(){return _0x23ed2b;};return a26_0x3afd();}import{promotionManager}from'./promotions.js';import a26_0x5b559c from'./firebase-idle-wrapper.js';export function calculateEloD2(_0x3ded8e,_0x4d9ef7,_0x9a3f75=0x20){const _0x1a43a4=a26_0x19a6,_0x51a6e4=0x1/(0x1+Math[_0x1a43a4(0x18e)](0xa,(_0x4d9ef7-_0x3ded8e)/0x190)),_0x5e4fe1=0x1/(0x1+Math[_0x1a43a4(0x18e)](0xa,(_0x3ded8e-_0x4d9ef7)/0x190)),_0x46ad8d=_0x3ded8e+_0x9a3f75*(0x1-_0x51a6e4),_0x117d9e=_0x4d9ef7+_0x9a3f75*(0x0-_0x5e4fe1);return{'newWinnerRating':Math[_0x1a43a4(0x169)](_0x46ad8d),'newLoserRating':Math[_0x1a43a4(0x169)](_0x117d9e)};}export async function updateEloRatingsD2(_0x4dcc41,_0x37f205,_0x11c728){const _0x124dde=a26_0x19a6;try{const _0x43e6b6=writeBatch(db),_0x313ac5=doc(db,_0x124dde(0x18d),_0x4dcc41),_0x5b74e4=doc(db,_0x124dde(0x18d),_0x37f205),[_0x1d0fde,_0x1bc8b8]=await Promise[_0x124dde(0x18b)]([getDoc(_0x313ac5),getDoc(_0x5b74e4)]);if(!_0x1d0fde[_0x124dde(0x15f)]()||!_0x1bc8b8[_0x124dde(0x15f)]())throw new Error(_0x124dde(0x161));const _0x5d4ab1=_0x1d0fde[_0x124dde(0x16c)](),_0x50bc8c=_0x1bc8b8[_0x124dde(0x16c)](),_0xe7e012=_0x5d4ab1[_0x124dde(0x16a)]||Number[_0x124dde(0x15c)],_0x4e9fd1=_0x50bc8c[_0x124dde(0x16a)]||Number[_0x124dde(0x15c)],{newWinnerRating:_0x46523e,newLoserRating:_0x5c7a2a}=calculateEloD2(_0x5d4ab1[_0x124dde(0x17c)]||0x4b0,_0x50bc8c[_0x124dde(0x17c)]||0x4b0);let _0x3ebf60=_0xe7e012,_0x3a76e3=_0x4e9fd1;if(_0xe7e012>_0x4e9fd1){console[_0x124dde(0x176)](_0x124dde(0x165)),_0x3ebf60=_0x4e9fd1,_0x3a76e3=_0x4e9fd1+0x1;const _0x581228=query(collection(db,_0x124dde(0x18d)),where(_0x124dde(0x16a),'>',_0x4e9fd1),where(_0x124dde(0x16a),'<',_0xe7e012)),_0x474fe4=await getDocs(_0x581228);for(const _0xca414 of _0x474fe4[_0x124dde(0x178)]){_0xca414['id']!==_0x4dcc41&&_0xca414['id']!==_0x37f205&&_0x43e6b6[_0x124dde(0x18c)](doc(db,_0x124dde(0x18d),_0xca414['id']),{'position':_0xca414[_0x124dde(0x16c)]()[_0x124dde(0x16a)]+0x1});}}else console[_0x124dde(0x176)](_0x124dde(0x170));return _0x43e6b6[_0x124dde(0x18c)](_0x313ac5,{'eloRating':_0x46523e,'lastMatchDate':serverTimestamp(),'position':_0x3ebf60,'lastMatchId':_0x11c728}),_0x43e6b6[_0x124dde(0x18c)](_0x5b74e4,{'eloRating':_0x5c7a2a,'lastMatchDate':serverTimestamp(),'position':_0x3a76e3,'lastMatchId':_0x11c728}),await _0x43e6b6[_0x124dde(0x183)](),console[_0x124dde(0x176)](_0x124dde(0x174)),await Promise[_0x124dde(0x18b)]([recordEloChangeD2({'playerId':_0x4dcc41,'previousElo':_0x5d4ab1[_0x124dde(0x17c)]||0x4b0,'newElo':_0x46523e,'opponentId':_0x37f205,'matchResult':_0x124dde(0x158),'previousPosition':_0xe7e012,'newPosition':_0x3ebf60,'isPromotion':_0x3ebf60<_0xe7e012,'matchId':_0x11c728,'timestamp':serverTimestamp()}),recordEloChangeD2({'playerId':_0x37f205,'previousElo':_0x50bc8c[_0x124dde(0x17c)]||0x4b0,'newElo':_0x5c7a2a,'opponentId':_0x4dcc41,'matchResult':_0x124dde(0x162),'previousPosition':_0x4e9fd1,'newPosition':_0x3a76e3,'isDemotion':_0x3a76e3>_0x4e9fd1,'matchId':_0x11c728,'timestamp':serverTimestamp()})]),await promotionManager[_0x124dde(0x17d)](_0x4dcc41,_0x46523e,_0x5d4ab1[_0x124dde(0x17c)],{'source':_0x124dde(0x17a),'matchId':_0x11c728}),await promotionManager[_0x124dde(0x17d)](_0x37f205,_0x5c7a2a,_0x50bc8c[_0x124dde(0x17c)],{'source':_0x124dde(0x17a),'matchId':_0x11c728}),!![];}catch(_0x5cc3f3){console[_0x124dde(0x191)](_0x124dde(0x181),_0x5cc3f3);throw _0x5cc3f3;}}export async function approveReportD2(_0x58d437,_0xe157c5,_0x2b2763,_0x4c3da1){const _0x127599=a26_0x19a6;try{console[_0x127599(0x176)](_0x127599(0x187),{'reportId':_0x58d437,'winnerScore':_0xe157c5,'winnerSuicides':_0x2b2763,'winnerComment':_0x4c3da1});const _0x47f624=auth[_0x127599(0x17b)];if(!_0x47f624){console[_0x127599(0x176)](_0x127599(0x189));throw new Error(_0x127599(0x180));}console[_0x127599(0x176)](_0x127599(0x16d),_0x47f624[_0x127599(0x179)]);const _0x569fb2=await getDoc(doc(db,_0x127599(0x18d),_0x47f624[_0x127599(0x188)])),_0x1d0574=_0x569fb2[_0x127599(0x15f)]()?_0x569fb2[_0x127599(0x16c)]()[_0x127599(0x160)]:null;console[_0x127599(0x176)](_0x127599(0x18a),_0x1d0574);const _0x466ef6=doc(db,_0x127599(0x185),_0x58d437),_0x51b0dc=await getDoc(_0x466ef6);if(!_0x51b0dc[_0x127599(0x15f)]()){console[_0x127599(0x176)](_0x127599(0x172),_0x58d437);throw new Error(_0x127599(0x16f));}const _0x79c348=_0x51b0dc[_0x127599(0x16c)]();console[_0x127599(0x176)](_0x127599(0x164),_0x79c348);if(_0x1d0574!==_0x79c348[_0x127599(0x157)])throw new Error(_0x127599(0x167));const _0x5c1198={..._0x79c348,'winnerScore':_0xe157c5,'winnerSuicides':_0x2b2763,'winnerComment':_0x4c3da1,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':_0x1d0574,'createdAt':_0x79c348[_0x127599(0x16e)]||serverTimestamp(),'winnerUsername':_0x79c348[_0x127599(0x157)],'loserUsername':_0x79c348[_0x127599(0x15a)]};await setDoc(doc(db,_0x127599(0x171),_0x58d437),_0x5c1198),await deleteDoc(_0x466ef6),console[_0x127599(0x176)](_0x127599(0x177));const [_0x309e3e,_0x515d72]=await Promise[_0x127599(0x18b)]([getDocs(query(collection(db,_0x127599(0x18d)),where(_0x127599(0x160),'==',_0x79c348[_0x127599(0x157)]))),getDocs(query(collection(db,_0x127599(0x18d)),where(_0x127599(0x160),'==',_0x79c348[_0x127599(0x15a)])))]);if(_0x309e3e[_0x127599(0x17e)]||_0x515d72[_0x127599(0x17e)])throw new Error(_0x127599(0x16b));const _0x3f8a6c=_0x309e3e[_0x127599(0x178)][0x0]['id'],_0x887114=_0x515d72[_0x127599(0x178)][0x0]['id'];return await updateEloRatingsD2(_0x3f8a6c,_0x887114,_0x58d437),console[_0x127599(0x176)](_0x127599(0x166)),!![];}catch(_0x30c1d1){console[_0x127599(0x191)](_0x127599(0x163),_0x30c1d1);throw _0x30c1d1;}}
const a14_0x47ac7e=a14_0x2b45,a14_0x13eab5=(function(){let _0x288f2c=!![];return function(_0x4fcc14,_0x25bd14){const _0x2bb367=_0x288f2c?function(){if(_0x25bd14){const _0x587b6b=_0x25bd14['apply'](_0x4fcc14,arguments);return _0x25bd14=null,_0x587b6b;}}:function(){};return _0x288f2c=![],_0x2bb367;};}()),a14_0x597c1b=a14_0x13eab5(this,function(){const _0x1e0af7=a14_0x2b45,_0x5538b0=function(){const _0x190076=a14_0x2b45;let _0x27be88;try{_0x27be88=Function(_0x190076(0xfa)+_0x190076(0x107)+');')();}catch(_0x4a3cb2){_0x27be88=window;}return _0x27be88;},_0x199b57=_0x5538b0(),_0x563842=_0x199b57['console']=_0x199b57['console']||{},_0x5c9ecc=[_0x1e0af7(0xfc),'warn','info','error','exception',_0x1e0af7(0x100),'trace'];for(let _0x133867=0x0;_0x133867<_0x5c9ecc['length'];_0x133867++){const _0x5ba852=a14_0x13eab5['constructor'][_0x1e0af7(0xfd)]['bind'](a14_0x13eab5),_0x5b73c6=_0x5c9ecc[_0x133867],_0x48ec5d=_0x563842[_0x5b73c6]||_0x5ba852;_0x5ba852['__proto__']=a14_0x13eab5['bind'](a14_0x13eab5),_0x5ba852['toString']=_0x48ec5d[_0x1e0af7(0x106)][_0x1e0af7(0xff)](_0x48ec5d),_0x563842[_0x5b73c6]=_0x5ba852;}});a14_0x597c1b();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a14_0x2e1e(){const _0x22c49f=['timestamp','return\x20(function()\x20','Bronze','log','prototype','data','bind','table','Error\x20getting\x20username:','Unknown\x20Player','error','exists','approvedMatchesD2','toString','{}.constructor(\x22return\x20this\x22)(\x20)','Unranked','username','loserUsername','eloHistoryD2','loserId'];a14_0x2e1e=function(){return _0x22c49f;};return a14_0x2e1e();}import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D2=[{'name':'Gold','elo':0x708},{'name':'Silver','elo':0x640},{'name':a14_0x47ac7e(0xfb),'elo':0x578},{'name':'Unranked','elo':0x4b0}];let lastVisibleD2=null;async function getUsernameByIdD2(_0x2b08e3){const _0x14d334=a14_0x47ac7e;try{if(!_0x2b08e3)return'Unknown\x20Player';const _0x5dc3d3=await getDoc(doc(db,'playersD2',_0x2b08e3));if(_0x5dc3d3[_0x14d334(0x104)]())return _0x5dc3d3['data']()[_0x14d334(0x109)]||_0x14d334(0x102);const _0x15f01e=await getDocs(query(collection(db,_0x14d334(0x105)),where('winnerId','==',_0x2b08e3),limit(0x1)));if(!_0x15f01e['empty'])return _0x15f01e['docs'][0x0]['data']()['winnerUsername']||'Unknown\x20Player';const _0x4699a4=await getDocs(query(collection(db,_0x14d334(0x105)),where(_0x14d334(0x10c),'==',_0x2b08e3),limit(0x1)));if(!_0x4699a4['empty'])return _0x4699a4['docs'][0x0]['data']()[_0x14d334(0x10a)]||_0x14d334(0x102);return'Unknown\x20Player';}catch(_0x1477bd){return console[_0x14d334(0x103)](_0x14d334(0x101),_0x1477bd),'Unknown\x20Player';}}export async function recordEloChangeD2({playerId:_0xe64d50,previousElo:_0x48b289,newElo:_0x362f8a,opponentId:_0x50c4d3,matchResult:_0x6e7136,previousPosition:_0x33c39f,newPosition:_0x2c288f,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x67ed88,timestamp:_0x33ec2f}){const _0x4ea54a=a14_0x47ac7e;try{const _0x3b3d13=doc(collection(db,'eloHistoryD2'));let _0x176ff1='match';if(isPromotion)_0x176ff1='promotion';if(isDemotion)_0x176ff1='demotion';let _0x5568a7=_0x4ea54a(0x108);if(_0x362f8a>=0x834)_0x5568a7='Emerald';else{if(_0x362f8a>=0x708)_0x5568a7='Gold';else{if(_0x362f8a>=0x640)_0x5568a7='Silver';else{if(_0x362f8a>=0x578)_0x5568a7='Bronze';}}}return await setDoc(_0x3b3d13,{'type':_0x176ff1,'player':_0xe64d50,'opponent':_0x50c4d3,'previousElo':_0x48b289,'newElo':_0x362f8a,'change':_0x362f8a-_0x48b289,'matchResult':_0x6e7136,'previousPosition':_0x33c39f,'newPosition':_0x2c288f,'rankAchieved':_0x5568a7,'matchId':_0x67ed88,'timestamp':_0x33ec2f}),console['log']('D2\x20ELO\x20history\x20recorded\x20for\x20'+_0xe64d50),!![];}catch(_0x4c1057){console[_0x4ea54a(0x103)]('Error\x20recording\x20D2\x20ELO\x20history:',_0x4c1057);throw _0x4c1057;}}function a14_0x2b45(_0x250c14,_0x2155a8){const _0x597c1b=a14_0x2e1e();return a14_0x2b45=function(_0x13eab5,_0x56c146){_0x13eab5=_0x13eab5-0xf9;let _0x2e1ea8=_0x597c1b[_0x13eab5];return _0x2e1ea8;},a14_0x2b45(_0x250c14,_0x2155a8);}export async function getEloHistoryD2(_0x275036=0x14){const _0x37a950=a14_0x47ac7e;try{const _0x3073e7=collection(db,_0x37a950(0x10b));let _0x2b3320;lastVisibleD2?_0x2b3320=query(_0x3073e7,orderBy('timestamp','desc'),startAfter(lastVisibleD2),limit(_0x275036)):_0x2b3320=query(_0x3073e7,orderBy(_0x37a950(0xf9),'desc'),limit(_0x275036));const _0x35201c=await getDocs(_0x2b3320);if(_0x35201c['empty'])return{'entries':[],'hasMore':![]};lastVisibleD2=_0x35201c['docs'][_0x35201c['docs']['length']-0x1];const _0x1bfd20=_0x35201c['docs']['map'](async _0x27702a=>{const _0x345c0a=_0x37a950,_0xdc1700=_0x27702a[_0x345c0a(0xfe)](),[_0x2dc2ba,_0x4d1d81]=await Promise['all']([getUsernameByIdD2(_0xdc1700['player']),getUsernameByIdD2(_0xdc1700['opponent'])]);return{..._0xdc1700,'playerUsername':_0x2dc2ba,'opponentUsername':_0x4d1d81,'change':_0xdc1700['newElo']-_0xdc1700['previousElo'],'timestamp':_0xdc1700[_0x345c0a(0xf9)]};}),_0x2bf26c=await Promise['all'](_0x1bfd20);return{'entries':_0x2bf26c,'hasMore':_0x35201c['size']===_0x275036};}catch(_0x552514){console[_0x37a950(0x103)]('Error\x20fetching\x20D2\x20ELO\x20history:',_0x552514);throw _0x552514;}}export function resetPaginationD2(){lastVisibleD2=null;}
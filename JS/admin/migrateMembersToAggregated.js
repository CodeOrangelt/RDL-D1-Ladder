import{initializeApp}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';import{getFirestore,collection,getDocs,writeBatch,doc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{firebaseConfig}from'../firebase-config.js';const app=initializeApp(firebaseConfig),db=getFirestore(app);async function migrateToAggregatedMembers(){const _0x3e8057=a1_0x2af1,_0x1eb10d=(function(){let _0x848829=!![];return function(_0xa4c864,_0x14bb68){const _0x2ad6f5=_0x848829?function(){if(_0x14bb68){const _0x461e1e=_0x14bb68['apply'](_0xa4c864,arguments);return _0x14bb68=null,_0x461e1e;}}:function(){};return _0x848829=![],_0x2ad6f5;};}()),_0x2b4b9a=_0x1eb10d(this,function(){const _0x3467a2=a1_0x2af1;let _0xbb29ac;try{const _0x465107=Function('return\x20(function()\x20'+_0x3467a2(0x9d)+');');_0xbb29ac=_0x465107();}catch(_0x1bc73d){_0xbb29ac=window;}const _0xf417aa=_0xbb29ac['console']=_0xbb29ac['console']||{},_0x58266f=['log','warn','info','error','exception','table',_0x3467a2(0x8f)];for(let _0x2b89bf=0x0;_0x2b89bf<_0x58266f['length'];_0x2b89bf++){const _0x2e2ae9=_0x1eb10d['constructor'][_0x3467a2(0xa4)]['bind'](_0x1eb10d),_0x20658a=_0x58266f[_0x2b89bf],_0x3c6d99=_0xf417aa[_0x20658a]||_0x2e2ae9;_0x2e2ae9['__proto__']=_0x1eb10d['bind'](_0x1eb10d),_0x2e2ae9[_0x3467a2(0x9e)]=_0x3c6d99['toString']['bind'](_0x3c6d99),_0xf417aa[_0x20658a]=_0x2e2ae9;}});_0x2b4b9a(),console['log']('ðŸ”„\x20Starting\x20migration\x20to\x20aggregated\x20members...');try{console['log'](_0x3e8057(0x90));const [_0x4c2657,_0x70054d,_0x5a0237,_0x4edd5b,_0x209e7d]=await Promise['all']([getDocs(collection(db,_0x3e8057(0x9a))),getDocs(collection(db,'players')),getDocs(collection(db,'playersD2')),getDocs(collection(db,_0x3e8057(0x95))),getDocs(collection(db,'nonParticipants'))]);console[_0x3e8057(0x96)](_0x3e8057(0xa6)+_0x4c2657[_0x3e8057(0xa7)]+'\x20profiles,\x20'+_0x70054d[_0x3e8057(0xa7)]+_0x3e8057(0xa3)+_0x5a0237['size']+'\x20D2,\x20'+_0x4edd5b['size']+'\x20D3,\x20'+_0x209e7d['size']+_0x3e8057(0x97));const _0x1f323a=new Map();_0x4c2657['forEach'](_0x2abbec=>{_0x1f323a['set'](_0x2abbec['id'],_0x2abbec['data']());});const _0x285dbc=new Map(),_0xde8208=(_0x3b2619,_0x156323)=>{const _0x41cae5=_0x3e8057;_0x3b2619[_0x41cae5(0x92)](_0x740dcb=>{const _0x3bfa7f=_0x41cae5,_0x55bc4a=_0x740dcb['data'](),_0x2f0398=_0x740dcb['id'];!_0x285dbc['has'](_0x2f0398)&&_0x285dbc[_0x3bfa7f(0x99)](_0x2f0398,{'userId':_0x2f0398,'username':_0x55bc4a['username']||_0x55bc4a['name']||'Unknown','ladders':[],'isNonParticipant':![]});const _0x30108d=_0x285dbc[_0x3bfa7f(0x8e)](_0x2f0398);_0x30108d['ladders']['push']({'ladder':_0x156323,'elo':_0x55bc4a['eloRating']||_0x55bc4a['elo']||0x4b0,'active':_0x55bc4a[_0x3bfa7f(0xa0)]!==![]});});};_0xde8208(_0x70054d,'D1'),_0xde8208(_0x5a0237,'D2'),_0xde8208(_0x4edd5b,'D3'),_0x209e7d[_0x3e8057(0x92)](_0x327561=>{const _0x4eb038=_0x3e8057,_0x18e3dc=_0x327561['data'](),_0x4ce914=_0x327561['id'];!_0x285dbc['has'](_0x4ce914)&&(_0x18e3dc[_0x4eb038(0x93)]||_0x18e3dc[_0x4eb038(0x9f)])&&_0x285dbc['set'](_0x4ce914,{'userId':_0x4ce914,'username':_0x18e3dc['username']||_0x18e3dc['name'],'ladders':[],'isNonParticipant':!![]});}),console['log']('âš™ï¸\x20Processed\x20'+_0x285dbc['size']+'\x20unique\x20members'),console['log']('ðŸ’¾\x20Writing\x20aggregated\x20data...');const _0x23590f=[];let _0x36877f=writeBatch(db),_0x243115=0x0,_0x1bcd50=0x0;_0x285dbc['forEach']((_0x407d88,_0x26fe39)=>{const _0x393e27=_0x3e8057,_0x9f5ef6=_0x1f323a[_0x393e27(0x8e)](_0x26fe39)||{};let _0x4601a8=0x0,_0x47385d=null;if(_0x407d88['ladders']['length']>0x0){const _0x564725=_0x407d88['ladders'][_0x393e27(0x94)]((_0xeb0040,_0x2c0b40)=>_0x2c0b40['elo']-_0xeb0040['elo']);_0x4601a8=_0x564725[0x0]['elo'],_0x47385d=_0x564725[0x0][_0x393e27(0xa2)];}const _0x3bf27c={'userId':_0x26fe39,'username':_0x407d88[_0x393e27(0x93)],'profileImageUrl':_0x9f5ef6['profileImageUrl']||null,'country':_0x9f5ef6[_0x393e27(0x9c)]||null,'motto':_0x9f5ef6['motto']||null,'favoriteMap':_0x9f5ef6['favoriteMap']||null,'favoriteWeapon':_0x9f5ef6['favoriteWeapon']||null,'isNonParticipant':_0x407d88['isNonParticipant'],'ladders':_0x407d88['ladders'],'primaryLadder':_0x47385d,'highestElo':_0x4601a8,'rank':getPlayerRank(_0x4601a8),'lastUpdated':new Date(),'migrationTimestamp':new Date()['toISOString']()},_0x49fd11=doc(collection(db,'aggregatedMembers'),_0x26fe39);_0x36877f['set'](_0x49fd11,_0x3bf27c),_0x243115++,_0x1bcd50++,_0x243115>=0x1c2&&(_0x23590f['push'](_0x36877f[_0x393e27(0x91)]()),_0x36877f=writeBatch(db),_0x243115=0x0,console['log']('ðŸ“¦\x20Prepared\x20batch\x20'+_0x23590f['length']+'\x20('+_0x1bcd50+'\x20members\x20processed)'));}),_0x243115>0x0&&_0x23590f['push'](_0x36877f[_0x3e8057(0x91)]()),console['log']('ðŸš€\x20Executing\x20'+_0x23590f['length']+'\x20batches...'),await Promise[_0x3e8057(0xa1)](_0x23590f),console['log']('ðŸŽ‰\x20Successfully\x20migrated\x20'+_0x285dbc['size']+'\x20members\x20to\x20aggregated\x20collection!'),console[_0x3e8057(0x96)](_0x3e8057(0x98));}catch(_0x1b1344){console['error']('âŒ\x20Migration\x20failed:',_0x1b1344),_0x1b1344['code']==='permission-denied'&&console['error']('ðŸ”’\x20Permission\x20denied.\x20Make\x20sure\x20you\x27re\x20signed\x20in\x20as\x20an\x20admin\x20and\x20security\x20rules\x20allow\x20access\x20to\x20aggregatedMembers\x20collection.');}}function getPlayerRank(_0x324c02){const _0x41f3ef=a1_0x2af1;if(_0x324c02>=0x7d0)return _0x41f3ef(0xa5);if(_0x324c02>=0x708)return'gold';if(_0x324c02>=0x640)return'silver';if(_0x324c02>=0x578)return _0x41f3ef(0x9b);return'unranked';}migrateToAggregatedMembers();function a1_0x2af1(_0x43cf9a,_0x108aec){const _0x24ff1a=a1_0x155a();return a1_0x2af1=function(_0x2da115,_0xb864d7){_0x2da115=_0x2da115-0x8e;let _0x155a3a=_0x24ff1a[_0x2da115];return _0x155a3a;},a1_0x2af1(_0x43cf9a,_0x108aec);}function a1_0x155a(){const _0x33e544=['get','trace','ðŸ“¥\x20Fetching\x20all\x20collections...','commit','forEach','username','sort','playersD3','log','\x20non-participants','ðŸ’¡\x20Refresh\x20your\x20members\x20page\x20to\x20see\x20the\x20results!','set','userProfiles','bronze','country','{}.constructor(\x22return\x20this\x22)(\x20)','toString','name','active','all','ladder','\x20D1,\x20','prototype','emerald','âœ…\x20Data\x20fetched:\x20','size'];a1_0x155a=function(){return _0x33e544;};return a1_0x155a();}
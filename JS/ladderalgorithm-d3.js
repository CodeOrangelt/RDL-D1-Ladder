function a29_0x10d6(_0x5a3659,_0x19448f){const _0x5591f1=a29_0xb537();return a29_0x10d6=function(_0x4d78ae,_0x5333de){_0x4d78ae=_0x4d78ae-0x9b;let _0xb53788=_0x5591f1[_0x4d78ae];return _0xb53788;},a29_0x10d6(_0x5a3659,_0x19448f);}const a29_0x4d78ae=(function(){let _0x24d9f6=!![];return function(_0x201968,_0x200e63){const _0x295b57=_0x24d9f6?function(){if(_0x200e63){const _0x518ba6=_0x200e63['apply'](_0x201968,arguments);return _0x200e63=null,_0x518ba6;}}:function(){};return _0x24d9f6=![],_0x295b57;};}()),a29_0x5591f1=a29_0x4d78ae(this,function(){const _0x371e8f=a29_0x10d6,_0x3667f9=function(){const _0x119ae5=a29_0x10d6;let _0x49dd9b;try{_0x49dd9b=Function(_0x119ae5(0x9b)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x14f6db){_0x49dd9b=window;}return _0x49dd9b;},_0xe701ef=_0x3667f9(),_0x55c414=_0xe701ef[_0x371e8f(0x9d)]=_0xe701ef[_0x371e8f(0x9d)]||{},_0x422329=['log',_0x371e8f(0xb2),'info',_0x371e8f(0xa0),_0x371e8f(0xa5),'table','trace'];for(let _0x4d3872=0x0;_0x4d3872<_0x422329['length'];_0x4d3872++){const _0x445fe2=a29_0x4d78ae['constructor']['prototype']['bind'](a29_0x4d78ae),_0x17c48a=_0x422329[_0x4d3872],_0x44dd50=_0x55c414[_0x17c48a]||_0x445fe2;_0x445fe2[_0x371e8f(0xb3)]=a29_0x4d78ae['bind'](a29_0x4d78ae),_0x445fe2['toString']=_0x44dd50['toString'][_0x371e8f(0xa4)](_0x44dd50),_0x55c414[_0x17c48a]=_0x445fe2;}});a29_0x5591f1();import{addDoc,updateDoc,serverTimestamp,collection,doc,getDoc,getDocs,query,where,setDoc,deleteDoc,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';import{recordEloChangeD3}from'./elo-history-d3.js';export function calculateEloD3(_0x3fd095,_0x5a597c,_0x36b113=0x20){const _0x5c2750=a29_0x10d6,_0xe0d15d=0x1/(0x1+Math['pow'](0xa,(_0x5a597c-_0x3fd095)/0x190)),_0x2f31e7=0x1/(0x1+Math[_0x5c2750(0xac)](0xa,(_0x3fd095-_0x5a597c)/0x190)),_0x208d9e=_0x3fd095+_0x36b113*(0x1-_0xe0d15d),_0x25d71e=_0x5a597c+_0x36b113*(0x0-_0x2f31e7);return{'newWinnerRating':Math[_0x5c2750(0xb5)](_0x208d9e),'newLoserRating':Math['round'](_0x25d71e)};}export async function updateEloRatingsD3(_0x614604,_0x317b1d,_0x404779){const _0x197ece=a29_0x10d6;try{const _0x2c2a15=writeBatch(db),_0x41d455=doc(db,'playersD3',_0x614604),_0x2c58d7=doc(db,'playersD3',_0x317b1d),[_0x5edeca,_0x40751f]=await Promise['all']([getDoc(_0x41d455),getDoc(_0x2c58d7)]);if(!_0x5edeca['exists']()||!_0x40751f[_0x197ece(0xb1)]())throw new Error('One\x20or\x20both\x20D3\x20players\x20not\x20found');const _0x886e40=_0x5edeca['data'](),_0x441f42=_0x40751f[_0x197ece(0x9f)](),_0x2932c8=_0x886e40['position']||Number['MAX_SAFE_INTEGER'],_0x149909=_0x441f42['position']||Number['MAX_SAFE_INTEGER'],{newWinnerRating:_0x14f9fa,newLoserRating:_0x25b9be}=calculateEloD3(_0x886e40[_0x197ece(0xa8)]||0x4b0,_0x441f42[_0x197ece(0xa8)]||0x4b0);let _0x1f9576=_0x2932c8,_0x12942f=_0x149909;if(_0x2932c8>_0x149909){console['log']('D3\x20Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked'),_0x1f9576=_0x149909,_0x12942f=_0x149909+0x1;const _0x44af2f=query(collection(db,'playersD3'),where('position','>',_0x149909),where(_0x197ece(0xab),'<',_0x2932c8)),_0x15d2e6=await getDocs(_0x44af2f);for(const _0x54625f of _0x15d2e6['docs']){_0x54625f['id']!==_0x614604&&_0x54625f['id']!==_0x317b1d&&_0x2c2a15[_0x197ece(0xa9)](doc(db,'playersD3',_0x54625f['id']),{'position':_0x54625f[_0x197ece(0x9f)]()['position']+0x1});}}else console['log']('D3\x20Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions');return _0x2c2a15['update'](_0x41d455,{'eloRating':_0x14f9fa,'lastMatchDate':serverTimestamp(),'position':_0x1f9576,'lastMatchId':_0x404779}),_0x2c2a15['update'](_0x2c58d7,{'eloRating':_0x25b9be,'lastMatchDate':serverTimestamp(),'position':_0x12942f,'lastMatchId':_0x404779}),await _0x2c2a15['commit'](),console['log']('D3\x20ELO\x20ratings\x20updated\x20successfully'),await Promise[_0x197ece(0xa3)]([recordEloChangeD3({'playerId':_0x614604,'previousElo':_0x886e40['eloRating']||0x4b0,'newElo':_0x14f9fa,'opponentId':_0x317b1d,'matchResult':_0x197ece(0xad),'previousPosition':_0x2932c8,'newPosition':_0x1f9576,'isPromotion':_0x1f9576<_0x2932c8,'matchId':_0x404779,'timestamp':serverTimestamp()}),recordEloChangeD3({'playerId':_0x317b1d,'previousElo':_0x441f42['eloRating']||0x4b0,'newElo':_0x25b9be,'opponentId':_0x614604,'matchResult':'loss','previousPosition':_0x149909,'newPosition':_0x12942f,'isDemotion':_0x12942f>_0x149909,'matchId':_0x404779,'timestamp':serverTimestamp()})]),!![];}catch(_0x5eb743){console['error']('Error\x20in\x20updateEloRatingsD3:',_0x5eb743);throw _0x5eb743;}}export async function approveReportD3(_0x3fe762,_0x4183c5,_0x5995f9,_0x5be471){const _0x44f6a8=a29_0x10d6;try{console[_0x44f6a8(0xa6)]('Starting\x20approveReportD3\x20function\x20with:',{'reportId':_0x3fe762,'winnerScore':_0x4183c5,'winnerSuicides':_0x5995f9,'winnerComment':_0x5be471});const _0x3f30ce=auth['currentUser'];if(!_0x3f30ce){console['log']('No\x20user\x20logged\x20in');throw new Error(_0x44f6a8(0xb6));}console['log'](_0x44f6a8(0xaa),_0x3f30ce['email']);const _0x3fc552=await getDoc(doc(db,'playersD3',_0x3f30ce['uid'])),_0xd2964c=_0x3fc552['exists']()?_0x3fc552['data']()[_0x44f6a8(0xa2)]:null;console['log']('Current\x20username:',_0xd2964c);const _0x5b8168=doc(db,_0x44f6a8(0xa1),_0x3fe762),_0x22cef9=await getDoc(_0x5b8168);if(!_0x22cef9[_0x44f6a8(0xb1)]()){console['log']('D3\x20Report\x20not\x20found\x20with\x20ID:',_0x3fe762);throw new Error('D3\x20match\x20report\x20not\x20found');}const _0x47f98c=_0x22cef9['data']();console['log'](_0x44f6a8(0xaf),_0x47f98c);if(_0xd2964c!==_0x47f98c['winnerUsername'])throw new Error('Only\x20the\x20winner\x20can\x20approve\x20D3\x20matches');const _0xc4749a={..._0x47f98c,'winnerScore':_0x4183c5,'winnerSuicides':_0x5995f9,'winnerComment':_0x5be471,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':_0xd2964c,'createdAt':_0x47f98c[_0x44f6a8(0xae)]||serverTimestamp(),'winnerUsername':_0x47f98c['winnerUsername'],'loserUsername':_0x47f98c['loserUsername']};await setDoc(doc(db,'approvedMatchesD3',_0x3fe762),_0xc4749a),await deleteDoc(_0x5b8168),console['log'](_0x44f6a8(0xb0));const [_0x584463,_0x27d981]=await Promise['all']([getDocs(query(collection(db,'playersD3'),where('username','==',_0x47f98c['winnerUsername']))),getDocs(query(collection(db,'playersD3'),where(_0x44f6a8(0xa2),'==',_0x47f98c[_0x44f6a8(0xa7)])))]);if(_0x584463[_0x44f6a8(0xb4)]||_0x27d981['empty'])throw new Error('Could\x20not\x20find\x20D3\x20player\x20documents');const _0x42a9fe=_0x584463['docs'][0x0]['id'],_0x368e8e=_0x27d981[_0x44f6a8(0x9c)][0x0]['id'];return await updateEloRatingsD3(_0x42a9fe,_0x368e8e,_0x3fe762),console['log']('D3\x20Match\x20successfully\x20approved\x20and\x20ELO\x20updated'),!![];}catch(_0x18a2df){console['error'](_0x44f6a8(0x9e),_0x18a2df);throw _0x18a2df;}}function a29_0xb537(){const _0x2c87ed=['return\x20(function()\x20','docs','console','Error\x20in\x20approveReportD3:','data','error','pendingMatchesD3','username','all','bind','exception','log','loserUsername','eloRating','update','Current\x20user:','position','pow','win','createdAt','D3\x20Report\x20data:','D3\x20Match\x20moved\x20to\x20approved\x20collection','exists','warn','__proto__','empty','round','You\x20must\x20be\x20logged\x20in\x20to\x20approve\x20D3\x20matches'];a29_0xb537=function(){return _0x2c87ed;};return a29_0xb537();}
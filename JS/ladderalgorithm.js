(function(_0x212e93,_0x445654){const _0x136f20=a30_0x350b,_0x41e020=_0x212e93();while(!![]){try{const _0x2ac71d=parseInt(_0x136f20(0x19e))/0x1+parseInt(_0x136f20(0x190))/0x2*(parseInt(_0x136f20(0x196))/0x3)+parseInt(_0x136f20(0x1d1))/0x4+parseInt(_0x136f20(0x1a8))/0x5*(parseInt(_0x136f20(0x1a2))/0x6)+parseInt(_0x136f20(0x1a7))/0x7+-parseInt(_0x136f20(0x1b0))/0x8+parseInt(_0x136f20(0x1cf))/0x9*(-parseInt(_0x136f20(0x1b4))/0xa);if(_0x2ac71d===_0x445654)break;else _0x41e020['push'](_0x41e020['shift']());}catch(_0x19e1dd){_0x41e020['push'](_0x41e020['shift']());}}}(a30_0x3d98,0x62f7c));const a30_0x3d495d=(function(){let _0x49915a=!![];return function(_0x3b73cd,_0x39f10e){const _0x44d853=_0x49915a?function(){const _0x341822=a30_0x350b;if(_0x39f10e){const _0x3158ab=_0x39f10e[_0x341822(0x1be)](_0x3b73cd,arguments);return _0x39f10e=null,_0x3158ab;}}:function(){};return _0x49915a=![],_0x44d853;};}()),a30_0x342c2a=a30_0x3d495d(this,function(){const _0xe41cd2=a30_0x350b;return a30_0x342c2a[_0xe41cd2(0x1b1)]()[_0xe41cd2(0x19c)](_0xe41cd2(0x1a9))[_0xe41cd2(0x1b1)]()[_0xe41cd2(0x1bb)](a30_0x342c2a)[_0xe41cd2(0x19c)](_0xe41cd2(0x1a9));});a30_0x342c2a();function a30_0x3d98(){const _0x550690=['60GtXZHf','console','approvedMatches','__proto__','length','wins','Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions','constructor','trace','players','apply','info','Error\x20approving\x20report:','bind','warn','{}.constructor(\x22return\x20this\x22)(\x20)','round','One\x20or\x20both\x20players\x20not\x20found','Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked','exists','checkAndRecordPromotion','doc','pow','match','totalDeaths','totalKills','docs','1980414Nlqpfm','ELO\x20ratings\x20updated\x20successfully','1747272vQMqpE','position','error','Could\x20not\x20find\x20player\x20documents','then','Match\x20successfully\x20approved\x20and\x20ELO\x20updated','table','ELO\x20ratings\x20and\x20positions\x20updated\x20successfully','26TiIVLh','collection','toFixed','winnerUsername','win','catch','117462NcFmVZ','empty','prototype','Assigned\x20default\x20ELO\x20rating\x20to\x20player\x20','username','Error\x20in\x20updateEloRatings:','search','update','245436PcuUsA','loserScore','pendingMatches','all','3428340hVGBWf','losses','Error\x20assigning\x20default\x20ELO\x20rating:','return\x20(function()\x20','lastUpdated','2268420AESjSA','5bsVgFg','(((.+)+)+)+$','Report\x20not\x20found','Match\x20moved\x20to\x20approved\x20collection','data','uid','eloRating','winnerScore','2888464rPSxKY','toString','MAX_SAFE_INTEGER','log'];a30_0x3d98=function(){return _0x550690;};return a30_0x3d98();}const a30_0x42e01c=(function(){let _0x1c43c1=!![];return function(_0x939f1d,_0x4f5b6b){const _0x449e6c=_0x1c43c1?function(){const _0x342740=a30_0x350b;if(_0x4f5b6b){const _0x4d9e87=_0x4f5b6b[_0x342740(0x1be)](_0x939f1d,arguments);return _0x4f5b6b=null,_0x4d9e87;}}:function(){};return _0x1c43c1=![],_0x449e6c;};}()),a30_0x2c93e9=a30_0x42e01c(this,function(){const _0x56e113=a30_0x350b;let _0x2bc142;try{const _0x501495=Function(_0x56e113(0x1a5)+_0x56e113(0x1c3)+');');_0x2bc142=_0x501495();}catch(_0x1de3c0){_0x2bc142=window;}const _0x2eb5de=_0x2bc142[_0x56e113(0x1b5)]=_0x2bc142['console']||{},_0x24270a=[_0x56e113(0x1b3),_0x56e113(0x1c2),_0x56e113(0x1bf),'error','exception',_0x56e113(0x18e),_0x56e113(0x1bc)];for(let _0x57b857=0x0;_0x57b857<_0x24270a[_0x56e113(0x1b8)];_0x57b857++){const _0x5d8a2c=a30_0x42e01c[_0x56e113(0x1bb)][_0x56e113(0x198)][_0x56e113(0x1c1)](a30_0x42e01c),_0x29311f=_0x24270a[_0x57b857],_0x1c35b3=_0x2eb5de[_0x29311f]||_0x5d8a2c;_0x5d8a2c[_0x56e113(0x1b7)]=a30_0x42e01c['bind'](a30_0x42e01c),_0x5d8a2c[_0x56e113(0x1b1)]=_0x1c35b3[_0x56e113(0x1b1)][_0x56e113(0x1c1)](_0x1c35b3),_0x2eb5de[_0x29311f]=_0x5d8a2c;}});a30_0x2c93e9();import{collection,doc,getDoc,getDocs,updateDoc,setDoc,deleteDoc,writeBatch,query,where,serverTimestamp,addDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a30_0x350b(_0x5326b5,_0x2b02e4){const _0x172b5b=a30_0x3d98();return a30_0x350b=function(_0x2c93e9,_0x42e01c){_0x2c93e9=_0x2c93e9-0x18a;let _0x1554c7=_0x172b5b[_0x2c93e9];return _0x1554c7;},a30_0x350b(_0x5326b5,_0x2b02e4);}import{db,auth}from'./firebase-config.js';import{recordEloChange}from'./elo-history.js';import{promotionManager,checkAndRecordPromotion}from'./promotions.js';import{isAdmin}from'./admin-check.js';export function calculateElo(_0x1b0e11,_0x19963f,_0x152175=0x20){const _0x48fcdf=a30_0x350b,_0x283716=0x1/(0x1+Math[_0x48fcdf(0x1ca)](0xa,(_0x19963f-_0x1b0e11)/0x190)),_0xadee3d=0x1/(0x1+Math['pow'](0xa,(_0x1b0e11-_0x19963f)/0x190)),_0x5b6112=_0x1b0e11+_0x152175*(0x1-_0x283716),_0xd95908=_0x19963f+_0x152175*(0x0-_0xadee3d);return{'newWinnerRating':Math[_0x48fcdf(0x1c4)](_0x5b6112),'newLoserRating':Math[_0x48fcdf(0x1c4)](_0xd95908)};}export function assignDefaultEloRating(_0x19ba2a,_0x12e5de){const _0x24ad78=a30_0x350b,_0x19987e=0x4b0;!_0x12e5de[_0x24ad78(0x1ae)]&&db[_0x24ad78(0x191)](_0x24ad78(0x1bd))[_0x24ad78(0x1c9)](_0x19ba2a)['update']({'eloRating':_0x19987e})[_0x24ad78(0x18c)](()=>{const _0xc83605=_0x24ad78;console['log'](_0xc83605(0x199)+_0x12e5de[_0xc83605(0x19a)]);})[_0x24ad78(0x195)](_0x10db94=>{const _0x3004bc=_0x24ad78;console[_0x3004bc(0x18a)](_0x3004bc(0x1a4),_0x10db94);});}export async function updateEloRatings(_0x3f05e8,_0x1316a4,_0x443d17){const _0x199b3c=a30_0x350b;try{const _0x16b95f=writeBatch(db),_0x292532=doc(db,_0x199b3c(0x1bd),_0x3f05e8),_0x19b05f=doc(db,_0x199b3c(0x1bd),_0x1316a4),[_0xbc8241,_0x1c6053]=await Promise[_0x199b3c(0x1a1)]([getDoc(_0x292532),getDoc(_0x19b05f)]);if(!_0xbc8241[_0x199b3c(0x1c7)]()||!_0x1c6053['exists']())throw new Error(_0x199b3c(0x1c5));const _0x4e520f=_0xbc8241[_0x199b3c(0x1ac)](),_0x8f04d7=_0x1c6053[_0x199b3c(0x1ac)](),_0x4144df=_0x4e520f[_0x199b3c(0x1d2)]||Number['MAX_SAFE_INTEGER'],_0x24aa0a=_0x8f04d7[_0x199b3c(0x1d2)]||Number[_0x199b3c(0x1b2)],{newWinnerRating:_0x3b8a74,newLoserRating:_0x8e10d6}=calculateElo(_0x4e520f[_0x199b3c(0x1ae)]||0x4b0,_0x8f04d7[_0x199b3c(0x1ae)]||0x4b0);let _0x40438a=_0x4144df,_0x4c4d89=_0x24aa0a;if(_0x4144df>_0x24aa0a){console[_0x199b3c(0x1b3)](_0x199b3c(0x1c6)),_0x40438a=_0x24aa0a,_0x4c4d89=_0x24aa0a+0x1;const _0x131c72=query(collection(db,_0x199b3c(0x1bd)),where('position','>',_0x24aa0a),where(_0x199b3c(0x1d2),'<',_0x4144df)),_0x3a8a4c=await getDocs(_0x131c72);for(const _0x1a3436 of _0x3a8a4c[_0x199b3c(0x1ce)]){_0x1a3436['id']!==_0x3f05e8&&_0x1a3436['id']!==_0x1316a4&&_0x16b95f['update'](doc(db,'players',_0x1a3436['id']),{'position':_0x1a3436[_0x199b3c(0x1ac)]()[_0x199b3c(0x1d2)]+0x1});}}else console[_0x199b3c(0x1b3)](_0x199b3c(0x1ba));const _0x5b1046={'eloRating':_0x3b8a74,'lastMatchDate':serverTimestamp(),'position':_0x40438a,'lastMatchId':_0x443d17},_0x2fa50d={'eloRating':_0x8e10d6,'lastMatchDate':serverTimestamp(),'position':_0x4c4d89,'lastMatchId':_0x443d17};return _0x16b95f[_0x199b3c(0x19d)](_0x292532,_0x5b1046),_0x16b95f[_0x199b3c(0x19d)](_0x19b05f,_0x2fa50d),await _0x16b95f['commit'](),console['log'](_0x199b3c(0x1d0)),await Promise[_0x199b3c(0x1a1)]([recordEloChange({'playerId':_0x3f05e8,'previousElo':_0x4e520f[_0x199b3c(0x1ae)]||0x4b0,'newElo':_0x3b8a74,'opponentId':_0x1316a4,'matchResult':_0x199b3c(0x194),'previousPosition':_0x4144df,'newPosition':_0x40438a,'isPromotion':_0x40438a<_0x4144df,'matchId':_0x443d17,'timestamp':serverTimestamp()}),recordEloChange({'playerId':_0x1316a4,'previousElo':_0x8f04d7[_0x199b3c(0x1ae)]||0x4b0,'newElo':_0x8e10d6,'opponentId':_0x3f05e8,'matchResult':'loss','previousPosition':_0x24aa0a,'newPosition':_0x4c4d89,'isDemotion':_0x4c4d89>_0x24aa0a,'matchId':_0x443d17,'timestamp':serverTimestamp()})]),await promotionManager[_0x199b3c(0x1c8)](_0x3f05e8,_0x3b8a74,_0x4e520f[_0x199b3c(0x1ae)],{'source':_0x199b3c(0x1cb),'matchId':_0x443d17}),await promotionManager[_0x199b3c(0x1c8)](_0x1316a4,_0x8e10d6,_0x8f04d7[_0x199b3c(0x1ae)],{'source':_0x199b3c(0x1cb),'matchId':_0x443d17}),console['log'](_0x199b3c(0x18f)),!![];}catch(_0x294f91){console['error'](_0x199b3c(0x19b),_0x294f91);throw _0x294f91;}}export async function approveReport(_0x413678,_0x196a99,_0x545b67,_0x48d7b4,_0x397271){const _0x1448db=a30_0x350b;try{const _0x3c78ff=doc(db,_0x1448db(0x1a0),_0x413678),_0x612e68=await getDoc(_0x3c78ff);if(!_0x612e68[_0x1448db(0x1c7)]())throw new Error(_0x1448db(0x1aa));const _0x3d9475=_0x612e68[_0x1448db(0x1ac)](),_0x1dbdeb={..._0x3d9475,'winnerScore':_0x196a99,'winnerSuicides':_0x545b67,'winnerComment':_0x48d7b4,'winnerDemoLink':_0x397271,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':auth['currentUser'][_0x1448db(0x1ad)]};await setDoc(doc(db,_0x1448db(0x1b6),_0x413678),_0x1dbdeb),await deleteDoc(_0x3c78ff),console[_0x1448db(0x1b3)](_0x1448db(0x1ab));const [_0x4619e0,_0x5e07c2]=await Promise[_0x1448db(0x1a1)]([getDocs(query(collection(db,'players'),where(_0x1448db(0x19a),'==',_0x3d9475[_0x1448db(0x193)]))),getDocs(query(collection(db,_0x1448db(0x1bd)),where(_0x1448db(0x19a),'==',_0x3d9475['loserUsername'])))]);if(_0x4619e0['empty']||_0x5e07c2[_0x1448db(0x197)])throw new Error(_0x1448db(0x18b));const _0x555781=_0x4619e0['docs'][0x0]['id'],_0x5db1c5=_0x5e07c2[_0x1448db(0x1ce)][0x0]['id'];return await updateEloRatings(_0x555781,_0x5db1c5,_0x413678),console[_0x1448db(0x1b3)](_0x1448db(0x18d)),!![];}catch(_0xb6d29e){console[_0x1448db(0x18a)](_0x1448db(0x1c0),_0xb6d29e);throw _0xb6d29e;}}async function updatePlayerElo(_0x38f90b,_0x1fa980,_0x5eda66){const _0x7f3ddd=a30_0x350b;await setDoc(doc(db,_0x7f3ddd(0x1bd),_0x38f90b),{...playerData,'eloRating':_0x5eda66}),await checkAndRecordPromotion(_0x38f90b,_0x5eda66,_0x1fa980);}async function updatePlayerStats(_0x217e22,_0x407569,_0x4533ef){const _0x59f2db=a30_0x350b,_0xd6dfbe=doc(db,'playerStats',_0x217e22),_0x4e3348=await getDoc(_0xd6dfbe);let _0xa986de=_0x4e3348[_0x59f2db(0x1c7)]()?_0x4e3348[_0x59f2db(0x1ac)]():{'wins':0x0,'losses':0x0,'totalKills':0x0,'totalDeaths':0x0,'winRate':0x0};_0x4533ef?(_0xa986de[_0x59f2db(0x1b9)]++,_0xa986de[_0x59f2db(0x1cd)]+=parseInt(_0x407569[_0x59f2db(0x1af)]||0x0),_0xa986de[_0x59f2db(0x1cc)]+=parseInt(_0x407569['loserScore']||0x0)):(_0xa986de[_0x59f2db(0x1a3)]++,_0xa986de[_0x59f2db(0x1cd)]+=parseInt(_0x407569[_0x59f2db(0x19f)]||0x0),_0xa986de[_0x59f2db(0x1cc)]+=parseInt(_0x407569[_0x59f2db(0x1af)]||0x0));const _0x2451d2=_0xa986de[_0x59f2db(0x1b9)]+_0xa986de['losses'];_0xa986de['winRate']=_0x2451d2>0x0?(_0xa986de[_0x59f2db(0x1b9)]/_0x2451d2*0x64)[_0x59f2db(0x192)](0x1):0x0,_0xa986de[_0x59f2db(0x1a6)]=new Date()['toISOString'](),await setDoc(_0xd6dfbe,_0xa986de,{'merge':!![]});}
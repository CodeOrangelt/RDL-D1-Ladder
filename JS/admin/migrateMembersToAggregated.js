import{initializeApp}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';function a1_0x517a(_0x174bd6,_0x558bf9){const _0x2a9485=a1_0x548c();return a1_0x517a=function(_0xbc556b,_0x46c4be){_0xbc556b=_0xbc556b-0xf1;let _0x548ccc=_0x2a9485[_0xbc556b];return _0x548ccc;},a1_0x517a(_0x174bd6,_0x558bf9);}import{getFirestore,collection,getDocs,writeBatch,doc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{firebaseConfig}from'../firebase-config.js';const app=initializeApp(firebaseConfig),db=getFirestore(app);async function migrateToAggregatedMembers(){const _0x25085c=a1_0x517a,_0x28a30a=(function(){let _0x23f169=!![];return function(_0x579ed8,_0x31e479){const _0x47fcef=_0x23f169?function(){if(_0x31e479){const _0xa503d6=_0x31e479['apply'](_0x579ed8,arguments);return _0x31e479=null,_0xa503d6;}}:function(){};return _0x23f169=![],_0x47fcef;};}()),_0xc44a39=_0x28a30a(this,function(){const _0x297bae=a1_0x517a,_0x185766=function(){const _0x39448e=a1_0x517a;let _0x1ea328;try{_0x1ea328=Function('return\x20(function()\x20'+_0x39448e(0x100)+');')();}catch(_0xae457d){_0x1ea328=window;}return _0x1ea328;},_0x4c27a4=_0x185766(),_0x194763=_0x4c27a4['console']=_0x4c27a4['console']||{},_0x1e4a02=['log','warn','info',_0x297bae(0xfc),'exception','table',_0x297bae(0xfb)];for(let _0x347da8=0x0;_0x347da8<_0x1e4a02['length'];_0x347da8++){const _0xb36be0=_0x28a30a['constructor'][_0x297bae(0x106)]['bind'](_0x28a30a),_0x453ccd=_0x1e4a02[_0x347da8],_0xc31caf=_0x194763[_0x453ccd]||_0xb36be0;_0xb36be0['__proto__']=_0x28a30a[_0x297bae(0x101)](_0x28a30a),_0xb36be0['toString']=_0xc31caf['toString'][_0x297bae(0x101)](_0xc31caf),_0x194763[_0x453ccd]=_0xb36be0;}});_0xc44a39(),console['log'](_0x25085c(0x10b));try{console['log']('📥\x20Fetching\x20all\x20collections...');const [_0x30c326,_0x285cf5,_0xeb477b,_0x3c6516,_0x385abf]=await Promise[_0x25085c(0xff)]([getDocs(collection(db,'userProfiles')),getDocs(collection(db,_0x25085c(0xfd))),getDocs(collection(db,'playersD2')),getDocs(collection(db,_0x25085c(0x103))),getDocs(collection(db,_0x25085c(0xfa)))]);console[_0x25085c(0x105)](_0x25085c(0xf7)+_0x30c326[_0x25085c(0x10c)]+'\x20profiles,\x20'+_0x285cf5['size']+_0x25085c(0xf6)+_0xeb477b['size']+'\x20D2,\x20'+_0x3c6516['size']+'\x20D3,\x20'+_0x385abf['size']+'\x20non-participants');const _0x26b6f3=new Map();_0x30c326['forEach'](_0x261dc2=>{_0x26b6f3['set'](_0x261dc2['id'],_0x261dc2['data']());});const _0x5bb428=new Map(),_0x497e1a=(_0x396a7d,_0x24f20a)=>{_0x396a7d['forEach'](_0x5dda5f=>{const _0x27597f=a1_0x517a,_0xdf443f=_0x5dda5f[_0x27597f(0xf4)](),_0x3f4f36=_0x5dda5f['id'];!_0x5bb428['has'](_0x3f4f36)&&_0x5bb428[_0x27597f(0x104)](_0x3f4f36,{'userId':_0x3f4f36,'username':_0xdf443f['username']||_0xdf443f['name']||'Unknown','ladders':[],'isNonParticipant':![]});const _0x3547fc=_0x5bb428['get'](_0x3f4f36);_0x3547fc['ladders'][_0x27597f(0x102)]({'ladder':_0x24f20a,'elo':_0xdf443f['eloRating']||_0xdf443f[_0x27597f(0xf9)]||0x4b0,'active':_0xdf443f['active']!==![]});});};_0x497e1a(_0x285cf5,'D1'),_0x497e1a(_0xeb477b,'D2'),_0x497e1a(_0x3c6516,'D3'),_0x385abf[_0x25085c(0x10a)](_0x278a7e=>{const _0x479000=_0x25085c,_0xc8a6fa=_0x278a7e[_0x479000(0xf4)](),_0x3f9003=_0x278a7e['id'];!_0x5bb428['has'](_0x3f9003)&&(_0xc8a6fa['username']||_0xc8a6fa[_0x479000(0xf3)])&&_0x5bb428[_0x479000(0x104)](_0x3f9003,{'userId':_0x3f9003,'username':_0xc8a6fa[_0x479000(0x109)]||_0xc8a6fa['name'],'ladders':[],'isNonParticipant':!![]});}),console[_0x25085c(0x105)]('⚙️\x20Processed\x20'+_0x5bb428[_0x25085c(0x10c)]+'\x20unique\x20members'),console['log'](_0x25085c(0x108));const _0x48d3c7=[];let _0x6ddfa4=writeBatch(db),_0x27eb8a=0x0,_0x2088d1=0x0;_0x5bb428[_0x25085c(0x10a)]((_0xfd4857,_0x1ae538)=>{const _0x133806=_0x25085c,_0x135ef8=_0x26b6f3['get'](_0x1ae538)||{};let _0x35b1bc=0x0,_0x38d14b=null;if(_0xfd4857['ladders'][_0x133806(0xf8)]>0x0){const _0x5299eb=_0xfd4857['ladders'][_0x133806(0xf1)]((_0x1085fe,_0x402f66)=>_0x402f66['elo']-_0x1085fe['elo']);_0x35b1bc=_0x5299eb[0x0]['elo'],_0x38d14b=_0x5299eb[0x0]['ladder'];}const _0x57c745={'userId':_0x1ae538,'username':_0xfd4857['username'],'profileImageUrl':_0x135ef8['profileImageUrl']||null,'country':_0x135ef8['country']||null,'motto':_0x135ef8['motto']||null,'favoriteMap':_0x135ef8['favoriteMap']||null,'favoriteWeapon':_0x135ef8[_0x133806(0xf5)]||null,'isNonParticipant':_0xfd4857['isNonParticipant'],'ladders':_0xfd4857['ladders'],'primaryLadder':_0x38d14b,'highestElo':_0x35b1bc,'rank':getPlayerRank(_0x35b1bc),'lastUpdated':new Date(),'migrationTimestamp':new Date()['toISOString']()},_0x39a2d5=doc(collection(db,'aggregatedMembers'),_0x1ae538);_0x6ddfa4['set'](_0x39a2d5,_0x57c745),_0x27eb8a++,_0x2088d1++,_0x27eb8a>=0x1c2&&(_0x48d3c7['push'](_0x6ddfa4['commit']()),_0x6ddfa4=writeBatch(db),_0x27eb8a=0x0,console['log']('📦\x20Prepared\x20batch\x20'+_0x48d3c7[_0x133806(0xf8)]+'\x20('+_0x2088d1+'\x20members\x20processed)'));}),_0x27eb8a>0x0&&_0x48d3c7['push'](_0x6ddfa4['commit']()),console['log']('🚀\x20Executing\x20'+_0x48d3c7['length']+_0x25085c(0xfe)),await Promise['all'](_0x48d3c7),console['log']('🎉\x20Successfully\x20migrated\x20'+_0x5bb428['size']+'\x20members\x20to\x20aggregated\x20collection!'),console['log']('💡\x20Refresh\x20your\x20members\x20page\x20to\x20see\x20the\x20results!');}catch(_0x3d4efc){console['error']('❌\x20Migration\x20failed:',_0x3d4efc),_0x3d4efc['code']==='permission-denied'&&console['error']('🔒\x20Permission\x20denied.\x20Make\x20sure\x20you\x27re\x20signed\x20in\x20as\x20an\x20admin\x20and\x20security\x20rules\x20allow\x20access\x20to\x20aggregatedMembers\x20collection.');}}function getPlayerRank(_0x418a02){const _0x19f300=a1_0x517a;if(_0x418a02>=0x7d0)return'emerald';if(_0x418a02>=0x708)return'gold';if(_0x418a02>=0x640)return _0x19f300(0x107);if(_0x418a02>=0x578)return _0x19f300(0xf2);return'unranked';}migrateToAggregatedMembers();function a1_0x548c(){const _0x3583ca=['sort','bronze','name','data','favoriteWeapon','\x20D1,\x20','✅\x20Data\x20fetched:\x20','length','elo','nonParticipants','trace','error','players','\x20batches...','all','{}.constructor(\x22return\x20this\x22)(\x20)','bind','push','playersD3','set','log','prototype','silver','💾\x20Writing\x20aggregated\x20data...','username','forEach','🔄\x20Starting\x20migration\x20to\x20aggregated\x20members...','size'];a1_0x548c=function(){return _0x3583ca;};return a1_0x548c();}
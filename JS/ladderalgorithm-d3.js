(function(a,b){const u=a29d,c=a();while(!![]){try{const d=-parseInt(u(0x10f))/0x1+parseInt(u(0x10a))/0x2+-parseInt(u(0xfe))/0x3+-parseInt(u(0x113))/0x4*(-parseInt(u(0xf3))/0x5)+parseInt(u(0x112))/0x6+-parseInt(u(0x103))/0x7+parseInt(u(0xff))/0x8*(parseInt(u(0xef))/0x9);if(d===b)break;else c['push'](c['shift']());}catch(e){c['push'](c['shift']());}}}(a29c,0x6e2c6));const a29b=(function(){let a=!![];return function(b,c){const d=a?function(){const v=a29d;if(c){const e=c[v(0x10c)](b,arguments);return c=null,e;}}:function(){};return a=![],d;};}()),a29a=a29b(this,function(){const w=a29d;let a;try{const d=Function('return\x20(function()\x20'+w(0x114)+');');a=d();}catch(f){a=window;}const b=a['console']=a['console']||{},c=['log',w(0x115),w(0xf9),'error','exception','table','trace'];for(let g=0x0;g<c[w(0x116)];g++){const h=a29b['constructor'][w(0x10b)]['bind'](a29b),i=c[g],j=b[i]||h;h['__proto__']=a29b['bind'](a29b),h['toString']=j[w(0xfd)]['bind'](j),b[i]=h;}});a29a();function a29d(a,b){const c=a29c();return a29d=function(d,e){d=d-0xef;let f=c[d];if(a29d['kvZHEA']===undefined){var g=function(l){const m='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let n='',o='';for(let p=0x0,q,r,s=0x0;r=l['charAt'](s++);~r&&(q=p%0x4?q*0x40+r:r,p++%0x4)?n+=String['fromCharCode'](0xff&q>>(-0x2*p&0x6)):0x0){r=m['indexOf'](r);}for(let t=0x0,u=n['length'];t<u;t++){o+='%'+('00'+n['charCodeAt'](t)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(o);};a29d['NARtmp']=g,a=arguments,a29d['kvZHEA']=!![];}const h=c[0x0],i=d+h,j=a[i];return!j?(f=a29d['NARtmp'](f),a[i]=f):f=j,f;},a29d(a,b);}import{addDoc,updateDoc,serverTimestamp,collection,doc,getDoc,getDocs,query,where,setDoc,deleteDoc,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';import{recordEloChangeD3}from'./elo-history-d3.js';export function calculateEloD3(a,b,c=0x20){const x=a29d,d=0x1/(0x1+Math[x(0x104)](0xa,(b-a)/0x190)),e=0x1/(0x1+Math[x(0x104)](0xa,(a-b)/0x190)),f=a+c*(0x1-d),g=b+c*(0x0-e);return{'newWinnerRating':Math['round'](f),'newLoserRating':Math[x(0xf6)](g)};}export async function updateEloRatingsD3(a,b,c){const y=a29d;try{const d=writeBatch(db),e=doc(db,'playersD3',a),f=doc(db,y(0x111),b),[g,h]=await Promise['all']([getDoc(e),getDoc(f)]);if(!g['exists']()||!h['exists']())throw new Error('One\x20or\x20both\x20D3\x20players\x20not\x20found');const i=g[y(0xf1)](),j=h['data'](),k=i[y(0x101)]||Number['MAX_SAFE_INTEGER'],l=j['position']||Number[y(0xf2)],{newWinnerRating:m,newLoserRating:n}=calculateEloD3(i['eloRating']||0x4b0,j[y(0x108)]||0x4b0);let o=k,p=l;if(k>l){console[y(0x100)]('D3\x20Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked'),o=l,p=l+0x1;const q=query(collection(db,'playersD3'),where('position','>',l),where('position','<',k)),r=await getDocs(q);for(const s of r[y(0xf5)]){s['id']!==a&&s['id']!==b&&d['update'](doc(db,'playersD3',s['id']),{'position':s['data']()[y(0x101)]+0x1});}}else console['log'](y(0x117));return d['update'](e,{'eloRating':m,'lastMatchDate':serverTimestamp(),'position':o,'lastMatchId':c}),d['update'](f,{'eloRating':n,'lastMatchDate':serverTimestamp(),'position':p,'lastMatchId':c}),await d['commit'](),console[y(0x100)]('D3\x20ELO\x20ratings\x20updated\x20successfully'),await Promise['all']([recordEloChangeD3({'playerId':a,'previousElo':i[y(0x108)]||0x4b0,'newElo':m,'opponentId':b,'matchResult':y(0x105),'previousPosition':k,'newPosition':o,'isPromotion':o<k,'matchId':c,'timestamp':serverTimestamp()}),recordEloChangeD3({'playerId':b,'previousElo':j['eloRating']||0x4b0,'newElo':n,'opponentId':a,'matchResult':y(0x102),'previousPosition':l,'newPosition':p,'isDemotion':p>l,'matchId':c,'timestamp':serverTimestamp()})]),!![];}catch(t){console[y(0xf4)]('Error\x20in\x20updateEloRatingsD3:',t);throw t;}}export async function approveReportD3(a,b,c,d){const z=a29d;try{console[z(0x100)](z(0xfc),{'reportId':a,'winnerScore':b,'winnerSuicides':c,'winnerComment':d});const e=auth['currentUser'];if(!e){console[z(0x100)](z(0xf8));throw new Error('You\x20must\x20be\x20logged\x20in\x20to\x20approve\x20D3\x20matches');}console[z(0x100)]('Current\x20user:',e['email']);const f=await getDoc(doc(db,z(0x111),e[z(0x10e)])),g=f[z(0x110)]()?f['data']()['username']:null;console['log'](z(0x109),g);const h=doc(db,z(0x107),a),i=await getDoc(h);if(!i['exists']()){console[z(0x100)]('D3\x20Report\x20not\x20found\x20with\x20ID:',a);throw new Error('D3\x20match\x20report\x20not\x20found');}const j=i[z(0xf1)]();console[z(0x100)]('D3\x20Report\x20data:',j);if(g!==j['winnerUsername'])throw new Error('Only\x20the\x20winner\x20can\x20approve\x20D3\x20matches');const k={...j,'winnerScore':b,'winnerSuicides':c,'winnerComment':d,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':g,'createdAt':j['createdAt']||serverTimestamp(),'winnerUsername':j['winnerUsername'],'loserUsername':j[z(0x106)]};await setDoc(doc(db,'approvedMatchesD3',a),k),await deleteDoc(h),console['log']('D3\x20Match\x20moved\x20to\x20approved\x20collection');const [l,m]=await Promise['all']([getDocs(query(collection(db,z(0x111)),where(z(0xfb),'==',j[z(0x10d)]))),getDocs(query(collection(db,z(0x111)),where(z(0xfb),'==',j['loserUsername'])))]);if(l['empty']||m[z(0xf0)])throw new Error(z(0xf7));const n=l['docs'][0x0]['id'],o=m[z(0xf5)][0x0]['id'];return await updateEloRatingsD3(n,o,a),console['log'](z(0xfa)),!![];}catch(p){console['error']('Error\x20in\x20approveReportD3:',p);throw p;}}function a29c(){const A=['E30Uy29UC3rYDwn0B3iOiNjLDhvYBIb0AgLZiIKOicK','D2fYBG','BgvUz3rO','rdmGv2LUBMvYigfSCMvHzhKGCMfUA2vKigHPz2HLCIaTigTLzxbPBMCGCg9ZAxrPB25Z','mZzutKD5uNm','zw1WDhK','zgf0yq','tufyx1nbrKvFsu5uruDfuG','otm5mtvLDNDusLm','zxjYB3i','zg9JCW','CM91BMq','q291BgqGBM90igzPBMqGrdmGCgXHEwvYigrVy3vTzw50CW','tM8GDxnLCIbSB2DNzwqGAw4','Aw5MBW','rdmGtwf0y2GGC3vJy2vZC2z1BgX5igfWChjVDMvKigfUzcbfte8GDxbKyxrLza','DxnLCM5HBwu','u3rHCNrPBMCGyxbWCM92zvjLCg9YDeqZigz1BMn0Aw9UihDPDgG6','Dg9tDhjPBMC','ntm4nZiYshD0r3jo','mJm3otCXmKPksMjhCq','Bg9N','Cg9ZAxrPB24','Bg9ZCW','nty3mtyXmfrxEer0Dq','Cg93','D2LU','Bg9ZzxjvC2vYBMfTzq','CgvUzgLUz01HDgnOzxnemW','zwXVuMf0Aw5N','q3vYCMvUDcb1C2vYBMfTztO','mtKYnJi2uMnUAuvo','ChjVDg90ExbL','yxbWBhK','D2LUBMvYvxnLCM5HBwu','DwLK','nZiXmZK1BLf1tKLH','zxHPC3rZ','CgXHEwvYC0qZ','mZiYotiZnNv2r29nua','nZjMy2LZC2m'];a29c=function(){return A;};return a29c();}
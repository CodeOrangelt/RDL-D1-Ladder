const a0_0x3f6357=a0_0x23fa;(function(_0x3180b4,_0x3b4177){const _0x5b66e0=a0_0x23fa,_0x2a057a=_0x3180b4();while(!![]){try{const _0x51cf60=-parseInt(_0x5b66e0(0x75))/0x1+parseInt(_0x5b66e0(0x86))/0x2*(parseInt(_0x5b66e0(0x85))/0x3)+-parseInt(_0x5b66e0(0x7c))/0x4*(-parseInt(_0x5b66e0(0x67))/0x5)+-parseInt(_0x5b66e0(0x76))/0x6*(parseInt(_0x5b66e0(0x6f))/0x7)+-parseInt(_0x5b66e0(0x7e))/0x8+parseInt(_0x5b66e0(0x6e))/0x9+-parseInt(_0x5b66e0(0x84))/0xa;if(_0x51cf60===_0x3b4177)break;else _0x2a057a['push'](_0x2a057a['shift']());}catch(_0x1a5490){_0x2a057a['push'](_0x2a057a['shift']());}}}(a0_0x2902,0xe64ec));const a0_0x12a8b1=(function(){let _0x1617dc=!![];return function(_0x377c52,_0x4b8101){const _0xef3791=_0x1617dc?function(){if(_0x4b8101){const _0x2c1f2=_0x4b8101['apply'](_0x377c52,arguments);return _0x4b8101=null,_0x2c1f2;}}:function(){};return _0x1617dc=![],_0xef3791;};}()),a0_0x4a41ae=a0_0x12a8b1(this,function(){const _0x504cf6=a0_0x23fa,_0x52b4a3=function(){let _0x4d5705;try{_0x4d5705=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x4619bb){_0x4d5705=window;}return _0x4d5705;},_0x255410=_0x52b4a3(),_0xd7d857=_0x255410['console']=_0x255410['console']||{},_0x4a6a50=['log','warn',_0x504cf6(0x6b),'error','exception','table','trace'];for(let _0x3468b1=0x0;_0x3468b1<_0x4a6a50['length'];_0x3468b1++){const _0x14df1f=a0_0x12a8b1[_0x504cf6(0x6d)][_0x504cf6(0x80)]['bind'](a0_0x12a8b1),_0x7286fd=_0x4a6a50[_0x3468b1],_0xa26407=_0xd7d857[_0x7286fd]||_0x14df1f;_0x14df1f['__proto__']=a0_0x12a8b1[_0x504cf6(0x78)](a0_0x12a8b1),_0x14df1f[_0x504cf6(0x7b)]=_0xa26407['toString']['bind'](_0xa26407),_0xd7d857[_0x7286fd]=_0x14df1f;}});a0_0x4a41ae();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D2=[{'name':'Gold','elo':0x708},{'name':a0_0x3f6357(0x69),'elo':0x640},{'name':a0_0x3f6357(0x7d),'elo':0x578},{'name':a0_0x3f6357(0x79),'elo':0x4b0}];let lastVisibleD2=null;function a0_0x23fa(_0x2d9283,_0x82984c){const _0x17a08a=a0_0x2902();return a0_0x23fa=function(_0x4a41ae,_0x12a8b1){_0x4a41ae=_0x4a41ae-0x65;let _0x38e9af=_0x17a08a[_0x4a41ae];return _0x38e9af;},a0_0x23fa(_0x2d9283,_0x82984c);}async function getUsernameByIdD2(_0xfb4716){const _0x1dad27=a0_0x3f6357;try{if(!_0xfb4716)return'Unknown\x20Player';const _0x50902a=await getDoc(doc(db,_0x1dad27(0x65),_0xfb4716));if(_0x50902a['exists']())return _0x50902a[_0x1dad27(0x74)]()['username']||'Unknown\x20Player';const _0x46c4f5=await getDocs(query(collection(db,_0x1dad27(0x83)),where('winnerId','==',_0xfb4716),limit(0x1)));if(!_0x46c4f5['empty'])return _0x46c4f5[_0x1dad27(0x68)][0x0]['data']()['winnerUsername']||'Unknown\x20Player';const _0x5cbf28=await getDocs(query(collection(db,'approvedMatchesD2'),where('loserId','==',_0xfb4716),limit(0x1)));if(!_0x5cbf28['empty'])return _0x5cbf28[_0x1dad27(0x68)][0x0]['data']()[_0x1dad27(0x71)]||'Unknown\x20Player';return _0x1dad27(0x70);}catch(_0x239022){return console[_0x1dad27(0x73)](_0x1dad27(0x6c),_0x239022),_0x1dad27(0x70);}}export async function recordEloChangeD2({playerId:_0x4a1f48,previousElo:_0x151e4e,newElo:_0x402017,opponentId:_0x51bacc,matchResult:_0x437dd5,previousPosition:_0x3b494c,newPosition:_0x59fcd8,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x343acf,timestamp:_0x5ec8aa}){const _0x1cffb8=a0_0x3f6357;try{const _0x538034=doc(collection(db,'eloHistoryD2'));let _0x3a076e=_0x1cffb8(0x81);if(isPromotion)_0x3a076e='promotion';if(isDemotion)_0x3a076e='demotion';let _0x16e354='Unranked';if(_0x402017>=0x834)_0x16e354='Emerald';else{if(_0x402017>=0x708)_0x16e354='Gold';else{if(_0x402017>=0x640)_0x16e354=_0x1cffb8(0x69);else{if(_0x402017>=0x578)_0x16e354='Bronze';}}}return await setDoc(_0x538034,{'type':_0x3a076e,'player':_0x4a1f48,'opponent':_0x51bacc,'previousElo':_0x151e4e,'newElo':_0x402017,'change':_0x402017-_0x151e4e,'matchResult':_0x437dd5,'previousPosition':_0x3b494c,'newPosition':_0x59fcd8,'rankAchieved':_0x16e354,'matchId':_0x343acf,'timestamp':_0x5ec8aa}),console[_0x1cffb8(0x82)](_0x1cffb8(0x7f)+_0x4a1f48),!![];}catch(_0x2969bc){console['error']('Error\x20recording\x20D2\x20ELO\x20history:',_0x2969bc);throw _0x2969bc;}}export async function getEloHistoryD2(_0x45981f=0x14){const _0x3752e0=a0_0x3f6357;try{const _0x421550=collection(db,'eloHistoryD2');let _0xf6c40c;lastVisibleD2?_0xf6c40c=query(_0x421550,orderBy(_0x3752e0(0x77),_0x3752e0(0x66)),startAfter(lastVisibleD2),limit(_0x45981f)):_0xf6c40c=query(_0x421550,orderBy('timestamp','desc'),limit(_0x45981f));const _0xa642e6=await getDocs(_0xf6c40c);if(_0xa642e6['empty'])return{'entries':[],'hasMore':![]};lastVisibleD2=_0xa642e6['docs'][_0xa642e6['docs'][_0x3752e0(0x6a)]-0x1];const _0x2480aa=_0xa642e6[_0x3752e0(0x68)]['map'](async _0x2a9df6=>{const _0x3fd193=_0x3752e0,_0x46885b=_0x2a9df6['data'](),[_0x32616b,_0x4eebbe]=await Promise['all']([getUsernameByIdD2(_0x46885b[_0x3fd193(0x7a)]),getUsernameByIdD2(_0x46885b[_0x3fd193(0x87)])]);return{..._0x46885b,'playerUsername':_0x32616b,'opponentUsername':_0x4eebbe,'change':_0x46885b[_0x3fd193(0x72)]-_0x46885b['previousElo'],'timestamp':_0x46885b['timestamp']};}),_0x3aa825=await Promise['all'](_0x2480aa);return{'entries':_0x3aa825,'hasMore':_0xa642e6['size']===_0x45981f};}catch(_0x1dfb4e){console[_0x3752e0(0x73)]('Error\x20fetching\x20D2\x20ELO\x20history:',_0x1dfb4e);throw _0x1dfb4e;}}export function resetPaginationD2(){lastVisibleD2=null;}function a0_0x2902(){const _0x554da4=['5818230ksghqu','444IsRDEp','9724kEzIck','opponent','playersD2','desc','1330EwxqCh','docs','Silver','length','info','Error\x20getting\x20username:','constructor','14211261BIGvpJ','72394KSzfVH','Unknown\x20Player','loserUsername','newElo','error','data','44669zvTFbe','510DYoVum','timestamp','bind','Unranked','player','toString','24532BaGjuN','Bronze','11848648uoiHid','D2\x20ELO\x20history\x20recorded\x20for\x20','prototype','match','log','approvedMatchesD2'];a0_0x2902=function(){return _0x554da4;};return a0_0x2902();}
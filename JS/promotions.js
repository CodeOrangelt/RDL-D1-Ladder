const a43_0x3ea08b=a43_0x392c,a43_0x204cf1=(function(){let _0x4cc199=!![];return function(_0x78d243,_0x9fd3b4){const _0x1089af=_0x4cc199?function(){if(_0x9fd3b4){const _0x22aa42=_0x9fd3b4['apply'](_0x78d243,arguments);return _0x9fd3b4=null,_0x22aa42;}}:function(){};return _0x4cc199=![],_0x1089af;};}()),a43_0x254511=a43_0x204cf1(this,function(){const _0x584a95=a43_0x392c;let _0x41f7a7;try{const _0x126b6a=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x41f7a7=_0x126b6a();}catch(_0x44726e){_0x41f7a7=window;}const _0x5c48bc=_0x41f7a7[_0x584a95(0x1e0)]=_0x41f7a7[_0x584a95(0x1e0)]||{},_0x5d2fe6=['log','warn',_0x584a95(0x216),'error','exception',_0x584a95(0x1fb),'trace'];for(let _0x2b9cd7=0x0;_0x2b9cd7<_0x5d2fe6['length'];_0x2b9cd7++){const _0x144c5b=a43_0x204cf1[_0x584a95(0x233)]['prototype'][_0x584a95(0x21b)](a43_0x204cf1),_0x951f2f=_0x5d2fe6[_0x2b9cd7],_0xed2a1a=_0x5c48bc[_0x951f2f]||_0x144c5b;_0x144c5b['__proto__']=a43_0x204cf1['bind'](a43_0x204cf1),_0x144c5b[_0x584a95(0x221)]=_0xed2a1a[_0x584a95(0x221)]['bind'](_0xed2a1a),_0x5c48bc[_0x951f2f]=_0x144c5b;}});a43_0x254511();function a43_0x392c(_0x3550ee,_0x499ecb){const _0x254511=a43_0x75d7();return a43_0x392c=function(_0x204cf1,_0x77c1f1){_0x204cf1=_0x204cf1-0x1d9;let _0x75d793=_0x254511[_0x204cf1];return _0x75d793;},a43_0x392c(_0x3550ee,_0x499ecb);}import{collection,doc,query,where,orderBy,limit,getDocs,addDoc,getDoc,serverTimestamp,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a43_0x75d7(){const _0x2d3523=['currentUser','lastFetchTime','rankAchieved','Unranked','set','split','resolveUserId','console','ignored','Skipping\x20ignored\x20promotion:\x20',')\x20→\x20','matchId','promotion','className','previousRank','log','\x20→\x20','\x20for\x20','test','initialize','remove','username','\x20to\x20','displayName','Congratulations!','none','style','Could\x20not\x20resolve\x20username\x20for\x20userId:','player','bannerContainer','appendChild','\x20was\x20dismissed\x20by\x20user\x20within\x20last\x20','dismissing','email','table','pollingInterval','\x20hours','stringify','fetchRecentPromotions','sendPromotionNotification','Don\x27t\x20show\x20again','setItem','click','data-id','rankChangeModal','then','add','desc','winnerUsername','resolvedName','showRankChangeLightbox','Unknown\x20Player','children','checkAndRecordPromotion','timestamp','getElementById','Silver','shouldShowPromotion','</span>','getRankName','You\x27ve\x20been\x20demoted\x20to','info','type','error','seconds','adminUser','bind','createElement','textContent','div','now','promotionHistory','toString','rank-change-modal\x20','addEventListener','classList','button','setAttribute','DISPLAY_HOURS','threshold','removeChild','modifiedBy','new-rank-change','empty','eloHistory','approvedMatches','data','beforeunload','RANKS','Fallback\x20write\x20failed:','constructor','toMillis','You\x27ve\x20been\x20promoted\x20to','data-rank','exists'];a43_0x75d7=function(){return _0x2d3523;};return a43_0x75d7();}import{auth,db}from'./firebase-config.js';class PromotionManager{constructor(){const _0x411eae=a43_0x392c;this['DISPLAY_HOURS']=0x18,this[_0x411eae(0x231)]=[{'threshold':0x578,'name':'Bronze','color':'#CD7F32'},{'threshold':0x640,'name':_0x411eae(0x211),'color':'#C0C0C0'},{'threshold':0x708,'name':'Gold','color':'#FFD700'},{'threshold':0x834,'name':'Emerald','color':'#50C878'}],this['bannerContainer']=null,this['lastFetchTime']=0x0,this['fetchInterval']=0xea60,this['pollingInterval']=null,this['usernameCache']={};}['initialize'](){const _0x1319ab=a43_0x392c;this[_0x1319ab(0x1f6)]=document['getElementById']('promotion-banner-container');if(!this['bannerContainer']){console['error']('Promotion\x20banner\x20container\x20not\x20found');return;}this['setupBannerContainer']();const _0x1217d7='promotions_checked_'+new Date()['toDateString'](),_0x31d59a=sessionStorage['getItem'](_0x1217d7);!_0x31d59a&&(this['fetchRecentPromotions'](),sessionStorage[_0x1319ab(0x202)](_0x1217d7,'true')),document['addEventListener']('visibilitychange',()=>{document['visibilityState']==='visible'&&!sessionStorage['getItem'](_0x1217d7)&&(this['fetchRecentPromotions'](),sessionStorage['setItem'](_0x1217d7,'true'));}),window[_0x1319ab(0x223)](_0x1319ab(0x230),()=>{this['pollingInterval']&&clearInterval(this['pollingInterval']);});}['setupBannerContainer'](){const _0x40bdc8=a43_0x392c;this['bannerContainer']['innerHTML']='',this[_0x40bdc8(0x1f6)][_0x40bdc8(0x1f3)]['display']='none';}async[a43_0x3ea08b(0x1ff)](){const _0x1ec91b=a43_0x3ea08b;try{const _0xe0604f=Date['now']();if(_0xe0604f-this[_0x1ec91b(0x1da)]<this['fetchInterval'])return;this['lastFetchTime']=_0xe0604f;const _0x215a7d=collection(db,_0x1ec91b(0x22d)),_0x5de228=query(_0x215a7d,where('type','in',[_0x1ec91b(0x1e5),'demotion']),orderBy('timestamp','desc'),limit(0x14)),_0x282bdf=await getDocs(_0x5de228),_0x563f25=[];_0x282bdf['forEach'](_0x4f57d2=>{const _0x3ce8cc=_0x1ec91b,_0xc38186={'id':_0x4f57d2['id'],..._0x4f57d2['data']()};this[_0x3ce8cc(0x212)](_0x4f57d2['id'])&&this['isNewRankChange'](_0xc38186)&&_0x563f25['push'](_0xc38186);}),_0x563f25['length']>0x0&&await this['processRankChanges'](_0x563f25);}catch(_0x38accc){console[_0x1ec91b(0x218)]('Error\x20fetching\x20promotions:',_0x38accc);}}async['processRankChanges'](_0x23bab0){const _0x1de698=a43_0x3ea08b;if(_0x23bab0['length']===0x0)return;_0x23bab0['sort']((_0x131312,_0x2fb0d4)=>{const _0x13ff75=a43_0x392c,_0x4a2345=_0x131312['timestamp']?.['toMillis']?.()||_0x131312['timestamp']?.['seconds']*0x3e8||0x0,_0x4b33ba=_0x2fb0d4['timestamp']?.[_0x13ff75(0x234)]?.()||_0x2fb0d4[_0x13ff75(0x20f)]?.['seconds']*0x3e8||0x0;return _0x4b33ba-_0x4a2345;});const _0x4d3894=this['bannerContainer'][_0x1de698(0x20d)]['length'],_0x4a9816=0x3-_0x4d3894;if(_0x4a9816<=0x0)return;const _0x1d22e6=_0x23bab0['slice'](0x0,_0x4a9816);for(let _0x344f1c=0x0;_0x344f1c<_0x1d22e6['length'];_0x344f1c++){const _0x458694=_0x1d22e6[_0x344f1c],_0x20c58b=auth['currentUser'];try{setTimeout(()=>{this['showRankChangeBanner'](_0x458694);},_0x344f1c*0x3e8),_0x20c58b&&_0x458694[_0x1de698(0x1f5)]===_0x20c58b['displayName']&&this['showRankChangeLightbox'](_0x458694[_0x1de698(0x217)],_0x458694[_0x1de698(0x1db)]);}catch(_0x58ad84){console['error']('Error\x20processing\x20rank\x20change:',_0x58ad84);}}}[a43_0x3ea08b(0x212)](_0x47ba98){const _0x30f928=a43_0x3ea08b;try{const _0x5693b0='promotion_'+_0x47ba98,_0x2748ef=localStorage['getItem'](_0x5693b0);if(_0x2748ef){let _0x2285a6;try{_0x2285a6=JSON['parse'](_0x2748ef);}catch(_0x162032){return console['warn']('Invalid\x20storage\x20format\x20for\x20'+_0x5693b0+',\x20treating\x20as\x20new'),!![];}if(_0x2285a6[_0x30f928(0x1e1)]===!![])return console[_0x30f928(0x1e8)]('Promotion\x20'+_0x47ba98+'\x20is\x20permanently\x20ignored'),![];const _0x121533=Date[_0x30f928(0x21f)]();if(_0x2285a6['userDismissed']&&_0x121533-_0x2285a6[_0x30f928(0x20f)]<this[_0x30f928(0x227)]*0x3c*0x3c*0x3e8)return console['log']('Promotion\x20'+_0x47ba98+_0x30f928(0x1f8)+this['DISPLAY_HOURS']+_0x30f928(0x1fd)),![];if(_0x2285a6['systemDismissed']&&_0x121533-_0x2285a6['timestamp']<0x4*0x3c*0x3c*0x3e8)return console['log']('Promotion\x20'+_0x47ba98+'\x20was\x20auto-dismissed\x20within\x20last\x204\x20hours'),![];}return!![];}catch(_0x65215c){return console['error']('Error\x20checking\x20promotion\x20visibility:',_0x65215c),![];}}['ignorePromotion'](_0x2a9838){const _0x58d91e=a43_0x3ea08b;try{const _0x5325c2='promotion_'+_0x2a9838;localStorage[_0x58d91e(0x202)](_0x5325c2,JSON['stringify']({'timestamp':Date[_0x58d91e(0x21f)](),'ignored':!![]}));}catch(_0x3ca7aa){console['error']('Error\x20saving\x20promotion\x20preference:',_0x3ca7aa);}}['showRankChangeBanner'](_0x2749a1){const _0x98188d=a43_0x3ea08b;this[_0x98188d(0x1df)](_0x2749a1)[_0x98188d(0x206)](_0x3e3c20=>{const _0x22f223=_0x98188d,_0x2a030a='promotion_'+_0x2749a1['id'],_0x3ab951=localStorage['getItem'](_0x2a030a);if(_0x3ab951)try{const _0x30884b=JSON['parse'](_0x3ab951);if(_0x30884b['ignored']===!![]){console['log'](_0x22f223(0x1e2)+_0x2749a1['id']);return;}}catch(_0x4d7556){}localStorage[_0x22f223(0x202)](_0x2a030a,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':![],'seenAt':Date['now']()})),this['bannerContainer'][_0x22f223(0x1f3)]['display']='block';while(this['bannerContainer'][_0x22f223(0x20d)]['length']>=0x3){this[_0x22f223(0x1f6)][_0x22f223(0x229)](this[_0x22f223(0x1f6)]['firstChild']);}const _0x4aadb7=document[_0x22f223(0x21c)]('div');_0x4aadb7[_0x22f223(0x1e6)]='promotion-banner',_0x4aadb7['setAttribute'](_0x22f223(0x236),_0x3e3c20['rankAchieved']),_0x4aadb7[_0x22f223(0x226)](_0x22f223(0x204),_0x3e3c20['id']);const _0x18c3ca=document[_0x22f223(0x21c)](_0x22f223(0x21e));_0x18c3ca['className']='promotion-details';const _0x269483=_0x3e3c20['resolvedName']||_0x3e3c20['player']||_0x3e3c20['username']||_0x3e3c20['playerUsername']||_0x3e3c20['displayName']||'A\x20player',_0x36022e=_0x3e3c20[_0x22f223(0x217)]===_0x22f223(0x1e5)?_0x269483+'\x20was\x20promoted\x20to':_0x269483+'\x20was\x20demoted\x20to';_0x18c3ca['innerHTML']=_0x36022e+'\x20<span\x20class=\x22rank-text\x22>'+_0x3e3c20['rankAchieved']+_0x22f223(0x213);const _0x584427=document['createElement'](_0x22f223(0x21e));_0x584427[_0x22f223(0x1e6)]='banner-actions';const _0x1df911=document['createElement'](_0x22f223(0x225));_0x1df911[_0x22f223(0x1e6)]='dismiss-btn',_0x1df911['innerHTML']='&times;',_0x1df911['title']='Dismiss';const _0x5747f5=document['createElement'](_0x22f223(0x225));_0x5747f5['className']='ignore-btn',_0x5747f5[_0x22f223(0x21d)]=_0x22f223(0x201),_0x5747f5['title']='Never\x20show\x20this\x20promotion\x20again',_0x584427['appendChild'](_0x5747f5),_0x584427['appendChild'](_0x1df911),_0x4aadb7['appendChild'](_0x18c3ca),_0x4aadb7['appendChild'](_0x584427),this[_0x22f223(0x1f6)][_0x22f223(0x1f7)](_0x4aadb7),void _0x4aadb7['offsetWidth'],setTimeout(()=>{_0x4aadb7['classList']['add']('new-rank-change');},0x32),_0x1df911['addEventListener']('click',()=>{const _0x293400=_0x22f223;localStorage['setItem'](_0x2a030a,JSON[_0x293400(0x1fe)]({'timestamp':Date['now'](),'ignored':![],'userDismissed':!![],'systemDismissed':![]})),_0x4aadb7['classList'][_0x293400(0x1ed)]('new-rank-change'),_0x4aadb7['classList']['add']('dismissing'),setTimeout(()=>{const _0xd7d2e3=_0x293400;_0x4aadb7['parentNode']&&(_0x4aadb7['remove'](),this[_0xd7d2e3(0x1f6)]['children']['length']===0x0&&(this[_0xd7d2e3(0x1f6)]['style']['display']='none'));},0x1f4);}),_0x5747f5['addEventListener']('click',()=>{const _0x21fa3d=_0x22f223;localStorage['setItem'](_0x2a030a,JSON[_0x21fa3d(0x1fe)]({'timestamp':Date[_0x21fa3d(0x21f)](),'ignored':!![],'userDismissed':!![],'systemDismissed':![]})),_0x4aadb7['classList']['remove'](_0x21fa3d(0x22b)),_0x4aadb7['classList']['add'](_0x21fa3d(0x1f9)),setTimeout(()=>{const _0x94e26a=_0x21fa3d;_0x4aadb7['parentNode']&&(_0x4aadb7['remove'](),this['bannerContainer']['children']['length']===0x0&&(this[_0x94e26a(0x1f6)]['style']['display']='none'));},0x1f4);}),setTimeout(()=>{const _0x5e3980=_0x22f223;_0x4aadb7['parentNode']&&(_0x4aadb7[_0x5e3980(0x224)][_0x5e3980(0x1ed)](_0x5e3980(0x22b)),_0x4aadb7['classList'][_0x5e3980(0x207)]('dismissing'),localStorage['setItem'](_0x2a030a,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':!![]})),setTimeout(()=>{const _0x190b80=_0x5e3980;_0x4aadb7['parentNode']&&(_0x4aadb7['remove'](),this['bannerContainer']['children']['length']===0x0&&(this['bannerContainer'][_0x190b80(0x1f3)]['display']=_0x190b80(0x1f2)));},0x1f4));},0x3a98);});}async['resolveUserId'](_0x5cfb04){const _0x390d16=a43_0x3ea08b,_0x12e31b={..._0x5cfb04},_0x3749d6=[_0x5cfb04[_0x390d16(0x1f5)],_0x5cfb04[_0x390d16(0x1ee)],_0x5cfb04['playerUsername'],_0x5cfb04['displayName']],_0x584f6d=_0x3749d6['some'](_0x21ca0d=>_0x21ca0d&&typeof _0x21ca0d==='string'&&!_0x21ca0d['includes']('ID:')&&!/^[a-zA-Z0-9]{20,}$/['test'](_0x21ca0d));if(_0x584f6d)return _0x12e31b;let _0x55c0e4=null;if(_0x5cfb04['userId'])_0x55c0e4=_0x5cfb04['userId'];else _0x5cfb04['player']&&/^[A-Za-z0-9]{20,}$/[_0x390d16(0x1eb)](_0x5cfb04['player'])&&(_0x55c0e4=_0x5cfb04[_0x390d16(0x1f5)]);if(!_0x55c0e4)return _0x12e31b;try{const _0x218c16=await getDoc(doc(db,'players',_0x55c0e4));if(_0x218c16[_0x390d16(0x237)]()){const _0x2e2835=_0x218c16['data']();if(_0x2e2835['username'])return _0x12e31b['resolvedName']=_0x2e2835['username'],_0x12e31b;}const _0x34f9f3=await getDocs(query(collection(db,_0x390d16(0x22e)),where('winnerId','==',_0x55c0e4),orderBy('date',_0x390d16(0x208)),limit(0x1)));if(!_0x34f9f3[_0x390d16(0x22c)]){const _0x5026db=_0x34f9f3['docs'][0x0][_0x390d16(0x22f)]();if(_0x5026db[_0x390d16(0x209)])return _0x12e31b[_0x390d16(0x20a)]=_0x5026db[_0x390d16(0x209)],_0x12e31b;}const _0x135003=await getDocs(query(collection(db,'approvedMatches'),where('loserId','==',_0x55c0e4),orderBy('date','desc'),limit(0x1)));if(!_0x135003[_0x390d16(0x22c)]){const _0x434fb5=_0x135003['docs'][0x0]['data']();if(_0x434fb5['loserUsername'])return _0x12e31b['resolvedName']=_0x434fb5['loserUsername'],console['log']('Resolved\x20'+_0x55c0e4+_0x390d16(0x1ef)+_0x434fb5['loserUsername']+'\x20(loser)'),_0x12e31b;}}catch(_0x43867a){console['error']('Error\x20resolving\x20user\x20ID:',_0x43867a);}return console['warn']('Failed\x20to\x20resolve\x20user\x20ID:\x20'+_0x55c0e4),_0x12e31b;}[a43_0x3ea08b(0x20b)](_0x599891,_0x5c4582){const _0x4c903f=a43_0x3ea08b;let _0xf37cee=document[_0x4c903f(0x210)]('rankChangeModal');!_0xf37cee&&(_0xf37cee=document['createElement']('div'),_0xf37cee['id']=_0x4c903f(0x205),_0xf37cee['className']=_0x4c903f(0x222)+_0x599891,document['body']['appendChild'](_0xf37cee));const _0x1ee8d0=_0x599891==='promotion'?_0x4c903f(0x1f1):'Rank\x20Update',_0x39ea19=_0x599891==='promotion'?_0x4c903f(0x235):_0x4c903f(0x215);_0xf37cee['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rank-change-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2\x20class=\x22rank-change-title\x22>'+_0x1ee8d0+'</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>'+_0x39ea19+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22rank-name\x22>'+_0x5c4582+'</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22rank-change-button\x22\x20id=\x22rank-change-ok-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Got\x20it!\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0xf37cee[_0x4c903f(0x1f3)]['display']='flex',document[_0x4c903f(0x210)]('rank-change-ok-btn')[_0x4c903f(0x223)](_0x4c903f(0x203),()=>{const _0x4f0a4a=_0x4c903f;_0xf37cee['style']['display']=_0x4f0a4a(0x1f2);}),_0xf37cee[_0x4c903f(0x223)]('click',_0x54f5e9=>{const _0x2c2377=_0x4c903f;_0x54f5e9['target']===_0xf37cee&&(_0xf37cee['style']['display']=_0x2c2377(0x1f2));});}async[a43_0x3ea08b(0x20e)](_0x24da32,_0x17b39b,_0x3d19d3,_0x5535c3={}){const _0xc33107=a43_0x3ea08b;try{if(_0x17b39b===_0x3d19d3||!_0x24da32)return null;const _0x2aac02=_0x5535c3['source']||'automatic',_0xf5b080=_0x5535c3['matchId']||null,_0x220bd2=_0x5535c3[_0xc33107(0x21a)]||null;console[_0xc33107(0x1e8)]('Processing\x20potential\x20rank\x20change:\x20'+_0x3d19d3+_0xc33107(0x1e9)+_0x17b39b+'\x20(source:\x20'+_0x2aac02+')');let _0xc12680=null,_0x3b733a=null;try{const _0x141970=await getDoc(doc(db,'players',_0x24da32));if(_0x141970['exists']()){const _0x126403=_0x141970['data']();_0xc12680=_0x126403['username']||_0x126403['displayName']||null,_0x3b733a=_0x126403['displayName']||_0x126403['username']||null;}!_0xc12680&&_0x5535c3[_0xc33107(0x1ee)]&&(_0xc12680=_0x5535c3[_0xc33107(0x1ee)],_0x3b733a=_0x5535c3['username']);!_0xc12680&&auth['currentUser']&&(_0xc12680=auth[_0xc33107(0x1d9)]['displayName']||auth['currentUser'][_0xc33107(0x1fa)][_0xc33107(0x1de)]('@')[0x0],_0x3b733a=auth['currentUser'][_0xc33107(0x1f0)]||null);if(!_0xc12680){const _0xc65d1f=query(collection(db,'approvedMatches'),where('winnerId','==',_0x24da32),limit(0x1)),_0x55a48a=await getDocs(_0xc65d1f);if(!_0x55a48a['empty'])_0xc12680=_0x55a48a['docs'][0x0]['data']()['winnerUsername']||_0xc33107(0x20c),_0x3b733a=_0xc12680;else{const _0x481751=query(collection(db,_0xc33107(0x22e)),where('loserId','==',_0x24da32),limit(0x1)),_0x2a4424=await getDocs(_0x481751);!_0x2a4424['empty']&&(_0xc12680=_0x2a4424[0x0][_0xc33107(0x22f)]()['loserUsername']||_0xc33107(0x20c),_0x3b733a=_0xc12680);}}}catch(_0x2b5df6){console[_0xc33107(0x218)]('Error\x20resolving\x20username:',_0x2b5df6);}!_0xc12680&&(console['warn'](_0xc33107(0x1f4),_0x24da32),_0xc12680='A\x20player',_0x3b733a=_0xc33107(0x20c));const _0x24ea69=this[_0xc33107(0x214)](_0x3d19d3),_0x36fbc2=this[_0xc33107(0x214)](_0x17b39b);if(_0x24ea69!==_0x36fbc2){const _0x20bd81=_0x17b39b>_0x3d19d3,_0xef8829=_0x20bd81?'promotion':'demotion',_0x50e26e=_0x36fbc2;console['log']('Recording\x20'+_0xef8829+_0xc33107(0x1ea)+_0xc12680+':\x20'+_0x3d19d3+'\x20('+_0x24ea69+_0xc33107(0x1e3)+_0x17b39b+'\x20('+_0x36fbc2+')');try{const _0x53aaea={'player':_0xc12680,'playerUsername':_0xc12680,'username':_0xc12680,'displayName':_0x3b733a,'userId':_0x24da32,'type':_0xef8829,'rankAchieved':_0x50e26e,'timestamp':serverTimestamp(),'previousElo':_0x3d19d3,'newElo':_0x17b39b,'change':_0x17b39b-_0x3d19d3,'previousRank':_0x24ea69,'newRank':_0x36fbc2,'source':_0x2aac02};if(_0x2aac02==='match'&&_0xf5b080)_0x53aaea[_0xc33107(0x1e4)]=_0xf5b080;else _0x2aac02==='admin'&&_0x220bd2?(_0x53aaea[_0xc33107(0x22a)]=_0x220bd2,_0x53aaea['isAutomatic']=![]):_0x53aaea['isAutomatic']=!![];const _0x35b41e=writeBatch(db),_0x3e6153=doc(collection(db,'eloHistory')),_0x2435db=doc(collection(db,_0xc33107(0x220)));return _0x35b41e['set'](_0x3e6153,_0x53aaea),_0x35b41e[_0xc33107(0x1dd)](_0x2435db,_0x53aaea),await _0x35b41e['commit'](),await this[_0xc33107(0x200)](_0x24da32,_0xc12680,_0x3d19d3,_0x17b39b,_0x24ea69,_0x36fbc2,_0xef8829,{'displayName':_0x3b733a,'source':_0x2aac02,'matchId':_0xf5b080,'ladder':_0x5535c3['ladder']||'D1'}),console['log']('Successfully\x20recorded\x20'+_0xef8829+'\x20for\x20'+_0xc12680+_0xc33107(0x1ef)+_0x50e26e),_0x50e26e;}catch(_0x1ebedb){console['error']('Error\x20writing\x20promotion\x20records:',_0x1ebedb);try{return await addDoc(collection(db,'eloHistory'),{'player':_0xc12680,'playerUsername':_0xc12680,'username':_0xc12680,'displayName':_0x3b733a,'userId':_0x24da32,'type':_0xef8829,'rankAchieved':_0x50e26e,'timestamp':serverTimestamp(),'previousElo':_0x3d19d3,'newElo':_0x17b39b,'change':_0x17b39b-_0x3d19d3,'previousRank':_0x24ea69,'source':_0x2aac02,'isAutomatic':_0x2aac02!=='admin'}),await this['sendPromotionNotification'](_0x24da32,_0xc12680,_0x3d19d3,_0x17b39b,_0x24ea69,_0x36fbc2,_0xef8829,{'displayName':_0x3b733a,'source':_0x2aac02,'matchId':_0xf5b080,'ladder':_0x5535c3['ladder']||'D1'}),_0x50e26e;}catch(_0x265614){return console['error'](_0xc33107(0x232),_0x265614),null;}}}return null;}catch(_0x183a7a){return console['error']('Error\x20in\x20promotion/demotion\x20recording:',_0x183a7a),null;}}[a43_0x3ea08b(0x214)](_0x407c7f){const _0x5952ab=a43_0x3ea08b;for(let _0x446a08=this[_0x5952ab(0x231)]['length']-0x1;_0x446a08>=0x0;_0x446a08--){if(_0x407c7f>=this['RANKS'][_0x446a08][_0x5952ab(0x228)])return this[_0x5952ab(0x231)][_0x446a08]['name'];}return _0x5952ab(0x1dc);}['cleanup'](){const _0x1f7b59=a43_0x3ea08b;this[_0x1f7b59(0x1fc)]&&clearInterval(this['pollingInterval']);}['isNewRankChange'](_0x3ce564){const _0x464689=a43_0x3ea08b;if(_0x3ce564['timestamp']){const _0x5294c2=_0x3ce564['timestamp'][_0x464689(0x219)]*0x3e8,_0x1ca4d8=Date['now'](),_0x48d1b5=(_0x1ca4d8-_0x5294c2)/(0x3e8*0x3c*0x3c);if(_0x48d1b5>0x18)return![];}if(_0x3ce564[_0x464689(0x1e7)]&&_0x3ce564['newRank']&&_0x3ce564[_0x464689(0x1e7)]!==_0x3ce564['newRank'])return!![];return![];}async['sendPromotionNotification'](_0x33ed99,_0xd54b3e,_0x12a706,_0x3fa407,_0x19cbe3,_0x136120,_0x58db39,_0x14ed7f={}){const _0x4373ab=a43_0x3ea08b;try{console['log']('STARTING\x20notification\x20for\x20'+_0xd54b3e+'\x27s\x20'+_0x58db39);const _0x219331={'userId':_0x33ed99,'username':_0xd54b3e,'displayName':_0x14ed7f['displayName']||_0xd54b3e,'oldElo':parseInt(_0x12a706),'newElo':parseInt(_0x3fa407),'eloDifference':parseInt(_0x3fa407)-parseInt(_0x12a706),'oldRank':_0x19cbe3,'newRank':_0x136120,'type':_0x58db39,'timestamp':serverTimestamp(),'processed':![],'source':_0x14ed7f['source']||'automatic','matchId':_0x14ed7f['matchId']||null,'ladder':_0x14ed7f['ladder']||'D1','adminUser':_0x14ed7f['adminUser']||null};console[_0x4373ab(0x1e8)]('Creating\x20Discord\x20notification:',_0x219331);const _0x18c936=await addDoc(collection(db,'promotionNotifications'),_0x219331);return console['log']('Discord\x20notification\x20sent\x20successfully\x20with\x20ID:\x20'+_0x18c936['id']),!![];}catch(_0x204024){return console[_0x4373ab(0x218)]('Error\x20sending\x20Discord\x20notification:',_0x204024),![];}}}export const promotionManager=new PromotionManager();document['addEventListener']('DOMContentLoaded',()=>{const _0x95c9fa=a43_0x3ea08b;promotionManager[_0x95c9fa(0x1ec)]();});export const initializePromotionTracker=()=>promotionManager['initialize']();export const checkAndRecordPromotion=(_0x4b4670,_0x470229,_0xf5bb61,_0x147375)=>promotionManager[a43_0x3ea08b(0x20e)](_0x4b4670,_0x470229,_0xf5bb61,_0x147375);export const getRankName=_0x3d5a45=>promotionManager['getRankName'](_0x3d5a45);
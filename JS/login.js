const a33_0x241fb6=a33_0xd323,a33_0x36c852=(function(){let _0x147257=!![];return function(_0x11c69a,_0x29b1e2){const _0x4d50d2=_0x147257?function(){if(_0x29b1e2){const _0x5ee38c=_0x29b1e2['apply'](_0x11c69a,arguments);return _0x29b1e2=null,_0x5ee38c;}}:function(){};return _0x147257=![],_0x4d50d2;};}()),a33_0x4f9f96=a33_0x36c852(this,function(){const _0x3103b7=a33_0xd323,_0x1bb55e=function(){let _0x578721;try{_0x578721=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0xdc5bef){_0x578721=window;}return _0x578721;},_0x8a818f=_0x1bb55e(),_0x29bcbd=_0x8a818f['console']=_0x8a818f[_0x3103b7(0xef)]||{},_0x436a29=['log','warn','info','error',_0x3103b7(0x11c),'table','trace'];for(let _0x33260d=0x0;_0x33260d<_0x436a29[_0x3103b7(0xf6)];_0x33260d++){const _0x3c1201=a33_0x36c852[_0x3103b7(0x104)]['prototype']['bind'](a33_0x36c852),_0x207cc7=_0x436a29[_0x33260d],_0x5ec01b=_0x29bcbd[_0x207cc7]||_0x3c1201;_0x3c1201['__proto__']=a33_0x36c852['bind'](a33_0x36c852),_0x3c1201[_0x3103b7(0xf0)]=_0x5ec01b[_0x3103b7(0xf0)][_0x3103b7(0xee)](_0x5ec01b),_0x29bcbd[_0x207cc7]=_0x3c1201;}});a33_0x4f9f96();import{createUserWithEmailAndPassword,signInWithEmailAndPassword,sendEmailVerification,signOut}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{doc,setDoc,collection,getDocs,query,where,getDoc,updateDoc,deleteDoc,orderBy,limit,serverTimestamp}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{auth,db}from'./firebase-config.js';function setupVerificationListener(_0x401906,_0x8099e3){const _0x2955c1=a33_0xd323;console[_0x2955c1(0x11f)]('Setting\x20up\x20email\x20verification\x20listener\x20for:',_0x401906);const _0x4ed989=setInterval(async()=>{const _0xfc8393=_0x2955c1;try{console[_0xfc8393(0x11f)](_0xfc8393(0x122));const _0x2a0c44=await signInWithEmailAndPassword(auth,_0x401906,_0x8099e3),_0x468b1f=_0x2a0c44[_0xfc8393(0x115)];await _0x468b1f['getIdToken'](!![]),_0x468b1f['emailVerified']?(console['log']('Email\x20has\x20been\x20verified!\x20Redirecting\x20to\x20login\x20page...'),clearInterval(_0x4ed989),document['getElementById']('register-error')[_0xfc8393(0x101)]=_0xfc8393(0x120),await signOut(auth),setTimeout(()=>{const _0x556ff1=_0xfc8393;document[_0x556ff1(0x10b)]('register-container')[_0x556ff1(0xfd)]['display']='none',document['getElementById']('login-container')['style'][_0x556ff1(0x117)]=_0x556ff1(0x100),document['getElementById'](_0x556ff1(0x112))['value']=_0x401906,document['getElementById']('login-error')['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22success-message\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Your\x20account\x20has\x20been\x20verified!\x20You\x20can\x20now\x20log\x20in.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>';},0x7d0)):(console['log'](_0xfc8393(0x11a)),await signOut(auth));}catch(_0x17d7d6){console[_0xfc8393(0x125)](_0xfc8393(0x10f),_0x17d7d6),clearInterval(_0x4ed989);}},0x1388);window['verificationCheckInterval']=_0x4ed989,setTimeout(()=>{const _0x2ce18d=_0x2955c1;window['verificationCheckInterval']&&(clearInterval(window[_0x2ce18d(0xed)]),window[_0x2ce18d(0xed)]=null,console['log']('Stopped\x20checking\x20for\x20email\x20verification\x20(timeout\x20reached)'));},0x5*0x3c*0x3e8);}async function isUsernameAvailable(_0x3e70f7){const _0x191792=a33_0xd323;if(!_0x3e70f7||typeof _0x3e70f7!=='string'||_0x3e70f7['trim']()['length']<0x3)return document[_0x191792(0x10b)]('register-error')['textContent']=_0x191792(0xff),![];const _0x2a0249=_0x3e70f7[_0x191792(0xea)]();try{const _0x5ce08e=/^[a-zA-Z0-9_-]{3,20}$/;if(!_0x5ce08e['test'](_0x2a0249))return document[_0x191792(0x10b)]('register-error')[_0x191792(0x111)]='Username\x20can\x20only\x20contain\x20letters,\x20numbers,\x20underscores\x20and\x20hyphens',![];const [_0x47af68,_0x45cac2,_0x21ffcc]=await Promise[_0x191792(0xfb)]([getDocs(query(collection(db,'players'),where('username','==',_0x2a0249))),getDocs(query(collection(db,'pendingRegistrations'),where('username','==',_0x2a0249))),getDocs(query(collection(db,'nonParticipants'),where('username','==',_0x2a0249)))]);if(!_0x47af68['empty']||!_0x45cac2['empty']||!_0x21ffcc['empty'])return document['getElementById']('register-error')['textContent']=_0x191792(0x108),![];return!![];}catch(_0xa770a1){return console['error']('Error\x20checking\x20username:',_0xa770a1),document['getElementById']('register-error')[_0x191792(0x111)]='Unable\x20to\x20verify\x20username\x20availability.\x20Please\x20try\x20again\x20later.',![];}}async function handleRegister(_0x12141d){const _0x25e0dd=a33_0xd323;_0x12141d[_0x25e0dd(0xfc)]();const _0x12e890=document['getElementById']('register-error');_0x12e890[_0x25e0dd(0x111)]='';const _0x2d1205=document[_0x25e0dd(0x10b)]('register-email')['value'],_0x4b867a=document['getElementById']('register-password')['value'],_0x3cad6d=document['getElementById'](_0x25e0dd(0x11e))['value'],_0xcbd592=document[_0x25e0dd(0x10b)]('verification-answer')['value']['toLowerCase'](),_0x16b50a=document[_0x25e0dd(0x10b)]('register-mode')['value'],_0x2d9422=document[_0x25e0dd(0x10b)]('non-participant')?.[_0x25e0dd(0x105)]||![];if(_0x2d9422&&_0x16b50a!==''){_0x12e890['textContent']='Please\x20unselect\x20a\x20game\x20mode\x20if\x20you\x20choose\x20Non-Participant.';return;}if(!_0x2d9422&&_0x16b50a===''){_0x12e890['textContent']='Please\x20select\x20a\x20game\x20mode\x20or\x20check\x20Non-Participant.';return;}try{const _0x449d1c=[_0x25e0dd(0x113),'magenta'];if(!_0x449d1c['includes'](_0xcbd592)){_0x12e890['textContent']='Incorrect\x20answer\x20to\x20verification\x20question';return;}const _0x2e9ffd=await isUsernameAvailable(_0x3cad6d);if(!_0x2e9ffd)return;const _0x3c2087=await createUserWithEmailAndPassword(auth,_0x2d1205,_0x4b867a),_0x36e4f3=_0x3c2087['user'];await sendEmailVerification(_0x36e4f3),await setDoc(doc(db,'pendingRegistrations',_0x36e4f3['uid']),{'username':_0x3cad6d['trim'](),'email':_0x2d1205,'gameMode':_0x16b50a,'nonParticipant':_0x2d9422,'createdAt':new Date(),'verified':![]}),_0x12e890['innerHTML']=_0x25e0dd(0xf2)+_0x2d1205+'\x27)\x22\x20class=\x22resend-button\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Resend\x20Verification\x20Email\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>',await signOut(auth),setupVerificationListener(_0x2d1205,_0x4b867a);}catch(_0x3f08bd){console[_0x25e0dd(0x125)]('Registration\x20error:',_0x3f08bd),_0x12e890['textContent']=_0x3f08bd['code']==='auth/email-already-in-use'?_0x25e0dd(0xfa):'Registration\x20failed.\x20Please\x20try\x20again\x20later.';}}async function handleLogin(_0x14600e){const _0x540e48=a33_0xd323;_0x14600e[_0x540e48(0xfc)]();const _0x560e0a=document['getElementById'](_0x540e48(0x112))['value'],_0x45f913=document[_0x540e48(0x10b)](_0x540e48(0x123))[_0x540e48(0xf5)],_0x4e2f05=document[_0x540e48(0x10b)]('login-error');console['log'](_0x540e48(0x121),_0x560e0a),_0x4e2f05['textContent']='';try{console['log']('Attempting\x20Firebase\x20signInWithEmailAndPassword...');const _0x29f27a=await signInWithEmailAndPassword(auth,_0x560e0a,_0x45f913),_0x2f5a2d=_0x29f27a['user'];console['log']('User\x20signed\x20in:',_0x2f5a2d[_0x540e48(0x10d)]);const _0x222c0c=['players',_0x540e48(0x119),'playersD3',_0x540e48(0xf7),'playersCTF',_0x540e48(0x10c)];console[_0x540e48(0x11f)](_0x540e48(0xf4));let _0x5d3ccb=![],_0x5106c6=await Promise['all'](_0x222c0c['map'](_0x3597e2=>getDoc(doc(db,_0x3597e2,_0x2f5a2d[_0x540e48(0x10d)]))));for(let _0x5c03a6=0x0;_0x5c03a6<_0x5106c6[_0x540e48(0xf6)];_0x5c03a6++){if(_0x5106c6[_0x5c03a6]['exists']()){_0x5d3ccb=!![],console['log']('User\x20found\x20in\x20'+_0x222c0c[_0x5c03a6]+_0x540e48(0xf8));break;}}if(!_0x5d3ccb){console['log']('User\x20not\x20found\x20in\x20any\x20collection,\x20checking\x20pending\x20registration');const _0x2c3a71=doc(db,'pendingRegistrations',_0x2f5a2d['uid']),_0x15942c=await getDoc(_0x2c3a71);if(_0x15942c['exists']()){const _0x49ef5e=_0x15942c['data']();console['log'](_0x540e48(0x103),_0x49ef5e);if(_0x2f5a2d['emailVerified']){console['log']('Email\x20is\x20verified,\x20processing\x20registration'),_0x4e2f05[_0x540e48(0x101)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22success-message\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Setting\x20up\x20your\x20account...\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>';if(_0x49ef5e['nonParticipant'])console[_0x540e48(0x11f)]('Processing\x20non-participant\x20registration'),await setDoc(doc(db,'nonParticipants',_0x2f5a2d[_0x540e48(0x10d)]),{'username':_0x49ef5e['username'],'email':_0x2f5a2d[_0x540e48(0x114)],'createdAt':serverTimestamp(),'isNonParticipant':!![]}),console[_0x540e48(0x11f)]('User\x20'+_0x49ef5e[_0x540e48(0x118)]+_0x540e48(0x11b));else{let _0x40ce46;switch(_0x49ef5e['gameMode']){case'D1':_0x40ce46='players';break;case'D2':_0x40ce46='playersD2';break;case'D3':_0x40ce46='playersD3';break;case'Duos':_0x40ce46='playersDuos';break;case'CTF':_0x40ce46='playersCTF';break;default:_0x40ce46='players';}console['log']('Processing\x20'+_0x49ef5e['gameMode']+'\x20player\x20registration\x20to\x20'+_0x40ce46);const _0x466484=collection(db,_0x40ce46),_0x3189d=query(_0x466484,orderBy('position','desc'),limit(0x1)),_0xecc259=await getDocs(_0x3189d),_0x58d9d4=_0xecc259['empty']?0x1:_0xecc259['docs'][0x0]['data']()['position']+0x1;await setDoc(doc(db,_0x40ce46,_0x2f5a2d['uid']),{'username':_0x49ef5e[_0x540e48(0x118)],'email':_0x2f5a2d['email'],'eloRating':0x4b0,'position':_0x58d9d4,'createdAt':serverTimestamp(),'isAdmin':![],'matches':0x0,'wins':0x0,'losses':0x0,'gameMode':_0x49ef5e['gameMode']}),console['log'](_0x540e48(0x124)+_0x49ef5e['username']+_0x540e48(0x10e)+_0x40ce46+'\x20at\x20position\x20'+_0x58d9d4);}await deleteDoc(_0x2c3a71),setTimeout(()=>{const _0x5ecc3a=_0x540e48;window['location'][_0x5ecc3a(0xf1)]='../index.html';},0x7d0);return;}else{_0x4e2f05['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22warning-message\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Please\x20verify\x20your\x20email\x20to\x20complete\x20your\x20registration.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<br><br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20type=\x22button\x22\x20id=\x22resend-button\x22\x20class=\x22resend-button\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Resend\x20Verification\x20Email\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>',document['getElementById']('resend-button')[_0x540e48(0x110)]('click',()=>{resendVerificationEmail(_0x560e0a);}),await signOut(auth);return;}}}window[_0x540e48(0x11d)]['href']='../index.html';}catch(_0xa9fbab){console[_0x540e48(0x125)]('Login\x20error:',_0xa9fbab),_0x4e2f05['textContent']='Login\x20failed:\x20'+_0xa9fbab['message'];}}function a33_0xd323(_0x2b4fac,_0x355ea3){const _0x4f9f96=a33_0xcae5();return a33_0xd323=function(_0x36c852,_0x34868c){_0x36c852=_0x36c852-0xea;let _0xcae549=_0x4f9f96[_0x36c852];return _0xcae549;},a33_0xd323(_0x2b4fac,_0x355ea3);}function loginFormHandler(_0x39c906){const _0x77c6ab=a33_0xd323;_0x39c906['preventDefault']();const _0x3f0e6f=document[_0x77c6ab(0x10b)]('login-email')['value']['trim'](),_0x3f338e=document[_0x77c6ab(0x10b)]('login-password')['value'],_0x29edde=document['getElementById']('login-error');signInWithEmailAndPassword(auth,_0x3f0e6f,_0x3f338e)[_0x77c6ab(0x109)](_0x4b43c9=>{const _0x2d003f=_0x77c6ab;console['log']('User\x20signed\x20in:',_0x4b43c9[_0x2d003f(0x115)]),window[_0x2d003f(0x11d)]['href']='../index.html';})['catch'](_0xcd640c=>{const _0x146ac3=_0x77c6ab;console['error']('Login\x20error:',_0xcd640c),_0x29edde['textContent']='Login\x20error:\x20'+_0xcd640c['message'],_0x29edde[_0x146ac3(0xfd)]['display']='block';});}async function resendVerificationEmail(_0x14f28b){const _0x7a9325=a33_0xd323;console['log']('Attempting\x20to\x20resend\x20verification\x20email\x20to:',_0x14f28b);try{const _0x27e366=document[_0x7a9325(0x10b)](_0x7a9325(0x123))?.[_0x7a9325(0xf5)];if(!_0x27e366){console['error']('Password\x20not\x20available\x20for\x20resending\x20verification'),document[_0x7a9325(0x10b)]('login-error')['textContent']=_0x7a9325(0xeb);return;}const _0x1962bd=await signInWithEmailAndPassword(auth,_0x14f28b,_0x27e366),_0x33f59e=_0x1962bd[_0x7a9325(0x115)];console[_0x7a9325(0x11f)]('User\x20signed\x20in\x20for\x20verification\x20email:',_0x33f59e['uid']),await sendEmailVerification(_0x33f59e),console['log']('Verification\x20email\x20sent'),document['getElementById']('login-error')['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22success-message\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Verification\x20email\x20has\x20been\x20resent\x20to\x20'+_0x14f28b+_0x7a9325(0x106),await signOut(auth);}catch(_0x3407f3){console['error'](_0x7a9325(0x116),_0x3407f3),document[_0x7a9325(0x10b)]('login-error')['textContent']='Error\x20sending\x20verification\x20email:\x20'+_0x3407f3['message'];}}function a33_0xcae5(){const _0x3fa326=['trim','Please\x20enter\x20your\x20password\x20to\x20resend\x20verification\x20email','submit','verificationCheckInterval','bind','console','toString','href','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22success-message\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Registration\x20pending!\x20Please\x20check\x20your\x20email\x20to\x20verify\x20your\x20account.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<br><br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20onclick=\x22resendVerificationEmail(\x27','Window.resendVerificationEmail\x20called\x20with:','Checking\x20if\x20user\x20exists\x20in\x20any\x20collection...','value','length','playersDuos','\x20collection','click','Email\x20address\x20is\x20already\x20registered','all','preventDefault','style','register-container','Username\x20must\x20be\x20at\x20least\x203\x20characters\x20long','block','innerHTML','none','Found\x20pending\x20registration:','constructor','checked','.\x20Please\x20check\x20your\x20inbox.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>','resendVerificationEmail','Username\x20is\x20already\x20taken','then','register-form','getElementById','nonParticipants','uid','\x20added\x20to\x20','Error\x20checking\x20verification\x20status:','addEventListener','textContent','login-email','purple','email','user','Error\x20resending\x20verification\x20email:','display','username','playersD2','Email\x20not\x20yet\x20verified,\x20waiting...','\x20added\x20to\x20nonParticipants\x20collection','exception','location','register-username','log','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22success-message\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Email\x20verified\x20successfully!\x20You\x20can\x20now\x20log\x20in.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>','Login\x20attempt\x20started\x20for:','Checking\x20if\x20email\x20has\x20been\x20verified...','login-password','New\x20player\x20','error'];a33_0xcae5=function(){return _0x3fa326;};return a33_0xcae5();}window[a33_0x241fb6(0x107)]=function(_0x12879c){const _0x40d505=a33_0x241fb6;console['log'](_0x40d505(0xf3),_0x12879c),resendVerificationEmail(_0x12879c);},document['addEventListener']('DOMContentLoaded',()=>{const _0x12771d=a33_0x241fb6,_0x3c26dd=document['getElementById']('non-participant'),_0x45f01e=document[_0x12771d(0x10b)]('register-mode');_0x3c26dd&&_0x45f01e&&_0x3c26dd[_0x12771d(0x110)]('change',function(){this['checked']?(_0x45f01e['value']='',_0x45f01e['disabled']=!![]):_0x45f01e['disabled']=![];});const _0x169fcf=document['getElementById'](_0x12771d(0x10a)),_0x87b7e9=document['getElementById']('login-form');_0x169fcf&&_0x169fcf['addEventListener'](_0x12771d(0xec),handleRegister);_0x87b7e9&&_0x87b7e9[_0x12771d(0x110)]('submit',handleLogin);const _0x3ecb1d=document['getElementById']('show-register'),_0x4e0210=document['getElementById']('show-login');_0x3ecb1d&&_0x3ecb1d[_0x12771d(0x110)](_0x12771d(0xf9),_0x2f5391=>{const _0x46f495=_0x12771d;_0x2f5391['preventDefault'](),document['getElementById']('login-container')['style'][_0x46f495(0x117)]='none',document['getElementById'](_0x46f495(0xfe))['style'][_0x46f495(0x117)]='block';}),_0x4e0210&&_0x4e0210['addEventListener']('click',_0x40b435=>{const _0x11ef3d=_0x12771d;_0x40b435['preventDefault'](),document['getElementById']('register-container')['style']['display']=_0x11ef3d(0x102),document['getElementById']('login-container')['style']['display']='block';});});
const a42_0x505422=a42_0x983b,a42_0x3d73f3=(function(){let _0x3b23c3=!![];return function(_0x38040c,_0x31c802){const _0x1a75aa=_0x3b23c3?function(){if(_0x31c802){const _0x7e146e=_0x31c802['apply'](_0x38040c,arguments);return _0x31c802=null,_0x7e146e;}}:function(){};return _0x3b23c3=![],_0x1a75aa;};}()),a42_0xbd483c=a42_0x3d73f3(this,function(){const _0x3d33e6=a42_0x983b,_0x4d5033=function(){const _0x3d537f=a42_0x983b;let _0x3b668a;try{_0x3b668a=Function(_0x3d537f(0xe0)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0xb18e2a){_0x3b668a=window;}return _0x3b668a;},_0x5e2ffc=_0x4d5033(),_0x44064e=_0x5e2ffc['console']=_0x5e2ffc['console']||{},_0x462089=['log','warn','info','error',_0x3d33e6(0xde),_0x3d33e6(0xb8),'trace'];for(let _0x3fb066=0x0;_0x3fb066<_0x462089['length'];_0x3fb066++){const _0x42f4f0=a42_0x3d73f3['constructor']['prototype'][_0x3d33e6(0x97)](a42_0x3d73f3),_0x3b9734=_0x462089[_0x3fb066],_0x365546=_0x44064e[_0x3b9734]||_0x42f4f0;_0x42f4f0['__proto__']=a42_0x3d73f3['bind'](a42_0x3d73f3),_0x42f4f0['toString']=_0x365546['toString']['bind'](_0x365546),_0x44064e[_0x3b9734]=_0x42f4f0;}});a42_0xbd483c();function a42_0x57b6(){const _0x58219e=['display','ignore-btn','adminUser','Error\x20fetching\x20promotions:','promotionHistory','now','set','children','currentUser','some','visible','promotion','rankAchieved','displayName','offsetWidth','sendPromotionNotification','rank-change-ok-btn','date','bind','player','getRankName','Resolved\x20','slice','source','approvedMatches','textContent','Congratulations!','matchId','previousRank','Promotion\x20','removeChild','data-rank','test','error','stringify','username','includes','desc','data','#C0C0C0','style','addEventListener','userId','userDismissed','Discord\x20notification\x20sent\x20successfully\x20with\x20ID:\x20','classList','promotion_','&times;','data-id','string','new-rank-change','table','parse','DISPLAY_HOURS','\x20to\x20','email','toMillis','promotions_checked_','#50C878','timestamp','lastFetchTime','type','loserUsername','playerUsername','resolvedName','bannerContainer','ID:','promotion-details','RANKS','players','log','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rank-change-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2\x20class=\x22rank-change-title\x22>','none','isAutomatic','eloHistory','demotion','getElementById','processRankChanges','\x20(loser)','\x27s\x20','ladder','newRank','Unranked','Rank\x20Update','className','length','cleanup','button','resolveUserId','exception','beforeunload','return\x20(function()\x20','remove'];a42_0x57b6=function(){return _0x58219e;};return a42_0x57b6();}import{collection,doc,query,where,orderBy,limit,getDocs,addDoc,getDoc,serverTimestamp,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{auth,db}from'./firebase-config.js';class PromotionManager{constructor(){const _0x2b5d85=a42_0x983b;this[_0x2b5d85(0xba)]=0x18,this[_0x2b5d85(0xc9)]=[{'threshold':0x578,'name':'Bronze','color':'#CD7F32'},{'threshold':0x640,'name':'Silver','color':_0x2b5d85(0xac)},{'threshold':0x708,'name':'Gold','color':'#FFD700'},{'threshold':0x834,'name':'Emerald','color':_0x2b5d85(0xbf)}],this['bannerContainer']=null,this[_0x2b5d85(0xc1)]=0x0,this['fetchInterval']=0xea60,this['pollingInterval']=null,this['usernameCache']={};}['initialize'](){const _0x13fac2=a42_0x983b;this['bannerContainer']=document['getElementById']('promotion-banner-container');if(!this['bannerContainer']){console['error']('Promotion\x20banner\x20container\x20not\x20found');return;}this['setupBannerContainer']();const _0x240817=_0x13fac2(0xbe)+new Date()['toDateString'](),_0x157bb2=sessionStorage['getItem'](_0x240817);!_0x157bb2&&(this['fetchRecentPromotions'](),sessionStorage['setItem'](_0x240817,'true')),document['addEventListener']('visibilitychange',()=>{const _0xea1045=_0x13fac2;document['visibilityState']===_0xea1045(0x8f)&&!sessionStorage['getItem'](_0x240817)&&(this['fetchRecentPromotions'](),sessionStorage['setItem'](_0x240817,'true'));}),window[_0x13fac2(0xae)](_0x13fac2(0xdf),()=>{this['pollingInterval']&&clearInterval(this['pollingInterval']);});}['setupBannerContainer'](){const _0x488aa7=a42_0x983b;this['bannerContainer']['innerHTML']='',this[_0x488aa7(0xc6)][_0x488aa7(0xad)]['display']='none';}async['fetchRecentPromotions'](){const _0x20ff30=a42_0x983b;try{const _0x1b086f=Date[_0x20ff30(0x8a)]();if(_0x1b086f-this['lastFetchTime']<this['fetchInterval'])return;this['lastFetchTime']=_0x1b086f;const _0x379407=collection(db,_0x20ff30(0xcf)),_0x1a24d2=query(_0x379407,where('type','in',[_0x20ff30(0x90),_0x20ff30(0xd0)]),orderBy('timestamp','desc'),limit(0x14)),_0x3ae148=await getDocs(_0x1a24d2),_0x40cd94=[];_0x3ae148['forEach'](_0x38aef0=>{const _0x388784={'id':_0x38aef0['id'],..._0x38aef0['data']()};this['shouldShowPromotion'](_0x38aef0['id'])&&this['isNewRankChange'](_0x388784)&&_0x40cd94['push'](_0x388784);}),_0x40cd94[_0x20ff30(0xda)]>0x0&&await this['processRankChanges'](_0x40cd94);}catch(_0x367cb3){console['error'](_0x20ff30(0x88),_0x367cb3);}}async[a42_0x505422(0xd2)](_0x40c8dc){const _0x3192a6=a42_0x505422;if(_0x40c8dc['length']===0x0)return;_0x40c8dc['sort']((_0x359191,_0x5d7569)=>{const _0x4bc80d=a42_0x983b,_0xba82e3=_0x359191['timestamp']?.['toMillis']?.()||_0x359191['timestamp']?.['seconds']*0x3e8||0x0,_0x2a7314=_0x5d7569['timestamp']?.[_0x4bc80d(0xbd)]?.()||_0x5d7569[_0x4bc80d(0xc0)]?.['seconds']*0x3e8||0x0;return _0x2a7314-_0xba82e3;});const _0x680c23=this['bannerContainer'][_0x3192a6(0x8c)][_0x3192a6(0xda)],_0x1871ac=0x3-_0x680c23;if(_0x1871ac<=0x0)return;const _0x1ab19d=_0x40c8dc[_0x3192a6(0x9b)](0x0,_0x1871ac);for(let _0x2f235f=0x0;_0x2f235f<_0x1ab19d[_0x3192a6(0xda)];_0x2f235f++){const _0x4e414e=_0x1ab19d[_0x2f235f],_0x1920c5=auth['currentUser'];try{setTimeout(()=>{this['showRankChangeBanner'](_0x4e414e);},_0x2f235f*0x3e8),_0x1920c5&&_0x4e414e['player']===_0x1920c5[_0x3192a6(0x92)]&&this['showRankChangeLightbox'](_0x4e414e['type'],_0x4e414e['rankAchieved']);}catch(_0x4c4be1){console[_0x3192a6(0xa6)]('Error\x20processing\x20rank\x20change:',_0x4c4be1);}}}['shouldShowPromotion'](_0x4451b5){const _0x2e5d58=a42_0x505422;try{const _0x6e0b8=_0x2e5d58(0xb3)+_0x4451b5,_0x4bb6e4=localStorage['getItem'](_0x6e0b8);if(_0x4bb6e4){let _0x1109c1;try{_0x1109c1=JSON[_0x2e5d58(0xb9)](_0x4bb6e4);}catch(_0x2217a5){return console['warn']('Invalid\x20storage\x20format\x20for\x20'+_0x6e0b8+',\x20treating\x20as\x20new'),!![];}if(_0x1109c1['ignored']===!![])return console['log'](_0x2e5d58(0xa2)+_0x4451b5+'\x20is\x20permanently\x20ignored'),![];const _0x364280=Date['now']();if(_0x1109c1[_0x2e5d58(0xb0)]&&_0x364280-_0x1109c1['timestamp']<this['DISPLAY_HOURS']*0x3c*0x3c*0x3e8)return console['log']('Promotion\x20'+_0x4451b5+'\x20was\x20dismissed\x20by\x20user\x20within\x20last\x20'+this['DISPLAY_HOURS']+'\x20hours'),![];if(_0x1109c1['systemDismissed']&&_0x364280-_0x1109c1[_0x2e5d58(0xc0)]<0x4*0x3c*0x3c*0x3e8)return console['log']('Promotion\x20'+_0x4451b5+'\x20was\x20auto-dismissed\x20within\x20last\x204\x20hours'),![];}return!![];}catch(_0x296cc7){return console[_0x2e5d58(0xa6)]('Error\x20checking\x20promotion\x20visibility:',_0x296cc7),![];}}['ignorePromotion'](_0x303909){try{const _0x43794c='promotion_'+_0x303909;localStorage['setItem'](_0x43794c,JSON['stringify']({'timestamp':Date['now'](),'ignored':!![]}));}catch(_0x3eaa88){console['error']('Error\x20saving\x20promotion\x20preference:',_0x3eaa88);}}['showRankChangeBanner'](_0x32e414){const _0x1bdddb=a42_0x505422;this[_0x1bdddb(0xdd)](_0x32e414)['then'](_0x23982b=>{const _0x4adddc=_0x1bdddb,_0x51de02='promotion_'+_0x32e414['id'],_0x1e55ba=localStorage['getItem'](_0x51de02);if(_0x1e55ba)try{const _0x446dc9=JSON['parse'](_0x1e55ba);if(_0x446dc9['ignored']===!![]){console['log']('Skipping\x20ignored\x20promotion:\x20'+_0x32e414['id']);return;}}catch(_0x413108){}localStorage['setItem'](_0x51de02,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':![],'seenAt':Date['now']()})),this['bannerContainer']['style']['display']='block';while(this['bannerContainer']['children']['length']>=0x3){this['bannerContainer'][_0x4adddc(0xa3)](this[_0x4adddc(0xc6)]['firstChild']);}const _0x30c4cc=document['createElement']('div');_0x30c4cc['className']='promotion-banner',_0x30c4cc['setAttribute'](_0x4adddc(0xa4),_0x23982b['rankAchieved']),_0x30c4cc['setAttribute'](_0x4adddc(0xb5),_0x23982b['id']);const _0x1a2fa9=document['createElement']('div');_0x1a2fa9[_0x4adddc(0xd9)]=_0x4adddc(0xc8);const _0x4178a8=_0x23982b['resolvedName']||_0x23982b['player']||_0x23982b['username']||_0x23982b['playerUsername']||_0x23982b['displayName']||'A\x20player',_0x56b6dd=_0x23982b[_0x4adddc(0xc2)]===_0x4adddc(0x90)?_0x4178a8+'\x20was\x20promoted\x20to':_0x4178a8+'\x20was\x20demoted\x20to';_0x1a2fa9['innerHTML']=_0x56b6dd+'\x20<span\x20class=\x22rank-text\x22>'+_0x23982b[_0x4adddc(0x91)]+'</span>';const _0x18ae09=document['createElement']('div');_0x18ae09['className']='banner-actions';const _0x16c365=document['createElement'](_0x4adddc(0xdc));_0x16c365['className']='dismiss-btn',_0x16c365['innerHTML']=_0x4adddc(0xb4),_0x16c365['title']='Dismiss';const _0x1ebfe5=document['createElement'](_0x4adddc(0xdc));_0x1ebfe5['className']=_0x4adddc(0x86),_0x1ebfe5[_0x4adddc(0x9e)]='Don\x27t\x20show\x20again',_0x1ebfe5['title']='Never\x20show\x20this\x20promotion\x20again',_0x18ae09['appendChild'](_0x1ebfe5),_0x18ae09['appendChild'](_0x16c365),_0x30c4cc['appendChild'](_0x1a2fa9),_0x30c4cc['appendChild'](_0x18ae09),this['bannerContainer']['appendChild'](_0x30c4cc),void _0x30c4cc[_0x4adddc(0x93)],setTimeout(()=>{const _0x1ce2b3=_0x4adddc;_0x30c4cc['classList']['add'](_0x1ce2b3(0xb7));},0x32),_0x16c365[_0x4adddc(0xae)]('click',()=>{const _0x33b074=_0x4adddc;localStorage['setItem'](_0x51de02,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':!![],'systemDismissed':![]})),_0x30c4cc['classList'][_0x33b074(0xe1)]('new-rank-change'),_0x30c4cc[_0x33b074(0xb2)]['add']('dismissing'),setTimeout(()=>{const _0x128185=_0x33b074;_0x30c4cc['parentNode']&&(_0x30c4cc['remove'](),this['bannerContainer']['children']['length']===0x0&&(this['bannerContainer'][_0x128185(0xad)]['display']='none'));},0x1f4);}),_0x1ebfe5['addEventListener']('click',()=>{const _0x19b402=_0x4adddc;localStorage['setItem'](_0x51de02,JSON[_0x19b402(0xa7)]({'timestamp':Date['now'](),'ignored':!![],'userDismissed':!![],'systemDismissed':![]})),_0x30c4cc[_0x19b402(0xb2)]['remove']('new-rank-change'),_0x30c4cc[_0x19b402(0xb2)]['add']('dismissing'),setTimeout(()=>{const _0x1afde3=_0x19b402;_0x30c4cc['parentNode']&&(_0x30c4cc['remove'](),this['bannerContainer']['children'][_0x1afde3(0xda)]===0x0&&(this['bannerContainer']['style'][_0x1afde3(0x85)]='none'));},0x1f4);}),setTimeout(()=>{const _0x1e7b80=_0x4adddc;_0x30c4cc['parentNode']&&(_0x30c4cc[_0x1e7b80(0xb2)]['remove']('new-rank-change'),_0x30c4cc['classList']['add']('dismissing'),localStorage['setItem'](_0x51de02,JSON[_0x1e7b80(0xa7)]({'timestamp':Date[_0x1e7b80(0x8a)](),'ignored':![],'userDismissed':![],'systemDismissed':!![]})),setTimeout(()=>{const _0x56ecb6=_0x1e7b80;_0x30c4cc['parentNode']&&(_0x30c4cc['remove'](),this['bannerContainer']['children']['length']===0x0&&(this['bannerContainer']['style'][_0x56ecb6(0x85)]=_0x56ecb6(0xcd)));},0x1f4));},0x3a98);});}async['resolveUserId'](_0x74c845){const _0x4d81f6=a42_0x505422,_0x22a2c6={..._0x74c845},_0x448d35=[_0x74c845[_0x4d81f6(0x98)],_0x74c845['username'],_0x74c845[_0x4d81f6(0xc4)],_0x74c845[_0x4d81f6(0x92)]],_0x13c3bc=_0x448d35[_0x4d81f6(0x8e)](_0x59cc9e=>_0x59cc9e&&typeof _0x59cc9e===_0x4d81f6(0xb6)&&!_0x59cc9e[_0x4d81f6(0xa9)](_0x4d81f6(0xc7))&&!/^[a-zA-Z0-9]{20,}$/[_0x4d81f6(0xa5)](_0x59cc9e));if(_0x13c3bc)return _0x22a2c6;let _0x5e239f=null;if(_0x74c845[_0x4d81f6(0xaf)])_0x5e239f=_0x74c845[_0x4d81f6(0xaf)];else _0x74c845['player']&&/^[A-Za-z0-9]{20,}$/['test'](_0x74c845[_0x4d81f6(0x98)])&&(_0x5e239f=_0x74c845['player']);if(!_0x5e239f)return _0x22a2c6;try{const _0x3f6062=await getDoc(doc(db,_0x4d81f6(0xca),_0x5e239f));if(_0x3f6062['exists']()){const _0x52e27c=_0x3f6062['data']();if(_0x52e27c['username'])return _0x22a2c6[_0x4d81f6(0xc5)]=_0x52e27c['username'],_0x22a2c6;}const _0x1cc2a2=await getDocs(query(collection(db,'approvedMatches'),where('winnerId','==',_0x5e239f),orderBy(_0x4d81f6(0x96),'desc'),limit(0x1)));if(!_0x1cc2a2['empty']){const _0x368c57=_0x1cc2a2['docs'][0x0]['data']();if(_0x368c57['winnerUsername'])return _0x22a2c6['resolvedName']=_0x368c57['winnerUsername'],_0x22a2c6;}const _0x4364d5=await getDocs(query(collection(db,'approvedMatches'),where('loserId','==',_0x5e239f),orderBy(_0x4d81f6(0x96),_0x4d81f6(0xaa)),limit(0x1)));if(!_0x4364d5['empty']){const _0x14cada=_0x4364d5['docs'][0x0][_0x4d81f6(0xab)]();if(_0x14cada[_0x4d81f6(0xc3)])return _0x22a2c6['resolvedName']=_0x14cada['loserUsername'],console[_0x4d81f6(0xcb)](_0x4d81f6(0x9a)+_0x5e239f+_0x4d81f6(0xbb)+_0x14cada['loserUsername']+_0x4d81f6(0xd3)),_0x22a2c6;}}catch(_0x56433f){console[_0x4d81f6(0xa6)]('Error\x20resolving\x20user\x20ID:',_0x56433f);}return console['warn']('Failed\x20to\x20resolve\x20user\x20ID:\x20'+_0x5e239f),_0x22a2c6;}['showRankChangeLightbox'](_0x422ae8,_0x1df3de){const _0x22865b=a42_0x505422;let _0x41b011=document['getElementById']('rankChangeModal');!_0x41b011&&(_0x41b011=document['createElement']('div'),_0x41b011['id']='rankChangeModal',_0x41b011['className']='rank-change-modal\x20'+_0x422ae8,document['body']['appendChild'](_0x41b011));const _0x55fc9c=_0x422ae8==='promotion'?_0x22865b(0x9f):_0x22865b(0xd8),_0x5b95fb=_0x422ae8==='promotion'?'You\x27ve\x20been\x20promoted\x20to':'You\x27ve\x20been\x20demoted\x20to';_0x41b011['innerHTML']=_0x22865b(0xcc)+_0x55fc9c+'</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>'+_0x5b95fb+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22rank-name\x22>'+_0x1df3de+'</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22rank-change-button\x22\x20id=\x22rank-change-ok-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Got\x20it!\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x41b011['style']['display']='flex',document[_0x22865b(0xd1)](_0x22865b(0x95))[_0x22865b(0xae)]('click',()=>{const _0x478c5b=_0x22865b;_0x41b011['style'][_0x478c5b(0x85)]=_0x478c5b(0xcd);}),_0x41b011[_0x22865b(0xae)]('click',_0x362a54=>{const _0x1030be=_0x22865b;_0x362a54['target']===_0x41b011&&(_0x41b011[_0x1030be(0xad)][_0x1030be(0x85)]='none');});}async['checkAndRecordPromotion'](_0x57a27f,_0x379fac,_0x467f69,_0x68c756={}){const _0x77e887=a42_0x505422;try{if(_0x379fac===_0x467f69||!_0x57a27f)return null;const _0x30bc5c=_0x68c756[_0x77e887(0x9c)]||'automatic',_0x5b0941=_0x68c756['matchId']||null,_0xda87fd=_0x68c756['adminUser']||null;console[_0x77e887(0xcb)]('Processing\x20potential\x20rank\x20change:\x20'+_0x467f69+'\x20→\x20'+_0x379fac+'\x20(source:\x20'+_0x30bc5c+')');let _0x9fc0a4=null,_0x186a9c=null;try{const _0x13bb2f=await getDoc(doc(db,'players',_0x57a27f));if(_0x13bb2f['exists']()){const _0x108f97=_0x13bb2f['data']();_0x9fc0a4=_0x108f97['username']||_0x108f97['displayName']||null,_0x186a9c=_0x108f97[_0x77e887(0x92)]||_0x108f97['username']||null;}!_0x9fc0a4&&_0x68c756[_0x77e887(0xa8)]&&(_0x9fc0a4=_0x68c756['username'],_0x186a9c=_0x68c756[_0x77e887(0xa8)]);!_0x9fc0a4&&auth['currentUser']&&(_0x9fc0a4=auth['currentUser']['displayName']||auth['currentUser'][_0x77e887(0xbc)]['split']('@')[0x0],_0x186a9c=auth[_0x77e887(0x8d)]['displayName']||null);if(!_0x9fc0a4){const _0x1ecf98=query(collection(db,_0x77e887(0x9d)),where('winnerId','==',_0x57a27f),limit(0x1)),_0x272293=await getDocs(_0x1ecf98);if(!_0x272293['empty'])_0x9fc0a4=_0x272293['docs'][0x0]['data']()['winnerUsername']||'Unknown\x20Player',_0x186a9c=_0x9fc0a4;else{const _0x181da0=query(collection(db,'approvedMatches'),where('loserId','==',_0x57a27f),limit(0x1)),_0x34a9d1=await getDocs(_0x181da0);!_0x34a9d1['empty']&&(_0x9fc0a4=_0x34a9d1[0x0]['data']()['loserUsername']||'Unknown\x20Player',_0x186a9c=_0x9fc0a4);}}}catch(_0x1ead98){console['error']('Error\x20resolving\x20username:',_0x1ead98);}!_0x9fc0a4&&(console['warn']('Could\x20not\x20resolve\x20username\x20for\x20userId:',_0x57a27f),_0x9fc0a4='A\x20player',_0x186a9c='Unknown\x20Player');const _0x3c6185=this[_0x77e887(0x99)](_0x467f69),_0x65504=this['getRankName'](_0x379fac);if(_0x3c6185!==_0x65504){const _0x520728=_0x379fac>_0x467f69,_0x3572be=_0x520728?'promotion':'demotion',_0x21aca6=_0x65504;console['log']('Recording\x20'+_0x3572be+'\x20for\x20'+_0x9fc0a4+':\x20'+_0x467f69+'\x20('+_0x3c6185+')\x20→\x20'+_0x379fac+'\x20('+_0x65504+')');try{const _0x10f8c7={'player':_0x9fc0a4,'playerUsername':_0x9fc0a4,'username':_0x9fc0a4,'displayName':_0x186a9c,'userId':_0x57a27f,'type':_0x3572be,'rankAchieved':_0x21aca6,'timestamp':serverTimestamp(),'previousElo':_0x467f69,'newElo':_0x379fac,'change':_0x379fac-_0x467f69,'previousRank':_0x3c6185,'newRank':_0x65504,'source':_0x30bc5c};if(_0x30bc5c==='match'&&_0x5b0941)_0x10f8c7['matchId']=_0x5b0941;else _0x30bc5c==='admin'&&_0xda87fd?(_0x10f8c7['modifiedBy']=_0xda87fd,_0x10f8c7[_0x77e887(0xce)]=![]):_0x10f8c7['isAutomatic']=!![];const _0x1d4957=writeBatch(db),_0x4eeed6=doc(collection(db,'eloHistory')),_0x3bd4d2=doc(collection(db,_0x77e887(0x89)));return _0x1d4957['set'](_0x4eeed6,_0x10f8c7),_0x1d4957[_0x77e887(0x8b)](_0x3bd4d2,_0x10f8c7),await _0x1d4957['commit'](),await this[_0x77e887(0x94)](_0x57a27f,_0x9fc0a4,_0x467f69,_0x379fac,_0x3c6185,_0x65504,_0x3572be,{'displayName':_0x186a9c,'source':_0x30bc5c,'matchId':_0x5b0941,'ladder':_0x68c756['ladder']||'D1'}),console['log']('Successfully\x20recorded\x20'+_0x3572be+'\x20for\x20'+_0x9fc0a4+'\x20to\x20'+_0x21aca6),_0x21aca6;}catch(_0x4c2ad9){console['error']('Error\x20writing\x20promotion\x20records:',_0x4c2ad9);try{return await addDoc(collection(db,'eloHistory'),{'player':_0x9fc0a4,'playerUsername':_0x9fc0a4,'username':_0x9fc0a4,'displayName':_0x186a9c,'userId':_0x57a27f,'type':_0x3572be,'rankAchieved':_0x21aca6,'timestamp':serverTimestamp(),'previousElo':_0x467f69,'newElo':_0x379fac,'change':_0x379fac-_0x467f69,'previousRank':_0x3c6185,'source':_0x30bc5c,'isAutomatic':_0x30bc5c!=='admin'}),await this['sendPromotionNotification'](_0x57a27f,_0x9fc0a4,_0x467f69,_0x379fac,_0x3c6185,_0x65504,_0x3572be,{'displayName':_0x186a9c,'source':_0x30bc5c,'matchId':_0x5b0941,'ladder':_0x68c756['ladder']||'D1'}),_0x21aca6;}catch(_0x2fc731){return console['error']('Fallback\x20write\x20failed:',_0x2fc731),null;}}}return null;}catch(_0x1bb282){return console[_0x77e887(0xa6)]('Error\x20in\x20promotion/demotion\x20recording:',_0x1bb282),null;}}['getRankName'](_0x159344){const _0x569950=a42_0x505422;for(let _0x1b914c=this['RANKS']['length']-0x1;_0x1b914c>=0x0;_0x1b914c--){if(_0x159344>=this['RANKS'][_0x1b914c]['threshold'])return this['RANKS'][_0x1b914c]['name'];}return _0x569950(0xd7);}[a42_0x505422(0xdb)](){this['pollingInterval']&&clearInterval(this['pollingInterval']);}['isNewRankChange'](_0x246cc1){const _0x53ed71=a42_0x505422;if(_0x246cc1['timestamp']){const _0x50ea55=_0x246cc1[_0x53ed71(0xc0)]['seconds']*0x3e8,_0x1af8d3=Date['now'](),_0x1d0de8=(_0x1af8d3-_0x50ea55)/(0x3e8*0x3c*0x3c);if(_0x1d0de8>0x18)return![];}if(_0x246cc1['previousRank']&&_0x246cc1[_0x53ed71(0xd6)]&&_0x246cc1[_0x53ed71(0xa1)]!==_0x246cc1['newRank'])return!![];return![];}async['sendPromotionNotification'](_0x58cea2,_0x11a0cc,_0x1ef1cd,_0x2b9575,_0x2c0205,_0x2d97a5,_0x407fd5,_0x2aee5d={}){const _0x4e336b=a42_0x505422;try{console['log']('STARTING\x20notification\x20for\x20'+_0x11a0cc+_0x4e336b(0xd4)+_0x407fd5);const _0x258fb0={'userId':_0x58cea2,'username':_0x11a0cc,'displayName':_0x2aee5d[_0x4e336b(0x92)]||_0x11a0cc,'oldElo':parseInt(_0x1ef1cd),'newElo':parseInt(_0x2b9575),'eloDifference':parseInt(_0x2b9575)-parseInt(_0x1ef1cd),'oldRank':_0x2c0205,'newRank':_0x2d97a5,'type':_0x407fd5,'timestamp':serverTimestamp(),'processed':![],'source':_0x2aee5d['source']||'automatic','matchId':_0x2aee5d[_0x4e336b(0xa0)]||null,'ladder':_0x2aee5d[_0x4e336b(0xd5)]||'D1','adminUser':_0x2aee5d[_0x4e336b(0x87)]||null};console['log']('Creating\x20Discord\x20notification:',_0x258fb0);const _0x130d16=await addDoc(collection(db,'promotionNotifications'),_0x258fb0);return console['log'](_0x4e336b(0xb1)+_0x130d16['id']),!![];}catch(_0x378dc8){return console['error']('Error\x20sending\x20Discord\x20notification:',_0x378dc8),![];}}}function a42_0x983b(_0x28b306,_0x235ad2){const _0xbd483c=a42_0x57b6();return a42_0x983b=function(_0x3d73f3,_0x4ac676){_0x3d73f3=_0x3d73f3-0x85;let _0x57b632=_0xbd483c[_0x3d73f3];return _0x57b632;},a42_0x983b(_0x28b306,_0x235ad2);}export const promotionManager=new PromotionManager();document[a42_0x505422(0xae)]('DOMContentLoaded',()=>{promotionManager['initialize']();});export const initializePromotionTracker=()=>promotionManager['initialize']();export const checkAndRecordPromotion=(_0x5b1efc,_0x5d422f,_0x38e599,_0x4829bf)=>promotionManager['checkAndRecordPromotion'](_0x5b1efc,_0x5d422f,_0x38e599,_0x4829bf);export const getRankName=_0x191b7b=>promotionManager[a42_0x505422(0x99)](_0x191b7b);
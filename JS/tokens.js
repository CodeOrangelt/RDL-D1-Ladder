const a58_0x1ea4f5=(function(){let _0x473234=!![];return function(_0x5ba041,_0xa28ff7){const _0x369e03=_0x473234?function(){if(_0xa28ff7){const _0x1f80af=_0xa28ff7['apply'](_0x5ba041,arguments);return _0xa28ff7=null,_0x1f80af;}}:function(){};return _0x473234=![],_0x369e03;};}()),a58_0x392c6c=a58_0x1ea4f5(this,function(){const _0x2f9c23=a58_0x3dae,_0x5210d7=function(){let _0x20555b;try{_0x20555b=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x2a6b86){_0x20555b=window;}return _0x20555b;},_0xc786a6=_0x5210d7(),_0x3ab6a2=_0xc786a6[_0x2f9c23(0x123)]=_0xc786a6[_0x2f9c23(0x123)]||{},_0x51ee95=[_0x2f9c23(0x129),'warn',_0x2f9c23(0x122),'error','exception','table','trace'];for(let _0x33b76e=0x0;_0x33b76e<_0x51ee95['length'];_0x33b76e++){const _0x4120dd=a58_0x1ea4f5['constructor'][_0x2f9c23(0x11d)]['bind'](a58_0x1ea4f5),_0x355561=_0x51ee95[_0x33b76e],_0x3f943d=_0x3ab6a2[_0x355561]||_0x4120dd;_0x4120dd[_0x2f9c23(0x128)]=a58_0x1ea4f5[_0x2f9c23(0x126)](a58_0x1ea4f5),_0x4120dd[_0x2f9c23(0x12e)]=_0x3f943d['toString']['bind'](_0x3f943d),_0x3ab6a2[_0x355561]=_0x4120dd;}});function a58_0x3dae(_0x3e1f9,_0x453b32){const _0x392c6c=a58_0x52ae();return a58_0x3dae=function(_0x1ea4f5,_0x4c0ac0){_0x1ea4f5=_0x1ea4f5-0x11a;let _0x52aee2=_0x392c6c[_0x1ea4f5];return _0x52aee2;},a58_0x3dae(_0x3e1f9,_0x453b32);}a58_0x392c6c();function a58_0x52ae(){const _0x3217a5=['string','forEach','error','prototype','tokens_','Error\x20fetching\x20user\x20tokens:','set','push','info','console','getTime','purchasedAt','bind','exists','__proto__','log','userProfiles','clear','seconds','from','toString','username'];a58_0x52ae=function(){return _0x3217a5;};return a58_0x52ae();}import{doc,getDoc,getDocs,collection}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const tokenCache=new Map(),CACHE_DURATION=0x5*0x3c*0x3e8;export async function getUserTokens(_0x125aef){const _0x2a03ae=a58_0x3dae,_0x3cc9cc='tokens_'+_0x125aef,_0x420513=tokenCache['get'](_0x3cc9cc);if(_0x420513&&Date['now']()-_0x420513['timestamp']<CACHE_DURATION)return _0x420513['tokens'];try{const _0x2e7169=doc(db,'userTokens',_0x125aef),_0x29474b=await getDoc(_0x2e7169);let _0x118933=[];return _0x29474b[_0x2a03ae(0x127)]()&&(_0x118933=_0x29474b['data']()['tokens']||[]),tokenCache[_0x2a03ae(0x120)](_0x3cc9cc,{'tokens':_0x118933,'timestamp':Date['now']()}),_0x118933;}catch(_0x458e99){return console['error'](_0x2a03ae(0x11f),_0x458e99),[];}}export async function getBulkUserTokens(_0x4f1c3e){const _0x8699bd=new Map(),_0x73d6d5=[];_0x4f1c3e['forEach'](_0x39ebb2=>{const _0x991287=a58_0x3dae,_0x2890b2='tokens_'+_0x39ebb2,_0x1e78bf=tokenCache['get'](_0x2890b2);_0x1e78bf&&Date['now']()-_0x1e78bf['timestamp']<CACHE_DURATION?_0x8699bd['set'](_0x39ebb2,_0x1e78bf['tokens']):_0x73d6d5[_0x991287(0x121)](_0x39ebb2);});if(_0x73d6d5['length']>0x0)try{const _0x18139b=_0x73d6d5['map'](async _0x5c664c=>{const _0x23b89f=a58_0x3dae,_0x722ce1=doc(db,'userTokens',_0x5c664c),_0x3b6c00=await getDoc(_0x722ce1);let _0x4560fc=[];_0x3b6c00['exists']()&&(_0x4560fc=_0x3b6c00['data']()['tokens']||[]);const _0x3a0c10='tokens_'+_0x5c664c;return tokenCache[_0x23b89f(0x120)](_0x3a0c10,{'tokens':_0x4560fc,'timestamp':Date['now']()}),[_0x5c664c,_0x4560fc];}),_0xde8ae3=await Promise['all'](_0x18139b);_0xde8ae3['forEach'](([_0x1e8813,_0x15fa43])=>{const _0x25839f=a58_0x3dae;_0x8699bd[_0x25839f(0x120)](_0x1e8813,_0x15fa43);});}catch(_0x506fed){console['error']('Error\x20fetching\x20bulk\x20user\x20tokens:',_0x506fed);}return _0x8699bd;}export async function getTokensByUsernames(_0x54c037){const _0x2e8c19=a58_0x3dae,_0x628081=new Map();try{const _0x33b63b=collection(db,_0x2e8c19(0x12a)),_0x530c87=await getDocs(_0x33b63b),_0x5d01b2=new Map();_0x530c87['forEach'](_0xc8418e=>{const _0x1197a9=_0x2e8c19,_0x2ef23e=_0xc8418e['data']();_0x2ef23e['username']&&_0x54c037['includes'](_0x2ef23e[_0x1197a9(0x12f)])&&_0x5d01b2['set'](_0x2ef23e[_0x1197a9(0x12f)],_0xc8418e['id']);});const _0x30976b=Array[_0x2e8c19(0x12d)](_0x5d01b2['values']());if(_0x30976b['length']>0x0){const _0x283ec9=await getBulkUserTokens(_0x30976b);_0x5d01b2[_0x2e8c19(0x11b)]((_0xb80388,_0x14e78b)=>{const _0x5bc532=_0x283ec9['get'](_0xb80388)||[];_0x628081['set'](_0x14e78b,_0x5bc532);});}}catch(_0x3c9960){console[_0x2e8c19(0x11c)]('Error\x20fetching\x20tokens\x20by\x20usernames:',_0x3c9960);}return _0x628081;}export function clearTokenCache(_0x3b5469=null){const _0x4521d1=a58_0x3dae;if(_0x3b5469){const _0x1b566f=_0x4521d1(0x11e)+_0x3b5469;tokenCache['delete'](_0x1b566f),console[_0x4521d1(0x129)]('🗑️\x20Cleared\x20token\x20cache\x20for\x20user:\x20'+_0x3b5469);}else tokenCache[_0x4521d1(0x12b)](),console['log']('🗑️\x20Cleared\x20all\x20token\x20cache');}export async function forceRefreshUserTokens(_0xc1ecac){return clearTokenCache(_0xc1ecac),await getUserTokens(_0xc1ecac);}export function getPrimaryDisplayToken(_0x13c6a3){if(!_0x13c6a3||_0x13c6a3['length']===0x0)return null;const _0x242aec=_0x13c6a3['find'](_0x155ae2=>_0x155ae2['equipped']===!![]);if(_0x242aec)return _0x242aec;const _0x1c419b=[..._0x13c6a3]['sort']((_0xfdb665,_0x3f90b5)=>{const _0x57ac6b=a58_0x3dae;let _0x9dca8e,_0x3cdac9;if(_0xfdb665['purchasedAt']){if(_0xfdb665[_0x57ac6b(0x125)]['seconds'])_0x9dca8e=_0xfdb665[_0x57ac6b(0x125)]['seconds'];else{if(_0xfdb665['purchasedAt']instanceof Date)_0x9dca8e=_0xfdb665['purchasedAt'][_0x57ac6b(0x124)]()/0x3e8;else typeof _0xfdb665['purchasedAt']==='string'?_0x9dca8e=new Date(_0xfdb665[_0x57ac6b(0x125)])[_0x57ac6b(0x124)]()/0x3e8:_0x9dca8e=0x0;}}else _0x9dca8e=0x0;if(_0x3f90b5['purchasedAt']){if(_0x3f90b5[_0x57ac6b(0x125)][_0x57ac6b(0x12c)])_0x3cdac9=_0x3f90b5[_0x57ac6b(0x125)]['seconds'];else{if(_0x3f90b5['purchasedAt']instanceof Date)_0x3cdac9=_0x3f90b5[_0x57ac6b(0x125)]['getTime']()/0x3e8;else typeof _0x3f90b5['purchasedAt']===_0x57ac6b(0x11a)?_0x3cdac9=new Date(_0x3f90b5['purchasedAt'])[_0x57ac6b(0x124)]()/0x3e8:_0x3cdac9=0x0;}}else _0x3cdac9=0x0;return _0x3cdac9-_0x9dca8e;});return _0x1c419b[0x0];}
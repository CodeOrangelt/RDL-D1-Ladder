function a12_0xf9d2(_0x3e7c18,_0x2114dd){const _0x26bc25=a12_0xc13a();return a12_0xf9d2=function(_0x59623c,_0xa44bed){_0x59623c=_0x59623c-0x12f;let _0xc13aa3=_0x26bc25[_0x59623c];return _0xc13aa3;},a12_0xf9d2(_0x3e7c18,_0x2114dd);}const a12_0x115b1c=a12_0xf9d2,a12_0x59623c=(function(){let _0x34b195=!![];return function(_0x94ae98,_0x2b14ec){const _0x2a258a=_0x34b195?function(){if(_0x2b14ec){const _0x2e8442=_0x2b14ec['apply'](_0x94ae98,arguments);return _0x2b14ec=null,_0x2e8442;}}:function(){};return _0x34b195=![],_0x2a258a;};}()),a12_0x26bc25=a12_0x59623c(this,function(){const _0x5e3fe6=a12_0xf9d2;let _0x5293f0;try{const _0x3b6baf=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x5293f0=_0x3b6baf();}catch(_0x1078e9){_0x5293f0=window;}const _0x764027=_0x5293f0[_0x5e3fe6(0x13b)]=_0x5293f0[_0x5e3fe6(0x13b)]||{},_0x36c1f8=['log',_0x5e3fe6(0x133),'info','error',_0x5e3fe6(0x131),_0x5e3fe6(0x142),'trace'];for(let _0x17c8e6=0x0;_0x17c8e6<_0x36c1f8[_0x5e3fe6(0x143)];_0x17c8e6++){const _0xb0d05f=a12_0x59623c['constructor']['prototype']['bind'](a12_0x59623c),_0x1da6ea=_0x36c1f8[_0x17c8e6],_0x3db6ae=_0x764027[_0x1da6ea]||_0xb0d05f;_0xb0d05f[_0x5e3fe6(0x13f)]=a12_0x59623c['bind'](a12_0x59623c),_0xb0d05f['toString']=_0x3db6ae[_0x5e3fe6(0x141)]['bind'](_0x3db6ae),_0x764027[_0x1da6ea]=_0xb0d05f;}});a12_0x26bc25();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D2=[{'name':a12_0x115b1c(0x13c),'elo':0x708},{'name':a12_0x115b1c(0x136),'elo':0x640},{'name':a12_0x115b1c(0x137),'elo':0x578},{'name':'Unranked','elo':0x4b0}];let lastVisibleD2=null;async function getUsernameByIdD2(_0x46686f){const _0x558dad=a12_0x115b1c;try{if(!_0x46686f)return'Unknown\x20Player';const _0x380b1f=await getDoc(doc(db,_0x558dad(0x132),_0x46686f));if(_0x380b1f['exists']())return _0x380b1f[_0x558dad(0x138)]()['username']||'Unknown\x20Player';const _0x4c1470=await getDocs(query(collection(db,'approvedMatchesD2'),where('winnerId','==',_0x46686f),limit(0x1)));if(!_0x4c1470['empty'])return _0x4c1470['docs'][0x0][_0x558dad(0x138)]()['winnerUsername']||'Unknown\x20Player';const _0x26d519=await getDocs(query(collection(db,'approvedMatchesD2'),where(_0x558dad(0x135),'==',_0x46686f),limit(0x1)));if(!_0x26d519['empty'])return _0x26d519['docs'][0x0]['data']()['loserUsername']||'Unknown\x20Player';return'Unknown\x20Player';}catch(_0x1769b2){return console['error'](_0x558dad(0x144),_0x1769b2),_0x558dad(0x13e);}}export async function recordEloChangeD2({playerId:_0x131b63,previousElo:_0x4906c9,newElo:_0x5b799d,opponentId:_0x223338,matchResult:_0x3fdeb4,previousPosition:_0x35b602,newPosition:_0x58876a,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x3b373f,timestamp:_0x3d7272}){try{const _0x34f159=doc(collection(db,'eloHistoryD2'));let _0x25feb7='match';if(isPromotion)_0x25feb7='promotion';if(isDemotion)_0x25feb7='demotion';let _0x2557e8='Unranked';if(_0x5b799d>=0x834)_0x2557e8='Emerald';else{if(_0x5b799d>=0x708)_0x2557e8='Gold';else{if(_0x5b799d>=0x640)_0x2557e8='Silver';else{if(_0x5b799d>=0x578)_0x2557e8='Bronze';}}}return await setDoc(_0x34f159,{'type':_0x25feb7,'player':_0x131b63,'opponent':_0x223338,'previousElo':_0x4906c9,'newElo':_0x5b799d,'change':_0x5b799d-_0x4906c9,'matchResult':_0x3fdeb4,'previousPosition':_0x35b602,'newPosition':_0x58876a,'rankAchieved':_0x2557e8,'matchId':_0x3b373f,'timestamp':_0x3d7272}),console['log']('D2\x20ELO\x20history\x20recorded\x20for\x20'+_0x131b63),!![];}catch(_0x365ddc){console['error']('Error\x20recording\x20D2\x20ELO\x20history:',_0x365ddc);throw _0x365ddc;}}function a12_0xc13a(){const _0x18c059=['desc','newElo','exception','playersD2','warn','map','loserId','Silver','Bronze','data','all','timestamp','console','Gold','opponent','Unknown\x20Player','__proto__','docs','toString','table','length','Error\x20getting\x20username:'];a12_0xc13a=function(){return _0x18c059;};return a12_0xc13a();}export async function getEloHistoryD2(_0x4b593a=0x14){const _0x56e3d7=a12_0x115b1c;try{const _0x17495f=collection(db,'eloHistoryD2');let _0x420e8d;lastVisibleD2?_0x420e8d=query(_0x17495f,orderBy('timestamp','desc'),startAfter(lastVisibleD2),limit(_0x4b593a)):_0x420e8d=query(_0x17495f,orderBy(_0x56e3d7(0x13a),_0x56e3d7(0x12f)),limit(_0x4b593a));const _0xb9ac8d=await getDocs(_0x420e8d);if(_0xb9ac8d['empty'])return{'entries':[],'hasMore':![]};lastVisibleD2=_0xb9ac8d[_0x56e3d7(0x140)][_0xb9ac8d[_0x56e3d7(0x140)][_0x56e3d7(0x143)]-0x1];const _0xbc4883=_0xb9ac8d[_0x56e3d7(0x140)][_0x56e3d7(0x134)](async _0x142061=>{const _0xd46eff=_0x56e3d7,_0x543bdf=_0x142061['data'](),[_0x37f880,_0x36797e]=await Promise[_0xd46eff(0x139)]([getUsernameByIdD2(_0x543bdf['player']),getUsernameByIdD2(_0x543bdf[_0xd46eff(0x13d)])]);return{..._0x543bdf,'playerUsername':_0x37f880,'opponentUsername':_0x36797e,'change':_0x543bdf[_0xd46eff(0x130)]-_0x543bdf['previousElo'],'timestamp':_0x543bdf['timestamp']};}),_0x369058=await Promise['all'](_0xbc4883);return{'entries':_0x369058,'hasMore':_0xb9ac8d['size']===_0x4b593a};}catch(_0x2bdc8c){console['error']('Error\x20fetching\x20D2\x20ELO\x20history:',_0x2bdc8c);throw _0x2bdc8c;}}export function resetPaginationD2(){lastVisibleD2=null;}
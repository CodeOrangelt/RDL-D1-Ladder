const a43_0x28d521=a43_0x17c2,a43_0x1a2d31=(function(){let _0x46eaea=!![];return function(_0x118d2c,_0x52bd82){const _0x7b0a95=_0x46eaea?function(){if(_0x52bd82){const _0x256a39=_0x52bd82['apply'](_0x118d2c,arguments);return _0x52bd82=null,_0x256a39;}}:function(){};return _0x46eaea=![],_0x7b0a95;};}()),a43_0x407f15=a43_0x1a2d31(this,function(){const _0x536d1b=a43_0x17c2;let _0x5c9381;try{const _0x1708c6=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x5c9381=_0x1708c6();}catch(_0x2894cd){_0x5c9381=window;}const _0x30f6bd=_0x5c9381['console']=_0x5c9381[_0x536d1b(0xb2)]||{},_0x3aa401=['log','warn','info','error',_0x536d1b(0xc6),'table',_0x536d1b(0xe3)];for(let _0x3ee3c8=0x0;_0x3ee3c8<_0x3aa401['length'];_0x3ee3c8++){const _0x4e0d9d=a43_0x1a2d31[_0x536d1b(0xe0)][_0x536d1b(0x104)]['bind'](a43_0x1a2d31),_0x46b9a1=_0x3aa401[_0x3ee3c8],_0x1794c4=_0x30f6bd[_0x46b9a1]||_0x4e0d9d;_0x4e0d9d['__proto__']=a43_0x1a2d31[_0x536d1b(0xee)](a43_0x1a2d31),_0x4e0d9d[_0x536d1b(0xe4)]=_0x1794c4[_0x536d1b(0xe4)][_0x536d1b(0xee)](_0x1794c4),_0x30f6bd[_0x46b9a1]=_0x4e0d9d;}});a43_0x407f15();import{collection,doc,query,where,orderBy,limit,getDocs,addDoc,getDoc,serverTimestamp,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{auth,db}from'./firebase-config.js';function a43_0x17c2(_0x3b0ab9,_0x53d513){const _0x407f15=a43_0x2ac4();return a43_0x17c2=function(_0x1a2d31,_0x2a5129){_0x1a2d31=_0x1a2d31-0xa8;let _0x2ac40d=_0x407f15[_0x1a2d31];return _0x2ac40d;},a43_0x17c2(_0x3b0ab9,_0x53d513);}class PromotionManager{constructor(){const _0x5a213e=a43_0x17c2;this[_0x5a213e(0x10f)]=0x18,this['RANKS']=[{'threshold':0x578,'name':'Bronze','color':_0x5a213e(0xb3)},{'threshold':0x640,'name':_0x5a213e(0xae),'color':'#C0C0C0'},{'threshold':0x708,'name':'Gold','color':'#FFD700'},{'threshold':0x834,'name':'Emerald','color':_0x5a213e(0xa9)}],this['bannerContainer']=null,this['lastFetchTime']=0x0,this[_0x5a213e(0xb7)]=0xea60,this[_0x5a213e(0xeb)]=null,this['usernameCache']={};}['initialize'](){const _0x3b9787=a43_0x17c2;this['bannerContainer']=document[_0x3b9787(0xd5)](_0x3b9787(0xbe));if(!this['bannerContainer']){console['error']('Promotion\x20banner\x20container\x20not\x20found');return;}this['setupBannerContainer']();const _0x225547='promotions_checked_'+new Date()['toDateString'](),_0x331143=sessionStorage['getItem'](_0x225547);!_0x331143&&(this[_0x3b9787(0x110)](),sessionStorage['setItem'](_0x225547,_0x3b9787(0xf1))),document[_0x3b9787(0x109)]('visibilitychange',()=>{const _0x1074da=_0x3b9787;document['visibilityState']===_0x1074da(0xf2)&&!sessionStorage['getItem'](_0x225547)&&(this['fetchRecentPromotions'](),sessionStorage['setItem'](_0x225547,'true'));}),window['addEventListener'](_0x3b9787(0xce),()=>{const _0x5ee87e=_0x3b9787;this['pollingInterval']&&clearInterval(this[_0x5ee87e(0xeb)]);});}['setupBannerContainer'](){const _0xdf0eb3=a43_0x17c2;this['bannerContainer'][_0xdf0eb3(0xd0)]='',this['bannerContainer'][_0xdf0eb3(0x105)]['display']='none';}async['fetchRecentPromotions'](){const _0x4a04b0=a43_0x17c2;try{const _0x4c0184=Date['now']();if(_0x4c0184-this[_0x4a04b0(0xfa)]<this['fetchInterval'])return;this[_0x4a04b0(0xfa)]=_0x4c0184;const _0x506b26=collection(db,'eloHistory'),_0x885edd=query(_0x506b26,where('type','in',['promotion','demotion']),orderBy('timestamp',_0x4a04b0(0xf5)),limit(0x14)),_0xc8a859=await getDocs(_0x885edd),_0x599925=[];_0xc8a859[_0x4a04b0(0xcb)](_0x57ea38=>{const _0x5d97dd=_0x4a04b0,_0x1c6cff={'id':_0x57ea38['id'],..._0x57ea38['data']()};this['shouldShowPromotion'](_0x57ea38['id'])&&this[_0x5d97dd(0xea)](_0x1c6cff)&&_0x599925['push'](_0x1c6cff);}),_0x599925['length']>0x0&&await this['processRankChanges'](_0x599925);}catch(_0x300046){console['error'](_0x4a04b0(0xf8),_0x300046);}}async['processRankChanges'](_0x174bf5){const _0x355c96=a43_0x17c2;if(_0x174bf5['length']===0x0)return;_0x174bf5[_0x355c96(0xde)]((_0x2defbc,_0x57a857)=>{const _0x7c6ae=_0x355c96,_0x43d0aa=_0x2defbc['timestamp']?.[_0x7c6ae(0xb4)]?.()||_0x2defbc[_0x7c6ae(0x10e)]?.[_0x7c6ae(0x108)]*0x3e8||0x0,_0x12523c=_0x57a857['timestamp']?.[_0x7c6ae(0xb4)]?.()||_0x57a857['timestamp']?.['seconds']*0x3e8||0x0;return _0x12523c-_0x43d0aa;});const _0x238b9a=this[_0x355c96(0x10c)]['children']['length'],_0x21c625=0x3-_0x238b9a;if(_0x21c625<=0x0)return;const _0x5980cc=_0x174bf5[_0x355c96(0xec)](0x0,_0x21c625);for(let _0x20f987=0x0;_0x20f987<_0x5980cc['length'];_0x20f987++){const _0x23f5dc=_0x5980cc[_0x20f987],_0x5bec51=auth[_0x355c96(0xd4)];try{setTimeout(()=>{this['showRankChangeBanner'](_0x23f5dc);},_0x20f987*0x3e8),_0x5bec51&&_0x23f5dc['player']===_0x5bec51[_0x355c96(0x106)]&&this['showRankChangeLightbox'](_0x23f5dc['type'],_0x23f5dc['rankAchieved']);}catch(_0x5c31f2){console[_0x355c96(0xe6)](_0x355c96(0xd9),_0x5c31f2);}}}[a43_0x28d521(0xb5)](_0xdc3d5f){const _0x341133=a43_0x28d521;try{const _0xb157f6='promotion_'+_0xdc3d5f,_0x7ddac7=localStorage['getItem'](_0xb157f6);if(_0x7ddac7){let _0x1b6b90;try{_0x1b6b90=JSON['parse'](_0x7ddac7);}catch(_0x4efad0){return console['warn']('Invalid\x20storage\x20format\x20for\x20'+_0xb157f6+',\x20treating\x20as\x20new'),!![];}if(_0x1b6b90['ignored']===!![])return console['log']('Promotion\x20'+_0xdc3d5f+'\x20is\x20permanently\x20ignored'),![];const _0x4603db=Date['now']();if(_0x1b6b90[_0x341133(0xff)]&&_0x4603db-_0x1b6b90[_0x341133(0x10e)]<this['DISPLAY_HOURS']*0x3c*0x3c*0x3e8)return console['log']('Promotion\x20'+_0xdc3d5f+'\x20was\x20dismissed\x20by\x20user\x20within\x20last\x20'+this[_0x341133(0x10f)]+'\x20hours'),![];if(_0x1b6b90['systemDismissed']&&_0x4603db-_0x1b6b90['timestamp']<0x4*0x3c*0x3c*0x3e8)return console['log']('Promotion\x20'+_0xdc3d5f+'\x20was\x20auto-dismissed\x20within\x20last\x204\x20hours'),![];}return!![];}catch(_0x58c6d2){return console['error']('Error\x20checking\x20promotion\x20visibility:',_0x58c6d2),![];}}[a43_0x28d521(0xfc)](_0x2b62f1){const _0x4c7bfb=a43_0x28d521;try{const _0x35fb7e='promotion_'+_0x2b62f1;localStorage['setItem'](_0x35fb7e,JSON[_0x4c7bfb(0xda)]({'timestamp':Date['now'](),'ignored':!![]}));}catch(_0x2eeab6){console[_0x4c7bfb(0xe6)]('Error\x20saving\x20promotion\x20preference:',_0x2eeab6);}}['showRankChangeBanner'](_0x395cbd){this['resolveUserId'](_0x395cbd)['then'](_0x158802=>{const _0x154da7=a43_0x17c2,_0x549294='promotion_'+_0x395cbd['id'],_0x23a926=localStorage['getItem'](_0x549294);if(_0x23a926)try{const _0x22285f=JSON[_0x154da7(0x111)](_0x23a926);if(_0x22285f[_0x154da7(0xd3)]===!![]){console['log'](_0x154da7(0xed)+_0x395cbd['id']);return;}}catch(_0x11cffa){}localStorage['setItem'](_0x549294,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':![],'seenAt':Date['now']()})),this[_0x154da7(0x10c)]['style'][_0x154da7(0xfd)]=_0x154da7(0xe8);while(this['bannerContainer']['children']['length']>=0x3){this['bannerContainer']['removeChild'](this[_0x154da7(0x10c)]['firstChild']);}const _0xcde8e6=document['createElement']('div');_0xcde8e6['className']='promotion-banner',_0xcde8e6['setAttribute'](_0x154da7(0xfe),_0x158802[_0x154da7(0xb9)]),_0xcde8e6['setAttribute']('data-id',_0x158802['id']);const _0x1e0558=document[_0x154da7(0x10a)]('div');_0x1e0558['className']='promotion-details';const _0x362041=_0x158802[_0x154da7(0xdd)]||_0x158802[_0x154da7(0xfb)]||_0x158802[_0x154da7(0x100)]||_0x158802[_0x154da7(0xd2)]||_0x158802['displayName']||'A\x20player',_0x11b99a=_0x158802['type']==='promotion'?_0x362041+_0x154da7(0xa8):_0x362041+'\x20was\x20demoted\x20to';_0x1e0558[_0x154da7(0xd0)]=_0x11b99a+'\x20<span\x20class=\x22rank-text\x22>'+_0x158802[_0x154da7(0xb9)]+'</span>';const _0x33a47b=document[_0x154da7(0x10a)]('div');_0x33a47b['className']='banner-actions';const _0x49e852=document['createElement'](_0x154da7(0xad));_0x49e852['className']='dismiss-btn',_0x49e852['innerHTML']=_0x154da7(0x112),_0x49e852[_0x154da7(0xcf)]='Dismiss';const _0x25e9b4=document['createElement']('button');_0x25e9b4['className']=_0x154da7(0xc1),_0x25e9b4[_0x154da7(0xc3)]='Don\x27t\x20show\x20again',_0x25e9b4['title']='Never\x20show\x20this\x20promotion\x20again',_0x33a47b['appendChild'](_0x25e9b4),_0x33a47b['appendChild'](_0x49e852),_0xcde8e6[_0x154da7(0xd6)](_0x1e0558),_0xcde8e6[_0x154da7(0xd6)](_0x33a47b),this['bannerContainer']['appendChild'](_0xcde8e6),void _0xcde8e6['offsetWidth'],setTimeout(()=>{const _0x47adbb=_0x154da7;_0xcde8e6['classList'][_0x47adbb(0xc5)](_0x47adbb(0xd7));},0x32),_0x49e852['addEventListener'](_0x154da7(0xe9),()=>{const _0x17030b=_0x154da7;localStorage[_0x17030b(0xb1)](_0x549294,JSON['stringify']({'timestamp':Date[_0x17030b(0xe7)](),'ignored':![],'userDismissed':!![],'systemDismissed':![]})),_0xcde8e6[_0x17030b(0xbf)]['remove']('new-rank-change'),_0xcde8e6['classList']['add'](_0x17030b(0xdc)),setTimeout(()=>{const _0x501ec4=_0x17030b;_0xcde8e6['parentNode']&&(_0xcde8e6[_0x501ec4(0xbc)](),this[_0x501ec4(0x10c)]['children']['length']===0x0&&(this[_0x501ec4(0x10c)]['style']['display']=_0x501ec4(0xac)));},0x1f4);}),_0x25e9b4[_0x154da7(0x109)]('click',()=>{const _0x3f133b=_0x154da7;localStorage['setItem'](_0x549294,JSON['stringify']({'timestamp':Date[_0x3f133b(0xe7)](),'ignored':!![],'userDismissed':!![],'systemDismissed':![]})),_0xcde8e6['classList']['remove']('new-rank-change'),_0xcde8e6['classList']['add'](_0x3f133b(0xdc)),setTimeout(()=>{const _0x5bd46c=_0x3f133b;_0xcde8e6['parentNode']&&(_0xcde8e6['remove'](),this[_0x5bd46c(0x10c)][_0x5bd46c(0xe2)][_0x5bd46c(0x103)]===0x0&&(this['bannerContainer'][_0x5bd46c(0x105)][_0x5bd46c(0xfd)]='none'));},0x1f4);}),setTimeout(()=>{const _0x2c3ad0=_0x154da7;_0xcde8e6['parentNode']&&(_0xcde8e6['classList'][_0x2c3ad0(0xbc)]('new-rank-change'),_0xcde8e6[_0x2c3ad0(0xbf)]['add']('dismissing'),localStorage['setItem'](_0x549294,JSON[_0x2c3ad0(0xda)]({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':!![]})),setTimeout(()=>{const _0x426125=_0x2c3ad0;_0xcde8e6['parentNode']&&(_0xcde8e6['remove'](),this['bannerContainer']['children']['length']===0x0&&(this['bannerContainer']['style']['display']=_0x426125(0xac)));},0x1f4));},0x3a98);});}async['resolveUserId'](_0x56e357){const _0x18669f=a43_0x28d521,_0x303e11={..._0x56e357},_0x534d58=[_0x56e357['player'],_0x56e357[_0x18669f(0x100)],_0x56e357[_0x18669f(0xd2)],_0x56e357['displayName']],_0xcb4dc0=_0x534d58[_0x18669f(0xba)](_0x165702=>_0x165702&&typeof _0x165702==='string'&&!_0x165702['includes'](_0x18669f(0xf0))&&!/^[a-zA-Z0-9]{20,}$/['test'](_0x165702));if(_0xcb4dc0)return _0x303e11;let _0x486a99=null;if(_0x56e357['userId'])_0x486a99=_0x56e357[_0x18669f(0xf3)];else _0x56e357['player']&&/^[A-Za-z0-9]{20,}$/[_0x18669f(0xaf)](_0x56e357[_0x18669f(0xfb)])&&(_0x486a99=_0x56e357['player']);if(!_0x486a99)return _0x303e11;try{const _0x35f6e9=await getDoc(doc(db,'players',_0x486a99));if(_0x35f6e9[_0x18669f(0xaa)]()){const _0x58ac4c=_0x35f6e9['data']();if(_0x58ac4c['username'])return _0x303e11['resolvedName']=_0x58ac4c[_0x18669f(0x100)],_0x303e11;}const _0x2ff7b3=await getDocs(query(collection(db,'approvedMatches'),where('winnerId','==',_0x486a99),orderBy('date',_0x18669f(0xf5)),limit(0x1)));if(!_0x2ff7b3['empty']){const _0x8c2ebc=_0x2ff7b3['docs'][0x0]['data']();if(_0x8c2ebc['winnerUsername'])return _0x303e11[_0x18669f(0xdd)]=_0x8c2ebc[_0x18669f(0xf4)],_0x303e11;}const _0xb28c46=await getDocs(query(collection(db,'approvedMatches'),where('loserId','==',_0x486a99),orderBy('date','desc'),limit(0x1)));if(!_0xb28c46['empty']){const _0x5511cb=_0xb28c46['docs'][0x0][_0x18669f(0xc9)]();if(_0x5511cb['loserUsername'])return _0x303e11['resolvedName']=_0x5511cb['loserUsername'],console['log']('Resolved\x20'+_0x486a99+'\x20to\x20'+_0x5511cb['loserUsername']+'\x20(loser)'),_0x303e11;}}catch(_0x25d582){console['error']('Error\x20resolving\x20user\x20ID:',_0x25d582);}return console['warn']('Failed\x20to\x20resolve\x20user\x20ID:\x20'+_0x486a99),_0x303e11;}['showRankChangeLightbox'](_0x889a25,_0x150025){const _0x584453=a43_0x28d521;let _0x47185a=document['getElementById']('rankChangeModal');!_0x47185a&&(_0x47185a=document[_0x584453(0x10a)]('div'),_0x47185a['id']=_0x584453(0xcd),_0x47185a['className']='rank-change-modal\x20'+_0x889a25,document[_0x584453(0xc0)]['appendChild'](_0x47185a));const _0x26a8db=_0x889a25===_0x584453(0x102)?'Congratulations!':'Rank\x20Update',_0x28aeef=_0x889a25==='promotion'?'You\x27ve\x20been\x20promoted\x20to':'You\x27ve\x20been\x20demoted\x20to';_0x47185a['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rank-change-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2\x20class=\x22rank-change-title\x22>'+_0x26a8db+'</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>'+_0x28aeef+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22rank-name\x22>'+_0x150025+'</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22rank-change-button\x22\x20id=\x22rank-change-ok-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Got\x20it!\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x47185a['style']['display']='flex',document['getElementById']('rank-change-ok-btn')['addEventListener']('click',()=>{const _0x49895f=_0x584453;_0x47185a['style'][_0x49895f(0xfd)]='none';}),_0x47185a[_0x584453(0x109)](_0x584453(0xe9),_0x4b5d8a=>{const _0x3da270=_0x584453;_0x4b5d8a[_0x3da270(0xf7)]===_0x47185a&&(_0x47185a[_0x3da270(0x105)][_0x3da270(0xfd)]='none');});}async[a43_0x28d521(0xd8)](_0x1dbf60,_0x247a0f,_0x7fe4ab,_0x121626={}){const _0x168843=a43_0x28d521;try{if(_0x247a0f===_0x7fe4ab||!_0x1dbf60)return null;const _0x1fdddd=_0x121626['source']||'automatic',_0x134fd0=_0x121626[_0x168843(0xdb)]||null,_0x270165=_0x121626['adminUser']||null;console['log'](_0x168843(0xdf)+_0x7fe4ab+_0x168843(0xca)+_0x247a0f+'\x20(source:\x20'+_0x1fdddd+')');let _0x5444cc=null,_0x8a2a20=null;try{const _0xf401d3=await getDoc(doc(db,_0x168843(0xc7),_0x1dbf60));if(_0xf401d3[_0x168843(0xaa)]()){const _0x4ffbb8=_0xf401d3['data']();_0x5444cc=_0x4ffbb8['username']||_0x4ffbb8[_0x168843(0x106)]||null,_0x8a2a20=_0x4ffbb8['displayName']||_0x4ffbb8['username']||null;}!_0x5444cc&&_0x121626['username']&&(_0x5444cc=_0x121626['username'],_0x8a2a20=_0x121626[_0x168843(0x100)]);!_0x5444cc&&auth[_0x168843(0xd4)]&&(_0x5444cc=auth[_0x168843(0xd4)]['displayName']||auth['currentUser'][_0x168843(0xb6)]['split']('@')[0x0],_0x8a2a20=auth['currentUser']['displayName']||null);if(!_0x5444cc){const _0x418c99=query(collection(db,_0x168843(0xf6)),where('winnerId','==',_0x1dbf60),limit(0x1)),_0x49e645=await getDocs(_0x418c99);if(!_0x49e645['empty'])_0x5444cc=_0x49e645['docs'][0x0]['data']()['winnerUsername']||'Unknown\x20Player',_0x8a2a20=_0x5444cc;else{const _0x344ee3=query(collection(db,'approvedMatches'),where('loserId','==',_0x1dbf60),limit(0x1)),_0x2274fb=await getDocs(_0x344ee3);!_0x2274fb[_0x168843(0xcc)]&&(_0x5444cc=_0x2274fb[0x0][_0x168843(0xc9)]()['loserUsername']||'Unknown\x20Player',_0x8a2a20=_0x5444cc);}}}catch(_0x141250){console['error']('Error\x20resolving\x20username:',_0x141250);}!_0x5444cc&&(console['warn'](_0x168843(0xf9),_0x1dbf60),_0x5444cc=_0x168843(0xab),_0x8a2a20=_0x168843(0x107));const _0x3bc26c=this['getRankName'](_0x7fe4ab),_0x177748=this[_0x168843(0xef)](_0x247a0f);if(_0x3bc26c!==_0x177748){const _0x2348cf=_0x247a0f>_0x7fe4ab,_0x391e4a=_0x2348cf?'promotion':'demotion',_0x5841e5=_0x177748;console['log']('Recording\x20'+_0x391e4a+_0x168843(0xb8)+_0x5444cc+':\x20'+_0x7fe4ab+'\x20('+_0x3bc26c+')\x20→\x20'+_0x247a0f+'\x20('+_0x177748+')');try{const _0x3c5ab6={'player':_0x5444cc,'playerUsername':_0x5444cc,'username':_0x5444cc,'displayName':_0x8a2a20,'userId':_0x1dbf60,'type':_0x391e4a,'rankAchieved':_0x5841e5,'timestamp':serverTimestamp(),'previousElo':_0x7fe4ab,'newElo':_0x247a0f,'change':_0x247a0f-_0x7fe4ab,'previousRank':_0x3bc26c,'newRank':_0x177748,'source':_0x1fdddd};if(_0x1fdddd==='match'&&_0x134fd0)_0x3c5ab6[_0x168843(0xdb)]=_0x134fd0;else _0x1fdddd==='admin'&&_0x270165?(_0x3c5ab6[_0x168843(0xbb)]=_0x270165,_0x3c5ab6[_0x168843(0xc4)]=![]):_0x3c5ab6[_0x168843(0xc4)]=!![];const _0x7a0de6=writeBatch(db),_0x17c3ec=doc(collection(db,'eloHistory')),_0x2d695e=doc(collection(db,'promotionHistory'));return _0x7a0de6['set'](_0x17c3ec,_0x3c5ab6),_0x7a0de6['set'](_0x2d695e,_0x3c5ab6),await _0x7a0de6['commit'](),await this['sendPromotionNotification'](_0x1dbf60,_0x5444cc,_0x7fe4ab,_0x247a0f,_0x3bc26c,_0x177748,_0x391e4a,{'displayName':_0x8a2a20,'source':_0x1fdddd,'matchId':_0x134fd0,'ladder':_0x121626[_0x168843(0x10d)]||'D1'}),console['log']('Successfully\x20recorded\x20'+_0x391e4a+'\x20for\x20'+_0x5444cc+'\x20to\x20'+_0x5841e5),_0x5841e5;}catch(_0x3198c7){console['error']('Error\x20writing\x20promotion\x20records:',_0x3198c7);try{return await addDoc(collection(db,'eloHistory'),{'player':_0x5444cc,'playerUsername':_0x5444cc,'username':_0x5444cc,'displayName':_0x8a2a20,'userId':_0x1dbf60,'type':_0x391e4a,'rankAchieved':_0x5841e5,'timestamp':serverTimestamp(),'previousElo':_0x7fe4ab,'newElo':_0x247a0f,'change':_0x247a0f-_0x7fe4ab,'previousRank':_0x3bc26c,'source':_0x1fdddd,'isAutomatic':_0x1fdddd!=='admin'}),await this['sendPromotionNotification'](_0x1dbf60,_0x5444cc,_0x7fe4ab,_0x247a0f,_0x3bc26c,_0x177748,_0x391e4a,{'displayName':_0x8a2a20,'source':_0x1fdddd,'matchId':_0x134fd0,'ladder':_0x121626['ladder']||'D1'}),_0x5841e5;}catch(_0x1b8797){return console[_0x168843(0xe6)](_0x168843(0xc8),_0x1b8797),null;}}}return null;}catch(_0x56ec9f){return console['error']('Error\x20in\x20promotion/demotion\x20recording:',_0x56ec9f),null;}}['getRankName'](_0x556f16){const _0x350167=a43_0x28d521;for(let _0x50b5fe=this[_0x350167(0x101)][_0x350167(0x103)]-0x1;_0x50b5fe>=0x0;_0x50b5fe--){if(_0x556f16>=this[_0x350167(0x101)][_0x50b5fe]['threshold'])return this[_0x350167(0x101)][_0x50b5fe][_0x350167(0xe5)];}return _0x350167(0xd1);}['cleanup'](){this['pollingInterval']&&clearInterval(this['pollingInterval']);}['isNewRankChange'](_0x3e48df){const _0x518227=a43_0x28d521;if(_0x3e48df['timestamp']){const _0xdc9b01=_0x3e48df['timestamp'][_0x518227(0x108)]*0x3e8,_0x5d328e=Date[_0x518227(0xe7)](),_0x326e14=(_0x5d328e-_0xdc9b01)/(0x3e8*0x3c*0x3c);if(_0x326e14>0x18)return![];}if(_0x3e48df['previousRank']&&_0x3e48df['newRank']&&_0x3e48df['previousRank']!==_0x3e48df['newRank'])return!![];return![];}async[a43_0x28d521(0xc2)](_0x3ee8c8,_0x4db2e8,_0x4c23ad,_0x2aa1df,_0x3a8e4a,_0x505db4,_0x186f86,_0x4cd1ca={}){const _0x36646e=a43_0x28d521;try{console[_0x36646e(0x10b)]('STARTING\x20notification\x20for\x20'+_0x4db2e8+'\x27s\x20'+_0x186f86);const _0x26bbbd={'userId':_0x3ee8c8,'username':_0x4db2e8,'displayName':_0x4cd1ca['displayName']||_0x4db2e8,'oldElo':parseInt(_0x4c23ad),'newElo':parseInt(_0x2aa1df),'eloDifference':parseInt(_0x2aa1df)-parseInt(_0x4c23ad),'oldRank':_0x3a8e4a,'newRank':_0x505db4,'type':_0x186f86,'timestamp':serverTimestamp(),'processed':![],'source':_0x4cd1ca['source']||'automatic','matchId':_0x4cd1ca[_0x36646e(0xdb)]||null,'ladder':_0x4cd1ca['ladder']||'D1','adminUser':_0x4cd1ca['adminUser']||null};console['log']('Creating\x20Discord\x20notification:',_0x26bbbd);const _0x4eb453=await addDoc(collection(db,_0x36646e(0xbd)),_0x26bbbd);return console[_0x36646e(0x10b)](_0x36646e(0xe1)+_0x4eb453['id']),!![];}catch(_0x223cbd){return console['error']('Error\x20sending\x20Discord\x20notification:',_0x223cbd),![];}}}export const promotionManager=new PromotionManager();document['addEventListener'](a43_0x28d521(0xb0),()=>{promotionManager['initialize']();});export const initializePromotionTracker=()=>promotionManager['initialize']();export const checkAndRecordPromotion=(_0x5c317e,_0x59cca9,_0x24a7a3,_0x3a57ee)=>promotionManager['checkAndRecordPromotion'](_0x5c317e,_0x59cca9,_0x24a7a3,_0x3a57ee);function a43_0x2ac4(){const _0x5e596e=['\x20was\x20promoted\x20to','#50C878','exists','A\x20player','none','button','Silver','test','DOMContentLoaded','setItem','console','#CD7F32','toMillis','shouldShowPromotion','email','fetchInterval','\x20for\x20','rankAchieved','some','modifiedBy','remove','promotionNotifications','promotion-banner-container','classList','body','ignore-btn','sendPromotionNotification','textContent','isAutomatic','add','exception','players','Fallback\x20write\x20failed:','data','\x20→\x20','forEach','empty','rankChangeModal','beforeunload','title','innerHTML','Unranked','playerUsername','ignored','currentUser','getElementById','appendChild','new-rank-change','checkAndRecordPromotion','Error\x20processing\x20rank\x20change:','stringify','matchId','dismissing','resolvedName','sort','Processing\x20potential\x20rank\x20change:\x20','constructor','Discord\x20notification\x20sent\x20successfully\x20with\x20ID:\x20','children','trace','toString','name','error','now','block','click','isNewRankChange','pollingInterval','slice','Skipping\x20ignored\x20promotion:\x20','bind','getRankName','ID:','true','visible','userId','winnerUsername','desc','approvedMatches','target','Error\x20fetching\x20promotions:','Could\x20not\x20resolve\x20username\x20for\x20userId:','lastFetchTime','player','ignorePromotion','display','data-rank','userDismissed','username','RANKS','promotion','length','prototype','style','displayName','Unknown\x20Player','seconds','addEventListener','createElement','log','bannerContainer','ladder','timestamp','DISPLAY_HOURS','fetchRecentPromotions','parse','&times;'];a43_0x2ac4=function(){return _0x5e596e;};return a43_0x2ac4();}export const getRankName=_0x4f1a13=>promotionManager['getRankName'](_0x4f1a13);
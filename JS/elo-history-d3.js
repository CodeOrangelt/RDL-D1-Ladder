const a15_0x312b36=a15_0x3c3e,a15_0x26fadf=(function(){let _0x13810d=!![];return function(_0x14e093,_0x5e04d1){const _0x1c8c2d=_0x13810d?function(){const _0x25cd3c=a15_0x3c3e;if(_0x5e04d1){const _0x2f394c=_0x5e04d1[_0x25cd3c(0xa9)](_0x14e093,arguments);return _0x5e04d1=null,_0x2f394c;}}:function(){};return _0x13810d=![],_0x1c8c2d;};}()),a15_0x117095=a15_0x26fadf(this,function(){const _0x34f5fa=a15_0x3c3e;let _0x5c107a;try{const _0x35e186=Function('return\x20(function()\x20'+_0x34f5fa(0xa2)+');');_0x5c107a=_0x35e186();}catch(_0x1c96b3){_0x5c107a=window;}const _0x2bb1c9=_0x5c107a['console']=_0x5c107a[_0x34f5fa(0xab)]||{},_0x5e5c0e=['log','warn','info',_0x34f5fa(0xaf),'exception',_0x34f5fa(0xb4),'trace'];for(let _0x2bedb0=0x0;_0x2bedb0<_0x5e5c0e['length'];_0x2bedb0++){const _0x21a061=a15_0x26fadf['constructor']['prototype'][_0x34f5fa(0xa0)](a15_0x26fadf),_0x2657e0=_0x5e5c0e[_0x2bedb0],_0x10515d=_0x2bb1c9[_0x2657e0]||_0x21a061;_0x21a061['__proto__']=a15_0x26fadf['bind'](a15_0x26fadf),_0x21a061[_0x34f5fa(0xa7)]=_0x10515d['toString']['bind'](_0x10515d),_0x2bb1c9[_0x2657e0]=_0x21a061;}});a15_0x117095();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc,where}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a15_0x3c3e(_0x51c7e7,_0x830629){const _0x117095=a15_0x5ae8();return a15_0x3c3e=function(_0x26fadf,_0x3f40a9){_0x26fadf=_0x26fadf-0x9e;let _0x5ae8ed=_0x117095[_0x26fadf];return _0x5ae8ed;},a15_0x3c3e(_0x51c7e7,_0x830629);}import{db}from'./firebase-config.js';function a15_0x5ae8(){const _0x503a89=['exists','newElo','bind','all','{}.constructor(\x22return\x20this\x22)(\x20)','eloHistoryD3','Gold','Unranked','approvedMatchesD3','toString','docs','apply','Silver','console','username','size','timestamp','error','empty','match','data','length','table','Emerald'];a15_0x5ae8=function(){return _0x503a89;};return a15_0x5ae8();}const ELO_THRESHOLDS_D3=[{'name':a15_0x312b36(0xb5),'elo':0x7d0},{'name':'Gold','elo':0x708},{'name':'Silver','elo':0x640},{'name':'Bronze','elo':0x578},{'name':a15_0x312b36(0xa5),'elo':0x4b0}];let lastVisibleD3=null;async function getUsernameByIdD3(_0x45136d){const _0x4b5b9e=a15_0x312b36;try{if(!_0x45136d)return'Unknown\x20Player';const _0x52721c=await getDoc(doc(db,'playersD3',_0x45136d));if(_0x52721c[_0x4b5b9e(0x9e)]())return _0x52721c['data']()[_0x4b5b9e(0xac)]||'Unknown\x20Player';const _0x166283=await getDocs(query(collection(db,'approvedMatchesD3'),where('winnerId','==',_0x45136d),limit(0x1)));if(!_0x166283['empty'])return _0x166283['docs'][0x0]['data']()['winnerUsername']||'Unknown\x20Player';const _0x2a2e13=await getDocs(query(collection(db,_0x4b5b9e(0xa6)),where('loserId','==',_0x45136d),limit(0x1)));if(!_0x2a2e13[_0x4b5b9e(0xb0)])return _0x2a2e13['docs'][0x0][_0x4b5b9e(0xb2)]()['loserUsername']||'Unknown\x20Player';return'Unknown\x20Player';}catch(_0x4d6f0a){return console['error']('Error\x20getting\x20D3\x20username:',_0x4d6f0a),'Unknown\x20Player';}}export async function recordEloChangeD3({playerId:_0x32440e,previousElo:_0x3e56c2,newElo:_0xc66c02,opponentId:_0x556ee0,matchResult:_0x234e58,previousPosition:_0x311676,newPosition:_0x537f4f,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x572758,timestamp:_0x861579}){const _0x2fda59=a15_0x312b36;try{const _0x15948b=doc(collection(db,'eloHistoryD3'));let _0x53c970=_0x2fda59(0xb1);if(isPromotion)_0x53c970='promotion';if(isDemotion)_0x53c970='demotion';let _0x4241c9='Unranked';if(_0xc66c02>=0x7d0)_0x4241c9=_0x2fda59(0xb5);else{if(_0xc66c02>=0x708)_0x4241c9=_0x2fda59(0xa4);else{if(_0xc66c02>=0x640)_0x4241c9=_0x2fda59(0xaa);else{if(_0xc66c02>=0x578)_0x4241c9='Bronze';}}}return await setDoc(_0x15948b,{'type':_0x53c970,'player':_0x32440e,'opponent':_0x556ee0,'previousElo':_0x3e56c2,'newElo':_0xc66c02,'change':_0xc66c02-_0x3e56c2,'matchResult':_0x234e58,'previousPosition':_0x311676,'newPosition':_0x537f4f,'rankAchieved':_0x4241c9,'matchId':_0x572758,'timestamp':_0x861579||serverTimestamp(),'gameMode':'D3'}),console['log']('D3\x20ELO\x20history\x20recorded\x20for\x20'+_0x32440e),!![];}catch(_0x2b6562){console['error']('Error\x20recording\x20D3\x20ELO\x20history:',_0x2b6562);throw _0x2b6562;}}export async function getEloHistoryD3(_0x3c68a0=0x14){const _0xce1571=a15_0x312b36;try{const _0x2ee151=collection(db,_0xce1571(0xa3));let _0x23f265;lastVisibleD3?_0x23f265=query(_0x2ee151,orderBy(_0xce1571(0xae),'desc'),startAfter(lastVisibleD3),limit(_0x3c68a0)):_0x23f265=query(_0x2ee151,orderBy('timestamp','desc'),limit(_0x3c68a0));const _0x2be00d=await getDocs(_0x23f265);if(_0x2be00d['empty'])return{'entries':[],'hasMore':![]};lastVisibleD3=_0x2be00d['docs'][_0x2be00d[_0xce1571(0xa8)][_0xce1571(0xb3)]-0x1];const _0xa78fec=_0x2be00d['docs']['map'](async _0x10a414=>{const _0x10c4d5=_0xce1571,_0x5e9e3b=_0x10a414['data'](),[_0x55961e,_0x11f50e]=await Promise[_0x10c4d5(0xa1)]([getUsernameByIdD3(_0x5e9e3b['player']),getUsernameByIdD3(_0x5e9e3b['opponent'])]);return{..._0x5e9e3b,'playerUsername':_0x55961e,'opponentUsername':_0x11f50e,'change':_0x5e9e3b[_0x10c4d5(0x9f)]-_0x5e9e3b['previousElo'],'timestamp':_0x5e9e3b[_0x10c4d5(0xae)]};}),_0x4188ef=await Promise[_0xce1571(0xa1)](_0xa78fec);return{'entries':_0x4188ef,'hasMore':_0x2be00d[_0xce1571(0xad)]===_0x3c68a0};}catch(_0x5388d9){console['error']('Error\x20fetching\x20D3\x20ELO\x20history:',_0x5388d9);throw _0x5388d9;}}export function resetPaginationD3(){lastVisibleD3=null;}
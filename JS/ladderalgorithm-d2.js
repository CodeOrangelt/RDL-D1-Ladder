(function(_0x51a537,_0xdf0f16){const _0x28faa2=a28_0x27c8,_0x2dc0d9=_0x51a537();while(!![]){try{const _0x5e544c=parseInt(_0x28faa2(0x122))/0x1+parseInt(_0x28faa2(0x12f))/0x2*(-parseInt(_0x28faa2(0x116))/0x3)+-parseInt(_0x28faa2(0x10a))/0x4+parseInt(_0x28faa2(0x10b))/0x5+parseInt(_0x28faa2(0x10c))/0x6*(-parseInt(_0x28faa2(0x11e))/0x7)+-parseInt(_0x28faa2(0x12d))/0x8*(parseInt(_0x28faa2(0x108))/0x9)+parseInt(_0x28faa2(0x135))/0xa;if(_0x5e544c===_0xdf0f16)break;else _0x2dc0d9['push'](_0x2dc0d9['shift']());}catch(_0x4a1d71){_0x2dc0d9['push'](_0x2dc0d9['shift']());}}}(a28_0x4a52,0x4b1a9));const a28_0x405b56=(function(){let _0x2d428e=!![];return function(_0x5f3c47,_0x12a551){const _0x35c1be=_0x2d428e?function(){const _0x2c40f7=a28_0x27c8;if(_0x12a551){const _0x5d23c6=_0x12a551[_0x2c40f7(0x12e)](_0x5f3c47,arguments);return _0x12a551=null,_0x5d23c6;}}:function(){};return _0x2d428e=![],_0x35c1be;};}()),a28_0x35069b=a28_0x405b56(this,function(){const _0x312c2b=a28_0x27c8;return a28_0x35069b[_0x312c2b(0x12b)]()['search'](_0x312c2b(0x130))['toString']()['constructor'](a28_0x35069b)[_0x312c2b(0x123)](_0x312c2b(0x130));});function a28_0x4a52(){const _0x4c6bf1=['Current\x20username:','782608uVaaKC','913905pxntBq','3124878SVtIKM','D2\x20Match\x20moved\x20to\x20approved\x20collection','uid','prototype','bind','length','D2\x20Match\x20successfully\x20approved\x20and\x20ELO\x20updated','console','playersD2','info','3BbfnPl','exists','table','position','error','log','D2\x20match\x20report\x20not\x20found','loserUsername','7oGhrhM','approvedMatchesD2','return\x20(function()\x20','loss','441741scPjoW','search','docs','update','Current\x20user:','One\x20or\x20both\x20D2\x20players\x20not\x20found','D2\x20Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked','MAX_SAFE_INTEGER','Error\x20in\x20updateEloRatingsD2:','toString','No\x20user\x20logged\x20in','208zMnojS','apply','959358lNuWdv','(((.+)+)+)+$','Could\x20not\x20find\x20D2\x20player\x20documents','exception','email','pow','9239410DaXxtX','username','winnerUsername','You\x20must\x20be\x20logged\x20in\x20to\x20approve\x20D2\x20matches','__proto__','data','D2\x20Report\x20data:','warn','all','empty','eloRating','round','match-d2','Only\x20the\x20winner\x20can\x20approve\x20D2\x20matches','Starting\x20approveReportD2\x20function\x20with:','currentUser','checkAndRecordPromotion','15471nMmBSE'];a28_0x4a52=function(){return _0x4c6bf1;};return a28_0x4a52();}a28_0x35069b();const a28_0x5d7dda=(function(){let _0x402dbc=!![];return function(_0x29703b,_0x25ba7b){const _0x1c4943=_0x402dbc?function(){const _0x169b99=a28_0x27c8;if(_0x25ba7b){const _0x41b019=_0x25ba7b[_0x169b99(0x12e)](_0x29703b,arguments);return _0x25ba7b=null,_0x41b019;}}:function(){};return _0x402dbc=![],_0x1c4943;};}()),a28_0x39a47b=a28_0x5d7dda(this,function(){const _0x36d49f=a28_0x27c8,_0x2bd357=function(){const _0x32c13d=a28_0x27c8;let _0x161df8;try{_0x161df8=Function(_0x32c13d(0x120)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x28bb14){_0x161df8=window;}return _0x161df8;},_0xc9d848=_0x2bd357(),_0x2744b4=_0xc9d848[_0x36d49f(0x113)]=_0xc9d848['console']||{},_0x561f5a=['log',_0x36d49f(0xfe),_0x36d49f(0x115),_0x36d49f(0x11a),_0x36d49f(0x132),_0x36d49f(0x118),'trace'];for(let _0x3e2e04=0x0;_0x3e2e04<_0x561f5a[_0x36d49f(0x111)];_0x3e2e04++){const _0x247ffd=a28_0x5d7dda['constructor'][_0x36d49f(0x10f)]['bind'](a28_0x5d7dda),_0x427fa2=_0x561f5a[_0x3e2e04],_0x5e341f=_0x2744b4[_0x427fa2]||_0x247ffd;_0x247ffd[_0x36d49f(0xfb)]=a28_0x5d7dda[_0x36d49f(0x110)](a28_0x5d7dda),_0x247ffd['toString']=_0x5e341f['toString'][_0x36d49f(0x110)](_0x5e341f),_0x2744b4[_0x427fa2]=_0x247ffd;}});a28_0x39a47b();import{collection,doc,getDoc,getDocs,updateDoc,setDoc,deleteDoc,writeBatch,query,where,serverTimestamp,addDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';import{recordEloChangeD2}from'./elo-history-d2.js';import{promotionManager}from'./promotions.js';import a28_0xfa4e9a from'./firebase-idle-wrapper.js';function a28_0x27c8(_0x170549,_0x18be15){const _0x3282b2=a28_0x4a52();return a28_0x27c8=function(_0x39a47b,_0x5d7dda){_0x39a47b=_0x39a47b-0xfb;let _0x3c9211=_0x3282b2[_0x39a47b];return _0x3c9211;},a28_0x27c8(_0x170549,_0x18be15);}export function calculateEloD2(_0x53cd1d,_0x2b13ff,_0x1d0ba1=0x20){const _0xddf44d=a28_0x27c8,_0x3d115c=0x1/(0x1+Math[_0xddf44d(0x134)](0xa,(_0x2b13ff-_0x53cd1d)/0x190)),_0x1acfdb=0x1/(0x1+Math[_0xddf44d(0x134)](0xa,(_0x53cd1d-_0x2b13ff)/0x190)),_0x48f7cf=_0x53cd1d+_0x1d0ba1*(0x1-_0x3d115c),_0xb7e707=_0x2b13ff+_0x1d0ba1*(0x0-_0x1acfdb);return{'newWinnerRating':Math['round'](_0x48f7cf),'newLoserRating':Math[_0xddf44d(0x102)](_0xb7e707)};}export async function updateEloRatingsD2(_0x5231bd,_0x20a01b,_0x18bc3d){const _0x5ea7cf=a28_0x27c8;try{const _0x27d81a=writeBatch(db),_0x4b4899=doc(db,_0x5ea7cf(0x114),_0x5231bd),_0x36fcda=doc(db,_0x5ea7cf(0x114),_0x20a01b),[_0xc7d7b9,_0x3c5094]=await Promise[_0x5ea7cf(0xff)]([getDoc(_0x4b4899),getDoc(_0x36fcda)]);if(!_0xc7d7b9[_0x5ea7cf(0x117)]()||!_0x3c5094[_0x5ea7cf(0x117)]())throw new Error(_0x5ea7cf(0x127));const _0x31b54a=_0xc7d7b9[_0x5ea7cf(0xfc)](),_0x30347b=_0x3c5094[_0x5ea7cf(0xfc)](),_0x3f45da=_0x31b54a[_0x5ea7cf(0x119)]||Number['MAX_SAFE_INTEGER'],_0x1b0a73=_0x30347b[_0x5ea7cf(0x119)]||Number[_0x5ea7cf(0x129)],{newWinnerRating:_0x440dbd,newLoserRating:_0x4c7989}=calculateEloD2(_0x31b54a[_0x5ea7cf(0x101)]||0x4b0,_0x30347b[_0x5ea7cf(0x101)]||0x4b0);let _0x488a85=_0x3f45da,_0x2e0d4f=_0x1b0a73;if(_0x3f45da>_0x1b0a73){console[_0x5ea7cf(0x11b)](_0x5ea7cf(0x128)),_0x488a85=_0x1b0a73,_0x2e0d4f=_0x1b0a73+0x1;const _0x10bae0=query(collection(db,_0x5ea7cf(0x114)),where(_0x5ea7cf(0x119),'>',_0x1b0a73),where('position','<',_0x3f45da)),_0xca5ff9=await getDocs(_0x10bae0);for(const _0x4db1b6 of _0xca5ff9[_0x5ea7cf(0x124)]){_0x4db1b6['id']!==_0x5231bd&&_0x4db1b6['id']!==_0x20a01b&&_0x27d81a['update'](doc(db,_0x5ea7cf(0x114),_0x4db1b6['id']),{'position':_0x4db1b6[_0x5ea7cf(0xfc)]()[_0x5ea7cf(0x119)]+0x1});}}else console[_0x5ea7cf(0x11b)]('D2\x20Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions');return _0x27d81a['update'](_0x4b4899,{'eloRating':_0x440dbd,'lastMatchDate':serverTimestamp(),'position':_0x488a85,'lastMatchId':_0x18bc3d}),_0x27d81a[_0x5ea7cf(0x125)](_0x36fcda,{'eloRating':_0x4c7989,'lastMatchDate':serverTimestamp(),'position':_0x2e0d4f,'lastMatchId':_0x18bc3d}),await _0x27d81a['commit'](),console[_0x5ea7cf(0x11b)]('D2\x20ELO\x20ratings\x20updated\x20successfully'),await Promise[_0x5ea7cf(0xff)]([recordEloChangeD2({'playerId':_0x5231bd,'previousElo':_0x31b54a[_0x5ea7cf(0x101)]||0x4b0,'newElo':_0x440dbd,'opponentId':_0x20a01b,'matchResult':'win','previousPosition':_0x3f45da,'newPosition':_0x488a85,'isPromotion':_0x488a85<_0x3f45da,'matchId':_0x18bc3d,'timestamp':serverTimestamp()}),recordEloChangeD2({'playerId':_0x20a01b,'previousElo':_0x30347b[_0x5ea7cf(0x101)]||0x4b0,'newElo':_0x4c7989,'opponentId':_0x5231bd,'matchResult':_0x5ea7cf(0x121),'previousPosition':_0x1b0a73,'newPosition':_0x2e0d4f,'isDemotion':_0x2e0d4f>_0x1b0a73,'matchId':_0x18bc3d,'timestamp':serverTimestamp()})]),await promotionManager['checkAndRecordPromotion'](_0x5231bd,_0x440dbd,_0x31b54a['eloRating'],{'source':_0x5ea7cf(0x103),'matchId':_0x18bc3d}),await promotionManager[_0x5ea7cf(0x107)](_0x20a01b,_0x4c7989,_0x30347b[_0x5ea7cf(0x101)],{'source':_0x5ea7cf(0x103),'matchId':_0x18bc3d}),!![];}catch(_0x2320ca){console[_0x5ea7cf(0x11a)](_0x5ea7cf(0x12a),_0x2320ca);throw _0x2320ca;}}export async function approveReportD2(_0xee1a05,_0x11149e,_0x4e4c9b,_0x4d8f58){const _0x5e5e6b=a28_0x27c8;try{console[_0x5e5e6b(0x11b)](_0x5e5e6b(0x105),{'reportId':_0xee1a05,'winnerScore':_0x11149e,'winnerSuicides':_0x4e4c9b,'winnerComment':_0x4d8f58});const _0x4ff4de=auth[_0x5e5e6b(0x106)];if(!_0x4ff4de){console[_0x5e5e6b(0x11b)](_0x5e5e6b(0x12c));throw new Error(_0x5e5e6b(0x138));}console[_0x5e5e6b(0x11b)](_0x5e5e6b(0x126),_0x4ff4de[_0x5e5e6b(0x133)]);const _0x6d3a1d=await getDoc(doc(db,_0x5e5e6b(0x114),_0x4ff4de[_0x5e5e6b(0x10e)])),_0x45d7d3=_0x6d3a1d[_0x5e5e6b(0x117)]()?_0x6d3a1d[_0x5e5e6b(0xfc)]()['username']:null;console[_0x5e5e6b(0x11b)](_0x5e5e6b(0x109),_0x45d7d3);const _0x13ffba=doc(db,'pendingMatchesD2',_0xee1a05),_0x1760a8=await getDoc(_0x13ffba);if(!_0x1760a8[_0x5e5e6b(0x117)]()){console['log']('D2\x20Report\x20not\x20found\x20with\x20ID:',_0xee1a05);throw new Error(_0x5e5e6b(0x11c));}const _0x2b71f2=_0x1760a8[_0x5e5e6b(0xfc)]();console[_0x5e5e6b(0x11b)](_0x5e5e6b(0xfd),_0x2b71f2);if(_0x45d7d3!==_0x2b71f2['winnerUsername'])throw new Error(_0x5e5e6b(0x104));const _0x2ddbcb={..._0x2b71f2,'winnerScore':_0x11149e,'winnerSuicides':_0x4e4c9b,'winnerComment':_0x4d8f58,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':_0x45d7d3,'createdAt':_0x2b71f2['createdAt']||serverTimestamp(),'winnerUsername':_0x2b71f2[_0x5e5e6b(0x137)],'loserUsername':_0x2b71f2['loserUsername']};await setDoc(doc(db,_0x5e5e6b(0x11f),_0xee1a05),_0x2ddbcb),await deleteDoc(_0x13ffba),console[_0x5e5e6b(0x11b)](_0x5e5e6b(0x10d));const [_0x115d0d,_0x2704f4]=await Promise[_0x5e5e6b(0xff)]([getDocs(query(collection(db,'playersD2'),where(_0x5e5e6b(0x136),'==',_0x2b71f2[_0x5e5e6b(0x137)]))),getDocs(query(collection(db,'playersD2'),where(_0x5e5e6b(0x136),'==',_0x2b71f2[_0x5e5e6b(0x11d)])))]);if(_0x115d0d[_0x5e5e6b(0x100)]||_0x2704f4[_0x5e5e6b(0x100)])throw new Error(_0x5e5e6b(0x131));const _0x3732c5=_0x115d0d['docs'][0x0]['id'],_0x226aaf=_0x2704f4['docs'][0x0]['id'];return await updateEloRatingsD2(_0x3732c5,_0x226aaf,_0xee1a05),console[_0x5e5e6b(0x11b)](_0x5e5e6b(0x112)),!![];}catch(_0x45252c){console['error']('Error\x20in\x20approveReportD2:',_0x45252c);throw _0x45252c;}}
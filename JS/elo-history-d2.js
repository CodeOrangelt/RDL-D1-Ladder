const a14_0x2b757e=a14_0x253f,a14_0x448644=(function(){let _0x8d1820=!![];return function(_0x343181,_0x56a404){const _0x319f1c=_0x8d1820?function(){if(_0x56a404){const _0x36fc79=_0x56a404['apply'](_0x343181,arguments);return _0x56a404=null,_0x36fc79;}}:function(){};return _0x8d1820=![],_0x319f1c;};}()),a14_0x554197=a14_0x448644(this,function(){const _0x5caa05=a14_0x253f,_0x241328=function(){let _0x1d3cf3;try{_0x1d3cf3=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x4aa230){_0x1d3cf3=window;}return _0x1d3cf3;},_0x209ee9=_0x241328(),_0x185e27=_0x209ee9[_0x5caa05(0x204)]=_0x209ee9['console']||{},_0x455660=['log','warn','info','error','exception','table','trace'];for(let _0x598a99=0x0;_0x598a99<_0x455660['length'];_0x598a99++){const _0x208ca7=a14_0x448644['constructor']['prototype']['bind'](a14_0x448644),_0x28128e=_0x455660[_0x598a99],_0x451845=_0x185e27[_0x28128e]||_0x208ca7;_0x208ca7['__proto__']=a14_0x448644['bind'](a14_0x448644),_0x208ca7['toString']=_0x451845[_0x5caa05(0x1f4)]['bind'](_0x451845),_0x185e27[_0x28128e]=_0x208ca7;}});a14_0x554197();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a14_0x253f(_0x9900fc,_0x3510fc){const _0x554197=a14_0x55f9();return a14_0x253f=function(_0x448644,_0x3705cd){_0x448644=_0x448644-0x1f4;let _0x55f9be=_0x554197[_0x448644];return _0x55f9be;},a14_0x253f(_0x9900fc,_0x3510fc);}import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D2=[{'name':'Gold','elo':0x708},{'name':'Silver','elo':0x640},{'name':'Bronze','elo':0x578},{'name':a14_0x2b757e(0x202),'elo':0x4b0}];let lastVisibleD2=null;async function getUsernameByIdD2(_0x4e9e40){const _0x4c2c8a=a14_0x2b757e;try{if(!_0x4e9e40)return'Unknown\x20Player';const _0x940c5e=await getDoc(doc(db,'playersD2',_0x4e9e40));if(_0x940c5e['exists']())return _0x940c5e[_0x4c2c8a(0x1f9)]()[_0x4c2c8a(0x1fc)]||'Unknown\x20Player';const _0x565066=await getDocs(query(collection(db,'approvedMatchesD2'),where(_0x4c2c8a(0x1f6),'==',_0x4e9e40),limit(0x1)));if(!_0x565066[_0x4c2c8a(0x1fd)])return _0x565066[_0x4c2c8a(0x201)][0x0]['data']()['winnerUsername']||_0x4c2c8a(0x203);const _0x5494be=await getDocs(query(collection(db,_0x4c2c8a(0x1fe)),where('loserId','==',_0x4e9e40),limit(0x1)));if(!_0x5494be[_0x4c2c8a(0x1fd)])return _0x5494be['docs'][0x0][_0x4c2c8a(0x1f9)]()['loserUsername']||'Unknown\x20Player';return'Unknown\x20Player';}catch(_0x3635e0){return console['error']('Error\x20getting\x20username:',_0x3635e0),'Unknown\x20Player';}}export async function recordEloChangeD2({playerId:_0x579619,previousElo:_0x3f4e62,newElo:_0x179db4,opponentId:_0xa5a11e,matchResult:_0x3b4a4d,previousPosition:_0x1a19e0,newPosition:_0x583ebb,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x33e6ca,timestamp:_0x32b100}){const _0x744f9e=a14_0x2b757e;try{const _0x42cc7b=doc(collection(db,'eloHistoryD2'));let _0x1e4c48=_0x744f9e(0x200);if(isPromotion)_0x1e4c48=_0x744f9e(0x1fa);if(isDemotion)_0x1e4c48='demotion';let _0x1b57ef='Unranked';if(_0x179db4>=0x834)_0x1b57ef='Emerald';else{if(_0x179db4>=0x708)_0x1b57ef=_0x744f9e(0x1ff);else{if(_0x179db4>=0x640)_0x1b57ef=_0x744f9e(0x1f5);else{if(_0x179db4>=0x578)_0x1b57ef='Bronze';}}}return await setDoc(_0x42cc7b,{'type':_0x1e4c48,'player':_0x579619,'opponent':_0xa5a11e,'previousElo':_0x3f4e62,'newElo':_0x179db4,'change':_0x179db4-_0x3f4e62,'matchResult':_0x3b4a4d,'previousPosition':_0x1a19e0,'newPosition':_0x583ebb,'rankAchieved':_0x1b57ef,'matchId':_0x33e6ca,'timestamp':_0x32b100}),console['log']('D2\x20ELO\x20history\x20recorded\x20for\x20'+_0x579619),!![];}catch(_0x866de5){console['error']('Error\x20recording\x20D2\x20ELO\x20history:',_0x866de5);throw _0x866de5;}}function a14_0x55f9(){const _0x3a15b5=['toString','Silver','winnerId','player','error','data','promotion','timestamp','username','empty','approvedMatchesD2','Gold','match','docs','Unranked','Unknown\x20Player','console','size','all','opponent','previousElo'];a14_0x55f9=function(){return _0x3a15b5;};return a14_0x55f9();}export async function getEloHistoryD2(_0x4d0523=0x14){const _0x3d0813=a14_0x2b757e;try{const _0x49e504=collection(db,'eloHistoryD2');let _0x107d13;lastVisibleD2?_0x107d13=query(_0x49e504,orderBy('timestamp','desc'),startAfter(lastVisibleD2),limit(_0x4d0523)):_0x107d13=query(_0x49e504,orderBy('timestamp','desc'),limit(_0x4d0523));const _0xcfe80d=await getDocs(_0x107d13);if(_0xcfe80d['empty'])return{'entries':[],'hasMore':![]};lastVisibleD2=_0xcfe80d['docs'][_0xcfe80d[_0x3d0813(0x201)]['length']-0x1];const _0x5b921d=_0xcfe80d['docs']['map'](async _0x1272f3=>{const _0x46091f=_0x3d0813,_0x4aee15=_0x1272f3['data'](),[_0x30c7aa,_0x2a5420]=await Promise['all']([getUsernameByIdD2(_0x4aee15[_0x46091f(0x1f7)]),getUsernameByIdD2(_0x4aee15[_0x46091f(0x207)])]);return{..._0x4aee15,'playerUsername':_0x30c7aa,'opponentUsername':_0x2a5420,'change':_0x4aee15['newElo']-_0x4aee15[_0x46091f(0x208)],'timestamp':_0x4aee15[_0x46091f(0x1fb)]};}),_0x2ad6c2=await Promise[_0x3d0813(0x206)](_0x5b921d);return{'entries':_0x2ad6c2,'hasMore':_0xcfe80d[_0x3d0813(0x205)]===_0x4d0523};}catch(_0x282b7d){console[_0x3d0813(0x1f8)]('Error\x20fetching\x20D2\x20ELO\x20history:',_0x282b7d);throw _0x282b7d;}}export function resetPaginationD2(){lastVisibleD2=null;}
(function(_0x4befaf,_0xfd132a){const _0x5a494a=a0_0x3541,_0x454d14=_0x4befaf();while(!![]){try{const _0x3337c6=parseInt(_0x5a494a(0x11c))/0x1+parseInt(_0x5a494a(0x11f))/0x2*(parseInt(_0x5a494a(0x111))/0x3)+-parseInt(_0x5a494a(0x12a))/0x4*(parseInt(_0x5a494a(0x133))/0x5)+-parseInt(_0x5a494a(0x135))/0x6*(-parseInt(_0x5a494a(0x11d))/0x7)+-parseInt(_0x5a494a(0x129))/0x8+-parseInt(_0x5a494a(0x105))/0x9+parseInt(_0x5a494a(0x130))/0xa*(-parseInt(_0x5a494a(0x10b))/0xb);if(_0x3337c6===_0xfd132a)break;else _0x454d14['push'](_0x454d14['shift']());}catch(_0x369762){_0x454d14['push'](_0x454d14['shift']());}}}(a0_0x5c93,0x92394));const a0_0x171d97=(function(){let _0x459b56=!![];return function(_0x47e405,_0x367222){const _0x1e3017=_0x459b56?function(){const _0x1f21a0=a0_0x3541;if(_0x367222){const _0x7b0379=_0x367222[_0x1f21a0(0x12b)](_0x47e405,arguments);return _0x367222=null,_0x7b0379;}}:function(){};return _0x459b56=![],_0x1e3017;};}()),a0_0x9ceebd=a0_0x171d97(this,function(){const _0x571f18=a0_0x3541,_0x2cfbd3=function(){let _0xfac8a1;try{_0xfac8a1=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x1cb077){_0xfac8a1=window;}return _0xfac8a1;},_0x370a44=_0x2cfbd3(),_0x18ec90=_0x370a44['console']=_0x370a44['console']||{},_0x1a6901=['log',_0x571f18(0x10f),'info','error','exception','table','trace'];for(let _0x30d28c=0x0;_0x30d28c<_0x1a6901[_0x571f18(0x101)];_0x30d28c++){const _0x32f273=a0_0x171d97['constructor']['prototype']['bind'](a0_0x171d97),_0x76493d=_0x1a6901[_0x30d28c],_0x12c627=_0x18ec90[_0x76493d]||_0x32f273;_0x32f273[_0x571f18(0x122)]=a0_0x171d97['bind'](a0_0x171d97),_0x32f273['toString']=_0x12c627[_0x571f18(0x127)]['bind'](_0x12c627),_0x18ec90[_0x76493d]=_0x32f273;}});a0_0x9ceebd();function a0_0x3541(_0x18aa12,_0x4a619){const _0x5eb119=a0_0x5c93();return a0_0x3541=function(_0x9ceebd,_0x171d97){_0x9ceebd=_0x9ceebd-0xff;let _0x54d133=_0x5eb119[_0x9ceebd];return _0x54d133;},a0_0x3541(_0x18aa12,_0x4a619);}import{collection,doc,getDoc,getDocs,updateDoc,setDoc,deleteDoc,writeBatch,query,where,serverTimestamp,addDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';import{recordEloChange}from'./elo-history.js';import{promotionManager,checkAndRecordPromotion}from'./promotions.js';function a0_0x5c93(){const _0x1a9264=['\x20points\x20to\x20both\x20players\x20for\x20','907098YIRLtK','Could\x20not\x20find\x20player\x20documents','totalKills','One\x20or\x20both\x20players\x20not\x20found','winnerScore','Assigned\x20default\x20ELO\x20rating\x20to\x20player\x20','players','unknown','checkAndRecordPromotion','wins','Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked','834847kFLEvw','49763clfwZy','min','4HHVjCd','uid','MAX_SAFE_INTEGER','__proto__','position','pointsHistory','exists','email','toString','win','4115280nBQVDA','440112IlwzjH','apply','data','username','log','pow','1334390NLyNOu','userProfiles','winRate','45YqYEDD','Standard','954KZskWC','loserScore','Error\x20in\x20updateEloRatings:','totalMatches','length','max','Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions','currentUser','593991ifzYah','then','totalDeaths','update','displayName','eloRating','33ftJJFx','all','winnerUsername','Unknown\x20User','warn'];a0_0x5c93=function(){return _0x1a9264;};return a0_0x5c93();}import{isAdmin}from'./admin-check.js';import{RANKS,getRankStyle}from'./ranks.js';export function calculateElo(_0x4bdb51,_0x2460a8,_0x2a6b35=0x20){const _0x159fa5=a0_0x3541;_0x4bdb51=_0x4bdb51>0x3e8?0xc8:_0x4bdb51,_0x2460a8=_0x2460a8>0x3e8?0xc8:_0x2460a8;const _0x1c9ada=0x1/(0x1+Math['pow'](0xa,(_0x2460a8-_0x4bdb51)/0x190)),_0x3488f2=0x1/(0x1+Math[_0x159fa5(0x12f)](0xa,(_0x4bdb51-_0x2460a8)/0x190)),_0x2e6221=_0x4bdb51+_0x2a6b35*(0x1-_0x1c9ada),_0x1bd187=_0x2460a8+_0x2a6b35*(0x0-_0x3488f2);return{'newWinnerRating':Math['round'](Math[_0x159fa5(0x11e)](_0x2e6221)),'newLoserRating':Math['round'](Math[_0x159fa5(0x102)](_0x1bd187,0x0))};}export function assignDefaultEloRating(_0x4d29fe,_0x446a42){const _0x13bf5b=a0_0x3541,_0x3c4ef9=0xc8;!_0x446a42[_0x13bf5b(0x10a)]&&db['collection']('players')['doc'](_0x4d29fe)['update']({'eloRating':_0x3c4ef9})[_0x13bf5b(0x106)](()=>{const _0x503407=_0x13bf5b;console['log'](_0x503407(0x116)+_0x446a42['username']);})['catch'](_0x273abd=>{console['error']('Error\x20assigning\x20default\x20ELO\x20rating:',_0x273abd);});}export async function updateEloRatings(_0x5428e1,_0x1a4b58,_0xae697){const _0x144382=a0_0x3541;try{const _0x48c3dc=writeBatch(db),_0x5928fc=doc(db,_0x144382(0x117),_0x5428e1),_0x4184c9=doc(db,'players',_0x1a4b58),[_0x58ea25,_0x6bf84]=await Promise['all']([getDoc(_0x5928fc),getDoc(_0x4184c9)]);if(!_0x58ea25[_0x144382(0x125)]()||!_0x6bf84['exists']())throw new Error(_0x144382(0x114));const _0x350a8c=_0x58ea25[_0x144382(0x12c)](),_0x1be5f2=_0x6bf84[_0x144382(0x12c)](),_0x36eb28=_0x350a8c['position']||Number[_0x144382(0x121)],_0x300c56=_0x1be5f2['position']||Number['MAX_SAFE_INTEGER'],{newWinnerRating:_0x19d125,newLoserRating:_0x2e728a}=calculateElo(_0x350a8c['eloRating']||0x4b0,_0x1be5f2[_0x144382(0x10a)]||0x4b0);let _0x404b25=_0x36eb28,_0x4e96c5=_0x300c56;if(_0x36eb28>_0x300c56){console['log'](_0x144382(0x11b)),_0x404b25=_0x300c56,_0x4e96c5=_0x300c56+0x1;const _0x2372d6=query(collection(db,'players'),where(_0x144382(0x123),'>',_0x300c56),where('position','<',_0x36eb28)),_0x1600f7=await getDocs(_0x2372d6);for(const _0x1559e0 of _0x1600f7['docs']){_0x1559e0['id']!==_0x5428e1&&_0x1559e0['id']!==_0x1a4b58&&_0x48c3dc[_0x144382(0x108)](doc(db,'players',_0x1559e0['id']),{'position':_0x1559e0['data']()['position']+0x1});}}else console['log'](_0x144382(0x103));const _0x3239d8={'eloRating':_0x19d125,'lastMatchDate':serverTimestamp(),'position':_0x404b25,'lastMatchId':_0xae697},_0x1f24f4={'eloRating':_0x2e728a,'lastMatchDate':serverTimestamp(),'position':_0x4e96c5,'lastMatchId':_0xae697};return _0x48c3dc[_0x144382(0x108)](_0x5928fc,_0x3239d8),_0x48c3dc['update'](_0x4184c9,_0x1f24f4),await _0x48c3dc['commit'](),console[_0x144382(0x12e)]('ELO\x20ratings\x20updated\x20successfully'),await Promise['all']([recordEloChange({'playerId':_0x5428e1,'previousElo':_0x350a8c['eloRating']||0x4b0,'newElo':_0x19d125,'opponentId':_0x1a4b58,'matchResult':_0x144382(0x128),'previousPosition':_0x36eb28,'newPosition':_0x404b25,'isPromotion':_0x404b25<_0x36eb28,'matchId':_0xae697,'timestamp':serverTimestamp()}),recordEloChange({'playerId':_0x1a4b58,'previousElo':_0x1be5f2[_0x144382(0x10a)]||0x4b0,'newElo':_0x2e728a,'opponentId':_0x5428e1,'matchResult':'loss','previousPosition':_0x300c56,'newPosition':_0x4e96c5,'isDemotion':_0x4e96c5>_0x300c56,'matchId':_0xae697,'timestamp':serverTimestamp()})]),await promotionManager[_0x144382(0x119)](_0x5428e1,_0x19d125,_0x350a8c['eloRating'],{'source':'match','matchId':_0xae697}),await promotionManager['checkAndRecordPromotion'](_0x1a4b58,_0x2e728a,_0x1be5f2['eloRating'],{'source':'match','matchId':_0xae697}),console['log']('ELO\x20ratings\x20and\x20positions\x20updated\x20successfully'),!![];}catch(_0x427694){console['error'](_0x144382(0xff),_0x427694);throw _0x427694;}}const POINTS_CHART={'':0xa,'Standard':0xa,'Fusion\x20Match':0x19,'â‰¥6\x20Missiles':0xa,'Weapon\x20Imbalance':0x1e,'Blind\x20Match':0x4b,'Rematch':0x14,'Disorientation':0x32,'Ratting':0x23,'Altered\x20Powerups':0x23,'Mega\x20Match':0x28,'Dogfight':0x32,'Gauss\x20and\x20Mercs':0x19,'Misc':0x1e};export async function approveReport(_0x5e5dfa,_0x38e213,_0x49d3e6,_0x2e040a,_0x279769){const _0x259c5e=a0_0x3541;try{const _0x356c6d=doc(db,'pendingMatches',_0x5e5dfa),_0x2c4513=await getDoc(_0x356c6d);if(!_0x2c4513['exists']())throw new Error('Report\x20not\x20found');const _0x2deb51=_0x2c4513[_0x259c5e(0x12c)](),_0x74f135={..._0x2deb51,'winnerScore':_0x38e213,'winnerSuicides':_0x49d3e6,'winnerComment':_0x2e040a,'winnerDemoLink':_0x279769,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':auth[_0x259c5e(0x104)][_0x259c5e(0x120)]};await setDoc(doc(db,'approvedMatches',_0x5e5dfa),_0x74f135),await deleteDoc(_0x356c6d),console['log']('Match\x20moved\x20to\x20approved\x20collection');const [_0x414b57,_0x96ea03]=await Promise['all']([getDocs(query(collection(db,'players'),where('username','==',_0x2deb51[_0x259c5e(0x10d)]))),getDocs(query(collection(db,'players'),where('username','==',_0x2deb51['loserUsername'])))]);if(_0x414b57['empty']||_0x96ea03['empty'])throw new Error(_0x259c5e(0x112));const _0x1ad0e6=_0x414b57['docs'][0x0]['id'],_0x27e774=_0x96ea03['docs'][0x0]['id'];await updateEloRatings(_0x1ad0e6,_0x27e774,_0x5e5dfa);try{const _0x34093d=_0x2deb51['subgameType']||_0x259c5e(0x134),_0xbe25f1=POINTS_CHART[_0x34093d]||0xa,_0x198fc2=doc(db,_0x259c5e(0x131),_0x1ad0e6),_0x3bcdca=doc(db,_0x259c5e(0x131),_0x27e774),[_0x4ff5ed,_0x4b7525]=await Promise[_0x259c5e(0x10c)]([getDoc(_0x198fc2),getDoc(_0x3bcdca)]);if(_0x4ff5ed['exists']()&&_0x4b7525['exists']()){const _0x464bdc=_0x4ff5ed['data'](),_0x974dec=_0x4b7525['data'](),_0x4e9e2b=_0x464bdc['points']||0x0,_0x47634f=_0x974dec['points']||0x0,_0x1338be=_0x4e9e2b+_0xbe25f1,_0x13448d=_0x47634f+_0xbe25f1;await Promise['all']([updateDoc(_0x198fc2,{'points':_0x1338be,'lastPointsModified':serverTimestamp()}),updateDoc(_0x3bcdca,{'points':_0x13448d,'lastPointsModified':serverTimestamp()})]),await Promise['all']([addDoc(collection(db,_0x259c5e(0x124)),{'userId':_0x1ad0e6,'userEmail':_0x464bdc['email']||_0x259c5e(0x118),'displayName':_0x464bdc[_0x259c5e(0x109)]||_0x464bdc[_0x259c5e(0x12d)]||'Unknown\x20User','action':'add','amount':_0xbe25f1,'previousPoints':_0x4e9e2b,'newPoints':_0x1338be,'reason':'Match\x20points:\x20'+_0x34093d+'\x20match\x20(Winner)','adminEmail':'system-match-award','timestamp':serverTimestamp()}),addDoc(collection(db,'pointsHistory'),{'userId':_0x27e774,'userEmail':_0x974dec[_0x259c5e(0x126)]||'unknown','displayName':_0x974dec['displayName']||_0x974dec['username']||_0x259c5e(0x10e),'action':'add','amount':_0xbe25f1,'previousPoints':_0x47634f,'newPoints':_0x13448d,'reason':'Match\x20points:\x20'+_0x34093d+'\x20match\x20(Participant)','adminEmail':'system-match-award','timestamp':serverTimestamp()})]),console[_0x259c5e(0x12e)]('Awarded\x20'+_0xbe25f1+_0x259c5e(0x110)+_0x34093d+'\x20match');}else console['warn']('Could\x20not\x20award\x20points\x20-\x20one\x20or\x20both\x20user\x20profiles\x20not\x20found');}catch(_0x55e2c8){console[_0x259c5e(0x10f)]('Points\x20award\x20failed,\x20but\x20match\x20approval\x20continues:',_0x55e2c8);}return console[_0x259c5e(0x12e)]('Match\x20successfully\x20approved\x20and\x20ELO\x20updated'),!![];}catch(_0x26ea01){console['error']('Error\x20approving\x20report:',_0x26ea01);throw _0x26ea01;}}async function updatePlayerElo(_0x300d58,_0x37f03d,_0x18cdb0){const _0x57da05=a0_0x3541,_0x317082=doc(db,'players',_0x300d58),_0x49cac9=await getDoc(_0x317082),_0x468bf6=_0x49cac9['data'](),_0x1f1aab=doc(db,'playerStats',_0x300d58),_0x1f3bbe=await getDoc(_0x1f1aab),_0x246ae4=_0x1f3bbe[_0x57da05(0x12c)]()||{'totalMatches':0x0,'winRate':0x0},_0x52420b=getRankStyle(_0x18cdb0,_0x246ae4[_0x57da05(0x100)],_0x246ae4['winRate']);await updateDoc(_0x317082,{'eloRating':_0x18cdb0,'rank':_0x52420b['name'],'rankColor':_0x52420b['color']}),await checkAndRecordPromotion(_0x300d58,_0x18cdb0,_0x37f03d,{'matchCount':_0x246ae4[_0x57da05(0x100)],'winRate':_0x246ae4['winRate']});}async function updatePlayerStats(_0x591996,_0x1fa628,_0x4725db){const _0x547e2b=a0_0x3541,_0x372d22=doc(db,'playerStats',_0x591996),_0x41a77f=await getDoc(_0x372d22);let _0x1c5e79=_0x41a77f['exists']()?_0x41a77f['data']():{'wins':0x0,'losses':0x0,'totalKills':0x0,'totalDeaths':0x0,'winRate':0x0};_0x4725db?(_0x1c5e79['wins']++,_0x1c5e79['totalKills']+=parseInt(_0x1fa628[_0x547e2b(0x115)]||0x0),_0x1c5e79[_0x547e2b(0x107)]+=parseInt(_0x1fa628['loserScore']||0x0)):(_0x1c5e79['losses']++,_0x1c5e79[_0x547e2b(0x113)]+=parseInt(_0x1fa628[_0x547e2b(0x136)]||0x0),_0x1c5e79['totalDeaths']+=parseInt(_0x1fa628['winnerScore']||0x0));const _0x372b92=_0x1c5e79[_0x547e2b(0x11a)]+_0x1c5e79['losses'];_0x1c5e79[_0x547e2b(0x132)]=_0x372b92>0x0?(_0x1c5e79['wins']/_0x372b92*0x64)['toFixed'](0x1):0x0,_0x1c5e79['lastUpdated']=new Date()['toISOString'](),await setDoc(_0x372d22,_0x1c5e79,{'merge':!![]});}
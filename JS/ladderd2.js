(function(a,b){const t=a32d,c=a();while(!![]){try{const d=-parseInt(t(0x13e))/0x1*(parseInt(t(0x14c))/0x2)+parseInt(t(0x143))/0x3+parseInt(t(0x14d))/0x4+parseInt(t(0x175))/0x5+-parseInt(t(0x17d))/0x6*(-parseInt(t(0x181))/0x7)+-parseInt(t(0x153))/0x8*(-parseInt(t(0x169))/0x9)+-parseInt(t(0x167))/0xa;if(d===b)break;else c['push'](c['shift']());}catch(e){c['push'](c['shift']());}}}(a32c,0x57d47));const a32b=(function(){let a=!![];return function(b,c){const d=a?function(){if(c){const e=c['apply'](b,arguments);return c=null,e;}}:function(){};return a=![],d;};}()),a32a=a32b(this,function(){const v=a32d,a=function(){const u=a32d;let f;try{f=Function(u(0x172)+u(0x171)+');')();}catch(g){f=window;}return f;},b=a(),c=b['console']=b[v(0x173)]||{},d=['log','warn','info',v(0x16d),'exception',v(0x18e),v(0x148)];for(let e=0x0;e<d[v(0x145)];e++){const f=a32b['constructor'][v(0x16a)]['bind'](a32b),g=d[e],h=c[g]||f;f['__proto__']=a32b[v(0x166)](a32b),f['toString']=h['toString']['bind'](h),c[g]=f;}});a32a();import{collection,getDocs,deleteDoc,doc,getDoc,query,where,updateDoc,Timestamp,onSnapshot,orderBy,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import{getRankStyle}from'./ranks.js';import a32e from'./firebase-idle-wrapper.js';const playerCacheD2={'data':null,'timestamp':0x0},CACHE_DURATION=0x7530;async function displayLadderD2(a=![]){const w=a32d,b=document[w(0x187)]('#ladder-d2\x20tbody');if(!b){console['error']('D2\x20Ladder\x20table\x20body\x20not\x20found');return;}b[w(0x142)]=w(0x14e);try{const c=Date[w(0x140)]();if(!a&&playerCacheD2[w(0x151)]&&c-playerCacheD2[w(0x18f)]<CACHE_DURATION){updateLadderDisplayD2(playerCacheD2[w(0x151)]);return;}const d=collection(db,'playersD2'),e=query(d,orderBy('position','asc')),f=await a32e[w(0x14a)](d),g=[];f[w(0x15e)](m=>{const x=w,n=m[x(0x151)]();n[x(0x165)]&&g[x(0x178)]({...n,'id':m['id'],'elo':n['eloRating']||0x0,'position':n['position']||Number[x(0x133)]});});const h=collection(db,'userProfiles'),i=await getDocs(h),j=new Map();i[w(0x15e)](m=>{const y=w,n=m[y(0x151)]();n[y(0x165)]&&j['set'](n[y(0x165)]['toLowerCase'](),n);});for(const m of g){const n=m[w(0x165)][w(0x135)]();if(j['has'](n)){const o=j[w(0x183)](n);o[w(0x159)]&&(m[w(0x159)]=o[w(0x159)]['toLowerCase']());}}const k=g[w(0x16b)](q=>q['username']),l=await fetchBatchMatchStatsD2(k);g['sort']((p,q)=>{const z=w,r=l['get'](p[z(0x165)])?.['totalMatches']||0x0,s=l[z(0x183)](q[z(0x165)])?.['totalMatches']||0x0;if(r===0x0!==(s===0x0))return r===0x0?0x1:-0x1;return(p['position']||0x3e7)-(q[z(0x18b)]||0x3e7);}),g['forEach']((p,q)=>{const A=w;p[A(0x18b)]=q+0x1;}),playerCacheD2[w(0x151)]=g,playerCacheD2[w(0x18f)]=c,updateLadderDisplayD2(g);}catch(p){console[w(0x16d)](w(0x189),p),b['innerHTML']=w(0x170)+p[w(0x141)]+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';}}function getNextAvailablePositionD2(a){const B=a32d;if(a[B(0x145)]===0x0)return 0x1;let b=0x0;return a[B(0x15e)](c=>{const C=B;c[C(0x18b)]&&typeof c[C(0x18b)]==='number'&&c[C(0x18b)]>b&&(b=c['position']);}),b+0x1;}async function updatePlayerPositions(a,b){const D=a32d;try{const c=collection(db,D(0x15c)),d=await getDocs(c),e=[];d['forEach'](h=>{const E=D;e[E(0x178)]({'id':h['id'],...h['data']()});});const f=e['find'](h=>h['username']===a),g=e['find'](h=>h['username']===b);if(!f||!g){console['error'](D(0x184));return;}if(f['position']>g[D(0x18b)]){const h=g[D(0x18b)];for(const i of e){i[D(0x18b)]>=g['position']&&i[D(0x18b)]<f['position']&&i[D(0x165)]!==a&&await updateDoc(doc(db,'playersD2',i['id']),{'position':i[D(0x18b)]+0x1});}await updateDoc(doc(db,D(0x15c),f['id']),{'position':h});if(h===0x1){const j=doc(db,'playersD2',f['id']),k=await getDoc(j);!k['data']()[D(0x154)]&&await updateDoc(j,{'firstPlaceDate':Timestamp[D(0x140)]()});}if(g['position']===0x1){const l=doc(db,'playersD2',g['id']);await updateDoc(l,{'firstPlaceDate':null});}playerCacheD2['timestamp']=0x0;}}catch(m){console['error']('Error\x20updating\x20D2\x20player\x20positions:',m);}}function a32d(a,b){const c=a32c();return a32d=function(d,e){d=d-0x133;let f=c[d];if(a32d['SyFLGi']===undefined){var g=function(l){const m='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let n='',o='';for(let p=0x0,q,r,s=0x0;r=l['charAt'](s++);~r&&(q=p%0x4?q*0x40+r:r,p++%0x4)?n+=String['fromCharCode'](0xff&q>>(-0x2*p&0x6)):0x0){r=m['indexOf'](r);}for(let t=0x0,u=n['length'];t<u;t++){o+='%'+('00'+n['charCodeAt'](t)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(o);};a32d['IBmgim']=g,a=arguments,a32d['SyFLGi']=!![];}const h=c[0x0],i=d+h,j=a[i];return!j?(f=a32d['IBmgim'](f),a[i]=f):f=j,f;},a32d(a,b);}function calculateStreakDays(a){const F=a32d;if(!a)return 0x0;const b=a['toDate'](),c=new Date(),d=Math['abs'](c-b);return Math[F(0x13b)](d/(0x3e8*0x3c*0x3c*0x18));}function getPlayerRankNameD2(a){const G=a32d;if(a>=0x834)return G(0x182);if(a>=0x708)return G(0x185);if(a>=0x640)return'Silver';if(a>=0x578)return'Bronze';return G(0x17a);}async function updateLadderDisplayD2(a){const H=a32d;a[H(0x137)]((g,h)=>g['position']-h[H(0x18b)]);const b=document[H(0x187)]('#ladder-d2\x20tbody');if(!b)return;b[H(0x142)]='';const c=a['map'](g=>g[H(0x165)]),d=await fetchBatchMatchStatsD2(c),e=document[H(0x187)]('#ladder-d2\x20thead\x20tr');e&&(e[H(0x142)]=H(0x138));const f=a[H(0x16b)](g=>{const h=d['get'](g['username'])||{'totalMatches':0x0,'wins':0x0,'losses':0x0,'kda':0x0,'winRate':0x0,'totalKills':0x0,'totalDeaths':0x0};return createPlayerRowD2(g,h);})['join']('');b['innerHTML']=f,getPlayersLastEloChangesD2(c)[H(0x155)](g=>{const h=new Map();b['querySelectorAll']('tr')['forEach']((i,j)=>{const I=a32d;j<c['length']&&h[I(0x150)](c[j],i);}),g['forEach']((i,j)=>{const J=a32d,k=h[J(0x183)](j);if(k&&i!==0x0){const l=k['querySelector'](J(0x186));if(l){const m=i>0x0?'+'+i:''+i,n=l['querySelector'](J(0x157));n&&(n[J(0x174)]=m,n[J(0x16e)]['color']=i>0x0?J(0x179):'#F44336',n[J(0x16e)][J(0x16f)]='bold',n[J(0x16e)][J(0x152)]=J(0x160),n[J(0x16e)][J(0x134)]=J(0x17c),n['style'][J(0x15a)]='visible',n[J(0x16e)]['opacity']='1');}}});})['catch'](g=>console['error'](H(0x191),g));}function a32c(){const U=['ndGZndi3DgzHD0jZ','rw1LCMfSza','z2v0','q291BgqGBM90igzPBMqGD2LUBMvYig9YigXVC2vYigLUieqYihbSyxLLCNmGBgLZDa','r29Sza','Dgq6BNrOlwnOAwXKkdmP','CxvLCNLtzwXLy3rVCG','i0nen0yZmG','rxjYB3iGBg9HzgLUzYbemIbSywrKzxi6','CgXHEwvYvxnLCM5HBwu','Cg9ZAxrPB24','BMv3rwXV','z3jHEq','DgfIBgu','DgLTzxn0yw1W','jMXHzgrLCJ1KmIiGcIaGicaGicaGicaGicaGicaGicbZDhLSzt0Iy29SB3i6ia','rxjYB3iGDxbKyxrPBMCGrdiGruXpihrYzw5KigLUzgLJyxrVCNm6','tufyx1nbrKvFsu5uruDfuG','zgLZCgXHEq','Dg9mB3DLCKnHC2u','iIakicaGicaGicaGicaGicaGicaGicaGicaGy2XHC3m9iNbSyxLLCI1MBgfNiIakicaGicaGicaGicaGicaGicaGicaGicaGC3r5Bgu9iM1HCMDPBI1Szwz0oIa1ChG7ihzLCNrPy2fSlwfSAwDUoIbTAwrKBgu7iGOGicaGicaGicaGicaGicaGicaGicaGicbVBMvYCM9Ypsj0AgLZlNn0EwXLlMrPC3bSyxK9j25VBMuNiJ4','C29YDa','cIaGicaGicaGicaGidX0Ad5syw5Rpc90Ad4kicaGicaGicaGicaGphrOpLvZzxjUyw1Lpc90Ad4kicaGicaGicaGicaGphrOpKvmtZWVDgG+cIaGicaGicaGicaGidX0Ad5nyxrJAgvZpc90Ad4kicaGicaGicaGicaGphrOpLDPBNm8l3rOpGOGicaGicaGicaGica8DgG+tg9ZC2vZpc90Ad4kicaGicaGicaGicaGphrOpKSVrdWVDgG+cIaGicaGicaGicaGidX0Ad5xAw4GuMf0ztWVDgG+cIaGicaGicaG','rxjYB3iGzMv0y2HPBMCGyMf0y2GGrdiGBwf0y2GGC3rHDhm6','Aw5JBhvKzxm','y2vPBa','i0zgrdCWma','Dg90ywXnyxrJAgvZ','nxHbB2rWza','CgXHEwvY','BM93','BwvZC2fNzq','Aw5Uzxjive1m','mtaZndmWn1LrAg53CW','A2rH','BgvUz3rO','zwXVsgLZDg9YEuqY','D2LUBMvYvxnLCM5HBwu','DhjHy2u','zgvZyW','z2v0rg9JDw1LBNrZ','lNbUzYiGcIaGicaGicaGicaGicaGicaGicaGicaGigfSDd0I','mti2mtG2DujkuNLb','odKYotjywu5KDLK','phrYpJX0zcbJB2XZCgfUpsi4iIbJBgfZCZ0IBg9HzgLUzY1JzwXSiJ5mB2fKAw5NieqYigXHzgrLCIbKyxrHlI4Upc90zd48l3rYpG','oYb0zxH0lwrLy29YyxrPB246ig5VBMu7iJ4kicaGicaGicaGicaGicaGicaGica','C2v0','zgf0yq','zM9UDfnPEMu','mtC5mZy3mKTdCMjgAa','zMLYC3rqBgfJzurHDgu','DgHLBG','zwXV','lNrYzw5KlwLUzgLJyxrVCG','D2LUuMf0zq','y291BNrYEq','DMLZAwjPBgL0Eq','Dg90ywXlAwXSCW','CgXHEwvYC0qY','Dg9gAxHLza','zM9YrwfJAa','Bg9ZC2vZ','mc44nwvT','D2LUBMvYu2nVCMu','D2LUCW','cIaGicaGicaGicaGidWVzgL2pGOGicaGicaGidWVDgq+cIaGicaGicaGphrKihn0EwXLpsjJB2XVCJOG','rdi6ievYCM9YigzLDgnOAw5NievmtYbOAxn0B3j5oG','DxnLCM5HBwu','yMLUza','mtiZodKZnJbUwff3D1a','Dg90ywXezwf0Ahm','ourKqLLbzq','ChjVDg90ExbL','BwfW','AgfZ','zxjYB3i','C3r5Bgu','zM9UDfDLAwDODa','cIaGicaGicaGicaGidX0CJ4kicaGicaGicaGicaGicaGidX0zcbJB2XZCgfUpsi4iIbZDhLSzt0IDgv4Dc1HBgLNBJOGy2vUDgvYoYbJB2XVCJOGCMvKoYi+cIaGicaGicaGicaGicaGicaGicaGrxjYB3iGBg9HzgLUzYbemIbSywrKzxiGzgf0ytOG','E30Uy29UC3rYDwn0B3iOiNjLDhvYBIb0AgLZiIKOicK','CMv0DxjUicHMDw5JDgLVBIGPia','y29UC29Szq','Dgv4DenVBNrLBNq','mZuWnJuXme5OvKLSEq','i0mWqZbdma','pc90zd4kicaGicaGica8Dgq+','ChvZAa','iZrdquy1ma','vw5Yyw5Rzwq','cIaGica8Dhi+cIaGicaGicaGphrKpG','Aw5SAw5L','ntrXrxzgwMq','ChjLDMLVDxnfBg8','igzHBgXIywnRievmtYbJAgfUz2u6ia','y2HHBMDL'];a32c=function(){return U;};return a32c();}function createPlayerRowD2(a,b){const K=a32d,c=parseFloat(a[K(0x156)])||0x0;let d=K(0x18d);if(c>=0x7d0)d='#50C878';else{if(c>=0x708)d=K(0x13c);else{if(c>=0x640)d=K(0x176);else c>=0x578&&(d=K(0x188));}}let e='';return a[K(0x159)]&&(e='<img\x20src=\x22../images/flags/'+a['country']['toLowerCase']()+K(0x14b)+a[K(0x159)]+K(0x136)),K(0x17b)+a['position']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td\x20style=\x22position:\x20relative;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20position:\x20relative;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username='+encodeURIComponent(a['username'])+K(0x190)+d+K(0x14f)+a[K(0x165)]+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+e+K(0x163)+d+';\x20position:\x20relative;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22elo-container\x22\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22elo-value\x22>'+c+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22trend-indicator\x22\x20style=\x22margin-left:\x205px;\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+b[K(0x13d)]+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+b['wins']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+b['losses']+K(0x177)+b[K(0x144)]+K(0x177)+b[K(0x158)]+'%</td>\x0a\x20\x20\x20\x20</tr>';}async function getPlayersLastEloChangesD2(a){const L=a32d,b=new Map();a[L(0x15e)](c=>b[L(0x150)](c,0x0));try{const c=collection(db,L(0x146)),d=query(c,orderBy(L(0x18f),'desc'),limit(0x64)),e=await getDocs(d),f=new Map(),g=await getDocs(collection(db,'playersD2'));g['forEach'](i=>{const M=L,j=i[M(0x151)]();j['username']&&f['set'](i['id'],j[M(0x165)]);});const h=new Map();e['forEach'](i=>{const N=L,j=i['data']();let k=j[N(0x165)]||j['playerUsername'];!k&&j[N(0x13f)]&&f[N(0x16c)](j['player'])&&(k=f['get'](j['player']));if(!k&&j['matchId']){}k&&a['includes'](k)&&(!h[N(0x16c)](k)&&h[N(0x150)](k,[]),h['get'](k)[N(0x178)]({...j,'timestamp':j[N(0x18f)]?.['seconds']||0x0,'username':k}));}),h['forEach']((i,j)=>{const O=L;if(i[O(0x145)]>0x0){i[O(0x137)]((l,m)=>m[O(0x18f)]-l['timestamp']);const k=i['find'](l=>l['change']!==undefined||l['newElo']!==undefined&&l[O(0x17e)]!==undefined);if(k){let l;if(k[O(0x180)]!==undefined)l=k['change'];else k['newElo']!==undefined&&k['previousElo']!==undefined&&(l=k['newElo']-k['previousElo']);l!==undefined&&b['set'](j,l);}}});if(h['size']===0x0){const i=collection(db,'eloHistory'),j=query(i,where('gameMode','==','D2'),orderBy(L(0x18f),L(0x149)),limit(0x32));try{const k=await getDocs(j);console['log']('D2:\x20Found',k['size'],'fallback\x20entries'),k[L(0x15e)](l=>{const P=L,m=l[P(0x151)](),n=m[P(0x165)]||m[P(0x18a)];if(n&&a[P(0x13a)](n)){const o=m['change']||(m[P(0x18c)]!==undefined&&m[P(0x17e)]!==undefined?m[P(0x18c)]-m['previousElo']:0x0);o!==0x0&&(b['set'](n,o),console['log']('D2:\x20'+n+P(0x17f)+o));}});}catch(l){}}}catch(m){console[L(0x16d)](L(0x164),m);}return b;}async function fetchBatchMatchStatsD2(a){const Q=a32d,b=new Map();try{a[Q(0x15e)](e=>{const R=Q;b[R(0x150)](e,{'totalMatches':0x0,'wins':0x0,'losses':0x0,'totalKills':0x0,'totalDeaths':0x0,'kda':0x0,'winRate':0x0});});const c=collection(db,'approvedMatchesD2'),d=await getDocs(c);d[Q(0x15e)](e=>{const S=Q,f=e[S(0x151)](),g=f[S(0x147)],h=f['loserUsername'];if(a[S(0x13a)](g)){const i=b[S(0x183)](g);i[S(0x162)]++,i[S(0x13d)]++,i[S(0x15b)]+=parseInt(f[S(0x161)])||0x0,i[S(0x168)]+=parseInt(f['loserScore'])||0x0;}if(a[S(0x13a)](h)){const j=b['get'](h);j[S(0x15f)]++,j['totalMatches']++,j['totalKills']+=parseInt(f['loserScore'])||0x0,j['totalDeaths']+=parseInt(f['winnerScore'])||0x0;}}),a[Q(0x15e)](e=>{const T=Q,f=b[T(0x183)](e);f[T(0x144)]=f[T(0x168)]>0x0?(f['totalKills']/f[T(0x168)])['toFixed'](0x2):f[T(0x15b)][T(0x15d)](0x2),f[T(0x158)]=f[T(0x13d)]>0x0?(f['wins']/f['totalMatches']*0x64)[T(0x15d)](0x1):0x0;});}catch(e){console['error'](Q(0x139),e);}return b;}export{displayLadderD2,updatePlayerPositions};
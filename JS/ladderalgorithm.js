const a30_0x1571e5=(function(){let _0x4fdc60=!![];return function(_0x41d841,_0x3fe3ad){const _0x3a956e=_0x4fdc60?function(){const _0x5d97c4=a30_0x2c2c;if(_0x3fe3ad){const _0x5eea17=_0x3fe3ad[_0x5d97c4(0x8c)](_0x41d841,arguments);return _0x3fe3ad=null,_0x5eea17;}}:function(){};return _0x4fdc60=![],_0x3a956e;};}()),a30_0x21602f=a30_0x1571e5(this,function(){const _0x4497af=a30_0x2c2c;let _0x5c2e32;try{const _0x25d896=Function('return\x20(function()\x20'+_0x4497af(0xa2)+');');_0x5c2e32=_0x25d896();}catch(_0x1f5ab1){_0x5c2e32=window;}const _0x36858c=_0x5c2e32[_0x4497af(0xa4)]=_0x5c2e32['console']||{},_0x9539a=['log',_0x4497af(0x92),_0x4497af(0x94),'error','exception','table','trace'];for(let _0x206fd7=0x0;_0x206fd7<_0x9539a['length'];_0x206fd7++){const _0x407aa7=a30_0x1571e5['constructor'][_0x4497af(0x9c)]['bind'](a30_0x1571e5),_0x3fbd7a=_0x9539a[_0x206fd7],_0x2a8b06=_0x36858c[_0x3fbd7a]||_0x407aa7;_0x407aa7[_0x4497af(0xa5)]=a30_0x1571e5['bind'](a30_0x1571e5),_0x407aa7[_0x4497af(0x8e)]=_0x2a8b06[_0x4497af(0x8e)][_0x4497af(0xa1)](_0x2a8b06),_0x36858c[_0x3fbd7a]=_0x407aa7;}});a30_0x21602f();import{collection,doc,getDoc,getDocs,updateDoc,setDoc,deleteDoc,writeBatch,query,where,serverTimestamp,addDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a30_0x24fa(){const _0x247d32=['update','apply','losses','toString','winnerScore','lastUpdated','Could\x20not\x20find\x20player\x20documents','warn','exists','info','log','then','data','players','Assigned\x20default\x20ELO\x20rating\x20to\x20player\x20','eloRating','position','prototype','loserScore','wins','pendingMatches','toISOString','bind','{}.constructor(\x22return\x20this\x22)(\x20)','winRate','console','__proto__','username'];a30_0x24fa=function(){return _0x247d32;};return a30_0x24fa();}import{db,auth}from'./firebase-config.js';import{recordEloChange}from'./elo-history.js';import{promotionManager,checkAndRecordPromotion}from'./promotions.js';import{isAdmin}from'./admin-check.js';export function calculateElo(_0x33736a,_0x371ee6,_0x581355=0x20){const _0x438980=0x1/(0x1+Math['pow'](0xa,(_0x371ee6-_0x33736a)/0x190)),_0x49af15=0x1/(0x1+Math['pow'](0xa,(_0x33736a-_0x371ee6)/0x190)),_0x4d2760=_0x33736a+_0x581355*(0x1-_0x438980),_0x16e80d=_0x371ee6+_0x581355*(0x0-_0x49af15);return{'newWinnerRating':Math['round'](_0x4d2760),'newLoserRating':Math['round'](_0x16e80d)};}function a30_0x2c2c(_0x6ae2e,_0x3ddf3f){const _0x21602f=a30_0x24fa();return a30_0x2c2c=function(_0x1571e5,_0x3d1d72){_0x1571e5=_0x1571e5-0x8b;let _0x24fa02=_0x21602f[_0x1571e5];return _0x24fa02;},a30_0x2c2c(_0x6ae2e,_0x3ddf3f);}export function assignDefaultEloRating(_0x878329,_0x314b4e){const _0x4a2b0f=a30_0x2c2c,_0x12d21f=0x4b0;!_0x314b4e['eloRating']&&db['collection']('players')['doc'](_0x878329)['update']({'eloRating':_0x12d21f})[_0x4a2b0f(0x96)](()=>{const _0x1b5d57=_0x4a2b0f;console['log'](_0x1b5d57(0x99)+_0x314b4e[_0x1b5d57(0xa6)]);})['catch'](_0xc8aa7c=>{console['error']('Error\x20assigning\x20default\x20ELO\x20rating:',_0xc8aa7c);});}export async function updateEloRatings(_0x33c180,_0x5e8ba6,_0x165e7a){const _0x41722d=a30_0x2c2c;try{const _0x4c22df=writeBatch(db),_0x1ce3e3=doc(db,'players',_0x33c180),_0x24d872=doc(db,'players',_0x5e8ba6),[_0x9dd4fb,_0x1bee69]=await Promise['all']([getDoc(_0x1ce3e3),getDoc(_0x24d872)]);if(!_0x9dd4fb['exists']()||!_0x1bee69[_0x41722d(0x93)]())throw new Error('One\x20or\x20both\x20players\x20not\x20found');const _0x46eb95=_0x9dd4fb['data'](),_0x1228ac=_0x1bee69['data'](),_0x1093ad=_0x46eb95[_0x41722d(0x9b)]||Number['MAX_SAFE_INTEGER'],_0x3fa6ff=_0x1228ac['position']||Number['MAX_SAFE_INTEGER'],{newWinnerRating:_0x56ac96,newLoserRating:_0x22c125}=calculateElo(_0x46eb95['eloRating']||0x4b0,_0x1228ac[_0x41722d(0x9a)]||0x4b0);let _0x14c3cb=_0x1093ad,_0x1f2e95=_0x3fa6ff;if(_0x1093ad>_0x3fa6ff){console['log']('Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked'),_0x14c3cb=_0x3fa6ff,_0x1f2e95=_0x3fa6ff+0x1;const _0x249402=query(collection(db,'players'),where('position','>',_0x3fa6ff),where('position','<',_0x1093ad)),_0x15485b=await getDocs(_0x249402);for(const _0x27868b of _0x15485b['docs']){_0x27868b['id']!==_0x33c180&&_0x27868b['id']!==_0x5e8ba6&&_0x4c22df[_0x41722d(0x8b)](doc(db,'players',_0x27868b['id']),{'position':_0x27868b[_0x41722d(0x97)]()['position']+0x1});}}else console[_0x41722d(0x95)]('Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions');const _0x4274ee={'eloRating':_0x56ac96,'lastMatchDate':serverTimestamp(),'position':_0x14c3cb,'lastMatchId':_0x165e7a},_0x3b5e26={'eloRating':_0x22c125,'lastMatchDate':serverTimestamp(),'position':_0x1f2e95,'lastMatchId':_0x165e7a};return _0x4c22df[_0x41722d(0x8b)](_0x1ce3e3,_0x4274ee),_0x4c22df['update'](_0x24d872,_0x3b5e26),await _0x4c22df['commit'](),console['log']('ELO\x20ratings\x20updated\x20successfully'),await Promise['all']([recordEloChange({'playerId':_0x33c180,'previousElo':_0x46eb95['eloRating']||0x4b0,'newElo':_0x56ac96,'opponentId':_0x5e8ba6,'matchResult':'win','previousPosition':_0x1093ad,'newPosition':_0x14c3cb,'isPromotion':_0x14c3cb<_0x1093ad,'matchId':_0x165e7a,'timestamp':serverTimestamp()}),recordEloChange({'playerId':_0x5e8ba6,'previousElo':_0x1228ac[_0x41722d(0x9a)]||0x4b0,'newElo':_0x22c125,'opponentId':_0x33c180,'matchResult':'loss','previousPosition':_0x3fa6ff,'newPosition':_0x1f2e95,'isDemotion':_0x1f2e95>_0x3fa6ff,'matchId':_0x165e7a,'timestamp':serverTimestamp()})]),await promotionManager['checkAndRecordPromotion'](_0x33c180,_0x56ac96,_0x46eb95[_0x41722d(0x9a)],{'source':'match','matchId':_0x165e7a}),await promotionManager['checkAndRecordPromotion'](_0x5e8ba6,_0x22c125,_0x1228ac[_0x41722d(0x9a)],{'source':'match','matchId':_0x165e7a}),console['log']('ELO\x20ratings\x20and\x20positions\x20updated\x20successfully'),!![];}catch(_0x3e390e){console['error']('Error\x20in\x20updateEloRatings:',_0x3e390e);throw _0x3e390e;}}export async function approveReport(_0x30c66d,_0x414709,_0x317674,_0x1529de,_0x1028ab){const _0x1cf287=a30_0x2c2c;try{const _0x1f9616=doc(db,_0x1cf287(0x9f),_0x30c66d),_0x5d39d0=await getDoc(_0x1f9616);if(!_0x5d39d0['exists']())throw new Error('Report\x20not\x20found');const _0x4ec601=_0x5d39d0['data'](),_0x49d476={..._0x4ec601,'winnerScore':_0x414709,'winnerSuicides':_0x317674,'winnerComment':_0x1529de,'winnerDemoLink':_0x1028ab,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':auth['currentUser']['uid']};await setDoc(doc(db,'approvedMatches',_0x30c66d),_0x49d476),await deleteDoc(_0x1f9616),console['log']('Match\x20moved\x20to\x20approved\x20collection');const [_0x424585,_0x2a9d01]=await Promise['all']([getDocs(query(collection(db,'players'),where('username','==',_0x4ec601['winnerUsername']))),getDocs(query(collection(db,_0x1cf287(0x98)),where('username','==',_0x4ec601['loserUsername'])))]);if(_0x424585['empty']||_0x2a9d01['empty'])throw new Error(_0x1cf287(0x91));const _0x50d438=_0x424585['docs'][0x0]['id'],_0x2172fd=_0x2a9d01['docs'][0x0]['id'];return await updateEloRatings(_0x50d438,_0x2172fd,_0x30c66d),console['log']('Match\x20successfully\x20approved\x20and\x20ELO\x20updated'),!![];}catch(_0x3ebba9){console['error']('Error\x20approving\x20report:',_0x3ebba9);throw _0x3ebba9;}}async function updatePlayerElo(_0x4d8ae2,_0x2cb822,_0x2b91a5){await setDoc(doc(db,'players',_0x4d8ae2),{...playerData,'eloRating':_0x2b91a5}),await checkAndRecordPromotion(_0x4d8ae2,_0x2b91a5,_0x2cb822);}async function updatePlayerStats(_0xef4495,_0x35fc2f,_0x1602bf){const _0x17558b=a30_0x2c2c,_0x3c280e=doc(db,'playerStats',_0xef4495),_0x3d4fef=await getDoc(_0x3c280e);let _0x33f85c=_0x3d4fef['exists']()?_0x3d4fef['data']():{'wins':0x0,'losses':0x0,'totalKills':0x0,'totalDeaths':0x0,'winRate':0x0};_0x1602bf?(_0x33f85c[_0x17558b(0x9e)]++,_0x33f85c['totalKills']+=parseInt(_0x35fc2f['winnerScore']||0x0),_0x33f85c['totalDeaths']+=parseInt(_0x35fc2f[_0x17558b(0x9d)]||0x0)):(_0x33f85c['losses']++,_0x33f85c['totalKills']+=parseInt(_0x35fc2f['loserScore']||0x0),_0x33f85c['totalDeaths']+=parseInt(_0x35fc2f[_0x17558b(0x8f)]||0x0));const _0xe2aaf0=_0x33f85c['wins']+_0x33f85c[_0x17558b(0x8d)];_0x33f85c[_0x17558b(0xa3)]=_0xe2aaf0>0x0?(_0x33f85c['wins']/_0xe2aaf0*0x64)['toFixed'](0x1):0x0,_0x33f85c[_0x17558b(0x90)]=new Date()[_0x17558b(0xa0)](),await setDoc(_0x3c280e,_0x33f85c,{'merge':!![]});}
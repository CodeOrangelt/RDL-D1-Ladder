function a0_0x33d4(_0x104855,_0x2e23e7){const _0x5a3eb3=a0_0x4dfb();return a0_0x33d4=function(_0x596b03,_0x502eb){_0x596b03=_0x596b03-0x9f;let _0x36724b=_0x5a3eb3[_0x596b03];return _0x36724b;},a0_0x33d4(_0x104855,_0x2e23e7);}(function(_0x15c23e,_0x3baf9e){const _0xf93cd1=a0_0x33d4,_0x3ac4ea=_0x15c23e();while(!![]){try{const _0x2df403=parseInt(_0xf93cd1(0x9f))/0x1*(-parseInt(_0xf93cd1(0xa0))/0x2)+parseInt(_0xf93cd1(0xb9))/0x3+-parseInt(_0xf93cd1(0xc2))/0x4*(parseInt(_0xf93cd1(0xbb))/0x5)+parseInt(_0xf93cd1(0xa4))/0x6*(-parseInt(_0xf93cd1(0xba))/0x7)+parseInt(_0xf93cd1(0xb7))/0x8*(parseInt(_0xf93cd1(0xbe))/0x9)+parseInt(_0xf93cd1(0xbc))/0xa+-parseInt(_0xf93cd1(0xaf))/0xb*(-parseInt(_0xf93cd1(0xa3))/0xc);if(_0x2df403===_0x3baf9e)break;else _0x3ac4ea['push'](_0x3ac4ea['shift']());}catch(_0x5d7931){_0x3ac4ea['push'](_0x3ac4ea['shift']());}}}(a0_0x4dfb,0xe3fa4));const a0_0x502eb=(function(){let _0x3ab330=!![];return function(_0x47e159,_0x54a991){const _0x483640=_0x3ab330?function(){if(_0x54a991){const _0x457af8=_0x54a991['apply'](_0x47e159,arguments);return _0x54a991=null,_0x457af8;}}:function(){};return _0x3ab330=![],_0x483640;};}()),a0_0x596b03=a0_0x502eb(this,function(){const _0x58b50d=a0_0x33d4,_0x1b73ad=function(){let _0x52830e;try{_0x52830e=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x464824){_0x52830e=window;}return _0x52830e;},_0x19f7ac=_0x1b73ad(),_0x25cc17=_0x19f7ac['console']=_0x19f7ac['console']||{},_0x119ea7=['log','warn',_0x58b50d(0xa9),'error','exception','table','trace'];for(let _0x1d6952=0x0;_0x1d6952<_0x119ea7[_0x58b50d(0xa2)];_0x1d6952++){const _0x359e64=a0_0x502eb['constructor']['prototype'][_0x58b50d(0xc0)](a0_0x502eb),_0x3727d0=_0x119ea7[_0x1d6952],_0x1974c=_0x25cc17[_0x3727d0]||_0x359e64;_0x359e64['__proto__']=a0_0x502eb[_0x58b50d(0xc0)](a0_0x502eb),_0x359e64['toString']=_0x1974c[_0x58b50d(0xa5)]['bind'](_0x1974c),_0x25cc17[_0x3727d0]=_0x359e64;}});a0_0x596b03();import{collection,doc,getDoc,getDocs,updateDoc,setDoc,deleteDoc,writeBatch,query,where,serverTimestamp,addDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';import{recordEloChangeD2}from'./elo-history-d2.js';import{promotionManager}from'./promotions.js';import a0_0x2f1b28 from'./firebase-idle-wrapper.js';function a0_0x4dfb(){const _0x3247e7=['playersD2','error','Error\x20in\x20approveReportD2:','log','231esqpAh','round','update','pow','docs','checkAndRecordPromotion','email','D2\x20Report\x20data:','1456DeQWdL','D2\x20Match\x20moved\x20to\x20approved\x20collection','493392KLnPSR','14jSKtWH','5cWuMiu','14477630xaXBHZ','eloRating','23409SUXXyE','position','bind','currentUser','727176ItwcYG','2kizZgA','527866gSjsPT','match-d2','length','611532GuIfdK','4537002gQTdTY','toString','winnerUsername','pendingMatchesD2','Could\x20not\x20find\x20D2\x20player\x20documents','info','D2\x20Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions'];a0_0x4dfb=function(){return _0x3247e7;};return a0_0x4dfb();}export function calculateEloD2(_0x89a350,_0x3352b5,_0x1e17c9=0x20){const _0x515c4e=a0_0x33d4,_0x822fef=0x1/(0x1+Math[_0x515c4e(0xb2)](0xa,(_0x3352b5-_0x89a350)/0x190)),_0x401fc7=0x1/(0x1+Math['pow'](0xa,(_0x89a350-_0x3352b5)/0x190)),_0x3c2a5d=_0x89a350+_0x1e17c9*(0x1-_0x822fef),_0x5d1afe=_0x3352b5+_0x1e17c9*(0x0-_0x401fc7);return{'newWinnerRating':Math[_0x515c4e(0xb0)](_0x3c2a5d),'newLoserRating':Math[_0x515c4e(0xb0)](_0x5d1afe)};}export async function updateEloRatingsD2(_0x4d1406,_0x4edcd7,_0xcd650){const _0x239f01=a0_0x33d4;try{const _0x4e4b29=writeBatch(db),_0x491ae8=doc(db,'playersD2',_0x4d1406),_0x12dcde=doc(db,'playersD2',_0x4edcd7),[_0x3b403d,_0x42ff6a]=await Promise['all']([getDoc(_0x491ae8),getDoc(_0x12dcde)]);if(!_0x3b403d['exists']()||!_0x42ff6a['exists']())throw new Error('One\x20or\x20both\x20D2\x20players\x20not\x20found');const _0x267057=_0x3b403d['data'](),_0x18e805=_0x42ff6a['data'](),_0x34e21e=_0x267057[_0x239f01(0xbf)]||Number['MAX_SAFE_INTEGER'],_0x1eb6d5=_0x18e805[_0x239f01(0xbf)]||Number['MAX_SAFE_INTEGER'],{newWinnerRating:_0x1df9aa,newLoserRating:_0x343554}=calculateEloD2(_0x267057['eloRating']||0x4b0,_0x18e805['eloRating']||0x4b0);let _0x586e76=_0x34e21e,_0x4702cb=_0x1eb6d5;if(_0x34e21e>_0x1eb6d5){console['log']('D2\x20Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked'),_0x586e76=_0x1eb6d5,_0x4702cb=_0x1eb6d5+0x1;const _0x5a6442=query(collection(db,'playersD2'),where(_0x239f01(0xbf),'>',_0x1eb6d5),where(_0x239f01(0xbf),'<',_0x34e21e)),_0x30249c=await getDocs(_0x5a6442);for(const _0x25b641 of _0x30249c['docs']){_0x25b641['id']!==_0x4d1406&&_0x25b641['id']!==_0x4edcd7&&_0x4e4b29['update'](doc(db,'playersD2',_0x25b641['id']),{'position':_0x25b641['data']()['position']+0x1});}}else console[_0x239f01(0xae)](_0x239f01(0xaa));return _0x4e4b29['update'](_0x491ae8,{'eloRating':_0x1df9aa,'lastMatchDate':serverTimestamp(),'position':_0x586e76,'lastMatchId':_0xcd650}),_0x4e4b29[_0x239f01(0xb1)](_0x12dcde,{'eloRating':_0x343554,'lastMatchDate':serverTimestamp(),'position':_0x4702cb,'lastMatchId':_0xcd650}),await _0x4e4b29['commit'](),console['log']('D2\x20ELO\x20ratings\x20updated\x20successfully'),await Promise['all']([recordEloChangeD2({'playerId':_0x4d1406,'previousElo':_0x267057[_0x239f01(0xbd)]||0x4b0,'newElo':_0x1df9aa,'opponentId':_0x4edcd7,'matchResult':'win','previousPosition':_0x34e21e,'newPosition':_0x586e76,'isPromotion':_0x586e76<_0x34e21e,'matchId':_0xcd650,'timestamp':serverTimestamp()}),recordEloChangeD2({'playerId':_0x4edcd7,'previousElo':_0x18e805[_0x239f01(0xbd)]||0x4b0,'newElo':_0x343554,'opponentId':_0x4d1406,'matchResult':'loss','previousPosition':_0x1eb6d5,'newPosition':_0x4702cb,'isDemotion':_0x4702cb>_0x1eb6d5,'matchId':_0xcd650,'timestamp':serverTimestamp()})]),await promotionManager['checkAndRecordPromotion'](_0x4d1406,_0x1df9aa,_0x267057['eloRating'],{'source':_0x239f01(0xa1),'matchId':_0xcd650}),await promotionManager[_0x239f01(0xb4)](_0x4edcd7,_0x343554,_0x18e805['eloRating'],{'source':_0x239f01(0xa1),'matchId':_0xcd650}),!![];}catch(_0x21a6da){console['error']('Error\x20in\x20updateEloRatingsD2:',_0x21a6da);throw _0x21a6da;}}export async function approveReportD2(_0x44d181,_0x375458,_0xfc2479,_0x241bbc){const _0x263681=a0_0x33d4;try{console['log']('Starting\x20approveReportD2\x20function\x20with:',{'reportId':_0x44d181,'winnerScore':_0x375458,'winnerSuicides':_0xfc2479,'winnerComment':_0x241bbc});const _0x4b3360=auth[_0x263681(0xc1)];if(!_0x4b3360){console['log']('No\x20user\x20logged\x20in');throw new Error('You\x20must\x20be\x20logged\x20in\x20to\x20approve\x20D2\x20matches');}console['log']('Current\x20user:',_0x4b3360[_0x263681(0xb5)]);const _0x599457=await getDoc(doc(db,_0x263681(0xab),_0x4b3360['uid'])),_0xb51e98=_0x599457['exists']()?_0x599457['data']()['username']:null;console['log']('Current\x20username:',_0xb51e98);const _0x52cd8a=doc(db,_0x263681(0xa7),_0x44d181),_0x4f2ce3=await getDoc(_0x52cd8a);if(!_0x4f2ce3['exists']()){console['log']('D2\x20Report\x20not\x20found\x20with\x20ID:',_0x44d181);throw new Error('D2\x20match\x20report\x20not\x20found');}const _0x4b1c37=_0x4f2ce3['data']();console['log'](_0x263681(0xb6),_0x4b1c37);if(_0xb51e98!==_0x4b1c37['winnerUsername'])throw new Error('Only\x20the\x20winner\x20can\x20approve\x20D2\x20matches');const _0x488a04={..._0x4b1c37,'winnerScore':_0x375458,'winnerSuicides':_0xfc2479,'winnerComment':_0x241bbc,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':_0xb51e98,'createdAt':_0x4b1c37['createdAt']||serverTimestamp(),'winnerUsername':_0x4b1c37[_0x263681(0xa6)],'loserUsername':_0x4b1c37['loserUsername']};await setDoc(doc(db,'approvedMatchesD2',_0x44d181),_0x488a04),await deleteDoc(_0x52cd8a),console[_0x263681(0xae)](_0x263681(0xb8));const [_0x9841d4,_0x1f6f20]=await Promise['all']([getDocs(query(collection(db,'playersD2'),where('username','==',_0x4b1c37['winnerUsername']))),getDocs(query(collection(db,'playersD2'),where('username','==',_0x4b1c37['loserUsername'])))]);if(_0x9841d4['empty']||_0x1f6f20['empty'])throw new Error(_0x263681(0xa8));const _0x511b08=_0x9841d4[_0x263681(0xb3)][0x0]['id'],_0x4ed0a3=_0x1f6f20['docs'][0x0]['id'];return await updateEloRatingsD2(_0x511b08,_0x4ed0a3,_0x44d181),console['log']('D2\x20Match\x20successfully\x20approved\x20and\x20ELO\x20updated'),!![];}catch(_0x4ce7a0){console[_0x263681(0xac)](_0x263681(0xad),_0x4ce7a0);throw _0x4ce7a0;}}
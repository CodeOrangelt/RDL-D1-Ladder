const a55_0x123a1b=a55_0x5003,a55_0x428bfa=(function(){let _0x20a3b5=!![];return function(_0x3c7ac1,_0x2cabfb){const _0x269ef8=_0x20a3b5?function(){if(_0x2cabfb){const _0x31df0e=_0x2cabfb['apply'](_0x3c7ac1,arguments);return _0x2cabfb=null,_0x31df0e;}}:function(){};return _0x20a3b5=![],_0x269ef8;};}()),a55_0x589e61=a55_0x428bfa(this,function(){const _0x9c8252=a55_0x5003,_0x1eec3d=function(){const _0x412707=a55_0x5003;let _0x16549e;try{_0x16549e=Function('return\x20(function()\x20'+_0x412707(0xf7)+');')();}catch(_0x175f5a){_0x16549e=window;}return _0x16549e;},_0xd6c6de=_0x1eec3d(),_0x51b10f=_0xd6c6de['console']=_0xd6c6de['console']||{},_0x2fe2ba=['log','warn','info','error','exception',_0x9c8252(0xfd),_0x9c8252(0xf8)];for(let _0x1df052=0x0;_0x1df052<_0x2fe2ba['length'];_0x1df052++){const _0x40814a=a55_0x428bfa['constructor'][_0x9c8252(0xf6)][_0x9c8252(0xee)](a55_0x428bfa),_0x5b6247=_0x2fe2ba[_0x1df052],_0x57f599=_0x51b10f[_0x5b6247]||_0x40814a;_0x40814a[_0x9c8252(0x101)]=a55_0x428bfa['bind'](a55_0x428bfa),_0x40814a[_0x9c8252(0xfc)]=_0x57f599[_0x9c8252(0xfc)]['bind'](_0x57f599),_0x51b10f[_0x5b6247]=_0x40814a;}});function a55_0x6a40(){const _0x5b5761=['bind','length','forEach','map','includes','nonParticipants','doc','userProfiles','prototype','{}.constructor(\x22return\x20this\x22)(\x20)','trace','push','now','data','toString','table','playersD3','playersD','get','__proto__','set','eloHistory','timestamp','ladderPlayers'];a55_0x6a40=function(){return _0x5b5761;};return a55_0x6a40();}a55_0x589e61();import{db}from'../firebase-config.js';import{collection,doc,getDoc,getDocs,query,limit,startAfter,where,onSnapshot}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const cache={'userProfiles':new Map(),'ladderPlayers':new Map(),'matchResults':new Map(),'eloHistory':new Map()},CACHE_EXPIRY={'userProfiles':0x5*0x3c*0x3e8,'ladderPlayers':0x2*0x3c*0x3e8,'matchResults':0x1*0x3c*0x3e8,'eloHistory':0x3*0x3c*0x3e8};export const userProfilesRef=collection(db,'userProfiles');export async function fetchPaginatedData(_0x395730,_0x4378bc=0xa,_0x4e0fdd=null){let _0x57a290=query(_0x395730,limit(_0x4378bc));_0x4e0fdd&&(_0x57a290=query(_0x57a290,startAfter(_0x4e0fdd)));const _0x46aaaa=await getDocs(_0x57a290),_0x4091ef=_0x46aaaa['docs'][_0x46aaaa['docs']['length']-0x1];return{'data':_0x46aaaa['docs']['map'](_0x1ad3e0=>({'id':_0x1ad3e0['id'],..._0x1ad3e0['data']()})),'lastVisible':_0x4091ef,'hasMore':_0x46aaaa['docs']['length']===_0x4378bc};}export async function getUserProfile(_0x13edd9){const _0x5dbf73=a55_0x5003,_0x32f40f=cache['userProfiles']['get'](_0x13edd9);if(_0x32f40f&&Date['now']()-_0x32f40f['timestamp']<CACHE_EXPIRY[_0x5dbf73(0xf5)])return _0x32f40f['data'];const _0xb7e1c9=await getDoc(doc(userProfilesRef,_0x13edd9));if(_0xb7e1c9['exists']()){const _0x35bb6b=_0xb7e1c9['data']();return cache[_0x5dbf73(0xf5)]['set'](_0x13edd9,{'data':_0x35bb6b,'timestamp':Date[_0x5dbf73(0xfa)]()}),_0x35bb6b;}return null;}function a55_0x5003(_0x235d60,_0x210b5b){const _0x589e61=a55_0x6a40();return a55_0x5003=function(_0x428bfa,_0x307fbf){_0x428bfa=_0x428bfa-0xee;let _0x6a4017=_0x589e61[_0x428bfa];return _0x6a4017;},a55_0x5003(_0x235d60,_0x210b5b);}export async function getLadderData(_0x1662db=0x1){const _0x11ae97=a55_0x5003,_0x3e0f28='division_'+_0x1662db,_0x3f5e9f=cache[_0x11ae97(0x105)][_0x11ae97(0x100)](_0x3e0f28);if(_0x3f5e9f&&Date['now']()-_0x3f5e9f[_0x11ae97(0x104)]<CACHE_EXPIRY['ladderPlayers'])return _0x3f5e9f['data'];const _0x678acb=_0x1662db===0x1?'players':_0x11ae97(0xff)+_0x1662db,_0x2068ea=collection(db,_0x678acb),_0x4e5943=await getDocs(query(_0x2068ea,limit(0x64))),_0x588098=_0x4e5943['docs']['map'](_0x4c1078=>({'id':_0x4c1078['id'],..._0x4c1078['data']()}));return cache['ladderPlayers'][_0x11ae97(0x102)](_0x3e0f28,{'data':_0x588098,'timestamp':Date[_0x11ae97(0xfa)]()}),_0x588098;}export async function getEloHistoryBatch(_0x27aa47,_0x9f5c00=0x1){const _0x25b992=a55_0x5003,_0x609d5c=_0x9f5c00===0x1?'eloHistory':'eloHistoryD'+_0x9f5c00,_0x3f9365=collection(db,_0x609d5c),_0x6835cc={},_0x2493c0=[];_0x27aa47['forEach'](_0x3ad8cd=>{const _0x189d34=a55_0x5003,_0x6e76e2=_0x3ad8cd+'_'+_0x9f5c00,_0xefe6bb=cache['eloHistory'][_0x189d34(0x100)](_0x6e76e2);_0xefe6bb&&Date[_0x189d34(0xfa)]()-_0xefe6bb['timestamp']<CACHE_EXPIRY['eloHistory']?_0x6835cc[_0x3ad8cd]=_0xefe6bb[_0x189d34(0xfb)]:_0x2493c0[_0x189d34(0xf9)](_0x3ad8cd);});const _0x37856e=0xa;for(let _0x2a4519=0x0;_0x2a4519<_0x2493c0['length'];_0x2a4519+=_0x37856e){const _0x567806=_0x2493c0['slice'](_0x2a4519,_0x2a4519+_0x37856e);if(_0x567806[_0x25b992(0xef)]>0x0)try{const _0x25c161=query(_0x3f9365,where('playerId','in',_0x567806),limit(0x64)),_0x5ac855=await getDocs(_0x25c161);_0x5ac855['docs'][_0x25b992(0xf0)](_0x488950=>{const _0x337fef=_0x25b992,_0x582764=_0x488950['data'](),_0x1d5ba0=_0x582764['playerId'];if(!_0x6835cc[_0x1d5ba0])_0x6835cc[_0x1d5ba0]=[];_0x6835cc[_0x1d5ba0]['push'](_0x582764);const _0x1cc4af=_0x1d5ba0+'_'+_0x9f5c00;cache[_0x337fef(0x103)]['set'](_0x1cc4af,{'data':_0x6835cc[_0x1d5ba0],'timestamp':Date['now']()});});}catch(_0x25c34c){console['error']('Error\x20fetching\x20batch\x20ELO\x20history:',_0x25c34c);}}return _0x6835cc;}let usernameCache=new Map(),usernameCacheTimestamp=Date[a55_0x123a1b(0xfa)]();export function setupEfficientListener(_0x53ec60,_0x4b8711=[],_0x44ec6a){const _0x3412e6=collection(db,_0x53ec60),_0x2d6b78=query(_0x3412e6,..._0x4b8711),_0x50d226=onSnapshot(_0x2d6b78,_0x3e7dcd=>{const _0x421a78=a55_0x5003,_0x35b5d6=_0x3e7dcd['docChanges']()[_0x421a78(0xf1)](_0x2533cb=>({'type':_0x2533cb['type'],'id':_0x2533cb[_0x421a78(0xf4)]['id'],'data':_0x2533cb[_0x421a78(0xf4)]['data']()}));_0x35b5d6['length']>0x0&&_0x44ec6a(_0x35b5d6,_0x3e7dcd['docs']);});return _0x50d226;}export async function bulkResolveUsernames(_0x5af206){const _0x541772=a55_0x123a1b,_0x43f215=new Map();if(!_0x5af206||_0x5af206[_0x541772(0xef)]===0x0)return _0x43f215;const _0x5be774=['players','playersD2',_0x541772(0xfe),_0x541772(0xf3)];for(const _0x391b5b of _0x5be774){const _0x5b7cf0=collection(db,_0x391b5b),_0x4975e4=await getDocs(_0x5b7cf0);_0x4975e4['forEach'](_0x211005=>{const _0x50631d=_0x541772,_0x34459a=_0x211005[_0x50631d(0xfb)]();_0x34459a['username']&&_0x5af206[_0x50631d(0xf2)](_0x211005['id'])&&_0x43f215['set'](_0x211005['id'],_0x34459a['username']);});}return _0x43f215;}
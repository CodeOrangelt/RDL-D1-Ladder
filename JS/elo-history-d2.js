const a14_0x4e6b66=a14_0x5133,a14_0x375834=(function(){let _0x2ebb6b=!![];return function(_0x4147cb,_0x304683){const _0x46fd40=_0x2ebb6b?function(){const _0x3abae6=a14_0x5133;if(_0x304683){const _0x34578a=_0x304683[_0x3abae6(0x1a9)](_0x4147cb,arguments);return _0x304683=null,_0x34578a;}}:function(){};return _0x2ebb6b=![],_0x46fd40;};}()),a14_0x899b1=a14_0x375834(this,function(){const _0x428eec=a14_0x5133,_0x4cb501=function(){let _0x237282;try{_0x237282=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x3f2ab3){_0x237282=window;}return _0x237282;},_0xa34a8a=_0x4cb501(),_0x43bd19=_0xa34a8a['console']=_0xa34a8a[_0x428eec(0x1b5)]||{},_0x2260d4=[_0x428eec(0x1aa),_0x428eec(0x1af),'info','error','exception',_0x428eec(0x1b8),_0x428eec(0x1b2)];for(let _0x26fbaf=0x0;_0x26fbaf<_0x2260d4[_0x428eec(0x1b7)];_0x26fbaf++){const _0x371cb2=a14_0x375834[_0x428eec(0x1ae)]['prototype']['bind'](a14_0x375834),_0x1c3642=_0x2260d4[_0x26fbaf],_0x2c7cf5=_0x43bd19[_0x1c3642]||_0x371cb2;_0x371cb2['__proto__']=a14_0x375834[_0x428eec(0x1ac)](a14_0x375834),_0x371cb2['toString']=_0x2c7cf5[_0x428eec(0x1a7)]['bind'](_0x2c7cf5),_0x43bd19[_0x1c3642]=_0x371cb2;}});function a14_0x4eab(){const _0x1ac56e=['all','username','toString','error','apply','log','demotion','bind','docs','constructor','warn','playersD2','Silver','trace','eloHistoryD2','Unknown\x20Player','console','Bronze','length','table','Error\x20recording\x20D2\x20ELO\x20history:'];a14_0x4eab=function(){return _0x1ac56e;};return a14_0x4eab();}a14_0x899b1();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D2=[{'name':'Gold','elo':0x708},{'name':a14_0x4e6b66(0x1b1),'elo':0x640},{'name':'Bronze','elo':0x578},{'name':'Unranked','elo':0x4b0}];let lastVisibleD2=null;async function getUsernameByIdD2(_0x2adc76){const _0x32d3a8=a14_0x4e6b66;try{if(!_0x2adc76)return _0x32d3a8(0x1b4);const _0x419f92=await getDoc(doc(db,_0x32d3a8(0x1b0),_0x2adc76));if(_0x419f92['exists']())return _0x419f92['data']()[_0x32d3a8(0x1a6)]||'Unknown\x20Player';const _0x32c812=await getDocs(query(collection(db,'approvedMatchesD2'),where('winnerId','==',_0x2adc76),limit(0x1)));if(!_0x32c812['empty'])return _0x32c812['docs'][0x0]['data']()['winnerUsername']||'Unknown\x20Player';const _0x3bb37a=await getDocs(query(collection(db,'approvedMatchesD2'),where('loserId','==',_0x2adc76),limit(0x1)));if(!_0x3bb37a['empty'])return _0x3bb37a[_0x32d3a8(0x1ad)][0x0]['data']()['loserUsername']||'Unknown\x20Player';return'Unknown\x20Player';}catch(_0x7c7da5){return console[_0x32d3a8(0x1a8)]('Error\x20getting\x20username:',_0x7c7da5),'Unknown\x20Player';}}export async function recordEloChangeD2({playerId:_0x4b1ee8,previousElo:_0x5c732c,newElo:_0x54f610,opponentId:_0x1b5a25,matchResult:_0x77c704,previousPosition:_0x3fc09a,newPosition:_0x6d3053,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x393c6d,timestamp:_0x45a91f}){const _0x3d1f3d=a14_0x4e6b66;try{const _0x3dd7ff=doc(collection(db,'eloHistoryD2'));let _0x4673fe='match';if(isPromotion)_0x4673fe='promotion';if(isDemotion)_0x4673fe=_0x3d1f3d(0x1ab);let _0x59e452='Unranked';if(_0x54f610>=0x834)_0x59e452='Emerald';else{if(_0x54f610>=0x708)_0x59e452='Gold';else{if(_0x54f610>=0x640)_0x59e452='Silver';else{if(_0x54f610>=0x578)_0x59e452=_0x3d1f3d(0x1b6);}}}return await setDoc(_0x3dd7ff,{'type':_0x4673fe,'player':_0x4b1ee8,'opponent':_0x1b5a25,'previousElo':_0x5c732c,'newElo':_0x54f610,'change':_0x54f610-_0x5c732c,'matchResult':_0x77c704,'previousPosition':_0x3fc09a,'newPosition':_0x6d3053,'rankAchieved':_0x59e452,'matchId':_0x393c6d,'timestamp':_0x45a91f}),console['log']('D2\x20ELO\x20history\x20recorded\x20for\x20'+_0x4b1ee8),!![];}catch(_0x54ca77){console['error'](_0x3d1f3d(0x1b9),_0x54ca77);throw _0x54ca77;}}function a14_0x5133(_0xe23d6e,_0x14db35){const _0x899b1=a14_0x4eab();return a14_0x5133=function(_0x375834,_0x3acf61){_0x375834=_0x375834-0x1a5;let _0x4eabd3=_0x899b1[_0x375834];return _0x4eabd3;},a14_0x5133(_0xe23d6e,_0x14db35);}export async function getEloHistoryD2(_0x35c467=0x14){const _0x4334e2=a14_0x4e6b66;try{const _0x146df0=collection(db,_0x4334e2(0x1b3));let _0x3155cb;lastVisibleD2?_0x3155cb=query(_0x146df0,orderBy('timestamp','desc'),startAfter(lastVisibleD2),limit(_0x35c467)):_0x3155cb=query(_0x146df0,orderBy('timestamp','desc'),limit(_0x35c467));const _0x3943fb=await getDocs(_0x3155cb);if(_0x3943fb['empty'])return{'entries':[],'hasMore':![]};lastVisibleD2=_0x3943fb['docs'][_0x3943fb['docs'][_0x4334e2(0x1b7)]-0x1];const _0x859735=_0x3943fb[_0x4334e2(0x1ad)]['map'](async _0x579daa=>{const _0x9803e6=_0x4334e2,_0x19dab8=_0x579daa['data'](),[_0x223334,_0x406e61]=await Promise[_0x9803e6(0x1a5)]([getUsernameByIdD2(_0x19dab8['player']),getUsernameByIdD2(_0x19dab8['opponent'])]);return{..._0x19dab8,'playerUsername':_0x223334,'opponentUsername':_0x406e61,'change':_0x19dab8['newElo']-_0x19dab8['previousElo'],'timestamp':_0x19dab8['timestamp']};}),_0x1895c0=await Promise['all'](_0x859735);return{'entries':_0x1895c0,'hasMore':_0x3943fb['size']===_0x35c467};}catch(_0x206f9b){console['error']('Error\x20fetching\x20D2\x20ELO\x20history:',_0x206f9b);throw _0x206f9b;}}export function resetPaginationD2(){lastVisibleD2=null;}
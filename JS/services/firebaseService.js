const a50_0x5c7c26=a50_0x15b0,a50_0x13d4cf=(function(){let _0x4300ca=!![];return function(_0x33289a,_0x2ebe5f){const _0x802880=_0x4300ca?function(){if(_0x2ebe5f){const _0xbb9860=_0x2ebe5f['apply'](_0x33289a,arguments);return _0x2ebe5f=null,_0xbb9860;}}:function(){};return _0x4300ca=![],_0x802880;};}()),a50_0x54be39=a50_0x13d4cf(this,function(){const _0x3b5777=a50_0x15b0,_0x4d0e4b=function(){const _0x4c0c82=a50_0x15b0;let _0x3ef4ec;try{_0x3ef4ec=Function('return\x20(function()\x20'+_0x4c0c82(0x1ab)+');')();}catch(_0x5098f3){_0x3ef4ec=window;}return _0x3ef4ec;},_0x3d8cb9=_0x4d0e4b(),_0x2c88c2=_0x3d8cb9[_0x3b5777(0x1a4)]=_0x3d8cb9['console']||{},_0x59a273=['log','warn','info','error','exception',_0x3b5777(0x1b8),'trace'];for(let _0x140b94=0x0;_0x140b94<_0x59a273['length'];_0x140b94++){const _0x5a0b05=a50_0x13d4cf['constructor'][_0x3b5777(0x1a9)]['bind'](a50_0x13d4cf),_0x5def4f=_0x59a273[_0x140b94],_0x149372=_0x2c88c2[_0x5def4f]||_0x5a0b05;_0x5a0b05[_0x3b5777(0x1af)]=a50_0x13d4cf['bind'](a50_0x13d4cf),_0x5a0b05['toString']=_0x149372['toString'][_0x3b5777(0x1a6)](_0x149372),_0x2c88c2[_0x5def4f]=_0x5a0b05;}});a50_0x54be39();import{db}from'../firebase-config.js';import{collection,doc,getDoc,getDocs,query,limit,startAfter,where,onSnapshot}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a50_0x1af2(){const _0x440568=['console','get','bind','players','eloHistory','prototype','ladderPlayers','{}.constructor(\x22return\x20this\x22)(\x20)','nonParticipants','now','userProfiles','__proto__','username','type','push','timestamp','playerId','data','length','doc','table'];a50_0x1af2=function(){return _0x440568;};return a50_0x1af2();}function a50_0x15b0(_0x3f9b48,_0x23cc3b){const _0x54be39=a50_0x1af2();return a50_0x15b0=function(_0x13d4cf,_0x3e5470){_0x13d4cf=_0x13d4cf-0x1a4;let _0x1af227=_0x54be39[_0x13d4cf];return _0x1af227;},a50_0x15b0(_0x3f9b48,_0x23cc3b);}const cache={'userProfiles':new Map(),'ladderPlayers':new Map(),'matchResults':new Map(),'eloHistory':new Map()},CACHE_EXPIRY={'userProfiles':0x5*0x3c*0x3e8,'ladderPlayers':0x2*0x3c*0x3e8,'matchResults':0x1*0x3c*0x3e8,'eloHistory':0x3*0x3c*0x3e8};export const userProfilesRef=collection(db,a50_0x5c7c26(0x1ae));export async function fetchPaginatedData(_0xa044e1,_0x48bdc3=0xa,_0x3f50d9=null){const _0x50e78e=a50_0x5c7c26;let _0x5a78ab=query(_0xa044e1,limit(_0x48bdc3));_0x3f50d9&&(_0x5a78ab=query(_0x5a78ab,startAfter(_0x3f50d9)));const _0x4f8635=await getDocs(_0x5a78ab),_0x16e020=_0x4f8635['docs'][_0x4f8635['docs'][_0x50e78e(0x1b6)]-0x1];return{'data':_0x4f8635['docs']['map'](_0x51246f=>({'id':_0x51246f['id'],..._0x51246f['data']()})),'lastVisible':_0x16e020,'hasMore':_0x4f8635['docs']['length']===_0x48bdc3};}export async function getUserProfile(_0x45fd28){const _0x5d6151=a50_0x5c7c26,_0x42421a=cache['userProfiles'][_0x5d6151(0x1a5)](_0x45fd28);if(_0x42421a&&Date['now']()-_0x42421a[_0x5d6151(0x1b3)]<CACHE_EXPIRY['userProfiles'])return _0x42421a['data'];const _0x5cda6f=await getDoc(doc(userProfilesRef,_0x45fd28));if(_0x5cda6f['exists']()){const _0x30b02e=_0x5cda6f[_0x5d6151(0x1b5)]();return cache['userProfiles']['set'](_0x45fd28,{'data':_0x30b02e,'timestamp':Date['now']()}),_0x30b02e;}return null;}export async function getLadderData(_0x147d3=0x1){const _0x4bda31=a50_0x5c7c26,_0x56f074='division_'+_0x147d3,_0x12b80d=cache[_0x4bda31(0x1aa)]['get'](_0x56f074);if(_0x12b80d&&Date['now']()-_0x12b80d[_0x4bda31(0x1b3)]<CACHE_EXPIRY['ladderPlayers'])return _0x12b80d['data'];const _0x35a92a=_0x147d3===0x1?'players':'playersD'+_0x147d3,_0xaa39f5=collection(db,_0x35a92a),_0x10f11d=await getDocs(query(_0xaa39f5,limit(0x64))),_0x120430=_0x10f11d['docs']['map'](_0x3a5790=>({'id':_0x3a5790['id'],..._0x3a5790['data']()}));return cache[_0x4bda31(0x1aa)]['set'](_0x56f074,{'data':_0x120430,'timestamp':Date[_0x4bda31(0x1ad)]()}),_0x120430;}export async function getEloHistoryBatch(_0x32ef31,_0x523863=0x1){const _0x579797=a50_0x5c7c26,_0x3b62d3=_0x523863===0x1?_0x579797(0x1a8):'eloHistoryD'+_0x523863,_0x4a933a=collection(db,_0x3b62d3),_0x4f7a6f={},_0x46e819=[];_0x32ef31['forEach'](_0x480c51=>{const _0xb97bb5=_0x579797,_0x1094db=_0x480c51+'_'+_0x523863,_0x76345c=cache[_0xb97bb5(0x1a8)][_0xb97bb5(0x1a5)](_0x1094db);_0x76345c&&Date['now']()-_0x76345c['timestamp']<CACHE_EXPIRY['eloHistory']?_0x4f7a6f[_0x480c51]=_0x76345c['data']:_0x46e819[_0xb97bb5(0x1b2)](_0x480c51);});const _0x46a6da=0xa;for(let _0x133a66=0x0;_0x133a66<_0x46e819['length'];_0x133a66+=_0x46a6da){const _0x2f1f26=_0x46e819['slice'](_0x133a66,_0x133a66+_0x46a6da);if(_0x2f1f26['length']>0x0)try{const _0xc24c22=query(_0x4a933a,where(_0x579797(0x1b4),'in',_0x2f1f26),limit(0x64)),_0x22e20c=await getDocs(_0xc24c22);_0x22e20c['docs']['forEach'](_0x1eb39d=>{const _0x374fde=_0x579797,_0x3efb62=_0x1eb39d[_0x374fde(0x1b5)](),_0x35e1c4=_0x3efb62['playerId'];if(!_0x4f7a6f[_0x35e1c4])_0x4f7a6f[_0x35e1c4]=[];_0x4f7a6f[_0x35e1c4]['push'](_0x3efb62);const _0x37af68=_0x35e1c4+'_'+_0x523863;cache['eloHistory']['set'](_0x37af68,{'data':_0x4f7a6f[_0x35e1c4],'timestamp':Date['now']()});});}catch(_0x51ab56){console['error']('Error\x20fetching\x20batch\x20ELO\x20history:',_0x51ab56);}}return _0x4f7a6f;}let usernameCache=new Map(),usernameCacheTimestamp=Date[a50_0x5c7c26(0x1ad)]();export function setupEfficientListener(_0x1e85ba,_0x497225=[],_0x4aece3){const _0x54d190=collection(db,_0x1e85ba),_0xb7dc01=query(_0x54d190,..._0x497225),_0x3d884c=onSnapshot(_0xb7dc01,_0x3f092d=>{const _0x1d8e56=a50_0x15b0,_0x46dc57=_0x3f092d['docChanges']()['map'](_0x570e86=>({'type':_0x570e86[_0x1d8e56(0x1b1)],'id':_0x570e86[_0x1d8e56(0x1b7)]['id'],'data':_0x570e86['doc'][_0x1d8e56(0x1b5)]()}));_0x46dc57[_0x1d8e56(0x1b6)]>0x0&&_0x4aece3(_0x46dc57,_0x3f092d['docs']);});return _0x3d884c;}export async function bulkResolveUsernames(_0x94f7e1){const _0x229a72=a50_0x5c7c26,_0x41269d=new Map();if(!_0x94f7e1||_0x94f7e1['length']===0x0)return _0x41269d;const _0x23d89c=[_0x229a72(0x1a7),'playersD2','playersD3',_0x229a72(0x1ac)];for(const _0x1c9774 of _0x23d89c){const _0x1d14a0=collection(db,_0x1c9774),_0x1d78ba=await getDocs(_0x1d14a0);_0x1d78ba['forEach'](_0x3d5976=>{const _0x48cd1d=_0x229a72,_0x8d8360=_0x3d5976['data']();_0x8d8360[_0x48cd1d(0x1b0)]&&_0x94f7e1['includes'](_0x3d5976['id'])&&_0x41269d['set'](_0x3d5976['id'],_0x8d8360[_0x48cd1d(0x1b0)]);});}return _0x41269d;}
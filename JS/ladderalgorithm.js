function a30_0x142c(){const _0x449799=['catch','uid','losses','Could\x20not\x20find\x20player\x20documents','return\x20(function()\x20','trace','docs','{}.constructor(\x22return\x20this\x22)(\x20)','winRate','data','loss','winnerUsername','constructor','all','lastUpdated','totalDeaths','log','position','bind','Match\x20successfully\x20approved\x20and\x20ELO\x20updated','wins','warn','commit','username','checkAndRecordPromotion','Match\x20moved\x20to\x20approved\x20collection','update','apply','prototype','toString','players','winnerScore','eloRating','exists'];a30_0x142c=function(){return _0x449799;};return a30_0x142c();}const a30_0x5efc9f=(function(){let _0x57b948=!![];return function(_0x412990,_0x52b393){const _0x165f87=_0x57b948?function(){const _0x513af7=a30_0xed86;if(_0x52b393){const _0x44d183=_0x52b393[_0x513af7(0x135)](_0x412990,arguments);return _0x52b393=null,_0x44d183;}}:function(){};return _0x57b948=![],_0x165f87;};}()),a30_0x2befc3=a30_0x5efc9f(this,function(){const _0x31aa2e=a30_0xed86,_0x346651=function(){const _0x3db700=a30_0xed86;let _0x304f15;try{_0x304f15=Function(_0x3db700(0x11e)+_0x3db700(0x121)+');')();}catch(_0x258969){_0x304f15=window;}return _0x304f15;},_0x1b3393=_0x346651(),_0x3f2ceb=_0x1b3393['console']=_0x1b3393['console']||{},_0x22d560=['log',_0x31aa2e(0x12f),'info','error','exception','table',_0x31aa2e(0x11f)];for(let _0x4db704=0x0;_0x4db704<_0x22d560['length'];_0x4db704++){const _0x2020f5=a30_0x5efc9f[_0x31aa2e(0x126)][_0x31aa2e(0x136)]['bind'](a30_0x5efc9f),_0x5c5d7e=_0x22d560[_0x4db704],_0x142ec3=_0x3f2ceb[_0x5c5d7e]||_0x2020f5;_0x2020f5['__proto__']=a30_0x5efc9f[_0x31aa2e(0x12c)](a30_0x5efc9f),_0x2020f5[_0x31aa2e(0x137)]=_0x142ec3['toString'][_0x31aa2e(0x12c)](_0x142ec3),_0x3f2ceb[_0x5c5d7e]=_0x2020f5;}});a30_0x2befc3();import{collection,doc,getDoc,getDocs,updateDoc,setDoc,deleteDoc,writeBatch,query,where,serverTimestamp,addDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';import{recordEloChange}from'./elo-history.js';import{promotionManager,checkAndRecordPromotion}from'./promotions.js';import{isAdmin}from'./admin-check.js';export function calculateElo(_0x1d3d82,_0x1879d3,_0x4fbf53=0x20){const _0x3b760e=0x1/(0x1+Math['pow'](0xa,(_0x1879d3-_0x1d3d82)/0x190)),_0x1b960a=0x1/(0x1+Math['pow'](0xa,(_0x1d3d82-_0x1879d3)/0x190)),_0x39a6f8=_0x1d3d82+_0x4fbf53*(0x1-_0x3b760e),_0x2aa871=_0x1879d3+_0x4fbf53*(0x0-_0x1b960a);return{'newWinnerRating':Math['round'](_0x39a6f8),'newLoserRating':Math['round'](_0x2aa871)};}function a30_0xed86(_0x2f19ca,_0x5cc541){const _0x2befc3=a30_0x142c();return a30_0xed86=function(_0x5efc9f,_0x50e813){_0x5efc9f=_0x5efc9f-0x11a;let _0x142c65=_0x2befc3[_0x5efc9f];return _0x142c65;},a30_0xed86(_0x2f19ca,_0x5cc541);}export function assignDefaultEloRating(_0x79f7f6,_0x3eddbf){const _0x515022=a30_0xed86,_0x6fb726=0x4b0;!_0x3eddbf['eloRating']&&db['collection']('players')['doc'](_0x79f7f6)['update']({'eloRating':_0x6fb726})['then'](()=>{console['log']('Assigned\x20default\x20ELO\x20rating\x20to\x20player\x20'+_0x3eddbf['username']);})[_0x515022(0x11a)](_0x471124=>{console['error']('Error\x20assigning\x20default\x20ELO\x20rating:',_0x471124);});}export async function updateEloRatings(_0x4ff1ff,_0x3c452c,_0x2cac10){const _0xb05eec=a30_0xed86;try{const _0xcf9c17=writeBatch(db),_0x3d1760=doc(db,'players',_0x4ff1ff),_0x17bef2=doc(db,'players',_0x3c452c),[_0x27677d,_0x4c4bdd]=await Promise['all']([getDoc(_0x3d1760),getDoc(_0x17bef2)]);if(!_0x27677d[_0xb05eec(0x13b)]()||!_0x4c4bdd['exists']())throw new Error('One\x20or\x20both\x20players\x20not\x20found');const _0x13ab2e=_0x27677d[_0xb05eec(0x123)](),_0x33acec=_0x4c4bdd['data'](),_0x107ba0=_0x13ab2e[_0xb05eec(0x12b)]||Number['MAX_SAFE_INTEGER'],_0xb0a2d4=_0x33acec[_0xb05eec(0x12b)]||Number['MAX_SAFE_INTEGER'],{newWinnerRating:_0x476440,newLoserRating:_0x27e141}=calculateElo(_0x13ab2e[_0xb05eec(0x13a)]||0x4b0,_0x33acec['eloRating']||0x4b0);let _0x59a81a=_0x107ba0,_0x1375b1=_0xb0a2d4;if(_0x107ba0>_0xb0a2d4){console['log']('Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked'),_0x59a81a=_0xb0a2d4,_0x1375b1=_0xb0a2d4+0x1;const _0x164024=query(collection(db,'players'),where('position','>',_0xb0a2d4),where('position','<',_0x107ba0)),_0x162278=await getDocs(_0x164024);for(const _0x4fa88c of _0x162278['docs']){_0x4fa88c['id']!==_0x4ff1ff&&_0x4fa88c['id']!==_0x3c452c&&_0xcf9c17['update'](doc(db,'players',_0x4fa88c['id']),{'position':_0x4fa88c['data']()['position']+0x1});}}else console[_0xb05eec(0x12a)]('Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions');const _0x40f813={'eloRating':_0x476440,'lastMatchDate':serverTimestamp(),'position':_0x59a81a,'lastMatchId':_0x2cac10},_0x585c18={'eloRating':_0x27e141,'lastMatchDate':serverTimestamp(),'position':_0x1375b1,'lastMatchId':_0x2cac10};return _0xcf9c17[_0xb05eec(0x134)](_0x3d1760,_0x40f813),_0xcf9c17['update'](_0x17bef2,_0x585c18),await _0xcf9c17[_0xb05eec(0x130)](),console['log']('ELO\x20ratings\x20updated\x20successfully'),await Promise['all']([recordEloChange({'playerId':_0x4ff1ff,'previousElo':_0x13ab2e['eloRating']||0x4b0,'newElo':_0x476440,'opponentId':_0x3c452c,'matchResult':'win','previousPosition':_0x107ba0,'newPosition':_0x59a81a,'isPromotion':_0x59a81a<_0x107ba0,'matchId':_0x2cac10,'timestamp':serverTimestamp()}),recordEloChange({'playerId':_0x3c452c,'previousElo':_0x33acec['eloRating']||0x4b0,'newElo':_0x27e141,'opponentId':_0x4ff1ff,'matchResult':_0xb05eec(0x124),'previousPosition':_0xb0a2d4,'newPosition':_0x1375b1,'isDemotion':_0x1375b1>_0xb0a2d4,'matchId':_0x2cac10,'timestamp':serverTimestamp()})]),await promotionManager['checkAndRecordPromotion'](_0x4ff1ff,_0x476440,_0x13ab2e['eloRating'],{'source':'match','matchId':_0x2cac10}),await promotionManager[_0xb05eec(0x132)](_0x3c452c,_0x27e141,_0x33acec['eloRating'],{'source':'match','matchId':_0x2cac10}),console['log']('ELO\x20ratings\x20and\x20positions\x20updated\x20successfully'),!![];}catch(_0x1fe04f){console['error']('Error\x20in\x20updateEloRatings:',_0x1fe04f);throw _0x1fe04f;}}export async function approveReport(_0x48ea53,_0x50fb9c,_0x33d256,_0x4e9e89,_0x4a87be){const _0x303175=a30_0xed86;try{const _0xda0e14=doc(db,'pendingMatches',_0x48ea53),_0x1040b4=await getDoc(_0xda0e14);if(!_0x1040b4['exists']())throw new Error('Report\x20not\x20found');const _0x3ad76a=_0x1040b4['data'](),_0x3cd85b={..._0x3ad76a,'winnerScore':_0x50fb9c,'winnerSuicides':_0x33d256,'winnerComment':_0x4e9e89,'winnerDemoLink':_0x4a87be,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':auth['currentUser'][_0x303175(0x11b)]};await setDoc(doc(db,'approvedMatches',_0x48ea53),_0x3cd85b),await deleteDoc(_0xda0e14),console['log'](_0x303175(0x133));const [_0x4c263d,_0x15f55b]=await Promise[_0x303175(0x127)]([getDocs(query(collection(db,'players'),where(_0x303175(0x131),'==',_0x3ad76a[_0x303175(0x125)]))),getDocs(query(collection(db,_0x303175(0x138)),where(_0x303175(0x131),'==',_0x3ad76a['loserUsername'])))]);if(_0x4c263d['empty']||_0x15f55b['empty'])throw new Error(_0x303175(0x11d));const _0x53660a=_0x4c263d['docs'][0x0]['id'],_0x1acde3=_0x15f55b[_0x303175(0x120)][0x0]['id'];return await updateEloRatings(_0x53660a,_0x1acde3,_0x48ea53),console['log'](_0x303175(0x12d)),!![];}catch(_0x3acca5){console['error']('Error\x20approving\x20report:',_0x3acca5);throw _0x3acca5;}}async function updatePlayerElo(_0x270613,_0x4c3913,_0x5422f2){await setDoc(doc(db,'players',_0x270613),{...playerData,'eloRating':_0x5422f2}),await checkAndRecordPromotion(_0x270613,_0x5422f2,_0x4c3913);}async function updatePlayerStats(_0x2ce0e9,_0xe4b8b2,_0x2f4949){const _0x2eb9ea=a30_0xed86,_0x4fbd87=doc(db,'playerStats',_0x2ce0e9),_0x869013=await getDoc(_0x4fbd87);let _0x510cb8=_0x869013['exists']()?_0x869013['data']():{'wins':0x0,'losses':0x0,'totalKills':0x0,'totalDeaths':0x0,'winRate':0x0};_0x2f4949?(_0x510cb8['wins']++,_0x510cb8['totalKills']+=parseInt(_0xe4b8b2[_0x2eb9ea(0x139)]||0x0),_0x510cb8[_0x2eb9ea(0x129)]+=parseInt(_0xe4b8b2['loserScore']||0x0)):(_0x510cb8[_0x2eb9ea(0x11c)]++,_0x510cb8['totalKills']+=parseInt(_0xe4b8b2['loserScore']||0x0),_0x510cb8['totalDeaths']+=parseInt(_0xe4b8b2[_0x2eb9ea(0x139)]||0x0));const _0x25103c=_0x510cb8[_0x2eb9ea(0x12e)]+_0x510cb8['losses'];_0x510cb8[_0x2eb9ea(0x122)]=_0x25103c>0x0?(_0x510cb8['wins']/_0x25103c*0x64)['toFixed'](0x1):0x0,_0x510cb8[_0x2eb9ea(0x128)]=new Date()['toISOString'](),await setDoc(_0x4fbd87,_0x510cb8,{'merge':!![]});}
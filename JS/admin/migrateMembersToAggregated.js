import{initializeApp}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';import{getFirestore,collection,getDocs,writeBatch,doc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{firebaseConfig}from'../firebase-config.js';function a1_0x17b2(){const _0x22065c=['profileImageUrl','üíæ\x20Writing\x20aggregated\x20data...','toString','üéâ\x20Successfully\x20migrated\x20','name','get','\x20unique\x20members','apply','set','size','eloRating','üöÄ\x20Executing\x20','‚öôÔ∏è\x20Processed\x20','‚úÖ\x20Data\x20fetched:\x20','country','\x20members\x20processed)','active','console','nonParticipants','\x20D2,\x20','‚ùå\x20Migration\x20failed:','forEach','elo','code','\x20batches...','__proto__','commit','bronze','ladder','log','table','error','motto','{}.constructor(\x22return\x20this\x22)(\x20)','all','unranked','username','playersD3','bind','isNonParticipant'];a1_0x17b2=function(){return _0x22065c;};return a1_0x17b2();}const app=initializeApp(firebaseConfig),db=getFirestore(app);async function migrateToAggregatedMembers(){const _0x22ba4c=a1_0x2b0b,_0x35a38c=(function(){let _0x54c3b3=!![];return function(_0x43b1fa,_0x57586a){const _0x24549c=_0x54c3b3?function(){const _0xf6aea9=a1_0x2b0b;if(_0x57586a){const _0x2c1494=_0x57586a[_0xf6aea9(0xf6)](_0x43b1fa,arguments);return _0x57586a=null,_0x2c1494;}}:function(){};return _0x54c3b3=![],_0x24549c;};}()),_0x15c3bf=_0x35a38c(this,function(){const _0x16b345=a1_0x2b0b;let _0x2cdc68;try{const _0x541e78=Function('return\x20(function()\x20'+_0x16b345(0x110)+');');_0x2cdc68=_0x541e78();}catch(_0x5a42dd){_0x2cdc68=window;}const _0x34172c=_0x2cdc68[_0x16b345(0x100)]=_0x2cdc68['console']||{},_0x5a1c89=['log','warn','info','error','exception',_0x16b345(0x10d),'trace'];for(let _0x565755=0x0;_0x565755<_0x5a1c89['length'];_0x565755++){const _0x510372=_0x35a38c['constructor']['prototype']['bind'](_0x35a38c),_0xcef074=_0x5a1c89[_0x565755],_0x2d61d3=_0x34172c[_0xcef074]||_0x510372;_0x510372[_0x16b345(0x108)]=_0x35a38c['bind'](_0x35a38c),_0x510372['toString']=_0x2d61d3[_0x16b345(0xf1)][_0x16b345(0x115)](_0x2d61d3),_0x34172c[_0xcef074]=_0x510372;}});_0x15c3bf(),console[_0x22ba4c(0x10c)]('üîÑ\x20Starting\x20migration\x20to\x20aggregated\x20members...');try{console['log']('üì•\x20Fetching\x20all\x20collections...');const [_0x4f835d,_0x365ec9,_0x145911,_0x24674c,_0x5585fe]=await Promise[_0x22ba4c(0x111)]([getDocs(collection(db,'userProfiles')),getDocs(collection(db,'players')),getDocs(collection(db,'playersD2')),getDocs(collection(db,_0x22ba4c(0x114))),getDocs(collection(db,_0x22ba4c(0x101)))]);console[_0x22ba4c(0x10c)](_0x22ba4c(0xfc)+_0x4f835d['size']+'\x20profiles,\x20'+_0x365ec9[_0x22ba4c(0xf8)]+'\x20D1,\x20'+_0x145911['size']+_0x22ba4c(0x102)+_0x24674c['size']+'\x20D3,\x20'+_0x5585fe['size']+'\x20non-participants');const _0x57ca59=new Map();_0x4f835d[_0x22ba4c(0x104)](_0x3f9ddd=>{const _0x39c2ba=_0x22ba4c;_0x57ca59[_0x39c2ba(0xf7)](_0x3f9ddd['id'],_0x3f9ddd['data']());});const _0x4cc4d9=new Map(),_0x5b657d=(_0x228ce7,_0x1e4543)=>{_0x228ce7['forEach'](_0x15e2ca=>{const _0x992522=a1_0x2b0b,_0x5d9f6f=_0x15e2ca['data'](),_0x5d7b26=_0x15e2ca['id'];!_0x4cc4d9['has'](_0x5d7b26)&&_0x4cc4d9['set'](_0x5d7b26,{'userId':_0x5d7b26,'username':_0x5d9f6f[_0x992522(0x113)]||_0x5d9f6f['name']||'Unknown','ladders':[],'isNonParticipant':![]});const _0x4232d3=_0x4cc4d9[_0x992522(0xf4)](_0x5d7b26);_0x4232d3['ladders']['push']({'ladder':_0x1e4543,'elo':_0x5d9f6f[_0x992522(0xf9)]||_0x5d9f6f['elo']||0x4b0,'active':_0x5d9f6f[_0x992522(0xff)]!==![]});});};_0x5b657d(_0x365ec9,'D1'),_0x5b657d(_0x145911,'D2'),_0x5b657d(_0x24674c,'D3'),_0x5585fe[_0x22ba4c(0x104)](_0x19f6c0=>{const _0x442745=_0x22ba4c,_0x5ae95f=_0x19f6c0['data'](),_0x5b0c56=_0x19f6c0['id'];!_0x4cc4d9['has'](_0x5b0c56)&&(_0x5ae95f['username']||_0x5ae95f['name'])&&_0x4cc4d9['set'](_0x5b0c56,{'userId':_0x5b0c56,'username':_0x5ae95f[_0x442745(0x113)]||_0x5ae95f[_0x442745(0xf3)],'ladders':[],'isNonParticipant':!![]});}),console['log'](_0x22ba4c(0xfb)+_0x4cc4d9[_0x22ba4c(0xf8)]+_0x22ba4c(0xf5)),console[_0x22ba4c(0x10c)](_0x22ba4c(0xf0));const _0x1512de=[];let _0x350bc3=writeBatch(db),_0x6d9c3d=0x0,_0x1475c2=0x0;_0x4cc4d9[_0x22ba4c(0x104)]((_0x279063,_0x1038fc)=>{const _0x256c1f=_0x22ba4c,_0x5772f3=_0x57ca59[_0x256c1f(0xf4)](_0x1038fc)||{};let _0x23753d=0x0,_0x143d9f=null;if(_0x279063['ladders']['length']>0x0){const _0x9ac4a6=_0x279063['ladders']['sort']((_0xe3e965,_0xe205c1)=>_0xe205c1['elo']-_0xe3e965['elo']);_0x23753d=_0x9ac4a6[0x0][_0x256c1f(0x105)],_0x143d9f=_0x9ac4a6[0x0][_0x256c1f(0x10b)];}const _0x4adbcf={'userId':_0x1038fc,'username':_0x279063['username'],'profileImageUrl':_0x5772f3[_0x256c1f(0xef)]||null,'country':_0x5772f3[_0x256c1f(0xfd)]||null,'motto':_0x5772f3[_0x256c1f(0x10f)]||null,'favoriteMap':_0x5772f3['favoriteMap']||null,'favoriteWeapon':_0x5772f3['favoriteWeapon']||null,'isNonParticipant':_0x279063[_0x256c1f(0x116)],'ladders':_0x279063['ladders'],'primaryLadder':_0x143d9f,'highestElo':_0x23753d,'rank':getPlayerRank(_0x23753d),'lastUpdated':new Date(),'migrationTimestamp':new Date()['toISOString']()},_0x2964e9=doc(collection(db,'aggregatedMembers'),_0x1038fc);_0x350bc3['set'](_0x2964e9,_0x4adbcf),_0x6d9c3d++,_0x1475c2++,_0x6d9c3d>=0x1c2&&(_0x1512de['push'](_0x350bc3[_0x256c1f(0x109)]()),_0x350bc3=writeBatch(db),_0x6d9c3d=0x0,console['log']('üì¶\x20Prepared\x20batch\x20'+_0x1512de['length']+'\x20('+_0x1475c2+_0x256c1f(0xfe)));}),_0x6d9c3d>0x0&&_0x1512de['push'](_0x350bc3[_0x22ba4c(0x109)]()),console[_0x22ba4c(0x10c)](_0x22ba4c(0xfa)+_0x1512de['length']+_0x22ba4c(0x107)),await Promise['all'](_0x1512de),console['log'](_0x22ba4c(0xf2)+_0x4cc4d9['size']+'\x20members\x20to\x20aggregated\x20collection!'),console[_0x22ba4c(0x10c)]('üí°\x20Refresh\x20your\x20members\x20page\x20to\x20see\x20the\x20results!');}catch(_0x3b2992){console['error'](_0x22ba4c(0x103),_0x3b2992),_0x3b2992[_0x22ba4c(0x106)]==='permission-denied'&&console[_0x22ba4c(0x10e)]('üîí\x20Permission\x20denied.\x20Make\x20sure\x20you\x27re\x20signed\x20in\x20as\x20an\x20admin\x20and\x20security\x20rules\x20allow\x20access\x20to\x20aggregatedMembers\x20collection.');}}function getPlayerRank(_0x137a70){const _0x27a4fb=a1_0x2b0b;if(_0x137a70>=0x7d0)return'emerald';if(_0x137a70>=0x708)return'gold';if(_0x137a70>=0x640)return'silver';if(_0x137a70>=0x578)return _0x27a4fb(0x10a);return _0x27a4fb(0x112);}function a1_0x2b0b(_0x2f9b36,_0x9ab698){const _0x518366=a1_0x17b2();return a1_0x2b0b=function(_0x404d81,_0x1e4043){_0x404d81=_0x404d81-0xef;let _0x17b202=_0x518366[_0x404d81];return _0x17b202;},a1_0x2b0b(_0x2f9b36,_0x9ab698);}migrateToAggregatedMembers();
(function(a,b){const w=a30d,c=a();while(!![]){try{const d=parseInt(w(0x1ae))/0x1+-parseInt(w(0x1d6))/0x2+parseInt(w(0x1d5))/0x3+-parseInt(w(0x1cc))/0x4+-parseInt(w(0x1a4))/0x5*(-parseInt(w(0x1ad))/0x6)+-parseInt(w(0x1bd))/0x7+parseInt(w(0x1d9))/0x8*(parseInt(w(0x1d0))/0x9);if(d===b)break;else c['push'](c['shift']());}catch(e){c['push'](c['shift']());}}}(a30c,0x8bb2c));const a30b=(function(){let a=!![];return function(b,c){const d=a?function(){if(c){const e=c['apply'](b,arguments);return c=null,e;}}:function(){};return a=![],d;};}()),a30a=a30b(this,function(){const y=a30d,a=function(){const x=a30d;let f;try{f=Function(x(0x1ab)+x(0x1d2)+');')();}catch(g){f=window;}return f;},b=a(),c=b[y(0x1b7)]=b['console']||{},d=[y(0x1bf),'warn',y(0x1c4),y(0x1b8),'exception',y(0x1d7),y(0x1aa)];for(let e=0x0;e<d[y(0x1af)];e++){const f=a30b[y(0x1d8)][y(0x1b4)][y(0x1b5)](a30b),g=d[e],h=c[g]||f;f[y(0x1ac)]=a30b['bind'](a30b),f[y(0x1b9)]=h[y(0x1b9)]['bind'](h),c[g]=f;}});a30a();import{collection,doc,getDoc,getDocs,updateDoc,setDoc,deleteDoc,writeBatch,query,where,serverTimestamp,addDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a30d(a,b){const c=a30c();return a30d=function(d,e){d=d-0x1a4;let f=c[d];if(a30d['MHjnUJ']===undefined){var g=function(l){const m='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let n='',o='';for(let p=0x0,q,r,s=0x0;r=l['charAt'](s++);~r&&(q=p%0x4?q*0x40+r:r,p++%0x4)?n+=String['fromCharCode'](0xff&q>>(-0x2*p&0x6)):0x0){r=m['indexOf'](r);}for(let t=0x0,u=n['length'];t<u;t++){o+='%'+('00'+n['charCodeAt'](t)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(o);};a30d['KtCjLS']=g,a=arguments,a30d['MHjnUJ']=!![];}const h=c[0x0],i=d+h,j=a[i];return!j?(f=a30d['KtCjLS'](f),a[i]=f):f=j,f;},a30d(a,b);}import{db,auth}from'./firebase-config.js';import{recordEloChange}from'./elo-history.js';import{promotionManager,checkAndRecordPromotion}from'./promotions.js';import{isAdmin}from'./admin-check.js';export function calculateElo(a,b,c=0x20){const z=a30d,d=0x1/(0x1+Math['pow'](0xa,(b-a)/0x190)),e=0x1/(0x1+Math['pow'](0xa,(a-b)/0x190)),f=a+c*(0x1-d),g=b+c*(0x0-e);return{'newWinnerRating':Math[z(0x1c3)](f),'newLoserRating':Math[z(0x1c3)](g)};}export function assignDefaultEloRating(a,b){const A=a30d,c=0x4b0;!b[A(0x1c8)]&&db['collection'](A(0x1cb))[A(0x1b6)](a)['update']({'eloRating':c})['then'](()=>{const B=A;console[B(0x1bf)](B(0x1b0)+b[B(0x1b2)]);})[A(0x1a7)](d=>{console['error']('Error\x20assigning\x20default\x20ELO\x20rating:',d);});}export async function updateEloRatings(a,b,c){const C=a30d;try{const d=writeBatch(db),e=doc(db,'players',a),f=doc(db,C(0x1cb),b),[g,h]=await Promise['all']([getDoc(e),getDoc(f)]);if(!g[C(0x1c0)]()||!h['exists']())throw new Error('One\x20or\x20both\x20players\x20not\x20found');const i=g[C(0x1c7)](),j=h['data'](),k=i['position']||Number['MAX_SAFE_INTEGER'],l=j['position']||Number['MAX_SAFE_INTEGER'],{newWinnerRating:m,newLoserRating:n}=calculateElo(i['eloRating']||0x4b0,j[C(0x1c8)]||0x4b0);let o=k,p=l;if(k>l){console[C(0x1bf)](C(0x1d3)),o=l,p=l+0x1;const s=query(collection(db,'players'),where(C(0x1a5),'>',l),where('position','<',k)),t=await getDocs(s);for(const u of t[C(0x1ca)]){u['id']!==a&&u['id']!==b&&d['update'](doc(db,'players',u['id']),{'position':u[C(0x1c7)]()['position']+0x1});}}else console['log']('Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions');const q={'eloRating':m,'lastMatchDate':serverTimestamp(),'position':o,'lastMatchId':c},r={'eloRating':n,'lastMatchDate':serverTimestamp(),'position':p,'lastMatchId':c};return d[C(0x1a9)](e,q),d[C(0x1a9)](f,r),await d[C(0x1a8)](),console[C(0x1bf)](C(0x1c5)),await Promise[C(0x1be)]([recordEloChange({'playerId':a,'previousElo':i['eloRating']||0x4b0,'newElo':m,'opponentId':b,'matchResult':C(0x1c9),'previousPosition':k,'newPosition':o,'isPromotion':o<k,'matchId':c,'timestamp':serverTimestamp()}),recordEloChange({'playerId':b,'previousElo':j['eloRating']||0x4b0,'newElo':n,'opponentId':a,'matchResult':C(0x1da),'previousPosition':l,'newPosition':p,'isDemotion':p>l,'matchId':c,'timestamp':serverTimestamp()})]),await promotionManager['checkAndRecordPromotion'](a,m,i['eloRating'],{'source':'match','matchId':c}),await promotionManager[C(0x1d1)](b,n,j['eloRating'],{'source':C(0x1ce),'matchId':c}),console[C(0x1bf)](C(0x1db)),!![];}catch(v){console[C(0x1b8)]('Error\x20in\x20updateEloRatings:',v);throw v;}}export async function approveReport(a,b,c,d,e){const D=a30d;try{const f=doc(db,'pendingMatches',a),g=await getDoc(f);if(!g['exists']())throw new Error('Report\x20not\x20found');const h=g['data'](),i={...h,'winnerScore':b,'winnerSuicides':c,'winnerComment':d,'winnerDemoLink':e,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':auth['currentUser']['uid']};await setDoc(doc(db,'approvedMatches',a),i),await deleteDoc(f),console[D(0x1bf)]('Match\x20moved\x20to\x20approved\x20collection');const [j,k]=await Promise['all']([getDocs(query(collection(db,'players'),where('username','==',h[D(0x1cf)]))),getDocs(query(collection(db,'players'),where(D(0x1b2),'==',h[D(0x1cd)])))]);if(j['empty']||k[D(0x1b3)])throw new Error('Could\x20not\x20find\x20player\x20documents');const l=j[D(0x1ca)][0x0]['id'],m=k['docs'][0x0]['id'];return await updateEloRatings(l,m,a),console[D(0x1bf)]('Match\x20successfully\x20approved\x20and\x20ELO\x20updated'),!![];}catch(n){console['error'](D(0x1a6),n);throw n;}}function a30c(){const G=['Cg9ZAxrPB24','rxjYB3iGyxbWCM92Aw5NihjLCg9YDdO','y2f0y2G','y29TBwL0','DxbKyxrL','DhjHy2u','CMv0DxjUicHMDw5JDgLVBIGPia','x19WCM90B19F','nMnWqNrita','nJG0nJmZvNnSAuzf','BgvUz3rO','qxnZAwDUzwqGzgvMyxvSDcbfte8GCMf0Aw5NihrVihbSyxLLCIa','Dg90ywXlAwXSCW','DxnLCM5HBwu','zw1WDhK','ChjVDg90ExbL','yMLUza','zg9J','y29UC29Szq','zxjYB3i','Dg9tDhjPBMC','Bg9Zzxjty29Yzq','Dg90ywXezwf0Ahm','Dg9ju09tDhjPBMC','ndC2nJq1ng91z3zdwG','ywXS','Bg9N','zxHPC3rZ','D2LUCW','Bg9ZC2vZ','CM91BMq','Aw5MBW','ruXpihjHDgLUz3mGDxbKyxrLzcbZDwnJzxnZzNvSBhK','D2LUBMvYu2nVCMu','zgf0yq','zwXVuMf0Aw5N','D2LU','zg9JCW','CgXHEwvYCW','mZK3mdm4ohH3yuDXEq','Bg9ZzxjvC2vYBMfTzq','Bwf0y2G','D2LUBMvYvxnLCM5HBwu','ow5PCev6vW','y2HLy2TbBMrszwnVCMrqCM9TB3rPB24','E30Uy29UC3rYDwn0B3iOiNjLDhvYBIb0AgLZiIKOicK','ug9ZAxrPB24GC3DHCcbUzwvKzwqGlsb3Aw5UzxiGD2fZigXVD2vYihjHBMTLza','Dg9gAxHLza','ntiXodHlBwTMC0K','mteYntqWnNHqCxDXuq','DgfIBgu','y29UC3rYDwn0B3i','mtm4oduWmtzgvffJq2O','Bg9ZCW','ruXpihjHDgLUz3mGyw5KihbVC2L0Aw9UCYb1CgrHDgvKihn1y2nLC3nMDwXSEq','mtG1mZG1mgTmu1Pwrq'];a30c=function(){return G;};return a30c();}async function updatePlayerElo(a,b,c){const E=a30d;await setDoc(doc(db,E(0x1cb),a),{...playerData,'eloRating':c}),await checkAndRecordPromotion(a,c,b);}async function updatePlayerStats(a,b,c){const F=a30d,d=doc(db,'playerStats',a),e=await getDoc(d);let f=e[F(0x1c0)]()?e[F(0x1c7)]():{'wins':0x0,'losses':0x0,'totalKills':0x0,'totalDeaths':0x0,'winRate':0x0};c?(f['wins']++,f[F(0x1b1)]+=parseInt(b[F(0x1c6)]||0x0),f['totalDeaths']+=parseInt(b[F(0x1ba)]||0x0)):(f[F(0x1c2)]++,f['totalKills']+=parseInt(b['loserScore']||0x0),f[F(0x1bb)]+=parseInt(b[F(0x1c6)]||0x0));const g=f[F(0x1c1)]+f['losses'];f['winRate']=g>0x0?(f[F(0x1c1)]/g*0x64)[F(0x1d4)](0x1):0x0,f['lastUpdated']=new Date()[F(0x1bc)](),await setDoc(d,f,{'merge':!![]});}
const a35_0x1f4afb=a35_0x3736,a35_0x41cb01=(function(){let _0x54c1af=!![];return function(_0x54333c,_0x5e0c2e){const _0x10a575=_0x54c1af?function(){if(_0x5e0c2e){const _0x448107=_0x5e0c2e['apply'](_0x54333c,arguments);return _0x5e0c2e=null,_0x448107;}}:function(){};return _0x54c1af=![],_0x10a575;};}()),a35_0x5ba5c6=a35_0x41cb01(this,function(){const _0x14fb9b=a35_0x3736,_0x1b9501=function(){const _0x3fdae3=a35_0x3736;let _0x39a992;try{_0x39a992=Function(_0x3fdae3(0x1f8)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x44fa40){_0x39a992=window;}return _0x39a992;},_0x4a0dcc=_0x1b9501(),_0x191243=_0x4a0dcc['console']=_0x4a0dcc['console']||{},_0x395f80=['log',_0x14fb9b(0x1da),'info','error',_0x14fb9b(0x1d7),'table',_0x14fb9b(0x1df)];for(let _0x32b660=0x0;_0x32b660<_0x395f80['length'];_0x32b660++){const _0x33a887=a35_0x41cb01['constructor']['prototype'][_0x14fb9b(0x1ed)](a35_0x41cb01),_0xa7fcc1=_0x395f80[_0x32b660],_0x2efb0f=_0x191243[_0xa7fcc1]||_0x33a887;_0x33a887[_0x14fb9b(0x1e5)]=a35_0x41cb01['bind'](a35_0x41cb01),_0x33a887['toString']=_0x2efb0f['toString']['bind'](_0x2efb0f),_0x191243[_0xa7fcc1]=_0x33a887;}});a35_0x5ba5c6();const functions=require('firebase-functions'),admin=require('firebase-admin');admin[a35_0x1f4afb(0x1dc)]();function a35_0x3736(_0x3ed468,_0x14a634){const _0x5ba5c6=a35_0x1da3();return a35_0x3736=function(_0x41cb01,_0x48f13e){_0x41cb01=_0x41cb01-0x1d3;let _0x1da3cb=_0x5ba5c6[_0x41cb01];return _0x1da3cb;},a35_0x3736(_0x3ed468,_0x14a634);}const db=admin['firestore']();exports[a35_0x1f4afb(0x1d8)]=functions['firestore']['document'](a35_0x1f4afb(0x1f2))['onWrite'](async(_0x54d53,_0x3e1ffc)=>{const _0x1451d9=a35_0x1f4afb,_0x91a2de=_0x3e1ffc[_0x1451d9(0x1d6)]['collection'],_0x5490d9=_0x3e1ffc['params'][_0x1451d9(0x1f3)];if(![_0x1451d9(0x1de),_0x1451d9(0x1e6),'playersD3','userProfiles','nonParticipants']['includes'](_0x91a2de))return null;try{await rebuildMembersList(),console['log'](_0x1451d9(0x1e7));}catch(_0x453a82){console[_0x1451d9(0x1ee)](_0x1451d9(0x1e1),_0x453a82);}});function a35_0x1da3(){const _0x11235d=['data','doc','motto','params','exception','updateMembersList','elo','warn','all','initializeApp','forEach','players','trace','favoriteMap','Error\x20updating\x20members\x20list:','collection','status','username','__proto__','playersD2','Successfully\x20updated\x20aggregated\x20members\x20list','unranked','get','ladders','country','nonParticipants','bind','error','has','delete','userProfiles','{collection}/{docId}','docId','gold','set','send','profileImageUrl','return\x20(function()\x20','silver'];a35_0x1da3=function(){return _0x11235d;};return a35_0x1da3();}async function rebuildMembersList(){const _0x37b07d=a35_0x1f4afb,_0x5aa011=db['batch'](),[_0xf9f1d7,_0x16faef,_0x3f5612,_0x283f1b,_0x5343a4]=await Promise['all']([db[_0x37b07d(0x1e2)](_0x37b07d(0x1f1))['get'](),db[_0x37b07d(0x1e2)](_0x37b07d(0x1de))['get'](),db['collection']('playersD2')['get'](),db['collection']('playersD3')['get'](),db['collection'](_0x37b07d(0x1ec))['get']()]),_0x37e5fe=new Map();_0xf9f1d7[_0x37b07d(0x1dd)](_0x35c239=>{const _0x5214f8=_0x37b07d;_0x37e5fe['set'](_0x35c239['id'],_0x35c239[_0x5214f8(0x1d3)]());});const _0x34364a=new Map(),_0x3e4fe8=(_0x116c94,_0x1df567)=>{_0x116c94['forEach'](_0xd046e4=>{const _0x42ff18=a35_0x3736,_0xaf34ce=_0xd046e4['data'](),_0x4db4f6=_0xd046e4['id'];!_0x34364a['has'](_0x4db4f6)&&_0x34364a[_0x42ff18(0x1f5)](_0x4db4f6,{'userId':_0x4db4f6,'username':_0xaf34ce['username']||'Unknown','ladders':[],'isNonParticipant':![]});const _0x106606=_0x34364a['get'](_0x4db4f6);_0x106606[_0x42ff18(0x1ea)]['push']({'ladder':_0x1df567,'elo':_0xaf34ce['eloRating']||0x4b0,'active':_0xaf34ce['active']!==![]});});};_0x3e4fe8(_0x16faef,'D1'),_0x3e4fe8(_0x3f5612,'D2'),_0x3e4fe8(_0x283f1b,'D3'),_0x5343a4['forEach'](_0x88b1a5=>{const _0x8ed10e=_0x37b07d,_0x3bbc10=_0x88b1a5['data'](),_0x27b8b0=_0x88b1a5['id'];!_0x34364a[_0x8ed10e(0x1ef)](_0x27b8b0)&&_0x3bbc10['username']&&_0x34364a['set'](_0x27b8b0,{'userId':_0x27b8b0,'username':_0x3bbc10['username'],'ladders':[],'isNonParticipant':!![]});});const _0x3c13b0=[];_0x34364a['forEach']((_0x391164,_0x431183)=>{const _0x412979=_0x37b07d,_0x59fdac=_0x37e5fe[_0x412979(0x1e9)](_0x431183)||{};let _0x5030ee=0x0,_0x316c4e=null;if(_0x391164['ladders']['length']>0x0){const _0x56dc3a=_0x391164[_0x412979(0x1ea)]['sort']((_0x1c83bd,_0x8bf47e)=>_0x8bf47e['elo']-_0x1c83bd[_0x412979(0x1d9)]);_0x5030ee=_0x56dc3a[0x0]['elo'],_0x316c4e=_0x56dc3a[0x0]['ladder'];}const _0x27c529={'userId':_0x431183,'username':_0x391164[_0x412979(0x1e4)],'profileImageUrl':_0x59fdac[_0x412979(0x1f7)]||null,'country':_0x59fdac[_0x412979(0x1eb)]||null,'motto':_0x59fdac[_0x412979(0x1d5)]||null,'favoriteMap':_0x59fdac[_0x412979(0x1e0)]||null,'favoriteWeapon':_0x59fdac['favoriteWeapon']||null,'isNonParticipant':_0x391164['isNonParticipant'],'ladders':_0x391164[_0x412979(0x1ea)],'primaryLadder':_0x316c4e,'highestElo':_0x5030ee,'rank':getPlayerRank(_0x5030ee),'lastUpdated':admin['firestore']['FieldValue']['serverTimestamp']()};_0x3c13b0['push'](_0x27c529);});const _0x4dcd63=db['collection']('aggregatedMembers'),_0x133485=await _0x4dcd63[_0x37b07d(0x1e9)](),_0x122fab=[];_0x133485['forEach'](_0x13cb93=>{const _0x1d2026=_0x37b07d;_0x122fab['push'](_0x13cb93['ref'][_0x1d2026(0x1f0)]());}),await Promise['all'](_0x122fab);const _0x152674=0x1f4,_0x390121=[];for(let _0x27f1c9=0x0;_0x27f1c9<_0x3c13b0['length'];_0x27f1c9+=_0x152674){const _0x5bd15d=db['batch'](),_0x29d10e=_0x3c13b0['slice'](_0x27f1c9,_0x27f1c9+_0x152674);_0x29d10e['forEach'](_0x332048=>{const _0x1150fa=_0x37b07d,_0x16bc90=_0x4dcd63[_0x1150fa(0x1d4)](_0x332048['userId']);_0x5bd15d['set'](_0x16bc90,_0x332048);}),_0x390121['push'](_0x5bd15d['commit']());}await Promise[_0x37b07d(0x1db)](_0x390121);}function getPlayerRank(_0x294c06){const _0x1745b6=a35_0x1f4afb;if(_0x294c06>=0x7d0)return'emerald';if(_0x294c06>=0x708)return _0x1745b6(0x1f4);if(_0x294c06>=0x640)return _0x1745b6(0x1f9);if(_0x294c06>=0x578)return'bronze';return _0x1745b6(0x1e8);}exports['rebuildMembersListManual']=functions['https']['onRequest'](async(_0x58922b,_0x531804)=>{const _0x361a4e=a35_0x1f4afb;try{await rebuildMembersList(),_0x531804['status'](0xc8)[_0x361a4e(0x1f6)]('Members\x20list\x20rebuilt\x20successfully');}catch(_0x3de147){console['error']('Error\x20rebuilding\x20members\x20list:',_0x3de147),_0x531804[_0x361a4e(0x1e3)](0x1f4)['send']('Error\x20rebuilding\x20members\x20list');}});
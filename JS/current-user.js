const a10_0x306132=(function(){let _0x3005c3=!![];return function(_0x4ed5b,_0x104cd3){const _0x7a6b86=_0x3005c3?function(){if(_0x104cd3){const _0x1fabdc=_0x104cd3['apply'](_0x4ed5b,arguments);return _0x104cd3=null,_0x1fabdc;}}:function(){};return _0x3005c3=![],_0x7a6b86;};}()),a10_0x3e5a26=a10_0x306132(this,function(){const _0x12bb59=a10_0x488e;let _0x576610;try{const _0x9ac369=Function('return\x20(function()\x20'+_0x12bb59(0xb4)+');');_0x576610=_0x9ac369();}catch(_0x4edded){_0x576610=window;}const _0x14eb99=_0x576610['console']=_0x576610['console']||{},_0x24edcd=[_0x12bb59(0xb6),_0x12bb59(0xb9),'info','error','exception',_0x12bb59(0xc6),'trace'];for(let _0x3c687e=0x0;_0x3c687e<_0x24edcd['length'];_0x3c687e++){const _0x18ff98=a10_0x306132['constructor']['prototype']['bind'](a10_0x306132),_0x2de297=_0x24edcd[_0x3c687e],_0x21617a=_0x14eb99[_0x2de297]||_0x18ff98;_0x18ff98['__proto__']=a10_0x306132[_0x12bb59(0xbe)](a10_0x306132),_0x18ff98['toString']=_0x21617a['toString']['bind'](_0x21617a),_0x14eb99[_0x2de297]=_0x18ff98;}});a10_0x3e5a26();function a10_0x1e69(){const _0x50b9aa=['.admin-only','catch','{}.constructor(\x22return\x20this\x22)(\x20)','creative\x20lead','log','exists','map','warn','filter','checkInterval','addEventListener','username','bind','now','roleName','slice','display','style','getElementById','empty','table','includes','\x20(Admin)','nonParticipants','playersD3','role','\x20by\x20email:','none','Found\x20user\x20in\x20','signOut','join','split','isAdmin','target','inline-block','Error\x20checking\x20','data','gameInvitations','email','uid','inbox-notification'];a10_0x1e69=function(){return _0x50b9aa;};return a10_0x1e69();}import{getAuth,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{doc,getDoc,collection,query,where,getDocs,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import{isAdmin}from'./admin-check.js';const ADMIN_EMAILS=['admin@ladder.com','Brian2af@outlook.com'],userCache={'uid':null,'username':null,'isAdmin':![],'hasCheckedCollections':![],'lastChecked':0x0,'role':null},invitationCache={'lastCheck':0x0,'pendingCount':0x0,'checkInterval':0x493e0};function updateInboxNotification(_0x3a6ce8){const _0x1c324f=a10_0x488e,_0x383f62=document[_0x1c324f(0xc4)](_0x1c324f(0xda));_0x383f62&&(_0x3a6ce8>0x0?(_0x383f62[_0x1c324f(0xc3)][_0x1c324f(0xc2)]=_0x1c324f(0xd4),_0x383f62['textContent']=_0x3a6ce8>0x9?'9+':_0x3a6ce8):_0x383f62[_0x1c324f(0xc3)][_0x1c324f(0xc2)]=_0x1c324f(0xcd));}async function checkPendingInvitationsForCurrentUser(_0x144fbc){const _0x16fef9=a10_0x488e;try{const _0x195091=Date[_0x16fef9(0xbf)]();if(_0x195091-invitationCache['lastCheck']<invitationCache[_0x16fef9(0xbb)])return updateInboxNotification(invitationCache['pendingCount']),invitationCache['pendingCount'];invitationCache['lastCheck']=_0x195091;const _0x51d95d=collection(db,_0x16fef9(0xd7)),_0x28c49a=query(_0x51d95d,where('toUserId','==',_0x144fbc),where('status','==','pending'),limit(0x5)),_0x543dab=await getDocs(_0x28c49a),_0x1ddd90=_0x543dab['size'];return invitationCache['pendingCount']=_0x1ddd90,updateInboxNotification(_0x1ddd90),_0x1ddd90;}catch(_0x4a03d0){return console['warn']('Could\x20not\x20check\x20pending\x20invitations\x20for\x20current\x20user:',_0x4a03d0),0x0;}}function updateAuthSectionImmediate(_0xaba875,_0x91cb74=![]){const _0x3dc8f9=a10_0x488e,_0x4f7246=document['getElementById']('auth-section');if(!_0x4f7246)return;if(_0xaba875&&_0x91cb74)document['querySelectorAll']('.admin-only')['forEach'](_0x5f5eee=>{const _0x1b91f4=a10_0x488e;_0x5f5eee['style'][_0x1b91f4(0xc2)]='block';});else!_0xaba875&&document['querySelectorAll']('.admin-only')['forEach'](_0x3ed7e1=>{_0x3ed7e1['style']['display']='none';});if(_0xaba875){const _0x1d1b20=userCache['username']||(_0xaba875['email']?_0xaba875[_0x3dc8f9(0xd8)][_0x3dc8f9(0xd1)]('@')[0x0]:'User'),_0x2dba33=userCache['role']?'\x20('+userCache['role']+')':_0x91cb74?_0x3dc8f9(0xc8):'';_0x4f7246['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20class=\x22nav-username\x22>'+_0x1d1b20+_0x2dba33+'</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username='+encodeURIComponent(_0x1d1b20)+'\x22>Profile</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./inbox.html\x22\x20class=\x22nav-notification\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Inbox\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22inbox-notification\x22\x20class=\x22notification-dot\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22members.html\x22>Members</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./redeem.html\x22><i\x20class=\x22fas\x20fa-gift\x22></i>Store</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20id=\x22logout-link\x22>Sign\x20Out</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';const _0x11cf30=document['getElementById']('logout-link');_0x11cf30&&_0x11cf30[_0x3dc8f9(0xbc)]('click',_0x4bbbd5=>{const _0x2aea9e=_0x3dc8f9;_0x4bbbd5['preventDefault']();const _0x4e8c10=getAuth();updateAuthSectionImmediate(null),_0x4e8c10[_0x2aea9e(0xcf)]()['catch'](_0x159643=>{console['error']('Error\x20signing\x20out:',_0x159643);});}),_0xaba875['uid']&&setTimeout(()=>{const _0x6c14ec=_0x3dc8f9;checkPendingInvitationsForCurrentUser(_0xaba875[_0x6c14ec(0xd9)]);},0x3e8);}else _0x4f7246['innerHTML']='<a\x20href=\x22login.html\x22\x20class=\x22login-link\x22>Login</a>';}async function checkAdminRoles(_0x55ba2e){const _0x389181=a10_0x488e;if(!_0x55ba2e||!_0x55ba2e['email'])return{'isAdmin':![],'role':null};try{console[_0x389181(0xb6)]('Checking\x20roles\x20for\x20user:\x20'+_0x55ba2e['email']);const _0x531f40=['players','playersD2',_0x389181(0xca),'nonParticipants','userProfiles'],_0x54cd1a=['council',_0x389181(0xb5),'owner','admin'];for(const _0x180ae0 of _0x531f40){try{const _0x3ec6e6=doc(db,_0x180ae0,_0x55ba2e[_0x389181(0xd9)]),_0x217144=await getDoc(_0x3ec6e6);if(_0x217144[_0x389181(0xb7)]()){const _0x10e414=_0x217144['data']();console['log'](_0x389181(0xce)+_0x180ae0+'\x20by\x20UID:',_0x10e414);let _0xa5ee1d=(_0x10e414[_0x389181(0xc0)]||_0x10e414['role']||'')['toLowerCase'](),_0x37afef=_0x10e414[_0x389181(0xc0)]||_0x10e414['role']||'';if(_0xa5ee1d&&_0x54cd1a[_0x389181(0xc7)](_0xa5ee1d)){console[_0x389181(0xb6)]('Found\x20admin\x20role:\x20'+_0xa5ee1d+'\x20in\x20'+_0x180ae0);const _0x5119c6=_0x37afef[_0x389181(0xd1)]('\x20')[_0x389181(0xb8)](_0x44b3b4=>_0x44b3b4['charAt'](0x0)['toUpperCase']()+_0x44b3b4[_0x389181(0xc1)](0x1)['toLowerCase']())['join']('\x20');return{'isAdmin':!![],'role':_0x5119c6};}}}catch(_0x338cc){console['error']('Error\x20checking\x20'+_0x180ae0+'\x20by\x20UID:',_0x338cc);}}for(const _0x46afcb of _0x531f40){try{const _0x470ce6=collection(db,_0x46afcb);let _0x2a06f4=query(_0x470ce6,where('email','==',_0x55ba2e['email'])),_0x32fbe6=await getDocs(_0x2a06f4);_0x32fbe6[_0x389181(0xc5)]&&(_0x2a06f4=query(_0x470ce6,where('email','==',_0x55ba2e['email']['toLowerCase']())),_0x32fbe6=await getDocs(_0x2a06f4));if(!_0x32fbe6[_0x389181(0xc5)]){const _0x24b95e=_0x32fbe6['docs'][0x0][_0x389181(0xd6)]();console['log'](_0x389181(0xce)+_0x46afcb+'\x20by\x20email:',_0x24b95e);let _0x18e638=(_0x24b95e[_0x389181(0xc0)]||_0x24b95e[_0x389181(0xcb)]||'')['toLowerCase'](),_0x3f744e=_0x24b95e[_0x389181(0xc0)]||_0x24b95e[_0x389181(0xcb)]||'';if(_0x18e638&&_0x54cd1a[_0x389181(0xc7)](_0x18e638)){console['log']('Found\x20admin\x20role:\x20'+_0x18e638+'\x20in\x20'+_0x46afcb);const _0x4eab51=_0x3f744e['split']('\x20')['map'](_0x376a51=>_0x376a51['charAt'](0x0)['toUpperCase']()+_0x376a51['slice'](0x1)['toLowerCase']())[_0x389181(0xd0)]('\x20');return{'isAdmin':!![],'role':_0x4eab51};}}}catch(_0x52f1dd){console['error'](_0x389181(0xd5)+_0x46afcb+_0x389181(0xcc),_0x52f1dd);}}return console[_0x389181(0xb6)]('No\x20admin\x20roles\x20found\x20for\x20user'),{'isAdmin':![],'role':null};}catch(_0x2b0a1e){return console['error']('Error\x20in\x20checkAdminRoles:',_0x2b0a1e),{'isAdmin':![],'role':null};}}async function updateAuthSection(_0x1b0317){const _0x4d4c25=a10_0x488e,_0x1e7946=_0x1b0317&&isAdmin(_0x1b0317[_0x4d4c25(0xd8)]);updateAuthSectionImmediate(_0x1b0317,_0x1e7946);if(!_0x1b0317){userCache[_0x4d4c25(0xd9)]=null,userCache['username']=null,userCache[_0x4d4c25(0xd2)]=![],userCache['hasCheckedCollections']=![],userCache[_0x4d4c25(0xcb)]=null;return;}const _0x2392cf=Date['now']();if(_0x1b0317[_0x4d4c25(0xd9)]===userCache[_0x4d4c25(0xd9)]&&userCache['hasCheckedCollections']&&_0x2392cf-userCache['lastChecked']<0x493e0)return;try{userCache[_0x4d4c25(0xd9)]=_0x1b0317['uid'],userCache['lastChecked']=_0x2392cf;const _0xbb05f5=isAdmin(_0x1b0317[_0x4d4c25(0xd8)]);userCache['isAdmin']=_0xbb05f5;if(!_0xbb05f5){const {isAdmin:_0x256266,role:_0x1aa3ed}=await checkAdminRoles(_0x1b0317);userCache['isAdmin']=_0x256266,userCache['role']=_0x1aa3ed,_0x256266&&(document['querySelectorAll'](_0x4d4c25(0xb2))['forEach'](_0x367ae1=>{const _0x5a9b50=_0x4d4c25;_0x367ae1[_0x5a9b50(0xc3)]['display']='block';}),updateAuthSectionImmediate(_0x1b0317,!![]));}const _0x4e2c0e=['players','playersD2','playersD3','playersDuos','playersCTF',_0x4d4c25(0xc9),'userProfiles'],_0x3dc663=_0x4e2c0e['map'](_0x4ee933=>getDoc(doc(db,_0x4ee933,_0x1b0317['uid']))['then'](_0x4369c3=>_0x4369c3['exists']()?{'collection':_0x4ee933,'data':_0x4369c3['data']()}:null)[_0x4d4c25(0xb3)](()=>null)),_0x487a5f=await Promise['all'](_0x3dc663),_0x74010c=_0x487a5f[_0x4d4c25(0xba)](_0x221be5=>_0x221be5!==null);let _0x1d4023=null;for(const _0x2092e4 of _0x74010c){if(_0x2092e4['data']['username']){_0x1d4023=_0x2092e4['data']['username'];break;}}userCache[_0x4d4c25(0xbd)]=_0x1d4023||(_0x1b0317[_0x4d4c25(0xd8)]?_0x1b0317['email']['split']('@')[0x0]:'User'),userCache['hasCheckedCollections']=!![],updateAuthSectionImmediate(_0x1b0317,userCache[_0x4d4c25(0xd2)]),setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0x1b0317['uid']);},0x1f4);}catch(_0x39c1dd){console['error']('Error\x20in\x20full\x20auth\x20update:',_0x39c1dd);}}document['addEventListener']('DOMContentLoaded',()=>{const _0xc1aee0=a10_0x488e,_0x34f6ba=getAuth();onAuthStateChanged(_0x34f6ba,async _0x3a47a9=>{await updateAuthSection(_0x3a47a9),_0x3a47a9&&checkPendingInvitationsForCurrentUser(_0x3a47a9['uid']);}),document['addEventListener']('visibilitychange',()=>{!document['hidden']&&_0x34f6ba['currentUser']&&checkPendingInvitationsForCurrentUser(_0x34f6ba['currentUser']['uid']);}),document[_0xc1aee0(0xbc)]('click',_0x985553=>{const _0x3bf6ba=_0xc1aee0;_0x985553[_0x3bf6ba(0xd3)]['closest']('a[href]')&&_0x34f6ba['currentUser']&&checkPendingInvitationsForCurrentUser(_0x34f6ba['currentUser']['uid']);});});function a10_0x488e(_0x492a1e,_0x59f203){const _0x3e5a26=a10_0x1e69();return a10_0x488e=function(_0x306132,_0x73d3ae){_0x306132=_0x306132-0xb2;let _0x1e699c=_0x3e5a26[_0x306132];return _0x1e699c;},a10_0x488e(_0x492a1e,_0x59f203);}export{updateAuthSection};
const a35_0x1fbf52=a35_0x24d0,a35_0x4460d4=(function(){let _0x3ee12a=!![];return function(_0x58db08,_0x2aeb26){const _0x2cb193=_0x3ee12a?function(){if(_0x2aeb26){const _0x38daf8=_0x2aeb26['apply'](_0x58db08,arguments);return _0x2aeb26=null,_0x38daf8;}}:function(){};return _0x3ee12a=![],_0x2cb193;};}()),a35_0x5461a0=a35_0x4460d4(this,function(){const _0x25471b=a35_0x24d0;let _0x2a4a26;try{const _0x1c36c7=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x2a4a26=_0x1c36c7();}catch(_0x2622f0){_0x2a4a26=window;}const _0x29166d=_0x2a4a26['console']=_0x2a4a26['console']||{},_0x48a680=[_0x25471b(0x14a),'warn','info',_0x25471b(0x148),_0x25471b(0x14f),'table',_0x25471b(0x144)];for(let _0x465bbe=0x0;_0x465bbe<_0x48a680['length'];_0x465bbe++){const _0x5a83b2=a35_0x4460d4['constructor']['prototype']['bind'](a35_0x4460d4),_0x55f873=_0x48a680[_0x465bbe],_0x112586=_0x29166d[_0x55f873]||_0x5a83b2;_0x5a83b2[_0x25471b(0x153)]=a35_0x4460d4[_0x25471b(0x149)](a35_0x4460d4),_0x5a83b2['toString']=_0x112586['toString']['bind'](_0x112586),_0x29166d[_0x55f873]=_0x5a83b2;}});a35_0x5461a0();function a35_0x24d0(_0x21c2de,_0x557f81){const _0x5461a0=a35_0x3cb2();return a35_0x24d0=function(_0x4460d4,_0x223bc0){_0x4460d4=_0x4460d4-0x144;let _0x3cb23c=_0x5461a0[_0x4460d4];return _0x3cb23c;},a35_0x24d0(_0x21c2de,_0x557f81);}function a35_0x3cb2(){const _0x1a14e7=['trace','get','forEach','isNonParticipant','error','bind','log','has','favoriteMap','userProfiles','silver','exception','playersD2','ladder','userId','__proto__','motto','sort','onRequest','players','eloRating','ladders','{collection}/{docId}','playersD3','all','set','favoriteWeapon','batch','bronze','profileImageUrl','elo','collection'];a35_0x3cb2=function(){return _0x1a14e7;};return a35_0x3cb2();}const functions=require('firebase-functions'),admin=require('firebase-admin');admin['initializeApp']();const db=admin['firestore']();exports['updateMembersList']=functions['firestore']['document'](a35_0x1fbf52(0x15a))['onWrite'](async(_0x2628b3,_0x518cf2)=>{const _0x7954a2=a35_0x1fbf52,_0x36df46=_0x518cf2['params'][_0x7954a2(0x163)],_0x214940=_0x518cf2['params']['docId'];if(![_0x7954a2(0x157),_0x7954a2(0x150),_0x7954a2(0x15b),'userProfiles','nonParticipants']['includes'](_0x36df46))return null;try{await rebuildMembersList(),console[_0x7954a2(0x14a)]('Successfully\x20updated\x20aggregated\x20members\x20list');}catch(_0x2197e2){console[_0x7954a2(0x148)]('Error\x20updating\x20members\x20list:',_0x2197e2);}});async function rebuildMembersList(){const _0x20e418=a35_0x1fbf52,_0x2be573=db['batch'](),[_0x53f8d5,_0x40596e,_0x728efe,_0x4e2eea,_0x4e7ea9]=await Promise['all']([db['collection'](_0x20e418(0x14d))[_0x20e418(0x145)](),db['collection']('players')['get'](),db['collection']('playersD2')[_0x20e418(0x145)](),db['collection']('playersD3')[_0x20e418(0x145)](),db['collection']('nonParticipants')['get']()]),_0x3974c8=new Map();_0x53f8d5['forEach'](_0x1b58d2=>{_0x3974c8['set'](_0x1b58d2['id'],_0x1b58d2['data']());});const _0x2e6ef9=new Map(),_0x4c4714=(_0x4f8a42,_0x5e34d2)=>{_0x4f8a42['forEach'](_0x118475=>{const _0x1d3f67=a35_0x24d0,_0xd7e34a=_0x118475['data'](),_0x143fe7=_0x118475['id'];!_0x2e6ef9[_0x1d3f67(0x14b)](_0x143fe7)&&_0x2e6ef9['set'](_0x143fe7,{'userId':_0x143fe7,'username':_0xd7e34a['username']||'Unknown','ladders':[],'isNonParticipant':![]});const _0xd76d93=_0x2e6ef9['get'](_0x143fe7);_0xd76d93['ladders']['push']({'ladder':_0x5e34d2,'elo':_0xd7e34a[_0x1d3f67(0x158)]||0x4b0,'active':_0xd7e34a['active']!==![]});});};_0x4c4714(_0x40596e,'D1'),_0x4c4714(_0x728efe,'D2'),_0x4c4714(_0x4e2eea,'D3'),_0x4e7ea9[_0x20e418(0x146)](_0x2ba0e8=>{const _0x397c3e=_0x20e418,_0x3edc9a=_0x2ba0e8['data'](),_0x3bd057=_0x2ba0e8['id'];!_0x2e6ef9['has'](_0x3bd057)&&_0x3edc9a['username']&&_0x2e6ef9[_0x397c3e(0x15d)](_0x3bd057,{'userId':_0x3bd057,'username':_0x3edc9a['username'],'ladders':[],'isNonParticipant':!![]});});const _0x39756c=[];_0x2e6ef9['forEach']((_0x22c75f,_0x309ecd)=>{const _0x11f7c1=_0x20e418,_0x2cd15c=_0x3974c8['get'](_0x309ecd)||{};let _0x57fd92=0x0,_0xeac6f9=null;if(_0x22c75f[_0x11f7c1(0x159)]['length']>0x0){const _0x30d5d1=_0x22c75f['ladders'][_0x11f7c1(0x155)]((_0x555999,_0x200de0)=>_0x200de0['elo']-_0x555999[_0x11f7c1(0x162)]);_0x57fd92=_0x30d5d1[0x0]['elo'],_0xeac6f9=_0x30d5d1[0x0][_0x11f7c1(0x151)];}const _0x4cb43b={'userId':_0x309ecd,'username':_0x22c75f['username'],'profileImageUrl':_0x2cd15c[_0x11f7c1(0x161)]||null,'country':_0x2cd15c['country']||null,'motto':_0x2cd15c[_0x11f7c1(0x154)]||null,'favoriteMap':_0x2cd15c[_0x11f7c1(0x14c)]||null,'favoriteWeapon':_0x2cd15c[_0x11f7c1(0x15e)]||null,'isNonParticipant':_0x22c75f[_0x11f7c1(0x147)],'ladders':_0x22c75f['ladders'],'primaryLadder':_0xeac6f9,'highestElo':_0x57fd92,'rank':getPlayerRank(_0x57fd92),'lastUpdated':admin['firestore']['FieldValue']['serverTimestamp']()};_0x39756c['push'](_0x4cb43b);});const _0x4c0204=db['collection']('aggregatedMembers'),_0x44126d=await _0x4c0204['get'](),_0x1f4fad=[];_0x44126d[_0x20e418(0x146)](_0x217461=>{_0x1f4fad['push'](_0x217461['ref']['delete']());}),await Promise['all'](_0x1f4fad);const _0x2b9b87=0x1f4,_0x36ff48=[];for(let _0x51c7f4=0x0;_0x51c7f4<_0x39756c['length'];_0x51c7f4+=_0x2b9b87){const _0x580407=db[_0x20e418(0x15f)](),_0x1794fe=_0x39756c['slice'](_0x51c7f4,_0x51c7f4+_0x2b9b87);_0x1794fe['forEach'](_0x3e068b=>{const _0x184cff=_0x20e418,_0x317d67=_0x4c0204['doc'](_0x3e068b[_0x184cff(0x152)]);_0x580407['set'](_0x317d67,_0x3e068b);}),_0x36ff48['push'](_0x580407['commit']());}await Promise[_0x20e418(0x15c)](_0x36ff48);}function getPlayerRank(_0x45878f){const _0x49ad9a=a35_0x1fbf52;if(_0x45878f>=0x7d0)return'emerald';if(_0x45878f>=0x708)return'gold';if(_0x45878f>=0x640)return _0x49ad9a(0x14e);if(_0x45878f>=0x578)return _0x49ad9a(0x160);return'unranked';}exports['rebuildMembersListManual']=functions['https'][a35_0x1fbf52(0x156)](async(_0x96fe4d,_0x500c69)=>{try{await rebuildMembersList(),_0x500c69['status'](0xc8)['send']('Members\x20list\x20rebuilt\x20successfully');}catch(_0x3d173e){console['error']('Error\x20rebuilding\x20members\x20list:',_0x3d173e),_0x500c69['status'](0x1f4)['send']('Error\x20rebuilding\x20members\x20list');}});
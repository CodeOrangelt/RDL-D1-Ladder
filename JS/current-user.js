const a10_0x1498da=(function(){let _0x2e2e61=!![];return function(_0x4f4127,_0x1bbff1){const _0xbbf086=_0x2e2e61?function(){if(_0x1bbff1){const _0x2cca5f=_0x1bbff1['apply'](_0x4f4127,arguments);return _0x1bbff1=null,_0x2cca5f;}}:function(){};return _0x2e2e61=![],_0xbbf086;};}()),a10_0x2f69ba=a10_0x1498da(this,function(){const _0x21b2ca=a10_0x5797,_0x3c4749=function(){const _0x4d404b=a10_0x5797;let _0x6874fe;try{_0x6874fe=Function('return\x20(function()\x20'+_0x4d404b(0x14c)+');')();}catch(_0x395bc9){_0x6874fe=window;}return _0x6874fe;},_0x2a9c18=_0x3c4749(),_0x4be64e=_0x2a9c18['console']=_0x2a9c18['console']||{},_0x2df691=['log','warn',_0x21b2ca(0x154),'error',_0x21b2ca(0x140),'table','trace'];for(let _0x48b0f9=0x0;_0x48b0f9<_0x2df691['length'];_0x48b0f9++){const _0x5271a7=a10_0x1498da['constructor']['prototype']['bind'](a10_0x1498da),_0xdfe822=_0x2df691[_0x48b0f9],_0x5db2bc=_0x4be64e[_0xdfe822]||_0x5271a7;_0x5271a7['__proto__']=a10_0x1498da[_0x21b2ca(0x148)](a10_0x1498da),_0x5271a7['toString']=_0x5db2bc['toString']['bind'](_0x5db2bc),_0x4be64e[_0xdfe822]=_0x5271a7;}});a10_0x2f69ba();import{getAuth,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{doc,getDoc,collection,query,where,getDocs,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import{isAdmin}from'./admin-check.js';function a10_0x5797(_0x13a4a7,_0x37dcde){const _0x2f69ba=a10_0x2833();return a10_0x5797=function(_0x1498da,_0x43d060){_0x1498da=_0x1498da-0x12f;let _0x28338a=_0x2f69ba[_0x1498da];return _0x28338a;},a10_0x5797(_0x13a4a7,_0x37dcde);}const ADMIN_EMAILS=['admin@ladder.com','Brian2af@outlook.com'],userCache={'uid':null,'username':null,'isAdmin':![],'hasCheckedCollections':![],'lastChecked':0x0,'role':null},invitationCache={'lastCheck':0x0,'pendingCount':0x0,'checkInterval':0x493e0};function updateInboxNotification(_0x535187){const _0x580aeb=a10_0x5797,_0x4e1e75=document['getElementById'](_0x580aeb(0x14e));_0x4e1e75&&(_0x535187>0x0?(_0x4e1e75[_0x580aeb(0x151)]['display']='inline-block',_0x4e1e75['textContent']=_0x535187>0x9?'9+':_0x535187):_0x4e1e75['style']['display']='none');}function a10_0x2833(){const _0x59da91=['admin','User','data','currentUser','preventDefault','role','\x20(Admin)','owner','playersD2','now','exists','playersD3','\x20by\x20email:','charAt','getElementById','players','uid','exception','forEach','roleName','Found\x20admin\x20role:\x20','log','pendingCount','split','Error\x20in\x20checkAdminRoles:','bind','email','filter','lastCheck','{}.constructor(\x22return\x20this\x22)(\x20)','join','inbox-notification','userProfiles','hasCheckedCollections','style','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20class=\x22nav-username\x22>','addEventListener','info','target','\x20by\x20UID:','checkInterval','lastChecked','all'];a10_0x2833=function(){return _0x59da91;};return a10_0x2833();}async function checkPendingInvitationsForCurrentUser(_0x5965e9){const _0x225fe9=a10_0x5797;try{const _0x2089d2=Date[_0x225fe9(0x138)]();if(_0x2089d2-invitationCache['lastCheck']<invitationCache[_0x225fe9(0x157)])return updateInboxNotification(invitationCache['pendingCount']),invitationCache['pendingCount'];invitationCache[_0x225fe9(0x14b)]=_0x2089d2;const _0x6b4b03=collection(db,'gameInvitations'),_0x48d015=query(_0x6b4b03,where('toUserId','==',_0x5965e9),where('status','==','pending'),limit(0x5)),_0x249b8d=await getDocs(_0x48d015),_0x410308=_0x249b8d['size'];return invitationCache[_0x225fe9(0x145)]=_0x410308,updateInboxNotification(_0x410308),_0x410308;}catch(_0x52fc69){return console['warn']('Could\x20not\x20check\x20pending\x20invitations\x20for\x20current\x20user:',_0x52fc69),0x0;}}function updateAuthSectionImmediate(_0x44869f,_0xae3ea1=![]){const _0x474a7a=a10_0x5797,_0x3f0b8c=document[_0x474a7a(0x13d)]('auth-section');if(!_0x3f0b8c)return;if(_0x44869f&&_0xae3ea1)document['querySelectorAll']('.admin-only')[_0x474a7a(0x141)](_0x287696=>{_0x287696['style']['display']='block';});else!_0x44869f&&document['querySelectorAll']('.admin-only')[_0x474a7a(0x141)](_0x2bed52=>{_0x2bed52['style']['display']='none';});if(_0x44869f){const _0x12573f=userCache['username']||(_0x44869f[_0x474a7a(0x149)]?_0x44869f['email']['split']('@')[0x0]:_0x474a7a(0x130)),_0x3feac6=userCache['role']?'\x20('+userCache['role']+')':_0xae3ea1?_0x474a7a(0x135):'';_0x3f0b8c['innerHTML']=_0x474a7a(0x152)+_0x12573f+_0x3feac6+'</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username='+encodeURIComponent(_0x12573f)+'\x22>Profile</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./inbox.html\x22\x20class=\x22nav-notification\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Inbox\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22inbox-notification\x22\x20class=\x22notification-dot\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22members.html\x22>Members</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./redeem.html\x22><i\x20class=\x22fas\x20fa-gift\x22></i>Store</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20id=\x22logout-link\x22>Sign\x20Out</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';const _0xa6a4c7=document['getElementById']('logout-link');_0xa6a4c7&&_0xa6a4c7[_0x474a7a(0x153)]('click',_0x3f8c1c=>{const _0x131e7c=_0x474a7a;_0x3f8c1c[_0x131e7c(0x133)]();const _0x1f1a68=getAuth();updateAuthSectionImmediate(null),_0x1f1a68['signOut']()['catch'](_0x259a3f=>{console['error']('Error\x20signing\x20out:',_0x259a3f);});}),_0x44869f['uid']&&setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0x44869f['uid']);},0x3e8);}else _0x3f0b8c['innerHTML']='<a\x20href=\x22login.html\x22\x20class=\x22login-link\x22>Login</a>';}async function checkAdminRoles(_0x601fea){const _0x4a3916=a10_0x5797;if(!_0x601fea||!_0x601fea['email'])return{'isAdmin':![],'role':null};try{console['log']('Checking\x20roles\x20for\x20user:\x20'+_0x601fea[_0x4a3916(0x149)]);const _0x23fa48=['players','playersD2',_0x4a3916(0x13a),'nonParticipants','userProfiles'],_0x495ce6=['council','creative\x20lead',_0x4a3916(0x136),_0x4a3916(0x12f)];for(const _0x150a63 of _0x23fa48){try{const _0x51d8b=doc(db,_0x150a63,_0x601fea[_0x4a3916(0x13f)]),_0x1c4968=await getDoc(_0x51d8b);if(_0x1c4968[_0x4a3916(0x139)]()){const _0x4afc99=_0x1c4968[_0x4a3916(0x131)]();console['log']('Found\x20user\x20in\x20'+_0x150a63+_0x4a3916(0x156),_0x4afc99);let _0x1ea3b3=(_0x4afc99[_0x4a3916(0x142)]||_0x4afc99[_0x4a3916(0x134)]||'')['toLowerCase'](),_0xaf03ed=_0x4afc99['roleName']||_0x4afc99['role']||'';if(_0x1ea3b3&&_0x495ce6['includes'](_0x1ea3b3)){console[_0x4a3916(0x144)](_0x4a3916(0x143)+_0x1ea3b3+'\x20in\x20'+_0x150a63);const _0x35019b=_0xaf03ed[_0x4a3916(0x146)]('\x20')['map'](_0x51d0ba=>_0x51d0ba[_0x4a3916(0x13c)](0x0)['toUpperCase']()+_0x51d0ba['slice'](0x1)['toLowerCase']())[_0x4a3916(0x14d)]('\x20');return{'isAdmin':!![],'role':_0x35019b};}}}catch(_0x3f5134){console['error']('Error\x20checking\x20'+_0x150a63+'\x20by\x20UID:',_0x3f5134);}}for(const _0x114f68 of _0x23fa48){try{const _0x4282c4=collection(db,_0x114f68);let _0xc14f6=query(_0x4282c4,where(_0x4a3916(0x149),'==',_0x601fea['email'])),_0x4086f2=await getDocs(_0xc14f6);_0x4086f2['empty']&&(_0xc14f6=query(_0x4282c4,where(_0x4a3916(0x149),'==',_0x601fea[_0x4a3916(0x149)]['toLowerCase']())),_0x4086f2=await getDocs(_0xc14f6));if(!_0x4086f2['empty']){const _0x4b693a=_0x4086f2['docs'][0x0]['data']();console[_0x4a3916(0x144)]('Found\x20user\x20in\x20'+_0x114f68+_0x4a3916(0x13b),_0x4b693a);let _0x24bca0=(_0x4b693a['roleName']||_0x4b693a[_0x4a3916(0x134)]||'')['toLowerCase'](),_0x4f340a=_0x4b693a['roleName']||_0x4b693a['role']||'';if(_0x24bca0&&_0x495ce6['includes'](_0x24bca0)){console['log']('Found\x20admin\x20role:\x20'+_0x24bca0+'\x20in\x20'+_0x114f68);const _0x1a3165=_0x4f340a['split']('\x20')['map'](_0x3ee289=>_0x3ee289['charAt'](0x0)['toUpperCase']()+_0x3ee289['slice'](0x1)['toLowerCase']())[_0x4a3916(0x14d)]('\x20');return{'isAdmin':!![],'role':_0x1a3165};}}}catch(_0x6da91b){console['error']('Error\x20checking\x20'+_0x114f68+'\x20by\x20email:',_0x6da91b);}}return console['log']('No\x20admin\x20roles\x20found\x20for\x20user'),{'isAdmin':![],'role':null};}catch(_0x80900c){return console['error'](_0x4a3916(0x147),_0x80900c),{'isAdmin':![],'role':null};}}async function updateAuthSection(_0xd80b4c){const _0x4b5c4e=a10_0x5797,_0x2e8085=_0xd80b4c&&isAdmin(_0xd80b4c['email']);updateAuthSectionImmediate(_0xd80b4c,_0x2e8085);if(!_0xd80b4c){userCache['uid']=null,userCache['username']=null,userCache['isAdmin']=![],userCache['hasCheckedCollections']=![],userCache['role']=null;return;}const _0x43df9b=Date['now']();if(_0xd80b4c['uid']===userCache['uid']&&userCache[_0x4b5c4e(0x150)]&&_0x43df9b-userCache['lastChecked']<0x493e0)return;try{userCache['uid']=_0xd80b4c[_0x4b5c4e(0x13f)],userCache[_0x4b5c4e(0x158)]=_0x43df9b;const _0xe31b9c=isAdmin(_0xd80b4c['email']);userCache['isAdmin']=_0xe31b9c;if(!_0xe31b9c){const {isAdmin:_0x573e27,role:_0x2adaca}=await checkAdminRoles(_0xd80b4c);userCache['isAdmin']=_0x573e27,userCache['role']=_0x2adaca,_0x573e27&&(document['querySelectorAll']('.admin-only')['forEach'](_0x53aeff=>{_0x53aeff['style']['display']='block';}),updateAuthSectionImmediate(_0xd80b4c,!![]));}const _0x1d6b66=[_0x4b5c4e(0x13e),_0x4b5c4e(0x137),'playersD3','playersDuos','playersCTF','nonParticipants',_0x4b5c4e(0x14f)],_0x566c91=_0x1d6b66['map'](_0x577de1=>getDoc(doc(db,_0x577de1,_0xd80b4c['uid']))['then'](_0x43d4b9=>_0x43d4b9['exists']()?{'collection':_0x577de1,'data':_0x43d4b9[_0x4b5c4e(0x131)]()}:null)['catch'](()=>null)),_0x2057b6=await Promise[_0x4b5c4e(0x159)](_0x566c91),_0x4e2345=_0x2057b6[_0x4b5c4e(0x14a)](_0x428578=>_0x428578!==null);let _0x86d07d=null;for(const _0x335d32 of _0x4e2345){if(_0x335d32['data']['username']){_0x86d07d=_0x335d32['data']['username'];break;}}userCache['username']=_0x86d07d||(_0xd80b4c['email']?_0xd80b4c['email']['split']('@')[0x0]:_0x4b5c4e(0x130)),userCache['hasCheckedCollections']=!![],updateAuthSectionImmediate(_0xd80b4c,userCache['isAdmin']),setTimeout(()=>{const _0x507d77=_0x4b5c4e;checkPendingInvitationsForCurrentUser(_0xd80b4c[_0x507d77(0x13f)]);},0x1f4);}catch(_0x13cc5d){console['error']('Error\x20in\x20full\x20auth\x20update:',_0x13cc5d);}}document['addEventListener']('DOMContentLoaded',()=>{const _0x9bf277=getAuth();onAuthStateChanged(_0x9bf277,async _0x5d26b8=>{await updateAuthSection(_0x5d26b8),_0x5d26b8&&checkPendingInvitationsForCurrentUser(_0x5d26b8['uid']);}),document['addEventListener']('visibilitychange',()=>{const _0x20d288=a10_0x5797;!document['hidden']&&_0x9bf277[_0x20d288(0x132)]&&checkPendingInvitationsForCurrentUser(_0x9bf277[_0x20d288(0x132)]['uid']);}),document['addEventListener']('click',_0x3ea66d=>{const _0x15dd04=a10_0x5797;_0x3ea66d[_0x15dd04(0x155)]['closest']('a[href]')&&_0x9bf277['currentUser']&&checkPendingInvitationsForCurrentUser(_0x9bf277[_0x15dd04(0x132)]['uid']);});});export{updateAuthSection};
const a13_0x35260c=a13_0x2890,a13_0xa6b187=(function(){let _0x438fc2=!![];return function(_0x3bd9c4,_0x313af3){const _0x2ed458=_0x438fc2?function(){const _0x34e905=a13_0x2890;if(_0x313af3){const _0x330b58=_0x313af3[_0x34e905(0x12b)](_0x3bd9c4,arguments);return _0x313af3=null,_0x330b58;}}:function(){};return _0x438fc2=![],_0x2ed458;};}()),a13_0x5a7c75=a13_0xa6b187(this,function(){const _0x3a7f90=a13_0x2890,_0x3b05d0=function(){const _0x1722a4=a13_0x2890;let _0x2b4786;try{_0x2b4786=Function('return\x20(function()\x20'+_0x1722a4(0x136)+');')();}catch(_0x3bd9ae){_0x2b4786=window;}return _0x2b4786;},_0x418841=_0x3b05d0(),_0x28d026=_0x418841['console']=_0x418841[_0x3a7f90(0x11f)]||{},_0x58ad06=['log','warn',_0x3a7f90(0x130),'error','exception','table',_0x3a7f90(0x12c)];for(let _0x2ba501=0x0;_0x2ba501<_0x58ad06['length'];_0x2ba501++){const _0x29336d=a13_0xa6b187['constructor'][_0x3a7f90(0x133)]['bind'](a13_0xa6b187),_0x501dab=_0x58ad06[_0x2ba501],_0x1c24fd=_0x28d026[_0x501dab]||_0x29336d;_0x29336d[_0x3a7f90(0x120)]=a13_0xa6b187['bind'](a13_0xa6b187),_0x29336d['toString']=_0x1c24fd['toString'][_0x3a7f90(0x137)](_0x1c24fd),_0x28d026[_0x501dab]=_0x29336d;}});function a13_0x2890(_0x12428f,_0x4227d7){const _0x5a7c75=a13_0x5651();return a13_0x2890=function(_0xa6b187,_0x5e80d7){_0xa6b187=_0xa6b187-0x11f;let _0x56510d=_0x5a7c75[_0xa6b187];return _0x56510d;},a13_0x2890(_0x12428f,_0x4227d7);}a13_0x5a7c75();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc,where}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D3=[{'name':'Emerald','elo':0x7d0},{'name':a13_0x35260c(0x132),'elo':0x708},{'name':'Silver','elo':0x640},{'name':'Bronze','elo':0x578},{'name':a13_0x35260c(0x12e),'elo':0x4b0}];let lastVisibleD3=null;async function getUsernameByIdD3(_0x2e2290){const _0x333acd=a13_0x35260c;try{if(!_0x2e2290)return'Unknown\x20Player';const _0x14e183=await getDoc(doc(db,'playersD3',_0x2e2290));if(_0x14e183[_0x333acd(0x134)]())return _0x14e183['data']()[_0x333acd(0x12a)]||_0x333acd(0x128);const _0x2fec9f=await getDocs(query(collection(db,'approvedMatchesD3'),where(_0x333acd(0x131),'==',_0x2e2290),limit(0x1)));if(!_0x2fec9f['empty'])return _0x2fec9f[_0x333acd(0x124)][0x0]['data']()['winnerUsername']||'Unknown\x20Player';const _0x365a47=await getDocs(query(collection(db,_0x333acd(0x126)),where('loserId','==',_0x2e2290),limit(0x1)));if(!_0x365a47[_0x333acd(0x122)])return _0x365a47[_0x333acd(0x124)][0x0]['data']()['loserUsername']||'Unknown\x20Player';return'Unknown\x20Player';}catch(_0x740c90){return console['error']('Error\x20getting\x20D3\x20username:',_0x740c90),'Unknown\x20Player';}}export async function recordEloChangeD3({playerId:_0xe528b7,previousElo:_0x4e4edf,newElo:_0x274331,opponentId:_0x27c510,matchResult:_0x4669e4,previousPosition:_0x500040,newPosition:_0x4c585e,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x102416,timestamp:_0x1c3323}){const _0x334f83=a13_0x35260c;try{const _0x2d22ef=doc(collection(db,'eloHistoryD3'));let _0x22c573='match';if(isPromotion)_0x22c573='promotion';if(isDemotion)_0x22c573=_0x334f83(0x138);let _0x3b7448='Unranked';if(_0x274331>=0x7d0)_0x3b7448='Emerald';else{if(_0x274331>=0x708)_0x3b7448=_0x334f83(0x132);else{if(_0x274331>=0x640)_0x3b7448=_0x334f83(0x121);else{if(_0x274331>=0x578)_0x3b7448='Bronze';}}}return await setDoc(_0x2d22ef,{'type':_0x22c573,'player':_0xe528b7,'opponent':_0x27c510,'previousElo':_0x4e4edf,'newElo':_0x274331,'change':_0x274331-_0x4e4edf,'matchResult':_0x4669e4,'previousPosition':_0x500040,'newPosition':_0x4c585e,'rankAchieved':_0x3b7448,'matchId':_0x102416,'timestamp':_0x1c3323||serverTimestamp(),'gameMode':'D3'}),console[_0x334f83(0x123)]('D3\x20ELO\x20history\x20recorded\x20for\x20'+_0xe528b7),!![];}catch(_0x278186){console[_0x334f83(0x12f)]('Error\x20recording\x20D3\x20ELO\x20history:',_0x278186);throw _0x278186;}}export async function getEloHistoryD3(_0x4f7eab=0x14){const _0x33c046=a13_0x35260c;try{const _0xef0afd=collection(db,'eloHistoryD3');let _0x476c2d;lastVisibleD3?_0x476c2d=query(_0xef0afd,orderBy(_0x33c046(0x135),'desc'),startAfter(lastVisibleD3),limit(_0x4f7eab)):_0x476c2d=query(_0xef0afd,orderBy('timestamp','desc'),limit(_0x4f7eab));const _0x5e1740=await getDocs(_0x476c2d);if(_0x5e1740['empty'])return{'entries':[],'hasMore':![]};lastVisibleD3=_0x5e1740['docs'][_0x5e1740['docs']['length']-0x1];const _0x38eb64=_0x5e1740['docs']['map'](async _0x402f8b=>{const _0x1a4d06=_0x33c046,_0xc0a311=_0x402f8b[_0x1a4d06(0x12d)](),[_0x5e5a3e,_0x4f0c9a]=await Promise[_0x1a4d06(0x125)]([getUsernameByIdD3(_0xc0a311[_0x1a4d06(0x127)]),getUsernameByIdD3(_0xc0a311[_0x1a4d06(0x129)])]);return{..._0xc0a311,'playerUsername':_0x5e5a3e,'opponentUsername':_0x4f0c9a,'change':_0xc0a311['newElo']-_0xc0a311['previousElo'],'timestamp':_0xc0a311['timestamp']};}),_0x4b4783=await Promise['all'](_0x38eb64);return{'entries':_0x4b4783,'hasMore':_0x5e1740['size']===_0x4f7eab};}catch(_0x52bafd){console[_0x33c046(0x12f)]('Error\x20fetching\x20D3\x20ELO\x20history:',_0x52bafd);throw _0x52bafd;}}export function resetPaginationD3(){lastVisibleD3=null;}function a13_0x5651(){const _0x3c6783=['console','__proto__','Silver','empty','log','docs','all','approvedMatchesD3','player','Unknown\x20Player','opponent','username','apply','trace','data','Unranked','error','info','winnerId','Gold','prototype','exists','timestamp','{}.constructor(\x22return\x20this\x22)(\x20)','bind','demotion'];a13_0x5651=function(){return _0x3c6783;};return a13_0x5651();}
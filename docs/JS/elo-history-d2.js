function a0_0x5e7e(){const _0x5cf734=['__proto__','eloHistoryD2','error','Error\x20getting\x20username:','previousElo','8440686AIwiWE','approvedMatchesD2','length','Unknown\x20Player','player','121qXKeZp','4KLtugM','{}.constructor(\x22return\x20this\x22)(\x20)','log','data','3GMeEKA','timestamp','size','5EBOGly','231591poEGvo','docs','winnerId','demotion','10FhPMBD','23875462xmqukh','2723823TzTGhH','info','4705532PNBLAB','desc','1761420YXfCyz','opponent','336YvCPRY','Bronze','toString','Gold','bind','65856FivnaJ'];a0_0x5e7e=function(){return _0x5cf734;};return a0_0x5e7e();}const a0_0x163b16=a0_0x1c7d;(function(_0x5e89a6,_0x10dcb4){const _0x3655ac=a0_0x1c7d,_0x4be1f3=_0x5e89a6();while(!![]){try{const _0xc795c9=-parseInt(_0x3655ac(0x156))/0x1*(-parseInt(_0x3655ac(0x14e))/0x2)+-parseInt(_0x3655ac(0x152))/0x3*(parseInt(_0x3655ac(0x139))/0x4)+parseInt(_0x3655ac(0x155))/0x5*(parseInt(_0x3655ac(0x148))/0x6)+-parseInt(_0x3655ac(0x13d))/0x7*(parseInt(_0x3655ac(0x142))/0x8)+-parseInt(_0x3655ac(0x137))/0x9*(-parseInt(_0x3655ac(0x135))/0xa)+-parseInt(_0x3655ac(0x14d))/0xb*(parseInt(_0x3655ac(0x13b))/0xc)+parseInt(_0x3655ac(0x136))/0xd;if(_0xc795c9===_0x10dcb4)break;else _0x4be1f3['push'](_0x4be1f3['shift']());}catch(_0x3d1b62){_0x4be1f3['push'](_0x4be1f3['shift']());}}}(a0_0x5e7e,0xc8ef6));const a0_0x1788c8=(function(){let _0x64167b=!![];return function(_0x43251e,_0x384a2f){const _0x20a259=_0x64167b?function(){if(_0x384a2f){const _0x289991=_0x384a2f['apply'](_0x43251e,arguments);return _0x384a2f=null,_0x289991;}}:function(){};return _0x64167b=![],_0x20a259;};}()),a0_0x3157b2=a0_0x1788c8(this,function(){const _0x1c4055=a0_0x1c7d;let _0x4eb17d;try{const _0x356150=Function('return\x20(function()\x20'+_0x1c4055(0x14f)+');');_0x4eb17d=_0x356150();}catch(_0x2cc136){_0x4eb17d=window;}const _0x533c59=_0x4eb17d['console']=_0x4eb17d['console']||{},_0x26c22e=[_0x1c4055(0x150),'warn',_0x1c4055(0x138),_0x1c4055(0x145),'exception','table','trace'];for(let _0x2dfd7a=0x0;_0x2dfd7a<_0x26c22e[_0x1c4055(0x14a)];_0x2dfd7a++){const _0x2b4b7a=a0_0x1788c8['constructor']['prototype']['bind'](a0_0x1788c8),_0x4ead36=_0x26c22e[_0x2dfd7a],_0x282b40=_0x533c59[_0x4ead36]||_0x2b4b7a;_0x2b4b7a[_0x1c4055(0x143)]=a0_0x1788c8['bind'](a0_0x1788c8),_0x2b4b7a['toString']=_0x282b40[_0x1c4055(0x13f)][_0x1c4055(0x141)](_0x282b40),_0x533c59[_0x4ead36]=_0x2b4b7a;}});a0_0x3157b2();function a0_0x1c7d(_0x301b77,_0x3be5a0){const _0x3181c3=a0_0x5e7e();return a0_0x1c7d=function(_0x3157b2,_0x1788c8){_0x3157b2=_0x3157b2-0x133;let _0xcff68d=_0x3181c3[_0x3157b2];return _0xcff68d;},a0_0x1c7d(_0x301b77,_0x3be5a0);}import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D2=[{'name':'Gold','elo':0x708},{'name':'Silver','elo':0x640},{'name':a0_0x163b16(0x13e),'elo':0x578},{'name':'Unranked','elo':0x4b0}];let lastVisibleD2=null;async function getUsernameByIdD2(_0x1e5b09){const _0x5e18ec=a0_0x163b16;try{if(!_0x1e5b09)return'Unknown\x20Player';const _0x1b6868=await getDoc(doc(db,'playersD2',_0x1e5b09));if(_0x1b6868['exists']())return _0x1b6868['data']()['username']||_0x5e18ec(0x14b);const _0x529d89=await getDocs(query(collection(db,'approvedMatchesD2'),where(_0x5e18ec(0x133),'==',_0x1e5b09),limit(0x1)));if(!_0x529d89['empty'])return _0x529d89[_0x5e18ec(0x157)][0x0]['data']()['winnerUsername']||_0x5e18ec(0x14b);const _0x1d51be=await getDocs(query(collection(db,_0x5e18ec(0x149)),where('loserId','==',_0x1e5b09),limit(0x1)));if(!_0x1d51be['empty'])return _0x1d51be['docs'][0x0]['data']()['loserUsername']||_0x5e18ec(0x14b);return'Unknown\x20Player';}catch(_0x208d07){return console['error'](_0x5e18ec(0x146),_0x208d07),'Unknown\x20Player';}}export async function recordEloChangeD2({playerId:_0x4b5525,previousElo:_0x23d3e1,newElo:_0xa1305e,opponentId:_0x1b5ee1,matchResult:_0x3ba949,previousPosition:_0x5ef7e0,newPosition:_0x20c3d2,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x373e93,timestamp:_0x34dccb}){const _0x114813=a0_0x163b16;try{const _0x5ae758=doc(collection(db,'eloHistoryD2'));let _0x406ee0='match';if(isPromotion)_0x406ee0='promotion';if(isDemotion)_0x406ee0=_0x114813(0x134);let _0x417e08='Unranked';if(_0xa1305e>=0x834)_0x417e08='Emerald';else{if(_0xa1305e>=0x708)_0x417e08=_0x114813(0x140);else{if(_0xa1305e>=0x640)_0x417e08='Silver';else{if(_0xa1305e>=0x578)_0x417e08='Bronze';}}}return await setDoc(_0x5ae758,{'type':_0x406ee0,'player':_0x4b5525,'opponent':_0x1b5ee1,'previousElo':_0x23d3e1,'newElo':_0xa1305e,'change':_0xa1305e-_0x23d3e1,'matchResult':_0x3ba949,'previousPosition':_0x5ef7e0,'newPosition':_0x20c3d2,'rankAchieved':_0x417e08,'matchId':_0x373e93,'timestamp':_0x34dccb}),console['log']('D2\x20ELO\x20history\x20recorded\x20for\x20'+_0x4b5525),!![];}catch(_0x2ba077){console['error']('Error\x20recording\x20D2\x20ELO\x20history:',_0x2ba077);throw _0x2ba077;}}export async function getEloHistoryD2(_0x1e04e7=0x14){const _0x53ae79=a0_0x163b16;try{const _0x7361a2=collection(db,_0x53ae79(0x144));let _0x5665f4;lastVisibleD2?_0x5665f4=query(_0x7361a2,orderBy('timestamp','desc'),startAfter(lastVisibleD2),limit(_0x1e04e7)):_0x5665f4=query(_0x7361a2,orderBy('timestamp',_0x53ae79(0x13a)),limit(_0x1e04e7));const _0x6ae96c=await getDocs(_0x5665f4);if(_0x6ae96c['empty'])return{'entries':[],'hasMore':![]};lastVisibleD2=_0x6ae96c[_0x53ae79(0x157)][_0x6ae96c[_0x53ae79(0x157)]['length']-0x1];const _0x29b647=_0x6ae96c['docs']['map'](async _0x2bf8aa=>{const _0x3e0c04=_0x53ae79,_0x3c775b=_0x2bf8aa[_0x3e0c04(0x151)](),[_0x20d081,_0x46a0ea]=await Promise['all']([getUsernameByIdD2(_0x3c775b[_0x3e0c04(0x14c)]),getUsernameByIdD2(_0x3c775b[_0x3e0c04(0x13c)])]);return{..._0x3c775b,'playerUsername':_0x20d081,'opponentUsername':_0x46a0ea,'change':_0x3c775b['newElo']-_0x3c775b[_0x3e0c04(0x147)],'timestamp':_0x3c775b[_0x3e0c04(0x153)]};}),_0x564539=await Promise['all'](_0x29b647);return{'entries':_0x564539,'hasMore':_0x6ae96c[_0x53ae79(0x154)]===_0x1e04e7};}catch(_0x6d79c9){console[_0x53ae79(0x145)]('Error\x20fetching\x20D2\x20ELO\x20history:',_0x6d79c9);throw _0x6d79c9;}}export function resetPaginationD2(){lastVisibleD2=null;}
const a7_0xbd48d1=a7_0x1c28,a7_0x32b4ca=(function(){let _0x43b856=!![];return function(_0x44f68a,_0x3d0045){const _0xcb5bf5=_0x43b856?function(){if(_0x3d0045){const _0x8f187d=_0x3d0045['apply'](_0x44f68a,arguments);return _0x3d0045=null,_0x8f187d;}}:function(){};return _0x43b856=![],_0xcb5bf5;};}()),a7_0x2c32cf=a7_0x32b4ca(this,function(){const _0x3b05e9=a7_0x1c28,_0x313cea=function(){const _0x3740c7=a7_0x1c28;let _0x321f79;try{_0x321f79=Function('return\x20(function()\x20'+_0x3740c7(0x129)+');')();}catch(_0x39ea7d){_0x321f79=window;}return _0x321f79;},_0x412590=_0x313cea(),_0x308510=_0x412590[_0x3b05e9(0x127)]=_0x412590[_0x3b05e9(0x127)]||{},_0x5a59ea=['log',_0x3b05e9(0x146),'info','error','exception','table','trace'];for(let _0x4f8fe6=0x0;_0x4f8fe6<_0x5a59ea[_0x3b05e9(0x128)];_0x4f8fe6++){const _0x263d35=a7_0x32b4ca[_0x3b05e9(0x145)]['prototype']['bind'](a7_0x32b4ca),_0x34095b=_0x5a59ea[_0x4f8fe6],_0x22ebaf=_0x308510[_0x34095b]||_0x263d35;_0x263d35['__proto__']=a7_0x32b4ca[_0x3b05e9(0x13c)](a7_0x32b4ca),_0x263d35['toString']=_0x22ebaf['toString']['bind'](_0x22ebaf),_0x308510[_0x34095b]=_0x263d35;}});a7_0x2c32cf();import{collection,getDocs,query,orderBy}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';function a7_0x3329(){const _0x976ac9=['newLoserRating','change','from','loser-select','displayCalculationDetails','playersD3','getELOColor','\x20=\x20','console','length','{}.constructor(\x22return\x20this\x22)(\x20)','newWinnerRating','\x0a\x0aInitial\x20Ratings:\x0a\x20\x20','toFixed','updateDropdowns','emerald','values','getElementById','innerHTML','target','loser-current-elo','bronze','color','add','#808080','\x0a\x20\x20','unranked','currentLadder','#C0C0C0','bind','active','%\x20chance\x20to\x20win)\x0a\x0aELO\x20Changes:\x0a\x20\x20','calculateMatch','winnerChange','style','textContent','display','loadPlayers','constructor','warn','match-result','New\x20ELO:\x20','Please\x20select\x20different\x20players\x20for\x20winner\x20and\x20loser','calculation-text','round','calculateELO','.ladder-btn','username','value','forEach','block','addEventListener','winner-elo-change','winner-current-elo','\x20players\x20from\x20','Low\x20ELO\x20gain.','error','elo','click','<option\x20value=\x22\x22>Select\x20a\x20player...</option>','players','ladder'];a7_0x3329=function(){return _0x976ac9;};return a7_0x3329();}class ELOCalculator{constructor(){this['currentLadder']='D1',this['players']=new Map(),this['init']();}['init'](){this['setupEventListeners'](),this['loadPlayers']();}['setupEventListeners'](){const _0x523ad1=a7_0x1c28;document['querySelectorAll'](_0x523ad1(0x14d))[_0x523ad1(0x150)](_0x3fe90c=>{const _0x5b399a=_0x523ad1;_0x3fe90c[_0x5b399a(0x152)]('click',_0x52df4e=>{const _0x4ed7b5=_0x5b399a;document['querySelectorAll'](_0x4ed7b5(0x14d))['forEach'](_0x578f7e=>_0x578f7e['classList']['remove']('active')),_0x52df4e[_0x4ed7b5(0x132)]['classList'][_0x4ed7b5(0x136)](_0x4ed7b5(0x13d)),this['currentLadder']=_0x52df4e['target']['dataset'][_0x4ed7b5(0x15c)],this['loadPlayers']();});}),document[_0x523ad1(0x130)]('refresh-players')['addEventListener'](_0x523ad1(0x159),()=>{const _0x592aa9=_0x523ad1;this[_0x592aa9(0x144)]();}),document['getElementById']('winner-select')[_0x523ad1(0x152)](_0x523ad1(0x120),()=>this[_0x523ad1(0x13f)]()),document[_0x523ad1(0x130)]('loser-select')['addEventListener'](_0x523ad1(0x120),()=>this['calculateMatch']());}async['loadPlayers'](){const _0xb480b8=a7_0x1c28;try{this[_0xb480b8(0x12d)]('<option\x20value=\x22\x22>Loading\x20players...</option>');const _0x9d3aaf=this['currentLadder']==='D1'?'players':this['currentLadder']==='D2'?'playersD2':_0xb480b8(0x124),_0x35beb3=collection(db,_0x9d3aaf),_0x50cc1b=query(_0x35beb3,orderBy('eloRating','desc')),_0x43bb8f=await getDocs(_0x50cc1b);this[_0xb480b8(0x15b)]['clear'](),_0x43bb8f['forEach'](_0x41785a=>{const _0x5f1381=_0xb480b8,_0x5eba9d=_0x41785a['data']();_0x5eba9d[_0x5f1381(0x14e)]&&this['players']['set'](_0x5eba9d['username'],{'id':_0x41785a['id'],'username':_0x5eba9d['username'],'elo':parseInt(_0x5eba9d['eloRating'])||0x4b0,'position':_0x5eba9d['position']||0x3e7});}),this[_0xb480b8(0x12d)](),console['log']('Loaded\x20'+this['players']['size']+_0xb480b8(0x155)+this[_0xb480b8(0x13a)]+'\x20ladder');}catch(_0x28dc68){console[_0xb480b8(0x157)]('Error\x20loading\x20players:',_0x28dc68),this['updateDropdowns']('<option\x20value=\x22\x22>Error\x20loading\x20players</option>');}}[a7_0xbd48d1(0x12d)](_0xbc4d2d=null){const _0x5551ae=a7_0xbd48d1,_0x3dffca=document['getElementById']('winner-select'),_0x5be6d7=document['getElementById']('loser-select');if(_0xbc4d2d){_0x3dffca[_0x5551ae(0x131)]=_0xbc4d2d,_0x5be6d7[_0x5551ae(0x131)]=_0xbc4d2d;return;}let _0x37fb7d=_0x5551ae(0x15a);const _0x2ee086=Array[_0x5551ae(0x121)](this[_0x5551ae(0x15b)][_0x5551ae(0x12f)]())['sort']((_0x3815d5,_0x428970)=>_0x428970['elo']-_0x3815d5['elo']);_0x2ee086[_0x5551ae(0x150)](_0xda3628=>{const _0x3821b1=_0x5551ae,_0x18b45e=this['getELORankClass'](_0xda3628[_0x3821b1(0x158)]);_0x37fb7d+='<option\x20value=\x22'+_0xda3628['username']+'\x22\x20data-elo=\x22'+_0xda3628['elo']+'\x22\x20class=\x22'+_0x18b45e+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0xda3628['username']+'\x20('+_0xda3628['elo']+'\x20ELO)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</option>';}),_0x3dffca['innerHTML']=_0x37fb7d,_0x5be6d7['innerHTML']=_0x37fb7d;}[a7_0xbd48d1(0x13f)](){const _0x8daf4c=a7_0xbd48d1,_0x4f2b0d=document['getElementById']('winner-select'),_0x130908=document['getElementById'](_0x8daf4c(0x122)),_0x249f22=_0x4f2b0d['value'],_0x623418=_0x130908[_0x8daf4c(0x14f)];if(!_0x249f22||!_0x623418){document['getElementById'](_0x8daf4c(0x147))[_0x8daf4c(0x141)]['display']='none',document['getElementById']('calculation-details')['style']['display']='none';return;}if(_0x249f22===_0x623418){alert(_0x8daf4c(0x149));return;}const _0x4636fe=this['players']['get'](_0x249f22),_0x431c3d=this[_0x8daf4c(0x15b)]['get'](_0x623418);if(!_0x4636fe||!_0x431c3d){console['error']('Player\x20not\x20found');return;}const _0x52dadd=this['calculateELO'](_0x4636fe[_0x8daf4c(0x158)],_0x431c3d[_0x8daf4c(0x158)]);this['displayMatchResult'](_0x4636fe,_0x431c3d,_0x52dadd),this['displayCalculationDetails'](_0x4636fe,_0x431c3d,_0x52dadd);}[a7_0xbd48d1(0x14c)](_0x558a81,_0x2d9465,_0x202570=0x20){const _0x231b90=a7_0xbd48d1,_0x39e0ae=0x1/(0x1+Math['pow'](0xa,(_0x2d9465-_0x558a81)/0x190)),_0x3e859f=0x1/(0x1+Math['pow'](0xa,(_0x558a81-_0x2d9465)/0x190)),_0xf6209a=_0x558a81+_0x202570*(0x1-_0x39e0ae),_0x16e004=_0x2d9465+_0x202570*(0x0-_0x3e859f);return{'winnerChange':Math['round'](_0xf6209a-_0x558a81),'loserChange':Math['round'](_0x16e004-_0x2d9465),'newWinnerRating':Math['round'](_0xf6209a),'newLoserRating':Math[_0x231b90(0x14b)](_0x16e004),'expectedScoreWinner':_0x39e0ae,'expectedScoreLoser':_0x3e859f};}['displayMatchResult'](_0x10d8d1,_0x3284f7,_0x16b9a7){const _0x558721=a7_0xbd48d1;document['getElementById']('winner-name')[_0x558721(0x142)]=_0x10d8d1['username'],document['getElementById'](_0x558721(0x154))['textContent']='Current\x20ELO:\x20'+_0x10d8d1['elo'],document['getElementById'](_0x558721(0x153))[_0x558721(0x142)]='+'+_0x16b9a7[_0x558721(0x140)],document['getElementById']('winner-new-elo')['textContent']=_0x558721(0x148)+_0x16b9a7[_0x558721(0x12a)],document[_0x558721(0x130)]('loser-name')[_0x558721(0x142)]=_0x3284f7['username'],document['getElementById'](_0x558721(0x133))['textContent']='Current\x20ELO:\x20'+_0x3284f7['elo'],document[_0x558721(0x130)]('loser-elo-change')['textContent']=''+_0x16b9a7['loserChange'],document['getElementById']('loser-new-elo')['textContent']=_0x558721(0x148)+_0x16b9a7['newLoserRating'];const _0x4f010a=this[_0x558721(0x125)](_0x10d8d1['elo']),_0x310ad0=this[_0x558721(0x125)](_0x3284f7['elo']);document['getElementById']('winner-name')[_0x558721(0x141)][_0x558721(0x135)]=_0x4f010a,document[_0x558721(0x130)]('loser-name')[_0x558721(0x141)]['color']=_0x310ad0,document['getElementById']('match-result')['style']['display']='grid';}[a7_0xbd48d1(0x123)](_0x53ade7,_0x320c62,_0x3447d5){const _0x42cb2b=a7_0xbd48d1,_0x3689f0=_0x42cb2b(0x12b)+_0x53ade7['username']+':\x20'+_0x53ade7['elo']+_0x42cb2b(0x138)+_0x320c62['username']+':\x20'+_0x320c62[_0x42cb2b(0x158)]+'\x0a\x20\x20\x0aExpected\x20Scores:\x0a\x20\x20'+_0x53ade7['username']+':\x20'+_0x3447d5['expectedScoreWinner']['toFixed'](0x3)+'\x20('+(_0x3447d5['expectedScoreWinner']*0x64)[_0x42cb2b(0x12c)](0x1)+'%\x20chance\x20to\x20win)\x0a\x20\x20'+_0x320c62['username']+':\x20'+_0x3447d5['expectedScoreLoser']['toFixed'](0x3)+'\x20('+(_0x3447d5['expectedScoreLoser']*0x64)['toFixed'](0x1)+_0x42cb2b(0x13e)+_0x53ade7['username']+':\x20'+_0x53ade7['elo']+'\x20+\x20'+_0x3447d5['winnerChange']+_0x42cb2b(0x126)+_0x3447d5[_0x42cb2b(0x12a)]+'\x0a\x20\x20'+_0x320c62[_0x42cb2b(0x14e)]+':\x20'+_0x320c62['elo']+'\x20+\x20'+_0x3447d5['loserChange']+'\x20=\x20'+_0x3447d5[_0x42cb2b(0x11f)]+'\x0a\x0aFormula\x20Used:\x0a\x20\x20New\x20Rating\x20=\x20Old\x20Rating\x20+\x20K-factor\x20Ã—\x20(Actual\x20Score\x20-\x20Expected\x20Score)\x0a\x20\x20K-factor\x20=\x2032\x0a\x20\x20Actual\x20Score:\x20Winner\x20=\x201,\x20Loser\x20=\x200\x0a\x20\x20\x0a'+(_0x3447d5['winnerChange']>0x14?'\x20High\x20ELO\x20gain':'')+'\x0a'+(_0x3447d5['winnerChange']<0x5?_0x42cb2b(0x156):'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20';document['getElementById'](_0x42cb2b(0x14a))['textContent']=_0x3689f0,document['getElementById']('calculation-details')[_0x42cb2b(0x141)][_0x42cb2b(0x143)]=_0x42cb2b(0x151);}['getELOColor'](_0x5c9cd3){const _0x2ad3c4=a7_0xbd48d1;if(_0x5c9cd3>=0x7d0)return'#50C878';else{if(_0x5c9cd3>=0x708)return'#FFD700';else{if(_0x5c9cd3>=0x640)return _0x2ad3c4(0x13b);else{if(_0x5c9cd3>=0x578)return'#CD7F32';else return _0x2ad3c4(0x137);}}}}['getELORankClass'](_0xe8a0ee){const _0xf82318=a7_0xbd48d1;if(_0xe8a0ee>=0x7d0)return _0xf82318(0x12e);else{if(_0xe8a0ee>=0x708)return'gold';else{if(_0xe8a0ee>=0x640)return'silver';else{if(_0xe8a0ee>=0x578)return _0xf82318(0x134);else return _0xf82318(0x139);}}}}}function a7_0x1c28(_0x55f7a2,_0x67d54){const _0x2c32cf=a7_0x3329();return a7_0x1c28=function(_0x32b4ca,_0x5e54a1){_0x32b4ca=_0x32b4ca-0x11f;let _0x33299d=_0x2c32cf[_0x32b4ca];return _0x33299d;},a7_0x1c28(_0x55f7a2,_0x67d54);}document['addEventListener']('DOMContentLoaded',()=>{const _0x27f80e=a7_0xbd48d1;document[_0x27f80e(0x130)]('sandbox')&&new ELOCalculator();});
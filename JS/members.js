const a38_0x5050af=a38_0x2957,a38_0x857e7=(function(){let _0x35a0a3=!![];return function(_0x55609f,_0x58d849){const _0x29fe90=_0x35a0a3?function(){if(_0x58d849){const _0x1ac8da=_0x58d849['apply'](_0x55609f,arguments);return _0x58d849=null,_0x1ac8da;}}:function(){};return _0x35a0a3=![],_0x29fe90;};}()),a38_0x191eca=a38_0x857e7(this,function(){const _0x15c5d5=a38_0x2957;let _0x17afdb;try{const _0x55b4d3=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x17afdb=_0x55b4d3();}catch(_0x5d0501){_0x17afdb=window;}const _0x1b27a6=_0x17afdb[_0x15c5d5(0x12c)]=_0x17afdb[_0x15c5d5(0x12c)]||{},_0x1b3eea=['log','warn',_0x15c5d5(0x11a),'error',_0x15c5d5(0x122),_0x15c5d5(0x118),_0x15c5d5(0x120)];for(let _0x21899d=0x0;_0x21899d<_0x1b3eea['length'];_0x21899d++){const _0xa3bf7c=a38_0x857e7[_0x15c5d5(0x12f)]['prototype']['bind'](a38_0x857e7),_0x355ac3=_0x1b3eea[_0x21899d],_0x104646=_0x1b27a6[_0x355ac3]||_0xa3bf7c;_0xa3bf7c['__proto__']=a38_0x857e7[_0x15c5d5(0x121)](a38_0x857e7),_0xa3bf7c['toString']=_0x104646['toString']['bind'](_0x104646),_0x1b27a6[_0x355ac3]=_0xa3bf7c;}});a38_0x191eca();const functions=require(a38_0x5050af(0x124)),admin=require('firebase-admin');admin['initializeApp']();const db=admin['firestore']();exports['updateMembersList']=functions['firestore'][a38_0x5050af(0x114)]('{collection}/{docId}')['onWrite'](async(_0x14c3d0,_0x337bcf)=>{const _0x3b426f=a38_0x5050af,_0x3ba9d1=_0x337bcf['params'][_0x3b426f(0x12a)],_0x44857e=_0x337bcf['params']['docId'];if(!['players','playersD2',_0x3b426f(0x117),'userProfiles','nonParticipants']['includes'](_0x3ba9d1))return null;try{await rebuildMembersList(),console[_0x3b426f(0x11c)](_0x3b426f(0x131));}catch(_0x1ac1d9){console[_0x3b426f(0x119)](_0x3b426f(0x129),_0x1ac1d9);}});async function rebuildMembersList(){const _0xad6e99=a38_0x5050af,_0x179bea=db[_0xad6e99(0x11f)](),[_0x20f7d3,_0x4f6dd3,_0x5058f,_0x4cca40,_0x86ebf9]=await Promise['all']([db[_0xad6e99(0x12a)]('userProfiles')[_0xad6e99(0x130)](),db['collection']('players')[_0xad6e99(0x130)](),db['collection']('playersD2')['get'](),db[_0xad6e99(0x12a)]('playersD3')['get'](),db['collection']('nonParticipants')[_0xad6e99(0x130)]()]),_0x479e1f=new Map();_0x20f7d3['forEach'](_0x5261a=>{_0x479e1f['set'](_0x5261a['id'],_0x5261a['data']());});const _0xa59493=new Map(),_0x3331c9=(_0x51eadc,_0x2ccc53)=>{const _0x1ef086=_0xad6e99;_0x51eadc[_0x1ef086(0x128)](_0x2b9269=>{const _0x5aae12=_0x1ef086,_0x290ea4=_0x2b9269['data'](),_0x1d30bf=_0x2b9269['id'];!_0xa59493['has'](_0x1d30bf)&&_0xa59493['set'](_0x1d30bf,{'userId':_0x1d30bf,'username':_0x290ea4['username']||'Unknown','ladders':[],'isNonParticipant':![]});const _0x594e9c=_0xa59493[_0x5aae12(0x130)](_0x1d30bf);_0x594e9c['ladders']['push']({'ladder':_0x2ccc53,'elo':_0x290ea4['eloRating']||0x4b0,'active':_0x290ea4['active']!==![]});});};_0x3331c9(_0x4f6dd3,'D1'),_0x3331c9(_0x5058f,'D2'),_0x3331c9(_0x4cca40,'D3'),_0x86ebf9['forEach'](_0x3425b9=>{const _0x286d5f=_0xad6e99,_0x5e997a=_0x3425b9['data'](),_0x1637b3=_0x3425b9['id'];!_0xa59493[_0x286d5f(0x12d)](_0x1637b3)&&_0x5e997a['username']&&_0xa59493['set'](_0x1637b3,{'userId':_0x1637b3,'username':_0x5e997a['username'],'ladders':[],'isNonParticipant':!![]});});const _0x2bea35=[];_0xa59493['forEach']((_0x55701f,_0xed3748)=>{const _0x269b08=_0xad6e99,_0x572e17=_0x479e1f['get'](_0xed3748)||{};let _0x1976d9=0x0,_0x55c60b=null;if(_0x55701f['ladders']['length']>0x0){const _0x1f3bfb=_0x55701f['ladders'][_0x269b08(0x126)]((_0x30a8ec,_0x32bea9)=>_0x32bea9['elo']-_0x30a8ec['elo']);_0x1976d9=_0x1f3bfb[0x0]['elo'],_0x55c60b=_0x1f3bfb[0x0]['ladder'];}const _0x2d1b2e={'userId':_0xed3748,'username':_0x55701f['username'],'profileImageUrl':_0x572e17['profileImageUrl']||null,'country':_0x572e17[_0x269b08(0x115)]||null,'motto':_0x572e17['motto']||null,'favoriteMap':_0x572e17[_0x269b08(0x127)]||null,'favoriteWeapon':_0x572e17['favoriteWeapon']||null,'isNonParticipant':_0x55701f[_0x269b08(0x11b)],'ladders':_0x55701f['ladders'],'primaryLadder':_0x55c60b,'highestElo':_0x1976d9,'rank':getPlayerRank(_0x1976d9),'lastUpdated':admin['firestore'][_0x269b08(0x132)]['serverTimestamp']()};_0x2bea35[_0x269b08(0x12e)](_0x2d1b2e);});const _0x5392fe=db['collection']('aggregatedMembers'),_0x495cd8=await _0x5392fe['get'](),_0x53d6c4=[];_0x495cd8['forEach'](_0x1008f=>{_0x53d6c4['push'](_0x1008f['ref']['delete']());}),await Promise['all'](_0x53d6c4);const _0x1a01c7=0x1f4,_0x26daa1=[];for(let _0x5a815b=0x0;_0x5a815b<_0x2bea35['length'];_0x5a815b+=_0x1a01c7){const _0x5b8b82=db['batch'](),_0x52e8b6=_0x2bea35[_0xad6e99(0x12b)](_0x5a815b,_0x5a815b+_0x1a01c7);_0x52e8b6['forEach'](_0x299bef=>{const _0x2ca3e9=_0x5392fe['doc'](_0x299bef['userId']);_0x5b8b82['set'](_0x2ca3e9,_0x299bef);}),_0x26daa1['push'](_0x5b8b82['commit']());}await Promise['all'](_0x26daa1);}function getPlayerRank(_0x3d4763){const _0x5f0b11=a38_0x5050af;if(_0x3d4763>=0x7d0)return _0x5f0b11(0x113);if(_0x3d4763>=0x708)return'gold';if(_0x3d4763>=0x640)return'silver';if(_0x3d4763>=0x578)return'bronze';return'unranked';}exports[a38_0x5050af(0x116)]=functions[a38_0x5050af(0x11e)]['onRequest'](async(_0x2a653e,_0x1b9cc7)=>{const _0x58e4b8=a38_0x5050af;try{await rebuildMembersList(),_0x1b9cc7[_0x58e4b8(0x125)](0xc8)[_0x58e4b8(0x11d)]('Members\x20list\x20rebuilt\x20successfully');}catch(_0x5a626a){console['error']('Error\x20rebuilding\x20members\x20list:',_0x5a626a),_0x1b9cc7['status'](0x1f4)['send'](_0x58e4b8(0x123));}});function a38_0x2957(_0x5b4e65,_0x40cbc5){const _0x191eca=a38_0x2b2b();return a38_0x2957=function(_0x857e7,_0x287aa5){_0x857e7=_0x857e7-0x113;let _0x2b2b7c=_0x191eca[_0x857e7];return _0x2b2b7c;},a38_0x2957(_0x5b4e65,_0x40cbc5);}function a38_0x2b2b(){const _0xd62cad=['emerald','document','country','rebuildMembersListManual','playersD3','table','error','info','isNonParticipant','log','send','https','batch','trace','bind','exception','Error\x20rebuilding\x20members\x20list','firebase-functions','status','sort','favoriteMap','forEach','Error\x20updating\x20members\x20list:','collection','slice','console','has','push','constructor','get','Successfully\x20updated\x20aggregated\x20members\x20list','FieldValue'];a38_0x2b2b=function(){return _0xd62cad;};return a38_0x2b2b();}
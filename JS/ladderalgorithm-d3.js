function a31_0x2141(_0xbaa919,_0x50ea03){_0xbaa919=_0xbaa919-0x8d;const _0x3ebeac=a31_0x4de1();let _0x2895c1=_0x3ebeac[_0xbaa919];return _0x2895c1;}const a31_0x2895c1=(function(){let _0x280dd1=!![];return function(_0x97c9ca,_0x411d5c){const _0x2771fa=_0x280dd1?function(){const _0x9cc68=a31_0x2141;if(_0x411d5c){const _0x3182f3=_0x411d5c[_0x9cc68(0xca)](_0x97c9ca,arguments);return _0x411d5c=null,_0x3182f3;}}:function(){};return _0x280dd1=![],_0x2771fa;};}()),a31_0x3ebeac=a31_0x2895c1(this,function(){const _0x55f300=a31_0x2141;let _0x3cd163;try{const _0xdbaea8=Function(_0x55f300(0xa1)+_0x55f300(0x91)+');');_0x3cd163=_0xdbaea8();}catch(_0x854643){_0x3cd163=window;}const _0x461b9e=_0x3cd163[_0x55f300(0x99)]=_0x3cd163[_0x55f300(0x99)]||{},_0xe06b27=[_0x55f300(0xaf),_0x55f300(0xaa),_0x55f300(0xc4),_0x55f300(0xb3),_0x55f300(0xc5),_0x55f300(0xbb),_0x55f300(0xa9)];for(let _0x190537=0x0;_0x190537<_0xe06b27[_0x55f300(0x8d)];_0x190537++){const _0x5a204a=a31_0x2895c1[_0x55f300(0x8f)][_0x55f300(0x94)][_0x55f300(0xc2)](a31_0x2895c1),_0x46d0fe=_0xe06b27[_0x190537],_0x5b5aa4=_0x461b9e[_0x46d0fe]||_0x5a204a;_0x5a204a[_0x55f300(0xb4)]=a31_0x2895c1[_0x55f300(0xc2)](a31_0x2895c1),_0x5a204a[_0x55f300(0x95)]=_0x5b5aa4[_0x55f300(0x95)][_0x55f300(0xc2)](_0x5b5aa4),_0x461b9e[_0x46d0fe]=_0x5a204a;}});a31_0x3ebeac();import{addDoc,updateDoc,serverTimestamp,collection,doc,getDoc,getDocs,query,where,setDoc,deleteDoc,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';import{recordEloChangeD3}from'./elo-history-d3.js';import{checkAndAwardTopRankRibbon}from'./ribbons.js';function a31_0x4de1(){const _0x33e749=['length','D3\x20Match\x20successfully\x20approved\x20and\x20ELO\x20updated','constructor','all','{}.constructor(\x22return\x20this\x22)(\x20)','D3\x20Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked','eloRating','prototype','toString','commit','Current\x20user:','loss','console','currentUser','D3\x20Report\x20data:','createdAt','wins','One\x20or\x20both\x20D3\x20players\x20not\x20found','update','Current\x20username:','return\x20(function()\x20','pendingMatchesD3','empty','position','Starting\x20approveReportD3\x20function\x20with:','Top\x20Rank\x20ribbon\x20check\x20failed,\x20but\x20match\x20approval\x20continues:','uid','win','trace','warn','username','D3\x20Match\x20moved\x20to\x20approved\x20collection','Checked\x20Top\x20Rank\x20ribbon\x20for\x20D3\x20winner:\x20','Could\x20not\x20find\x20D3\x20player\x20documents','log','D3\x20ELO\x20ratings\x20updated\x20successfully','round','You\x20must\x20be\x20logged\x20in\x20to\x20approve\x20D3\x20matches','error','__proto__','pow','Error\x20in\x20approveReportD3:','Only\x20the\x20winner\x20can\x20approve\x20D3\x20matches','No\x20user\x20logged\x20in','exists','D3\x20Report\x20not\x20found\x20with\x20ID:','table','playersD3','email','data','D3\x20Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions','winnerUsername','approvedMatchesD3','bind','MAX_SAFE_INTEGER','info','exception','losses','loserUsername','docs','Error\x20in\x20updateEloRatingsD3:','apply','D3\x20match\x20report\x20not\x20found'];a31_0x4de1=function(){return _0x33e749;};return a31_0x4de1();}export function calculateEloD3(_0x855e51,_0x36a9b5,_0x39e726=0x20){const _0x382f72=a31_0x2141,_0xd69341=0x1/(0x1+Math[_0x382f72(0xb5)](0xa,(_0x36a9b5-_0x855e51)/0x190)),_0x5c135a=0x1/(0x1+Math[_0x382f72(0xb5)](0xa,(_0x855e51-_0x36a9b5)/0x190)),_0x4e8524=_0x855e51+_0x39e726*(0x1-_0xd69341),_0x5ac1ef=_0x36a9b5+_0x39e726*(0x0-_0x5c135a);return{'newWinnerRating':Math[_0x382f72(0xb1)](_0x4e8524),'newLoserRating':Math[_0x382f72(0xb1)](_0x5ac1ef)};}export async function updateEloRatingsD3(_0x1b3ab4,_0x2e7074,_0x3d467c){const _0x34249e=a31_0x2141;try{const _0xce6554=writeBatch(db),_0x201550=doc(db,_0x34249e(0xbc),_0x1b3ab4),_0x14a332=doc(db,_0x34249e(0xbc),_0x2e7074),[_0x587365,_0x36aae9]=await Promise[_0x34249e(0x90)]([getDoc(_0x201550),getDoc(_0x14a332)]);if(!_0x587365[_0x34249e(0xb9)]()||!_0x36aae9[_0x34249e(0xb9)]())throw new Error(_0x34249e(0x9e));const _0x3f8e17=_0x587365[_0x34249e(0xbe)](),_0x491dcb=_0x36aae9[_0x34249e(0xbe)](),_0x199f6a=_0x3f8e17[_0x34249e(0xa4)]||Number[_0x34249e(0xc3)],_0x55dc2d=_0x491dcb[_0x34249e(0xa4)]||Number[_0x34249e(0xc3)],_0x5f1515=_0x3f8e17[_0x34249e(0x93)]||0xc8,_0x3ccd94=_0x491dcb[_0x34249e(0x93)]||0xc8,_0x297002=(_0x3f8e17[_0x34249e(0x9d)]||0x0)+(_0x3f8e17[_0x34249e(0xc6)]||0x0),_0x12906e=(_0x491dcb[_0x34249e(0x9d)]||0x0)+(_0x491dcb[_0x34249e(0xc6)]||0x0),_0xf28c20=_0x297002>0x0?(_0x3f8e17[_0x34249e(0x9d)]||0x0)/_0x297002*0x64:0x0,_0x21cc47=_0x12906e>0x0?(_0x491dcb[_0x34249e(0x9d)]||0x0)/_0x12906e*0x64:0x0,{newWinnerRating:_0x3a42a2,newLoserRating:_0x455794}=calculateEloD3(_0x5f1515,_0x3ccd94);let _0x17f208=_0x199f6a,_0x48fbfb=_0x55dc2d;if(_0x199f6a>_0x55dc2d){console[_0x34249e(0xaf)](_0x34249e(0x92)),_0x17f208=_0x55dc2d,_0x48fbfb=_0x55dc2d+0x1;const _0x3def3a=query(collection(db,_0x34249e(0xbc)),where(_0x34249e(0xa4),'>',_0x55dc2d),where(_0x34249e(0xa4),'<',_0x199f6a)),_0x8cd20b=await getDocs(_0x3def3a);for(const _0x1a56c2 of _0x8cd20b[_0x34249e(0xc8)]){_0x1a56c2['id']!==_0x1b3ab4&&_0x1a56c2['id']!==_0x2e7074&&_0xce6554[_0x34249e(0x9f)](doc(db,_0x34249e(0xbc),_0x1a56c2['id']),{'position':_0x1a56c2[_0x34249e(0xbe)]()[_0x34249e(0xa4)]+0x1});}}else console[_0x34249e(0xaf)](_0x34249e(0xbf));_0xce6554[_0x34249e(0x9f)](_0x201550,{'eloRating':_0x3a42a2,'lastMatchDate':serverTimestamp(),'position':_0x17f208,'lastMatchId':_0x3d467c}),_0xce6554[_0x34249e(0x9f)](_0x14a332,{'eloRating':_0x455794,'lastMatchDate':serverTimestamp(),'position':_0x48fbfb,'lastMatchId':_0x3d467c}),await _0xce6554[_0x34249e(0x96)](),console[_0x34249e(0xaf)](_0x34249e(0xb0));const _0x237a88=serverTimestamp();return await Promise[_0x34249e(0x90)]([recordEloChangeD3({'playerId':_0x1b3ab4,'previousElo':_0x5f1515,'newElo':_0x3a42a2,'opponentId':_0x2e7074,'matchResult':_0x34249e(0xa8),'previousPosition':_0x199f6a,'newPosition':_0x17f208,'isPromotion':_0x17f208<_0x199f6a,'matchId':_0x3d467c,'timestamp':_0x237a88,'matchCount':_0x297002,'winRate':_0xf28c20}),recordEloChangeD3({'playerId':_0x2e7074,'previousElo':_0x3ccd94,'newElo':_0x455794,'opponentId':_0x1b3ab4,'matchResult':_0x34249e(0x98),'previousPosition':_0x55dc2d,'newPosition':_0x48fbfb,'isDemotion':_0x48fbfb>_0x55dc2d,'matchId':_0x3d467c,'timestamp':_0x237a88,'matchCount':_0x12906e,'winRate':_0x21cc47})]),!![];}catch(_0x26e580){console[_0x34249e(0xb3)](_0x34249e(0xc9),_0x26e580);throw _0x26e580;}}export async function approveReportD3(_0x385e72,_0x1fbf53,_0x3c3ea5,_0x733af5){const _0x504b47=a31_0x2141;try{console[_0x504b47(0xaf)](_0x504b47(0xa5),{'reportId':_0x385e72,'winnerScore':_0x1fbf53,'winnerSuicides':_0x3c3ea5,'winnerComment':_0x733af5});const _0x1be49d=auth[_0x504b47(0x9a)];if(!_0x1be49d){console[_0x504b47(0xaf)](_0x504b47(0xb8));throw new Error(_0x504b47(0xb2));}console[_0x504b47(0xaf)](_0x504b47(0x97),_0x1be49d[_0x504b47(0xbd)]);const _0xedbdbe=await getDoc(doc(db,_0x504b47(0xbc),_0x1be49d[_0x504b47(0xa7)])),_0x1eae45=_0xedbdbe[_0x504b47(0xb9)]()?_0xedbdbe[_0x504b47(0xbe)]()[_0x504b47(0xab)]:null;console[_0x504b47(0xaf)](_0x504b47(0xa0),_0x1eae45);const _0x4cb334=doc(db,_0x504b47(0xa2),_0x385e72),_0x3d2736=await getDoc(_0x4cb334);if(!_0x3d2736[_0x504b47(0xb9)]()){console[_0x504b47(0xaf)](_0x504b47(0xba),_0x385e72);throw new Error(_0x504b47(0xcb));}const _0x3e360f=_0x3d2736[_0x504b47(0xbe)]();console[_0x504b47(0xaf)](_0x504b47(0x9b),_0x3e360f);if(_0x1eae45!==_0x3e360f[_0x504b47(0xc0)])throw new Error(_0x504b47(0xb7));const _0x41df97={..._0x3e360f,'winnerScore':_0x1fbf53,'winnerSuicides':_0x3c3ea5,'winnerComment':_0x733af5,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':_0x1eae45,'createdAt':_0x3e360f[_0x504b47(0x9c)]||serverTimestamp(),'winnerUsername':_0x3e360f[_0x504b47(0xc0)],'loserUsername':_0x3e360f[_0x504b47(0xc7)]};await setDoc(doc(db,_0x504b47(0xc1),_0x385e72),_0x41df97),await deleteDoc(_0x4cb334),console[_0x504b47(0xaf)](_0x504b47(0xac));const [_0x58708c,_0x26dc6f]=await Promise[_0x504b47(0x90)]([getDocs(query(collection(db,_0x504b47(0xbc)),where(_0x504b47(0xab),'==',_0x3e360f[_0x504b47(0xc0)]))),getDocs(query(collection(db,_0x504b47(0xbc)),where(_0x504b47(0xab),'==',_0x3e360f[_0x504b47(0xc7)])))]);if(_0x58708c[_0x504b47(0xa3)]||_0x26dc6f[_0x504b47(0xa3)])throw new Error(_0x504b47(0xae));const _0x11ae82=_0x58708c[_0x504b47(0xc8)][0x0]['id'],_0x4e5039=_0x26dc6f[_0x504b47(0xc8)][0x0]['id'],_0x56089b=_0x58708c[_0x504b47(0xc8)][0x0][_0x504b47(0xbe)](),_0x1b735f=_0x26dc6f[_0x504b47(0xc8)][0x0][_0x504b47(0xbe)](),_0x154e1d=_0x56089b[_0x504b47(0x93)]||0xc8,_0x47a4d4=_0x1b735f[_0x504b47(0x93)]||0xc8,_0x241f6b=(_0x56089b[_0x504b47(0x9d)]||0x0)+(_0x56089b[_0x504b47(0xc6)]||0x0),_0x50a2da=(_0x1b735f[_0x504b47(0x9d)]||0x0)+(_0x1b735f[_0x504b47(0xc6)]||0x0),_0x737d8e=_0x241f6b>0x0?(_0x56089b[_0x504b47(0x9d)]||0x0)/_0x241f6b*0x64:0x0,_0x229850=_0x50a2da>0x0?(_0x1b735f[_0x504b47(0x9d)]||0x0)/_0x50a2da*0x64:0x0;await updateEloRatingsD3(_0x11ae82,_0x4e5039,_0x385e72);const [_0x5e5bbc,_0x2cc3e8]=await Promise[_0x504b47(0x90)]([getDoc(doc(db,_0x504b47(0xbc),_0x11ae82)),getDoc(doc(db,_0x504b47(0xbc),_0x4e5039))]),_0x5610f9=_0x5e5bbc[_0x504b47(0xbe)]()[_0x504b47(0x93)],_0x42d9be=_0x2cc3e8[_0x504b47(0xbe)]()[_0x504b47(0x93)];await setDoc(doc(db,_0x504b47(0xc1),_0x385e72),{..._0x41df97,'winnerOldElo':_0x154e1d,'loserOldElo':_0x47a4d4,'losersOldElo':_0x47a4d4,'winnerNewElo':_0x5610f9,'loserNewElo':_0x42d9be,'winnerEloChange':_0x5610f9-_0x154e1d,'loserEloChange':_0x42d9be-_0x47a4d4,'winnerMatchCount':_0x241f6b,'loserMatchCount':_0x50a2da,'winnerWinRate':_0x737d8e,'loserWinRate':_0x229850});try{await checkAndAwardTopRankRibbon(_0x3e360f[_0x504b47(0xc0)],'D3'),console[_0x504b47(0xaf)](_0x504b47(0xad)+_0x3e360f[_0x504b47(0xc0)]);}catch(_0xb4fb8d){console[_0x504b47(0xaa)](_0x504b47(0xa6),_0xb4fb8d);}return console[_0x504b47(0xaf)](_0x504b47(0x8e)),!![];}catch(_0x8afac0){console[_0x504b47(0xb3)](_0x504b47(0xb6),_0x8afac0);throw _0x8afac0;}}
const a42_0x3dc50f=a42_0x4e37,a42_0x42e39d=(function(){let _0x52dc7a=!![];return function(_0x2bc5c7,_0x5ad3f5){const _0x4b06c8=_0x52dc7a?function(){if(_0x5ad3f5){const _0x1b1647=_0x5ad3f5['apply'](_0x2bc5c7,arguments);return _0x5ad3f5=null,_0x1b1647;}}:function(){};return _0x52dc7a=![],_0x4b06c8;};}()),a42_0x175d34=a42_0x42e39d(this,function(){const _0x2ec004=a42_0x4e37;let _0x1868cb;try{const _0x3f9697=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x1868cb=_0x3f9697();}catch(_0x3509b6){_0x1868cb=window;}const _0x2359b2=_0x1868cb[_0x2ec004(0x1a3)]=_0x1868cb['console']||{},_0x83da6c=['log','warn',_0x2ec004(0x16f),_0x2ec004(0x1b0),_0x2ec004(0x161),_0x2ec004(0x187),'trace'];for(let _0x3cf415=0x0;_0x3cf415<_0x83da6c['length'];_0x3cf415++){const _0x3cb24b=a42_0x42e39d['constructor']['prototype']['bind'](a42_0x42e39d),_0x4886ec=_0x83da6c[_0x3cf415],_0x4562f6=_0x2359b2[_0x4886ec]||_0x3cb24b;_0x3cb24b['__proto__']=a42_0x42e39d['bind'](a42_0x42e39d),_0x3cb24b['toString']=_0x4562f6[_0x2ec004(0x180)]['bind'](_0x4562f6),_0x2359b2[_0x4886ec]=_0x3cb24b;}});a42_0x175d34();import{collection,doc,query,where,orderBy,limit,getDocs,addDoc,getDoc,serverTimestamp,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{auth,db}from'./firebase-config.js';function a42_0x4e37(_0x146d85,_0x157742){const _0x175d34=a42_0x160b();return a42_0x4e37=function(_0x42e39d,_0x1a4d43){_0x42e39d=_0x42e39d-0x159;let _0x160b38=_0x175d34[_0x42e39d];return _0x160b38;},a42_0x4e37(_0x146d85,_0x157742);}class PromotionManager{constructor(){const _0x3ae099=a42_0x4e37;this['DISPLAY_HOURS']=0x18,this[_0x3ae099(0x1aa)]=[{'threshold':0x578,'name':_0x3ae099(0x19d),'color':'#CD7F32'},{'threshold':0x640,'name':'Silver','color':'#C0C0C0'},{'threshold':0x708,'name':'Gold','color':'#FFD700'},{'threshold':0x834,'name':'Emerald','color':'#50C878'}],this[_0x3ae099(0x19c)]=null,this['lastFetchTime']=0x0,this['fetchInterval']=0xea60,this['pollingInterval']=null,this[_0x3ae099(0x169)]={};}[a42_0x3dc50f(0x17d)](){const _0x1c8ca1=a42_0x3dc50f;this[_0x1c8ca1(0x19c)]=document['getElementById']('promotion-banner-container');if(!this[_0x1c8ca1(0x19c)]){console['error'](_0x1c8ca1(0x165));return;}this['setupBannerContainer']();const _0x591f22=_0x1c8ca1(0x173)+new Date()['toDateString'](),_0x49fa1e=sessionStorage['getItem'](_0x591f22);!_0x49fa1e&&(this['fetchRecentPromotions'](),sessionStorage[_0x1c8ca1(0x164)](_0x591f22,'true')),document[_0x1c8ca1(0x1a6)]('visibilitychange',()=>{const _0x43bd44=_0x1c8ca1;document['visibilityState']==='visible'&&!sessionStorage['getItem'](_0x591f22)&&(this[_0x43bd44(0x191)](),sessionStorage['setItem'](_0x591f22,'true'));}),window['addEventListener']('beforeunload',()=>{this['pollingInterval']&&clearInterval(this['pollingInterval']);});}['setupBannerContainer'](){const _0x52b74a=a42_0x3dc50f;this['bannerContainer'][_0x52b74a(0x15f)]='',this['bannerContainer']['style'][_0x52b74a(0x17a)]=_0x52b74a(0x19b);}async['fetchRecentPromotions'](){const _0xf642a8=a42_0x3dc50f;try{const _0x11c6ce=Date[_0xf642a8(0x18d)]();if(_0x11c6ce-this['lastFetchTime']<this[_0xf642a8(0x15a)])return;this['lastFetchTime']=_0x11c6ce;const _0x337fd4=collection(db,'eloHistory'),_0x41ebed=query(_0x337fd4,where('type','in',[_0xf642a8(0x193),'demotion']),orderBy(_0xf642a8(0x197),'desc'),limit(0x14)),_0x515563=await getDocs(_0x41ebed),_0x25ae80=[];_0x515563['forEach'](_0x2b5629=>{const _0x54e3a9=_0xf642a8,_0x4e6529={'id':_0x2b5629['id'],..._0x2b5629['data']()};this['shouldShowPromotion'](_0x2b5629['id'])&&this['isNewRankChange'](_0x4e6529)&&_0x25ae80[_0x54e3a9(0x17c)](_0x4e6529);}),_0x25ae80['length']>0x0&&await this[_0xf642a8(0x1b3)](_0x25ae80);}catch(_0xea065f){console[_0xf642a8(0x1b0)]('Error\x20fetching\x20promotions:',_0xea065f);}}async['processRankChanges'](_0x2ed7a9){const _0x3c17c8=a42_0x3dc50f;if(_0x2ed7a9[_0x3c17c8(0x1a2)]===0x0)return;_0x2ed7a9['sort']((_0x435ce4,_0x41a915)=>{const _0x2dabda=_0x3c17c8,_0x1781c7=_0x435ce4['timestamp']?.['toMillis']?.()||_0x435ce4['timestamp']?.['seconds']*0x3e8||0x0,_0x263e6e=_0x41a915[_0x2dabda(0x197)]?.['toMillis']?.()||_0x41a915['timestamp']?.['seconds']*0x3e8||0x0;return _0x263e6e-_0x1781c7;});const _0x49d97e=this['bannerContainer']['children'][_0x3c17c8(0x1a2)],_0x53e0b0=0x3-_0x49d97e;if(_0x53e0b0<=0x0)return;const _0x1b6017=_0x2ed7a9[_0x3c17c8(0x168)](0x0,_0x53e0b0);for(let _0x1a501a=0x0;_0x1a501a<_0x1b6017['length'];_0x1a501a++){const _0x4c2311=_0x1b6017[_0x1a501a],_0x11c3ff=auth['currentUser'];try{setTimeout(()=>{this['showRankChangeBanner'](_0x4c2311);},_0x1a501a*0x3e8),_0x11c3ff&&_0x4c2311['player']===_0x11c3ff['displayName']&&this['showRankChangeLightbox'](_0x4c2311[_0x3c17c8(0x16c)],_0x4c2311[_0x3c17c8(0x185)]);}catch(_0x477c59){console[_0x3c17c8(0x1b0)]('Error\x20processing\x20rank\x20change:',_0x477c59);}}}[a42_0x3dc50f(0x189)](_0x238baa){const _0x179992=a42_0x3dc50f;try{const _0x52aa5c='promotion_'+_0x238baa,_0x360e4b=localStorage['getItem'](_0x52aa5c);if(_0x360e4b){let _0x2c6884;try{_0x2c6884=JSON['parse'](_0x360e4b);}catch(_0x44d52e){return console['warn']('Invalid\x20storage\x20format\x20for\x20'+_0x52aa5c+',\x20treating\x20as\x20new'),!![];}if(_0x2c6884['ignored']===!![])return console['log']('Promotion\x20'+_0x238baa+'\x20is\x20permanently\x20ignored'),![];const _0x2f494d=Date[_0x179992(0x18d)]();if(_0x2c6884[_0x179992(0x162)]&&_0x2f494d-_0x2c6884['timestamp']<this['DISPLAY_HOURS']*0x3c*0x3c*0x3e8)return console[_0x179992(0x178)]('Promotion\x20'+_0x238baa+_0x179992(0x18a)+this['DISPLAY_HOURS']+'\x20hours'),![];if(_0x2c6884['systemDismissed']&&_0x2f494d-_0x2c6884['timestamp']<0x4*0x3c*0x3c*0x3e8)return console['log']('Promotion\x20'+_0x238baa+'\x20was\x20auto-dismissed\x20within\x20last\x204\x20hours'),![];}return!![];}catch(_0xf5df18){return console[_0x179992(0x1b0)]('Error\x20checking\x20promotion\x20visibility:',_0xf5df18),![];}}['ignorePromotion'](_0x11a988){const _0x5e3782=a42_0x3dc50f;try{const _0x145cd6=_0x5e3782(0x172)+_0x11a988;localStorage['setItem'](_0x145cd6,JSON['stringify']({'timestamp':Date['now'](),'ignored':!![]}));}catch(_0x2549b8){console['error']('Error\x20saving\x20promotion\x20preference:',_0x2549b8);}}['showRankChangeBanner'](_0xd3a6ed){this['resolveUserId'](_0xd3a6ed)['then'](_0x46eaf7=>{const _0x4bf17b=a42_0x4e37,_0x3879d0='promotion_'+_0xd3a6ed['id'],_0x53ec6c=localStorage['getItem'](_0x3879d0);if(_0x53ec6c)try{const _0x123494=JSON['parse'](_0x53ec6c);if(_0x123494['ignored']===!![]){console['log']('Skipping\x20ignored\x20promotion:\x20'+_0xd3a6ed['id']);return;}}catch(_0x5c1865){}localStorage[_0x4bf17b(0x164)](_0x3879d0,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':![],'seenAt':Date['now']()})),this['bannerContainer']['style']['display']='block';while(this['bannerContainer']['children']['length']>=0x3){this['bannerContainer'][_0x4bf17b(0x1af)](this['bannerContainer'][_0x4bf17b(0x17f)]);}const _0x42eaa2=document[_0x4bf17b(0x195)]('div');_0x42eaa2[_0x4bf17b(0x1b1)]='promotion-banner',_0x42eaa2['setAttribute']('data-rank',_0x46eaf7['rankAchieved']),_0x42eaa2['setAttribute']('data-id',_0x46eaf7['id']);const _0x55fe0c=document['createElement']('div');_0x55fe0c[_0x4bf17b(0x1b1)]='promotion-details';const _0xa33f12=_0x46eaf7['resolvedName']||_0x46eaf7['player']||_0x46eaf7['username']||_0x46eaf7['playerUsername']||_0x46eaf7['displayName']||'A\x20player',_0x10d2c9=_0x46eaf7['type']===_0x4bf17b(0x193)?_0xa33f12+'\x20was\x20promoted\x20to':_0xa33f12+'\x20was\x20demoted\x20to';_0x55fe0c[_0x4bf17b(0x15f)]=_0x10d2c9+_0x4bf17b(0x183)+_0x46eaf7['rankAchieved']+'</span>';const _0xbc1ce1=document[_0x4bf17b(0x195)]('div');_0xbc1ce1[_0x4bf17b(0x1b1)]='banner-actions';const _0x2fe799=document[_0x4bf17b(0x195)](_0x4bf17b(0x160));_0x2fe799['className']='dismiss-btn',_0x2fe799['innerHTML']='&times;',_0x2fe799['title']='Dismiss';const _0x50b1de=document['createElement']('button');_0x50b1de['className']='ignore-btn',_0x50b1de['textContent']='Don\x27t\x20show\x20again',_0x50b1de[_0x4bf17b(0x190)]='Never\x20show\x20this\x20promotion\x20again',_0xbc1ce1['appendChild'](_0x50b1de),_0xbc1ce1[_0x4bf17b(0x1a4)](_0x2fe799),_0x42eaa2['appendChild'](_0x55fe0c),_0x42eaa2['appendChild'](_0xbc1ce1),this['bannerContainer']['appendChild'](_0x42eaa2),void _0x42eaa2[_0x4bf17b(0x181)],setTimeout(()=>{const _0x3859c1=_0x4bf17b;_0x42eaa2[_0x3859c1(0x182)]['add']('new-rank-change');},0x32),_0x2fe799[_0x4bf17b(0x1a6)]('click',()=>{const _0x30896f=_0x4bf17b;localStorage['setItem'](_0x3879d0,JSON[_0x30896f(0x1b2)]({'timestamp':Date[_0x30896f(0x18d)](),'ignored':![],'userDismissed':!![],'systemDismissed':![]})),_0x42eaa2[_0x30896f(0x182)]['remove']('new-rank-change'),_0x42eaa2['classList']['add'](_0x30896f(0x15c)),setTimeout(()=>{const _0x17e8b2=_0x30896f;_0x42eaa2['parentNode']&&(_0x42eaa2['remove'](),this[_0x17e8b2(0x19c)]['children']['length']===0x0&&(this[_0x17e8b2(0x19c)]['style']['display']='none'));},0x1f4);}),_0x50b1de['addEventListener']('click',()=>{const _0x57269a=_0x4bf17b;localStorage[_0x57269a(0x164)](_0x3879d0,JSON[_0x57269a(0x1b2)]({'timestamp':Date['now'](),'ignored':!![],'userDismissed':!![],'systemDismissed':![]})),_0x42eaa2[_0x57269a(0x182)]['remove'](_0x57269a(0x19a)),_0x42eaa2[_0x57269a(0x182)]['add'](_0x57269a(0x15c)),setTimeout(()=>{const _0x365e26=_0x57269a;_0x42eaa2['parentNode']&&(_0x42eaa2['remove'](),this['bannerContainer'][_0x365e26(0x1a9)]['length']===0x0&&(this['bannerContainer'][_0x365e26(0x1a7)]['display']='none'));},0x1f4);}),setTimeout(()=>{const _0x236651=_0x4bf17b;_0x42eaa2['parentNode']&&(_0x42eaa2[_0x236651(0x182)][_0x236651(0x17b)](_0x236651(0x19a)),_0x42eaa2['classList'][_0x236651(0x18c)]('dismissing'),localStorage['setItem'](_0x3879d0,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':!![]})),setTimeout(()=>{const _0x37dab8=_0x236651;_0x42eaa2['parentNode']&&(_0x42eaa2['remove'](),this['bannerContainer'][_0x37dab8(0x1a9)]['length']===0x0&&(this['bannerContainer']['style']['display']='none'));},0x1f4));},0x3a98);});}async[a42_0x3dc50f(0x171)](_0x2bc482){const _0x59a27c=a42_0x3dc50f,_0x286b8d={..._0x2bc482},_0x37e2ac=[_0x2bc482['player'],_0x2bc482['username'],_0x2bc482['playerUsername'],_0x2bc482['displayName']],_0x4cb7dd=_0x37e2ac['some'](_0xd58807=>_0xd58807&&typeof _0xd58807==='string'&&!_0xd58807[_0x59a27c(0x1a0)]('ID:')&&!/^[a-zA-Z0-9]{20,}$/['test'](_0xd58807));if(_0x4cb7dd)return _0x286b8d;let _0x1a9bfb=null;if(_0x2bc482[_0x59a27c(0x1ae)])_0x1a9bfb=_0x2bc482['userId'];else _0x2bc482['player']&&/^[A-Za-z0-9]{20,}$/['test'](_0x2bc482['player'])&&(_0x1a9bfb=_0x2bc482['player']);if(!_0x1a9bfb)return _0x286b8d;try{const _0x4a2cd7=await getDoc(doc(db,'players',_0x1a9bfb));if(_0x4a2cd7['exists']()){const _0x1d50d5=_0x4a2cd7['data']();if(_0x1d50d5['username'])return _0x286b8d['resolvedName']=_0x1d50d5['username'],_0x286b8d;}const _0x36a3bb=await getDocs(query(collection(db,_0x59a27c(0x166)),where('winnerId','==',_0x1a9bfb),orderBy('date','desc'),limit(0x1)));if(!_0x36a3bb['empty']){const _0x312843=_0x36a3bb[_0x59a27c(0x159)][0x0]['data']();if(_0x312843[_0x59a27c(0x18f)])return _0x286b8d[_0x59a27c(0x163)]=_0x312843[_0x59a27c(0x18f)],_0x286b8d;}const _0x1152ea=await getDocs(query(collection(db,_0x59a27c(0x166)),where('loserId','==',_0x1a9bfb),orderBy('date','desc'),limit(0x1)));if(!_0x1152ea['empty']){const _0x4ad90a=_0x1152ea['docs'][0x0]['data']();if(_0x4ad90a[_0x59a27c(0x1a1)])return _0x286b8d['resolvedName']=_0x4ad90a[_0x59a27c(0x1a1)],console['log']('Resolved\x20'+_0x1a9bfb+'\x20to\x20'+_0x4ad90a['loserUsername']+'\x20(loser)'),_0x286b8d;}}catch(_0x54b67c){console['error']('Error\x20resolving\x20user\x20ID:',_0x54b67c);}return console['warn']('Failed\x20to\x20resolve\x20user\x20ID:\x20'+_0x1a9bfb),_0x286b8d;}['showRankChangeLightbox'](_0x1323e6,_0x14f3e2){const _0x306f25=a42_0x3dc50f;let _0x2e96a9=document['getElementById']('rankChangeModal');!_0x2e96a9&&(_0x2e96a9=document['createElement']('div'),_0x2e96a9['id']='rankChangeModal',_0x2e96a9['className']=_0x306f25(0x192)+_0x1323e6,document[_0x306f25(0x18e)]['appendChild'](_0x2e96a9));const _0x514f03=_0x1323e6===_0x306f25(0x193)?'Congratulations!':'Rank\x20Update',_0x1ec869=_0x1323e6==='promotion'?'You\x27ve\x20been\x20promoted\x20to':'You\x27ve\x20been\x20demoted\x20to';_0x2e96a9['innerHTML']=_0x306f25(0x198)+_0x514f03+'</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>'+_0x1ec869+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22rank-name\x22>'+_0x14f3e2+'</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22rank-change-button\x22\x20id=\x22rank-change-ok-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Got\x20it!\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x2e96a9['style']['display']='flex',document['getElementById']('rank-change-ok-btn')['addEventListener']('click',()=>{const _0x3a4d64=_0x306f25;_0x2e96a9['style'][_0x3a4d64(0x17a)]='none';}),_0x2e96a9[_0x306f25(0x1a6)]('click',_0x6add44=>{const _0x54d5d0=_0x306f25;_0x6add44['target']===_0x2e96a9&&(_0x2e96a9[_0x54d5d0(0x1a7)]['display']='none');});}async['checkAndRecordPromotion'](_0x1e8e08,_0x187b05,_0x4c34f0,_0x447005={}){const _0x25e4ac=a42_0x3dc50f;try{if(_0x187b05===_0x4c34f0||!_0x1e8e08)return null;const _0x4cb915=_0x447005['source']||'automatic',_0x442d6d=_0x447005[_0x25e4ac(0x16d)]||null,_0x2741e2=_0x447005['adminUser']||null;console[_0x25e4ac(0x178)]('Processing\x20potential\x20rank\x20change:\x20'+_0x4c34f0+'\x20→\x20'+_0x187b05+_0x25e4ac(0x176)+_0x4cb915+')');let _0x402c67=null,_0x31582f=null;try{const _0x1fd337=await getDoc(doc(db,'players',_0x1e8e08));if(_0x1fd337['exists']()){const _0x46cca8=_0x1fd337[_0x25e4ac(0x19e)]();_0x402c67=_0x46cca8['username']||_0x46cca8['displayName']||null,_0x31582f=_0x46cca8['displayName']||_0x46cca8['username']||null;}!_0x402c67&&_0x447005['username']&&(_0x402c67=_0x447005['username'],_0x31582f=_0x447005['username']);!_0x402c67&&auth['currentUser']&&(_0x402c67=auth['currentUser']['displayName']||auth['currentUser']['email']['split']('@')[0x0],_0x31582f=auth[_0x25e4ac(0x19f)]['displayName']||null);if(!_0x402c67){const _0x3ed69d=query(collection(db,'approvedMatches'),where(_0x25e4ac(0x199),'==',_0x1e8e08),limit(0x1)),_0x41c15b=await getDocs(_0x3ed69d);if(!_0x41c15b['empty'])_0x402c67=_0x41c15b[_0x25e4ac(0x159)][0x0]['data']()[_0x25e4ac(0x18f)]||'Unknown\x20Player',_0x31582f=_0x402c67;else{const _0x436a6e=query(collection(db,'approvedMatches'),where(_0x25e4ac(0x1a5),'==',_0x1e8e08),limit(0x1)),_0x27365c=await getDocs(_0x436a6e);!_0x27365c['empty']&&(_0x402c67=_0x27365c[0x0]['data']()['loserUsername']||_0x25e4ac(0x1ab),_0x31582f=_0x402c67);}}}catch(_0x30d0ca){console[_0x25e4ac(0x1b0)]('Error\x20resolving\x20username:',_0x30d0ca);}!_0x402c67&&(console[_0x25e4ac(0x186)](_0x25e4ac(0x15e),_0x1e8e08),_0x402c67=_0x25e4ac(0x18b),_0x31582f='Unknown\x20Player');const _0x406df7=this[_0x25e4ac(0x167)](_0x4c34f0),_0x2689eb=this['getRankName'](_0x187b05);if(_0x406df7!==_0x2689eb){const _0xd4ae45=_0x187b05>_0x4c34f0,_0xfb6f96=_0xd4ae45?'promotion':'demotion',_0x15a1f7=_0x2689eb;console['log'](_0x25e4ac(0x188)+_0xfb6f96+'\x20for\x20'+_0x402c67+':\x20'+_0x4c34f0+'\x20('+_0x406df7+_0x25e4ac(0x177)+_0x187b05+'\x20('+_0x2689eb+')');try{const _0x134a4d={'player':_0x402c67,'playerUsername':_0x402c67,'username':_0x402c67,'displayName':_0x31582f,'userId':_0x1e8e08,'type':_0xfb6f96,'rankAchieved':_0x15a1f7,'timestamp':serverTimestamp(),'previousElo':_0x4c34f0,'newElo':_0x187b05,'change':_0x187b05-_0x4c34f0,'previousRank':_0x406df7,'newRank':_0x2689eb,'source':_0x4cb915};if(_0x4cb915==='match'&&_0x442d6d)_0x134a4d[_0x25e4ac(0x16d)]=_0x442d6d;else _0x4cb915==='admin'&&_0x2741e2?(_0x134a4d['modifiedBy']=_0x2741e2,_0x134a4d['isAutomatic']=![]):_0x134a4d[_0x25e4ac(0x196)]=!![];const _0xec9c95=writeBatch(db),_0x16bca7=doc(collection(db,'eloHistory')),_0xaf837a=doc(collection(db,'promotionHistory'));return _0xec9c95['set'](_0x16bca7,_0x134a4d),_0xec9c95['set'](_0xaf837a,_0x134a4d),await _0xec9c95[_0x25e4ac(0x17e)](),await this[_0x25e4ac(0x16b)](_0x1e8e08,_0x402c67,_0x4c34f0,_0x187b05,_0x406df7,_0x2689eb,_0xfb6f96,{'displayName':_0x31582f,'source':_0x4cb915,'matchId':_0x442d6d,'ladder':_0x447005[_0x25e4ac(0x1a8)]||'D1'}),console[_0x25e4ac(0x178)]('Successfully\x20recorded\x20'+_0xfb6f96+'\x20for\x20'+_0x402c67+'\x20to\x20'+_0x15a1f7),_0x15a1f7;}catch(_0x3e515b){console['error']('Error\x20writing\x20promotion\x20records:',_0x3e515b);try{return await addDoc(collection(db,'eloHistory'),{'player':_0x402c67,'playerUsername':_0x402c67,'username':_0x402c67,'displayName':_0x31582f,'userId':_0x1e8e08,'type':_0xfb6f96,'rankAchieved':_0x15a1f7,'timestamp':serverTimestamp(),'previousElo':_0x4c34f0,'newElo':_0x187b05,'change':_0x187b05-_0x4c34f0,'previousRank':_0x406df7,'source':_0x4cb915,'isAutomatic':_0x4cb915!==_0x25e4ac(0x179)}),await this[_0x25e4ac(0x16b)](_0x1e8e08,_0x402c67,_0x4c34f0,_0x187b05,_0x406df7,_0x2689eb,_0xfb6f96,{'displayName':_0x31582f,'source':_0x4cb915,'matchId':_0x442d6d,'ladder':_0x447005[_0x25e4ac(0x1a8)]||'D1'}),_0x15a1f7;}catch(_0x2bd6b9){return console['error']('Fallback\x20write\x20failed:',_0x2bd6b9),null;}}}return null;}catch(_0x540f5c){return console['error'](_0x25e4ac(0x170),_0x540f5c),null;}}['getRankName'](_0x3ec44e){const _0x1833cc=a42_0x3dc50f;for(let _0x36e43a=this['RANKS'][_0x1833cc(0x1a2)]-0x1;_0x36e43a>=0x0;_0x36e43a--){if(_0x3ec44e>=this['RANKS'][_0x36e43a]['threshold'])return this['RANKS'][_0x36e43a][_0x1833cc(0x194)];}return _0x1833cc(0x16a);}[a42_0x3dc50f(0x15b)](){const _0x202636=a42_0x3dc50f;this[_0x202636(0x184)]&&clearInterval(this['pollingInterval']);}['isNewRankChange'](_0x4c03a2){const _0x111e4f=a42_0x3dc50f;if(_0x4c03a2['timestamp']){const _0x4b7364=_0x4c03a2['timestamp']['seconds']*0x3e8,_0x9f4c09=Date['now'](),_0x41e2f4=(_0x9f4c09-_0x4b7364)/(0x3e8*0x3c*0x3c);if(_0x41e2f4>0x18)return![];}if(_0x4c03a2['previousRank']&&_0x4c03a2['newRank']&&_0x4c03a2['previousRank']!==_0x4c03a2[_0x111e4f(0x16e)])return!![];return![];}async[a42_0x3dc50f(0x16b)](_0x1fe5ec,_0x331204,_0x585bd6,_0x55b267,_0x50c66b,_0x26468b,_0xa2f543,_0x8a7571={}){const _0x1bddff=a42_0x3dc50f;try{console[_0x1bddff(0x178)]('STARTING\x20notification\x20for\x20'+_0x331204+_0x1bddff(0x15d)+_0xa2f543);const _0x5b8b88={'userId':_0x1fe5ec,'username':_0x331204,'displayName':_0x8a7571['displayName']||_0x331204,'oldElo':parseInt(_0x585bd6),'newElo':parseInt(_0x55b267),'eloDifference':parseInt(_0x55b267)-parseInt(_0x585bd6),'oldRank':_0x50c66b,'newRank':_0x26468b,'type':_0xa2f543,'timestamp':serverTimestamp(),'processed':![],'source':_0x8a7571[_0x1bddff(0x174)]||'automatic','matchId':_0x8a7571[_0x1bddff(0x16d)]||null,'ladder':_0x8a7571['ladder']||'D1','adminUser':_0x8a7571['adminUser']||null};console[_0x1bddff(0x178)](_0x1bddff(0x1ad),_0x5b8b88);const _0x4e1832=await addDoc(collection(db,_0x1bddff(0x175)),_0x5b8b88);return console['log']('Discord\x20notification\x20sent\x20successfully\x20with\x20ID:\x20'+_0x4e1832['id']),!![];}catch(_0xa54adb){return console[_0x1bddff(0x1b0)]('Error\x20sending\x20Discord\x20notification:',_0xa54adb),![];}}}export const promotionManager=new PromotionManager();document[a42_0x3dc50f(0x1a6)]('DOMContentLoaded',()=>{promotionManager['initialize']();});export const initializePromotionTracker=()=>promotionManager['initialize']();export const checkAndRecordPromotion=(_0x430212,_0x28be68,_0x26c787,_0x5e0fb0)=>promotionManager[a42_0x3dc50f(0x1ac)](_0x430212,_0x28be68,_0x26c787,_0x5e0fb0);export const getRankName=_0x1373db=>promotionManager[a42_0x3dc50f(0x167)](_0x1373db);function a42_0x160b(){const _0x47451f=['docs','fetchInterval','cleanup','dismissing','\x27s\x20','Could\x20not\x20resolve\x20username\x20for\x20userId:','innerHTML','button','exception','userDismissed','resolvedName','setItem','Promotion\x20banner\x20container\x20not\x20found','approvedMatches','getRankName','slice','usernameCache','Unranked','sendPromotionNotification','type','matchId','newRank','info','Error\x20in\x20promotion/demotion\x20recording:','resolveUserId','promotion_','promotions_checked_','source','promotionNotifications','\x20(source:\x20',')\x20→\x20','log','admin','display','remove','push','initialize','commit','firstChild','toString','offsetWidth','classList','\x20<span\x20class=\x22rank-text\x22>','pollingInterval','rankAchieved','warn','table','Recording\x20','shouldShowPromotion','\x20was\x20dismissed\x20by\x20user\x20within\x20last\x20','A\x20player','add','now','body','winnerUsername','title','fetchRecentPromotions','rank-change-modal\x20','promotion','name','createElement','isAutomatic','timestamp','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rank-change-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2\x20class=\x22rank-change-title\x22>','winnerId','new-rank-change','none','bannerContainer','Bronze','data','currentUser','includes','loserUsername','length','console','appendChild','loserId','addEventListener','style','ladder','children','RANKS','Unknown\x20Player','checkAndRecordPromotion','Creating\x20Discord\x20notification:','userId','removeChild','error','className','stringify','processRankChanges'];a42_0x160b=function(){return _0x47451f;};return a42_0x160b();}
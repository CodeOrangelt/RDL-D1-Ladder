const a53_0x236c78=(function(){let _0x2da85e=!![];return function(_0x4a122c,_0x2a196f){const _0x4835f4=_0x2da85e?function(){const _0x23b435=a53_0x51d0;if(_0x2a196f){const _0x365abe=_0x2a196f[_0x23b435(0x10d)](_0x4a122c,arguments);return _0x2a196f=null,_0x365abe;}}:function(){};return _0x2da85e=![],_0x4835f4;};}()),a53_0xcf155e=a53_0x236c78(this,function(){const _0x3158f7=a53_0x51d0,_0x1d656a=function(){const _0x59142f=a53_0x51d0;let _0xc854f3;try{_0xc854f3=Function('return\x20(function()\x20'+_0x59142f(0x111)+');')();}catch(_0x30a1b9){_0xc854f3=window;}return _0xc854f3;},_0x220768=_0x1d656a(),_0x764fb2=_0x220768['console']=_0x220768['console']||{},_0x36a89d=[_0x3158f7(0x112),_0x3158f7(0x109),'info','error','exception','table','trace'];for(let _0x16e283=0x0;_0x16e283<_0x36a89d[_0x3158f7(0xff)];_0x16e283++){const _0x177e92=a53_0x236c78['constructor']['prototype'][_0x3158f7(0xfa)](a53_0x236c78),_0x76cb4=_0x36a89d[_0x16e283],_0x4688f5=_0x764fb2[_0x76cb4]||_0x177e92;_0x177e92[_0x3158f7(0x100)]=a53_0x236c78[_0x3158f7(0xfa)](a53_0x236c78),_0x177e92[_0x3158f7(0xf9)]=_0x4688f5['toString']['bind'](_0x4688f5),_0x764fb2[_0x76cb4]=_0x177e92;}});a53_0xcf155e();import{db}from'../firebase-config.js';import{collection,doc,getDoc,getDocs,query,limit,startAfter,where,onSnapshot}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const cache={'userProfiles':new Map(),'ladderPlayers':new Map(),'matchResults':new Map(),'eloHistory':new Map()},CACHE_EXPIRY={'userProfiles':0x5*0x3c*0x3e8,'ladderPlayers':0x2*0x3c*0x3e8,'matchResults':0x1*0x3c*0x3e8,'eloHistory':0x3*0x3c*0x3e8};export const userProfilesRef=collection(db,'userProfiles');export async function fetchPaginatedData(_0x40d0bb,_0x53b539=0xa,_0x47da9c=null){const _0x53dc0c=a53_0x51d0;let _0x517697=query(_0x40d0bb,limit(_0x53b539));_0x47da9c&&(_0x517697=query(_0x517697,startAfter(_0x47da9c)));const _0x8446ba=await getDocs(_0x517697),_0x1a5980=_0x8446ba['docs'][_0x8446ba['docs'][_0x53dc0c(0xff)]-0x1];return{'data':_0x8446ba['docs'][_0x53dc0c(0x108)](_0x2fe0a7=>({'id':_0x2fe0a7['id'],..._0x2fe0a7['data']()})),'lastVisible':_0x1a5980,'hasMore':_0x8446ba['docs']['length']===_0x53b539};}export async function getUserProfile(_0x2fc19c){const _0x55f272=a53_0x51d0,_0x35ef65=cache[_0x55f272(0x10c)][_0x55f272(0x10a)](_0x2fc19c);if(_0x35ef65&&Date[_0x55f272(0x106)]()-_0x35ef65['timestamp']<CACHE_EXPIRY['userProfiles'])return _0x35ef65[_0x55f272(0x107)];const _0x32c0e5=await getDoc(doc(userProfilesRef,_0x2fc19c));if(_0x32c0e5['exists']()){const _0x4c9d2d=_0x32c0e5['data']();return cache[_0x55f272(0x10c)]['set'](_0x2fc19c,{'data':_0x4c9d2d,'timestamp':Date[_0x55f272(0x106)]()}),_0x4c9d2d;}return null;}export async function getLadderData(_0x87da88=0x1){const _0x1b4956=a53_0x51d0,_0x4cff8a='division_'+_0x87da88,_0x7b24f8=cache['ladderPlayers']['get'](_0x4cff8a);if(_0x7b24f8&&Date['now']()-_0x7b24f8[_0x1b4956(0x102)]<CACHE_EXPIRY[_0x1b4956(0x10f)])return _0x7b24f8['data'];const _0x53f295=_0x87da88===0x1?'players':'playersD'+_0x87da88,_0x55a83f=collection(db,_0x53f295),_0x3cb13b=await getDocs(query(_0x55a83f,limit(0x64))),_0x22aea6=_0x3cb13b[_0x1b4956(0xfd)]['map'](_0x11ba0a=>({'id':_0x11ba0a['id'],..._0x11ba0a['data']()}));return cache['ladderPlayers'][_0x1b4956(0x110)](_0x4cff8a,{'data':_0x22aea6,'timestamp':Date['now']()}),_0x22aea6;}export async function getEloHistoryBatch(_0x3e2bf6,_0x2a3558=0x1){const _0x3ff4fd=a53_0x51d0,_0x31221d=_0x2a3558===0x1?'eloHistory':_0x3ff4fd(0xfe)+_0x2a3558,_0x3fb9d1=collection(db,_0x31221d),_0x2c3f3f={},_0x52e69d=[];_0x3e2bf6[_0x3ff4fd(0x113)](_0x27cf4d=>{const _0x40fec3=_0x3ff4fd,_0x1644c2=_0x27cf4d+'_'+_0x2a3558,_0xc576a3=cache['eloHistory']['get'](_0x1644c2);_0xc576a3&&Date['now']()-_0xc576a3[_0x40fec3(0x102)]<CACHE_EXPIRY['eloHistory']?_0x2c3f3f[_0x27cf4d]=_0xc576a3['data']:_0x52e69d['push'](_0x27cf4d);});const _0x232108=0xa;for(let _0x228754=0x0;_0x228754<_0x52e69d['length'];_0x228754+=_0x232108){const _0x5617fd=_0x52e69d[_0x3ff4fd(0x104)](_0x228754,_0x228754+_0x232108);if(_0x5617fd['length']>0x0)try{const _0x3b7115=query(_0x3fb9d1,where('playerId','in',_0x5617fd),limit(0x64)),_0x4bfb78=await getDocs(_0x3b7115);_0x4bfb78['docs'][_0x3ff4fd(0x113)](_0x464765=>{const _0x457a84=_0x3ff4fd,_0x30810e=_0x464765['data'](),_0x1c36df=_0x30810e[_0x457a84(0x101)];if(!_0x2c3f3f[_0x1c36df])_0x2c3f3f[_0x1c36df]=[];_0x2c3f3f[_0x1c36df]['push'](_0x30810e);const _0x4dc630=_0x1c36df+'_'+_0x2a3558;cache[_0x457a84(0x10e)]['set'](_0x4dc630,{'data':_0x2c3f3f[_0x1c36df],'timestamp':Date['now']()});});}catch(_0x4b82fd){console['error']('Error\x20fetching\x20batch\x20ELO\x20history:',_0x4b82fd);}}return _0x2c3f3f;}function a53_0x51d0(_0x302700,_0x39ad5a){const _0xcf155e=a53_0x55a8();return a53_0x51d0=function(_0x236c78,_0x31f5f3){_0x236c78=_0x236c78-0xf9;let _0x55a8ab=_0xcf155e[_0x236c78];return _0x55a8ab;},a53_0x51d0(_0x302700,_0x39ad5a);}let usernameCache=new Map(),usernameCacheTimestamp=Date['now']();function a53_0x55a8(){const _0xeb6a91=['toString','bind','nonParticipants','docChanges','docs','eloHistoryD','length','__proto__','playerId','timestamp','doc','slice','includes','now','data','map','warn','get','username','userProfiles','apply','eloHistory','ladderPlayers','set','{}.constructor(\x22return\x20this\x22)(\x20)','log','forEach'];a53_0x55a8=function(){return _0xeb6a91;};return a53_0x55a8();}export function setupEfficientListener(_0x444c25,_0x44adb7=[],_0x2fccea){const _0x58e839=collection(db,_0x444c25),_0xf6aa11=query(_0x58e839,..._0x44adb7),_0x5f4bf5=onSnapshot(_0xf6aa11,_0x3b0727=>{const _0x56e330=a53_0x51d0,_0x5a0c3b=_0x3b0727[_0x56e330(0xfc)]()['map'](_0x1f44d1=>({'type':_0x1f44d1['type'],'id':_0x1f44d1[_0x56e330(0x103)]['id'],'data':_0x1f44d1['doc'][_0x56e330(0x107)]()}));_0x5a0c3b['length']>0x0&&_0x2fccea(_0x5a0c3b,_0x3b0727['docs']);});return _0x5f4bf5;}export async function bulkResolveUsernames(_0x2a0a31){const _0xe8feb2=a53_0x51d0,_0x1e4891=new Map();if(!_0x2a0a31||_0x2a0a31['length']===0x0)return _0x1e4891;const _0xc25c34=['players','playersD2','playersD3',_0xe8feb2(0xfb)];for(const _0xf8b62a of _0xc25c34){const _0x8438b1=collection(db,_0xf8b62a),_0x226734=await getDocs(_0x8438b1);_0x226734['forEach'](_0x79d4e4=>{const _0x19fcbc=_0xe8feb2,_0x112bfc=_0x79d4e4[_0x19fcbc(0x107)]();_0x112bfc['username']&&_0x2a0a31[_0x19fcbc(0x105)](_0x79d4e4['id'])&&_0x1e4891[_0x19fcbc(0x110)](_0x79d4e4['id'],_0x112bfc[_0x19fcbc(0x10b)]);});}return _0x1e4891;}
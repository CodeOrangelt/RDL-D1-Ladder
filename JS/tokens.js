const a52_0x4285fb=(function(){let _0x5f2524=!![];return function(_0x34d260,_0x416988){const _0x400baf=_0x5f2524?function(){const _0x3db8aa=a52_0x39aa;if(_0x416988){const _0x383ac5=_0x416988[_0x3db8aa(0x1d1)](_0x34d260,arguments);return _0x416988=null,_0x383ac5;}}:function(){};return _0x5f2524=![],_0x400baf;};}()),a52_0x2a549b=a52_0x4285fb(this,function(){const _0x54234e=a52_0x39aa;let _0x4587d6;try{const _0x1fb4de=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x4587d6=_0x1fb4de();}catch(_0x585819){_0x4587d6=window;}const _0x4a136b=_0x4587d6[_0x54234e(0x1d2)]=_0x4587d6['console']||{},_0x339e2c=[_0x54234e(0x1d8),'warn','info','error','exception','table','trace'];for(let _0x58d463=0x0;_0x58d463<_0x339e2c['length'];_0x58d463++){const _0x3f3e38=a52_0x4285fb['constructor'][_0x54234e(0x1cb)]['bind'](a52_0x4285fb),_0x4446a7=_0x339e2c[_0x58d463],_0x409453=_0x4a136b[_0x4446a7]||_0x3f3e38;_0x3f3e38[_0x54234e(0x1dd)]=a52_0x4285fb['bind'](a52_0x4285fb),_0x3f3e38['toString']=_0x409453['toString']['bind'](_0x409453),_0x4a136b[_0x4446a7]=_0x3f3e38;}});a52_0x2a549b();import{doc,getDoc,getDocs,collection}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const tokenCache=new Map(),CACHE_DURATION=0x5*0x3c*0x3e8;export async function getUserTokens(_0x400e7a){const _0x21ce04=a52_0x39aa,_0x552b9b=_0x21ce04(0x1dc)+_0x400e7a,_0x171df7=tokenCache['get'](_0x552b9b);if(_0x171df7&&Date['now']()-_0x171df7['timestamp']<CACHE_DURATION)return _0x171df7['tokens'];try{const _0x262661=doc(db,'userTokens',_0x400e7a),_0x32f6ab=await getDoc(_0x262661);let _0x46d8ed=[];return _0x32f6ab['exists']()&&(_0x46d8ed=_0x32f6ab['data']()[_0x21ce04(0x1d9)]||[]),tokenCache['set'](_0x552b9b,{'tokens':_0x46d8ed,'timestamp':Date['now']()}),_0x46d8ed;}catch(_0x1d31c6){return console['error']('Error\x20fetching\x20user\x20tokens:',_0x1d31c6),[];}}export async function getBulkUserTokens(_0x151caa){const _0x5e5e79=a52_0x39aa,_0x193330=new Map(),_0x7979d8=[];_0x151caa['forEach'](_0x39954a=>{const _0x17ddee=a52_0x39aa,_0x27ed98='tokens_'+_0x39954a,_0x271226=tokenCache[_0x17ddee(0x1da)](_0x27ed98);_0x271226&&Date['now']()-_0x271226[_0x17ddee(0x1d4)]<CACHE_DURATION?_0x193330['set'](_0x39954a,_0x271226[_0x17ddee(0x1d9)]):_0x7979d8['push'](_0x39954a);});if(_0x7979d8['length']>0x0)try{const _0x50d644=_0x7979d8['map'](async _0x459523=>{const _0x3f763c=doc(db,'userTokens',_0x459523),_0x4fac93=await getDoc(_0x3f763c);let _0x1465e6=[];_0x4fac93['exists']()&&(_0x1465e6=_0x4fac93['data']()['tokens']||[]);const _0x3b4248='tokens_'+_0x459523;return tokenCache['set'](_0x3b4248,{'tokens':_0x1465e6,'timestamp':Date['now']()}),[_0x459523,_0x1465e6];}),_0x5dc16b=await Promise['all'](_0x50d644);_0x5dc16b['forEach'](([_0x22988e,_0x23dba4])=>{const _0x349907=a52_0x39aa;_0x193330[_0x349907(0x1ca)](_0x22988e,_0x23dba4);});}catch(_0x3c2bbb){console[_0x5e5e79(0x1d3)](_0x5e5e79(0x1ce),_0x3c2bbb);}return _0x193330;}export async function getTokensByUsernames(_0x30234a){const _0x5c7f0a=a52_0x39aa,_0x1a5670=new Map();try{const _0x3a301d=collection(db,'userProfiles'),_0x3995ca=await getDocs(_0x3a301d),_0xfb6e4=new Map();_0x3995ca['forEach'](_0x1daaa0=>{const _0x459d43=a52_0x39aa,_0x2c7dc4=_0x1daaa0[_0x459d43(0x1c7)]();_0x2c7dc4['username']&&_0x30234a[_0x459d43(0x1cd)](_0x2c7dc4[_0x459d43(0x1d6)])&&_0xfb6e4['set'](_0x2c7dc4['username'],_0x1daaa0['id']);});const _0x435199=Array[_0x5c7f0a(0x1cf)](_0xfb6e4['values']());if(_0x435199[_0x5c7f0a(0x1d5)]>0x0){const _0x1c9727=await getBulkUserTokens(_0x435199);_0xfb6e4[_0x5c7f0a(0x1cc)]((_0x30881e,_0x33b385)=>{const _0x4c2fc6=_0x5c7f0a,_0x111dcb=_0x1c9727[_0x4c2fc6(0x1da)](_0x30881e)||[];_0x1a5670['set'](_0x33b385,_0x111dcb);});}}catch(_0x2fdef6){console['error']('Error\x20fetching\x20tokens\x20by\x20usernames:',_0x2fdef6);}return _0x1a5670;}export function clearTokenCache(_0x3d925c=null){const _0x5987a1=a52_0x39aa;if(_0x3d925c){const _0x7dfdee='tokens_'+_0x3d925c;tokenCache[_0x5987a1(0x1c9)](_0x7dfdee),console['log']('ðŸ—‘ï¸\x20Cleared\x20token\x20cache\x20for\x20user:\x20'+_0x3d925c);}else tokenCache['clear'](),console[_0x5987a1(0x1d8)](_0x5987a1(0x1db));}function a52_0x39aa(_0x1c0b0a,_0x24d213){const _0x2a549b=a52_0x1d04();return a52_0x39aa=function(_0x4285fb,_0x25ada8){_0x4285fb=_0x4285fb-0x1c7;let _0x1d0430=_0x2a549b[_0x4285fb];return _0x1d0430;},a52_0x39aa(_0x1c0b0a,_0x24d213);}export async function forceRefreshUserTokens(_0x8b773){return clearTokenCache(_0x8b773),await getUserTokens(_0x8b773);}function a52_0x1d04(){const _0x17fd39=['data','string','delete','set','prototype','forEach','includes','Error\x20fetching\x20bulk\x20user\x20tokens:','from','getTime','apply','console','error','timestamp','length','username','purchasedAt','log','tokens','get','ðŸ—‘ï¸\x20Cleared\x20all\x20token\x20cache','tokens_','__proto__'];a52_0x1d04=function(){return _0x17fd39;};return a52_0x1d04();}export function getPrimaryDisplayToken(_0x3ea641){if(!_0x3ea641||_0x3ea641['length']===0x0)return null;const _0x3956a8=_0x3ea641['find'](_0xa8b4ee=>_0xa8b4ee['equipped']===!![]);if(_0x3956a8)return _0x3956a8;const _0x379b8e=[..._0x3ea641]['sort']((_0x326d07,_0x223dd1)=>{const _0x3ea06a=a52_0x39aa;let _0x3051bb,_0x27aa7b;if(_0x326d07['purchasedAt']){if(_0x326d07['purchasedAt']['seconds'])_0x3051bb=_0x326d07[_0x3ea06a(0x1d7)]['seconds'];else{if(_0x326d07['purchasedAt']instanceof Date)_0x3051bb=_0x326d07['purchasedAt'][_0x3ea06a(0x1d0)]()/0x3e8;else typeof _0x326d07[_0x3ea06a(0x1d7)]===_0x3ea06a(0x1c8)?_0x3051bb=new Date(_0x326d07['purchasedAt'])['getTime']()/0x3e8:_0x3051bb=0x0;}}else _0x3051bb=0x0;if(_0x223dd1['purchasedAt']){if(_0x223dd1[_0x3ea06a(0x1d7)]['seconds'])_0x27aa7b=_0x223dd1['purchasedAt']['seconds'];else{if(_0x223dd1[_0x3ea06a(0x1d7)]instanceof Date)_0x27aa7b=_0x223dd1[_0x3ea06a(0x1d7)]['getTime']()/0x3e8;else typeof _0x223dd1['purchasedAt']===_0x3ea06a(0x1c8)?_0x27aa7b=new Date(_0x223dd1['purchasedAt'])[_0x3ea06a(0x1d0)]()/0x3e8:_0x27aa7b=0x0;}}else _0x27aa7b=0x0;return _0x27aa7b-_0x3051bb;});return _0x379b8e[0x0];}
const a29_0x80c8ca=(function(){let _0x393cac=!![];return function(_0x1dc02e,_0x4b5133){const _0x479cf8=_0x393cac?function(){if(_0x4b5133){const _0x54a20e=_0x4b5133['apply'](_0x1dc02e,arguments);return _0x4b5133=null,_0x54a20e;}}:function(){};return _0x393cac=![],_0x479cf8;};}()),a29_0x32830d=a29_0x80c8ca(this,function(){const _0x232e37=a29_0x459c,_0x48c051=function(){let _0x2bc6f6;try{_0x2bc6f6=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x310f20){_0x2bc6f6=window;}return _0x2bc6f6;},_0x3126a3=_0x48c051(),_0x59cd95=_0x3126a3['console']=_0x3126a3['console']||{},_0x1e30d5=['log',_0x232e37(0x176),_0x232e37(0x17a),'error','exception','table','trace'];for(let _0x5b3c5a=0x0;_0x5b3c5a<_0x1e30d5['length'];_0x5b3c5a++){const _0x24cf3d=a29_0x80c8ca['constructor']['prototype']['bind'](a29_0x80c8ca),_0xcb6f34=_0x1e30d5[_0x5b3c5a],_0x46fab2=_0x59cd95[_0xcb6f34]||_0x24cf3d;_0x24cf3d['__proto__']=a29_0x80c8ca['bind'](a29_0x80c8ca),_0x24cf3d['toString']=_0x46fab2['toString'][_0x232e37(0x168)](_0x46fab2),_0x59cd95[_0xcb6f34]=_0x24cf3d;}});a29_0x32830d();import{addDoc,updateDoc,serverTimestamp,collection,doc,getDoc,getDocs,query,where,setDoc,deleteDoc,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a29_0x459c(_0x58b6a6,_0x934ec6){const _0x32830d=a29_0x756e();return a29_0x459c=function(_0x80c8ca,_0x5754d9){_0x80c8ca=_0x80c8ca-0x163;let _0x756e7d=_0x32830d[_0x80c8ca];return _0x756e7d;},a29_0x459c(_0x58b6a6,_0x934ec6);}import{db,auth}from'./firebase-config.js';function a29_0x756e(){const _0x44bf7c=['D3\x20ELO\x20ratings\x20updated\x20successfully','D3\x20Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions','You\x20must\x20be\x20logged\x20in\x20to\x20approve\x20D3\x20matches','createdAt','username','bind','round','update','docs','empty','eloRating','win','loss','log','No\x20user\x20logged\x20in','data','Only\x20the\x20winner\x20can\x20approve\x20D3\x20matches','D3\x20Report\x20not\x20found\x20with\x20ID:','pow','warn','exists','position','D3\x20Match\x20moved\x20to\x20approved\x20collection','info'];a29_0x756e=function(){return _0x44bf7c;};return a29_0x756e();}import{recordEloChangeD3}from'./elo-history-d3.js';export function calculateEloD3(_0x30b0a3,_0x78999,_0x291f88=0x20){const _0x48dca9=a29_0x459c,_0x4ad08a=0x1/(0x1+Math[_0x48dca9(0x175)](0xa,(_0x78999-_0x30b0a3)/0x190)),_0x2205b7=0x1/(0x1+Math[_0x48dca9(0x175)](0xa,(_0x30b0a3-_0x78999)/0x190)),_0x2a8fb2=_0x30b0a3+_0x291f88*(0x1-_0x4ad08a),_0x48cb3d=_0x78999+_0x291f88*(0x0-_0x2205b7);return{'newWinnerRating':Math['round'](_0x2a8fb2),'newLoserRating':Math[_0x48dca9(0x169)](_0x48cb3d)};}export async function updateEloRatingsD3(_0x2b483e,_0x14b04a,_0x59e28a){const _0x229127=a29_0x459c;try{const _0x2f5a48=writeBatch(db),_0x437781=doc(db,'playersD3',_0x2b483e),_0x1a7a60=doc(db,'playersD3',_0x14b04a),[_0x24ac22,_0x54dbfd]=await Promise['all']([getDoc(_0x437781),getDoc(_0x1a7a60)]);if(!_0x24ac22['exists']()||!_0x54dbfd[_0x229127(0x177)]())throw new Error('One\x20or\x20both\x20D3\x20players\x20not\x20found');const _0x1e4149=_0x24ac22['data'](),_0x25dcff=_0x54dbfd['data'](),_0x583f2a=_0x1e4149[_0x229127(0x178)]||Number['MAX_SAFE_INTEGER'],_0x527197=_0x25dcff['position']||Number['MAX_SAFE_INTEGER'],{newWinnerRating:_0x2af607,newLoserRating:_0x2d575e}=calculateEloD3(_0x1e4149['eloRating']||0x4b0,_0x25dcff[_0x229127(0x16d)]||0x4b0);let _0x10d524=_0x583f2a,_0x50d746=_0x527197;if(_0x583f2a>_0x527197){console['log']('D3\x20Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked'),_0x10d524=_0x527197,_0x50d746=_0x527197+0x1;const _0x3a6a60=query(collection(db,'playersD3'),where(_0x229127(0x178),'>',_0x527197),where('position','<',_0x583f2a)),_0x2301b8=await getDocs(_0x3a6a60);for(const _0x477203 of _0x2301b8[_0x229127(0x16b)]){_0x477203['id']!==_0x2b483e&&_0x477203['id']!==_0x14b04a&&_0x2f5a48['update'](doc(db,'playersD3',_0x477203['id']),{'position':_0x477203['data']()['position']+0x1});}}else console['log'](_0x229127(0x164));return _0x2f5a48['update'](_0x437781,{'eloRating':_0x2af607,'lastMatchDate':serverTimestamp(),'position':_0x10d524,'lastMatchId':_0x59e28a}),_0x2f5a48[_0x229127(0x16a)](_0x1a7a60,{'eloRating':_0x2d575e,'lastMatchDate':serverTimestamp(),'position':_0x50d746,'lastMatchId':_0x59e28a}),await _0x2f5a48['commit'](),console[_0x229127(0x170)](_0x229127(0x163)),await Promise['all']([recordEloChangeD3({'playerId':_0x2b483e,'previousElo':_0x1e4149['eloRating']||0x4b0,'newElo':_0x2af607,'opponentId':_0x14b04a,'matchResult':_0x229127(0x16e),'previousPosition':_0x583f2a,'newPosition':_0x10d524,'isPromotion':_0x10d524<_0x583f2a,'matchId':_0x59e28a,'timestamp':serverTimestamp()}),recordEloChangeD3({'playerId':_0x14b04a,'previousElo':_0x25dcff['eloRating']||0x4b0,'newElo':_0x2d575e,'opponentId':_0x2b483e,'matchResult':_0x229127(0x16f),'previousPosition':_0x527197,'newPosition':_0x50d746,'isDemotion':_0x50d746>_0x527197,'matchId':_0x59e28a,'timestamp':serverTimestamp()})]),!![];}catch(_0x3b44df){console['error']('Error\x20in\x20updateEloRatingsD3:',_0x3b44df);throw _0x3b44df;}}export async function approveReportD3(_0x78f0d3,_0x735ff6,_0x44e40c,_0x3c6154){const _0x2f265d=a29_0x459c;try{console[_0x2f265d(0x170)]('Starting\x20approveReportD3\x20function\x20with:',{'reportId':_0x78f0d3,'winnerScore':_0x735ff6,'winnerSuicides':_0x44e40c,'winnerComment':_0x3c6154});const _0x3b3bb2=auth['currentUser'];if(!_0x3b3bb2){console[_0x2f265d(0x170)](_0x2f265d(0x171));throw new Error(_0x2f265d(0x165));}console['log']('Current\x20user:',_0x3b3bb2['email']);const _0x10d879=await getDoc(doc(db,'playersD3',_0x3b3bb2['uid'])),_0x2cc081=_0x10d879['exists']()?_0x10d879[_0x2f265d(0x172)]()['username']:null;console['log']('Current\x20username:',_0x2cc081);const _0x11157f=doc(db,'pendingMatchesD3',_0x78f0d3),_0x14f405=await getDoc(_0x11157f);if(!_0x14f405[_0x2f265d(0x177)]()){console['log'](_0x2f265d(0x174),_0x78f0d3);throw new Error('D3\x20match\x20report\x20not\x20found');}const _0x11fc56=_0x14f405['data']();console['log']('D3\x20Report\x20data:',_0x11fc56);if(_0x2cc081!==_0x11fc56['winnerUsername'])throw new Error(_0x2f265d(0x173));const _0x56687d={..._0x11fc56,'winnerScore':_0x735ff6,'winnerSuicides':_0x44e40c,'winnerComment':_0x3c6154,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':_0x2cc081,'createdAt':_0x11fc56[_0x2f265d(0x166)]||serverTimestamp(),'winnerUsername':_0x11fc56['winnerUsername'],'loserUsername':_0x11fc56['loserUsername']};await setDoc(doc(db,'approvedMatchesD3',_0x78f0d3),_0x56687d),await deleteDoc(_0x11157f),console['log'](_0x2f265d(0x179));const [_0x365dcc,_0x3a8a27]=await Promise['all']([getDocs(query(collection(db,'playersD3'),where(_0x2f265d(0x167),'==',_0x11fc56['winnerUsername']))),getDocs(query(collection(db,'playersD3'),where('username','==',_0x11fc56['loserUsername'])))]);if(_0x365dcc['empty']||_0x3a8a27[_0x2f265d(0x16c)])throw new Error('Could\x20not\x20find\x20D3\x20player\x20documents');const _0x264535=_0x365dcc[_0x2f265d(0x16b)][0x0]['id'],_0x1f1c47=_0x3a8a27['docs'][0x0]['id'];return await updateEloRatingsD3(_0x264535,_0x1f1c47,_0x78f0d3),console['log']('D3\x20Match\x20successfully\x20approved\x20and\x20ELO\x20updated'),!![];}catch(_0xd4ec76){console['error']('Error\x20in\x20approveReportD3:',_0xd4ec76);throw _0xd4ec76;}}
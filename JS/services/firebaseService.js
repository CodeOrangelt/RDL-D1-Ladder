const a53_0x348293=a53_0x3706,a53_0x59e8df=(function(){let _0x115a5d=!![];return function(_0x35d482,_0x2dde3c){const _0x551756=_0x115a5d?function(){if(_0x2dde3c){const _0x2d2e53=_0x2dde3c['apply'](_0x35d482,arguments);return _0x2dde3c=null,_0x2d2e53;}}:function(){};return _0x115a5d=![],_0x551756;};}()),a53_0x117a30=a53_0x59e8df(this,function(){const _0x576443=a53_0x3706,_0x4b11d6=function(){let _0x34a2ab;try{_0x34a2ab=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x2283c5){_0x34a2ab=window;}return _0x34a2ab;},_0x527c9b=_0x4b11d6(),_0x284cbd=_0x527c9b['console']=_0x527c9b['console']||{},_0x3e7daa=['log','warn',_0x576443(0x103),'error','exception',_0x576443(0x10a),_0x576443(0x102)];for(let _0x3a0fbb=0x0;_0x3a0fbb<_0x3e7daa[_0x576443(0x10c)];_0x3a0fbb++){const _0x1c9c08=a53_0x59e8df['constructor']['prototype']['bind'](a53_0x59e8df),_0x26a3a5=_0x3e7daa[_0x3a0fbb],_0x9b187b=_0x284cbd[_0x26a3a5]||_0x1c9c08;_0x1c9c08[_0x576443(0x10d)]=a53_0x59e8df['bind'](a53_0x59e8df),_0x1c9c08['toString']=_0x9b187b['toString']['bind'](_0x9b187b),_0x284cbd[_0x26a3a5]=_0x1c9c08;}});a53_0x117a30();import{db}from'../firebase-config.js';import{collection,doc,getDoc,getDocs,query,limit,startAfter,where,onSnapshot}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const cache={'userProfiles':new Map(),'ladderPlayers':new Map(),'matchResults':new Map(),'eloHistory':new Map()},CACHE_EXPIRY={'userProfiles':0x5*0x3c*0x3e8,'ladderPlayers':0x2*0x3c*0x3e8,'matchResults':0x1*0x3c*0x3e8,'eloHistory':0x3*0x3c*0x3e8};export const userProfilesRef=collection(db,a53_0x348293(0x107));function a53_0x3a89(){const _0xbc4f09=['push','trace','info','doc','now','exists','userProfiles','playersD2','forEach','table','docs','length','__proto__','eloHistory','data','Error\x20fetching\x20batch\x20ELO\x20history:','ladderPlayers','get'];a53_0x3a89=function(){return _0xbc4f09;};return a53_0x3a89();}export async function fetchPaginatedData(_0x1abcab,_0x3b8014=0xa,_0x154175=null){const _0xe7c929=a53_0x348293;let _0x59c3c8=query(_0x1abcab,limit(_0x3b8014));_0x154175&&(_0x59c3c8=query(_0x59c3c8,startAfter(_0x154175)));const _0x47e713=await getDocs(_0x59c3c8),_0x2cc306=_0x47e713['docs'][_0x47e713['docs']['length']-0x1];return{'data':_0x47e713['docs']['map'](_0x26fbac=>({'id':_0x26fbac['id'],..._0x26fbac['data']()})),'lastVisible':_0x2cc306,'hasMore':_0x47e713['docs'][_0xe7c929(0x10c)]===_0x3b8014};}export async function getUserProfile(_0x2fd653){const _0x1b56fb=a53_0x348293,_0x13bad7=cache[_0x1b56fb(0x107)][_0x1b56fb(0x112)](_0x2fd653);if(_0x13bad7&&Date['now']()-_0x13bad7['timestamp']<CACHE_EXPIRY['userProfiles'])return _0x13bad7[_0x1b56fb(0x10f)];const _0x31270e=await getDoc(doc(userProfilesRef,_0x2fd653));if(_0x31270e[_0x1b56fb(0x106)]()){const _0x2f4ce5=_0x31270e['data']();return cache['userProfiles']['set'](_0x2fd653,{'data':_0x2f4ce5,'timestamp':Date['now']()}),_0x2f4ce5;}return null;}export async function getLadderData(_0x38c664=0x1){const _0x2725c5=a53_0x348293,_0x3d2399='division_'+_0x38c664,_0xd84b84=cache['ladderPlayers']['get'](_0x3d2399);if(_0xd84b84&&Date[_0x2725c5(0x105)]()-_0xd84b84['timestamp']<CACHE_EXPIRY[_0x2725c5(0x111)])return _0xd84b84['data'];const _0x55649c=_0x38c664===0x1?'players':'playersD'+_0x38c664,_0x4dcf3d=collection(db,_0x55649c),_0x4c34c0=await getDocs(query(_0x4dcf3d,limit(0x64))),_0x47c77b=_0x4c34c0[_0x2725c5(0x10b)]['map'](_0x36b2c3=>({'id':_0x36b2c3['id'],..._0x36b2c3['data']()}));return cache['ladderPlayers']['set'](_0x3d2399,{'data':_0x47c77b,'timestamp':Date['now']()}),_0x47c77b;}export async function getEloHistoryBatch(_0x3f69da,_0x234e78=0x1){const _0x5844ec=a53_0x348293,_0xbba322=_0x234e78===0x1?'eloHistory':'eloHistoryD'+_0x234e78,_0x4f7250=collection(db,_0xbba322),_0x505d81={},_0x3355b9=[];_0x3f69da[_0x5844ec(0x109)](_0x33eea2=>{const _0x5ed1bc=_0x5844ec,_0x3c58a7=_0x33eea2+'_'+_0x234e78,_0x576fc5=cache[_0x5ed1bc(0x10e)]['get'](_0x3c58a7);_0x576fc5&&Date['now']()-_0x576fc5['timestamp']<CACHE_EXPIRY['eloHistory']?_0x505d81[_0x33eea2]=_0x576fc5[_0x5ed1bc(0x10f)]:_0x3355b9[_0x5ed1bc(0x101)](_0x33eea2);});const _0x16b4b7=0xa;for(let _0x4ea769=0x0;_0x4ea769<_0x3355b9[_0x5844ec(0x10c)];_0x4ea769+=_0x16b4b7){const _0x5cfd8b=_0x3355b9['slice'](_0x4ea769,_0x4ea769+_0x16b4b7);if(_0x5cfd8b[_0x5844ec(0x10c)]>0x0)try{const _0x528d51=query(_0x4f7250,where('playerId','in',_0x5cfd8b),limit(0x64)),_0x7fd76e=await getDocs(_0x528d51);_0x7fd76e[_0x5844ec(0x10b)][_0x5844ec(0x109)](_0xb8aa7c=>{const _0x2b22cc=_0x5844ec,_0x17275d=_0xb8aa7c['data'](),_0x3947dd=_0x17275d['playerId'];if(!_0x505d81[_0x3947dd])_0x505d81[_0x3947dd]=[];_0x505d81[_0x3947dd]['push'](_0x17275d);const _0x41c17d=_0x3947dd+'_'+_0x234e78;cache[_0x2b22cc(0x10e)]['set'](_0x41c17d,{'data':_0x505d81[_0x3947dd],'timestamp':Date['now']()});});}catch(_0x2ed1c4){console['error'](_0x5844ec(0x110),_0x2ed1c4);}}return _0x505d81;}let usernameCache=new Map(),usernameCacheTimestamp=Date['now']();function a53_0x3706(_0x16f481,_0x32001c){const _0x117a30=a53_0x3a89();return a53_0x3706=function(_0x59e8df,_0x44b3b6){_0x59e8df=_0x59e8df-0x101;let _0x3a8906=_0x117a30[_0x59e8df];return _0x3a8906;},a53_0x3706(_0x16f481,_0x32001c);}export function setupEfficientListener(_0x3488ad,_0x18fe2a=[],_0x3825e8){const _0x16b7c3=collection(db,_0x3488ad),_0x73c1bd=query(_0x16b7c3,..._0x18fe2a),_0x25163d=onSnapshot(_0x73c1bd,_0x5a161b=>{const _0xfcb32=a53_0x3706,_0x56f49f=_0x5a161b['docChanges']()['map'](_0x598a9c=>({'type':_0x598a9c['type'],'id':_0x598a9c['doc']['id'],'data':_0x598a9c[_0xfcb32(0x104)]['data']()}));_0x56f49f[_0xfcb32(0x10c)]>0x0&&_0x3825e8(_0x56f49f,_0x5a161b['docs']);});return _0x25163d;}export async function bulkResolveUsernames(_0x4b2c3a){const _0x101c2f=a53_0x348293,_0x2d6393=new Map();if(!_0x4b2c3a||_0x4b2c3a['length']===0x0)return _0x2d6393;const _0x33d8ec=['players',_0x101c2f(0x108),'playersD3','nonParticipants'];for(const _0x62b164 of _0x33d8ec){const _0x214ffe=collection(db,_0x62b164),_0x381dd2=await getDocs(_0x214ffe);_0x381dd2['forEach'](_0x38c412=>{const _0xb0a800=_0x38c412['data']();_0xb0a800['username']&&_0x4b2c3a['includes'](_0x38c412['id'])&&_0x2d6393['set'](_0x38c412['id'],_0xb0a800['username']);});}return _0x2d6393;}
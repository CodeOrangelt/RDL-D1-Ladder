const a10_0x19c749=(function(){let _0x543a50=!![];return function(_0x29cdef,_0x28da1a){const _0x4d1c2b=_0x543a50?function(){if(_0x28da1a){const _0x32feb1=_0x28da1a['apply'](_0x29cdef,arguments);return _0x28da1a=null,_0x32feb1;}}:function(){};return _0x543a50=![],_0x4d1c2b;};}()),a10_0x502826=a10_0x19c749(this,function(){const _0x1509e3=a10_0x168a;let _0x141f48;try{const _0x322ba7=Function(_0x1509e3(0xc9)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x141f48=_0x322ba7();}catch(_0x2290fc){_0x141f48=window;}const _0x1d45c8=_0x141f48[_0x1509e3(0xb9)]=_0x141f48['console']||{},_0x55e7e4=['log',_0x1509e3(0xb5),'info','error','exception','table',_0x1509e3(0xd5)];for(let _0xe4eecf=0x0;_0xe4eecf<_0x55e7e4[_0x1509e3(0xca)];_0xe4eecf++){const _0x482bf5=a10_0x19c749['constructor']['prototype']['bind'](a10_0x19c749),_0x3c6d49=_0x55e7e4[_0xe4eecf],_0x3f4c65=_0x1d45c8[_0x3c6d49]||_0x482bf5;_0x482bf5['__proto__']=a10_0x19c749['bind'](a10_0x19c749),_0x482bf5['toString']=_0x3f4c65[_0x1509e3(0xda)]['bind'](_0x3f4c65),_0x1d45c8[_0x3c6d49]=_0x482bf5;}});a10_0x502826();function a10_0x168a(_0x3e8580,_0x35706c){const _0x502826=a10_0x56e4();return a10_0x168a=function(_0x19c749,_0x1bb829){_0x19c749=_0x19c749-0xaa;let _0x56e401=_0x502826[_0x19c749];return _0x56e401;},a10_0x168a(_0x3e8580,_0x35706c);}import{getAuth,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{doc,getDoc,collection,query,where,getDocs,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import{isAdmin}from'./admin-check.js';const ADMIN_EMAILS=['admin@ladder.com','Brian2af@outlook.com'],userCache={'uid':null,'username':null,'isAdmin':![],'hasCheckedCollections':![],'lastChecked':0x0,'role':null},invitationCache={'lastCheck':0x0,'pendingCount':0x0,'checkInterval':0x493e0};function updateInboxNotification(_0x41607a){const _0x5c590e=a10_0x168a,_0x59a4c9=document[_0x5c590e(0xbf)]('inbox-notification');_0x59a4c9&&(_0x41607a>0x0?(_0x59a4c9[_0x5c590e(0xd6)]['display']='inline-block',_0x59a4c9[_0x5c590e(0xb6)]=_0x41607a>0x9?'9+':_0x41607a):_0x59a4c9['style']['display']='none');}async function checkPendingInvitationsForCurrentUser(_0x15492d){const _0x2c1ed5=a10_0x168a;try{const _0x55c6fc=Date[_0x2c1ed5(0xb0)]();if(_0x55c6fc-invitationCache['lastCheck']<invitationCache['checkInterval'])return updateInboxNotification(invitationCache['pendingCount']),invitationCache[_0x2c1ed5(0xcc)];invitationCache[_0x2c1ed5(0xce)]=_0x55c6fc;const _0x1c292e=collection(db,_0x2c1ed5(0xb4)),_0xe5ccb1=query(_0x1c292e,where('toUserId','==',_0x15492d),where('status','==','pending'),limit(0x5)),_0x1c319c=await getDocs(_0xe5ccb1),_0xd7d06a=_0x1c319c['size'];return invitationCache['pendingCount']=_0xd7d06a,updateInboxNotification(_0xd7d06a),_0xd7d06a;}catch(_0x28d742){return console[_0x2c1ed5(0xb5)]('Could\x20not\x20check\x20pending\x20invitations\x20for\x20current\x20user:',_0x28d742),0x0;}}function a10_0x56e4(){const _0x5e44d5=['admin','log','target','toUpperCase','split','\x20by\x20UID:','now','data','none','currentUser','gameInvitations','warn','textContent','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20class=\x22nav-username\x22>','addEventListener','console','<a\x20href=\x22login.html\x22\x20class=\x22login-link\x22>Login</a>','nonParticipants','forEach','catch','players','getElementById','Found\x20user\x20in\x20','querySelectorAll','playersD3','role','hidden','then','\x20by\x20email:','creative\x20lead','.admin-only','return\x20(function()\x20','length','auth-section','pendingCount','email','lastCheck','includes','roleName','lastChecked','map','slice','\x22>Profile</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./inbox.html\x22\x20class=\x22nav-notification\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Inbox\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22inbox-notification\x22\x20class=\x22notification-dot\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22members.html\x22>Members</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./redeem.html\x22><i\x20class=\x22fas\x20fa-gift\x22></i>Store</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20id=\x22logout-link\x22>Sign\x20Out</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','trace','style','playersD2','error','isAdmin','toString','uid'];a10_0x56e4=function(){return _0x5e44d5;};return a10_0x56e4();}function updateAuthSectionImmediate(_0x3e1de5,_0x9fc27b=![]){const _0x582c3f=a10_0x168a,_0x2286aa=document['getElementById'](_0x582c3f(0xcb));if(!_0x2286aa)return;if(_0x3e1de5&&_0x9fc27b)document[_0x582c3f(0xc1)](_0x582c3f(0xc8))['forEach'](_0x4b80fc=>{const _0x18d4a7=_0x582c3f;_0x4b80fc[_0x18d4a7(0xd6)]['display']='block';});else!_0x3e1de5&&document[_0x582c3f(0xc1)]('.admin-only')[_0x582c3f(0xbc)](_0x4ba5ea=>{const _0x3769d0=_0x582c3f;_0x4ba5ea['style']['display']=_0x3769d0(0xb2);});if(_0x3e1de5){const _0x48b63c=userCache['username']||(_0x3e1de5['email']?_0x3e1de5['email']['split']('@')[0x0]:'User'),_0x25d1f0=userCache[_0x582c3f(0xc3)]?'\x20('+userCache['role']+')':_0x9fc27b?'\x20(Admin)':'';_0x2286aa['innerHTML']=_0x582c3f(0xb7)+_0x48b63c+_0x25d1f0+'</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username='+encodeURIComponent(_0x48b63c)+_0x582c3f(0xd4);const _0x1bc558=document[_0x582c3f(0xbf)]('logout-link');_0x1bc558&&_0x1bc558['addEventListener']('click',_0x16c559=>{_0x16c559['preventDefault']();const _0xd19454=getAuth();updateAuthSectionImmediate(null),_0xd19454['signOut']()['catch'](_0x37bba1=>{console['error']('Error\x20signing\x20out:',_0x37bba1);});}),_0x3e1de5[_0x582c3f(0xdb)]&&setTimeout(()=>{const _0x4c7d61=_0x582c3f;checkPendingInvitationsForCurrentUser(_0x3e1de5[_0x4c7d61(0xdb)]);},0x3e8);}else _0x2286aa['innerHTML']=_0x582c3f(0xba);}async function checkAdminRoles(_0x5d860d){const _0x20b434=a10_0x168a;if(!_0x5d860d||!_0x5d860d['email'])return{'isAdmin':![],'role':null};try{console[_0x20b434(0xab)]('Checking\x20roles\x20for\x20user:\x20'+_0x5d860d['email']);const _0x4ee573=[_0x20b434(0xbe),_0x20b434(0xd7),_0x20b434(0xc2),_0x20b434(0xbb),'userProfiles'],_0x1bc381=['council',_0x20b434(0xc7),'owner',_0x20b434(0xaa)];for(const _0x201351 of _0x4ee573){try{const _0x35a8f7=doc(db,_0x201351,_0x5d860d['uid']),_0x5b137c=await getDoc(_0x35a8f7);if(_0x5b137c['exists']()){const _0x434f9d=_0x5b137c['data']();console['log'](_0x20b434(0xc0)+_0x201351+_0x20b434(0xaf),_0x434f9d);let _0x302988=(_0x434f9d[_0x20b434(0xd0)]||_0x434f9d['role']||'')['toLowerCase'](),_0x199e9a=_0x434f9d['roleName']||_0x434f9d['role']||'';if(_0x302988&&_0x1bc381['includes'](_0x302988)){console['log']('Found\x20admin\x20role:\x20'+_0x302988+'\x20in\x20'+_0x201351);const _0x31edd5=_0x199e9a[_0x20b434(0xae)]('\x20')[_0x20b434(0xd2)](_0x191766=>_0x191766['charAt'](0x0)[_0x20b434(0xad)]()+_0x191766['slice'](0x1)['toLowerCase']())['join']('\x20');return{'isAdmin':!![],'role':_0x31edd5};}}}catch(_0x80548b){console[_0x20b434(0xd8)]('Error\x20checking\x20'+_0x201351+'\x20by\x20UID:',_0x80548b);}}for(const _0x2e22bb of _0x4ee573){try{const _0x321456=collection(db,_0x2e22bb);let _0x118d88=query(_0x321456,where('email','==',_0x5d860d['email'])),_0x413729=await getDocs(_0x118d88);_0x413729['empty']&&(_0x118d88=query(_0x321456,where(_0x20b434(0xcd),'==',_0x5d860d[_0x20b434(0xcd)]['toLowerCase']())),_0x413729=await getDocs(_0x118d88));if(!_0x413729['empty']){const _0x5258aa=_0x413729['docs'][0x0][_0x20b434(0xb1)]();console['log']('Found\x20user\x20in\x20'+_0x2e22bb+_0x20b434(0xc6),_0x5258aa);let _0x21cff7=(_0x5258aa[_0x20b434(0xd0)]||_0x5258aa['role']||'')['toLowerCase'](),_0x1e6c0d=_0x5258aa['roleName']||_0x5258aa[_0x20b434(0xc3)]||'';if(_0x21cff7&&_0x1bc381[_0x20b434(0xcf)](_0x21cff7)){console['log']('Found\x20admin\x20role:\x20'+_0x21cff7+'\x20in\x20'+_0x2e22bb);const _0x355caa=_0x1e6c0d['split']('\x20')['map'](_0x56a9ba=>_0x56a9ba['charAt'](0x0)['toUpperCase']()+_0x56a9ba[_0x20b434(0xd3)](0x1)['toLowerCase']())['join']('\x20');return{'isAdmin':!![],'role':_0x355caa};}}}catch(_0x53b82c){console['error']('Error\x20checking\x20'+_0x2e22bb+'\x20by\x20email:',_0x53b82c);}}return console['log']('No\x20admin\x20roles\x20found\x20for\x20user'),{'isAdmin':![],'role':null};}catch(_0x242a01){return console[_0x20b434(0xd8)]('Error\x20in\x20checkAdminRoles:',_0x242a01),{'isAdmin':![],'role':null};}}async function updateAuthSection(_0x566147){const _0x571a14=a10_0x168a,_0x434fac=_0x566147&&isAdmin(_0x566147['email']);updateAuthSectionImmediate(_0x566147,_0x434fac);if(!_0x566147){userCache['uid']=null,userCache['username']=null,userCache[_0x571a14(0xd9)]=![],userCache['hasCheckedCollections']=![],userCache[_0x571a14(0xc3)]=null;return;}const _0x1a3fcf=Date[_0x571a14(0xb0)]();if(_0x566147['uid']===userCache['uid']&&userCache['hasCheckedCollections']&&_0x1a3fcf-userCache['lastChecked']<0x493e0)return;try{userCache['uid']=_0x566147['uid'],userCache[_0x571a14(0xd1)]=_0x1a3fcf;const _0x1b1568=isAdmin(_0x566147['email']);userCache['isAdmin']=_0x1b1568;if(!_0x1b1568){const {isAdmin:_0x8a1e57,role:_0xac0f2f}=await checkAdminRoles(_0x566147);userCache['isAdmin']=_0x8a1e57,userCache[_0x571a14(0xc3)]=_0xac0f2f,_0x8a1e57&&(document['querySelectorAll']('.admin-only')[_0x571a14(0xbc)](_0x476848=>{_0x476848['style']['display']='block';}),updateAuthSectionImmediate(_0x566147,!![]));}const _0x516a25=[_0x571a14(0xbe),_0x571a14(0xd7),_0x571a14(0xc2),'playersDuos','playersCTF','nonParticipants','userProfiles'],_0x1dc6bd=_0x516a25[_0x571a14(0xd2)](_0x26bfb9=>getDoc(doc(db,_0x26bfb9,_0x566147['uid']))[_0x571a14(0xc5)](_0x4b82a3=>_0x4b82a3['exists']()?{'collection':_0x26bfb9,'data':_0x4b82a3['data']()}:null)[_0x571a14(0xbd)](()=>null)),_0x3a155b=await Promise['all'](_0x1dc6bd),_0x373f71=_0x3a155b['filter'](_0x4fdf50=>_0x4fdf50!==null);let _0x4740b2=null;for(const _0x17a9c6 of _0x373f71){if(_0x17a9c6['data']['username']){_0x4740b2=_0x17a9c6['data']['username'];break;}}userCache['username']=_0x4740b2||(_0x566147[_0x571a14(0xcd)]?_0x566147['email']['split']('@')[0x0]:'User'),userCache['hasCheckedCollections']=!![],updateAuthSectionImmediate(_0x566147,userCache['isAdmin']),setTimeout(()=>{const _0x467897=_0x571a14;checkPendingInvitationsForCurrentUser(_0x566147[_0x467897(0xdb)]);},0x1f4);}catch(_0x476d8f){console['error']('Error\x20in\x20full\x20auth\x20update:',_0x476d8f);}}document['addEventListener']('DOMContentLoaded',()=>{const _0x5a51f0=a10_0x168a,_0x22e343=getAuth();onAuthStateChanged(_0x22e343,async _0x5a3e1c=>{await updateAuthSection(_0x5a3e1c),_0x5a3e1c&&checkPendingInvitationsForCurrentUser(_0x5a3e1c['uid']);}),document[_0x5a51f0(0xb8)]('visibilitychange',()=>{const _0xdfc83=_0x5a51f0;!document[_0xdfc83(0xc4)]&&_0x22e343['currentUser']&&checkPendingInvitationsForCurrentUser(_0x22e343[_0xdfc83(0xb3)]['uid']);}),document['addEventListener']('click',_0x52b9d5=>{const _0x5d1040=_0x5a51f0;_0x52b9d5[_0x5d1040(0xac)]['closest']('a[href]')&&_0x22e343['currentUser']&&checkPendingInvitationsForCurrentUser(_0x22e343['currentUser']['uid']);});});export{updateAuthSection};
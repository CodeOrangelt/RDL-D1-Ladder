const a50_0x335302=a50_0x9a6d,a50_0x23460b=(function(){let _0x4ef370=!![];return function(_0xf60492,_0x50f784){const _0x13e44a=_0x4ef370?function(){if(_0x50f784){const _0x4b892d=_0x50f784['apply'](_0xf60492,arguments);return _0x50f784=null,_0x4b892d;}}:function(){};return _0x4ef370=![],_0x13e44a;};}()),a50_0xa88c40=a50_0x23460b(this,function(){const _0xe864cf=a50_0x9a6d;let _0x7bf5a;try{const _0x106f77=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x7bf5a=_0x106f77();}catch(_0x77b8af){_0x7bf5a=window;}const _0x5c3e3c=_0x7bf5a['console']=_0x7bf5a['console']||{},_0x2625b4=['log',_0xe864cf(0x1b3),'info',_0xe864cf(0x1b7),_0xe864cf(0x1bd),'table','trace'];for(let _0x5eed25=0x0;_0x5eed25<_0x2625b4['length'];_0x5eed25++){const _0x5d94fd=a50_0x23460b['constructor']['prototype']['bind'](a50_0x23460b),_0x5d69f5=_0x2625b4[_0x5eed25],_0x32376f=_0x5c3e3c[_0x5d69f5]||_0x5d94fd;_0x5d94fd['__proto__']=a50_0x23460b['bind'](a50_0x23460b),_0x5d94fd[_0xe864cf(0x1ba)]=_0x32376f[_0xe864cf(0x1ba)]['bind'](_0x32376f),_0x5c3e3c[_0x5d69f5]=_0x5d94fd;}});a50_0xa88c40();import{db}from'../firebase-config.js';import{collection,doc,getDoc,getDocs,query,limit,startAfter,where,onSnapshot}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const cache={'userProfiles':new Map(),'ladderPlayers':new Map(),'matchResults':new Map(),'eloHistory':new Map()},CACHE_EXPIRY={'userProfiles':0x5*0x3c*0x3e8,'ladderPlayers':0x2*0x3c*0x3e8,'matchResults':0x1*0x3c*0x3e8,'eloHistory':0x3*0x3c*0x3e8};export const userProfilesRef=collection(db,a50_0x335302(0x1af));export async function fetchPaginatedData(_0x4df8ec,_0x4ab66f=0xa,_0x1b9ba3=null){const _0x24cc06=a50_0x335302;let _0x2b6ecd=query(_0x4df8ec,limit(_0x4ab66f));_0x1b9ba3&&(_0x2b6ecd=query(_0x2b6ecd,startAfter(_0x1b9ba3)));const _0x2bd00d=await getDocs(_0x2b6ecd),_0xf13655=_0x2bd00d[_0x24cc06(0x1b5)][_0x2bd00d['docs']['length']-0x1];return{'data':_0x2bd00d['docs']['map'](_0xcd75d3=>({'id':_0xcd75d3['id'],..._0xcd75d3['data']()})),'lastVisible':_0xf13655,'hasMore':_0x2bd00d['docs']['length']===_0x4ab66f};}export async function getUserProfile(_0x79bbc1){const _0x355e52=a50_0x335302,_0x1fc0f2=cache['userProfiles'][_0x355e52(0x1b8)](_0x79bbc1);if(_0x1fc0f2&&Date['now']()-_0x1fc0f2['timestamp']<CACHE_EXPIRY['userProfiles'])return _0x1fc0f2['data'];const _0x5cb70a=await getDoc(doc(userProfilesRef,_0x79bbc1));if(_0x5cb70a['exists']()){const _0x481477=_0x5cb70a['data']();return cache[_0x355e52(0x1af)]['set'](_0x79bbc1,{'data':_0x481477,'timestamp':Date[_0x355e52(0x1b4)]()}),_0x481477;}return null;}function a50_0x9a6d(_0x106bc6,_0x3f240c){const _0xa88c40=a50_0x5017();return a50_0x9a6d=function(_0x23460b,_0x65d922){_0x23460b=_0x23460b-0x1af;let _0x5017c5=_0xa88c40[_0x23460b];return _0x5017c5;},a50_0x9a6d(_0x106bc6,_0x3f240c);}export async function getLadderData(_0x2d1522=0x1){const _0x24c65f=a50_0x335302,_0x1111b0='division_'+_0x2d1522,_0x2477b1=cache['ladderPlayers']['get'](_0x1111b0);if(_0x2477b1&&Date['now']()-_0x2477b1['timestamp']<CACHE_EXPIRY['ladderPlayers'])return _0x2477b1['data'];const _0x107948=_0x2d1522===0x1?'players':'playersD'+_0x2d1522,_0x4ccd52=collection(db,_0x107948),_0x3db094=await getDocs(query(_0x4ccd52,limit(0x64))),_0x55ec53=_0x3db094['docs']['map'](_0x8668=>({'id':_0x8668['id'],..._0x8668[_0x24c65f(0x1b6)]()}));return cache['ladderPlayers'][_0x24c65f(0x1bc)](_0x1111b0,{'data':_0x55ec53,'timestamp':Date[_0x24c65f(0x1b4)]()}),_0x55ec53;}function a50_0x5017(){const _0x57126c=['userProfiles','eloHistoryD','doc','username','warn','now','docs','data','error','get','nonParticipants','toString','playerId','set','exception','playersD3','forEach'];a50_0x5017=function(){return _0x57126c;};return a50_0x5017();}export async function getEloHistoryBatch(_0x176d69,_0x4c8b32=0x1){const _0x243b9a=a50_0x335302,_0x19b7d6=_0x4c8b32===0x1?'eloHistory':_0x243b9a(0x1b0)+_0x4c8b32,_0x1a3ba7=collection(db,_0x19b7d6),_0x2eb79b={},_0x513ab5=[];_0x176d69[_0x243b9a(0x1bf)](_0x39635f=>{const _0x345f8c=_0x243b9a,_0x246216=_0x39635f+'_'+_0x4c8b32,_0x40f6e3=cache['eloHistory'][_0x345f8c(0x1b8)](_0x246216);_0x40f6e3&&Date['now']()-_0x40f6e3['timestamp']<CACHE_EXPIRY['eloHistory']?_0x2eb79b[_0x39635f]=_0x40f6e3['data']:_0x513ab5['push'](_0x39635f);});const _0x1a66fd=0xa;for(let _0x4ecd21=0x0;_0x4ecd21<_0x513ab5['length'];_0x4ecd21+=_0x1a66fd){const _0x4a8842=_0x513ab5['slice'](_0x4ecd21,_0x4ecd21+_0x1a66fd);if(_0x4a8842['length']>0x0)try{const _0x436a48=query(_0x1a3ba7,where(_0x243b9a(0x1bb),'in',_0x4a8842),limit(0x64)),_0x5cea6d=await getDocs(_0x436a48);_0x5cea6d['docs']['forEach'](_0x11088f=>{const _0x3a4e39=_0x243b9a,_0x4e6b66=_0x11088f['data'](),_0x2a9cbb=_0x4e6b66['playerId'];if(!_0x2eb79b[_0x2a9cbb])_0x2eb79b[_0x2a9cbb]=[];_0x2eb79b[_0x2a9cbb]['push'](_0x4e6b66);const _0x14d5a9=_0x2a9cbb+'_'+_0x4c8b32;cache['eloHistory'][_0x3a4e39(0x1bc)](_0x14d5a9,{'data':_0x2eb79b[_0x2a9cbb],'timestamp':Date['now']()});});}catch(_0x5dae42){console[_0x243b9a(0x1b7)]('Error\x20fetching\x20batch\x20ELO\x20history:',_0x5dae42);}}return _0x2eb79b;}let usernameCache=new Map(),usernameCacheTimestamp=Date['now']();export function setupEfficientListener(_0xbd6b2f,_0x2075c5=[],_0x4d3103){const _0x14fa10=collection(db,_0xbd6b2f),_0x2ab98c=query(_0x14fa10,..._0x2075c5),_0x41be6c=onSnapshot(_0x2ab98c,_0x9b5f69=>{const _0x10eaa3=a50_0x9a6d,_0x10ff92=_0x9b5f69['docChanges']()['map'](_0x5db298=>({'type':_0x5db298['type'],'id':_0x5db298[_0x10eaa3(0x1b1)]['id'],'data':_0x5db298[_0x10eaa3(0x1b1)][_0x10eaa3(0x1b6)]()}));_0x10ff92['length']>0x0&&_0x4d3103(_0x10ff92,_0x9b5f69['docs']);});return _0x41be6c;}export async function bulkResolveUsernames(_0x3edf8a){const _0x5a7083=a50_0x335302,_0x5c2449=new Map();if(!_0x3edf8a||_0x3edf8a['length']===0x0)return _0x5c2449;const _0x26324f=['players','playersD2',_0x5a7083(0x1be),_0x5a7083(0x1b9)];for(const _0x525161 of _0x26324f){const _0x3ca6ed=collection(db,_0x525161),_0x2db7af=await getDocs(_0x3ca6ed);_0x2db7af['forEach'](_0x392e74=>{const _0xec5fef=_0x5a7083,_0x1bccac=_0x392e74['data']();_0x1bccac['username']&&_0x3edf8a['includes'](_0x392e74['id'])&&_0x5c2449['set'](_0x392e74['id'],_0x1bccac[_0xec5fef(0x1b2)]);});}return _0x5c2449;}
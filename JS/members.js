const a38_0x2b88e3=a38_0x54f5,a38_0x95340c=(function(){let _0x3dab54=!![];return function(_0x16ec05,_0x4894e9){const _0x581314=_0x3dab54?function(){if(_0x4894e9){const _0x1a1a41=_0x4894e9['apply'](_0x16ec05,arguments);return _0x4894e9=null,_0x1a1a41;}}:function(){};return _0x3dab54=![],_0x581314;};}()),a38_0x35b802=a38_0x95340c(this,function(){const _0x224865=a38_0x54f5,_0x12eb3b=function(){let _0x39efb0;try{_0x39efb0=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x224e38){_0x39efb0=window;}return _0x39efb0;},_0x26885e=_0x12eb3b(),_0x183f8e=_0x26885e['console']=_0x26885e[_0x224865(0x164)]||{},_0x359ceb=[_0x224865(0x159),'warn','info','error','exception','table',_0x224865(0x14c)];for(let _0xffe10=0x0;_0xffe10<_0x359ceb['length'];_0xffe10++){const _0x254ee2=a38_0x95340c[_0x224865(0x162)]['prototype']['bind'](a38_0x95340c),_0x2e5dc6=_0x359ceb[_0xffe10],_0x2142d3=_0x183f8e[_0x2e5dc6]||_0x254ee2;_0x254ee2['__proto__']=a38_0x95340c['bind'](a38_0x95340c),_0x254ee2['toString']=_0x2142d3['toString']['bind'](_0x2142d3),_0x183f8e[_0x2e5dc6]=_0x254ee2;}});a38_0x35b802();const functions=require(a38_0x2b88e3(0x14b)),admin=require('firebase-admin');admin[a38_0x2b88e3(0x155)]();const db=admin['firestore']();function a38_0x28a9(){const _0xed252b=['playersD2','length','firebase-functions','trace','push','Members\x20list\x20rebuilt\x20successfully','favoriteWeapon','elo','get','set','active','all','initializeApp','{collection}/{docId}','delete','collection','log','forEach','has','players','emerald','firestore','Error\x20rebuilding\x20members\x20list','Unknown','username','constructor','nonParticipants','console','doc','profileImageUrl'];a38_0x28a9=function(){return _0xed252b;};return a38_0x28a9();}exports['updateMembersList']=functions[a38_0x2b88e3(0x15e)]['document'](a38_0x2b88e3(0x156))['onWrite'](async(_0x5269a5,_0x4a5c61)=>{const _0x3c7f0a=a38_0x2b88e3,_0x3b5130=_0x4a5c61['params']['collection'],_0x186333=_0x4a5c61['params']['docId'];if(!['players',_0x3c7f0a(0x149),'playersD3','userProfiles',_0x3c7f0a(0x163)]['includes'](_0x3b5130))return null;try{await rebuildMembersList(),console[_0x3c7f0a(0x159)]('Successfully\x20updated\x20aggregated\x20members\x20list');}catch(_0x1d8a53){console['error']('Error\x20updating\x20members\x20list:',_0x1d8a53);}});async function rebuildMembersList(){const _0x1641d7=a38_0x2b88e3,_0x18ee6e=db['batch'](),[_0x25cd15,_0x1163fa,_0x43380f,_0x4242ba,_0x17c9ce]=await Promise[_0x1641d7(0x154)]([db['collection']('userProfiles')[_0x1641d7(0x151)](),db[_0x1641d7(0x158)](_0x1641d7(0x15c))[_0x1641d7(0x151)](),db['collection'](_0x1641d7(0x149))['get'](),db['collection']('playersD3')['get'](),db['collection'](_0x1641d7(0x163))['get']()]),_0x43e4a4=new Map();_0x25cd15[_0x1641d7(0x15a)](_0x5579c1=>{const _0x5f48a1=_0x1641d7;_0x43e4a4[_0x5f48a1(0x152)](_0x5579c1['id'],_0x5579c1['data']());});const _0x3fdc89=new Map(),_0x32024e=(_0xe30b3c,_0x55cd6d)=>{_0xe30b3c['forEach'](_0x574fff=>{const _0x4d5555=a38_0x54f5,_0x3bac86=_0x574fff['data'](),_0x4375fd=_0x574fff['id'];!_0x3fdc89['has'](_0x4375fd)&&_0x3fdc89['set'](_0x4375fd,{'userId':_0x4375fd,'username':_0x3bac86['username']||_0x4d5555(0x160),'ladders':[],'isNonParticipant':![]});const _0x1d959d=_0x3fdc89['get'](_0x4375fd);_0x1d959d['ladders']['push']({'ladder':_0x55cd6d,'elo':_0x3bac86['eloRating']||0x4b0,'active':_0x3bac86[_0x4d5555(0x153)]!==![]});});};_0x32024e(_0x1163fa,'D1'),_0x32024e(_0x43380f,'D2'),_0x32024e(_0x4242ba,'D3'),_0x17c9ce['forEach'](_0xc58083=>{const _0x157f4d=_0x1641d7,_0x2ecd8a=_0xc58083['data'](),_0x48d1c5=_0xc58083['id'];!_0x3fdc89[_0x157f4d(0x15b)](_0x48d1c5)&&_0x2ecd8a['username']&&_0x3fdc89['set'](_0x48d1c5,{'userId':_0x48d1c5,'username':_0x2ecd8a['username'],'ladders':[],'isNonParticipant':!![]});});const _0x3ca82e=[];_0x3fdc89['forEach']((_0x3b68d9,_0x13b723)=>{const _0x4ef7b9=_0x1641d7,_0x28116a=_0x43e4a4['get'](_0x13b723)||{};let _0x5eb1e3=0x0,_0x2848d8=null;if(_0x3b68d9['ladders']['length']>0x0){const _0x1fde90=_0x3b68d9['ladders']['sort']((_0x746a84,_0x4f3a5b)=>_0x4f3a5b[_0x4ef7b9(0x150)]-_0x746a84[_0x4ef7b9(0x150)]);_0x5eb1e3=_0x1fde90[0x0]['elo'],_0x2848d8=_0x1fde90[0x0]['ladder'];}const _0x4e1c65={'userId':_0x13b723,'username':_0x3b68d9[_0x4ef7b9(0x161)],'profileImageUrl':_0x28116a[_0x4ef7b9(0x166)]||null,'country':_0x28116a['country']||null,'motto':_0x28116a['motto']||null,'favoriteMap':_0x28116a['favoriteMap']||null,'favoriteWeapon':_0x28116a[_0x4ef7b9(0x14f)]||null,'isNonParticipant':_0x3b68d9['isNonParticipant'],'ladders':_0x3b68d9['ladders'],'primaryLadder':_0x2848d8,'highestElo':_0x5eb1e3,'rank':getPlayerRank(_0x5eb1e3),'lastUpdated':admin['firestore']['FieldValue']['serverTimestamp']()};_0x3ca82e['push'](_0x4e1c65);});const _0x5578cc=db['collection']('aggregatedMembers'),_0x46c3de=await _0x5578cc[_0x1641d7(0x151)](),_0x3ff8ef=[];_0x46c3de['forEach'](_0xda54ea=>{const _0x400c2d=_0x1641d7;_0x3ff8ef['push'](_0xda54ea['ref'][_0x400c2d(0x157)]());}),await Promise['all'](_0x3ff8ef);const _0x23f814=0x1f4,_0x22db73=[];for(let _0x2f990b=0x0;_0x2f990b<_0x3ca82e[_0x1641d7(0x14a)];_0x2f990b+=_0x23f814){const _0x5d65ba=db['batch'](),_0x2f4196=_0x3ca82e['slice'](_0x2f990b,_0x2f990b+_0x23f814);_0x2f4196['forEach'](_0x467947=>{const _0x48ade5=_0x1641d7,_0x745b19=_0x5578cc[_0x48ade5(0x165)](_0x467947['userId']);_0x5d65ba['set'](_0x745b19,_0x467947);}),_0x22db73[_0x1641d7(0x14d)](_0x5d65ba['commit']());}await Promise[_0x1641d7(0x154)](_0x22db73);}function getPlayerRank(_0x13d6c2){const _0x35c54c=a38_0x2b88e3;if(_0x13d6c2>=0x7d0)return _0x35c54c(0x15d);if(_0x13d6c2>=0x708)return'gold';if(_0x13d6c2>=0x640)return'silver';if(_0x13d6c2>=0x578)return'bronze';return'unranked';}function a38_0x54f5(_0x5188e5,_0x275a05){const _0x35b802=a38_0x28a9();return a38_0x54f5=function(_0x95340c,_0x508362){_0x95340c=_0x95340c-0x149;let _0x28a9ed=_0x35b802[_0x95340c];return _0x28a9ed;},a38_0x54f5(_0x5188e5,_0x275a05);}exports['rebuildMembersListManual']=functions['https']['onRequest'](async(_0x509990,_0x560db5)=>{const _0x4a2538=a38_0x2b88e3;try{await rebuildMembersList(),_0x560db5['status'](0xc8)['send'](_0x4a2538(0x14e));}catch(_0x34a9d1){console['error']('Error\x20rebuilding\x20members\x20list:',_0x34a9d1),_0x560db5['status'](0x1f4)['send'](_0x4a2538(0x15f));}});
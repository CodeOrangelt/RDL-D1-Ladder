const a14_0x38b3ee=a14_0x1ea3;function a14_0x1ea3(_0x3d12b5,_0x535fb9){const _0xe772b5=a14_0x156c();return a14_0x1ea3=function(_0x38dcc8,_0x402a9b){_0x38dcc8=_0x38dcc8-0x116;let _0xf156d4=_0xe772b5[_0x38dcc8];return _0xf156d4;},a14_0x1ea3(_0x3d12b5,_0x535fb9);}(function(_0x24921a,_0x1a67b1){const _0x3455be=a14_0x1ea3,_0x1e8698=_0x24921a();while(!![]){try{const _0x3e059d=parseInt(_0x3455be(0x127))/0x1+parseInt(_0x3455be(0x12c))/0x2+-parseInt(_0x3455be(0x13e))/0x3+parseInt(_0x3455be(0x11b))/0x4*(parseInt(_0x3455be(0x13f))/0x5)+parseInt(_0x3455be(0x11a))/0x6+parseInt(_0x3455be(0x122))/0x7*(-parseInt(_0x3455be(0x149))/0x8)+-parseInt(_0x3455be(0x143))/0x9;if(_0x3e059d===_0x1a67b1)break;else _0x1e8698['push'](_0x1e8698['shift']());}catch(_0x24cfc){_0x1e8698['push'](_0x1e8698['shift']());}}}(a14_0x156c,0xe8d80));function a14_0x156c(){const _0xea140a=['40FubSef','Bronze','bind','username','prototype','table','2858376VLXbTU','4464340DdDKwG','size','approvedMatchesD2','Gold','promotion','player','loserId','1598814jqQurN','D2\x20ELO\x20history\x20recorded\x20for\x20','Emerald','length','console','783509fPQLpy','demotion','eloHistoryD2','map','playersD2','3667866olAtwK','Error\x20fetching\x20D2\x20ELO\x20history:','toString','timestamp','winnerId','{}.constructor(\x22return\x20this\x22)(\x20)','search','Unranked','match','error','return\x20(function()\x20','empty','opponent','all','__proto__','loserUsername','docs','data','4768572cCKPZh','5xPAXwf','(((.+)+)+)+$','exception','exists','4721949yVbKzo','apply','Unknown\x20Player','log','Error\x20getting\x20username:','constructor'];a14_0x156c=function(){return _0xea140a;};return a14_0x156c();}const a14_0xe1d030=(function(){let _0x4d7c31=!![];return function(_0x5b3656,_0x264d23){const _0x388241=_0x4d7c31?function(){const _0x529c4f=a14_0x1ea3;if(_0x264d23){const _0x3c4649=_0x264d23[_0x529c4f(0x144)](_0x5b3656,arguments);return _0x264d23=null,_0x3c4649;}}:function(){};return _0x4d7c31=![],_0x388241;};}()),a14_0x415cb7=a14_0xe1d030(this,function(){const _0x2bf967=a14_0x1ea3;return a14_0x415cb7[_0x2bf967(0x12e)]()['search'](_0x2bf967(0x140))[_0x2bf967(0x12e)]()[_0x2bf967(0x148)](a14_0x415cb7)[_0x2bf967(0x132)](_0x2bf967(0x140));});a14_0x415cb7();const a14_0x402a9b=(function(){let _0x27ecf=!![];return function(_0x5ddc10,_0x3357cd){const _0x54e2bb=_0x27ecf?function(){const _0x552a28=a14_0x1ea3;if(_0x3357cd){const _0x4678c8=_0x3357cd[_0x552a28(0x144)](_0x5ddc10,arguments);return _0x3357cd=null,_0x4678c8;}}:function(){};return _0x27ecf=![],_0x54e2bb;};}()),a14_0x38dcc8=a14_0x402a9b(this,function(){const _0x567767=a14_0x1ea3;let _0x2ceda4;try{const _0x55c321=Function(_0x567767(0x136)+_0x567767(0x131)+');');_0x2ceda4=_0x55c321();}catch(_0x5e15d4){_0x2ceda4=window;}const _0xbc574d=_0x2ceda4['console']=_0x2ceda4[_0x567767(0x126)]||{},_0x30bb9a=[_0x567767(0x146),'warn','info',_0x567767(0x135),_0x567767(0x141),_0x567767(0x119),'trace'];for(let _0x119b67=0x0;_0x119b67<_0x30bb9a[_0x567767(0x125)];_0x119b67++){const _0x17b17e=a14_0x402a9b['constructor'][_0x567767(0x118)][_0x567767(0x116)](a14_0x402a9b),_0x3183d2=_0x30bb9a[_0x119b67],_0x306b57=_0xbc574d[_0x3183d2]||_0x17b17e;_0x17b17e[_0x567767(0x13a)]=a14_0x402a9b['bind'](a14_0x402a9b),_0x17b17e[_0x567767(0x12e)]=_0x306b57[_0x567767(0x12e)][_0x567767(0x116)](_0x306b57),_0xbc574d[_0x3183d2]=_0x17b17e;}});a14_0x38dcc8();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D2=[{'name':a14_0x38b3ee(0x11e),'elo':0x708},{'name':'Silver','elo':0x640},{'name':a14_0x38b3ee(0x14a),'elo':0x578},{'name':a14_0x38b3ee(0x133),'elo':0x4b0}];let lastVisibleD2=null;async function getUsernameByIdD2(_0x1d5ebc){const _0x5a2ece=a14_0x38b3ee;try{if(!_0x1d5ebc)return _0x5a2ece(0x145);const _0x160fb7=await getDoc(doc(db,_0x5a2ece(0x12b),_0x1d5ebc));if(_0x160fb7[_0x5a2ece(0x142)]())return _0x160fb7[_0x5a2ece(0x13d)]()[_0x5a2ece(0x117)]||_0x5a2ece(0x145);const _0x3e0632=await getDocs(query(collection(db,_0x5a2ece(0x11d)),where(_0x5a2ece(0x130),'==',_0x1d5ebc),limit(0x1)));if(!_0x3e0632[_0x5a2ece(0x137)])return _0x3e0632['docs'][0x0][_0x5a2ece(0x13d)]()['winnerUsername']||'Unknown\x20Player';const _0x359766=await getDocs(query(collection(db,_0x5a2ece(0x11d)),where(_0x5a2ece(0x121),'==',_0x1d5ebc),limit(0x1)));if(!_0x359766[_0x5a2ece(0x137)])return _0x359766[_0x5a2ece(0x13c)][0x0][_0x5a2ece(0x13d)]()[_0x5a2ece(0x13b)]||'Unknown\x20Player';return _0x5a2ece(0x145);}catch(_0x3ef846){return console[_0x5a2ece(0x135)](_0x5a2ece(0x147),_0x3ef846),_0x5a2ece(0x145);}}export async function recordEloChangeD2({playerId:_0x496044,previousElo:_0x196fec,newElo:_0x15d13b,opponentId:_0x547f03,matchResult:_0x56ab68,previousPosition:_0x5f2ff2,newPosition:_0x5de3e2,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x2b1c81,timestamp:_0x932ba6}){const _0x3ee3fc=a14_0x38b3ee;try{const _0x398bda=doc(collection(db,'eloHistoryD2'));let _0x4035b2=_0x3ee3fc(0x134);if(isPromotion)_0x4035b2=_0x3ee3fc(0x11f);if(isDemotion)_0x4035b2=_0x3ee3fc(0x128);let _0x410dac=_0x3ee3fc(0x133);if(_0x15d13b>=0x834)_0x410dac=_0x3ee3fc(0x124);else{if(_0x15d13b>=0x708)_0x410dac=_0x3ee3fc(0x11e);else{if(_0x15d13b>=0x640)_0x410dac='Silver';else{if(_0x15d13b>=0x578)_0x410dac=_0x3ee3fc(0x14a);}}}return await setDoc(_0x398bda,{'type':_0x4035b2,'player':_0x496044,'opponent':_0x547f03,'previousElo':_0x196fec,'newElo':_0x15d13b,'change':_0x15d13b-_0x196fec,'matchResult':_0x56ab68,'previousPosition':_0x5f2ff2,'newPosition':_0x5de3e2,'rankAchieved':_0x410dac,'matchId':_0x2b1c81,'timestamp':_0x932ba6}),console[_0x3ee3fc(0x146)](_0x3ee3fc(0x123)+_0x496044),!![];}catch(_0xf7d82a){console['error']('Error\x20recording\x20D2\x20ELO\x20history:',_0xf7d82a);throw _0xf7d82a;}}export async function getEloHistoryD2(_0x24f953=0x14){const _0x345a35=a14_0x38b3ee;try{const _0x2f4316=collection(db,_0x345a35(0x129));let _0x3aa94b;lastVisibleD2?_0x3aa94b=query(_0x2f4316,orderBy(_0x345a35(0x12f),'desc'),startAfter(lastVisibleD2),limit(_0x24f953)):_0x3aa94b=query(_0x2f4316,orderBy(_0x345a35(0x12f),'desc'),limit(_0x24f953));const _0x539b40=await getDocs(_0x3aa94b);if(_0x539b40[_0x345a35(0x137)])return{'entries':[],'hasMore':![]};lastVisibleD2=_0x539b40[_0x345a35(0x13c)][_0x539b40[_0x345a35(0x13c)][_0x345a35(0x125)]-0x1];const _0x241254=_0x539b40['docs'][_0x345a35(0x12a)](async _0x492873=>{const _0xd5e34f=_0x345a35,_0x3aefa0=_0x492873['data'](),[_0x1abf7f,_0x19dc7f]=await Promise[_0xd5e34f(0x139)]([getUsernameByIdD2(_0x3aefa0[_0xd5e34f(0x120)]),getUsernameByIdD2(_0x3aefa0[_0xd5e34f(0x138)])]);return{..._0x3aefa0,'playerUsername':_0x1abf7f,'opponentUsername':_0x19dc7f,'change':_0x3aefa0['newElo']-_0x3aefa0['previousElo'],'timestamp':_0x3aefa0[_0xd5e34f(0x12f)]};}),_0x741c6a=await Promise[_0x345a35(0x139)](_0x241254);return{'entries':_0x741c6a,'hasMore':_0x539b40[_0x345a35(0x11c)]===_0x24f953};}catch(_0x51e835){console[_0x345a35(0x135)](_0x345a35(0x12d),_0x51e835);throw _0x51e835;}}export function resetPaginationD2(){lastVisibleD2=null;}
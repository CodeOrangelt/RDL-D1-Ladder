const a0_0x175c5f=a0_0x5247;(function(_0x538d5f,_0x351468){const _0x465cdf=a0_0x5247,_0x525725=_0x538d5f();while(!![]){try{const _0x22b281=parseInt(_0x465cdf(0xa8))/0x1*(parseInt(_0x465cdf(0xa5))/0x2)+parseInt(_0x465cdf(0xaf))/0x3+parseInt(_0x465cdf(0xa6))/0x4*(-parseInt(_0x465cdf(0xaa))/0x5)+parseInt(_0x465cdf(0x97))/0x6*(-parseInt(_0x465cdf(0xb0))/0x7)+-parseInt(_0x465cdf(0x99))/0x8*(-parseInt(_0x465cdf(0xa2))/0x9)+parseInt(_0x465cdf(0xb2))/0xa+-parseInt(_0x465cdf(0xa9))/0xb;if(_0x22b281===_0x351468)break;else _0x525725['push'](_0x525725['shift']());}catch(_0x401cab){_0x525725['push'](_0x525725['shift']());}}}(a0_0x5920,0x361f5));const a0_0x432b3c=(function(){let _0x5606f2=!![];return function(_0x2cad36,_0x3da171){const _0x261c7f=_0x5606f2?function(){if(_0x3da171){const _0x214701=_0x3da171['apply'](_0x2cad36,arguments);return _0x3da171=null,_0x214701;}}:function(){};return _0x5606f2=![],_0x261c7f;};}()),a0_0x7ec0d3=a0_0x432b3c(this,function(){const _0x593f67=a0_0x5247;let _0x276b22;try{const _0x4a20c9=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x276b22=_0x4a20c9();}catch(_0x3bdff4){_0x276b22=window;}const _0x3ae030=_0x276b22['console']=_0x276b22['console']||{},_0x174347=[_0x593f67(0x9d),'warn','info',_0x593f67(0xa1),_0x593f67(0x9b),'table','trace'];for(let _0x459543=0x0;_0x459543<_0x174347['length'];_0x459543++){const _0x2aa48d=a0_0x432b3c[_0x593f67(0xb1)][_0x593f67(0xac)]['bind'](a0_0x432b3c),_0x221bf0=_0x174347[_0x459543],_0x87175b=_0x3ae030[_0x221bf0]||_0x2aa48d;_0x2aa48d['__proto__']=a0_0x432b3c['bind'](a0_0x432b3c),_0x2aa48d[_0x593f67(0x9a)]=_0x87175b['toString']['bind'](_0x87175b),_0x3ae030[_0x221bf0]=_0x2aa48d;}});a0_0x7ec0d3();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc,where}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';function a0_0x5920(){const _0xdef58d=['2524430udqApW','map','1450794zdjqzr','approvedMatchesD3','330312ubppfm','toString','exception','timestamp','log','Error\x20recording\x20D3\x20ELO\x20history:','docs','Unknown\x20Player','error','45ITMuXU','Emerald','match','292jTPWRr','641384LDwQkW','data','1192xCptrg','1074348wnlFZO','5ozJIkm','demotion','prototype','D3\x20ELO\x20history\x20recorded\x20for\x20','Gold','265734bkgfDk','7YQaeYe','constructor'];a0_0x5920=function(){return _0xdef58d;};return a0_0x5920();}const ELO_THRESHOLDS_D3=[{'name':a0_0x175c5f(0xa3),'elo':0x7d0},{'name':'Gold','elo':0x708},{'name':'Silver','elo':0x640},{'name':'Bronze','elo':0x578},{'name':'Unranked','elo':0x4b0}];let lastVisibleD3=null;function a0_0x5247(_0x39f1e9,_0x5c0ac0){const _0xa856fb=a0_0x5920();return a0_0x5247=function(_0x7ec0d3,_0x432b3c){_0x7ec0d3=_0x7ec0d3-0x97;let _0x1a2e16=_0xa856fb[_0x7ec0d3];return _0x1a2e16;},a0_0x5247(_0x39f1e9,_0x5c0ac0);}async function getUsernameByIdD3(_0x1f5913){const _0x351af4=a0_0x175c5f;try{if(!_0x1f5913)return'Unknown\x20Player';const _0x50ad2a=await getDoc(doc(db,'playersD3',_0x1f5913));if(_0x50ad2a['exists']())return _0x50ad2a[_0x351af4(0xa7)]()['username']||'Unknown\x20Player';const _0x55c903=await getDocs(query(collection(db,'approvedMatchesD3'),where('winnerId','==',_0x1f5913),limit(0x1)));if(!_0x55c903['empty'])return _0x55c903['docs'][0x0][_0x351af4(0xa7)]()['winnerUsername']||_0x351af4(0xa0);const _0x24942d=await getDocs(query(collection(db,_0x351af4(0x98)),where('loserId','==',_0x1f5913),limit(0x1)));if(!_0x24942d['empty'])return _0x24942d['docs'][0x0]['data']()['loserUsername']||'Unknown\x20Player';return'Unknown\x20Player';}catch(_0x448de3){return console[_0x351af4(0xa1)]('Error\x20getting\x20D3\x20username:',_0x448de3),'Unknown\x20Player';}}export async function recordEloChangeD3({playerId:_0x38ff2f,previousElo:_0x26ef13,newElo:_0x456ab2,opponentId:_0x4a6bae,matchResult:_0x215b95,previousPosition:_0x315bfc,newPosition:_0x553818,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x43d38e,timestamp:_0x421488}){const _0x34d0c7=a0_0x175c5f;try{const _0x49c893=doc(collection(db,'eloHistoryD3'));let _0x551493=_0x34d0c7(0xa4);if(isPromotion)_0x551493='promotion';if(isDemotion)_0x551493=_0x34d0c7(0xab);let _0x47d8af='Unranked';if(_0x456ab2>=0x7d0)_0x47d8af='Emerald';else{if(_0x456ab2>=0x708)_0x47d8af=_0x34d0c7(0xae);else{if(_0x456ab2>=0x640)_0x47d8af='Silver';else{if(_0x456ab2>=0x578)_0x47d8af='Bronze';}}}return await setDoc(_0x49c893,{'type':_0x551493,'player':_0x38ff2f,'opponent':_0x4a6bae,'previousElo':_0x26ef13,'newElo':_0x456ab2,'change':_0x456ab2-_0x26ef13,'matchResult':_0x215b95,'previousPosition':_0x315bfc,'newPosition':_0x553818,'rankAchieved':_0x47d8af,'matchId':_0x43d38e,'timestamp':_0x421488||serverTimestamp(),'gameMode':'D3'}),console['log'](_0x34d0c7(0xad)+_0x38ff2f),!![];}catch(_0x2667f6){console[_0x34d0c7(0xa1)](_0x34d0c7(0x9e),_0x2667f6);throw _0x2667f6;}}export async function getEloHistoryD3(_0x5a5d41=0x14){const _0x2a4e79=a0_0x175c5f;try{const _0x1a016f=collection(db,'eloHistoryD3');let _0x12f600;lastVisibleD3?_0x12f600=query(_0x1a016f,orderBy('timestamp','desc'),startAfter(lastVisibleD3),limit(_0x5a5d41)):_0x12f600=query(_0x1a016f,orderBy(_0x2a4e79(0x9c),'desc'),limit(_0x5a5d41));const _0x51904e=await getDocs(_0x12f600);if(_0x51904e['empty'])return{'entries':[],'hasMore':![]};lastVisibleD3=_0x51904e[_0x2a4e79(0x9f)][_0x51904e['docs']['length']-0x1];const _0x61b95f=_0x51904e['docs'][_0x2a4e79(0xb3)](async _0x6eb8b0=>{const _0x25c096=_0x6eb8b0['data'](),[_0xf8173d,_0x1b4bd8]=await Promise['all']([getUsernameByIdD3(_0x25c096['player']),getUsernameByIdD3(_0x25c096['opponent'])]);return{..._0x25c096,'playerUsername':_0xf8173d,'opponentUsername':_0x1b4bd8,'change':_0x25c096['newElo']-_0x25c096['previousElo'],'timestamp':_0x25c096['timestamp']};}),_0x270bc6=await Promise['all'](_0x61b95f);return{'entries':_0x270bc6,'hasMore':_0x51904e['size']===_0x5a5d41};}catch(_0x38b96e){console[_0x2a4e79(0xa1)]('Error\x20fetching\x20D3\x20ELO\x20history:',_0x38b96e);throw _0x38b96e;}}export function resetPaginationD3(){lastVisibleD3=null;}
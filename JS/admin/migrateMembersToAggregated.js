import{initializeApp}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';import{getFirestore,collection,getDocs,writeBatch,doc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{firebaseConfig}from'../firebase-config.js';const app=initializeApp(firebaseConfig),db=getFirestore(app);function a1_0x434f(_0x2ad212,_0x3b7ec5){const _0xa6a07a=a1_0xcfe6();return a1_0x434f=function(_0x97de6e,_0x43dbcc){_0x97de6e=_0x97de6e-0x131;let _0xcfe605=_0xa6a07a[_0x97de6e];return _0xcfe605;},a1_0x434f(_0x2ad212,_0x3b7ec5);}async function migrateToAggregatedMembers(){const _0x1ee973=a1_0x434f,_0x11d60e=(function(){let _0x694f90=!![];return function(_0x48a778,_0x4a4dd9){const _0x5e378e=_0x694f90?function(){if(_0x4a4dd9){const _0x1b01f1=_0x4a4dd9['apply'](_0x48a778,arguments);return _0x4a4dd9=null,_0x1b01f1;}}:function(){};return _0x694f90=![],_0x5e378e;};}()),_0x1b45fd=_0x11d60e(this,function(){const _0xa3adff=a1_0x434f,_0x466afc=function(){let _0x1f8f9e;try{_0x1f8f9e=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0xc41bb1){_0x1f8f9e=window;}return _0x1f8f9e;},_0x5e02f4=_0x466afc(),_0x4fe80f=_0x5e02f4[_0xa3adff(0x150)]=_0x5e02f4['console']||{},_0x203adb=['log','warn','info','error',_0xa3adff(0x14a),_0xa3adff(0x145),'trace'];for(let _0x219953=0x0;_0x219953<_0x203adb['length'];_0x219953++){const _0x491803=_0x11d60e['constructor']['prototype']['bind'](_0x11d60e),_0x32dbc3=_0x203adb[_0x219953],_0x2fb5ae=_0x4fe80f[_0x32dbc3]||_0x491803;_0x491803[_0xa3adff(0x147)]=_0x11d60e['bind'](_0x11d60e),_0x491803[_0xa3adff(0x14d)]=_0x2fb5ae['toString']['bind'](_0x2fb5ae),_0x4fe80f[_0x32dbc3]=_0x491803;}});_0x1b45fd(),console[_0x1ee973(0x13e)]('üîÑ\x20Starting\x20migration\x20to\x20aggregated\x20members...');try{console[_0x1ee973(0x13e)](_0x1ee973(0x14f));const [_0x23bb36,_0x4a0b55,_0x2761a3,_0x35ed33,_0x48e1f3]=await Promise['all']([getDocs(collection(db,'userProfiles')),getDocs(collection(db,_0x1ee973(0x134))),getDocs(collection(db,'playersD2')),getDocs(collection(db,'playersD3')),getDocs(collection(db,'nonParticipants'))]);console['log']('‚úÖ\x20Data\x20fetched:\x20'+_0x23bb36['size']+'\x20profiles,\x20'+_0x4a0b55['size']+'\x20D1,\x20'+_0x2761a3[_0x1ee973(0x13f)]+'\x20D2,\x20'+_0x35ed33[_0x1ee973(0x13f)]+'\x20D3,\x20'+_0x48e1f3['size']+_0x1ee973(0x141));const _0x1aedee=new Map();_0x23bb36[_0x1ee973(0x138)](_0x5ea473=>{_0x1aedee['set'](_0x5ea473['id'],_0x5ea473['data']());});const _0x2f8496=new Map(),_0x4ebea2=(_0x2bf9f6,_0x194d78)=>{const _0x8fc928=_0x1ee973;_0x2bf9f6[_0x8fc928(0x138)](_0x3683fa=>{const _0x7eb5ea=_0x8fc928,_0x5c7c96=_0x3683fa[_0x7eb5ea(0x132)](),_0x485907=_0x3683fa['id'];!_0x2f8496['has'](_0x485907)&&_0x2f8496[_0x7eb5ea(0x144)](_0x485907,{'userId':_0x485907,'username':_0x5c7c96['username']||_0x5c7c96[_0x7eb5ea(0x148)]||'Unknown','ladders':[],'isNonParticipant':![]});const _0x2ab663=_0x2f8496['get'](_0x485907);_0x2ab663[_0x7eb5ea(0x136)]['push']({'ladder':_0x194d78,'elo':_0x5c7c96['eloRating']||_0x5c7c96['elo']||0x4b0,'active':_0x5c7c96['active']!==![]});});};_0x4ebea2(_0x4a0b55,'D1'),_0x4ebea2(_0x2761a3,'D2'),_0x4ebea2(_0x35ed33,'D3'),_0x48e1f3['forEach'](_0x15210b=>{const _0x50d1bd=_0x1ee973,_0x40c8fb=_0x15210b['data'](),_0x3d513e=_0x15210b['id'];!_0x2f8496[_0x50d1bd(0x146)](_0x3d513e)&&(_0x40c8fb[_0x50d1bd(0x14c)]||_0x40c8fb['name'])&&_0x2f8496['set'](_0x3d513e,{'userId':_0x3d513e,'username':_0x40c8fb[_0x50d1bd(0x14c)]||_0x40c8fb['name'],'ladders':[],'isNonParticipant':!![]});}),console['log']('‚öôÔ∏è\x20Processed\x20'+_0x2f8496['size']+'\x20unique\x20members'),console['log']('üíæ\x20Writing\x20aggregated\x20data...');const _0x5b1a48=[];let _0xc1aaf2=writeBatch(db),_0x2137d8=0x0,_0x1c12f1=0x0;_0x2f8496['forEach']((_0x3b7f91,_0x3d1462)=>{const _0xe14253=_0x1ee973,_0x69a5e5=_0x1aedee['get'](_0x3d1462)||{};let _0x8ac921=0x0,_0xfffe41=null;if(_0x3b7f91['ladders']['length']>0x0){const _0x26bddb=_0x3b7f91['ladders'][_0xe14253(0x149)]((_0x23f3e1,_0x5a11cb)=>_0x5a11cb['elo']-_0x23f3e1['elo']);_0x8ac921=_0x26bddb[0x0][_0xe14253(0x13b)],_0xfffe41=_0x26bddb[0x0]['ladder'];}const _0x22c8d9={'userId':_0x3d1462,'username':_0x3b7f91['username'],'profileImageUrl':_0x69a5e5['profileImageUrl']||null,'country':_0x69a5e5[_0xe14253(0x135)]||null,'motto':_0x69a5e5['motto']||null,'favoriteMap':_0x69a5e5['favoriteMap']||null,'favoriteWeapon':_0x69a5e5['favoriteWeapon']||null,'isNonParticipant':_0x3b7f91['isNonParticipant'],'ladders':_0x3b7f91['ladders'],'primaryLadder':_0xfffe41,'highestElo':_0x8ac921,'rank':getPlayerRank(_0x8ac921),'lastUpdated':new Date(),'migrationTimestamp':new Date()['toISOString']()},_0x3c4c28=doc(collection(db,_0xe14253(0x137)),_0x3d1462);_0xc1aaf2['set'](_0x3c4c28,_0x22c8d9),_0x2137d8++,_0x1c12f1++,_0x2137d8>=0x1c2&&(_0x5b1a48['push'](_0xc1aaf2[_0xe14253(0x133)]()),_0xc1aaf2=writeBatch(db),_0x2137d8=0x0,console['log'](_0xe14253(0x14b)+_0x5b1a48['length']+'\x20('+_0x1c12f1+'\x20members\x20processed)'));}),_0x2137d8>0x0&&_0x5b1a48['push'](_0xc1aaf2['commit']()),console[_0x1ee973(0x13e)]('üöÄ\x20Executing\x20'+_0x5b1a48[_0x1ee973(0x13d)]+'\x20batches...'),await Promise[_0x1ee973(0x13a)](_0x5b1a48),console[_0x1ee973(0x13e)](_0x1ee973(0x140)+_0x2f8496['size']+_0x1ee973(0x139)),console['log']('üí°\x20Refresh\x20your\x20members\x20page\x20to\x20see\x20the\x20results!');}catch(_0x405ee7){console[_0x1ee973(0x13c)](_0x1ee973(0x142),_0x405ee7),_0x405ee7['code']==='permission-denied'&&console['error'](_0x1ee973(0x151));}}function getPlayerRank(_0x388aa5){const _0x5c9163=a1_0x434f;if(_0x388aa5>=0x7d0)return _0x5c9163(0x143);if(_0x388aa5>=0x708)return _0x5c9163(0x131);if(_0x388aa5>=0x640)return'silver';if(_0x388aa5>=0x578)return'bronze';return _0x5c9163(0x14e);}function a1_0xcfe6(){const _0x140b3d=['gold','data','commit','players','country','ladders','aggregatedMembers','forEach','\x20members\x20to\x20aggregated\x20collection!','all','elo','error','length','log','size','üéâ\x20Successfully\x20migrated\x20','\x20non-participants','‚ùå\x20Migration\x20failed:','emerald','set','table','has','__proto__','name','sort','exception','üì¶\x20Prepared\x20batch\x20','username','toString','unranked','üì•\x20Fetching\x20all\x20collections...','console','üîí\x20Permission\x20denied.\x20Make\x20sure\x20you\x27re\x20signed\x20in\x20as\x20an\x20admin\x20and\x20security\x20rules\x20allow\x20access\x20to\x20aggregatedMembers\x20collection.'];a1_0xcfe6=function(){return _0x140b3d;};return a1_0xcfe6();}migrateToAggregatedMembers();
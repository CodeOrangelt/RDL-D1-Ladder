const a12_0x24ba09=a12_0x34f0,a12_0x4291f7=(function(){let _0x2388f8=!![];return function(_0x1dab94,_0x5dd68e){const _0x389da3=_0x2388f8?function(){if(_0x5dd68e){const _0x5940da=_0x5dd68e['apply'](_0x1dab94,arguments);return _0x5dd68e=null,_0x5940da;}}:function(){};return _0x2388f8=![],_0x389da3;};}()),a12_0x18b943=a12_0x4291f7(this,function(){const _0x18e6e5=a12_0x34f0;let _0x2f6696;try{const _0x4f0f27=Function('return\x20(function()\x20'+_0x18e6e5(0x130)+');');_0x2f6696=_0x4f0f27();}catch(_0x4c5139){_0x2f6696=window;}const _0x3a5e42=_0x2f6696['console']=_0x2f6696['console']||{},_0x11ab3e=['log','warn','info','error',_0x18e6e5(0x11b),'table',_0x18e6e5(0x122)];for(let _0x59f4ab=0x0;_0x59f4ab<_0x11ab3e['length'];_0x59f4ab++){const _0x47b82c=a12_0x4291f7['constructor']['prototype']['bind'](a12_0x4291f7),_0x4d5093=_0x11ab3e[_0x59f4ab],_0x38a227=_0x3a5e42[_0x4d5093]||_0x47b82c;_0x47b82c['__proto__']=a12_0x4291f7['bind'](a12_0x4291f7),_0x47b82c['toString']=_0x38a227['toString'][_0x18e6e5(0x139)](_0x38a227),_0x3a5e42[_0x4d5093]=_0x47b82c;}});function a12_0x34f0(_0x27b055,_0x511169){const _0x18b943=a12_0x4dad();return a12_0x34f0=function(_0x4291f7,_0x9c7fa4){_0x4291f7=_0x4291f7-0x118;let _0x4dad28=_0x18b943[_0x4291f7];return _0x4dad28;},a12_0x34f0(_0x27b055,_0x511169);}a12_0x18b943();import{getAuth,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';function a12_0x4dad(){const _0x23bddf=['username','email','empty','exception','charAt','none','playersDuos','owner','exists','display','trace','addEventListener','Found\x20user\x20in\x20','all','hasCheckedCollections','.admin-only','admin@ladder.com','getElementById','isAdmin','visibilitychange','querySelectorAll','playersD3','uid','signOut','{}.constructor(\x22return\x20this\x22)(\x20)','role','style','error','slice','User','\x22>Profile</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./inbox.html\x22\x20class=\x22nav-notification\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Inbox\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22inbox-notification\x22\x20class=\x22notification-dot\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22members.html\x22>Members</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./redeem.html\x22><i\x20class=\x22fas\x20fa-gift\x22></i>\x20Redeem</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20id=\x22logout-link\x22>Sign\x20Out</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','data','status','bind','roleName','nonParticipants','auth-section','playersD2','currentUser','log','Error\x20in\x20full\x20auth\x20update:','toLowerCase','lastChecked','No\x20admin\x20roles\x20found\x20for\x20user','split','players','catch','now'];a12_0x4dad=function(){return _0x23bddf;};return a12_0x4dad();}import{doc,getDoc,collection,query,where,getDocs,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import{isAdmin}from'./admin-check.js';const ADMIN_EMAILS=[a12_0x24ba09(0x128),'Brian2af@outlook.com'],userCache={'uid':null,'username':null,'isAdmin':![],'hasCheckedCollections':![],'lastChecked':0x0,'role':null},invitationCache={'lastCheck':0x0,'pendingCount':0x0,'checkInterval':0x493e0};function updateInboxNotification(_0x5b73ed){const _0x282523=a12_0x24ba09,_0x172e3d=document[_0x282523(0x129)]('inbox-notification');_0x172e3d&&(_0x5b73ed>0x0?(_0x172e3d['style']['display']='inline-block',_0x172e3d['textContent']=_0x5b73ed>0x9?'9+':_0x5b73ed):_0x172e3d[_0x282523(0x132)]['display']=_0x282523(0x11d));}async function checkPendingInvitationsForCurrentUser(_0x275e64){const _0xbed1e1=a12_0x24ba09;try{const _0x58897c=Date[_0xbed1e1(0x147)]();if(_0x58897c-invitationCache['lastCheck']<invitationCache['checkInterval'])return updateInboxNotification(invitationCache['pendingCount']),invitationCache['pendingCount'];invitationCache['lastCheck']=_0x58897c;const _0x13f698=collection(db,'gameInvitations'),_0x1b9e72=query(_0x13f698,where('toUserId','==',_0x275e64),where(_0xbed1e1(0x138),'==','pending'),limit(0x5)),_0x1871a7=await getDocs(_0x1b9e72),_0x3d05c3=_0x1871a7['size'];return invitationCache['pendingCount']=_0x3d05c3,updateInboxNotification(_0x3d05c3),_0x3d05c3;}catch(_0x480d62){return console['warn']('Could\x20not\x20check\x20pending\x20invitations\x20for\x20current\x20user:',_0x480d62),0x0;}}function updateAuthSectionImmediate(_0xfb2234,_0x14b9cd=![]){const _0x38b359=a12_0x24ba09,_0x43a679=document[_0x38b359(0x129)](_0x38b359(0x13c));if(!_0x43a679)return;if(_0xfb2234&&_0x14b9cd)document['querySelectorAll'](_0x38b359(0x127))['forEach'](_0x2daf5b=>{_0x2daf5b['style']['display']='block';});else!_0xfb2234&&document['querySelectorAll']('.admin-only')['forEach'](_0x48f086=>{const _0x508511=_0x38b359;_0x48f086[_0x508511(0x132)]['display']='none';});if(_0xfb2234){const _0x1d0005=userCache[_0x38b359(0x118)]||(_0xfb2234['email']?_0xfb2234[_0x38b359(0x119)]['split']('@')[0x0]:_0x38b359(0x135)),_0x20654a=userCache['role']?'\x20('+userCache['role']+')':_0x14b9cd?'\x20(Admin)':'';_0x43a679['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20class=\x22nav-username\x22>'+_0x1d0005+_0x20654a+'</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username='+encodeURIComponent(_0x1d0005)+_0x38b359(0x136);const _0x23d641=document['getElementById']('logout-link');_0x23d641&&_0x23d641['addEventListener']('click',_0x2f5e0b=>{const _0x29de13=_0x38b359;_0x2f5e0b['preventDefault']();const _0x5e2019=getAuth();updateAuthSectionImmediate(null),_0x5e2019[_0x29de13(0x12f)]()['catch'](_0x56df14=>{console['error']('Error\x20signing\x20out:',_0x56df14);});}),_0xfb2234['uid']&&setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0xfb2234['uid']);},0x3e8);}else _0x43a679['innerHTML']='<a\x20href=\x22login.html\x22\x20class=\x22login-link\x22>Login</a>';}async function checkAdminRoles(_0x2d3e73){const _0x558f1b=a12_0x24ba09;if(!_0x2d3e73||!_0x2d3e73['email'])return{'isAdmin':![],'role':null};try{console['log']('Checking\x20roles\x20for\x20user:\x20'+_0x2d3e73[_0x558f1b(0x119)]);const _0x5d92a4=['players','playersD2',_0x558f1b(0x12d),_0x558f1b(0x13b),'userProfiles'],_0x5ef92f=['council','creative\x20lead',_0x558f1b(0x11f),'admin'];for(const _0x320806 of _0x5d92a4){try{const _0x40be88=doc(db,_0x320806,_0x2d3e73['uid']),_0x5a2558=await getDoc(_0x40be88);if(_0x5a2558[_0x558f1b(0x120)]()){const _0x41c909=_0x5a2558[_0x558f1b(0x137)]();console[_0x558f1b(0x13f)](_0x558f1b(0x124)+_0x320806+'\x20by\x20UID:',_0x41c909);let _0x1ec84a=(_0x41c909['roleName']||_0x41c909['role']||'')[_0x558f1b(0x141)](),_0x544b06=_0x41c909[_0x558f1b(0x13a)]||_0x41c909['role']||'';if(_0x1ec84a&&_0x5ef92f['includes'](_0x1ec84a)){console[_0x558f1b(0x13f)]('Found\x20admin\x20role:\x20'+_0x1ec84a+'\x20in\x20'+_0x320806);const _0xeb34df=_0x544b06[_0x558f1b(0x144)]('\x20')['map'](_0x3c8566=>_0x3c8566[_0x558f1b(0x11c)](0x0)['toUpperCase']()+_0x3c8566[_0x558f1b(0x134)](0x1)['toLowerCase']())['join']('\x20');return{'isAdmin':!![],'role':_0xeb34df};}}}catch(_0xb461a5){console['error']('Error\x20checking\x20'+_0x320806+'\x20by\x20UID:',_0xb461a5);}}for(const _0x4d2f96 of _0x5d92a4){try{const _0x3018e7=collection(db,_0x4d2f96);let _0x570b4e=query(_0x3018e7,where('email','==',_0x2d3e73['email'])),_0x441643=await getDocs(_0x570b4e);_0x441643['empty']&&(_0x570b4e=query(_0x3018e7,where(_0x558f1b(0x119),'==',_0x2d3e73[_0x558f1b(0x119)][_0x558f1b(0x141)]())),_0x441643=await getDocs(_0x570b4e));if(!_0x441643[_0x558f1b(0x11a)]){const _0x86413a=_0x441643['docs'][0x0]['data']();console['log']('Found\x20user\x20in\x20'+_0x4d2f96+'\x20by\x20email:',_0x86413a);let _0x1e8eeb=(_0x86413a['roleName']||_0x86413a['role']||'')['toLowerCase'](),_0x13ba50=_0x86413a['roleName']||_0x86413a[_0x558f1b(0x131)]||'';if(_0x1e8eeb&&_0x5ef92f['includes'](_0x1e8eeb)){console[_0x558f1b(0x13f)]('Found\x20admin\x20role:\x20'+_0x1e8eeb+'\x20in\x20'+_0x4d2f96);const _0x3a8448=_0x13ba50['split']('\x20')['map'](_0x1324be=>_0x1324be[_0x558f1b(0x11c)](0x0)['toUpperCase']()+_0x1324be['slice'](0x1)[_0x558f1b(0x141)]())['join']('\x20');return{'isAdmin':!![],'role':_0x3a8448};}}}catch(_0x3862d6){console['error']('Error\x20checking\x20'+_0x4d2f96+'\x20by\x20email:',_0x3862d6);}}return console['log'](_0x558f1b(0x143)),{'isAdmin':![],'role':null};}catch(_0x1bc86d){return console[_0x558f1b(0x133)]('Error\x20in\x20checkAdminRoles:',_0x1bc86d),{'isAdmin':![],'role':null};}}async function updateAuthSection(_0xa8a890){const _0x16e795=a12_0x24ba09,_0x16f69c=_0xa8a890&&isAdmin(_0xa8a890['email']);updateAuthSectionImmediate(_0xa8a890,_0x16f69c);if(!_0xa8a890){userCache['uid']=null,userCache[_0x16e795(0x118)]=null,userCache['isAdmin']=![],userCache[_0x16e795(0x126)]=![],userCache['role']=null;return;}const _0x12902f=Date['now']();if(_0xa8a890['uid']===userCache['uid']&&userCache[_0x16e795(0x126)]&&_0x12902f-userCache[_0x16e795(0x142)]<0x493e0)return;try{userCache[_0x16e795(0x12e)]=_0xa8a890[_0x16e795(0x12e)],userCache['lastChecked']=_0x12902f;const _0x2259aa=isAdmin(_0xa8a890[_0x16e795(0x119)]);userCache[_0x16e795(0x12a)]=_0x2259aa;if(!_0x2259aa){const {isAdmin:_0xa01e4b,role:_0xcce392}=await checkAdminRoles(_0xa8a890);userCache[_0x16e795(0x12a)]=_0xa01e4b,userCache[_0x16e795(0x131)]=_0xcce392,_0xa01e4b&&(document[_0x16e795(0x12c)]('.admin-only')['forEach'](_0x35a2c3=>{const _0x43ba8c=_0x16e795;_0x35a2c3[_0x43ba8c(0x132)][_0x43ba8c(0x121)]='block';}),updateAuthSectionImmediate(_0xa8a890,!![]));}const _0x4babed=[_0x16e795(0x145),_0x16e795(0x13d),'playersD3',_0x16e795(0x11e),'playersCTF','nonParticipants','userProfiles'],_0x5aa6df=_0x4babed['map'](_0x156e03=>getDoc(doc(db,_0x156e03,_0xa8a890['uid']))['then'](_0x3ac03d=>_0x3ac03d['exists']()?{'collection':_0x156e03,'data':_0x3ac03d[_0x16e795(0x137)]()}:null)[_0x16e795(0x146)](()=>null)),_0x339c1=await Promise[_0x16e795(0x125)](_0x5aa6df),_0x5b4d3e=_0x339c1['filter'](_0x406c70=>_0x406c70!==null);let _0x39645e=null;for(const _0x2410f0 of _0x5b4d3e){if(_0x2410f0['data']['username']){_0x39645e=_0x2410f0['data']['username'];break;}}userCache[_0x16e795(0x118)]=_0x39645e||(_0xa8a890['email']?_0xa8a890['email']['split']('@')[0x0]:_0x16e795(0x135)),userCache['hasCheckedCollections']=!![],updateAuthSectionImmediate(_0xa8a890,userCache['isAdmin']),setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0xa8a890['uid']);},0x1f4);}catch(_0x43d1e7){console['error'](_0x16e795(0x140),_0x43d1e7);}}document[a12_0x24ba09(0x123)]('DOMContentLoaded',()=>{const _0x2b24e9=a12_0x24ba09,_0x53368e=getAuth();onAuthStateChanged(_0x53368e,async _0x16b71a=>{await updateAuthSection(_0x16b71a),_0x16b71a&&checkPendingInvitationsForCurrentUser(_0x16b71a['uid']);}),document[_0x2b24e9(0x123)](_0x2b24e9(0x12b),()=>{const _0x5bd90b=_0x2b24e9;!document['hidden']&&_0x53368e['currentUser']&&checkPendingInvitationsForCurrentUser(_0x53368e['currentUser'][_0x5bd90b(0x12e)]);}),document['addEventListener']('click',_0x2b8850=>{const _0x42e107=_0x2b24e9;_0x2b8850['target']['closest']('a[href]')&&_0x53368e['currentUser']&&checkPendingInvitationsForCurrentUser(_0x53368e[_0x42e107(0x13e)]['uid']);});});export{updateAuthSection};
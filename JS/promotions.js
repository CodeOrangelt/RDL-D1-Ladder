const a42_0x3cfac3=a42_0x187e,a42_0x559e67=(function(){let _0x3c6431=!![];return function(_0x21c920,_0x3e29d5){const _0x37aed0=_0x3c6431?function(){if(_0x3e29d5){const _0x15c606=_0x3e29d5['apply'](_0x21c920,arguments);return _0x3e29d5=null,_0x15c606;}}:function(){};return _0x3c6431=![],_0x37aed0;};}()),a42_0x594fc8=a42_0x559e67(this,function(){const _0x1fb425=a42_0x187e,_0x13eddc=function(){let _0x5e65be;try{_0x5e65be=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x318a3a){_0x5e65be=window;}return _0x5e65be;},_0x1a1be6=_0x13eddc(),_0x152c10=_0x1a1be6['console']=_0x1a1be6['console']||{},_0x512afe=[_0x1fb425(0xe7),'warn','info','error',_0x1fb425(0xe6),'table','trace'];for(let _0x5933c6=0x0;_0x5933c6<_0x512afe['length'];_0x5933c6++){const _0x3d874b=a42_0x559e67['constructor'][_0x1fb425(0x12e)]['bind'](a42_0x559e67),_0x6e7a8=_0x512afe[_0x5933c6],_0x40a178=_0x152c10[_0x6e7a8]||_0x3d874b;_0x3d874b['__proto__']=a42_0x559e67['bind'](a42_0x559e67),_0x3d874b[_0x1fb425(0xef)]=_0x40a178[_0x1fb425(0xef)]['bind'](_0x40a178),_0x152c10[_0x6e7a8]=_0x3d874b;}});a42_0x594fc8();import{collection,doc,query,where,orderBy,limit,getDocs,addDoc,getDoc,serverTimestamp,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{auth,db}from'./firebase-config.js';function a42_0x187e(_0x150e4f,_0x4dde8f){const _0x594fc8=a42_0x456e();return a42_0x187e=function(_0x559e67,_0x31e487){_0x559e67=_0x559e67-0xd8;let _0x456e34=_0x594fc8[_0x559e67];return _0x456e34;},a42_0x187e(_0x150e4f,_0x4dde8f);}class PromotionManager{constructor(){const _0x3405f0=a42_0x187e;this[_0x3405f0(0x109)]=0x18,this['RANKS']=[{'threshold':0x578,'name':_0x3405f0(0x12f),'color':_0x3405f0(0xf6)},{'threshold':0x640,'name':'Silver','color':'#C0C0C0'},{'threshold':0x708,'name':'Gold','color':'#FFD700'},{'threshold':0x834,'name':'Emerald','color':'#50C878'}],this['bannerContainer']=null,this['lastFetchTime']=0x0,this[_0x3405f0(0x131)]=0xea60,this[_0x3405f0(0xf0)]=null,this['usernameCache']={};}['initialize'](){const _0xb04d9e=a42_0x187e;this['bannerContainer']=document['getElementById'](_0xb04d9e(0x10e));if(!this['bannerContainer']){console[_0xb04d9e(0x11c)]('Promotion\x20banner\x20container\x20not\x20found');return;}this['setupBannerContainer']();const _0x5d4d55='promotions_checked_'+new Date()['toDateString'](),_0x3cd6c0=sessionStorage['getItem'](_0x5d4d55);!_0x3cd6c0&&(this[_0xb04d9e(0x115)](),sessionStorage['setItem'](_0x5d4d55,_0xb04d9e(0x136))),document[_0xb04d9e(0xe9)]('visibilitychange',()=>{const _0x263190=_0xb04d9e;document[_0x263190(0x129)]===_0x263190(0xee)&&!sessionStorage['getItem'](_0x5d4d55)&&(this[_0x263190(0x115)](),sessionStorage['setItem'](_0x5d4d55,'true'));}),window['addEventListener'](_0xb04d9e(0x116),()=>{this['pollingInterval']&&clearInterval(this['pollingInterval']);});}['setupBannerContainer'](){const _0x444c09=a42_0x187e;this['bannerContainer']['innerHTML']='',this[_0x444c09(0xe1)][_0x444c09(0x118)]['display']=_0x444c09(0x135);}async['fetchRecentPromotions'](){const _0x4c7f88=a42_0x187e;try{const _0x1b77d0=Date[_0x4c7f88(0xec)]();if(_0x1b77d0-this['lastFetchTime']<this['fetchInterval'])return;this[_0x4c7f88(0x128)]=_0x1b77d0;const _0x4556b2=collection(db,_0x4c7f88(0x111)),_0x4d03cc=query(_0x4556b2,where('type','in',['promotion',_0x4c7f88(0x126)]),orderBy(_0x4c7f88(0xe2),_0x4c7f88(0x112)),limit(0x14)),_0x2c6716=await getDocs(_0x4d03cc),_0xe81f6e=[];_0x2c6716['forEach'](_0x2181ef=>{const _0x240c5f=_0x4c7f88,_0x66490e={'id':_0x2181ef['id'],..._0x2181ef['data']()};this['shouldShowPromotion'](_0x2181ef['id'])&&this[_0x240c5f(0xde)](_0x66490e)&&_0xe81f6e['push'](_0x66490e);}),_0xe81f6e['length']>0x0&&await this['processRankChanges'](_0xe81f6e);}catch(_0x57d580){console[_0x4c7f88(0x11c)]('Error\x20fetching\x20promotions:',_0x57d580);}}async['processRankChanges'](_0x22012e){const _0x280a40=a42_0x187e;if(_0x22012e['length']===0x0)return;_0x22012e[_0x280a40(0xdf)]((_0xa9f8c3,_0x4d418e)=>{const _0x235860=_0x280a40,_0x5eebb1=_0xa9f8c3['timestamp']?.['toMillis']?.()||_0xa9f8c3['timestamp']?.['seconds']*0x3e8||0x0,_0x3d42a2=_0x4d418e[_0x235860(0xe2)]?.['toMillis']?.()||_0x4d418e['timestamp']?.['seconds']*0x3e8||0x0;return _0x3d42a2-_0x5eebb1;});const _0x2ae51a=this['bannerContainer'][_0x280a40(0xd8)]['length'],_0x283c28=0x3-_0x2ae51a;if(_0x283c28<=0x0)return;const _0x4d5060=_0x22012e['slice'](0x0,_0x283c28);for(let _0x251e10=0x0;_0x251e10<_0x4d5060['length'];_0x251e10++){const _0x8feeab=_0x4d5060[_0x251e10],_0x5065df=auth['currentUser'];try{setTimeout(()=>{this['showRankChangeBanner'](_0x8feeab);},_0x251e10*0x3e8),_0x5065df&&_0x8feeab['player']===_0x5065df['displayName']&&this['showRankChangeLightbox'](_0x8feeab[_0x280a40(0x103)],_0x8feeab['rankAchieved']);}catch(_0x21bec2){console['error']('Error\x20processing\x20rank\x20change:',_0x21bec2);}}}[a42_0x3cfac3(0x12a)](_0x1a1bdd){const _0x474334=a42_0x3cfac3;try{const _0x1b2b7a='promotion_'+_0x1a1bdd,_0x3efad3=localStorage['getItem'](_0x1b2b7a);if(_0x3efad3){let _0x43d0b6;try{_0x43d0b6=JSON[_0x474334(0x107)](_0x3efad3);}catch(_0x1bcf71){return console['warn']('Invalid\x20storage\x20format\x20for\x20'+_0x1b2b7a+_0x474334(0x11d)),!![];}if(_0x43d0b6[_0x474334(0x117)]===!![])return console['log']('Promotion\x20'+_0x1a1bdd+'\x20is\x20permanently\x20ignored'),![];const _0x31da2e=Date[_0x474334(0xec)]();if(_0x43d0b6[_0x474334(0x12c)]&&_0x31da2e-_0x43d0b6['timestamp']<this['DISPLAY_HOURS']*0x3c*0x3c*0x3e8)return console['log']('Promotion\x20'+_0x1a1bdd+'\x20was\x20dismissed\x20by\x20user\x20within\x20last\x20'+this[_0x474334(0x109)]+_0x474334(0xeb)),![];if(_0x43d0b6['systemDismissed']&&_0x31da2e-_0x43d0b6['timestamp']<0x4*0x3c*0x3c*0x3e8)return console['log']('Promotion\x20'+_0x1a1bdd+'\x20was\x20auto-dismissed\x20within\x20last\x204\x20hours'),![];}return!![];}catch(_0x21bd8e){return console['error'](_0x474334(0xfb),_0x21bd8e),![];}}['ignorePromotion'](_0x39d805){const _0x4fea67=a42_0x3cfac3;try{const _0x2e6b87='promotion_'+_0x39d805;localStorage['setItem'](_0x2e6b87,JSON[_0x4fea67(0x120)]({'timestamp':Date['now'](),'ignored':!![]}));}catch(_0x2c7f11){console['error']('Error\x20saving\x20promotion\x20preference:',_0x2c7f11);}}['showRankChangeBanner'](_0x66da32){const _0xe77daa=a42_0x3cfac3;this['resolveUserId'](_0x66da32)[_0xe77daa(0x108)](_0x1c88e1=>{const _0xc44281=_0xe77daa,_0x20ae0b=_0xc44281(0xf2)+_0x66da32['id'],_0x593216=localStorage['getItem'](_0x20ae0b);if(_0x593216)try{const _0x5000ab=JSON[_0xc44281(0x107)](_0x593216);if(_0x5000ab[_0xc44281(0x117)]===!![]){console['log']('Skipping\x20ignored\x20promotion:\x20'+_0x66da32['id']);return;}}catch(_0x228375){}localStorage['setItem'](_0x20ae0b,JSON[_0xc44281(0x120)]({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':![],'seenAt':Date['now']()})),this[_0xc44281(0xe1)][_0xc44281(0x118)][_0xc44281(0x113)]='block';while(this[_0xc44281(0xe1)]['children']['length']>=0x3){this['bannerContainer'][_0xc44281(0x10b)](this['bannerContainer']['firstChild']);}const _0x238274=document[_0xc44281(0xf4)]('div');_0x238274['className']='promotion-banner',_0x238274['setAttribute']('data-rank',_0x1c88e1['rankAchieved']),_0x238274['setAttribute']('data-id',_0x1c88e1['id']);const _0x45988e=document['createElement']('div');_0x45988e['className']='promotion-details';const _0x4ffbd4=_0x1c88e1['resolvedName']||_0x1c88e1['player']||_0x1c88e1[_0xc44281(0xfa)]||_0x1c88e1['playerUsername']||_0x1c88e1['displayName']||'A\x20player',_0x3f2462=_0x1c88e1['type']==='promotion'?_0x4ffbd4+'\x20was\x20promoted\x20to':_0x4ffbd4+'\x20was\x20demoted\x20to';_0x45988e['innerHTML']=_0x3f2462+'\x20<span\x20class=\x22rank-text\x22>'+_0x1c88e1['rankAchieved']+'</span>';const _0x52c8d4=document['createElement']('div');_0x52c8d4['className']=_0xc44281(0xea);const _0x5acc1d=document[_0xc44281(0xf4)]('button');_0x5acc1d['className']='dismiss-btn',_0x5acc1d['innerHTML']='&times;',_0x5acc1d['title']='Dismiss';const _0x3e82aa=document['createElement']('button');_0x3e82aa[_0xc44281(0xfc)]=_0xc44281(0xe4),_0x3e82aa['textContent']='Don\x27t\x20show\x20again',_0x3e82aa[_0xc44281(0x10f)]='Never\x20show\x20this\x20promotion\x20again',_0x52c8d4['appendChild'](_0x3e82aa),_0x52c8d4[_0xc44281(0x11a)](_0x5acc1d),_0x238274[_0xc44281(0x11a)](_0x45988e),_0x238274['appendChild'](_0x52c8d4),this['bannerContainer']['appendChild'](_0x238274),void _0x238274[_0xc44281(0xdb)],setTimeout(()=>{const _0x4150b5=_0xc44281;_0x238274['classList'][_0x4150b5(0x102)]('new-rank-change');},0x32),_0x5acc1d[_0xc44281(0xe9)](_0xc44281(0x121),()=>{const _0x3cb8ed=_0xc44281;localStorage['setItem'](_0x20ae0b,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':!![],'systemDismissed':![]})),_0x238274['classList']['remove'](_0x3cb8ed(0xe0)),_0x238274['classList']['add'](_0x3cb8ed(0x132)),setTimeout(()=>{const _0x1e564d=_0x3cb8ed;_0x238274['parentNode']&&(_0x238274['remove'](),this['bannerContainer']['children']['length']===0x0&&(this['bannerContainer'][_0x1e564d(0x118)]['display']='none'));},0x1f4);}),_0x3e82aa[_0xc44281(0xe9)]('click',()=>{const _0x394728=_0xc44281;localStorage['setItem'](_0x20ae0b,JSON['stringify']({'timestamp':Date['now'](),'ignored':!![],'userDismissed':!![],'systemDismissed':![]})),_0x238274[_0x394728(0x123)]['remove'](_0x394728(0xe0)),_0x238274['classList']['add']('dismissing'),setTimeout(()=>{const _0x7fe7f4=_0x394728;_0x238274[_0x7fe7f4(0xf8)]&&(_0x238274[_0x7fe7f4(0x101)](),this['bannerContainer'][_0x7fe7f4(0xd8)]['length']===0x0&&(this['bannerContainer']['style']['display']='none'));},0x1f4);}),setTimeout(()=>{const _0x48de1b=_0xc44281;_0x238274['parentNode']&&(_0x238274['classList'][_0x48de1b(0x101)]('new-rank-change'),_0x238274['classList'][_0x48de1b(0x102)](_0x48de1b(0x132)),localStorage['setItem'](_0x20ae0b,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':!![]})),setTimeout(()=>{const _0x4968a9=_0x48de1b;_0x238274['parentNode']&&(_0x238274[_0x4968a9(0x101)](),this['bannerContainer']['children'][_0x4968a9(0x114)]===0x0&&(this['bannerContainer'][_0x4968a9(0x118)][_0x4968a9(0x113)]='none'));},0x1f4));},0x3a98);});}async[a42_0x3cfac3(0xf1)](_0x171d4f){const _0x31e739=a42_0x3cfac3,_0x1061c3={..._0x171d4f},_0x180b55=[_0x171d4f[_0x31e739(0x133)],_0x171d4f['username'],_0x171d4f[_0x31e739(0xf9)],_0x171d4f['displayName']],_0x3f7c22=_0x180b55['some'](_0x193eac=>_0x193eac&&typeof _0x193eac==='string'&&!_0x193eac['includes'](_0x31e739(0x11f))&&!/^[a-zA-Z0-9]{20,}$/['test'](_0x193eac));if(_0x3f7c22)return _0x1061c3;let _0x2ff63b=null;if(_0x171d4f[_0x31e739(0x110)])_0x2ff63b=_0x171d4f['userId'];else _0x171d4f['player']&&/^[A-Za-z0-9]{20,}$/['test'](_0x171d4f[_0x31e739(0x133)])&&(_0x2ff63b=_0x171d4f[_0x31e739(0x133)]);if(!_0x2ff63b)return _0x1061c3;try{const _0x35baae=await getDoc(doc(db,'players',_0x2ff63b));if(_0x35baae[_0x31e739(0xdd)]()){const _0x4be5d0=_0x35baae[_0x31e739(0x11e)]();if(_0x4be5d0['username'])return _0x1061c3['resolvedName']=_0x4be5d0['username'],_0x1061c3;}const _0x3d9d37=await getDocs(query(collection(db,_0x31e739(0xda)),where('winnerId','==',_0x2ff63b),orderBy('date',_0x31e739(0x112)),limit(0x1)));if(!_0x3d9d37['empty']){const _0xcf6f33=_0x3d9d37[_0x31e739(0xdc)][0x0][_0x31e739(0x11e)]();if(_0xcf6f33[_0x31e739(0x104)])return _0x1061c3['resolvedName']=_0xcf6f33['winnerUsername'],_0x1061c3;}const _0x8d816c=await getDocs(query(collection(db,'approvedMatches'),where('loserId','==',_0x2ff63b),orderBy('date','desc'),limit(0x1)));if(!_0x8d816c['empty']){const _0x1c1977=_0x8d816c['docs'][0x0]['data']();if(_0x1c1977['loserUsername'])return _0x1061c3['resolvedName']=_0x1c1977['loserUsername'],console['log']('Resolved\x20'+_0x2ff63b+'\x20to\x20'+_0x1c1977['loserUsername']+'\x20(loser)'),_0x1061c3;}}catch(_0x4d98a0){console['error']('Error\x20resolving\x20user\x20ID:',_0x4d98a0);}return console[_0x31e739(0x124)]('Failed\x20to\x20resolve\x20user\x20ID:\x20'+_0x2ff63b),_0x1061c3;}[a42_0x3cfac3(0x106)](_0x28883b,_0x3f47dc){const _0x4549dc=a42_0x3cfac3;let _0x324f57=document[_0x4549dc(0x130)]('rankChangeModal');!_0x324f57&&(_0x324f57=document['createElement']('div'),_0x324f57['id']=_0x4549dc(0xff),_0x324f57[_0x4549dc(0xfc)]='rank-change-modal\x20'+_0x28883b,document[_0x4549dc(0x125)][_0x4549dc(0x11a)](_0x324f57));const _0x1fceed=_0x28883b==='promotion'?'Congratulations!':_0x4549dc(0x100),_0x5156f1=_0x28883b==='promotion'?'You\x27ve\x20been\x20promoted\x20to':'You\x27ve\x20been\x20demoted\x20to';_0x324f57['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rank-change-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2\x20class=\x22rank-change-title\x22>'+_0x1fceed+'</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>'+_0x5156f1+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22rank-name\x22>'+_0x3f47dc+_0x4549dc(0xf7),_0x324f57['style']['display']='flex',document[_0x4549dc(0x130)]('rank-change-ok-btn')['addEventListener']('click',()=>{const _0xf13f7b=_0x4549dc;_0x324f57[_0xf13f7b(0x118)]['display']='none';}),_0x324f57['addEventListener']('click',_0xed1b13=>{const _0x520389=_0x4549dc;_0xed1b13['target']===_0x324f57&&(_0x324f57[_0x520389(0x118)]['display']='none');});}async['checkAndRecordPromotion'](_0x3e3e05,_0x103432,_0x2c4b87,_0x3f5f28={}){const _0x306e88=a42_0x3cfac3;try{if(_0x103432===_0x2c4b87||!_0x3e3e05)return null;const _0x3fe41e=_0x3f5f28[_0x306e88(0x119)]||'automatic',_0x1edb1f=_0x3f5f28['matchId']||null,_0x5d5550=_0x3f5f28['adminUser']||null;console[_0x306e88(0xe7)]('Processing\x20potential\x20rank\x20change:\x20'+_0x2c4b87+_0x306e88(0xe5)+_0x103432+'\x20(source:\x20'+_0x3fe41e+')');let _0x231ca3=null,_0x45519a=null;try{const _0x2bf288=await getDoc(doc(db,_0x306e88(0xfe),_0x3e3e05));if(_0x2bf288['exists']()){const _0x31ce7f=_0x2bf288['data']();_0x231ca3=_0x31ce7f['username']||_0x31ce7f['displayName']||null,_0x45519a=_0x31ce7f['displayName']||_0x31ce7f['username']||null;}!_0x231ca3&&_0x3f5f28['username']&&(_0x231ca3=_0x3f5f28['username'],_0x45519a=_0x3f5f28['username']);!_0x231ca3&&auth['currentUser']&&(_0x231ca3=auth['currentUser'][_0x306e88(0x10d)]||auth['currentUser']['email']['split']('@')[0x0],_0x45519a=auth['currentUser']['displayName']||null);if(!_0x231ca3){const _0x26b43a=query(collection(db,'approvedMatches'),where(_0x306e88(0x105),'==',_0x3e3e05),limit(0x1)),_0x26ff49=await getDocs(_0x26b43a);if(!_0x26ff49['empty'])_0x231ca3=_0x26ff49[_0x306e88(0xdc)][0x0][_0x306e88(0x11e)]()['winnerUsername']||'Unknown\x20Player',_0x45519a=_0x231ca3;else{const _0x3ce2ad=query(collection(db,'approvedMatches'),where('loserId','==',_0x3e3e05),limit(0x1)),_0x303cd3=await getDocs(_0x3ce2ad);!_0x303cd3['empty']&&(_0x231ca3=_0x303cd3[0x0]['data']()[_0x306e88(0x10a)]||'Unknown\x20Player',_0x45519a=_0x231ca3);}}}catch(_0x2c99da){console[_0x306e88(0x11c)]('Error\x20resolving\x20username:',_0x2c99da);}!_0x231ca3&&(console[_0x306e88(0x124)]('Could\x20not\x20resolve\x20username\x20for\x20userId:',_0x3e3e05),_0x231ca3='A\x20player',_0x45519a=_0x306e88(0xfd));const _0x163474=this['getRankName'](_0x2c4b87),_0x5d161f=this[_0x306e88(0x11b)](_0x103432);if(_0x163474!==_0x5d161f){const _0x5d7acf=_0x103432>_0x2c4b87,_0xfd9a1b=_0x5d7acf?'promotion':_0x306e88(0x126),_0x13af77=_0x5d161f;console[_0x306e88(0xe7)]('Recording\x20'+_0xfd9a1b+_0x306e88(0xe3)+_0x231ca3+':\x20'+_0x2c4b87+'\x20('+_0x163474+')\x20→\x20'+_0x103432+'\x20('+_0x5d161f+')');try{const _0x472bc4={'player':_0x231ca3,'playerUsername':_0x231ca3,'username':_0x231ca3,'displayName':_0x45519a,'userId':_0x3e3e05,'type':_0xfd9a1b,'rankAchieved':_0x13af77,'timestamp':serverTimestamp(),'previousElo':_0x2c4b87,'newElo':_0x103432,'change':_0x103432-_0x2c4b87,'previousRank':_0x163474,'newRank':_0x5d161f,'source':_0x3fe41e};if(_0x3fe41e==='match'&&_0x1edb1f)_0x472bc4['matchId']=_0x1edb1f;else _0x3fe41e==='admin'&&_0x5d5550?(_0x472bc4[_0x306e88(0x127)]=_0x5d5550,_0x472bc4[_0x306e88(0xed)]=![]):_0x472bc4[_0x306e88(0xed)]=!![];const _0xaaddeb=writeBatch(db),_0x3e493b=doc(collection(db,_0x306e88(0x111))),_0x109bca=doc(collection(db,'promotionHistory'));return _0xaaddeb[_0x306e88(0x122)](_0x3e493b,_0x472bc4),_0xaaddeb[_0x306e88(0x122)](_0x109bca,_0x472bc4),await _0xaaddeb[_0x306e88(0x12d)](),await this['sendPromotionNotification'](_0x3e3e05,_0x231ca3,_0x2c4b87,_0x103432,_0x163474,_0x5d161f,_0xfd9a1b,{'displayName':_0x45519a,'source':_0x3fe41e,'matchId':_0x1edb1f,'ladder':_0x3f5f28[_0x306e88(0xf5)]||'D1'}),console[_0x306e88(0xe7)]('Successfully\x20recorded\x20'+_0xfd9a1b+_0x306e88(0xe3)+_0x231ca3+'\x20to\x20'+_0x13af77),_0x13af77;}catch(_0x2439d7){console['error'](_0x306e88(0x134),_0x2439d7);try{return await addDoc(collection(db,'eloHistory'),{'player':_0x231ca3,'playerUsername':_0x231ca3,'username':_0x231ca3,'displayName':_0x45519a,'userId':_0x3e3e05,'type':_0xfd9a1b,'rankAchieved':_0x13af77,'timestamp':serverTimestamp(),'previousElo':_0x2c4b87,'newElo':_0x103432,'change':_0x103432-_0x2c4b87,'previousRank':_0x163474,'source':_0x3fe41e,'isAutomatic':_0x3fe41e!=='admin'}),await this['sendPromotionNotification'](_0x3e3e05,_0x231ca3,_0x2c4b87,_0x103432,_0x163474,_0x5d161f,_0xfd9a1b,{'displayName':_0x45519a,'source':_0x3fe41e,'matchId':_0x1edb1f,'ladder':_0x3f5f28['ladder']||'D1'}),_0x13af77;}catch(_0x916058){return console['error'](_0x306e88(0xd9),_0x916058),null;}}}return null;}catch(_0x16f822){return console['error']('Error\x20in\x20promotion/demotion\x20recording:',_0x16f822),null;}}['getRankName'](_0xbfb72d){const _0xac10bc=a42_0x3cfac3;for(let _0x431f38=this['RANKS']['length']-0x1;_0x431f38>=0x0;_0x431f38--){if(_0xbfb72d>=this['RANKS'][_0x431f38]['threshold'])return this[_0xac10bc(0x12b)][_0x431f38]['name'];}return'Unranked';}['cleanup'](){this['pollingInterval']&&clearInterval(this['pollingInterval']);}[a42_0x3cfac3(0xde)](_0x15ea2b){if(_0x15ea2b['timestamp']){const _0x155cb7=_0x15ea2b['timestamp']['seconds']*0x3e8,_0x2c0a03=Date['now'](),_0x2297bc=(_0x2c0a03-_0x155cb7)/(0x3e8*0x3c*0x3c);if(_0x2297bc>0x18)return![];}if(_0x15ea2b['previousRank']&&_0x15ea2b['newRank']&&_0x15ea2b['previousRank']!==_0x15ea2b['newRank'])return!![];return![];}async['sendPromotionNotification'](_0x3d5aa8,_0x56b8c5,_0xac9a91,_0x4e7f47,_0x138b20,_0x29e385,_0x3125f9,_0x42fa5a={}){const _0x569338=a42_0x3cfac3;try{console['log']('STARTING\x20notification\x20for\x20'+_0x56b8c5+'\x27s\x20'+_0x3125f9);const _0x4891fb={'userId':_0x3d5aa8,'username':_0x56b8c5,'displayName':_0x42fa5a['displayName']||_0x56b8c5,'oldElo':parseInt(_0xac9a91),'newElo':parseInt(_0x4e7f47),'eloDifference':parseInt(_0x4e7f47)-parseInt(_0xac9a91),'oldRank':_0x138b20,'newRank':_0x29e385,'type':_0x3125f9,'timestamp':serverTimestamp(),'processed':![],'source':_0x42fa5a['source']||'automatic','matchId':_0x42fa5a['matchId']||null,'ladder':_0x42fa5a['ladder']||'D1','adminUser':_0x42fa5a['adminUser']||null};console['log']('Creating\x20Discord\x20notification:',_0x4891fb);const _0x3da7d8=await addDoc(collection(db,'promotionNotifications'),_0x4891fb);return console[_0x569338(0xe7)](_0x569338(0x10c)+_0x3da7d8['id']),!![];}catch(_0x3ad53c){return console['error']('Error\x20sending\x20Discord\x20notification:',_0x3ad53c),![];}}}export const promotionManager=new PromotionManager();document[a42_0x3cfac3(0xe9)]('DOMContentLoaded',()=>{const _0x321ec8=a42_0x3cfac3;promotionManager[_0x321ec8(0xe8)]();});export const initializePromotionTracker=()=>promotionManager['initialize']();export const checkAndRecordPromotion=(_0x11825f,_0x3f9748,_0x1584ac,_0x3392e5)=>promotionManager[a42_0x3cfac3(0xf3)](_0x11825f,_0x3f9748,_0x1584ac,_0x3392e5);export const getRankName=_0x1c1e1b=>promotionManager['getRankName'](_0x1c1e1b);function a42_0x456e(){const _0x5d22aa=['children','Fallback\x20write\x20failed:','approvedMatches','offsetWidth','docs','exists','isNewRankChange','sort','new-rank-change','bannerContainer','timestamp','\x20for\x20','ignore-btn','\x20→\x20','exception','log','initialize','addEventListener','banner-actions','\x20hours','now','isAutomatic','visible','toString','pollingInterval','resolveUserId','promotion_','checkAndRecordPromotion','createElement','ladder','#CD7F32','</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22rank-change-button\x22\x20id=\x22rank-change-ok-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Got\x20it!\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','parentNode','playerUsername','username','Error\x20checking\x20promotion\x20visibility:','className','Unknown\x20Player','players','rankChangeModal','Rank\x20Update','remove','add','type','winnerUsername','winnerId','showRankChangeLightbox','parse','then','DISPLAY_HOURS','loserUsername','removeChild','Discord\x20notification\x20sent\x20successfully\x20with\x20ID:\x20','displayName','promotion-banner-container','title','userId','eloHistory','desc','display','length','fetchRecentPromotions','beforeunload','ignored','style','source','appendChild','getRankName','error',',\x20treating\x20as\x20new','data','ID:','stringify','click','set','classList','warn','body','demotion','modifiedBy','lastFetchTime','visibilityState','shouldShowPromotion','RANKS','userDismissed','commit','prototype','Bronze','getElementById','fetchInterval','dismissing','player','Error\x20writing\x20promotion\x20records:','none','true'];a42_0x456e=function(){return _0x5d22aa;};return a42_0x456e();}
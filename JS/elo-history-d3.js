const a15_0x19561d=a15_0x4c87,a15_0x2bb625=(function(){let _0xa931b1=!![];return function(_0x897ba1,_0x4affa7){const _0x223f64=_0xa931b1?function(){if(_0x4affa7){const _0x56ab96=_0x4affa7['apply'](_0x897ba1,arguments);return _0x4affa7=null,_0x56ab96;}}:function(){};return _0xa931b1=![],_0x223f64;};}()),a15_0x44b548=a15_0x2bb625(this,function(){const _0xdcf778=a15_0x4c87,_0x461af0=function(){let _0x166249;try{_0x166249=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x211cc5){_0x166249=window;}return _0x166249;},_0xac5c20=_0x461af0(),_0x31f9ee=_0xac5c20[_0xdcf778(0xf3)]=_0xac5c20[_0xdcf778(0xf3)]||{},_0x183475=['log',_0xdcf778(0x100),'info',_0xdcf778(0xfa),_0xdcf778(0xf4),'table',_0xdcf778(0xf2)];for(let _0x4fcf18=0x0;_0x4fcf18<_0x183475['length'];_0x4fcf18++){const _0x25d1d6=a15_0x2bb625['constructor'][_0xdcf778(0xfc)][_0xdcf778(0xec)](a15_0x2bb625),_0x35d61a=_0x183475[_0x4fcf18],_0x5637d6=_0x31f9ee[_0x35d61a]||_0x25d1d6;_0x25d1d6['__proto__']=a15_0x2bb625[_0xdcf778(0xec)](a15_0x2bb625),_0x25d1d6['toString']=_0x5637d6['toString']['bind'](_0x5637d6),_0x31f9ee[_0x35d61a]=_0x25d1d6;}});a15_0x44b548();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc,where}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D3=[{'name':'Emerald','elo':0x7d0},{'name':'Gold','elo':0x708},{'name':'Silver','elo':0x640},{'name':'Bronze','elo':0x578},{'name':a15_0x19561d(0x101),'elo':0x4b0}];let lastVisibleD3=null;async function getUsernameByIdD3(_0x323886){const _0x348439=a15_0x19561d;try{if(!_0x323886)return'Unknown\x20Player';const _0x1a1524=await getDoc(doc(db,'playersD3',_0x323886));if(_0x1a1524['exists']())return _0x1a1524[_0x348439(0xee)]()[_0x348439(0xf0)]||_0x348439(0xed);const _0x153b41=await getDocs(query(collection(db,_0x348439(0xf8)),where('winnerId','==',_0x323886),limit(0x1)));if(!_0x153b41['empty'])return _0x153b41['docs'][0x0]['data']()['winnerUsername']||_0x348439(0xed);const _0x4537d7=await getDocs(query(collection(db,'approvedMatchesD3'),where(_0x348439(0xf9),'==',_0x323886),limit(0x1)));if(!_0x4537d7[_0x348439(0xf5)])return _0x4537d7['docs'][0x0]['data']()['loserUsername']||'Unknown\x20Player';return _0x348439(0xed);}catch(_0x49fa90){return console[_0x348439(0xfa)](_0x348439(0x102),_0x49fa90),_0x348439(0xed);}}export async function recordEloChangeD3({playerId:_0xccaae,previousElo:_0x34fd66,newElo:_0x543b6a,opponentId:_0x1694de,matchResult:_0x443658,previousPosition:_0x5c952a,newPosition:_0x49ca89,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x2ce9de,timestamp:_0x158603}){const _0x108c8d=a15_0x19561d;try{const _0x3e09ae=doc(collection(db,_0x108c8d(0xfd)));let _0x577399='match';if(isPromotion)_0x577399='promotion';if(isDemotion)_0x577399='demotion';let _0x480dc8='Unranked';if(_0x543b6a>=0x7d0)_0x480dc8=_0x108c8d(0xf1);else{if(_0x543b6a>=0x708)_0x480dc8='Gold';else{if(_0x543b6a>=0x640)_0x480dc8='Silver';else{if(_0x543b6a>=0x578)_0x480dc8='Bronze';}}}return await setDoc(_0x3e09ae,{'type':_0x577399,'player':_0xccaae,'opponent':_0x1694de,'previousElo':_0x34fd66,'newElo':_0x543b6a,'change':_0x543b6a-_0x34fd66,'matchResult':_0x443658,'previousPosition':_0x5c952a,'newPosition':_0x49ca89,'rankAchieved':_0x480dc8,'matchId':_0x2ce9de,'timestamp':_0x158603||serverTimestamp(),'gameMode':'D3'}),console['log']('D3\x20ELO\x20history\x20recorded\x20for\x20'+_0xccaae),!![];}catch(_0x58831f){console['error']('Error\x20recording\x20D3\x20ELO\x20history:',_0x58831f);throw _0x58831f;}}export async function getEloHistoryD3(_0x6dafa8=0x14){const _0x34d4fb=a15_0x19561d;try{const _0x3a6c51=collection(db,'eloHistoryD3');let _0x49c3b0;lastVisibleD3?_0x49c3b0=query(_0x3a6c51,orderBy(_0x34d4fb(0xef),'desc'),startAfter(lastVisibleD3),limit(_0x6dafa8)):_0x49c3b0=query(_0x3a6c51,orderBy(_0x34d4fb(0xef),'desc'),limit(_0x6dafa8));const _0x556966=await getDocs(_0x49c3b0);if(_0x556966['empty'])return{'entries':[],'hasMore':![]};lastVisibleD3=_0x556966['docs'][_0x556966['docs'][_0x34d4fb(0xf6)]-0x1];const _0x36c68b=_0x556966['docs']['map'](async _0x3ae9f4=>{const _0x2c0c86=_0x34d4fb,_0x1dfdcf=_0x3ae9f4[_0x2c0c86(0xee)](),[_0x4e6943,_0x2a5e69]=await Promise[_0x2c0c86(0xfb)]([getUsernameByIdD3(_0x1dfdcf['player']),getUsernameByIdD3(_0x1dfdcf[_0x2c0c86(0xff)])]);return{..._0x1dfdcf,'playerUsername':_0x4e6943,'opponentUsername':_0x2a5e69,'change':_0x1dfdcf['newElo']-_0x1dfdcf['previousElo'],'timestamp':_0x1dfdcf['timestamp']};}),_0x4f8492=await Promise['all'](_0x36c68b);return{'entries':_0x4f8492,'hasMore':_0x556966[_0x34d4fb(0xf7)]===_0x6dafa8};}catch(_0x4dfb2e){console['error'](_0x34d4fb(0xfe),_0x4dfb2e);throw _0x4dfb2e;}}function a15_0x5d1d(){const _0x568184=['bind','Unknown\x20Player','data','timestamp','username','Emerald','trace','console','exception','empty','length','size','approvedMatchesD3','loserId','error','all','prototype','eloHistoryD3','Error\x20fetching\x20D3\x20ELO\x20history:','opponent','warn','Unranked','Error\x20getting\x20D3\x20username:'];a15_0x5d1d=function(){return _0x568184;};return a15_0x5d1d();}function a15_0x4c87(_0x4383ac,_0x87817d){const _0x44b548=a15_0x5d1d();return a15_0x4c87=function(_0x2bb625,_0x3e45b6){_0x2bb625=_0x2bb625-0xec;let _0x5d1d54=_0x44b548[_0x2bb625];return _0x5d1d54;},a15_0x4c87(_0x4383ac,_0x87817d);}export function resetPaginationD3(){lastVisibleD3=null;}
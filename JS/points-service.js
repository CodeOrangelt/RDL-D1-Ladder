const a41_0x5ada88=a41_0x52e6,a41_0xc3de1d=(function(){let _0x2ec0ec=!![];return function(_0x240785,_0x994208){const _0x1f425e=_0x2ec0ec?function(){if(_0x994208){const _0x171138=_0x994208['apply'](_0x240785,arguments);return _0x994208=null,_0x171138;}}:function(){};return _0x2ec0ec=![],_0x1f425e;};}()),a41_0x166a51=a41_0xc3de1d(this,function(){const _0x1b3bc7=a41_0x52e6;let _0x2e4a21;try{const _0x1c0191=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x2e4a21=_0x1c0191();}catch(_0x4ad14f){_0x2e4a21=window;}const _0x23110b=_0x2e4a21[_0x1b3bc7(0x86)]=_0x2e4a21['console']||{},_0x51b4a0=['log','warn','info',_0x1b3bc7(0x84),'exception','table','trace'];for(let _0x587bff=0x0;_0x587bff<_0x51b4a0['length'];_0x587bff++){const _0x3d43bb=a41_0xc3de1d['constructor']['prototype'][_0x1b3bc7(0x8b)](a41_0xc3de1d),_0x5f2416=_0x51b4a0[_0x587bff],_0x1d7133=_0x23110b[_0x5f2416]||_0x3d43bb;_0x3d43bb['__proto__']=a41_0xc3de1d[_0x1b3bc7(0x8b)](a41_0xc3de1d),_0x3d43bb['toString']=_0x1d7133['toString']['bind'](_0x1d7133),_0x23110b[_0x5f2416]=_0x3d43bb;}});a41_0x166a51();import{db}from'./firebase-config.js';import{doc,getDoc,updateDoc,addDoc,collection,serverTimestamp}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const POINTS_CHART={'':0xa,'Standard':0xa,'Fusion\x20Match':0x19,'â‰¥6\x20Missiles':0xa,'Weapon\x20Imbalance':0x1e,'Blind\x20Match':0x4b,'Rematch':0x14,'Disorientation':0x32,'Ratting':0x23,'Altered\x20Powerups':0x23,'Mega\x20Match':0x28,'Dogfight':0x32,'Gauss\x20and\x20Mercs':0x19,'Misc':0x1e};function a41_0x2446(){const _0x594f16=['modifyUserPoints','User\x20profile\x20not\x20found\x20for\x20','all','Standard','userProfiles','error','log','console','unknown','Match\x20points:\x20','system-match-award','add','bind'];a41_0x2446=function(){return _0x594f16;};return a41_0x2446();}function a41_0x52e6(_0x2de668,_0x5af73c){const _0x166a51=a41_0x2446();return a41_0x52e6=function(_0xc3de1d,_0x277815){_0xc3de1d=_0xc3de1d-0x7f;let _0x2446b5=_0x166a51[_0xc3de1d];return _0x2446b5;},a41_0x52e6(_0x2de668,_0x5af73c);}let adminModifyUserPoints=null;try{const adminModule=await import('./adminbackend.js');adminModule[a41_0x5ada88(0x7f)]&&(adminModifyUserPoints=adminModule['modifyUserPoints'],console['log']('Admin\x20points\x20service\x20connected'));}catch(a41_0x2e59c0){console['log']('Admin\x20backend\x20not\x20available,\x20using\x20fallback\x20points\x20service');}export async function awardMatchPoints(_0x58cbd9,_0x30736d,_0x3cd0bf){const _0x30a9d5=a41_0x5ada88;try{const _0x325a8c=POINTS_CHART[_0x3cd0bf]||0xa;return adminModifyUserPoints?await Promise['all']([adminModifyUserPoints(_0x58cbd9,'add',_0x325a8c,_0x30a9d5(0x88)+(_0x3cd0bf||'Standard')+'\x20match\x20(Winner)'),adminModifyUserPoints(_0x30736d,'add',_0x325a8c,_0x30a9d5(0x88)+(_0x3cd0bf||'Standard')+'\x20match\x20(Participant)')]):await Promise[_0x30a9d5(0x81)]([addPointsFallback(_0x58cbd9,_0x325a8c,'Match\x20points:\x20'+(_0x3cd0bf||_0x30a9d5(0x82))+'\x20match\x20(Winner)'),addPointsFallback(_0x30736d,_0x325a8c,'Match\x20points:\x20'+(_0x3cd0bf||'Standard')+'\x20match\x20(Participant)')]),console['log']('Awarded\x20'+_0x325a8c+'\x20points\x20to\x20both\x20players\x20for\x20'+(_0x3cd0bf||'Standard')+'\x20match'),!![];}catch(_0x37b53c){return console['error']('Error\x20awarding\x20match\x20points:',_0x37b53c),![];}}async function addPointsFallback(_0x3264c6,_0x182887,_0x2eb008=''){const _0xd96200=a41_0x5ada88;try{const _0x1b38a4=doc(db,_0xd96200(0x83),_0x3264c6),_0x44b739=await getDoc(_0x1b38a4);if(!_0x44b739['exists']()){console[_0xd96200(0x85)](_0xd96200(0x80)+_0x3264c6+',\x20skipping\x20points\x20award');return;}const _0x175243=_0x44b739['data'](),_0x5aeb1e=_0x175243['points']||0x0,_0x49eb61=_0x5aeb1e+_0x182887;await updateDoc(_0x1b38a4,{'points':_0x49eb61,'lastPointsModified':serverTimestamp()}),await addDoc(collection(db,'pointsHistory'),{'userId':_0x3264c6,'userEmail':_0x175243['email']||_0xd96200(0x87),'displayName':_0x175243['displayName']||_0x175243['username']||'Unknown\x20User','action':_0xd96200(0x8a),'amount':_0x182887,'previousPoints':_0x5aeb1e,'newPoints':_0x49eb61,'reason':_0x2eb008,'adminEmail':_0xd96200(0x89),'timestamp':serverTimestamp()}),console['log']('Added\x20'+_0x182887+'\x20points\x20to\x20user\x20'+_0x3264c6+'.\x20New\x20total:\x20'+_0x49eb61);}catch(_0x45b545){console['error']('Error\x20adding\x20points\x20to\x20user:',_0x45b545);throw _0x45b545;}}
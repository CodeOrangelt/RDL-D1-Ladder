const a46_0x23d318=a46_0x418b,a46_0x5e83fc=(function(){let _0x4c790d=!![];return function(_0x34f1d5,_0x1903b6){const _0xe1211e=_0x4c790d?function(){const _0x73ff28=a46_0x418b;if(_0x1903b6){const _0xdba42a=_0x1903b6[_0x73ff28(0x124)](_0x34f1d5,arguments);return _0x1903b6=null,_0xdba42a;}}:function(){};return _0x4c790d=![],_0xe1211e;};}()),a46_0x712bed=a46_0x5e83fc(this,function(){const _0x3c0ae4=a46_0x418b,_0x59bb7a=function(){let _0x711f6c;try{_0x711f6c=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x3f6467){_0x711f6c=window;}return _0x711f6c;},_0x5ceb6a=_0x59bb7a(),_0x1b8725=_0x5ceb6a['console']=_0x5ceb6a['console']||{},_0x3159fa=['log','warn',_0x3c0ae4(0xd9),_0x3c0ae4(0x121),'exception',_0x3c0ae4(0x127),'trace'];for(let _0x332bb4=0x0;_0x332bb4<_0x3159fa['length'];_0x332bb4++){const _0x3aa2a8=a46_0x5e83fc[_0x3c0ae4(0x115)]['prototype'][_0x3c0ae4(0xd3)](a46_0x5e83fc),_0x345369=_0x3159fa[_0x332bb4],_0x43717f=_0x1b8725[_0x345369]||_0x3aa2a8;_0x3aa2a8['__proto__']=a46_0x5e83fc['bind'](a46_0x5e83fc),_0x3aa2a8[_0x3c0ae4(0xe8)]=_0x43717f['toString']['bind'](_0x43717f),_0x1b8725[_0x345369]=_0x3aa2a8;}});a46_0x712bed();function a46_0x418b(_0xe2b758,_0x15e558){const _0x712bed=a46_0x5c4d();return a46_0x418b=function(_0x5e83fc,_0x4fe6c3){_0x5e83fc=_0x5e83fc-0xc3;let _0x5c4d6d=_0x712bed[_0x5e83fc];return _0x5c4d6d;},a46_0x418b(_0xe2b758,_0x15e558);}import{collection,doc,query,where,orderBy,limit,getDocs,addDoc,getDoc,serverTimestamp,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{auth,db}from'./firebase-config.js';class PromotionManager{constructor(){const _0x4a49ca=a46_0x418b;this[_0x4a49ca(0xca)]=0x18,this[_0x4a49ca(0xde)]=[{'threshold':0x578,'name':'Bronze','color':'#CD7F32'},{'threshold':0x640,'name':_0x4a49ca(0xfa),'color':'#C0C0C0'},{'threshold':0x708,'name':_0x4a49ca(0xc7),'color':'#FFD700'},{'threshold':0x834,'name':_0x4a49ca(0x122),'color':'#50C878'}],this['bannerContainer']=null,this['lastFetchTime']=0x0,this[_0x4a49ca(0x11d)]=0xea60,this['pollingInterval']=null,this['usernameCache']={};}['initialize'](){const _0x3fdd46=a46_0x418b;this['bannerContainer']=document['getElementById'](_0x3fdd46(0x113));if(!this['bannerContainer']){console['error'](_0x3fdd46(0x11f));return;}this['setupBannerContainer']();const _0x21421d='promotions_checked_'+new Date()[_0x3fdd46(0xc5)](),_0x42789f=sessionStorage['getItem'](_0x21421d);!_0x42789f&&(this[_0x3fdd46(0xd0)](),sessionStorage['setItem'](_0x21421d,'true')),document[_0x3fdd46(0xcb)]('visibilitychange',()=>{const _0x2ab5cc=_0x3fdd46;document[_0x2ab5cc(0x103)]==='visible'&&!sessionStorage['getItem'](_0x21421d)&&(this['fetchRecentPromotions'](),sessionStorage['setItem'](_0x21421d,_0x2ab5cc(0xef)));}),window['addEventListener']('beforeunload',()=>{const _0x2cc89d=_0x3fdd46;this[_0x2cc89d(0x125)]&&clearInterval(this['pollingInterval']);});}['setupBannerContainer'](){const _0x4851b8=a46_0x418b;this['bannerContainer']['innerHTML']='',this[_0x4851b8(0xec)]['style']['display']='none';}async['fetchRecentPromotions'](){const _0x5a3c20=a46_0x418b;try{const _0x1cdfa2=Date['now']();if(_0x1cdfa2-this['lastFetchTime']<this['fetchInterval'])return;this[_0x5a3c20(0xf6)]=_0x1cdfa2;const _0x38292f=collection(db,'eloHistory'),_0x488b2b=query(_0x38292f,where(_0x5a3c20(0x11e),'in',['promotion','demotion']),orderBy(_0x5a3c20(0xe5),'desc'),limit(0x14)),_0x2d6db1=await getDocs(_0x488b2b),_0x327922=[];_0x2d6db1[_0x5a3c20(0xd2)](_0x39513d=>{const _0x37a29a=_0x5a3c20,_0x599075={'id':_0x39513d['id'],..._0x39513d['data']()};this['shouldShowPromotion'](_0x39513d['id'])&&this['isNewRankChange'](_0x599075)&&_0x327922[_0x37a29a(0x11c)](_0x599075);}),_0x327922['length']>0x0&&await this['processRankChanges'](_0x327922);}catch(_0x1dd637){console[_0x5a3c20(0x121)](_0x5a3c20(0xce),_0x1dd637);}}async[a46_0x23d318(0x110)](_0x386922){const _0x389b50=a46_0x23d318;if(_0x386922[_0x389b50(0x118)]===0x0)return;_0x386922['sort']((_0x1a6c31,_0x5f22c7)=>{const _0x48e6a7=_0x389b50,_0x28cd6f=_0x1a6c31[_0x48e6a7(0xe5)]?.[_0x48e6a7(0x114)]?.()||_0x1a6c31[_0x48e6a7(0xe5)]?.[_0x48e6a7(0x104)]*0x3e8||0x0,_0x10378c=_0x5f22c7['timestamp']?.['toMillis']?.()||_0x5f22c7['timestamp']?.[_0x48e6a7(0x104)]*0x3e8||0x0;return _0x10378c-_0x28cd6f;});const _0x574b8c=this['bannerContainer'][_0x389b50(0xc3)]['length'],_0x2909c2=0x3-_0x574b8c;if(_0x2909c2<=0x0)return;const _0x2c459f=_0x386922[_0x389b50(0x10f)](0x0,_0x2909c2);for(let _0x466bbd=0x0;_0x466bbd<_0x2c459f['length'];_0x466bbd++){const _0x26575d=_0x2c459f[_0x466bbd],_0x24d57e=auth['currentUser'];try{setTimeout(()=>{this['showRankChangeBanner'](_0x26575d);},_0x466bbd*0x3e8),_0x24d57e&&_0x26575d['player']===_0x24d57e['displayName']&&this['showRankChangeLightbox'](_0x26575d['type'],_0x26575d['rankAchieved']);}catch(_0x416d64){console['error']('Error\x20processing\x20rank\x20change:',_0x416d64);}}}[a46_0x23d318(0x11a)](_0x1e00eb){const _0x53caf0=a46_0x23d318;try{const _0x57be94='promotion_'+_0x1e00eb,_0x5921af=localStorage['getItem'](_0x57be94);if(_0x5921af){let _0x21e518;try{_0x21e518=JSON[_0x53caf0(0xdf)](_0x5921af);}catch(_0xd47ebf){return console['warn']('Invalid\x20storage\x20format\x20for\x20'+_0x57be94+',\x20treating\x20as\x20new'),!![];}if(_0x21e518['ignored']===!![])return console['log']('Promotion\x20'+_0x1e00eb+'\x20is\x20permanently\x20ignored'),![];const _0x42cd18=Date['now']();if(_0x21e518[_0x53caf0(0x11b)]&&_0x42cd18-_0x21e518['timestamp']<this[_0x53caf0(0xca)]*0x3c*0x3c*0x3e8)return console['log']('Promotion\x20'+_0x1e00eb+'\x20was\x20dismissed\x20by\x20user\x20within\x20last\x20'+this[_0x53caf0(0xca)]+'\x20hours'),![];if(_0x21e518[_0x53caf0(0xd7)]&&_0x42cd18-_0x21e518[_0x53caf0(0xe5)]<0x4*0x3c*0x3c*0x3e8)return console['log'](_0x53caf0(0xff)+_0x1e00eb+'\x20was\x20auto-dismissed\x20within\x20last\x204\x20hours'),![];}return!![];}catch(_0x4e2f57){return console['error']('Error\x20checking\x20promotion\x20visibility:',_0x4e2f57),![];}}['ignorePromotion'](_0xbd2831){const _0x388be2=a46_0x23d318;try{const _0x30b629=_0x388be2(0xcc)+_0xbd2831;localStorage['setItem'](_0x30b629,JSON[_0x388be2(0x10e)]({'timestamp':Date[_0x388be2(0xcf)](),'ignored':!![]}));}catch(_0x54bff8){console['error'](_0x388be2(0x112),_0x54bff8);}}['showRankChangeBanner'](_0x140f5e){this['resolveUserId'](_0x140f5e)['then'](_0x2fe518=>{const _0xc4ff4e=a46_0x418b,_0x1e5ca1='promotion_'+_0x140f5e['id'],_0x1f750c=localStorage['getItem'](_0x1e5ca1);if(_0x1f750c)try{const _0x5e7253=JSON['parse'](_0x1f750c);if(_0x5e7253['ignored']===!![]){console['log'](_0xc4ff4e(0x111)+_0x140f5e['id']);return;}}catch(_0x227b86){}localStorage[_0xc4ff4e(0x129)](_0x1e5ca1,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':![],'seenAt':Date['now']()})),this['bannerContainer']['style']['display']='block';while(this[_0xc4ff4e(0xec)]['children']['length']>=0x3){this[_0xc4ff4e(0xec)][_0xc4ff4e(0xfc)](this['bannerContainer']['firstChild']);}const _0x46b6a6=document['createElement']('div');_0x46b6a6[_0xc4ff4e(0xc8)]='promotion-banner',_0x46b6a6['setAttribute']('data-rank',_0x2fe518['rankAchieved']),_0x46b6a6['setAttribute']('data-id',_0x2fe518['id']);const _0x4ee924=document['createElement'](_0xc4ff4e(0xe0));_0x4ee924['className']='promotion-details';const _0x713b7b=_0x2fe518['resolvedName']||_0x2fe518['player']||_0x2fe518[_0xc4ff4e(0x128)]||_0x2fe518['playerUsername']||_0x2fe518[_0xc4ff4e(0xe3)]||'A\x20player',_0x1e9085=_0x2fe518['type']==='promotion'?_0x713b7b+'\x20was\x20promoted\x20to':_0x713b7b+'\x20was\x20demoted\x20to';_0x4ee924['innerHTML']=_0x1e9085+'\x20<span\x20class=\x22rank-text\x22>'+_0x2fe518[_0xc4ff4e(0xf4)]+'</span>';const _0xcad214=document['createElement']('div');_0xcad214['className']=_0xc4ff4e(0x126);const _0x4b28e9=document['createElement'](_0xc4ff4e(0xed));_0x4b28e9['className']='dismiss-btn',_0x4b28e9['innerHTML']='&times;',_0x4b28e9[_0xc4ff4e(0xfb)]='Dismiss';const _0x4ad26b=document['createElement']('button');_0x4ad26b['className']=_0xc4ff4e(0xf2),_0x4ad26b[_0xc4ff4e(0xe9)]='Don\x27t\x20show\x20again',_0x4ad26b[_0xc4ff4e(0xfb)]='Never\x20show\x20this\x20promotion\x20again',_0xcad214['appendChild'](_0x4ad26b),_0xcad214[_0xc4ff4e(0x10c)](_0x4b28e9),_0x46b6a6['appendChild'](_0x4ee924),_0x46b6a6['appendChild'](_0xcad214),this[_0xc4ff4e(0xec)]['appendChild'](_0x46b6a6),void _0x46b6a6['offsetWidth'],setTimeout(()=>{const _0x4cc00d=_0xc4ff4e;_0x46b6a6[_0x4cc00d(0xf3)][_0x4cc00d(0x119)]('new-rank-change');},0x32),_0x4b28e9['addEventListener'](_0xc4ff4e(0xc4),()=>{const _0x579624=_0xc4ff4e;localStorage['setItem'](_0x1e5ca1,JSON[_0x579624(0x10e)]({'timestamp':Date['now'](),'ignored':![],'userDismissed':!![],'systemDismissed':![]})),_0x46b6a6[_0x579624(0xf3)]['remove'](_0x579624(0xe6)),_0x46b6a6['classList']['add']('dismissing'),setTimeout(()=>{const _0x4f0e9b=_0x579624;_0x46b6a6['parentNode']&&(_0x46b6a6[_0x4f0e9b(0xd6)](),this[_0x4f0e9b(0xec)]['children']['length']===0x0&&(this['bannerContainer']['style']['display']=_0x4f0e9b(0x123)));},0x1f4);}),_0x4ad26b[_0xc4ff4e(0xcb)]('click',()=>{const _0x1f9f3a=_0xc4ff4e;localStorage['setItem'](_0x1e5ca1,JSON['stringify']({'timestamp':Date[_0x1f9f3a(0xcf)](),'ignored':!![],'userDismissed':!![],'systemDismissed':![]})),_0x46b6a6['classList'][_0x1f9f3a(0xd6)]('new-rank-change'),_0x46b6a6[_0x1f9f3a(0xf3)]['add']('dismissing'),setTimeout(()=>{const _0x7d8e16=_0x1f9f3a;_0x46b6a6[_0x7d8e16(0x120)]&&(_0x46b6a6['remove'](),this[_0x7d8e16(0xec)][_0x7d8e16(0xc3)][_0x7d8e16(0x118)]===0x0&&(this['bannerContainer']['style']['display']=_0x7d8e16(0x123)));},0x1f4);}),setTimeout(()=>{const _0x39af21=_0xc4ff4e;_0x46b6a6[_0x39af21(0x120)]&&(_0x46b6a6[_0x39af21(0xf3)]['remove']('new-rank-change'),_0x46b6a6['classList'][_0x39af21(0x119)]('dismissing'),localStorage['setItem'](_0x1e5ca1,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':!![]})),setTimeout(()=>{const _0x434b04=_0x39af21;_0x46b6a6['parentNode']&&(_0x46b6a6['remove'](),this['bannerContainer']['children']['length']===0x0&&(this['bannerContainer'][_0x434b04(0x107)]['display']='none'));},0x1f4));},0x3a98);});}async['resolveUserId'](_0x42ccfc){const _0x9b5ba6=a46_0x23d318,_0x5656e3={..._0x42ccfc},_0x5be0e9=[_0x42ccfc['player'],_0x42ccfc[_0x9b5ba6(0x128)],_0x42ccfc['playerUsername'],_0x42ccfc[_0x9b5ba6(0xe3)]],_0x30a2f1=_0x5be0e9['some'](_0x4d3338=>_0x4d3338&&typeof _0x4d3338==='string'&&!_0x4d3338['includes']('ID:')&&!/^[a-zA-Z0-9]{20,}$/[_0x9b5ba6(0xe1)](_0x4d3338));if(_0x30a2f1)return _0x5656e3;let _0x217cc4=null;if(_0x42ccfc['userId'])_0x217cc4=_0x42ccfc['userId'];else _0x42ccfc['player']&&/^[A-Za-z0-9]{20,}$/['test'](_0x42ccfc[_0x9b5ba6(0x106)])&&(_0x217cc4=_0x42ccfc['player']);if(!_0x217cc4)return _0x5656e3;try{const _0x2fc6fb=await getDoc(doc(db,'players',_0x217cc4));if(_0x2fc6fb['exists']()){const _0x1fcf8f=_0x2fc6fb[_0x9b5ba6(0x10d)]();if(_0x1fcf8f['username'])return _0x5656e3['resolvedName']=_0x1fcf8f['username'],_0x5656e3;}const _0x1ba1ff=await getDocs(query(collection(db,'approvedMatches'),where(_0x9b5ba6(0xf1),'==',_0x217cc4),orderBy('date','desc'),limit(0x1)));if(!_0x1ba1ff['empty']){const _0x3decbc=_0x1ba1ff[_0x9b5ba6(0x10b)][0x0]['data']();if(_0x3decbc['winnerUsername'])return _0x5656e3['resolvedName']=_0x3decbc['winnerUsername'],_0x5656e3;}const _0x16af8c=await getDocs(query(collection(db,'approvedMatches'),where('loserId','==',_0x217cc4),orderBy(_0x9b5ba6(0x109),_0x9b5ba6(0x108)),limit(0x1)));if(!_0x16af8c['empty']){const _0x503e9f=_0x16af8c['docs'][0x0]['data']();if(_0x503e9f['loserUsername'])return _0x5656e3['resolvedName']=_0x503e9f[_0x9b5ba6(0xf8)],console['log']('Resolved\x20'+_0x217cc4+'\x20to\x20'+_0x503e9f['loserUsername']+'\x20(loser)'),_0x5656e3;}}catch(_0x459119){console[_0x9b5ba6(0x121)]('Error\x20resolving\x20user\x20ID:',_0x459119);}return console['warn'](_0x9b5ba6(0x116)+_0x217cc4),_0x5656e3;}['showRankChangeLightbox'](_0x593a1b,_0x36f760){const _0x2d8d48=a46_0x23d318;let _0x4f232d=document['getElementById']('rankChangeModal');!_0x4f232d&&(_0x4f232d=document[_0x2d8d48(0xc6)](_0x2d8d48(0xe0)),_0x4f232d['id']='rankChangeModal',_0x4f232d['className']='rank-change-modal\x20'+_0x593a1b,document['body'][_0x2d8d48(0x10c)](_0x4f232d));const _0x31aeaf=_0x593a1b==='promotion'?'Congratulations!':'Rank\x20Update',_0x1fb0d8=_0x593a1b==='promotion'?_0x2d8d48(0xd5):'You\x27ve\x20been\x20demoted\x20to';_0x4f232d['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rank-change-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2\x20class=\x22rank-change-title\x22>'+_0x31aeaf+'</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>'+_0x1fb0d8+_0x2d8d48(0xfe)+_0x36f760+'</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22rank-change-button\x22\x20id=\x22rank-change-ok-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Got\x20it!\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x4f232d['style']['display']=_0x2d8d48(0xdd),document['getElementById']('rank-change-ok-btn')['addEventListener'](_0x2d8d48(0xc4),()=>{const _0x3917da=_0x2d8d48;_0x4f232d[_0x3917da(0x107)][_0x3917da(0xf9)]=_0x3917da(0x123);}),_0x4f232d[_0x2d8d48(0xcb)]('click',_0x5b5a91=>{const _0x19003d=_0x2d8d48;_0x5b5a91['target']===_0x4f232d&&(_0x4f232d[_0x19003d(0x107)][_0x19003d(0xf9)]='none');});}async[a46_0x23d318(0x117)](_0x51667f,_0x5013dd,_0x2cafe7,_0x63afa7={}){const _0x3fdf73=a46_0x23d318;try{if(_0x5013dd===_0x2cafe7||!_0x51667f)return null;const _0x579557=_0x63afa7['source']||'automatic',_0x25f891=_0x63afa7['matchId']||null,_0x3fb774=_0x63afa7['adminUser']||null;console['log']('Processing\x20potential\x20rank\x20change:\x20'+_0x2cafe7+'\x20→\x20'+_0x5013dd+'\x20(source:\x20'+_0x579557+')');let _0x4a8ef9=null,_0x2045d3=null;try{const _0x6cc810=await getDoc(doc(db,_0x3fdf73(0x101),_0x51667f));if(_0x6cc810['exists']()){const _0x19ad94=_0x6cc810['data']();_0x4a8ef9=_0x19ad94[_0x3fdf73(0x128)]||_0x19ad94['displayName']||null,_0x2045d3=_0x19ad94['displayName']||_0x19ad94['username']||null;}!_0x4a8ef9&&_0x63afa7[_0x3fdf73(0x128)]&&(_0x4a8ef9=_0x63afa7['username'],_0x2045d3=_0x63afa7['username']);!_0x4a8ef9&&auth['currentUser']&&(_0x4a8ef9=auth['currentUser']['displayName']||auth['currentUser']['email'][_0x3fdf73(0x102)]('@')[0x0],_0x2045d3=auth['currentUser']['displayName']||null);if(!_0x4a8ef9){const _0x23e68e=query(collection(db,_0x3fdf73(0xc9)),where('winnerId','==',_0x51667f),limit(0x1)),_0x480739=await getDocs(_0x23e68e);if(!_0x480739['empty'])_0x4a8ef9=_0x480739['docs'][0x0][_0x3fdf73(0x10d)]()['winnerUsername']||_0x3fdf73(0xe4),_0x2045d3=_0x4a8ef9;else{const _0x1391ab=query(collection(db,_0x3fdf73(0xc9)),where('loserId','==',_0x51667f),limit(0x1)),_0x1f8c2d=await getDocs(_0x1391ab);!_0x1f8c2d['empty']&&(_0x4a8ef9=_0x1f8c2d[0x0]['data']()['loserUsername']||'Unknown\x20Player',_0x2045d3=_0x4a8ef9);}}}catch(_0x3613b4){console[_0x3fdf73(0x121)]('Error\x20resolving\x20username:',_0x3613b4);}!_0x4a8ef9&&(console['warn']('Could\x20not\x20resolve\x20username\x20for\x20userId:',_0x51667f),_0x4a8ef9=_0x3fdf73(0xcd),_0x2045d3='Unknown\x20Player');const _0x115a91=this[_0x3fdf73(0xd8)](_0x2cafe7),_0xcb1131=this['getRankName'](_0x5013dd);if(_0x115a91!==_0xcb1131){const _0x58d965=_0x5013dd>_0x2cafe7,_0x5b4738=_0x58d965?'promotion':_0x3fdf73(0xf0),_0x4c2e77=_0xcb1131;console[_0x3fdf73(0xdc)]('Recording\x20'+_0x5b4738+'\x20for\x20'+_0x4a8ef9+':\x20'+_0x2cafe7+'\x20('+_0x115a91+_0x3fdf73(0xfd)+_0x5013dd+'\x20('+_0xcb1131+')');try{const _0x9b0b34={'player':_0x4a8ef9,'playerUsername':_0x4a8ef9,'username':_0x4a8ef9,'displayName':_0x2045d3,'userId':_0x51667f,'type':_0x5b4738,'rankAchieved':_0x4c2e77,'timestamp':serverTimestamp(),'previousElo':_0x2cafe7,'newElo':_0x5013dd,'change':_0x5013dd-_0x2cafe7,'previousRank':_0x115a91,'newRank':_0xcb1131,'source':_0x579557};if(_0x579557===_0x3fdf73(0x105)&&_0x25f891)_0x9b0b34['matchId']=_0x25f891;else _0x579557===_0x3fdf73(0xd4)&&_0x3fb774?(_0x9b0b34['modifiedBy']=_0x3fb774,_0x9b0b34['isAutomatic']=![]):_0x9b0b34[_0x3fdf73(0x10a)]=!![];const _0x1931e0=writeBatch(db),_0x2caa79=doc(collection(db,'eloHistory')),_0x546b8b=doc(collection(db,'promotionHistory'));return _0x1931e0['set'](_0x2caa79,_0x9b0b34),_0x1931e0[_0x3fdf73(0xda)](_0x546b8b,_0x9b0b34),await _0x1931e0['commit'](),await this['sendPromotionNotification'](_0x51667f,_0x4a8ef9,_0x2cafe7,_0x5013dd,_0x115a91,_0xcb1131,_0x5b4738,{'displayName':_0x2045d3,'source':_0x579557,'matchId':_0x25f891,'ladder':_0x63afa7['ladder']||'D1'}),console['log']('Successfully\x20recorded\x20'+_0x5b4738+'\x20for\x20'+_0x4a8ef9+'\x20to\x20'+_0x4c2e77),_0x4c2e77;}catch(_0x23518b){console[_0x3fdf73(0x121)]('Error\x20writing\x20promotion\x20records:',_0x23518b);try{return await addDoc(collection(db,'eloHistory'),{'player':_0x4a8ef9,'playerUsername':_0x4a8ef9,'username':_0x4a8ef9,'displayName':_0x2045d3,'userId':_0x51667f,'type':_0x5b4738,'rankAchieved':_0x4c2e77,'timestamp':serverTimestamp(),'previousElo':_0x2cafe7,'newElo':_0x5013dd,'change':_0x5013dd-_0x2cafe7,'previousRank':_0x115a91,'source':_0x579557,'isAutomatic':_0x579557!==_0x3fdf73(0xd4)}),await this['sendPromotionNotification'](_0x51667f,_0x4a8ef9,_0x2cafe7,_0x5013dd,_0x115a91,_0xcb1131,_0x5b4738,{'displayName':_0x2045d3,'source':_0x579557,'matchId':_0x25f891,'ladder':_0x63afa7['ladder']||'D1'}),_0x4c2e77;}catch(_0x45a112){return console[_0x3fdf73(0x121)]('Fallback\x20write\x20failed:',_0x45a112),null;}}}return null;}catch(_0x22decb){return console['error']('Error\x20in\x20promotion/demotion\x20recording:',_0x22decb),null;}}['getRankName'](_0x11535e){const _0x5e8dbd=a46_0x23d318;for(let _0x49ab6c=this['RANKS'][_0x5e8dbd(0x118)]-0x1;_0x49ab6c>=0x0;_0x49ab6c--){if(_0x11535e>=this[_0x5e8dbd(0xde)][_0x49ab6c]['threshold'])return this[_0x5e8dbd(0xde)][_0x49ab6c]['name'];}return'Unranked';}[a46_0x23d318(0xea)](){const _0x570195=a46_0x23d318;this[_0x570195(0x125)]&&clearInterval(this['pollingInterval']);}['isNewRankChange'](_0x3271a8){const _0x50079b=a46_0x23d318;if(_0x3271a8['timestamp']){const _0x5cffa1=_0x3271a8[_0x50079b(0xe5)]['seconds']*0x3e8,_0x20a9f7=Date['now'](),_0x3dfaf0=(_0x20a9f7-_0x5cffa1)/(0x3e8*0x3c*0x3c);if(_0x3dfaf0>0x18)return![];}if(_0x3271a8['previousRank']&&_0x3271a8[_0x50079b(0xf5)]&&_0x3271a8['previousRank']!==_0x3271a8[_0x50079b(0xf5)])return!![];return![];}async['sendPromotionNotification'](_0x59bac9,_0x1f973f,_0x3423da,_0x458321,_0x42353f,_0x17b5ab,_0x23e357,_0xcffc7a={}){const _0x676bfa=a46_0x23d318;try{console['log']('STARTING\x20notification\x20for\x20'+_0x1f973f+'\x27s\x20'+_0x23e357);const _0x131cd9={'userId':_0x59bac9,'username':_0x1f973f,'displayName':_0xcffc7a['displayName']||_0x1f973f,'oldElo':parseInt(_0x3423da),'newElo':parseInt(_0x458321),'eloDifference':parseInt(_0x458321)-parseInt(_0x3423da),'oldRank':_0x42353f,'newRank':_0x17b5ab,'type':_0x23e357,'timestamp':serverTimestamp(),'processed':![],'source':_0xcffc7a[_0x676bfa(0xeb)]||_0x676bfa(0xdb),'matchId':_0xcffc7a['matchId']||null,'ladder':_0xcffc7a[_0x676bfa(0x100)]||'D1','adminUser':_0xcffc7a[_0x676bfa(0xee)]||null};console['log']('Creating\x20Discord\x20notification:',_0x131cd9);const _0x25ac1d=await addDoc(collection(db,_0x676bfa(0xd1)),_0x131cd9);return console['log'](_0x676bfa(0xf7)+_0x25ac1d['id']),!![];}catch(_0x3806bf){return console['error'](_0x676bfa(0xe7),_0x3806bf),![];}}}export const promotionManager=new PromotionManager();document['addEventListener']('DOMContentLoaded',()=>{const _0x573fa9=a46_0x23d318;promotionManager[_0x573fa9(0xe2)]();});export const initializePromotionTracker=()=>promotionManager[a46_0x23d318(0xe2)]();export const checkAndRecordPromotion=(_0x1f970e,_0x420b45,_0x201439,_0x4309c4)=>promotionManager['checkAndRecordPromotion'](_0x1f970e,_0x420b45,_0x201439,_0x4309c4);function a46_0x5c4d(){const _0x42d27b=['children','click','toDateString','createElement','Gold','className','approvedMatches','DISPLAY_HOURS','addEventListener','promotion_','A\x20player','Error\x20fetching\x20promotions:','now','fetchRecentPromotions','promotionNotifications','forEach','bind','admin','You\x27ve\x20been\x20promoted\x20to','remove','systemDismissed','getRankName','info','set','automatic','log','flex','RANKS','parse','div','test','initialize','displayName','Unknown\x20Player','timestamp','new-rank-change','Error\x20sending\x20Discord\x20notification:','toString','textContent','cleanup','source','bannerContainer','button','adminUser','true','demotion','winnerId','ignore-btn','classList','rankAchieved','newRank','lastFetchTime','Discord\x20notification\x20sent\x20successfully\x20with\x20ID:\x20','loserUsername','display','Silver','title','removeChild',')\x20→\x20','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22rank-name\x22>','Promotion\x20','ladder','players','split','visibilityState','seconds','match','player','style','desc','date','isAutomatic','docs','appendChild','data','stringify','slice','processRankChanges','Skipping\x20ignored\x20promotion:\x20','Error\x20saving\x20promotion\x20preference:','promotion-banner-container','toMillis','constructor','Failed\x20to\x20resolve\x20user\x20ID:\x20','checkAndRecordPromotion','length','add','shouldShowPromotion','userDismissed','push','fetchInterval','type','Promotion\x20banner\x20container\x20not\x20found','parentNode','error','Emerald','none','apply','pollingInterval','banner-actions','table','username','setItem'];a46_0x5c4d=function(){return _0x42d27b;};return a46_0x5c4d();}export const getRankName=_0x48348a=>promotionManager[a46_0x23d318(0xd8)](_0x48348a);
const a39_0x363ca3=a39_0x6502,a39_0x36a25e=(function(){let _0x4db169=!![];return function(_0x1d2f1c,_0x37809f){const _0x15240c=_0x4db169?function(){if(_0x37809f){const _0x5dfb2c=_0x37809f['apply'](_0x1d2f1c,arguments);return _0x37809f=null,_0x5dfb2c;}}:function(){};return _0x4db169=![],_0x15240c;};}()),a39_0x381f99=a39_0x36a25e(this,function(){const _0x65b830=a39_0x6502;let _0x510197;try{const _0x36dc09=Function('return\x20(function()\x20'+_0x65b830(0x1cd)+');');_0x510197=_0x36dc09();}catch(_0x3955f4){_0x510197=window;}const _0x406861=_0x510197[_0x65b830(0x1d1)]=_0x510197[_0x65b830(0x1d1)]||{},_0x297cb6=['log','warn','info','error','exception','table','trace'];for(let _0xe08a22=0x0;_0xe08a22<_0x297cb6[_0x65b830(0x1da)];_0xe08a22++){const _0x14d065=a39_0x36a25e['constructor']['prototype']['bind'](a39_0x36a25e),_0x19d442=_0x297cb6[_0xe08a22],_0x3843e3=_0x406861[_0x19d442]||_0x14d065;_0x14d065['__proto__']=a39_0x36a25e['bind'](a39_0x36a25e),_0x14d065['toString']=_0x3843e3[_0x65b830(0x1c8)][_0x65b830(0x1c9)](_0x3843e3),_0x406861[_0x19d442]=_0x14d065;}});a39_0x381f99();import{db}from'./firebase-config.js';function a39_0x6502(_0x55e709,_0x48145d){const _0x381f99=a39_0x5991();return a39_0x6502=function(_0x36a25e,_0xb9193f){_0x36a25e=_0x36a25e-0x1c6;let _0x599134=_0x381f99[_0x36a25e];return _0x599134;},a39_0x6502(_0x55e709,_0x48145d);}import{doc,getDoc,updateDoc,addDoc,collection,serverTimestamp}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a39_0x5991(){const _0x9388bd=['Match\x20points:\x20','.\x20New\x20total:\x20','toString','bind','pointsHistory','log',',\x20skipping\x20points\x20award','{}.constructor(\x22return\x20this\x22)(\x20)','Error\x20adding\x20points\x20to\x20user:','./adminbackend.js','\x20match','console','Standard','add','system-match-award','\x20match\x20(Participant)','Admin\x20backend\x20not\x20available,\x20using\x20fallback\x20points\x20service','\x20match\x20(Winner)','Added\x20','modifyUserPoints','length'];a39_0x5991=function(){return _0x9388bd;};return a39_0x5991();}const POINTS_CHART={'':0xa,'Standard':0xa,'Fusion\x20Match':0x19,'â‰¥6\x20Missiles':0xa,'Weapon\x20Imbalance':0x1e,'Blind\x20Match':0x4b,'Rematch':0x14,'Disorientation':0x32,'Ratting':0x23,'Altered\x20Powerups':0x23,'Mega\x20Match':0x28,'Dogfight':0x32,'Gauss\x20and\x20Mercs':0x19,'Misc':0x1e};let adminModifyUserPoints=null;try{const adminModule=await import(a39_0x363ca3(0x1cf));adminModule[a39_0x363ca3(0x1d9)]&&(adminModifyUserPoints=adminModule['modifyUserPoints'],console[a39_0x363ca3(0x1cb)]('Admin\x20points\x20service\x20connected'));}catch(a39_0x58fd2b){console['log'](a39_0x363ca3(0x1d6));}export async function awardMatchPoints(_0x3fd1f2,_0x3c3c20,_0x2cbfdf){const _0x23a201=a39_0x363ca3;try{const _0x258000=POINTS_CHART[_0x2cbfdf]||0xa;return adminModifyUserPoints?await Promise['all']([adminModifyUserPoints(_0x3fd1f2,_0x23a201(0x1d3),_0x258000,_0x23a201(0x1c6)+(_0x2cbfdf||'Standard')+'\x20match\x20(Winner)'),adminModifyUserPoints(_0x3c3c20,_0x23a201(0x1d3),_0x258000,'Match\x20points:\x20'+(_0x2cbfdf||_0x23a201(0x1d2))+'\x20match\x20(Participant)')]):await Promise['all']([addPointsFallback(_0x3fd1f2,_0x258000,'Match\x20points:\x20'+(_0x2cbfdf||'Standard')+_0x23a201(0x1d7)),addPointsFallback(_0x3c3c20,_0x258000,_0x23a201(0x1c6)+(_0x2cbfdf||'Standard')+_0x23a201(0x1d5))]),console[_0x23a201(0x1cb)]('Awarded\x20'+_0x258000+'\x20points\x20to\x20both\x20players\x20for\x20'+(_0x2cbfdf||_0x23a201(0x1d2))+_0x23a201(0x1d0)),!![];}catch(_0x590b1a){return console['error']('Error\x20awarding\x20match\x20points:',_0x590b1a),![];}}async function addPointsFallback(_0x55978e,_0x56e7cc,_0x19b6b9=''){const _0x4aa248=a39_0x363ca3;try{const _0x5e7709=doc(db,'userProfiles',_0x55978e),_0x3d87d1=await getDoc(_0x5e7709);if(!_0x3d87d1['exists']()){console[_0x4aa248(0x1cb)]('User\x20profile\x20not\x20found\x20for\x20'+_0x55978e+_0x4aa248(0x1cc));return;}const _0x7f2d8d=_0x3d87d1['data'](),_0x1b415b=_0x7f2d8d['points']||0x0,_0x393e82=_0x1b415b+_0x56e7cc;await updateDoc(_0x5e7709,{'points':_0x393e82,'lastPointsModified':serverTimestamp()}),await addDoc(collection(db,_0x4aa248(0x1ca)),{'userId':_0x55978e,'userEmail':_0x7f2d8d['email']||'unknown','displayName':_0x7f2d8d['displayName']||_0x7f2d8d['username']||'Unknown\x20User','action':'add','amount':_0x56e7cc,'previousPoints':_0x1b415b,'newPoints':_0x393e82,'reason':_0x19b6b9,'adminEmail':_0x4aa248(0x1d4),'timestamp':serverTimestamp()}),console[_0x4aa248(0x1cb)](_0x4aa248(0x1d8)+_0x56e7cc+'\x20points\x20to\x20user\x20'+_0x55978e+_0x4aa248(0x1c7)+_0x393e82);}catch(_0x1f0f1f){console['error'](_0x4aa248(0x1ce),_0x1f0f1f);throw _0x1f0f1f;}}
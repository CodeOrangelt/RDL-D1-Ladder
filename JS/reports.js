const a47_0x338b36=(function(){let _0x41d150=!![];return function(_0x3aaac4,_0x22a7f2){const _0x32b75b=_0x41d150?function(){if(_0x22a7f2){const _0x59da21=_0x22a7f2['apply'](_0x3aaac4,arguments);return _0x22a7f2=null,_0x59da21;}}:function(){};return _0x41d150=![],_0x32b75b;};}()),a47_0x391d62=a47_0x338b36(this,function(){const _0x5b1395=a47_0x52e2;let _0x2a474a;try{const _0x456e47=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x2a474a=_0x456e47();}catch(_0x25e100){_0x2a474a=window;}const _0x36ee34=_0x2a474a[_0x5b1395(0x167)]=_0x2a474a['console']||{},_0x37fedf=['log','warn','info','error','exception',_0x5b1395(0x188),_0x5b1395(0x15e)];for(let _0x4597c8=0x0;_0x4597c8<_0x37fedf['length'];_0x4597c8++){const _0x42953c=a47_0x338b36['constructor']['prototype']['bind'](a47_0x338b36),_0x5c3e12=_0x37fedf[_0x4597c8],_0x33d556=_0x36ee34[_0x5c3e12]||_0x42953c;_0x42953c['__proto__']=a47_0x338b36[_0x5b1395(0x141)](a47_0x338b36),_0x42953c['toString']=_0x33d556['toString']['bind'](_0x33d556),_0x36ee34[_0x5c3e12]=_0x42953c;}});a47_0x391d62();function a47_0x1446(){const _0x40d12c=['bind','options','click','email','nonParticipants','uid','value','username','lightbox-comment','\x22>View\x20Details</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','lightbox-loser','message','padding','report-error','push','pendingMatchesD2','winnerOldElo','Report\x20has\x20been\x20successfully\x20rescinded.','eloRating','lightbox-game-mode','active','green','currentUser','Report\x20Game','subgameType','report-lightbox','Error:\x20','className','getElementById','trace','winnerUsername','Query\x20by\x20winnerId\x20results:\x20','auth-warning','cancel-button','empty','Checking\x20reports\x20for\x20user:\x20','loserId','\x20moved\x20to\x20position\x20','console','createdAt','classList','Showing\x20lightbox','reset','lightbox-map','warn','then','Required\x20elements\x20not\x20found\x20for\x20loadOpponentsList','reportError','target','Using\x20collection:\x20','data-id','pendingMatchesD3','type','error','getAttribute','suicides','backgroundColor','createElement','Lightbox\x20element\x20not\x20found','winner-username','Error:\x20Loser\x20data\x20not\x20found.','white','all','entries','data-edit-id','No\x20matches\x20found\x20by\x20winnerId,\x20trying\x20winnerEmail','\x20(ELO:\x20','block','User\x20already\x20logged\x20in,\x20checking\x20D1\x20ladder\x20status','Loading\x20opponents\x20from\x20collection:\x20','addEventListener','table','style','Error\x20loading\x20opponents\x20list:','winnerEmail','<p>No\x20outstanding\x20matches\x20found\x20in\x20the\x20current\x20game\x20mode.</p>','loserScore','from','d2-mode','docs','report-form','view-outstanding-container','\x20in\x20','winner-suicides','\x20ladder.','remove','\x20matches\x20found','color','forEach','\x20mode','cloneNode','Error\x20submitting\x20report:','textContent','approved','lightbox-winner','d3-mode','view-outstanding-btn','Game\x20reported\x20successfully.','loserComment','Found\x20buttons\x20container:','pendingMatches','Not\x20specified','players','You\x20are\x20not\x20registered\x20in\x20any\x20ladder.','innerHTML','Error:\x20Winner\x20data\x20not\x20found.','approve-button','none','loser-score','winner-score','map-played','</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22match-details\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22match-detail-item\x22>Map:\x20','readOnly','gameMode','toDate','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22match-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20view-detail-btn\x22\x20data-id=\x22','reload','subgame-type','Unknown\x20date','Report\x20form\x20reset','You\x20are\x20not\x20registered\x20in\x20the\x20','Unknown','#6a1b9a','User\x20found\x20in\x20collection\x20','Error\x20checking\x20non-participant\x20status:','log','data','Only\x20the\x20winner\x20of\x20the\x20match\x20can\x20reject\x20it','winnerId','reportForm','rgba(255,\x20255,\x20255,\x200.05)','loser-username','Report\x20has\x20been\x20successfully\x20updated.','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3>','\x27\x20not\x20found\x20in\x20the\x20DOM','No\x20authenticated\x20user\x20found','brian2af@outlook.com','add','\x20for\x20game\x20mode:\x20','playersD2','size','exists','losersOldElo','Error\x20rejecting\x20match:\x20','8px\x2016px','10px','Current\x20user\x20info:','Standard\x20Match','loserUsername','Query\x20by\x20winnerUsername\x20results:\x20','4px','border','show','display','onAuthStateChanged','Failed\x20to\x20update\x20report.\x20Please\x20try\x20again.','querySelector','playersD3','playersCTF'];a47_0x1446=function(){return _0x40d12c;};return a47_0x1446();}import{approveReport}from'./ladderalgorithm.js';import{approveReportD2}from'./ladderalgorithm-d2.js';import{approveReportD3}from'./ladderalgorithm-d3.js';import{checkPendingMatches,updatePendingMatchNotification,updateNotificationDot}from'./checkPendingMatches.js';import{collection,getDocs,query,where,orderBy,serverTimestamp,doc,setDoc,getDoc,addDoc,updateDoc,deleteDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{auth,db}from'./firebase-config.js';let currentUserEmail=null,confirmationNotification=null,outstandingReportData=null,currentGameMode='D1',outstandingMatches=[];document['addEventListener']('DOMContentLoaded',async()=>{const _0x29bf14=a47_0x52e2,_0x5bf3cd={'authWarning':document[_0x29bf14(0x15d)](_0x29bf14(0x161)),'reportForm':document[_0x29bf14(0x15d)]('report-form'),'winnerUsername':document['getElementById'](_0x29bf14(0x17c)),'loserUsername':document['getElementById']('loser-username'),'loserScore':document['getElementById'](_0x29bf14(0x1ad)),'suicides':document['getElementById'](_0x29bf14(0x178)),'mapPlayed':document['getElementById'](_0x29bf14(0x1af)),'loserComment':document['getElementById']('loser-comment'),'reportError':document['getElementById']('report-error'),'reportLightbox':document['getElementById']('report-lightbox')};Object[_0x29bf14(0x180)](_0x5bf3cd)['forEach'](([_0x1f5fd1,_0x328fc3])=>{const _0x3ffc44=_0x29bf14;!_0x328fc3&&console['warn']('Element\x20\x27'+_0x1f5fd1+_0x3ffc44(0x1c7));});const _0x31d190=document[_0x29bf14(0x15d)]('d1-mode'),_0x3b0151=document['getElementById']('d2-mode'),_0xcfabac=document['getElementById'](_0x29bf14(0x1a0));_0x31d190['addEventListener']('click',()=>{const _0x1f8cf9=_0x29bf14;_0x12fff8('D1'),_0x31d190[_0x1f8cf9(0x169)]['add'](_0x1f8cf9(0x155)),_0x3b0151['classList']['remove']('active'),_0xcfabac['classList'][_0x1f8cf9(0x196)]('active');}),_0x3b0151['addEventListener']('click',()=>{const _0x1d1fac=_0x29bf14;_0x12fff8('D2'),_0x3b0151['classList']['add']('active'),_0x31d190[_0x1d1fac(0x169)]['remove']('active'),_0xcfabac['classList']['remove']('active');}),_0xcfabac[_0x29bf14(0x187)](_0x29bf14(0x143),()=>{const _0x3ff1a1=_0x29bf14;_0x12fff8('D3'),_0xcfabac['classList']['add']('active'),_0x31d190['classList'][_0x3ff1a1(0x196)]('active'),_0x3b0151['classList']['remove']('active');});function _0x12fff8(_0x825ef0){const _0x48270e=_0x29bf14;currentGameMode=_0x825ef0,console['log']('Game\x20mode\x20set\x20to:\x20'+currentGameMode),auth['currentUser']&&checkUserInLadderAndLoadOpponents(auth[_0x48270e(0x157)]['uid']);}setupAuthStateListener(_0x5bf3cd),setupReportForm(_0x5bf3cd),auth['currentUser']?(console[_0x29bf14(0x1be)](_0x29bf14(0x185)),checkUserInLadderAndLoadOpponents(auth['currentUser']['uid'])):console['log']('No\x20user\x20logged\x20in\x20yet,\x20waiting\x20for\x20auth\x20state\x20change');});function setupAuthStateListener(_0x1a92cd){onAuthStateChanged(auth,async _0x2fdb7b=>{_0x2fdb7b?handleUserSignedIn(_0x2fdb7b,_0x1a92cd):handleUserSignedOut(_0x1a92cd);});}async function handleUserSignedIn(_0x35f7ca,_0x256b5e){const _0x4b32ca=a47_0x52e2;if(!_0x256b5e){console[_0x4b32ca(0x176)]('Elements\x20object\x20is\x20null\x20or\x20undefined');return;}currentUserEmail=_0x35f7ca['email']||null;const _0x1fd47a=_0x35f7ca['uid'];try{const _0x15b802=doc(db,_0x4b32ca(0x145),_0x1fd47a);try{const _0x5d60c9=await getDoc(_0x15b802);console[_0x4b32ca(0x1be)]('Non-participant\x20check:',{'exists':_0x5d60c9['exists'](),'data':_0x5d60c9[_0x4b32ca(0x1ce)]()?_0x5d60c9['data']():null});if(_0x5d60c9['exists']()&&_0x5d60c9[_0x4b32ca(0x1bf)]()['isNonParticipant']===!![]){_0x256b5e['authWarning']&&(_0x256b5e['authWarning']['style']['display']='block',_0x256b5e['authWarning']['textContent']='Non-participants\x20cannot\x20report\x20games.');_0x256b5e[_0x4b32ca(0x1c2)]&&(_0x256b5e[_0x4b32ca(0x1c2)]['style']['display']=_0x4b32ca(0x1ac));return;}}catch(_0x1a4003){console[_0x4b32ca(0x16d)](_0x4b32ca(0x1bd),_0x1a4003);}const _0x22dfb4=['players','playersD2','playersD3','playersDuos',_0x4b32ca(0x1df)];let _0x2e26e2=![],_0x585562='';for(const _0x1e89e3 of _0x22dfb4){try{const _0x13b869=doc(db,_0x1e89e3,_0x1fd47a),_0x629c46=await getDoc(_0x13b869);if(_0x629c46['exists']()){_0x2e26e2=!![],_0x585562=_0x629c46['data']()[_0x4b32ca(0x148)],console['log'](_0x4b32ca(0x1bc)+_0x1e89e3+'\x20with\x20username:\x20'+_0x585562);if(_0x1e89e3===_0x4b32ca(0x1a7)&&currentGameMode!=='D1'){currentGameMode='D1';const _0x299eb7=document['getElementById']('d1-mode'),_0x1e91fa=document['getElementById']('d2-mode'),_0x3d104b=document[_0x4b32ca(0x15d)]('d3-mode');_0x299eb7[_0x4b32ca(0x169)][_0x4b32ca(0x1ca)]('active'),_0x1e91fa[_0x4b32ca(0x169)]['remove']('active'),_0x3d104b['classList'][_0x4b32ca(0x196)]('active');}else{if(_0x1e89e3===_0x4b32ca(0x1cc)&&currentGameMode!=='D2'){currentGameMode='D2';const _0x21c0d4=document['getElementById']('d1-mode'),_0x522ab1=document[_0x4b32ca(0x15d)]('d2-mode'),_0x36fcf8=document['getElementById']('d3-mode');_0x522ab1['classList'][_0x4b32ca(0x1ca)]('active'),_0x21c0d4[_0x4b32ca(0x169)]['remove'](_0x4b32ca(0x155)),_0x36fcf8['classList']['remove']('active');}}break;}}catch(_0x5d7385){console['warn']('Error\x20checking\x20'+_0x1e89e3+'\x20collection:',_0x5d7385);}}if(!_0x2e26e2){_0x256b5e['authWarning']&&(_0x256b5e['authWarning']['style'][_0x4b32ca(0x1da)]='block',_0x256b5e['authWarning']['textContent']=_0x4b32ca(0x1a8));_0x256b5e[_0x4b32ca(0x1c2)]&&(_0x256b5e[_0x4b32ca(0x1c2)][_0x4b32ca(0x189)][_0x4b32ca(0x1da)]='none');return;}const _0x5204c9=await checkUserInLadderAndLoadOpponents(_0x1fd47a);if(!_0x5204c9){console['warn']('User\x20is\x20not\x20in\x20the\x20'+currentGameMode+'\x20ladder.\x20Checking\x20other\x20ladders.');for(const _0x397850 of['players',_0x4b32ca(0x1cc),_0x4b32ca(0x1de)]){if(_0x397850===(currentGameMode==='D1'?'players':currentGameMode==='D2'?'playersD2':'playersD3'))continue;const _0x337ff6=doc(db,_0x397850,_0x1fd47a);try{const _0x1ea3df=await getDoc(_0x337ff6);if(_0x1ea3df['exists']()){const _0x5c531a=_0x397850===_0x4b32ca(0x1a7)?'D1':_0x397850===_0x4b32ca(0x1cc)?'D2':'D3';console[_0x4b32ca(0x1be)]('User\x20found\x20in\x20'+_0x397850+',\x20switching\x20to\x20'+_0x5c531a+_0x4b32ca(0x19a));const _0xe19810=document['getElementById']('d1-mode'),_0x40dc91=document[_0x4b32ca(0x15d)](_0x4b32ca(0x18f)),_0xe6640e=document['getElementById']('d3-mode');if(_0x5c531a==='D1')_0xe19810['classList']['add']('active'),_0x40dc91['classList']['remove']('active'),_0xe6640e['classList']['remove']('active');else _0x5c531a==='D2'?(_0x40dc91[_0x4b32ca(0x169)]['add']('active'),_0xe19810['classList']['remove']('active'),_0xe6640e['classList']['remove'](_0x4b32ca(0x155))):(_0xe6640e[_0x4b32ca(0x169)][_0x4b32ca(0x1ca)](_0x4b32ca(0x155)),_0xe19810['classList']['remove'](_0x4b32ca(0x155)),_0x40dc91['classList'][_0x4b32ca(0x196)]('active'));currentGameMode=_0x5c531a,await checkUserInLadderAndLoadOpponents(_0x1fd47a);break;}}catch(_0x1c6062){console['warn']('Error\x20checking\x20'+_0x397850+':',_0x1c6062);}}}}catch(_0x399527){console[_0x4b32ca(0x176)]('Error\x20during\x20sign-in\x20handling:',_0x399527);}}function handleUserSignedOut(_0x56299f){_0x56299f['authWarning']['style']['display']='block',_0x56299f['reportForm']['style']['display']='none',currentUserEmail=null;}async function updateUserDisplay(_0x12271d,_0x2d3d27){const _0x46ba06=a47_0x52e2,_0x4ca510=collection(db,'players'),_0x40a92f=query(_0x4ca510,where('email','==',_0x12271d)),_0x388ecd=await getDocs(_0x40a92f);if(!_0x388ecd['empty']){const _0x555e80=_0x388ecd[_0x46ba06(0x190)][0x0]['data']()['username'];_0x2d3d27['loserUsername']['textContent']=_0x555e80;}}async function populateWinnerDropdown(_0x3e3f81){try{const _0x163080=collection(db,'players'),_0x22cafb=await getDocs(_0x163080);_0x3e3f81['innerHTML']='<option\x20value=\x22\x22>Select\x20Winner</option>',!_0x22cafb['empty']&&_0x22cafb['forEach'](_0x4c65c5=>{const _0x5f0f06=a47_0x52e2,_0x554856=_0x4c65c5[_0x5f0f06(0x1bf)]();if(_0x554856['email']!==currentUserEmail){const _0x2df033=document['createElement']('option');_0x2df033['value']=_0x554856['email'],_0x2df033['textContent']=_0x554856['username'],_0x3e3f81['appendChild'](_0x2df033);}});}catch(_0x4a2538){console['error']('Error\x20populating\x20winner\x20dropdown:',_0x4a2538);throw _0x4a2538;}}function setupReportForm(_0x157680){const _0x5db227=a47_0x52e2;if(!_0x157680[_0x5db227(0x1c2)])return;_0x157680['reportForm']['addEventListener']('submit',async _0x3a469a=>{const _0x4a5674=_0x5db227;_0x3a469a['preventDefault']();try{await submitReport(_0x157680),_0x157680[_0x4a5674(0x1c2)][_0x4a5674(0x16b)](),alert(_0x4a5674(0x1a2));}catch(_0x17ebff){console[_0x4a5674(0x176)](_0x4a5674(0x19c),_0x17ebff),_0x157680[_0x4a5674(0x170)][_0x4a5674(0x19d)]='Error\x20reporting\x20game.\x20Please\x20try\x20again.';}});}async function submitReport(_0x203e03){const _0x1d8c46=a47_0x52e2,_0x46ce21=currentGameMode==='D1'?_0x1d8c46(0x1a5):currentGameMode==='D2'?_0x1d8c46(0x150):_0x1d8c46(0x174),_0x5208cf=collection(db,_0x46ce21),_0x40f607=doc(_0x5208cf);try{const _0x14cc6c=auth['currentUser'];if(!_0x14cc6c)throw new Error('User\x20not\x20authenticated');const _0x25b234=_0x14cc6c['uid'],_0x545940=currentGameMode==='D1'?_0x1d8c46(0x1a7):currentGameMode==='D2'?_0x1d8c46(0x1cc):'playersD3',_0x31f893=await getDoc(doc(db,_0x545940,_0x25b234));if(!_0x31f893[_0x1d8c46(0x1ce)]())throw new Error('Your\x20player\x20profile\x20not\x20found');const _0xebde71=document[_0x1d8c46(0x15d)]('subgame-type'),_0x4eee72=_0x203e03[_0x1d8c46(0x15f)][_0x1d8c46(0x147)];if(!_0x4eee72)throw new Error('Please\x20select\x20an\x20opponent');const _0x5af33f=query(collection(db,_0x545940),where('username','==',_0x4eee72)),_0x4202d2=await getDocs(_0x5af33f);if(_0x4202d2['empty'])throw new Error('Selected\x20opponent\x20not\x20found');const _0x34ee76=_0x4202d2['docs'][0x0]['data'](),_0x552488=_0x4202d2['docs'][0x0]['id'],_0x35ad1d={'matchId':_0x40f607['id'],'loserUsername':_0x31f893['data']()['username'],'loserId':_0x25b234,'winnerUsername':_0x34ee76['username'],'winnerId':_0x552488,'loserScore':_0x203e03[_0x1d8c46(0x18d)]['value'],'loserSuicides':_0x203e03['suicides']['value'],'mapPlayed':_0x203e03['mapPlayed']['value'],'loserComment':_0x203e03['loserComment'][_0x1d8c46(0x147)],'subgameType':_0xebde71?_0xebde71['value']:'','gameMode':currentGameMode,'approved':![],'createdAt':serverTimestamp(),'winnerOldElo':_0x34ee76['eloRating']||null,'losersOldElo':_0x31f893['data']()['eloRating']||null};await setDoc(_0x40f607,_0x35ad1d),console['log']('Match\x20reported\x20in\x20'+_0x46ce21+'\x20with\x20ID:\x20'+_0x40f607['id']),_0x203e03['reportError']['textContent']='Game\x20reported\x20successfully!',_0x203e03['reportError']['style']['color']=_0x1d8c46(0x156),updatePendingMatchNotification();}catch(_0x345e79){console['error'](_0x1d8c46(0x19c),_0x345e79),_0x203e03['reportError']['textContent']=_0x1d8c46(0x15b)+_0x345e79['message'],_0x203e03['reportError']['style']['color']='red';throw _0x345e79;}}async function checkForOutstandingReports(_0x16507a,_0x12eae4,_0x239fa3=null){const _0x5a516a=a47_0x52e2;console[_0x5a516a(0x1be)](_0x5a516a(0x164)+_0x16507a+_0x5a516a(0x193)+(_0x239fa3||'default\x20collection'));const _0x23535b=_0x239fa3||(currentGameMode==='D1'?'pendingMatches':currentGameMode==='D2'?'pendingMatchesD2':'pendingMatchesD3');console[_0x5a516a(0x1be)](_0x5a516a(0x172)+_0x23535b);try{const _0x3b44d5=auth[_0x5a516a(0x157)];if(!_0x3b44d5){console['log'](_0x5a516a(0x1c8));return;}const _0x2ab3a0=_0x3b44d5['uid'],_0x31005d=collection(db,_0x23535b),_0x52b2db=query(_0x31005d,where('winnerId','==',_0x2ab3a0),where('approved','==',![]));let _0x43c2f3=await getDocs(_0x52b2db);console['log'](_0x5a516a(0x160)+_0x43c2f3[_0x5a516a(0x1cd)]+'\x20matches\x20found');if(_0x43c2f3[_0x5a516a(0x163)]&&_0x3b44d5['email']){console['log'](_0x5a516a(0x182));const _0x1b45e2=query(_0x31005d,where('winnerEmail','==',_0x3b44d5[_0x5a516a(0x144)]),where('approved','==',![]));_0x43c2f3=await getDocs(_0x1b45e2),console[_0x5a516a(0x1be)]('Query\x20by\x20winnerEmail\x20results:\x20'+_0x43c2f3[_0x5a516a(0x1cd)]+_0x5a516a(0x197));}if(_0x43c2f3['empty']){console['log']('No\x20matches\x20found\x20by\x20email\x20either,\x20trying\x20winnerUsername');const _0x1b2923=currentGameMode==='D1'?'players':_0x5a516a(0x1cc),_0x1937d9=await getDoc(doc(db,_0x1b2923,_0x2ab3a0));if(_0x1937d9['exists']()&&_0x1937d9['data']()['username']){const _0x3181f4=_0x1937d9['data']()['username'],_0x5cb2a4=query(_0x31005d,where('winnerUsername','==',_0x3181f4),where(_0x5a516a(0x19e),'==',![]));_0x43c2f3=await getDocs(_0x5cb2a4),console['log'](_0x5a516a(0x1d6)+_0x43c2f3['size']+'\x20matches\x20found');}}if(!_0x43c2f3[_0x5a516a(0x163)]){const _0x453f06=_0x43c2f3['docs'][0x0][_0x5a516a(0x1bf)]();return console['log']('Found\x20pending\x20match:',_0x453f06),_0x453f06['id']=_0x43c2f3['docs'][0x0]['id'],autoFillReportForm(_0x453f06),updateNotificationDot(!![]),!![];}else return console[_0x5a516a(0x1be)]('No\x20pending\x20matches\x20found\x20for\x20this\x20user'),updateNotificationDot(![]),![];}catch(_0x7cc450){console['error']('Error\x20checking\x20outstanding\x20reports:',_0x7cc450);}}function autoFillReportForm(_0x4eb5b9){const _0x7b9e0b=a47_0x52e2;console['log']('Report\x20Data\x20in\x20autoFillReportForm:',_0x4eb5b9);if(_0x4eb5b9){const _0xa3167d=parseInt(_0x4eb5b9[_0x7b9e0b(0x18d)]||'0'),_0x1b0652=_0xa3167d<0x12?0x14:_0xa3167d+0x2,_0x341576=_0x4eb5b9[_0x7b9e0b(0x1b2)]||currentGameMode,_0x5b8c12=_0x341576==='D1'?'players':_0x341576==='D2'?'playersD2':'playersD3';console['log']('Using\x20players\x20collection:\x20'+_0x5b8c12+_0x7b9e0b(0x1cb)+_0x341576);let _0x11b679;_0x4eb5b9['winnerId']?_0x11b679=getDoc(doc(db,_0x5b8c12,_0x4eb5b9[_0x7b9e0b(0x1c1)]))['then'](_0x1b07aa=>_0x1b07aa['exists']()?{'id':_0x1b07aa['id'],'data':_0x1b07aa['data']()}:null):_0x11b679=getDocs(query(collection(db,_0x5b8c12),where('username','==',_0x4eb5b9['winnerUsername'])))['then'](_0x4b0267=>!_0x4b0267['empty']?{'id':_0x4b0267['docs'][0x0]['id'],'data':_0x4b0267['docs'][0x0]['data']()}:null);let _0x3b6079;_0x4eb5b9[_0x7b9e0b(0x165)]?_0x3b6079=getDoc(doc(db,_0x5b8c12,_0x4eb5b9['loserId']))[_0x7b9e0b(0x16e)](_0x554b0e=>_0x554b0e[_0x7b9e0b(0x1ce)]()?{'id':_0x554b0e['id'],'data':_0x554b0e['data']()}:null):_0x3b6079=getDocs(query(collection(db,_0x5b8c12),where('username','==',_0x4eb5b9[_0x7b9e0b(0x1d5)])))[_0x7b9e0b(0x16e)](_0x1f8254=>!_0x1f8254['empty']?{'id':_0x1f8254[_0x7b9e0b(0x190)][0x0]['id'],'data':_0x1f8254[_0x7b9e0b(0x190)][0x0]['data']()}:null),Promise[_0x7b9e0b(0x17f)]([_0x11b679,_0x3b6079])[_0x7b9e0b(0x16e)](([_0x27bf80,_0x184674])=>{const _0xa1f225=_0x7b9e0b;if(!_0x27bf80){console['error']('No\x20winner\x20found\x20for\x20this\x20match'),alert(_0xa1f225(0x1aa));return;}if(!_0x184674){console[_0xa1f225(0x176)]('No\x20loser\x20found\x20for\x20this\x20match'),alert(_0xa1f225(0x17d));return;}const _0xcdac3=_0x4eb5b9[_0xa1f225(0x151)]!=null?_0x4eb5b9['winnerOldElo']:_0x27bf80['data'][_0xa1f225(0x153)],_0x3ef3d7=_0x4eb5b9['losersOldElo']!=null?_0x4eb5b9[_0xa1f225(0x1cf)]:_0x184674['data']['eloRating'],_0x3b9aff=_0x27bf80['data']['username'],_0x32e6eb=_0x184674[_0xa1f225(0x1bf)]['username'];console['log']('Winner:\x20'+_0x3b9aff+_0xa1f225(0x183)+_0xcdac3+'),\x20Loser:\x20'+_0x32e6eb+'\x20(ELO:\x20'+_0x3ef3d7+')');const _0x50d0bd=document[_0xa1f225(0x15d)](_0xa1f225(0x15a));if(!_0x50d0bd){console['error'](_0xa1f225(0x17b));return;}document['getElementById']('lightbox-winner')['textContent']=_0x3b9aff,document[_0xa1f225(0x15d)](_0xa1f225(0x14b))[_0xa1f225(0x19d)]=_0x32e6eb,document['getElementById']('lightbox-loser-score')['textContent']=_0x4eb5b9[_0xa1f225(0x18d)]||'0',document['getElementById']('lightbox-suicides')['textContent']=_0x4eb5b9['loserSuicides']||'0',document[_0xa1f225(0x15d)](_0xa1f225(0x16c))[_0xa1f225(0x19d)]=_0x4eb5b9['mapPlayed']||_0xa1f225(0x1a6),document['getElementById'](_0xa1f225(0x149))['textContent']=_0x4eb5b9['loserComment']||'No\x20comment',document['getElementById']('lightbox-subgame')['textContent']=_0x4eb5b9['subgameType']||_0xa1f225(0x1d4);const _0x27c2c8=document[_0xa1f225(0x15d)](_0xa1f225(0x1ae));_0x27c2c8&&(_0x27c2c8['value']=_0x1b0652,_0x27c2c8[_0xa1f225(0x1b1)]=!![],_0x27c2c8[_0xa1f225(0x189)]['backgroundColor']=_0xa1f225(0x1c3));showLightbox();const _0x245273=document[_0xa1f225(0x1dd)]('.lightbox-buttons');if(_0x245273){console[_0xa1f225(0x1be)](_0xa1f225(0x1a4),_0x245273);const _0x56fb6e=document['getElementById']('reject-button');_0x56fb6e&&_0x56fb6e['remove']();const _0x1dacbf=document[_0xa1f225(0x17a)]('button');_0x1dacbf['id']='reject-button',_0x1dacbf['className']='button\x20danger-button',_0x1dacbf['textContent']='Reject\x20Match',_0x1dacbf['style']['backgroundColor']='#d32f2f',_0x1dacbf['style']['color']=_0xa1f225(0x17e),_0x1dacbf['style']['marginRight']=_0xa1f225(0x1d2),_0x1dacbf['style'][_0xa1f225(0x14d)]=_0xa1f225(0x1d1),_0x1dacbf['style'][_0xa1f225(0x1d8)]='none',_0x1dacbf['style']['borderRadius']=_0xa1f225(0x1d7),_0x1dacbf[_0xa1f225(0x189)]['cursor']='pointer',_0x1dacbf['style']['fontWeight']='bold',_0x245273['prepend'](_0x1dacbf),console['log']('Reject\x20button\x20added:',_0x1dacbf);}const _0x55f51f=document['getElementById'](_0xa1f225(0x1ab)),_0x59de95=document['getElementById']('reject-button'),_0x27f947=document['getElementById'](_0xa1f225(0x162));if(_0x55f51f){const _0x41fe95=_0x55f51f['cloneNode'](!![]);_0x55f51f['parentNode']['replaceChild'](_0x41fe95,_0x55f51f),_0x41fe95['addEventListener'](_0xa1f225(0x143),async function(){const _0x171c2a=_0xa1f225;try{const _0x5e1b4d=document[_0x171c2a(0x15d)]('winner-score')[_0x171c2a(0x147)],_0x4b9cb4=document[_0x171c2a(0x15d)](_0x171c2a(0x194))['value']||'0',_0x4d4cbf=document['getElementById']('winner-comment')['value']||'';console['log'](_0x171c2a(0x1d3),{'uid':auth['currentUser']?.['uid'],'email':auth['currentUser']?.[_0x171c2a(0x144)],'isAdmin':auth[_0x171c2a(0x157)]?.['email']==='admin@ladder.com'||auth[_0x171c2a(0x157)]?.[_0x171c2a(0x144)]===_0x171c2a(0x1c9)});const _0x4d8a3a=_0x4eb5b9[_0x171c2a(0x1b2)]||currentGameMode;if(_0x4d8a3a==='D3')await approveReportD3(_0x4eb5b9['id'],_0x5e1b4d,_0x4b9cb4,_0x4d4cbf);else _0x4d8a3a==='D2'?await approveReportD2(_0x4eb5b9['id'],_0x5e1b4d,_0x4b9cb4,_0x4d4cbf):await approveReport(_0x4eb5b9['id'],_0x5e1b4d,_0x4b9cb4,_0x4d4cbf);document['getElementById']('report-lightbox')['style']['display']='none',alert('Match\x20approved\x20successfully'),updatePendingMatchNotification(),location[_0x171c2a(0x1b5)]();const _0x1aa37b=_0x4d8a3a==='D1'?'players':'playersD2',_0x3bd3be=doc(db,_0x1aa37b,_0x27bf80['id']),_0x3230e8=doc(db,_0x1aa37b,_0x184674['id']),[_0x15e56b,_0x3dfb31]=await Promise['all']([getDoc(_0x3bd3be),getDoc(_0x3230e8)]);if(_0x15e56b['exists']()&&_0x3dfb31['exists']()){const _0x3a4ce6=_0x15e56b[_0x171c2a(0x1bf)](),_0x1c3daa=_0x3dfb31['data']();_0x3a4ce6['position']>_0x1c3daa['position']?(await updateDoc(_0x3bd3be,{'position':_0x1c3daa['position']}),console[_0x171c2a(0x1be)]('Winner\x20'+_0x3a4ce6[_0x171c2a(0x148)]+_0x171c2a(0x166)+_0x1c3daa['position'])):console[_0x171c2a(0x1be)]('No\x20position\x20change\x20needed;\x20winner\x20is\x20already\x20above\x20the\x20loser.');}}catch(_0xe35255){console['error']('Error\x20approving\x20report:',_0xe35255),alert('Error\x20approving\x20match:\x20'+_0xe35255[_0x171c2a(0x14c)]);}});}if(_0x59de95){const _0x55c76e=_0x59de95['cloneNode'](!![]);_0x59de95['parentNode']['replaceChild'](_0x55c76e,_0x59de95),_0x55c76e['addEventListener']('click',async function(){const _0x2fd3ad=_0xa1f225;try{const _0x1f0702=prompt('Please\x20provide\x20a\x20reason\x20for\x20rejecting\x20this\x20match\x20report:','');if(_0x1f0702===null)return;await rejectReport(_0x4eb5b9['id'],_0x1f0702),hideLightbox(),alert('Match\x20report\x20rejected\x20successfully'),updatePendingMatchNotification(),location['reload']();}catch(_0x39452b){console['error']('Error\x20rejecting\x20report:',_0x39452b),alert(_0x2fd3ad(0x1d0)+_0x39452b[_0x2fd3ad(0x14c)]);}});}if(_0x27f947){const _0x3ff64f=_0x27f947[_0xa1f225(0x19b)](!![]);_0x27f947['parentNode']['replaceChild'](_0x3ff64f,_0x27f947),_0x3ff64f['addEventListener']('click',hideLightbox);}})['catch'](_0x1176c7=>{console['error']('Error\x20processing\x20player\x20data:',_0x1176c7),alert('Error\x20fetching\x20player\x20data.\x20Please\x20try\x20again.');});}}function showLightbox(){const _0x1a6d55=a47_0x52e2;console['log'](_0x1a6d55(0x16a));const _0x532891=document['getElementById']('report-lightbox');if(!_0x532891){console['error'](_0x1a6d55(0x17b));return;}_0x532891['classList']['add']('show');}function hideLightbox(){const _0x1d4c82=a47_0x52e2,_0x5956a1=document[_0x1d4c82(0x15d)](_0x1d4c82(0x15a));_0x5956a1['classList']['remove'](_0x1d4c82(0x1d9));}async function rejectReport(_0xdb1e33,_0x582186){const _0x4db257=a47_0x52e2;try{const _0x7de289=currentGameMode==='D1'?'pendingMatches':currentGameMode==='D2'?'pendingMatchesD2':'pendingMatchesD3',_0x419d16=currentGameMode==='D1'?'RejectedD1':currentGameMode==='D2'?'RejectedD2':'RejectedD3';console['log']('Rejecting\x20match\x20'+_0xdb1e33+'\x20from\x20'+_0x7de289+'\x20to\x20'+_0x419d16);const _0x416e3d=auth['currentUser'];if(!_0x416e3d)throw new Error('You\x20must\x20be\x20logged\x20in\x20to\x20reject\x20a\x20match');const _0x52ca8c=doc(db,_0x7de289,_0xdb1e33),_0x3b4a28=await getDoc(_0x52ca8c);if(!_0x3b4a28['exists']())throw new Error('Match\x20report\x20not\x20found');const _0x549b1e=_0x3b4a28['data'](),_0x4f571b=_0x549b1e['winnerId']&&_0x549b1e['winnerId']===_0x416e3d[_0x4db257(0x146)]||_0x549b1e[_0x4db257(0x18b)]&&_0x549b1e['winnerEmail']===_0x416e3d['email']||_0x549b1e[_0x4db257(0x15f)]&&_0x549b1e['winnerUsername']===await getUsernameFromId(_0x416e3d[_0x4db257(0x146)]);if(!_0x4f571b)throw new Error(_0x4db257(0x1c0));const _0x2e14ed={..._0x549b1e,'rejectedAt':serverTimestamp(),'rejectedBy':_0x416e3d['uid'],'rejectionReason':_0x582186||'No\x20reason\x20provided','originalDocumentId':_0xdb1e33},_0x2cbb9f=doc(collection(db,_0x419d16));return await setDoc(_0x2cbb9f,_0x2e14ed),await deleteDoc(_0x52ca8c),console[_0x4db257(0x1be)]('Match\x20'+_0xdb1e33+'\x20rejected\x20successfully'),updatePendingMatchNotification(),!![];}catch(_0x43472e){console['error']('Error\x20rejecting\x20match:',_0x43472e);throw _0x43472e;}}function a47_0x52e2(_0x5163ec,_0x3f6b15){const _0x391d62=a47_0x1446();return a47_0x52e2=function(_0x338b36,_0x16b24c){_0x338b36=_0x338b36-0x141;let _0x14464a=_0x391d62[_0x338b36];return _0x14464a;},a47_0x52e2(_0x5163ec,_0x3f6b15);}async function getUsernameFromId(_0x9cfc53){const _0x3ee9f8=a47_0x52e2,_0x513f77=await getDoc(doc(db,'players',_0x9cfc53));if(_0x513f77['exists']())return _0x513f77['data']()[_0x3ee9f8(0x148)];const _0x4ca312=await getDoc(doc(db,'playersD2',_0x9cfc53));if(_0x4ca312[_0x3ee9f8(0x1ce)]())return _0x4ca312['data']()[_0x3ee9f8(0x148)];return null;}async function loadOpponentsList(_0x308f3a){const _0x18e054=a47_0x52e2;try{const _0x2e7bf8=document[_0x18e054(0x15d)](_0x18e054(0x14e)),_0x571bca=document[_0x18e054(0x15d)]('loser-username'),_0xc8a76f=document['getElementById']('winner-username');if(!_0x2e7bf8||!_0x571bca||!_0xc8a76f){console['error'](_0x18e054(0x16f));return;}const _0x427d60=currentGameMode==='D1'?_0x18e054(0x1a7):currentGameMode==='D2'?'playersD2':'playersD3';console['log'](_0x18e054(0x186)+_0x427d60);const _0x1a79fc=await getDoc(doc(db,_0x427d60,_0x308f3a));if(!_0x1a79fc['exists']()){_0x2e7bf8['textContent']='You\x20are\x20not\x20registered\x20in\x20the\x20'+currentGameMode+_0x18e054(0x195),_0x2e7bf8['style']['color']='red',_0x571bca[_0x18e054(0x19d)]='Not\x20registered\x20in\x20this\x20ladder',_0xc8a76f['disabled']=!![];return;}const _0x5eb687=_0x1a79fc['data'](),_0x4ba941=_0x5eb687[_0x18e054(0x148)];_0x571bca['textContent']='You\x20('+_0x4ba941+')',_0x2e7bf8['textContent']='',_0xc8a76f['disabled']=![];const _0x24a8da=collection(db,_0x427d60),_0x2ea302=await getDocs(_0x24a8da);if(_0x2ea302['empty']){console['log']('No\x20opponents\x20available');return;}_0xc8a76f[_0x18e054(0x1a9)]='<option\x20value=\x22\x22>Select\x20Opponent</option>',_0x2ea302['forEach'](_0x22f1b4=>{const _0x1512ce=_0x18e054,_0xd99789=_0x22f1b4[_0x1512ce(0x1bf)]();if(_0x22f1b4['id']!==_0x308f3a){const _0xdfb5f9=document['createElement']('option');_0xdfb5f9['value']=_0xd99789['username'],_0xdfb5f9['textContent']=_0xd99789['username'],_0xdfb5f9['dataset']['uid']=_0x22f1b4['id'],_0xc8a76f['appendChild'](_0xdfb5f9);}});}catch(_0x5586ad){console['error'](_0x18e054(0x18a),_0x5586ad),document[_0x18e054(0x15d)](_0x18e054(0x14e))['textContent']='Error\x20loading\x20opponents.\x20Please\x20try\x20again\x20later.',document['getElementById'](_0x18e054(0x14e))['style']['color']='red';}}async function checkUserInLadderAndLoadOpponents(_0x439c51){const _0xad6ccf=a47_0x52e2;try{const _0x45662b=document['getElementById']('report-error'),_0x4e3aed=document['getElementById'](_0xad6ccf(0x1c4)),_0x324a5a=document['getElementById']('winner-username'),_0x3016c8=document[_0xad6ccf(0x15d)](_0xad6ccf(0x191)),_0x15ca3c=document['getElementById'](_0xad6ccf(0x161));_0x45662b[_0xad6ccf(0x19d)]='Checking\x20if\x20you\x20are\x20registered\x20in\x20'+currentGameMode+'\x20ladder...',_0x45662b['style']['color']='white';const _0x24ec14=currentGameMode==='D1'?'players':currentGameMode==='D2'?'playersD2':'playersD3';console['log']('Checking\x20if\x20user\x20exists\x20in\x20collection:\x20'+_0x24ec14);const _0x1e6a11=await getDoc(doc(db,_0x24ec14,_0x439c51));if(!_0x1e6a11['exists']())return _0x45662b['textContent']=_0xad6ccf(0x1b9)+currentGameMode+_0xad6ccf(0x195),_0x45662b[_0xad6ccf(0x189)][_0xad6ccf(0x198)]='red',_0x4e3aed['textContent']='Not\x20registered\x20in\x20this\x20ladder',_0x324a5a['disabled']=!![],_0x324a5a['innerHTML']='<option\x20value=\x22\x22>Select\x20Opponent</option>',_0x15ca3c[_0xad6ccf(0x189)][_0xad6ccf(0x1da)]=_0xad6ccf(0x184),_0x15ca3c['textContent']=_0xad6ccf(0x1b9)+currentGameMode+_0xad6ccf(0x195),![];_0x45662b['textContent']='',_0x15ca3c['style'][_0xad6ccf(0x1da)]='none';const _0x2cc60f=_0x1e6a11['data'](),_0x3e7421=_0x2cc60f[_0xad6ccf(0x148)];_0x4e3aed['textContent']='You\x20('+_0x3e7421+')',_0x324a5a['disabled']=![],_0x3016c8['style']['display']='block',await loadOpponentsList(_0x439c51);const _0x334811=currentGameMode==='D1'?'pendingMatches':currentGameMode==='D2'?_0xad6ccf(0x150):_0xad6ccf(0x174);return await checkForOutstandingReports(_0x2cc60f['email'],null,_0x334811),!![];}catch(_0x4003cc){return console['error']('Error\x20checking\x20if\x20user\x20is\x20in\x20ladder:',_0x4003cc),document['getElementById']('report-error')[_0xad6ccf(0x19d)]='Error\x20checking\x20ladder\x20membership.\x20Please\x20try\x20again\x20later.',document['getElementById']('report-error')[_0xad6ccf(0x189)]['color']='red',![];}}export async function fetchOutstandingMatches(){const _0x57167e=a47_0x52e2,_0x4dae64=auth['currentUser'];if(!_0x4dae64)return[];try{const _0x32cc1e=[],_0x420a7f=currentGameMode==='D1'?'pendingMatches':currentGameMode==='D2'?'pendingMatchesD2':'pendingMatchesD3',_0x4e14af=collection(db,_0x420a7f),_0x31ba00=[query(_0x4e14af,where(_0x57167e(0x165),'==',_0x4dae64['uid']),where('approved','==',![])),query(_0x4e14af,where('loserEmail','==',_0x4dae64['email']),where(_0x57167e(0x19e),'==',![])),query(_0x4e14af,where('winnerId','==',_0x4dae64['uid']),where(_0x57167e(0x19e),'==',![])),query(_0x4e14af,where('winnerEmail','==',_0x4dae64['email']),where('approved','==',![]))],_0x541233=currentGameMode==='D1'?'players':currentGameMode==='D2'?_0x57167e(0x1cc):'playersD3',_0x3de44f=await getDocs(query(collection(db,_0x541233),where(_0x57167e(0x144),'==',_0x4dae64['email'])));let _0x3159f5=null;!_0x3de44f['empty']&&(_0x3159f5=_0x3de44f['docs'][0x0]['data']()[_0x57167e(0x148)],_0x3159f5&&_0x31ba00[_0x57167e(0x14f)](query(_0x4e14af,where('loserUsername','==',_0x3159f5),where('approved','==',![])),query(_0x4e14af,where(_0x57167e(0x15f),'==',_0x3159f5),where('approved','==',![]))));for(const _0x3a00b4 of _0x31ba00){const _0x26aaee=await getDocs(_0x3a00b4);!_0x26aaee[_0x57167e(0x163)]&&_0x26aaee[_0x57167e(0x199)](_0x20dfdd=>{!_0x32cc1e['some'](_0x969645=>_0x969645['id']===_0x20dfdd['id'])&&_0x32cc1e['push']({'id':_0x20dfdd['id'],..._0x20dfdd['data']()});});}return _0x32cc1e['sort']((_0x2e17d7,_0x51d891)=>{const _0x32e1d1=_0x57167e,_0x3186c8=_0x2e17d7['createdAt']?.[_0x32e1d1(0x1b3)]()||new Date(0x0),_0x530ec5=_0x51d891['createdAt']?.[_0x32e1d1(0x1b3)]()||new Date(0x0);return _0x530ec5-_0x3186c8;}),outstandingMatches=_0x32cc1e,_0x32cc1e;}catch(_0x526249){return console[_0x57167e(0x176)]('Error\x20fetching\x20outstanding\x20matches:',_0x526249),[];}}export function renderOutstandingMatches(){const _0x2c10af=a47_0x52e2,_0x11e5d0=document[_0x2c10af(0x15d)]('outstanding-matches-list');if(outstandingMatches['length']===0x0){_0x11e5d0['innerHTML']=_0x2c10af(0x18c);return;}let _0x4dba8c='';const _0xa6edf8=auth[_0x2c10af(0x157)];if(!_0xa6edf8)return;outstandingMatches['forEach'](_0x590c0e=>{const _0x53f230=_0x2c10af,_0x2cb18f=_0x590c0e[_0x53f230(0x168)]?.['toDate']()?_0x590c0e['createdAt']['toDate']()['toLocaleDateString']():_0x53f230(0x1b7),_0x46bc5e=_0x590c0e['loserEmail']===_0xa6edf8['email']||_0x590c0e['loserId']===_0xa6edf8['uid'];_0x4dba8c+='\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22match-item\x22\x20data-id=\x22'+_0x590c0e['id']+_0x53f230(0x1c6)+(_0x590c0e['winnerUsername']||'Winner')+'\x20vs\x20'+(_0x590c0e[_0x53f230(0x1d5)]||'Loser')+_0x53f230(0x1b0)+(_0x590c0e['mapPlayed']||_0x53f230(0x1ba))+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22match-detail-item\x22>Date:\x20'+_0x2cb18f+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22match-detail-item\x22>Score:\x20?\x20-\x20'+(_0x590c0e[_0x53f230(0x18d)]||'0')+_0x53f230(0x1b4)+_0x590c0e['id']+_0x53f230(0x14a)+(_0x46bc5e?'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20edit-report-btn\x22\x20data-id=\x22'+_0x590c0e['id']+'\x22>Edit\x20Report</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20danger-button\x20rescind-report-btn\x22\x20data-id=\x22'+_0x590c0e['id']+'\x22>Rescind\x20Report</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20':'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';}),_0x11e5d0['innerHTML']=_0x4dba8c,document['querySelectorAll']('.view-detail-btn')['forEach'](_0x28ed03=>{const _0x2ce3e3=_0x2c10af;_0x28ed03[_0x2ce3e3(0x187)](_0x2ce3e3(0x143),function(){const _0x2acded=_0x2ce3e3,_0x1f3c7e=this['getAttribute'](_0x2acded(0x173)),_0x3599fc=outstandingMatches['find'](_0x1697b=>_0x1697b['id']===_0x1f3c7e);document[_0x2acded(0x15d)]('outstanding-modal')[_0x2acded(0x169)]['remove']('show'),showMatchLightbox(_0x3599fc);});}),document['querySelectorAll']('.edit-report-btn')['forEach'](_0x458c99=>{const _0x12965e=_0x2c10af;_0x458c99['addEventListener'](_0x12965e(0x143),function(){const _0x3a8860=_0x12965e,_0x22be0a=this[_0x3a8860(0x177)]('data-id'),_0x10b285=outstandingMatches['find'](_0x4dd8d0=>_0x4dd8d0['id']===_0x22be0a);document['getElementById']('outstanding-modal')['classList'][_0x3a8860(0x196)]('show'),editReport(_0x10b285);});}),document['querySelectorAll']('.rescind-report-btn')['forEach'](_0x526dcd=>{const _0x2c7e11=_0x2c10af;_0x526dcd['addEventListener'](_0x2c7e11(0x143),function(){const _0x1a342f=this['getAttribute']('data-id'),_0xac47d6=outstandingMatches['find'](_0x1bec76=>_0x1bec76['id']===_0x1a342f);confirm('Are\x20you\x20sure\x20you\x20want\x20to\x20rescind\x20this\x20match\x20report\x20against\x20'+(_0xac47d6['winnerUsername']||'opponent')+'?')&&rescindReport(_0xac47d6);});});}export async function rescindReport(_0x5df61a){const _0x52589b=a47_0x52e2;try{const _0x121488=currentGameMode==='D1'?'pendingMatches':currentGameMode==='D2'?'pendingMatchesD2':'pendingMatchesD3',_0x151422=doc(db,_0x121488,_0x5df61a['id']);await deleteDoc(_0x151422),alert(_0x52589b(0x152)),await fetchOutstandingMatches(),renderOutstandingMatches();}catch(_0x1f82d2){console['error']('Error\x20rescinding\x20report:',_0x1f82d2),alert('Failed\x20to\x20rescind\x20report.\x20Please\x20try\x20again.');}}export function editReport(_0xee02f0){const _0x4da6bc=a47_0x52e2,_0x1cbef2=document['getElementById']('report-form'),_0x56a77e=document['getElementById']('loser-score'),_0x41adab=document['getElementById'](_0x4da6bc(0x178)),_0x4c2155=document['getElementById']('map-played'),_0x21b1a6=document[_0x4da6bc(0x15d)]('loser-comment');_0x1cbef2['style'][_0x4da6bc(0x1da)]='block',document['getElementById'](_0x4da6bc(0x161))['style'][_0x4da6bc(0x1da)]=_0x4da6bc(0x1ac);if(_0xee02f0[_0x4da6bc(0x18d)])_0x56a77e['value']=_0xee02f0['loserScore'];if(_0xee02f0['loserSuicides'])_0x41adab['value']=_0xee02f0['loserSuicides'];if(_0xee02f0['mapPlayed'])_0x4c2155['value']=_0xee02f0['mapPlayed'];if(_0xee02f0['loserComment'])_0x21b1a6['value']=_0xee02f0[_0x4da6bc(0x1a3)];const _0x3963eb=document['getElementById'](_0x4da6bc(0x17c));_0x3963eb&&_0xee02f0['winnerUsername']&&Array[_0x4da6bc(0x18e)](_0x3963eb[_0x4da6bc(0x142)])[_0x4da6bc(0x199)](_0x10a5eb=>{_0x10a5eb['text']===_0xee02f0['winnerUsername']&&(_0x10a5eb['selected']=!![]);});const _0x34d417=document['getElementById']('subgame-type');_0x34d417&&_0xee02f0[_0x4da6bc(0x159)]&&(_0x34d417[_0x4da6bc(0x147)]=_0xee02f0['subgameType']);_0x1cbef2['setAttribute']('data-edit-id',_0xee02f0['id']);const _0x267b05=_0x1cbef2['querySelector']('button[type=\x22submit\x22]');_0x267b05['textContent']='Update\x20Report';if(!document['getElementById']('cancel-edit-btn')){const _0x1dc76a=document[_0x4da6bc(0x17a)]('button');_0x1dc76a['id']='cancel-edit-btn',_0x1dc76a[_0x4da6bc(0x15c)]='btn',_0x1dc76a['style'][_0x4da6bc(0x179)]=_0x4da6bc(0x1bb),_0x1dc76a['style']['marginRight']=_0x4da6bc(0x1d2),_0x1dc76a['textContent']='Cancel\x20Edit',_0x1dc76a[_0x4da6bc(0x175)]='button',_0x267b05['parentNode']['insertBefore'](_0x1dc76a,_0x267b05),_0x1dc76a['addEventListener'](_0x4da6bc(0x143),function(_0x204a56){const _0x585223=_0x4da6bc;_0x204a56['preventDefault'](),_0x1cbef2['reset'](),_0x1cbef2['removeAttribute'](_0x585223(0x181)),_0x267b05['textContent']='Report\x20Game',this['remove'](),initReportForm();});}_0x1cbef2['scrollIntoView']({'behavior':'smooth'});}function initReportForm(){const _0x32e145=a47_0x52e2;console[_0x32e145(0x1be)](_0x32e145(0x1b8));}export function showMatchLightbox(_0xf4afd8){const _0xfb6106=a47_0x52e2,_0x1a2644=document['getElementById'](_0xfb6106(0x15a));document[_0xfb6106(0x15d)](_0xfb6106(0x154))['textContent']=currentGameMode,document['getElementById'](_0xfb6106(0x19f))['textContent']=_0xf4afd8[_0xfb6106(0x15f)]||_0xfb6106(0x1ba),document[_0xfb6106(0x15d)]('lightbox-loser')[_0xfb6106(0x19d)]=_0xf4afd8['loserUsername']||'Unknown',document[_0xfb6106(0x15d)]('lightbox-loser-score')['textContent']=_0xf4afd8[_0xfb6106(0x18d)]||'0',document['getElementById']('lightbox-suicides')['textContent']=_0xf4afd8['loserSuicides']||'0',document['getElementById']('lightbox-map')[_0xfb6106(0x19d)]=_0xf4afd8['mapPlayed']||'Unknown',document['getElementById']('lightbox-comment')['textContent']=_0xf4afd8[_0xfb6106(0x1a3)]||'No\x20comment',document['getElementById']('lightbox-subgame')['textContent']=_0xf4afd8['subgameType']||_0xfb6106(0x1d4),_0x1a2644[_0xfb6106(0x169)]['add'](_0xfb6106(0x1d9));}export function setCurrentGameMode(_0xaadefe){currentGameMode=_0xaadefe;}export function initOutstandingMatches(){document['addEventListener']('DOMContentLoaded',()=>{const _0x48701e=a47_0x52e2,_0x1e6a51=document[_0x48701e(0x15d)](_0x48701e(0x1a1)),_0x2b044e=document['getElementById'](_0x48701e(0x192)),_0x4fde59=document[_0x48701e(0x15d)]('outstanding-modal'),_0x572e3e=document['getElementById']('close-outstanding-btn'),_0x318968=document['getElementById'](_0x48701e(0x162)),_0x32cdca=document['getElementById']('d1-mode'),_0x476693=document['getElementById'](_0x48701e(0x18f)),_0xd566ed=document['getElementById']('d3-mode');if(_0x32cdca)_0x32cdca['addEventListener'](_0x48701e(0x143),()=>{setCurrentGameMode('D1');});if(_0x476693)_0x476693['addEventListener'](_0x48701e(0x143),()=>{setCurrentGameMode('D2');});if(_0xd566ed)_0xd566ed[_0x48701e(0x187)]('click',()=>{setCurrentGameMode('D3');});auth[_0x48701e(0x1db)](_0x2f7465=>{const _0x3770a3=_0x48701e;_0x2f7465?_0x2b044e['style'][_0x3770a3(0x1da)]=_0x3770a3(0x184):_0x2b044e['style']['display']='none';});_0x1e6a51&&_0x1e6a51['addEventListener']('click',async()=>{const _0x4fbaf2=_0x48701e;_0x4fde59[_0x4fbaf2(0x169)]['add']('show'),document['getElementById']('outstanding-matches-list')['innerHTML']='<div\x20class=\x22loading\x22>Loading\x20your\x20matches...</div>',await fetchOutstandingMatches(),renderOutstandingMatches();});_0x572e3e&&_0x572e3e[_0x48701e(0x187)]('click',()=>{const _0x278bb2=_0x48701e;_0x4fde59[_0x278bb2(0x169)][_0x278bb2(0x196)]('show');});_0x318968&&_0x318968['addEventListener']('click',()=>{const _0x136a60=_0x48701e;document['getElementById'](_0x136a60(0x15a))['classList']['remove']('show');});_0x4fde59&&_0x4fde59['addEventListener']('click',_0x199fc3=>{const _0x2d41b2=_0x48701e;_0x199fc3[_0x2d41b2(0x171)]===_0x4fde59&&_0x4fde59['classList']['remove']('show');});const _0x2cb4eb=document[_0x48701e(0x15d)]('report-lightbox');_0x2cb4eb&&_0x2cb4eb['addEventListener'](_0x48701e(0x143),_0x21ad08=>{const _0x27f295=_0x48701e;_0x21ad08['target']===_0x2cb4eb&&_0x2cb4eb['classList']['remove'](_0x27f295(0x1d9));});const _0x5a9464=document['getElementById']('report-form');if(_0x5a9464){const _0x481ad3=_0x5a9464['onsubmit'];_0x5a9464['onsubmit']=async function(_0x3fd5ae){const _0x2c84d9=_0x48701e;_0x3fd5ae['preventDefault']();const _0x4a0d47=this[_0x2c84d9(0x177)]('data-edit-id');if(_0x4a0d47)try{const _0x467c19=document['getElementById']('loser-score')['value'],_0x10a2af=document['getElementById']('suicides')[_0x2c84d9(0x147)],_0x3f7294=document['getElementById']('map-played')[_0x2c84d9(0x147)],_0x15105d=document['getElementById']('loser-comment')['value'],_0xb678f5=currentGameMode==='D1'?'pendingMatches':currentGameMode==='D2'?'pendingMatchesD2':'pendingMatchesD3',_0x28ceb0=doc(db,_0xb678f5,_0x4a0d47);await updateDoc(_0x28ceb0,{'loserScore':Number(_0x467c19),'loserSuicides':Number(_0x10a2af),'mapPlayed':_0x3f7294,'loserComment':_0x15105d,'subgameType':document[_0x2c84d9(0x15d)](_0x2c84d9(0x1b6))['value'],'updatedAt':new Date()}),alert(_0x2c84d9(0x1c5)),this['reset'](),this['removeAttribute']('data-edit-id');const _0x586841=this['querySelector']('button[type=\x22submit\x22]');_0x586841['textContent']=_0x2c84d9(0x158);const _0x227bd6=document['getElementById']('cancel-edit-btn');if(_0x227bd6)_0x227bd6['remove']();}catch(_0x5bc516){console[_0x2c84d9(0x176)]('Error\x20updating\x20report:',_0x5bc516),document['getElementById'](_0x2c84d9(0x14e))['textContent']=_0x2c84d9(0x1dc);}else typeof _0x481ad3==='function'&&_0x481ad3['call'](this,_0x3fd5ae);};}});}typeof window!=='undefined'&&(window['showMatchLightbox']=showMatchLightbox,window['editReport']=editReport,window['rescindReport']=rescindReport,window['fetchOutstandingMatches']=fetchOutstandingMatches,window['renderOutstandingMatches']=renderOutstandingMatches);initOutstandingMatches();
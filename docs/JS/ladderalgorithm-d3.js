(function(_0x41e1e0,_0x4f37c6){const _0x58dd06=a0_0x5115,_0x1b33bf=_0x41e1e0();while(!![]){try{const _0x482fe0=parseInt(_0x58dd06(0x15c))/0x1*(parseInt(_0x58dd06(0x16c))/0x2)+-parseInt(_0x58dd06(0x15a))/0x3*(parseInt(_0x58dd06(0x15b))/0x4)+-parseInt(_0x58dd06(0x15e))/0x5+parseInt(_0x58dd06(0x157))/0x6*(-parseInt(_0x58dd06(0x15f))/0x7)+parseInt(_0x58dd06(0x15d))/0x8*(parseInt(_0x58dd06(0x175))/0x9)+-parseInt(_0x58dd06(0x165))/0xa+parseInt(_0x58dd06(0x154))/0xb;if(_0x482fe0===_0x4f37c6)break;else _0x1b33bf['push'](_0x1b33bf['shift']());}catch(_0x253108){_0x1b33bf['push'](_0x1b33bf['shift']());}}}(a0_0x249c,0x60b4f));const a0_0x504be5=(function(){let _0x583c95=!![];return function(_0x4062b7,_0x111b5c){const _0x42705d=_0x583c95?function(){const _0x51c27c=a0_0x5115;if(_0x111b5c){const _0x4bf8c0=_0x111b5c[_0x51c27c(0x160)](_0x4062b7,arguments);return _0x111b5c=null,_0x4bf8c0;}}:function(){};return _0x583c95=![],_0x42705d;};}()),a0_0x18ed71=a0_0x504be5(this,function(){const _0x5a97aa=a0_0x5115,_0x4c2b3c=function(){const _0x4f5c42=a0_0x5115;let _0x201c6c;try{_0x201c6c=Function('return\x20(function()\x20'+_0x4f5c42(0x166)+');')();}catch(_0x204720){_0x201c6c=window;}return _0x201c6c;},_0x7c620f=_0x4c2b3c(),_0x168609=_0x7c620f[_0x5a97aa(0x178)]=_0x7c620f['console']||{},_0x463cea=['log','warn',_0x5a97aa(0x16b),'error','exception','table','trace'];for(let _0x279391=0x0;_0x279391<_0x463cea['length'];_0x279391++){const _0x307d4d=a0_0x504be5['constructor']['prototype']['bind'](a0_0x504be5),_0x2a1113=_0x463cea[_0x279391],_0x5364e4=_0x168609[_0x2a1113]||_0x307d4d;_0x307d4d['__proto__']=a0_0x504be5['bind'](a0_0x504be5),_0x307d4d['toString']=_0x5364e4['toString']['bind'](_0x5364e4),_0x168609[_0x2a1113]=_0x307d4d;}});a0_0x18ed71();import{addDoc,updateDoc,serverTimestamp,collection,doc,getDoc,getDocs,query,where,setDoc,deleteDoc,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';import{recordEloChangeD3}from'./elo-history-d3.js';export function calculateEloD3(_0x1065bb,_0x364bf0,_0x55f39f=0x20){const _0x4b7b5e=a0_0x5115,_0x36099e=0x1/(0x1+Math[_0x4b7b5e(0x167)](0xa,(_0x364bf0-_0x1065bb)/0x190)),_0x565161=0x1/(0x1+Math['pow'](0xa,(_0x1065bb-_0x364bf0)/0x190)),_0x1b4dd2=_0x1065bb+_0x55f39f*(0x1-_0x36099e),_0x5dc864=_0x364bf0+_0x55f39f*(0x0-_0x565161);return{'newWinnerRating':Math['round'](_0x1b4dd2),'newLoserRating':Math['round'](_0x5dc864)};}export async function updateEloRatingsD3(_0x4a6c4d,_0x5ee6e2,_0x3a0f5d){const _0x19d9cb=a0_0x5115;try{const _0xa64f10=writeBatch(db),_0x4d3052=doc(db,_0x19d9cb(0x16a),_0x4a6c4d),_0x5b3b34=doc(db,_0x19d9cb(0x16a),_0x5ee6e2),[_0x157c7a,_0x253cc9]=await Promise['all']([getDoc(_0x4d3052),getDoc(_0x5b3b34)]);if(!_0x157c7a['exists']()||!_0x253cc9['exists']())throw new Error(_0x19d9cb(0x159));const _0x109305=_0x157c7a[_0x19d9cb(0x155)](),_0x5d13a3=_0x253cc9['data'](),_0x13efad=_0x109305[_0x19d9cb(0x16e)]||Number[_0x19d9cb(0x171)],_0x3335ad=_0x5d13a3[_0x19d9cb(0x16e)]||Number[_0x19d9cb(0x171)],{newWinnerRating:_0x1aef4c,newLoserRating:_0xf3282b}=calculateEloD3(_0x109305[_0x19d9cb(0x163)]||0x4b0,_0x5d13a3['eloRating']||0x4b0);let _0x19c5ff=_0x13efad,_0x339ecf=_0x3335ad;if(_0x13efad>_0x3335ad){console[_0x19d9cb(0x158)](_0x19d9cb(0x168)),_0x19c5ff=_0x3335ad,_0x339ecf=_0x3335ad+0x1;const _0x2a896b=query(collection(db,_0x19d9cb(0x16a)),where(_0x19d9cb(0x16e),'>',_0x3335ad),where('position','<',_0x13efad)),_0x4bbe46=await getDocs(_0x2a896b);for(const _0x9ccf72 of _0x4bbe46[_0x19d9cb(0x170)]){_0x9ccf72['id']!==_0x4a6c4d&&_0x9ccf72['id']!==_0x5ee6e2&&_0xa64f10['update'](doc(db,'playersD3',_0x9ccf72['id']),{'position':_0x9ccf72['data']()['position']+0x1});}}else console[_0x19d9cb(0x158)](_0x19d9cb(0x16f));return _0xa64f10['update'](_0x4d3052,{'eloRating':_0x1aef4c,'lastMatchDate':serverTimestamp(),'position':_0x19c5ff,'lastMatchId':_0x3a0f5d}),_0xa64f10[_0x19d9cb(0x164)](_0x5b3b34,{'eloRating':_0xf3282b,'lastMatchDate':serverTimestamp(),'position':_0x339ecf,'lastMatchId':_0x3a0f5d}),await _0xa64f10['commit'](),console['log'](_0x19d9cb(0x161)),await Promise['all']([recordEloChangeD3({'playerId':_0x4a6c4d,'previousElo':_0x109305[_0x19d9cb(0x163)]||0x4b0,'newElo':_0x1aef4c,'opponentId':_0x5ee6e2,'matchResult':'win','previousPosition':_0x13efad,'newPosition':_0x19c5ff,'isPromotion':_0x19c5ff<_0x13efad,'matchId':_0x3a0f5d,'timestamp':serverTimestamp()}),recordEloChangeD3({'playerId':_0x5ee6e2,'previousElo':_0x5d13a3['eloRating']||0x4b0,'newElo':_0xf3282b,'opponentId':_0x4a6c4d,'matchResult':'loss','previousPosition':_0x3335ad,'newPosition':_0x339ecf,'isDemotion':_0x339ecf>_0x3335ad,'matchId':_0x3a0f5d,'timestamp':serverTimestamp()})]),!![];}catch(_0x5c0e30){console['error'](_0x19d9cb(0x156),_0x5c0e30);throw _0x5c0e30;}}export async function approveReportD3(_0x1613b3,_0x4a7e62,_0x1d9139,_0xf968ab){const _0xc0b091=a0_0x5115;try{console['log'](_0xc0b091(0x169),{'reportId':_0x1613b3,'winnerScore':_0x4a7e62,'winnerSuicides':_0x1d9139,'winnerComment':_0xf968ab});const _0x1c162e=auth['currentUser'];if(!_0x1c162e){console[_0xc0b091(0x158)]('No\x20user\x20logged\x20in');throw new Error('You\x20must\x20be\x20logged\x20in\x20to\x20approve\x20D3\x20matches');}console['log']('Current\x20user:',_0x1c162e[_0xc0b091(0x176)]);const _0x6c049=await getDoc(doc(db,'playersD3',_0x1c162e['uid'])),_0x371a50=_0x6c049['exists']()?_0x6c049[_0xc0b091(0x155)]()['username']:null;console['log'](_0xc0b091(0x174),_0x371a50);const _0x524d44=doc(db,_0xc0b091(0x162),_0x1613b3),_0x514329=await getDoc(_0x524d44);if(!_0x514329['exists']()){console[_0xc0b091(0x158)](_0xc0b091(0x173),_0x1613b3);throw new Error(_0xc0b091(0x177));}const _0x12f8c0=_0x514329['data']();console['log']('D3\x20Report\x20data:',_0x12f8c0);if(_0x371a50!==_0x12f8c0['winnerUsername'])throw new Error('Only\x20the\x20winner\x20can\x20approve\x20D3\x20matches');const _0x1b4a2a={..._0x12f8c0,'winnerScore':_0x4a7e62,'winnerSuicides':_0x1d9139,'winnerComment':_0xf968ab,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':_0x371a50,'createdAt':_0x12f8c0[_0xc0b091(0x16d)]||serverTimestamp(),'winnerUsername':_0x12f8c0['winnerUsername'],'loserUsername':_0x12f8c0['loserUsername']};await setDoc(doc(db,'approvedMatchesD3',_0x1613b3),_0x1b4a2a),await deleteDoc(_0x524d44),console['log']('D3\x20Match\x20moved\x20to\x20approved\x20collection');const [_0x1d20ff,_0x2c4489]=await Promise['all']([getDocs(query(collection(db,_0xc0b091(0x16a)),where('username','==',_0x12f8c0['winnerUsername']))),getDocs(query(collection(db,_0xc0b091(0x16a)),where('username','==',_0x12f8c0['loserUsername'])))]);if(_0x1d20ff['empty']||_0x2c4489['empty'])throw new Error(_0xc0b091(0x172));const _0x89cacc=_0x1d20ff[_0xc0b091(0x170)][0x0]['id'],_0x4ba015=_0x2c4489[_0xc0b091(0x170)][0x0]['id'];return await updateEloRatingsD3(_0x89cacc,_0x4ba015,_0x1613b3),console['log']('D3\x20Match\x20successfully\x20approved\x20and\x20ELO\x20updated'),!![];}catch(_0x2ae23b){console['error']('Error\x20in\x20approveReportD3:',_0x2ae23b);throw _0x2ae23b;}}function a0_0x5115(_0x18a39d,_0x26decc){const _0x42fb97=a0_0x249c();return a0_0x5115=function(_0x18ed71,_0x504be5){_0x18ed71=_0x18ed71-0x154;let _0x40ef70=_0x42fb97[_0x18ed71];return _0x40ef70;},a0_0x5115(_0x18a39d,_0x26decc);}function a0_0x249c(){const _0x483907=['One\x20or\x20both\x20D3\x20players\x20not\x20found','123990PIqvUu','8ahIyht','1oNBabn','8NFTgyG','119740VGrbJS','35edNknC','apply','D3\x20ELO\x20ratings\x20updated\x20successfully','pendingMatchesD3','eloRating','update','430950yhZhuE','{}.constructor(\x22return\x20this\x22)(\x20)','pow','D3\x20Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked','Starting\x20approveReportD3\x20function\x20with:','playersD3','info','902714QgFgUu','createdAt','position','D3\x20Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions','docs','MAX_SAFE_INTEGER','Could\x20not\x20find\x20D3\x20player\x20documents','D3\x20Report\x20not\x20found\x20with\x20ID:','Current\x20username:','1526535GJcdfp','email','D3\x20match\x20report\x20not\x20found','console','920117WyQORK','data','Error\x20in\x20updateEloRatingsD3:','190566Sedvcj','log'];a0_0x249c=function(){return _0x483907;};return a0_0x249c();}
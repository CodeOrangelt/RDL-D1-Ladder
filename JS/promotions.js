const a43_0x23f07a=a43_0x4905,a43_0x2746e1=(function(){let _0x599834=!![];return function(_0x167f9c,_0x127e93){const _0x2af2b9=_0x599834?function(){if(_0x127e93){const _0x4684e8=_0x127e93['apply'](_0x167f9c,arguments);return _0x127e93=null,_0x4684e8;}}:function(){};return _0x599834=![],_0x2af2b9;};}()),a43_0x8fbfdc=a43_0x2746e1(this,function(){const _0x46509a=a43_0x4905,_0x1b16d3=function(){const _0x47d053=a43_0x4905;let _0x339a17;try{_0x339a17=Function(_0x47d053(0x168)+_0x47d053(0x17e)+');')();}catch(_0xf17c61){_0x339a17=window;}return _0x339a17;},_0x1cb639=_0x1b16d3(),_0xaf98b8=_0x1cb639['console']=_0x1cb639['console']||{},_0x2053dd=['log','warn','info',_0x46509a(0x177),'exception','table',_0x46509a(0x165)];for(let _0x1926b4=0x0;_0x1926b4<_0x2053dd[_0x46509a(0x154)];_0x1926b4++){const _0x436245=a43_0x2746e1['constructor']['prototype'][_0x46509a(0x184)](a43_0x2746e1),_0x43ff49=_0x2053dd[_0x1926b4],_0x49454d=_0xaf98b8[_0x43ff49]||_0x436245;_0x436245[_0x46509a(0x169)]=a43_0x2746e1['bind'](a43_0x2746e1),_0x436245['toString']=_0x49454d['toString']['bind'](_0x49454d),_0xaf98b8[_0x43ff49]=_0x436245;}});function a43_0xbb3c(){const _0x1aae0f=['checkAndRecordPromotion','lastFetchTime','seconds','commit','systemDismissed','Promotion\x20banner\x20container\x20not\x20found','display','getRankName','desc','now','children','parse','split','Unknown\x20Player','shouldShowPromotion','sort','currentUser','source','matchId','Invalid\x20storage\x20format\x20for\x20','none','Don\x27t\x20show\x20again','pollingInterval','You\x27ve\x20been\x20promoted\x20to','add','classList','Rank\x20Update','automatic','userId','showRankChangeBanner','createElement','type','empty','Error\x20resolving\x20username:','initialize','loserUsername','length','\x20→\x20','promotion','appendChild','log','usernameCache','\x20was\x20auto-dismissed\x20within\x20last\x204\x20hours','timestamp','parentNode','winnerId','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22rank-name\x22>','Promotion\x20','className','resolvedName','admin','isAutomatic','sendPromotionNotification','trace','setItem','remove','return\x20(function()\x20','__proto__','ID:','target','email','getItem','name','textContent','Unranked','data','RANKS','addEventListener',')\x20→\x20','date','warn','error','promotion_','div','\x20was\x20promoted\x20to','set','player','ladder','{}.constructor(\x22return\x20this\x22)(\x20)','Fallback\x20write\x20failed:','button','approvedMatches','displayName','A\x20player','bind','Gold','\x20for\x20','eloHistory','Dismiss','bannerContainer','\x20to\x20','adminUser','getElementById','You\x27ve\x20been\x20demoted\x20to','\x27s\x20','innerHTML'];a43_0xbb3c=function(){return _0x1aae0f;};return a43_0xbb3c();}a43_0x8fbfdc();import{collection,doc,query,where,orderBy,limit,getDocs,addDoc,getDoc,serverTimestamp,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{auth,db}from'./firebase-config.js';class PromotionManager{constructor(){const _0x314653=a43_0x4905;this['DISPLAY_HOURS']=0x18,this[_0x314653(0x172)]=[{'threshold':0x578,'name':'Bronze','color':'#CD7F32'},{'threshold':0x640,'name':'Silver','color':'#C0C0C0'},{'threshold':0x708,'name':_0x314653(0x185),'color':'#FFD700'},{'threshold':0x834,'name':'Emerald','color':'#50C878'}],this['bannerContainer']=null,this['lastFetchTime']=0x0,this['fetchInterval']=0xea60,this['pollingInterval']=null,this[_0x314653(0x159)]={};}[a43_0x23f07a(0x152)](){const _0x3cb0bb=a43_0x23f07a;this['bannerContainer']=document['getElementById']('promotion-banner-container');if(!this['bannerContainer']){console['error'](_0x3cb0bb(0x135));return;}this['setupBannerContainer']();const _0x233002='promotions_checked_'+new Date()['toDateString'](),_0x261983=sessionStorage[_0x3cb0bb(0x16d)](_0x233002);!_0x261983&&(this['fetchRecentPromotions'](),sessionStorage['setItem'](_0x233002,'true')),document['addEventListener']('visibilitychange',()=>{document['visibilityState']==='visible'&&!sessionStorage['getItem'](_0x233002)&&(this['fetchRecentPromotions'](),sessionStorage['setItem'](_0x233002,'true'));}),window['addEventListener']('beforeunload',()=>{const _0x50f791=_0x3cb0bb;this[_0x50f791(0x146)]&&clearInterval(this['pollingInterval']);});}['setupBannerContainer'](){const _0x2499d9=a43_0x23f07a;this['bannerContainer']['innerHTML']='',this[_0x2499d9(0x189)]['style']['display']=_0x2499d9(0x144);}async['fetchRecentPromotions'](){const _0x3e44be=a43_0x23f07a;try{const _0x5f4015=Date[_0x3e44be(0x139)]();if(_0x5f4015-this['lastFetchTime']<this['fetchInterval'])return;this[_0x3e44be(0x131)]=_0x5f4015;const _0x245990=collection(db,'eloHistory'),_0x5dea5b=query(_0x245990,where(_0x3e44be(0x14f),'in',['promotion','demotion']),orderBy(_0x3e44be(0x15b),_0x3e44be(0x138)),limit(0x14)),_0x4f8219=await getDocs(_0x5dea5b),_0x2907ee=[];_0x4f8219['forEach'](_0x291519=>{const _0x14e192=_0x3e44be,_0x58136f={'id':_0x291519['id'],..._0x291519['data']()};this[_0x14e192(0x13e)](_0x291519['id'])&&this['isNewRankChange'](_0x58136f)&&_0x2907ee['push'](_0x58136f);}),_0x2907ee['length']>0x0&&await this['processRankChanges'](_0x2907ee);}catch(_0x209920){console['error']('Error\x20fetching\x20promotions:',_0x209920);}}async['processRankChanges'](_0x2d8abe){const _0x138073=a43_0x23f07a;if(_0x2d8abe[_0x138073(0x154)]===0x0)return;_0x2d8abe[_0x138073(0x13f)]((_0x1671a0,_0xa68567)=>{const _0x1a9da0=_0x138073,_0x2cee25=_0x1671a0['timestamp']?.['toMillis']?.()||_0x1671a0['timestamp']?.['seconds']*0x3e8||0x0,_0x501e26=_0xa68567[_0x1a9da0(0x15b)]?.['toMillis']?.()||_0xa68567[_0x1a9da0(0x15b)]?.[_0x1a9da0(0x132)]*0x3e8||0x0;return _0x501e26-_0x2cee25;});const _0x22e3a9=this[_0x138073(0x189)][_0x138073(0x13a)]['length'],_0x4b970b=0x3-_0x22e3a9;if(_0x4b970b<=0x0)return;const _0x586e79=_0x2d8abe['slice'](0x0,_0x4b970b);for(let _0x5bda71=0x0;_0x5bda71<_0x586e79['length'];_0x5bda71++){const _0x2fdea1=_0x586e79[_0x5bda71],_0x58f4df=auth['currentUser'];try{setTimeout(()=>{const _0x314139=_0x138073;this[_0x314139(0x14d)](_0x2fdea1);},_0x5bda71*0x3e8),_0x58f4df&&_0x2fdea1[_0x138073(0x17c)]===_0x58f4df['displayName']&&this['showRankChangeLightbox'](_0x2fdea1['type'],_0x2fdea1['rankAchieved']);}catch(_0x5248bc){console[_0x138073(0x177)]('Error\x20processing\x20rank\x20change:',_0x5248bc);}}}['shouldShowPromotion'](_0x3a45dc){const _0x2ccb0e=a43_0x23f07a;try{const _0x274d94='promotion_'+_0x3a45dc,_0x46b7b0=localStorage[_0x2ccb0e(0x16d)](_0x274d94);if(_0x46b7b0){let _0x277178;try{_0x277178=JSON['parse'](_0x46b7b0);}catch(_0x1c2e54){return console['warn'](_0x2ccb0e(0x143)+_0x274d94+',\x20treating\x20as\x20new'),!![];}if(_0x277178['ignored']===!![])return console['log'](_0x2ccb0e(0x15f)+_0x3a45dc+'\x20is\x20permanently\x20ignored'),![];const _0x546b29=Date['now']();if(_0x277178['userDismissed']&&_0x546b29-_0x277178['timestamp']<this['DISPLAY_HOURS']*0x3c*0x3c*0x3e8)return console['log'](_0x2ccb0e(0x15f)+_0x3a45dc+'\x20was\x20dismissed\x20by\x20user\x20within\x20last\x20'+this['DISPLAY_HOURS']+'\x20hours'),![];if(_0x277178[_0x2ccb0e(0x134)]&&_0x546b29-_0x277178['timestamp']<0x4*0x3c*0x3c*0x3e8)return console[_0x2ccb0e(0x158)]('Promotion\x20'+_0x3a45dc+_0x2ccb0e(0x15a)),![];}return!![];}catch(_0x2c9c28){return console[_0x2ccb0e(0x177)]('Error\x20checking\x20promotion\x20visibility:',_0x2c9c28),![];}}['ignorePromotion'](_0x441589){const _0xc5ed2e=a43_0x23f07a;try{const _0x5500b6='promotion_'+_0x441589;localStorage['setItem'](_0x5500b6,JSON['stringify']({'timestamp':Date[_0xc5ed2e(0x139)](),'ignored':!![]}));}catch(_0x29e692){console[_0xc5ed2e(0x177)]('Error\x20saving\x20promotion\x20preference:',_0x29e692);}}[a43_0x23f07a(0x14d)](_0x41ec2d){this['resolveUserId'](_0x41ec2d)['then'](_0x37f03e=>{const _0x59514a=a43_0x4905,_0x567fad=_0x59514a(0x178)+_0x41ec2d['id'],_0x5fbf65=localStorage[_0x59514a(0x16d)](_0x567fad);if(_0x5fbf65)try{const _0x16e8d8=JSON[_0x59514a(0x13b)](_0x5fbf65);if(_0x16e8d8['ignored']===!![]){console[_0x59514a(0x158)]('Skipping\x20ignored\x20promotion:\x20'+_0x41ec2d['id']);return;}}catch(_0x306a76){}localStorage[_0x59514a(0x166)](_0x567fad,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':![],'seenAt':Date[_0x59514a(0x139)]()})),this['bannerContainer']['style'][_0x59514a(0x136)]='block';while(this[_0x59514a(0x189)]['children']['length']>=0x3){this['bannerContainer']['removeChild'](this[_0x59514a(0x189)]['firstChild']);}const _0x304b9b=document['createElement'](_0x59514a(0x179));_0x304b9b[_0x59514a(0x160)]='promotion-banner',_0x304b9b['setAttribute']('data-rank',_0x37f03e['rankAchieved']),_0x304b9b['setAttribute']('data-id',_0x37f03e['id']);const _0x567bee=document['createElement']('div');_0x567bee[_0x59514a(0x160)]='promotion-details';const _0x3675c4=_0x37f03e[_0x59514a(0x161)]||_0x37f03e[_0x59514a(0x17c)]||_0x37f03e['username']||_0x37f03e['playerUsername']||_0x37f03e['displayName']||'A\x20player',_0x43fc6a=_0x37f03e['type']===_0x59514a(0x156)?_0x3675c4+_0x59514a(0x17a):_0x3675c4+'\x20was\x20demoted\x20to';_0x567bee[_0x59514a(0x18f)]=_0x43fc6a+'\x20<span\x20class=\x22rank-text\x22>'+_0x37f03e['rankAchieved']+'</span>';const _0x43b0ee=document['createElement']('div');_0x43b0ee['className']='banner-actions';const _0x1cd176=document['createElement']('button');_0x1cd176['className']='dismiss-btn',_0x1cd176[_0x59514a(0x18f)]='&times;',_0x1cd176['title']=_0x59514a(0x188);const _0x248854=document['createElement'](_0x59514a(0x180));_0x248854[_0x59514a(0x160)]='ignore-btn',_0x248854[_0x59514a(0x16f)]=_0x59514a(0x145),_0x248854['title']='Never\x20show\x20this\x20promotion\x20again',_0x43b0ee[_0x59514a(0x157)](_0x248854),_0x43b0ee[_0x59514a(0x157)](_0x1cd176),_0x304b9b['appendChild'](_0x567bee),_0x304b9b['appendChild'](_0x43b0ee),this['bannerContainer'][_0x59514a(0x157)](_0x304b9b),void _0x304b9b['offsetWidth'],setTimeout(()=>{_0x304b9b['classList']['add']('new-rank-change');},0x32),_0x1cd176[_0x59514a(0x173)]('click',()=>{const _0x3c4c5d=_0x59514a;localStorage['setItem'](_0x567fad,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':!![],'systemDismissed':![]})),_0x304b9b[_0x3c4c5d(0x149)][_0x3c4c5d(0x167)]('new-rank-change'),_0x304b9b['classList'][_0x3c4c5d(0x148)]('dismissing'),setTimeout(()=>{const _0x423b7f=_0x3c4c5d;_0x304b9b[_0x423b7f(0x15c)]&&(_0x304b9b['remove'](),this['bannerContainer'][_0x423b7f(0x13a)]['length']===0x0&&(this['bannerContainer']['style']['display']='none'));},0x1f4);}),_0x248854[_0x59514a(0x173)]('click',()=>{const _0x2a92e3=_0x59514a;localStorage['setItem'](_0x567fad,JSON['stringify']({'timestamp':Date[_0x2a92e3(0x139)](),'ignored':!![],'userDismissed':!![],'systemDismissed':![]})),_0x304b9b['classList']['remove']('new-rank-change'),_0x304b9b['classList']['add']('dismissing'),setTimeout(()=>{const _0x3c2b8c=_0x2a92e3;_0x304b9b[_0x3c2b8c(0x15c)]&&(_0x304b9b[_0x3c2b8c(0x167)](),this['bannerContainer'][_0x3c2b8c(0x13a)]['length']===0x0&&(this['bannerContainer']['style'][_0x3c2b8c(0x136)]=_0x3c2b8c(0x144)));},0x1f4);}),setTimeout(()=>{const _0x38884f=_0x59514a;_0x304b9b['parentNode']&&(_0x304b9b['classList']['remove']('new-rank-change'),_0x304b9b['classList'][_0x38884f(0x148)]('dismissing'),localStorage['setItem'](_0x567fad,JSON['stringify']({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':!![]})),setTimeout(()=>{const _0x4f2885=_0x38884f;_0x304b9b['parentNode']&&(_0x304b9b[_0x4f2885(0x167)](),this[_0x4f2885(0x189)]['children'][_0x4f2885(0x154)]===0x0&&(this['bannerContainer']['style']['display']='none'));},0x1f4));},0x3a98);});}async['resolveUserId'](_0x389f05){const _0x46f4c2=a43_0x23f07a,_0x6ba20c={..._0x389f05},_0x242ed7=[_0x389f05[_0x46f4c2(0x17c)],_0x389f05['username'],_0x389f05['playerUsername'],_0x389f05['displayName']],_0x227080=_0x242ed7['some'](_0x1930e4=>_0x1930e4&&typeof _0x1930e4==='string'&&!_0x1930e4['includes'](_0x46f4c2(0x16a))&&!/^[a-zA-Z0-9]{20,}$/['test'](_0x1930e4));if(_0x227080)return _0x6ba20c;let _0x4cc28a=null;if(_0x389f05[_0x46f4c2(0x14c)])_0x4cc28a=_0x389f05['userId'];else _0x389f05['player']&&/^[A-Za-z0-9]{20,}$/['test'](_0x389f05[_0x46f4c2(0x17c)])&&(_0x4cc28a=_0x389f05['player']);if(!_0x4cc28a)return _0x6ba20c;try{const _0x21c48e=await getDoc(doc(db,'players',_0x4cc28a));if(_0x21c48e['exists']()){const _0x38a154=_0x21c48e['data']();if(_0x38a154['username'])return _0x6ba20c['resolvedName']=_0x38a154['username'],_0x6ba20c;}const _0x15afef=await getDocs(query(collection(db,'approvedMatches'),where('winnerId','==',_0x4cc28a),orderBy('date','desc'),limit(0x1)));if(!_0x15afef['empty']){const _0x5c0acf=_0x15afef['docs'][0x0]['data']();if(_0x5c0acf['winnerUsername'])return _0x6ba20c['resolvedName']=_0x5c0acf['winnerUsername'],_0x6ba20c;}const _0x3b7a6d=await getDocs(query(collection(db,'approvedMatches'),where('loserId','==',_0x4cc28a),orderBy(_0x46f4c2(0x175),'desc'),limit(0x1)));if(!_0x3b7a6d['empty']){const _0xffa298=_0x3b7a6d['docs'][0x0]['data']();if(_0xffa298['loserUsername'])return _0x6ba20c['resolvedName']=_0xffa298['loserUsername'],console['log']('Resolved\x20'+_0x4cc28a+_0x46f4c2(0x18a)+_0xffa298[_0x46f4c2(0x153)]+'\x20(loser)'),_0x6ba20c;}}catch(_0x43aea9){console['error']('Error\x20resolving\x20user\x20ID:',_0x43aea9);}return console['warn']('Failed\x20to\x20resolve\x20user\x20ID:\x20'+_0x4cc28a),_0x6ba20c;}['showRankChangeLightbox'](_0x664948,_0x473060){const _0x251ab2=a43_0x23f07a;let _0x297081=document[_0x251ab2(0x18c)]('rankChangeModal');!_0x297081&&(_0x297081=document[_0x251ab2(0x14e)]('div'),_0x297081['id']='rankChangeModal',_0x297081['className']='rank-change-modal\x20'+_0x664948,document['body']['appendChild'](_0x297081));const _0x4a9bec=_0x664948===_0x251ab2(0x156)?'Congratulations!':_0x251ab2(0x14a),_0x43773c=_0x664948==='promotion'?_0x251ab2(0x147):_0x251ab2(0x18d);_0x297081['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rank-change-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2\x20class=\x22rank-change-title\x22>'+_0x4a9bec+'</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>'+_0x43773c+_0x251ab2(0x15e)+_0x473060+'</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22rank-change-button\x22\x20id=\x22rank-change-ok-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Got\x20it!\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x297081['style'][_0x251ab2(0x136)]='flex',document['getElementById']('rank-change-ok-btn')[_0x251ab2(0x173)]('click',()=>{const _0x34987a=_0x251ab2;_0x297081['style'][_0x34987a(0x136)]='none';}),_0x297081['addEventListener']('click',_0x4f94c9=>{const _0x235569=_0x251ab2;_0x4f94c9[_0x235569(0x16b)]===_0x297081&&(_0x297081['style']['display']='none');});}async['checkAndRecordPromotion'](_0x541f12,_0x3c6a38,_0x208df1,_0x1e9e42={}){const _0xf84320=a43_0x23f07a;try{if(_0x3c6a38===_0x208df1||!_0x541f12)return null;const _0x47eb48=_0x1e9e42[_0xf84320(0x141)]||'automatic',_0x49783b=_0x1e9e42['matchId']||null,_0x57f644=_0x1e9e42[_0xf84320(0x18b)]||null;console[_0xf84320(0x158)]('Processing\x20potential\x20rank\x20change:\x20'+_0x208df1+_0xf84320(0x155)+_0x3c6a38+'\x20(source:\x20'+_0x47eb48+')');let _0x55f7b9=null,_0x46fa5d=null;try{const _0x5e0089=await getDoc(doc(db,'players',_0x541f12));if(_0x5e0089['exists']()){const _0x45a19e=_0x5e0089['data']();_0x55f7b9=_0x45a19e['username']||_0x45a19e['displayName']||null,_0x46fa5d=_0x45a19e['displayName']||_0x45a19e['username']||null;}!_0x55f7b9&&_0x1e9e42['username']&&(_0x55f7b9=_0x1e9e42['username'],_0x46fa5d=_0x1e9e42['username']);!_0x55f7b9&&auth['currentUser']&&(_0x55f7b9=auth['currentUser'][_0xf84320(0x182)]||auth['currentUser'][_0xf84320(0x16c)][_0xf84320(0x13c)]('@')[0x0],_0x46fa5d=auth[_0xf84320(0x140)]['displayName']||null);if(!_0x55f7b9){const _0x52e505=query(collection(db,_0xf84320(0x181)),where(_0xf84320(0x15d),'==',_0x541f12),limit(0x1)),_0x2552f7=await getDocs(_0x52e505);if(!_0x2552f7[_0xf84320(0x150)])_0x55f7b9=_0x2552f7['docs'][0x0]['data']()['winnerUsername']||_0xf84320(0x13d),_0x46fa5d=_0x55f7b9;else{const _0x593ad4=query(collection(db,'approvedMatches'),where('loserId','==',_0x541f12),limit(0x1)),_0xe4504e=await getDocs(_0x593ad4);!_0xe4504e['empty']&&(_0x55f7b9=_0xe4504e[0x0][_0xf84320(0x171)]()['loserUsername']||'Unknown\x20Player',_0x46fa5d=_0x55f7b9);}}}catch(_0x4e771b){console[_0xf84320(0x177)](_0xf84320(0x151),_0x4e771b);}!_0x55f7b9&&(console[_0xf84320(0x176)]('Could\x20not\x20resolve\x20username\x20for\x20userId:',_0x541f12),_0x55f7b9=_0xf84320(0x183),_0x46fa5d='Unknown\x20Player');const _0x527b27=this['getRankName'](_0x208df1),_0x3d3a52=this['getRankName'](_0x3c6a38);if(_0x527b27!==_0x3d3a52){const _0x2d5718=_0x3c6a38>_0x208df1,_0x40be60=_0x2d5718?_0xf84320(0x156):'demotion',_0x3254f7=_0x3d3a52;console['log']('Recording\x20'+_0x40be60+'\x20for\x20'+_0x55f7b9+':\x20'+_0x208df1+'\x20('+_0x527b27+_0xf84320(0x174)+_0x3c6a38+'\x20('+_0x3d3a52+')');try{const _0x1d6f8a={'player':_0x55f7b9,'playerUsername':_0x55f7b9,'username':_0x55f7b9,'displayName':_0x46fa5d,'userId':_0x541f12,'type':_0x40be60,'rankAchieved':_0x3254f7,'timestamp':serverTimestamp(),'previousElo':_0x208df1,'newElo':_0x3c6a38,'change':_0x3c6a38-_0x208df1,'previousRank':_0x527b27,'newRank':_0x3d3a52,'source':_0x47eb48};if(_0x47eb48==='match'&&_0x49783b)_0x1d6f8a['matchId']=_0x49783b;else _0x47eb48===_0xf84320(0x162)&&_0x57f644?(_0x1d6f8a['modifiedBy']=_0x57f644,_0x1d6f8a[_0xf84320(0x163)]=![]):_0x1d6f8a['isAutomatic']=!![];const _0x14f849=writeBatch(db),_0x4c0f90=doc(collection(db,_0xf84320(0x187))),_0x78a87f=doc(collection(db,'promotionHistory'));return _0x14f849[_0xf84320(0x17b)](_0x4c0f90,_0x1d6f8a),_0x14f849[_0xf84320(0x17b)](_0x78a87f,_0x1d6f8a),await _0x14f849[_0xf84320(0x133)](),await this['sendPromotionNotification'](_0x541f12,_0x55f7b9,_0x208df1,_0x3c6a38,_0x527b27,_0x3d3a52,_0x40be60,{'displayName':_0x46fa5d,'source':_0x47eb48,'matchId':_0x49783b,'ladder':_0x1e9e42['ladder']||'D1'}),console['log']('Successfully\x20recorded\x20'+_0x40be60+_0xf84320(0x186)+_0x55f7b9+'\x20to\x20'+_0x3254f7),_0x3254f7;}catch(_0x1e6a56){console['error']('Error\x20writing\x20promotion\x20records:',_0x1e6a56);try{return await addDoc(collection(db,'eloHistory'),{'player':_0x55f7b9,'playerUsername':_0x55f7b9,'username':_0x55f7b9,'displayName':_0x46fa5d,'userId':_0x541f12,'type':_0x40be60,'rankAchieved':_0x3254f7,'timestamp':serverTimestamp(),'previousElo':_0x208df1,'newElo':_0x3c6a38,'change':_0x3c6a38-_0x208df1,'previousRank':_0x527b27,'source':_0x47eb48,'isAutomatic':_0x47eb48!=='admin'}),await this['sendPromotionNotification'](_0x541f12,_0x55f7b9,_0x208df1,_0x3c6a38,_0x527b27,_0x3d3a52,_0x40be60,{'displayName':_0x46fa5d,'source':_0x47eb48,'matchId':_0x49783b,'ladder':_0x1e9e42['ladder']||'D1'}),_0x3254f7;}catch(_0x341d24){return console['error'](_0xf84320(0x17f),_0x341d24),null;}}}return null;}catch(_0x337d45){return console[_0xf84320(0x177)]('Error\x20in\x20promotion/demotion\x20recording:',_0x337d45),null;}}[a43_0x23f07a(0x137)](_0x4c76b5){const _0x441f9f=a43_0x23f07a;for(let _0x326f0a=this['RANKS'][_0x441f9f(0x154)]-0x1;_0x326f0a>=0x0;_0x326f0a--){if(_0x4c76b5>=this[_0x441f9f(0x172)][_0x326f0a]['threshold'])return this[_0x441f9f(0x172)][_0x326f0a][_0x441f9f(0x16e)];}return _0x441f9f(0x170);}['cleanup'](){this['pollingInterval']&&clearInterval(this['pollingInterval']);}['isNewRankChange'](_0x576097){const _0x1c4418=a43_0x23f07a;if(_0x576097['timestamp']){const _0x5e2989=_0x576097['timestamp']['seconds']*0x3e8,_0x2a1496=Date[_0x1c4418(0x139)](),_0x50026f=(_0x2a1496-_0x5e2989)/(0x3e8*0x3c*0x3c);if(_0x50026f>0x18)return![];}if(_0x576097['previousRank']&&_0x576097['newRank']&&_0x576097['previousRank']!==_0x576097['newRank'])return!![];return![];}async[a43_0x23f07a(0x164)](_0x28a85e,_0x58a292,_0x40b774,_0x32a8ec,_0x509666,_0x31ea9d,_0x4deea1,_0x1374dd={}){const _0x1e752b=a43_0x23f07a;try{console[_0x1e752b(0x158)]('STARTING\x20notification\x20for\x20'+_0x58a292+_0x1e752b(0x18e)+_0x4deea1);const _0x3a4966={'userId':_0x28a85e,'username':_0x58a292,'displayName':_0x1374dd[_0x1e752b(0x182)]||_0x58a292,'oldElo':parseInt(_0x40b774),'newElo':parseInt(_0x32a8ec),'eloDifference':parseInt(_0x32a8ec)-parseInt(_0x40b774),'oldRank':_0x509666,'newRank':_0x31ea9d,'type':_0x4deea1,'timestamp':serverTimestamp(),'processed':![],'source':_0x1374dd['source']||_0x1e752b(0x14b),'matchId':_0x1374dd[_0x1e752b(0x142)]||null,'ladder':_0x1374dd[_0x1e752b(0x17d)]||'D1','adminUser':_0x1374dd['adminUser']||null};console[_0x1e752b(0x158)]('Creating\x20Discord\x20notification:',_0x3a4966);const _0x19f362=await addDoc(collection(db,'promotionNotifications'),_0x3a4966);return console['log']('Discord\x20notification\x20sent\x20successfully\x20with\x20ID:\x20'+_0x19f362['id']),!![];}catch(_0x5025e7){return console['error']('Error\x20sending\x20Discord\x20notification:',_0x5025e7),![];}}}function a43_0x4905(_0x53c44f,_0x3330c3){const _0x8fbfdc=a43_0xbb3c();return a43_0x4905=function(_0x2746e1,_0x49caa6){_0x2746e1=_0x2746e1-0x130;let _0xbb3c7=_0x8fbfdc[_0x2746e1];return _0xbb3c7;},a43_0x4905(_0x53c44f,_0x3330c3);}export const promotionManager=new PromotionManager();document['addEventListener']('DOMContentLoaded',()=>{promotionManager['initialize']();});export const initializePromotionTracker=()=>promotionManager['initialize']();export const checkAndRecordPromotion=(_0x247e40,_0x2627b5,_0x45a1d,_0x31c0e2)=>promotionManager[a43_0x23f07a(0x130)](_0x247e40,_0x2627b5,_0x45a1d,_0x31c0e2);export const getRankName=_0x4f971a=>promotionManager['getRankName'](_0x4f971a);
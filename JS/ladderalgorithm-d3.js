function a29_0x563a(_0x73da1e,_0x400a70){const _0x1a70e8=a29_0x540c();return a29_0x563a=function(_0x303cb6,_0x57daeb){_0x303cb6=_0x303cb6-0x10a;let _0x540c05=_0x1a70e8[_0x303cb6];return _0x540c05;},a29_0x563a(_0x73da1e,_0x400a70);}const a29_0x303cb6=(function(){let _0x1ce5a2=!![];return function(_0x5d4d3b,_0x4942c2){const _0x441d8d=_0x1ce5a2?function(){if(_0x4942c2){const _0x422c93=_0x4942c2['apply'](_0x5d4d3b,arguments);return _0x4942c2=null,_0x422c93;}}:function(){};return _0x1ce5a2=![],_0x441d8d;};}()),a29_0x1a70e8=a29_0x303cb6(this,function(){const _0x41ffa2=a29_0x563a,_0x3ac269=function(){let _0x515671;try{_0x515671=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x544a04){_0x515671=window;}return _0x515671;},_0x2d5fe2=_0x3ac269(),_0x239650=_0x2d5fe2[_0x41ffa2(0x116)]=_0x2d5fe2['console']||{},_0x45a558=[_0x41ffa2(0x10f),'warn','info','error','exception','table','trace'];for(let _0x126736=0x0;_0x126736<_0x45a558['length'];_0x126736++){const _0x51190a=a29_0x303cb6['constructor']['prototype']['bind'](a29_0x303cb6),_0x188108=_0x45a558[_0x126736],_0x389c42=_0x239650[_0x188108]||_0x51190a;_0x51190a['__proto__']=a29_0x303cb6['bind'](a29_0x303cb6),_0x51190a['toString']=_0x389c42['toString']['bind'](_0x389c42),_0x239650[_0x188108]=_0x51190a;}});a29_0x1a70e8();import{addDoc,updateDoc,serverTimestamp,collection,doc,getDoc,getDocs,query,where,setDoc,deleteDoc,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';import{recordEloChangeD3}from'./elo-history-d3.js';function a29_0x540c(){const _0x115083=['empty','D3\x20Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions','pendingMatchesD3','update','email','log','error','all','round','position','You\x20must\x20be\x20logged\x20in\x20to\x20approve\x20D3\x20matches','uid','console','winnerUsername','pow','data','username','docs','playersD3'];a29_0x540c=function(){return _0x115083;};return a29_0x540c();}export function calculateEloD3(_0xa85e70,_0xba1107,_0x155a2e=0x20){const _0x41bd3f=a29_0x563a,_0x636f0c=0x1/(0x1+Math['pow'](0xa,(_0xba1107-_0xa85e70)/0x190)),_0xeb5510=0x1/(0x1+Math[_0x41bd3f(0x118)](0xa,(_0xa85e70-_0xba1107)/0x190)),_0x7d4a59=_0xa85e70+_0x155a2e*(0x1-_0x636f0c),_0x54aad2=_0xba1107+_0x155a2e*(0x0-_0xeb5510);return{'newWinnerRating':Math[_0x41bd3f(0x112)](_0x7d4a59),'newLoserRating':Math['round'](_0x54aad2)};}export async function updateEloRatingsD3(_0x2a1684,_0x2eeb0e,_0x4ccc93){const _0x5e38f4=a29_0x563a;try{const _0x2c14b6=writeBatch(db),_0x433c59=doc(db,_0x5e38f4(0x11c),_0x2a1684),_0x251870=doc(db,'playersD3',_0x2eeb0e),[_0x2684b7,_0x302cbf]=await Promise[_0x5e38f4(0x111)]([getDoc(_0x433c59),getDoc(_0x251870)]);if(!_0x2684b7['exists']()||!_0x302cbf['exists']())throw new Error('One\x20or\x20both\x20D3\x20players\x20not\x20found');const _0x36361a=_0x2684b7['data'](),_0x412663=_0x302cbf[_0x5e38f4(0x119)](),_0x10d1d0=_0x36361a['position']||Number['MAX_SAFE_INTEGER'],_0x357440=_0x412663['position']||Number['MAX_SAFE_INTEGER'],{newWinnerRating:_0x1fc689,newLoserRating:_0x49c461}=calculateEloD3(_0x36361a['eloRating']||0x4b0,_0x412663['eloRating']||0x4b0);let _0x5ad8fc=_0x10d1d0,_0x283cdc=_0x357440;if(_0x10d1d0>_0x357440){console['log']('D3\x20Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked'),_0x5ad8fc=_0x357440,_0x283cdc=_0x357440+0x1;const _0x5b2da1=query(collection(db,'playersD3'),where('position','>',_0x357440),where(_0x5e38f4(0x113),'<',_0x10d1d0)),_0x45b05d=await getDocs(_0x5b2da1);for(const _0xdab64e of _0x45b05d['docs']){_0xdab64e['id']!==_0x2a1684&&_0xdab64e['id']!==_0x2eeb0e&&_0x2c14b6['update'](doc(db,'playersD3',_0xdab64e['id']),{'position':_0xdab64e['data']()['position']+0x1});}}else console['log'](_0x5e38f4(0x10b));return _0x2c14b6[_0x5e38f4(0x10d)](_0x433c59,{'eloRating':_0x1fc689,'lastMatchDate':serverTimestamp(),'position':_0x5ad8fc,'lastMatchId':_0x4ccc93}),_0x2c14b6[_0x5e38f4(0x10d)](_0x251870,{'eloRating':_0x49c461,'lastMatchDate':serverTimestamp(),'position':_0x283cdc,'lastMatchId':_0x4ccc93}),await _0x2c14b6['commit'](),console['log']('D3\x20ELO\x20ratings\x20updated\x20successfully'),await Promise[_0x5e38f4(0x111)]([recordEloChangeD3({'playerId':_0x2a1684,'previousElo':_0x36361a['eloRating']||0x4b0,'newElo':_0x1fc689,'opponentId':_0x2eeb0e,'matchResult':'win','previousPosition':_0x10d1d0,'newPosition':_0x5ad8fc,'isPromotion':_0x5ad8fc<_0x10d1d0,'matchId':_0x4ccc93,'timestamp':serverTimestamp()}),recordEloChangeD3({'playerId':_0x2eeb0e,'previousElo':_0x412663['eloRating']||0x4b0,'newElo':_0x49c461,'opponentId':_0x2a1684,'matchResult':'loss','previousPosition':_0x357440,'newPosition':_0x283cdc,'isDemotion':_0x283cdc>_0x357440,'matchId':_0x4ccc93,'timestamp':serverTimestamp()})]),!![];}catch(_0x271bf3){console[_0x5e38f4(0x110)]('Error\x20in\x20updateEloRatingsD3:',_0x271bf3);throw _0x271bf3;}}export async function approveReportD3(_0x26cb11,_0xabe9d9,_0x4e81fd,_0x3196be){const _0x4d18d2=a29_0x563a;try{console[_0x4d18d2(0x10f)]('Starting\x20approveReportD3\x20function\x20with:',{'reportId':_0x26cb11,'winnerScore':_0xabe9d9,'winnerSuicides':_0x4e81fd,'winnerComment':_0x3196be});const _0x416487=auth['currentUser'];if(!_0x416487){console['log']('No\x20user\x20logged\x20in');throw new Error(_0x4d18d2(0x114));}console['log']('Current\x20user:',_0x416487[_0x4d18d2(0x10e)]);const _0xe0f2e6=await getDoc(doc(db,'playersD3',_0x416487[_0x4d18d2(0x115)])),_0x294838=_0xe0f2e6['exists']()?_0xe0f2e6['data']()['username']:null;console[_0x4d18d2(0x10f)]('Current\x20username:',_0x294838);const _0x49d234=doc(db,_0x4d18d2(0x10c),_0x26cb11),_0x1db9c1=await getDoc(_0x49d234);if(!_0x1db9c1['exists']()){console[_0x4d18d2(0x10f)]('D3\x20Report\x20not\x20found\x20with\x20ID:',_0x26cb11);throw new Error('D3\x20match\x20report\x20not\x20found');}const _0x7d7421=_0x1db9c1['data']();console['log']('D3\x20Report\x20data:',_0x7d7421);if(_0x294838!==_0x7d7421[_0x4d18d2(0x117)])throw new Error('Only\x20the\x20winner\x20can\x20approve\x20D3\x20matches');const _0x49972b={..._0x7d7421,'winnerScore':_0xabe9d9,'winnerSuicides':_0x4e81fd,'winnerComment':_0x3196be,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':_0x294838,'createdAt':_0x7d7421['createdAt']||serverTimestamp(),'winnerUsername':_0x7d7421['winnerUsername'],'loserUsername':_0x7d7421['loserUsername']};await setDoc(doc(db,'approvedMatchesD3',_0x26cb11),_0x49972b),await deleteDoc(_0x49d234),console[_0x4d18d2(0x10f)]('D3\x20Match\x20moved\x20to\x20approved\x20collection');const [_0x58c2b8,_0x1a12d8]=await Promise[_0x4d18d2(0x111)]([getDocs(query(collection(db,'playersD3'),where(_0x4d18d2(0x11a),'==',_0x7d7421['winnerUsername']))),getDocs(query(collection(db,'playersD3'),where('username','==',_0x7d7421['loserUsername'])))]);if(_0x58c2b8[_0x4d18d2(0x10a)]||_0x1a12d8['empty'])throw new Error('Could\x20not\x20find\x20D3\x20player\x20documents');const _0x3a5881=_0x58c2b8[_0x4d18d2(0x11b)][0x0]['id'],_0x358e33=_0x1a12d8['docs'][0x0]['id'];return await updateEloRatingsD3(_0x3a5881,_0x358e33,_0x26cb11),console['log']('D3\x20Match\x20successfully\x20approved\x20and\x20ELO\x20updated'),!![];}catch(_0xfcf965){console[_0x4d18d2(0x110)]('Error\x20in\x20approveReportD3:',_0xfcf965);throw _0xfcf965;}}
const a14_0x40abfd=a14_0x1978,a14_0x2fa64f=(function(){let _0x14e25e=!![];return function(_0x442080,_0x37c531){const _0x265e6e=_0x14e25e?function(){if(_0x37c531){const _0x511a00=_0x37c531['apply'](_0x442080,arguments);return _0x37c531=null,_0x511a00;}}:function(){};return _0x14e25e=![],_0x265e6e;};}()),a14_0x26d811=a14_0x2fa64f(this,function(){const _0x5c12b=a14_0x1978,_0x160d43=function(){const _0x3e5609=a14_0x1978;let _0x469f26;try{_0x469f26=Function('return\x20(function()\x20'+_0x3e5609(0x102)+');')();}catch(_0x41a266){_0x469f26=window;}return _0x469f26;},_0x4fd30f=_0x160d43(),_0x5c60bf=_0x4fd30f['console']=_0x4fd30f['console']||{},_0x2d8d3c=[_0x5c12b(0x10a),_0x5c12b(0x111),'info','error','exception','table','trace'];for(let _0x1aae73=0x0;_0x1aae73<_0x2d8d3c[_0x5c12b(0x106)];_0x1aae73++){const _0x9faed9=a14_0x2fa64f['constructor']['prototype']['bind'](a14_0x2fa64f),_0x2af7fa=_0x2d8d3c[_0x1aae73],_0x44537d=_0x5c60bf[_0x2af7fa]||_0x9faed9;_0x9faed9[_0x5c12b(0x10c)]=a14_0x2fa64f[_0x5c12b(0x104)](a14_0x2fa64f),_0x9faed9['toString']=_0x44537d['toString'][_0x5c12b(0x104)](_0x44537d),_0x5c60bf[_0x2af7fa]=_0x9faed9;}});a14_0x26d811();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D2=[{'name':'Gold','elo':0x708},{'name':'Silver','elo':0x640},{'name':a14_0x40abfd(0x108),'elo':0x578},{'name':a14_0x40abfd(0x100),'elo':0x4b0}];function a14_0x1978(_0x5eb21c,_0x458ea7){const _0x26d811=a14_0xc268();return a14_0x1978=function(_0x2fa64f,_0x511027){_0x2fa64f=_0x2fa64f-0xfe;let _0xc26822=_0x26d811[_0x2fa64f];return _0xc26822;},a14_0x1978(_0x5eb21c,_0x458ea7);}let lastVisibleD2=null;async function getUsernameByIdD2(_0x3d31e3){const _0x421b2d=a14_0x40abfd;try{if(!_0x3d31e3)return'Unknown\x20Player';const _0x105c57=await getDoc(doc(db,'playersD2',_0x3d31e3));if(_0x105c57[_0x421b2d(0xfe)]())return _0x105c57['data']()['username']||'Unknown\x20Player';const _0x151756=await getDocs(query(collection(db,'approvedMatchesD2'),where(_0x421b2d(0x109),'==',_0x3d31e3),limit(0x1)));if(!_0x151756['empty'])return _0x151756['docs'][0x0]['data']()[_0x421b2d(0x105)]||'Unknown\x20Player';const _0x5d74fd=await getDocs(query(collection(db,'approvedMatchesD2'),where(_0x421b2d(0x110),'==',_0x3d31e3),limit(0x1)));if(!_0x5d74fd[_0x421b2d(0x112)])return _0x5d74fd[_0x421b2d(0x113)][0x0][_0x421b2d(0x10b)]()[_0x421b2d(0x103)]||_0x421b2d(0x115);return'Unknown\x20Player';}catch(_0x484582){return console[_0x421b2d(0x10e)]('Error\x20getting\x20username:',_0x484582),_0x421b2d(0x115);}}function a14_0xc268(){const _0x533bb4=['exists','Gold','Unranked','all','{}.constructor(\x22return\x20this\x22)(\x20)','loserUsername','bind','winnerUsername','length','previousElo','Bronze','winnerId','log','data','__proto__','promotion','error','Silver','loserId','warn','empty','docs','eloHistoryD2','Unknown\x20Player'];a14_0xc268=function(){return _0x533bb4;};return a14_0xc268();}export async function recordEloChangeD2({playerId:_0x1abffe,previousElo:_0x3d4a1d,newElo:_0xe6b617,opponentId:_0x7dee7b,matchResult:_0x1d2507,previousPosition:_0xc5da60,newPosition:_0xa919ce,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x32d8a3,timestamp:_0x10b255}){const _0x1a7bd3=a14_0x40abfd;try{const _0x3af6f2=doc(collection(db,'eloHistoryD2'));let _0x370699='match';if(isPromotion)_0x370699=_0x1a7bd3(0x10d);if(isDemotion)_0x370699='demotion';let _0x4d63bf='Unranked';if(_0xe6b617>=0x834)_0x4d63bf='Emerald';else{if(_0xe6b617>=0x708)_0x4d63bf=_0x1a7bd3(0xff);else{if(_0xe6b617>=0x640)_0x4d63bf=_0x1a7bd3(0x10f);else{if(_0xe6b617>=0x578)_0x4d63bf='Bronze';}}}return await setDoc(_0x3af6f2,{'type':_0x370699,'player':_0x1abffe,'opponent':_0x7dee7b,'previousElo':_0x3d4a1d,'newElo':_0xe6b617,'change':_0xe6b617-_0x3d4a1d,'matchResult':_0x1d2507,'previousPosition':_0xc5da60,'newPosition':_0xa919ce,'rankAchieved':_0x4d63bf,'matchId':_0x32d8a3,'timestamp':_0x10b255}),console['log']('D2\x20ELO\x20history\x20recorded\x20for\x20'+_0x1abffe),!![];}catch(_0x524eb8){console['error']('Error\x20recording\x20D2\x20ELO\x20history:',_0x524eb8);throw _0x524eb8;}}export async function getEloHistoryD2(_0x3e57cd=0x14){const _0x329c23=a14_0x40abfd;try{const _0x456c3b=collection(db,_0x329c23(0x114));let _0x5004fb;lastVisibleD2?_0x5004fb=query(_0x456c3b,orderBy('timestamp','desc'),startAfter(lastVisibleD2),limit(_0x3e57cd)):_0x5004fb=query(_0x456c3b,orderBy('timestamp','desc'),limit(_0x3e57cd));const _0xdaec2e=await getDocs(_0x5004fb);if(_0xdaec2e['empty'])return{'entries':[],'hasMore':![]};lastVisibleD2=_0xdaec2e['docs'][_0xdaec2e['docs'][_0x329c23(0x106)]-0x1];const _0xce83ce=_0xdaec2e['docs']['map'](async _0x22bf04=>{const _0x36aadf=_0x329c23,_0x27019a=_0x22bf04['data'](),[_0x3dd258,_0x49dad2]=await Promise['all']([getUsernameByIdD2(_0x27019a['player']),getUsernameByIdD2(_0x27019a['opponent'])]);return{..._0x27019a,'playerUsername':_0x3dd258,'opponentUsername':_0x49dad2,'change':_0x27019a['newElo']-_0x27019a[_0x36aadf(0x107)],'timestamp':_0x27019a['timestamp']};}),_0x1bcc65=await Promise[_0x329c23(0x101)](_0xce83ce);return{'entries':_0x1bcc65,'hasMore':_0xdaec2e['size']===_0x3e57cd};}catch(_0x352077){console['error']('Error\x20fetching\x20D2\x20ELO\x20history:',_0x352077);throw _0x352077;}}export function resetPaginationD2(){lastVisibleD2=null;}
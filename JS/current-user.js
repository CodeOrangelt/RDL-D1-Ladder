const a12_0x1f3340=a12_0x392e,a12_0x44c486=(function(){let _0x518aa5=!![];return function(_0x797740,_0x93a817){const _0x46c652=_0x518aa5?function(){if(_0x93a817){const _0x40d070=_0x93a817['apply'](_0x797740,arguments);return _0x93a817=null,_0x40d070;}}:function(){};return _0x518aa5=![],_0x46c652;};}()),a12_0x4a869e=a12_0x44c486(this,function(){const _0x20a393=a12_0x392e;let _0x48ba27;try{const _0x7d10ac=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x48ba27=_0x7d10ac();}catch(_0x1f34ef){_0x48ba27=window;}const _0x5581a8=_0x48ba27['console']=_0x48ba27[_0x20a393(0xff)]||{},_0x37f925=['log','warn','info','error',_0x20a393(0x105),'table',_0x20a393(0xfb)];for(let _0x28ff46=0x0;_0x28ff46<_0x37f925['length'];_0x28ff46++){const _0x4b0808=a12_0x44c486[_0x20a393(0xdd)]['prototype']['bind'](a12_0x44c486),_0x5293a7=_0x37f925[_0x28ff46],_0x3db375=_0x5581a8[_0x5293a7]||_0x4b0808;_0x4b0808['__proto__']=a12_0x44c486['bind'](a12_0x44c486),_0x4b0808['toString']=_0x3db375[_0x20a393(0xfd)]['bind'](_0x3db375),_0x5581a8[_0x5293a7]=_0x4b0808;}});a12_0x4a869e();function a12_0x392e(_0x3e8bb4,_0x4e6d8d){const _0x4a869e=a12_0x2063();return a12_0x392e=function(_0x44c486,_0x22357d){_0x44c486=_0x44c486-0xdd;let _0x206310=_0x4a869e[_0x44c486];return _0x206310;},a12_0x392e(_0x3e8bb4,_0x4e6d8d);}import{getAuth,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{doc,getDoc,collection,query,where,getDocs,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';function a12_0x2063(){const _0x358a0e=['constructor','toUpperCase','pendingCount','\x20(Admin)','Checking\x20roles\x20for\x20user:\x20','map','split','\x22>Profile</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./inbox.html\x22\x20class=\x22nav-notification\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Inbox\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22inbox-notification\x22\x20class=\x22notification-dot\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22members.html\x22>Members</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./redeem.html\x22><i\x20class=\x22fas\x20fa-gift\x22></i>\x20Redeem</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20id=\x22logout-link\x22>Sign\x20Out</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','.admin-only','email','lastChecked','hidden','slice','Found\x20user\x20in\x20','currentUser','style','forEach','gameInvitations','catch','click','now','toLowerCase','charAt','playersD2','all','\x20by\x20UID:','role','uid','log','error','trace','getElementById','toString','owner','console','a[href]','username','roleName','creative\x20lead','admin@ladder.com','exception','addEventListener','join','players','admin','data','querySelectorAll','visibilitychange','Error\x20signing\x20out:'];a12_0x2063=function(){return _0x358a0e;};return a12_0x2063();}import{db}from'./firebase-config.js';import{isAdmin}from'./admin-check.js';const ADMIN_EMAILS=[a12_0x1f3340(0x104),'Brian2af@outlook.com'],userCache={'uid':null,'username':null,'isAdmin':![],'hasCheckedCollections':![],'lastChecked':0x0,'role':null},invitationCache={'lastCheck':0x0,'pendingCount':0x0,'checkInterval':0x493e0};function updateInboxNotification(_0xbf3a4a){const _0xbce2a4=a12_0x1f3340,_0x112e48=document[_0xbce2a4(0xfc)]('inbox-notification');_0x112e48&&(_0xbf3a4a>0x0?(_0x112e48[_0xbce2a4(0xec)]['display']='inline-block',_0x112e48['textContent']=_0xbf3a4a>0x9?'9+':_0xbf3a4a):_0x112e48['style']['display']='none');}async function checkPendingInvitationsForCurrentUser(_0xe35e20){const _0xdd802f=a12_0x1f3340;try{const _0x22119b=Date[_0xdd802f(0xf1)]();if(_0x22119b-invitationCache['lastCheck']<invitationCache['checkInterval'])return updateInboxNotification(invitationCache['pendingCount']),invitationCache['pendingCount'];invitationCache['lastCheck']=_0x22119b;const _0x2e43a8=collection(db,_0xdd802f(0xee)),_0x47e9ed=query(_0x2e43a8,where('toUserId','==',_0xe35e20),where('status','==','pending'),limit(0x5)),_0xfced31=await getDocs(_0x47e9ed),_0x2d0bb6=_0xfced31['size'];return invitationCache[_0xdd802f(0xdf)]=_0x2d0bb6,updateInboxNotification(_0x2d0bb6),_0x2d0bb6;}catch(_0x5e6921){return console['warn']('Could\x20not\x20check\x20pending\x20invitations\x20for\x20current\x20user:',_0x5e6921),0x0;}}function updateAuthSectionImmediate(_0x3cbfb3,_0x2df35c=![]){const _0x71ad32=a12_0x1f3340,_0x2a5b11=document[_0x71ad32(0xfc)]('auth-section');if(!_0x2a5b11)return;if(_0x3cbfb3&&_0x2df35c)document[_0x71ad32(0x10b)](_0x71ad32(0xe5))[_0x71ad32(0xed)](_0x5ce3bd=>{const _0x56fd84=_0x71ad32;_0x5ce3bd[_0x56fd84(0xec)]['display']='block';});else!_0x3cbfb3&&document['querySelectorAll']('.admin-only')[_0x71ad32(0xed)](_0x5e9ab1=>{const _0x5aa30a=_0x71ad32;_0x5e9ab1[_0x5aa30a(0xec)]['display']='none';});if(_0x3cbfb3){const _0x5006dd=userCache[_0x71ad32(0x101)]||(_0x3cbfb3[_0x71ad32(0xe6)]?_0x3cbfb3['email']['split']('@')[0x0]:'User'),_0x4e28ab=userCache['role']?'\x20('+userCache['role']+')':_0x2df35c?_0x71ad32(0xe0):'';_0x2a5b11['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20class=\x22nav-username\x22>'+_0x5006dd+_0x4e28ab+'</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username='+encodeURIComponent(_0x5006dd)+_0x71ad32(0xe4);const _0x302ddb=document[_0x71ad32(0xfc)]('logout-link');_0x302ddb&&_0x302ddb['addEventListener'](_0x71ad32(0xf0),_0x113777=>{const _0x565bda=_0x71ad32;_0x113777['preventDefault']();const _0x11abec=getAuth();updateAuthSectionImmediate(null),_0x11abec['signOut']()[_0x565bda(0xef)](_0x15f69f=>{const _0x140c59=_0x565bda;console[_0x140c59(0xfa)](_0x140c59(0x10d),_0x15f69f);});}),_0x3cbfb3['uid']&&setTimeout(()=>{const _0x449ff5=_0x71ad32;checkPendingInvitationsForCurrentUser(_0x3cbfb3[_0x449ff5(0xf8)]);},0x3e8);}else _0x2a5b11['innerHTML']='<a\x20href=\x22login.html\x22\x20class=\x22login-link\x22>Login</a>';}async function checkAdminRoles(_0x3d07ce){const _0x39b758=a12_0x1f3340;if(!_0x3d07ce||!_0x3d07ce[_0x39b758(0xe6)])return{'isAdmin':![],'role':null};try{console['log'](_0x39b758(0xe1)+_0x3d07ce[_0x39b758(0xe6)]);const _0x2b7f6c=[_0x39b758(0x108),'playersD2','playersD3','nonParticipants','userProfiles'],_0x1ba8d2=['council',_0x39b758(0x103),_0x39b758(0xfe),_0x39b758(0x109)];for(const _0x211a90 of _0x2b7f6c){try{const _0x59f7d9=doc(db,_0x211a90,_0x3d07ce['uid']),_0x5128d1=await getDoc(_0x59f7d9);if(_0x5128d1['exists']()){const _0x4c2698=_0x5128d1[_0x39b758(0x10a)]();console['log'](_0x39b758(0xea)+_0x211a90+_0x39b758(0xf6),_0x4c2698);let _0x137e6f=(_0x4c2698[_0x39b758(0x102)]||_0x4c2698[_0x39b758(0xf7)]||'')[_0x39b758(0xf2)](),_0x4f0ce3=_0x4c2698['roleName']||_0x4c2698['role']||'';if(_0x137e6f&&_0x1ba8d2['includes'](_0x137e6f)){console[_0x39b758(0xf9)]('Found\x20admin\x20role:\x20'+_0x137e6f+'\x20in\x20'+_0x211a90);const _0x3605d2=_0x4f0ce3[_0x39b758(0xe3)]('\x20')['map'](_0x515d4d=>_0x515d4d[_0x39b758(0xf3)](0x0)[_0x39b758(0xde)]()+_0x515d4d['slice'](0x1)[_0x39b758(0xf2)]())['join']('\x20');return{'isAdmin':!![],'role':_0x3605d2};}}}catch(_0x20f491){console['error']('Error\x20checking\x20'+_0x211a90+'\x20by\x20UID:',_0x20f491);}}for(const _0x38c0ca of _0x2b7f6c){try{const _0x3cc014=collection(db,_0x38c0ca);let _0x5d6b0e=query(_0x3cc014,where(_0x39b758(0xe6),'==',_0x3d07ce['email'])),_0x501afc=await getDocs(_0x5d6b0e);_0x501afc['empty']&&(_0x5d6b0e=query(_0x3cc014,where('email','==',_0x3d07ce['email']['toLowerCase']())),_0x501afc=await getDocs(_0x5d6b0e));if(!_0x501afc['empty']){const _0x2ca9fc=_0x501afc['docs'][0x0]['data']();console['log']('Found\x20user\x20in\x20'+_0x38c0ca+'\x20by\x20email:',_0x2ca9fc);let _0x3cfb5c=(_0x2ca9fc['roleName']||_0x2ca9fc['role']||'')['toLowerCase'](),_0x31882d=_0x2ca9fc['roleName']||_0x2ca9fc['role']||'';if(_0x3cfb5c&&_0x1ba8d2['includes'](_0x3cfb5c)){console['log']('Found\x20admin\x20role:\x20'+_0x3cfb5c+'\x20in\x20'+_0x38c0ca);const _0x438b2f=_0x31882d['split']('\x20')['map'](_0x4f5b11=>_0x4f5b11['charAt'](0x0)['toUpperCase']()+_0x4f5b11[_0x39b758(0xe9)](0x1)['toLowerCase']())[_0x39b758(0x107)]('\x20');return{'isAdmin':!![],'role':_0x438b2f};}}}catch(_0x42e54d){console['error']('Error\x20checking\x20'+_0x38c0ca+'\x20by\x20email:',_0x42e54d);}}return console['log']('No\x20admin\x20roles\x20found\x20for\x20user'),{'isAdmin':![],'role':null};}catch(_0x202b39){return console[_0x39b758(0xfa)]('Error\x20in\x20checkAdminRoles:',_0x202b39),{'isAdmin':![],'role':null};}}async function updateAuthSection(_0x3fbc9c){const _0x4323ca=a12_0x1f3340,_0x35fb1f=_0x3fbc9c&&isAdmin(_0x3fbc9c[_0x4323ca(0xe6)]);updateAuthSectionImmediate(_0x3fbc9c,_0x35fb1f);if(!_0x3fbc9c){userCache['uid']=null,userCache['username']=null,userCache['isAdmin']=![],userCache['hasCheckedCollections']=![],userCache[_0x4323ca(0xf7)]=null;return;}const _0x2223bf=Date[_0x4323ca(0xf1)]();if(_0x3fbc9c['uid']===userCache['uid']&&userCache['hasCheckedCollections']&&_0x2223bf-userCache[_0x4323ca(0xe7)]<0x493e0)return;try{userCache['uid']=_0x3fbc9c[_0x4323ca(0xf8)],userCache['lastChecked']=_0x2223bf;const _0x10a66a=isAdmin(_0x3fbc9c[_0x4323ca(0xe6)]);userCache['isAdmin']=_0x10a66a;if(!_0x10a66a){const {isAdmin:_0x302bf1,role:_0x6c2fbb}=await checkAdminRoles(_0x3fbc9c);userCache['isAdmin']=_0x302bf1,userCache[_0x4323ca(0xf7)]=_0x6c2fbb,_0x302bf1&&(document['querySelectorAll']('.admin-only')['forEach'](_0x4a87e6=>{_0x4a87e6['style']['display']='block';}),updateAuthSectionImmediate(_0x3fbc9c,!![]));}const _0x5d96a0=['players',_0x4323ca(0xf4),'playersD3','playersDuos','playersCTF','nonParticipants','userProfiles'],_0x295de9=_0x5d96a0[_0x4323ca(0xe2)](_0x5a7f21=>getDoc(doc(db,_0x5a7f21,_0x3fbc9c['uid']))['then'](_0x21d94d=>_0x21d94d['exists']()?{'collection':_0x5a7f21,'data':_0x21d94d['data']()}:null)['catch'](()=>null)),_0x4804f0=await Promise[_0x4323ca(0xf5)](_0x295de9),_0xacf635=_0x4804f0['filter'](_0x133d15=>_0x133d15!==null);let _0x10bf9a=null;for(const _0x3d12db of _0xacf635){if(_0x3d12db[_0x4323ca(0x10a)]['username']){_0x10bf9a=_0x3d12db['data']['username'];break;}}userCache[_0x4323ca(0x101)]=_0x10bf9a||(_0x3fbc9c['email']?_0x3fbc9c['email'][_0x4323ca(0xe3)]('@')[0x0]:'User'),userCache['hasCheckedCollections']=!![],updateAuthSectionImmediate(_0x3fbc9c,userCache['isAdmin']),setTimeout(()=>{checkPendingInvitationsForCurrentUser(_0x3fbc9c['uid']);},0x1f4);}catch(_0x280acb){console['error']('Error\x20in\x20full\x20auth\x20update:',_0x280acb);}}document['addEventListener']('DOMContentLoaded',()=>{const _0xea01fd=a12_0x1f3340,_0x24ad1f=getAuth();onAuthStateChanged(_0x24ad1f,async _0x2acc62=>{const _0x454d0f=a12_0x392e;await updateAuthSection(_0x2acc62),_0x2acc62&&checkPendingInvitationsForCurrentUser(_0x2acc62[_0x454d0f(0xf8)]);}),document['addEventListener'](_0xea01fd(0x10c),()=>{const _0x5793ee=_0xea01fd;!document[_0x5793ee(0xe8)]&&_0x24ad1f['currentUser']&&checkPendingInvitationsForCurrentUser(_0x24ad1f[_0x5793ee(0xeb)]['uid']);}),document[_0xea01fd(0x106)](_0xea01fd(0xf0),_0x51ca1c=>{const _0x1f1be1=_0xea01fd;_0x51ca1c['target']['closest'](_0x1f1be1(0x100))&&_0x24ad1f['currentUser']&&checkPendingInvitationsForCurrentUser(_0x24ad1f['currentUser']['uid']);});});export{updateAuthSection};
const a31_0x4b32c8=a31_0x12ae,a31_0xbfc4bf=(function(){let _0x117e9a=!![];return function(_0x4bdc44,_0x201c31){const _0x46596a=_0x117e9a?function(){const _0x2dedce=a31_0x12ae;if(_0x201c31){const _0x4d6218=_0x201c31[_0x2dedce(0x1fa)](_0x4bdc44,arguments);return _0x201c31=null,_0x4d6218;}}:function(){};return _0x117e9a=![],_0x46596a;};}()),a31_0x100f23=a31_0xbfc4bf(this,function(){const _0x18c9b2=a31_0x12ae;let _0x4713e8;try{const _0x2bf24e=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x4713e8=_0x2bf24e();}catch(_0x3ecb8d){_0x4713e8=window;}const _0xb927cb=_0x4713e8['console']=_0x4713e8['console']||{},_0x56683a=['log','warn','info','error','exception',_0x18c9b2(0x1ee),_0x18c9b2(0x1e3)];for(let _0xf6c939=0x0;_0xf6c939<_0x56683a['length'];_0xf6c939++){const _0x296ef4=a31_0xbfc4bf['constructor']['prototype']['bind'](a31_0xbfc4bf),_0x38a0b8=_0x56683a[_0xf6c939],_0x11883b=_0xb927cb[_0x38a0b8]||_0x296ef4;_0x296ef4[_0x18c9b2(0x1dd)]=a31_0xbfc4bf[_0x18c9b2(0x1de)](a31_0xbfc4bf),_0x296ef4[_0x18c9b2(0x1d1)]=_0x11883b[_0x18c9b2(0x1d1)][_0x18c9b2(0x1de)](_0x11883b),_0xb927cb[_0x38a0b8]=_0x296ef4;}});a31_0x100f23();import{collection,getDocs,doc,getDoc,query,where,updateDoc,Timestamp,orderBy,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import a31_0x230f86 from'./firebase-idle-wrapper.js';import{getTokensByUsernames,getPrimaryDisplayToken,clearTokenCache}from'./tokens.js';const styleEl=document['createElement']('style');styleEl['textContent']='\x0a\x20\x20.streak-indicator\x20{\x0a\x20\x20\x20\x20font-size:\x200.9em;\x0a\x20\x20\x20\x20color:\x20#FF4500;\x0a\x20\x20\x20\x20margin-left:\x205px;\x0a\x20\x20\x20\x20font-weight:\x20bold;\x0a\x20\x20}\x0a',document['head'][a31_0x4b32c8(0x1d5)](styleEl);function a31_0x4bc1(){const _0x30dd22=['position','previousElo','username','querySelector','data','toString','innerHTML','push','forEach','appendChild','get','#FFD700','newElo','timestamp','playersD3','string',';\x20text-decoration:\x20none;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','__proto__','bind','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22trend-indicator\x22\x20style=\x22margin-left:\x205px;\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>','includes','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Rank</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Username</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>ELO</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Matches</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Wins</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Losses</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>K/D</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Win\x20Rate</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','map','trace','sort','inline','wins','Error\x20loading\x20D3\x20ladder:','textContent','0.85em','\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20alt=\x22','set','country','has','table','player','fontSize','<img\x20src=\x22','fontWeight','totalMatches','eloHistoryD3','totalKills','elo','style','#ladder-d3\x20tbody','losses','apply','error','td:nth-child(3)','winRate','abs'];a31_0x4bc1=function(){return _0x30dd22;};return a31_0x4bc1();}const playerCacheD3={'data':null,'timestamp':0x0},CACHE_DURATION=0x7530;async function displayLadderD3(_0x3c7cec=![]){const _0x2e6480=a31_0x4b32c8,_0x44690e=document['querySelector']('#ladder-d3\x20tbody');if(!_0x44690e){console['error']('D3\x20Ladder\x20table\x20body\x20not\x20found');return;}_0x44690e[_0x2e6480(0x1d2)]='<tr><td\x20colspan=\x228\x22\x20class=\x22loading-cell\x22>Loading\x20D3\x20ladder\x20data...</td></tr>';try{const _0x5d855f=Date['now']();if(!_0x3c7cec&&playerCacheD3['data']&&_0x5d855f-playerCacheD3['timestamp']<CACHE_DURATION){updateLadderDisplayD3(playerCacheD3['data']);return;}const _0x3e69cd=collection(db,'playersD3'),_0x6aa6f3=await getDocs(_0x3e69cd),_0x35ffec=[];_0x6aa6f3[_0x2e6480(0x1d4)](_0xdae778=>{const _0x1b8ab0=_0x2e6480,_0x181ed6=_0xdae778['data']();_0x181ed6['username']&&_0x35ffec[_0x1b8ab0(0x1d3)]({..._0x181ed6,'id':_0xdae778['id'],'elo':_0x181ed6['eloRating']||0x0,'position':_0x181ed6[_0x1b8ab0(0x1cc)]||Number['MAX_SAFE_INTEGER']});});const _0x49ddbc=collection(db,'userProfiles'),_0x22d14b=await getDocs(_0x49ddbc),_0x325278=new Map();_0x22d14b['forEach'](_0x501bcd=>{const _0x99fdd8=_0x501bcd['data']();_0x99fdd8['username']&&_0x325278['set'](_0x99fdd8['username']['toLowerCase'](),_0x99fdd8);});for(const _0x19a628 of _0x35ffec){const _0xd4cb4b=_0x19a628['username']['toLowerCase']();if(_0x325278[_0x2e6480(0x1ed)](_0xd4cb4b)){const _0x17521b=_0x325278[_0x2e6480(0x1d6)](_0xd4cb4b);_0x17521b[_0x2e6480(0x1ec)]&&(_0x19a628['country']=_0x17521b[_0x2e6480(0x1ec)]['toLowerCase']());}}const _0x2b0002=_0x35ffec[_0x2e6480(0x1e2)](_0x9ceb12=>_0x9ceb12['username']),_0x34f753=await fetchBatchMatchStatsD3(_0x2b0002);_0x35ffec[_0x2e6480(0x1e4)]((_0x325ea2,_0x2f91a6)=>{const _0x16b6c2=_0x2e6480,_0x30376d=_0x34f753[_0x16b6c2(0x1d6)](_0x325ea2['username'])?.['totalMatches']||0x0,_0xd092cb=_0x34f753['get'](_0x2f91a6['username'])?.['totalMatches']||0x0;if(_0x30376d===0x0!==(_0xd092cb===0x0))return _0x30376d===0x0?0x1:-0x1;return(_0x325ea2['position']||0x3e7)-(_0x2f91a6[_0x16b6c2(0x1cc)]||0x3e7);}),_0x35ffec['forEach']((_0x2523d5,_0x5eebcb)=>{const _0x3a393e=_0x2e6480;_0x2523d5[_0x3a393e(0x1cc)]=_0x5eebcb+0x1;}),playerCacheD3[_0x2e6480(0x1d0)]=_0x35ffec,playerCacheD3[_0x2e6480(0x1d9)]=_0x5d855f,updateLadderDisplayD3(_0x35ffec);}catch(_0x19219e){console[_0x2e6480(0x1fb)](_0x2e6480(0x1e7),_0x19219e),_0x44690e['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20colspan=\x228\x22\x20style=\x22text-align:\x20center;\x20color:\x20red;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Error\x20loading\x20D3\x20ladder\x20data:\x20'+_0x19219e['message']+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';}}function a31_0x12ae(_0x4ac646,_0x4b5ae2){const _0x100f23=a31_0x4bc1();return a31_0x12ae=function(_0xbfc4bf,_0x2fa477){_0xbfc4bf=_0xbfc4bf-0x1cc;let _0x4bc162=_0x100f23[_0xbfc4bf];return _0x4bc162;},a31_0x12ae(_0x4ac646,_0x4b5ae2);}function calculateStreakDays(_0x177a99){const _0xf8ce6d=a31_0x4b32c8;if(!_0x177a99)return 0x0;const _0x4f3f34=_0x177a99['toDate'](),_0x5c31f0=new Date(),_0x2ed43e=Math[_0xf8ce6d(0x1fe)](_0x5c31f0-_0x4f3f34);return Math['ceil'](_0x2ed43e/(0x3e8*0x3c*0x3c*0x18));}async function updatePlayerPositions(_0xeede09,_0x3eef82){const _0x1bbb78=a31_0x4b32c8;try{const _0x1e53ff=collection(db,'playersD3'),_0x4c3b19=await getDocs(_0x1e53ff),_0xe06f27=[];_0x4c3b19['forEach'](_0x182db7=>{const _0x40bc95=a31_0x12ae;_0xe06f27['push']({'id':_0x182db7['id'],..._0x182db7[_0x40bc95(0x1d0)]()});});const _0x493949=_0xe06f27['find'](_0x5bbcc6=>_0x5bbcc6['username']===_0xeede09),_0x253e84=_0xe06f27['find'](_0x37073=>_0x37073['username']===_0x3eef82);if(!_0x493949||!_0x253e84){console['error']('Could\x20not\x20find\x20winner\x20or\x20loser\x20in\x20D3\x20players\x20list');return;}if(_0x493949['position']>_0x253e84[_0x1bbb78(0x1cc)]){const _0x5a39e4=_0x253e84['position'];for(const _0x2bb75b of _0xe06f27){_0x2bb75b[_0x1bbb78(0x1cc)]>=_0x253e84[_0x1bbb78(0x1cc)]&&_0x2bb75b['position']<_0x493949['position']&&_0x2bb75b['username']!==_0xeede09&&await updateDoc(doc(db,'playersD3',_0x2bb75b['id']),{'position':_0x2bb75b[_0x1bbb78(0x1cc)]+0x1});}await updateDoc(doc(db,'playersD3',_0x493949['id']),{'position':_0x5a39e4});if(_0x5a39e4===0x1){const _0x10da33=doc(db,_0x1bbb78(0x1da),_0x493949['id']),_0x3b1ddf=await getDoc(_0x10da33);!_0x3b1ddf[_0x1bbb78(0x1d0)]()['firstPlaceDate']&&await updateDoc(_0x10da33,{'firstPlaceDate':Timestamp['now']()});}if(_0x253e84['position']===0x1){const _0x578e80=doc(db,'playersD3',_0x253e84['id']);await updateDoc(_0x578e80,{'firstPlaceDate':null});}playerCacheD3['timestamp']=0x0;}}catch(_0x526e4e){console['error']('Error\x20updating\x20D3\x20player\x20positions:',_0x526e4e);}}async function updateLadderDisplayD3(_0x15a4a0){const _0xcfc8e1=a31_0x4b32c8;_0x15a4a0['sort']((_0x114198,_0x5e619f)=>_0x114198['position']-_0x5e619f['position']);const _0x20c5e7=document['querySelector'](_0xcfc8e1(0x1f8));if(!_0x20c5e7)return;_0x20c5e7[_0xcfc8e1(0x1d2)]='';const _0x2790c3=_0x15a4a0['map'](_0x292ffb=>_0x292ffb[_0xcfc8e1(0x1ce)]),_0x3564de=await fetchBatchMatchStatsD3(_0x2790c3);let _0x427f37=new Map();try{typeof clearTokenCache==='function'&&clearTokenCache(),_0x427f37=await getTokensByUsernames(_0x2790c3);}catch(_0x7192a4){console['error']('D3:\x20Error\x20fetching\x20tokens:',_0x7192a4);}const _0x3cb149=document[_0xcfc8e1(0x1cf)]('#ladder-d3\x20thead\x20tr');_0x3cb149&&(_0x3cb149['innerHTML']=_0xcfc8e1(0x1e1));const _0x496ee5=_0x15a4a0[_0xcfc8e1(0x1e2)](_0x423f06=>{const _0x2352f1=_0xcfc8e1,_0x4ed5b2=_0x3564de[_0x2352f1(0x1d6)](_0x423f06['username'])||{'totalMatches':0x0,'wins':0x0,'losses':0x0,'kda':0x0,'winRate':0x0,'totalKills':0x0,'totalDeaths':0x0},_0x7b6e1c=_0x427f37['get'](_0x423f06[_0x2352f1(0x1ce)])||[],_0x30728e=getPrimaryDisplayToken(_0x7b6e1c);return createPlayerRowD3(_0x423f06,_0x4ed5b2,_0x30728e);})['join']('');_0x20c5e7['innerHTML']=_0x496ee5,getPlayersLastEloChangesD3(_0x2790c3)['then'](_0x333166=>{const _0x300f3b=_0xcfc8e1,_0x28c24a=new Map();_0x20c5e7['querySelectorAll']('tr')[_0x300f3b(0x1d4)]((_0x3efd7d,_0x14684c)=>{_0x14684c<_0x2790c3['length']&&_0x28c24a['set'](_0x2790c3[_0x14684c],_0x3efd7d);}),_0x333166['forEach']((_0x19c561,_0x1c2058)=>{const _0x425df1=_0x300f3b,_0x4288fd=_0x28c24a['get'](_0x1c2058);if(_0x4288fd&&_0x19c561!==0x0){const _0x4d2577=_0x4288fd['querySelector'](_0x425df1(0x1fc));if(_0x4d2577){const _0x2361e9=_0x19c561>0x0?'+'+_0x19c561:''+_0x19c561,_0x11b157=_0x4d2577['querySelector']('.trend-indicator');_0x11b157&&(_0x11b157[_0x425df1(0x1e8)]=_0x2361e9,_0x11b157['style']['color']=_0x19c561>0x0?'#4CAF50':'#F44336',_0x11b157['style'][_0x425df1(0x1f2)]='bold',_0x11b157['style'][_0x425df1(0x1f0)]=_0x425df1(0x1e9),_0x11b157[_0x425df1(0x1f7)]['display']=_0x425df1(0x1e5),_0x11b157['style']['visibility']='visible',_0x11b157['style']['opacity']='1');}}});})['catch'](_0x14663a=>console['error']('Error\x20updating\x20D3\x20ELO\x20trend\x20indicators:',_0x14663a));}async function fetchBatchMatchStatsD3(_0x3a0916){const _0x8d07ee=a31_0x4b32c8,_0xc3cb89=new Map();try{_0x3a0916[_0x8d07ee(0x1d4)](_0x3c0dfd=>{_0xc3cb89['set'](_0x3c0dfd,{'totalMatches':0x0,'wins':0x0,'losses':0x0,'totalKills':0x0,'totalDeaths':0x0,'kda':0x0,'winRate':0x0});});const _0x1c441f=collection(db,'approvedMatchesD3'),_0x25fa4f=await getDocs(_0x1c441f);_0x25fa4f[_0x8d07ee(0x1d4)](_0x3ab7b2=>{const _0x4dfb3f=_0x8d07ee,_0x51da23=_0x3ab7b2[_0x4dfb3f(0x1d0)](),_0x4f6a9a=_0x51da23['winnerUsername'],_0xa3ebda=_0x51da23['loserUsername'];if(_0x3a0916[_0x4dfb3f(0x1e0)](_0x4f6a9a)){const _0x576bb8=_0xc3cb89['get'](_0x4f6a9a);_0x576bb8['wins']++,_0x576bb8['totalMatches']++,_0x576bb8[_0x4dfb3f(0x1f5)]+=parseInt(_0x51da23['winnerScore'])||0x0,_0x576bb8['totalDeaths']+=parseInt(_0x51da23['loserScore'])||0x0;}if(_0x3a0916[_0x4dfb3f(0x1e0)](_0xa3ebda)){const _0x361530=_0xc3cb89['get'](_0xa3ebda);_0x361530[_0x4dfb3f(0x1f9)]++,_0x361530[_0x4dfb3f(0x1f3)]++,_0x361530['totalKills']+=parseInt(_0x51da23['loserScore'])||0x0,_0x361530['totalDeaths']+=parseInt(_0x51da23['winnerScore'])||0x0;}}),_0x3a0916['forEach'](_0x3a790b=>{const _0x4a2f3e=_0xc3cb89['get'](_0x3a790b);_0x4a2f3e['kda']=_0x4a2f3e['totalDeaths']>0x0?(_0x4a2f3e['totalKills']/_0x4a2f3e['totalDeaths'])['toFixed'](0x2):_0x4a2f3e['totalKills'],_0x4a2f3e['winRate']=_0x4a2f3e['totalMatches']>0x0?(_0x4a2f3e['wins']/_0x4a2f3e['totalMatches']*0x64)['toFixed'](0x1):0x0;});}catch(_0x33eed7){console['error']('Error\x20fetching\x20batch\x20match\x20stats\x20for\x20D3:',_0x33eed7);}return _0xc3cb89;}function createPlayerRowD3(_0x53bb9f,_0x22dd01,_0x4c3234){const _0x91f942=a31_0x4b32c8,_0x2256fc=parseFloat(_0x53bb9f[_0x91f942(0x1f6)])||0x0;let _0x575589='gray';if(_0x2256fc>=0x7d0)_0x575589='#50C878';else{if(_0x2256fc>=0x708)_0x575589=_0x91f942(0x1d7);else{if(_0x2256fc>=0x640)_0x575589='#b9f1fc';else _0x2256fc>=0x578&&(_0x575589='#CD7F32');}}let _0xa8029c='';_0x53bb9f['country']&&(_0xa8029c='<img\x20src=\x22../images/flags/'+_0x53bb9f['country']['toLowerCase']()+'.png\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20alt=\x22'+_0x53bb9f[_0x91f942(0x1ec)]+'\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20class=\x22player-flag\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20style=\x22margin-left:\x205px;\x20vertical-align:\x20middle;\x20width:\x2020px;\x20height:\x20auto;\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20onerror=\x22this.style.display=\x27none\x27\x22>');let _0x4bbf87='';return _0x4c3234&&(_0x4bbf87=_0x91f942(0x1f1)+_0x4c3234['tokenImage']+_0x91f942(0x1ea)+_0x4c3234['tokenName']+'\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20class=\x22player-token\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20title=\x22'+_0x4c3234['tokenName']+'\x20'+(_0x4c3234['equipped']?'(Equipped)':'')+'\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20style=\x22width:\x2035px;\x20height:\x2035px;\x20margin-left:\x205px;\x20vertical-align:\x20middle;\x20object-fit:\x20contain;\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20onerror=\x22this.style.display=\x27none\x27\x22>'),'\x0a\x20\x20\x20\x20<tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+_0x53bb9f[_0x91f942(0x1cc)]+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td\x20style=\x22position:\x20relative;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20position:\x20relative;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username='+encodeURIComponent(_0x53bb9f['username'])+'&ladder=d3\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20style=\x22color:\x20'+_0x575589+_0x91f942(0x1dc)+_0x53bb9f['username']+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0xa8029c+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x4bbf87+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td\x20style=\x22color:\x20'+_0x575589+';\x20position:\x20relative;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22elo-container\x22\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22elo-value\x22>'+_0x2256fc+_0x91f942(0x1df)+_0x22dd01['totalMatches']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+_0x22dd01[_0x91f942(0x1e6)]+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+_0x22dd01['losses']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+_0x22dd01['kda']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<td>'+_0x22dd01[_0x91f942(0x1fd)]+'%</td>\x0a\x20\x20\x20\x20</tr>';}async function getPlayersLastEloChangesD3(_0x50cca0){const _0x3e98b6=a31_0x4b32c8,_0x270dfa=new Map();_0x50cca0['forEach'](_0x2a8c9b=>_0x270dfa[_0x3e98b6(0x1eb)](_0x2a8c9b,0x0));try{const _0x19eb18=new Map(),_0x148b0e=await getDocs(collection(db,_0x3e98b6(0x1da)));_0x148b0e['forEach'](_0x27af9d=>{const _0x1d2499=_0x3e98b6,_0x18532b=_0x27af9d['data']();_0x18532b[_0x1d2499(0x1ce)]&&_0x19eb18[_0x1d2499(0x1eb)](_0x27af9d['id'],_0x18532b['username']);});const _0x2adc5b=collection(db,_0x3e98b6(0x1f4)),_0x421a63=query(_0x2adc5b,orderBy('timestamp','desc'),limit(0x64)),_0x2f12e4=await getDocs(_0x421a63),_0x454673=new Map();_0x2f12e4[_0x3e98b6(0x1d4)](_0x4e7f11=>{const _0x5877d2=_0x3e98b6,_0x2c91db=_0x4e7f11['data']();let _0xd9d758=null;if(_0x2c91db['username'])_0xd9d758=_0x2c91db['username'];else{if(_0x2c91db['playerUsername'])_0xd9d758=_0x2c91db['playerUsername'];else{if(_0x2c91db['player']&&typeof _0x2c91db[_0x5877d2(0x1ef)]===_0x5877d2(0x1db))_0xd9d758=_0x2c91db['player'];else{if(_0x2c91db[_0x5877d2(0x1ef)]&&_0x19eb18['has'](_0x2c91db['player']))_0xd9d758=_0x19eb18[_0x5877d2(0x1d6)](_0x2c91db[_0x5877d2(0x1ef)]);else _0x2c91db['playerId']&&_0x19eb18['has'](_0x2c91db['playerId'])&&(_0xd9d758=_0x19eb18[_0x5877d2(0x1d6)](_0x2c91db['playerId']));}}}_0xd9d758&&_0x50cca0['includes'](_0xd9d758)&&(!_0x454673['has'](_0xd9d758)&&_0x454673['set'](_0xd9d758,[]),_0x454673[_0x5877d2(0x1d6)](_0xd9d758)['push']({..._0x2c91db,'timestamp':_0x2c91db[_0x5877d2(0x1d9)]?.['seconds']||0x0}));}),_0x454673['forEach']((_0x5e80ff,_0x324781)=>{const _0x5ef4aa=_0x3e98b6;if(_0x5e80ff['length']>0x0){_0x5e80ff['sort']((_0x2be555,_0xe03e14)=>_0xe03e14[_0x5ef4aa(0x1d9)]-_0x2be555['timestamp']);const _0x4dd7b0=_0x5e80ff['find'](_0x34c627=>_0x34c627['change']!==undefined||_0x34c627['newElo']!==undefined&&_0x34c627['previousElo']!==undefined);if(_0x4dd7b0){let _0x511491;if(_0x4dd7b0['change']!==undefined)_0x511491=_0x4dd7b0['change'];else _0x4dd7b0[_0x5ef4aa(0x1d8)]!==undefined&&_0x4dd7b0[_0x5ef4aa(0x1cd)]!==undefined&&(_0x511491=_0x4dd7b0['newElo']-_0x4dd7b0['previousElo']);_0x511491!==undefined&&_0x270dfa[_0x5ef4aa(0x1eb)](_0x324781,_0x511491);}}});if(_0x454673['size']===0x0){const _0x185ef8=collection(db,'eloHistory'),_0x3b387f=query(_0x185ef8,where('gameMode','==','D3'),orderBy(_0x3e98b6(0x1d9),'desc'),limit(0x32));try{const _0x547ede=await getDocs(_0x3b387f);_0x547ede['forEach'](_0x1ed0c2=>{const _0x42b017=_0x3e98b6,_0x89acd6=_0x1ed0c2[_0x42b017(0x1d0)]();let _0x39c514=_0x89acd6['username']||_0x89acd6['playerUsername'];!_0x39c514&&_0x89acd6['player']&&_0x19eb18['has'](_0x89acd6['player'])&&(_0x39c514=_0x19eb18[_0x42b017(0x1d6)](_0x89acd6['player']));if(_0x39c514&&_0x50cca0['includes'](_0x39c514)){const _0x307bab=_0x89acd6['change']||(_0x89acd6['newElo']!==undefined&&_0x89acd6[_0x42b017(0x1cd)]!==undefined?_0x89acd6['newElo']-_0x89acd6['previousElo']:0x0);_0x307bab!==0x0&&_0x270dfa[_0x42b017(0x1eb)](_0x39c514,_0x307bab);}});}catch(_0x300154){console['error']('D3:\x20Fallback\x20query\x20failed:',_0x300154);}}}catch(_0x296d64){console['error']('D3:\x20Error\x20fetching\x20ELO\x20history:',_0x296d64);}return _0x270dfa;}window['refreshLadderDisplayD3']=function(_0x126276=!![]){typeof displayLadderD3==='function'?displayLadderD3(_0x126276):console['warn']('displayLadderD3\x20function\x20not\x20available');};export{displayLadderD3,updatePlayerPositions};
const a50_0x3d6583=a50_0x57d7,a50_0x53bead=(function(){let _0x36a814=!![];return function(_0x17bd48,_0x1ada81){const _0x26e284=_0x36a814?function(){if(_0x1ada81){const _0x200148=_0x1ada81['apply'](_0x17bd48,arguments);return _0x1ada81=null,_0x200148;}}:function(){};return _0x36a814=![],_0x26e284;};}()),a50_0x26ad64=a50_0x53bead(this,function(){const _0x596a7b=a50_0x57d7;let _0x4d3851;try{const _0x15c342=Function(_0x596a7b(0xec)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x4d3851=_0x15c342();}catch(_0xe94e02){_0x4d3851=window;}const _0x5df79f=_0x4d3851['console']=_0x4d3851['console']||{},_0x5564da=['log','warn',_0x596a7b(0xe1),'error',_0x596a7b(0xe6),'table','trace'];for(let _0x51f2f1=0x0;_0x51f2f1<_0x5564da['length'];_0x51f2f1++){const _0x10944b=a50_0x53bead['constructor'][_0x596a7b(0xe8)]['bind'](a50_0x53bead),_0x2830c0=_0x5564da[_0x51f2f1],_0x5a6f56=_0x5df79f[_0x2830c0]||_0x10944b;_0x10944b['__proto__']=a50_0x53bead['bind'](a50_0x53bead),_0x10944b['toString']=_0x5a6f56[_0x596a7b(0xe9)]['bind'](_0x5a6f56),_0x5df79f[_0x2830c0]=_0x10944b;}});a50_0x26ad64();import{db}from'../firebase-config.js';import{collection,doc,getDoc,getDocs,query,limit,startAfter,where,onSnapshot}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const cache={'userProfiles':new Map(),'ladderPlayers':new Map(),'matchResults':new Map(),'eloHistory':new Map()},CACHE_EXPIRY={'userProfiles':0x5*0x3c*0x3e8,'ladderPlayers':0x2*0x3c*0x3e8,'matchResults':0x1*0x3c*0x3e8,'eloHistory':0x3*0x3c*0x3e8};export const userProfilesRef=collection(db,'userProfiles');export async function fetchPaginatedData(_0x3b48bd,_0x44e811=0xa,_0xc31b75=null){const _0x31c3ac=a50_0x57d7;let _0x111ad6=query(_0x3b48bd,limit(_0x44e811));_0xc31b75&&(_0x111ad6=query(_0x111ad6,startAfter(_0xc31b75)));const _0x36d204=await getDocs(_0x111ad6),_0x591ceb=_0x36d204['docs'][_0x36d204[_0x31c3ac(0xea)]['length']-0x1];return{'data':_0x36d204[_0x31c3ac(0xea)]['map'](_0x14f38f=>({'id':_0x14f38f['id'],..._0x14f38f['data']()})),'lastVisible':_0x591ceb,'hasMore':_0x36d204['docs']['length']===_0x44e811};}function a50_0xcc0c(){const _0x5b3e8b=['map','doc','forEach','error','username','nonParticipants','info','eloHistory','now','push','eloHistoryD','exception','slice','prototype','toString','docs','data','return\x20(function()\x20'];a50_0xcc0c=function(){return _0x5b3e8b;};return a50_0xcc0c();}export async function getUserProfile(_0x516ef2){const _0x2c6f99=a50_0x57d7,_0x2d9098=cache['userProfiles']['get'](_0x516ef2);if(_0x2d9098&&Date['now']()-_0x2d9098['timestamp']<CACHE_EXPIRY['userProfiles'])return _0x2d9098['data'];const _0x5ae587=await getDoc(doc(userProfilesRef,_0x516ef2));if(_0x5ae587['exists']()){const _0x4ff608=_0x5ae587[_0x2c6f99(0xeb)]();return cache['userProfiles']['set'](_0x516ef2,{'data':_0x4ff608,'timestamp':Date['now']()}),_0x4ff608;}return null;}export async function getLadderData(_0x2b273d=0x1){const _0x3ad9c9=a50_0x57d7,_0xad2a7e='division_'+_0x2b273d,_0x71890f=cache['ladderPlayers']['get'](_0xad2a7e);if(_0x71890f&&Date[_0x3ad9c9(0xe3)]()-_0x71890f['timestamp']<CACHE_EXPIRY['ladderPlayers'])return _0x71890f['data'];const _0x50d9bb=_0x2b273d===0x1?'players':'playersD'+_0x2b273d,_0x285447=collection(db,_0x50d9bb),_0x52f287=await getDocs(query(_0x285447,limit(0x64))),_0x22f3a8=_0x52f287['docs'][_0x3ad9c9(0xdb)](_0xe9cdec=>({'id':_0xe9cdec['id'],..._0xe9cdec[_0x3ad9c9(0xeb)]()}));return cache['ladderPlayers']['set'](_0xad2a7e,{'data':_0x22f3a8,'timestamp':Date[_0x3ad9c9(0xe3)]()}),_0x22f3a8;}export async function getEloHistoryBatch(_0x310cd9,_0x27430d=0x1){const _0x2684f7=a50_0x57d7,_0xd8148e=_0x27430d===0x1?_0x2684f7(0xe2):_0x2684f7(0xe5)+_0x27430d,_0x40d256=collection(db,_0xd8148e),_0x22ae7c={},_0xf55332=[];_0x310cd9['forEach'](_0x665b1e=>{const _0x309c0a=_0x2684f7,_0x267d11=_0x665b1e+'_'+_0x27430d,_0x22b292=cache['eloHistory']['get'](_0x267d11);_0x22b292&&Date['now']()-_0x22b292['timestamp']<CACHE_EXPIRY['eloHistory']?_0x22ae7c[_0x665b1e]=_0x22b292[_0x309c0a(0xeb)]:_0xf55332[_0x309c0a(0xe4)](_0x665b1e);});const _0x58a23f=0xa;for(let _0x267e8b=0x0;_0x267e8b<_0xf55332['length'];_0x267e8b+=_0x58a23f){const _0x5b769c=_0xf55332[_0x2684f7(0xe7)](_0x267e8b,_0x267e8b+_0x58a23f);if(_0x5b769c['length']>0x0)try{const _0xc62953=query(_0x40d256,where('playerId','in',_0x5b769c),limit(0x64)),_0x39de12=await getDocs(_0xc62953);_0x39de12[_0x2684f7(0xea)][_0x2684f7(0xdd)](_0x3b2669=>{const _0x1066b2=_0x2684f7,_0x4ba84e=_0x3b2669[_0x1066b2(0xeb)](),_0x52166e=_0x4ba84e['playerId'];if(!_0x22ae7c[_0x52166e])_0x22ae7c[_0x52166e]=[];_0x22ae7c[_0x52166e][_0x1066b2(0xe4)](_0x4ba84e);const _0x22d051=_0x52166e+'_'+_0x27430d;cache['eloHistory']['set'](_0x22d051,{'data':_0x22ae7c[_0x52166e],'timestamp':Date['now']()});});}catch(_0x3afb16){console[_0x2684f7(0xde)]('Error\x20fetching\x20batch\x20ELO\x20history:',_0x3afb16);}}return _0x22ae7c;}let usernameCache=new Map(),usernameCacheTimestamp=Date[a50_0x3d6583(0xe3)]();export function setupEfficientListener(_0x5788bf,_0x268529=[],_0x142716){const _0x263374=collection(db,_0x5788bf),_0xc29771=query(_0x263374,..._0x268529),_0x519068=onSnapshot(_0xc29771,_0x5aaee9=>{const _0x11b293=a50_0x57d7,_0x2da17f=_0x5aaee9['docChanges']()['map'](_0x368fd8=>({'type':_0x368fd8['type'],'id':_0x368fd8['doc']['id'],'data':_0x368fd8[_0x11b293(0xdc)]['data']()}));_0x2da17f['length']>0x0&&_0x142716(_0x2da17f,_0x5aaee9['docs']);});return _0x519068;}function a50_0x57d7(_0x5c942c,_0x650730){const _0x26ad64=a50_0xcc0c();return a50_0x57d7=function(_0x53bead,_0x1a80c7){_0x53bead=_0x53bead-0xdb;let _0xcc0cce=_0x26ad64[_0x53bead];return _0xcc0cce;},a50_0x57d7(_0x5c942c,_0x650730);}export async function bulkResolveUsernames(_0x2d5aa4){const _0x4407dd=a50_0x3d6583,_0x312714=new Map();if(!_0x2d5aa4||_0x2d5aa4['length']===0x0)return _0x312714;const _0x5d7d82=['players','playersD2','playersD3',_0x4407dd(0xe0)];for(const _0x1966b4 of _0x5d7d82){const _0x1d9062=collection(db,_0x1966b4),_0x15d52b=await getDocs(_0x1d9062);_0x15d52b['forEach'](_0x5ea84c=>{const _0x2c341a=_0x4407dd,_0x9b1ec9=_0x5ea84c['data']();_0x9b1ec9[_0x2c341a(0xdf)]&&_0x2d5aa4['includes'](_0x5ea84c['id'])&&_0x312714['set'](_0x5ea84c['id'],_0x9b1ec9[_0x2c341a(0xdf)]);});}return _0x312714;}
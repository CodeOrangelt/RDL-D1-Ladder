const a15_0x513fac=(function(){let _0x533aae=!![];return function(_0xf83bdf,_0x432857){const _0x5a8c29=_0x533aae?function(){const _0x3d8123=a15_0x25e0;if(_0x432857){const _0x3d9899=_0x432857[_0x3d8123(0x1fe)](_0xf83bdf,arguments);return _0x432857=null,_0x3d9899;}}:function(){};return _0x533aae=![],_0x5a8c29;};}()),a15_0x4b6b04=a15_0x513fac(this,function(){const _0x278d30=a15_0x25e0,_0x4c7960=function(){const _0x11a3b2=a15_0x25e0;let _0x5496e1;try{_0x5496e1=Function(_0x11a3b2(0x204)+_0x11a3b2(0x1ff)+');')();}catch(_0x26a7e4){_0x5496e1=window;}return _0x5496e1;},_0x32fc32=_0x4c7960(),_0x1ad60d=_0x32fc32['console']=_0x32fc32['console']||{},_0x443854=[_0x278d30(0x1fd),_0x278d30(0x1f4),'info','error','exception','table','trace'];for(let _0x15bafd=0x0;_0x15bafd<_0x443854[_0x278d30(0x1fa)];_0x15bafd++){const _0x2e7b92=a15_0x513fac['constructor']['prototype']['bind'](a15_0x513fac),_0x21fade=_0x443854[_0x15bafd],_0x4f0f61=_0x1ad60d[_0x21fade]||_0x2e7b92;_0x2e7b92['__proto__']=a15_0x513fac['bind'](a15_0x513fac),_0x2e7b92['toString']=_0x4f0f61['toString'][_0x278d30(0x1f6)](_0x4f0f61),_0x1ad60d[_0x21fade]=_0x2e7b92;}});function a15_0x25e0(_0x2de2d7,_0x4ba511){const _0x4b6b04=a15_0x49e4();return a15_0x25e0=function(_0x513fac,_0x5a593a){_0x513fac=_0x513fac-0x1f2;let _0x49e4a2=_0x4b6b04[_0x513fac];return _0x49e4a2;},a15_0x25e0(_0x2de2d7,_0x4ba511);}a15_0x4b6b04();function a15_0x49e4(){const _0x3363e2=['loserUsername','Unknown\x20Player','warn','playersD3','bind','exists','docs','size','length','loserId','match','log','apply','{}.constructor(\x22return\x20this\x22)(\x20)','eloHistoryD3','Silver','newElo','Emerald','return\x20(function()\x20','timestamp'];a15_0x49e4=function(){return _0x3363e2;};return a15_0x49e4();}import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc,where}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D3=[{'name':'Emerald','elo':0x7d0},{'name':'Gold','elo':0x708},{'name':'Silver','elo':0x640},{'name':'Bronze','elo':0x578},{'name':'Unranked','elo':0x4b0}];let lastVisibleD3=null;async function getUsernameByIdD3(_0x530493){const _0x5ad941=a15_0x25e0;try{if(!_0x530493)return'Unknown\x20Player';const _0x375f04=await getDoc(doc(db,_0x5ad941(0x1f5),_0x530493));if(_0x375f04[_0x5ad941(0x1f7)]())return _0x375f04['data']()['username']||'Unknown\x20Player';const _0x1962d6=await getDocs(query(collection(db,'approvedMatchesD3'),where('winnerId','==',_0x530493),limit(0x1)));if(!_0x1962d6['empty'])return _0x1962d6[_0x5ad941(0x1f8)][0x0]['data']()['winnerUsername']||'Unknown\x20Player';const _0x1c3f3e=await getDocs(query(collection(db,'approvedMatchesD3'),where(_0x5ad941(0x1fb),'==',_0x530493),limit(0x1)));if(!_0x1c3f3e['empty'])return _0x1c3f3e['docs'][0x0]['data']()[_0x5ad941(0x1f2)]||_0x5ad941(0x1f3);return _0x5ad941(0x1f3);}catch(_0x1c42ce){return console['error']('Error\x20getting\x20D3\x20username:',_0x1c42ce),_0x5ad941(0x1f3);}}export async function recordEloChangeD3({playerId:_0x52c7fa,previousElo:_0x11c4dd,newElo:_0x38ee4d,opponentId:_0x509ee6,matchResult:_0x1bc564,previousPosition:_0x5a9af4,newPosition:_0x4f5b8e,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x5eaea3,timestamp:_0x43d3f7}){const _0x1c7995=a15_0x25e0;try{const _0x1c99fd=doc(collection(db,_0x1c7995(0x200)));let _0x2dbbd7=_0x1c7995(0x1fc);if(isPromotion)_0x2dbbd7='promotion';if(isDemotion)_0x2dbbd7='demotion';let _0x25618f='Unranked';if(_0x38ee4d>=0x7d0)_0x25618f=_0x1c7995(0x203);else{if(_0x38ee4d>=0x708)_0x25618f='Gold';else{if(_0x38ee4d>=0x640)_0x25618f=_0x1c7995(0x201);else{if(_0x38ee4d>=0x578)_0x25618f='Bronze';}}}return await setDoc(_0x1c99fd,{'type':_0x2dbbd7,'player':_0x52c7fa,'opponent':_0x509ee6,'previousElo':_0x11c4dd,'newElo':_0x38ee4d,'change':_0x38ee4d-_0x11c4dd,'matchResult':_0x1bc564,'previousPosition':_0x5a9af4,'newPosition':_0x4f5b8e,'rankAchieved':_0x25618f,'matchId':_0x5eaea3,'timestamp':_0x43d3f7||serverTimestamp(),'gameMode':'D3'}),console['log']('D3\x20ELO\x20history\x20recorded\x20for\x20'+_0x52c7fa),!![];}catch(_0x44c75d){console['error']('Error\x20recording\x20D3\x20ELO\x20history:',_0x44c75d);throw _0x44c75d;}}export async function getEloHistoryD3(_0x44db82=0x14){const _0x4b7f6b=a15_0x25e0;try{const _0xdf940e=collection(db,_0x4b7f6b(0x200));let _0x2c6abb;lastVisibleD3?_0x2c6abb=query(_0xdf940e,orderBy('timestamp','desc'),startAfter(lastVisibleD3),limit(_0x44db82)):_0x2c6abb=query(_0xdf940e,orderBy(_0x4b7f6b(0x205),'desc'),limit(_0x44db82));const _0x464df8=await getDocs(_0x2c6abb);if(_0x464df8['empty'])return{'entries':[],'hasMore':![]};lastVisibleD3=_0x464df8['docs'][_0x464df8[_0x4b7f6b(0x1f8)]['length']-0x1];const _0x308e65=_0x464df8['docs']['map'](async _0x34a008=>{const _0x5c5997=_0x4b7f6b,_0x399899=_0x34a008['data'](),[_0x4454ca,_0x1ddb91]=await Promise['all']([getUsernameByIdD3(_0x399899['player']),getUsernameByIdD3(_0x399899['opponent'])]);return{..._0x399899,'playerUsername':_0x4454ca,'opponentUsername':_0x1ddb91,'change':_0x399899[_0x5c5997(0x202)]-_0x399899['previousElo'],'timestamp':_0x399899[_0x5c5997(0x205)]};}),_0x44e607=await Promise['all'](_0x308e65);return{'entries':_0x44e607,'hasMore':_0x464df8[_0x4b7f6b(0x1f9)]===_0x44db82};}catch(_0x5e6621){console['error']('Error\x20fetching\x20D3\x20ELO\x20history:',_0x5e6621);throw _0x5e6621;}}export function resetPaginationD3(){lastVisibleD3=null;}
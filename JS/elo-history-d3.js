const a15_0x24483b=a15_0x38e9,a15_0xc280cd=(function(){let _0x58808e=!![];return function(_0x3c4e1f,_0x36ea92){const _0x7a2b13=_0x58808e?function(){if(_0x36ea92){const _0x52a7c5=_0x36ea92['apply'](_0x3c4e1f,arguments);return _0x36ea92=null,_0x52a7c5;}}:function(){};return _0x58808e=![],_0x7a2b13;};}()),a15_0x51b1d9=a15_0xc280cd(this,function(){const _0xd595ca=a15_0x38e9;let _0x24d64d;try{const _0x330a29=Function(_0xd595ca(0x7f)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x24d64d=_0x330a29();}catch(_0x2c29dc){_0x24d64d=window;}const _0x181150=_0x24d64d['console']=_0x24d64d['console']||{},_0xde1a87=[_0xd595ca(0x7c),'warn','info','error','exception','table','trace'];for(let _0xe4af9d=0x0;_0xe4af9d<_0xde1a87['length'];_0xe4af9d++){const _0x910ed4=a15_0xc280cd['constructor']['prototype']['bind'](a15_0xc280cd),_0x2cd17e=_0xde1a87[_0xe4af9d],_0x7850ad=_0x181150[_0x2cd17e]||_0x910ed4;_0x910ed4[_0xd595ca(0x80)]=a15_0xc280cd['bind'](a15_0xc280cd),_0x910ed4['toString']=_0x7850ad['toString']['bind'](_0x7850ad),_0x181150[_0x2cd17e]=_0x910ed4;}});a15_0x51b1d9();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc,where}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';function a15_0x38e9(_0x54cf94,_0x350dfd){const _0x51b1d9=a15_0x3a64();return a15_0x38e9=function(_0xc280cd,_0xd030e3){_0xc280cd=_0xc280cd-0x7c;let _0x3a6489=_0x51b1d9[_0xc280cd];return _0x3a6489;},a15_0x38e9(_0x54cf94,_0x350dfd);}const ELO_THRESHOLDS_D3=[{'name':'Emerald','elo':0x7d0},{'name':'Gold','elo':0x708},{'name':'Silver','elo':0x640},{'name':a15_0x24483b(0x82),'elo':0x578},{'name':'Unranked','elo':0x4b0}];let lastVisibleD3=null;async function getUsernameByIdD3(_0x4ff42e){const _0x54c96e=a15_0x24483b;try{if(!_0x4ff42e)return _0x54c96e(0x8d);const _0x3602b2=await getDoc(doc(db,'playersD3',_0x4ff42e));if(_0x3602b2['exists']())return _0x3602b2[_0x54c96e(0x8a)]()[_0x54c96e(0x7d)]||_0x54c96e(0x8d);const _0x434f6a=await getDocs(query(collection(db,'approvedMatchesD3'),where(_0x54c96e(0x86),'==',_0x4ff42e),limit(0x1)));if(!_0x434f6a['empty'])return _0x434f6a['docs'][0x0][_0x54c96e(0x8a)]()['winnerUsername']||'Unknown\x20Player';const _0x119d57=await getDocs(query(collection(db,'approvedMatchesD3'),where('loserId','==',_0x4ff42e),limit(0x1)));if(!_0x119d57['empty'])return _0x119d57[_0x54c96e(0x8c)][0x0]['data']()[_0x54c96e(0x8b)]||'Unknown\x20Player';return'Unknown\x20Player';}catch(_0x4929d9){return console['error']('Error\x20getting\x20D3\x20username:',_0x4929d9),_0x54c96e(0x8d);}}export async function recordEloChangeD3({playerId:_0x5e7040,previousElo:_0x5355a0,newElo:_0x1c6a5d,opponentId:_0x3faef3,matchResult:_0x7505fa,previousPosition:_0x802e43,newPosition:_0x29dd8a,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x1f13d3,timestamp:_0x94e9cf}){const _0x4de44c=a15_0x24483b;try{const _0x35022a=doc(collection(db,'eloHistoryD3'));let _0x33921a='match';if(isPromotion)_0x33921a='promotion';if(isDemotion)_0x33921a=_0x4de44c(0x7e);let _0xa2661a='Unranked';if(_0x1c6a5d>=0x7d0)_0xa2661a='Emerald';else{if(_0x1c6a5d>=0x708)_0xa2661a='Gold';else{if(_0x1c6a5d>=0x640)_0xa2661a='Silver';else{if(_0x1c6a5d>=0x578)_0xa2661a='Bronze';}}}return await setDoc(_0x35022a,{'type':_0x33921a,'player':_0x5e7040,'opponent':_0x3faef3,'previousElo':_0x5355a0,'newElo':_0x1c6a5d,'change':_0x1c6a5d-_0x5355a0,'matchResult':_0x7505fa,'previousPosition':_0x802e43,'newPosition':_0x29dd8a,'rankAchieved':_0xa2661a,'matchId':_0x1f13d3,'timestamp':_0x94e9cf||serverTimestamp(),'gameMode':'D3'}),console['log']('D3\x20ELO\x20history\x20recorded\x20for\x20'+_0x5e7040),!![];}catch(_0x451eeb){console[_0x4de44c(0x88)]('Error\x20recording\x20D3\x20ELO\x20history:',_0x451eeb);throw _0x451eeb;}}export async function getEloHistoryD3(_0x314ef9=0x14){const _0xd25250=a15_0x24483b;try{const _0x4d782d=collection(db,_0xd25250(0x87));let _0x516b87;lastVisibleD3?_0x516b87=query(_0x4d782d,orderBy('timestamp','desc'),startAfter(lastVisibleD3),limit(_0x314ef9)):_0x516b87=query(_0x4d782d,orderBy('timestamp',_0xd25250(0x81)),limit(_0x314ef9));const _0x1fb016=await getDocs(_0x516b87);if(_0x1fb016['empty'])return{'entries':[],'hasMore':![]};lastVisibleD3=_0x1fb016[_0xd25250(0x8c)][_0x1fb016[_0xd25250(0x8c)]['length']-0x1];const _0x34300f=_0x1fb016[_0xd25250(0x8c)][_0xd25250(0x83)](async _0x47f04b=>{const _0xfdc0e0=_0xd25250,_0x586568=_0x47f04b[_0xfdc0e0(0x8a)](),[_0x325aa7,_0x335599]=await Promise[_0xfdc0e0(0x84)]([getUsernameByIdD3(_0x586568['player']),getUsernameByIdD3(_0x586568[_0xfdc0e0(0x8f)])]);return{..._0x586568,'playerUsername':_0x325aa7,'opponentUsername':_0x335599,'change':_0x586568[_0xfdc0e0(0x85)]-_0x586568[_0xfdc0e0(0x8e)],'timestamp':_0x586568['timestamp']};}),_0x2e8de0=await Promise['all'](_0x34300f);return{'entries':_0x2e8de0,'hasMore':_0x1fb016['size']===_0x314ef9};}catch(_0x170193){console['error'](_0xd25250(0x89),_0x170193);throw _0x170193;}}export function resetPaginationD3(){lastVisibleD3=null;}function a15_0x3a64(){const _0xb2c895=['log','username','demotion','return\x20(function()\x20','__proto__','desc','Bronze','map','all','newElo','winnerId','eloHistoryD3','error','Error\x20fetching\x20D3\x20ELO\x20history:','data','loserUsername','docs','Unknown\x20Player','previousElo','opponent'];a15_0x3a64=function(){return _0xb2c895;};return a15_0x3a64();}
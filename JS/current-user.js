const a12_0x420aef=a12_0x5323,a12_0x1bab59=(function(){let _0x43e1c5=!![];return function(_0x3344a2,_0xa51c54){const _0x5e0167=_0x43e1c5?function(){if(_0xa51c54){const _0x6c90f9=_0xa51c54['apply'](_0x3344a2,arguments);return _0xa51c54=null,_0x6c90f9;}}:function(){};return _0x43e1c5=![],_0x5e0167;};}()),a12_0x283725=a12_0x1bab59(this,function(){const _0x365f48=a12_0x5323;let _0x46835f;try{const _0x537361=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x46835f=_0x537361();}catch(_0x1491f9){_0x46835f=window;}const _0x38e29d=_0x46835f['console']=_0x46835f['console']||{},_0x208622=['log',_0x365f48(0x1f6),'info','error','exception','table',_0x365f48(0x1d4)];for(let _0x50e799=0x0;_0x50e799<_0x208622['length'];_0x50e799++){const _0x49b3b9=a12_0x1bab59[_0x365f48(0x1ee)]['prototype']['bind'](a12_0x1bab59),_0x115868=_0x208622[_0x50e799],_0x3ceae1=_0x38e29d[_0x115868]||_0x49b3b9;_0x49b3b9[_0x365f48(0x1dc)]=a12_0x1bab59['bind'](a12_0x1bab59),_0x49b3b9['toString']=_0x3ceae1['toString']['bind'](_0x3ceae1),_0x38e29d[_0x115868]=_0x49b3b9;}});a12_0x283725();import{getAuth,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{doc,getDoc,collection,query,where,getDocs,limit}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';import{isAdmin}from'./admin-check.js';function a12_0x5323(_0x5be47f,_0x1e0490){const _0x283725=a12_0x5d28();return a12_0x5323=function(_0x1bab59,_0x2178b8){_0x1bab59=_0x1bab59-0x1cf;let _0x5d2880=_0x283725[_0x1bab59];return _0x5d2880;},a12_0x5323(_0x5be47f,_0x1e0490);}const ADMIN_EMAILS=['admin@ladder.com',a12_0x420aef(0x1f1)],userCache={'uid':null,'username':null,'isAdmin':![],'hasCheckedCollections':![],'lastChecked':0x0,'role':null},invitationCache={'lastCheck':0x0,'pendingCount':0x0,'checkInterval':0x493e0};function updateInboxNotification(_0x20b3a6){const _0x1cb139=a12_0x420aef,_0x268709=document[_0x1cb139(0x1db)]('inbox-notification');_0x268709&&(_0x20b3a6>0x0?(_0x268709['style']['display']=_0x1cb139(0x1fa),_0x268709[_0x1cb139(0x1e8)]=_0x20b3a6>0x9?'9+':_0x20b3a6):_0x268709[_0x1cb139(0x1ff)][_0x1cb139(0x1fe)]=_0x1cb139(0x1f9));}async function checkPendingInvitationsForCurrentUser(_0x112a30){const _0x5ef076=a12_0x420aef;try{const _0x439a3d=Date['now']();if(_0x439a3d-invitationCache[_0x5ef076(0x1ef)]<invitationCache['checkInterval'])return updateInboxNotification(invitationCache[_0x5ef076(0x1fc)]),invitationCache['pendingCount'];invitationCache['lastCheck']=_0x439a3d;const _0x34885a=collection(db,'gameInvitations'),_0xd4e4bc=query(_0x34885a,where('toUserId','==',_0x112a30),where('status','==','pending'),limit(0x5)),_0x1c9cc4=await getDocs(_0xd4e4bc),_0x36a389=_0x1c9cc4['size'];return invitationCache[_0x5ef076(0x1fc)]=_0x36a389,updateInboxNotification(_0x36a389),_0x36a389;}catch(_0x388fed){return console['warn']('Could\x20not\x20check\x20pending\x20invitations\x20for\x20current\x20user:',_0x388fed),0x0;}}function updateAuthSectionImmediate(_0x5bbba0,_0x5c1903=![]){const _0x4f915a=a12_0x420aef,_0x388258=document['getElementById']('auth-section');if(!_0x388258)return;if(_0x5bbba0&&_0x5c1903)document['querySelectorAll']('.admin-only')['forEach'](_0x72338d=>{const _0xfbef17=a12_0x5323;_0x72338d['style']['display']=_0xfbef17(0x1d2);});else!_0x5bbba0&&document[_0x4f915a(0x1f0)]('.admin-only')['forEach'](_0x4aa0c8=>{const _0x162954=_0x4f915a;_0x4aa0c8['style']['display']=_0x162954(0x1f9);});if(_0x5bbba0){const _0x41afb1=userCache[_0x4f915a(0x1df)]||(_0x5bbba0[_0x4f915a(0x1da)]?_0x5bbba0[_0x4f915a(0x1da)]['split']('@')[0x0]:'User'),_0x5c8c4d=userCache[_0x4f915a(0x1fd)]?'\x20('+userCache[_0x4f915a(0x1fd)]+')':_0x5c1903?_0x4f915a(0x200):'';_0x388258['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20class=\x22nav-username\x22>'+_0x41afb1+_0x5c8c4d+'</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nav-dropdown-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22profile.html?username='+encodeURIComponent(_0x41afb1)+'\x22>Profile</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./inbox.html\x22\x20class=\x22nav-notification\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Inbox\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22inbox-notification\x22\x20class=\x22notification-dot\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22members.html\x22>Members</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22./redeem.html\x22><i\x20class=\x22fas\x20fa-gift\x22></i>\x20Redeem</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20id=\x22logout-link\x22>Sign\x20Out</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';const _0x158fb6=document['getElementById']('logout-link');_0x158fb6&&_0x158fb6['addEventListener']('click',_0x242d12=>{const _0x1245ea=_0x4f915a;_0x242d12[_0x1245ea(0x1f5)]();const _0x3936a9=getAuth();updateAuthSectionImmediate(null),_0x3936a9[_0x1245ea(0x1e5)]()[_0x1245ea(0x1de)](_0x39e143=>{console['error']('Error\x20signing\x20out:',_0x39e143);});}),_0x5bbba0['uid']&&setTimeout(()=>{const _0x4daacd=_0x4f915a;checkPendingInvitationsForCurrentUser(_0x5bbba0[_0x4daacd(0x1f3)]);},0x3e8);}else _0x388258['innerHTML']='<a\x20href=\x22login.html\x22\x20class=\x22login-link\x22>Login</a>';}async function checkAdminRoles(_0x41ffed){const _0x44dac3=a12_0x420aef;if(!_0x41ffed||!_0x41ffed['email'])return{'isAdmin':![],'role':null};try{console[_0x44dac3(0x1e0)]('Checking\x20roles\x20for\x20user:\x20'+_0x41ffed['email']);const _0x446264=['players','playersD2','playersD3','nonParticipants','userProfiles'],_0x5da5a3=['council',_0x44dac3(0x1d9),'owner',_0x44dac3(0x1e2)];for(const _0x1efe11 of _0x446264){try{const _0x409acc=doc(db,_0x1efe11,_0x41ffed['uid']),_0x4f80e3=await getDoc(_0x409acc);if(_0x4f80e3['exists']()){const _0x36fdf0=_0x4f80e3['data']();console['log']('Found\x20user\x20in\x20'+_0x1efe11+'\x20by\x20UID:',_0x36fdf0);let _0x11bd99=(_0x36fdf0['roleName']||_0x36fdf0[_0x44dac3(0x1fd)]||'')['toLowerCase'](),_0x378de2=_0x36fdf0['roleName']||_0x36fdf0['role']||'';if(_0x11bd99&&_0x5da5a3['includes'](_0x11bd99)){console['log'](_0x44dac3(0x1eb)+_0x11bd99+'\x20in\x20'+_0x1efe11);const _0x2a8efb=_0x378de2[_0x44dac3(0x1f8)]('\x20')[_0x44dac3(0x1f2)](_0x4cbf37=>_0x4cbf37['charAt'](0x0)['toUpperCase']()+_0x4cbf37[_0x44dac3(0x1e3)](0x1)['toLowerCase']())['join']('\x20');return{'isAdmin':!![],'role':_0x2a8efb};}}}catch(_0x2e389b){console['error']('Error\x20checking\x20'+_0x1efe11+_0x44dac3(0x1d7),_0x2e389b);}}for(const _0x59de94 of _0x446264){try{const _0x500e72=collection(db,_0x59de94);let _0x33447e=query(_0x500e72,where('email','==',_0x41ffed[_0x44dac3(0x1da)])),_0x1fb493=await getDocs(_0x33447e);_0x1fb493['empty']&&(_0x33447e=query(_0x500e72,where('email','==',_0x41ffed['email']['toLowerCase']())),_0x1fb493=await getDocs(_0x33447e));if(!_0x1fb493['empty']){const _0x1848c2=_0x1fb493['docs'][0x0]['data']();console['log']('Found\x20user\x20in\x20'+_0x59de94+'\x20by\x20email:',_0x1848c2);let _0xfea509=(_0x1848c2['roleName']||_0x1848c2[_0x44dac3(0x1fd)]||'')['toLowerCase'](),_0x261579=_0x1848c2[_0x44dac3(0x1dd)]||_0x1848c2['role']||'';if(_0xfea509&&_0x5da5a3['includes'](_0xfea509)){console['log']('Found\x20admin\x20role:\x20'+_0xfea509+_0x44dac3(0x1ec)+_0x59de94);const _0x1d5e04=_0x261579[_0x44dac3(0x1f8)]('\x20')[_0x44dac3(0x1f2)](_0x248547=>_0x248547[_0x44dac3(0x1d1)](0x0)['toUpperCase']()+_0x248547['slice'](0x1)['toLowerCase']())[_0x44dac3(0x1cf)]('\x20');return{'isAdmin':!![],'role':_0x1d5e04};}}}catch(_0x2793b8){console['error']('Error\x20checking\x20'+_0x59de94+_0x44dac3(0x203),_0x2793b8);}}return console[_0x44dac3(0x1e0)](_0x44dac3(0x1f7)),{'isAdmin':![],'role':null};}catch(_0x29bdb2){return console[_0x44dac3(0x1ea)]('Error\x20in\x20checkAdminRoles:',_0x29bdb2),{'isAdmin':![],'role':null};}}async function updateAuthSection(_0x27586b){const _0x577ade=a12_0x420aef,_0xfddc96=_0x27586b&&isAdmin(_0x27586b['email']);updateAuthSectionImmediate(_0x27586b,_0xfddc96);if(!_0x27586b){userCache['uid']=null,userCache['username']=null,userCache[_0x577ade(0x1e9)]=![],userCache[_0x577ade(0x1e7)]=![],userCache[_0x577ade(0x1fd)]=null;return;}const _0x31ef7b=Date[_0x577ade(0x1fb)]();if(_0x27586b['uid']===userCache['uid']&&userCache['hasCheckedCollections']&&_0x31ef7b-userCache[_0x577ade(0x1d8)]<0x493e0)return;try{userCache['uid']=_0x27586b['uid'],userCache['lastChecked']=_0x31ef7b;const _0x594dc5=isAdmin(_0x27586b['email']);userCache['isAdmin']=_0x594dc5;if(!_0x594dc5){const {isAdmin:_0x3ee544,role:_0x18e9b4}=await checkAdminRoles(_0x27586b);userCache['isAdmin']=_0x3ee544,userCache['role']=_0x18e9b4,_0x3ee544&&(document['querySelectorAll'](_0x577ade(0x1d3))[_0x577ade(0x1e1)](_0xf3a206=>{_0xf3a206['style']['display']='block';}),updateAuthSectionImmediate(_0x27586b,!![]));}const _0x39c21f=['players','playersD2',_0x577ade(0x201),'playersDuos',_0x577ade(0x202),'nonParticipants','userProfiles'],_0x13f93c=_0x39c21f[_0x577ade(0x1f2)](_0x3ce0f0=>getDoc(doc(db,_0x3ce0f0,_0x27586b[_0x577ade(0x1f3)]))['then'](_0x44affe=>_0x44affe['exists']()?{'collection':_0x3ce0f0,'data':_0x44affe[_0x577ade(0x1d0)]()}:null)['catch'](()=>null)),_0x2fff32=await Promise['all'](_0x13f93c),_0xac1001=_0x2fff32['filter'](_0x2902c5=>_0x2902c5!==null);let _0x599bce=null;for(const _0x299710 of _0xac1001){if(_0x299710[_0x577ade(0x1d0)]['username']){_0x599bce=_0x299710[_0x577ade(0x1d0)]['username'];break;}}userCache['username']=_0x599bce||(_0x27586b['email']?_0x27586b['email']['split']('@')[0x0]:'User'),userCache['hasCheckedCollections']=!![],updateAuthSectionImmediate(_0x27586b,userCache[_0x577ade(0x1e9)]),setTimeout(()=>{const _0x18ffe4=_0x577ade;checkPendingInvitationsForCurrentUser(_0x27586b[_0x18ffe4(0x1f3)]);},0x1f4);}catch(_0x55f827){console['error'](_0x577ade(0x1ed),_0x55f827);}}document[a12_0x420aef(0x1d6)]('DOMContentLoaded',()=>{const _0x576e8d=getAuth();onAuthStateChanged(_0x576e8d,async _0xabe13e=>{await updateAuthSection(_0xabe13e),_0xabe13e&&checkPendingInvitationsForCurrentUser(_0xabe13e['uid']);}),document['addEventListener']('visibilitychange',()=>{const _0x291d53=a12_0x5323;!document['hidden']&&_0x576e8d[_0x291d53(0x1e4)]&&checkPendingInvitationsForCurrentUser(_0x576e8d[_0x291d53(0x1e4)]['uid']);}),document['addEventListener']('click',_0x5647cb=>{const _0x192ee7=a12_0x5323;_0x5647cb[_0x192ee7(0x1e6)][_0x192ee7(0x1f4)](_0x192ee7(0x1d5))&&_0x576e8d['currentUser']&&checkPendingInvitationsForCurrentUser(_0x576e8d['currentUser'][_0x192ee7(0x1f3)]);});});function a12_0x5d28(){const _0x1c5649=['join','data','charAt','block','.admin-only','trace','a[href]','addEventListener','\x20by\x20UID:','lastChecked','creative\x20lead','email','getElementById','__proto__','roleName','catch','username','log','forEach','admin','slice','currentUser','signOut','target','hasCheckedCollections','textContent','isAdmin','error','Found\x20admin\x20role:\x20','\x20in\x20','Error\x20in\x20full\x20auth\x20update:','constructor','lastCheck','querySelectorAll','Brian2af@outlook.com','map','uid','closest','preventDefault','warn','No\x20admin\x20roles\x20found\x20for\x20user','split','none','inline-block','now','pendingCount','role','display','style','\x20(Admin)','playersD3','playersCTF','\x20by\x20email:'];a12_0x5d28=function(){return _0x1c5649;};return a12_0x5d28();}export{updateAuthSection};
const a14_0xec4dff=(function(){let _0x9bf0da=!![];return function(_0x31fcef,_0x5c4a02){const _0x106333=_0x9bf0da?function(){if(_0x5c4a02){const _0x54a253=_0x5c4a02['apply'](_0x31fcef,arguments);return _0x5c4a02=null,_0x54a253;}}:function(){};return _0x9bf0da=![],_0x106333;};}()),a14_0x23a436=a14_0xec4dff(this,function(){const _0x552c85=a14_0x1d80;let _0x8310f4;try{const _0x4b3956=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x8310f4=_0x4b3956();}catch(_0x2676fe){_0x8310f4=window;}const _0x573797=_0x8310f4['console']=_0x8310f4['console']||{},_0x4c727e=['log','warn',_0x552c85(0x1a8),'error',_0x552c85(0x1ae),'table',_0x552c85(0x1a0)];for(let _0x5eb874=0x0;_0x5eb874<_0x4c727e[_0x552c85(0x1ad)];_0x5eb874++){const _0x23c901=a14_0xec4dff['constructor']['prototype'][_0x552c85(0x19c)](a14_0xec4dff),_0x3bae0c=_0x4c727e[_0x5eb874],_0x1dcb0a=_0x573797[_0x3bae0c]||_0x23c901;_0x23c901['__proto__']=a14_0xec4dff['bind'](a14_0xec4dff),_0x23c901[_0x552c85(0x1a7)]=_0x1dcb0a['toString'][_0x552c85(0x19c)](_0x1dcb0a),_0x573797[_0x3bae0c]=_0x23c901;}});a14_0x23a436();function a14_0x4064(){const _0x219810=['bind','Unknown\x20Player','winnerId','opponent','trace','username','error','docs','Gold','desc','data','toString','info','empty','player','Error\x20fetching\x20D2\x20ELO\x20history:','approvedMatchesD2','length','exception'];a14_0x4064=function(){return _0x219810;};return a14_0x4064();}import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D2=[{'name':'Gold','elo':0x708},{'name':'Silver','elo':0x640},{'name':'Bronze','elo':0x578},{'name':'Unranked','elo':0x4b0}];let lastVisibleD2=null;async function getUsernameByIdD2(_0x13933d){const _0x20187a=a14_0x1d80;try{if(!_0x13933d)return'Unknown\x20Player';const _0x311af3=await getDoc(doc(db,'playersD2',_0x13933d));if(_0x311af3['exists']())return _0x311af3['data']()[_0x20187a(0x1a1)]||'Unknown\x20Player';const _0x1cd216=await getDocs(query(collection(db,_0x20187a(0x1ac)),where(_0x20187a(0x19e),'==',_0x13933d),limit(0x1)));if(!_0x1cd216[_0x20187a(0x1a9)])return _0x1cd216[_0x20187a(0x1a3)][0x0][_0x20187a(0x1a6)]()['winnerUsername']||_0x20187a(0x19d);const _0x1341fd=await getDocs(query(collection(db,_0x20187a(0x1ac)),where('loserId','==',_0x13933d),limit(0x1)));if(!_0x1341fd['empty'])return _0x1341fd['docs'][0x0]['data']()['loserUsername']||'Unknown\x20Player';return _0x20187a(0x19d);}catch(_0x1b328d){return console['error']('Error\x20getting\x20username:',_0x1b328d),'Unknown\x20Player';}}export async function recordEloChangeD2({playerId:_0x15cae7,previousElo:_0x4a2144,newElo:_0xa22d88,opponentId:_0x2dafe0,matchResult:_0x2ec4d6,previousPosition:_0x5f3109,newPosition:_0x34ba8a,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x86f4e4,timestamp:_0xb79efd}){const _0x2cef85=a14_0x1d80;try{const _0x15e61f=doc(collection(db,'eloHistoryD2'));let _0xbb06b8='match';if(isPromotion)_0xbb06b8='promotion';if(isDemotion)_0xbb06b8='demotion';let _0x106c80='Unranked';if(_0xa22d88>=0x834)_0x106c80='Emerald';else{if(_0xa22d88>=0x708)_0x106c80=_0x2cef85(0x1a4);else{if(_0xa22d88>=0x640)_0x106c80='Silver';else{if(_0xa22d88>=0x578)_0x106c80='Bronze';}}}return await setDoc(_0x15e61f,{'type':_0xbb06b8,'player':_0x15cae7,'opponent':_0x2dafe0,'previousElo':_0x4a2144,'newElo':_0xa22d88,'change':_0xa22d88-_0x4a2144,'matchResult':_0x2ec4d6,'previousPosition':_0x5f3109,'newPosition':_0x34ba8a,'rankAchieved':_0x106c80,'matchId':_0x86f4e4,'timestamp':_0xb79efd}),console['log']('D2\x20ELO\x20history\x20recorded\x20for\x20'+_0x15cae7),!![];}catch(_0x2aff60){console[_0x2cef85(0x1a2)]('Error\x20recording\x20D2\x20ELO\x20history:',_0x2aff60);throw _0x2aff60;}}function a14_0x1d80(_0x5490f5,_0x49b124){const _0x23a436=a14_0x4064();return a14_0x1d80=function(_0xec4dff,_0x1d338d){_0xec4dff=_0xec4dff-0x19c;let _0x4064fe=_0x23a436[_0xec4dff];return _0x4064fe;},a14_0x1d80(_0x5490f5,_0x49b124);}export async function getEloHistoryD2(_0x5e3c6c=0x14){const _0x890543=a14_0x1d80;try{const _0x352631=collection(db,'eloHistoryD2');let _0x5101fd;lastVisibleD2?_0x5101fd=query(_0x352631,orderBy('timestamp','desc'),startAfter(lastVisibleD2),limit(_0x5e3c6c)):_0x5101fd=query(_0x352631,orderBy('timestamp',_0x890543(0x1a5)),limit(_0x5e3c6c));const _0x4c39cd=await getDocs(_0x5101fd);if(_0x4c39cd['empty'])return{'entries':[],'hasMore':![]};lastVisibleD2=_0x4c39cd['docs'][_0x4c39cd['docs']['length']-0x1];const _0xfce066=_0x4c39cd[_0x890543(0x1a3)]['map'](async _0x547aa1=>{const _0x550c84=_0x890543,_0x98805b=_0x547aa1['data'](),[_0x4f5ed3,_0x2081d9]=await Promise['all']([getUsernameByIdD2(_0x98805b[_0x550c84(0x1aa)]),getUsernameByIdD2(_0x98805b[_0x550c84(0x19f)])]);return{..._0x98805b,'playerUsername':_0x4f5ed3,'opponentUsername':_0x2081d9,'change':_0x98805b['newElo']-_0x98805b['previousElo'],'timestamp':_0x98805b['timestamp']};}),_0x5aef89=await Promise['all'](_0xfce066);return{'entries':_0x5aef89,'hasMore':_0x4c39cd['size']===_0x5e3c6c};}catch(_0x42aefd){console['error'](_0x890543(0x1ab),_0x42aefd);throw _0x42aefd;}}export function resetPaginationD2(){lastVisibleD2=null;}
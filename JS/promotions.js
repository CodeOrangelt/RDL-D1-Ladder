const a44_0x4256d4=a44_0x39df,a44_0x3fa31b=(function(){let _0x42acd4=!![];return function(_0x184d82,_0x481f55){const _0x31e61c=_0x42acd4?function(){if(_0x481f55){const _0x10b5f4=_0x481f55['apply'](_0x184d82,arguments);return _0x481f55=null,_0x10b5f4;}}:function(){};return _0x42acd4=![],_0x31e61c;};}()),a44_0x295391=a44_0x3fa31b(this,function(){const _0x40c818=a44_0x39df,_0x38172a=function(){const _0x54b176=a44_0x39df;let _0x524169;try{_0x524169=Function(_0x54b176(0x1bd)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x374ca9){_0x524169=window;}return _0x524169;},_0x526cba=_0x38172a(),_0x5b5cff=_0x526cba['console']=_0x526cba['console']||{},_0x58d2de=['log','warn',_0x40c818(0x174),'error','exception','table','trace'];for(let _0x2618d5=0x0;_0x2618d5<_0x58d2de['length'];_0x2618d5++){const _0x1aa354=a44_0x3fa31b[_0x40c818(0x19d)]['prototype'][_0x40c818(0x1ba)](a44_0x3fa31b),_0x529aa7=_0x58d2de[_0x2618d5],_0x240adb=_0x5b5cff[_0x529aa7]||_0x1aa354;_0x1aa354['__proto__']=a44_0x3fa31b['bind'](a44_0x3fa31b),_0x1aa354[_0x40c818(0x16a)]=_0x240adb['toString']['bind'](_0x240adb),_0x5b5cff[_0x529aa7]=_0x1aa354;}});a44_0x295391();import{collection,doc,query,where,orderBy,limit,getDocs,addDoc,getDoc,serverTimestamp,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{auth,db}from'./firebase-config.js';class PromotionManager{constructor(){const _0x106e19=a44_0x39df;this[_0x106e19(0x1bb)]=0x18,this['RANKS']=[{'threshold':0x578,'name':'Bronze','color':'#CD7F32'},{'threshold':0x640,'name':_0x106e19(0x1b5),'color':'#C0C0C0'},{'threshold':0x708,'name':'Gold','color':_0x106e19(0x18e)},{'threshold':0x834,'name':_0x106e19(0x18f),'color':_0x106e19(0x1c1)}],this['bannerContainer']=null,this['lastFetchTime']=0x0,this['fetchInterval']=0xea60,this[_0x106e19(0x162)]=null,this['usernameCache']={};}['initialize'](){const _0xadef0e=a44_0x39df;this['bannerContainer']=document['getElementById']('promotion-banner-container');if(!this['bannerContainer']){console['error']('Promotion\x20banner\x20container\x20not\x20found');return;}this['setupBannerContainer']();const _0x733d25=_0xadef0e(0x1c8)+new Date()['toDateString'](),_0x4f7032=sessionStorage['getItem'](_0x733d25);!_0x4f7032&&(this['fetchRecentPromotions'](),sessionStorage[_0xadef0e(0x166)](_0x733d25,'true')),document['addEventListener'](_0xadef0e(0x1b0),()=>{const _0x21156f=_0xadef0e;document[_0x21156f(0x197)]==='visible'&&!sessionStorage[_0x21156f(0x172)](_0x733d25)&&(this['fetchRecentPromotions'](),sessionStorage[_0x21156f(0x166)](_0x733d25,_0x21156f(0x195)));}),window['addEventListener']('beforeunload',()=>{const _0xccf8b8=_0xadef0e;this['pollingInterval']&&clearInterval(this[_0xccf8b8(0x162)]);});}['setupBannerContainer'](){this['bannerContainer']['innerHTML']='',this['bannerContainer']['style']['display']='none';}async['fetchRecentPromotions'](){const _0x1cb56e=a44_0x39df;try{const _0x54bc6d=Date['now']();if(_0x54bc6d-this['lastFetchTime']<this['fetchInterval'])return;this['lastFetchTime']=_0x54bc6d;const _0x1d76a6=collection(db,'eloHistory'),_0x23bf82=query(_0x1d76a6,where(_0x1cb56e(0x1b3),'in',['promotion','demotion']),orderBy('timestamp','desc'),limit(0x14)),_0x53b272=await getDocs(_0x23bf82),_0x2d121c=[];_0x53b272['forEach'](_0x549128=>{const _0x14e4e0={'id':_0x549128['id'],..._0x549128['data']()};this['shouldShowPromotion'](_0x549128['id'])&&this['isNewRankChange'](_0x14e4e0)&&_0x2d121c['push'](_0x14e4e0);}),_0x2d121c['length']>0x0&&await this['processRankChanges'](_0x2d121c);}catch(_0x3bf295){console[_0x1cb56e(0x194)]('Error\x20fetching\x20promotions:',_0x3bf295);}}async['processRankChanges'](_0x587e68){const _0x4601f8=a44_0x39df;if(_0x587e68[_0x4601f8(0x1c0)]===0x0)return;_0x587e68['sort']((_0x46e72f,_0xd659f5)=>{const _0x171a5c=_0x4601f8,_0xc9045d=_0x46e72f[_0x171a5c(0x1c7)]?.['toMillis']?.()||_0x46e72f['timestamp']?.[_0x171a5c(0x188)]*0x3e8||0x0,_0x1306ec=_0xd659f5[_0x171a5c(0x1c7)]?.[_0x171a5c(0x19f)]?.()||_0xd659f5['timestamp']?.['seconds']*0x3e8||0x0;return _0x1306ec-_0xc9045d;});const _0x4fd6b4=this[_0x4601f8(0x178)]['children']['length'],_0x1f2f98=0x3-_0x4fd6b4;if(_0x1f2f98<=0x0)return;const _0x504c29=_0x587e68[_0x4601f8(0x17e)](0x0,_0x1f2f98);for(let _0x3416b8=0x0;_0x3416b8<_0x504c29['length'];_0x3416b8++){const _0x239e64=_0x504c29[_0x3416b8],_0x4a886e=auth['currentUser'];try{setTimeout(()=>{this['showRankChangeBanner'](_0x239e64);},_0x3416b8*0x3e8),_0x4a886e&&_0x239e64['player']===_0x4a886e[_0x4601f8(0x19b)]&&this[_0x4601f8(0x163)](_0x239e64[_0x4601f8(0x1b3)],_0x239e64['rankAchieved']);}catch(_0x823278){console['error']('Error\x20processing\x20rank\x20change:',_0x823278);}}}['shouldShowPromotion'](_0x18cae5){const _0x1615f7=a44_0x39df;try{const _0x518704='promotion_'+_0x18cae5,_0x47d6c6=localStorage['getItem'](_0x518704);if(_0x47d6c6){let _0xd9f318;try{_0xd9f318=JSON['parse'](_0x47d6c6);}catch(_0x299169){return console['warn'](_0x1615f7(0x192)+_0x518704+',\x20treating\x20as\x20new'),!![];}if(_0xd9f318['ignored']===!![])return console['log']('Promotion\x20'+_0x18cae5+'\x20is\x20permanently\x20ignored'),![];const _0xb796d4=Date['now']();if(_0xd9f318[_0x1615f7(0x171)]&&_0xb796d4-_0xd9f318['timestamp']<this[_0x1615f7(0x1bb)]*0x3c*0x3c*0x3e8)return console['log'](_0x1615f7(0x1ca)+_0x18cae5+_0x1615f7(0x175)+this[_0x1615f7(0x1bb)]+'\x20hours'),![];if(_0xd9f318['systemDismissed']&&_0xb796d4-_0xd9f318[_0x1615f7(0x1c7)]<0x4*0x3c*0x3c*0x3e8)return console['log']('Promotion\x20'+_0x18cae5+_0x1615f7(0x1ad)),![];}return!![];}catch(_0x3b4146){return console[_0x1615f7(0x194)]('Error\x20checking\x20promotion\x20visibility:',_0x3b4146),![];}}[a44_0x4256d4(0x18c)](_0x2c3fa8){const _0x22b954=a44_0x4256d4;try{const _0x4fef83='promotion_'+_0x2c3fa8;localStorage[_0x22b954(0x166)](_0x4fef83,JSON[_0x22b954(0x182)]({'timestamp':Date['now'](),'ignored':!![]}));}catch(_0xfa4ee2){console[_0x22b954(0x194)]('Error\x20saving\x20promotion\x20preference:',_0xfa4ee2);}}[a44_0x4256d4(0x161)](_0x23a12c){const _0x38a758=a44_0x4256d4;this[_0x38a758(0x1c3)](_0x23a12c)['then'](_0x4cfd2c=>{const _0x4ab59d=_0x38a758,_0x8c7a54='promotion_'+_0x23a12c['id'],_0x27f866=localStorage['getItem'](_0x8c7a54);if(_0x27f866)try{const _0x40e85d=JSON['parse'](_0x27f866);if(_0x40e85d[_0x4ab59d(0x1be)]===!![]){console['log']('Skipping\x20ignored\x20promotion:\x20'+_0x23a12c['id']);return;}}catch(_0x1eec34){}localStorage['setItem'](_0x8c7a54,JSON['stringify']({'timestamp':Date[_0x4ab59d(0x176)](),'ignored':![],'userDismissed':![],'systemDismissed':![],'seenAt':Date[_0x4ab59d(0x176)]()})),this[_0x4ab59d(0x178)]['style']['display']='block';while(this['bannerContainer']['children']['length']>=0x3){this['bannerContainer'][_0x4ab59d(0x1a4)](this['bannerContainer']['firstChild']);}const _0x2db5c5=document['createElement']('div');_0x2db5c5['className']='promotion-banner',_0x2db5c5['setAttribute'](_0x4ab59d(0x190),_0x4cfd2c[_0x4ab59d(0x196)]),_0x2db5c5[_0x4ab59d(0x173)]('data-id',_0x4cfd2c['id']);const _0x3a3cbd=document['createElement']('div');_0x3a3cbd['className']='promotion-details';const _0x3333e1=_0x4cfd2c['resolvedName']||_0x4cfd2c['player']||_0x4cfd2c[_0x4ab59d(0x19e)]||_0x4cfd2c[_0x4ab59d(0x1ae)]||_0x4cfd2c['displayName']||'A\x20player',_0x3cbc31=_0x4cfd2c['type']==='promotion'?_0x3333e1+_0x4ab59d(0x170):_0x3333e1+'\x20was\x20demoted\x20to';_0x3a3cbd[_0x4ab59d(0x1c2)]=_0x3cbc31+'\x20<span\x20class=\x22rank-text\x22>'+_0x4cfd2c['rankAchieved']+_0x4ab59d(0x17b);const _0x9979d4=document['createElement'](_0x4ab59d(0x18b));_0x9979d4['className']='banner-actions';const _0x1e11a8=document['createElement'](_0x4ab59d(0x19a));_0x1e11a8['className']='dismiss-btn',_0x1e11a8['innerHTML']='&times;',_0x1e11a8[_0x4ab59d(0x1b6)]='Dismiss';const _0x3e8c84=document[_0x4ab59d(0x1a0)](_0x4ab59d(0x19a));_0x3e8c84['className']='ignore-btn',_0x3e8c84['textContent']='Don\x27t\x20show\x20again',_0x3e8c84['title']=_0x4ab59d(0x1b2),_0x9979d4[_0x4ab59d(0x191)](_0x3e8c84),_0x9979d4['appendChild'](_0x1e11a8),_0x2db5c5[_0x4ab59d(0x191)](_0x3a3cbd),_0x2db5c5['appendChild'](_0x9979d4),this['bannerContainer']['appendChild'](_0x2db5c5),void _0x2db5c5['offsetWidth'],setTimeout(()=>{_0x2db5c5['classList']['add']('new-rank-change');},0x32),_0x1e11a8['addEventListener']('click',()=>{const _0x3f3a4d=_0x4ab59d;localStorage[_0x3f3a4d(0x166)](_0x8c7a54,JSON[_0x3f3a4d(0x182)]({'timestamp':Date['now'](),'ignored':![],'userDismissed':!![],'systemDismissed':![]})),_0x2db5c5['classList'][_0x3f3a4d(0x165)](_0x3f3a4d(0x184)),_0x2db5c5['classList']['add']('dismissing'),setTimeout(()=>{const _0x37e2d9=_0x3f3a4d;_0x2db5c5['parentNode']&&(_0x2db5c5['remove'](),this[_0x37e2d9(0x178)]['children'][_0x37e2d9(0x1c0)]===0x0&&(this[_0x37e2d9(0x178)]['style']['display']='none'));},0x1f4);}),_0x3e8c84['addEventListener'](_0x4ab59d(0x1cb),()=>{const _0x486c4b=_0x4ab59d;localStorage['setItem'](_0x8c7a54,JSON[_0x486c4b(0x182)]({'timestamp':Date['now'](),'ignored':!![],'userDismissed':!![],'systemDismissed':![]})),_0x2db5c5['classList']['remove'](_0x486c4b(0x184)),_0x2db5c5['classList'][_0x486c4b(0x1a2)](_0x486c4b(0x1a8)),setTimeout(()=>{const _0x2bb409=_0x486c4b;_0x2db5c5['parentNode']&&(_0x2db5c5['remove'](),this['bannerContainer'][_0x2bb409(0x17d)]['length']===0x0&&(this[_0x2bb409(0x178)]['style']['display']=_0x2bb409(0x1ab)));},0x1f4);}),setTimeout(()=>{const _0xdd5834=_0x4ab59d;_0x2db5c5['parentNode']&&(_0x2db5c5['classList']['remove'](_0xdd5834(0x184)),_0x2db5c5['classList']['add']('dismissing'),localStorage['setItem'](_0x8c7a54,JSON[_0xdd5834(0x182)]({'timestamp':Date['now'](),'ignored':![],'userDismissed':![],'systemDismissed':!![]})),setTimeout(()=>{_0x2db5c5['parentNode']&&(_0x2db5c5['remove'](),this['bannerContainer']['children']['length']===0x0&&(this['bannerContainer']['style']['display']='none'));},0x1f4));},0x3a98);});}async[a44_0x4256d4(0x1c3)](_0x992020){const _0x2a8de5=a44_0x4256d4,_0x29790a={..._0x992020},_0x33a612=[_0x992020['player'],_0x992020['username'],_0x992020[_0x2a8de5(0x1ae)],_0x992020[_0x2a8de5(0x19b)]],_0x1dc056=_0x33a612['some'](_0x517fa8=>_0x517fa8&&typeof _0x517fa8===_0x2a8de5(0x1c4)&&!_0x517fa8[_0x2a8de5(0x1bf)](_0x2a8de5(0x18d))&&!/^[a-zA-Z0-9]{20,}$/[_0x2a8de5(0x198)](_0x517fa8));if(_0x1dc056)return _0x29790a;let _0x13b75a=null;if(_0x992020['userId'])_0x13b75a=_0x992020['userId'];else _0x992020['player']&&/^[A-Za-z0-9]{20,}$/['test'](_0x992020['player'])&&(_0x13b75a=_0x992020['player']);if(!_0x13b75a)return _0x29790a;try{const _0x254a25=await getDoc(doc(db,_0x2a8de5(0x179),_0x13b75a));if(_0x254a25['exists']()){const _0x4b93c1=_0x254a25['data']();if(_0x4b93c1[_0x2a8de5(0x19e)])return _0x29790a['resolvedName']=_0x4b93c1['username'],_0x29790a;}const _0x801bcc=await getDocs(query(collection(db,'approvedMatches'),where('winnerId','==',_0x13b75a),orderBy(_0x2a8de5(0x1b1),_0x2a8de5(0x1a3)),limit(0x1)));if(!_0x801bcc['empty']){const _0x26a947=_0x801bcc['docs'][0x0][_0x2a8de5(0x1c5)]();if(_0x26a947['winnerUsername'])return _0x29790a[_0x2a8de5(0x16e)]=_0x26a947[_0x2a8de5(0x1aa)],_0x29790a;}const _0x5886e0=await getDocs(query(collection(db,'approvedMatches'),where('loserId','==',_0x13b75a),orderBy(_0x2a8de5(0x1b1),_0x2a8de5(0x1a3)),limit(0x1)));if(!_0x5886e0['empty']){const _0xe73a7b=_0x5886e0['docs'][0x0]['data']();if(_0xe73a7b['loserUsername'])return _0x29790a['resolvedName']=_0xe73a7b['loserUsername'],console[_0x2a8de5(0x16c)]('Resolved\x20'+_0x13b75a+'\x20to\x20'+_0xe73a7b['loserUsername']+'\x20(loser)'),_0x29790a;}}catch(_0x391fe8){console['error'](_0x2a8de5(0x1a9),_0x391fe8);}return console[_0x2a8de5(0x17a)]('Failed\x20to\x20resolve\x20user\x20ID:\x20'+_0x13b75a),_0x29790a;}['showRankChangeLightbox'](_0x50cf27,_0x443b32){const _0xd647a3=a44_0x4256d4;let _0x43a606=document['getElementById']('rankChangeModal');!_0x43a606&&(_0x43a606=document['createElement']('div'),_0x43a606['id']='rankChangeModal',_0x43a606['className']='rank-change-modal\x20'+_0x50cf27,document['body'][_0xd647a3(0x191)](_0x43a606));const _0x1d3d36=_0x50cf27==='promotion'?'Congratulations!':_0xd647a3(0x169),_0x684e12=_0x50cf27===_0xd647a3(0x1af)?'You\x27ve\x20been\x20promoted\x20to':_0xd647a3(0x193);_0x43a606['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rank-change-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2\x20class=\x22rank-change-title\x22>'+_0x1d3d36+'</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>'+_0x684e12+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22rank-name\x22>'+_0x443b32+_0xd647a3(0x16f),_0x43a606['style']['display']='flex',document['getElementById'](_0xd647a3(0x17c))[_0xd647a3(0x19c)]('click',()=>{const _0x5f45d4=_0xd647a3;_0x43a606[_0x5f45d4(0x17f)]['display']='none';}),_0x43a606['addEventListener']('click',_0x2edf77=>{_0x2edf77['target']===_0x43a606&&(_0x43a606['style']['display']='none');});}async['checkAndRecordPromotion'](_0x453a0d,_0xa2e888,_0x22cef5,_0x3b9381={}){const _0x49ed1b=a44_0x4256d4;try{if(_0xa2e888===_0x22cef5||!_0x453a0d)return null;const _0x2908d5=_0x3b9381[_0x49ed1b(0x1b8)]||'automatic',_0xf270bc=_0x3b9381['matchId']||null,_0x4e8905=_0x3b9381['adminUser']||null;console[_0x49ed1b(0x16c)]('Processing\x20potential\x20rank\x20change:\x20'+_0x22cef5+_0x49ed1b(0x177)+_0xa2e888+'\x20(source:\x20'+_0x2908d5+')');let _0x8f5c4=null,_0x1f7a8e=null;try{const _0x4e251e=await getDoc(doc(db,'players',_0x453a0d));if(_0x4e251e['exists']()){const _0x26807b=_0x4e251e['data']();_0x8f5c4=_0x26807b['username']||_0x26807b['displayName']||null,_0x1f7a8e=_0x26807b['displayName']||_0x26807b['username']||null;}!_0x8f5c4&&_0x3b9381['username']&&(_0x8f5c4=_0x3b9381['username'],_0x1f7a8e=_0x3b9381['username']);!_0x8f5c4&&auth['currentUser']&&(_0x8f5c4=auth['currentUser'][_0x49ed1b(0x19b)]||auth['currentUser'][_0x49ed1b(0x160)][_0x49ed1b(0x1b7)]('@')[0x0],_0x1f7a8e=auth[_0x49ed1b(0x1a5)]['displayName']||null);if(!_0x8f5c4){const _0x541027=query(collection(db,_0x49ed1b(0x1ac)),where(_0x49ed1b(0x167),'==',_0x453a0d),limit(0x1)),_0x543b0d=await getDocs(_0x541027);if(!_0x543b0d['empty'])_0x8f5c4=_0x543b0d['docs'][0x0]['data']()['winnerUsername']||'Unknown\x20Player',_0x1f7a8e=_0x8f5c4;else{const _0x56a2b6=query(collection(db,'approvedMatches'),where('loserId','==',_0x453a0d),limit(0x1)),_0x5466ba=await getDocs(_0x56a2b6);!_0x5466ba['empty']&&(_0x8f5c4=_0x5466ba[0x0]['data']()['loserUsername']||_0x49ed1b(0x180),_0x1f7a8e=_0x8f5c4);}}}catch(_0x403db5){console[_0x49ed1b(0x194)](_0x49ed1b(0x1b4),_0x403db5);}!_0x8f5c4&&(console[_0x49ed1b(0x17a)]('Could\x20not\x20resolve\x20username\x20for\x20userId:',_0x453a0d),_0x8f5c4='A\x20player',_0x1f7a8e=_0x49ed1b(0x180));const _0x3a564d=this[_0x49ed1b(0x1a7)](_0x22cef5),_0x5192d6=this['getRankName'](_0xa2e888);if(_0x3a564d!==_0x5192d6){const _0x46bf96=_0xa2e888>_0x22cef5,_0x4b29c6=_0x46bf96?'promotion':'demotion',_0xfdcdcf=_0x5192d6;console['log']('Recording\x20'+_0x4b29c6+'\x20for\x20'+_0x8f5c4+':\x20'+_0x22cef5+'\x20('+_0x3a564d+')\x20→\x20'+_0xa2e888+'\x20('+_0x5192d6+')');try{const _0x394eff={'player':_0x8f5c4,'playerUsername':_0x8f5c4,'username':_0x8f5c4,'displayName':_0x1f7a8e,'userId':_0x453a0d,'type':_0x4b29c6,'rankAchieved':_0xfdcdcf,'timestamp':serverTimestamp(),'previousElo':_0x22cef5,'newElo':_0xa2e888,'change':_0xa2e888-_0x22cef5,'previousRank':_0x3a564d,'newRank':_0x5192d6,'source':_0x2908d5};if(_0x2908d5==='match'&&_0xf270bc)_0x394eff['matchId']=_0xf270bc;else _0x2908d5==='admin'&&_0x4e8905?(_0x394eff['modifiedBy']=_0x4e8905,_0x394eff[_0x49ed1b(0x1bc)]=![]):_0x394eff[_0x49ed1b(0x1bc)]=!![];const _0x2e2b9e=writeBatch(db),_0x475c23=doc(collection(db,'eloHistory')),_0x1db7c9=doc(collection(db,'promotionHistory'));return _0x2e2b9e['set'](_0x475c23,_0x394eff),_0x2e2b9e[_0x49ed1b(0x186)](_0x1db7c9,_0x394eff),await _0x2e2b9e[_0x49ed1b(0x183)](),await this['sendPromotionNotification'](_0x453a0d,_0x8f5c4,_0x22cef5,_0xa2e888,_0x3a564d,_0x5192d6,_0x4b29c6,{'displayName':_0x1f7a8e,'source':_0x2908d5,'matchId':_0xf270bc,'ladder':_0x3b9381['ladder']||'D1'}),console['log'](_0x49ed1b(0x1b9)+_0x4b29c6+_0x49ed1b(0x16d)+_0x8f5c4+_0x49ed1b(0x199)+_0xfdcdcf),_0xfdcdcf;}catch(_0xce9900){console['error']('Error\x20writing\x20promotion\x20records:',_0xce9900);try{return await addDoc(collection(db,'eloHistory'),{'player':_0x8f5c4,'playerUsername':_0x8f5c4,'username':_0x8f5c4,'displayName':_0x1f7a8e,'userId':_0x453a0d,'type':_0x4b29c6,'rankAchieved':_0xfdcdcf,'timestamp':serverTimestamp(),'previousElo':_0x22cef5,'newElo':_0xa2e888,'change':_0xa2e888-_0x22cef5,'previousRank':_0x3a564d,'source':_0x2908d5,'isAutomatic':_0x2908d5!==_0x49ed1b(0x187)}),await this['sendPromotionNotification'](_0x453a0d,_0x8f5c4,_0x22cef5,_0xa2e888,_0x3a564d,_0x5192d6,_0x4b29c6,{'displayName':_0x1f7a8e,'source':_0x2908d5,'matchId':_0xf270bc,'ladder':_0x3b9381[_0x49ed1b(0x164)]||'D1'}),_0xfdcdcf;}catch(_0x439584){return console[_0x49ed1b(0x194)]('Fallback\x20write\x20failed:',_0x439584),null;}}}return null;}catch(_0x2e817f){return console[_0x49ed1b(0x194)]('Error\x20in\x20promotion/demotion\x20recording:',_0x2e817f),null;}}['getRankName'](_0x69a2ae){const _0x10a4c8=a44_0x4256d4;for(let _0x13d906=this['RANKS']['length']-0x1;_0x13d906>=0x0;_0x13d906--){if(_0x69a2ae>=this['RANKS'][_0x13d906]['threshold'])return this[_0x10a4c8(0x1c6)][_0x13d906][_0x10a4c8(0x18a)];}return _0x10a4c8(0x181);}[a44_0x4256d4(0x168)](){this['pollingInterval']&&clearInterval(this['pollingInterval']);}['isNewRankChange'](_0x2b52d4){const _0x39993a=a44_0x4256d4;if(_0x2b52d4['timestamp']){const _0x4d1b82=_0x2b52d4['timestamp'][_0x39993a(0x188)]*0x3e8,_0x529226=Date['now'](),_0x45a51e=(_0x529226-_0x4d1b82)/(0x3e8*0x3c*0x3c);if(_0x45a51e>0x18)return![];}if(_0x2b52d4['previousRank']&&_0x2b52d4['newRank']&&_0x2b52d4[_0x39993a(0x1a1)]!==_0x2b52d4['newRank'])return!![];return![];}async['sendPromotionNotification'](_0x45998a,_0x43aa9e,_0x2ab685,_0x55ff2e,_0x595d8d,_0x1ffa0a,_0x5c2dbc,_0x129c7c={}){const _0x56ad33=a44_0x4256d4;try{console['log'](_0x56ad33(0x1c9)+_0x43aa9e+'\x27s\x20'+_0x5c2dbc);const _0x2cf3ae={'userId':_0x45998a,'username':_0x43aa9e,'displayName':_0x129c7c['displayName']||_0x43aa9e,'oldElo':parseInt(_0x2ab685),'newElo':parseInt(_0x55ff2e),'eloDifference':parseInt(_0x55ff2e)-parseInt(_0x2ab685),'oldRank':_0x595d8d,'newRank':_0x1ffa0a,'type':_0x5c2dbc,'timestamp':serverTimestamp(),'processed':![],'source':_0x129c7c['source']||_0x56ad33(0x16b),'matchId':_0x129c7c[_0x56ad33(0x189)]||null,'ladder':_0x129c7c['ladder']||'D1','adminUser':_0x129c7c['adminUser']||null};console['log']('Creating\x20Discord\x20notification:',_0x2cf3ae);const _0x438afb=await addDoc(collection(db,'promotionNotifications'),_0x2cf3ae);return console['log']('Discord\x20notification\x20sent\x20successfully\x20with\x20ID:\x20'+_0x438afb['id']),!![];}catch(_0x3cb6cc){return console[_0x56ad33(0x194)]('Error\x20sending\x20Discord\x20notification:',_0x3cb6cc),![];}}}export const promotionManager=new PromotionManager();document['addEventListener']('DOMContentLoaded',()=>{const _0x79a16a=a44_0x4256d4;promotionManager[_0x79a16a(0x1a6)]();});function a44_0x39df(_0x465d88,_0x5dde85){const _0x295391=a44_0x4a65();return a44_0x39df=function(_0x3fa31b,_0x49ec2e){_0x3fa31b=_0x3fa31b-0x160;let _0x4a651f=_0x295391[_0x3fa31b];return _0x4a651f;},a44_0x39df(_0x465d88,_0x5dde85);}export const initializePromotionTracker=()=>promotionManager['initialize']();export const checkAndRecordPromotion=(_0x1389eb,_0x466af4,_0x1240f9,_0x4d48c8)=>promotionManager[a44_0x4256d4(0x185)](_0x1389eb,_0x466af4,_0x1240f9,_0x4d48c8);export const getRankName=_0x58b59c=>promotionManager['getRankName'](_0x58b59c);function a44_0x4a65(){const _0x205d60=['email','showRankChangeBanner','pollingInterval','showRankChangeLightbox','ladder','remove','setItem','winnerId','cleanup','Rank\x20Update','toString','automatic','log','\x20for\x20','resolvedName','</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22rank-change-button\x22\x20id=\x22rank-change-ok-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Got\x20it!\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','\x20was\x20promoted\x20to','userDismissed','getItem','setAttribute','info','\x20was\x20dismissed\x20by\x20user\x20within\x20last\x20','now','\x20→\x20','bannerContainer','players','warn','</span>','rank-change-ok-btn','children','slice','style','Unknown\x20Player','Unranked','stringify','commit','new-rank-change','checkAndRecordPromotion','set','admin','seconds','matchId','name','div','ignorePromotion','ID:','#FFD700','Emerald','data-rank','appendChild','Invalid\x20storage\x20format\x20for\x20','You\x27ve\x20been\x20demoted\x20to','error','true','rankAchieved','visibilityState','test','\x20to\x20','button','displayName','addEventListener','constructor','username','toMillis','createElement','previousRank','add','desc','removeChild','currentUser','initialize','getRankName','dismissing','Error\x20resolving\x20user\x20ID:','winnerUsername','none','approvedMatches','\x20was\x20auto-dismissed\x20within\x20last\x204\x20hours','playerUsername','promotion','visibilitychange','date','Never\x20show\x20this\x20promotion\x20again','type','Error\x20resolving\x20username:','Silver','title','split','source','Successfully\x20recorded\x20','bind','DISPLAY_HOURS','isAutomatic','return\x20(function()\x20','ignored','includes','length','#50C878','innerHTML','resolveUserId','string','data','RANKS','timestamp','promotions_checked_','STARTING\x20notification\x20for\x20','Promotion\x20','click'];a44_0x4a65=function(){return _0x205d60;};return a44_0x4a65();}
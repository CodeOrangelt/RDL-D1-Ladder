const a0_0x4e0e41=a0_0x5858;function a0_0x1fe7(){const _0x42b70f=['1160310WciAfM','trace','Gold','log','exists','70NusTmY','891536bSDUPH','Silver','desc','demotion','7863dIhqCd','console','451088whxLFn','data','toString','206qqircq','loserId','Error\x20recording\x20D3\x20ELO\x20history:','828549aqldYb','docs','empty','error','Unranked','Emerald','344360hoSVQy','D3\x20ELO\x20history\x20recorded\x20for\x20','3372318txuOaw','Unknown\x20Player','12hfzESf','126mqMlVj','timestamp'];a0_0x1fe7=function(){return _0x42b70f;};return a0_0x1fe7();}(function(_0x12e33b,_0x5a344f){const _0x455cd2=a0_0x5858,_0x8db032=_0x12e33b();while(!![]){try{const _0x4babd2=-parseInt(_0x455cd2(0x98))/0x1*(-parseInt(_0x455cd2(0x9d))/0x2)+-parseInt(_0x455cd2(0xa0))/0x3+-parseInt(_0x455cd2(0x94))/0x4+parseInt(_0x455cd2(0xad))/0x5*(parseInt(_0x455cd2(0xaa))/0x6)+parseInt(_0x455cd2(0xab))/0x7*(-parseInt(_0x455cd2(0xa6))/0x8)+parseInt(_0x455cd2(0xa8))/0x9+-parseInt(_0x455cd2(0xb2))/0xa*(-parseInt(_0x455cd2(0x9a))/0xb);if(_0x4babd2===_0x5a344f)break;else _0x8db032['push'](_0x8db032['shift']());}catch(_0x18e518){_0x8db032['push'](_0x8db032['shift']());}}}(a0_0x1fe7,0xa1986));const a0_0x4fd44a=(function(){let _0x407935=!![];return function(_0x26b4b9,_0x581cf6){const _0x556aaf=_0x407935?function(){if(_0x581cf6){const _0x1d9599=_0x581cf6['apply'](_0x26b4b9,arguments);return _0x581cf6=null,_0x1d9599;}}:function(){};return _0x407935=![],_0x556aaf;};}()),a0_0x121a43=a0_0x4fd44a(this,function(){const _0x32ce43=a0_0x5858,_0x2904bc=function(){let _0x49e703;try{_0x49e703=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x4bfa53){_0x49e703=window;}return _0x49e703;},_0x50c7a9=_0x2904bc(),_0x29234d=_0x50c7a9['console']=_0x50c7a9[_0x32ce43(0x99)]||{},_0x4ff5ef=['log','warn','info','error','exception','table',_0x32ce43(0xae)];for(let _0x5ec96c=0x0;_0x5ec96c<_0x4ff5ef['length'];_0x5ec96c++){const _0x4d6ab6=a0_0x4fd44a['constructor']['prototype']['bind'](a0_0x4fd44a),_0x4df8df=_0x4ff5ef[_0x5ec96c],_0x7f2b1=_0x29234d[_0x4df8df]||_0x4d6ab6;_0x4d6ab6['__proto__']=a0_0x4fd44a['bind'](a0_0x4fd44a),_0x4d6ab6['toString']=_0x7f2b1[_0x32ce43(0x9c)]['bind'](_0x7f2b1),_0x29234d[_0x4df8df]=_0x4d6ab6;}});function a0_0x5858(_0x4c8c80,_0x4961ab){const _0x194276=a0_0x1fe7();return a0_0x5858=function(_0x121a43,_0x4fd44a){_0x121a43=_0x121a43-0x94;let _0x37871a=_0x194276[_0x121a43];return _0x37871a;},a0_0x5858(_0x4c8c80,_0x4961ab);}a0_0x121a43();import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc,where}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D3=[{'name':a0_0x4e0e41(0xa5),'elo':0x7d0},{'name':a0_0x4e0e41(0xaf),'elo':0x708},{'name':a0_0x4e0e41(0x95),'elo':0x640},{'name':'Bronze','elo':0x578},{'name':'Unranked','elo':0x4b0}];let lastVisibleD3=null;async function getUsernameByIdD3(_0x1813d0){const _0x29a954=a0_0x4e0e41;try{if(!_0x1813d0)return'Unknown\x20Player';const _0x5c1309=await getDoc(doc(db,'playersD3',_0x1813d0));if(_0x5c1309[_0x29a954(0xb1)]())return _0x5c1309['data']()['username']||_0x29a954(0xa9);const _0x1c742d=await getDocs(query(collection(db,'approvedMatchesD3'),where('winnerId','==',_0x1813d0),limit(0x1)));if(!_0x1c742d['empty'])return _0x1c742d['docs'][0x0]['data']()['winnerUsername']||'Unknown\x20Player';const _0x46a0a4=await getDocs(query(collection(db,'approvedMatchesD3'),where(_0x29a954(0x9e),'==',_0x1813d0),limit(0x1)));if(!_0x46a0a4['empty'])return _0x46a0a4['docs'][0x0]['data']()['loserUsername']||_0x29a954(0xa9);return'Unknown\x20Player';}catch(_0x10b213){return console[_0x29a954(0xa3)]('Error\x20getting\x20D3\x20username:',_0x10b213),'Unknown\x20Player';}}export async function recordEloChangeD3({playerId:_0x1fdcec,previousElo:_0x3fccf4,newElo:_0x15bb02,opponentId:_0x45fa56,matchResult:_0x340d3f,previousPosition:_0x2780be,newPosition:_0x1cfcde,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x39ab70,timestamp:_0x5721fc}){const _0x17a85a=a0_0x4e0e41;try{const _0x1d2e48=doc(collection(db,'eloHistoryD3'));let _0x3df993='match';if(isPromotion)_0x3df993='promotion';if(isDemotion)_0x3df993=_0x17a85a(0x97);let _0x673b2e=_0x17a85a(0xa4);if(_0x15bb02>=0x7d0)_0x673b2e='Emerald';else{if(_0x15bb02>=0x708)_0x673b2e='Gold';else{if(_0x15bb02>=0x640)_0x673b2e=_0x17a85a(0x95);else{if(_0x15bb02>=0x578)_0x673b2e='Bronze';}}}return await setDoc(_0x1d2e48,{'type':_0x3df993,'player':_0x1fdcec,'opponent':_0x45fa56,'previousElo':_0x3fccf4,'newElo':_0x15bb02,'change':_0x15bb02-_0x3fccf4,'matchResult':_0x340d3f,'previousPosition':_0x2780be,'newPosition':_0x1cfcde,'rankAchieved':_0x673b2e,'matchId':_0x39ab70,'timestamp':_0x5721fc||serverTimestamp(),'gameMode':'D3'}),console[_0x17a85a(0xb0)](_0x17a85a(0xa7)+_0x1fdcec),!![];}catch(_0x227511){console['error'](_0x17a85a(0x9f),_0x227511);throw _0x227511;}}export async function getEloHistoryD3(_0x47f3d2=0x14){const _0x6ea215=a0_0x4e0e41;try{const _0x160aed=collection(db,'eloHistoryD3');let _0x2df407;lastVisibleD3?_0x2df407=query(_0x160aed,orderBy('timestamp',_0x6ea215(0x96)),startAfter(lastVisibleD3),limit(_0x47f3d2)):_0x2df407=query(_0x160aed,orderBy(_0x6ea215(0xac),'desc'),limit(_0x47f3d2));const _0x2cd1df=await getDocs(_0x2df407);if(_0x2cd1df[_0x6ea215(0xa2)])return{'entries':[],'hasMore':![]};lastVisibleD3=_0x2cd1df['docs'][_0x2cd1df['docs']['length']-0x1];const _0x52d634=_0x2cd1df[_0x6ea215(0xa1)]['map'](async _0x3fb667=>{const _0x584c83=_0x6ea215,_0x4c5e46=_0x3fb667[_0x584c83(0x9b)](),[_0x19da3b,_0x5ae30a]=await Promise['all']([getUsernameByIdD3(_0x4c5e46['player']),getUsernameByIdD3(_0x4c5e46['opponent'])]);return{..._0x4c5e46,'playerUsername':_0x19da3b,'opponentUsername':_0x5ae30a,'change':_0x4c5e46['newElo']-_0x4c5e46['previousElo'],'timestamp':_0x4c5e46[_0x584c83(0xac)]};}),_0x2f0276=await Promise['all'](_0x52d634);return{'entries':_0x2f0276,'hasMore':_0x2cd1df['size']===_0x47f3d2};}catch(_0x1979ff){console['error']('Error\x20fetching\x20D3\x20ELO\x20history:',_0x1979ff);throw _0x1979ff;}}export function resetPaginationD3(){lastVisibleD3=null;}
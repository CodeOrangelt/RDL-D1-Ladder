const a51_0x12a8d7=a51_0x1acb,a51_0x19099b=(function(){let _0x2b7fdb=!![];return function(_0x25a34d,_0x46143a){const _0x49d844=_0x2b7fdb?function(){const _0x372a4=a51_0x1acb;if(_0x46143a){const _0x596a30=_0x46143a[_0x372a4(0x1d7)](_0x25a34d,arguments);return _0x46143a=null,_0x596a30;}}:function(){};return _0x2b7fdb=![],_0x49d844;};}()),a51_0x449872=a51_0x19099b(this,function(){const _0x416f94=a51_0x1acb;let _0xae9dfa;try{const _0x5c0a44=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0xae9dfa=_0x5c0a44();}catch(_0x506779){_0xae9dfa=window;}const _0x36a5f3=_0xae9dfa[_0x416f94(0x1ef)]=_0xae9dfa[_0x416f94(0x1ef)]||{},_0x17057a=[_0x416f94(0x1e4),'warn','info','error','exception','table','trace'];for(let _0x3cebc1=0x0;_0x3cebc1<_0x17057a[_0x416f94(0x265)];_0x3cebc1++){const _0x28bcb0=a51_0x19099b['constructor'][_0x416f94(0x223)]['bind'](a51_0x19099b),_0x547e43=_0x17057a[_0x3cebc1],_0x38e228=_0x36a5f3[_0x547e43]||_0x28bcb0;_0x28bcb0['__proto__']=a51_0x19099b['bind'](a51_0x19099b),_0x28bcb0['toString']=_0x38e228['toString']['bind'](_0x38e228),_0x36a5f3[_0x547e43]=_0x28bcb0;}});a51_0x449872();import{approveReport}from'./ladderalgorithm.js';import{approveReportD2}from'./ladderalgorithm-d2.js';import{approveReportD3}from'./ladderalgorithm-d3.js';import{checkPendingMatches,updatePendingMatchNotification,updateNotificationDot}from'./checkPendingMatches.js';import{collection,getDocs,query,where,orderBy,serverTimestamp,doc,setDoc,getDoc,addDoc,updateDoc,deleteDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';import{auth,db}from'./firebase-config.js';let currentUserEmail=null,confirmationNotification=null,outstandingReportData=null,currentGameMode='D1',outstandingMatches=[];document['addEventListener']('DOMContentLoaded',async()=>{const _0xdf6dbe=a51_0x1acb,_0x533dac={'authWarning':document[_0xdf6dbe(0x1dd)]('auth-warning'),'reportForm':document[_0xdf6dbe(0x1dd)]('report-form'),'winnerUsername':document['getElementById']('winner-username'),'loserUsername':document[_0xdf6dbe(0x1dd)](_0xdf6dbe(0x1f6)),'loserScore':document[_0xdf6dbe(0x1dd)]('loser-score'),'suicides':document[_0xdf6dbe(0x1dd)]('suicides'),'mapPlayed':document['getElementById'](_0xdf6dbe(0x245)),'loserComment':document['getElementById'](_0xdf6dbe(0x24b)),'reportError':document[_0xdf6dbe(0x1dd)](_0xdf6dbe(0x209)),'reportLightbox':document['getElementById']('report-lightbox')};Object['entries'](_0x533dac)['forEach'](([_0x2ee181,_0x1b4014])=>{const _0x1cc3b1=_0xdf6dbe;!_0x1b4014&&console['warn'](_0x1cc3b1(0x1e6)+_0x2ee181+'\x27\x20not\x20found\x20in\x20the\x20DOM');});const _0x1f8c9d=document[_0xdf6dbe(0x1dd)](_0xdf6dbe(0x200)),_0x2e6251=document['getElementById']('d2-mode'),_0x37595b=document[_0xdf6dbe(0x1dd)]('d3-mode');_0x1f8c9d['addEventListener']('click',()=>{const _0x416be5=_0xdf6dbe;_0x770bc9('D1'),_0x1f8c9d['classList']['add'](_0x416be5(0x1f5)),_0x2e6251['classList']['remove']('active'),_0x37595b[_0x416be5(0x261)]['remove'](_0x416be5(0x1f5));}),_0x2e6251['addEventListener']('click',()=>{const _0x11d735=_0xdf6dbe;_0x770bc9('D2'),_0x2e6251[_0x11d735(0x261)]['add']('active'),_0x1f8c9d[_0x11d735(0x261)][_0x11d735(0x267)]('active'),_0x37595b[_0x11d735(0x261)][_0x11d735(0x267)]('active');}),_0x37595b[_0xdf6dbe(0x20d)]('click',()=>{const _0x1b09c6=_0xdf6dbe;_0x770bc9('D3'),_0x37595b['classList']['add']('active'),_0x1f8c9d[_0x1b09c6(0x261)]['remove']('active'),_0x2e6251['classList']['remove']('active');});function _0x770bc9(_0x383509){const _0x2c0970=_0xdf6dbe;currentGameMode=_0x383509,console['log'](_0x2c0970(0x259)+currentGameMode),auth[_0x2c0970(0x22c)]&&checkUserInLadderAndLoadOpponents(auth['currentUser']['uid']);}setupAuthStateListener(_0x533dac),setupReportForm(_0x533dac),auth['currentUser']?(console[_0xdf6dbe(0x1e4)](_0xdf6dbe(0x1ff)),checkUserInLadderAndLoadOpponents(auth[_0xdf6dbe(0x22c)][_0xdf6dbe(0x268)])):console['log']('No\x20user\x20logged\x20in\x20yet,\x20waiting\x20for\x20auth\x20state\x20change');});function setupAuthStateListener(_0x39d9dd){onAuthStateChanged(auth,async _0x179ad6=>{_0x179ad6?handleUserSignedIn(_0x179ad6,_0x39d9dd):handleUserSignedOut(_0x39d9dd);});}async function handleUserSignedIn(_0x4690d0,_0x2034c9){const _0x6cbfbd=a51_0x1acb;if(!_0x2034c9){console[_0x6cbfbd(0x22d)]('Elements\x20object\x20is\x20null\x20or\x20undefined');return;}currentUserEmail=_0x4690d0['email']||null;const _0x236552=_0x4690d0['uid'];try{const _0x25a4b6=doc(db,'nonParticipants',_0x236552);try{const _0x1af56d=await getDoc(_0x25a4b6);console[_0x6cbfbd(0x1e4)]('Non-participant\x20check:',{'exists':_0x1af56d['exists'](),'data':_0x1af56d['exists']()?_0x1af56d['data']():null});if(_0x1af56d[_0x6cbfbd(0x205)]()&&_0x1af56d[_0x6cbfbd(0x1e3)]()['isNonParticipant']===!![]){_0x2034c9['authWarning']&&(_0x2034c9[_0x6cbfbd(0x246)]['style']['display']='block',_0x2034c9['authWarning']['textContent']=_0x6cbfbd(0x242));_0x2034c9['reportForm']&&(_0x2034c9[_0x6cbfbd(0x26d)]['style']['display']='none');return;}}catch(_0x2e10cf){console[_0x6cbfbd(0x1de)]('Error\x20checking\x20non-participant\x20status:',_0x2e10cf);}const _0x190af9=['players','playersD2',_0x6cbfbd(0x207),_0x6cbfbd(0x201),'playersCTF'];let _0x17a5ba=![],_0x7e75c6='';for(const _0x3d11cb of _0x190af9){try{const _0x579ab3=doc(db,_0x3d11cb,_0x236552),_0x5572af=await getDoc(_0x579ab3);if(_0x5572af['exists']()){_0x17a5ba=!![],_0x7e75c6=_0x5572af[_0x6cbfbd(0x1e3)]()[_0x6cbfbd(0x25e)],console[_0x6cbfbd(0x1e4)]('User\x20found\x20in\x20collection\x20'+_0x3d11cb+'\x20with\x20username:\x20'+_0x7e75c6);if(_0x3d11cb==='players'&&currentGameMode!=='D1'){currentGameMode='D1';const _0x546ceb=document['getElementById'](_0x6cbfbd(0x200)),_0x2e21d7=document[_0x6cbfbd(0x1dd)]('d2-mode'),_0x540cb3=document['getElementById']('d3-mode');_0x546ceb['classList'][_0x6cbfbd(0x20f)]('active'),_0x2e21d7['classList']['remove'](_0x6cbfbd(0x1f5)),_0x540cb3['classList']['remove'](_0x6cbfbd(0x1f5));}else{if(_0x3d11cb==='playersD2'&&currentGameMode!=='D2'){currentGameMode='D2';const _0x2170fa=document['getElementById']('d1-mode'),_0xce2fda=document['getElementById']('d2-mode'),_0x286fe0=document['getElementById']('d3-mode');_0xce2fda['classList'][_0x6cbfbd(0x20f)]('active'),_0x2170fa['classList']['remove']('active'),_0x286fe0['classList']['remove']('active');}}break;}}catch(_0x27fbe9){console['warn']('Error\x20checking\x20'+_0x3d11cb+'\x20collection:',_0x27fbe9);}}if(!_0x17a5ba){_0x2034c9['authWarning']&&(_0x2034c9['authWarning']['style']['display']='block',_0x2034c9['authWarning']['textContent']=_0x6cbfbd(0x264));_0x2034c9['reportForm']&&(_0x2034c9['reportForm']['style']['display']=_0x6cbfbd(0x237));return;}const _0x2d02f3=await checkUserInLadderAndLoadOpponents(_0x236552);if(!_0x2d02f3){console['warn']('User\x20is\x20not\x20in\x20the\x20'+currentGameMode+'\x20ladder.\x20Checking\x20other\x20ladders.');for(const _0x21d55f of['players','playersD2',_0x6cbfbd(0x207)]){if(_0x21d55f===(currentGameMode==='D1'?'players':currentGameMode==='D2'?_0x6cbfbd(0x26f):_0x6cbfbd(0x207)))continue;const _0x18e227=doc(db,_0x21d55f,_0x236552);try{const _0x33cf53=await getDoc(_0x18e227);if(_0x33cf53[_0x6cbfbd(0x205)]()){const _0x1804f2=_0x21d55f===_0x6cbfbd(0x215)?'D1':_0x21d55f===_0x6cbfbd(0x26f)?'D2':'D3';console['log']('User\x20found\x20in\x20'+_0x21d55f+',\x20switching\x20to\x20'+_0x1804f2+'\x20mode');const _0x177a52=document['getElementById']('d1-mode'),_0x35dd1b=document['getElementById']('d2-mode'),_0x5e7536=document['getElementById']('d3-mode');if(_0x1804f2==='D1')_0x177a52[_0x6cbfbd(0x261)]['add']('active'),_0x35dd1b[_0x6cbfbd(0x261)]['remove']('active'),_0x5e7536['classList']['remove']('active');else _0x1804f2==='D2'?(_0x35dd1b[_0x6cbfbd(0x261)]['add']('active'),_0x177a52[_0x6cbfbd(0x261)]['remove']('active'),_0x5e7536[_0x6cbfbd(0x261)][_0x6cbfbd(0x267)]('active')):(_0x5e7536[_0x6cbfbd(0x261)]['add'](_0x6cbfbd(0x1f5)),_0x177a52['classList'][_0x6cbfbd(0x267)]('active'),_0x35dd1b['classList']['remove']('active'));currentGameMode=_0x1804f2,await checkUserInLadderAndLoadOpponents(_0x236552);break;}}catch(_0x24d9f6){console['warn']('Error\x20checking\x20'+_0x21d55f+':',_0x24d9f6);}}}}catch(_0xab7f90){console['error'](_0x6cbfbd(0x1d4),_0xab7f90);}}function handleUserSignedOut(_0x4d1c22){const _0x1438bc=a51_0x1acb;_0x4d1c22[_0x1438bc(0x246)]['style']['display']='block',_0x4d1c22['reportForm']['style']['display']=_0x1438bc(0x237),currentUserEmail=null;}async function updateUserDisplay(_0x338c53,_0x4c3ef7){const _0x23c87d=a51_0x1acb,_0x1a57ff=collection(db,'players'),_0x149962=query(_0x1a57ff,where(_0x23c87d(0x230),'==',_0x338c53)),_0x201b92=await getDocs(_0x149962);if(!_0x201b92[_0x23c87d(0x255)]){const _0x9e6511=_0x201b92[_0x23c87d(0x1e7)][0x0][_0x23c87d(0x1e3)]()[_0x23c87d(0x25e)];_0x4c3ef7[_0x23c87d(0x21b)]['textContent']=_0x9e6511;}}function a51_0x408d(){const _0x2bf25d=['find','Report\x20has\x20been\x20successfully\x20updated.','Error\x20during\x20sign-in\x20handling:','approved','admin@ladder.com','apply','removeAttribute','button','winner-username','Please\x20select\x20an\x20opponent','pendingMatchesD2','getElementById','warn','\x22>View\x20Details</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','reportError','getAttribute','Update\x20Report','data','log','winner-score','Element\x20\x27','docs','Match\x20','textContent','winnerOldElo','white','Found\x20pending\x20match:','pendingMatches','text','console','preventDefault','winnerId','view-outstanding-btn','auth-warning','position','active','loser-username','winnerUsername','\x20(ELO:\x20','innerHTML','Not\x20specified','forEach','click','value','data-edit-id','User\x20already\x20logged\x20in,\x20checking\x20D1\x20ladder\x20status','d1-mode','playersDuos','appendChild','loserId','green','exists','\x20ladder.','playersD3','outstanding-matches-list','report-error','Reject\x20button\x20added:','querySelectorAll','createdAt','addEventListener','createElement','add','block','onsubmit','eloRating','onAuthStateChanged','outstanding-modal','players','<p>No\x20outstanding\x20matches\x20found\x20in\x20the\x20current\x20game\x20mode.</p>','gameMode','toDate','.view-detail-btn','backgroundColor','loserUsername','Found\x20buttons\x20container:','smooth','Checking\x20reports\x20for\x20user:\x20','Winner','color','size','suicides','prototype','loserScore','pendingMatchesD3','No\x20pending\x20matches\x20found\x20for\x20this\x20user','4px','\x22>Rescind\x20Report</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','winnerEmail','style','reset','currentUser','error','Unknown','marginRight','email','lightbox-winner','Error\x20rejecting\x20match:\x20','No\x20comment','pointer','then','\x20ladder...','none','undefined','),\x20Loser:\x20','mapPlayed','option','Error:\x20Loser\x20data\x20not\x20found.','red','Loser','RejectedD1','.rescind-report-btn','lightbox-suicides','Non-participants\x20cannot\x20report\x20games.','You\x20must\x20be\x20logged\x20in\x20to\x20reject\x20a\x20match','report-form','map-played','authWarning','className','loserComment','Error:\x20Winner\x20data\x20not\x20found.','loser-score','loser-comment','from','DOMContentLoaded','Standard\x20Match','Using\x20collection:\x20','renderOutstandingMatches','report-lightbox','all','User\x20not\x20authenticated','loserEmail','empty','show','You\x20(','cloneNode','Game\x20mode\x20set\x20to:\x20','Error\x20submitting\x20report:','data-id','</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22match-details\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22match-detail-item\x22>Map:\x20','push','username','cancel-button','Your\x20player\x20profile\x20not\x20found','classList','You\x20are\x20not\x20registered\x20in\x20the\x20','disabled','You\x20are\x20not\x20registered\x20in\x20any\x20ladder.','length','Not\x20registered\x20in\x20this\x20ladder','remove','uid','insertBefore','<option\x20value=\x22\x22>Select\x20Winner</option>','Current\x20user\x20info:','loserSuicides','reportForm','display','playersD2','subgame-type'];a51_0x408d=function(){return _0x2bf25d;};return a51_0x408d();}async function populateWinnerDropdown(_0x4f9695){const _0x34cdb4=a51_0x1acb;try{const _0x5dcd5a=collection(db,'players'),_0x4ea627=await getDocs(_0x5dcd5a);_0x4f9695[_0x34cdb4(0x1f9)]=_0x34cdb4(0x26a),!_0x4ea627['empty']&&_0x4ea627['forEach'](_0x3583cb=>{const _0x57da10=_0x34cdb4,_0x578e07=_0x3583cb['data']();if(_0x578e07[_0x57da10(0x230)]!==currentUserEmail){const _0x9886c0=document['createElement']('option');_0x9886c0['value']=_0x578e07['email'],_0x9886c0[_0x57da10(0x1e9)]=_0x578e07[_0x57da10(0x25e)],_0x4f9695[_0x57da10(0x202)](_0x9886c0);}});}catch(_0x496fde){console['error']('Error\x20populating\x20winner\x20dropdown:',_0x496fde);throw _0x496fde;}}function setupReportForm(_0x5e5785){const _0x1db8c8=a51_0x1acb;if(!_0x5e5785['reportForm'])return;_0x5e5785['reportForm'][_0x1db8c8(0x20d)]('submit',async _0x412045=>{const _0x1111d4=_0x1db8c8;_0x412045['preventDefault']();try{await submitReport(_0x5e5785),_0x5e5785['reportForm'][_0x1111d4(0x22b)](),alert('Game\x20reported\x20successfully.');}catch(_0x58cab7){console[_0x1111d4(0x22d)]('Error\x20submitting\x20report:',_0x58cab7),_0x5e5785['reportError']['textContent']='Error\x20reporting\x20game.\x20Please\x20try\x20again.';}});}async function submitReport(_0x56e284){const _0x57fd7c=a51_0x1acb,_0x9fde04=currentGameMode==='D1'?_0x57fd7c(0x1ed):currentGameMode==='D2'?'pendingMatchesD2':'pendingMatchesD3',_0x13ac70=collection(db,_0x9fde04),_0x3a075f=doc(_0x13ac70);try{const _0x39d913=auth['currentUser'];if(!_0x39d913)throw new Error(_0x57fd7c(0x253));const _0xbc0359=_0x39d913[_0x57fd7c(0x268)],_0x465e57=currentGameMode==='D1'?'players':currentGameMode==='D2'?_0x57fd7c(0x26f):'playersD3',_0x3e6483=await getDoc(doc(db,_0x465e57,_0xbc0359));if(!_0x3e6483[_0x57fd7c(0x205)]())throw new Error(_0x57fd7c(0x260));const _0x408a75=document['getElementById']('subgame-type'),_0x1afa43=_0x56e284['winnerUsername']['value'];if(!_0x1afa43)throw new Error(_0x57fd7c(0x1db));const _0x3f36e1=query(collection(db,_0x465e57),where(_0x57fd7c(0x25e),'==',_0x1afa43)),_0x4f25df=await getDocs(_0x3f36e1);if(_0x4f25df['empty'])throw new Error('Selected\x20opponent\x20not\x20found');const _0x38bef7=_0x4f25df['docs'][0x0]['data'](),_0x1a58b5=_0x4f25df['docs'][0x0]['id'],_0x3c9134={'matchId':_0x3a075f['id'],'loserUsername':_0x3e6483['data']()['username'],'loserId':_0xbc0359,'winnerUsername':_0x38bef7['username'],'winnerId':_0x1a58b5,'loserScore':_0x56e284[_0x57fd7c(0x224)][_0x57fd7c(0x1fd)],'loserSuicides':_0x56e284[_0x57fd7c(0x222)][_0x57fd7c(0x1fd)],'mapPlayed':_0x56e284['mapPlayed']['value'],'loserComment':_0x56e284['loserComment']['value'],'subgameType':_0x408a75?_0x408a75['value']:'','gameMode':currentGameMode,'approved':![],'createdAt':serverTimestamp(),'winnerOldElo':_0x38bef7['eloRating']||null,'losersOldElo':_0x3e6483[_0x57fd7c(0x1e3)]()[_0x57fd7c(0x212)]||null};await setDoc(_0x3a075f,_0x3c9134),console['log']('Match\x20reported\x20in\x20'+_0x9fde04+'\x20with\x20ID:\x20'+_0x3a075f['id']),_0x56e284[_0x57fd7c(0x1e0)]['textContent']='Game\x20reported\x20successfully!',_0x56e284['reportError']['style']['color']=_0x57fd7c(0x204),updatePendingMatchNotification();}catch(_0x45faed){console['error'](_0x57fd7c(0x25a),_0x45faed),_0x56e284[_0x57fd7c(0x1e0)][_0x57fd7c(0x1e9)]='Error:\x20'+_0x45faed['message'],_0x56e284[_0x57fd7c(0x1e0)]['style'][_0x57fd7c(0x220)]=_0x57fd7c(0x23d);throw _0x45faed;}}async function checkForOutstandingReports(_0x484268,_0x295c83,_0x578e59=null){const _0x200df0=a51_0x1acb;console['log'](_0x200df0(0x21e)+_0x484268+'\x20in\x20'+(_0x578e59||'default\x20collection'));const _0x287d51=_0x578e59||(currentGameMode==='D1'?'pendingMatches':currentGameMode==='D2'?'pendingMatchesD2':'pendingMatchesD3');console['log'](_0x200df0(0x24f)+_0x287d51);try{const _0x307da8=auth['currentUser'];if(!_0x307da8){console['log']('No\x20authenticated\x20user\x20found');return;}const _0x452a81=_0x307da8[_0x200df0(0x268)],_0x1252eb=collection(db,_0x287d51),_0x2747ae=query(_0x1252eb,where('winnerId','==',_0x452a81),where('approved','==',![]));let _0x29fc03=await getDocs(_0x2747ae);console['log']('Query\x20by\x20winnerId\x20results:\x20'+_0x29fc03['size']+'\x20matches\x20found');if(_0x29fc03['empty']&&_0x307da8[_0x200df0(0x230)]){console['log']('No\x20matches\x20found\x20by\x20winnerId,\x20trying\x20winnerEmail');const _0x3e0632=query(_0x1252eb,where('winnerEmail','==',_0x307da8['email']),where('approved','==',![]));_0x29fc03=await getDocs(_0x3e0632),console['log']('Query\x20by\x20winnerEmail\x20results:\x20'+_0x29fc03[_0x200df0(0x221)]+'\x20matches\x20found');}if(_0x29fc03[_0x200df0(0x255)]){console['log']('No\x20matches\x20found\x20by\x20email\x20either,\x20trying\x20winnerUsername');const _0x36a366=currentGameMode==='D1'?'players':_0x200df0(0x26f),_0x158306=await getDoc(doc(db,_0x36a366,_0x452a81));if(_0x158306[_0x200df0(0x205)]()&&_0x158306['data']()[_0x200df0(0x25e)]){const _0xab7682=_0x158306['data']()['username'],_0x4f06ef=query(_0x1252eb,where(_0x200df0(0x1f7),'==',_0xab7682),where(_0x200df0(0x1d5),'==',![]));_0x29fc03=await getDocs(_0x4f06ef),console['log']('Query\x20by\x20winnerUsername\x20results:\x20'+_0x29fc03['size']+'\x20matches\x20found');}}if(!_0x29fc03['empty']){const _0x48d614=_0x29fc03['docs'][0x0]['data']();return console[_0x200df0(0x1e4)](_0x200df0(0x1ec),_0x48d614),_0x48d614['id']=_0x29fc03['docs'][0x0]['id'],autoFillReportForm(_0x48d614),updateNotificationDot(!![]),!![];}else return console['log'](_0x200df0(0x226)),updateNotificationDot(![]),![];}catch(_0x577793){console[_0x200df0(0x22d)]('Error\x20checking\x20outstanding\x20reports:',_0x577793);}}function autoFillReportForm(_0x55ece3){const _0x3fc3d2=a51_0x1acb;console['log']('Report\x20Data\x20in\x20autoFillReportForm:',_0x55ece3);if(_0x55ece3){const _0x52c0eb=parseInt(_0x55ece3['loserScore']||'0'),_0x3b5409=_0x52c0eb<0x12?0x14:_0x52c0eb+0x2,_0x86bbfd=_0x55ece3[_0x3fc3d2(0x217)]||currentGameMode,_0x4dbafc=_0x86bbfd==='D1'?'players':_0x86bbfd==='D2'?'playersD2':'playersD3';console['log']('Using\x20players\x20collection:\x20'+_0x4dbafc+'\x20for\x20game\x20mode:\x20'+_0x86bbfd);let _0x36e072;_0x55ece3['winnerId']?_0x36e072=getDoc(doc(db,_0x4dbafc,_0x55ece3['winnerId']))[_0x3fc3d2(0x235)](_0x537bbc=>_0x537bbc['exists']()?{'id':_0x537bbc['id'],'data':_0x537bbc['data']()}:null):_0x36e072=getDocs(query(collection(db,_0x4dbafc),where('username','==',_0x55ece3[_0x3fc3d2(0x1f7)])))['then'](_0x214105=>!_0x214105['empty']?{'id':_0x214105['docs'][0x0]['id'],'data':_0x214105['docs'][0x0]['data']()}:null);let _0x1e8926;_0x55ece3['loserId']?_0x1e8926=getDoc(doc(db,_0x4dbafc,_0x55ece3['loserId']))['then'](_0x50f958=>_0x50f958['exists']()?{'id':_0x50f958['id'],'data':_0x50f958['data']()}:null):_0x1e8926=getDocs(query(collection(db,_0x4dbafc),where('username','==',_0x55ece3['loserUsername'])))['then'](_0x2477ab=>!_0x2477ab['empty']?{'id':_0x2477ab['docs'][0x0]['id'],'data':_0x2477ab['docs'][0x0][_0x3fc3d2(0x1e3)]()}:null),Promise[_0x3fc3d2(0x252)]([_0x36e072,_0x1e8926])[_0x3fc3d2(0x235)](([_0x4ee61d,_0x220628])=>{const _0x1a4f68=_0x3fc3d2;if(!_0x4ee61d){console['error']('No\x20winner\x20found\x20for\x20this\x20match'),alert(_0x1a4f68(0x249));return;}if(!_0x220628){console['error']('No\x20loser\x20found\x20for\x20this\x20match'),alert(_0x1a4f68(0x23c));return;}const _0x568529=_0x55ece3[_0x1a4f68(0x1ea)]!=null?_0x55ece3['winnerOldElo']:_0x4ee61d['data']['eloRating'],_0x130fab=_0x55ece3['losersOldElo']!=null?_0x55ece3['losersOldElo']:_0x220628['data']['eloRating'],_0x49d793=_0x4ee61d['data']['username'],_0x8283ed=_0x220628[_0x1a4f68(0x1e3)]['username'];console['log']('Winner:\x20'+_0x49d793+_0x1a4f68(0x1f8)+_0x568529+_0x1a4f68(0x239)+_0x8283ed+'\x20(ELO:\x20'+_0x130fab+')');const _0x29d25e=document['getElementById']('report-lightbox');if(!_0x29d25e){console['error']('Lightbox\x20element\x20not\x20found');return;}document['getElementById'](_0x1a4f68(0x231))['textContent']=_0x49d793,document['getElementById']('lightbox-loser')['textContent']=_0x8283ed,document[_0x1a4f68(0x1dd)]('lightbox-loser-score')['textContent']=_0x55ece3[_0x1a4f68(0x224)]||'0',document['getElementById']('lightbox-suicides')[_0x1a4f68(0x1e9)]=_0x55ece3[_0x1a4f68(0x26c)]||'0',document['getElementById']('lightbox-map')[_0x1a4f68(0x1e9)]=_0x55ece3['mapPlayed']||_0x1a4f68(0x1fa),document['getElementById']('lightbox-comment')[_0x1a4f68(0x1e9)]=_0x55ece3['loserComment']||_0x1a4f68(0x233),document[_0x1a4f68(0x1dd)]('lightbox-subgame')['textContent']=_0x55ece3['subgameType']||_0x1a4f68(0x24e);const _0x17dce1=document['getElementById'](_0x1a4f68(0x1e5));_0x17dce1&&(_0x17dce1[_0x1a4f68(0x1fd)]=_0x3b5409,_0x17dce1['readOnly']=!![],_0x17dce1[_0x1a4f68(0x22a)]['backgroundColor']='rgba(255,\x20255,\x20255,\x200.05)');showLightbox();const _0x488723=document['querySelector']('.lightbox-buttons');if(_0x488723){console[_0x1a4f68(0x1e4)](_0x1a4f68(0x21c),_0x488723);const _0x33dcd5=document['getElementById']('reject-button');_0x33dcd5&&_0x33dcd5['remove']();const _0x220d64=document['createElement'](_0x1a4f68(0x1d9));_0x220d64['id']='reject-button',_0x220d64[_0x1a4f68(0x247)]='button\x20danger-button',_0x220d64['textContent']='Reject\x20Match',_0x220d64['style']['backgroundColor']='#d32f2f',_0x220d64['style'][_0x1a4f68(0x220)]=_0x1a4f68(0x1eb),_0x220d64[_0x1a4f68(0x22a)]['marginRight']='10px',_0x220d64['style']['padding']='8px\x2016px',_0x220d64[_0x1a4f68(0x22a)]['border']='none',_0x220d64['style']['borderRadius']=_0x1a4f68(0x227),_0x220d64['style']['cursor']=_0x1a4f68(0x234),_0x220d64['style']['fontWeight']='bold',_0x488723['prepend'](_0x220d64),console['log'](_0x1a4f68(0x20a),_0x220d64);}const _0x3e1d5a=document[_0x1a4f68(0x1dd)]('approve-button'),_0x22d62f=document['getElementById']('reject-button'),_0x1c04c9=document[_0x1a4f68(0x1dd)](_0x1a4f68(0x25f));if(_0x3e1d5a){const _0x35ab59=_0x3e1d5a['cloneNode'](!![]);_0x3e1d5a['parentNode']['replaceChild'](_0x35ab59,_0x3e1d5a),_0x35ab59['addEventListener']('click',async function(){const _0x383d80=_0x1a4f68;try{const _0x9acfb0=document['getElementById'](_0x383d80(0x1e5))['value'],_0x3a3446=document[_0x383d80(0x1dd)]('winner-suicides')['value']||'0',_0x4b1212=document[_0x383d80(0x1dd)]('winner-comment')['value']||'';console[_0x383d80(0x1e4)](_0x383d80(0x26b),{'uid':auth[_0x383d80(0x22c)]?.[_0x383d80(0x268)],'email':auth['currentUser']?.[_0x383d80(0x230)],'isAdmin':auth['currentUser']?.['email']===_0x383d80(0x1d6)||auth[_0x383d80(0x22c)]?.[_0x383d80(0x230)]==='brian2af@outlook.com'});const _0x2b6543=_0x55ece3['gameMode']||currentGameMode;if(_0x2b6543==='D3')await approveReportD3(_0x55ece3['id'],_0x9acfb0,_0x3a3446,_0x4b1212);else _0x2b6543==='D2'?await approveReportD2(_0x55ece3['id'],_0x9acfb0,_0x3a3446,_0x4b1212):await approveReport(_0x55ece3['id'],_0x9acfb0,_0x3a3446,_0x4b1212);document[_0x383d80(0x1dd)]('report-lightbox')['style']['display']='none',alert('Match\x20approved\x20successfully'),updatePendingMatchNotification(),location['reload']();const _0x3671fe=_0x2b6543==='D1'?'players':'playersD2',_0x5317f0=doc(db,_0x3671fe,_0x4ee61d['id']),_0x2060bc=doc(db,_0x3671fe,_0x220628['id']),[_0x229553,_0x5e299c]=await Promise[_0x383d80(0x252)]([getDoc(_0x5317f0),getDoc(_0x2060bc)]);if(_0x229553['exists']()&&_0x5e299c[_0x383d80(0x205)]()){const _0x427973=_0x229553[_0x383d80(0x1e3)](),_0x474219=_0x5e299c[_0x383d80(0x1e3)]();_0x427973[_0x383d80(0x1f4)]>_0x474219['position']?(await updateDoc(_0x5317f0,{'position':_0x474219['position']}),console['log']('Winner\x20'+_0x427973['username']+'\x20moved\x20to\x20position\x20'+_0x474219['position'])):console[_0x383d80(0x1e4)]('No\x20position\x20change\x20needed;\x20winner\x20is\x20already\x20above\x20the\x20loser.');}}catch(_0x5c9cc1){console[_0x383d80(0x22d)]('Error\x20approving\x20report:',_0x5c9cc1),alert('Error\x20approving\x20match:\x20'+_0x5c9cc1['message']);}});}if(_0x22d62f){const _0x11697d=_0x22d62f[_0x1a4f68(0x258)](!![]);_0x22d62f['parentNode']['replaceChild'](_0x11697d,_0x22d62f),_0x11697d['addEventListener']('click',async function(){const _0x42876a=_0x1a4f68;try{const _0x42c5e7=prompt('Please\x20provide\x20a\x20reason\x20for\x20rejecting\x20this\x20match\x20report:','');if(_0x42c5e7===null)return;await rejectReport(_0x55ece3['id'],_0x42c5e7),hideLightbox(),alert('Match\x20report\x20rejected\x20successfully'),updatePendingMatchNotification(),location['reload']();}catch(_0x4401a5){console['error']('Error\x20rejecting\x20report:',_0x4401a5),alert(_0x42876a(0x232)+_0x4401a5['message']);}});}if(_0x1c04c9){const _0x1f6c36=_0x1c04c9[_0x1a4f68(0x258)](!![]);_0x1c04c9['parentNode']['replaceChild'](_0x1f6c36,_0x1c04c9),_0x1f6c36['addEventListener'](_0x1a4f68(0x1fc),hideLightbox);}})['catch'](_0x443bed=>{const _0x532f63=_0x3fc3d2;console[_0x532f63(0x22d)]('Error\x20processing\x20player\x20data:',_0x443bed),alert('Error\x20fetching\x20player\x20data.\x20Please\x20try\x20again.');});}}function showLightbox(){const _0x14c177=a51_0x1acb;console['log']('Showing\x20lightbox');const _0x1b539f=document[_0x14c177(0x1dd)]('report-lightbox');if(!_0x1b539f){console['error']('Lightbox\x20element\x20not\x20found');return;}_0x1b539f[_0x14c177(0x261)]['add']('show');}function hideLightbox(){const _0x379586=a51_0x1acb,_0x45db2a=document[_0x379586(0x1dd)](_0x379586(0x251));_0x45db2a[_0x379586(0x261)][_0x379586(0x267)](_0x379586(0x256));}async function rejectReport(_0x43280f,_0x169134){const _0x4e1ff2=a51_0x1acb;try{const _0x5af26f=currentGameMode==='D1'?_0x4e1ff2(0x1ed):currentGameMode==='D2'?'pendingMatchesD2':'pendingMatchesD3',_0x1352c9=currentGameMode==='D1'?_0x4e1ff2(0x23f):currentGameMode==='D2'?'RejectedD2':'RejectedD3';console[_0x4e1ff2(0x1e4)]('Rejecting\x20match\x20'+_0x43280f+'\x20from\x20'+_0x5af26f+'\x20to\x20'+_0x1352c9);const _0x5fc9f6=auth[_0x4e1ff2(0x22c)];if(!_0x5fc9f6)throw new Error(_0x4e1ff2(0x243));const _0x121e72=doc(db,_0x5af26f,_0x43280f),_0xbd928=await getDoc(_0x121e72);if(!_0xbd928['exists']())throw new Error('Match\x20report\x20not\x20found');const _0x5a839b=_0xbd928['data'](),_0x5c3d58=_0x5a839b['winnerId']&&_0x5a839b[_0x4e1ff2(0x1f1)]===_0x5fc9f6['uid']||_0x5a839b[_0x4e1ff2(0x229)]&&_0x5a839b[_0x4e1ff2(0x229)]===_0x5fc9f6['email']||_0x5a839b[_0x4e1ff2(0x1f7)]&&_0x5a839b[_0x4e1ff2(0x1f7)]===await getUsernameFromId(_0x5fc9f6['uid']);if(!_0x5c3d58)throw new Error('Only\x20the\x20winner\x20of\x20the\x20match\x20can\x20reject\x20it');const _0x58725d={..._0x5a839b,'rejectedAt':serverTimestamp(),'rejectedBy':_0x5fc9f6['uid'],'rejectionReason':_0x169134||'No\x20reason\x20provided','originalDocumentId':_0x43280f},_0x221577=doc(collection(db,_0x1352c9));return await setDoc(_0x221577,_0x58725d),await deleteDoc(_0x121e72),console['log'](_0x4e1ff2(0x1e8)+_0x43280f+'\x20rejected\x20successfully'),updatePendingMatchNotification(),!![];}catch(_0x4c1523){console[_0x4e1ff2(0x22d)]('Error\x20rejecting\x20match:',_0x4c1523);throw _0x4c1523;}}async function getUsernameFromId(_0x35c94c){const _0x5c679a=a51_0x1acb,_0xa0f58c=await getDoc(doc(db,'players',_0x35c94c));if(_0xa0f58c[_0x5c679a(0x205)]())return _0xa0f58c[_0x5c679a(0x1e3)]()['username'];const _0x574c63=await getDoc(doc(db,'playersD2',_0x35c94c));if(_0x574c63['exists']())return _0x574c63['data']()['username'];return null;}async function loadOpponentsList(_0x3bfed8){const _0xb0b4e6=a51_0x1acb;try{const _0x4b8e28=document[_0xb0b4e6(0x1dd)]('report-error'),_0x5b2f9f=document['getElementById']('loser-username'),_0x328284=document['getElementById'](_0xb0b4e6(0x1da));if(!_0x4b8e28||!_0x5b2f9f||!_0x328284){console['error']('Required\x20elements\x20not\x20found\x20for\x20loadOpponentsList');return;}const _0x3de0e5=currentGameMode==='D1'?'players':currentGameMode==='D2'?'playersD2':'playersD3';console['log']('Loading\x20opponents\x20from\x20collection:\x20'+_0x3de0e5);const _0x1ddb99=await getDoc(doc(db,_0x3de0e5,_0x3bfed8));if(!_0x1ddb99[_0xb0b4e6(0x205)]()){_0x4b8e28['textContent']=_0xb0b4e6(0x262)+currentGameMode+_0xb0b4e6(0x206),_0x4b8e28[_0xb0b4e6(0x22a)][_0xb0b4e6(0x220)]='red',_0x5b2f9f[_0xb0b4e6(0x1e9)]='Not\x20registered\x20in\x20this\x20ladder',_0x328284['disabled']=!![];return;}const _0x2a5111=_0x1ddb99[_0xb0b4e6(0x1e3)](),_0x46694b=_0x2a5111[_0xb0b4e6(0x25e)];_0x5b2f9f['textContent']=_0xb0b4e6(0x257)+_0x46694b+')',_0x4b8e28['textContent']='',_0x328284[_0xb0b4e6(0x263)]=![];const _0x2823a3=collection(db,_0x3de0e5),_0x3b464e=await getDocs(_0x2823a3);if(_0x3b464e['empty']){console['log']('No\x20opponents\x20available');return;}_0x328284['innerHTML']='<option\x20value=\x22\x22>Select\x20Opponent</option>',_0x3b464e['forEach'](_0x392def=>{const _0x57b7b7=_0xb0b4e6,_0x13642c=_0x392def['data']();if(_0x392def['id']!==_0x3bfed8){const _0x213284=document[_0x57b7b7(0x20e)](_0x57b7b7(0x23b));_0x213284['value']=_0x13642c['username'],_0x213284['textContent']=_0x13642c['username'],_0x213284['dataset'][_0x57b7b7(0x268)]=_0x392def['id'],_0x328284['appendChild'](_0x213284);}});}catch(_0x77e3de){console['error']('Error\x20loading\x20opponents\x20list:',_0x77e3de),document['getElementById'](_0xb0b4e6(0x209))['textContent']='Error\x20loading\x20opponents.\x20Please\x20try\x20again\x20later.',document['getElementById']('report-error')[_0xb0b4e6(0x22a)]['color']='red';}}async function checkUserInLadderAndLoadOpponents(_0x350549){const _0x4717d8=a51_0x1acb;try{const _0x4f0eb4=document['getElementById']('report-error'),_0x2ac90d=document[_0x4717d8(0x1dd)]('loser-username'),_0x215cc5=document['getElementById']('winner-username'),_0x510aa8=document['getElementById'](_0x4717d8(0x244)),_0x2b651e=document['getElementById'](_0x4717d8(0x1f3));_0x4f0eb4['textContent']='Checking\x20if\x20you\x20are\x20registered\x20in\x20'+currentGameMode+_0x4717d8(0x236),_0x4f0eb4['style']['color']=_0x4717d8(0x1eb);const _0x5d1351=currentGameMode==='D1'?'players':currentGameMode==='D2'?_0x4717d8(0x26f):'playersD3';console['log']('Checking\x20if\x20user\x20exists\x20in\x20collection:\x20'+_0x5d1351);const _0x37bda6=await getDoc(doc(db,_0x5d1351,_0x350549));if(!_0x37bda6['exists']())return _0x4f0eb4['textContent']=_0x4717d8(0x262)+currentGameMode+_0x4717d8(0x206),_0x4f0eb4['style']['color']='red',_0x2ac90d['textContent']=_0x4717d8(0x266),_0x215cc5['disabled']=!![],_0x215cc5['innerHTML']='<option\x20value=\x22\x22>Select\x20Opponent</option>',_0x2b651e['style']['display']='block',_0x2b651e['textContent']='You\x20are\x20not\x20registered\x20in\x20the\x20'+currentGameMode+'\x20ladder.',![];_0x4f0eb4['textContent']='',_0x2b651e['style']['display']='none';const _0x38e256=_0x37bda6[_0x4717d8(0x1e3)](),_0x36c433=_0x38e256[_0x4717d8(0x25e)];_0x2ac90d['textContent']='You\x20('+_0x36c433+')',_0x215cc5[_0x4717d8(0x263)]=![],_0x510aa8['style']['display']=_0x4717d8(0x210),await loadOpponentsList(_0x350549);const _0x4d3f5f=currentGameMode==='D1'?'pendingMatches':currentGameMode==='D2'?'pendingMatchesD2':'pendingMatchesD3';return await checkForOutstandingReports(_0x38e256['email'],null,_0x4d3f5f),!![];}catch(_0x4f5fe5){return console['error']('Error\x20checking\x20if\x20user\x20is\x20in\x20ladder:',_0x4f5fe5),document[_0x4717d8(0x1dd)]('report-error')[_0x4717d8(0x1e9)]='Error\x20checking\x20ladder\x20membership.\x20Please\x20try\x20again\x20later.',document[_0x4717d8(0x1dd)]('report-error')['style']['color']='red',![];}}export async function fetchOutstandingMatches(){const _0x14d78c=a51_0x1acb,_0x22b514=auth[_0x14d78c(0x22c)];if(!_0x22b514)return[];try{const _0xd16d48=[],_0xdf63ea=currentGameMode==='D1'?'pendingMatches':currentGameMode==='D2'?_0x14d78c(0x1dc):'pendingMatchesD3',_0x4cec11=collection(db,_0xdf63ea),_0x5c2bda=[query(_0x4cec11,where('loserId','==',_0x22b514[_0x14d78c(0x268)]),where('approved','==',![])),query(_0x4cec11,where(_0x14d78c(0x254),'==',_0x22b514['email']),where('approved','==',![])),query(_0x4cec11,where('winnerId','==',_0x22b514[_0x14d78c(0x268)]),where('approved','==',![])),query(_0x4cec11,where(_0x14d78c(0x229),'==',_0x22b514['email']),where('approved','==',![]))],_0x241e89=currentGameMode==='D1'?_0x14d78c(0x215):currentGameMode==='D2'?'playersD2':'playersD3',_0x31ab42=await getDocs(query(collection(db,_0x241e89),where('email','==',_0x22b514['email'])));let _0x3365a8=null;!_0x31ab42['empty']&&(_0x3365a8=_0x31ab42['docs'][0x0]['data']()[_0x14d78c(0x25e)],_0x3365a8&&_0x5c2bda[_0x14d78c(0x25d)](query(_0x4cec11,where('loserUsername','==',_0x3365a8),where('approved','==',![])),query(_0x4cec11,where('winnerUsername','==',_0x3365a8),where('approved','==',![]))));for(const _0x5c8c10 of _0x5c2bda){const _0x30e5f1=await getDocs(_0x5c8c10);!_0x30e5f1['empty']&&_0x30e5f1['forEach'](_0x5f08e7=>{!_0xd16d48['some'](_0x245391=>_0x245391['id']===_0x5f08e7['id'])&&_0xd16d48['push']({'id':_0x5f08e7['id'],..._0x5f08e7['data']()});});}return _0xd16d48['sort']((_0x47d776,_0x4a8e7c)=>{const _0x1ae4d5=_0x14d78c,_0x52830f=_0x47d776[_0x1ae4d5(0x20c)]?.[_0x1ae4d5(0x218)]()||new Date(0x0),_0x182ada=_0x4a8e7c['createdAt']?.['toDate']()||new Date(0x0);return _0x182ada-_0x52830f;}),outstandingMatches=_0xd16d48,_0xd16d48;}catch(_0x50a0b6){return console[_0x14d78c(0x22d)]('Error\x20fetching\x20outstanding\x20matches:',_0x50a0b6),[];}}export function renderOutstandingMatches(){const _0x20d83a=a51_0x1acb,_0x297f15=document[_0x20d83a(0x1dd)]('outstanding-matches-list');if(outstandingMatches['length']===0x0){_0x297f15['innerHTML']=_0x20d83a(0x216);return;}let _0x47c4dc='';const _0x2d2977=auth['currentUser'];if(!_0x2d2977)return;outstandingMatches['forEach'](_0x2f4056=>{const _0x1fb8ea=_0x20d83a,_0x547f56=_0x2f4056['createdAt']?.[_0x1fb8ea(0x218)]()?_0x2f4056['createdAt']['toDate']()['toLocaleDateString']():'Unknown\x20date',_0x10642a=_0x2f4056['loserEmail']===_0x2d2977[_0x1fb8ea(0x230)]||_0x2f4056[_0x1fb8ea(0x203)]===_0x2d2977['uid'];_0x47c4dc+='\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22match-item\x22\x20data-id=\x22'+_0x2f4056['id']+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3>'+(_0x2f4056['winnerUsername']||_0x1fb8ea(0x21f))+'\x20vs\x20'+(_0x2f4056[_0x1fb8ea(0x21b)]||_0x1fb8ea(0x23e))+_0x1fb8ea(0x25c)+(_0x2f4056['mapPlayed']||'Unknown')+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22match-detail-item\x22>Date:\x20'+_0x547f56+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22match-detail-item\x22>Score:\x20?\x20-\x20'+(_0x2f4056['loserScore']||'0')+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22match-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20view-detail-btn\x22\x20data-id=\x22'+_0x2f4056['id']+_0x1fb8ea(0x1df)+(_0x10642a?'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20edit-report-btn\x22\x20data-id=\x22'+_0x2f4056['id']+'\x22>Edit\x20Report</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20danger-button\x20rescind-report-btn\x22\x20data-id=\x22'+_0x2f4056['id']+_0x1fb8ea(0x228):'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';}),_0x297f15[_0x20d83a(0x1f9)]=_0x47c4dc,document[_0x20d83a(0x20b)](_0x20d83a(0x219))['forEach'](_0x55df29=>{_0x55df29['addEventListener']('click',function(){const _0x4a86ff=a51_0x1acb,_0x4c8c12=this[_0x4a86ff(0x1e1)]('data-id'),_0x29edcf=outstandingMatches[_0x4a86ff(0x1d2)](_0xeb23b8=>_0xeb23b8['id']===_0x4c8c12);document['getElementById']('outstanding-modal')['classList']['remove']('show'),showMatchLightbox(_0x29edcf);});}),document[_0x20d83a(0x20b)]('.edit-report-btn')[_0x20d83a(0x1fb)](_0x339e4c=>{const _0x32a215=_0x20d83a;_0x339e4c['addEventListener'](_0x32a215(0x1fc),function(){const _0xf1f1df=_0x32a215,_0x2db45c=this['getAttribute'](_0xf1f1df(0x25b)),_0x1fc8a9=outstandingMatches[_0xf1f1df(0x1d2)](_0x2a6876=>_0x2a6876['id']===_0x2db45c);document['getElementById']('outstanding-modal')['classList'][_0xf1f1df(0x267)]('show'),editReport(_0x1fc8a9);});}),document[_0x20d83a(0x20b)](_0x20d83a(0x240))['forEach'](_0x2def89=>{_0x2def89['addEventListener']('click',function(){const _0x37cf84=a51_0x1acb,_0x54ba26=this['getAttribute']('data-id'),_0x3b48a8=outstandingMatches[_0x37cf84(0x1d2)](_0x2c9d43=>_0x2c9d43['id']===_0x54ba26);confirm('Are\x20you\x20sure\x20you\x20want\x20to\x20rescind\x20this\x20match\x20report\x20against\x20'+(_0x3b48a8['winnerUsername']||'opponent')+'?')&&rescindReport(_0x3b48a8);});});}export async function rescindReport(_0x1d380d){const _0x79c3fd=a51_0x1acb;try{const _0xf84e06=currentGameMode==='D1'?'pendingMatches':currentGameMode==='D2'?'pendingMatchesD2':'pendingMatchesD3',_0x4faac0=doc(db,_0xf84e06,_0x1d380d['id']);await deleteDoc(_0x4faac0),alert('Report\x20has\x20been\x20successfully\x20rescinded.'),await fetchOutstandingMatches(),renderOutstandingMatches();}catch(_0x27da12){console[_0x79c3fd(0x22d)]('Error\x20rescinding\x20report:',_0x27da12),alert('Failed\x20to\x20rescind\x20report.\x20Please\x20try\x20again.');}}export function editReport(_0x2bf62f){const _0x4c016e=a51_0x1acb,_0x17a409=document[_0x4c016e(0x1dd)]('report-form'),_0x334aa1=document['getElementById'](_0x4c016e(0x24a)),_0x44192f=document['getElementById']('suicides'),_0x20322b=document['getElementById']('map-played'),_0xe43e39=document['getElementById']('loser-comment');_0x17a409['style'][_0x4c016e(0x26e)]=_0x4c016e(0x210),document['getElementById'](_0x4c016e(0x1f3))['style'][_0x4c016e(0x26e)]='none';if(_0x2bf62f['loserScore'])_0x334aa1['value']=_0x2bf62f['loserScore'];if(_0x2bf62f['loserSuicides'])_0x44192f['value']=_0x2bf62f[_0x4c016e(0x26c)];if(_0x2bf62f['mapPlayed'])_0x20322b[_0x4c016e(0x1fd)]=_0x2bf62f[_0x4c016e(0x23a)];if(_0x2bf62f['loserComment'])_0xe43e39[_0x4c016e(0x1fd)]=_0x2bf62f[_0x4c016e(0x248)];const _0x28f72f=document[_0x4c016e(0x1dd)](_0x4c016e(0x1da));_0x28f72f&&_0x2bf62f['winnerUsername']&&Array[_0x4c016e(0x24c)](_0x28f72f['options'])[_0x4c016e(0x1fb)](_0x26b8d8=>{const _0x564563=_0x4c016e;_0x26b8d8[_0x564563(0x1ee)]===_0x2bf62f['winnerUsername']&&(_0x26b8d8['selected']=!![]);});const _0x518f75=document['getElementById'](_0x4c016e(0x270));_0x518f75&&_0x2bf62f['subgameType']&&(_0x518f75['value']=_0x2bf62f['subgameType']);_0x17a409['setAttribute']('data-edit-id',_0x2bf62f['id']);const _0x23f969=_0x17a409['querySelector']('button[type=\x22submit\x22]');_0x23f969[_0x4c016e(0x1e9)]=_0x4c016e(0x1e2);if(!document[_0x4c016e(0x1dd)]('cancel-edit-btn')){const _0x37a5f9=document['createElement']('button');_0x37a5f9['id']='cancel-edit-btn',_0x37a5f9['className']='btn',_0x37a5f9['style'][_0x4c016e(0x21a)]='#6a1b9a',_0x37a5f9['style'][_0x4c016e(0x22f)]='10px',_0x37a5f9['textContent']='Cancel\x20Edit',_0x37a5f9['type']='button',_0x23f969['parentNode'][_0x4c016e(0x269)](_0x37a5f9,_0x23f969),_0x37a5f9['addEventListener']('click',function(_0x330dca){const _0x5f157e=_0x4c016e;_0x330dca['preventDefault'](),_0x17a409[_0x5f157e(0x22b)](),_0x17a409['removeAttribute']('data-edit-id'),_0x23f969['textContent']='Report\x20Game',this[_0x5f157e(0x267)](),initReportForm();});}_0x17a409['scrollIntoView']({'behavior':_0x4c016e(0x21d)});}function initReportForm(){console['log']('Report\x20form\x20reset');}export function showMatchLightbox(_0x5bd9b7){const _0x551e10=a51_0x1acb,_0x3b37fc=document['getElementById']('report-lightbox');document[_0x551e10(0x1dd)]('lightbox-game-mode')['textContent']=currentGameMode,document[_0x551e10(0x1dd)](_0x551e10(0x231))['textContent']=_0x5bd9b7['winnerUsername']||_0x551e10(0x22e),document[_0x551e10(0x1dd)]('lightbox-loser')['textContent']=_0x5bd9b7[_0x551e10(0x21b)]||'Unknown',document['getElementById']('lightbox-loser-score')[_0x551e10(0x1e9)]=_0x5bd9b7[_0x551e10(0x224)]||'0',document['getElementById'](_0x551e10(0x241))[_0x551e10(0x1e9)]=_0x5bd9b7[_0x551e10(0x26c)]||'0',document['getElementById']('lightbox-map')['textContent']=_0x5bd9b7['mapPlayed']||'Unknown',document['getElementById']('lightbox-comment')['textContent']=_0x5bd9b7[_0x551e10(0x248)]||'No\x20comment',document['getElementById']('lightbox-subgame')['textContent']=_0x5bd9b7['subgameType']||'Standard\x20Match',_0x3b37fc['classList'][_0x551e10(0x20f)]('show');}export function setCurrentGameMode(_0x5ec3c7){currentGameMode=_0x5ec3c7;}export function initOutstandingMatches(){const _0x3d5f7d=a51_0x1acb;document['addEventListener'](_0x3d5f7d(0x24d),()=>{const _0x28ca96=_0x3d5f7d,_0x2a5ae2=document[_0x28ca96(0x1dd)](_0x28ca96(0x1f2)),_0x417f9c=document['getElementById']('view-outstanding-container'),_0xc22ff6=document['getElementById'](_0x28ca96(0x214)),_0x851104=document['getElementById']('close-outstanding-btn'),_0x19cc9e=document[_0x28ca96(0x1dd)](_0x28ca96(0x25f)),_0x322ec0=document[_0x28ca96(0x1dd)]('d1-mode'),_0x25342a=document['getElementById']('d2-mode'),_0x54c0ec=document['getElementById']('d3-mode');if(_0x322ec0)_0x322ec0['addEventListener']('click',()=>{setCurrentGameMode('D1');});if(_0x25342a)_0x25342a[_0x28ca96(0x20d)]('click',()=>{setCurrentGameMode('D2');});if(_0x54c0ec)_0x54c0ec[_0x28ca96(0x20d)](_0x28ca96(0x1fc),()=>{setCurrentGameMode('D3');});auth[_0x28ca96(0x213)](_0x1f4089=>{_0x1f4089?_0x417f9c['style']['display']='block':_0x417f9c['style']['display']='none';});_0x2a5ae2&&_0x2a5ae2[_0x28ca96(0x20d)]('click',async()=>{const _0x49e6cc=_0x28ca96;_0xc22ff6['classList']['add']('show'),document['getElementById'](_0x49e6cc(0x208))[_0x49e6cc(0x1f9)]='<div\x20class=\x22loading\x22>Loading\x20your\x20matches...</div>',await fetchOutstandingMatches(),renderOutstandingMatches();});_0x851104&&_0x851104['addEventListener']('click',()=>{const _0x1f43ee=_0x28ca96;_0xc22ff6['classList'][_0x1f43ee(0x267)]('show');});_0x19cc9e&&_0x19cc9e['addEventListener']('click',()=>{const _0x262f2a=_0x28ca96;document['getElementById'](_0x262f2a(0x251))['classList']['remove']('show');});_0xc22ff6&&_0xc22ff6['addEventListener'](_0x28ca96(0x1fc),_0x208673=>{_0x208673['target']===_0xc22ff6&&_0xc22ff6['classList']['remove']('show');});const _0x50931c=document['getElementById']('report-lightbox');_0x50931c&&_0x50931c['addEventListener']('click',_0x46176d=>{_0x46176d['target']===_0x50931c&&_0x50931c['classList']['remove']('show');});const _0x9eb8dd=document[_0x28ca96(0x1dd)]('report-form');if(_0x9eb8dd){const _0xd569f4=_0x9eb8dd[_0x28ca96(0x211)];_0x9eb8dd['onsubmit']=async function(_0x383cd5){const _0x3164ef=_0x28ca96;_0x383cd5[_0x3164ef(0x1f0)]();const _0x1e5ef7=this[_0x3164ef(0x1e1)]('data-edit-id');if(_0x1e5ef7)try{const _0x578f8a=document['getElementById']('loser-score')[_0x3164ef(0x1fd)],_0x3a7134=document['getElementById']('suicides')['value'],_0x5e4c0e=document['getElementById'](_0x3164ef(0x245))['value'],_0x4e477c=document[_0x3164ef(0x1dd)](_0x3164ef(0x24b))[_0x3164ef(0x1fd)],_0x5180cd=currentGameMode==='D1'?_0x3164ef(0x1ed):currentGameMode==='D2'?'pendingMatchesD2':_0x3164ef(0x225),_0x1c7416=doc(db,_0x5180cd,_0x1e5ef7);await updateDoc(_0x1c7416,{'loserScore':Number(_0x578f8a),'loserSuicides':Number(_0x3a7134),'mapPlayed':_0x5e4c0e,'loserComment':_0x4e477c,'subgameType':document[_0x3164ef(0x1dd)]('subgame-type')['value'],'updatedAt':new Date()}),alert(_0x3164ef(0x1d3)),this[_0x3164ef(0x22b)](),this[_0x3164ef(0x1d8)](_0x3164ef(0x1fe));const _0x50e3a7=this['querySelector']('button[type=\x22submit\x22]');_0x50e3a7['textContent']='Report\x20Game';const _0x2b9915=document['getElementById']('cancel-edit-btn');if(_0x2b9915)_0x2b9915['remove']();}catch(_0xe88939){console['error']('Error\x20updating\x20report:',_0xe88939),document['getElementById']('report-error')[_0x3164ef(0x1e9)]='Failed\x20to\x20update\x20report.\x20Please\x20try\x20again.';}else typeof _0xd569f4==='function'&&_0xd569f4['call'](this,_0x383cd5);};}});}typeof window!==a51_0x12a8d7(0x238)&&(window['showMatchLightbox']=showMatchLightbox,window['editReport']=editReport,window['rescindReport']=rescindReport,window['fetchOutstandingMatches']=fetchOutstandingMatches,window[a51_0x12a8d7(0x250)]=renderOutstandingMatches);function a51_0x1acb(_0x370086,_0x518f2d){const _0x449872=a51_0x408d();return a51_0x1acb=function(_0x19099b,_0x6b9ef5){_0x19099b=_0x19099b-0x1d2;let _0x408d6e=_0x449872[_0x19099b];return _0x408d6e;},a51_0x1acb(_0x370086,_0x518f2d);}initOutstandingMatches();
(function(_0x47cbea,_0x3fd3a0){const _0x3081a2=a29_0x190a,_0xf584f2=_0x47cbea();while(!![]){try{const _0x6ba7a6=parseInt(_0x3081a2(0x174))/0x1+-parseInt(_0x3081a2(0x160))/0x2+-parseInt(_0x3081a2(0x161))/0x3+-parseInt(_0x3081a2(0x187))/0x4+-parseInt(_0x3081a2(0x166))/0x5*(-parseInt(_0x3081a2(0x16a))/0x6)+parseInt(_0x3081a2(0x184))/0x7+-parseInt(_0x3081a2(0x171))/0x8*(-parseInt(_0x3081a2(0x16c))/0x9);if(_0x6ba7a6===_0x3fd3a0)break;else _0xf584f2['push'](_0xf584f2['shift']());}catch(_0x4dedc0){_0xf584f2['push'](_0xf584f2['shift']());}}}(a29_0x394b,0xa3c8e));const a29_0x471b21=(function(){let _0x56df9e=!![];return function(_0x3bd534,_0x11ec13){const _0x35a0aa=_0x56df9e?function(){const _0x3cebbf=a29_0x190a;if(_0x11ec13){const _0x4e0198=_0x11ec13[_0x3cebbf(0x18a)](_0x3bd534,arguments);return _0x11ec13=null,_0x4e0198;}}:function(){};return _0x56df9e=![],_0x35a0aa;};}()),a29_0x16089e=a29_0x471b21(this,function(){const _0x1935a7=a29_0x190a;return a29_0x16089e[_0x1935a7(0x165)]()[_0x1935a7(0x15d)](_0x1935a7(0x191))[_0x1935a7(0x165)]()[_0x1935a7(0x179)](a29_0x16089e)['search'](_0x1935a7(0x191));});a29_0x16089e();const a29_0x6b5b72=(function(){let _0x527432=!![];return function(_0x3a6420,_0x39bed7){const _0x48a2e=_0x527432?function(){const _0x4c0a8b=a29_0x190a;if(_0x39bed7){const _0x601540=_0x39bed7[_0x4c0a8b(0x18a)](_0x3a6420,arguments);return _0x39bed7=null,_0x601540;}}:function(){};return _0x527432=![],_0x48a2e;};}()),a29_0x301b7c=a29_0x6b5b72(this,function(){const _0x5dc9da=a29_0x190a,_0x39c4fe=function(){const _0x3c875e=a29_0x190a;let _0x22bdd6;try{_0x22bdd6=Function(_0x3c875e(0x189)+_0x3c875e(0x182)+');')();}catch(_0x12d561){_0x22bdd6=window;}return _0x22bdd6;},_0x55872a=_0x39c4fe(),_0x3cb3aa=_0x55872a[_0x5dc9da(0x17b)]=_0x55872a[_0x5dc9da(0x17b)]||{},_0x1e86ea=[_0x5dc9da(0x17e),'warn',_0x5dc9da(0x188),_0x5dc9da(0x16e),'exception',_0x5dc9da(0x192),_0x5dc9da(0x181)];for(let _0x2e222d=0x0;_0x2e222d<_0x1e86ea[_0x5dc9da(0x16f)];_0x2e222d++){const _0x3c2bc3=a29_0x6b5b72[_0x5dc9da(0x179)][_0x5dc9da(0x18e)][_0x5dc9da(0x175)](a29_0x6b5b72),_0x36cc95=_0x1e86ea[_0x2e222d],_0x396bd7=_0x3cb3aa[_0x36cc95]||_0x3c2bc3;_0x3c2bc3[_0x5dc9da(0x18d)]=a29_0x6b5b72[_0x5dc9da(0x175)](a29_0x6b5b72),_0x3c2bc3[_0x5dc9da(0x165)]=_0x396bd7[_0x5dc9da(0x165)]['bind'](_0x396bd7),_0x3cb3aa[_0x36cc95]=_0x3c2bc3;}});function a29_0x394b(){const _0x39448d=['D3\x20ELO\x20ratings\x20updated\x20successfully','docs','Could\x20not\x20find\x20D3\x20player\x20documents','toString','5274575psFnRg','winnerUsername','eloRating','No\x20user\x20logged\x20in','6vHnwFF','Error\x20in\x20approveReportD3:','1486719sUwnDD','round','error','length','email','64zPxyBY','loserUsername','pendingMatchesD3','1338295kcbMJb','bind','D3\x20Report\x20data:','Error\x20in\x20updateEloRatingsD3:','Current\x20username:','constructor','You\x20must\x20be\x20logged\x20in\x20to\x20approve\x20D3\x20matches','console','win','pow','log','D3\x20Match\x20successfully\x20approved\x20and\x20ELO\x20updated','Only\x20the\x20winner\x20can\x20approve\x20D3\x20matches','trace','{}.constructor(\x22return\x20this\x22)(\x20)','playersD3','1745800Euuqra','uid','empty','3848040MhoWfh','info','return\x20(function()\x20','apply','all','MAX_SAFE_INTEGER','__proto__','prototype','D3\x20Match\x20moved\x20to\x20approved\x20collection','exists','(((.+)+)+)+$','table','update','createdAt','Current\x20user:','data','D3\x20Position\x20swap\x20needed\x20-\x20winner\x20was\x20lower\x20ranked','D3\x20match\x20report\x20not\x20found','commit','position','approvedMatchesD3','search','username','loss','2248898imCtRr','3620451Dytevx'];a29_0x394b=function(){return _0x39448d;};return a29_0x394b();}a29_0x301b7c();import{addDoc,updateDoc,serverTimestamp,collection,doc,getDoc,getDocs,query,where,setDoc,deleteDoc,writeBatch}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db,auth}from'./firebase-config.js';import{recordEloChangeD3}from'./elo-history-d3.js';export function calculateEloD3(_0x3ecfd4,_0x6d60b7,_0x42e54a=0x20){const _0x5c44eb=a29_0x190a,_0x1955dd=0x1/(0x1+Math['pow'](0xa,(_0x6d60b7-_0x3ecfd4)/0x190)),_0x233bc7=0x1/(0x1+Math[_0x5c44eb(0x17d)](0xa,(_0x3ecfd4-_0x6d60b7)/0x190)),_0x4edab0=_0x3ecfd4+_0x42e54a*(0x1-_0x1955dd),_0x492fb5=_0x6d60b7+_0x42e54a*(0x0-_0x233bc7);return{'newWinnerRating':Math[_0x5c44eb(0x16d)](_0x4edab0),'newLoserRating':Math[_0x5c44eb(0x16d)](_0x492fb5)};}function a29_0x190a(_0x39afc8,_0xaa7bfc){const _0x335783=a29_0x394b();return a29_0x190a=function(_0x301b7c,_0x6b5b72){_0x301b7c=_0x301b7c-0x15b;let _0x345454=_0x335783[_0x301b7c];return _0x345454;},a29_0x190a(_0x39afc8,_0xaa7bfc);}export async function updateEloRatingsD3(_0x16931f,_0x12ea72,_0x4b2ea3){const _0x2de8d1=a29_0x190a;try{const _0x2c437b=writeBatch(db),_0x53c9b1=doc(db,_0x2de8d1(0x183),_0x16931f),_0x3f71dc=doc(db,'playersD3',_0x12ea72),[_0x1b8b1c,_0x478647]=await Promise[_0x2de8d1(0x18b)]([getDoc(_0x53c9b1),getDoc(_0x3f71dc)]);if(!_0x1b8b1c[_0x2de8d1(0x190)]()||!_0x478647[_0x2de8d1(0x190)]())throw new Error('One\x20or\x20both\x20D3\x20players\x20not\x20found');const _0x1b5ae7=_0x1b8b1c[_0x2de8d1(0x196)](),_0x2140be=_0x478647[_0x2de8d1(0x196)](),_0x297d32=_0x1b5ae7[_0x2de8d1(0x15b)]||Number[_0x2de8d1(0x18c)],_0x1b47ed=_0x2140be[_0x2de8d1(0x15b)]||Number[_0x2de8d1(0x18c)],{newWinnerRating:_0x1b1324,newLoserRating:_0x54fb9e}=calculateEloD3(_0x1b5ae7[_0x2de8d1(0x168)]||0x4b0,_0x2140be[_0x2de8d1(0x168)]||0x4b0);let _0x3b7d49=_0x297d32,_0x17e200=_0x1b47ed;if(_0x297d32>_0x1b47ed){console[_0x2de8d1(0x17e)](_0x2de8d1(0x197)),_0x3b7d49=_0x1b47ed,_0x17e200=_0x1b47ed+0x1;const _0x5f5396=query(collection(db,_0x2de8d1(0x183)),where('position','>',_0x1b47ed),where(_0x2de8d1(0x15b),'<',_0x297d32)),_0xecc6c8=await getDocs(_0x5f5396);for(const _0x586463 of _0xecc6c8['docs']){_0x586463['id']!==_0x16931f&&_0x586463['id']!==_0x12ea72&&_0x2c437b[_0x2de8d1(0x193)](doc(db,_0x2de8d1(0x183),_0x586463['id']),{'position':_0x586463[_0x2de8d1(0x196)]()[_0x2de8d1(0x15b)]+0x1});}}else console[_0x2de8d1(0x17e)]('D3\x20Winner\x20already\x20ranked\x20higher\x20-\x20keeping\x20positions');return _0x2c437b[_0x2de8d1(0x193)](_0x53c9b1,{'eloRating':_0x1b1324,'lastMatchDate':serverTimestamp(),'position':_0x3b7d49,'lastMatchId':_0x4b2ea3}),_0x2c437b[_0x2de8d1(0x193)](_0x3f71dc,{'eloRating':_0x54fb9e,'lastMatchDate':serverTimestamp(),'position':_0x17e200,'lastMatchId':_0x4b2ea3}),await _0x2c437b[_0x2de8d1(0x199)](),console[_0x2de8d1(0x17e)](_0x2de8d1(0x162)),await Promise[_0x2de8d1(0x18b)]([recordEloChangeD3({'playerId':_0x16931f,'previousElo':_0x1b5ae7['eloRating']||0x4b0,'newElo':_0x1b1324,'opponentId':_0x12ea72,'matchResult':_0x2de8d1(0x17c),'previousPosition':_0x297d32,'newPosition':_0x3b7d49,'isPromotion':_0x3b7d49<_0x297d32,'matchId':_0x4b2ea3,'timestamp':serverTimestamp()}),recordEloChangeD3({'playerId':_0x12ea72,'previousElo':_0x2140be[_0x2de8d1(0x168)]||0x4b0,'newElo':_0x54fb9e,'opponentId':_0x16931f,'matchResult':_0x2de8d1(0x15f),'previousPosition':_0x1b47ed,'newPosition':_0x17e200,'isDemotion':_0x17e200>_0x1b47ed,'matchId':_0x4b2ea3,'timestamp':serverTimestamp()})]),!![];}catch(_0x2ed846){console[_0x2de8d1(0x16e)](_0x2de8d1(0x177),_0x2ed846);throw _0x2ed846;}}export async function approveReportD3(_0x268200,_0x39db3a,_0x123061,_0xb9e01c){const _0x3d3202=a29_0x190a;try{console[_0x3d3202(0x17e)]('Starting\x20approveReportD3\x20function\x20with:',{'reportId':_0x268200,'winnerScore':_0x39db3a,'winnerSuicides':_0x123061,'winnerComment':_0xb9e01c});const _0x5bf46f=auth['currentUser'];if(!_0x5bf46f){console['log'](_0x3d3202(0x169));throw new Error(_0x3d3202(0x17a));}console['log'](_0x3d3202(0x195),_0x5bf46f[_0x3d3202(0x170)]);const _0x2c90fb=await getDoc(doc(db,_0x3d3202(0x183),_0x5bf46f[_0x3d3202(0x185)])),_0x303daf=_0x2c90fb['exists']()?_0x2c90fb[_0x3d3202(0x196)]()[_0x3d3202(0x15e)]:null;console[_0x3d3202(0x17e)](_0x3d3202(0x178),_0x303daf);const _0x3bf782=doc(db,_0x3d3202(0x173),_0x268200),_0x2ae510=await getDoc(_0x3bf782);if(!_0x2ae510[_0x3d3202(0x190)]()){console['log']('D3\x20Report\x20not\x20found\x20with\x20ID:',_0x268200);throw new Error(_0x3d3202(0x198));}const _0x425203=_0x2ae510[_0x3d3202(0x196)]();console['log'](_0x3d3202(0x176),_0x425203);if(_0x303daf!==_0x425203['winnerUsername'])throw new Error(_0x3d3202(0x180));const _0x374a00={..._0x425203,'winnerScore':_0x39db3a,'winnerSuicides':_0x123061,'winnerComment':_0xb9e01c,'approved':!![],'approvedAt':serverTimestamp(),'approvedBy':_0x303daf,'createdAt':_0x425203[_0x3d3202(0x194)]||serverTimestamp(),'winnerUsername':_0x425203[_0x3d3202(0x167)],'loserUsername':_0x425203[_0x3d3202(0x172)]};await setDoc(doc(db,_0x3d3202(0x15c),_0x268200),_0x374a00),await deleteDoc(_0x3bf782),console['log'](_0x3d3202(0x18f));const [_0x1f4239,_0x14a765]=await Promise[_0x3d3202(0x18b)]([getDocs(query(collection(db,'playersD3'),where(_0x3d3202(0x15e),'==',_0x425203[_0x3d3202(0x167)]))),getDocs(query(collection(db,_0x3d3202(0x183)),where('username','==',_0x425203[_0x3d3202(0x172)])))]);if(_0x1f4239[_0x3d3202(0x186)]||_0x14a765['empty'])throw new Error(_0x3d3202(0x164));const _0x5ade3b=_0x1f4239[_0x3d3202(0x163)][0x0]['id'],_0x5a57b1=_0x14a765[_0x3d3202(0x163)][0x0]['id'];return await updateEloRatingsD3(_0x5ade3b,_0x5a57b1,_0x268200),console[_0x3d3202(0x17e)](_0x3d3202(0x17f)),!![];}catch(_0x4157df){console[_0x3d3202(0x16e)](_0x3d3202(0x16b),_0x4157df);throw _0x4157df;}}
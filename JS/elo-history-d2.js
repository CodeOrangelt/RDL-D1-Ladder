const a12_0xe7933a=a12_0x1e3d,a12_0x5ce44b=(function(){let _0x1e447f=!![];return function(_0x3c8cf0,_0x4beda6){const _0x2f6b3a=_0x1e447f?function(){const _0x2440a9=a12_0x1e3d;if(_0x4beda6){const _0xc4b7d=_0x4beda6[_0x2440a9(0xda)](_0x3c8cf0,arguments);return _0x4beda6=null,_0xc4b7d;}}:function(){};return _0x1e447f=![],_0x2f6b3a;};}()),a12_0x5f3464=a12_0x5ce44b(this,function(){const _0x1f071d=a12_0x1e3d,_0x20c741=function(){const _0x2d083d=a12_0x1e3d;let _0x669343;try{_0x669343=Function(_0x2d083d(0xe1)+_0x2d083d(0xb5)+');')();}catch(_0x7a2c48){_0x669343=window;}return _0x669343;},_0x35f9b6=_0x20c741(),_0x3e0181=_0x35f9b6[_0x1f071d(0xd3)]=_0x35f9b6[_0x1f071d(0xd3)]||{},_0x34084c=[_0x1f071d(0xce),_0x1f071d(0xc7),_0x1f071d(0xc1),_0x1f071d(0xc9),_0x1f071d(0xc2),_0x1f071d(0xd4),_0x1f071d(0xc4)];for(let _0x49e769=0x0;_0x49e769<_0x34084c[_0x1f071d(0xdf)];_0x49e769++){const _0x156847=a12_0x5ce44b[_0x1f071d(0xcc)][_0x1f071d(0xe3)][_0x1f071d(0xe5)](a12_0x5ce44b),_0x700958=_0x34084c[_0x49e769],_0x3beb08=_0x3e0181[_0x700958]||_0x156847;_0x156847[_0x1f071d(0xd9)]=a12_0x5ce44b[_0x1f071d(0xe5)](a12_0x5ce44b),_0x156847[_0x1f071d(0xcf)]=_0x3beb08[_0x1f071d(0xcf)][_0x1f071d(0xe5)](_0x3beb08),_0x3e0181[_0x700958]=_0x156847;}});a12_0x5f3464();function a12_0x1e3d(_0xe18370,_0x5b8ce9){const _0x5f3464=a12_0x4e1a();return a12_0x1e3d=function(_0x5ce44b,_0x3800ac){_0x5ce44b=_0x5ce44b-0xb5;let _0x4e1aa2=_0x5f3464[_0x5ce44b];return _0x4e1aa2;},a12_0x1e3d(_0xe18370,_0x5b8ce9);}import{collection,addDoc,serverTimestamp,query,orderBy,getDocs,limit,startAfter,doc,setDoc,getDoc}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';import{db}from'./firebase-config.js';const ELO_THRESHOLDS_D2=[{'name':a12_0xe7933a(0xbc),'elo':0x708},{'name':a12_0xe7933a(0xdb),'elo':0x640},{'name':a12_0xe7933a(0xbb),'elo':0x578},{'name':a12_0xe7933a(0xd8),'elo':0x4b0}];let lastVisibleD2=null;function a12_0x4e1a(){const _0x1ea5dc=['{}.constructor(\x22return\x20this\x22)(\x20)','player','previousElo','winnerId','map','Error\x20recording\x20D2\x20ELO\x20history:','Bronze','Gold','opponent','playersD2','loserUsername','docs','info','exception','Error\x20fetching\x20D2\x20ELO\x20history:','trace','demotion','newElo','warn','desc','error','empty','data','constructor','Unknown\x20Player','log','toString','exists','winnerUsername','approvedMatchesD2','console','table','match','Error\x20getting\x20username:','Emerald','Unranked','__proto__','apply','Silver','all','eloHistoryD2','username','length','D2\x20ELO\x20history\x20recorded\x20for\x20','return\x20(function()\x20','size','prototype','timestamp','bind','promotion','loserId'];a12_0x4e1a=function(){return _0x1ea5dc;};return a12_0x4e1a();}async function getUsernameByIdD2(_0x5ac9d3){const _0x267ea5=a12_0xe7933a;try{if(!_0x5ac9d3)return _0x267ea5(0xcd);const _0x5814db=await getDoc(doc(db,_0x267ea5(0xbe),_0x5ac9d3));if(_0x5814db[_0x267ea5(0xd0)]())return _0x5814db[_0x267ea5(0xcb)]()[_0x267ea5(0xde)]||_0x267ea5(0xcd);const _0x5042c3=await getDocs(query(collection(db,_0x267ea5(0xd2)),where(_0x267ea5(0xb8),'==',_0x5ac9d3),limit(0x1)));if(!_0x5042c3[_0x267ea5(0xca)])return _0x5042c3[_0x267ea5(0xc0)][0x0][_0x267ea5(0xcb)]()[_0x267ea5(0xd1)]||_0x267ea5(0xcd);const _0x176696=await getDocs(query(collection(db,_0x267ea5(0xd2)),where(_0x267ea5(0xe7),'==',_0x5ac9d3),limit(0x1)));if(!_0x176696[_0x267ea5(0xca)])return _0x176696[_0x267ea5(0xc0)][0x0][_0x267ea5(0xcb)]()[_0x267ea5(0xbf)]||_0x267ea5(0xcd);return _0x267ea5(0xcd);}catch(_0x173cb8){return console[_0x267ea5(0xc9)](_0x267ea5(0xd6),_0x173cb8),_0x267ea5(0xcd);}}export async function recordEloChangeD2({playerId:_0x7a816a,previousElo:_0x203168,newElo:_0x336de3,opponentId:_0xbdf1d1,matchResult:_0x353aea,previousPosition:_0x37765e,newPosition:_0x53d91f,isPromotion:isPromotion=![],isDemotion:isDemotion=![],matchId:_0x807382,timestamp:_0xd1980c}){const _0x5aeee4=a12_0xe7933a;try{const _0x181a2d=doc(collection(db,_0x5aeee4(0xdd)));let _0x744403=_0x5aeee4(0xd5);if(isPromotion)_0x744403=_0x5aeee4(0xe6);if(isDemotion)_0x744403=_0x5aeee4(0xc5);let _0x5d4021=_0x5aeee4(0xd8);if(_0x336de3>=0x834)_0x5d4021=_0x5aeee4(0xd7);else{if(_0x336de3>=0x708)_0x5d4021=_0x5aeee4(0xbc);else{if(_0x336de3>=0x640)_0x5d4021=_0x5aeee4(0xdb);else{if(_0x336de3>=0x578)_0x5d4021=_0x5aeee4(0xbb);}}}return await setDoc(_0x181a2d,{'type':_0x744403,'player':_0x7a816a,'opponent':_0xbdf1d1,'previousElo':_0x203168,'newElo':_0x336de3,'change':_0x336de3-_0x203168,'matchResult':_0x353aea,'previousPosition':_0x37765e,'newPosition':_0x53d91f,'rankAchieved':_0x5d4021,'matchId':_0x807382,'timestamp':_0xd1980c}),console[_0x5aeee4(0xce)](_0x5aeee4(0xe0)+_0x7a816a),!![];}catch(_0x3ef8b1){console[_0x5aeee4(0xc9)](_0x5aeee4(0xba),_0x3ef8b1);throw _0x3ef8b1;}}export async function getEloHistoryD2(_0x1bbb3b=0x14){const _0x26ce0b=a12_0xe7933a;try{const _0x5c51c0=collection(db,_0x26ce0b(0xdd));let _0x4f5dbc;lastVisibleD2?_0x4f5dbc=query(_0x5c51c0,orderBy(_0x26ce0b(0xe4),_0x26ce0b(0xc8)),startAfter(lastVisibleD2),limit(_0x1bbb3b)):_0x4f5dbc=query(_0x5c51c0,orderBy(_0x26ce0b(0xe4),_0x26ce0b(0xc8)),limit(_0x1bbb3b));const _0x5ca7b9=await getDocs(_0x4f5dbc);if(_0x5ca7b9[_0x26ce0b(0xca)])return{'entries':[],'hasMore':![]};lastVisibleD2=_0x5ca7b9[_0x26ce0b(0xc0)][_0x5ca7b9[_0x26ce0b(0xc0)][_0x26ce0b(0xdf)]-0x1];const _0x537ff8=_0x5ca7b9[_0x26ce0b(0xc0)][_0x26ce0b(0xb9)](async _0x3576ba=>{const _0x3625d4=_0x26ce0b,_0x16d4cb=_0x3576ba[_0x3625d4(0xcb)](),[_0x24e819,_0x39c56c]=await Promise[_0x3625d4(0xdc)]([getUsernameByIdD2(_0x16d4cb[_0x3625d4(0xb6)]),getUsernameByIdD2(_0x16d4cb[_0x3625d4(0xbd)])]);return{..._0x16d4cb,'playerUsername':_0x24e819,'opponentUsername':_0x39c56c,'change':_0x16d4cb[_0x3625d4(0xc6)]-_0x16d4cb[_0x3625d4(0xb7)],'timestamp':_0x16d4cb[_0x3625d4(0xe4)]};}),_0x38b67c=await Promise[_0x26ce0b(0xdc)](_0x537ff8);return{'entries':_0x38b67c,'hasMore':_0x5ca7b9[_0x26ce0b(0xe2)]===_0x1bbb3b};}catch(_0x31f301){console[_0x26ce0b(0xc9)](_0x26ce0b(0xc3),_0x31f301);throw _0x31f301;}}export function resetPaginationD2(){lastVisibleD2=null;}
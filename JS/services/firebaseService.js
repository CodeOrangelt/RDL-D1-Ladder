const a50_0x38a6bb=(function(){let _0x2c1c5c=!![];return function(_0x166f56,_0x11423d){const _0x3c06a5=_0x2c1c5c?function(){if(_0x11423d){const _0x3300d5=_0x11423d['apply'](_0x166f56,arguments);return _0x11423d=null,_0x3300d5;}}:function(){};return _0x2c1c5c=![],_0x3c06a5;};}()),a50_0x59dee4=a50_0x38a6bb(this,function(){const _0xd305df=a50_0x53a0;let _0xd19ef5;try{const _0x147670=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0xd19ef5=_0x147670();}catch(_0x4cb13e){_0xd19ef5=window;}const _0x4db8a5=_0xd19ef5['console']=_0xd19ef5['console']||{},_0x17880b=['log','warn','info','error','exception','table',_0xd305df(0x93)];for(let _0x5e262f=0x0;_0x5e262f<_0x17880b[_0xd305df(0x8f)];_0x5e262f++){const _0x399303=a50_0x38a6bb[_0xd305df(0x97)]['prototype']['bind'](a50_0x38a6bb),_0x9e44f8=_0x17880b[_0x5e262f],_0x3b0730=_0x4db8a5[_0x9e44f8]||_0x399303;_0x399303[_0xd305df(0x8d)]=a50_0x38a6bb[_0xd305df(0x87)](a50_0x38a6bb),_0x399303[_0xd305df(0x96)]=_0x3b0730['toString']['bind'](_0x3b0730),_0x4db8a5[_0x9e44f8]=_0x399303;}});a50_0x59dee4();import{db}from'../firebase-config.js';function a50_0x53a0(_0x575a81,_0x1c73b8){const _0x59dee4=a50_0x3603();return a50_0x53a0=function(_0x38a6bb,_0xf2c14d){_0x38a6bb=_0x38a6bb-0x86;let _0x36036f=_0x59dee4[_0x38a6bb];return _0x36036f;},a50_0x53a0(_0x575a81,_0x1c73b8);}import{collection,doc,getDoc,getDocs,query,limit,startAfter,where,onSnapshot}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';const cache={'userProfiles':new Map(),'ladderPlayers':new Map(),'matchResults':new Map(),'eloHistory':new Map()},CACHE_EXPIRY={'userProfiles':0x5*0x3c*0x3e8,'ladderPlayers':0x2*0x3c*0x3e8,'matchResults':0x1*0x3c*0x3e8,'eloHistory':0x3*0x3c*0x3e8};export const userProfilesRef=collection(db,'userProfiles');export async function fetchPaginatedData(_0x541659,_0x4feb0b=0xa,_0x509e54=null){const _0x15445c=a50_0x53a0;let _0x4a92bf=query(_0x541659,limit(_0x4feb0b));_0x509e54&&(_0x4a92bf=query(_0x4a92bf,startAfter(_0x509e54)));const _0x3f7d16=await getDocs(_0x4a92bf),_0x58e990=_0x3f7d16['docs'][_0x3f7d16[_0x15445c(0x8c)]['length']-0x1];return{'data':_0x3f7d16['docs']['map'](_0x222b6d=>({'id':_0x222b6d['id'],..._0x222b6d['data']()})),'lastVisible':_0x58e990,'hasMore':_0x3f7d16['docs'][_0x15445c(0x8f)]===_0x4feb0b};}export async function getUserProfile(_0x5e8783){const _0x1953c5=a50_0x53a0,_0x16051b=cache['userProfiles']['get'](_0x5e8783);if(_0x16051b&&Date[_0x1953c5(0x94)]()-_0x16051b[_0x1953c5(0x88)]<CACHE_EXPIRY['userProfiles'])return _0x16051b['data'];const _0x46858c=await getDoc(doc(userProfilesRef,_0x5e8783));if(_0x46858c[_0x1953c5(0x91)]()){const _0x47b58b=_0x46858c['data']();return cache['userProfiles']['set'](_0x5e8783,{'data':_0x47b58b,'timestamp':Date[_0x1953c5(0x94)]()}),_0x47b58b;}return null;}function a50_0x3603(){const _0x57a8b6=['docChanges','bind','timestamp','data','map','playerId','docs','__proto__','push','length','ladderPlayers','exists','players','trace','now','forEach','toString','constructor','playersD2','get','playersD3','username'];a50_0x3603=function(){return _0x57a8b6;};return a50_0x3603();}export async function getLadderData(_0x468ea1=0x1){const _0x41affd=a50_0x53a0,_0x815ba9='division_'+_0x468ea1,_0x41885d=cache['ladderPlayers'][_0x41affd(0x99)](_0x815ba9);if(_0x41885d&&Date['now']()-_0x41885d['timestamp']<CACHE_EXPIRY[_0x41affd(0x90)])return _0x41885d['data'];const _0xba9930=_0x468ea1===0x1?_0x41affd(0x92):'playersD'+_0x468ea1,_0x56d865=collection(db,_0xba9930),_0x216e44=await getDocs(query(_0x56d865,limit(0x64))),_0x5cffd7=_0x216e44['docs']['map'](_0x2b0074=>({'id':_0x2b0074['id'],..._0x2b0074['data']()}));return cache[_0x41affd(0x90)]['set'](_0x815ba9,{'data':_0x5cffd7,'timestamp':Date['now']()}),_0x5cffd7;}export async function getEloHistoryBatch(_0x31f87c,_0x137c7e=0x1){const _0x37f004=a50_0x53a0,_0x270941=_0x137c7e===0x1?'eloHistory':'eloHistoryD'+_0x137c7e,_0x4b16e7=collection(db,_0x270941),_0x1d4782={},_0x373cfc=[];_0x31f87c['forEach'](_0x200125=>{const _0x59e47c=a50_0x53a0,_0x3e97d4=_0x200125+'_'+_0x137c7e,_0x53583a=cache['eloHistory']['get'](_0x3e97d4);_0x53583a&&Date['now']()-_0x53583a['timestamp']<CACHE_EXPIRY['eloHistory']?_0x1d4782[_0x200125]=_0x53583a[_0x59e47c(0x89)]:_0x373cfc['push'](_0x200125);});const _0xe546c8=0xa;for(let _0x1a742a=0x0;_0x1a742a<_0x373cfc['length'];_0x1a742a+=_0xe546c8){const _0x364631=_0x373cfc['slice'](_0x1a742a,_0x1a742a+_0xe546c8);if(_0x364631[_0x37f004(0x8f)]>0x0)try{const _0x485fd7=query(_0x4b16e7,where(_0x37f004(0x8b),'in',_0x364631),limit(0x64)),_0x3035b9=await getDocs(_0x485fd7);_0x3035b9['docs']['forEach'](_0x556766=>{const _0x4966a3=_0x37f004,_0x4e3cd6=_0x556766['data'](),_0x56e9e4=_0x4e3cd6['playerId'];if(!_0x1d4782[_0x56e9e4])_0x1d4782[_0x56e9e4]=[];_0x1d4782[_0x56e9e4][_0x4966a3(0x8e)](_0x4e3cd6);const _0x5a6e67=_0x56e9e4+'_'+_0x137c7e;cache['eloHistory']['set'](_0x5a6e67,{'data':_0x1d4782[_0x56e9e4],'timestamp':Date['now']()});});}catch(_0x469539){console['error']('Error\x20fetching\x20batch\x20ELO\x20history:',_0x469539);}}return _0x1d4782;}let usernameCache=new Map(),usernameCacheTimestamp=Date['now']();export function setupEfficientListener(_0x4551f6,_0x3a9631=[],_0x41e25f){const _0x32c01e=collection(db,_0x4551f6),_0x392dd8=query(_0x32c01e,..._0x3a9631),_0x189554=onSnapshot(_0x392dd8,_0x59dcfb=>{const _0x5a9720=a50_0x53a0,_0x131cfc=_0x59dcfb[_0x5a9720(0x86)]()[_0x5a9720(0x8a)](_0x2ad95e=>({'type':_0x2ad95e['type'],'id':_0x2ad95e['doc']['id'],'data':_0x2ad95e['doc']['data']()}));_0x131cfc['length']>0x0&&_0x41e25f(_0x131cfc,_0x59dcfb['docs']);});return _0x189554;}export async function bulkResolveUsernames(_0x32f3ee){const _0x3f3b77=a50_0x53a0,_0x4e7b95=new Map();if(!_0x32f3ee||_0x32f3ee['length']===0x0)return _0x4e7b95;const _0x3c7a5b=[_0x3f3b77(0x92),_0x3f3b77(0x98),_0x3f3b77(0x9a),'nonParticipants'];for(const _0x3ebfd1 of _0x3c7a5b){const _0x39a246=collection(db,_0x3ebfd1),_0x3808b9=await getDocs(_0x39a246);_0x3808b9[_0x3f3b77(0x95)](_0x59620c=>{const _0x1bf9f0=_0x3f3b77,_0x4bd137=_0x59620c['data']();_0x4bd137['username']&&_0x32f3ee['includes'](_0x59620c['id'])&&_0x4e7b95['set'](_0x59620c['id'],_0x4bd137[_0x1bf9f0(0x9b)]);});}return _0x4e7b95;}